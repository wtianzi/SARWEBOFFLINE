/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"../../chunks/tslib.es6.js";import"../../chunks/ArrayPool.js";import"../../core/lang.js";import"../../chunks/deprecate.js";import"../../chunks/object.js";import"../../kernel.js";import"../../config.js";import"../../chunks/Logger.js";import"../../chunks/string.js";import"../../chunks/metadata.js";import"../../core/accessorSupport/decorators/property.js";import"../../core/Accessor.js";import"../../chunks/PropertyOrigin.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../chunks/Message.js";import e from"../../core/Error.js";import"../../chunks/compilerUtils.js";import"../../chunks/ensureType.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Evented.js";import"../../core/Collection.js";import"../../chunks/collectionUtils.js";import"../../chunks/JSONSupport.js";import"../../chunks/Promise.js";import"../../chunks/Loadable.js";import"../../chunks/asyncUtils.js";import"../../chunks/loadAll.js";import"../../core/urlUtils.js";import"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/jsonMap.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../chunks/resourceExtension.js";import"../../chunks/persistableUrlUtils.js";import"../../geometry/SpatialReference.js";import"../../chunks/locale.js";import"../../chunks/number.js";import{fetchMessageBundle as n,substitute as r}from"../../intl.js";import"../../request.js";import"../../chunks/assets.js";import"../../geometry/Geometry.js";import"../../geometry/Point.js";import"../../chunks/Ellipsoid.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Extent.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../../portal/PortalUser.js";import"../../portal/Portal.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../portal/PortalItem.js";import"../../Basemap.js";import"../../chunks/writeUtils.js";import"../../chunks/mathUtils2.js";import"../../chunks/colorUtils.js";import"../../Color.js";import"../../chunks/zmUtils.js";import"../../geometry/Multipoint.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../geometry.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/domains.js";import"../../chunks/arcadeOnDemand.js";import"../../layers/support/fieldUtils.js";import"../../popup/content/Content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/CustomContent.js";import"../../chunks/date.js";import"../../popup/support/FieldInfoFormat.js";import t from"../../popup/FieldInfo.js";import"../../popup/content/FieldsContent.js";import"../../chunks/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/MediaContent.js";import"../../popup/content/TextContent.js";import"../../popup/content.js";import o from"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/RelatedRecordsInfo.js";import"../../chunks/Identifiable.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import s from"../../PopupTemplate.js";import"../../symbols/Symbol.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/screenUtils.js";import"../../chunks/opacityUtils.js";import"../../chunks/materialUtils.js";import"../../symbols/edges/Edges3D.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/utils.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/patterns/StylePattern3D.js";import"../../symbols/FillSymbol3DLayer.js";import"../../chunks/colors.js";import"../../chunks/Symbol3DOutline.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/Symbol3D.js";import"../../chunks/Thumbnail.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../chunks/Symbol3DVerticalOffset.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../symbols.js";import"../../chunks/uid.js";import"../../Graphic.js";import"../../chunks/basemapUtils.js";import"../../renderers/visualVariables/support/ColorStop.js";import"../../chunks/sizeVariableUtils.js";import"../../chunks/unitUtils.js";import"../../chunks/lengthUtils.js";import"../../chunks/visualVariableUtils.js";import"../../chunks/utils5.js";import{b as i,c as a,d as p,e as l,f as m,h as f}from"../../chunks/predominanceUtils.js";import"../../chunks/numberUtils.js";import"../../chunks/utils7.js";import{a as d,h as u,b as c,e as y,c as I,g as j}from"../../chunks/utils6.js";async function h(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("class-breaks"!==o.type)throw new e("class-breaks-popup:invalid-parameters","renderer.type must be 'class-breaks'");return{layer:r,renderer:o}}async function b(e,n,r="divide"){const{fieldInfos:t,expressionInfos:o}=await c({renderer:e,layer:n,normFieldExpressionTemplate:r});return new s({content:await d(n,{fieldInfos:t,expressionInfos:o}),fieldInfos:t,expressionInfos:o})}async function g(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("dot-density"!==o.type)throw new e("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:r,renderer:o}}async function x(e,n){const{fieldInfos:r,expressionInfos:t}=await c({renderer:e,layer:n});return new s({content:await d(n,{fieldInfos:r,expressionInfos:t}),expressionInfos:t,fieldInfos:r})}async function w(e,n,r){const{fieldInfos:a,expressionInfos:p}=await c({renderer:e,layer:n}),l=a.filter((e=>-1===e.fieldName.indexOf(y))),m={fieldInfo:new t({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new o({name:"dot-density-categories-list",title:r.listOfCategories,expression:i(l,p)})},f=new s({expressionInfos:[m.expressionInfo],fieldInfos:[m.fieldInfo],title:r.competingFields,content:`{${m.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:r.orderedListOfValues,value:f}}async function k(e,n,r){const{fieldInfos:i,expressionInfos:p}=await c({renderer:e,layer:n}),l=i.filter((e=>-1===e.fieldName.indexOf(y))),m={fieldInfo:new t({fieldName:"expression/dot-density-category"}),expressionInfo:new o({name:"dot-density-category",title:r.predominantCategory,expression:a(l,p)})},f=new s({expressionInfos:[m.expressionInfo,...p],fieldInfos:[m.fieldInfo,...i],content:[{type:"text",text:`<div><b><font size="3">{${m.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:r.competingFields,value:{fields:i.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:r.predominantCategoryWithChart,value:f}}async function S(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("heatmap"!==o.type)throw new e("heatmap-popup:invalid-parameters","renderer.type must be 'heatmap'");return{layer:r,renderer:o}}function v(e,n){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:n.competingFields}function C(e,n){return{fieldInfo:new t({fieldName:"expression/predominant-category"}),expressionInfo:new o({name:"predominant-category",title:n.predominantCategory,expression:a(e)})}}function N(e,n){const r=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new o({name:"predominant-value",title:n.predominantCategoryValue,expression:p(r),returnType:"number"})}}function M(e,n){const r=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-strength",title:n.strengthOfPredominance,expression:m(r),returnType:"number"})}}function P(e,n){const t=C(e.fieldInfos,n),o=new s({expressionInfos:[t.expressionInfo],fieldInfos:[t.fieldInfo],content:r(n.predominantCategoryContent,{expression:`<b>{${t.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:n.predominantCategory,value:o}}function T(e,n){const{fieldInfos:t}=e,o=C(t,n),i=N(t,n),a=new s({expressionInfos:[i.expressionInfo,o.expressionInfo],fieldInfos:[i.fieldInfo,o.fieldInfo],content:r(n.predominantCategoryValueContent,{expression1:`<b>{${o.fieldInfo.fieldName}}</b>`,expression2:`<b>{${i.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:n.predominantCategoryValue,value:a}}function D(e,n){const{fieldInfos:i}=e,a=C(i,n),p=N(i,n),m=function(e,n){const r=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-margin",title:n.marginOfVictory,expression:l(r),returnType:"number"})}}(i,n),f=new s({expressionInfos:[p.expressionInfo,a.expressionInfo,m.expressionInfo],fieldInfos:[p.fieldInfo,a.fieldInfo,m.fieldInfo],title:r(n.mostCommon,{expression:"{expression/predominant-category}"}),content:r(n.predominantCategoryValueMarginContent,{expression1:`<b>{${a.fieldInfo.fieldName}}</b>`,expression2:`<b>{${p.fieldInfo.fieldName}}</b>`,expression3:`<b>{${m.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:n.marginOfVictory,value:f}}function U(e,n){const{fieldInfos:t}=e,o=C(t,n),i=N(t,n),a=M(t,n),p=new s({expressionInfos:[i.expressionInfo,o.expressionInfo,a.expressionInfo],fieldInfos:[i.fieldInfo,o.fieldInfo,a.fieldInfo],content:r(n.predominantCategoryStrengthContent,{expression1:`{${i.fieldInfo.fieldName}}`,expression2:`<b>{${o.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:n.strengthOfPredominance,value:p}}function F(e,n){const{renderer:a,fieldInfos:p}=e,l=C(p,n),m=N(p,n),f=M(p,n),d=function(e,n){return{fieldInfo:new t({fieldName:"expression/predominant-categories-list"}),expressionInfo:new o({name:"predominant-categories-list",title:n.listOfCategories,expression:i(e)})}}(p,n),u=new s({expressionInfos:[l.expressionInfo,m.expressionInfo,f.expressionInfo,d.expressionInfo],fieldInfos:[l.fieldInfo,m.fieldInfo,f.fieldInfo,d.fieldInfo],title:v(a,n),content:[{type:"text",text:r(n.predominantCategoryStrengthContent,{expression1:`{${m.fieldInfo.fieldName}}`,expression2:`<b>{${l.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${d.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:n.orderedListOfValues,value:u}}function O(e,n){const{fieldInfos:i}=e,a=C(i,n),p=N(i,n),l=M(i,n),m=function(e,n){const r=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-total",title:n.sumOfCategories,expression:f(r),returnType:"number"})}}(i,n),d=new s({expressionInfos:[p.expressionInfo,a.expressionInfo,m.expressionInfo,l.expressionInfo],fieldInfos:[p.fieldInfo,a.fieldInfo,m.fieldInfo,l.fieldInfo],content:r(n.predominantCategoryTotalStrengthContent,{expression1:`{${p.fieldInfo.fieldName}}`,expression2:`<b>{${a.fieldInfo.fieldName}}</b>`,expression3:`<b>{${l.fieldInfo.fieldName}}%</b>`,expression4:`{${m.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:n.predominantCategoryWithTotalAndStrength,value:d}}function L(e,n){const{renderer:t,fieldInfos:o}=e,i=C(o,n),a=N(o,n),p=M(o,n),l=new s({expressionInfos:[a.expressionInfo,i.expressionInfo,p.expressionInfo],fieldInfos:[a.fieldInfo,i.fieldInfo,p.fieldInfo],title:v(t,n),content:[{type:"text",text:r(n.predominantCategoryStrengthContent,{expression1:`{${a.fieldInfo.fieldName}}`,expression2:`<b>{${i.fieldInfo.fieldName}}</b>`,expression3:`<b>{${p.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:o.map((e=>e.fieldName))}}}]});return{name:"predominant-category-chart",title:n.predominantCategoryWithChart,value:l}}async function $(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("unique-value"!==o.type)throw new e("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return{renderer:o,fieldInfos:function(n,r){const t=n.authoringInfo,o="predominance"===t.type?t.fields:[];if(!o||!o.length)throw new e("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return o.map((e=>I(r,e)))}(o,r)}}async function V(e){const[r,t]=await Promise.all([$(e),n("esri/smartMapping/t9n/smartMapping")]),o=F(r,t),s=await async function(e){const[r,t]=await Promise.all([$(e),n("esri/smartMapping/t9n/smartMapping")]);return[P(r,t),T(r,t),D(r,t),O(r,t),F(r,t),U(r,t),L(r,t)]}(e);return{primaryTemplate:o,secondaryTemplates:s.filter((e=>e.name!==o.name))}}async function E(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("unique-value"!==o.type)throw new e("relationship-popup:invalid-parameters","renderer.type must be 'unique-value'");const s=o.authoringInfo;if(!s||"relationship"!==s.type)throw new e("relationship-popup:invalid-parameters","renderer.authoringInfo.type must be 'relationship'");if(!(s.field1&&s.field1.field&&s.field2&&s.field2.field))throw new e("relationship-popup:invalid-parameters","'field1' and/or 'field2' properties are missing in renderer.authoringInfo");return{layer:r,renderer:o}}async function q(e,n,r="divide"){const{fieldInfos:t,expressionInfos:o}=await c({renderer:e,layer:n,normFieldExpressionTemplate:r});return new s({content:await d(n,{fieldInfos:t,expressionInfos:o}),fieldInfos:t,expressionInfos:o})}async function A(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("simple"!==o.type)throw new e("simple-popup:invalid-parameters","renderer.type must be 'simple'");return{layer:r,renderer:o}}async function R(e,n,r="divide"){const{fieldInfos:t,expressionInfos:o}=await c({renderer:e,layer:n,normFieldExpressionTemplate:r});return new s({content:await d(n,{fieldInfos:t,expressionInfos:o}),expressionInfos:o,fieldInfos:t})}async function B(n){const{layer:r,renderer:t}=n;await r.load();const o=t||r.renderer;if("unique-value"!==o.type)throw new e("unique-values-popup:invalid-parameters","renderer.type must be 'unique-value'");return{layer:r,renderer:o}}async function z(e,n,r="divide"){const{fieldInfos:t,expressionInfos:o}=await c({renderer:e,layer:n,normFieldExpressionTemplate:r});return new s({content:await d(n,{fieldInfos:t,expressionInfos:o}),fieldInfos:t,expressionInfos:o})}async function W(r){const{renderer:t,layer:o}=function(n){const{layer:r}=n,t=n.renderer||r.renderer;if(!t)throw new e("getTemplates:invalid-parameters","'renderer' or 'layer.renderer' must be provided");return{layer:r,renderer:t}}(r);if("simple"===t.type)return async function(e){const[{renderer:r,layer:t},o]=await Promise.all([A(e),n("esri/smartMapping/t9n/smartMapping")]),s=[];if(!j(r).length)return null;const i={name:"simple",title:o.simple,value:await R(r,t)};return u(r)&&s.push({name:"simple-percent",title:o.simpleNormFieldAsPercent,value:await R(r,t,"percentage")}),{primaryTemplate:i,secondaryTemplates:s}}({renderer:t,layer:o});if("class-breaks"===t.type)return async function(e){const[{renderer:r,layer:t},o]=await Promise.all([h(e),n("esri/smartMapping/t9n/smartMapping")]),s={name:"class-breaks",title:o.classBreaks,value:await b(r,t)},i=[];return u(r)&&i.push({name:"class-breaks-percent",title:o.classBreaksNormFieldAsPercent,value:await b(r,t,"percentage")}),{primaryTemplate:s,secondaryTemplates:i}}({renderer:t,layer:o});if("dot-density"===t.type)return async function(e){const[{renderer:r,layer:t},o]=await Promise.all([g(e),n("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:o.dotDensity,value:await x(r,t)},secondaryTemplates:[await w(r,t,o),await k(r,t,o)]}}({renderer:t,layer:o});if("heatmap"===t.type)return async function(e){const[{renderer:r,layer:t},o]=await Promise.all([S(e),n("esri/smartMapping/t9n/smartMapping")]);if(!r.field)return null;const{fieldInfos:i}=await c({renderer:r,layer:t}),a=new s({content:await d(t,{fieldInfos:i}),fieldInfos:i});return{primaryTemplate:{name:"heatmap",title:o.heatmap,value:a},secondaryTemplates:[]}}({renderer:t,layer:o});if("unique-value"===t.type){const e=t.authoringInfo&&t.authoringInfo.type;return"predominance"===e?V({renderer:t,layer:o}):"relationship"===e?async function(e){const[{renderer:r,layer:t},o]=await Promise.all([E(e),n("esri/smartMapping/t9n/smartMapping")]),s={name:"relationship",title:o.relationshipPopupTitle,value:await q(r,t)},i=[];return function(e){const n=e.authoringInfo;return!(!n.field1.normalizationField&&!n.field2.normalizationField)}(r)&&i.push({name:"relationship-percent",title:o.relationshipNormFieldAsPercent,value:await q(r,t,"percentage")}),{primaryTemplate:s,secondaryTemplates:i}}({renderer:t,layer:o}):async function(e){const[{renderer:r,layer:t},o]=await Promise.all([B(e),n("esri/smartMapping/t9n/smartMapping")]),s={name:"unique-values",title:o.uniqueValues,value:await z(r,t)},i=[];return u(r)&&i.push({name:"unique-values-percent",title:o.uniqueValuesNormFieldAsPercent,value:await z(r,t,"percentage")}),{primaryTemplate:s,secondaryTemplates:i}}({renderer:t,layer:o})}return null}export{W as getTemplates};
