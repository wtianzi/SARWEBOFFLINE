/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import{i as t,u as o}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{isAbortError as i}from"../core/promiseUtils.js";import"../chunks/Message.js";import r from"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../chunks/asyncUtils.js";import"../core/urlUtils.js";import{aliasOf as a}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import l from"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../portal/PortalItem.js";import"../chunks/mathUtils2.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec3.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import p from"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"./support/CodedValueDomain.js";import"./support/Domain.js";import"./support/InheritedDomain.js";import"./support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"./support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols.js";import"../chunks/uid.js";import"../Graphic.js";import m from"./Layer.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../tasks/support/ColorRamp.js";import"../tasks/support/AlgorithmicColorRamp.js";import"../tasks/support/MultipartColorRamp.js";import"../chunks/colorRamps.js";import"../renderers/Renderer.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/sizeVariableUtils.js";import"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/VisualVariablesMixin.js";import"../chunks/symbolConversion.js";import"../symbols/support/jsonUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/support/ColormapInfo.js";import"../chunks/colorUtils2.js";import"../chunks/colorRampUtils.js";import"../renderers/RasterColormapRenderer.js";import"../renderers/RasterShadedReliefRenderer.js";import"../renderers/RasterStretchRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/styleUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/normalizeUtilsCommon.js";import"../geometry/support/normalizeUtils.js";import"./support/PixelBlock.js";import"../chunks/vectorFieldUtils.js";import"../chunks/MemCache.js";import"../chunks/ItemCache.js";import"../chunks/utils3.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils2.js";import"../renderers/VectorFieldRenderer.js";import"../rasterRenderers.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import{M as c}from"../chunks/MultiOriginJSONSupport.js";import"../core/watchUtils.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/fieldType.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/aaBoundingRect.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformationStep.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/projection.js";import{O as u}from"../chunks/OperationalLayer.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import{p as d}from"../chunks/commonProperties2.js";import"../chunks/Scheduler.js";import"../chunks/_commonjsHelpers.js";import"../core/workers/RemoteClient.js";import"../core/workers/Connection.js";import"../core/workers/workers.js";import"./support/LOD.js";import"./support/TileInfo.js";import h from"./support/Field.js";import{P as f}from"../chunks/PortalLayer.js";import{R as g}from"../chunks/RefreshableLayer.js";import{S as y}from"../chunks/ScaleRangeLayer.js";import{createPopupTemplate as b}from"../support/popupUtils.js";import v from"./support/DimensionalDefinition.js";import j from"./support/RasterInfo.js";import"../chunks/rasterRendererHelper.js";import"../chunks/RasterSymbolizer.js";import"../chunks/LercCodec.js";import"../chunks/ClassBreaksDefinition.js";import{k as x}from"../chunks/pixelUtils.js";import{g as w,b as S,a as C,e as k,f as I,i as D,h as L,B as R,I as O}from"../chunks/xmlUtilities.js";import"../chunks/RawBlockCache.js";import"../chunks/rasterProjectionHelper.js";import{c as T}from"../chunks/wmsUtils.js";function P(e){const t=function(e){var t,o;const s=null==(t=e.getHeader("Content-Type"))?void 0:t.split(";");if(!(null!=(o=null==s?void 0:s[0].trim())?o:"").startsWith("multipart/"))return null;const i={boundary:"",start:"",type:""};for(let e=1;e<s.length;e++){const t=s[e].split("="),o=t[1].trim();i[t[0].trim()]=o.startsWith('"')?o.slice(1,t[1].length-1):o}return i}(e);if(!t)return{isMultipart:!1,data:null};return{isMultipart:!0,data:t.boundary?function(e,t,o=0){const s="--"+t.boundary,i=[];for(let e=0;e<s.length;e++)i.push(s.charCodeAt(e));const r=[],n="\n--"+t.boundary+"--";for(let e=0;e<n.length;e++)r.push(n.charCodeAt(e));const a=[10],l=[13,10],p=[],m=i.length,c=new Uint8Array(e,o),u=Math.min(5e4,c.length-m);let d=0,h=0;for(let e=0;e<u;e++){for(h=0;h<m&&c[e+h]===i[h];h++);h===m&&(d&&p.push(M(c.subarray(d,e),t)),e+=m-1,c[e+1]===a[0]?e+=1:c[e+1]===l[0]&&c[e+2]===l[1]&&(e+=2),d=e+1)}const f=r.length;for(let e=c.length-f-10;e<c.length-f;e++){for(h=0;h<f&&c[e+h]===r[h];h++);if(h===f){p.push(M(c.subarray(d,e),t));break}}return p}(e.data,t,0):null}}function M(e,t){const o=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),s=Math.min(o.length,7),i={contentDisposition:"inline"};let r=0;for(let a=0;a<s;a++){var n;if(o[a].length<4)r=r+o[a].length+1;else if("content"===o[a].slice(0,7).toLowerCase()){if(r=r+o[a].length+1,-1===o[a].indexOf(":"))continue;const e=o[a].substring(0,o[a].indexOf(":")).trim(),t=o[a].substring(o[a].indexOf(":")+1).trim();switch(e.toLowerCase()){case"content-type":i.contentType=t;break;case"content-description":i.contentDescription=t;break;case"content-transfer-encoding":i.contentTransferEncoding=t;break;case"content-id":i.contentID=t;break;case"content-disposition":i.contentDisposition=t;break;case"content-location":i.contentLocation=t}}else{if(i.contentDisposition.toLowerCase().indexOf("inline")>-1&&o[a].length>=4&&(null==(n=i.contentType)?void 0:n.toLowerCase().indexOf("image"))>-1){let t=!0;if(i.contentType.toLowerCase().indexOf("tif")>0&&(t=73===e[r]&&73===e[r+1]||77===e[r]&&77===e[r+1]),t){const t=new ArrayBuffer(e.length-r);new Uint8Array(t).set(e.subarray(r,e.length)),i.contentData=t}break}if((""===t.start||i.contentID===t.start)&&i.contentType){if(i.contentType.indexOf("text")>-1||i.contentType.indexOf("xml")>-1){i.contentData=String.fromCharCode.apply(null,e.subarray(r,e.length));break}i.contentData=e.subarray(r,e.length)}}}return i}function E(e){return e.indexOf("?")===e.length-1?e.substring(0,e.length-1):e}function U(e){const t={};for(let o=0;o<e.childNodes.length;o++){const s=e.childNodes[o];if(1!==s.nodeType)continue;const i=L(s).toLowerCase();switch(i){case"title":case"abstract":t[i]=w(s);break;case"identifier":t.id=w(s);break;case"wgs84boundingbox":{const e=k(s,"LowerCorner"),o=k(s,"UpperCorner");t.lonLatEnvelope=new l({xmin:e[0],ymin:e[1],xmax:o[0],ymax:o[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(U(s))}}return t}function A(e,t){if(e.coverageSummaries)for(let o=0;o<e.coverageSummaries.length;o++)e.coverageSummaries[o].abstract=e.coverageSummaries[o].abstract||e.abstract,e.coverageSummaries[o].lonLatEnvelope=e.coverageSummaries[o].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[o].title=e.coverageSummaries[o].title||e.title,A(e.coverageSummaries[o],t);null!=e.id&&t.push(e)}function $(e){const t=S(e.querySelector("Operation[name=GetCapabilities]"),"Get").getAttribute("xlink:href")||"",o=S(e.querySelector("Operation[name=DescribeCoverage]"),"Get").getAttribute("xlink:href")||"",s=S(e.querySelector("Operation[name=GetCoverage]"),"Get").getAttribute("xlink:href")||"";return{getCapabilities:E(t),describeCoverage:E(o),getCoverage:E(s)}}function F(e,t=null){let o=null;if("string"==typeof e){o=(new DOMParser).parseFromString(e,"text/xml")}else o=e;const s=o.documentElement.getAttribute("version"),i=(s||t||"1.0.0").slice(0,3);let n;if("2.0"===i)n=function(e){const t=S(e,"ServiceIdentification"),o=w(t,"Title"),s=I(t,"ServiceTypeVersion"),i=I(t,"Profile"),r=$(S(e,"OperationsMetadata")),n=C(e,"Contents/CoverageSummary"),a=[];for(let e=0;e<n.length;e++){const t=n[e],o=w(t,"CoverageId"),s=S(t,"WGS84BoundingBox");let i;if(s){const e=k(s,"LowerCorner"),t=k(s,"UpperCorner");i=new l({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}a.push({id:o,lonLatEnvelope:i})}const p=S(e,"ServiceMetadata");return{name:o,supportedVersions:s,supportedFormats:I(p,"formatSupported"),supportedInterpolations:I(p,"interpolationSupported"),onlineResources:r,profiles:i,coverages:a}}(o);else if("1.1"===i)n=function(e){const t=w(e,"ServiceIdentification/Title"),o=I(e,"ServiceIdentification/ServiceTypeVersion"),s=$(S(e,"OperationsMetadata")),i=[],r=S(e,"Contents");for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];1===t.nodeType&&D(t,"CoverageSummary")&&A(U(t),i)}return{name:t,onlineResources:s,coverages:i,supportedVersions:o,supportedFormats:I(r,"SupportedFormat")}}(o);else{if("1.0"!==i)throw new r("wcsraster:parsecapabilities","the capabilities version is not supported");n=function(e){var t,o,s;const i=w(e,"Service/name"),r=S(e,"Capability"),n=null!=(t=S(r,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"))?t:"",a=null!=(o=S(r,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"))?o:"",p=null!=(s=S(r,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"))?s:"",m={getCapabilities:E(n),describeCoverage:E(a),getCoverage:E(p)},c=C(e,"CoverageOfferingBrief"),u=[];for(let e=0;e<c.length;e++){const t=c[e],o=w(t,"name"),s=C(t,"pos"),i=k(s[0]),r=k(s[1]),n=new l({xmin:i[0],ymin:i[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}});u.push({id:o,lonLatEnvelope:n})}return{name:i,onlineResources:m,coverages:u,supportedVersions:["1.0.0"]}}(o)}return n.capabilitiesVersion=s,n}function V(e,t){const o=I(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),s="1.0.0"===t?e.getAttribute("default"):w(e,"InterpolationMethods/Default");return null!=s?[s].concat(o.filter((e=>e.toLowerCase()!==s.toLowerCase()))):o}function G(e){return null==e?["nearest"]:e.map((e=>{const t=e.toLowerCase();return t.indexOf("nearest")>-1?"nearest":t.indexOf("linear")>-1?"bilinear":t.indexOf("cubic")>-1?"cubic":null})).filter((e=>!!e))}function N(e){const t=C(e,"pos"),o=k(t[0]),s=k(t[1]);return new l({xmin:o[0],ymin:o[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:4326}})}function B(e){const t=[],o=C(e,"RangeSet");let s=[];for(let e=0;e<o.length;e++){const i=w(o[e],"name"),r=w(o[e],"label"),n=[],a=C(o[e],"AxisDescription");for(let e=0;e<a.length;e++){const t=w(a[e],"name"),o=w(a[e],"label"),i=I(a[e],"singleValue");if(0===i.length){const t=w(a[e],"min"),o=w(a[e],"max"),s=Number(w(a[e],"res"))||1;if(null!==t&&null!==o)for(let e=parseInt(t,10);e<=parseInt(o,10);e+=s)i.push(e.toString())}"band"===t.toLowerCase()&&(s=i),n.push({name:t,label:o,values:i})}t.push({name:i,label:r,axis:n})}return{rangeSet:t,bandNames:s}}function _(e){const t=C(e,"timeposition");if(t.length>0){const e=[];for(let o=0;o<t.length;o++)e.push(new Date(w(t[o])));return{begin:e[0],end:e[e.length-1],values:e}}const o=S(e,"timePeriod")||S(e,"TimePeriod");if(o){return{begin:new Date(w(o,"beginPosition")||w(o,"BeginPosition")),end:new Date(w(o,"endPosition")||w(o,"EndPosition")),...function(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const o=["Y","M","D"],s=["H","M","S"],i=["Years","Months","Days","Hours","Minutes","Seconds"];let r,n,a;return-1===t.indexOf("PT")?(t=t.slice(1),a=o.findIndex((e=>t.indexOf(e)>-1)),a>-1&&(r=i[a]),n=parseFloat(t.substring(0,t.length-1))):(t=t.slice(2),a=s.findIndex((e=>t.indexOf(e)>-1)),r=i[3+a],n=parseFloat(t.substring(0,t.length-1))),{resolution:n,units:r}}(w(o,"timeResolution")||w(o,"TimeResolution"))}}return null}function q(e){const t=S(e,"spatialDomain"),o=S(t,"Envelope")||S(t,"EnvelopeWithTimePeriod"),s=o.getAttribute("srsName").split(":"),i=s[s.length-1],r=C(o,"pos"),n=k(r[0]),a=k(r[1]),p=parseInt(i,10),m=isNaN(p)?null:{wkid:p},c=new l({xmin:n[0],ymin:n[1],xmax:a[0],ymax:a[1],spatialReference:m}),u=S(t,"RectifiedGrid"),d=w(u,"low").split(" "),h=w(u,"high").split(" "),f=parseInt(h[0],10)-parseInt(d[0],10)+1,g=parseInt(h[1],10)-parseInt(d[1],10)+1,y=k(t,"origin/pos"),b=C(t,"offsetVector"),v={envelope:c,columns:f,rows:g,offset:{x:parseFloat(w(b[0]).split(" ")[0]),y:parseFloat(w(b[1]).split(" ")[1])},origin:{x:y[0],y:y[1]}},j=S(e,"temporalDomain")||S(e,"TemporalDomain");return{spatialDomain:v,temporalDomain:j?_(j):null}}function W(e){const t=[],o=C(e,"Field");let s=[];for(let e=0;e<o.length;e++){const i=w(o[e],"Identifier"),r=w(o[e],"Description"),n=w(o[e],"Definition"),a=w(o[e],"Abstract"),l=w(o[e],"Title"),p=V(o[e],"1.1.0"),m=[],c=C(o[e],"Axis");for(let e=0;e<c.length;e++){const t=c[e].getAttribute("identifier"),o=w(c[e],"UOM"),i=w(c[e],"DataType"),r=I(c[e],"Key");"band"===t.toLowerCase()&&(s=r),m.push({identifier:t,uom:o,dataType:i,values:r})}t.push({identifier:i,description:r,definition:n,abstract:a,title:l,supportedInterpolations:p,axis:m})}return{rangeSet:t,bandNames:s}}function z(e){var t;const o=S(e,"SpatialDomain"),s=S(o,"GridCRS"),i=w(s,"GridBaseCRS"),r=w(s,"GridOrigin"),n=null!=(t=null==r?void 0:r.split(" ").map((e=>parseFloat(e))))?t:[0,0],a=k(s,"GridOffsets"),p=C(o,"BoundingBox");let m,c,u,d;for(let e=0;e<p.length;e++){var h;const t=null==(h=p[e].getAttribute("crs"))?void 0:h.toLowerCase();if(null!=t)if(t.indexOf("imagecrs")>-1){const t=k(p[e],"LowerCorner"),o=k(p[e],"UpperCorner");m=o[0]-t[0]+1,c=o[1]-t[1]+1}else if(t.indexOf("epsg")>0){const o=t.split(":");u=parseInt(o[o.length-1],10);const s=k(p[e],"LowerCorner"),i=k(p[e],"UpperCorner");d=new l({xmin:s[0],ymin:s[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:u}})}}const f=m>c,g=d.xmax-d.xmin>d.ymax-d.ymin;let y=!1;T(u)&&(f===g?y=!1:(y=!0,d=new l({xmin:d.ymin,ymin:d.xmin,xmax:d.ymax,ymax:d.xmax,spatialReference:{wkid:u}})));const b={columns:m,rows:c,origin:{x:n[0],y:n[1]},offset:{x:a[0],y:a[1]},gridBaseCRS:i,envelope:d,useEPSGAxis:y},v=S(e,"temporalDomain")||S(e,"TemporalDomain");return{spatialDomain:b,temporalDomain:v?_(v):null}}function H(e,t){const o=[],s=[],i={supportedFormats:o,supportedCRSs:s,version:"1.1"};let r;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if(1!==n.nodeType)continue;const a=L(n).toLowerCase();switch(a){case"title":case"abstract":case"identifier":i[a]=w(n);break;case"supportedformat":{const e=w(n);-1===o.indexOf(e)&&o.push(e)}break;case"supportedcrs":{const e=w(n);-1===s.indexOf(e)&&s.push(e)}break;case"range":{const e=W(n);i.range=e.rangeSet,r=e.bandNames}break;case"domain":i.domain=z(n)}}const n=G(i.range[0].supportedInterpolations),{identifier:a,abstract:l,title:p,domain:m,range:c}=i,u={x:Math.abs(m.spatialDomain.offset.x),y:Math.abs(m.spatialDomain.offset.y)},d=function(e,t){const o=e.filter((e=>-1===e.identifier.toLowerCase().indexOf("field_1")&&!e.axis.some((e=>"band"===e.identifier.toLowerCase())))),s=[];if(o.length&&o.forEach((e=>{var t,o;const i=e.axis.map((e=>{const t=e.values.map((t=>"ISO8601"===e.uom?-1===(t=t.trim()).toLowerCase().indexOf("z")?new Date(t+"Z").getTime():new Date(t).getTime():parseFloat(t.trim()))),o=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:o}}));s.push({name:e.identifier.trim(),description:null!=(t=null==(o=e.description)?void 0:o.trim())?t:"",unit:"",dimensions:i})})),t.temporalDomain){const{begin:e,end:o,values:i,units:r,resolution:n}=t.temporalDomain;s.some((e=>e.dimensions.some((e=>"stdtime"===e.name.toLowerCase()))))||s.forEach((t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null==i?void 0:i.map((e=>e.getTime())),hasRegularIntervals:!i,interval:n,intervalUnit:r,extent:[e.getTime(),o.getTime()]})}))}return s.length?{variables:s}:null}(c,m),h=new j({width:m.spatialDomain.columns,height:m.spatialDomain.rows,pixelSize:u,extent:m.spatialDomain.envelope,spatialReference:m.spatialDomain.envelope.spatialReference,bandCount:r.length||1,multidimensionalInfo:d});return{id:a,title:i.title,description:l||p,lonLatEnvelope:null,bandNames:r,rasterInfo:h,supportedFormats:o,supportedInterpolations:n,coverageDescription:i,version:t,useEPSGAxis:m.spatialDomain.useEPSGAxis}}function J(e){const t=S(e,"Envelope")||S(e,"EnvelopeWithTimePeriod"),o=t.getAttribute("srsName"),s=o.slice(o.lastIndexOf("/")+1),i=t.getAttribute("axisLabels").split(" ").map((e=>e.trim())).filter((e=>""!==e.trim())),r=k(t,"lowerCorner"),n=k(t,"upperCorner"),a=!["y","lat","latitude","north","nor","n","b"].some((e=>e===i[0].toLowerCase()));let p;const m=parseInt(s,10),c=isNaN(m)?null:{wkid:m};p=new l(a?{xmin:r[0],ymin:r[1],xmax:n[0],ymax:n[1],spatialReference:c}:{xmin:r[1],ymin:r[0],xmax:n[1],ymax:n[0],spatialReference:c});const u={mins:r,maxs:n},d=t.getAttribute("uomLabels").trim().split(" ");let h,f;return D(t,"EnvelopeWithTimePeriod")&&(h=new Date(w(e,"beginPosition")||w(e,"BeginPosition")),f=new Date(w(e,"endPosition")||w(e,"EndPosition"))),{envelope:p,axisLabels:i,uomLabels:d.length?d:null,envelopeAllDims:u,beginPosition:h,endPosition:f,isEastFirst:a}}function Y(e){const t=[],o=C(e,"DataRecord"),s=[];for(let e=0;e<o.length;e++){const r=C(o[e],"field"),n=[];for(let e=0;e<r.length;e++){var i;const t=r[e].getAttribute("name"),o=w(r[e],"description")||"",a=(null==(i=S(r[e],"uom"))?void 0:i.getAttribute("code"))||"",l=k(r[e],"interval");t.toLowerCase().indexOf("band")>-1&&s.push(t),n.push({name:t,description:o,uom:a,allowedValues:l})}t.push(n)}return{rangeType:t,bandNames:s}}function Q(e){let t=1,o="";const s=.01;return Math.abs(e-1/24)<1/24*s?o="Hours":Math.abs(e-1)<.01?o="Days":e<1?(t=Math.round(24*e),o="Hours"):e>27.99&&e<31.01||Math.round(e/30)<12?o="Months":e>364.99&&e<366.01&&(o="Years"),{interval:t,intervalUnit:o}}function K(e,t){const o=S(e,"RectifiedGrid"),s=k(o,"low"),i=k(o,"high"),r=[];for(let e=0;e<s.length;e++)r.push(i[e]-s[e]+1);const n=w(o,"axisLabels").split(" "),a=k(o,"origin/pos"),l=C(o,"offsetVector"),p=[];for(let e=0;e<l.length;e++){const t=k(l[e]),o=t.findIndex((e=>0!==e));p[o]=t[o]}const m=t||n;let c,u,d;return["y","lat","latitude","north","nor","n","b"].some((e=>e===m[0].toLowerCase()))?(c=r[1],u=r[0],d={y:Math.abs(p[0]),x:Math.abs(p[1])}):(c=r[0],u=r[1],d={x:Math.abs(p[0]),y:Math.abs(p[1])}),{columns:c,rows:u,origin:a,offset:p,resolution:d,gridSamples:r,axisLabels:n}}function Z(e){const t=S(e,"EarthObservation");if(!t)return null;const o=S(t,"phenomenonTime"),s=o?_(o):null,i=S(t,"phenomenonTime"),r=i?_(i):null,n=w(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let a=null;if(n){const e=n.split(" ").map((e=>e.trim())).filter((e=>null!=e&&""!==e));if(e.length){const t=[];for(let o=0;o<e.length/2;o+=2)t.push(e[o],e[o+1]);a=new p({rings:[t],spatialReference:{wkid:4326}})}}return{observation:{phonomenonTime:s,resultTime:r,footprint:a,identifier:w(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:w(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:w(e,"metaDataProperty/EarthObservationMetaData/status")}}}function X(e){const t={version:"2.0"};let o=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(1===r.nodeType)if(D(r,"coverageId"))t.coverageId=w(r);else if(D(r,"ServiceParameters"))t.serviceParameters={supportedFormats:I(r,"nativeFormat")};else if(D(r,"boundedBy"))t.boundedBy=J(r);else if(D(r,"rangeType")){const e=Y(r);t.rangeType=e.rangeType,o=e.bandNames}else if(D(r,"domainSet")){var s;t.domainSet=K(r,null==(s=t.boundedBy)?void 0:s.axisLabels)}else if(D(r,"metadata")){const e=S(r,"EOMetadata");t.eoMetadata=e?Z(e):null}}const{coverageId:i,boundedBy:r,domainSet:n,rangeType:a,serviceParameters:l}=t,p=function(e,t,o){const s=[];for(let t=0;t<e.length;t++){const o=e[t];for(let e=0;e<o.length;e++)-1===o[e].name.toLowerCase().indexOf("band")&&s.push(o[e])}const i=[];if(s.length){const e=[];for(let s=2;s<o.axisLabels.length;s++){const i=(t.uomLabels&&t.uomLabels.length)>s?t.uomLabels[s]:"",r=o.axisLabels[s].toLowerCase().indexOf("time")>-1||"iso8601"===i.toLowerCase()||"oledatetime"===i.toLowerCase();let n,a;if(r){const e=Q(o.offset[s]);n=e.interval,a=e.intervalUnit}else n=o.offset[s],a=i;const l=[];r?(l.push((new Date).setTime(24*(t.envelopeAllDims.mins[s]-25569)*3600*1e3)),l.push((new Date).setTime(24*(t.envelopeAllDims.maxs[s]-25569)*3600*1e3))):(l.push(t.envelopeAllDims.mins[s]),l.push(t.envelopeAllDims.maxs[s])),e.push({name:o.axisLabels[s].trim(),description:o.axisLabels[s].trim(),unit:t.uomLabels&&t.uomLabels.length>s?t.uomLabels[s].trim():"",hasRegularIntervals:!0,extent:l,interval:n,intervalUnit:a})}if(s.forEach((t=>{var o,s;return i.push({name:t.name.trim(),description:null!=(o=null==(s=t.description)?void 0:s.trim())?o:"",unit:t.uom.trim(),dimensions:e})})),i.length)return{variables:i}}return null}(a,r,n);return{id:i,title:i,description:i,lonLatEnvelope:null,bandNames:o,rasterInfo:new j({width:n.columns,height:n.rows,pixelSize:n.resolution,extent:r.envelope,spatialReference:r.envelope.spatialReference,bandCount:o.length||1,multidimensionalInfo:p}),supportedFormats:l.supportedFormats,supportedInterpolations:null,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}function ee(e,t){let o=null;if("string"==typeof e){o=(new DOMParser).parseFromString(e,"text/xml")}else o=e;if("1.0.0"===t){return C(o,"CoverageOffering").map((e=>function(e){const t={version:"1.0"};let o=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(1===r.nodeType)if(D(r,"description"))t.description=w(r);else if(D(r,"name"))t.name=w(r);else if(D(r,"label"))t.label=w(r);else if(D(r,"supportedFormats"))t.supportedFormats=I(r,"formats");else if(D(r,"supportedCRSs"))t.supportedCRSs={requestResponseCRSs:I(s=r,"requestResponseCRSs").map((e=>e.split(":")[1])),nativeCRSs:I(s,"nativeCRSs").map((e=>e.split(":")[1]))};else if(D(r,"supportedInterpolations"))t.supportedInterpolations=V(r,"1.0.0");else if(D(r,"lonLatEnvelope"))t.lonLatEnvelope=N(r);else if(D(r,"rangeSet")){const e=B(r);t.rangeSet=e.rangeSet,o=e.bandNames}else D(r,"domainSet")&&(t.domainSet=q(r))}var s;const i=G(t.supportedInterpolations),{name:r,description:n,label:a,lonLatEnvelope:l,supportedFormats:p}=t,{spatialDomain:m}=t.domainSet,c={x:Math.abs(m.offset.x),y:Math.abs(m.offset.y)},u=new j({width:m.columns,height:m.rows,pixelSize:c,extent:m.envelope,spatialReference:m.envelope.spatialReference,bandCount:o.length||1});return{id:r,title:t.name,description:n||a,lonLatEnvelope:l,rasterInfo:u,bandNames:o,supportedFormats:p,supportedInterpolations:i,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}(e)))}const s=C(o,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?s.map((e=>H(e,t))):s.map((e=>X(e)))}const te=["nearest neighbor","bilinear","bicubic"],oe=["nearest","linear","cubic"];let se=class extends R{constructor(){super(...arguments),this.datasetFormat="WCSServer"}async open(e){await this.init();const t=null==e?void 0:e.signal,o=await this._getCapabilities(t);if(this.capabilities=o,!this.version){var s;let e=null==(s=o.capabilitiesVersion)?void 0:s.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=o.capabilitiesVersion:(e=o.supportedVersions.find((e=>"2.0.1"===e))||o.supportedVersions.find((e=>"2.0"===e.slice(0,3)))||o.supportedVersions.find((e=>"1.1"===e.slice(0,3)))||o.supportedVersions.find((e=>"1.0"===e.slice(0,3)))||"1.0.0",this.version=e)}null==this.coverageId&&(this.coverageId=o.coverages[0].id);const i=o.coverages.filter((e=>e.id===this.coverageId))[0];if(null==i)throw new r("wcsraster-open",`the coverageId ${this.coverageId} does not exist in capabilities`);const n=await this._describeCoverage(t);this.coverageInfo=n[0],"2.0"===this.version.slice(0,3)&&(this.coverageInfo.lonLatEnvelope=i.lonLatEnvelope,this.coverageInfo.supportedInterpolations=G(o.supportedInterpolations)),this.datasetName=this.coverageInfo.title;const{rasterInfo:a}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(a,512,512),this._set("rasterInfo",a),null==a.spatialReference)throw new r("wcsraster-open",`coverage without spatial referernce is not supported: ${this.coverageId}`);const{pixelType:l,bandCount:p}=await this._getPixelTypeAndBandCount(t);a.pixelType=l,1===a.bandCount&&p>1&&(a.bandCount=p),this.updateTileInfo()}async fetchRawTile(e,t,o,s={}){if(this.isBlockOutside(e,t,o))return null;const{nativePixelSize:i,spatialReference:n}=this.rasterInfo,a=2**e,l=i.x*a,p=i.y*a,{blockWidth:m,blockHeight:c}=this.getBlockWidthHeight(e),{origin:u}=this.rasterInfo.storageInfo.tileInfo,d=this.getTileExtent({x:l,y:p},t,o,u,n,[m,c]),h=this.rasterInfo.extent,f=d.xmax>h.xmax||d.ymin<h.ymin;let g=d,y=m,b=c;if(f&&(g=d.clone().intersection(h),y=Math.floor((g.xmax-g.xmin)/l),b=Math.floor((g.ymax-g.ymin)/p),g.xmax=g.xmin+l*y,g.ymin=g.ymax-p*b),y<=1||b<=1)return null;const v=await this._getCoverage(g,y,b,a,s);if(!v)return null;let j=await this.decodePixelBlock(v,{width:y,height:b,planes:null,pixelType:null});if(j&&(j.width!==y||j.height!==b))throw new r("wcsraster-fetch",`the reponse has unexpected dimension width: ${j.width}, height: {pixelBlock.height}`);return f&&(j=x(j,{x:0,y:0},{width:c,height:c})),j}async _getCapabilities(e){const t={service:"WCS",request:"GetCapabilities"};this.version&&(t.version=this.version,t.acceptVersions=this.version);try{const{data:o}=await this.request(this.url,{query:t,responseType:"xml",signal:e});return F(o)}catch(e){if(!i(e))throw new r("wcslayer:open","wcs capabilities is not valid or supported");throw e}}async _describeCoverage(e){const t={service:"WCS",request:"DescribeCoverage",version:this.version},o=this.version.slice(0,3);"1.0"===o?t.coverage=this.coverageId:"1.1"===o?t.identifiers=this.coverageId:"2.0"===o&&(t.coverageId=this.coverageId);try{const{data:o}=await this.request(this.url,{query:t,responseType:"xml",signal:e});return ee(o,this.version)}catch(e){if(!i(e))throw new r("wcslayer:open","wcs coverage description is not valid or supported");throw e}}async _getPixelTypeAndBandCount(e){const{pixelSize:s,extent:i,multidimensionalInfo:n}=this.rasterInfo,a=i.center,p=new l({xmin:a.x-s.x,xmax:a.x+s.x,ymin:a.y-s.y,ymax:a.y+s.y,spatialReference:i.spatialReference});let m;if(t(n)){const e=n.variables[0];m=[],e.dimensions.forEach((t=>{m.push(new v({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent[0]:t.values[0],isSlice:!0}))}))}const c=await this._getCoverage(p,2,2,1,{multidimensionalDefinition:m,signal:o(e)});if(!c)throw new r("wcsraster-open","unable to determine pixel type");const u=await this.decodePixelBlock(c,{width:2,height:2,planes:null,pixelType:null});return{pixelType:u.pixelType,bandCount:u.getPlaneCount()}}async _getCoverage(e,t,o,s,i){const{coverageDescription:n}=this.coverageInfo,{version:a}=n,l="2.0"===n.version?this._getCoverage201Parameters(e,t,o,s,i,n):"1.1"===n.version?this._getCoverage110Parameters(e,t,o,i,n):this._getCoverage100Parameters(e,t,o,i),p="2.0"===n.version?await this.request(this._constructWCS201Url(l),{signal:i.signal,responseType:"array-buffer"}):await this.request(this.url,{query:l,signal:i.signal,responseType:"array-buffer"});if("1.0"===a)return p.data;const m=P(p);if(m.isMultipart&&m.data){const e=m.data.filter((e=>{var t;return(null==(t=e.contentType)?void 0:t.toLowerCase().includes("image"))&&null!=e.contentData}))[0];return null==e?void 0:e.contentData}if(this.ioConfig.allowAnyMediaType)return p.data;throw new r("wcsraster:getcoverage","response is not a valid coverage, multipart response is expected")}_getInterpolationIndex(e){return-1===this.coverageInfo.supportedInterpolations.indexOf(e)||"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0}_getCoverage100Parameters(e,t,o,s){const i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,r=e.spatialReference.wkid,n=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"GEOTIFF",{bandIds:a,interpolation:l}=s,p=this._getInterpolationIndex(l),m=a?a.map((e=>this.coverageInfo.bandNames[e])):null,c=te[p];return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:n,crs:`EPSG:${r}`,bbox:i,width:t,height:o,interpolation:c,band:null==m?void 0:m.join(",")}}_getCoverage110Parameters(e,t,o,s,i){var r;const{multidimensionalDefinition:n,bandIds:a,interpolation:l}=s,p=e.spatialReference.wkid,m=`urn:ogc:def:crs:EPSG::${p}`,c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",u=this._getInterpolationIndex(l),d=oe[u],h=null==l||0===(null==(r=this.coverageInfo.supportedInterpolations)?void 0:r.indexOf(l)),f=i.domain.spatialDomain,g=f.origin.x<=f.envelope.xmin&&f.origin.y<=f.envelope.ymin,y=e.width/t,b=e.height/o*(g?1:-1),v=g?[e.xmin,e.ymin]:[e.xmin,e.ymax],j=f.useEPSGAxis&&T(p),x=j?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,w=j?`${b},0,0,${y}`:`${y},0,0,${b}`,S=y/2,C=e.xmin+S,k=e.xmax-S,I=Math.abs(b)/2,D=e.ymin+I,L=e.ymax-I,R=j?`${D},${C},${L},${k},${m}`:`${C},${D},${k},${L},${m}`,O=i.range.filter((e=>e.axis.some((e=>e.identifier.toLowerCase().indexOf("band")>-1))))[0];let P,M=O&&d&&a?h?`${O.identifier}[${O.axis[0].identifier}[${a.join(",")}]]`:`${O.identifier}:${d}[${O.axis[0].identifier}[${a.join(",")}]]`:null;if(null!=n&&n.length)for(let e=0;e<n.length;e++){let t=n[e].values;const o=n[e].dimensionName.toLowerCase(),s=n[e].variableName.toLowerCase();if(t.length>0)if(t[0]instanceof Array&&(t=t[0]),"stdtime"===o)P=t.map((e=>this._convertToISOTime(e))).join(",");else{const e=i.range.filter((e=>e.identifier.toLowerCase()===s))[0];if(e){const s=e.axis.filter((e=>e.identifier.toLowerCase()===o))[0];s&&(M=h?e.identifier+"["+s.identifier+"["+t.join(",")+"]]":e.identifier+":"+d+"["+s.identifier+"["+t.join(",")+"]]")}}}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:c,crs:`EPSG:${p}`,boundingbox:R,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:x,gridOffsets:w,gridBaseCRS:m,timeSequence:P,rangeSubset:M}}_convertToISOTime(e,t=!1){return(t?new Date(24*(e-25569)*60*60*1e3):new Date(e)).toISOString()}_getCoverage201Parameters(e,t,o,s,i,r){const{multidimensionalDefinition:n,interpolation:a}=i,l=this._getInterpolationIndex(a);let p=null;const{supportedInterpolations:m}=this.capabilities;if(null!=m&&m.length)switch(l){case 0:p=m.find((e=>e.includes("nearest")));break;case 1:p=m.find((e=>e.includes("linear")));break;case 2:p=m.find((e=>e.includes("cubic")||e.includes("quadratic")))}const c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",{bandNames:u}=this.coverageInfo,{boundedBy:d,domainSet:h,rangeType:f}=r,g=d.isEastFirst?0:1,y=1-g,{axisLabels:b}=d,v=b[g],j=b[y],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,w=x,S=[];S.push(`${v}(${e.xmin},${e.xmax})`),S.push(`${j}(${e.ymin},${e.ymax})`);const C=[];if(b.length>2)for(let e=2;e<b.length;e++){const t=h.origin[e];if(b[e].toLowerCase().indexOf("time")>-1){let o=t.toString();d.uomLabels[e].toLowerCase().indexOf("ole")>-1&&(C.push(b[e]),o=this._convertToISOTime(t,!0)),S.push(b[e]+",http://www.opengis.net("+o+")")}else S.push(b[e]+",http://www.opengis.net("+t+")")}let k=null;if(null!=n&&n.length){const e=[];f.forEach((t=>t.forEach((t=>e.push(t.name)))));const t=[];for(let o=0;o<n.length;o++){const s=b.find((e=>e===n[o].dimensionName)),i=e.find((e=>e===n[o].variableName));if(-1===t.indexOf(i)&&t.push(i),s){let e=n[o].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=s.toLowerCase().indexOf("time")>-1?e.map((e=>this._convertToISOTime(e))).join(","):e.join(",");const o=S.findIndex((e=>0===e.indexOf(s+",http://www.opengis.net")));-1===o&&S.push(s+",http://www.opengis.net("+t+")"),-1!==o&&-1===S[o].indexOf("("+t+")")&&S.splice(o,1,s+",http://www.opengis.net("+t+")")}}}t.length&&(k=t.join(","))}else if(null!=u&&u.length){k=(i.bandIds?i.bandIds.map((e=>u[e])):u).join(",")}const I=S.join("&subset="),D=!(r.domainSet.axisLabels.join("")===r.boundedBy.axisLabels.join(""))&&!1!==this.ioConfig.allowScaleFactor,L=D?null:`${v}(${t}),${j}(${o})`,R=D?1/s:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:k,interpolation:p,scaleSize:L,scaleFactor:R,subset:I,format:c,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:w}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},o=[];Object.keys(t).forEach((e=>{const s=t[e];null!=s&&("subset"===e?s.split("&subset=").forEach((e=>{e&&o.push(`subset=${encodeURIComponent(e)}`)})):o.push(`${e}=${encodeURIComponent(s)}`))}));return`${encodeURI(this.url)}?${o.join("&")}`}};e([s({type:String,json:{write:!0}})],se.prototype,"datasetFormat",void 0),e([s()],se.prototype,"tileType",void 0),e([s({type:String,json:{write:!0}})],se.prototype,"version",void 0),e([s({type:String,json:{write:!0}})],se.prototype,"coverageId",void 0),se=e([n("esri.layers.support.rasterDatasets.ImageServerRaster")],se);var ie=se;let re=class extends(y(g(u(f(O(c(m))))))){constructor(...e){super(...e),this.coverageId=null,this.coverageInfo=null,this.customParameters=null,this.version=null,this.isReference=null,this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const o=t(e)?e.signal:null;return this.addResolvingPromise(this._openRaster(o)),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return[new h({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}createPopupTemplate(e){return b(this,e)}async _openRaster(e){const t=new ie({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{...this.ioConfig,sampling:"closest",customFetchParameters:this.customParameters}});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new r("wcs-layer:load","cannot load resources on "+this.url);null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service"),this.raster=t,this._configDefaultSettings()}};e([s({json:{write:!0}})],re.prototype,"coverageId",void 0),e([s({readOnly:!0}),a("raster.coverageInfo")],re.prototype,"coverageInfo",void 0),e([s({json:{type:Object,write:!0}})],re.prototype,"customParameters",void 0),e([s()],re.prototype,"version",void 0),e([s()],re.prototype,"isReference",void 0),e([s({readOnly:!0})],re.prototype,"type",void 0),e([s(d)],re.prototype,"popupEnabled",void 0),e([s()],re.prototype,"popupTemplate",void 0),e([s({readOnly:!0})],re.prototype,"defaultPopupTemplate",null),e([s({readOnly:!0})],re.prototype,"fields",null),re=e([n("esri.layers.WCSLayer")],re);var ne=re;export default ne;
