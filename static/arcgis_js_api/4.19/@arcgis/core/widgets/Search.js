/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import"../chunks/Logger.js";import{e as s}from"../chunks/string.js";import"../chunks/metadata.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{createAbortController as r,e as o}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../chunks/asyncUtils.js";import"../chunks/loadAll.js";import"../core/urlUtils.js";import{aliasOf as n}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import{substitute as l}from"../intl.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../portal/PortalItem.js";import"../Basemap.js";import"../chunks/writeUtils.js";import"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols.js";import"../chunks/uid.js";import"../Graphic.js";import a from"../core/Handles.js";import"../chunks/basemapUtils.js";import"../chunks/unitUtils.js";import{watch as u,on as c,init as h}from"../core/watchUtils.js";import"../tasks/support/ProjectParameters.js";import"../chunks/domUtils.js";import{s as p,k as d}from"../chunks/widgetUtils.js";import"../chunks/projector.js";import"../chunks/accessibleHandler.js";import{m}from"../chunks/messageBundle.js";import{v as g}from"../chunks/vmEvent.js";import{j as _}from"../chunks/index.js";import v from"./Widget.js";import"../chunks/utils4.js";import"../tasks/Task.js";import"../chunks/scaleUtils.js";import"../chunks/utils5.js";import"../chunks/symbologyUtils.js";import"../chunks/utils9.js";import"../smartMapping/symbology/location.js";import"../chunks/trimExtend.js";import"../tasks/support/GeneralizeParameters.js";import"../tasks/support/LengthsParameters.js";import"../tasks/support/OffsetParameters.js";import"../tasks/support/RelationParameters.js";import"../tasks/support/TrimExtendParameters.js";import"../chunks/suggestLocations.js";import"../tasks/support/AddressCandidate.js";import"../chunks/commonProperties3.js";import"../tasks/Locator.js";import"../chunks/layerViewUtils.js";import"../chunks/GoTo.js";import"./Search/SearchSource.js";import"../chunks/geometryUtils3.js";import"./Search/LayerSearchSource.js";import"./Search/LocatorSearchSource.js";import"../chunks/geolocationUtils.js";import y from"./Search/SearchViewModel.js";import j from"./Search/SearchResultRenderer.js";const M="esri-search esri-widget",b="esri-widget__loader",S="esri-widget__loader-text",I="esri-widget__loader-animation",k="esri-input",w="esri-search--multiple-sources",f="esri-search--loading",C="esri-search--searching",x="esri-search--show-suggestions",L="esri-search--sources",T="esri-search--warning",E="esri-search__container",R="esri-search__input",N="esri-search__input-container",D="esri-search__form",B="esri-search__submit-button",P="esri-search__sources-button",U="esri-search__clear-button",A="esri-search__source-name",F="esri-search__suggestions-menu",O="esri-search__suggestions-list",G="esri-search__suggestions-list--current-location",$="esri-search__sources-menu",W="esri-search__source",H="esri-search__warning-menu",K="esri-search__warning-body",V="esri-search__warning-header",z="esri-search__warning-text",X="esri-search__no-value-text",Q="esri-widget--disabled",q="esri-widget--button",J="esri-icon-font-fallback-text",Y="esri-icon-locate-circled",Z="esri-menu",ee="esri-menu__list",se="esri-menu__list-item",te="esri-menu__list-item--active",re="esri-menu__list-item--focus",oe="esri-menu__header",ie="esri-icon-search",ne="esri-icon-down-arrow esri-search__sources-button--down",le="esri-icon-up-arrow esri-search__sources-button--up",ae="esri-icon-close",ue="esri-icon-notice-triangle",ce="esri-icon-search",he="esri-disabled",pe=/<[a-z/][\s\S]*>/i;let de=class extends v{constructor(e,s){super(e,s),this._activeMenuItemIndex=-1,this._handles=new a,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new j,this._relatedTarget=null,this._locateFailed=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass=ce,this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new y,this.own(u(this,"searchTerm",(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&(this.activeMenu="none")})),c(this,"viewModel.allSources","change",(()=>this._watchSourceChanges())),h(this,"activeMenu",(()=>this._resetActiveMenuItemIndex())),h(this,"viewModel.defaultPopupTemplate",(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))})))}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){this._inputNode&&(this.activeMenu="suggestion",this._inputNode.focus(),this.emit("search-focus"))}blur(e){this._inputNode&&(this._inputNode.blur(),this._inputBlur(e),this.emit("search-blur"))}search(e){this.activeMenu="none",this._cancelSuggest(),this._cancelSearch();const s=r(),{signal:t}=s;return this._searchController=s,this.viewModel.search(e,{signal:t}).catch((e=>{if(this._searchController===s)return this.activeMenu="none",this._searchController=null,e})).then((e=>{if(this._searchController===s)return this.activeMenu=e.numResults?"none":"warning",this._searchController=null,e}))}suggest(e){this._cancelSuggest();const s=r(),{signal:t}=s;return this._suggestController=s,this.viewModel.suggest(e,null,{signal:t}).then((e=>{if(this._suggestController===s)return this._suggestController=null,e.numResults&&(this.activeMenu="suggestion"),this._scrollToTopSuggestion(),e})).catch((()=>{if(this._suggestController===s)return this._suggestController=null,null}))}render(){const{state:e}=this.viewModel,s={[he]:"disabled"===e,[Q]:this.disabled};return _("div",{class:this.classes(M,s)},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e}=this;return _("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(B,q),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle},_("span",{"aria-hidden":"true",class:ie}))}renderWarningMenu(){return _("div",{key:"esri-search__error-menu",class:this.classes(Z,H)},_("div",{class:K},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:s,sourceMenuId:t,sourceMenuButtonId:r}=this,{activeSourceIndex:o,allSources:i}=this.viewModel;return i.length>1?_("button",{id:r,key:"esri-search__source-menu-button",bind:this,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===s).toString(),"aria-controls":t,class:this.classes(P,q),onclick:this._handleSourcesMenuToggleClick,onblur:this._sourcesButtonBlur,afterCreate:p,"data-node-ref":"_sourceMenuButtonNode"},_("span",{"aria-hidden":"true",class:ne}),_("span",{"aria-hidden":"true",class:le}),_("span",{class:A},this._getSourceName(o))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:s}=this.viewModel,{_activeMenuItemIndex:t,activeMenu:r,sourceMenuId:o,sourceMenuButtonId:i}=this,n="source"===r&&t>-1?this._buildId("source-item",t):null;return e.length>1?_("ul",{"aria-activedescendant":n,"aria-labelledby":i,id:o,role:"menu",bind:this,afterCreate:p,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:ee,tabIndex:-1},s?this.renderSource(y.ALL_INDEX):null,e.map(((e,s)=>this.renderSource(s))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?_("div",{key:"esri-search__source-menu",class:this.classes(Z,$)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:s}=this;return _("div",{class:b,key:"base-loader"},_("span",{"aria-hidden":"true",class:I}),_("span",{class:J},e.searchButtonTitle),_("span",{class:S},s.loading))}renderContainer(){const{allSources:e,state:s}=this.viewModel,{activeMenu:t}=this,r={[w]:e.length>1,[f]:"loading"===s,[C]:"searching"===s,[T]:"warning"===t,[L]:"source"===t,[x]:"suggestion"===t};return _("div",{class:this.classes(r,E),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?_("button",{bind:this,class:this.classes(U,q),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearButtonFocus,title:this.messages.clearButtonTitle},_("span",{"aria-hidden":"true",class:ae})):null}renderLocationGroup(){const{messages:e,locationEnabled:s,displayedSearchTerm:t}=this,r=s&&!t,o="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return r?_("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(ee,O,G)},_("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(se,o?re:null)},_("span",{"aria-hidden":"true",class:Y})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:s,displayedSearchTerm:t,messages:r,suggestionsMenuId:o,inputId:i,_activeMenuItemIndex:n}=this,{maxInputLength:l,placeholder:a,searchTerm:u,suggestionCount:c}=this.viewModel,h=!(!(s&&!t)&&!c),d="suggestion"===e&&n>-1?this._buildId("suggestion-item",n):null;return _("input",{"aria-activedescendant":d,"aria-autocomplete":"list","aria-expanded":(h&&"suggestion"===e).toString(),"aria-controls":h?o:null,"aria-owns":h?o:null,"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,bind:this,placeholder:a,maxlength:l,autocomplete:"off",type:"text",class:this.classes(k,R),value:u,id:i,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:p,"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:u?"":a})}renderForm(){return _("form",{key:"esri-search__form",bind:this,class:D,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:s}=e,t=e.results.length,r=e.results;return t?_("ul",{role:"group",key:`esri-search__suggestion-list-${s}`,class:this.classes(ee,O)},r.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:s,suggestionsMenuId:t,inputId:r}=this,{suggestionCount:o}=this.viewModel,i=s&&!e||o;return this._menuItemCount=0,i?_("div",{id:t,key:"esri-search__suggestions-menu",class:this.classes(Z,F),role:"listbox","aria-labelledby":r,bind:this,afterCreate:p,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return _("div",{key:"esri-search__input-container",class:N},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:s,activeSourceIndex:t}=this.viewModel,{sourceIndex:r}=e,o=e.results.length,i=s.length>1&&t===y.ALL_INDEX;return o&&i?_("div",{key:`esri-search__suggestion-header-${r}`,class:oe},this._getSourceName(r)):null}renderSuggestion(e,s){const{_activeMenuItemIndex:t,messages:r}=this,{searchTerm:o}=this.viewModel;if(o){const{text:i}=e,n=i||r.untitledResult,l=pe.test(n),a=[];if(l)a.push(_("div",{innerHTML:n}));else{const e=this._splitResult(n,o),s=o.toLowerCase();e.forEach(((e,t)=>{e&&e.length&&(e.toLowerCase()===s?a.push(_("strong",{key:t},e)):a.push(e))}))}const u="suggestion"===this.activeMenu&&t===s;return _("li",{bind:this,id:this._buildId("suggestion-item",s),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===s).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${s}`,"data-suggestion":e,role:"option",class:this.classes(se,u?re:null)},a)}}renderSource(e){const{activeSourceIndex:s,searchAllEnabled:t}=this.viewModel,r={[te]:e===s,[re]:"source"===this.activeMenu&&e===(t?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},o=t?e+1:e;return _("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",o),"aria-checked":(e===s).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(W,se,r)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:s}=this,t=e?l(s.noResultsFoundForValue,{value:`"${e}"`}):s.noResultsFound;return _("div",{key:"esri-search__no_results"},_("div",{class:V},s.noResults),_("div",{class:z},t))}renderEmptySearchWarning(){const{messages:e}=this;return _("div",{key:"esri-search__empty-search"},_("span",{"aria-hidden":"true",class:ue}),_("span",{class:X},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return _("div",{key:"esri-search__locate-error"},_("span",{"aria-hidden":"true",class:ue}),_("span",{class:X},e.locateError))}renderWarning(){var e;const{displayedSearchTerm:s,_locateFailed:t}=this,{viewModel:r}=this;return t?this.renderLocateWarning():null!=(e=r.selectedSuggestion)&&e.location||s?this.renderNoResultsWarning(s):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,s){return`${this.id}-${e}${void 0===s?"":`-${s}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:s}}=this,t="sources";e.remove(t),s.forEach((s=>e.add(u(s,"name",(()=>this.scheduleRender())),t)))}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;var s;(this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu)&&(null==(s=this._sourceListNode)||s.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const s=e.currentTarget["data-suggestion"];s&&(this._focus(),this.search(s))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=r(),{signal:s}=e;this._searchController=e,this.viewModel.searchNearby({signal:s}).catch((()=>{this._locateFailed=!0,this.activeMenu="warning"})).then((()=>{this._searchController=null}))}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var s;if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this.activeMenu="none",null==(s=this._sourceMenuButtonNode)||s.focus()}_sourcesButtonBlur(e){const s=e&&e.relatedTarget;this._removeActiveMenu(s,this._sourceListNode)}_inputBlur(e){const s=e&&e.relatedTarget;this._removeActiveMenu(s||this._relatedTarget,this._suggestionListNode)}_storeRelatedTarget(e){this._relatedTarget=e.relatedTarget}_clearButtonFocus(){this.activeMenu="none"}_removeActiveMenu(e,s){!e||e&&s&&s.contains(e)||(this.activeMenu="none")}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var s;const t=o(e);if(e.ctrlKey||e.metaKey||"Copy"===t||"ArrowLeft"===t||"ArrowRight"===t||"Shift"===t)return;if("Tab"===t||"Escape"===t||e.shiftKey&&"Tab"===t)return this._cancelSuggest(),void("Escape"===t&&(this.activeMenu="none"));const r="Home"===t||"End"===t||"ArrowUp"===t||"ArrowDown"===t;if("Enter"===t&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const i=null==(s=this._suggestionListNode)?void 0:s.getElementsByTagName("li");if(null!=i&&i.length){if("suggestion"!==this.activeMenu&&(this.activeMenu="suggestion"),r)return e.preventDefault(),this._cancelSuggest(),void this.handleItemNavigation(t,i,this._suggestionListNode);const s=i[this._activeMenuItemIndex];if("Enter"===t&&s){const e=s["data-suggestion"];return void(e?(this._focus(),this.search(e)):s["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}handleItemNavigation(e,s,t){const r=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=s.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?s.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===s.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&d(s[this._activeMenuItemIndex],t)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_handleInputClick(){this.activeMenu="suggestion"}_handleInputPaste(e){const s=e.target;this.viewModel.searchTerm!==s.value&&(this.viewModel.searchTerm=s.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const s=o(e);if(" "!==s&&"Enter"!==s)"ArrowUp"!==s&&"ArrowDown"!==s&&"End"!==s&&"Home"!==s||e.preventDefault();else{e.preventDefault();const s=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(s)}}_handleSourceMenuKeyup(e){var s;const t=o(e),r="ArrowUp"===t||"ArrowDown"===t||"End"===t||"Home"===t;var i;if(r&&e.preventDefault(),"Escape"===t)return this.activeMenu="none",void(null==(i=this._sourceMenuButtonNode)||i.focus());const n=null==(s=this._sourceListNode)?void 0:s.getElementsByTagName("li");return n&&0!==n.length&&r?("source"!==this.activeMenu&&(this.activeMenu="source"),void this.handleItemNavigation(t,n,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:s}=this,t=this.viewModel,{allSources:r}=t,o=r.getItemAt(e);return e===y.ALL_INDEX?s.all:o&&o.name||s.untitledSource}_splitResult(e,t){const r=s(t);return e.replace(new RegExp(`(^|)(${r})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};e([t()],de.prototype,"_activeMenuItemIndex",void 0),e([t()],de.prototype,"displayedSearchTerm",null),e([t({readOnly:!0})],de.prototype,"inputId",null),e([t({readOnly:!0})],de.prototype,"suggestionsMenuId",null),e([t({readOnly:!0})],de.prototype,"sourceMenuId",null),e([t({readOnly:!0})],de.prototype,"sourceMenuButtonId",null),e([t()],de.prototype,"activeMenu",void 0),e([n("viewModel.activeSource")],de.prototype,"activeSource",void 0),e([n("viewModel.activeSourceIndex")],de.prototype,"activeSourceIndex",void 0),e([n("viewModel.allPlaceholder")],de.prototype,"allPlaceholder",void 0),e([n("viewModel.allSources")],de.prototype,"allSources",void 0),e([n("viewModel.autoNavigate")],de.prototype,"autoNavigate",void 0),e([n("viewModel.autoSelect")],de.prototype,"autoSelect",void 0),e([n("viewModel.defaultSources")],de.prototype,"defaultSources",void 0),e([t()],de.prototype,"disabled",void 0),e([n("viewModel.goToOverride")],de.prototype,"goToOverride",void 0),e([t()],de.prototype,"iconClass",void 0),e([n("viewModel.includeDefaultSources")],de.prototype,"includeDefaultSources",void 0),e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],de.prototype,"label",void 0),e([n("viewModel.locationEnabled")],de.prototype,"locationEnabled",void 0),e([n("viewModel.maxResults")],de.prototype,"maxResults",void 0),e([n("viewModel.maxSuggestions")],de.prototype,"maxSuggestions",void 0),e([t(),m("esri/widgets/Search/t9n/Search")],de.prototype,"messages",void 0),e([t(),m("esri/t9n/common")],de.prototype,"messagesCommon",void 0),e([n("viewModel.minSuggestCharacters")],de.prototype,"minSuggestCharacters",void 0),e([n("viewModel.popupEnabled")],de.prototype,"popupEnabled",void 0),e([n("viewModel.popupTemplate")],de.prototype,"popupTemplate",void 0),e([n("viewModel.portal")],de.prototype,"portal",void 0),e([n("viewModel.resultGraphic")],de.prototype,"resultGraphic",void 0),e([n("viewModel.resultGraphicEnabled")],de.prototype,"resultGraphicEnabled",void 0),e([n("viewModel.results")],de.prototype,"results",void 0),e([n("viewModel.searchAllEnabled")],de.prototype,"searchAllEnabled",void 0),e([n("viewModel.searchTerm")],de.prototype,"searchTerm",void 0),e([n("viewModel.selectedResult")],de.prototype,"selectedResult",void 0),e([n("viewModel.sources")],de.prototype,"sources",void 0),e([n("viewModel.suggestions")],de.prototype,"suggestions",void 0),e([n("viewModel.suggestionsEnabled")],de.prototype,"suggestionsEnabled",void 0),e([n("viewModel.view")],de.prototype,"view",void 0),e([g(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),t({type:y})],de.prototype,"viewModel",void 0),e([n("viewModel.clear")],de.prototype,"clear",null),de=e([i("esri.widgets.Search")],de);var me=de;export default me;
