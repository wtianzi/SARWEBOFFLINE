/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import{h as t}from"../core/lang.js";import{a as s}from"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import{L as i}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{e as o}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import a from"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../core/urlUtils.js";import{aliasOf as l}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as m}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols.js";import"../chunks/uid.js";import"../Graphic.js";import"../core/Handles.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../tasks/support/ColorRamp.js";import"../tasks/support/AlgorithmicColorRamp.js";import"../tasks/support/MultipartColorRamp.js";import"../chunks/colorRamps.js";import"../renderers/Renderer.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/sizeVariableUtils.js";import"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/VisualVariablesMixin.js";import"../chunks/symbolConversion.js";import"../symbols/support/jsonUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../renderers/ClassBreaksRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/styleUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/MemCache.js";import"../chunks/LRUCache.js";import"../renderers/DictionaryRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/support/jsonUtils.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/MultiOriginJSONSupport.js";import{on as c,init as d}from"../core/watchUtils.js";import"../chunks/fieldType.js";import{HandleOwnerMixin as p}from"../core/HandleOwner.js";import"../chunks/domUtils.js";import"../chunks/widgetUtils.js";import"../chunks/projector.js";import{a as u}from"../chunks/accessibleHandler.js";import{m as h}from"../chunks/messageBundle.js";import"./support/widget.js";import{v as b}from"../chunks/vmEvent.js";import{j as y}from"../chunks/index.js";import g from"./Widget.js";import"../layers/support/Field.js";import"../chunks/labelUtils.js";import"../layers/support/LabelClass.js";import"../chunks/defaultsJSON.js";import"../chunks/defaults.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../layers/support/FieldsIndex.js";import"../chunks/DataLayerSource.js";import"../support/popupUtils.js";import"../tasks/support/Query.js";import"../tasks/support/StatisticDefinition.js";import"../layers/support/Sublayer.js";import"../chunks/ActionSlider.js";import"./LayerList/ListItemPanel.js";import{f as _}from"../chunks/layerListUtils.js";import j from"./LayerList/ListItem.js";import f from"./BasemapLayerList/BasemapLayerListViewModel.js";import{S as v}from"../chunks/sortable.esm.js";const k=a.ofType(j);function I(e,t,s){e.splice(s,0,e.splice(t,1)[0])}const S="esri-basemap-layer-list esri-widget esri-widget--panel",L="esri-basemap-layer-list--new-ui",C="esri-basemap-layer-list__title-container",A="esri-basemap-layer-list__main-heading",E="esri-basemap-layer-list__editing-card",T="esri-basemap-layer-list__editing-input",w="esri-basemap-layer-list__editing-actions",U="esri-basemap-layer-list__edit-button",R="esri-basemap-layer-list__edit-button-icon",M="esri-basemap-layer-list__no-items",B="esri-basemap-layer-list__hr",O="esri-basemap-layer-list__list-heading",x="esri-basemap-layer-list__list",V="esri-basemap-layer-list__list--root",D="esri-basemap-layer-list__list--exclusive",P="esri-basemap-layer-list__list--inherited",N="esri-basemap-layer-list__list--independent",F="esri-basemap-layer-list__item",$="esri-basemap-layer-list__item--only-child",H="esri-basemap-layer-list__item--error",z="esri-basemap-layer-list__item--invisible",J="esri-basemap-layer-list__item--invisible-at-scale",K="esri-basemap-layer-list__item--updating",q="esri-basemap-layer-list__item--has-children",G="esri-basemap-layer-list__item--selectable",Q="esri-basemap-layer-list__item-container",W="esri-basemap-layer-list__item-actions-menu",X="esri-basemap-layer-list__item-actions-menu-item",Y="esri-basemap-layer-list__item-actions-menu-item--active",Z="esri-basemap-layer-list__item-actions",ee="esri-basemap-layer-list__item-actions-list",te="esri-basemap-layer-list__item-action",se="esri-basemap-layer-list__item-action-icon",ie="esri-basemap-layer-list__item-action-image",re="esri-basemap-layer-list__item-action-title",oe="esri-basemap-layer-list__action-toggle",ne="esri-basemap-layer-list__action-toggle--on",ae="esri-basemap-layer-list__item-label",le="esri-basemap-layer-list__item-error-message",me="esri-basemap-layer-list__item-title",ce="esri-basemap-layer-list__item-toggle",de="esri-basemap-layer-list__item-toggle-icon",pe="esri-basemap-layer-list__item-toggle-icon",ue="esri-basemap-layer-list__item-radio-icon",he="esri-basemap-layer-list__child-toggle",be="esri-basemap-layer-list__child-toggle--open",ye="esri-basemap-layer-list__child-toggle-icon--opened",ge="esri-basemap-layer-list__child-toggle-icon--closed",_e="esri-basemap-layer-list__child-toggle-icon--closed-rtl",je="esri-basemap-layer-list--chosen",fe="esri-button",ve="esri-button--tertiary",ke="esri-input",Ie="esri-disabled",Se="esri-disabled-element",Le="esri-hidden",Ce="esri-rotating",Ae="esri-widget__heading",Ee="esri-icon-edit",Te="esri-icon-handle-horizontal",we="esri-icon-visible",Ue="esri-icon-non-visible",Re="esri-icon-radio-checked",Me="esri-icon-radio-unchecked",Be="esri-icon-notice-triangle",Oe="esri-icon-down-arrow",xe="esri-icon-right-triangle-arrow",Ve="esri-icon-left-triangle-arrow",De="esri-icon-loading-indicator",Pe="esri-icon-default-action",Ne="esri-icon-layers",Fe="base-items",$e="reference-items",He={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function ze(e){const{actionsOpen:t,children:s}=e;t&&(e.actionsOpen=!1),s.forEach((e=>ze(e)))}const Je=i.getLogger("esri.widgets.BasemapLayerList"),Ke={baseLayers:!0,referenceLayers:!0,statusIndicators:!0};let qe=class extends(p(g)){constructor(e,s){super(e,s),this._editingTitle=!1,this._editTitleInput=null,this._editTitleButton=null,this._focusOnElement=null,this._sortableBaseLayers=null,this._sortableReferenceLayers=null,this._sortableBaseLayersNode=null,this._sortableReferenceLayersNode=null,this._focusSortUid=null,this._newUI=t("esri-basemaplayerlist-new-ui"),this.basemapTitle=null,this.baseListItemCreatedFunction=null,this.editingEnabled=!1,this.iconClass=Ne,this.label=void 0,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.referenceListItemCreatedFunction=null,this.baseItems=null,this.referenceItems=null,this.selectedItems=new k,this.view=null,this.viewModel=new f,this.visibleElements={...Ke}}initialize(){const{baseItems:e,referenceItems:t}=this;this.own([c(this,"baseItems","change",(()=>{this._itemsChanged(e,Fe),this._toggleSortingBaseLayers()})),c(this,"referenceItems","change",(()=>this._itemsChanged(t,$e))),d(this,"editingEnabled",(()=>this._toggleSorting()))])}destroy(){this._destroyBaseSortable(),this._destroyReferenceSortable()}set statusIndicatorsVisible(e){s(Je,"statusIndicatorsVisible",{replacement:"visibleElements.statusIndicators",version:"4.15"}),this.visibleElements={...this.visibleElements,statusIndicators:e}}castVisibleElements(e){return{...Ke,...e}}triggerAction(e,t){this.viewModel.triggerAction(e,t)}render(){const{state:e}=this.viewModel,t={[L]:this._newUI,[Le]:"loading"===e,[Ie]:"disabled"===e},s=this.renderReferenceSection(),i=this.renderBaseSection(),r=s&&i?y("hr",{class:B}):null;return y("div",{class:this.classes(S,t)},this.renderTitleContainer(),s,r,i)}renderEditingInput(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return y("label",{class:T},e.basemapTitle,y("input",{bind:this,class:ke,title:e.basemapTitle,"aria-label":e.basemapTitle,placeholder:e.basemapTitle,type:"text",role:"textbox",value:t,afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement}))}renderCancelButton(){const{messagesCommon:e}=this;return y("button",{title:e.cancel,"aria-label":e.cancel,type:"button",bind:this,class:this.classes(fe,ve),onclick:this._toggleEditingTitle},e.cancel)}renderSubmitButton(){const{messagesCommon:e}=this;return y("button",{title:e.form.submit,"aria-label":e.form.submit,type:"button",bind:this,class:fe,onclick:this._formSubmit},e.form.ok)}renderEditingForm(){return y("div",{class:E},y("form",{bind:this,onsubmit:this._formSubmit},this.renderEditingInput(),y("div",{class:w},this.renderCancelButton(),this.renderSubmitButton())))}renderBasemapTitle(){const{basemapTitle:e}=this.viewModel;return y("h2",{class:this.classes(Ae,A)},e)}renderEditTitleButton(){const{_editingTitle:e,editingEnabled:t,messagesCommon:s}=this;return t&&!e?y("button",{bind:this,class:U,title:s.edit,"aria-label":s.edit,onclick:this._toggleEditingTitle,afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"data-node-ref":"_editButtonNode"},y("span",{"aria-hidden":"true",class:this.classes(Ee,R)})):null}renderTitleContainer(){return y("div",{class:C},this._editingTitle?this.renderEditingForm():this.renderBasemapTitle(),this.renderEditTitleButton())}renderNoLayersInfo(e,t){return y("div",{key:t,class:M},e)}renderList(e,t){const{messages:s}=this,i="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return y("ul",{key:t,"aria-label":s.widgetLabel,role:this.editingEnabled&&e.length?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:i,"data-node-ref":t,bind:this,class:this.classes(x,V,N)},e.map((s=>this.renderItem({item:s,parent:null,itemType:t,isOnlyChild:1===e.length}))))}renderBaseHeader(){return y("h3",{key:"base-heading",class:this.classes(Ae,O)},this.messages.baseHeading)}renderBaseSection(){const{baseItems:e,messages:t,visibleElements:s}=this;if(!s.baseLayers)return null;const i=this._getItems(e),r="base";return[this.renderBaseHeader(),[0===i.length?this.renderNoLayersInfo(t.noBaseLayers,r):null,this.renderList(i,r)]]}renderReferenceHeader(){return y("h3",{key:"reference-heading",class:this.classes(Ae,O)},this.messages.referenceHeading)}renderReferenceSection(){const{referenceItems:e,messages:t,visibleElements:s}=this;if(!s.referenceLayers)return null;const i=this._getItems(e),r="reference";return[this.renderReferenceHeader(),[0===i.length?this.renderNoLayersInfo(t.noReferenceLayers,r):null,this.renderList(i,r)]]}renderChildrenToggle(e,t){const{messagesCommon:s}=this,{children:i}=e,r=!!e.error,o=!!i.length&&!r,n={[be]:e.open},a=e.open?s.collapse:s.expand;return o?y("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(he,n),tabindex:"0",role:"button","aria-controls":t,"aria-label":a,title:a},y("span",{"aria-hidden":"true",class:this.classes(ge,xe)}),y("span",{"aria-hidden":"true",class:this.classes(ye,Oe)}),y("span",{"aria-hidden":"true",class:this.classes(_e,Ve)})):null}renderError(e){return e.error?y("div",{key:"error",class:le,role:"alert"},y("span",null,this.messages.layerError)):null}renderActionsMenuIcon(e,t){const{messagesCommon:s}=this,i={[Y]:e.actionsOpen},r=e.actionsOpen?s.close:s.open;return y("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(X,i),tabindex:"0",role:"button","aria-controls":t,"aria-label":r,title:r},y("span",{"aria-hidden":"true",class:Te}))}renderActionsMenu(e,t,s,i){const{panel:r}=e,o=r&&r.visible?this.renderPanelButton(r):null,n=1===s&&this._getSingleActionButton(t),a=n?this.renderAction({item:e,action:n,singleAction:!0}):null,l=!n&&s?this.renderActionsMenuIcon(e,i):null;return l||o||n?y("div",{key:"actions-menu",class:W},o,a,l):null}renderChildList(e,t){const{editingEnabled:s}=this,{visibilityMode:i,children:r}=e,o=!!e.error,n=!!r.length&&!o,{exclusive:a,inherited:l}=He,m={[D]:i===a,[P]:i===l,[N]:i!==l&&i!==a};return n?y("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,class:this.classes(x,m),"aria-expanded":e.open?"true":"false",role:s?"listbox":i===a?"radiogroup":"group",hidden:!e.open||null},null==r?void 0:r.map((t=>this.renderItem({item:t,parent:e}))).toArray()):null}renderItemContent(e,t,s){const{id:i}=this,r=`${i}_${e.uid}`,o=`${r}_actions`,n=`${r}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),m=this._countActions(l);return[y("div",{key:"list-item-container",class:Q},this.renderChildrenToggle(e,n),this.renderLabel(e,t,s),this.renderActionsMenu(e,l,m,o)),this.renderError(e),m?this.renderActionsSections(e,l,o):null,a&&a.open?a.render():null,this.renderChildList(e,n)]}renderItem({item:e,parent:t,itemType:s,isOnlyChild:i}){const{_newUI:r,id:o,editingEnabled:n,selectedItems:a,visibleElements:l}=this,{children:m}=e,c=`${`${o}_${e.uid}`}__title`,d=!!e.error,p=!!m.length&&!d,u={[q]:p,[H]:!!d,[K]:e.updating&&!t&&l.statusIndicators,[z]:r&&!e.visible,[J]:!e.visibleAtCurrentScale,[G]:n};if(n){var h;const r={"data-layer-uid":null==(h=e.layer)?void 0:h.uid};return y("li",Object.assign({key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(F,u,{[$]:i}),"aria-labelledby":c,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item-type":s,"data-item":e,tabIndex:0,"aria-selected":_(e,a)?"true":"false",role:"option"},r),this.renderItemContent(e,t,c))}return y("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(F,u),"aria-labelledby":c},this.renderItemContent(e,t,c))}renderItemTitle(e,t){const{messages:s}=this,i=e.title||s.untitledLayer,r=e.visibleAtCurrentScale?i:`${i} (${s.layerInvisibleAtScale})`;return y("span",{key:"layer-title-container",id:t,title:r,"aria-label":r,class:me},i)}renderItemToggleIcon(e,t){const{_newUI:s}=this,{exclusive:i}=He,r=t&&t.visibilityMode,o={[de]:s,[pe]:s&&r!==i,[ue]:s&&r===i,[Re]:r===i&&e.visible,[Me]:r===i&&!e.visible,[we]:r!==i&&e.visible,[Ue]:r!==i&&!e.visible};return y("span",{key:"item-toggle-icon",class:this.classes(o),"aria-hidden":"true"})}renderItemToggle(e,t,s){const{editingEnabled:i}=this,{exclusive:r}=He,o=t&&t.visibilityMode,n=o===r?"radio":"switch";return y("span",i?{key:"item-toggle-selection-enabled",class:ce,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,"aria-checked":e.visible?"true":"false",role:n,"aria-labelledby":s}:{key:"item-toggle",class:ce},this.renderItemToggleIcon(e,t))}renderItemError(e){return e.error?y("span",{key:"notice-triangle","aria-hidden":"true",class:Be}):null}renderLabel(e,t,s){const{editingEnabled:i,_newUI:r}=this,{inherited:o,exclusive:n}=He,a=null==t?void 0:t.visibilityMode,l=a===n?"radio":"switch",m=[this.renderItemToggle(e,t,s),this.renderItemTitle(e,s)];r&&m.reverse();const c=y("div",i?{key:`item-label-no-selection-${e.uid}`,class:ae}:{key:`item-label-with-selection-${e.uid}`,class:ae,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":a,tabIndex:0,"aria-checked":e.visible?"true":"false",role:l,"aria-labelledby":s},m);return a===o||e.error?y("div",{key:`item-label-container-${e.uid}`,class:ae},this.renderItemError(e),this.renderItemTitle(e,s)):c}renderPanelButton(e){const{className:t,open:s,title:i,image:r}=e,o=r||t?t:Pe,n=this._getIconImageStyles(e),a={[Y]:s},l={[ie]:!!n["background-image"]};return o&&(l[o]=!!o),y("div",{key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(X,a),role:"button",tabindex:"0",title:i,"aria-label":i},y("span",{class:this.classes(l),styles:n}))}renderActionsSections(e,t,s){const i=t.toArray().map(((t,s)=>y("ul",{key:`${e}-action-section-${s}`,class:ee},this.renderActionSection(e,t))));return y("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:s,class:Z,hidden:!e.actionsOpen||null},i)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:s}=e,i=this._getIconImageStyles(e),r="button"!==e.type||e.image||s?s:Pe,o={[ie]:!t&&!!i["background-image"],[De]:t,[Ce]:t};return r&&!t&&(o[r]=!0),y("span",{key:"action-icon","aria-hidden":"true",class:this.classes(se,o),styles:i})}renderActionTitle(e,t){return t?null:y("span",{key:"action-title",class:re},e)}renderAction(e){const{item:t,action:s,singleAction:i}=e,{active:r,disabled:o,title:n}=s,a={[X]:i&&"button"===s.type,[te]:r||!i&&"toggle"!==s.type,[oe]:!r&&"toggle"===s.type,[ne]:!r&&"toggle"===s.type&&s.value,[Se]:o},l=[this.renderActionIcon(s),this.renderActionTitle(n,i)];return i?y("div",{bind:this,"data-item":t,"data-action":s,role:"button",key:`single-action-${s.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:n,"aria-label":n},l):y("li",{bind:this,"data-item":t,"data-action":s,key:`action-${s.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:n,"aria-label":n},l)}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_destroyReferenceSortable(){const{_sortableReferenceLayers:e}=this;(null==e?void 0:e.el)&&e.destroy(),this._sortableReferenceLayersNode=null}_destroyBaseSortable(){const{_sortableBaseLayers:e}=this;(null==e?void 0:e.el)&&e.destroy(),this._sortableBaseLayersNode=null}_toggleEditingTitle(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()}_storeEditTitleInput(e){this._editTitleInput=e,this._focusEditElement()}_focusEditElement(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())}_storeEditTitleButton(e){this._editTitleButton=e,this._focusEditElement()}_formSubmit(e){e.preventDefault();const{_editTitleInput:t}=this;t&&(this.basemapTitle=t.value),this._toggleEditingTitle()}_itemMovedList(e){const t=e.item["data-item"],s=e.to.dataset.nodeRef,i=e.from.dataset.nodeRef,{newIndex:r}=e;this.viewModel.transferListItem({listItem:t,from:i,to:s,newIndex:r})}_toggleSortingBaseLayers(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:s}=this;if(!t)return;const i=!s;if(e)e.option("disabled",i);else{const e=v.create(t,{dataIdAttr:"data-layer-uid",group:"root-layers",filter:`.${$}`,fallbackTolerance:4,disabled:i,onSort:()=>this._sortLayersToItems({type:"base",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:je});this._sortableBaseLayers=e}}_toggleSortingReferenceLayers(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:s}=this;if(!t)return;const i=!s;if(e)e.option("disabled",i);else{const e=v.create(t,{dataIdAttr:"data-layer-uid",group:"root-layers",disabled:i,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:je});this._sortableReferenceLayers=e}}_toggleSorting(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()}_sortNodeCreated(e){const t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()}_getItems(e){return e.toArray().filter((e=>this.errorsVisible||!e.error))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)}_sortLayersToItems({type:e,itemIds:t}){const s="base"===e?this.get("view.map.basemap.baseLayers"):"reference"===e?this.get("view.map.basemap.referenceLayers"):null;s&&s.sort(((e,s)=>{const i=t.indexOf(e.uid),r=t.indexOf(s.uid);return i>r?-1:i<r?1:0}))}_focusListItem(e){var t;const{_focusSortUid:s}=this;if(!e||!s)return;(null==(t=e["data-item"].layer)?void 0:t.uid)===s&&(e.focus(),this._focusSortUid=null)}_selectionKeydown(e){const t=o(e);if(-1===["ArrowDown","ArrowUp"].indexOf(t))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget,i=s["data-item"],r=s.dataset.itemType,{_sortableBaseLayers:n,_sortableReferenceLayers:a,selectedItems:l}=this,m="base"===r?n:"reference"===r?a:null;if(!m)return;const c=_(i,l),d=m.toArray(),p=e.target,u=d.indexOf(p.dataset.layerUid),{baseItems:h,referenceItems:b}=this.viewModel;if(-1!==u){if("ArrowDown"===t){var y;const e=u+1,t=e>=d.length;if(t&&"reference"===r&&c){var g;const e=h.length;return this.viewModel.transferListItem({listItem:i,from:"reference",to:"base",newIndex:e}),this._focusSortUid=null==(g=i.layer)?void 0:g.uid,void this.scheduleRender()}if(t&&"reference"===r){var j;const e=h.getItemAt(0);return this._focusSortUid=null==e||null==(j=e.layer)?void 0:j.uid,void this.scheduleRender()}if(t)return;return c&&(I(d,u,e),m.sort(d),this._sortLayersToItems({type:r,itemIds:m.toArray()})),this._focusSortUid=null==(y=i.layer)?void 0:y.uid,void this.scheduleRender()}if("ArrowUp"===t){var f;const e=u-1,t=e<0;if(t&&"base"===r&&c){var v;if(1===h.length)return;const e=0;return this.viewModel.transferListItem({listItem:i,from:"base",to:"reference",newIndex:e}),this._focusSortUid=null==(v=i.layer)?void 0:v.uid,void this.scheduleRender()}if(t&&"base"===r){var k;const e=b.getItemAt(b.length-1);return this._focusSortUid=null==e||null==(k=e.layer)?void 0:k.uid,void this.scheduleRender()}if(t)return;c&&(I(d,u,e),m.sort(d),this._sortLayersToItems({type:r,itemIds:m.toArray()})),this._focusSortUid=null==(f=i.layer)?void 0:f.uid,this.scheduleRender()}}}_watchActionSectionChanges(e,t){this.handles.add(e.on("change",(()=>this.scheduleRender())),t),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){"toggle"!==e.type?"slider"!==e.type?this.handles.add([d(e,["className","image","id","title","visible"],(()=>this.scheduleRender()))],t):this.handles.add([d(e,["className","id","title","visible","value","displayValueEnabled","max","min","step"],(()=>this.scheduleRender()))],t):this.handles.add([d(e,["className","image","id","title","visible","value"],(()=>this.scheduleRender()))],t)}_renderOnItemChanges(e,t){this.handles.add([d(e,["actionsOpen","visible","open","updating","title","visibleAtCurrentScale","error","visibilityMode","panel","panel.title","panel.content","panel.className"],(()=>this.scheduleRender())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],t),e.children.forEach((e=>this._renderOnItemChanges(e,t))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e,t){this.handles.remove(t),e.forEach((e=>this._renderOnItemChanges(e,t))),this.scheduleRender()}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}}_toggleActionsOpen(e){e.stopPropagation();const t=e.currentTarget["data-item"],{actionsOpen:s}=t,i=!s,{baseItems:r,referenceItems:o}=this;i&&(r.forEach((e=>ze(e))),o.forEach((e=>ze(e)))),t.actionsOpen=i}_triggerPanel(e){e.stopPropagation();const t=e.currentTarget["data-panel"];t&&(t.open=!t.open)}_triggerAction(e){e.stopPropagation();const t=e.currentTarget,s=t["data-action"],i=t["data-item"];"toggle"===s.type&&(s.value=!s.value),this.triggerAction(s,i)}_toggleVisibility(e){e.stopPropagation();const t=e.currentTarget,s=t.getAttribute("data-parent-visibility"),i=t["data-item"];s===He.exclusive&&i.visible||(i.visible=!i.visible)}_toggleChildrenClick(e){e.stopPropagation();const t=e.currentTarget["data-item"];t.open=!t.open}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:s}=this,i=t&&(e.metaKey||e.ctrlKey),r=e.currentTarget["data-item"],o=_(r,s),{length:n}=s;if(!i)return n&&!(o&&1===n)?(s.removeAll(),void s.add(r)):void(o?s.remove(o):s.add(r));o?s.remove(o):s.add(r)}};e([l("viewModel.basemapTitle")],qe.prototype,"basemapTitle",void 0),e([l("viewModel.baseListItemCreatedFunction")],qe.prototype,"baseListItemCreatedFunction",void 0),e([r()],qe.prototype,"editingEnabled",void 0),e([r()],qe.prototype,"errorsVisible",void 0),e([r()],qe.prototype,"iconClass",void 0),e([r({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],qe.prototype,"label",void 0),e([r(),h("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],qe.prototype,"messages",void 0),e([r(),h("esri/t9n/common")],qe.prototype,"messagesCommon",void 0),e([r()],qe.prototype,"multipleSelectionEnabled",void 0),e([l("viewModel.referenceListItemCreatedFunction")],qe.prototype,"referenceListItemCreatedFunction",void 0),e([l("viewModel.baseItems")],qe.prototype,"baseItems",void 0),e([l("viewModel.referenceItems")],qe.prototype,"referenceItems",void 0),e([r()],qe.prototype,"selectedItems",void 0),e([r()],qe.prototype,"statusIndicatorsVisible",null),e([l("viewModel.view")],qe.prototype,"view",void 0),e([b("trigger-action"),r({type:f})],qe.prototype,"viewModel",void 0),e([r()],qe.prototype,"visibleElements",void 0),e([m("visibleElements")],qe.prototype,"castVisibleElements",null),e([u()],qe.prototype,"_toggleActionsOpen",null),e([u()],qe.prototype,"_triggerPanel",null),e([u()],qe.prototype,"_triggerAction",null),e([u()],qe.prototype,"_toggleVisibility",null),e([u()],qe.prototype,"_toggleChildrenClick",null),e([u()],qe.prototype,"_toggleSelection",null),qe=e([n("esri.widgets.BasemapLayerList")],qe);var Ge=qe;export default Ge;
