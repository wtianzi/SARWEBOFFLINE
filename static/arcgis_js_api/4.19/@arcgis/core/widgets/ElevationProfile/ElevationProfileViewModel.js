/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../chunks/ArrayPool.js";import"../../core/lang.js";import"../../chunks/deprecate.js";import"../../chunks/object.js";import"../../kernel.js";import"../../config.js";import{i as e,b as s,c as i,j as o,m as r,e as n,h as a,d as l,L as p}from"../../chunks/Logger.js";import"../../chunks/string.js";import{h as u,f as c}from"../../chunks/metadata.js";import{property as h}from"../../core/accessorSupport/decorators/property.js";import m,{c as d,w as f,d as j}from"../../core/Accessor.js";import"../../chunks/PropertyOrigin.js";import{s as y,m as v}from"../../core/scheduling.js";import{throwIfAborted as g,throwIfNotAbortError as _,after as k,isAbortError as b,createTask as w,throwIfAbortError as P,ignoreAbortErrors as S,whenOrAbort as U}from"../../core/promiseUtils.js";import"../../chunks/Message.js";import"../../core/Error.js";import"../../chunks/compilerUtils.js";import"../../chunks/ensureType.js";import{subclass as I}from"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Evented.js";import M from"../../core/Collection.js";import{r as R}from"../../chunks/collectionUtils.js";import"../../chunks/JSONSupport.js";import"../../chunks/Promise.js";import"../../chunks/Loadable.js";import"../../chunks/asyncUtils.js";import"../../chunks/loadAll.js";import"../../core/urlUtils.js";import{aliasOf as E}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/jsonMap.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../chunks/shared.js";import"../../chunks/writer.js";import"../../chunks/resourceExtension.js";import"../../chunks/persistableUrlUtils.js";import C from"../../geometry/SpatialReference.js";import"../../chunks/locale.js";import"../../chunks/number.js";import"../../intl.js";import"../../request.js";import"../../chunks/assets.js";import"../../geometry/Geometry.js";import"../../geometry/Point.js";import"../../chunks/Ellipsoid.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Extent.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../../portal/PortalUser.js";import"../../portal/Portal.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../portal/PortalItem.js";import{h as D}from"../../chunks/mathUtils2.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import{f as x}from"../../chunks/vec3.js";import"../../chunks/mathUtils.js";import"../../chunks/colorUtils.js";import"../../Color.js";import"../../chunks/zmUtils.js";import L from"../../geometry/Multipoint.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import T from"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../geometry.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/domains.js";import"../../chunks/arcadeOnDemand.js";import"../../layers/support/fieldUtils.js";import"../../popup/content/Content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/CustomContent.js";import"../../chunks/date.js";import"../../popup/support/FieldInfoFormat.js";import"../../popup/FieldInfo.js";import"../../popup/content/FieldsContent.js";import"../../chunks/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/MediaContent.js";import"../../popup/content/TextContent.js";import"../../popup/content.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/RelatedRecordsInfo.js";import"../../chunks/Identifiable.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../PopupTemplate.js";import"../../symbols/Symbol.js";import O from"../../symbols/CIMSymbol.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/screenUtils.js";import"../../chunks/opacityUtils.js";import"../../chunks/materialUtils.js";import"../../symbols/edges/Edges3D.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/utils.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import V from"../../symbols/SimpleLineSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/patterns/StylePattern3D.js";import"../../symbols/FillSymbol3DLayer.js";import"../../chunks/colors.js";import"../../chunks/Symbol3DOutline.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/Symbol3D.js";import"../../chunks/Thumbnail.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../chunks/Symbol3DVerticalOffset.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../symbols.js";import"../../chunks/uid.js";import A from"../../Graphic.js";import"../../Ground.js";import G from"../../core/Handles.js";import"../../layers/Layer.js";import"../../chunks/LegendOptions.js";import"../../renderers/visualVariables/support/ColorStop.js";import"../../renderers/support/AuthoringInfo.js";import"../../renderers/support/AuthoringInfoVisualVariable.js";import"../../tasks/support/ColorRamp.js";import"../../tasks/support/AlgorithmicColorRamp.js";import"../../tasks/support/MultipartColorRamp.js";import"../../chunks/colorRamps.js";import"../../renderers/Renderer.js";import"../../renderers/visualVariables/VisualVariable.js";import"../../renderers/visualVariables/ColorVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../chunks/sizeVariableUtils.js";import{a as F,i as Z,c as z,C as q,D as N,B}from"../../chunks/unitUtils.js";import"../../chunks/lengthUtils.js";import"../../chunks/visualVariableUtils.js";import"../../chunks/VisualVariablesMixin.js";import"../../chunks/symbolConversion.js";import"../../symbols/support/jsonUtils.js";import"../../renderers/support/ClassBreakInfo.js";import"../../chunks/commonProperties.js";import"../../renderers/ClassBreaksRenderer.js";import"../../chunks/diffUtils.js";import"../../renderers/support/UniqueValueInfo.js";import"../../chunks/devEnvironmentUtils.js";import"../../chunks/styleUtils.js";import"../../renderers/UniqueValueRenderer.js";import"../../chunks/normalizeUtilsCommon.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/MemCache.js";import"../../chunks/ItemCache.js";import"../../chunks/utils3.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils2.js";import{L as Q}from"../../chunks/LRUCache.js";import"../../renderers/DictionaryRenderer.js";import"../../renderers/support/AttributeColorInfo.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/support/HeatmapColorStop.js";import"../../renderers/HeatmapRenderer.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/support/jsonUtils.js";import"../../chunks/timeUtils.js";import"../../TimeExtent.js";import"../../TimeInterval.js";import"../../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../../chunks/MultiOriginJSONSupport.js";import"../../core/watchUtils.js";import"../../chunks/arcgisLayerUrl.js";import"../../chunks/fieldType.js";import"../../geometry/HeightModelInfo.js";import"../../chunks/mat4.js";import"../../chunks/pe.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/geodesicConstants.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../geometry/support/GeographicTransformation.js";import{initializeProjection as H,project as W}from"../../geometry/projection.js";import"../../chunks/OperationalLayer.js";import"../../chunks/ElevationInfo.js";import"../../chunks/unitConversionUtils.js";import"../../chunks/commonProperties2.js";import{T as J}from"../../chunks/Scheduler.js";import"../../core/HandleOwner.js";import"../../chunks/_commonjsHelpers.js";import"../../core/workers/RemoteClient.js";import"../../core/workers/Connection.js";import"../../core/workers/workers.js";import"../../form/ExpressionInfo.js";import"../../form/elements/FieldElement.js";import"../../form/support/elements.js";import"../../form/elements/inputs/Input.js";import"../../form/elements/inputs/TextInput.js";import"../../form/elements/inputs/BarcodeScannerInput.js";import"../../form/elements/inputs/ComboBoxInput.js";import"../../form/elements/inputs/DateTimePickerInput.js";import"../../form/elements/inputs/RadioButtonsInput.js";import"../../form/elements/inputs/TextAreaInput.js";import"../../form/elements/inputs/TextBoxInput.js";import"../../form/elements/support/inputs.js";import"../../form/elements/GroupElement.js";import"../../form/FormTemplate.js";import{geodesicLengths as Y,inverseGeodeticSolver as K,directGeodeticSolver as X,isSupported as $}from"../../geometry/support/geodesicUtils.js";import"../../geometry/Circle.js";import"../../chunks/vec4f64.js";import"../../chunks/quatf64.js";import"../../chunks/mat3.js";import"../../chunks/BufferView.js";import{d as tt,m as et}from"../../chunks/vec2.js";import"../../chunks/vec4.js";import"../../chunks/quat.js";import"../../chunks/domUtils.js";import"../../chunks/widgetUtils.js";import"../../chunks/projector.js";import"../../chunks/accessibleHandler.js";import"../../chunks/messageBundle.js";import"../support/widget.js";import"../../chunks/vmEvent.js";import"../../chunks/index.js";import"../Widget.js";import"../../chunks/zscale.js";import"../../chunks/queryZScale.js";import"../../layers/support/Field.js";import"../../tasks/support/FeatureSet.js";import"../../layers/FeatureLayer.js";import"../../chunks/ArcGISService.js";import"../../chunks/BlendLayer.js";import"../../chunks/CustomParametersMixin.js";import"../../chunks/PortalLayer.js";import"../../chunks/RefreshableLayer.js";import"../../chunks/ScaleRangeLayer.js";import"../../layers/support/TimeInfo.js";import"../../chunks/TemporalLayer.js";import"../../layers/support/FeatureReductionSelection.js";import"../../layers/support/FeatureReductionCluster.js";import"../../chunks/labelUtils.js";import"../../layers/support/LabelClass.js";import"../../chunks/defaultsJSON.js";import"../../chunks/defaults.js";import"../../chunks/featureReductionUtils.js";import"../../layers/support/FeatureTemplate.js";import"../../layers/support/FeatureType.js";import"../../chunks/fieldProperties.js";import"../../layers/support/FieldsIndex.js";import"../../layers/support/GeometryFieldsInfo.js";import"../../chunks/labelingInfo.js";import"../../layers/support/LayerFloorInfo.js";import"../../layers/support/Relationship.js";import"../../chunks/DataLayerSource.js";import"../../chunks/styleUtils2.js";import"../../support/popupUtils.js";import"../../tasks/support/AttachmentQuery.js";import"../../tasks/support/Query.js";import"../../tasks/support/StatisticDefinition.js";import"../../tasks/support/RelationshipQuery.js";import"../../chunks/GraphicsCollection.js";import st from"../../layers/GraphicsLayer.js";import"../../chunks/utils4.js";import"../../tasks/Task.js";import"../../rest/query/support/AttachmentInfo.js";import"../../chunks/query.js";import"../../chunks/executeRelationshipQuery.js";import"../../chunks/pbf.js";import"../../chunks/OptimizedFeatureSet.js";import"../../chunks/pbfQueryUtils.js";import"../../chunks/featureConversionUtils.js";import"../../tasks/QueryTask.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/vec4f32.js";import"../../layers/support/ElevationSampler.js";import"../../chunks/quantizationUtils.js";import"../../chunks/mat2d.js";import"../../symbols/support/symbolUtils.js";import"../../chunks/byteSizeEstimations.js";import"../../chunks/dehydratedFeatureComparison.js";import"../../chunks/dehydratedFeatures.js";import"../../chunks/ElevationProvider.js";import{i as it}from"../../chunks/interactiveToolUtils.js";import{t as ot}from"../../chunks/throttle.js";import"../Attachments.js";import"../Attachments/AttachmentsViewModel.js";import"../Feature/FeatureViewModel.js";import"../Feature.js";import"../../chunks/AnchorElementViewModel.js";import"../Spinner/SpinnerViewModel.js";import"../Popup.js";import"../../chunks/Queue.js";import"../../chunks/InputManager.js";import"../../chunks/layerViewUtils.js";import"../../chunks/actions.js";import"../Popup/PopupViewModel.js";import"../../chunks/GoTo.js";import"../../chunks/MapUtils.js";import"../../chunks/screenUtils2.js";import"../../chunks/mat2df64.js";import"../../chunks/vec2f64.js";import{Q as rt}from"../../chunks/QueueProcessor.js";import"../../chunks/requestImageUtils.js";import"../../chunks/VertexColor.glsl.js";import"../../chunks/Program.js";import"../../chunks/FramebufferObject.js";import"../../chunks/renderState.js";import"../../chunks/glUtil.js";import"../../chunks/InterleavedLayout.js";import"../../chunks/mat4f32.js";import"../../chunks/vec3f32.js";import"../../chunks/stack.js";import"../../chunks/geometryUtils.js";import"../../chunks/ColorMaterial.js";import"../../chunks/Util.js";import"../../chunks/glUtil3D.js";import"../../chunks/Object3D.js";import"../../chunks/VertexArrayObject.js";import"../../chunks/sdfPrimitives.js";import"../../chunks/intersectorUtils.js";import"../../chunks/Intersector.js";import"../../chunks/PiUtils.glsl.js";import"../../chunks/GLMaterialTexture.js";import"../../chunks/VerticalOffset.glsl.js";import"../../chunks/RibbonLineMaterial.js";import"../../chunks/Texture.js";import{E as nt}from"../../chunks/ElevationQueryTileCache.js";import"../../chunks/CameraSpace.glsl.js";import"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../../chunks/Settings.js";import"../../views/interactive/snapping/SnappingOptions.js";import"../../views/draw/DrawAction.js";import{h as at,d as lt}from"../../chunks/elevationInfoUtils.js";import"../../chunks/AppendVertex.js";import"../../chunks/Keys.js";import"../../views/draw/MultipointDrawAction.js";import"../../chunks/InteractiveToolBase.js";import"../../chunks/DrawTool.js";import"../../chunks/VisualElement.js";import"../../chunks/LaserlineVisualElement.js";import"../../chunks/Object3DVisualElement.js";import"../../chunks/RightAngleQuadVisualElement.js";import"../../views/draw/PointDrawAction.js";import"../../views/draw/PolygonDrawAction.js";import"../../views/draw/PolylineDrawAction.js";import"../../views/draw/SegmentDrawAction.js";import"../../views/draw/Draw.js";import{d as pt}from"../../chunks/commonProperties4.js";import ut from"../Sketch/SketchViewModel.js";import{S as ct,D as ht,b as mt,c as dt,m as ft,d as jt,e as yt,f as vt,U as gt,g as _t,E as kt}from"../../chunks/ElevationProfileLine.js";import"../../chunks/elevationQuerySourceUtils.js";import bt from"./ElevationProfileLineGround.js";import"../../chunks/ElevationQuery.js";import wt from"./ElevationProfileLineInput.js";import Pt from"./ElevationProfileLineQuery.js";import"../../chunks/SetUtils.js";import St from"./ElevationProfileLineView.js";class Ut extends Error{constructor(t){super("profile could not be generated"),this.cause=t,this.type="ProfileGenerationError"}}async function It(t,e,s,i,o,r,n){let a,l,p;const u=t.spatialReference,c=u.isGeographic||u.isWebMercator,h=await import("../../geometry/geometryEngineAsync.js");g(n);let m=0;c||(m=await h.planarLength(t,"meters"),g(n));const d=1/F(i);if(c||m>=o.geodesicDistanceThreshold){await H([{source:u,dest:i},{source:u,dest:C.WGS84}],n);const c=function(t){if($(t.spatialReference))return t;return W(t,C.WGS84)}(t);a=Y([c],"meters")[0];const h=Mt(a,o);if(zt(t,a,h)>r)throw new Ut("too-complex");const m=Rt(c,e,s);({densifiedPath:l,distances:p}=function(t,e,s){const{hasZ:i}=t;return Lt(t,e,s,Tt,i?At:Vt)}(m,h,d)),l=W(l,i)}else{await H([{source:u,dest:i}],n),a=m;const c=Mt(a,o);if(zt(t,a,c)>r)throw new Ut("too-complex");const h=Rt(t,e,s);({densifiedPath:l,distances:p}=function(t,e,s){const{hasZ:i}=t;return Lt(t,e,s,Ot,i?Ft:Gt)}(h,c,d)),g(n),l=W(l,i)}return{densifiedPath:l,pathLength:a*d,distances:p}}function Mt(t,e){const s=t/e.densificationMaxSamples;return Math.max(e.samplingDistance,s)}function Rt(t,e,o){if(s(e))return Et(t);const r=t.spatialReference,n=e.mode,a=i(e.offset,0);let l=null;switch(o.type){case"2d":l=function({hasZ:t},e,s){switch(e){case"absolute-height":return t?([t,e,i])=>[t,e,i+s]:([t,e])=>[t,e,s];default:return null}}(t,n,a);break;case"3d":l=function({spatialReference:t,hasZ:e},s,o,{elevationProvider:r}){const n=(e,s,o,n)=>i(r.getElevation(e,s,o,t,n),0);switch(s){case"on-the-ground":return([t,e])=>[t,e,n(t,e,0,"ground")];case"absolute-height":return e?([t,e,s])=>[t,e,s+o]:([t,e])=>[t,e,o];case"relative-to-ground":return e?([t,e,s])=>[t,e,s+n(t,e,s,"ground")+o]:([t,e])=>[t,e,n(t,e,0,"ground")+o];case"relative-to-scene":return e?([t,e,s])=>[t,e,s+n(t,e,s,"scene")+o]:([t,e])=>[t,e,n(t,e,0,"scene")+o];default:return null}}(t,n,a,o)}return s(l)?Et(t):new T({hasZ:!0,hasM:!1,spatialReference:r,paths:Ct(t.paths,l)})}function Et(t){return t.hasZ?new T({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:Ct(t.paths,(([t,e])=>[t,e]))}):t}function Ct(t,e){const s=t.length,i=new Array(s);for(let o=0;o<s;++o){const s=t[o],r=s.length,n=new Array(s.length);i[o]=n;for(let t=0;t<r;++t)n[t]=e(s[t])}return i}function Dt(t){return xt(t)&&t.paths.length>0&&t.paths.every((t=>t.length>=2))}function xt(t){return e(t)&&"polyline"===t.type}function Lt(t,e,s,i,o){const{spatialReference:r,hasZ:n}=t,a={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:r,metersPerSR:F(r)},l=new Array(t.paths.length),p=new Array(t.paths.length);let u=0;for(let r=0;r<t.paths.length;++r){const n=t.paths[r],c=new Array,h=new Array;let m=0;for(let t=1;t<n.length;++t){const r=n[t-1],l=n[t],p=i(a,r,l);let d;for(d=m;d<p.distance;d+=e)c.push(o(p,d)),h.push((u+d)*s);m=d-p.distance,u+=p.distance,c.push(l),h.push(u*s)}l[r]=c,p[r]=h}return{densifiedPath:new T({spatialReference:r,hasZ:n,paths:l}),distances:p}}function Tt(t,e,s){return t.distance=0,K(t,e,s,t.spatialReference),t.from=e,t.to=s,t}function Ot(t,e,s){return t.from=e,t.to=s,t.distance=tt(s,e)*t.metersPerSR,t}function Vt({from:t,azimuth:e,spatialReference:s},i){return X([0,0],t,e,i,s)}function At({from:t,to:e,azimuth:s,distance:i,spatialReference:o},r){const n=r/i,a=[0,0,D(t[2],e[2],n)];return X(a,t,s,r,o),a}function Gt({from:t,to:e,distance:s},i){return et([0,0],t,e,i/s)}function Ft({from:t,to:e,distance:s},i){return x([0,0,0],t,e,i/s)}function Zt(t){return t.paths.reduce(((t,e)=>t+e.length),0)}function zt(t,e,s){return Zt(t)+Math.floor(e/s)+Math.max(0,t.paths.reduce((t=>1+t),0)-1)}function qt(t,i){return s(i)?t:e(t)?Math.min(t,i):i}function Nt(t,i){return s(i)?t:e(t)?Math.max(t,i):i}function Bt(t,s){return e(t)&&e(s)?t*s:null}class Qt{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return 0===this._sampleCount}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,e){this._start=t,this._sampleCount=1,this._totalElevation=e}insert(t){++this._sampleCount,this._totalElevation+=t}}function Ht(t,e,s=[]){if(t>=e)return s;s.push(t);if(e-t<2)return s;const i=e-1;s.push(i);const o=Wt(t+1,i);for(;;){const t=o.next();if(t.done)break;s.push(t.value)}return s}function*Wt(t,e){if(t>=e)return;const s=t+Math.floor((e-t)/2);yield s;const i=Wt(t,s),o=Wt(s+1,e);for(;;){const t=i.next(),e=o.next();if(t.done&&e.done)break;t.done||(yield t.value),e.done||(yield e.value)}}function*Jt(t,e){const{densificationResult:s}=t,i={...t,abortOptions:e,densificationResult:s},o=Ht(0,i.result.samples.length),r=o.slice(0,i.provider.numSamplesForPreview);yield Yt(i,r,!0);const n=y(o,i.provider.numSamplesPerChunk);for(const t of n)yield Yt(i,t,!1)}async function Yt({densificationResult:t,result:e,provider:s,queue:i,abortOptions:o,cache:r},n,a){const{densifiedPath:l,pathLength:p}=t,u=e.spatialReference,{samples:c}=e,h=new Array(n.length);for(let t=0;t<n.length;t++){const e=c[n[t]];h[t]=e.coordinate}try{return await i.push({geometry:new L({spatialReference:u,points:h,hasZ:l.hasZ}),provider:s,indices:n,preview:a,result:e,queryOptions:{...mt,minDemResolution:a?Math.round(p/s.numSamplesForPreview):Math.round(p/c.length),cache:r}},o),{...e}}catch(t){return b(t)?null:dt}}function Kt(t){return new rt({task:J.ELEVATION_PROFILE,concurrency:1,scheduler:t,process:async t=>{g(t.queryOptions);try{await async function({geometry:t,provider:i,indices:o,preview:r,result:n,queryOptions:a}){if(0===o.length)return;const l=(await async function(t,e,s){try{return await t.queryElevation(e,s)}catch(t){throw new Ut("elevation-query-error")}}(i,t,a)).geometry,{hasZ:p,points:u}=l,c=a.noDataValue,{samples:h}=n;for(let t=0;t<o.length;t++){const e=h[o[t]];if(e.isHole)continue;const s=p?u[t][2]:null;null===s||s===c?e.sampledZ=null:(n.hasZ=!0,e.sampledZ=s),e.sampled=!0}(function(t){const e=t.length-1;let s=0;for(let i=1;i<=e;i++){(t[i].sampled||i===e)&&(Xt(t,s,i),s=i)}})(h),n.progress=r?0:n.progress+o.length/h.length,n.statistics=function(t,i){const o=t.length;if(0===o)return null;const r=t[0],n=r.sampledZ;let a=n,l=n,p=0,u=0,c=null,h=null,m=e(n)?n:0,d=0,f=0,j=e(n)?1:0,y=0,v=0;const g=F(i),_=Z(i),k=ct/g,b=2*k,w=new Qt,P=new Qt,S=()=>{I(),w.copy(P),P.reset()},U=(t,e)=>{S();const s=w||t-w.start>b?t:w.start+k;P.restart(s,e)},I=()=>{if(w.isHole||P.isHole)return;const t=P.avgElevation-w.avgElevation,e=P.start-w.start,s=t*_,i=e*g,o=z(Math.atan2(s,i),"radians","degrees");o>0?(d+=o,c=Nt(c,o),y++):o<0&&(f-=o,h=Nt(h,-o),v++)};e(r.sampledZ)&&U(r.distance,r.sampledZ);for(let i=1;i<o;++i){const o=t[i-1],r=t[i],n=r.sampledZ;if(s(n)){P.isHole||S();continue}j++,m+=n,a=qt(a,n),l=Nt(l,n),P.isHole||r.distance-P.start>=k?U(r.distance,n):P.insert(n);const c=o.sampledZ;if(e(c)){const t=n-c;t>0?p+=t:t<0&&(u-=t)}}return S(),0===j?null:{maxDistance:t[o-1].distance,minElevation:a,maxElevation:l,avgElevation:0===j?null:m/j,elevationGain:p,elevationLoss:u,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:0===y?null:d/y,avgNegativeSlope:0===v?null:f/v}}(n.samples,n.spatialReference)}(t)}catch(t){_(t)}}})}function Xt(t,e,i){if(i-e==1)return;const o=t[e],r=o.sampledZ,n=t[i],a=n.sampledZ;if(s(r)||s(a)){for(let s=e+1;s<i;s++)t[s].sampledZ=null;return}const l=o.distance,p=n.distance-l;for(let s=e+1;s<i;s++){const e=t[s],i=(e.distance-l)/p;e.sampledZ=D(r,a,i)}}function $t({densifiedPath:t,distances:e}){const s=t.spatialReference,i=t.paths,o=i.length,r=2*(o-1),n=i.reduce(((t,e)=>t+e.length),0)+r,a=new Array(n);let l=0,p=null,u=0;const c=(t,e,s,i)=>{a[l++]=ee(t,s),a[l++]=ee(e,i)};for(let t=0;t<o;t++){const s=i[t],o=e[t];for(let t=0;t<s.length;t++){const e=s[t],i=o[t];p&&0===t&&c(p,e,u,i),a[l++]=te(e,i),p=e,u=i}}return{progress:0,samples:a,hasZ:!1,statistics:null,spatialReference:s}}function te(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!1,isHole:!1}}function ee(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!0,isHole:!0}}let se=class extends m{constructor(t){super(t),this._handles=new G,this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=ft(((t,e,s)=>({stationary:t,visibleProfiles:e,generationParameters:s}))),this._getGenerationParametersMemoized=ft(((t,e,i,o,r,n)=>xt(e)&&Dt(e)&&!s(o)?{view:t,geometry:e,elevationInfo:i,options:n,queue:o,cache:r}:null)),this._getOptionsMemoized=ft(((t,e,s)=>({geodesicDistanceThreshold:t,samplingDistance:i(e,jt),densificationMaxSamples:Math.round(yt/s),maxTotalSamples:vt}))),this._updateThrottled=ot((t=>S(this._update(t))),gt)}initialize(){const t=this.viewModel;this._handles.add([d((()=>t.profiles.toArray()),(t=>{this._abortUpdate(),this._paramsPerProfile.clear(),this._handles.remove("line-change"),this._handles.add(t.map((t=>u([t.attach(this.viewModel),t.on("change",(()=>{this._invalidateProfile(t)}))]))),"line-change")})),this._updateThrottled,d((()=>this._updateParameters),this._updateThrottled)])}destroy(){this._handles.destroy(),this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:t}=this,s=t.view;return this._getUpdateParametersMemoized(!e(s)||s.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:t,input:e,queue:i,tileCache:o}=this.viewModel;if(s(t))return null;const r=n(e,(t=>t.geometry)),a=n(e,(t=>at(t)?null:lt(t)));return this._getGenerationParametersMemoized(t,r,a,i,o,this._options)}get _options(){const t=this.viewModel,e=t.visibleProfiles.length;return this._getOptionsMemoized(t.geodesicDistanceThreshold,t.minDemResolution,e)}async _update({stationary:t,visibleProfiles:e,generationParameters:i}){this._abortUpdate(),t&&(s(i)?this._clearResults():this._updateTask=w((async t=>{this.viewModel.error=null;const n=e.filter((t=>!this._isProfileValid(t,i))),a=async function*(t,e){var i;const{view:n,geometry:a,elevationInfo:l,providers:p,options:u}=t;if(s(a)||!Dt(a))throw new Ut("invalid-geometry");const c=n.spatialReference,h=p.length;if(0===h)return o;const m=Math.round(u.maxTotalSamples/h);if(Zt(a)>m)throw new Ut("too-complex");const d=await It(a,l,n,c,u,m,e);let f=0;const j=new Array(h),y=new Array(h);for(let s=0;s<h;s++){const i=$t(d);j[s]=i,f+=i.samples.length;const o={...t,provider:p[s],result:i,densificationResult:d};y[s]=Jt(o,e)[Symbol.iterator]()}if(f>u.maxTotalSamples)throw new Ut("too-complex");const v=await Promise.all(y.map((t=>{const e=t.next();return!0===e.done?Promise.resolve(null):e.value})));g(e);for(let t=0;t<h;t++)j[t]=v[t];yield j,await k(null!=(i=t.delayAfterPreview)?i:ht,null,e.signal);const _=[];try{let t;do{t=!1;for(let e=0;e<h;e++){const s=y[e].next();!1===s.done&&(_.push({resultPromise:s.value,index:e}),t=!0)}}while(t)}finally{y.forEach((t=>null==t.return?void 0:t.return()))}for(const{resultPromise:t,index:s}of _)j[s]=await t,g(e),yield j;r(j,(t=>{t.progress=1})),yield j}({...i,providers:n},{signal:t});try{for await(const e of a){g(t),this._clearInvalidResults(i);for(let t=0;t<n.length;t++)n[t].result=e[t]}for(const t of n)this._paramsPerProfile.set(t,i)}catch(t){P(t),this._abortUpdate(),this.viewModel.error=t,n.forEach((t=>{t.result=null}))}})))}_abortUpdate(){this._updateTask=a(this._updateTask)}_isProfileValid(t,e){return this._paramsPerProfile.has(t)&&this._paramsPerProfile.get(t)===e}_invalidateProfile(t){this._paramsPerProfile.delete(t),this._updateThrottled(this._updateParameters)}_clearInvalidResults(t){for(const e of this.viewModel.profiles.items)this._isProfileValid(e,t)||(e.result=null,this._paramsPerProfile.delete(e))}_clearResults(){for(const t of this.viewModel.profiles.items)t.result=null,this._paramsPerProfile.delete(t)}};t([h({nonNullable:!0})],se.prototype,"viewModel",void 0),t([h()],se.prototype,"_updateParameters",null),t([h()],se.prototype,"_generationParameters",null),t([h()],se.prototype,"_options",null),se=t([I("esri.widgets.ElevationProfile.ElevationProfileController")],se);const ie={base:_t,key:"type",typeMap:{ground:bt,input:wt,query:Pt,view:St},errorContext:"elevation-profile-line"},oe=M.ofType(ie);var re;!function(t){t.Ready="ready",t.Creating="creating",t.Reshaping="reshaping",t.ReshapingDisabled="rehsaping-disabled",t.Selecting="selecting",t.Selected="selected"}(re||(re={}));let ne=class extends m{constructor(t){super(t),this.state=re.Ready,this._handles=new G,this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this._handles.add(d((()=>this.tool.viewModel.view),(t=>{e(t)?this._initialize(t):this._destroy()})),"view")}destroy(){this._destroy(),this._handles=l(this._handles)}get canStopCreating(){const t=n(this.tool.viewModel.input,(t=>t.geometry)),e=this._shouldRemoveLastPoint?3:2;return xt(t)&&t.paths.length>0&&t.paths[0].length>=e}get _input(){return this.tool.viewModel.input}set _input(t){this.tool.viewModel.input=t}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([i(this._creationToolPromise,Promise.resolve()),i(this._updateToolPromise,Promise.resolve())])}}start(t={mode:"sketch"}){if(!this.tool.editable)return;const e=this._view;if(!s(e)&&e.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),s(this._previousInputInfo)&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),t.mode){case"sketch":this._set("state",re.Creating),this._startCreationInteraction();break;case"select":this._set("state",re.Selecting),this._startSelectionInteraction()}else this._pendingStartOptions=t}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state",re.Ready),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(t){return e(t)&&this._sketchedGraphics.has(t)}_initialize(t){this._destroy();const s={mode:"3d"===t.type?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new st({listMode:"hide",internal:!0,elevationInfo:s});const i="2d"===t.type?new O({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new V({color:[0,0,0,0]});this._sketchVM=new ut({layer:this._graphicsLayer,view:t,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMidpoints:!0,enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,enableMoveGraphic:!1,tool:"reshape"},polylineSymbol:i,updatePolylineSymbol:i,activeLineSymbol:i,activeFillSymbol:i}),this._handles.add([f((()=>t.ready),(()=>n(this._pendingStartOptions,(t=>this.start(t))))),d((()=>[this._input,this._visibleAndEditable]),(()=>this._update())),d((()=>({map:t.map,graphicsLayer:this._graphicsLayer})),(({map:t,graphicsLayer:s})=>{e(t)&&e(s)&&t.add(s),this._update()}))],"main")}_destroy(){this._handles.remove("main"),this._sketchVM=l(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const t=n(this._view,(t=>t.map)),s=this._graphicsLayer;e(t)&&e(s)&&t.remove(s),this._graphicsLayer=l(this._graphicsLayer)}_startCreationInteraction(){this._stopInteractionAndUpdate();const t=this._view,e=this._sketchVM;if(s(t)||s(e))return;this._shouldRemoveLastPoint=!1;const i=e.on("create",(t=>{const e=t.graphic;switch(t.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(e),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(e),"cursor-update"===t.toolEventInfo.type&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(e)}}));this._handles.remove("interaction"),this._handles.add(c((()=>{i.remove(),e.cancel(),this._creationToolPromise=null;const t=this._input;!s(t)&&this.canStopCreating?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new A({geometry:ae(t.geometry)})):this._input=null})),"interaction"),this._creationToolPromise=S(e.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const t=this._view,e=this._sketchVM;if(s(t)||s(e))return;const i=e.on("update",(t=>{const e=t.graphics[0];switch(t.state){case"complete":this._setSketchedGraphic(e),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(e)}}));this._handles.remove("interaction"),this._handles.add(c((()=>{i.remove(),e.cancel(),this._updateToolPromise=null})),"interaction"),n(this._input,(t=>{t.visible=!0,this._updateToolPromise=S(e.update(t,{tool:"reshape"}))}))}_startSelectionInteraction(){this._stopInteraction();const t=this._view;if(s(t))return;const i=t.cursor,o=c((()=>t.cursor=i));t.cursor="crosshair",t.popup.close();let r=null;const n=c((()=>a(r))),l=t.on("immediate-click",(s=>{s.preventDefault(),s.stopPropagation(),a(r),r=w((async i=>{const{results:o}=await t.hitTest(s);g(i);const r=o.map((t=>t.graphic)).find((t=>e(t.geometry)&&"polyline"===t.geometry.type));r&&(this._input=r,this._clearPreviousInput(),this._stopInteractionAndUpdate())}))})),p=t.on("key-down",(t=>{"Escape"===t.key&&this.cancel()}));this._handles.remove("interaction"),this._handles.add([l,p,n,o],"interaction"),t.ready&&it(t)&&t.focus()}_stopInteraction(){this._handles.remove("interaction")}_stopInteractionAndUpdate(){this._handles.has("interaction")&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state",re.Ready),this._update()}_update(){if(this._updateDisabled)return;const t=this.state;if(t!==re.Selecting){if(this._visibleAndEditable){if(t===re.Creating||t===re.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return s(this._input)?re.Ready:this.isSketchedGraphic(this._input)?this.state===re.Creating?re.Creating:this._visibleAndEditable?re.Reshaping:re.ReshapingDisabled:re.Selected}_updateVisuals(){switch(this.state){case re.Creating:break;case re.Reshaping:this._startReshapeInteraction();break;case re.ReshapingDisabled:{this._stopInteractionAndUpdate();const t=this._input;e(t)&&this.isSketchedGraphic(t)&&(t.visible=!1);break}case re.Ready:case re.Selected:this._stopInteractionAndUpdate();break;case re.Selecting:}this._updateSketchedGraphic()}_storePreviousInput(t){this._previousInputInfo={graphic:t}}_restorePreviousInput(){const t=this._previousInputInfo;s(t)||(this._clearPreviousInput(),this._input=t.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const t=this._graphicsLayer;if(s(t))return;const e=t.graphics,i=this._input;if(s(i)||!this.isSketchedGraphic(i))return void e.removeAll();if(-1===e.indexOf(i))e.removeAll(),e.add(i);else if(1!==e.length){const t=e.filter((t=>t!==i));e.removeMany(t)}}_setSketchedGraphic(t){e(t)&&this._sketchedGraphics.add(t),this._input=t,this._updateSketchedGraphic()}};function ae(t){if(xt(t)){const e=t.clone();return e.paths=[e.paths[0].slice(0,-1)],e}return t}t([h({nonNullable:!0})],ne.prototype,"state",void 0),t([h({nonNullable:!0})],ne.prototype,"tool",void 0),t([h()],ne.prototype,"canStopCreating",null),t([h()],ne.prototype,"_graphicsLayer",void 0),t([h()],ne.prototype,"_sketchVM",void 0),t([h()],ne.prototype,"_input",null),t([h()],ne.prototype,"_visibleAndEditable",null),t([h()],ne.prototype,"_view",null),t([h()],ne.prototype,"_shouldRemoveLastPoint",void 0),ne=t([I("esri.widgets.ElevationProfile.ElevationProfileInteraction")],ne);let le=class extends m{constructor(t){super(t),this._implementation=null,this._loadingTask=null,this._handles=new G}initialize(){this._handles.add(j((()=>{this.tool.visible?this._show():this._hide()})))}destroy(){this._handles=l(this._handles),this._hide()}_show(){e(this._loadingTask)&&this._loadingTask.abort();const t=this.tool,i=t.viewModel.view;if(s(i))return this._hide();this._loadingTask=w((async e=>{if("2d"===i.type){const s=import("../../chunks/ElevationProfileView2D.js"),o=(await U(s,e)).ElevationProfileView2D;this._implementation=new o(i,t)}else if("3d"===i.type){const s=import("../../chunks/ElevationProfileView3D.js"),o=(await U(s,e)).ElevationProfileView3D;this._implementation=new o(i,t)}}))}_hide(){e(this._loadingTask)&&(this._loadingTask.abort(),this._loadingTask=null),this._implementation=l(this._implementation)}};t([h()],le.prototype,"tool",void 0),le=t([I("esri.widgets.ElevationProfile.support.ElevationProfileView")],le);let pe=class extends m{constructor(t){super(t),this.editable=!0,this.visible=!0}initialize(){this.view=new le({tool:this}),this.interaction=new ne({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){var t;switch(null==(t=this.interaction)?void 0:t.state){case re.Ready:return kt.Ready;case re.Creating:return kt.Creating;case re.Selecting:return kt.Selecting;case re.Selected:return kt.Selected;case re.Reshaping:case re.ReshapingDisabled:return kt.Created}}};t([h({nonNullable:!0})],pe.prototype,"viewModel",void 0),t([h()],pe.prototype,"view",void 0),t([h()],pe.prototype,"interaction",void 0),t([h()],pe.prototype,"editable",void 0),t([h()],pe.prototype,"visible",void 0),pe=t([I("esri.widgets.ElevationProfile.ElevationProfileTool")],pe);const ue=p.getLogger("esri.widgets.ElevationProfile.ElevationProfileViewModel");let ce=class extends m{constructor(t){super(t),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=ft(((t,e)=>({distance:t,elevation:e}))),this.geodesicDistanceThreshold=1e5,this.hoveredChartPosition=null,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._handles=new G,this._defaultProfileLineGround=new bt,this._userUnitOptions=null,this._userUnit=null,null!=t&&t.profiles||(this.profiles=new M([this._defaultProfileLineGround]))}initialize(){this._handles.add(d((()=>this.view),(t=>{var e;s(t)?ue.warnOnce("no view. Widget will be disabled until a view is provided."):this.queue=Kt("3d"===t.type?null==(e=t.resourceController)?void 0:e.scheduler:void 0)}))),this.tool=new pe({viewModel:this}),this._controller=new se({viewModel:this})}destroy(){this._handles=l(this._handles),this._defaultProfileLineGround=l(this._defaultProfileLineGround),this._controller=l(this._controller),this._currentTileCache=l(this._currentTileCache),this.tool=l(this.tool),this.queue=l(this.queue)}set profiles(t){const e=this._get("profiles"),s=null!=t?t:new M;this._set("profiles",R(s,e))}get state(){const t=this.view;return e(t)&&t.ready?this.tool.state:kt.Disabled}get progress(){let t=0,e=0;for(const s of this.visibleProfiles)t++,e+=s.progress;return t>0?e/t:0}set unitOptions(t){this._userUnitOptions=t,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(t){this._userUnit=t?this._findSelectableUnit(t,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const t=function(t){let e=null,o=null,r=null;for(const i of t){if(s(i))continue;const{statistics:t,spatialReference:n}=i;if(s(t))continue;const a=F(n);e=Nt(e,Bt(t.maxDistance,a));const l=Z(n);r=qt(r,Bt(t.minElevation,l)),o=Nt(o,Bt(t.maxElevation,l))}return{minDistance:0,maxDistance:i(e,0),minElevation:i(r,0),maxElevation:i(o,0)}}(this.visibleProfiles.map((t=>t.result))),e=q(t.maxDistance,"meters",this.unit),o=N(t.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(e,o)}get hasVertices(){const t=n(this.input,(t=>t.geometry));return xt(t)&&t.paths.reduce(((t,e)=>t+e.length),0)>0}get hoveredPoints(){return!s(this.input)&&this.visible&&this.tool.editable?this.visibleProfiles.map((t=>{const s=t.hoveredPoint;return e(s)?{hoveredPoint:s,color:t.color}:null})).filter(e):[]}get statistics(){return function(t){const s=t.filter(e),i=s.length;if(0===i)return null;const o=s[0];if(1===i)return o;let r=o.maxDistance,n=o.minElevation,a=o.maxElevation,l=o.maxPositiveSlope,p=o.maxNegativeSlope;for(let t=1;t<s.length;++t){const e=s[t];r=Nt(r,e.maxDistance),n=qt(n,e.minElevation),a=Nt(a,e.maxElevation),l=Nt(l,e.maxPositiveSlope),p=Nt(p,e.maxNegativeSlope)}return{maxDistance:r,minElevation:n,maxElevation:a,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:p,avgPositiveSlope:null,avgNegativeSlope:null}}(this.visibleProfiles.map((t=>t.statistics)))}get chartData(){if(s(this.input))return null;const{effectiveUnits:t,progress:e,statistics:i,visibleProfiles:o}=this,r=o.filter((t=>t.hasZ)).map((t=>({id:t.id,type:t.type,title:t.title,color:t.color,samples:t.samples,progress:t.progress,chartFillEnabled:t.chartFillEnabled,chartStrokeWidth:t.chartStrokeWidth,chartStrokeOffsetY:t.chartStrokeOffsetY})));return 0===r.length?null:{lines:r,effectiveUnits:t,statistics:i,fullyRefined:1===e,dynamicElevationRange:o.some((t=>"view"===t.type))}}get visibleProfiles(){return this.profiles.toArray().filter((t=>t.available&&t.visible))}get minDemResolutions(){const t=[];for(const{minDemResolution:s}of this.visibleProfiles)e(s)&&t.push(s);return t}get minDemResolution(){return v(this.minDemResolutions)}get errorState(){if(!Dt(n(this.input,(t=>t.geometry))))return"no-valid-input";if(e(this.error)){if("ProfileGenerationError"===this.error.type)switch(this.error.cause){case"too-complex":return"too-complex";case"invalid-geometry":return"invalid-geometry";case"invalid-elevation-info":return"invalid-elevation-info";case"elevation-query-error":return"no-valid-input"}return"unknown-error"}return 0===this.visibleProfiles.length?"no-visible-profiles":s(this.chartData)&&1===this.progress?"refined-but-no-chart-data":"none"}get tileCache(){this._currentTileCache=l(this._currentTileCache);const t=this.view;if(e(t)&&"3d"===(null==t?void 0:t.type)){var i;const s=null==(i=t.basemapTerrain)?void 0:i.elevationQueryCache;if(e(s))return s}return s(this._currentTileCache)&&(this._currentTileCache=new nt(new Q(20971520))),this._currentTileCache}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}start(t){this.tool.interaction.start(t)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(t,s){const i=this.unitOptions;return e(t)&&-1!==i.indexOf(t)?t:s?this._findSelectableUnit(s):i[0]}_filteredOrAllUnits(t){const s=(e(t)?t:[]).filter((t=>-1!==B.indexOf(t)));return 0===s.length?B.slice():s}};t([h()],ce.prototype,"view",void 0),t([h({type:A})],ce.prototype,"input",void 0),t([h({type:oe,nonNullable:!0})],ce.prototype,"profiles",null),t([h({readOnly:!0})],ce.prototype,"state",null),t([h({readOnly:!0})],ce.prototype,"progress",null),t([h()],ce.prototype,"unitOptions",null),t([h()],ce.prototype,"unit",null),t([h({readOnly:!0})],ce.prototype,"effectiveUnits",null),t([h({type:Number})],ce.prototype,"geodesicDistanceThreshold",void 0),t([h()],ce.prototype,"hoveredChartPosition",void 0),t([h({readOnly:!0})],ce.prototype,"hoveredPoints",null),t([h({readOnly:!0})],ce.prototype,"statistics",null),t([h()],ce.prototype,"chartData",null),t([h()],ce.prototype,"visibleProfiles",null),t([h()],ce.prototype,"minDemResolutions",null),t([h({readOnly:!0})],ce.prototype,"minDemResolution",null),t([h({readOnly:!0})],ce.prototype,"errorState",null),t([h(pt)],ce.prototype,"defaultUnit",void 0),t([h()],ce.prototype,"queue",void 0),t([h()],ce.prototype,"tileCache",null),t([h()],ce.prototype,"tool",void 0),t([E("tool.visible")],ce.prototype,"visible",void 0),t([h()],ce.prototype,"error",void 0),t([h()],ce.prototype,"inputIsSketched",null),t([h()],ce.prototype,"_defaultProfileLineGround",void 0),t([h()],ce.prototype,"_userUnitOptions",void 0),t([h()],ce.prototype,"_controller",void 0),t([h()],ce.prototype,"_userUnit",void 0),ce=t([I("esri.widgets.ElevationProfile.ElevationProfileViewModel")],ce);var he=ce;export default he;
