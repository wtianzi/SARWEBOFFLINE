/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as t}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../core/urlUtils.js";import{aliasOf as i}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../request.js";import"../chunks/assets.js";import"../core/Handles.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import"../TimeInterval.js";import"../core/watchUtils.js";import"../chunks/Widgets.js";import"../core/HandleOwner.js";import"../chunks/_commonjsHelpers.js";import"../chunks/domUtils.js";import{i as l}from"../chunks/widgetUtils.js";import"../chunks/projector.js";import{m as o}from"../chunks/messageBundle.js";import{j as r}from"../chunks/index.js";import n from"./Widget.js";import"../chunks/GoTo.js";import{R as a}from"../chunks/ResizeObserver.js";import c from"./FloorFilter/FloorFilterViewModel.js";const h="esri-widget",d="esri-widget--button",u="esri-widget--button-active",v="esri-button--disabled",m="esri-icon",p="esri-interactive",f="esri-widget__content--empty",M="esri-floor-filter",g="esri-floor-filter__layout--",w="esri-floor-filter__position--",_="esri-floor-filter__button-container",b="esri-floor-filter__button-info",y="esri-floor-filter__button-label",k="esri-floor-filter__browse-button",j="esri-floor-filter__close-levels-button",F="esri-floor-filter__zoom-button",T="esri-floor-filter__zoom-button--levels",C="esri-floor-filter__minimize-toggle-button",S="esri-floor-filter__levels-container",N="esri-floor-filter__level-button",B="esri-floor-filter__separator",O="esri-floor-filter__filter-menu",L="esri-floor-filter__filter-menu-header",z="esri-floor-filter__filter-menu-header-text-group",x="esri-floor-filter__filter-menu-header-text",I="esri-floor-filter__filter-menu-header-subtext",E="esri-floor-filter__filter-menu-header-back",P="esri-floor-filter__filter-menu-search",$="esri-floor-filter__filter-menu-search-input",W="esri-floor-filter__filter-menu-items",U="esri-floor-filter__filter-menu-item-name",A="esri-floor-filter__filter-menu-item-name--selected",R="esri-floor-filter__filter-menu-site",D="esri-floor-filter__filter-menu-facility",H="esri-floor-filter__selected-item-circle",Z="esri-icon-urban-model",q="esri-icon-zoom-to-object",G="esri-icon-collapse",J="esri-icon-expand",V="esri-icon-close",K="esri-icon-search",Q="esri-icon-right",X="esri-icon-left";let Y=class extends n{constructor(e,s){super(e,s),this._baseNode=null,this.enabled=null,this.longNames=null,this.minimized=null,this.pinnedLevels=null,this.site=null,this.facility=null,this.level=null,this.view=null,this.viewModel=new c,this.messages=null,this.messagesCommon=null,this.goToOverride=null,this._resizeObserver=new a((()=>this.scheduleRender()))}destroy(){this._resizeObserver.disconnect()}updateWebDocument(){}render(){var e;const{longNames:s}=this,t=s&&this.viewModel.isNormalMode?"expanded":"collapsed",i=this.renderButtons(),o=this.renderFilterMenu(),n=r("div",{class:this.classes(B)}),a=this._getComponentPosition(),c=this._getPosition(a),d="top-right"===a||"bottom-right"===a,u="top-left"===a||"bottom-left"===a,v=l(),m=v&&u||!v&&d?o:i,p=v&&u||!v&&d?i:o;return r("div",{afterCreate:this._afterBaseNodeCreate,key:"floor-filter-menu",class:this.classes(M,h,`${g}${t}`,`${w}${c}`)},m,(null==(e=this.viewModel)?void 0:e.filterMenuOpen)&&n,p)}renderButtons(){const e=this._getComponentPosition(),s=[];return"top"===this._getPosition(e)?(s.push(this.renderBrowseButton()),s.push(this.renderLevelButtons()),s.push(this.renderCloseLevelsButton()),s.push(this.renderZoomButton()),s.push(this.renderCollapseToggleButton())):(s.push(this.renderCollapseToggleButton()),s.push(this.renderZoomButton()),s.push(this.renderCloseLevelsButton()),s.push(this.renderLevelButtons()),s.push(this.renderBrowseButton())),r("div",{key:"button-container",class:this.classes(h,_)},s)}renderBrowseButton(){var e;const{longNames:s,messages:t}=this;return r("button",{key:"browse-button",title:t.buttons.browse,bind:this,class:this.classes(h,d,p,("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&v,k,(null==(e=this.viewModel)?void 0:e.filterMenuOpen)&&u),"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":t.buttons.browse,onclick:this._toggleFilterMenu},r("div",{class:this.classes(b)},r("span",{class:this.classes(m,Z)}),r("span",{class:this.classes(y)},s&&this.viewModel.isNormalMode&&t.buttons.browse)))}renderLevelButtons(){var e,s,t,i;if(null==(e=this.viewModel)||null==(s=e.filterFeatures)||null==(t=s.levels)||!t.levelsInfo||!this.facility)return null;const{facility:l,messagesCommon:o}=this,n=(null==(i=this.viewModel)?void 0:i.getFacilityLevels(l)).map((e=>this.renderLevelButton(e)));if(!n.length)return null;if(this._isWebScene(this.view.map)&&(null==n?void 0:n.length)>1){const e={id:`all--${l}`,facilityId:l,shortName:o.all,longName:o.all,levelNumber:null,verticalOrder:null},s=this.renderLevelButton(e);n.push(s)}return r("ul",{key:"levels-button-container",class:this.classes(S)},n)}renderLevelButton(e){const{longNames:s}=this,{shortName:t,longName:i,id:l}=e,o=`levels--${l}`,n=this.level===l,a=s&&this.viewModel.isNormalMode?i:t;return this.viewModel.isNormalMode||n||this.viewModel.levelsExpanded?r("li",{key:o},r("button",{"data-id":l,bind:this,class:this.classes(d,n?u:null,p,N),onclick:this._levelSelected},a)):null}renderCloseLevelsButton(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const{messagesCommon:e}=this;return r("button",{key:"close-levels-button",title:e.close,bind:this,class:this.classes(h,d,p,j),"aria-label":e.close,onclick:this._closeLevels},r("div",{class:this.classes(b)},r("span",{class:this.classes(m,V)})))}renderZoomButton(){var e,s,t,i,l;const{longNames:o,messages:n,facility:a,site:c}=this,u=null==(e=this.viewModel)?void 0:e.filterMenuType,f=null==(s=this.viewModel)?void 0:s.filterMenuOpen,M=null==(t=this.viewModel)?void 0:t.getSite(c),g=null==(i=this.viewModel)?void 0:i.getFacility(a),w="site"===u&&f?!M:!g;return r("button",{key:"zoom-button",title:n.buttons.zoomTo,bind:this,class:this.classes(h,d,w&&v,p,(null==(l=this.viewModel)?void 0:l.getFacilityLevels(a).length)>0?T:F),"aria-label":n.buttons.zoomTo,onclick:this._zoomToClicked},r("div",{class:this.classes(b)},r("span",{class:this.classes(m,q)}),r("span",{class:this.classes(y)},o&&this.viewModel.isNormalMode&&n.buttons.zoomTo)))}renderCollapseToggleButton(){const{longNames:e,messagesCommon:s}=this,t=e?G:J,i=this.classes(m,t),l=e?s.collapse:s.expand;return r("button",{key:"minimize-toggle-button",title:l,bind:this,class:this.classes(h,d,p,C),"aria-label":l,onclick:this._toggleCollapsed},r("div",{class:this.classes(b)},r("span",{class:i}),r("span",{class:this.classes(y)},e&&this.viewModel.isNormalMode&&s.collapse)))}renderFilterMenu(){var e,s,t;return null!=(e=this.viewModel)&&e.filterMenuOpen?"site"===(null==(s=this.viewModel)?void 0:s.filterMenuType)?this.renderSiteFilterMenu():"facility"===(null==(t=this.viewModel)?void 0:t.filterMenuType)?this.renderFacilityFilterMenu():null:null}renderSiteFilterMenu(){var e,s;const{messages:t,messagesCommon:i}=this,l=this.site?null==(e=this.viewModel)||null==(s=e.getSite(this.site))?void 0:s.name:t.selector.selectSite,o=r("div",{key:"filter-menu-site-header",class:this.classes(`${L}`)},r("div",{class:this.classes(z)},r("h2",{class:this.classes(x)},l)),r("button",{bind:this,title:i.close,class:this.classes(m,V),onclick:this._closeClicked})),n=this.renderSearchInput(),a=this.renderSiteItems();return r("div",{key:"filter-menu-site",class:this.classes(O)},o,n,a)}renderFacilityFilterMenu(){var e,s,t,i;const{messages:o,messagesCommon:n,site:a}=this,c=null==(e=this.viewModel)||null==(s=e.getSite(a))?void 0:s.name,h=this.facility&&(null==(t=this.viewModel)||null==(i=t.getFacility(this.facility))?void 0:i.name)||o.selector.selectFacility,d=this.viewModel.hasMultipleSites?r("button",{bind:this,title:n.back,class:this.classes(E),onclick:this._backClicked},r("span",{class:this.classes(l()?Q:X)})):null,u=this.viewModel.hasMultipleSites?r("h3",{class:this.classes(I)},c):null,v=r("div",{key:"filter-menu-site-header",class:this.classes(L)},d,r("div",{class:this.classes(z)},r("h2",{class:this.classes(x)},h),u),r("button",{bind:this,title:n.close,class:this.classes(m,V),onclick:this._closeClicked})),p=this.renderSearchInput(),f=this.renderFacilityItems();return r("div",{key:"filter-menu-facility",class:this.classes(O)},v,p,f)}renderSearchInput(){const{messagesCommon:e}=this;return r("div",{key:"filter-menu-search",class:this.classes(P)},r("span",{class:this.classes(m,K)}),r("input",{bind:this,key:"filter-menu-search__input",class:this.classes($),placeholder:e.search,oninput:this._onSearchChange,onpaste:this._onSearchChange}))}renderBlueCircle(){return r("span",{key:"floor-filter__selected-item-circle",class:this.classes(H)})}renderSiteItems(){var e,s,t,i;if(null==(e=this.viewModel)||null==(s=e.filterFeatures)||null==(t=s.sites)||!t.sitesInfo)return null;const{messages:l}=this,o=this.viewModel.filterFeatures.sites.sitesInfo,n=this.viewModel.filterSites(o).map((e=>this.renderSiteItem(e))),a=0===n.length&&(null==(i=this.viewModel)?void 0:i.searchTerm)&&r("div",{class:this.classes(f)},l.noResults);return r("ul",{key:"filter-menu-items--sites",class:this.classes(W)},n,a)}renderSiteItem(e){const{name:s,id:t}=e,i=`filter-menu-site--${t}`,o=this.site===t;return r("li",{key:i},r("button",{"data-id":t,bind:this,class:this.classes(R),onclick:this._siteSelected},o&&this.renderBlueCircle(),r("span",{class:this.classes(o?A:U)},s),r("span",{class:this.classes(l()?X:Q)})))}renderFacilityItems(){var e,s,t,i;if(null==(e=this.viewModel)||null==(s=e.filterFeatures)||null==(t=s.facilities)||!t.facilitiesInfo)return null;const{messages:l}=this,o=this.viewModel.filterFeatures.facilities.facilitiesInfo,n=this.viewModel.filterFacilities(o).map((e=>this.renderFacilityItem(e))),a=0===n.length&&(null==(i=this.viewModel)?void 0:i.searchTerm)&&r("div",{class:this.classes(f)},l.noResults);return r("ul",{key:"filter-menu-items--facilities",class:this.classes(W)},n,a)}renderFacilityItem(e){const{name:s,id:t}=e,i=`filter-menu-facility--${t}`,l=this.facility===t;return r("li",{key:i},r("button",{"data-id":t,bind:this,class:this.classes(D),onclick:this._facilitySelected},l&&this.renderBlueCircle(),r("span",{class:this.classes(l?A:U)},s)))}_afterBaseNodeCreate(e){var s,t;this._baseNode&&(null==(t=this._resizeObserver)||t.unobserve(this._baseNode));this._baseNode=e,null==(s=this._resizeObserver)||s.observe(this._baseNode)}_toggleCollapsed(){this.longNames=!this.longNames}_toggleFilterMenu(){var e,s;const t=null!=(e=null==(s=this.viewModel)?void 0:s.filterMenuOpen)&&e;this.viewModel.filterMenuOpen=!t}_setFilterMenuType(e){this.viewModel.filterMenuType=e}_zoomToClicked(){var e,s;if(this.site&&"site"===(null==(e=this.viewModel)?void 0:e.filterMenuType)&&null!=(s=this.viewModel)&&s.filterMenuOpen){var t;const e=null==(t=this.viewModel)?void 0:t.getSite(this.site);this.viewModel.goTo(e)}else if(this.facility){var i;const e=null==(i=this.viewModel)?void 0:i.getFacility(this.facility);this.viewModel.goTo(e)}else if(this.site){var l;const e=null==(l=this.viewModel)?void 0:l.getSite(this.site);this.viewModel.goTo(e)}}_onSearchChange(e){var s;const t=e.target;""===t.value?this.viewModel.searchTerm=null:t.value&&(null==(s=this.viewModel)?void 0:s.searchTerm)!==t.value&&(this.viewModel.searchTerm=t.value.toLowerCase().trim())}_closeClicked(){this.viewModel.searchTerm=null,this.viewModel.filterMenuOpen=!1}_backClicked(){this.viewModel.filterMenuType="site",this.viewModel.searchTerm=null}_siteSelected(e){const s=e.currentTarget.getAttribute("data-id"),t=this.viewModel.getSite(s);let i=!1;this.site!==s&&(this.facility=void 0,this.level=void 0,i=!0,this.viewModel.levelsExpanded=!1),this.site=s,this.viewModel.searchTerm=null,this._setFilterMenuType("facility"),this.viewModel.goTo(t),i&&this.viewModel.setFloors(null)}_facilitySelected(e){const s=e.currentTarget.getAttribute("data-id"),t=this.viewModel.getFacility(s);let i=!1;if(this.facility!==s){if("base-floors"===this.viewModel.filterMode){var l;const e=null==(l=this.viewModel)?void 0:l.getBaseLevel(t);this.level=e?e.id:void 0}else this.level=void 0;i=!0,this.viewModel.levelsExpanded=!1}if(this.facility=s,this.viewModel.goTo(t),i){const e=this.viewModel.getLevel(this.level);this.viewModel.setFloors(e)}if(!this.viewModel.isNormalMode){const e=this.viewModel.getFacilityLevels(s);(null==e?void 0:e.length)>1&&(this.viewModel.levelsExpanded=!0)}}_levelSelected(e){const s=e.currentTarget.getAttribute("data-id");this.level=s}_closeLevels(){this.viewModel.levelsExpanded=!1}_isWebScene(e){return"esri.WebScene"===e.declaredClass}_getComponentPosition(){var e,s;return null==(e=this.view)||null==(s=e.ui)?void 0:s.getPosition(this.container)}_getPosition(e){switch(e){case"bottom-right":case"bottom-left":return"bottom";default:return"top"}}};e([i("viewModel.enabled")],Y.prototype,"enabled",void 0),e([i("viewModel.longNames")],Y.prototype,"longNames",void 0),e([i("viewModel.minimized")],Y.prototype,"minimized",void 0),e([i("viewModel.pinnedLevels")],Y.prototype,"pinnedLevels",void 0),e([i("viewModel.site")],Y.prototype,"site",void 0),e([i("viewModel.facility")],Y.prototype,"facility",void 0),e([i("viewModel.level")],Y.prototype,"level",void 0),e([i("viewModel.view")],Y.prototype,"view",void 0),e([s({type:c})],Y.prototype,"viewModel",void 0),e([s(),o("esri/widgets/FloorFilter/t9n/FloorFilter")],Y.prototype,"messages",void 0),e([s(),o("esri/t9n/common")],Y.prototype,"messagesCommon",void 0),e([i("viewModel.goToOverride")],Y.prototype,"goToOverride",void 0),e([i("viewModel.updateWebDocument")],Y.prototype,"updateWebDocument",null),Y=e([t("esri.widgets.FloorFilter")],Y);var ee=Y;export default ee;
