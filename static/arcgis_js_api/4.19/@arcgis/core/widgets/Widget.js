/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import{b as t}from"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import{L as r}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{S as i,a as o}from"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{debounce as n,throwIfNotAbortError as a,eachAlways as l}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{E as d}from"../chunks/Evented.js";import"../core/Collection.js";import{a as h}from"../chunks/Promise.js";import"../core/urlUtils.js";import{cast as p}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import{g as m}from"../chunks/resourceExtension.js";import{o as u}from"../chunks/locale.js";import"../chunks/number.js";import{fetchMessageBundle as g}from"../intl.js";import"../request.js";import"../chunks/assets.js";import j from"../core/Handles.js";import{init as _,whenOnce as y}from"../core/watchUtils.js";import{b as k}from"../chunks/domUtils.js";import{g as f,c as v}from"../chunks/widgetUtils.js";import{c as w}from"../chunks/projector.js";const b=r.getLogger("esri.widgets.Widget");let C=0;const H="esri-icon-checkbox-unchecked",N=w();let E=!1,L=class extends(h(d.EventedAccessor)){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new j,this._projector=N,this.domNode=null,this.iconClass=H,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=n((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await l(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{this[t]=await g(e)})));for(const t of e)t.error&&b.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()}));const s=f()||"light";["light","dark"].includes(s)||t(b,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const a="esri-widget-uid-"+m(),c=this.render.bind(this);let d=!1;this._trackingTarget=new i((()=>this.scheduleRender()));const h=()=>{if(!d||this.destroyed)return null;const e=c();return e.properties?e.properties.key||(e.properties.key=a):e.properties={key:a},e};this.render=()=>{if(E)return h();let e;this._trackingTarget.clear(),E=!0;try{e=o(this._trackingTarget,h)}finally{E=!1}return e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{d=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch(a)}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return k(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+C++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return v.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e;this.destroyed||(this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(_(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(u((async()=>{await this._loadLocale().catch(a),this.scheduleRender()}))),this._internalHandles.add(y(this,"container",(async e=>{this.destroyed||this._attach(e)}))))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};e([s({value:null})],L.prototype,"container",null),e([p("container")],L.prototype,"castContainer",null),e([s({aliasOf:"container"})],L.prototype,"domNode",void 0),e([s()],L.prototype,"iconClass",void 0),e([s()],L.prototype,"id",null),e([s()],L.prototype,"label",void 0),e([s()],L.prototype,"renderable",null),e([s()],L.prototype,"viewModel",void 0),e([s()],L.prototype,"visible",void 0),L=e([c("esri.widgets.Widget")],L);var P=L;export default P;
