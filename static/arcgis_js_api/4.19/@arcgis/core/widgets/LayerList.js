/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import{h as t}from"../core/lang.js";import{a as s}from"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import{L as i}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{e as o}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import n from"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../core/urlUtils.js";import{aliasOf as a}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as p}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols.js";import"../chunks/uid.js";import"../Graphic.js";import c from"../core/Handles.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../tasks/support/ColorRamp.js";import"../tasks/support/AlgorithmicColorRamp.js";import"../tasks/support/MultipartColorRamp.js";import"../chunks/colorRamps.js";import"../renderers/Renderer.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/sizeVariableUtils.js";import"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/VisualVariablesMixin.js";import"../chunks/symbolConversion.js";import"../symbols/support/jsonUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../renderers/ClassBreaksRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/styleUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/MemCache.js";import"../chunks/LRUCache.js";import"../renderers/DictionaryRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/support/jsonUtils.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/MultiOriginJSONSupport.js";import{on as m,init as d}from"../core/watchUtils.js";import"../chunks/fieldType.js";import"../core/HandleOwner.js";import"../chunks/domUtils.js";import"../chunks/widgetUtils.js";import"../chunks/projector.js";import{a as u}from"../chunks/accessibleHandler.js";import{m as h}from"../chunks/messageBundle.js";import"./support/widget.js";import{v as y}from"../chunks/vmEvent.js";import{j as g}from"../chunks/index.js";import b from"./Widget.js";import"../layers/support/Field.js";import"../chunks/labelUtils.js";import"../layers/support/LabelClass.js";import"../chunks/defaultsJSON.js";import"../chunks/defaults.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../layers/support/FieldsIndex.js";import"../chunks/DataLayerSource.js";import"../support/popupUtils.js";import"../tasks/support/Query.js";import"../tasks/support/StatisticDefinition.js";import"../layers/support/Sublayer.js";import"../chunks/ActionSlider.js";import"./LayerList/ListItemPanel.js";import{f as j,s as _,d as v,e as k}from"../chunks/layerListUtils.js";import f from"./LayerList/ListItem.js";import{S as I}from"../chunks/sortable.esm.js";import S from"./LayerList/LayerListViewModel.js";function C(e,t,s){e.splice(s,0,e.splice(t,1)[0])}const A=n.ofType(f),w="esri-layer-list esri-widget esri-widget--panel",L="esri-layer-list--new-ui",U="esri-layer-list__no-items",M="esri-layer-list__list",E="esri-layer-list__list--root",V="esri-layer-list__list--exclusive",x="esri-layer-list__list--inherited",O="esri-layer-list__list--independent",P="esri-layer-list__item",D="esri-layer-list__item--error",R="esri-layer-list__item--invisible",T="esri-layer-list__item--invisible-at-scale",N="esri-layer-list__item--updating",F="esri-layer-list__item--has-children",$="esri-layer-list__item--selectable",B="esri-layer-list__item-container",z="esri-layer-list__item-actions-menu",H="esri-layer-list__item-actions-menu-item",J="esri-layer-list__item-actions-menu-item--active",K="esri-layer-list__item-actions",q="esri-layer-list__item-actions-list",G="esri-layer-list__item-action",Q="esri-layer-list__item-action-icon",W="esri-layer-list__item-action-image",X="esri-layer-list__item-action-title",Y="esri-layer-list__action-toggle",Z="esri-layer-list__action-toggle--on",ee="esri-layer-list__item-label",te="esri-layer-list__item-error-message",se="esri-layer-list__item-title",ie="esri-layer-list__item-toggle",re="esri-layer-list__item-toggle-icon",oe="esri-layer-list__item-toggle-icon",le="esri-layer-list__item-radio-icon",ne="esri-layer-list__child-toggle",ae="esri-layer-list__child-toggle--open",pe="esri-layer-list__child-toggle-icon--opened",ce="esri-layer-list__child-toggle-icon--closed",me="esri-layer-list__child-toggle-icon--closed-rtl",de="esri-layer-list--chosen",ue="esri-disabled",he="esri-disabled-element",ye="esri-hidden",ge="esri-rotating",be="esri-icon-handle-horizontal",je="esri-icon-visible",_e="esri-icon-non-visible",ve="esri-icon-radio-checked",ke="esri-icon-radio-unchecked",fe="esri-icon-notice-triangle",Ie="esri-icon-down-arrow",Se="esri-icon-right-triangle-arrow",Ce="esri-icon-left-triangle-arrow",Ae="esri-icon-loading-indicator",we="esri-icon-default-action",Le="esri-icon-layers",Ue="actions",Me="action-section",Ee="items",Ve={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function xe(e){const{actionsOpen:t,children:s}=e;t&&(e.actionsOpen=!1),s.forEach((e=>xe(e)))}const Oe=i.getLogger("esri.widgets.LayerList"),Pe={statusIndicators:!0};let De=class extends b{constructor(e,s){super(e,s),this._handles=new c,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=t("esri-layerlist-new-ui"),this.visibleItems=null,this.iconClass=Le,this.label=void 0,this.listItemCreatedFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.operationalItems=null,this.selectionEnabled=!1,this.selectedItems=new A,this.view=null,this.viewModel=new S,this.visibleElements={...Pe},this._onSortableSort=({to:e,from:t,item:s,newIndex:i})=>{t&&e&&(t===e?this._sortLayers(this._sortableMap.get(t.dataset.group)):this._moveLayerFromChildList({to:e,from:t,item:s,newIndex:i}))},this._sortableCanPut=(e,t,s)=>{var i,r;const o=e.el.dataset.group,l=t.el.dataset.group,n=e.el["data-item"],a=s["data-item"],p=null==a||null==(i=a.layer)?void 0:i.type,c=null==n||null==(r=n.layer)?void 0:r.type;return o&&l&&p&&!("group"===c&&"group"===p)},this._sortableCanPull=(e,t,s)=>{var i;const r=e.el.dataset.group,o=t.el.dataset.group,l=s["data-item"],n=null==l||null==(i=l.layer)?void 0:i.type;return r&&o&&!!n},this._onSortableEnd=({oldIndex:e,from:t,to:s,item:i})=>{t!==s&&t.insertBefore(i,t.children[e])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.own(m(this,"operationalItems","change",(()=>this._itemsChanged(e))),d(this,"selectionEnabled",(()=>this._toggleAllSorting())))}destroy(){this._destroySortables(),this._handles.destroy(),this._handles=null}set statusIndicatorsVisible(e){s(Oe,"statusIndicatorsVisible",{replacement:"visibleElements.statusIndicators",version:"4.15"}),this.visibleElements={...this.visibleElements,statusIndicators:e}}castVisibleElements(e){return{...Pe,...e}}triggerAction(e,t){this.viewModel.triggerAction(e,t)}render(){var e;const{visibleItems:t,_newUI:s}=this,i=null==(e=this.viewModel)?void 0:e.state,r={[L]:s,[ye]:"loading"===i,[ue]:"disabled"===i};return g("div",{class:this.classes(w,r)},null!=t&&t.length?this.renderItems():this.renderNoItems())}renderNoItems(){return g("div",{class:U},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:e,selectionEnabled:t,messages:s}=this;return g("ul",{"aria-label":s.widgetLabel,role:t?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":"root",bind:this,class:this.classes(M,E,O)},null==e?void 0:e.map((e=>this.renderItem(e,null))).toArray())}renderActionsMenuIcon(e,t){const{messages:s}=this,i={[J]:e.actionsOpen},r=e.actionsOpen?s.closeActions:s.openActions;return g("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(H,i),tabindex:"0",role:"button","aria-controls":t,"aria-label":r,title:r},g("span",{"aria-hidden":"true",class:be}))}renderActionsMenu(e,t,s,i){const{panel:r}=e,o=r&&r.visible?this.renderPanelButton(r):null,l=1===s&&this._getSingleActionButton(t),n=l?this.renderAction({item:e,action:l,singleAction:!0}):null,a=!l&&s?this.renderActionsMenuIcon(e,i):null;return a||o||l?g("div",{key:"actions-menu",class:z},o,n,a):null}renderChildList(e,t){var s;const{selectionEnabled:i}=this,{visibilityMode:r,children:o}=e,l=!!e.error,n=!!o.length&&!l,a=!n&&i&&"group"===(null==(s=e.layer)?void 0:s.type),{exclusive:p,inherited:c}=Ve,m={[V]:r===p,[x]:r===c,[O]:r!==c&&r!==p};return n||a?g("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(M,m),"aria-expanded":e.open?"true":"false",role:i?"listbox":r===p?"radiogroup":"group",hidden:!e.open&&!a||null},null==o?void 0:o.map((t=>this.renderItem(t,e))).toArray()):null}renderChildrenToggle(e,t){const{messagesCommon:s}=this,{children:i}=e,r=!!e.error,o=!!i.length&&!r,l={[ae]:e.open},n=e.open?s.collapse:s.expand;return o?g("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(ne,l),tabindex:"0",role:"button","aria-controls":t,"aria-label":n,title:n},g("span",{"aria-hidden":"true",class:this.classes(ce,Se)}),g("span",{"aria-hidden":"true",class:this.classes(pe,Ie)}),g("span",{"aria-hidden":"true",class:this.classes(me,Ce)})):null}renderError(e){return e.error?g("div",{key:"esri-layer-list__error",class:te,role:"alert"},g("span",null,this.messages.layerError)):null}renderItemContent(e,t,s){const{id:i}=this,r=`${i}_${e.uid}`,o=`${r}_actions`,l=`${r}__list`,{panel:n}=e,a=this._filterActions(e.actionsSections),p=this._countActions(a);return[g("div",{key:"list-item-container",class:B},this.renderChildrenToggle(e,l),this.renderLabel(e,t,s),this.renderActionsMenu(e,a,p,o)),this.renderError(e),p?this.renderActionsSections(e,a,o):null,n&&n.open?n.render():null,this.renderChildList(e,l)]}renderItem(e,t){const{_newUI:s,id:i,selectionEnabled:r,selectedItems:o,visibleElements:l}=this,{children:n}=e,a=`${`${i}_${e.uid}`}__title`,p=!!e.error,c=!!n.length&&!p,m={[F]:c,[D]:!!p,[N]:e.updating&&!t&&l.statusIndicators,[R]:s&&!e.visible,[T]:!e.visibleAtCurrentScale,[$]:r};if(r){var d;const s={"data-layer-uid":null==(d=e.layer)?void 0:d.uid,"data-sort-filter":(!e.sortable).toString()};return g("li",Object.assign({key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(P,m),"aria-labelledby":a,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":e,"data-group":t?t.uid:"root",tabIndex:0,"aria-selected":j(e,o)?"true":"false",role:"option"},s),this.renderItemContent(e,t,a))}return g("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(P,m),"aria-labelledby":a},this.renderItemContent(e,t,a))}renderItemTitle(e,t){const{messages:s}=this,i=e.title||s.untitledLayer,r=e.visibleAtCurrentScale?i:`${i} (${s.layerInvisibleAtScale})`;return g("span",{key:"layer-title-container",id:t,title:r,"aria-label":r,class:se},i)}renderItemToggleIcon(e,t){const{_newUI:s}=this,{exclusive:i}=Ve,r=t&&t.visibilityMode,o={[re]:s,[oe]:s&&r!==i,[le]:s&&r===i,[ve]:r===i&&e.visible,[ke]:r===i&&!e.visible,[je]:r!==i&&e.visible,[_e]:r!==i&&!e.visible};return g("span",{key:"item-toggle-icon",class:this.classes(o),"aria-hidden":"true"})}renderItemToggle(e,t,s){const{selectionEnabled:i}=this,{exclusive:r}=Ve,o=t&&t.visibilityMode,l=o===r?"radio":"switch";return g("span",i?{key:"item-toggle-selection-enabled",class:ie,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,"aria-checked":e.visible?"true":"false",role:l,"aria-labelledby":s}:{key:"item-toggle",class:ie},this.renderItemToggleIcon(e,t))}renderItemError(e){return e.error?g("span",{key:"notice-triangle","aria-hidden":"true",class:fe}):null}renderLabel(e,t,s){const{selectionEnabled:i,_newUI:r}=this,{inherited:o,exclusive:l}=Ve,n=null==t?void 0:t.visibilityMode,a=n===l?"radio":"switch",p=[this.renderItemToggle(e,t,s),this.renderItemTitle(e,s)];r&&p.reverse();const c=g("div",i?{key:`item-label-no-selection-${e.uid}`,class:ee}:{key:`item-label-with-selection-${e.uid}`,class:ee,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":n,tabIndex:0,"aria-checked":e.visible?"true":"false",role:a,"aria-labelledby":s},p);return n===o||e.error?g("div",{key:`item-label-container-${e.uid}`,class:ee},this.renderItemError(e),this.renderItemTitle(e,s)):c}renderPanelButton(e){const{className:t,open:s,title:i,image:r}=e,o=r||t?t:we,l=this._getIconImageStyles(e),n={[J]:s},a={[W]:!!l["background-image"]};return o&&(a[o]=!!o),g("div",{key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(H,n),role:"button",tabindex:"0",title:i,"aria-label":i},g("span",{class:this.classes(a),styles:l}))}renderActionsSections(e,t,s){const i=t.toArray().map(((t,s)=>g("ul",{key:`${e}-action-section-${s}`,class:q},this.renderActionSection(e,t))));return g("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:s,class:K,hidden:!e.actionsOpen||null},i)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:s}=e,i=this._getIconImageStyles(e),r="button"!==e.type||e.image||s?s:we,o={[W]:!t&&!!i["background-image"],[Ae]:t,[ge]:t};return r&&!t&&(o[r]=!0),g("span",{key:"action-icon","aria-hidden":"true",class:this.classes(Q,o),styles:i})}renderActionTitle(e,t){return t?null:g("span",{key:"action-title",class:X},e)}renderAction(e){const{item:t,action:s,singleAction:i}=e,{active:r,disabled:o,title:l}=s,n={[H]:i&&"button"===s.type,[G]:r||!i&&"toggle"!==s.type,[Y]:!r&&"toggle"===s.type,[Z]:!r&&"toggle"===s.type&&s.value,[he]:o},a=[this.renderActionIcon(s),this.renderActionTitle(l,i)];return i?g("div",{bind:this,"data-item":t,"data-action":s,role:"button",key:`single-action-${s.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:n,tabindex:"0",title:l,"aria-label":l},a):g("li",{bind:this,"data-item":t,"data-action":s,key:`action-${s.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:n,tabindex:"0",role:"button",title:l,"aria-label":l},a)}_sortNodeRemoved(e){const{_sortableMap:t}=this,s=e.dataset.group,i=t.get(s);i&&i.destroy(),t.delete(s)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach((e=>e&&e.destroy())),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:s,newIndex:i}){const r=s["data-item"],o=e["data-item"],l=t["data-item"];this.viewModel.moveListItem(r,l,o,i)}_sortLayers(e){if(!e)return;const t=e.el["data-item"],s=e.toArray();var i,r;t?v(t,s):_(null==(i=this.view)||null==(r=i.map)?void 0:r.layers,s)}_toggleSorting(e,t){const{_sortableMap:s,selectionEnabled:i}=this,r=s.get(t),o=e["data-item"],l=("root"===t||o.childrenSortable&&k(o))&&i;if(r)r.option("disabled",!l);else if(l){const i=I.create(e,{dataIdAttr:"data-layer-uid",group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:'[data-sort-filter="true"]',fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!l,chosenClass:de});s.set(t,i)}}_toggleAllSorting(){this._sortableNodes.forEach(((e,t)=>this._toggleSorting(e,t)))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=null==e?void 0:e.filter((e=>this.errorsVisible||!e.error))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)}_focusListItem(e){var t;const{_focusSortUid:s}=this;if(!e||!s)return;(null==(t=e["data-item"].layer)?void 0:t.uid)===s&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e,t){const s=Me+t;this._handles.add(e.on("change",this.scheduleRender.bind(this)),s),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){const s=Ue+t;"toggle"!==e.type?"slider"!==e.type?this._handles.add([d(e,["className","image","id","title","visible"],(()=>this.scheduleRender()))],s):this._handles.add([d(e,["className","id","title","visible","value","displayValueEnabled","max","min","step"],(()=>this.scheduleRender()))],s):this._handles.add([d(e,["className","image","id","title","visible","value"],(()=>this.scheduleRender()))],s)}_renderOnItemChanges(e){const t=e.uid,s=Ee+t;this._handles.add([d(e,["actionsOpen","visible","open","updating","title","visibleAtCurrentScale","error","visibilityMode","panel","panel.title","panel.content","panel.className","sortable","childrenSortable"],(()=>this.scheduleRender())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],s),e.children.forEach((e=>this._renderOnItemChanges(e))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e){this._handles.removeAll(),e.forEach((e=>this._renderOnItemChanges(e))),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}}_selectionKeydown(e){const t=o(e);if(-1===["ArrowDown","ArrowUp"].indexOf(t))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget,i=s["data-item"],{_sortableMap:r,selectedItems:l}=this,n=s.dataset.group,a=r.get(n);if(!a)return;const p=j(i,l),c=a.toArray(),m=e.target,d=c.indexOf(m.dataset.layerUid);if(-1!==d){if("ArrowDown"===t){const e=d+1;if(e>=c.length)return;var u,h;if(p)C(c,d,e),a.sort(c),this._sortLayers(a),this._focusSortUid=null==(u=i.layer)?void 0:u.uid;else this._focusSortUid=null==(h=i.layer)?void 0:h.uid,this.scheduleRender()}if("ArrowUp"===t){const e=d-1;if(e<=-1)return;var y,g;if(p)C(c,d,e),a.sort(c),this._sortLayers(a),this._focusSortUid=null==(y=i.layer)?void 0:y.uid;else this._focusSortUid=null==(g=i.layer)?void 0:g.uid,this.scheduleRender()}}}_toggleActionsOpen(e){const t=e.currentTarget["data-item"],{actionsOpen:s}=t,i=!s;i&&this.operationalItems.forEach((e=>xe(e))),t.actionsOpen=i,e.stopPropagation()}_triggerPanel(e){const t=e.currentTarget["data-panel"];t&&(t.open=!t.open),e.stopPropagation()}_triggerAction(e){const t=e.currentTarget,s=t["data-action"],i=t["data-item"];"toggle"===s.type&&(s.value=!s.value),this.triggerAction(s,i),e.stopPropagation()}_toggleVisibility(e){const t=e.currentTarget,s=t.getAttribute("data-parent-visibility"),i=t["data-item"];s===Ve.exclusive&&i.visible||(i.visible=!i.visible),e.stopPropagation()}_toggleChildrenClick(e){const t=e.currentTarget["data-item"];t.open=!t.open,e.stopPropagation()}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:s}=this,i=t&&(e.metaKey||e.ctrlKey),r=e.currentTarget["data-item"],o=j(r,s),{length:l}=s;if(!i)return l&&!(o&&1===l)?(s.removeAll(),void s.add(r)):void(o?null==s.remove||s.remove(o):s.add(r));o?null==s.remove||s.remove(o):s.add(r)}};e([r()],De.prototype,"visibleItems",void 0),e([r()],De.prototype,"iconClass",void 0),e([r()],De.prototype,"errorsVisible",void 0),e([r({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],De.prototype,"label",void 0),e([a("viewModel.listItemCreatedFunction")],De.prototype,"listItemCreatedFunction",void 0),e([r(),h("esri/widgets/LayerList/t9n/LayerList")],De.prototype,"messages",void 0),e([r(),h("esri/t9n/common")],De.prototype,"messagesCommon",void 0),e([r()],De.prototype,"multipleSelectionEnabled",void 0),e([a("viewModel.operationalItems")],De.prototype,"operationalItems",void 0),e([r()],De.prototype,"selectionEnabled",void 0),e([r()],De.prototype,"selectedItems",void 0),e([r()],De.prototype,"statusIndicatorsVisible",null),e([a("viewModel.view")],De.prototype,"view",void 0),e([y("trigger-action"),r({type:S})],De.prototype,"viewModel",void 0),e([r()],De.prototype,"visibleElements",void 0),e([p("visibleElements")],De.prototype,"castVisibleElements",null),e([a("viewModel.triggerAction")],De.prototype,"triggerAction",null),e([u()],De.prototype,"_toggleActionsOpen",null),e([u()],De.prototype,"_triggerPanel",null),e([u()],De.prototype,"_triggerAction",null),e([u()],De.prototype,"_toggleVisibility",null),e([u()],De.prototype,"_toggleChildrenClick",null),e([u()],De.prototype,"_toggleSelection",null),De=e([l("esri.widgets.LayerList")],De);var Re=De;export default Re;
