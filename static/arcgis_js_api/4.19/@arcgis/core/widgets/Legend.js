/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as t}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../chunks/asyncUtils.js";import"../core/urlUtils.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as i}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import{f as o}from"../chunks/number.js";import{substitute as l}from"../intl.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/vec3f64.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import{a as n}from"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols.js";import"../chunks/uid.js";import"../Graphic.js";import a from"../core/Handles.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../tasks/support/ColorRamp.js";import"../tasks/support/AlgorithmicColorRamp.js";import"../tasks/support/MultipartColorRamp.js";import"../chunks/colorRamps.js";import"../renderers/Renderer.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/sizeVariableUtils.js";import"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/VisualVariablesMixin.js";import"../chunks/symbolConversion.js";import"../symbols/support/jsonUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../renderers/ClassBreaksRenderer.js";import"../chunks/colorUtils2.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/styleUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/MemCache.js";import"../chunks/ItemCache.js";import"../chunks/utils3.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils2.js";import"../chunks/LRUCache.js";import"../renderers/DictionaryRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/support/jsonUtils.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import{on as c,init as p}from"../core/watchUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/commonProperties2.js";import"../core/HandleOwner.js";import"../chunks/domUtils.js";import{c as m}from"../chunks/widgetUtils.js";import{c as d}from"../chunks/projector.js";import{a as h}from"../chunks/accessibleHandler.js";import{m as y}from"../chunks/messageBundle.js";import{j as u}from"../chunks/index.js";import g from"./Widget.js";import"../chunks/sublayerUtils.js";import"../chunks/ExportImageParameters.js";import"../chunks/mat2d.js";import"../chunks/mat2df32.js";import"../chunks/numberUtils.js";import{renderColorRampPreviewHTML as v}from"../symbols/support/symbolUtils.js";import"../chunks/rendererConversion.js";import"./Legend/support/ActiveLayerInfo.js";import{g as f,a as b,r as _,b as j,c as k,d as w,e as L,f as S}from"../chunks/renderUtils.js";import"../chunks/previewSymbol3D.js";import x from"./Legend/LegendViewModel.js";const I="http://www.w3.org/2000/svg",C="esri-relationship-ramp--diamond__container",z="esri-relationship-ramp--diamond__left-column",E="esri-relationship-ramp--diamond__right-column",$="esri-relationship-ramp--diamond__middle-column",R="esri-relationship-ramp--diamond__middle-column--label",A="esri-relationship-ramp--diamond__middle-column--ramp",U="esri-relationship-ramp--square__table",F="esri-relationship-ramp--square__table-row",M="esri-relationship-ramp--square__table-cell",N="esri-relationship-ramp--square__table-label",D="esri-relationship-ramp--square__table-label--left-bottom",V="esri-relationship-ramp--square__table-label--right-bottom",P="esri-relationship-ramp--square__table-label--left-top",O="esri-relationship-ramp--square__table-label--right-top";function T(e,s,t){const{focus:r,labels:i}=e,o=!!r,l=function(e,s,t,r=60){const{focus:i,numClasses:o,colors:l,rotation:n}=e,a=!!i,c=Math.sqrt(r**2+r**2)+(a?0:5);let p=null;null!=t&&(p=`opacity: ${t}`);const m=[],d=[],h=[],y=(r||75)/o;for(let e=0;e<o;e++){const s=e*y;for(let t=0;t<o;t++){const r=t*y,i=f(l[e][t]),o=b(null),n={type:"rect",x:r,y:s,width:y,height:y};m.push(_(i)),d.push(j(n,i.fill,o,null)),h.push(k(n))}}const g=10,v=15,S=15,x=10;let C=null;a||(C="margin: -15px -15px -18px -15px");const z=B("left",i,s),E=B("right",i,s),$=w(h),R=L($,c,c,0,!1,n,!1),U=L($,c,c,0,!1,a?-45:null,!1);return u("div",{style:p,class:a?A:M},u("svg",{xmlns:I,width:c,height:c,style:C},u("defs",null,u("marker",{id:`${s}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},u("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),u("marker",{id:`${s}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},u("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),m),u("g",{transform:R},d),u("g",{transform:U},u("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":z.markerStart,"marker-end":z.markerEnd,x1:-g,y1:r-v,x2:-g,y2:v}),u("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:S,y1:r+x,x2:r-S,y2:r+x}))))}(e,s,t);return o?u("div",{class:C},u("div",{class:z},i.left),u("div",{class:$},u("div",{class:R},i.top),l,u("div",{class:R},i.bottom)),u("div",{class:E},i.right)):u("div",{class:U},u("div",{class:F},u("div",{class:m(M,N,V)},i.left),u("div",{class:M}),u("div",{class:m(M,N,D)},i.top)),u("div",{class:F},u("div",{class:M}),l,u("div",{class:M})),u("div",{class:F},u("div",{class:m(M,N,O)},i.bottom),u("div",{class:M}),u("div",{class:m(M,N,P)},i.right)))}function B(e,s,t){const r=`${t}_arrowStart`,i=`${t}_arrowEnd`,o="left"===e,l={markerStart:null,markerEnd:null};switch(s){case"HL":o?l.markerStart=`url(#${i})`:l.markerEnd=`url(#${r})`;break;case"LL":l.markerStart=`url(#${i})`;break;case"LH":o?l.markerEnd=`url(#${r})`:l.markerStart=`url(#${i})`;break;default:l.markerEnd=`url(#${r})`}return l}const q=d(),H="esri-univariate-above-and-below-ramp__symbol",W="esri-legend__color-ramp";function G(e="vertical"){const s="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?u("svg",{height:"4",width:"10"},u("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:s})):u("svg",{height:"10",width:"10"},u("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:s}))}function Q(e,s="vertical"){const t=document.createElement("div");return t.style.height="20px",t.className=H,null!=e&&(t.style.opacity=e.toString()),q.append(t,G.bind(null,s)),t}function X(e,s,t="vertical",r){e.infos.forEach(((e,i)=>{if(r&&2===i)e.preview=Q(s,t);else{const s=n(e.size)+("horizontal"===t?20:10),r="div"===e.preview.tagName.toLowerCase(),i=r?e.preview:document.createElement("div");i.className=H,"horizontal"===t?i.style.width=`${s}px`:i.style.height=`${s}px`,r||i.appendChild(e.preview),e.preview=i}}))}function Y(e,s="classic"){const t=e.infos;return"classic"===s?(n(t[0].size)+10)/2:(n(t[0].size)-n(t[t.length-1].size))/2}function Z(e,s){if(!e)return null;const t=e.infos.map((e=>e.color)),r=v("full"===s.type?t:"above"===s.type?t.slice(0,3):t.slice(2,5),{width:s.width,height:s.height,align:s.rampAlignment});return r.className=W,null!=s.opacity&&(r.style.opacity=s.opacity.toString()),r}function J(e,s,t,r="vertical"){let i=0;const o=e.infos,l=Math.floor(o.length/2),a="full"===s||"above"===s?0:l,c="full"===s||"below"===s?o.length-1:l;for(let e=a;e<=c;e++)if(t&&e===l)i+="horizontal"===r?10:20;else{i+=n(o[e].size)+("horizontal"===r?20:10)}return Math.round(i)}function K(e,s,t,r="vertical"){const i=J(e,s,t,r),o=e.infos,l=Math.floor(o.length/2),a="full"===s||"above"===s?0:l,c="full"===s||"below"===s?o.length-1:l,p="full"===s?o[a].size+o[c].size:"above"===s?o[a].size:o[c].size,m=t?"vertical"===r?20:10:0,d="vertical"===r?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(i-(n(p)/2+m/2+d/2))}function ee(e,s,t="vertical"){const r=e.infos;let i=r.filter((({type:e})=>"size-ramp"===e))[0],o=r.filter((({type:e})=>"color-ramp"===e))[0];var l;(i&&(i={...i},i.infos=[...i.infos]),o&&(o={...o},o.infos=[...o.infos]),X(i,s,t,!0),"horizontal"===t)&&(i.infos.reverse(),null==(l=o)||l.infos.reverse());return{sizeRampElement:i,colorRampElement:o}}function se(e,s="vertical"){const t=e.infos;let r=t.filter((({type:e})=>"size-ramp"===e))[0],i=t.filter((({type:e})=>"color-ramp"===e))[0];var o;(r&&(r={...r},r.infos=[...r.infos]),i&&(i={...i},i.infos=[...i.infos]),X(r,null,s,!1),"horizontal"===s)&&(r.infos.reverse(),null==(o=i)||o.infos.reverse());return{sizeRampElement:r,colorRampElement:i}}function te(e){e.appendChild(this)}function re(e,s,t){if(!s)return;if("string"==typeof s||"number"==typeof s)return s;if("value"in s||"unit"in s)return l(e.dotValue,s);if("colorName"in s||"bandName"in s)return e[s.colorName]+": "+(e[s.bandName]||s.bandName);if("showCount"in s)return s.showCount?e.clusterCountTitle:null;let r=null;return!function(e,s){return s}(0,t)?ie(s,t)&&(r=s.normField?"showNormField":s.normByPct?"showNormPct":s.field?"showField":null):r=s.ratioPercentTotal?"showRatioPercentTotal":s.ratioPercent?"showRatioPercent":s.ratio?"showRatio":s.normField?"showNormField":s.field?"showField":null,r?l("showField"===r?"{field}":e[r],{field:s.field,normField:s.normField}):null}function ie(e,s){return!s}function oe(e,s){return!!(s&&"Stretched"===s&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const le="esri-legend--card__carousel-indicator--activated",ne="esri-legend--card",ae="esri-legend--stacked",ce="esri-legend--card__carousel-title",pe="esri-legend--card__carousel-indicator",me="esri-legend--card__interval-separator",de="esri-legend--card__imagery-layer-image--stretched",he="esri-legend--card__image-label",ye="esri-legend--card__layer-caption",ue="esri-legend--card__label-element",ge="esri-legend--card__layer-row",ve="esri-legend--card__label-cell",fe="esri-legend--card__message",be="esri-legend--card__ramp-label",_e="esri-legend--card__section",je="esri-legend--card__service-caption-text",ke="esri-legend--card__service-content",we="esri-legend--card__service",Le="esri-legend--card__group-layer",Se="esri-legend--card__group-layer-child",xe="esri-legend--card__symbol",Ie="esri-legend--card__size-ramp-row",Ce="esri-legend--card__symbol-row",ze="esri-legend--card__symbol-cell",Ee="esri-legend--card__carousel-indicator-container",$e="esri-legend--card__interval-separators-container",Re="esri-legend--card__relationship-label-container",Ae="esri-legend--card__label-container",Ue="esri-legend--card__service-caption-container",Fe="esri-legend--card__symbol-container",Me="esri-legend--card__size-ramp-container",Ne="esri-legend--card__size-ramp-preview",De="esri-legend__size-ramp--horizontal",Ve="esri-legend__ramp-labels",Pe="esri-legend__layer-cell esri-legend__layer-cell--info",Oe="esri-univariate-above-and-below-ramp__color--card",Te="esri-widget__heading",Be=window.devicePixelRatio;let qe=class extends g{constructor(e,s){super(e,s),this._handles=new a,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))])}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const t=this._sectionNames.length,r=this._sectionNames.map(((e,s)=>{const r=l(this.messagesCommon.pagination.pageText,{index:s+1,total:t});return u("div",{key:e,role:"tab",id:e,"aria-label":r,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:r,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(pe,{[le]:this._selectedSectionName===e}),"data-section-name":e})})),i=this._hasIndicators&&t>1?u("div",{class:Ee,key:"carousel-navigation",role:"tablist"},r):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s&&s.length?s:null,n={[ae]:this._hasIndicators};return u("div",{class:this.classes(ne,n)},o||u("div",{class:fe},this.messages.noLegend),i)}_selectSection(e){const s=e.target.getAttribute("data-section-name");s&&(this._selectedSectionName=s)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const s=e.key,t="ArrowLeft"===s?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),o=this._sectionNames;let l=null;-1!==i&&(o[i+t]?l=document.getElementById(o[i+t]):"ArrowLeft"===s?l=document.getElementById(o[o.length-1]):"ArrowRight"===s&&(l=document.getElementById(o[0])),l&&l.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const s=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(s),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),s)}));const s="activeLayerInfos-collection-change";this._handles.remove(s),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,s,t){return`${this.id}${e.uid}-type-${s.type}-${t}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((s,t)=>{this._sectionNames.push(this._getSectionName(e.layer,s,t))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return u("div",{key:e.layer.uid,class:this.classes(we,Le)},u("div",{class:Ue},e.title),s)}{const s=e.legendElements;if(s&&!s.length)return null;const t=s.some((e=>"relationship-ramp"===e.type)),r=s.map(((s,r)=>this._renderLegendForElement(s,e,r,t))).filter((e=>!!e));if(!r.length)return null;const i={[Se]:!!e.parent};return u("div",{key:e.layer.uid,class:this.classes(we,i)},u("div",{class:Ue},u("div",{class:je},e.title)),u("div",{class:ke},r))}}_renderLegendForElement(e,s,t,r=!1){const i="color-ramp"===e.type,o="opacity-ramp"===e.type,l="size-ramp"===e.type,n=s.layer,a=e.title;let c=null;if("string"==typeof a)c=a;else if(a){const e=re(this.messages,a,i||o);c=a.title?`${a.title} (${e})`:e}const p=this._getSectionName(n,e,t),m=this._hasIndicators?u("div",null,u("h3",{class:this.classes(Te,ce)},s.title),u("h4",{class:this.classes(Te,ye)},c)):c?u("h4",{class:this.classes(Te,ye)},c):null;let d=null;if("symbol-table"===e.type){const t=e.infos.map(((t,r)=>this._renderLegendForElementInfo(t,s,e.legendType,r))).filter((e=>!!e));if(t.length){const e=t[0].properties.classes&&t[0].properties.classes[Ce],s={[Ae]:!e&&!r,[Re]:r};d=u("div",{class:this.classes(s)},t)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?d=this._renderLegendForRamp(e,n.opacity):l?d=this._renderSizeRamp(e,n.opacity):"relationship-ramp"===e.type?d=T(e,this.id,n.opacity):"univariate-above-and-below-ramp"===e.type?d=this._renderUnivariateAboveAndBelowRamp(e,n.opacity):"univariate-color-size-ramp"===e.type&&(d=this._renderUnivariateColorSizeRamp(e,n.opacity));if(!d)return null;const h=u("div",{key:p,class:_e,id:`${p}-panel`,role:"tabpanel","aria-labelledby":p,tabIndex:0},[m,d]);return this._sectionMap.set(p,h),h}_renderUnivariateAboveAndBelowRamp(e,s){const{sizeRampElement:t,colorRampElement:r}=ee(e,s,"horizontal"),i=J(t,"full",!0,"horizontal"),o=K(t,"above",!0,"horizontal"),l=K(t,"below",!0,"horizontal"),n=Z(r,{width:o,height:12,rampAlignment:"horizontal",opacity:s,type:"above"}),a=Z(r,{width:l,height:12,rampAlignment:"horizontal",opacity:s,type:"below"}),c=Y(t,"card"),p=t.infos.map((e=>e.label)),m=p.length-1,d=p.map(((e,s)=>0===s||s===m?u("div",{key:s},e):null)),h={marginTop:"3px",marginLeft:`${c}px`,display:"flex"},y={width:`${i}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return u("div",{class:ge,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},u("div",{class:this.classes(Fe,De),styles:{display:"flex",flexDirection:"row"}},t.infos.map(((e,s)=>u("div",{key:s,class:xe,bind:e.preview,afterCreate:te})))),n?u("div",{class:Oe,styles:h,key:"color-ramp-preview"},u("div",{bind:n,afterCreate:te}),u("div",{bind:a,afterCreate:te})):null,u("div",{class:Pe},u("div",{class:Ve,styles:y},d)))}_renderUnivariateColorSizeRamp(e,s){const{sizeRampElement:t,colorRampElement:r}=se(e,"horizontal"),i=J(t,"full",!1,"horizontal"),o=Z(r,{width:K(t,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:s,type:"full"}),l=Y(t,"card"),n=t.infos.length-1,a=t.infos.map(((e,s)=>0===s||s===n?u("div",{key:s},e.label):null)),c={marginTop:"3px",marginLeft:`${l}px`,display:"flex"},p={width:`${i}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return u("div",{class:ge,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},u("div",{class:this.classes(Fe,De),styles:{display:"flex",flexDirection:"row"}},t.infos.map(((e,s)=>u("div",{key:s,class:xe,bind:e.preview,afterCreate:te})))),u("div",{class:Oe,styles:c,key:"color-ramp-preview"},u("div",{bind:o,afterCreate:te})),u("div",{class:Pe},u("div",{class:Ve,styles:p},a)))}_renderLegendForElementInfo(e,s,t,r){const i=s.layer;if(e.type)return this._renderLegendForElement(e,s,r);const o=oe(i,t);if(e.preview){var l,n;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return u("div",{key:r,bind:e.preview,afterCreate:te});const s={[ze]:this._hasIndicators};return u("div",{key:r,class:this.classes(ge,{[Ce]:this._hasIndicators})},u("div",{class:this.classes(s),bind:e.preview,afterCreate:te}),u("div",{class:this.classes(he,{[ve]:this._hasIndicators})},re(this.messages,e.label,!1)||""))}let s=255,t=255,o=255,a=0,c=255,p=255,m=255,d=0;const h=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(s=e.symbol.color.r,t=e.symbol.color.g,o=e.symbol.color.b,a=e.symbol.color.a*i.opacity),y&&(c=e.symbol.outline.color.r,p=e.symbol.outline.color.g,m=e.symbol.outline.color.b,d=e.symbol.outline.color.a*i.opacity);const g=null==(l=null==(n=e.symbol.color)?void 0:n.isBright)||l,v=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return u("div",{key:r,class:ge},u("div",{class:ue,styles:{background:h?`rgba(${s}, ${t}, ${o}, ${a})`:"none",color:g?"black":"white",textShadow:`-1px -1px 0 ${v},\n                                              1px -1px 0 ${v},\n                                              -1px 1px 0 ${v},\n                                              1px 1px 0 ${v}`,border:y?`1px solid rgba(${c}, ${p}, ${m}, ${d})`:"none"}}," ",e.label," "))}if(e.src){const s=this._renderImage(e,i,o);return u("div",{key:r,class:ge},s,u("div",{class:he},e.label||""))}}_renderImage(e,s,t){const{label:r,src:i,opacity:o}=e,l={[de]:t,[xe]:!t},n={opacity:`${null!=o?o:s.opacity}`};return u("img",{alt:re(this.messages,r,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}_renderSizeRampLines(e){const s=e.infos,t=s[0],r=s[s.length-1],i=t.symbol,o=this._hasIndicators,l=n(t.size+t.outlineSize)*Be,a=n(r.size+r.outlineSize)*Be,c=o?l:l+50*Be,p=o?l/2+50*Be:l,m=function(e){if(e){if(e.type.indexOf("3d")>-1){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1).get("resource.primitive");return"triangle"===t||"cone"===t||"tetrahedron"===t}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.indexOf("3d")>-1){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1),r=t.resource&&t.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}{const s=e.style;return"circle"===s||"diamond"===s||"cross"===s}}}(i),h=document.createElement("canvas");h.width=c,h.height=p,h.style.width=h.width/Be+"px",h.style.height=h.height/Be+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,s=0,t=c/2-a/2,r=p;y.moveTo(e,s),y.lineTo(t,r);const i=c,o=0,l=c/2+a/2,n=p;y.moveTo(i,o),y.lineTo(l,n)}else{y.beginPath();const e=0,s=p/2-a/2,t=c,r=0;y.moveTo(e,s),y.lineTo(t,r);const i=0,o=p/2+a/2,l=c,n=p;y.moveTo(i,o),y.lineTo(l,n)}return y.strokeStyle="#ddd",y.stroke(),u("div",{bind:h,afterCreate:te,styles:o?{display:"flex",marginTop:`-${m?0:d?l/2:0}px`,marginBottom:`-${m?a:d?a/2:0}px`}:{display:"flex",marginRight:`-${m?0:d?l/2:0}px`,marginLeft:`-${m?0:d?a/2:0}px`}})}_renderSizeRamp(e,s){const t=e.infos,r=t[0].label,i=t[t.length-1].label;let o=t[0].preview,l=t[t.length-1].preview;const n=this._hasIndicators,a={"flex-direction":n?"column":"row-reverse"};o&&(o=o.cloneNode(!0),o.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");const c={opacity:null!=s?`${s}`:""};return u("div",{class:this.classes(ge,{[Ie]:n})},u("div",{class:be},n?r:i),u("div",{class:Me,styles:a},u("div",{bind:o,afterCreate:te,class:Ne,styles:c}),this._renderSizeRampLines(e),u("div",{bind:l,afterCreate:te,class:Me,styles:c})),u("div",{class:be},n?i:r))}_renderLegendForRamp(e,s){const t=e.infos,r="heatmap-ramp"===e.type,i=t.length-1,o=25,l=i>2&&!r?25*i:100,n=l+20,a=10,c=t.slice(0).reverse();c.forEach(((e,s)=>{e.offset=r?e.ratio:s/i}));const p=c.length-1,m=c.length%2!=0&&c[c.length/2|0],d=m&&u("div",{class:$e},u("div",{class:me},"|"),u("div",{class:be},m.label)),h=t[t.length-1].label,y=t[0].label;let g=null;null!=s&&(g=`opacity: ${s}`);const v=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:a,y:0,width:l,height:o},fill:{type:"linear",x1:a,y1:0,x2:l+a,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:`M${l+a} 0 L${n} 12.5 L${l+a} 25 Z`},fill:c[p].color,stroke:{width:0}}]],f=S(v,n,o),{messages:b}=this;return u("div",{class:ge},u("div",{class:be},r?b[h]:h),u("div",{class:Fe},u("div",{style:g},f),d),u("div",{class:be},r?b[y]:y))}};e([s()],qe.prototype,"activeLayerInfos",void 0),e([s()],qe.prototype,"layout",void 0),e([s(),y("esri/widgets/Legend/t9n/Legend")],qe.prototype,"messages",void 0),e([s(),y("esri/t9n/common")],qe.prototype,"messagesCommon",void 0),e([s({readOnly:!0})],qe.prototype,"type",void 0),e([s()],qe.prototype,"view",void 0),e([h()],qe.prototype,"_selectSection",null),qe=e([t("esri.widgets.Legend.styles.Card")],qe);var He=qe;const We="esri-legend__service",Ge="esri-legend__service-label",Qe="esri-legend__layer",Xe="esri-legend__group-layer",Ye="esri-legend__group-layer-child",Ze="esri-legend__layer-table",Je="esri-legend__layer-table--size-ramp",Ke="esri-legend__layer-child-table",es="esri-legend__layer-caption",ss="esri-legend__layer-body",ts="esri-legend__layer-row",rs="esri-legend__layer-cell esri-legend__layer-cell--info",is="esri-legend__imagery-layer-image--stretched",os="esri-legend__imagery-layer-info--stretched",ls="esri-legend__layer-cell esri-legend__layer-cell--symbols",ns="esri-legend__symbol",as="esri-legend__ramps",cs="esri-legend__size-ramp",ps="esri-legend__color-ramp",ms="esri-legend__opacity-ramp",ds="esri-legend__ramp-labels",hs="esri-legend__ramp-label",ys="esri-univariate-above-and-below-ramp__label",us="esri-legend__message",gs="esri-widget__heading",vs={display:"flex",alignItems:"flex-start"},fs={marginLeft:"3px"},bs={display:"table-cell",verticalAlign:"middle"};let _s=class extends g{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return u("div",null,s&&s.length?s:u("div",{class:us},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`esri-legend__${e.layer.uid}-version-${e.version}`,r=e.title?u("h3",{class:this.classes(gs,Ge)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return u("div",{key:t,class:this.classes(We,Xe)},r,s)}{const s=e.legendElements;if(s&&!s.length)return null;const i=s.map((s=>this._renderLegendForElement(s,e.layer))).filter((e=>!!e));if(!i.length)return null;const o={[Ye]:!!e.parent};return u("div",{key:t,class:this.classes(We,o),tabIndex:0},r,u("div",{class:Qe},i))}}_renderLegendForElement(e,s,t){const r="color-ramp"===e.type,i="opacity-ramp"===e.type,o="size-ramp"===e.type;let l=null;if("symbol-table"===e.type||o){const t=e.infos.map((t=>this._renderLegendForElementInfo(t,s,o,e.legendType))).filter((e=>!!e));t.length&&(l=u("div",{class:ss},t))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?l=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?l=T(e,this.id,s.opacity):"univariate-above-and-below-ramp"===e.type?l=this._renderUnivariateAboveAndBelowRamp(e,s.opacity):"univariate-color-size-ramp"===e.type&&(l=this._renderUnivariateColorSizeRamp(e,s.opacity));if(!l)return null;const n=e.title;let a=null;if("string"==typeof n)a=n;else if(n){const e=re(this.messages,n,r||i);a=ie(0,r||i)&&n.title?`${n.title} (${e})`:e}const c=t?Ke:Ze,p=a?u("div",{class:es},a):null,m={[Je]:o||!t};return u("div",{class:this.classes(c,m)},p,l)}_renderUnivariateAboveAndBelowRamp(e,s){const{sizeRampElement:t,colorRampElement:r}=ee(e,s),i=K(t,"above",!0),o=K(t,"below",!0),l=Z(r,{width:12,height:i,rampAlignment:"vertical",opacity:s,type:"above"}),n=Z(r,{width:12,height:o,rampAlignment:"vertical",opacity:s,type:"below"}),a=Y(t),c=t.infos.map((e=>e.label)),p=c.map(((e,s)=>{const t=2===s;return 0===s?u("div",{key:s,class:e?l?ys:hs:null},e):t?u("div",null):null})),m=c.length-1,d=Math.floor(c.length/2),h=c.map(((e,s)=>s===d||s===m?u("div",{key:s,class:e?l?ys:hs:null},e):null)),y={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${a}px`},v={height:`${i}px`},f={height:`${o}px`};return u("div",{key:"univariate-above-and-below-ramp-preview",styles:vs},u("div",{class:ss},t.infos.map(((e,s)=>u("div",{class:this.classes(ts,cs)},u("div",{class:ns,styles:y,bind:e.preview,afterCreate:te}),l||s%2!=0?null:u("div",{class:rs},c[s]))))),l?u("div",{styles:g,key:"color-ramp-preview"},u("div",{styles:fs},u("div",{styles:bs},u("div",{class:as,bind:l,afterCreate:te})),u("div",{styles:bs},u("div",{class:ds,styles:v},p))),u("div",{styles:fs},u("div",{styles:bs},u("div",{class:as,bind:n,afterCreate:te})),u("div",{styles:bs},u("div",{class:ds,styles:f},h)))):null)}_renderUnivariateColorSizeRamp(e,s){const{sizeRampElement:t,colorRampElement:r}=se(e),i=Y(t),o=K(t,"full",!1),l=Z(r,{width:12,height:o,rampAlignment:"vertical",opacity:s,type:"full"}),n=t.infos.length-1,a=t.infos.map(((e,s)=>0===s||s===n?u("div",{key:s,class:e.label?r?ys:hs:null},e.label):null)),c={display:"table-cell",verticalAlign:"middle"},p={marginTop:`${i}px`},m={height:`${o}px`};return u("div",{key:"univariate-above-and-below-ramp-preview",styles:vs},u("div",{class:ss},t.infos.map((e=>u("div",{class:this.classes(ts,cs)},u("div",{class:ns,styles:c,bind:e.preview,afterCreate:te}))))),u("div",{styles:p,key:"color-ramp-preview"},u("div",{styles:fs},u("div",{styles:bs},u("div",{class:as,bind:l,afterCreate:te})),u("div",{styles:bs},u("div",{class:ds,styles:m},a)))))}_renderLegendForRamp(e,s){const t=e.infos,r="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,o="stretch-ramp"===e.type,l=e.preview,n=r?ms:"";l.className=`${ps} ${n}`,null!=s&&(l.style.opacity=s.toString());const a=t.map((e=>u("div",{class:e.label?hs:null},i?this.messages[e.label]:o?this._getStretchStopLabel(e):e.label))),c={width:"24px"},p={height:l.style.height};return u("div",{class:ts},u("div",{class:ls,styles:c},u("div",{class:as,bind:l,afterCreate:te})),u("div",{class:rs},u("div",{class:ds,styles:p},a)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+o(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""}_renderLegendForElementInfo(e,s,t,r){if(e.type)return this._renderLegendForElement(e,s,!0);let i=null;const o=oe(s,r);if(e.preview?i=u("div",{class:ns,bind:e.preview,afterCreate:te}):e.src&&(i=this._renderImage(e,s,o)),!i)return null;const l={[os]:o},n={[os]:o,[cs]:!o&&t};return u("div",{class:ts},u("div",{class:this.classes(ls,n)},i),u("div",{class:this.classes(rs,l)},re(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:r,src:i,opacity:o}=e,l={[is]:t,[ns]:!t},n={opacity:`${null!=o?o:s.opacity}`};return u("img",{alt:re(this.messages,r,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}};e([s()],_s.prototype,"activeLayerInfos",void 0),e([s(),y("esri/widgets/Legend/t9n/Legend")],_s.prototype,"messages",void 0),e([s({readOnly:!0})],_s.prototype,"type",void 0),_s=e([t("esri.widgets.Legend.styles.Classic")],_s);var js=_s;const ks="esri-legend",ws="esri-widget",Ls="esri-widget--panel",Ss="esri-icon-layer-list";let xs=class extends g{constructor(e,s){super(e,s),this._handles=new a,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=Ss,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new js,this.view=null,this.viewModel=new x}initialize(){this.own(c(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),p(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof He||e instanceof js)return e;if("string"==typeof e)return"card"===e?new He:new js;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?He:js)(s)}return new js}render(){return u("div",{class:this.classes(ks,ws,this.style instanceof js?Ls:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=p(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const t=c(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(t,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([r("viewModel.activeLayerInfos")],xs.prototype,"activeLayerInfos",void 0),e([r("viewModel.basemapLegendVisible")],xs.prototype,"basemapLegendVisible",void 0),e([r("viewModel.groundLegendVisible")],xs.prototype,"groundLegendVisible",void 0),e([r("viewModel.keepCacheOnDestroy")],xs.prototype,"keepCacheOnDestroy",void 0),e([r("viewModel.respectLayerVisibility")],xs.prototype,"respectLayerVisibility",void 0),e([s()],xs.prototype,"iconClass",void 0),e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],xs.prototype,"label",void 0),e([r("viewModel.layerInfos")],xs.prototype,"layerInfos",void 0),e([s(),y("esri/widgets/Legend/t9n/Legend")],xs.prototype,"messages",void 0),e([s()],xs.prototype,"style",void 0),e([i("style")],xs.prototype,"castStyle",null),e([r("viewModel.view")],xs.prototype,"view",void 0),e([s()],xs.prototype,"viewModel",void 0),xs=e([t("esri.widgets.Legend")],xs);var Is=xs;export default Is;
