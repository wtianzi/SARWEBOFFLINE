/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../core/lang.js";import"../chunks/deprecate.js";import"../chunks/object.js";import"../kernel.js";import"../config.js";import{b as n}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{throwIfAborted as t}from"../core/promiseUtils.js";import"../chunks/Message.js";import e from"../core/Error.js";import"../chunks/ensureType.js";import"../core/accessorSupport/decorators/subclass.js";import"../chunks/JSONSupport.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import{e as r,j as s,a as o,i as u,b as l,c as i}from"./SpatialReference.js";import"../request.js";import"../chunks/assets.js";import"./Geometry.js";import a from"./Point.js";import{e as c,a as f,m as p}from"../chunks/Ellipsoid.js";import"./support/webMercatorUtils.js";import h from"./Extent.js";import{c as m,d,r as j,a as M}from"../chunks/mathUtils2.js";import{c as R}from"../chunks/vec3f64.js";import"../chunks/common.js";import{g as k,e as g,s as w,n as y,l as E}from"../chunks/vec3.js";import"../chunks/zmUtils.js";import x from"./Multipoint.js";import P from"./Polygon.js";import"../chunks/extentUtils.js";import S from"./Polyline.js";import{a as T,S as I,W as b,b as C,d as F}from"../chunks/unitUtils.js";import{i as U,t as q,s as v}from"../chunks/mat4.js";import{l as z,p as G,i as A}from"../chunks/pe.js";import{s as W}from"../chunks/aaBoundingRect.js";import{e as Z}from"../chunks/geodesicConstants.js";import"./support/GeographicTransformationStep.js";import _ from"./support/GeographicTransformation.js";let B=null,L=null,N=null,O={};function J(){return!!B&&A()}function K(){return!0}function V(e){return n(N)&&(N=Promise.all([z(),import("../chunks/geometryEngineBase.js").then((function(n){return n.g})),import("../chunks/hydrated.js")])),N.then((([,n,{hydratedAdapter:r}])=>{t(e),L=r,B=n.default,B._enableProjection(G)}))}function X(n,t,e=null){return Array.isArray(n)?0===n.length?[]:D(L,n,n[0].spatialReference,t,e):D(L,[n],n.spatialReference,t,e)[0]}function D(t,e,r,s,o=null){if(n(r)||n(s))return e;if(nn(r,s,o))return e.map((n=>function(n,t,e){if(!n)return n;if("x"in n){const r=new a;return sn(n,t,r,e)?r:null}if("xmin"in n){const r=new h;return hn(n,t,r,e)?r:null}if("rings"in n){const r=new P;return fn(n,t,r,e)?r:null}if("paths"in n){const r=new S;return an(n,t,r,e)?r:null}if("points"in n){const r=new x;return un(n,t,r,e)?r:null}return null}(n,r,s)));if(n(o)){const t=_.cacheKey(r,s);void 0!==O[t]?o=O[t]:(o=H(r,s,null),n(o)&&(o=new _),O[t]=o)}if(n(B))throw new Y;return B._project(t,e,r,s,o)}function H(t,e,r=null){if(n(B))throw new Y;if(n(t)||n(e))return null;const s=B._getTransformation(L,t,e,r,null==r?void 0:r.spatialReference);return null!==s?_.fromGE(s):null}function Q(t,e,r=null){if(n(B))throw new Y;const s=B._getTransformationBySuitability(L,t,e,r,null==r?void 0:r.spatialReference);if(null!==s){const n=[];for(const t of s)n.push(_.fromGE(t));return n}return[]}class Y extends e{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function $(){B=null,L=null,N=null,O={}}function nn(n,t,e){return!e&&(!!r(n,t)||s(n)&&s(t)&&!!$n(n,t,st))}async function tn(n,t){if(!J())for(const{source:e,dest:r,geographicTransformation:s}of n)if(!nn(e,r,s))return V(t)}function en(n,t){switch($n(n,t,st)){case Cn:return"copy3";case Bn:return"wgs84ToSphericalECEF";case zn:return"wgs84ToWebMercator";case Xn:return"wgs84ToWGS84ECEF";case Fn:return"webMercatorToWGS84";case Un:return"webMercatorToSphericalECEF";case qn:return"webMercatorToWGS84ECEF";case Dn:return"wgs84ECEFToWGS84";case Hn:return"wgs84ECEFToSphericalECEF";case Qn:return"wgs84ECEFToWebMercator";case Jn:return"sphericalECEFToWGS84";case Kn:return"sphericalECEFToWebMercator";case On:return"sphericalMarsPCPFToMars2000";case Nn:return"sphericalMoonPCPFToMoon2000";case Vn:return"sphericalECEFToWGS84ECEF";case _n:return"mars2000ToSphericalPCPF";case Zn:return"moon2000ToSphericalPCPF";default:return null}}function rn(t,e,r=e.spatialReference,s=0){return!n(r)&&sn(t,t.spatialReference,e,r,s)}function sn(n,t,e,r,s=0){ft[0]=n.x,ft[1]=n.y;const o=n.z;return ft[2]=void 0!==o?o:s,!!wn(ft,t,0,ft,r,0,1)&&(e.x=ft[0],e.y=ft[1],e.spatialReference=r,void 0===o?(e.z=void 0,e.hasZ=!1):(e.z=ft[2],e.hasZ=!0),void 0===n.m?(e.m=void 0,e.hasM=!1):(e.m=n.m,e.hasM=!0),!0)}function on(t,e,r=e.spatialReference,s=0){return!n(r)&&un(t,t.spatialReference,e,r,s)}function un(n,t,e,r,s=0){const{points:o,hasZ:u,hasM:l}=n,i=[],a=o.length,c=[];for(const n of o)c.push(n[0],n[1],u?n[2]:s);if(!wn(c,t,0,c,r,0,a))return!1;for(let n=0;n<a;++n){const t=3*n,e=c[t],r=c[t+1];u&&l?i.push([e,r,c[t+2],o[n][3]]):u?i.push([e,r,c[t+2]]):l?i.push([e,r,o[n][2]]):i.push([e,r])}return e.points=i,e.spatialReference=r,e.hasZ=u,e.hasM=l,!0}function ln(t,e,r=e.spatialReference,s=0){return!n(r)&&an(t,t.spatialReference,e,r,s)}function an(n,t,e,r,s=0){const{paths:o,hasZ:u,hasM:l}=n,i=[];return!!En(o,u,l,t,i,r,s)&&(e.paths=i,e.spatialReference=r,e.hasZ=u,e.hasM=l,!0)}function cn(t,e,r=e.spatialReference,s=0){return!n(r)&&fn(t,t.spatialReference,e,r,s)}function fn(n,t,e,r,s=0){const{rings:o,hasZ:u,hasM:l}=n,i=[];return!!En(o,u,l,t,i,r,s)&&(e.rings=i,e.spatialReference=r,e.hasZ=u,e.hasM=l,!0)}function pn(t,e,r=e.spatialReference,s=0){return!n(r)&&hn(t,t.spatialReference,e,r,s)}function hn(n,t,e,r,s=0){const{xmin:o,ymin:u,xmax:l,ymax:i,hasZ:a,hasM:c}=n;if(!Mn(o,u,a?n.zmin:s,t,ft,r))return!1;e.xmin=ft[0],e.ymin=ft[1],a&&(e.zmin=ft[2]);return!!Mn(l,i,a?n.zmax:s,t,ft,r)&&(e.xmax=ft[0],e.ymax=ft[1],a&&(e.zmax=ft[2]),c&&(e.mmin=n.mmin,e.mmax=n.mmax),e.spatialReference=r,!0)}function mn(t,e,r){if(n(e)||n(r))return null;const s=new a({spatialReference:r});return wn(t,e,0,ft,r,0,1)?(s.x=ft[0],s.y=ft[1],s.z=ft[2],s):null}function dn(n,t,e){return wn(n,t,0,ft,e.spatialReference,0,1)?(e.x=ft[0],e.y=ft[1],e.z=ft[2],e):null}function jn(n,t,e,r=0){ft[0]=n.x,ft[1]=n.y;const s=n.z;return ft[2]=void 0!==s?s:r,wn(ft,n.spatialReference,0,t,e,0,1)}function Mn(n,t,e,r,s,o){return it[0]=n,it[1]=t,it[2]=e,wn(it,r,0,s,o,0,1)}function Rn(t,e,r,s){return!(n(e)||n(s)||t.length<2)&&(2===t.length&&(it[0]=t[0],it[1]=t[1],it[2]=0,t=it),wn(t,e,0,r,s,0,1))}function kn(n,t){ft[0]=n.x,ft[1]=n.y;const e=n.z;return ft[2]=void 0!==e?e:0,gn(ft,n.spatialReference,t)}function gn(t,e,r){return function(t,e,r,s){if(n(e))return!1;const o=bn(e,et),u=Yn[o][s];if(n(u))return!1;u(t,0,it,0),r!==it&&(r[0]=it[0],r[1]=it[1],r.length>2&&(r[2]=it[2]));return!0}(t,e,r,6)}function wn(t,e,r,s,o,u,l=1){const i=$n(e,o,st);if(n(i))return!1;if(i===Cn){if(t===s&&r===u)return!0;const n=r+3*l;for(let e=r,o=u;e<n;e++,o++)s[o]=t[e];return!0}const a=r+3*l;for(let n=r,e=u;n<a;n+=3,e+=3)i(t,n,s,e);return!0}function yn(n,t,e,r,s){k(ft,n),g(pt,n,t),Rn(ft,e,ft,s),Rn(pt,e,pt,s),w(r,pt,ft),y(r,r)}function En(n,t,e,r,s,o,u=0){const l=new Array;for(const e of n)for(const n of e)l.push(n[0],n[1],t?n[2]:u);if(!wn(l,r,0,l,o,0,l.length/3))return!1;let i=0;s.length=0;for(const r of n){const n=new Array;for(const s of r)t&&e?n.push([l[i++],l[i++],l[i++],s[3]]):t?n.push([l[i++],l[i++],l[i++]]):e?(n.push([l[i++],l[i++],s[2]]),i++):(n.push([l[i++],l[i++]]),i++);s.push(n)}return!0}function xn(t,e,r,s){if(n(e)||n(s))return!1;const o=nt(e,s,ot);if(o.projector===Cn)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(n(o.projector))return!1;const{source:u,dest:l}=o;if(3===l.spatialReferenceId){const e=Yn[u.spatialReferenceId][2];if(n(e))return!1;e(t,0,at,0);const s=Math.abs(ut*at[1])+Math.asin(t[3]/(c.radius+t[2]));if(zn(at,0,r,0),s>.9999*Math.PI)r[3]=Number.MAX_VALUE;else{const n=1/Math.cos(s);r[3]=n*t[3]}return!0}return o.projector(t,0,r,0),r[3]=t[3]*u.metersPerUnit/l.metersPerUnit,!0}function Pn(n,t,e,s){return null!=n&&(r(t,s)?(W(e,n),!0):(it[0]=n[0],it[1]=n[1],it[2]=0,!!wn(it,t,0,it,s,0,1)&&(e[0]=it[0],e[1]=it[1],it[0]=n[2],it[1]=n[3],it[2]=0,!!wn(it,t,0,it,s,0,1)&&(e[2]=it[0],e[3]=it[1],!0))))}function Sn(t,e,s,o){if(n(e)||n(o))return!1;const u=bn(e,et),l=bn(o,rt);if(u===l&&0!==u||r(e,o))return s[0]=1,s[1]=1,s[2]=1,!0;if(1===u){const n=E(t),e=n/Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=n/c.radius;if(3===l)return s[0]=e*r,s[1]=e*r,s[2]=1,!0;if(2===l||5===l){const n=180/(c.radius*Math.PI);return s[0]=n*e*r,s[1]=n*r,s[2]=1,!0}}return!1}function Tn(t,e,s,o){if(n(t)||n(o))return!1;const u=bn(t,et),l=bn(o,rt);if(u===l&&1!==l&&(0!==u||r(t,o)))return U(s),q(s,s,e),!0;if(1===l||7===l||9===l){let t=0,r=0;if(1===l){const s=Yn[u][6],o=Yn[6][l];if(n(s)||n(o))return!1;s(e,0,at,0),o(at,0,ct,0),t=ut*at[0],r=ut*at[1]}else if(7===l||9===l){const s=Yn[u][l];if(n(s))return!1;s(e,0,ct,0),t=ut*e[0],r=ut*e[1]}return In(r,t,s),s[12]=ct[0],s[13]=ct[1],s[14]=ct[2],!0}if(3===l&&(2===u||1===u)){const t=Yn[u][6];if(n(t))return!1;t(e,0,at,0);const r=ut*at[1];zn(at,0,ct,0),U(s),q(s,s,ct);const o=1/Math.cos(r);return v(s,s,[o,o,1]),!0}return!1}function In(n,t,e){const r=Math.sin(t),s=Math.cos(t),o=Math.sin(n),u=Math.cos(n),l=e;return l[0]=-r,l[4]=-o*s,l[8]=u*s,l[12]=0,l[1]=s,l[5]=-o*r,l[9]=u*r,l[13]=0,l[2]=0,l[6]=u,l[10]=o,l[14]=0,l[3]=0,l[7]=0,l[11]=0,l[15]=1,l}function bn(n,t){return t.spatialReference===n?t.spatialReferenceId:(t.spatialReference=n,"metersPerUnit"in t&&(t.metersPerUnit=T(n,1)),n.wkt===I.wkt?t.spatialReferenceId=1:o(n)?t.spatialReferenceId=2:u(n)?t.spatialReferenceId=3:n.wkt===b.wkt?t.spatialReferenceId=4:4490===n.wkid?t.spatialReferenceId=5:n.wkt===C.wkt?t.spatialReferenceId=7:n.wkt===F.wkt?t.spatialReferenceId=9:l(n)?t.spatialReferenceId=8:i(n)?t.spatialReferenceId=10:t.spatialReferenceId=0)}function Cn(n,t,e,r){n!==e&&(e[r++]=n[t++],e[r++]=n[t++],e[r]=n[t])}function Fn(n,t,e,r){e[r++]=lt*(n[t++]/c.radius),e[r++]=lt*(Math.PI/2-2*Math.atan(Math.exp(-1*n[t++]/c.radius))),e[r]=n[t]}function Un(n,t,e,r){Fn(n,t,e,r),Bn(e,r,e,r)}function qn(n,t,e,r){Fn(n,t,e,r),Xn(e,r,e,r)}function vn(n,t,e,r,s){const o=.4999999*Math.PI,u=m(ut*n[t+1],-o,o),l=Math.sin(u);e[r++]=ut*n[t]*s.radius,e[r++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),e[r]=n[t+2]}function zn(n,t,e,r){vn(n,t,e,r,c)}function Gn(t){if(n(t))return!1;const e=bn(t,et);return!!Yn[e][6]}function An(n,t,e,r,s=0){const o=r+s,u=Math.cos(e);n[0]=Math.cos(t)*u*o,n[1]=Math.sin(t)*u*o,n[2]=Math.sin(e)*o}function Wn(n,t,e,r,s){const o=s+n[t+2],u=ut*n[t+1],l=ut*n[t],i=Math.cos(u);e[r++]=Math.cos(l)*i*o,e[r++]=Math.sin(l)*i*o,e[r]=Math.sin(u)*o}function Zn(n,t,e,r){Wn(n,t,e,r,f.radius)}function _n(n,t,e,r){Wn(n,t,e,r,p.radius)}function Bn(n,t,e,r){Wn(n,t,e,r,c.radius)}function Ln(n,t,e,r,s){const o=n[t],u=n[t+1],l=n[t+2],i=Math.sqrt(o*o+u*u+l*l),a=M(l/(0===i?1:i)),c=Math.atan2(u,o);e[r++]=lt*c,e[r++]=lt*a,e[r]=i-s}function Nn(n,t,e,r){Ln(n,t,e,r,f.radius)}function On(n,t,e,r){Ln(n,t,e,r,p.radius)}function Jn(n,t,e,r){Ln(n,t,e,r,c.radius)}function Kn(n,t,e,r){Jn(n,t,e,r),zn(e,r,e,r)}function Vn(n,t,e,r){Jn(n,t,e,r),Xn(e,r,e,r)}function Xn(n,t,e,r){!function(n,t,e,r,s){const o=ut*n[t],u=ut*n[t+1],l=n[t+2],i=Math.sin(u),a=Math.cos(u),c=s.radius/Math.sqrt(1-s.eccentricitySquared*i*i);e[r++]=(c+l)*a*Math.cos(o),e[r++]=(c+l)*a*Math.sin(o),e[r++]=(c*(1-s.eccentricitySquared)+l)*i}(n,t,e,r,c)}function Dn(n,t,e,r){const s=Z,o=n[t],u=n[t+1],l=n[t+2];let i,a,f,p,h,m,d,j,M,R,k,g,w,y,E,x,P,S,T,I,b;i=Math.abs(l),a=o*o+u*u,f=Math.sqrt(a),p=a+l*l,h=Math.sqrt(p),I=Math.atan2(u,o),m=l*l/p,d=a/p,y=s.a2/h,E=s.a3-s.a4/h,d>.3?(j=i/h*(1+d*(s.a1+y+m*E)/h),T=Math.asin(j),R=j*j,M=Math.sqrt(1-R)):(M=f/h*(1-m*(s.a5-y-d*E)/h),T=Math.acos(M),R=1-M*M,j=Math.sqrt(R)),k=1-c.eccentricitySquared*R,g=c.radius/Math.sqrt(k),w=s.a6*g,y=f-g*M,E=i-w*j,P=M*y+j*E,x=M*E-j*y,S=x/(w/k+P),T+=S,b=P+x*S/2,l<0&&(T=-T),e[r++]=lt*I,e[r++]=lt*T,e[r]=b}function Hn(n,t,e,r){Dn(n,t,e,r),Bn(e,r,e,r)}function Qn(n,t,e,r){Dn(n,t,e,r),zn(e,r,e,r)}const Yn={2:{5:null,8:null,10:null,6:Cn,1:Bn,7:null,9:null,0:null,3:zn,2:Cn,4:Xn},5:{5:Cn,8:null,10:null,6:Cn,1:Bn,7:null,9:null,0:null,3:null,2:null,4:Xn},8:{5:null,8:Cn,10:null,6:null,1:null,7:_n,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:Cn,6:null,1:null,7:null,9:Zn,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,6:Fn,1:Un,7:null,9:null,0:null,3:Cn,2:Fn,4:qn},4:{5:Dn,8:null,10:null,6:Dn,1:Hn,7:null,9:null,0:null,3:Qn,2:Dn,4:Cn},1:{5:Jn,8:null,10:null,6:Jn,1:Cn,7:null,9:null,0:null,3:Kn,2:Jn,4:Vn},7:{5:null,8:On,10:null,6:null,1:null,7:Cn,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:Nn,6:null,1:null,7:null,9:Cn,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,6:null,1:null,7:null,9:null,0:Cn,3:null,2:null,4:null},6:{5:null,8:null,10:null,6:Cn,1:Bn,7:null,9:null,0:null,3:null,2:Cn,4:Xn}};function $n(t,e,r=tt()){return n(t)||n(e)?null:nt(t,e,r).projector}function nt(t,e,s){if(n(t)||n(e)||s.source.spatialReference===t&&s.dest.spatialReference===e)return s;const o=bn(t,s.source),u=bn(e,s.dest);return 0===o&&0===u?r(t,e)?s.projector=Cn:s.projector=null:s.projector=Yn[o][u],s}function tt(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Cn}}const et={spatialReference:null,spatialReferenceId:0},rt={spatialReference:null,spatialReferenceId:0},st=tt(),ot=tt(),ut=d(1),lt=j(1),it=R(),at=R(),ct=R(),ft=R(),pt=R();export{Gn as canProjectToWGS84ComparableLonLat,nn as canProjectWithoutEngine,In as computeLatLonToENURotation,Tn as computeLinearTransformation,en as getProjectorName,H as getTransformation,Q as getTransformations,tn as initializeProjection,J as isLoaded,K as isSupported,V as load,Sn as localLinearScaleFactors,An as lonLatToSphericalPCPF,vn as lonLatToWebMercatorComparable,X as project,Pn as projectBoundingRect,xn as projectBoundingSphere,wn as projectBuffer,yn as projectDirection,pn as projectExtent,D as projectMany,on as projectMultipoint,rn as projectPoint,jn as projectPointToVector,kn as projectPointToWGS84ComparableLonLat,cn as projectPolygon,ln as projectPolyline,dn as projectVectorToDehydratedPoint,mn as projectVectorToPoint,Rn as projectVectorToVector,gn as projectVectorToWGS84ComparableLonLat,Mn as projectXYZToVector,Ln as sphericalPCPFtoLonLatElevation,$ as unload};
