self.webpackChunkRemoteClient([78],{400:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(17),r(1),r(50),r(197),r(299);function n(e,t,r,n){const s=e.clone(),o=1<<s.level,i=s.col+t,a=s.row+r;return n&&i<0?(s.col=i+o,s.world-=1):i>=o?(s.col=i-o,s.world+=1):s.col=i,s.row=a,s}},441:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(11),s=(r(1),r(0),r(7)),o=(r(5),r(13)),i=(r(14),r(21),r(274));let a=class extends i.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(n.a)([Object(s.d)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),Object(n.a)([Object(s.d)({constructOnly:!0})],a.prototype,"remoteClient",void 0),Object(n.a)([Object(s.d)({constructOnly:!0})],a.prototype,"service",void 0),Object(n.a)([Object(s.d)()],a.prototype,"spatialReference",null),Object(n.a)([Object(s.d)({constructOnly:!0})],a.prototype,"tileInfo",void 0),Object(n.a)([Object(s.d)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=Object(n.a)([Object(o.g)("esri.views.2d.layers.features.processors.BaseProcessor")],a);var c=a},539:function(e,t,r){"use strict";r.r(t);var n=r(11),s=(r(17),r(1)),o=(r(19),r(4),r(6),r(0)),i=(r(9),r(3),r(7),r(15),r(16),r(12),r(2),r(10),r(8),r(5),r(13)),a=(r(68),r(72),r(42),r(14),r(48),r(43),r(47),r(45),r(44),r(21),r(46),r(51),r(52),r(49),r(54),r(50),r(53),r(65),r(63),r(62),r(60),r(61),r(67),r(59),r(64),r(78),r(71),r(79),r(80),r(82),r(190),r(225)),c=(r(172),r(169),r(20),r(173),r(274),r(170),r(212),r(197),r(213),r(299),r(287));(()=>{if(!("document"in s.h))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");e.height=512,e.width=1})();function l(e,t,r,n){const{blurRadius:s,fieldOffset:o,field:i}=t,a=new Float64Array(r*n),c=function(e){const t=Math.round(3*e),r=2*e*e,n=new Float64Array(2*t+1);for(let s=0;s<=n.length;s++)n[s]=Math.exp(-((s-t)**2)/r)/Math.sqrt(2*Math.PI)*(e/2);return n}(s),l=Math.round(3*s);let d,u=Number.NEGATIVE_INFINITY;const h=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(i,o),f=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const s=e.readLegacyPointGeometry(),o=128;if(s.x<-o||s.x>=r+o||s.y<-o||s.y>n+o)continue;const i=+h(e),p=Math.round(s.x)-l,y=Math.round(s.y)-l,O=Math.max(0,p),b=Math.max(0,y),m=Math.min(n,Math.round(s.y)+l),j=Math.min(r,Math.round(s.x)+l);for(let e=b;e<m;e++){const t=c[e-y];for(let n=O;n<j;n++){const s=c[n-p];d=a[e*r+n]+=t*s*i,d>u&&(u=d)}}}}return{matrix:a.buffer,max:u}}var d=r(400),u=r(441);class h{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends u.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&Object(a.b)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const n=this._tileKeyToFeatureSets.get(e.key.id);if(Object(o.h)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&n.set(t.addOrUpdate.instance,t),t.end){const t=[],n=function(e){const t=e.key,r=new Map,n=256,s=c.j,o=e.tileInfoView.tileInfo.isWrappable;return r.set(Object(d.a)(t,-1,-1,o).id,new h([-s,-s],[s-n,s-n,s,s])),r.set(Object(d.a)(t,0,-1,o).id,new h([0,-s],[0,s-n,s,s])),r.set(Object(d.a)(t,1,-1,o).id,new h([s,-s],[0,s-n,n,s])),r.set(Object(d.a)(t,-1,0,o).id,new h([-s,0],[s-n,0,s,s])),r.set(Object(d.a)(t,1,0,o).id,new h([s,0],[0,0,n,s])),r.set(Object(d.a)(t,-1,1,o).id,new h([-s,s],[s-n,0,s,n])),r.set(Object(d.a)(t,0,1,o).id,new h([0,s],[0,0,s,n])),r.set(Object(d.a)(t,1,1,o).id,new h([s,s],[0,0,n,n])),r}(e);this._tileKeyToFeatureSets.forEach((r,s)=>{if(s===e.key.id)r.forEach(e=>Object(o.m)(e.addOrUpdate,e=>t.push(e)));else if(n.has(s)){const e=n.get(s),[i,a]=e.offset;r.forEach(e=>Object(o.m)(e.addOrUpdate,e=>{const r=e.transform(i,a,1,1);t.push(r)}))}});const s=l(t,this._schema.mesh,512,512),i={tileKey:e.key.id,intensityInfo:s},a=[s.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",i,{...r,transferList:a})}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};f=Object(n.a)([Object(i.g)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);var p=f;t.default=p}});