/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import"../core/lang.js";import{i as r}from"./Logger.js";import"../core/accessorSupport/decorators/property.js";import s from"../core/Error.js";import"./ensureType.js";import{subclass as t}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"./resourceExtension.js";import{unpackFieldNames as o,populateMissingFields as a}from"../layers/support/fieldUtils.js";import{g as p,a as i}from"./popupUtils.js";const c=c=>{let n=class extends c{_validateFetchPopupFeatures(e){const{layer:r}=this,{popupEnabled:t}=r;if(!t)return new s("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:r});return p(r,e)?void 0:new s("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:r})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,s){const t=this._validateFetchPopupFeatures(s);if(t)return Promise.reject(t);const c=r(s)?s.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const n=[],u=[],l="scene"===this.layer.type&&r(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,h=o(this.layer.fields,await i(l,p(this.layer,s)));await this.prepareFetchPopupFeatures(h);const y=new Set;for(const e of c)a(h,e,y)?u.push(e):n.push(e);return 0===u.length?Promise.resolve(n):this.whenGraphicAttributes(u,[...y]).catch((()=>u)).then((e=>n.concat(e)))}};return n=e([t("esri.views.3d.layers.support.PopupSceneLayerView")],n),n};export{c as P};
