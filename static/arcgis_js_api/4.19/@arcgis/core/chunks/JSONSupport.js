/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as r}from"./tslib.es6.js";import{L as e}from"./Logger.js";import{g as t,m as o}from"./metadata.js";import{v as n,e as s}from"../core/accessorSupport/decorators/property.js";import i from"../core/Accessor.js";import{n as a,i as u}from"./PropertyOrigin.js";import{e as c}from"../core/scheduling.js";import f from"../core/Error.js";import{o as l,a as d,b as p,subclass as g}from"../core/accessorSupport/decorators/subclass.js";function m(r,e,t){if(!r||!r.read||!1===r.read.enabled||!r.read.source)return!1;const o=r.read.source;if("string"==typeof o){if(o===e)return!0;if(o.indexOf(".")>-1&&0===o.indexOf(e)&&s(o,t))return!0}else for(const r of o){if(r===e)return!0;if(r.indexOf(".")>-1&&0===r.indexOf(e)&&s(r,t))return!0}return!1}function O(r,e,t,o,n){let s=l(e[t],n);(function(r){return r&&(!r.read||!1!==r.read.enabled&&!r.read.source)})(s)&&(r[t]=!0);for(const i of Object.getOwnPropertyNames(e))s=l(e[i],n),m(s,t,o)&&(r[i]=!0)}function w(r,e,t,o){const n=t.metadatas,s=d(n[e],"any",o),i=s&&s.default;if(void 0===i)return;const a="function"==typeof i?i.call(r,e,o):i;void 0!==a&&t.set(e,a)}const y={origin:"service"};function N(r,e,o=y){if(!e||"object"!=typeof e)return;const s=t(r),i=s.metadatas,a={};for(const r of Object.getOwnPropertyNames(e))O(a,i,r,e,o);s.setDefaultOrigin(o.origin);for(const t of Object.getOwnPropertyNames(a)){const a=l(i[t],o).read,u=a&&a.source;let c;c=u&&"string"==typeof u?n(e,u):e[t],a&&a.reader&&(c=a.reader.call(r,c,e,o)),void 0!==c&&s.set(t,c)}if(!o||!o.ignoreDefaults)for(const e of Object.getOwnPropertyNames(i))a[e]||w(r,e,s,o);s.setDefaultOrigin("user")}function v(r,e,t,o=y){var n;const s={...o,messages:[]};t(s),null==(n=s.messages)||n.forEach((e=>{"warning"!==e.type||r.loaded?o&&o.messages&&o.messages.push(e):r.loadWarnings.push(e)}))}const h=e.getLogger("esri.core.accessorSupport.write");function j(r,e,t,o,n){var s,i;const a={};return null==(s=e.write)||null==(i=s.writer)||i.call(r,o,a,t,n),a}function S(r,e,t,o,n,s){if(!o||!o.write)return!1;const i=r.get(t);if(!n&&o.write.overridePolicy){const e=o.write.overridePolicy.call(r,i,t,s);void 0!==e&&(n=e)}if(n||(n=o.write),!n||!1===n.enabled)return!1;if((null===i&&!n.allowNull||void 0===i)&&n.isRequired){const e=new f("web-document-write:property-required",`Missing value for required property '${t}' on '${r.declaredClass}'`,{propertyName:t,target:r});return e&&s&&s.messages?s.messages.push(e):e&&!s&&h.error(e.name,e.message),!1}if(void 0===i)return!1;if(null===i&&!n.allowNull)return!1;if(function(r,e,t,o,n){const s=o.default;if(void 0===s)return!1;if(null!=o.defaultEquals)return o.defaultEquals(n);if("function"==typeof s){if(Array.isArray(n)){const o=s.call(r,e,t);return c(o,n)}return!1}return s===n}(r,t,s,o,i))return!1;if(void 0!==o.default)return!0;if(!n.ignoreOrigin&&s&&s.origin){if(e.store.originOf(t)<a(s.origin))return!1}return!0}function b(r,e,o,n){const s=t(r),i=s.metadatas,a=p(i[e],n);return!!a&&S(r,s,e,a,o,n)}function J(r,e,n){if(r&&"function"==typeof r.toJSON&&(!r.toJSON.isDefaultToJSON||!r.write))return o(e,r.toJSON());const s=t(r),i=s.metadatas;for(const t in i){const f=p(i[t],n);if(!S(r,s,t,f,void 0,n))continue;const l=r.get(t),d=j(r,f,f.write&&"string"==typeof f.write.target?f.write.target:t,l,n);var a,c;if(Object.keys(d).length>0)e=o(e,d),null!=n&&null!=(a=n.resources)&&null!=(c=a.pendingOperations)&&c.length&&Promise.all(n.resources.pendingOperations).then((()=>o(e,d))),n&&n.writtenProperties&&n.writtenProperties.push({target:r,propName:t,oldOrigin:u(s.store.originOf(t)),newOrigin:n.origin})}return e}const P=e=>{let t=class extends e{constructor(...r){super(...r)}read(r,e){N(this,r,e)}write(r={},e){return J(this,r,e)}toJSON(r){return this.write({},r)}static fromJSON(r,e){return x.call(this,r,e)}};return t=r([g("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function x(r,e){if(!r)return null;if(r.declaredClass)throw new Error("JSON object is already hydrated");const t=new this;return t.read(r,e),t}let q=class extends(P(i)){};q=r([g("esri.core.JSONSupport")],q);export{P as J,q as a,N as b,b as c,v as r,J as w};
