/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"./tslib.es6.js";import"./ArrayPool.js";import"../core/lang.js";import"./deprecate.js";import"./object.js";import"../kernel.js";import"../config.js";import{u as t,e as r}from"./Logger.js";import"./string.js";import"./metadata.js";import"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"./PropertyOrigin.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"./Message.js";import"../core/Error.js";import"./compilerUtils.js";import"./ensureType.js";import"../core/accessorSupport/decorators/subclass.js";import"./JSONSupport.js";import"./asyncUtils.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/cast.js";import"./jsonMap.js";import"./reader.js";import"./writer.js";import"./resourceExtension.js";import"./persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../request.js";import"./assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"./Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"./mathUtils2.js";import{f as e}from"./vec3f64.js";import"./common.js";import"./vec3.js";import"./mathUtils.js";import"./colorUtils.js";import"../Color.js";import"./zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"./extentUtils.js";import"../geometry/Polyline.js";import"./screenUtils.js";import"./uid.js";import"./unitUtils.js";import"./Version.js";import"./mat4.js";import"./pe.js";import"./aaBoundingRect.js";import"./geodesicConstants.js";import"../geometry/support/GeographicTransformationStep.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/projection.js";import"./_commonjsHelpers.js";import{f as o}from"./vec4f64.js";import"./screenshotUtils.js";import s from"../geometry/support/MeshTexture.js";import"../geometry/support/MeshMaterial.js";import i from"../geometry/support/MeshMaterialMetallicRoughness.js";import"../geometry/support/MeshComponent.js";import"./earcut.js";import"./deduplicate.js";import"./triangulationUtils.js";import{a}from"./quatf64.js";import{n as m}from"./mat3.js";import{B as p,a as n,f as c,d as u,h as l,l as j,m as f,n as g}from"./BufferView.js";import"./vec2.js";import"./vec4.js";import"./projection.js";import{g as d}from"../geometry/Mesh.js";import{t as y,a as h,s as b,b as x}from"./vec32.js";import"./quat.js";import"./aaBoundingBox.js";import"./vec2f64.js";import"./VertexColor.glsl.js";import"./Program.js";import"./FramebufferObject.js";import"./renderState.js";import"./InterleavedLayout.js";import"./mat4f32.js";import"./vec3f32.js";import"./stack.js";import"./geometryUtils.js";import"./Util.js";import"./Object3D.js";import"./VertexArrayObject.js";import"./intersectorUtils.js";import"./PiUtils.glsl.js";import"./GLMaterialTexture.js";import"./VerticalOffset.glsl.js";import"./PhysicallyBasedRendering.glsl.js";import"./testSVGPremultipliedAlpha.js";import{l as v,n as U,o as M,v as w,w as S,x as B,p as T,q as C,s as P,r as E,y as O,u as R,k as A,b as V}from"./vec42.js";async function q(U,q,k){const N=new V,z=(await v(N,q,k,!0)).model,D=z.lods.shift(),H=new Map,I=new Map;return z.textures.forEach(((t,r)=>{return H.set(r,new s({data:(e=t).data,wrap:G(e.parameters.wrap)}));var e})),z.materials.forEach(((s,a)=>I.set(a,function(s,a){const m=(c=s.color,u=s.opacity,o(L(c[0]),L(c[1]),L(c[2]),u)),p=s.emissiveFactor?function(t){return e(L(t[0]),L(t[1]),L(t[2]))}(s.emissiveFactor):null,n={color:m,colorTexture:t(r(s.textureColor,(t=>a.get(t)))),normalTexture:t(r(s.textureNormal,(t=>a.get(t)))),emissiveColor:p,emissiveTexture:t(r(s.textureEmissive,(t=>a.get(t)))),occlusionTexture:t(r(s.textureOcclusion,(t=>a.get(t)))),alphaMode:F(s.alphaMode),alphaCutoff:s.alphaCutoff,doubleSided:s.doubleSided,metallic:s.metallicFactor,roughness:s.roughnessFactor,metallicRoughnessTexture:t(r(s.textureMetallicRoughness,(t=>a.get(t))))};var c,u;return new i(n)}(s,H)))),D.parts.map((e=>function(e,o,s,i){const v=M(p,s.attributes.position.count);y(v,s.attributes.position,s.transform);const U=r(s.attributes.normal,(t=>{const r=M(n,t.count),e=m(a(),s.transform);return h(r,t,e),r.typedBuffer})),V=r(s.attributes.tangent,(t=>{const r=M(c,t.count),e=m(a(),s.transform);return T(r,t,e),r.typedBuffer})),q=r(s.attributes.texCoord0,(t=>{const r=M(u,t.count);return C(r,t),r.typedBuffer})),F=r(s.attributes.color,(t=>{const r=M(l,t.count);if(4===t.elementCount)t instanceof c?P(r,t,255):t instanceof l?E(r,t):t instanceof j&&O(r,t,8);else{R(r,255,255,255,255);const e=new f(r.buffer,0,4);t instanceof n?b(e,t,255):t instanceof f?A(e,t):t instanceof g&&x(e,t,8)}return r.typedBuffer})),G=d({position:v.typedBuffer,normal:t(U),tangent:t(V)},e,{...i,unit:"meters"}),k=function(t,r){switch(r){case 4:return B(t);case 5:return S(t);case 6:return w(t)}}(s.indices||s.attributes.position.count,s.primitiveType);return{vertexAttributes:{position:G.position,normal:G.normal,tangent:G.tangent,uv:t(q),color:t(F)},components:[{faces:k,material:o.get(s.material),trustSourceNormals:!0}],spatialReference:e.spatialReference}}(U,I,e,k)))}function F(t){switch(t){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function G(t){return{horizontal:k(t.s),vertical:k(t.t)}}function k(t){switch(t){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}function L(t){return t**(1/U)*255}export{q as loadGLTFMesh};
