/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"../core/lang.js";import{i as e}from"./Logger.js";import t from"../core/Error.js";import{p as n}from"./arcgisLayerUrl.js";import i from"../geometry/HeightModelInfo.js";function a(e,n){if(!e)return null;if(!s(e))return new t("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const a=e.heightUnit,r=i.deriveUnitFromSR(e,n).heightUnit;return a!==r?new t("webscene:incompatible-height-unit",`The vertical units of the scene (${a}) must match the horizontal units of the scene (${r})`,{verticalUnit:a,horizontalUnit:r}):null}function r(e,n,a){const r=o(e),c=n,l=function(e,t,n){if(!s(e)||!s(t))return 4;if(null==e||null==t)return 0;if(!n&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}(r,c,a);{let n=null;if(r){const s=i.deriveUnitFromSR(r,e.spatialReference).heightUnit;a||s===r.heightUnit||(n=new t("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${s})`,{horizontalUnit:s}))}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!h(e)}(e)||4===l||n)return new t("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:n})}{let e=null;switch(l){case 1:{const n=r.heightUnit||"unknown",i=c.heightUnit||"unknown";e=new t("layerview:incompatible-height-unit",`The vertical units of the layer (${n}) must match the vertical units of the scene (${i})`,{layerUnit:n,sceneUnit:i});break}case 2:{const n=r.heightModel||"unknown",i=c.heightModel||"unknown";e=new t("layerview:incompatible-height-model",`The height model of the layer (${n}) must match the height model of the scene (${i})`,{layerHeightModel:n,sceneHeightModel:i});break}case 3:{const n=r.vertCRS||"unknown",i=c.vertCRS||"unknown";e=new t("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${n}) must match the vertical datum of the scene (${i})`,{layerDatum:n,sceneDatum:i});break}}if(e)return new t("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:c,error:e})}return null}function s(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function o(t){const a=t.url&&n(t.url);return!(null==(t.spatialReference&&t.spatialReference.vcsWkid)&&e(a)&&"ImageServer"===a.serverType)&&c(t)&&t.heightModelInfo?t.heightModelInfo:h(t)?i.deriveUnitFromSR(g,t.spatialReference):null}function c(e){return"heightModelInfo"in e}function l(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function h(e){return l(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function u(e){return null!=e.layers||m(e)||l(e)||c(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1}return!1}const g=new i({heightModel:"gravity-related-height"});export{o as d,u as m,r,a as v};
