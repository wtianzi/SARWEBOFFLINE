/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import{clone as r}from"../core/lang.js";import{a as s}from"./Logger.js";import{g as e}from"./metadata.js";import i from"../core/Accessor.js";import{O as o,a as n,n as a}from"./PropertyOrigin.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import{b as p}from"./JSONSupport.js";class g{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(o),this._values=new Map}clone(t){const s=new g,e=this._originStores[0];e&&e.forEach(((t,e)=>{s.set(e,r(t),0)}));for(let e=2;e<o;e++){const i=this._originStores[e];i&&i.forEach(((i,o)=>{t&&t.has(o)||s.set(o,r(i),e)}))}return s}get(t,r){const s=void 0===r?this._values:this._originStores[r];return s?s.get(t):void 0}keys(t){const r=null==t?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,e=6){let i=this._originStores[e];if(i||(i=new Map,this._originStores[e]=i),i.set(t,r),!this._values.has(t)||s(this._propertyOriginMap.get(t))<=e){const s=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,e),s!==r}return!1}delete(t,r=6){const s=this._originStores[r];if(!s)return;const e=s.get(t);if(s.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let s=r-1;s>=0;s--){const r=this._originStores[s];if(r&&r.has(t)){this._values.set(t,r.get(t)),this._propertyOriginMap.set(t,s);break}}}return e}has(t,r){const s=void 0===r?this._values:this._originStores[r];return!!s&&s.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const s=this._originStores[r],e=s&&s.get(t),i=this._values.get(t);return this._values.set(t,e),this._propertyOriginMap.set(t,r),i!==e}originOf(t){return this._propertyOriginMap.get(t)||0}forEach(t){this._values.forEach(t)}}const c=r=>{let i=class extends r{constructor(...t){super(...t);const r=s(e(this)),i=r.metadatas,o=r.store,n=new g;r.store=n,o.keys().forEach((t=>{n.set(t,o.get(t),0)})),Object.keys(i).forEach((t=>{r.internalGet(t)&&n.set(t,r.internalGet(t),0)}))}read(t,r){p(this,t,r)}getAtOrigin(t,r){const s=u(this),e=a(r);if("string"==typeof t)return s.get(t,e);const i={};return t.forEach((t=>{i[t]=s.get(t,e)})),i}originOf(t){return n(this.originIdOf(t))}originIdOf(t){return u(this).originOf(t)}revert(t,r){const s=u(this),i=a(r),o=e(this);let n;n="string"==typeof t?"*"===t?s.keys(i):[t]:t,n.forEach((t=>{o.propertyInvalidated(t),s.revert(t,i),o.propertyCommitted(t)}))}};return i=t([h("esri.core.ReadOnlyMultiOriginJSONSupport")],i),i};function u(t){return e(t).store}let l=class extends(c(i)){};l=t([h("esri.core.ReadOnlyMultiOriginJSONSupport")],l);export{c as R};
