/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{i as e}from"./Logger.js";import{urlToObject as r,removeTrailingSlash as t,removeQueryParameters as n,join as s,Url as i,makeAbsolute as o}from"../core/urlUtils.js";import{w as a}from"./persistableUrlUtils.js";const l=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],u=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${l.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${l.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),f=/(.*)\/(\d+)\/?$/i;function p(e){return!!u.test(e)}function d(e){const t=r(e),n=t.path.match(u)||t.path.match(c);if(!n)return null;const[,s,i,o,a]=n,l=i.indexOf("/");return{title:v(-1!==l?i.slice(l+1):i),serverType:o,sublayer:null!=a&&""!==a?parseInt(a,10):null,url:{path:s}}}function m(e){const t=r(e).path.match(f);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function v(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function h(r,t){const n=[];if(r){const t=d(r);e(t)&&t.title&&n.push(t.title)}if(t){const e=v(t);n.push(e)}if(2===n.length){if(-1!==n[0].toLowerCase().indexOf(n[1].toLowerCase()))return n[0];if(-1!==n[1].toLowerCase().indexOf(n[0].toLowerCase()))return n[1]}return n.join(" - ")}function w(e){if(!e)return!1;const r=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),t=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return r&&t}function g(e,r){return e?t(n(e,r)):e}function x(s){let{url:i}=s;if(!i)return{url:i};i=n(i,s.logger);const o=r(i),a=d(o.path);let l;if(e(a))null!=a.sublayer&&null==s.layer.layerId&&(l=a.sublayer),i=a.url.path;else if(s.nonStandardUrlAllowed){const r=m(o.path);e(r)&&(i=r.serviceUrl,l=r.sublayerId)}return{url:t(i),layerId:l}}function y(e,r,t,n,i){a(r,n,"url",i),n.url&&null!=e.layerId&&(n.url=s(n.url,t,e.layerId.toString()))}function S(e){if(!e)return!1;const r=e.toLowerCase(),t=-1!==r.indexOf("/services/"),n=-1!==r.indexOf("/mapserver/wmsserver"),s=-1!==r.indexOf("/imageserver/wmsserver"),i=-1!==r.indexOf("/wmsserver");return t&&(n||s||i)}function O(e){if(!e)return!1;const r=new i(o(e)).authority.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}export{g as a,w as b,v as c,p as d,S as e,m as f,O as i,d as p,x as s,h as t,y as w};
