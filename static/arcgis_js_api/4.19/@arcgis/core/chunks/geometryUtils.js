/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"../core/lang.js";import{n as t,b as n,L as r,i as e}from"./Logger.js";import{n as i}from"../core/scheduling.js";import{b as o,c as s}from"./mathUtils2.js";import{c,a as u,f as a}from"./vec3f64.js";import{d as f,l as g,n as l,c as p,b as m,g as d,s as b,e as h,m as y,h as P,a as M,k as A,i as v,u as _}from"./vec3.js";import{j,d as w}from"./mathUtils.js";import{e as S}from"./screenUtils.js";import{i as I,r as R,a as O,b as V,m as x}from"./mat4.js";import{c as N,f as L}from"./vec4f64.js";import{c as E}from"./quatf64.js";import{c as T,d as B}from"./vec2.js";import{c as z,t as F}from"./vec4.js";import{b as q,a as U,s as k}from"./stack.js";function C(t,n){return f(t,n)/g(t)}function H(t,n){const r=f(t,n)/(g(t)*g(n));return-o(r)}function D(t,n,r){l(Y,t),l(G,n);const e=f(Y,G),i=o(e),s=p(Y,Y,G);return f(s,r)<0?2*Math.PI-i:i}const Y=c(),G=c();var W=Object.freeze({__proto__:null,projectPoint:function(t,n,r){const e=f(t,n)/f(t,t);return m(r,t,e)},projectPointSignedLength:C,angle:H,angleAroundAxis:D});function X(t=K){return[t[0],t[1],t[2],t[3]]}function J(t,n,r,e,i=X()){return i[0]=t,i[1]=n,i[2]=r,i[3]=e,i}const K=[0,0,1,0];var Q=Object.freeze({__proto__:null,create:X,wrap:function(t,n,r,e){return J(t,n,r,e,q.get())},wrapAxisAngle:function(t,n){return J(t[0],t[1],t[2],n,q.get())},copy:function(t,n=X()){return J(t[0],t[1],t[2],t[3],n)},fromValues:J,fromAxisAndAngle:function(t,n,r=X()){return d(r,t),r[3]=n,r},fromPoints:function(t,n,r=X()){return p(r,t,n),l(r,r),r[3]=H(t,n),r},axis:function(t){return t},UP:K});class Z{constructor(t){this.allocator=t,this.items=[],this.itemsPtr=0,this.tickHandle=i.before((()=>this.reset())),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=t(this.tickHandle)),this.items=t(this.items)}get(){return 0===this.itemsPtr&&i((()=>{})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const t=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*$);this.items.length=Math.min(t,this.items.length),this.itemsPtr=0}grow(){for(let t=0;t<Math.max(8,Math.min(this.items.length,$));t++)this.items.push(this.allocator())}}const $=1024;function tt(t){return t?{origin:u(t.origin),vector:u(t.vector)}:{origin:c(),vector:c()}}function nt(t,n){const r=ct.get();return r.origin=t,r.vector=n,r}function rt(t,n,r=tt()){return d(r.origin,t),d(r.vector,n),r}function et(t,n){const r=b(U.get(),n,t.origin),e=f(t.vector,r),i=f(t.vector,t.vector),o=s(e/i,0,1),c=b(U.get(),m(U.get(),t.vector,o),r);return f(c,c)}function it(t,n,r,e,i){const{vector:o,origin:c}=t,u=b(U.get(),n,c),a=f(o,u)/y(o);return m(i,o,s(a,r,e)),h(i,i,t.origin)}function ot(t,n,r,e){const i=1e-6,o=t.origin,c=h(U.get(),o,t.vector),u=n.origin,a=h(U.get(),u,n.vector),f=U.get(),g=U.get();if(f[0]=o[0]-u[0],f[1]=o[1]-u[1],f[2]=o[2]-u[2],g[0]=a[0]-u[0],g[1]=a[1]-u[1],g[2]=a[2]-u[2],Math.abs(g[0])<i&&Math.abs(g[1])<i&&Math.abs(g[2])<i)return!1;const l=U.get();if(l[0]=c[0]-o[0],l[1]=c[1]-o[1],l[2]=c[2]-o[2],Math.abs(l[0])<i&&Math.abs(l[1])<i&&Math.abs(l[2])<i)return!1;const p=f[0]*g[0]+f[1]*g[1]+f[2]*g[2],m=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],d=f[0]*l[0]+f[1]*l[1]+f[2]*l[2],b=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],y=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*b-m*m;if(Math.abs(y)<i)return!1;let M=(p*m-d*b)/y,A=(p+m*M)/b;r&&(M=s(M,0,1),A=s(A,0,1));const v=U.get(),_=U.get();return v[0]=o[0]+M*l[0],v[1]=o[1]+M*l[1],v[2]=o[2]+M*l[2],_[0]=u[0]+A*g[0],_[1]=u[1]+A*g[1],_[2]=u[2]+A*g[2],e.tA=M,e.tB=A,e.pA=v,e.pB=_,e.distance2=P(v,_),!0}const st={tA:0,tB:0,pA:c(),pB:c(),distance2:0},ct=new Z((()=>({origin:null,vector:null})));var ut=Object.freeze({__proto__:null,create:tt,wrap:nt,copy:function(t,n=tt()){return rt(t.origin,t.vector,n)},fromValues:rt,fromPoints:function(t,n,r=tt()){return d(r.origin,t),b(r.vector,n,t),r},distance2:et,distance:function(t,n){return Math.sqrt(et(t,n))},projectPoint:function(t,n,r){return it(t,n,0,1,r)},pointAt:function(t,n,r){return h(r,t.origin,m(r,t.vector,n))},projectPointClamp:it,closestRayDistance2:function(t,n){if(ot(t,nt(n.origin,n.direction),!1,st)){const{tA:n,pB:r,distance2:e}=st;if(n>=0&&n<=1)return e;if(n<0)return P(t.origin,r);if(n>1)return P(h(U.get(),t.origin,t.vector),r)}return null},closestLineSegmentPoint:function(t,n,r){return!!ot(t,n,!0,st)&&(d(r,st.pA),!0)},closestLineSegmentDistance2:function(t,n){return ot(t,n,!0,st)?st.distance2:null}});function at(t){return t?{origin:u(t.origin),direction:u(t.direction)}:{origin:c(),direction:c()}}function ft(t,n=at()){return lt(t.origin,t.direction,n)}function gt(t,n,r=at()){return d(r.origin,t),b(r.direction,n,t),r}function lt(t,n,r=at()){return d(r.origin,t),d(r.direction,n),r}function pt(t,n,r=at()){return mt(t,t.screenToRender(n,S(U.get())),r)}function mt(t,r,e=at()){const i=S(T(U.get(),r));if(i[2]=0,!t.unprojectFromRenderScreen(i,e.origin))return null;const o=S(T(U.get(),r));o[2]=1;const s=t.unprojectFromRenderScreen(o,U.get());return n(s)?null:(b(e.direction,s,e.origin),e)}function dt(t,n,r=at()){return bt(t,t.screenToRender(n,S(U.get())),r)}function bt(t,r,e=at()){d(e.origin,t.eye);const i=M(U.get(),r[0],r[1],1),o=t.unprojectFromRenderScreen(i,U.get());return n(o)?null:(b(e.direction,o,e.origin),e)}function ht(t,n){const r=p(U.get(),l(U.get(),t.direction),b(U.get(),n,t.origin));return f(r,r)}function yt(t,n,r){const e=f(t.direction,b(r,n,t.origin));return h(r,t.origin,m(r,t.direction,e)),r}function Pt(){return{origin:null,direction:null}}const Mt=new Z(Pt);var At=Object.freeze({__proto__:null,create:at,wrap:function(t,n){const r=Mt.get();return r.origin=t,r.direction=n,r},copy:ft,fromPoints:gt,fromValues:lt,fromScreen:pt,fromRender:mt,fromScreenAtEye:dt,fromRenderAtEye:bt,distance2:ht,distance:function(t,n){return Math.sqrt(ht(t,n))},closestPoint:yt,createWrapper:Pt});const vt=r.getLogger("esri.views.3d.support.geometryUtils.sphere");function _t(){return N()}function jt(t,n=_t()){return z(n,t)}function wt(t){t[0]=t[1]=t[2]=t[3]=0}function St(t){return Array.isArray(t)?t[3]:t}function It(t){return Array.isArray(t)?t:Bt}function Rt(t,r,e){if(n(r))return!1;const i=b(U.get(),r.origin,It(t)),o=f(r.direction,r.direction),s=2*f(r.direction,i),c=s*s-4*o*(f(i,i)-t[3]*t[3]);if(c<0)return!1;const u=Math.sqrt(c);let a=(-s-u)/(2*o);const g=(-s+u)/(2*o);return(a<0||g<a&&g>0)&&(a=g),!(a<0)&&(e&&h(e,r.origin,m(U.get(),r.direction,a)),!0)}function Ot(t,n,r){const e=U.get(),i=k.get();p(e,n.origin,n.direction);const o=St(t);p(r,e,n.origin),m(r,r,1/g(r)*o);const s=xt(t,n.origin),c=H(n.origin,r);return I(i),R(i,i,c+s,e),v(r,r,i),r}function Vt(t,n,r){const e=b(U.get(),n,It(t)),i=m(U.get(),e,t[3]/g(e));return h(r,i,It(t))}function xt(t,n){const r=b(U.get(),n,It(t)),e=g(r),i=St(t),s=i+Math.abs(i-e);return o(i/s)}const Nt=c();function Lt(t,n,r,e){const i=b(Nt,n,It(t));switch(r){case 0:{const t=j(i,Nt)[2];return M(e,-Math.sin(t),Math.cos(t),0)}case 1:{const t=j(i,Nt),n=t[1],r=t[2],o=Math.sin(n);return M(e,-o*Math.cos(r),-o*Math.sin(r),Math.cos(n))}case 2:return l(e,i);default:return}}function Et(t,n){const r=b(zt,n,It(t));return g(r)-t[3]}const Tt=at(),Bt=c(),zt=c();Object.freeze(Bt);var Ft=Object.freeze({__proto__:null,create:_t,copy:jt,fromCenterAndRadius:function(t,n){return L(t[0],t[1],t[2],n)},wrap:function(t){return t},clear:wt,fromRadius:function(t){return t},getRadius:St,getCenter:It,fromValues:function(t,n,r,e){return L(t,n,r,e)},elevate:function(t,n,r){return t!==r&&d(r,t),r[3]=t[3]+n,r},setExtent:function(t,n,r){return vt.error("sphere.setExtent is not yet supported"),t===r?r:jt(t,r)},intersectRay:Rt,intersectScreen:function(t,n,r,e){return Rt(t,dt(n,r,Tt),e)},intersectsRay:function(t,n){return Rt(t,n,null)},intersectRayClosestSilhouette:function(t,n,r){if(Rt(t,n,r))return r;const e=Ot(t,n,U.get());return h(r,n.origin,m(U.get(),n.direction,A(n.origin,e)/g(n.direction))),r},closestPointOnSilhouette:Ot,closestPoint:function(t,n,r){return Rt(t,n,r)?r:(yt(n,It(t),r),Vt(t,r,r))},projectPoint:Vt,distanceToSilhouette:function(t,n){const r=b(U.get(),n,It(t)),e=y(r),i=t[3]*t[3];return Math.sqrt(Math.abs(e-i))},angleToSilhouette:xt,axisAt:Lt,altitudeAt:Et,setAltitudeAt:function(t,n,r,e){const i=Et(t,n),o=Lt(t,n,2,zt),s=m(zt,o,r-i);return h(e,n,s),e}});function qt(t=dn){return[t[0],t[1],t[2],t[3]]}function Ut(t,n,r,e){return Ct(t,n,r,e,q.get())}function kt(t,n=qt()){return Ct(t[0],t[1],t[2],t[3],n)}function Ct(t,n,r,e,i=qt()){return i[0]=t,i[1]=n,i[2]=r,i[3]=e,i}function Ht(t,n,r=qt()){d(r,n);const e=f(n,n);return Math.abs(e-1)>1e-5&&e>1e-12&&m(r,r,1/Math.sqrt(e)),Zt(r,t,r),r}function Dt(t,n,r,e=qt()){return $t(b(U.get(),t,n),b(U.get(),r,n),t,e)}function Yt(t,n,r,e,i){if(t.count<3)return!1;t.getVec(r,Wt);let o=e,s=!1;for(;o<t.count-1&&!s;)t.getVec(o,Xt),o++,s=!_(Wt,Xt);if(!s)return!1;for(o=Math.max(o,i),s=!1;o<t.count&&!s;)t.getVec(o,Jt),o++,b(Kt,Wt,Xt),l(Kt,Kt),b(Qt,Xt,Jt),l(Qt,Qt),s=!_(Wt,Jt)&&!_(Xt,Jt)&&Math.abs(f(Kt,Qt))<Gt;return s?(Dt(Wt,Xt,Jt,n),!0):(0!==r||1!==e||2!==i)&&Yt(t,n,0,1,2)}const Gt=.99619469809,Wt=c(),Xt=c(),Jt=c(),Kt=c(),Qt=c();function Zt(t,n,r){return t!==r&&kt(t,r),r[3]=-f(r,n),r}function $t(t,n,r,e=qt()){return Ht(r,p(U.get(),n,t),e)}function tn(t,n,r){return!!e(n)&&pn(t,n.origin,n.direction,!0,!1,r)}function nn(t,n,r){return pn(t,n.origin,n.vector,!1,!1,r)}function rn(t,n,r){return pn(t,n.origin,n.vector,!1,!0,r)}function en(t,n){return ln(t,It(n))-n[3]>=0}function on(t,n){return ln(t,n)>=0}function sn(t,n){return ln(t,n)<0}function cn(t,n){const r=n[0],e=n[1],i=n[2],o=n[3],s=n[4],c=n[5];return t[0]*(t[0]>0?r:o)+t[1]*(t[1]>0?e:s)+t[2]*(t[2]>0?i:c)+t[3]>=0}function un(t,n){const r=f(t,n.ray.direction),e=-ln(t,n.ray.origin);if(e<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return e>0;if((e<0||r<0)&&!(e<0&&r<0))return!0;const i=e/r;return r>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function an(t,n){const r=f(t,n.ray.direction),e=-ln(t,n.ray.origin);if(r>-1e-6&&r<1e-6)return e>0;const i=e/r;return r>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function fn(t,n,r){const e=m(U.get(),t,-t[3]),i=gn(t,b(U.get(),n,e),U.get());return h(r,i,e),r}function gn(t,n,r){const e=m(U.get(),t,f(t,n));return b(r,n,e),r}function ln(t,n){return f(t,n)+t[3]}function pn(t,n,r,e,i,o){const c=f(t,r);if(0===c)return!1;let u=-(f(t,n)+t[3])/c;return i&&(u=e?Math.max(0,u):s(u,0,1)),!(u<0||!e&&u>1)&&(h(o,n,m(o,r,u)),!0)}function mn(t){return t}const dn=[0,0,1,0];var bn=Object.freeze({__proto__:null,create:qt,wrap:Ut,copy:kt,fromValues:Ct,fromNormalAndOffset:function(t,n,r=qt()){return d(r,t),r[3]=n,r},fromPositionAndNormal:Ht,fromPoints:Dt,fromManyPoints:function(t,n){return Yt(t,n,0,1,2)},fromManyPointsSampleAt:Yt,setOffsetFromPoint:Zt,negate:function(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},fromVectorsAndPoint:$t,intersectRay:tn,intersectLineSegment:nn,intersectLineSegmentClamp:rn,isSphereFullyInside:en,isSphereFullyOutside:function(t,n){return ln(t,It(n))+n[3]<0},isPointInside:on,isPointOutside:sn,isAABBFullyInside:cn,clip:un,clipInfinite:an,projectPoint:fn,projectVector:gn,distance:function(t,n){return Math.abs(ln(t,n))},signedDistance:ln,normal:mn,UP:dn});const hn=r.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class yn{constructor(){this.plane=qt(),this.origin=c(),this.basis1=c(),this.basis2=c()}}function Pn(t=Fn){return{plane:qt(t.plane),origin:u(t.origin),basis1:u(t.basis1),basis2:u(t.basis2)}}function Mn(t,n=Pn()){return An(t.origin,t.basis1,t.basis2,n)}function An(t,n,r,e=Pn()){return d(e.origin,t),d(e.basis1,n),d(e.basis2,r),vn(e),function(t,n){Math.abs(f(t.basis1,t.basis2)/(g(t.basis1)*g(t.basis2)))>1e-6&&hn.warn(n,"Provided basis vectors are not perpendicular");Math.abs(f(t.basis1,Ln(t)))>1e-6&&hn.warn(n,"Basis vectors and plane normal are not perpendicular");Math.abs(-f(Ln(t),t.origin)-t.plane[3])>1e-6&&hn.warn(n,"Plane offset is not consistent with plane origin")}(e,"fromValues()"),e}function vn(t){$t(t.basis2,t.basis1,t.origin,t.plane)}function _n(t,n,r){t!==r&&Mn(t,r);const e=m(U.get(),Ln(t),n);return h(r.origin,r.origin,e),r.plane[3]-=n,r}function jn(t,n=Pn()){const r=(t[2]-t[0])/2,e=(t[3]-t[1])/2;return M(n.origin,t[0]+r,t[1]+e,0),M(n.basis1,r,0,0),M(n.basis2,0,e,0),Ct(0,0,1,0,n.plane),n}function wn(t,n,r){return!!tn(t.plane,n,r)&&En(t,r)}function Sn(t,n,r){const e=qn.get();zn(t,n,e,qn.get());let i=Number.POSITIVE_INFINITY;for(const s of Hn){const c=Bn(t,s,Un.get()),u=U.get();if(nn(e,c,u)){const t=w(U.get(),n.origin,u),e=Math.abs(o(f(n.direction,t)));e<i&&(i=e,d(r,u))}}return i===Number.POSITIVE_INFINITY?In(t,n,r):r}function In(t,n,r){if(wn(t,n,r))return r;const e=qn.get(),i=qn.get();zn(t,n,e,i);let o=Number.POSITIVE_INFINITY;for(const s of Hn){const c=Bn(t,s,Un.get()),u=U.get();if(rn(e,c,u)){const t=ht(n,u);if(!on(i,u))continue;t<o&&(o=t,d(r,u))}}return Vn(t,n.origin)<o&&Rn(t,n.origin,r),r}function Rn(t,n,r){const e=fn(t.plane,n,U.get()),i=it(Tn(t,t.basis1),e,-1,1,U.get()),o=it(Tn(t,t.basis2),e,-1,1,U.get());return b(r,h(U.get(),i,o),t.origin),r}function On(t,n,r){const{origin:e,basis1:i,basis2:o}=t,s=b(U.get(),n,e),c=C(i,s),u=C(o,s),a=C(Ln(t),s);return M(r,c,u,a)}function Vn(t,n){const r=On(t,n,U.get()),{basis1:e,basis2:i}=t,o=g(e),s=g(i),c=Math.max(Math.abs(r[0])-o,0),u=Math.max(Math.abs(r[1])-s,0),a=r[2];return c*c+u*u+a*a}function xn(t,n){return on(t.plane,n)&&En(t,n)}function Nn(t,n){const r=-t.plane[3];return C(Ln(t),n)-r}function Ln(t){return t.plane}function En(t,n){const r=b(U.get(),n,t.origin),e=y(t.basis1),i=y(t.basis2),o=f(t.basis1,r),s=f(t.basis2,r);return-o-e<0&&o-e<0&&-s-i<0&&s-i<0}function Tn(t,n){const r=Un.get();return d(r.origin,t.origin),d(r.vector,n),r}function Bn(t,n,r){const{basis1:e,basis2:i,origin:o}=t,s=m(U.get(),e,n.origin[0]),c=m(U.get(),i,n.origin[1]);h(r.origin,s,c),h(r.origin,r.origin,o);const u=m(U.get(),e,n.direction[0]),a=m(U.get(),i,n.direction[1]);return m(r.vector,h(u,u,a),2),r}function zn(t,n,r,e){const i=Ln(t);$t(i,n.direction,n.origin,r),$t(r,i,n.origin,e)}const Fn={plane:qt(),origin:a(0,0,0),basis1:a(1,0,0),basis2:a(0,1,0)},qn=new Z(qt),Un=new Z(tt),kn=c(),Cn=new Z((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Hn=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Dn=E(),Yn=E();var Gn=Object.freeze({__proto__:null,BoundedPlaneClass:yn,create:Pn,wrap:function(t,n,r){const e=Cn.get();return e.origin=t,e.basis1=n,e.basis2=r,e.plane=Ut(0,0,0,0),vn(e),e},copy:Mn,copyWithoutVerify:function(t,n){d(n.origin,t.origin),d(n.basis1,t.basis1),d(n.basis2,t.basis2),kt(t.plane,n.plane)},fromValues:An,updateUnboundedPlane:vn,elevate:_n,setExtent:function(t,n,r){return jn(n,r),_n(r,Nn(t,t.origin),r),r},fromAABoundingRect:jn,intersectRay:wn,intersectRayClosestSilhouette:function(t,n,r){if(wn(t,n,r))return r;const e=Sn(t,n,U.get());return h(r,n.origin,m(U.get(),n.direction,A(n.origin,e)/g(n.direction))),r},closestPointOnSilhouette:Sn,closestPoint:In,projectPoint:Rn,projectPointLocal:On,distance2:Vn,distance:function(t,n){return Math.sqrt(Vn(t,n))},distanceToSilhouette:function(t,n){let r=Number.NEGATIVE_INFINITY;for(const e of Hn){const i=et(Bn(t,e,Un.get()),n);i>r&&(r=i)}return Math.sqrt(r)},extrusionContainsPoint:xn,axisAt:function(t,n,r,e){return function(t,n,r){switch(n){case 0:d(r,t.basis1),l(r,r);break;case 1:d(r,t.basis2),l(r,r);break;case 2:d(r,Ln(t))}return r}(t,r,e)},altitudeAt:Nn,setAltitudeAt:function(t,n,r,e){const i=Nn(t,n),o=m(kn,Ln(t),r-i);return h(e,n,o),e},equals:function(t,n){return _(t.basis1,n.basis1)&&_(t.basis2,n.basis2)&&_(t.origin,n.origin)},transform:function(t,n,r){return t!==r&&Mn(t,r),O(Dn,n),V(Dn,Dn),v(r.basis1,t.basis1,Dn),v(r.basis2,t.basis2,Dn),v(r.plane,t.plane,Dn),v(r.origin,t.origin,n),Zt(r.plane,r.origin,r.plane),r},rotate:function(t,n,r,e){return t!==e&&Mn(t,e),R(Yn,I(Yn),n,r),v(e.basis1,t.basis1,Yn),v(e.basis2,t.basis2,Yn),vn(e),e},normal:Ln,UP:Fn});function Wn(t){return t?{ray:at(t.ray),c0:t.c0,c1:t.c1}:{ray:at(),c0:0,c1:Number.MAX_VALUE}}function Xn(t,n,r,e=Wn()){return ft(t,e.ray),e.c0=n,e.c1=r,e}function Jn(t,n=Wn()){return ft(t,n.ray),n.c0=0,n.c1=Number.MAX_VALUE,n}function Kn(t,n,r=Wn()){const e=g(t.vector);return lt(t.origin,n,r.ray),r.c0=0,r.c1=e,r}function Qn(t,n){return $n(t,t.c0,n)}function Zn(t,n){return $n(t,t.c1,n)}function $n(t,n,r){return h(r,t.ray.origin,m(r,t.ray.direction,n))}const tr=new Z((()=>({c0:0,c1:0,ray:null})));var nr=Object.freeze({__proto__:null,create:Wn,wrap:function(t,n,r){const e=tr.get();return e.ray=t,e.c0=n,e.c1=r,e},copy:function(t,n=Wn()){return Xn(t.ray,t.c0,t.c1,n)},fromValues:Xn,fromRay:Jn,fromLineSegment:function(t,n=Wn()){return Kn(t,l(U.get(),t.vector),n)},fromLineSegmentAndDirection:Kn,getStart:Qn,getEnd:Zn,getAt:$n});function rr(t){return t?[qt(t[0]),qt(t[1]),qt(t[2]),qt(t[3]),qt(t[4]),qt(t[5])]:[qt(),qt(),qt(),qt(),qt(),qt()]}function er(){return[c(),c(),c(),c(),c(),c(),c(),c()]}function ir(t,n,r,e=dr){const i=x(k.get(),n,t);O(i,i);for(let t=0;t<8;++t){const n=F(q.get(),pr[t],i);M(e[t],n[0]/n[3],n[1]/n[3],n[2]/n[3])}or(r,e)}function or(t,n){Dt(n[4],n[0],n[3],t[0]),Dt(n[1],n[5],n[6],t[1]),Dt(n[4],n[5],n[1],t[2]),Dt(n[3],n[2],n[6],t[3]),Dt(n[0],n[1],n[2],t[4]),Dt(n[5],n[4],n[7],t[5])}function sr(t,n){for(let r=0;r<6;r++)if(en(t[r],n))return!1;return!0}function cr(t,n){return gr(t,Jn(n,mr.get()))}function ur(t,n,r){return gr(t,Kn(n,r,mr.get()))}function ar(t,n){for(let r=0;r<6;r++){if(ln(t[r],n)>0)return!1}return!0}function fr(t,n){for(let r=0;r<6;r++)if(cn(t[r],n))return!1;return!0}function gr(t,n){for(let r=0;r<6;r++)if(!un(t[r],n))return!1;return!0}const lr={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},pr=[L(-1,-1,-1,1),L(1,-1,-1,1),L(1,1,-1,1),L(-1,1,-1,1),L(-1,-1,1,1),L(1,-1,1,1),L(1,1,1,1),L(-1,1,1,1)],mr=new Z(Wn),dr=er();var br=Object.freeze({__proto__:null,create:rr,createPoints:er,copy:function(t,n=rr()){for(let r=0;r<6;r++)kt(t[r],n[r])},fromMatrix:ir,computePlanes:or,intersectsSphere:sr,intersectsRay:cr,intersectClipRay:function(t,n){for(let r=0;r<6;r++){if(!an(t[r],n))return!1}return!0},intersectsLineSegment:ur,intersectsPoint:ar,intersectsAABB:fr,planePointIndices:lr});function hr(t){return t?{p0:u(t.p0),p1:u(t.p1),p2:u(t.p2)}:{p0:c(),p1:c(),p2:c()}}function yr(t,n,r,e=hr()){return d(e.p0,t),d(e.p1,n),d(e.p2,r),e}function Pr(t,n,r){const e=1e-5,{direction:i,origin:o}=n,{p0:s,p1:c,p2:u}=t,a=c[0]-s[0],f=c[1]-s[1],g=c[2]-s[2],l=u[0]-s[0],p=u[1]-s[1],d=u[2]-s[2],b=i[1]*d-p*i[2],y=i[2]*l-d*i[0],P=i[0]*p-l*i[1],M=a*b+f*y+g*P;if(M>-e&&M<e)return!1;const A=1/M,v=o[0]-s[0],_=o[1]-s[1],j=o[2]-s[2],w=A*(v*b+_*y+j*P);if(w<0||w>1)return!1;const S=_*g-f*j,I=j*a-g*v,R=v*f-a*_,O=A*(i[0]*S+i[1]*I+i[2]*R);if(O<0||w+O>1)return!1;if(r){m(r,i,A*(l*S+p*I+d*R)),h(r,o,r)}return!0}function Mr(t,n,r){const e=B(t,n),i=B(n,r),o=B(r,t),s=(e+i+o)/2,c=s*(s-e)*(s-i)*(s-o);return c<=0?0:Math.sqrt(c)}function Ar(t,n,r){return b(jr,n,t),b(wr,r,t),g(p(jr,jr,wr))/2}const vr=new Z(tt),_r=new Z((()=>({p0:null,p1:null,p2:null}))),jr=c(),wr=c();const Sr=bn,Ir=Gn,Rr=Object.freeze({__proto__:null,create:hr,wrap:function(t,n,r){const e=_r.get();return e.p0=t,e.p1=n,e.p2=r,e},copy:function(t,n=hr()){return yr(t.p0,t.p1,t.p2,n)},fromValues:yr,distance2:function(t,n){const r=t.p0,e=t.p1,i=t.p2,o=b(U.get(),e,r),s=b(U.get(),i,e),c=b(U.get(),r,i),u=b(U.get(),n,r),a=b(U.get(),n,e),g=b(U.get(),n,i),l=p(o,o,c),m=f(p(U.get(),o,l),u),d=f(p(U.get(),s,l),a),h=f(p(U.get(),c,l),g);if(m>0&&d>0&&h>0){const t=f(l,u);return t*t/f(l,l)}const y=et(rt(r,o,vr.get()),n),P=et(rt(e,s,vr.get()),n),M=et(rt(i,c,vr.get()),n);return Math.min(y,P,M)},intersectRay:Pr,areaPoints2d:Mr,area2d:function(t){return Mr(t.p0,t.p1,t.p2)},areaPoints3d:Ar}),Or=ut,Vr=At,xr=nr,Nr=Ft,Lr=br,Er=W,Tr=Q;export{Er as A,_t as B,fr as C,kt as D,sn as E,ln as F,yn as G,xn as H,C as I,wt as J,Ar as K,Wn as L,Jn as M,Qn as N,Zn as O,xr as P,ft as Q,gt as R,D as S,Pr as T,Tr as a,Ir as b,H as c,qt as d,rr as e,Yt as f,It as g,er as h,Rt as i,ir as j,or as k,sr as l,cr as m,mn as n,ur as o,Sr as p,ar as q,Vr as r,Nr as s,lr as t,Or as u,Rr as v,Lr as w,at as x,bt as y,pt as z};
