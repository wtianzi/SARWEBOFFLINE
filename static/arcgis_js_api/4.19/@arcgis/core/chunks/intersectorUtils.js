/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{b as t,i as s,u as r}from"./Logger.js";import{c as e,a as i}from"./vec3f64.js";import{b as a,l as n,e as h,g as o,n as l,f as c,x as f,s as m}from"./vec3.js";import{a as p,b as u,c as d,m as b}from"./mat4.js";import{c as g}from"./vec4f64.js";import{c as y,a as v,b as T}from"./quatf64.js";import{g as O}from"./mat3.js";import{t as S}from"./vec4.js";import{c as z}from"./quat.js";import{c as L}from"./vec3f32.js";import{r as _,H as x,B as I}from"./geometryUtils.js";import{O as M}from"./Object3D.js";function q(t){return(s,r,e)=>(c(C,s,r,e),!x(t,C))}class V{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}class w{constructor(){this._transform=y(),this._transformInverse=new j({value:this._transform},p,y),this._transformInverseTranspose=new j(this._transformInverse,u,y),this._transformTranspose=new j({value:this._transform},u,y),this._transformInverseRotation=new j({value:this._transform},O,v)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){d(this._transform,t)}multiplyTransform(t){b(this._transform,this._transform,t)}set(t){d(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,s){this.setTransformMatrix(t),this.multiplyTransform(s),this.invalidateLazyTransforms()}}class j{constructor(t,s,r){this.original=t,this.update=s,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class G{constructor(){this.min=new U,this.max=new U,this.hud=new U,this.ground=new U}init(t){this.min.init(t),this.max.init(t),this.hud.init(t),this.ground.init(t),this.all=[]}}class U{constructor(t){this.normal=e(),this.transformation=y(),this._ray=_.create(),this.init(t)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return a(E,this.ray.direction,this.dist),n(E)}getIntersectionPoint(t){return!!this.hasIntersectionPoint&&(a(E,this.ray.direction,this.dist),h(t,this.ray.origin,E),!0)}getTransformedNormal(t){return o(J,this.normal),J[3]=0,S(J,J,this.transformation),o(t,J),l(t,t),t}init(t){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",t?_.copy(t,this._ray):this._ray=_.create()}set(t,s,r,e,a,n,h,l,c,f){t instanceof M&&(t={type:"stage",obj:t}),this.dist=r,o(this.normal,e),d(this.transformation,a),this.target=t,this.name=s,this.drapedLayerOrder=n,this.center=h?i(h):null,this.geometryId=l,this.triangleNr=c,this.drapedLayerGraphicOrder=f}copyFrom(t){_.copy(t._ray,this._ray),this.dist=t.dist,this.target=t.target,this.name=t.name,this.drapedLayerOrder=t.drapedLayerOrder,this.center=t.center?i(t.center):null,this.geometryId=t.geometryId,this.triangleNr=t.triangleNr,this.intersector=t.intersector,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,o(this.normal,t.normal),d(this.transformation,t.transformation)}toOwner(t){if(!this.target)return null;switch(this.target.type){case"stage":return R(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return function(t,s){const r=t.metadata.layerUid;return null!=r?s.map.findLayerByUid(r):null}(this.target,t);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return R(this.target.metadata,t);case"TerrainRenderer":return t.map&&t.map.ground}}return null}toGraphic(t){if(!this.target)return null;switch(this.target.type){case"stage":return F(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return this.target.metadata.createGraphic();case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return F(this.target.metadata,t)}}return null}}function R(r,e){return t(r)||null==r.layerUid?null:s(e.graphicsView)&&r.layerUid===e.graphicsView.graphics3d.layer.id?e.graphics:e.map.findLayerByUid(r.layerUid)}function F(e,i){if(t(e))return null;const a=R(e,i);if(t(a))return null;if(a===i.graphics)return s(i.graphicsView)?r(i.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;const n=i.allLayerViews.find((t=>t.layer===a));return n?function(t,s){if(!t||t.suspended)return null;if("getGraphicFromIntersectorMetadata"in t&&s)return t.getGraphicFromIntersectorMetadata(s);if("getGraphicFromGraphicUid"in t&&null!=s.graphicUid)return t.getGraphicFromGraphicUid(s.graphicUid);return null}(n,e):null}const N=new class{constructor(t=0){this.offset=t,this.sphere=I(),this.tmpVertex=e()}applyToVertex(t,s,r){const e=this.objectTransform.transform;let i=e[0]*t+e[4]*s+e[8]*r+e[12],a=e[1]*t+e[5]*s+e[9]*r+e[13],n=e[2]*t+e[6]*s+e[10]*r+e[14];const h=this.offset/Math.sqrt(i*i+a*a+n*n);i+=i*h,a+=a*h,n+=n*h;const o=this.objectTransform.inverse;return this.tmpVertex[0]=o[0]*i+o[4]*a+o[8]*n+o[12],this.tmpVertex[1]=o[1]*i+o[5]*a+o[9]*n+o[13],this.tmpVertex[2]=o[2]*i+o[6]*a+o[10]*n+o[14],this.tmpVertex}applyToMinMax(t,s){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const e=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]+=s[0]*e,s[1]+=s[1]*e,s[2]+=s[2]*e}applyToAabb(t){const s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/s;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/s,this.sphere}};function P(t){return s(t)?(N.offset=t,N):null}const A=new class{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=e(),this.mbs=g(),this.obb={center:e(),halfSize:L(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,s,r){const e=t,i=s,a=r+this.componentLocalOriginLength,n=this.offset/Math.sqrt(e*e+i*i+a*a);return this.tmpVertex[0]=t+e*n,this.tmpVertex[1]=s+i*n,this.tmpVertex[2]=r+a*n,this.tmpVertex}applyToAabb(t){const s=t[0],r=t[1],e=t[2]+this.componentLocalOriginLength,i=t[3],a=t[4],n=t[5]+this.componentLocalOriginLength,h=this.offset/Math.sqrt(s*s+r*r+e*e);t[0]+=s*h,t[1]+=r*h,t[2]+=e*h;const o=this.offset/Math.sqrt(i*i+a*a+n*n);return t[3]+=i*o,t[4]+=a*o,t[5]+=n*o,t}applyToMbs(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/s;return this.mbs[0]=t[0]+t[0]*r,this.mbs[1]=t[1]+t[1]*r,this.mbs[2]=t[2]+t[2]*r,this.mbs[3]=t[3]+t[3]*this.offset/s,this.mbs}applyToObb(t){const s=t.center,r=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.obb.center[0]=s[0]+s[0]*r,this.obb.center[1]=s[1]+s[1]*r,this.obb.center[2]=s[2]+s[2]*r,f(this.obb.halfSize,t.halfSize,t.quaternion),h(this.obb.halfSize,this.obb.halfSize,t.center);const e=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*e,this.obb.halfSize[1]+=this.obb.halfSize[1]*e,this.obb.halfSize[2]+=this.obb.halfSize[2]*e,m(this.obb.halfSize,this.obb.halfSize,t.center),z(K,t.quaternion),f(this.obb.halfSize,this.obb.halfSize,K),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}};function B(t){return s(t)?(A.offset=t,A):null}const k=new class{constructor(t=0){this.offset=t,this.tmpVertex=e()}applyToVertex(t,s,r){const e=t+this.localOrigin[0],i=s+this.localOrigin[1],a=r+this.localOrigin[2],n=this.offset/Math.sqrt(e*e+i*i+a*a);return this.tmpVertex[0]=t+e*n,this.tmpVertex[1]=s+i*n,this.tmpVertex[2]=r+a*n,this.tmpVertex}applyToAabb(t){const s=t[0]+this.localOrigin[0],r=t[1]+this.localOrigin[1],e=t[2]+this.localOrigin[2],i=t[3]+this.localOrigin[0],a=t[4]+this.localOrigin[1],n=t[5]+this.localOrigin[2],h=this.offset/Math.sqrt(s*s+r*r+e*e);t[0]+=s*h,t[1]+=r*h,t[2]+=e*h;const o=this.offset/Math.sqrt(i*i+a*a+n*n);return t[3]+=i*o,t[4]+=a*o,t[5]+=n*o,t}};function D(t){return s(t)?(k.offset=t,k):null}const H="terrain",C=e(),E=e(),J=g(),K=T();export{U as I,H as T,V as a,G as b,w as c,P as d,B as e,D as g,q as s};
