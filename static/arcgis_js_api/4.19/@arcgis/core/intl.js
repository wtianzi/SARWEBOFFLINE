/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{g as t}from"./core/lang.js";import{g as e}from"./chunks/object.js";import"./kernel.js";import"./config.js";import{L as n,i as r}from"./chunks/Logger.js";import{r as i}from"./chunks/string.js";import{createDeferred as u}from"./core/promiseUtils.js";import"./chunks/Message.js";import l from"./core/Error.js";import"./core/urlUtils.js";import"./chunks/jsonMap.js";import{g as h,b as d}from"./chunks/locale.js";export{g as getLocale,o as onLocaleChange,p as prefersRTL,s as setLocale}from"./chunks/locale.js";import{f as m,a as w}from"./chunks/number.js";export{c as convertDateFormatToIntlOptions,b as convertNumberFormatToIntlOptions,a as formatDate,f as formatNumber}from"./chunks/number.js";import j from"./request.js";import{g as k}from"./chunks/assets.js";const _=n.getLogger("esri.intl");function L(t,n,r={}){const{format:s={}}=r;return i(t,(t=>function(t,n,r){let s,o;const a=t.indexOf(":");-1===a?s=t.trim():(s=t.slice(0,a).trim(),o=t.slice(a+1).trim());if(!s)return"";const i=e(s,n);if(null==i)return"";const c=r[o]||r[s];if(c)return function(t,e){switch(e.type){case"date":return w(t,e.intlOptions);case"number":return m(t,e.intlOptions);default:return _.warn("missing format descriptor for key {key}"),y(t)}}(i,c);if(o)return function(t,e){switch(e.toLowerCase()){case"dateformat":return w(t);case"numberformat":return m(t);default:return _.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?w(t):/^numberformat/i.test(e)?m(t):y(t)}}(i,o);return y(i)}(t,n,s)))}function y(t){switch(typeof t){case"string":return t;case"number":return m(t);case"boolean":return""+t;default:return t instanceof Date?w(t):""}}const $=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,x=new Set(["ar","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),U=[],R=new Map;function B(t){if(!U.includes(t)){for(const e of R.keys())M(t.pattern,e)&&R.delete(e);U.unshift(t)}}async function v(t){const e=h();R.has(t)||R.set(t,async function(t,e){const n=[];for(const r of U)if(M(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(t){n.push(t)}if(n.length)throw new l("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:n});throw new l("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}(t,e));const n=R.get(t);return await O.add(n),n}function A(t){if(!$.test(t))return null;const[,e,n]=$.exec(t),r=e+(n?"-"+n.toUpperCase():"");return x.has(r)?r:x.has(e)?e:null}function M(t,e){return"string"==typeof t?e.startsWith(t):t.test(e)}d((()=>{R.clear()}));const O=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=u())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}};async function T(t){if(r(C.fetchBundleAsset))return C.fetchBundleAsset(t);const e=await j(t,{responseType:"text"});return JSON.parse(e.data)}class z{constructor({base:e="",pattern:n,location:r=new URL(window.location.href)}){let s;s="string"==typeof r?e=>new URL(e,new URL(r,t.location)).href:r instanceof URL?t=>new URL(t,r).href:r,this.pattern="string"==typeof n?new RegExp(`^${n}`):n,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,e){return async function(t,e,n,r){const s=e.exec(n);if(!s)throw new l("esri-intl:invalid-bundle",`Bundle id "${n}" is not compatible with the pattern "${e}"`);const o=s[1]?`${s[1]}/`:"",a=s[2],i=A(r),c=`${o}${a}.json`,u=i?`${o}${a}_${i}.json`:c;let f;try{f=await T(t(u))}catch(e){if(u===c)throw new l("intl:unknown-bundle",`Bundle "${n}" cannot be loaded`,{error:e});try{f=await T(t(c))}catch(t){throw new l("intl:unknown-bundle",`Bundle "${n}" cannot be loaded`,{error:t})}}return f}(this.getAssetUrl,this.matcher,t,e)}}function N(t){return new z(t)}const C={};B(N({pattern:"esri/",location:k}));export{N as createJSONLoader,v as fetchMessageBundle,A as normalizeMessageBundleLocale,B as registerMessageBundleLoader,L as substitute};
