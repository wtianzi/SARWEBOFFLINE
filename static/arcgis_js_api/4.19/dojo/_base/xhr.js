//>>built
define("./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),function(b,D,L,q,E,m,F,G,z,n,H,M,A,u,B,I){b._xhrObj=B._create;var v=b.config;b.objectToQuery=q.objectToQuery;b.queryToObject=q.queryToObject;b.fieldToObject=m.fieldToObject;b.formToObject=m.toObject;b.formToQuery=m.toQuery;b.formToJson=m.toJson;b._blockAsync=!1;var p=b._contentHandlers=b.contentHandlers={text:function(a){return a.responseText},
json:function(a){return z.fromJson(a.responseText||null)},"json-comment-filtered":function(a){G.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}\x26\x26\nUse djConfig.useCommentedJson\x3dtrue to turn off this message.");a=a.responseText;var c=a.indexOf("/*"),g=a.lastIndexOf("*/");if(-1==c||-1==g)throw Error("JSON was not comment filtered");
return z.fromJson(a.substring(c+2,g))},javascript:function(a){return b.eval(a.responseText)},xml:function(a){var c=a.responseXML;c&&!c.querySelectorAll&&(c=(new DOMParser).parseFromString(a.responseText,"application/xml"));if(D("ie")&&(!c||!c.documentElement)){var g=function(h){return"MSXML"+h+".DOMDocument"};g=["Microsoft.XMLDOM",g(6),g(4),g(3),g(2)];H.some(g,function(h){try{var d=new ActiveXObject(h);d.async=!1;d.loadXML(a.responseText);c=d}catch(k){return!1}return!0})}return c},"json-comment-optional":function(a){return a.responseText&&
/^[^{\[]*\/\*/.test(a.responseText)?p["json-comment-filtered"](a):p.json(a)}};p.arraybuffer=p.blob=p.document=function(a,c){return a.response};b._ioSetArgs=function(a,c,g,h){var d={args:a,url:a.url},k=null;if(a.form){k=E.byId(a.form);var l=k.getAttributeNode("action");d.url=d.url||(l?l.value:b.doc?b.doc.URL:null);k=m.toObject(k)}l={};k&&n.mixin(l,k);a.content&&n.mixin(l,a.content);a.preventCache&&(l["dojo.preventCache"]=(new Date).valueOf());d.query=q.objectToQuery(l);d.handleAs=a.handleAs||"text";
var e=new F(function(f){f.canceled=!0;c&&c(f);var r=f.ioArgs.error;r||(r=Error("request cancelled"),r.dojoType="cancel",f.ioArgs.error=r);return r});e.addCallback(g);var w=a.load;w&&n.isFunction(w)&&e.addCallback(function(f){return w.call(a,f,d)});var x=a.error;x&&n.isFunction(x)&&e.addErrback(function(f){return x.call(a,f,d)});var y=a.handle;y&&n.isFunction(y)&&e.addBoth(function(f){return y.call(a,f,d)});e.addErrback(function(f){return h(f,e)});v.ioPublish&&b.publish&&!1!==d.args.ioPublish&&(e.addCallbacks(function(f){b.publish("/dojo/io/load",
[e,f]);return f},function(f){b.publish("/dojo/io/error",[e,f]);return f}),e.addBoth(function(f){b.publish("/dojo/io/done",[e,f]);return f}));e.ioArgs=d;return e};var J=function(a){a=p[a.ioArgs.handleAs](a.ioArgs.xhr,a.ioArgs);return void 0===a?null:a},K=function(a,c){c.ioArgs.args.failOk||console.error(a);return a},C=function(a){0>=t&&(t=0,v.ioPublish&&b.publish&&(!a||a&&!1!==a.ioArgs.args.ioPublish)&&b.publish("/dojo/io/stop"))},t=0;A.after(u,"_onAction",function(){--t});A.after(u,"_onInFlight",
C);b._ioCancelAll=u.cancelAll;b._ioNotifyStart=function(a){v.ioPublish&&b.publish&&!1!==a.ioArgs.args.ioPublish&&(t||b.publish("/dojo/io/start"),t+=1,b.publish("/dojo/io/send",[a]))};b._ioWatch=function(a,c,g,h){a.ioArgs.options=a.ioArgs.args;n.mixin(a,{response:a.ioArgs,isValid:function(d){return c(a)},isReady:function(d){return g(a)},handleResponse:function(d){return h(a)}});u(a);C(a)};b._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(-1==a.url.indexOf("?")?"?":"\x26")+a.query,a.query=null)};
b.xhr=function(a,c,g){var h=b._ioSetArgs(c,function(e){l&&l.cancel()},J,K),d=h.ioArgs;"postData"in c?d.query=c.postData:"putData"in c?d.query=c.putData:"rawBody"in c?d.query=c.rawBody:(2<arguments.length&&!g||-1==="POST|PUT".indexOf(a.toUpperCase()))&&b._ioAddQueryToUrl(d);var k={method:a,handleAs:{arraybuffer:1,blob:1,document:1}[c.handleAs]?c.handleAs:"text",responseType:c.responseType,timeout:c.timeout,withCredentials:c.withCredentials,ioArgs:d};"undefined"!==typeof c.headers&&(k.headers=c.headers);
"undefined"!==typeof c.contentType&&(k.headers||(k.headers={}),k.headers["Content-Type"]=c.contentType);"undefined"!==typeof d.query&&(k.data=d.query);"undefined"!==typeof c.sync&&(k.sync=c.sync);b._ioNotifyStart(h);try{var l=B(d.url,k,!0)}catch(e){return h.cancel(),h}h.ioArgs.xhr=l.response.xhr;l.then(function(){h.resolve(h)}).otherwise(function(e){d.error=e;e.response&&(e.status=e.response.status,e.responseText=e.response.text,e.xhr=e.response.xhr);h.reject(e)});return h};b.xhrGet=function(a){return b.xhr("GET",
a)};b.rawXhrPost=b.xhrPost=function(a){return b.xhr("POST",a,!0)};b.rawXhrPut=b.xhrPut=function(a){return b.xhr("PUT",a,!0)};b.xhrDelete=function(a){return b.xhr("DELETE",a)};b._isDocumentOk=function(a){return I.checkStatus(a.status)};b._getText=function(a){var c;b.xhrGet({url:a,sync:!0,load:function(g){c=g}});return c};n.mixin(b.xhr,{_xhrObj:b._xhrObj,fieldToObject:m.fieldToObject,formToObject:m.toObject,objectToQuery:q.objectToQuery,formToQuery:m.toQuery,formToJson:m.toJson,queryToObject:q.queryToObject,
contentHandlers:p,_ioSetArgs:b._ioSetArgs,_ioCancelAll:b._ioCancelAll,_ioNotifyStart:b._ioNotifyStart,_ioWatch:b._ioWatch,_ioAddQueryToUrl:b._ioAddQueryToUrl,_isDocumentOk:b._isDocumentOk,_getText:b._getText,get:b.xhrGet,post:b.xhrPost,put:b.xhrPut,del:b.xhrDelete});return b.xhr});