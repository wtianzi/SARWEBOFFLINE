//>>built
define("./kernel ../on ../topic ../aspect ./event ../mouse ./sniff ./lang ../keys".split(" "),function(q,m,r,x,B,u,k,n){function y(a,b,e,d,f){d=n.hitch(e,d);if(!a||!a.addEventListener&&!a.attachEvent)return x.after(a||q.global,b,d,!0);"string"==typeof b&&"on"==b.substring(0,2)&&(b=b.substring(2));a||(a=q.global);if(!f)switch(b){case "keypress":b=v;break;case "mouseenter":b=u.enter;break;case "mouseleave":b=u.leave}return m(a,b,d,f)}function w(a){a.keyChar=a.charCode?String.fromCharCode(a.charCode):
"";a.charOrCode=a.keyChar||a.keyCode}k.add("events-keypress-typed",function(){var a={charCode:0};try{a=document.createEvent("KeyboardEvent"),(a.initKeyboardEvent||a.initKeyEvent).call(a,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(b){}return 0==a.charCode&&!k("opera")});var z={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},A=k("mac")?"metaKey":"ctrlKey",t=function(a,b){b=n.mixin({},a,b);w(b);b.preventDefault=function(){a.preventDefault()};b.stopPropagation=
function(){a.stopPropagation()};return b};var v=k("events-keypress-typed")?function(a,b){var e=m(a,"keydown",function(f){var c=f.keyCode,g=13!=c&&32!=c&&(27!=c||!k("ie"))&&(48>c||90<c)&&(96>c||111<c)&&(186>c||192<c)&&(219>c||222<c)&&229!=c;if(g||f.ctrlKey){g=g?0:c;if(f.ctrlKey){if(3==c||13==c)return b.call(f.currentTarget,f);g=95<g&&106>g?g-48:!f.shiftKey&&65<=g&&90>=g?g+32:z[g]||g}c=t(f,{type:"keypress",faux:!0,charCode:g});b.call(f.currentTarget,c);if(k("ie"))try{f.keyCode=c.keyCode}catch(h){}}}),
d=m(a,"keypress",function(f){var c=f.charCode;f=t(f,{charCode:32<=c?c:0,faux:!0});return b.call(this,f)});return{remove:function(){e.remove();d.remove()}}}:k("opera")?function(a,b){return m(a,"keypress",function(e){var d=e.which;3==d&&(d=99);d=32>d&&!e.shiftKey?0:d;e.ctrlKey&&!e.shiftKey&&65<=d&&90>=d&&(d+=32);return b.call(this,t(e,{charCode:d}))})}:function(a,b){return m(a,"keypress",function(e){w(e);return b.call(this,e)})};var l={_keypress:v,connect:function(a,b,e,d,f){var c=arguments,g=[],h=
0;g.push("string"==typeof c[0]?null:c[h++],c[h++]);var p=c[h+1];g.push("string"==typeof p||"function"==typeof p?c[h++]:null,c[h++]);for(p=c.length;h<p;h++)g.push(c[h]);return y.apply(this,g)},disconnect:function(a){a&&a.remove()},subscribe:function(a,b,e){return r.subscribe(a,n.hitch(b,e))},publish:function(a,b){return r.publish.apply(r,[a].concat(b))},connectPublisher:function(a,b,e){var d=function(){l.publish(a,arguments)};return e?l.connect(b,e,d):l.connect(b,d)},isCopyKey:function(a){return a[A]}};
l.unsubscribe=l.disconnect;n.mixin(q,l);return l});