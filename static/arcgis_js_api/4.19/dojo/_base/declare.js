//>>built
define(["./kernel","../has","./lang"],function(w,z,A){function p(c,b){throw Error("declare"+(b?" "+b:"")+": "+c);}function D(c,b){for(var a=[],f=[{cls:0,refs:[]}],d={},h=1,l=c.length,m=0,g,k,e,n,r;m<l;++m){(g=c[m])?"[object Function]"!=u.call(g)&&p("mixin #"+m+" is not a callable constructor.",b):p("mixin #"+m+" is unknown. Did you use dojo.require to pull it in?",b);k=g._meta?g._meta.bases:[g];e=0;for(g=k.length-1;0<=g;--g)n=k[g].prototype,n.hasOwnProperty("declaredClass")||(n.declaredClass="uniqName_"+
E++),n=n.declaredClass,d.hasOwnProperty(n)||(d[n]={count:0,refs:[],cls:k[g]},++h),n=d[n],e&&e!==n&&(n.refs.push(e),++e.count),e=n;++e.count;f[0].refs.push(e)}for(;f.length;){e=f.pop();a.push(e.cls);for(--h;r=e.refs,1==r.length;){e=r[0];if(!e||--e.count){e=0;break}a.push(e.cls);--h}if(e)for(m=0,l=r.length;m<l;++m)e=r[m],--e.count||f.push(e)}h&&p("can't build consistent linearization",b);g=c[0];a[0]=g?g._meta&&g===a[a.length-g._meta.bases.length]?g._meta.bases.length:1:0;return a}function B(c,b,a,f){var d,
h=this._inherited=this._inherited||{};if("string"===typeof c){var l=c;c=b;b=a;a=f}if("function"===typeof c){var m=c;c=b;b=a}else try{m=c.callee}catch(n){if(n instanceof TypeError)p("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);else throw n;}(l=l||m.nom)||p("can't deduce a name to call inherited()",this.declaredClass);a=f=0;var g=this.constructor._meta;f=g.bases;var k=h.p;if("constructor"!=l){if(h.c!==m){k=0;var e=f[0];g=e._meta;if(g.hidden[l]!==
m){(d=g.chains)&&"string"==typeof d[l]&&p("calling chained method with inherited: "+l,this.declaredClass);do if(g=e._meta,d=e.prototype,g&&(d[l]===m&&d.hasOwnProperty(l)||g.hidden[l]===m))break;while(e=f[++k]);k=e?k:-1}}if(e=f[++k])if(d=e.prototype,e._meta&&d.hasOwnProperty(l))a=d[l];else{m=q[l];do if(d=e.prototype,(a=d[l])&&(e._meta?d.hasOwnProperty(l):a!==m))break;while(e=f[++k])}a=e&&a||q[l]}else{if(h.c!==m&&(k=0,(g=f[0]._meta)&&g.ctor!==m)){for((d=g.chains)&&"manual"===d.constructor||p("calling chained constructor with inherited",
this.declaredClass);(e=f[++k])&&(!(g=e._meta)||g.ctor!==m););k=e?k:-1}for(;(e=f[++k])&&!(a=(g=e._meta)?g.ctor:e););a=e&&a}h.c=a;h.p=k;if(a)return!0===b?a:a.apply(this,b||c)}function F(c,b,a){return"string"===typeof c?"function"===typeof b?this.__inherited(c,b,a,!0):this.__inherited(c,b,!0):"function"===typeof c?this.__inherited(c,b,!0):this.__inherited(c,!0)}function G(c,b,a,f){var d=this.getInherited(c,b,a);if(d)return d.apply(this,f||a||b||c)}function H(c){for(var b=this.constructor._meta.bases,
a=0,f=b.length;a<f;++a)if(b[a]===c)return!0;return this instanceof c}function I(c,b){for(var a in b)"constructor"!=a&&b.hasOwnProperty(a)&&(c[a]=b[a])}function J(c){t.safeMixin(this.prototype,c);return this}function K(c,b){c instanceof Array||"function"===typeof c||(b=c,c=void 0);b=b||{};c=c||[];return t([this].concat(c),b)}function L(c,b){return function(){var a=arguments,f=a,d=a[0],h;var l=c.length;if(!(this instanceof a.callee))return x(a);if(b&&(d&&d.preamble||this.preamble)){var m=Array(c.length);
m[0]=a;for(h=0;;){(d=a[0])&&(d=d.preamble)&&(a=d.apply(this,a)||a);d=c[h].prototype;(d=d.hasOwnProperty("preamble")&&d.preamble)&&(a=d.apply(this,a)||a);if(++h==l)break;m[h]=a}}for(h=l-1;0<=h;--h)d=c[h],(d=(l=d._meta)?l.ctor:d)&&d.apply(this,m?m[h]:a);(d=this.postscript)&&d.apply(this,f)}}function M(c,b){return function(){var a=arguments,f=a,d=a[0];if(!(this instanceof a.callee))return x(a);b&&(d&&(d=d.preamble)&&(f=d.apply(this,f)||f),(d=this.preamble)&&d.apply(this,f));c&&c.apply(this,a);(d=this.postscript)&&
d.apply(this,a)}}function N(c){return function(){var b=arguments,a=0,f,d;if(!(this instanceof b.callee))return x(b);for(;f=c[a];++a)if(f=(d=f._meta)?d.ctor:f){f.apply(this,b);break}(f=this.postscript)&&f.apply(this,b)}}function O(c,b,a){return function(){var f,d=0,h=1;a&&(d=b.length-1,h=-1);for(;f=b[d];d+=h){var l=f._meta;(f=(l?l.hidden:f.prototype)[c])&&f.apply(this,arguments)}}}function C(c){y.prototype=c.prototype;c=new y;y.prototype=null;return c}function x(c){var b=c.callee,a=C(b);b.apply(a,
c);return a}function t(c,b,a){"string"!=typeof c&&(a=b,b=c,c="");a=a||{};var f,d,h,l=1,m=b;if("[object Array]"==u.call(b)){var g=D(b,c);var k=g[0];l=g.length-k;b=g[l]}else g=[0],b?"[object Function]"==u.call(b)?(k=b._meta,g=g.concat(k?k.bases:b)):p("base class is not a callable constructor.",c):null!==b&&p("unknown base class. Did you use dojo.require to pull it in?",c);if(b)for(f=l-1;;--f){var e=C(b);if(!f)break;k=g[f];(k._meta?I:v)(e,k.prototype);var n=z("csp-restrictions")?function(){}:new Function;
n.superclass=b;n.prototype=e;b=e.constructor=n}else e={};t.safeMixin(e,a);k=a.constructor;k!==q.constructor&&(k.nom="constructor",e.constructor=k);for(f=l-1;f;--f)(k=g[f]._meta)&&k.chains&&(h=v(h||{},k.chains));e["-chains-"]&&(h=v(h||{},e["-chains-"]));b&&b.prototype&&b.prototype["-chains-"]&&(h=v(h||{},b.prototype["-chains-"]));k=!h||!h.hasOwnProperty("constructor");g[0]=n=h&&"manual"===h.constructor?N(g):1==g.length?M(a.constructor,k):L(g,k);n._meta={bases:g,hidden:a,chains:h,parents:m,ctor:a.constructor};
n.superclass=b&&b.prototype;n.extend=J;n.createSubclass=K;n.prototype=e;e.constructor=n;e.getInherited=F;e.isInstanceOf=H;e.inherited=P;e.__inherited=B;c&&(e.declaredClass=c,A.setObject(c,n));if(h)for(d in h)e[d]&&"string"==typeof h[d]&&"constructor"!=d&&(k=e[d]=O(d,g,"after"===h[d]),k.nom=d);return n}var v=A.mixin,q=Object.prototype,u=q.toString,E=0;var y=z("csp-restrictions")?function(){}:new Function;var P=w.config.isDebug?G:B;w.safeMixin=t.safeMixin=function(c,b){var a;for(a in b){var f=b[a];
f===q[a]&&a in q||"constructor"==a||("[object Function]"==u.call(f)&&(f.nom=a),c[a]=f)}return c};return w.declare=t});