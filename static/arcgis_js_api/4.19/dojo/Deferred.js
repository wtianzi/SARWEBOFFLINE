//>>built
define(["./has","./_base/lang","./errors/CancelError","./promise/Promise","./has!config-deferredInstrumentation?./promise/instrumentation"],function(q,C,x,y,u){var z=Object.freeze||function(){},r=function(c,a,d,b,f){q("config-deferredInstrumentation")&&2===a&&k.instrumentRejected&&0===c.length&&k.instrumentRejected(d,!1,b,f);for(f=0;f<c.length;f++)v(c[f],a,d,b)},v=function(c,a,d,b){var f=c[a],g=c.deferred;if(f)try{var l=f(d);if(0===a)"undefined"!==typeof l&&p(g,a,l);else{if(l&&"function"===typeof l.then){c.cancel=
l.cancel;l.then(t(g,1),t(g,2),t(g,0));return}p(g,1,l)}}catch(m){p(g,2,m)}else p(g,a,d);q("config-deferredInstrumentation")&&2===a&&k.instrumentRejected&&k.instrumentRejected(d,!!f,b,g.promise)},t=function(c,a){return function(d){p(c,a,d)}},p=function(c,a,d){if(!c.isCanceled())switch(a){case 0:c.progress(d);break;case 1:c.resolve(d);break;case 2:c.reject(d)}},k=function(c){var a=this.promise=new y,d=this,b,f,g,l=!1,m=[];q("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(d,
k),Error.captureStackTrace(a,k));this.isResolved=a.isResolved=function(){return 1===b};this.isRejected=a.isRejected=function(){return 2===b};this.isFulfilled=a.isFulfilled=function(){return!!b};this.isCanceled=a.isCanceled=function(){return l};this.progress=function(e,h){if(b){if(!0===h)throw Error("This deferred has already been fulfilled.");return a}r(m,0,e,null,d);return a};this.resolve=function(e,h){if(b){if(!0===h)throw Error("This deferred has already been fulfilled.");return a}r(m,b=1,f=e,
null,d);m=null;return a};var w=this.reject=function(e,h){if(b){if(!0===h)throw Error("This deferred has already been fulfilled.");return a}q("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(g={},w);r(m,b=2,f=e,g,d);m=null;return a};this.then=a.then=function(e,h,A){var n=[A,e,h];n.cancel=a.cancel;n.deferred=new k(function(B){return n.cancel&&n.cancel(B)});b&&!m?v(n,b,f,g):m.push(n);return n.deferred.promise};this.cancel=a.cancel=function(e,h){if(!b){c&&(h=c(e),e=
"undefined"===typeof h?e:h);l=!0;if(!b)return"undefined"===typeof e&&(e=new x),w(e),e;if(2===b&&f===e)return e}else if(!0===h)throw Error("This deferred has already been fulfilled.");};z(a)};k.prototype.toString=function(){return"[object Deferred]"};u&&u(k);return k});