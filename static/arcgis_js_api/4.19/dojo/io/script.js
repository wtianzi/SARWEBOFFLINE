//>>built
define("../_base/connect ../_base/kernel ../_base/lang ../sniff ../_base/window ../_base/xhr ../dom ../dom-construct ../request/script ../aspect".split(" "),function(p,g,l,q,r,k,t,u,h,m){g.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var d={get:function(a){var c=this._makeScriptDeferred(a,function(e){f&&f.cancel()}),b=c.ioArgs;k._ioAddQueryToUrl(b);k._ioNotifyStart(c);var f=h.get(b.url,{timeout:a.timeout,jsonp:b.jsonp,checkString:a.checkString,ioArgs:b,frameDoc:a.frameDoc,canAttach:function(e){b.requestId=
e.id;b.scriptId=e.scriptId;b.canDelete=e.canDelete;return d._canAttach(b)}},!0);m.around(f,"isValid",function(e){return function(n){d._validCheck(c);return e.call(this,n)}});f.then(function(){c.resolve(c)}).otherwise(function(e){c.ioArgs.error=e;c.reject(e)});return c},attach:h._attach,remove:h._remove,_makeScriptDeferred:function(a,c){c=k._ioSetArgs(a,c||this._deferredCancel,this._deferredOk,this._deferredError);var b=c.ioArgs;b.id=g._scopeName+"IoScript"+this._counter++;b.canDelete=!1;b.jsonp=a.callbackParamName||
a.jsonp;b.jsonp&&(b.query=b.query||"",0<b.query.length&&(b.query+="\x26"),b.query+=b.jsonp+"\x3d"+(a.frameDoc?"parent.":"")+g._scopeName+".io.script.jsonp_"+b.id+"._jsonpCallback",b.frameDoc=a.frameDoc,b.canDelete=!0,c._jsonpCallback=this._jsonpCallback,this["jsonp_"+b.id]=c);c.addBoth(function(f){b.canDelete&&(f instanceof Error?d["jsonp_"+b.id]._jsonpCallback=function(){delete d["jsonp_"+b.id];if(b.requestId)g.global[h._callbacksProperty][b.requestId]()}:d._addDeadScript(b))});return c},_deferredCancel:function(a){a.canceled=
!0},_deferredOk:function(a){a=a.ioArgs;return a.json||a.scriptLoaded||a},_deferredError:function(a,c){console.log("dojo.io.script error",a);return a},_deadScripts:[],_counter:1,_addDeadScript:function(a){d._deadScripts.push({id:a.id,frameDoc:a.frameDoc});a.frameDoc=null},_validCheck:function(a){if((a=d._deadScripts)&&0<a.length){for(var c=0;c<a.length;c++)d.remove(a[c].id,a[c].frameDoc),delete d["jsonp_"+a[c].id],a[c].frameDoc=null;d._deadScripts=[]}return!0},_ioCheck:function(a){a=a.ioArgs;return a.json||
a.scriptLoaded&&!a.args.checkString?!0:(a=a.args.checkString)&&eval("typeof("+a+") !\x3d 'undefined'")},_resHandle:function(a){d._ioCheck(a)?a.callback(a):a.errback(Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(a){this.ioArgs.json=a;if(this.ioArgs.requestId)g.global[h._callbacksProperty][this.ioArgs.requestId](a)}};l.setObject("dojo.io.script",d);return d});