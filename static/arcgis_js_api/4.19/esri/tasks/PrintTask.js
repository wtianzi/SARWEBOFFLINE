// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/Polygon ../core/screenUtils ../kernel ../request ../renderers/visualVariables/support/visualVariableUtils ./support/Query ./Task ./Geoprocessor ./support/fileFormat ./support/layoutTemplate ./support/printTaskUtils ./support/PrintTemplate".split(" "),
function(H,B,y,I,ca,da,D,J,Q,R,A,ea,fa,S,z,C,K,T,U,V,W,X,Y,q,Z){function E(x){return x&&(x.path||"image/svg+xml"===x.contentType||x.url&&x.url.endsWith(".svg"))}const L={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},M=new J.JSONMap({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),aa=new J.JSONMap({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),ba=new U({returnGeometry:!0});y=function(x){function F(...a){a=x.call(this,...a)||this;
a._ssExtent=null;a._legendLayers=[];a._legendLayerNameMap={};a._gpServerUrl=null;a._cimVersion=null;a._is11xService=!1;a._gpMetadata=null;a.updateDelay=1E3;return a}H._inheritsLoose(F,x);var m=F.prototype;m.execute=function(a,b){let c=this.url;const f=c.lastIndexOf("/GPServer/");0<f&&(c=c.slice(0,f+9));return Promise.resolve().then(()=>{if(this._gpServerUrl===c)return{data:this._gpMetadata};this._gpServerUrl=c;return K(c,{query:{f:"json"}})}).then(d=>{this._gpMetadata=d.data;this._cimVersion=this._gpMetadata.cimVersion;
this._is11xService=!!this._cimVersion;return this._getGpPrintParams(a)}).then(d=>{const e=k=>"sync"===this.mode?k.results&&k.results[0]&&k.results[0].value:this._geoprocessor.getResultData(k.jobId,"Output_File",b).then(g=>g.value);return"async"===this.mode?this._geoprocessor.submitJob(d,b).then(k=>this._geoprocessor.waitForJobCompletion(k.jobId,{interval:this.updateDelay}).then(e)):this._geoprocessor.execute(d,b).then(e)})};m._createOperationalLayers=async function(a,b){const c=[],f={layerView:null,
printTemplate:b,view:a};let d=0;b.scalePreserved&&(d=b.outScale||a.scale);var e=q.getVisibleLayerViews(a,d);for(const k of e){e=k.layer;if(!e.loaded||q.isGroupLayer(e))continue;let g;f.layerView=k;if(g=q.isBingMapsLayer(e)?this._createBingMapsLayerJSON(e):q.isCSVLayer(e)?await this._createCSVLayerJSON(e,f):q.isFeatureLayer(e)?await this._createFeatureLayerJSON(e,f):q.isGeoJSONLayer(e)?await this._createGeoJSONLayer(e,f):q.isGraphicsLayer(e)?await this._createGraphicsLayerJSON(e,f):q.isImageryLayer(e)?
this._createImageryLayerJSON(e):q.isKMLLayer(e)?await this._createKMLLayerJSON(e,f):q.isMapImageLayer(e)?this._createMapImageLayerJSON(e,f):q.isMapNotesLayer(e)?await this._createMapNotesLayerJSON(f):q.isOpenStreetMapLayer(e)?this._createOpenStreetMapLayerJSON():q.isStreamLayer(e)?await this._createStreamLayerJSON(e,f):q.isTileLayer(e)?this._createTileLayerJSON(e):q.isVectorTileLayer(e)?await this._createVectorTileLayerJSON(e,f):q.isWebTileLayer(e)?this._createWebTileLayerJSON(e):q.isWMSLayer(e)?
this._createWMSLayerJSON(e):q.isWMTSLayer(e)?this._createWMTSLayerJSON(e):await this._createScreenshotJSON(e,f))Array.isArray(g)?c.push(...g):(g.id=e.id,g.title=this._legendLayerNameMap[e.id]||e.title,g.opacity=e.opacity,g.minScale=e.minScale||0,g.maxScale=e.maxScale||0,c.push(g))}d&&c.forEach(k=>{k.minScale=0;k.maxScale=0});a.graphics&&a.graphics.length&&(a=await this._createFeatureCollectionJSON(null,a.graphics,b))&&c.push(a);return c};m._createBingMapsLayerJSON=function(a){return{culture:a.culture,
key:a.key,type:`BingMaps${"aerial"===a.style?"Aerial":"hybrid"===a.style?"Hybrid":"Road"}`}};m._createCSVLayerJSON=async function(a,{layerView:b,printTemplate:c}){this._legendLayers&&this._legendLayers.push({id:a.id});if(this._is11xService)b={type:"CSV"},a.write(b,{origin:"web-map"}),delete b.popupInfo,delete b.layerType,b.showLabels=c.showLabels&&a.labelsVisible;else return b=await this._getGraphics(b),this._createFeatureCollectionJSON(a,b,c);return b};m._createFeatureCollectionJSON=async function(a,
b,c){let f;const d=q.createPolygonLayer(),e=q.createPolylineLayer(),k=q.createPointLayer(),g=q.createMultipointLayer(),n=q.createPointLayer();n.layerDefinition.name="textLayer";delete n.layerDefinition.drawingInfo;if(a){"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass?d.layerDefinition.name=e.layerDefinition.name=k.layerDefinition.name=g.layerDefinition.name=this._legendLayerNameMap[a.id]||a.get("arcgisProps.title")||a.title:"esri.layers.GraphicsLayer"===a.declaredClass&&
(b=a.graphics.items);if(a.renderer){var l=a.renderer.toJSON();d.layerDefinition.drawingInfo.renderer=l;e.layerDefinition.drawingInfo.renderer=l;k.layerDefinition.drawingInfo.renderer=l;g.layerDefinition.drawingInfo.renderer=l}if(c.showLabels&&a.labelsVisible&&"function"===typeof a.write){var r,p;if(l=null==(r=a.write({},{origin:"web-map"}).layerDefinition)?void 0:null==(p=r.drawingInfo)?void 0:p.labelingInfo)f=!0,d.layerDefinition.drawingInfo.labelingInfo=l,e.layerDefinition.drawingInfo.labelingInfo=
l,k.layerDefinition.drawingInfo.labelingInfo=l,g.layerDefinition.drawingInfo.labelingInfo=l}}null!=a&&a.renderer||f||(delete d.layerDefinition.drawingInfo,delete e.layerDefinition.drawingInfo,delete k.layerDefinition.drawingInfo,delete g.layerDefinition.drawingInfo);r=a&&a.fields;p=a&&a.renderer;if(r&&p&&"function"===typeof p.collectRequiredFields){var v=new Set;await p.collectRequiredFields(v,r);v=Array.from(v)}r&&(r=r.map(t=>t.toJSON()),d.layerDefinition.fields=r,e.layerDefinition.fields=r,k.layerDefinition.fields=
r,g.layerDefinition.fields=r);r=b&&b.length;let h;for(p=0;p<r;p++)if(l=b[p]||b.getItemAt(p),!1!==l.visible&&l.geometry&&(h=l.toJSON(),h.hasOwnProperty("popupTemplate")&&delete h.popupTemplate,h.geometry&&h.geometry.z&&delete h.geometry.z,!h.symbol||!h.symbol.outline||"esriCLS"!==h.symbol.outline.type||this._is11xService)){!this._is11xService&&h.symbol&&h.symbol.outline&&h.symbol.outline.color&&h.symbol.outline.color[3]&&(h.symbol.outline.color[3]=255);var w=a&&a.renderer&&("valueExpression"in a.renderer&&
a.renderer.valueExpression||"hasVisualVariables"in a.renderer&&a.renderer.hasVisualVariables());if(!h.symbol&&a&&a.renderer&&w&&!this._is11xService){w=a.renderer;const t=await w.getSymbolAsync(l);if(!t)continue;h.symbol=t.toJSON();"hasVisualVariables"in w&&w.hasVisualVariables()&&q.applyVisualVariables(h.symbol,{renderer:w,graphic:l,symbol:t})}h.symbol&&(h.symbol.angle||delete h.symbol.angle,E(h.symbol)?h.symbol=await this._convertSvgToPictureMarkerSymbolJson(h.symbol):h.symbol.text&&delete h.attributes);
if((!c||!c.forceFeatureAttributes)&&v&&v.length){const t={};v.forEach(u=>{h.attributes&&h.attributes.hasOwnProperty(u)&&(t[u]=h.attributes[u])});h.attributes=t}"polygon"===l.geometry.type?d.featureSet.features.push(h):"polyline"===l.geometry.type?e.featureSet.features.push(h):"point"===l.geometry.type?h.symbol&&h.symbol.text?n.featureSet.features.push(h):k.featureSet.features.push(h):"multipoint"===l.geometry.type?g.featureSet.features.push(h):"extent"===l.geometry.type&&(h.geometry=S.fromExtent(l.geometry).toJSON(),
d.featureSet.features.push(h))}a=[d,e,g,k,n].filter(t=>0<t.featureSet.features.length);for(const t of a)b=t.featureSet.features.every(u=>u.symbol),!b||c&&c.forceFeatureAttributes||t.featureSet.features.forEach(u=>{delete u.attributes}),b&&delete t.layerDefinition.drawingInfo,t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer&&await this._convertSvgRenderer(t.layerDefinition.drawingInfo.renderer);return a.length?{featureCollection:{layers:a},showLabels:f}:null};m._createFeatureLayerJSON=
async function(a,b){var c,f;this._legendLayers&&this._legendLayers.push({id:a.id});var d=a.renderer;if(a.featureReduction||d&&"dot-density"===d.type&&(!this._is11xService||2.6>parseFloat(this._cimVersion)))return this._createScreenshotJSON(a,b);const {layerView:e,printTemplate:k,view:g}=b;b=d&&("valueExpression"in d&&d.valueExpression||"hasVisualVariables"in d&&d.hasVisualVariables());const n="feature-layer"!==(null==(c=a.source)?void 0:c.type)&&"ogc-feature"!==(null==(f=a.source)?void 0:f.type);
if(!this._is11xService&&b||a.featureReduction||n||!d||"field"in d&&null!=d.field&&("string"!==typeof d.field||!a.getField(d.field)))d=await this._getGraphics(e),c=await this._createFeatureCollectionJSON(a,d,k);else{var l,r;c=a.write();c={id:c.id,title:c.title,opacity:c.opacity,minScale:c.minScale,maxScale:c.maxScale,url:c.url,layerDefinition:c.layerDefinition};c.showLabels=k.showLabels&&a.labelsVisible;this._setURLandToken(c,a);null!=(l=c.layerDefinition)&&null!=(r=l.drawingInfo)&&r.renderer&&(delete c.layerDefinition.minScale,
delete c.layerDefinition.maxScale,await this._convertSvgRenderer(c.layerDefinition.drawingInfo.renderer),"visualVariables"in d&&d.visualVariables&&d.visualVariables[0]&&(a=d.visualVariables[0],"size"===a.type&&a.maxSize&&"number"!==typeof a.maxSize&&a.minSize&&"number"!==typeof a.minSize&&(a=T.getSizeRangeAtScale(a,g.scale),c.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=a.minSize,c.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=a.maxSize)))}return c};m._createGeoJSONLayer=
async function(a,{layerView:b,printTemplate:c}){this._legendLayers&&this._legendLayers.push({id:a.id});b=await this._getGraphics(b);return this._createFeatureCollectionJSON(a,b,c)};m._createGraphicsLayerJSON=async function(a,{printTemplate:b}){return this._createFeatureCollectionJSON(a,null,b)};m._createImageryLayerJSON=function(a){this._legendLayers&&this._legendLayers.push({id:a.id});const b={bandIds:a.bandIds,compressionQuality:a.compressionQuality,format:a.format,interpolation:a.interpolation};
if(a.mosaicRule||a.definitionExpression)b.mosaicRule=a.exportImageServiceParameters.mosaicRule.toJSON();if(a.renderingRule||a.renderer)if(this._is11xService)a.renderingRule&&(b.renderingRule=a.renderingRule.toJSON()),a.renderer&&(b.layerDefinition=b.layerDefinition||{},b.layerDefinition.drawingInfo=b.layerDefinition.drawingInfo||{},b.layerDefinition.drawingInfo.renderer=a.renderer.toJSON());else{const c=a.exportImageServiceParameters.combineRendererWithRenderingRule();c&&(b.renderingRule=c.toJSON())}this._setURLandToken(b,
a);return b};m._createKMLLayerJSON=async function(a,b){var c=b.printTemplate;if(this._is11xService)return c={type:"kml"},a.write(c,{origin:"web-map"}),delete c.layerType,c.url=A.normalize(a.url),c;{const f=[];b=b.layerView;b.allVisibleMapImages.forEach((d,e)=>{e={id:`${a.id}_image${e}`,type:"image",title:a.id,minScale:a.minScale||0,maxScale:a.maxScale||0,opacity:a.opacity,extent:d.extent};"data:image/png;base64,"===d.href.substr(0,22)?e.imageData=d.href.substr(22):e.url=d.href;f.push(e)});b=[...b.allVisiblePoints.items,
...b.allVisiblePolylines.items,...b.allVisiblePolygons.items];c={id:a.id,...await this._createFeatureCollectionJSON(null,b,c)};f.push(c);return f}};m._createMapImageLayerJSON=function(a,{view:b}){let c;const f={id:a.id,subLayerIds:[]};let d=[];const e=b.scale,k=g=>{var n=0===e;const l=0===g.minScale||e<=g.minScale,r=0===g.maxScale||e>=g.maxScale;g.visible&&(n||l&&r)&&(g.sublayers?g.sublayers.forEach(k):(n=g.toExportImageJSON(),d.unshift({id:g.id,name:g.title,layerDefinition:{drawingInfo:n.drawingInfo,
definitionExpression:n.definitionExpression,source:n.source}}),f.subLayerIds.push(g.id)))};a.sublayers&&a.sublayers.forEach(k);d.length&&(d=d.map(({id:g,name:n,layerDefinition:l})=>({id:g,name:n,layerDefinition:l})),c={layers:d,visibleLayers:a.capabilities.exportMap.supportsDynamicLayers?void 0:f.subLayerIds},this._setURLandToken(c,a),this._legendLayers.push(f));return c};m._createMapNotesLayerJSON=async function({layerView:a,printTemplate:b}){const c=[];a=a.layer;if(I.isSome(a.featureCollections))for(var f of a.featureCollections){var d=
await this._createFeatureCollectionJSON(f,f.source,b);d&&c.push(...d.featureCollection.layers)}else if(I.isSome(a.sublayers))for(d of a.sublayers)(f=await this._createFeatureCollectionJSON(null,d.graphics,b))&&c.push(...f.featureCollection.layers);return{featureCollection:{layers:c}}};m._createOpenStreetMapLayerJSON=function(){return{type:"OpenStreetMap"}};m._createScreenshotJSON=async function(a,{printTemplate:b,view:c}){const f={type:"image"};a={format:"png",ignoreBackground:!0,layers:[a],rotation:0};
const d=this._ssExtent||c.extent.clone();let e=96,k=!0,g=!0;if(b.exportOptions){const n=b.exportOptions;0<n.dpi&&(e=n.dpi);0<n.width&&(k=n.width%2===c.width%2);0<n.height&&(g=n.height%2===c.height%2)}"map-only"!==b.layout||!b.scalePreserved||b.outScale&&b.outScale!==c.scale||96!==e||k&&g||(a.area={x:0,y:0,width:c.width,height:c.height},k||--a.area.width,g||--a.area.height,this._ssExtent||(b=c.toMap(z.createScreenPoint(a.area.width,a.area.height)),d.ymin=b.y,d.xmax=b.x,this._ssExtent=d));f.extent=
d.clone()._normalize(!0).toJSON();c=await c.takeScreenshot(a);c=A.dataComponents(c.dataUrl);f.imageData=c.data;return f};m._createStreamLayerJSON=async function(a,{layerView:b,printTemplate:c}){this._legendLayers&&this._legendLayers.push({id:a.id});b=await this._getGraphics(b);return this._createFeatureCollectionJSON(a,b,c)};m._createTileLayerJSON=function(a){const b={customParameters:a.customParameters};this._setURLandToken(b,a);return b};m._createVectorTileLayerJSON=async function(a,b){if(this._is11xService&&
a.serviceUrl&&a.styleUrl){const c=C.id&&C.id.findCredential(a.styleUrl),f=C.id&&C.id.findCredential(a.serviceUrl);if(!c&&!f||"2.1.0"!==this._cimVersion)return b={type:"VectorTileLayer"},b.styleUrl=A.normalize(a.styleUrl),c&&(b.token=c.token),f&&f.token!==b.token&&(b.additionalTokens=[{url:a.serviceUrl,token:f.token}]),b}return this._createScreenshotJSON(a,b)};m._createWebTileLayerJSON=function(a){const b={type:"WebTiledLayer",urlTemplate:a.urlTemplate.replace(/\${/g,"{"),credits:a.copyright};a.subDomains&&
0<a.subDomains.length&&(b.subDomains=a.subDomains);return b};m._createWMSLayerJSON=function(a){let b;const c=[],f=d=>{d.visible&&(d.sublayers?d.sublayers.forEach(f):d.name&&c.unshift(d.name))};a.sublayers&&a.sublayers.forEach(f);c.length&&(b={type:"wms",customLayerParameters:a.customLayerParameters,customParameters:a.customParameters,transparentBackground:a.imageTransparency,visibleLayers:c,url:A.normalize(a.url),version:a.version});return b};m._createWMTSLayerJSON=function(a){const b=a.activeLayer;
return{type:"wmts",customLayerParameters:a.customLayerParameters,customParameters:a.customParameters,format:b.imageFormat,layer:b.id,style:b.styleId,tileMatrixSet:b.tileMatrixSetId,url:A.normalize(a.url)}};m._setURLandToken=function(a,b){var c;b.url&&(a.url=A.normalize(a.url||b.url),b=null==(c=C.id)?void 0:c.findCredential(b.url))&&(a.token=b.token)};m._convertSvgToPictureMarkerSymbolJson=async function(a){this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.width=1024;this._canvas.height=
1024;const b=this._canvas.getContext("2d");if(a.path){var c;var f=new Path2D(a.path);f.closePath();b.fillStyle=Array.isArray(a.color)?`rgba(${a.color[0]},${a.color[1]},${a.color[2]},${a.color[3]/255})`:"rgb(0,0,0)";b.fill(f);var d=q.getContextBoundingBox(b);if(!d)return null;b.clearRect(0,0,1024,1024);var e=z.pt2px(a.size)/Math.max(d.width,d.height);b.scale(e,e);const k=1024/e;b.translate(k/2-d.width/2-d.x,k/2-d.height/2-d.y);Array.isArray(a.color)&&b.fill(f);null!=(c=a.outline)&&c.width&&Array.isArray(a.outline.color)&&
(c=a.outline,b.lineWidth=z.pt2px(c.width)/e,b.lineJoin="round",b.strokeStyle=`rgba(${c.color[0]},${c.color[1]},${c.color[2]},${c.color[3]/255})`,b.stroke(f),d.width+=b.lineWidth,d.height+=b.lineWidth);d.width*=e;d.height*=e;e=b.getImageData(512-d.width/2,512-d.height/2,Math.ceil(d.width),Math.ceil(d.height));f=e.width;d=e.height;b.canvas.width=f;b.canvas.height=d;b.putImageData(e,0,0)}else e=(await K("image/svg+xml"===a.contentType?"data:image/svg+xml;base64,"+a.imageData:a.url,{responseType:"image"})).data,
f=z.pt2px(a.width),d=z.pt2px(a.height),b.canvas.width=f,b.canvas.height=d,b.drawImage(e,0,0,b.canvas.width,b.canvas.height);return{type:"esriPMS",imageData:b.canvas.toDataURL("image/png").substr(22),angle:a.angle,contentType:"image/png",height:z.px2pt(d),width:z.px2pt(f),xoffset:a.xoffset,yoffset:a.yoffset}};m._convertSvgRenderer=async function(a){const b=a.type;if("simple"===b&&E(a.symbol))a.symbol=await this._convertSvgToPictureMarkerSymbolJson(a.symbol);else if("uniqueValue"===b||"classBreaks"===
b)if(E(a.defaultSymbol)&&(a.defaultSymbol=await this._convertSvgToPictureMarkerSymbolJson(a.defaultSymbol)),a=a["uniqueValue"===b?"uniqueValueInfos":"classBreakInfos"])for(const c of a)E(c.symbol)&&(c.symbol=await this._convertSvgToPictureMarkerSymbolJson(c.symbol))};m._getGraphics=function(a){return a.queryFeatures(ba).then(b=>b.features)};m._getPrintDefinition=async function(a,b){const c=a.view;let f=c.spatialReference;const d={operationalLayers:await this._createOperationalLayers(c,b)};a=this._ssExtent||
a.extent||c.extent;f&&f.isWrappable&&(a=a.clone()._normalize(!0),f=a.spatialReference);d.mapOptions={extent:a&&a.toJSON(),spatialReference:f&&f.toJSON(),showAttribution:b.attributionVisible};this._ssExtent=null;c.background&&(d.background=c.background.toJSON());c.rotation&&(d.mapOptions.rotation=-c.rotation);b.scalePreserved&&(d.mapOptions.scale=b.outScale||c.scale);return d};m._getGpPrintParams=async function(a){var b=a.template||new Z;null==b.showLabels&&(b.showLabels=!0);var c=b.exportOptions;
let f;const d=Y.toJSON(b.layout);c&&(f={dpi:c.dpi},"map_only"===d.toLowerCase()||""===d)&&(f.outputSize=[c.width,c.height]);c=b.layoutOptions;let e;if(c){let g;if("Miles"===c.scalebarUnit||"Kilometers"===c.scalebarUnit){var k="Kilometers";g="Miles"}else if("Meters"===c.scalebarUnit||"Feet"===c.scalebarUnit)k="Meters",g="Feet";e={titleText:c.titleText,authorText:c.authorText,copyrightText:c.copyrightText,customTextElements:c.customTextElements,scaleBarOptions:{metricUnit:M.toJSON(k),metricLabel:L[k],
nonMetricUnit:M.toJSON(g),nonMetricLabel:L[g]}}}k=null;c&&c.legendLayers&&(k=c.legendLayers.map(g=>{this._legendLayerNameMap[g.layerId]=g.title;const n={id:g.layerId};g.subLayerIds&&(n.subLayerIds=g.subLayerIds);return n}));c=await this._getPrintDefinition(a,b);if(c.operationalLayers){const g=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,n=/[\u0600-\u06FF]/,l=p=>{const v=p.text,h=(p=p.font)&&p.family&&p.family.toLowerCase();v&&p&&("arial"===h||"arial unicode ms"===
h)&&(p.family=g.test(v)?"Arial Unicode MS":"Arial","normal"!==p.style&&n.test(v)&&(p.family="Arial Unicode MS"))},r=()=>{throw new R("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap");};c.operationalLayers.forEach(p=>{var v,h,w;null!=(v=p.featureCollection)&&v.layers?p.featureCollection.layers.forEach(t=>{var u,N,O,P;null!=(u=t.layerDefinition)&&null!=(N=u.drawingInfo)&&null!=(O=N.renderer)&&O.symbol&&(u=t.layerDefinition.drawingInfo.renderer,
"esriTS"===u.symbol.type?l(u.symbol):"CIMSymbolReference"!==u.symbol.type||this._is11xService||r());null!=(P=t.featureSet)&&P.features&&t.featureSet.features.forEach(G=>{G.symbol&&("esriTS"===G.symbol.type?l(G.symbol):"CIMSymbolReference"!==G.symbol.type||this._is11xService||r())})}):!this._is11xService&&null!=(h=p.layerDefinition)&&null!=(w=h.drawingInfo)&&w.renderer&&JSON.stringify(p.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&r()})}a.outSpatialReference&&(c.mapOptions.spatialReference=
a.outSpatialReference.toJSON());Object.assign(c,{exportOptions:f,layoutOptions:e||{}});Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:null!=k?k:this._legendLayers.slice()}});this._legendLayers.length=0;b={Web_Map_as_JSON:JSON.stringify(c),Format:X.toJSON(b.format),Layout_Template:d};a.extraParameters&&Object.assign(b,a.extraParameters);return b};H._createClass(F,[{key:"_geoprocessor",get:function(){return new W({url:this.url})}},{key:"mode",get:function(){return this._gpMetadata&&
this._gpMetadata.executionType?aa.fromJSON(this._gpMetadata.executionType):"sync"}}]);return F}(V);B.__decorate([D.property()],y.prototype,"_geoprocessor",null);B.__decorate([D.property()],y.prototype,"_gpMetadata",void 0);B.__decorate([D.property({readOnly:!0})],y.prototype,"mode",null);B.__decorate([D.property()],y.prototype,"updateDelay",void 0);return y=B.__decorate([Q.subclass("esri.tasks.PrintTask")],y)});