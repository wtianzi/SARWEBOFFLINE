// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../core/maybe ../../Color ../../tasks/support/AlgorithmicColorRamp ../../tasks/support/MultipartColorRamp ./AuthoringInfo ../../core/unitUtils ./ClassBreakInfo ../ClassBreaksRenderer ./colorRampUtils ../RasterColormapRenderer ../RasterShadedReliefRenderer ../RasterStretchRenderer ./UniqueValueInfo ../UniqueValueRenderer ../VectorFieldRenderer ../../rasterRenderers ../../layers/support/Field ../../layers/support/RasterInfo ../../tasks/support/ClassBreaksDefinition ../../tasks/support/generateRendererUtils".split(" "),
function(m,k,x,V,A,H,W,X,Y,z,Z,aa,ba,I,ca,da,ka,ea,fa,ha,ia){function J(a,b){var d,c,e,f;a=K(a,null==b?void 0:b.variableName);const {bandCount:l}=a;let {bandIds:p,stretchType:q}=b||{};null!=(d=p)&&d.some(r=>r>=l)&&(p=null);let u=k.unwrap(a.statistics),h=k.unwrap(a.histograms);if(1<l){var v;p=null!=(v=p)&&v.length?p:L(a);u=null==u?null:p.map(r=>u[r]);h=null==h?null:p.map(r=>h[r])}else p=[0];null==q&&(q=ja(a));b=!1;switch(q){case "none":b=!1;break;case "percent-clip":b=!(null!=(c=h)&&c.length);break;
default:b=!(null!=(e=u)&&e.length)}a=1===(null==(f=p)?void 0:f.length)&&"scientific"===a.dataType?M:null;f=new ba({stretchType:q,dynamicRangeAdjustment:b,colorRamp:a,outputMin:0,outputMax:255,gamma:1===p.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===q?f.maxPercent=f.minPercent=.25:"standard-deviation"===q&&(f.numberOfStandardDeviations=2);if(!b)if("percent-clip"===q)f.histograms=h;else if("min-max"===q||"standard-deviation"===q)f.statistics=u;return f}function K(a,b){if(null==b)return a;let d=
k.unwrap(a.statistics),c=k.unwrap(a.histograms);const {multidimensionalInfo:e}=a;if(b&&k.isSome(e)){const {statistics:f,histograms:l}=e.variables.find(p=>p.name===b);null!=f&&f.length&&(d=f);null!=l&&l.length&&(c=l)}return fa.fromJSON({...a.toJSON(),statistics:d,histograms:c})}function L(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;let d;if(a&&a.length===b){const {red:c,green:e,blue:f,nir:l}=N(a);null!=c&&null!=e&&null!=f?d=[c,e,
f]:null!=l&&null!=c&&null!=e&&(d=[l,c,e])}!d&&3<=b&&(d=[0,1,2]);return d}function N(a){const b={};for(let f=0;f<a.length;f++){var d,c=a[f],e=null==(d=c.BandName)?void 0:d.toLowerCase();"red"===e?b.red=f:"green"===e?b.green=f:"blue"===e?b.blue=f:"nearinfrared"===e||"nearinfrared_1"===e||"nir"===e?b.nir=f:c.WavelengthMax&&c.WavelengthMin&&(e=c.WavelengthMin,c=c.WavelengthMax,null==b.blue&&410<=e&&480>=e&&480<=c&&540>=c?b.blue=f:null==b.green&&490<=e&&560>=e&&560<=c&&610>=c?b.green=f:null==b.red&&595<=
e&&670>=e&&660<=c&&730>=c?b.red=f:null==b.nir&&700<=e&&860>=e&&800<=c&&950>=c&&(b.nir=f))}return b}function ja(a){let b="percent-clip";const {pixelType:d,dataType:c,histograms:e,statistics:f}=a;"u8"!==d||"processed"!==c&&k.isSome(e)&&k.isSome(f)?"u8"===d||"elevation"===c||"scientific"===c?b="min-max":k.isSome(e)?b="percent-clip":k.isSome(f)&&(b=b="min-max"):b="none";return b}function O(a,b,d,c){if(!B(a,b))return null;const {attributeTable:e,statistics:f}=a,l=C(e,b),p=y(e,"red"),q=y(e,"green"),u=y(e,
"blue");a=new H;const h=[],v=new Set,r=!!(p&&q&&u);if(k.isSome(e))e.features.forEach(n=>{const g=n.attributes[l.name];v.has(n.attributes[l.name])||null==g||(v.add(g),h.push(new I({value:n.attributes[l.name],label:n.attributes[l.name]+"",symbol:{type:"simple-fill",style:"solid",outline:null,color:r?new x([n.attributes[p.name],n.attributes[q.name],n.attributes[u.name],1]):new x([0,0,0,0])}})))});else if(null!=f&&f[0])for(b=f[0].min;b<=f[0].max;b++)h.push(new I({value:b,label:b.toString(),symbol:{type:"simple-fill",
style:"solid",outline:null,color:new x([0,0,0,0])}}));h.sort((n,g)=>n.value&&"string"===typeof n.value.valueOf()?0:n.value>g.value?1:-1);if(!r){const n=z.convertColorRampToColormap(P,h.length);h.forEach((g,t)=>g.symbol.color=new x(n[t].slice(1,4)));a.colorRamp=P}if(d||c){const n=d||z.convertColorRampToColormap(c,h.length).map(g=>g.slice(1));h.forEach((g,t)=>g.symbol.color=new x(n[t]));a.colorRamp=c}return new ca({field:l.name,uniqueValueInfos:h,authoringInfo:a})}function C(a,b){let d;k.isSome(a)?
(d=b?a.fields.find(c=>b.toLowerCase()===c.name.toLowerCase()):a.fields.find(c=>"string"===c.type&&-1<c.name.toLowerCase().indexOf("class")),d||(d=a.fields.find(c=>"string"===c.type))||(d=y(a,"value"))):d=new ea({name:"value"});return d}function y(a,b){return k.isSome(a)?a.fields.find(d=>d.name.toLowerCase()===b):null}function B(a,b){const {attributeTable:d,bandCount:c}=a;return!k.isSome(d)&&Q(a)?!0:!k.isSome(d)||1<c||b&&null==d.fields.find(e=>e.name.toLowerCase()===b.toLowerCase())?!1:!0}function D(a){const {bandCount:b,
colormap:d}=a;return k.isSome(d)&&d.length&&1===b}function R(a){if(!D(a))return null;let b;const {attributeTable:d,colormap:c}=a;if(k.isSome(d)){const e=y(d,"value"),f=C(d);"string"===f.type&&(b={},d.features.forEach(l=>{l=l.attributes;b[l[e.name]]=f?l[f.name]:l[e.name]}))}return Z.createFromColormap(k.unwrap(c),b)}function E(a){return"elevation"===a.dataType}function F(a){const {attributeTable:b,bandCount:d}=a;return 1===d&&(k.isSome(b)||k.isSome(a.histograms))}function Q(a){var b,d,c;return-1<["u8",
"s8"].indexOf(a.pixelType)&&null!=(null==(b=a.statistics)?void 0:null==(d=b[0])?void 0:d.min)&&null!=(null==(c=a.statistics[0])?void 0:c.max)&&1===a.bandCount}function G(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function S(a){return G(a)?new da:null}function T(a){var b;return{color:null==(b=a.symbolLayers[0].material)?void 0:b.color,type:"esriSFS",style:"esriSFSSolid"}}const M=A.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,
255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),P=A.fromJSON(z.PREDEFINED_JSON_COLOR_RAMPS[0]);m.createClassBreaksRenderer=function(a,b){a=K(a,null==b?void 0:b.variableName);const {attributeTable:d}=a;if(!F(a))return null;const c=k.isSome(a.histograms)?a.histograms[0]:null;var e=(null==b?void 0:b.numClasses)||5;const f=new H({classificationMethod:null==b?void 0:b.classificationMethod,colorRamp:null==b?void 0:b.colorRamp});let l=(null==b?void 0:b.field)||"value";const p=[],q=
[];if(k.isSome(d)){const h=d.fields.find(g=>"count"===g.name.toLowerCase()),v=d.fields.find(g=>g.name.toLowerCase()===l.toLowerCase());l=v.name;const r=d.features.length;let n=0;d.features.forEach(g=>n+=g.attributes[h.name]/r);d.features.forEach(g=>{const t=g.attributes[v.name];g=g.attributes[h.name];if(0<g){q.push(g);g=Math.max(1,Math.round(g/r/n*1E3));for(let w=0;w<g;w++)p.push(t)}})}else{({pixelType:a}=a);const h=(c.max-c.min)/c.size,v=(a=-1<a.indexOf("s")||-1<a.indexOf("u"))&&1===h?Math.floor(c.min+
.5):c.min,r=a&&1===h?Math.floor(c.max-.5):c.max,n=c.size;let g=0;c.counts.forEach(t=>g+=t/n);c.counts.forEach((t,w)=>{if(0<t){q.push(t);t=Math.max(1,Math.round(t/n/g*1E3));w=0===w?v:w===n-1?r:c.min+h*(w+.5);for(let U=0;U<t;U++)p.push(w)}})}e=ia.createGenerateRendererClassBreaks({values:p,valueFrequency:q,normalizationTotal:null,definition:new ha({classificationMethod:(null==b?void 0:b.classificationMethod)||"natural-breaks",breakCount:e,definedInterval:null==b?void 0:b.definedInterval})});let u=null==
b?void 0:b.colors;u||(b=(null==b?void 0:b.colorRamp)||M,f.colorRamp=b,u=z.convertColorRampToColormap(b,e.classBreaks.length,!0).map(h=>h.slice(1)));b=e.classBreaks.map((h,v)=>new X({minValue:h.minValue,maxValue:h.maxValue,label:h.label,symbol:{type:"simple-fill",color:u[v]}}));return new Y({field:l,classBreakInfos:b,authoringInfo:f})};m.createColorRamp=function(a){const b=[];for(let d=0;d<a.length-1;d++)b[d]=new V({algorithm:"hsv",fromColor:a[d],toColor:a[d+1]||new x({r:255,g:255,b:255,a:1})});return 2<
a.length?new A({colorRamps:b}):b[0]};m.createColormapRenderer=R;m.createDefaultRenderer=function(a,b){const {attributeTable:d,colormap:c,dataType:e}=a;if("vector-uv"===e||"vector-magdir"===e){var f=S(a);if(k.isSome(f))return f}return k.isSome(c)&&(f=R(a),k.isSome(f))||k.isSome(d)&&(f=O(a),k.isSome(f))?f:J(a,b)};m.createShadedReliefRenderer=function(a,b){var d;if(!E(a))return null;({extent:a}=a);a=a.width*W.getMetersPerUnitForSR(a.spatialReference);b=null!=(d=b)?d:"multi-directional";return new aa({hillshadeType:b,
scalingType:5E6<a?"adjusted":"none"})};m.createStretchRenderer=J;m.createUVRenderer=O;m.createVectorFieldRenderer=S;m.getBandNames=function(a,b){var d;const c=a.keyProperties&&a.keyProperties.BandProperties;b=null!=(d=b)&&d.length?b:Array.from(Array(a.bandCount).keys());return b.map(e=>c&&c.length===a.bandCount?c[e]&&c[e].BandName||"band_"+(e+1):"band_"+(e+1))};m.getClassField=C;m.getDefaultBandCombination=L;m.getDefaultInterpolation=function(a,b,d){const c=["nearest","bilinear","cubic","majority"].find(e=>
e===(null==d?void 0:d.toLowerCase()));return"Map"===b?null!=c?c:"bilinear":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===c||"majority"===c?c:"nearest":null!=c?c:"bilinear"};m.getSupportedRendererTypes=function(a){const b=["raster-stretch"];D(a)&&b.push("raster-colormap");B(a)&&b.push("unique-value");F(a)&&b.push("class-breaks");E(a)&&b.push("raster-shaded-relief");G(a)&&b.push("vector-field");return b};m.getWellKnownBandIndexes=N;m.isClassBreaksSupported=F;m.isColormapRendererSupported=
D;m.isShadedReliefRendererSupported=E;m.isSingleBand8BitRasterWithStats=Q;m.isUVRendererSupported=B;m.isVectorFieldRendererSupported=G;m.normalizeRendererJSON=function(a){if("uniqueValue"===a.type){var b,d=a.uniqueValueInfos,c=d[0].symbol;null!=c&&null!=(b=c.symbolLayers)&&b.length&&(a.uniqueValueInfos=d.map(e=>({value:e.value,label:e.label,symbol:e.symbol?T(e.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,c=b[0].symbol,null!=c&&null!=(d=c.symbolLayers)&&d.length&&(a.classBreakInfos=
b.map(e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?T(e.symbol):null}))));return a};Object.defineProperty(m,"__esModule",{value:!0})});