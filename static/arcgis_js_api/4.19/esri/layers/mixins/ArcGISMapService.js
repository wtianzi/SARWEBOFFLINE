// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../../core/Version ../support/commonProperties".split(" "),
function(m,u,d,G,H,I,g,J,n,v,w,K,L,x,y,z,A,B,p){m.ArcGISMapService=c=>{c=function(q){function k(){var b=q.apply(this,arguments)||this;b.capabilities=void 0;b.copyright=null;b.fullExtent=null;b.legendEnabled=!0;b.spatialReference=null;b.version=null;return b}u._inheritsLoose(k,q);var h=k.prototype;h.readCapabilities=function(b,a){var e=a.capabilities&&a.capabilities.split(",").map(C=>C.toLowerCase().trim());if(!e)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var f=this.type;b=-1!==e.indexOf("query");const r=-1!==e.indexOf("map"),t=!!a.exportTilesAllowed;e=-1!==e.indexOf("tilemap");const l="tile"!==f&&!!a.supportsDynamicLayers,D="tile"!==f&&(!a.tileInfo||l),E="tile"!==f&&(!a.tileInfo||l);f="tile"!==f;const F=a.cimVersion?B.Version.parse(a.cimVersion).since(1,4):!1;return{operations:{supportsQuery:b,supportsExportMap:r,supportsExportTiles:t,supportsTileMap:e},exportMap:r?{supportsArcadeExpressionForLabeling:F,supportsSublayersChanges:f,
supportsDynamicLayers:l,supportsSublayerVisibility:D,supportsSublayerDefinitionExpression:E}:null,exportTiles:t?{maxExportTilesCount:+a.maxExportTilesCount}:null}};h.readVersion=function(b,a){(b=a.currentVersion)||(b=a.hasOwnProperty("capabilities")||a.hasOwnProperty("tables")?10:a.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return b};h.fetchSublayerInfo=async function(b,a){await this.fetchAllLayersAndTables(a);return this._allLayersAndTablesMap.get(b)};h.fetchAllLayersAndTables=async function(b){await this.load(b);
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=A(w.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(e=>{this._allLayersAndTablesMap=new Map;for(const f of e.data.layers)this._allLayersAndTablesMap.set(f.id,f);return{result:e.data}},e=>({error:e})));const a=await this._allLayersAndTablesPromise;x.throwIfAborted(b);if("result"in a)return a.result;throw a.error;};return k}(c);d.__decorate([g.property({readOnly:!0})],c.prototype,
"capabilities",void 0);d.__decorate([n.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],c.prototype,"readCapabilities",null);d.__decorate([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);d.__decorate([g.property({type:z})],c.prototype,"fullExtent",void 0);d.__decorate([g.property(p.id)],c.prototype,"id",void 0);d.__decorate([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},
read:{source:"showLegend"},write:{target:"showLegend"}}})],c.prototype,"legendEnabled",void 0);d.__decorate([g.property(p.popupEnabled)],c.prototype,"popupEnabled",void 0);d.__decorate([g.property({type:y})],c.prototype,"spatialReference",void 0);d.__decorate([g.property()],c.prototype,"version",void 0);d.__decorate([n.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=d.__decorate([v.subclass("esri.layers.mixins.ArcGISMapService")],
c)};Object.defineProperty(m,"__esModule",{value:!0})});