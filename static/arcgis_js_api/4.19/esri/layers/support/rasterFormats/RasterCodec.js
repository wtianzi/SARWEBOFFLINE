// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Error ../PixelBlock ../../../chunks/_commonjsHelpers ../../../chunks/Zlib ./ImageCanvasDecoder ./JpgPlus ../../../chunks/LercCodec ./Raw ./utils ./TiffDecoder".split(" "),function(Q,J,K,X,Y,Z,aa,ba,ca,S,T){function da(m,q){if(!S.isPlatformLittleEndian)throw new J("rasterCoded:decode","lerc decoder is not supported on big endian platform");const {width:t,height:v,pixelType:b}=q;var a=U(b);const e=a.pixelTypeCtor;q=null==q.noDataValue?a.noDataValue:q.noDataValue;a=0;let d,
c=0,g;const k=m.byteLength-10;for(;c<k;){var h=ba.decode(m,{inputOffset:c,encodedMaskData:d,returnMask:0===a?!0:!1,returnEncodedMask:0===a?!0:!1,returnFileInfo:!0,pixelType:e,noDataValue:q});if(t&&v&&(h.width!==t||h.height!==v))throw new J("rasterCoded:decode","lerc decoded result has width or height different from specified in options");c=h.fileInfo.eofOffset;0===a&&(d=h.encodedMaskData,g=new K({width:h.width,height:h.height,pixels:[],pixelType:b,mask:h.maskData,statistics:[]}));a++;g.addData({pixels:h.pixelData,
statistics:{minValue:h.minValue,maxValue:h.maxValue,noDataValue:h.noDataValue}});10<k-c&&(h=String.fromCharCode.apply(null,new Uint8Array(m,c,10)),c=-1<c+h.indexOf("CntZ")?h.indexOf("CntZ"):0)}return g}function ea(m,q){if(!S.isPlatformLittleEndian)throw new J("rasterCoded:decode","lerc decoder is not supported on big endian platform");var t=0,v=0,b=0;let a;let e;const d=m.byteLength-10,c=[],{width:g,height:k}=q;for(q=0;v<d;){var h;var f=fa.decode(m,{inputOffset:v,maskData:a,returnFileInfo:!0});if(g&&
k&&(f.width!==g||f.height!==k))throw new J("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");v=f.fileInfo.eofOffset;a=f.maskData;0===t&&(b=f.fileInfo.numValidPixel,e=new K({width:f.width,height:f.height,pixels:[],pixelType:f.fileInfo.pixelType,mask:a,statistics:[]}));f.fileInfo.mask&&0<f.fileInfo.mask.numBytes&&q++;a&&c.push(a);if(1<f.dimCount&&(null==(h=f.pixelData)?void 0:h.length)===f.width*f.height*f.dimCount){var p,r,l,n;f.pixelData=f.pixelData.slice(-f.width*
f.height);const u=null==(p=f.dimStats)?void 0:null==(r=p.minValues)?void 0:r[f.dimCount-1],y=null==(l=f.dimStats)?void 0:null==(n=l.maxValues)?void 0:n[f.dimCount-1];null!=u&&null!=y&&(f.minValue=u,f.maxValue=y)}t++;e.addData({pixels:f.pixelData,statistics:{minValue:f.minValue,maxValue:f.maxValue}});10<d-v&&(f=String.fromCharCode.apply(null,new Uint8Array(m,v,10)),v+=-1<f.indexOf("Lerc")?f.indexOf("Lerc"):0)}v=t=m=0;if(1<q){v=e.width*e.height;a=new Uint8Array(v);a.set(c[0]);for(m=1;m<c.length;m++)for(b=
c[m],t=0;t<v;t++)a[t]&=b[t];for(t=b=0;t<v;t++)b+=a[t];e.mask=a}e.validPixelCount=b;return e}function ha(m){m=T.decode(m);m=new K({width:m.width,height:m.height,pixels:m.pixels,pixelType:m.pixelType.toLowerCase(),mask:m.mask,statistics:null});m.updateStatistics();return m}function ia(m){m=aa.decode(m);m=new K({width:m.width,height:m.height,pixels:m.pixels,pixelType:"U8",mask:m.mask,statistics:null});m.updateStatistics();return m}function ja(m,q){m=new Uint8Array(m);m=new ka(m);const {width:t,height:v}=
q;q=t*v;m=m.decode();let b=0;var a=0;let e;a=new Uint8Array(q);for(b=0;b<q;b++)a[b]=m[4*b+3];const d=new K({width:t,height:v,pixels:[],pixelType:"U8",mask:a,statistics:[]});for(b=0;3>b;b++){e=new Uint8Array(q);for(a=0;a<q;a++)e[a]=m[4*a+b];d.addData({pixels:e})}d.updateStatistics();return d}async function la(m,q,t,v){m=await (new Z).decode(m,{applyJpegMask:!1,format:q,...t},v);m=new K(m);m.updateStatistics();return m}function V(m){if(null==m)throw new J("rasterCodec:decode","parameter encodeddata is required.");
m=new Uint8Array(m,0,10);let q="";255===m[0]&&216===m[1]?q="jpg":137===m[0]&&80===m[1]&&78===m[2]&&71===m[3]?q="png":67===m[0]&&110===m[1]&&116===m[2]&&90===m[3]&&73===m[4]&&109===m[5]&&97===m[6]&&103===m[7]&&101===m[8]&&32===m[9]?q="lerc":76===m[0]&&101===m[1]&&114===m[2]&&99===m[3]&&50===m[4]&&32===m[5]?q="lerc2":73===m[0]&&73===m[1]&&42===m[2]&&0===m[3]||77===m[0]&&77===m[1]&&0===m[2]&&42===m[3]||73===m[0]&&73===m[1]&&43===m[2]&&0===m[3]||77===m[0]&&77===m[1]&&0===m[2]&&43===m[3]?q="tiff":71===
m[0]&&73===m[1]&&70===m[2]?q="gif":66===m[0]&&77===m[1]?q="bmp":-1<String.fromCharCode.apply(null,m).toLowerCase().indexOf("error")&&(q="error");return q}function ma(m){let q=null;switch(m){case "lerc":q=da;break;case "lerc2":q=ea;break;case "jpg":q=ia;break;case "png":q=ja;break;case "bsq":case "bip":q=(t,v)=>{{const {pixelTypeCtor:b}=U(v.pixelType),a=ca.decode;t=a(t,{width:v.width,height:v.height,pixelType:b,format:m});v=new K({width:v.width,height:v.height,pixels:t.pixels,pixelType:v.pixelType,
mask:t.mask,statistics:null});v.updateStatistics()}return v};break;case "tiff":q=ha;break;case "error":q=()=>{throw new J("rasterCodec:decode","input data contains error");};break;default:q=()=>{throw new J("rasterCodec:decode","unsupported raster format");}}return q}function U(m){let q=null,t=null;switch(m?m.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":t=255;q=Uint8Array;break;case "u16":t=t||65535;q=Uint16Array;break;case "u32":t=t||2**32-1;q=Uint32Array;break;case "s8":t=t||-128;
q=Int8Array;break;case "s16":t=t||-32768;q=Int16Array;break;case "s32":t=t||-(2**31);q=Int32Array;break;default:q=Float32Array}return{pixelTypeCtor:q,noDataValue:t}}function na(m,q=1){if(m){var {pixels:t,width:v,height:b,mask:a}=m;if(t&&0!==t.length){var e=t.length,d=v-1,c=b-1,g=[],k,h,f=K.getPixelArrayConstructor(m.pixelType);if(0===q){for(q=0;q<e;q++){var p=t[q];var r=new f(d*c);for(k=0;k<c;k++){var l=k*v;for(h=0;h<d;h++)r[k*d+h]=p[l+h]}g.push(r)}if(a){var n=new Uint8Array(d*c);for(k=0;k<c;k++)for(l=
k*v,h=0;h<d;h++)n[k*d+h]=a[l+h]}}else{for(q=0;q<e;q++){p=t[q];r=new f(d*c);for(k=0;k<c;k++)for(l=k*v,h=0;h<d;h++)r[k*d+h]=(p[l+h]+p[l+h+1]+p[l+v+h]+p[l+v+h+1])/4;g.push(r)}if(a)for(n=new Uint8Array(d*c),k=0;k<c;k++)for(l=k*v,h=0;h<d;h++)n[k*d+h]=Math.min.apply(null,[a[l+h],a[l+h+1],a[l+v+h],a[l+v+h+1]])}m.width=d;m.height=c;m.mask=n;m.pixels=g}}}var fa=X.createCommonjsModule(function(m){(function(q){q=q();void 0!==q&&(m.exports=q)})(function(){var q={unstuff:function(b,a,e,d,c,g,k,h){var f=(1<<e)-
1,p=0,r,l=0;b[b.length-1]<<=8*(4*b.length-Math.ceil(e*d/8));if(c)for(r=0;r<d;r++){if(0===l){var n=b[p++];l=32}if(l>=e){var u=n>>>l-e&f;l-=e}else l=e-l,u=(n&f)<<l&f,n=b[p++],l=32-l,u+=n>>>l;a[r]=c[u]}else for(c=Math.ceil((h-g)/k),r=0;r<d;r++)0===l&&(n=b[p++],l=32),l>=e?(u=n>>>l-e&f,l-=e):(l=e-l,u=(n&f)<<l&f,n=b[p++],l=32-l,u+=n>>>l),a[r]=u<c?g+u*k:h},unstuffLUT:function(b,a,e,d,c,g){var k=(1<<a)-1,h=0,f=0,p=0,r=p=0,l=[];b[b.length-1]<<=8*(4*b.length-Math.ceil(a*e/8));var n=Math.ceil((g-d)/c);for(f=
0;f<e;f++){if(0===p){var u=b[h++];p=32}p>=a?(r=u>>>p-a&k,p-=a):(p=a-p,r=(u&k)<<p&k,u=b[h++],p=32-p,r+=u>>>p);l[f]=r<n?d+r*c:g}l.unshift(d);return l},unstuff2:function(b,a,e,d,c,g,k,h){var f=(1<<e)-1,p=0,r,l=0,n=0;if(c)for(r=0;r<d;r++){if(0===l){var u=b[p++];l=32;n=0}if(l>=e){var y=u>>>n&f;l-=e;n+=e}else{var w=e-l;y=u>>>n&f;u=b[p++];l=32-w;y|=(u&(1<<w)-1)<<e-w;n=w}a[r]=c[y]}else for(c=Math.ceil((h-g)/k),r=0;r<d;r++)0===l&&(u=b[p++],l=32,n=0),l>=e?(y=u>>>n&f,l-=e,n+=e):(w=e-l,y=u>>>n&f,u=b[p++],l=32-
w,y|=(u&(1<<w)-1)<<e-w,n=w),a[r]=y<c?g+y*k:h;return a},unstuffLUT2:function(b,a,e,d,c,g){var k=(1<<a)-1,h=0,f=0,p=0,r=0,l=0,n=0,u=[],y=Math.ceil((g-d)/c);for(f=0;f<e;f++){if(0===r){var w=b[h++];r=32;n=0}r>=a?(l=w>>>n&k,r-=a,n+=a):(p=a-r,l=w>>>n&k,w=b[h++],r=32-p,l|=(w&(1<<p)-1)<<a-p,n=p);u[f]=l<y?d+l*c:g}u.unshift(d);return u},originalUnstuff:function(b,a,e,d){var c=(1<<e)-1,g=0,k,h=0;b[b.length-1]<<=8*(4*b.length-Math.ceil(e*d/8));for(k=0;k<d;k++){if(0===h){var f=b[g++];h=32}if(h>=e){var p=f>>>h-
e&c;h-=e}else h=e-h,p=(f&c)<<h&c,f=b[g++],h=32-h,p+=f>>>h;a[k]=p}return a},originalUnstuff2:function(b,a,e,d){var c=(1<<e)-1,g=0,k,h=0,f=0;for(k=0;k<d;k++){if(0===h){var p=b[g++];h=32;f=0}if(h>=e){var r=p>>>f&c;h-=e;f+=e}else{var l=e-h;r=p>>>f&c;p=b[g++];h=32-l;r|=(p&(1<<l)-1)<<e-l;f=l}a[k]=r}return a}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(b){for(var a=65535,e=65535,d=b.length,c=Math.floor(d/2),g=0;c;){var k=359<=c?359:c;c-=k;do a+=b[g++]<<8,e+=a+=b[g++];while(--k);a=(a&65535)+
(a>>>16);e=(e&65535)+(e>>>16)}d&1&&(e+=a+=b[g]<<8);return((e&65535)+(e>>>16)<<16|(a&65535)+(a>>>16))>>>0},readHeaderInfo:function(b,a){var e=a.ptr,d=new Uint8Array(b,e,6),c={};c.fileIdentifierString=String.fromCharCode.apply(null,d);if(0!==c.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+c.fileIdentifierString;e+=6;d=new DataView(b,e,8);var g=d.getInt32(0,!0);c.fileVersion=g;e+=4;3<=g&&(c.checksum=d.getUint32(4,!0),e+=4);d=new DataView(b,e,12);
c.height=d.getUint32(0,!0);c.width=d.getUint32(4,!0);e+=8;4<=g?(c.numDims=d.getUint32(8,!0),e+=4):c.numDims=1;d=new DataView(b,e,40);c.numValidPixel=d.getUint32(0,!0);c.microBlockSize=d.getInt32(4,!0);c.blobSize=d.getInt32(8,!0);c.imageType=d.getInt32(12,!0);c.maxZError=d.getFloat64(16,!0);c.zMin=d.getFloat64(24,!0);c.zMax=d.getFloat64(32,!0);e+=40;a.headerInfo=c;a.ptr=e;if(3<=g&&(b=this.computeChecksumFletcher32(new Uint8Array(b,e-(4<=g?52:48),c.blobSize-14)),b!==c.checksum))throw"Checksum failed.";
return!0},checkMinMaxRanges:function(b,a){var e=a.headerInfo,d=this.getDataTypeArray(e.imageType),c=e.numDims*this.getDataTypeSize(e.imageType),g=this.readSubArray(b,a.ptr,d,c);b=this.readSubArray(b,a.ptr+c,d,c);a.ptr+=2*c;c=!0;for(a=0;a<e.numDims;a++)if(g[a]!==b[a]){c=!1;break}e.minValues=g;e.maxValues=b;return c},readSubArray:function(b,a,e,d){if(e===Uint8Array)b=new Uint8Array(b,a,d);else{var c=new ArrayBuffer(d);(new Uint8Array(c)).set(new Uint8Array(b,a,d));b=new e(c)}return b},readMask:function(b,
a){var e=a.ptr,d=a.headerInfo,c=d.width*d.height,g=d.numValidPixel,k=new DataView(b,e,4);d={};d.numBytes=k.getUint32(0,!0);e+=4;if((0===g||c===g)&&0!==d.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(c/8)),d.bitset=g,k=new Uint8Array(c),a.pixels.resultMask=k,e+=d.numBytes;else if(0<d.numBytes){g=new Uint8Array(Math.ceil(c/8));k=new DataView(b,e,d.numBytes);b=k.getInt16(0,!0);var h=2,f=0,p=0;do{if(0<b)for(;b--;)g[f++]=k.getUint8(h++);else for(p=k.getUint8(h++),b=-b;b--;)g[f++]=p;
b=k.getInt16(h,!0);h+=2}while(h<d.numBytes);if(-32768!==b||f<g.length)throw"Unexpected end of mask RLE encoding";k=new Uint8Array(c);for(h=h=b=0;h<c;h++)h&7?(b=g[h>>3],b<<=h&7):b=g[h>>3],b&128&&(k[h]=1);a.pixels.resultMask=k;d.bitset=g;e+=d.numBytes}a.ptr=e;a.mask=d;return!0},readDataOneSweep:function(b,a,e){var d=a.ptr,c=a.headerInfo,g=c.numDims,k=c.width*c.height;c=c.numValidPixel*t.getDataTypeSize(c.imageType)*g;var h=a.pixels.resultMask;if(e===Uint8Array)b=new Uint8Array(b,d,c);else{var f=new ArrayBuffer(c);
(new Uint8Array(f)).set(new Uint8Array(b,d,c));b=new e(f)}if(b.length===k*g)a.pixels.resultPixels=b;else{a.pixels.resultPixels=new e(k*g);var p=f=e=0,r=0;if(1<g)for(p=0;p<g;p++)for(r=p*k,f=0;f<k;f++)h[f]&&(a.pixels.resultPixels[r+f]=b[e++]);else for(f=0;f<k;f++)h[f]&&(a.pixels.resultPixels[f]=b[e++])}a.ptr=d+c;return!0},readHuffmanTree:function(b,a){var e=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(b,a.ptr,16);a.ptr+=16;if(2>d.getInt32(0,!0))throw"unsupported Huffman version";var c=d.getInt32(4,!0),
g=d.getInt32(8,!0);d=d.getInt32(12,!0);if(g>=d)return!1;var k=new Uint32Array(d-g);t.decodeBits(b,a,k);var h=[],f;for(f=g;f<d;f++){var p=f-(f<c?0:c);h[p]={first:k[f-g],second:null}}f=b.byteLength-a.ptr;k=new ArrayBuffer(4*Math.ceil(f/4));(new Uint8Array(k)).set(new Uint8Array(b,a.ptr,f));b=new Uint32Array(k);a=0;k=0;var r=b[0];for(f=g;f<d;f++){p=f-(f<c?0:c);var l=h[p].first;0<l&&(h[p].second=r<<a>>>32-l,32-a>=l?(a+=l,32===a&&(a=0,k++,r=b[k])):(a+=l-32,k++,r=b[k],h[p].second|=r>>>32-a))}var n=r=0,
u=new v;for(f=0;f<h.length;f++)void 0!==h[f]&&(r=Math.max(r,h[f].first));n=r>=e?e:r;e=[];var y;for(f=g;f<d;f++)if(p=f-(f<c?0:c),l=h[p].first,0<l)if(g=[l,p],l<=n){p=h[p].second<<n-l;var w=1<<n-l;for(l=0;l<w;l++)e[p|l]=g}else for(p=h[p].second,w=u,--l;0<=l;l--)(y=p>>>l&1)?(w.right||(w.right=new v),w=w.right):(w.left||(w.left=new v),w=w.left),0!==l||w.val||(w.val=g[1]);return{decodeLut:e,numBitsLUTQick:n,numBitsLUT:r,tree:u,stuffedData:b,srcPtr:k,bitPos:a}},readHuffman:function(b,a,e){var d=a.headerInfo,
c=d.numDims,g=a.headerInfo.height,k=a.headerInfo.width,h=k*g,f=this.readHuffmanTree(b,a);b=f.decodeLut;var p=f.tree,r=f.stuffedData,l=f.srcPtr,n=f.bitPos,u=f.numBitsLUTQick;f=f.numBitsLUT;var y=0===a.headerInfo.imageType?128:0,w=a.pixels.resultMask,A,B,F,H,E,x,G=0;0<n&&(l++,n=0);var C=r[l],N=1===a.encodeMode,P=new e(h*c),L=P,O;for(O=0;O<d.numDims;O++){1<c&&(L=new e(P.buffer,h*O,h),G=0);if(a.headerInfo.numValidPixel===k*g)for(F=E=0;F<g;F++)for(H=0;H<k;H++,E++){var D=0;var z=A=C<<n>>>32-u;32-n<u&&(z=
A|=r[l+1]>>>64-n-u);if(b[z])D=b[z][1],n+=b[z][0];else for(z=A=C<<n>>>32-f,32-n<f&&(z=A|=r[l+1]>>>64-n-f),z=p,x=0;x<f;x++)if(z=(B=A>>>f-x-1&1)?z.right:z.left,!z.left&&!z.right){D=z.val;n=n+x+1;break}32<=n&&(n-=32,l++,C=r[l]);D-=y;N?(D=0<H?D+G:0<F?D+L[E-k]:D+G,D&=255,G=L[E]=D):L[E]=D}else for(F=E=0;F<g;F++)for(H=0;H<k;H++,E++)if(w[E]){D=0;z=A=C<<n>>>32-u;32-n<u&&(z=A|=r[l+1]>>>64-n-u);if(b[z])D=b[z][1],n+=b[z][0];else for(z=A=C<<n>>>32-f,32-n<f&&(z=A|=r[l+1]>>>64-n-f),z=p,x=0;x<f;x++)if(z=(B=A>>>f-
x-1&1)?z.right:z.left,!z.left&&!z.right){D=z.val;n=n+x+1;break}32<=n&&(n-=32,l++,C=r[l]);D-=y;N?(D=0<H&&w[E-1]?D+G:0<F&&w[E-k]?D+L[E-k]:D+G,D&=255,G=L[E]=D):L[E]=D}a.ptr=a.ptr+4*(l+1)+(0<n?4:0)}a.pixels.resultPixels=P},decodeBits:function(b,a,e,d,c){var g=a.headerInfo,k=g.fileVersion,h=0,f=new DataView(b,a.ptr,5<=b.byteLength-a.ptr?5:b.byteLength-a.ptr),p=f.getUint8(0);h++;var r=p>>6,l=0===r?4:3-r,n=0<(p&32)?!0:!1;r=p&31;p=0;if(1===l)p=f.getUint8(h),h++;else if(2===l)p=f.getUint16(h,!0),h+=2;else if(4===
l)p=f.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";l=2*g.maxZError;c=1<g.numDims?g.maxValues[c]:g.zMax;if(n){a.counter.lut++;n=f.getUint8(h);h++;g=Math.ceil((n-1)*r/8);var u=Math.ceil(g/4);u=new ArrayBuffer(4*u);var y=new Uint8Array(u);a.ptr+=h;y.set(new Uint8Array(b,a.ptr,g));h=new Uint32Array(u);a.ptr+=g;for(f=0;n-1>>>f;)f++;g=Math.ceil(p*f/8);u=Math.ceil(g/4);u=new ArrayBuffer(4*u);y=new Uint8Array(u);y.set(new Uint8Array(b,a.ptr,g));b=new Uint32Array(u);a.ptr+=g;a=3<=k?q.unstuffLUT2(h,
r,n-1,d,l,c):q.unstuffLUT(h,r,n-1,d,l,c);3<=k?q.unstuff2(b,e,f,p,a):q.unstuff(b,e,f,p,a)}else a.counter.bitstuffer++,f=r,a.ptr+=h,0<f&&(g=Math.ceil(p*f/8),u=Math.ceil(g/4),u=new ArrayBuffer(4*u),y=new Uint8Array(u),y.set(new Uint8Array(b,a.ptr,g)),b=new Uint32Array(u),a.ptr+=g,3<=k?null==d?q.originalUnstuff2(b,e,f,p):q.unstuff2(b,e,f,p,!1,d,l,c):null==d?q.originalUnstuff(b,e,f,p):q.unstuff(b,e,f,p,!1,d,l,c))},readTiles:function(b,a,e){var d=a.headerInfo,c=d.width,g=d.height,k=d.microBlockSize,h=d.imageType,
f=t.getDataTypeSize(h),p=Math.ceil(c/k),r=Math.ceil(g/k);a.pixels.numBlocksY=r;a.pixels.numBlocksX=p;var l=a.pixels.ptr=0,n=0,u=0,y=0,w=0,A=0,B=0,F=0,H=0,E=0,x=0,G=0,C=0;B=C=B=0;var N=new e(k*k),P=g%k||k,L=c%k||k,O=d.numDims,D,z=a.pixels.resultMask,I=a.pixels.resultPixels,W=5<=d.fileVersion?14:15,R=d.zMax;for(u=0;u<r;u++)for(w=u!==r-1?k:P,y=0;y<p;y++)for(A=y!==p-1?k:L,x=u*c*k+y*k,G=c-A,D=0;D<O;D++){1<O?(C=I,x=u*c*k+y*k,I=new e(a.pixels.resultPixels.buffer,c*g*D*f,c*g),R=d.maxValues[D]):C=null;B=b.byteLength-
a.ptr;l=new DataView(b,a.ptr,Math.min(10,B));n={};B=0;F=l.getUint8(0);B++;var M=5<=d.fileVersion?F&4:0;H=F>>6&255;E=F>>2&W;if(E!==(y*k>>3&W))throw"integrity issue";if(M&&0===D)throw"integrity issue";F&=3;if(3<F)throw a.ptr+=B,"Invalid block encoding ("+F+")";if(2===F){if(M)if(z)for(l=0;l<w;l++)for(n=0;n<A;n++)z[x]&&(I[x]=C[x]),x++;else for(l=0;l<w;l++)for(n=0;n<A;n++)I[x]=C[x],x++;a.counter.constant++;a.ptr+=B}else if(0===F){if(M)throw"integrity issue";a.counter.uncompressed++;a.ptr+=B;C=w*A*f;B=
b.byteLength-a.ptr;C=C<B?C:B;B=new ArrayBuffer(0===C%f?C:C+f-C%f);M=new Uint8Array(B);M.set(new Uint8Array(b,a.ptr,C));B=new e(B);C=0;if(z)for(l=0;l<w;l++){for(n=0;n<A;n++)z[x]&&(I[x]=B[C++]),x++;x+=G}else for(l=0;l<w;l++){for(n=0;n<A;n++)I[x++]=B[C++];x+=G}a.ptr+=C*f}else if(H=t.getDataTypeUsed(M&&6>h?4:h,H),E=t.getOnePixel(n,B,H,l),B+=t.getDataTypeSize(H),3===F)if(a.ptr+=B,a.counter.constantoffset++,z)for(l=0;l<w;l++){for(n=0;n<A;n++)z[x]&&(I[x]=M?Math.min(R,C[x]+E):E),x++;x+=G}else for(l=0;l<w;l++){for(n=
0;n<A;n++)I[x]=M?Math.min(R,C[x]+E):E,x++;x+=G}else if(a.ptr+=B,t.decodeBits(b,a,N,E,D),B=0,M)if(z)for(l=0;l<w;l++){for(n=0;n<A;n++)z[x]&&(I[x]=N[B++]+C[x]),x++;x+=G}else for(l=0;l<w;l++){for(n=0;n<A;n++)I[x]=N[B++]+C[x],x++;x+=G}else if(z)for(l=0;l<w;l++){for(n=0;n<A;n++)z[x]&&(I[x]=N[B++]),x++;x+=G}else for(l=0;l<w;l++){for(n=0;n<A;n++)I[x++]=N[B++];x+=G}}},formatFileInfo:function(b){return{fileIdentifierString:b.headerInfo.fileIdentifierString,fileVersion:b.headerInfo.fileVersion,imageType:b.headerInfo.imageType,
height:b.headerInfo.height,width:b.headerInfo.width,numValidPixel:b.headerInfo.numValidPixel,microBlockSize:b.headerInfo.microBlockSize,blobSize:b.headerInfo.blobSize,maxZError:b.headerInfo.maxZError,pixelType:t.getPixelType(b.headerInfo.imageType),eofOffset:b.eofOffset,mask:b.mask?{numBytes:b.mask.numBytes}:null,pixels:{numBlocksX:b.pixels.numBlocksX,numBlocksY:b.pixels.numBlocksY,maxValue:b.headerInfo.zMax,minValue:b.headerInfo.zMin,noDataValue:b.noDataValue}}},constructConstantSurface:function(b){var a=
b.headerInfo.zMax,e=b.headerInfo.numDims,d=b.headerInfo.height*b.headerInfo.width,c=0,g=0,k=0,h=b.pixels.resultMask,f=b.pixels.resultPixels;if(h)if(1<e)for(c=0;c<e;c++)for(k=c*d,a=b.headerInfo.maxValues[c],g=0;g<d;g++)h[g]&&(f[k+g]=a);else for(g=0;g<d;g++)h[g]&&(f[g]=a);else if(1<e)for(c=0;c<e;c++)for(k=c*d,a=b.headerInfo.maxValues[c],g=0;g<d;g++)f[k+g]=a;else for(g=0;g<d;g++)f[g]=a},getDataTypeArray:function(b){switch(b){case 0:b=Int8Array;break;case 1:b=Uint8Array;break;case 2:b=Int16Array;break;
case 3:b=Uint16Array;break;case 4:b=Int32Array;break;case 5:b=Uint32Array;break;case 6:b=Float32Array;break;case 7:b=Float64Array;break;default:b=Float32Array}return b},getPixelType:function(b){switch(b){case 0:b="S8";break;case 1:b="U8";break;case 2:b="S16";break;case 3:b="U16";break;case 4:b="S32";break;case 5:b="U32";break;case 6:b="F32";break;case 7:b="F64";break;default:b="F32"}return b},isValidPixelValue:function(b,a){if(null==a)return!1;switch(b){case 0:b=-128<=a&&127>=a;break;case 1:b=0<=
a&&255>=a;break;case 2:b=-32768<=a&&32767>=a;break;case 3:b=0<=a&&65536>=a;break;case 4:b=-2147483648<=a&&2147483647>=a;break;case 5:b=0<=a&&4294967296>=a;break;case 6:b=-3.4027999387901484E38<=a&&3.4027999387901484E38>=a;break;case 7:b=4.9E-324<=a&&1.7976931348623157E308>=a;break;default:b=!1}return b},getDataTypeSize:function(b){var a=0;switch(b){case 0:case 1:a=1;break;case 2:case 3:a=2;break;case 4:case 5:case 6:a=4;break;case 7:a=8;break;default:a=b}return a},getDataTypeUsed:function(b,a){var e=
b;switch(b){case 2:case 4:e=b-a;break;case 3:case 5:e=b-2*a;break;case 6:e=0===a?b:1===a?2:1;break;case 7:e=0===a?b:b-2*a+1;break;default:e=b}return e},getOnePixel:function(b,a,e,d){b=0;switch(e){case 0:b=d.getInt8(a);break;case 1:b=d.getUint8(a);break;case 2:b=d.getInt16(a,!0);break;case 3:b=d.getUint16(a,!0);break;case 4:b=d.getInt32(a,!0);break;case 5:b=d.getUInt32(a,!0);break;case 6:b=d.getFloat32(a,!0);break;case 7:b=d.getFloat64(a,!0);break;default:throw"the decoder does not understand this pixel type";
}return b}},v=function(b,a,e){this.val=b;this.left=a;this.right=e};return{decode:function(b,a){a=a||{};var e=a.noDataValue,d=0,c={};c.ptr=a.inputOffset||0;c.pixels={};if(t.readHeaderInfo(b,c)){d=c.headerInfo;var g=d.fileVersion,k=t.getDataTypeArray(d.imageType);if(5<g)throw"unsupported lerc version 2."+g;t.readMask(b,c);d.numValidPixel===d.width*d.height||c.pixels.resultMask||(c.pixels.resultMask=a.maskData);var h=d.width*d.height;c.pixels.resultPixels=new k(h*d.numDims);c.counter={onesweep:0,uncompressed:0,
lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==d.numValidPixel)if(d.zMax===d.zMin)t.constructConstantSurface(c);else if(4<=g&&t.checkMinMaxRanges(b,c))t.constructConstantSurface(c);else{var f=new DataView(b,c.ptr,2),p=f.getUint8(0);c.ptr++;if(p)t.readDataOneSweep(b,c,k);else if(1<g&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)){f=f.getUint8(1);c.ptr++;c.encodeMode=f;if(2<f||4>g&&1<f)throw"Invalid Huffman flag "+f;f?t.readHuffman(b,c,k):t.readTiles(b,c,k)}else t.readTiles(b,c,k)}c.eofOffset=
c.ptr;a.inputOffset?(b=c.headerInfo.blobSize+a.inputOffset-c.ptr,1<=Math.abs(b)&&(c.eofOffset=a.inputOffset+c.headerInfo.blobSize)):(b=c.headerInfo.blobSize-c.ptr,1<=Math.abs(b)&&(c.eofOffset=c.headerInfo.blobSize));b={width:d.width,height:d.height,pixelData:c.pixels.resultPixels,minValue:d.zMin,maxValue:d.zMax,validPixelCount:d.numValidPixel,dimCount:d.numDims,dimStats:{minValues:d.minValues,maxValues:d.maxValues},maskData:c.pixels.resultMask};if(c.pixels.resultMask&&t.isValidPixelValue(d.imageType,
e)){g=c.pixels.resultMask;for(d=0;d<h;d++)g[d]||(b.pixelData[d]=e);b.noDataValue=e}c.noDataValue=e;a.returnFileInfo&&(b.fileInfo=t.formatFileInfo(c));return b}},getBandCount:function(b){for(var a=0,e=0,d={ptr:0,pixels:{}};e<b.byteLength-58;)t.readHeaderInfo(b,d),e+=d.headerInfo.blobSize,a++,d.ptr=e;return a}}})}),ka=function(m){function q(a){var e,d;this.data=a;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(d=null;;){var c=this.readUInt32();var g=
a=void 0;a=[];for(g=0;4>g;++g)a.push(String.fromCharCode(this.data[this.pos++]));a=a.join("");switch(a){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=
this.read(c);break;case "fcTL":d&&this.animation.frames.push(d);this.pos+=4;d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};a=this.readUInt16();c=this.readUInt16()||100;d.delay=1E3*a/c;d.disposeOp=this.data[this.pos++];d.blendOp=this.data[this.pos++];d.data=[];break;case "IDAT":case "fdAT":"fdAT"===a&&(this.pos+=4,c-=4);a=(null!=d?d.data:void 0)||this.imgData;for(g=0;0<=c?g<c:g>c;0<=c?++g:--g)a.push(this.data[this.pos++]);break;case "tRNS":this.transparency=
{};switch(this.colorType){case 3:this.transparency.indexed=this.read(c);c=255-this.transparency.indexed.length;if(0<c)for(a=0;0<=c?a<c:a>c;0<=c?++a:--a)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case "tEXt":g=this.read(c);c=g.indexOf(0);a=String.fromCharCode.apply(String,g.slice(0,c));this.text[a]=String.fromCharCode.apply(String,g.slice(c+1));break;case "IEND":d&&this.animation.frames.push(d);
a:{switch(this.colorType){case 0:case 3:case 4:d=1;break a;case 2:case 6:d=3;break a}d=void 0}this.colors=d;this.hasAlphaChannel=4===(e=this.colorType)||6===e;e=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*e;a:{switch(this.colors){case 1:e="DeviceGray";break a;case 3:e="DeviceRGB";break a}e=void 0}this.colorSpace=e;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=c}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}var t;
q.load=function(a,e,d){"function"===typeof e&&(d=e);var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){var g=new Uint8Array(c.response||c.mozResponseArrayBuffer);g=new q(g);"function"===typeof(null!=e?e.getContext:void 0)&&g.render(e);return"function"===typeof d?d(g):void 0};return c.send(null)};q.prototype.read=function(a){var e;var d=[];for(e=0;0<=a?e<a:e>a;0<=a?++e:--e)d.push(this.data[this.pos++]);return d};q.prototype.readUInt32=function(){var a=this.data[this.pos++]<<
24;var e=this.data[this.pos++]<<16;var d=this.data[this.pos++]<<8;var c=this.data[this.pos++];return a|e|d|c};q.prototype.readUInt16=function(){var a=this.data[this.pos++]<<8;var e=this.data[this.pos++];return a|e};q.prototype.decodePixels=function(a){var e,d,c,g,k,h,f,p;null==a&&(a=this.imgData);if(0===a.length)return new Uint8Array(0);a=new Y.Zlib(a);a=a.getBytes();var r=this.pixelBitlength/8;var l=r*this.width;var n=new Uint8Array(l*this.height);var u=a.length;for(d=g=k=0;g<u;){switch(a[g++]){case 0:for(c=
e=0;e<l;c=e+=1)n[d++]=a[g++];break;case 1:for(c=h=0;h<l;c=h+=1){e=a[g++];var y=c<r?0:n[d-r];n[d++]=(e+y)%256}break;case 2:for(c=y=0;y<l;c=y+=1){e=a[g++];var w=(c-c%r)/r;h=k&&n[(k-1)*l+w*r+c%r];n[d++]=(h+e)%256}break;case 3:for(c=p=0;p<l;c=p+=1)e=a[g++],w=(c-c%r)/r,y=c<r?0:n[d-r],h=k&&n[(k-1)*l+w*r+c%r],n[d++]=(e+Math.floor((y+h)/2))%256;break;case 4:for(c=p=0;p<l;c=p+=1){e=a[g++];w=(c-c%r)/r;y=c<r?0:n[d-r];0===k?h=f=0:(h=n[(k-1)*l+w*r+c%r],f=w&&n[(k-1)*l+(w-1)*r+c%r]);var A=y+h-f;c=Math.abs(A-y);
w=Math.abs(A-h);A=Math.abs(A-f);y=c<=w&&c<=A?y:w<=A?h:f;n[d++]=(e+y)%256}break;default:throw Error("Invalid filter algorithm: "+a[g-1]);}k++}return n};q.prototype.decodePalette=function(){var a,e,d,c,g;var k=this.palette;var h=this.transparency.indexed||[];var f=new Uint8Array((h.length||0)+k.length);var p=d=a=e=0;for(c=k.length;d<c;p=d+=3)f[e++]=k[p],f[e++]=k[p+1],f[e++]=k[p+2],f[e++]=null!=(g=h[a++])?g:255;return f};q.prototype.copyToImageData=function(a,e){var d,c;var g=this.colors;var k=null;
var h=this.hasAlphaChannel;this.palette.length&&(k=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),g=4,h=!0);a=a.data||a;var f=a.length;var p=k||e;d=c=0;if(1===g)for(;d<f;)g=k?4*e[d/4]:c,c=p[g++],a[d++]=c,a[d++]=c,a[d++]=c,a[d++]=h?p[g++]:this.transparency.grayscale&&this.transparency.grayscale===c?0:255,c=g;else for(;d<f;)g=k?4*e[d/4]:c,a[d++]=p[g++],a[d++]=p[g++],a[d++]=p[g++],a[d++]=h?p[g++]:this.transparency.rgb&&this.transparency.rgb[1]===p[g-3]&&this.transparency.rgb[3]===
p[g-2]&&this.transparency.rgb[5]===p[g-1]?0:255,c=g};q.prototype.decode=function(){var a=new Uint8Array(this.width*this.height*4);this.copyToImageData(a,this.decodePixels());return a};var v=(t=m.document&&m.document.createElement("canvas"))&&t.getContext("2d");var b=function(a){v.width=a.width;v.height=a.height;v.clearRect(0,0,a.width,a.height);v.putImageData(a,0,0);a=new Image;a.src=t.toDataURL();return a};q.prototype.decodeFrames=function(a){var e,d;if(this.animation){var c=this.animation.frames;
var g=[];var k=e=0;for(d=c.length;e<d;k=++e){k=c[k];var h=a.createImageData(k.width,k.height);var f=this.decodePixels(new Uint8Array(k.data));this.copyToImageData(h,f);k.imageData=h;g.push(k.image=b(h))}return g}};q.prototype.renderFrame=function(a,e){var d=this.animation.frames;var c=d[e];d=d[e-1];0===e&&a.clearRect(0,0,this.width,this.height);1===(null!=d?d.disposeOp:void 0)?a.clearRect(d.xOffset,d.yOffset,d.width,d.height):2===(null!=d?d.disposeOp:void 0)&&a.putImageData(d.imageData,d.xOffset,
d.yOffset);0===c.blendOp&&a.clearRect(c.xOffset,c.yOffset,c.width,c.height);return a.drawImage(c.image,c.xOffset,c.yOffset)};q.prototype.animate=function(a){var e,d=this;var c=0;var g=this.animation;var k=g.numFrames;var h=g.frames;var f=g.numPlays;return(e=function(){var p=c++%k;var r=h[p];d.renderFrame(a,p);if(1<k&&c/k<f)return d.animation._timeout=setTimeout(e,r.delay)})()};q.prototype.stopAnimation=function(){var a;return clearTimeout(null!=(a=this.animation)?a._timeout:void 0)};q.prototype.render=
function(a){a._png&&a._png.stopAnimation();a._png=this;a.width=this.width;a.height=this.height;a=a.getContext("2d");if(this.animation)return this.decodeFrames(a),this.animate(a);var e=a.createImageData(this.width,this.height);this.copyToImageData(e,this.decodePixels());return a.putImageData(e,0,0)};return q}(self);const oa=new Set(["jpg","png","bmp","gif"]);Q.decode=async function(m,q,t){if(null==m)throw new J("rasterCodec:decode","missing encodeddata parameter.");if(null==q||null==q.width||null==
q.height)throw new J("rasterCodec:decode","requires width and height in options parameter.");let v=q.format&&q.format.toLowerCase();if("tiff"===v&&q.customOptions)return q=T.decodeTileOrStrip(m,q.customOptions),q=new K({width:q.width,height:q.height,pixels:q.pixels,pixelType:q.pixelType.toLowerCase(),mask:q.mask,statistics:null}),q.updateStatistics(),q;if(!v||"bsq"!==v&&"bip"!==v)v=V(m);q.useCanvas&&oa.has(v)?m=await la(m,v,q,t):(t=ma(v),q.isPoint&&(q={...q},q.width++,q.height++),m=t(m,q),q.isPoint&&
na(m));return m};Q.getFormat=function(m){m=V(m);"lerc2"===m?m="lerc":"error"===m&&(m="");return m};Object.defineProperty(Q,"__esModule",{value:!0})});