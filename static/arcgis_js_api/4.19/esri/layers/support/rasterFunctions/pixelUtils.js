// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../PixelBlock"],function(A,H){function R(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);let b,e;const h=new Uint8Array(256);for(b=0;256>b;b++)0<a&&100>a?e=(200*b-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?e=(200*b-25500+510*c)*(100+a)/2E4+128:100===a?(e=200*b-25500+256*(100-a)+510*c,e=0<e?255:0):-100===a&&(e=128),h[b]=255<e?255:0>e?0:e;return h}function P(a,c,b,e,h,m,k,l){return{xmin:h<=b*a?0:h<b*a+a?h-b*a:a,ymin:m<=e*c?0:m<e*c+c?m-e*c:c,xmax:h+k<=b*a?0:h+
k<b*a+a?h+k-b*a:a,ymax:m+l<=e*c?0:m+l<e*c+c?m+l-e*c:c}}function S(a,c,b,e){var h=a.filter(E=>D(E))[0];if(null==h)return null;const m=e?e.width:c.width;e=e?e.height:c.height;const k=h.width,l=h.height,d=c.width/k;c=c.height/l;const g=b?b.x:0;b=b?b.y:0;const f=h.pixelType;var n=H.getPixelArrayConstructor(f);const q=h.pixels.length;h=[];let p,v;let u,t,r,x,w,y,z;for(t=0;t<q;t++){v=new n(m*e);for(r=0;r<c;r++)for(x=0;x<d;x++){var B=a[r*d+x];if(D(B))for(p=B.pixels[t],z=P(k,l,x,r,g,b,m,e),w=z.ymin;w<z.ymax;w++)for(B=
(r*l+w-b)*m+(x*k-g),u=w*k,y=z.xmin;y<z.xmax;y++)v[B+y]=p[u+y]}h.push(v)}let C;if(a.some(E=>null==E||E.mask&&0<E.mask.length))for(C=new Uint8Array(m*e),r=0;r<c;r++)for(x=0;x<d;x++)if(n=(B=a[r*d+x])?B.mask:null,z=P(k,l,x,r,g,b,m,e),n)for(w=z.ymin;w<z.ymax;w++)for(B=(r*l+w-b)*m+(x*k-g),u=w*k,y=z.xmin;y<z.xmax;y++)C[B+y]=n[u+y];else if(B)for(w=z.ymin;w<z.ymax;w++)for(B=(r*l+w-b)*m+(x*k-g),u=w*k,y=z.xmin;y<z.xmax;y++)C[B+y]=1;else for(w=z.ymin;w<z.ymax;w++)for(B=(r*l+w-b)*m+(x*k-g),u=w*k,y=z.xmin;y<z.xmax;y++)C[B+
y]=0;a=new H({width:m,height:e,pixels:h,pixelType:f,mask:C});a.updateStatistics();return a}function T(a){if(!D(a))return null;const c=a.clone(),{width:b,height:e,pixels:h,mask:m}=a;var k=h[0];a=c.pixels[0];for(let g=2;g<e-1;g++){const f=new Map;for(var l=g-2;l<g+2;l++)for(var d=0;4>d;d++){const n=l*b+d;M(f,k[n],m?m[n]:1)}a[g*b]=U(f);a[g*b+1]=a[g*b+2]=a[g*b];for(l=3;l<b-1;l++)d=(g-2)*b+l+1,M(f,k[d],m?m[d]:1),d=(g-1)*b+l+1,M(f,k[d],m?m[d]:1),d=g*b+l+1,M(f,k[d],m?m[d]:1),d=(g+1)*b+l+1,M(f,k[d],m?m[d]:
1),d=(g-2)*b+l-3,N(f,k[d],m?m[d]:1),d=(g-1)*b+l-3,N(f,k[d],m?m[d]:1),d=g*b+l-3,N(f,k[d],m?m[d]:1),d=(g+1)*b+l-3,N(f,k[d],m?m[d]:1),a[g*b+l]=U(f);a[g*b+l+1]=a[g*b+l]}for(k=0;k<b;k++)a[k]=a[b+k]=a[2*b+k],a[(e-1)*b+k]=a[(e-2)*b+k];c.updateStatistics();return c}function U(a){if(0===a.size)return 0;let c=0,b=-1,e=0;const h=a.keys();let m=h.next();for(;!m.done;)e=a.get(m.value),e>c&&(b=m.value,c=e),m=h.next();return b}function N(a,c,b){0!==b&&(b=a.get(c),1===b?a.delete(c):a.set(c,b-1))}function M(a,c,b){0!==
b&&a.set(c,a.has(c)?a.get(c)+1:1)}function V(a,c,b){let {x:e,y:h}=c;const {width:m,height:k}=b;if(0===e&&0===h&&k===a.height&&m===a.width)return a;const {width:l,height:d}=a;c=Math.max(0,h);const g=Math.max(0,e),f=Math.min(e+m,l),n=Math.min(h+k,d);if(0>f||0>n||!D(a))return null;e=Math.max(0,-e);h=Math.max(0,-h);const {pixels:q,mask:p}=a;var v=m*k,u=q.length;const t=[];for(var r=0;r<u;r++){var x=q[r],w=H.createEmptyBand(a.pixelType,v);for(let y=c;y<n;y++){const z=y*l;let B=(y+h-c)*m+e;for(let C=g;C<
f;C++)w[B++]=x[z+C]}t.push(w)}v=new Uint8Array(v);for(u=c;u<n;u++)for(r=u*l,x=(u+h-c)*m+e,w=g;w<f;w++)v[x++]=p?p[r+w]:1;a=new H({width:b.width,height:b.height,pixelType:a.pixelType,pixels:t,mask:v});a.updateStatistics();return a}function X(a,c=!0){if(!D(a))return null;const {pixels:b,width:e,height:h,mask:m,pixelType:k}=a;a=[];const l=Math.round(e/2),d=Math.round(h/2),g=h-1,f=e-1;for(var n=0;n<b.length;n++){var q=b[n],p=H.createEmptyBand(k,l*d),v=0;for(var u=0;u<h;u+=2)for(var t=0;t<e;t+=2){var r=
q[u*e+t];if(c){var x=t===f?r:q[u*e+t+1];const w=u===g?r:q[u*e+t+e],y=t===f?w:u===g?x:q[u*e+t+e+1];p[v++]=(r+x+w+y)/4}else p[v++]=r}a.push(p)}n=null;if(m)for(n=new Uint8Array(l*d),q=0,p=0;p<h;p+=2)for(v=0;v<e;v+=2)u=m[p*e+v],c?(t=v===f?u:m[p*e+v+1],r=p===g?u:m[p*e+v+e],x=v===f?r:p===g?t:m[p*e+v+e+1],n[q++]=u*t*r*x?1:0):n[q++]=u;return new H({width:l,height:d,pixelType:k,pixels:a,mask:n})}const D=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};
A.approximateTransform=function(a,c,b,e,h="nearest"){if(!D(a))return null;"majority"===h&&(a=T(a));const {pixels:m,mask:k,pixelType:l}=a,d=a.width;var g=a.height;a=H.getPixelArrayConstructor(l);var f=m.length;const {width:n,height:q}=c;c=e.cols;var p=e.rows;const v=Math.ceil(n/c),u=Math.ceil(q/p);e=!1;for(var t=0;t<b.length;t+=3)-1===b[t]&&-1===b[t+1]&&-1===b[t+2]&&(e=!0);let r,x,w,y,z,B;const C=new Float32Array(n*q),E=new Float32Array(n*q);t=0;let K,L;const O="majority"===h?0:.5;for(let I=0;I<u;I++)for(let J=
0;J<v;J++){r=12*(I*v+J);h=b[r];x=b[r+1];w=b[r+2];y=b[r+3];z=b[r+4];B=b[r+5];for(var F=0;F<p;F++){t=(I*p+F)*n+J*c;L=(F+.5)/p;for(var G=0;G<F;G++)K=(G+.5)/c,C[t+G]=Math.round((h*K+x*L+w)*d-O),E[t+G]=Math.round((y*K+z*L+B)*g-O)}r+=6;h=b[r];x=b[r+1];w=b[r+2];y=b[r+3];z=b[r+4];B=b[r+5];for(F=0;F<p;F++)for(t=(I*p+F)*n+J*c,L=(F+.5)/p,G=F;G<c;G++)K=(G+.5)/c,C[t+G]=Math.round((h*K+x*L+w)*d-O),E[t+G]=Math.round((y*K+z*L+B)*g-O)}b=(I,J)=>{for(let Q=0;Q<q;Q++){r=Q*n;for(let W=0;W<n;W++)I[r]=0>C[r]||0>E[r]?0:
J[C[r]+E[r]*d],r++}};g=[];for(p=0;p<f;p++)c=new a(n*q),b(c,m[p]),g.push(c);a=new H({width:n,height:q,pixelType:l,pixels:g});if(k)a.mask=new Uint8Array(n*q),b(a.mask,k);else if(e)for(a.mask=new Uint8Array(n*q),f=0;f<n*q;f++)a.mask[f]=0>C[f]||0>E[f]?0:1;a.updateStatistics();return a};A.clip=V;A.colorize=function(a,c){if(!D(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;const b=a.clone();var e=b.pixels;let h=b.mask;const m=b.width*b.height;if(1!==e.length)return a;const {indexedColormap:k,
indexed2DColormap:l,offset:d,alphaSpecified:g}=c;c=k.length-1;a=0;e=e[0];const f=new Uint8Array(e.length),n=new Uint8Array(e.length),q=new Uint8Array(e.length);let p=0;if(k)if(h)for(a=0;a<m;a++)h[a]&&(p=4*(e[a]-d),p<d||p>c?h[a]=0:(f[a]=k[p],n[a]=k[p+1],q[a]=k[p+2],h[a]=k[p+3]));else{h=new Uint8Array(m);for(a=0;a<m;a++)p=4*(e[a]-d),p<d||p>c?h[a]=0:(f[a]=k[p],n[a]=k[p+1],q[a]=k[p+2],h[a]=k[p+3]);b.mask=h}else if(h)for(a=0;a<m;a++)h[a]&&(c=l[e[a]],f[a]=c[0],n[a]=c[1],q[a]=c[2],h[a]=c[3]);else{h=new Uint8Array(m);
for(a=0;a<m;a++)c=l[e[a]],f[a]=c[0],n[a]=c[1],q[a]=c[2],h[a]=c[3];b.mask=h}b.pixels=[f,n,q];b.statistics=null;b.pixelType="u8";b.maskIsAlpha=g;return b};A.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((g,f)=>g[0]-f[0]);var b=0;0>c[0][0]&&(b=c[0][0]);var e=Math.max(256,c[c.length-1][0]-b+1),h=new Uint8Array(4*e),m=[],k=0,l=0,d=5===c[0].length;if(65536<e)return c.forEach(g=>{m[g[0]-b]=d?g.slice(1):g.slice(1).concat([255])}),{indexed2DColormap:m,offset:b,alphaSpecified:d};
if(a.fillUnspecified)for(a=c[l],k=a[0]-b;k<e;k++)h[4*k]=a[1],h[4*k+1]=a[2],h[4*k+2]=a[3],h[4*k+3]=d?a[4]:255,k===a[0]-b&&(a=l===c.length-1?a:c[++l]);else for(k=0;k<c.length;k++)a=c[k],l=4*(a[0]-b),h[l]=a[1],h[l+1]=a[2],h[l+2]=a[3],h[l+3]=d?a[4]:255;return{indexedColormap:h,offset:b,alphaSpecified:d}}}};A.createContrastBrightnessLUT=R;A.createHistogramEqualizationLUT=function(a,c=256){c=Math.min(c,256);const {size:b,counts:e}=a;a=new Uint8Array(b);var h=e.reduce((g,f)=>g+f/c,0);let m=0;var k=0;let l=
0,d=h;for(let g=0;g<b;g++)if(l+=e[g],!(g<b-1&&l+e[g+1]<d)){for(;m<c-1&&d<l;)m++,d+=h;for(;k<=g;k++)a[k]=m;k=g+1}for(h=k;h<b;h++)a[h]=c-1;return a};A.createStretchLUT=function(a){const {minCutOff:c,maxCutOff:b,gamma:e,pixelType:h}=a,m=a.outMin||0,k=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(h))return null;const l=c.length;let d;let g=0;"s8"===h?g=-127:"s16"===h&&(g=-32767);let f=256;-1<["u16","s16"].indexOf(h)&&(f=65536);const n=[],q=k-m;for(d=0;d<l;d++)n[d]=b[d]-c[d];var p=e&&e.length>=
l;const v=[];if(p)for(d=0;d<l;d++)v[d]=1<e[d]?2<e[d]?6.5+(e[d]-2)**2.5:6.5+100*(2-e[d])**4:1;let u;const t=[];let r,x,w;if(p)for(d=0;d<l;d++){w=[];for(p=0;p<f;p++)r=p+g,u=(r-c[d])/n[d],x=1,1<e[d]&&(x-=(1/q)**(u*v[d])),w[p]=r<b[d]&&r>c[d]?Math.floor(x*q*u**(1/e[d]))+m:r>=b[d]?k:m;t[d]=w}else for(d=0;d<l;d++){w=[];for(p=0;p<f;p++)r=p+g,w[p]=r<=c[d]?m:r>=b[d]?k:Math.floor((r-c[d])/n[d]*q)+m;t[d]=w}if(null!=a.contrastOffset)for(a=R(a.contrastOffset,a.brightnessOffset),d=0;d<l;d++)for(w=t[d],p=0;p<f;p++)w[p]=
a[w[p]];return{lut:t,offset:g}};A.estimateStatisticsFromHistograms=function(a){const c=[];for(let m=0;m<a.length;m++){const {min:k,max:l,size:d,counts:g}=a[m];let f=0;var b=0;for(var e=0;e<d;e++)f+=g[e],b+=e*g[e];b/=f;e=0;for(var h=0;h<d;h++)e+=g[h]*(h-b)**2;h=(l-k)/d;c.push({min:k,max:l,avg:(b+.5)*h+k,stddev:Math.sqrt(e/(f-1))*h})}return c};A.estimateStatisticsHistograms=function(a){if(!D(a))return null;a.statistics||a.updateStatistics();const {pixels:c,mask:b,pixelType:e,statistics:h}=a;a=a.width*
a.height;const m=c.length;let k,l;let d;var g;const f=[],n=[];for(d=0;d<m;d++){var q=new Uint32Array(256);var p=c[d];if("u8"===e)if(k=-.5,l=255.5,b)for(g=0;g<a;g++)b[g]&&q[p[g]]++;else for(g=0;g<a;g++)q[p[g]]++;else{k=h[d].minValue;l=h[d].maxValue;var v=(l-k)/256;var u=new Uint32Array(257);if(b)for(g=0;g<a;g++)b[g]&&u[Math.floor((p[g]-k)/v)]++;else for(g=0;g<a;g++)u[Math.floor((p[g]-k)/v)]++;for(g=0;255>g;g++)q[g]=u[g];q[255]=u[255]+u[256]}f.push({min:k,max:l,size:256,counts:q});for(g=p=u=v=0;256>
g;g++)v+=q[g],u+=g*q[g];u/=v;for(g=0;256>g;g++)p+=q[g]*(g-u)**2;q=Math.sqrt(p/(v-1));v=(l-k)/256;g=(u+.5)*v+k;q*=v;n.push({min:k,max:l,avg:g,stddev:q})}return{statistics:n,histograms:f}};A.extractBands=function(a,c){if(null==c||!c.length||!D(a))return a;const b=a.pixels.length;return c&&c.some(e=>e>=b)||1===b&&1===c.length&&0===c[0]||b===c.length&&!c.some((e,h)=>e!==h)?a:new H({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,
pixels:c.map(e=>a.pixels[e]),statistics:a.statistics&&c.map(e=>a.statistics[e])})};A.getClipBounds=P;A.lookupPixels=function(a,c){if(!D(a))return null;const {pixels:b,mask:e}=a,h=a.width*a.height,m=b.length;let k=c.lut;({offset:c}=c);let l,d;k&&1===k[0].length&&(k=b.map(()=>k));const g=[];let f,n,q;if(c)if(null==e)for(l=0;l<m;l++){f=b[l];n=k[l];q=new Uint8Array(h);for(d=0;d<h;d++)q[d]=n[f[d]-c];g.push(q)}else for(l=0;l<m;l++){f=b[l];n=k[l];q=new Uint8Array(h);for(d=0;d<h;d++)e[d]&&(q[d]=n[f[d]-c]);
g.push(q)}else if(null==e)for(l=0;l<m;l++){f=b[l];n=k[l];q=new Uint8Array(h);for(d=0;d<h;d++)q[d]=n[f[d]];g.push(q)}else for(l=0;l<m;l++){f=b[l];n=k[l];q=new Uint8Array(h);for(d=0;d<h;d++)e[d]&&(q[d]=n[f[d]]);g.push(q)}a=new H({width:a.width,height:a.height,pixels:g,mask:e,pixelType:"u8"});a.updateStatistics();return a};A.mosaic=S;A.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var b=a.filter(n=>n.pixelBlock)[0];if(!b)return null;var e=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;
const h=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,m=.01*Math.min(e,h),k=a.sort((n,q)=>Math.abs(n.extent.ymax-q.extent.ymax)>m?q.extent.ymax-n.extent.ymax:Math.abs(n.extent.xmin-q.extent.xmin)>m?n.extent.xmin-q.extent.xmin:0);var l=Math.min.apply(null,k.map(n=>n.extent.xmin));const d=Math.min.apply(null,k.map(n=>n.extent.ymin)),g=Math.max.apply(null,k.map(n=>n.extent.xmax)),f=Math.max.apply(null,k.map(n=>n.extent.ymax));a={x:Math.round((c.xmin-l)/e),y:Math.round((f-c.ymax)/h)};l={width:Math.round((g-
l)/e),height:Math.round((f-d)/h)};e={width:Math.round((c.xmax-c.xmin)/e),height:Math.round((c.ymax-c.ymin)/h)};if(Math.round(l.width/b.pixelBlock.width)*Math.round(l.height/b.pixelBlock.height)!==k.length||0>a.x||0>a.y||l.width<e.width||l.height<e.height)return null;b=k.map(n=>n.pixelBlock);b=S(b,l,a,e);return{extent:c,pixelBlock:b}};A.remapColor=function(a,c){if(!D(a))return null;a=a.clone();var {pixels:b}=a;const e=a.width*a.height,h=c.length,m=Math.floor(h/2),k=c[Math.floor(m)];b=b[0];let l,d,
g,f,n,q,p=!1;const v=new Uint8Array(e),u=new Uint8Array(e),t=new Uint8Array(e);let r=a.mask;const x=4===c[0].mappedColor.length;r||(r=new Uint8Array(e),r.fill(x?255:1),a.mask=r);for(n=0;n<e;n++)if(r[n]){l=b[n];p=!1;q=m;d=k;g=0;for(f=h-1;1<f-g;){if(l===d.value){p=!0;break}l>d.value?g=q:f=q;q=Math.floor((g+f)/2);d=c[Math.floor(q)]}p||(l===c[g].value?(d=c[g],p=!0):l===c[f].value?(d=c[f],p=!0):l<c[g].value?(p=!1,d=null):l>c[g].value&&(l<c[f].value?(d=c[g],p=!0):f===h-1?(p=!1,d=null):(d=c[f],p=!0)));p?
(v[n]=d.mappedColor[0],u[n]=d.mappedColor[1],t[n]=d.mappedColor[2],r[n]=d.mappedColor[3]):v[n]=u[n]=t[n]=r[n]=0}a.pixels=[v,u,t];a.mask=r;a.pixelType="u8";a.maskIsAlpha=x;return a};A.resampleByMajority=T;A.setValidBoundary=function(a,c,b){if(!D(a))return null;const {width:e,height:h}=a,m=c.x;c=c.y;const k=b.width+m;b=b.height+c;if(0>m||0>c||k>e||b>h||0===m&&0===c&&k===e&&b===h)return a;a.mask||(a.mask=new Uint8Array(e*h));const l=a.mask;for(let d=0;d<h;d++){const g=d*e;for(let f=0;f<e;f++)l[g+f]=
d<c||d>=b||f<m||f>=k?0:1}a.updateStatistics();return a};A.split=function(a,c,b){if(!D(a))return null;const {width:e,height:h}=c;let {width:m,height:k}=a;const l=new Map,d={x:0,y:0};b=null==b?1:1+b;for(let g=0;g<b;g++){const f=Math.ceil(m/e),n=Math.ceil(k/h);for(let q=0;q<n;q++){d.y=q*h;for(let p=0;p<f;p++){d.x=p*e;const v=V(a,d,c);l.set(`${g}/${q}/${p}`,v)}}g<b-1&&(a=X(a));m=Math.round(m/2);k=Math.round(k/2)}return l};A.stretch=function(a,c){if(!D(a))return null;a=a.clone();const {pixels:b,mask:e}=
a,{minCutOff:h,maxCutOff:m,gamma:k}=c,l=c.outMin||0;c=c.outMax||255;const d=a.width*a.height,g=b.length;let f;let n,q,p;const v=c-l,u=[];for(f=0;f<g;f++)u[f]=m[f]-h[f];var t=k&&k.length>=g;const r=[];if(t)for(f=0;f<g;f++)r[f]=1<k[f]?2<k[f]?6.5+(k[f]-2)**2.5:6.5+100*(2-k[f])**4:1;if(t)if(null!=e)for(t=0;t<d;t++){if(e[t])for(f=0;f<g;f++)n=b[f][t],p=(n-h[f])/u[f],q=1,1<k[f]&&(q-=(1/v)**(p*r[f])),b[f][t]=n<m[f]&&n>h[f]?Math.floor(q*v*p**(1/k[f]))+l:n>=m[f]?c:l}else for(t=0;t<d;t++)for(f=0;f<g;f++)n=b[f][t],
p=(n-h[f])/u[f],q=1,1<k[f]&&(q-=(1/v)**(p*r[f])),b[f][t]=n<m[f]&&n>h[f]?Math.floor(q*v*p**(1/k[f]))+l:n>=m[f]?c:l;else if(null!=e)for(t=0;t<d;t++){if(e[t])for(f=0;f<g;f++)n=b[f][t],b[f][t]=n<m[f]&&n>h[f]?Math.floor((n-h[f])/u[f]*v)+l:n>=m[f]?c:l}else for(t=0;t<d;t++)for(f=0;f<g;f++)n=b[f][t],b[f][t]=n<m[f]&&n>h[f]?Math.floor((n-h[f])/u[f]*v)+l:n>=m[f]?c:l;a.pixelType="u8";a.updateStatistics();return a};Object.defineProperty(A,"__esModule",{value:!0})});