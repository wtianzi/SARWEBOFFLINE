// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ./BaseRaster ../rasterTransforms/PolynomialTransform ./InMemoryRaster ./pamParser".split(" "),
function(t,n,g,u,I,J,v,K,w,x,L,M,N,p,y,z,O,A,B,C,D,E,F){g=function(q){function m(){return q.apply(this,arguments)||this}t._inheritsLoose(m,q);var h=m.prototype;h.open=async function(a){await this.init();var b=await this._fetchData(a);let {spatialReference:c,statistics:d,histograms:e,transform:f}=await this._fetchAuxiliaryData(a);(a=!c)&&(c=new y({wkid:3857}));null!=e&&e.length&&null==d&&(d=B.estimateStatisticsFromHistograms(e));const {width:G,height:H}=b;let k=new z({xmin:-.5,ymin:.5-H,xmax:G-.5,
ymax:.5,spatialReference:c});const r=f?f.forwardTransform(k):k;var l=!0;f&&(l=(l=f.forwardCoefficients)&&0===l[1]&&0===l[2])&&(f=null,k=r);b=new E({data:{extent:r,nativeExtent:k,transform:f,pixelBlock:b,statistics:d,histograms:e,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:a}});await b.open();this._set("rasterInfo",b.rasterInfo);this._inMemoryRaster=b};h.fetchRawTile=function(a,b,c,d={}){return this._inMemoryRaster.fetchRawTile(a,b,c,d)};h._fetchData=async function(a){({data:a}=await this.request(this.url,
{responseType:"array-buffer",signal:null==a?void 0:a.signal}));const b=A.getFormat(a).toUpperCase();if("JPG"===b||"PNG"===b||"GIF"===b||"BMP"===b)this._set("datasetFormat",b);else throw new x("image-aux-raster:open","the data is not a supported format");return await this.decodePixelBlock(a,{format:"jpg",width:1,height:1,useCanvas:!0})};h._fetchAuxiliaryData=async function(a){var b,c;a=u.unwrap(null==a?void 0:a.signal);var d=null!=(b=this.ioConfig.skipExtensions)?b:[];b=-1<d.indexOf("aux.xml")?null:
this.request(this.url+".aux.xml",{responseType:"xml",signal:a});var e=this.datasetFormat;e="JPG"===e?"jgw":"PNG"===e?"pgw":"BMP"===e?"bpw":null;d=-1<d.indexOf(e)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+e,{responseType:"text",signal:a});d=await p.eachAlways([b,d]);if(null!=a&&a.aborted)throw p.createAbortError();a=F.parsePAMInfo(null==(c=d[0].value)?void 0:c.data);a.transform||(c=d[1].value?d[1].value.data.split("\n").slice(0,6).map(f=>Number(f)):null,a.transform=6===(null==
c?void 0:c.length)?new D({forwardCoefficients:[c[4],c[5],c[0],-c[1],c[2],-c[3]]}):null);return a};return m}(C);n.__decorate([v.property({type:String,json:{write:!0}})],g.prototype,"datasetFormat",void 0);return g=n.__decorate([w.subclass("esri.layers.support.rasterDatasets.ImageAuxRaster")],g)});