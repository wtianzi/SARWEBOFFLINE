// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry ../RasterInfo ../rasterFunctions/pixelUtils ./BaseRaster".split(" "),
function(w,k,e,r,I,J,t,K,x,y,L,M,N,z,A,B,O,C,u,D){e=function(v){function l(){var a=v.apply(this,arguments)||this;a.datasetFormat="MEMORY";return a}w._inheritsLoose(l,v);var m=l.prototype;m.open=async function(a){var b;await this.init();const {pixelBlock:d,statistics:c,histograms:n,name:f,keyProperties:g,nativeExtent:E,transform:F}=this.data,{width:p,height:q,pixelType:G}=d,h=this.data.extent||new B({xmin:-.5,ymin:.5,xmax:p-.5,ymax:q-.5,spatialReference:new A({wkid:3857})}),H=null!=(b=this.data.isPseudoSpatialReference)?
b:!this.data.extent;b=new C({width:p,height:q,pixelType:G,extent:h,nativeExtent:E,transform:F,pixelSize:{x:h.width/p,y:h.height/q},spatialReference:h.spatialReference,bandCount:3,keyProperties:g||{},statistics:c,isPseudoSpatialReference:H,histograms:n});this.createRemoteDatasetStorageInfo(b,512,512);this._set("rasterInfo",b);this.updateTileInfo();await this._buildInMemoryRaster(d,{width:512,height:512},a);this.datasetName=f;this.url="/InMemory/"+f};m.fetchRawTile=function(a,b,d,c){a=this._pixelBlockTiles.get(`${a}/${b}/${d}`);
return Promise.resolve(a)};m._buildInMemoryRaster=async function(a,b,d){var c=this.rasterInfo.storageInfo.maximumPyramidLevel;const n=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:a,tileSize:b,maximumPyramidLevel:c},d):Promise.resolve(u.split(a,b,c));b=r.isSome(this.rasterInfo.statistics);c=r.isSome(this.rasterInfo.histograms);a=b&&c?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:a},d):Promise.resolve(u.estimateStatisticsHistograms(a));
a=await z.eachAlways([n,a]);if(!a[0].value&&a[1].value)throw new y("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=a[0].value;if(!b){var f;this.rasterInfo.statistics=null==(f=a[1].value)?void 0:f.statistics}if(c){var g;this.rasterInfo.histograms=null==(g=a[1].value)?void 0:g.histograms}};return l}(D);k.__decorate([t.property({type:String,json:{write:!0}})],e.prototype,"datasetFormat",void 0);k.__decorate([t.property()],e.prototype,"data",void 0);return e=k.__decorate([x.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],
e)});