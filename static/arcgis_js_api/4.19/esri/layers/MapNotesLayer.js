// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/object ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/Warning ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/support/spatialReferenceUtils ../geometry/SpatialReference ../geometry/Extent ../geometry ../core/Collection ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/TextSymbol ../symbols ../Graphic ./Layer ../geometry/support/normalizeUtils ../core/MultiOriginJSONSupport ../geometry/projection ./mixins/OperationalLayer ./support/Field ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./FeatureLayer ./GraphicsLayer ./graphics/objectIdUtils".split(" "),
function(y,d,e,D,M,r,fa,ha,k,ia,t,H,I,N,O,ja,ka,la,P,w,E,ma,F,Q,R,J,S,na,T,U,V,W,z,X,K,Y,Z,aa,ba,ca,da){function A(u){return u.layers.some(q=>null!=q.layerDefinition.visibilityField)}const L=new K({name:"OBJECTID",alias:"OBJECTID",type:"oid",nullable:!1,editable:!1}),ea=new K({name:"title",alias:"Title",type:"string",nullable:!0,editable:!0});let v=function(u){function q(){var h=u.apply(this,arguments)||this;h.visibilityMode="inherited";return h}y._inheritsLoose(q,u);q.prototype.initialize=function(){for(const h of this.graphics)h.sourceLayer=
this.layer;this.graphics.on("after-add",h=>{h.item.sourceLayer=this.layer});this.graphics.on("after-remove",h=>{h.item.sourceLayer=null})};y._createClass(q,[{key:"sublayers",get:function(){return this.graphics}}]);return q}(ca);d.__decorate([k.property({readOnly:!0})],v.prototype,"sublayers",null);d.__decorate([k.property()],v.prototype,"layer",void 0);d.__decorate([k.property({readOnly:!0})],v.prototype,"visibilityMode",void 0);v=d.__decorate([I.subclass("esri.layers.MapNotesLayer.MapNotesSublayer")],
v);const G=[{geometryType:"polygon",geometryTypeJSON:"esriGeometryPolygon",layerId:"polygonLayer",title:"Polygons",identifyingSymbol:(new R).toJSON()},{geometryType:"polyline",geometryTypeJSON:"esriGeometryPolyline",layerId:"polylineLayer",title:"Polylines",identifyingSymbol:(new Q).toJSON()},{geometryType:"multipoint",geometryTypeJSON:"esriGeometryMultipoint",layerId:"multipointLayer",title:"Multipoints",identifyingSymbol:(new J).toJSON()},{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",
layerId:"pointLayer",title:"Points",identifyingSymbol:(new J).toJSON()},{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",layerId:"textLayer",title:"Text",identifyingSymbol:(new S).toJSON()}];e=function(u){function q(b){var a=u.call(this,b)||this;a.capabilities={operations:{supportsMapNotesEditing:!0}};a.featureCollections=null;a.featureCollectionJSON=null;a.featureCollectionType="notes";a.legendEnabled=!1;a.minScale=0;a.maxScale=0;a.spatialReference=w.WGS84;a.sublayers=new F(G.map(c=>new v({id:c.layerId,
title:c.title,layer:y._assertThisInitialized(a)})));a.title="Map Notes";a.type="map-notes";a.visibilityMode="inherited";return a}y._inheritsLoose(q,u);var h=q.prototype;h.readCapabilities=function(b,a,c){return{operations:{supportsMapNotesEditing:!A(a)&&"portal-item"!==(null==c?void 0:c.origin)}}};h.readFeatureCollections=function(b,a,c){if(!A(a))return null;b=a.layers.map(f=>{const g=new ba;g.read(f,c);return g});return new F({items:b})};h.readLegacyfeatureCollectionJSON=function(b,a){return A(a)?
D.clone(a.featureCollection):null};h.readFullExtent=function(b,a){if(!a.layers.length)return new E({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:w.WGS84});b=w.fromJSON(a.layers[0].layerDefinition.spatialReference);return a.layers.reduce((c,f)=>(f=f.layerDefinition.extent)?E.fromJSON(f).union(c):c,new E({spatialReference:b}))};h.readMinScale=function(b,a){for(const c of a.layers)if(null!=c.layerDefinition.minScale)return c.layerDefinition.minScale;return 0};h.readMaxScale=function(b,a){for(const c of a.layers)if(null!=
c.layerDefinition.maxScale)return c.layerDefinition.maxScale;return 0};h.readSpatialReference=function(b,a){return a.layers.length?w.fromJSON(a.layers[0].layerDefinition.spatialReference):w.WGS84};h.readSublayers=function(b,a,c){if(A(a))return null;b=[];for(c=0;c<a.layers.length;c++){var f;const {layerDefinition:m,featureSet:n}=a.layers[c],p=null!=(f=m.geometryType)?f:n.geometryType;var g=G.find(l=>{var x,B,C;return p===l.geometryTypeJSON&&(null==(x=m.drawingInfo)?void 0:null==(B=x.renderer)?void 0:
null==(C=B.symbol)?void 0:C.type)===l.identifyingSymbol.type});g&&(g=new v({id:g.layerId,title:m.name,layer:this,graphics:n.features.map(({geometry:l,symbol:x,attributes:B,popupInfo:C})=>T.fromJSON({attributes:B,geometry:l,symbol:x,popupTemplate:C}))}),b.push(g))}return new F(b)};h.writeSublayers=function(b,a,c,f){const {minScale:g,maxScale:m}=this;if(!r.isNone(b))if(c=b.some(l=>0<l.graphics.length),this.capabilities.operations.supportsMapNotesEditing){var n=[];c=this.spatialReference.toJSON();a:for(var p of b)for(const l of p.graphics)if(r.isSome(l.geometry)){c=
l.geometry.spatialReference.toJSON();break a}for(const l of G)p=b.find(x=>l.layerId===x.id),this._writeMapNoteSublayer(n,p,l,g,m,c,f);M.setDeepValue("featureCollection.layers",n,a)}else c&&(null==f?void 0:null==(n=f.messages)?void 0:n.push(new O("map-notes-layer:editing-not-supported","New map notes cannot be added to this layer")))};h.load=function(b){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Collection"]},b));return Promise.resolve(this)};h.read=function(b,a){"featureCollection"in
b&&(b=D.clone(b),Object.assign(b,b.featureCollection));u.prototype.read.call(this,b,a)};h.beforeSave=async function(){if(!r.isNone(this.sublayers)){var b=null,a=[];for(const f of this.sublayers)for(const g of f.graphics)if(r.isSome(g.geometry)){const m=g.geometry;b?P.equals(m.spatialReference,b)||(z.canProjectWithoutEngine(m.spatialReference,b)||z.isLoaded()||await z.load(),g.geometry=z.project(m,b)):b=m.spatialReference;a.push(g)}var c=await V.normalizeCentralMeridian(a.map(f=>f.geometry));a.forEach((f,
g)=>f.geometry=c[g])}};h._findSublayer=function(b){var a,c;return r.isNone(this.sublayers)?null:null!=(a=null==(c=this.sublayers)?void 0:c.find(f=>f.id===b))?a:null};h._writeMapNoteSublayer=function(b,a,c,f,g,m,n){const p=[];if(!r.isNone(a)){for(const l of a.graphics)this._writeMapNote(p,l,c.geometryType,n);this._normalizeObjectIds(p,L);b.push({layerDefinition:{name:a.title,drawingInfo:{renderer:{type:"simple",symbol:D.clone(c.identifyingSymbol)}},geometryType:c.geometryTypeJSON,minScale:f,maxScale:g,
objectIdField:"OBJECTID",fields:[L.toJSON(),ea.toJSON()],spatialReference:m},featureSet:{features:p,geometryType:c.geometryTypeJSON}})}};h._writeMapNote=function(b,a,c,f){if(!r.isNone(a)){var {geometry:g,symbol:m,popupTemplate:n}=a;if(!r.isNone(g))if(g.type!==c){var p;null==f?void 0:null==(p=f.messages)?void 0:p.push(new H("map-notes-layer:invalid-geometry-type",`Geometry "${g.type}" cannot be saved in "${c}" layer`,{graphic:a}))}else if(r.isNone(m)){var l;null==f?void 0:null==(l=f.messages)?void 0:
l.push(new H("map-notes-layer:no-symbol","Skipping map notes with no symbol",{graphic:a}))}else a={attributes:{...a.attributes},geometry:g.toJSON(),symbol:m.toJSON()},r.isSome(n)&&(a.popupInfo=n.toJSON()),b.push(a)}};h._normalizeObjectIds=function(b,a){a=a.name;let c=da.findLastObjectIdFromFeatures(a,b)+1;const f=new Set;for(const g of b){g.attributes||(g.attributes={});({attributes:b}=g);if(null==b[a]||f.has(b[a]))b[a]=c++;f.add(b[a])}};y._createClass(q,[{key:"multipointLayer",get:function(){return this._findSublayer("multipointLayer")}},
{key:"pointLayer",get:function(){return this._findSublayer("pointLayer")}},{key:"polygonLayer",get:function(){return this._findSublayer("polygonLayer")}},{key:"polylineLayer",get:function(){return this._findSublayer("polylineLayer")}},{key:"textLayer",get:function(){return this._findSublayer("textLayer")}}]);return q}(Y.BlendLayer(aa.ScaleRangeLayer(X.OperationalLayer(Z.PortalLayer(W.MultiOriginJSONMixin(U))))));d.__decorate([k.property({readOnly:!0})],e.prototype,"capabilities",void 0);d.__decorate([t.reader(["portal-item",
"web-map"],"capabilities",["layers"])],e.prototype,"readCapabilities",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"featureCollections",void 0);d.__decorate([t.reader(["web-map","portal-item"],"featureCollections",["layers"])],e.prototype,"readFeatureCollections",null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{enabled:!0,target:"featureCollection"}}}}})],e.prototype,"featureCollectionJSON",void 0);d.__decorate([t.reader(["web-map","portal-item"],"featureCollectionJSON",
["featureCollection"])],e.prototype,"readLegacyfeatureCollectionJSON",null);d.__decorate([k.property({readOnly:!0,json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],e.prototype,"featureCollectionType",void 0);d.__decorate([k.property({json:{write:!1}})],e.prototype,"fullExtent",void 0);d.__decorate([t.reader(["web-map","portal-item"],"fullExtent",["layers"])],e.prototype,"readFullExtent",null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{target:"featureCollection.showLegend",
overridePolicy(){return{enabled:null!=this.featureCollectionJSON}}}}}}})],e.prototype,"legendEnabled",void 0);d.__decorate([k.property({type:["show","hide"]})],e.prototype,"listMode",void 0);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!1}})],e.prototype,"minScale",void 0);d.__decorate([t.reader(["web-map","portal-item"],"minScale",["layers"])],e.prototype,"readMinScale",null);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!1}})],e.prototype,"maxScale",void 0);
d.__decorate([t.reader(["web-map","portal-item"],"maxScale",["layers"])],e.prototype,"readMaxScale",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"multipointLayer",null);d.__decorate([k.property({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],e.prototype,"operationalLayerType",void 0);d.__decorate([k.property({readOnly:!0})],e.prototype,"pointLayer",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"polygonLayer",null);d.__decorate([k.property({readOnly:!0})],e.prototype,
"polylineLayer",null);d.__decorate([k.property({type:w})],e.prototype,"spatialReference",void 0);d.__decorate([t.reader(["web-map","portal-item"],"spatialReference",["layers"])],e.prototype,"readSpatialReference",null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],e.prototype,"sublayers",void 0);d.__decorate([t.reader("web-map","sublayers",["layers"])],e.prototype,"readSublayers",null);d.__decorate([N.writer("web-map","sublayers")],e.prototype,"writeSublayers",
null);d.__decorate([k.property({readOnly:!0})],e.prototype,"textLayer",null);d.__decorate([k.property()],e.prototype,"title",void 0);d.__decorate([k.property({readOnly:!0,json:{read:!1}})],e.prototype,"type",void 0);return e=d.__decorate([I.subclass("esri.layers.MapNotesLayer")],e)});