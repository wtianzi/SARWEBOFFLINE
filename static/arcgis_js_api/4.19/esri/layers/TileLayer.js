// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J){m.ArcGISCachedService=y=>{y=function(W){function N(){var M=W.apply(this,arguments)||this;M.copyright=null;M.minScale=0;M.maxScale=0;M.spatialReference=null;M.tileInfo=null;M.tilemapCache=null;return M}t._inheritsLoose(N,W);var S=N.prototype;S.readMinScale=function(M,K){return null!=K.minLOD&&null!=K.maxLOD?M:0};S.readMaxScale=function(M,K){return null!=K.minLOD&&null!=K.maxLOD?M:0};S.readTilemapCache=function(M,K){return K.capabilities&&-1<K.capabilities.indexOf("Tilemap")?
new J.TilemapCache({layer:this}):null};t._createClass(N,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return N}(y);e.__decorate([u.property({json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0);e.__decorate([u.property()],y.prototype,"minScale",void 0);e.__decorate([v.reader("service","minScale")],y.prototype,"readMinScale",null);e.__decorate([u.property()],y.prototype,"maxScale",void 0);e.__decorate([v.reader("service","maxScale")],y.prototype,"readMaxScale",
null);e.__decorate([u.property({type:a})],y.prototype,"spatialReference",void 0);e.__decorate([u.property({readOnly:!0})],y.prototype,"supportsBlankTile",null);e.__decorate([u.property(h.serviceTileInfoProperty)],y.prototype,"tileInfo",void 0);e.__decorate([u.property()],y.prototype,"tilemapCache",void 0);e.__decorate([v.reader("service","tilemapCache",["capabilities"])],y.prototype,"readTilemapCache",null);e.__decorate([u.property()],y.prototype,"version",void 0);return y=e.__decorate([z.subclass("esri.layers.mixins.ArcGISCachedService")],
y)};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(m,t){function e(B,n,u,x){if(!B)return null;const {minScale:v,maxScale:z,minLOD:H,maxLOD:L}=n;if(null!=H&&null!=L)return x&&x.ignoreMinMaxLOD?t.fromJSON(B):t.fromJSON({...B,lods:B.lods.filter(({level:O})=>null!=O&&O>=H&&O<=L)});if(0!==v&&0!==z){const O=v?Math.round(1E4*v)/1E4:Infinity,a=z?Math.round(1E4*z)/1E4:-Infinity;return t.fromJSON({...B,lods:B.lods.filter(d=>
{d=Math.round(1E4*d.scale)/1E4;return d<=O&&d>=a})})}return t.fromJSON(B)}const r={type:t,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:e}}}}};m.readServiceTileInfo=e;m.serviceTileInfoProperty=r;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect ./LOD".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W,N,S,M){var K;e=new u.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});a=K=function(C){function G(f){f=C.call(this,f)||this;f.dpi=96;f.format=null;f.origin=null;f.minScale=0;f.maxScale=0;f.size=null;f.spatialReference=null;return f}m._inheritsLoose(G,C);G.create=function(f=
{size:256,spatialReference:h.WebMercator}){var b=f.resolutionFactor||1,g=f.scales;const l=f.size||256,q=f.spatialReference||h.WebMercator;if(!d.isValid(q)){b=[];if(g)for(f=0;f<g.length;f++){var A=g[f];b.push({level:f,scale:A,resolution:A})}else for(g=5E-4,f=23;0<=f;f--)b.unshift({level:f,scale:g,resolution:g}),g*=2;return new K({dpi:96,lods:b,origin:new y(0,0,q),size:[l,l],spatialReference:q})}A=d.getInfo(q);f=f.origin?new y({x:f.origin.x,y:f.origin.y,spatialReference:q}):A?new y({x:A.origin[0],y:A.origin[1],
spatialReference:q}):new y({x:0,y:0,spatialReference:q});A=1/(39.37*N.getMetersPerUnitForSR(q)*96);const Q=[];if(g)for(b=0;b<g.length;b++){var R=g[b];Q.push({level:b,scale:R,resolution:R*A})}else{var P=d.isGeographic(q)?512/l*5.916575275917094E8:256/l*5.91657527591555E8;g=Math.ceil(24/b);Q.push({level:0,scale:P,resolution:P*A});for(R=1;R<g;R++)P/=2**b,Q.push({level:R,scale:P,resolution:P*A})}return new K({dpi:96,lods:Q,origin:f,size:[l,l],spatialReference:q})};var D=G.prototype;D.readOrigin=function(f,
b){return y.fromJSON({spatialReference:b.spatialReference,...f})};D.readSize=function(f,b){return[b.cols,b.rows]};D.writeSize=function(f,b){b.cols=f[0];b.rows=f[0]};D.zoomToScale=function(f){const b=this.scales;if(0>=f)return b[0];if(f>=b.length)return b[b.length-1];{const g=Math.round(f);return b[g]+(g-f)*(b[Math.round(f-.5)]-b[g])}};D.scaleToZoom=function(f){const b=this.scales,g=b.length-1;let l=0;for(;l<g;l++){const q=b[l],A=b[l+1];if(q<=f)break;if(A===f)return l+1;if(q>f&&A<f)return l+1-(f-A)/
(q-A)}return l};D.snapScale=function(f,b=.95){f=this.scaleToZoom(f);return f%Math.floor(f)>=b?this.zoomToScale(Math.ceil(f)):this.zoomToScale(Math.floor(f))};D.tileAt=function(f,b,g,l){var q=this.lodAt(f);if(!q)return null;let A;if("number"===typeof b)A=b,b=g;else{if(d.equals(b.spatialReference,this.spatialReference))A=b.x,b=b.y;else{l=J.project(b,this.spatialReference);if(!l)return null;A=l.x;b=l.y}l=g}g=q.resolution*this.size[0];q=q.resolution*this.size[1];l||(l={id:null,level:0,row:0,col:0,extent:S.create()});
l.level=f;l.row=Math.floor((this.origin.y-b)/q+.001);l.col=Math.floor((A-this.origin.x)/g+.001);this.updateTileInfo(l);return l};D.updateTileInfo=function(f,b=0){var g=this.lodAt(f.level);g||1!==b||(b=this.lods[this.lods.length-1],b.level<f.level&&(g=b));if(g){var l=f.level-g.level;b=g.resolution*this.size[0]/2**l;g=g.resolution*this.size[1]/2**l;f.id=`${f.level}/${f.row}/${f.col}`;f.extent||(f.extent=S.create());f.extent[0]=this.origin.x+f.col*b;f.extent[1]=this.origin.y-(f.row+1)*g;f.extent[2]=
f.extent[0]+b;f.extent[3]=f.extent[1]+g}};D.upsampleTile=function(f){const b=this._upsampleLevels[f.level];if(!b||-1===b.parentLevel)return!1;f.level=b.parentLevel;f.row=Math.floor(f.row/b.factor+.001);f.col=Math.floor(f.col/b.factor+.001);this.updateTileInfo(f);return!0};D.getTileBounds=function(f,b){var {resolution:g}=this.lodAt(b.level);const l=g*this.size[0];g*=this.size[1];f[0]=this.origin.x+b.col*l;f[1]=this.origin.y-(b.row+1)*g;f[2]=f[0]+l;f[3]=f[1]+g;return f};D.lodAt=function(f){return this._levelToLOD&&
this._levelToLOD[f]||null};D.clone=function(){return K.fromJSON(this.write({}))};D._initializeUpsampleLevels=function(){const f=this.lods;this._upsampleLevels=[];let b=null;for(let g=0;g<f.length;g++){const l=f[g];this._upsampleLevels[l.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/l.resolution:0};b=l}};m._createClass(G,[{key:"isWrappable",get:function(){const {spatialReference:f,origin:b}=this;if(f&&b){const g=d.getInfo(f);return f.isWrappable&&Math.abs(g.origin[0]-b.x)<=g.dx}return!1}},
{key:"lods",set:function(f){let b=0,g=0;const l=[];this._levelToLOD={};f&&(b=-Infinity,g=Infinity,f.forEach(q=>{l.push(q.scale);b=q.scale>b?q.scale:b;g=q.scale<g?q.scale:g;this._levelToLOD[q.level]=q}));this._set("scales",l);this._set("minScale",b);this._set("maxScale",g);this._set("lods",f);this._initializeUpsampleLevels()}}]);return G}(a.JSONSupport);t.__decorate([n.property({type:Number,json:{write:!0}})],a.prototype,"compressionQuality",void 0);t.__decorate([n.property({type:Number,json:{write:!0}})],
a.prototype,"dpi",void 0);t.__decorate([n.property({type:String,json:{read:e.read,write:e.write,origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"format",void 0);t.__decorate([n.property({readOnly:!0})],a.prototype,"isWrappable",null);t.__decorate([n.property({type:y,json:{write:!0}})],a.prototype,"origin",void 0);t.__decorate([x.reader("origin")],a.prototype,"readOrigin",null);t.__decorate([n.property({type:[M],value:null,json:{write:!0}})],a.prototype,"lods",null);t.__decorate([n.property({readOnly:!0})],
a.prototype,"minScale",void 0);t.__decorate([n.property({readOnly:!0})],a.prototype,"maxScale",void 0);t.__decorate([n.property({readOnly:!0})],a.prototype,"scales",void 0);t.__decorate([n.property({cast:C=>Array.isArray(C)?C:"number"===typeof C?[C,C]:[256,256]})],a.prototype,"size",void 0);t.__decorate([x.reader("size",["rows","cols"])],a.prototype,"readSize",null);t.__decorate([z.writer("size",{cols:{type:B.Integer},rows:{type:B.Integer}})],a.prototype,"writeSize",null);t.__decorate([n.property({type:h,
json:{write:!0}})],a.prototype,"spatialReference",void 0);return a=K=t.__decorate([v.subclass("esri.layers.support.TileInfo")],a)})},"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../../core/maybe","../Extent"],function(m,t,e,r){function B(a=O){return[a[0],a[1],a[2],a[3]]}function n(a){return a[0]>=a[2]?0:a[2]-a[0]}function u(a){return a[1]>=a[3]?0:a[3]-a[1]}function x(a,d,h){return d>=a[0]&&h>=a[1]&&d<=a[2]&&h<=a[3]}function v(a,d){a[0]=d[0];a[1]=d[1];a[2]=
d[2];a[3]=d[3];return a}function z(a){return 4===a.length}function H(a,d,h){return a<d?d:a>h?h:a}const L=[Infinity,Infinity,-Infinity,-Infinity],O=[0,0,0,0];m.NEGATIVE_INFINITY=L;m.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];m.UNIT=[0,0,1,1];m.ZERO=O;m.allFinite=function(a){for(let d=0;4>d;d++)if(!isFinite(a[d]))return!1;return!0};m.area=function(a){return n(a)*u(a)};m.center=function(a,d=[0,0]){d[0]=(a[0]+a[2])/2;d[1]=(a[1]+a[3])/2;return d};m.clone=function(a){return[a[0],a[1],a[2],
a[3]]};m.contains=function(a,d){return d[0]>=a[0]&&d[2]<=a[2]&&d[1]>=a[1]&&d[3]<=a[3]};m.containsPoint=function(a,d){return x(a,d[0],d[1])};m.containsPointObject=function(a,d){return x(a,d.x,d.y)};m.containsPointWithMargin=function(a,d,h){return d[0]>=a[0]-h&&d[1]>=a[1]-h&&d[0]<=a[2]+h&&d[1]<=a[3]+h};m.containsXY=x;m.create=B;m.diameter=function(a){const d=n(a);a=u(a);return Math.sqrt(d*d+a*a)};m.distance=function(a,d){const h=(a[1]+a[3])/2,J=Math.max(Math.abs(d[0]-(a[0]+a[2])/2)-n(a)/2,0);a=Math.max(Math.abs(d[1]-
h)-u(a)/2,0);return Math.sqrt(J*J+a*a)};m.empty=function(a){return a?v(a,L):B(L)};m.equals=function(a,d,h){if(e.isNone(a)||e.isNone(d))return a===d;if(!z(a)||!z(d))return!1;if(h)for(let J=0;J<a.length;J++){if(!h(a[J],d[J]))return!1}else for(h=0;h<a.length;h++)if(a[h]!==d[h])return!1;return!0};m.expand=function(a,d,h=a){if("length"in d)if(z(d))h[0]=Math.min(a[0],d[0]),h[1]=Math.min(a[1],d[1]),h[2]=Math.max(a[2],d[2]),h[3]=Math.max(a[3],d[3]);else{if(2===d.length||3===d.length)h[0]=Math.min(a[0],d[0]),
h[1]=Math.min(a[1],d[1]),h[2]=Math.max(a[2],d[0]),h[3]=Math.max(a[3],d[1])}else switch(d.type){case "extent":h[0]=Math.min(a[0],d.xmin);h[1]=Math.min(a[1],d.ymin);h[2]=Math.max(a[2],d.xmax);h[3]=Math.max(a[3],d.ymax);break;case "point":h[0]=Math.min(a[0],d.x),h[1]=Math.min(a[1],d.y),h[2]=Math.max(a[2],d.x),h[3]=Math.max(a[3],d.y)}return h};m.expandPointInPlace=function(a,d){d[0]<a[0]&&(a[0]=d[0]);d[0]>a[2]&&(a[2]=d[0]);d[1]<a[1]&&(a[1]=d[1]);d[1]>a[3]&&(a[3]=d[1])};m.expandWithNestedArray=function(a,
d,h=a){const J=d.length;let y=a[0],W=a[1],N=a[2];a=a[3];for(let S=0;S<J;S++){const M=d[S];y=Math.min(y,M[0]);W=Math.min(W,M[1]);N=Math.max(N,M[0]);a=Math.max(a,M[1])}h[0]=y;h[1]=W;h[2]=N;h[3]=a;return h};m.fromExtent=function(a,d=B()){d[0]=a.xmin;d[1]=a.ymin;d[2]=a.xmax;d[3]=a.ymax;return d};m.fromValues=function(a,d,h,J,y=B()){y[0]=a;y[1]=d;y[2]=h;y[3]=J;return y};m.height=u;m.intersection=function(a,d,h=a){const J=d[0],y=d[1],W=d[2];d=d[3];h[0]=H(a[0],J,W);h[1]=H(a[1],y,d);h[2]=H(a[2],J,W);h[3]=
H(a[3],y,d);return h};m.intersects=function(a,d){return Math.max(d[0],a[0])<=Math.min(d[2],a[2])&&Math.max(d[1],a[1])<=Math.min(d[3],a[3])};m.is=z;m.isPoint=function(a){return(0===n(a)||!isFinite(a[0]))&&(0===u(a)||!isFinite(a[1]))};m.offset=function(a,d,h,J=a){J[0]=a[0]+d;J[1]=a[1]+h;J[2]=a[2]+d;J[3]=a[3]+h;return J};m.pad=function(a,d,h=a){h[0]=a[0]-d;h[1]=a[1]-d;h[2]=a[2]+d;h[3]=a[3]+d;return h};m.set=v;m.setMax=function(a,d,h=a){h[2]=d[0];h[3]=d[1];h!==a&&(h[0]=a[0],h[1]=a[1]);return a};m.setMin=
function(a,d,h=a){h[0]=d[0];h[1]=d[1];h!==a&&(h[2]=a[2],h[3]=a[3]);return h};m.size=function(a,d){d[0]=a[2]-a[0];d[1]=a[3]-a[1]};m.toExtent=function(a,d){return new r({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:d})};m.width=n;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L){var O;e=O=function(a){function d(h){h=a.call(this,h)||this;h.level=0;h.levelValue=null;h.resolution=0;h.scale=0;return h}m._inheritsLoose(d,a);d.prototype.clone=function(){return new O({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return d}(L.JSONSupport);t.__decorate([n.property({type:B.Integer,json:{write:!0}})],e.prototype,"level",void 0);t.__decorate([n.property({type:String,json:{write:!0}})],e.prototype,"levelValue",
void 0);t.__decorate([n.property({type:Number,json:{write:!0}})],e.prototype,"resolution",void 0);t.__decorate([n.property({type:Number,json:{write:!0}})],e.prototype,"scale",void 0);return e=O=t.__decorate([x.subclass("esri.layers.support.LOD")],e)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W,N,S,M){var K;const C=B.getLogger("esri.layers.support.TilemapCache");m.TilemapCache=K=function(G){function D(b){b=G.call(this,b)||this;b._handles=new W;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=y;b._prefetchingEnabled=!0;return b}t._inheritsLoose(D,G);var f=D.prototype;f.initialize=function(){this._tilemapCache=new N(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),S.init(this,"layer.tileInfo.lods",b=>this._initializeAvailableLevels(b),!0)]);this._initializeTilemapDefinition()};f.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};f.castLevels=function(b){return 2>=b?(C.error("Minimum levels for Tilemap is 3, but got ",b),3):b};f.fetchTilemap=function(b,g,l,q){if(!this._availableLevels[b])return Promise.reject(new z("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));
const A=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,g,l,A))return Promise.resolve(b);const Q=q&&q.signal;q={...q,signal:null};return new Promise((R,P)=>{d.onAbort(Q,()=>P(d.createAbortError()));const X=M.tilemapDefinitionId(A);let Z=this._pendingTilemapRequests[X];if(!Z){Z=M.Tilemap.fromDefinition(A,q).then(p=>{this._tilemapCache.put(X,p,p.byteSize);return p});const Y=()=>delete this._pendingTilemapRequests[X];this._pendingTilemapRequests[X]=Z;Z.then(Y,Y)}Z.then(R,P)})};f.getAvailability=
function(b,g,l){return this._availableLevels[b]?(b=this._tilemapFromCache(b,g,l,this._tmpTilemapDefinition))?b.getAvailability(g,l):"unknown":"unavailable"};f.getAvailabilityUpsample=function(b,g,l,q){q.level=b;q.row=g;q.col=l;b=this.layer.tileInfo;for(b.updateTileInfo(q);;)if(g=this.getAvailability(q.level,q.row,q.col),"unavailable"===g){if(!b.upsampleTile(q))return"unavailable"}else return g};f.fetchAvailability=function(b,g,l,q){return this._availableLevels[b]?this.fetchTilemap(b,g,l,q).catch(A=>
A).then(A=>{if(A instanceof M.Tilemap)return A=A.getAvailability(g,l),"unavailable"===A?Promise.reject(new z("tile-map:tile-unavailable","Tile is not available",{level:b,row:g,col:l})):A;if(d.isAbortError(A))throw A;return"unknown"}):Promise.reject(new z("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};f.fetchAvailabilityUpsample=function(b,g,l,q,A){q.level=b;q.row=g;q.col=l;const Q=this.layer.tileInfo;Q.updateTileInfo(q);const R=this.fetchAvailability(b,g,l,A).catch(P=>
{if(d.isAbortError(P))throw P;if(Q.upsampleTile(q))return this.fetchAvailabilityUpsample(q.level,q.row,q.col,q);throw P;});this._fetchAvailabilityUpsamplePrefetch(q.id,b,g,l,A,R);return R};f._fetchAvailabilityUpsamplePrefetch=async function(b,g,l,q,A,Q){if(this._prefetchingEnabled){var R=`prefetch-${b}`;if(!this._handles.has(R)){var P=d.createAbortController();Q.then(()=>P.abort(),()=>P.abort());var X=!1;this._handles.add({remove(){X||(X=!0,P.abort())}},R);await h.waitTicks(10,P.signal).catch(()=>
{});X||(X=!0,this._handles.remove(R));if(!d.isAborted(P))for(b={id:b,level:g,row:l,col:q},A={...A,signal:P.signal},g=this.layer.tileInfo,l=0;K._prefetches.length<K._maxPrefetch&&g.upsampleTile(b);++l){const Z=this.fetchAvailability(b.level,b.row,b.col,A);K._prefetches.push(Z);q=()=>{K._prefetches.removeUnordered(Z)};Z.then(q,q)}}}};f._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var b=this.layer.parsedUrl,g=b.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:b.path,
query:g?H.objectToQuery(g):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};f._tilemapFromCache=function(b,g,l,q){q.level=b;q.row=g-g%this.size;q.col=l-l%this.size;b=M.tilemapDefinitionId(q);return this._tilemapCache.get(b)};f._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(g=>this._availableLevels[g.level]=!0)};t._createClass(D,[{key:"size",get:function(){return 1<<this.levels}},
{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(g){b._prefetchingEnabled=g},hasTilemap(g,l,q){return!!b._tilemapFromCache(g,l,q,b._tmpTilemapDefinition)}}}}]);return D}(J);m.TilemapCache._maxPrefetch=4;m.TilemapCache._prefetches=new a({initialSize:K._maxPrefetch});e.__decorate([n.property({constructOnly:!0,type:Number})],m.TilemapCache.prototype,"levels",void 0);e.__decorate([u.cast("levels")],m.TilemapCache.prototype,"castLevels",
null);e.__decorate([n.property({readOnly:!0,type:Number})],m.TilemapCache.prototype,"size",null);e.__decorate([n.property({constructOnly:!0,type:Number})],m.TilemapCache.prototype,"cacheByteSize",void 0);e.__decorate([n.property({constructOnly:!0})],m.TilemapCache.prototype,"layer",void 0);e.__decorate([n.property({constructOnly:!0})],m.TilemapCache.prototype,"request",void 0);m.TilemapCache=K=e.__decorate([v.subclass("esri.layers.support.TilemapCache")],m.TilemapCache);Object.defineProperty(m,"__esModule",
{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(m,t,e,r,B){function n(x){if("vector-tile"===x.service.type)var v=`${x.service.url}/tilemap/${x.level}/${x.row}/${x.col}/${x.width}/${x.height}`;else v=x.service.tileServers,v=`${v&&v.length?v[x.row%v.length]:x.service.url}/tilemap/${x.level}/${x.row}/${x.col}/${x.width}/${x.height}`;(x=x.service.query)&&(v=`${v}?${x}`);return v}let u=function(){function x(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var v=x.prototype;v.getAvailability=function(z,H){if("unknown"!==this._allAvailability)return this._allAvailability;z=(z-this.location.top)*this.location.width+(H-this.location.left);H=z>>3;const L=this._tileAvailabilityBitSet;return 0>H||H>L.length?"unknown":L[H]&1<<z%8?"available":"unavailable"};v._updateFromData=function(z){let H=!0,L=!0;const O=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let a=0;for(let d=0;d<z.length;d++){const h=d%8;z[d]?(L=!1,O[a]|=1<<h):H=!1;7===h&&++a}L?this._allAvailability="unavailable":H?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=O,this.byteSize+=O.length)};x.fromDefinition=function(z,H){const L=z.service.request||B,{row:O,col:a,width:d,height:h}=z,J={query:{f:"json"}};H=H?{...J,...H}:J;return L(n(z),H).then(y=>y.data).catch(y=>{if(y&&y.details&&422===y.details.httpStatus)return{location:{top:O,left:a,width:d,
height:h},valid:!0,data:r.constant(d*h,0)};throw y;}).then(y=>{if(y.location&&(y.location.top!==O||y.location.left!==a||y.location.width!==d||y.location.height!==h))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:y,definition:{top:O,left:a,width:d,height:h}});return x.fromJSON(y)})};x.fromJSON=function(z){x.validateJSON(z);const H=new x;H.location=Object.freeze(t.clone(z.location));H._updateFromData(z.data);return Object.freeze(H)};x.validateJSON=
function(z){if(!z||!z.location)throw new e("tilemap:missing-location","Location missing from tilemap response");if(!1===z.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!z.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(z.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(z.data.length!==z.location.width*z.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return x}();m.Tilemap=u;m.default=u;m.tilemapDefinitionId=function(x){return`${x.level}/${x.row}/${x.col}/${x.width}/${x.height}`};m.tilemapDefinitionUrl=n;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../../core/Version ../support/commonProperties".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W){m.ArcGISMapService=N=>{N=function(S){function M(){var C=S.apply(this,arguments)||this;C.capabilities=void 0;C.copyright=null;C.fullExtent=null;C.legendEnabled=!0;C.spatialReference=null;C.version=null;return C}t._inheritsLoose(M,S);var K=M.prototype;K.readCapabilities=function(C,G){var D=G.capabilities&&G.capabilities.split(",").map(R=>R.toLowerCase().trim());if(!D)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var f=this.type;C=-1!==D.indexOf("query");const b=-1!==D.indexOf("map"),g=!!G.exportTilesAllowed;D=-1!==D.indexOf("tilemap");const l="tile"!==f&&!!G.supportsDynamicLayers,q="tile"!==f&&(!G.tileInfo||l),A="tile"!==f&&(!G.tileInfo||l);f="tile"!==f;const Q=G.cimVersion?y.Version.parse(G.cimVersion).since(1,4):!1;return{operations:{supportsQuery:C,supportsExportMap:b,supportsExportTiles:g,supportsTileMap:D},exportMap:b?{supportsArcadeExpressionForLabeling:Q,supportsSublayersChanges:f,
supportsDynamicLayers:l,supportsSublayerVisibility:q,supportsSublayerDefinitionExpression:A}:null,exportTiles:g?{maxExportTilesCount:+G.maxExportTilesCount}:null}};K.readVersion=function(C,G){(C=G.currentVersion)||(C=G.hasOwnProperty("capabilities")||G.hasOwnProperty("tables")?10:G.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return C};K.fetchSublayerInfo=async function(C,G){await this.fetchAllLayersAndTables(G);return this._allLayersAndTablesMap.get(C)};K.fetchAllLayersAndTables=async function(C){await this.load(C);
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=J(H.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(D=>{this._allLayersAndTablesMap=new Map;for(const f of D.data.layers)this._allLayersAndTablesMap.set(f.id,f);return{result:D.data}},D=>({error:D})));const G=await this._allLayersAndTablesPromise;a.throwIfAborted(C);if("result"in G)return G.result;throw G.error;};return M}(N);e.__decorate([u.property({readOnly:!0})],N.prototype,
"capabilities",void 0);e.__decorate([v.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],N.prototype,"readCapabilities",null);e.__decorate([u.property({json:{read:{source:"copyrightText"}}})],N.prototype,"copyright",void 0);e.__decorate([u.property({type:h})],N.prototype,"fullExtent",void 0);e.__decorate([u.property(W.id)],N.prototype,"id",void 0);e.__decorate([u.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},
read:{source:"showLegend"},write:{target:"showLegend"}}})],N.prototype,"legendEnabled",void 0);e.__decorate([u.property(W.popupEnabled)],N.prototype,"popupEnabled",void 0);e.__decorate([u.property({type:d})],N.prototype,"spatialReference",void 0);e.__decorate([u.property()],N.prototype,"version",void 0);e.__decorate([v.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],N.prototype,"readVersion",null);return N=e.__decorate([z.subclass("esri.layers.mixins.ArcGISMapService")],
N)};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(m,t){let e=function(){function r(n,u,x=""){this.major=n;this.minor=u;this._context=x}var B=r.prototype;B.lessThan=function(n,u){return this.major<n||n===this.major&&this.minor<u};B.since=function(n,u){return!this.lessThan(n,u)};B.validate=function(n){if(this.major!==n.major)throw new t((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&
this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:n});};B.clone=function(){return new r(this.major,this.minor,this._context)};r.parse=function(n,u=""){const [x,v]=n.split(".");var z=/^\s*\d+\s*$/;if(!x||!x.match||!x.match(z))throw new t((u&&u+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:n});if(!v||!v.match||!v.match(z))throw new t((u&&u+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:n});n=parseInt(x,10);z=parseInt(v,10);return new r(n,z,u)};return r}();m.Version=e;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../geometry/Extent ../../geometry ../../core/Collection ./fieldUtils ../../core/Identifiable ../../PopupTemplate ../../request ../../core/Loadable ../../symbols ../../renderers/Renderer ../../renderers/ClassBreaksRenderer ../../renderers/UniqueValueRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/SimpleRenderer ../../renderers/support/types ../../renderers/support/jsonUtils ../../core/MultiOriginJSONSupport ./Field ./FieldsIndex ./LabelClass ./FeatureType ./source/MapLayerSource ./source/DataLayerSource ../../support/popupUtils ../../tasks/support/Query ../../core/HandleOwner".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W,N,S,M,K,C,G,D,f,b,g,l,q,A,Q,R,P,X,Z,Y,p,F,U,ba,ca,ia,da,oa,ra){function ma(T){return T&&"esriSMS"===T.type}function pa(T,aa,E){var c;return{ignoreOrigin:!0,enabled:E?"map-image"===(null==(c=E.layer)?void 0:c.type)&&(E.writeSublayerStructure||this.originIdOf(aa)>=y.nameToId(E.origin)):!1}}function qa(T,aa,E){var c;return{enabled:E?"tile"===(null==(c=E.layer)?void 0:c.type)&&this._isOverridden(aa):!1}}function ea(T,aa,E){return{ignoreOrigin:!0,enabled:E&&
E.writeSublayerStructure||!1}}function ka(T,aa,E){return{ignoreOrigin:!0,enabled:E?E.writeSublayerStructure||this.originIdOf(aa)>=y.nameToId(E.origin):!1}}var la;const na=n.getLogger("esri.layers.support.Sublayer");let sa=0;const ha=new Set;ha.add("layer");ha.add("parent");ha.add("loaded");ha.add("loadStatus");ha.add("loadError");ha.add("loadWarnings");r=la=function(T){function aa(c){c=T.call(this,c)||this;c.capabilities=void 0;c.fields=null;c.fullExtent=null;c.globalIdField=null;c.legendEnabled=
!0;c.objectIdField=null;c.popupEnabled=!0;c.popupTemplate=null;c.sourceJSON=null;c.title=null;c.typeIdField=null;c.types=null;return c}t._inheritsLoose(aa,T);var E=aa.prototype;E.load=async function(c){this.addResolvingPromise((async()=>{var k;if(!this.layer&&!this.url)throw new d("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let w=null;if(!this.layer||2<this.originIdOf("url")||"data-layer"===(null==(k=this.source)?void 0:k.type))w=(await D(this.url,
{responseType:"json",query:{f:"json"},...c})).data;else{var I;k=this.id;"map-layer"===(null==(I=this.source)?void 0:I.type)&&(k=this.source.mapLayerId);w=await this.layer.fetchSublayerInfo(k,c)}w&&(this.sourceJSON=w,this.read({layerDefinition:w},{origin:"service"}))})());return this};E.readCapabilities=function(c,k){k=k.layerDefinition||k;c=(c=k.capabilities||c)?c.toLowerCase().split(",").map(w=>w.trim()):[];return{exportMap:{supportsModification:!!k.canModifyLayer},operations:{supportsQuery:-1!==
c.indexOf("query")}}};E.readGlobalIdFieldFromService=function(c,k){k=k.layerDefinition||k;if(k.globalIdField)return k.globalIdField;if(k.fields)for(const w of k.fields)if("esriFieldTypeGlobalID"===w.type)return w.name};E.writeLabelingInfo=function(c,k,w,I){c&&c.length&&(k.layerDefinition={drawingInfo:{labelingInfo:c.map(V=>V.write({},I))}})};E.readMinScale=function(c,k){return k.minScale||k.layerDefinition&&k.layerDefinition.minScale||0};E.readMaxScale=function(c,k){return k.maxScale||k.layerDefinition&&
k.layerDefinition.maxScale||0};E.readObjectIdFieldFromService=function(c,k){k=k.layerDefinition||k;if(k.objectIdField)return k.objectIdField;if(k.fields)for(const w of k.fields)if("esriFieldTypeOID"===w.type)return w.name};E.readOpacity=function(c,k){c=k.layerDefinition;return 1-.01*(null!=c.transparency?c.transparency:c.drawingInfo.transparency)};E.writeOpacity=function(c,k,w,I){k.layerDefinition={drawingInfo:{transparency:100-100*c}}};E.writeParent=function(c,k){k.parentLayerId=this.parent&&this.parent!==
this.layer?u.ensureInteger(this.parent.id):-1};E.castSublayers=function(c){return u.ensureType(M.ofType(la),c)};E.writeSublayers=function(c,k,w){this.get("sublayers.length")&&(k[w]=this.sublayers.map(I=>I.id).toArray().reverse())};E.readTypeIdField=function(c,k){k=k.layerDefinition||k;if(c=k.typeIdField)if(k=K.getField(k.fields,c))return k.name;return null};E.writeVisible=function(c,k,w,I){k[w]=this.getAtOrigin("defaultVisibility","service")||c};E.clone=function(){const {store:c}=x.getProperties(this),
k=new la;x.getProperties(k).store=c.clone(ha);this.commitProperty("url");k._lastParsedUrl=this._lastParsedUrl;return k};E.createPopupTemplate=function(c){return da.createPopupTemplate(this,c)};E.createQuery=function(){return new oa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};E.createFeatureLayer=async function(){var c,k;if(this.hasOwnProperty("sublayers"))return null;const w=null==(c=this.layer)?void 0:c.parsedUrl;c=new (await new Promise(function(I,V){m(["../FeatureLayer"],function(fa){I(Object.freeze({__proto__:null,
"default":fa}))},V)})).default({url:w.path});w&&this.source&&("map-layer"===this.source.type?c.layerId=this.source.mapLayerId:c.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(c.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(c.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&(c.labelingInfo=B.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(c.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&
(c.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(c.visible=this.visible);0<this.originIdOf("minScale")&&(c.minScale=this.minScale);0<this.originIdOf("maxScale")&&(c.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(c.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(c.popupTemplate=B.clone(this.popupTemplate));2<this.originIdOf("renderer")&&(c.renderer=B.clone(this.renderer));"data-layer"===(null==(k=this.source)?void 0:k.type)&&(c.dynamicDataSource=this.source.clone());
0<this.originIdOf("title")&&(c.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(c.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(c.customParameters=this.layer.customParameters);return c};E.getFeatureType=function(c){const {typeIdField:k,types:w}=this;if(!k||!c)return null;const I=c.attributes?c.attributes[k]:void 0;if(null==I)return null;let V=null;w.some(fa=>{const {id:ja}=fa;if(null==
ja)return!1;ja.toString()===I.toString()&&(V=fa);return!!V});return V};E.getFieldDomain=function(c,k){return(k=this.getFeatureType(k&&k.feature))&&(k=k.domains&&k.domains[c])&&"inherited"!==k.type?k:this._getLayerDomain(c)};E.queryFeatures=function(c=this.createQuery(),k){return this.load().then(()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new d("Sublayer.queryFeatures","this layer doesn't support queries.");return Promise.all([new Promise(function(w,I){m(["../../rest/query/operations/query"],
w,I)}),new Promise(function(w,I){m(["../../tasks/support/FeatureSet"],function(V){w(Object.freeze({__proto__:null,"default":V}))},I)})])}).then(([{executeQuery:w},{default:I}])=>w(this.url,oa.from(c),this.layer?this.layer.spatialReference:null,{...k,query:{...this.layer.customParameters}}).then(V=>I.fromJSON(V.data))).then(w=>{w&&w.features&&w.features.forEach(I=>{I.sourceLayer=this});return w})};E.toExportImageJSON=function(){var c;const k={id:this.id,source:(null==(c=this.source)?void 0:c.toJSON())||
{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(k.definitionExpression=this.definitionExpression);const w=["renderer","labelingInfo","opacity","labelsVisible"].reduce((I,V)=>{I[V]=this.originIdOf(V);return I},{});Object.keys(w).some(I=>2<w[I])&&(c=k.drawingInfo={},2<w.renderer&&(c.renderer=this.renderer?this.renderer.toJSON():null),2<w.labelsVisible&&(c.showLabels=this.labelsVisible),this.labelsVisible&&2<w.labelingInfo&&(c.labelingInfo=this.labelingInfo?this.labelingInfo.map(I=>
I.write({},{origin:"service",layer:this.layer})):null,c.showLabels=!0),2<w.opacity&&(c.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(c.renderer));return k};E._assignDefaultSymbolColors=function(c){this._forEachSimpleMarkerSymbols(c,k=>{k.color||"esriSMSX"!==k.style&&"esriSMSCross"!==k.style||(k.color=k.outline&&k.outline.color?k.outline.color:[0,0,0,0])})};E._forEachSimpleMarkerSymbols=function(c,k){if(c){const w="uniqueValueInfos"in c?c.uniqueValueInfos:"classBreakInfos"in c?
c.classBreakInfos:[];for(const I of w)ma(I.symbol)&&k(I.symbol);"symbol"in c&&ma(c.symbol)&&k(c.symbol);"defaultSymbol"in c&&ma(c.defaultSymbol)&&k(c.defaultSymbol)}};E._setAndNotifyLayer=function(c,k){const w=this.layer,I=this._get(c);let V,fa;switch(c){case "definitionExpression":V="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":V="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":V="supportsDynamicLayers",
fa="supportsModification"}const ja=x.getProperties(this).getDefaultOrigin();if("service"!==ja){if(V&&!1===this.get(`layer.capabilities.exportMap.${V}`)){this._logLockedError(c,`capability not available 'layer.capabilities.exportMap.${V}'`);return}if(fa&&!1===this.get(`capabilities.exportMap.${fa}`)){this._logLockedError(c,`capability not available 'capabilities.exportMap.${fa}'`);return}}"source"===c&&"not-loaded"!==this.loadStatus?this._logLockedError(c,"'source' can't be changed after calling sublayer.load()"):
(this._set(c,k),"service"!==ja&&I!==k&&w&&w.emit&&w.emit("sublayer-update",{propertyName:c,target:this}))};E._handleSublayersChange=function(c,k){k&&(k.forEach(w=>{w.parent=null;w.layer=null}),this.handles.removeAll());c&&(c.forEach(w=>{w.parent=this;w.layer=this.layer}),this.handles.add([c.on("after-add",({item:w})=>{w.parent=this;w.layer=this.layer}),c.on("after-remove",({item:w})=>{w.parent=null;w.layer=null}),c.on("before-changes",w=>{const I=this.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==I||I||(na.error(new d("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),w.preventDefault())})]))};E._logLockedError=function(c,k){na.error(new d("sublayer:locked",`Property '${c}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:k,sublayer:this,layer:this.layer}))};E._getLayerDomain=function(c){return(c=this.fieldsIndex.get(c))?c.domain:null};t._createClass(aa,[{key:"definitionExpression",
set:function(c){this._setAndNotifyLayer("definitionExpression",c)}},{key:"fieldsIndex",get:function(){return new F(this.fields||[])}},{key:"id",get:function(){const c=this._get("id");return null==c?sa++:c},set:function(c){this._get("id")!==c&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",c))}},{key:"labelingInfo",set:function(c){this._setAndNotifyLayer("labelingInfo",
c)}},{key:"labelsVisible",set:function(c){this._setAndNotifyLayer("labelsVisible",c)}},{key:"layer",set:function(c){this._set("layer",c);this.sublayers&&this.sublayers.forEach(k=>k.layer=c)}},{key:"listMode",set:function(c){this._set("listMode",c)}},{key:"minScale",set:function(c){this._setAndNotifyLayer("minScale",c)}},{key:"maxScale",set:function(c){this._setAndNotifyLayer("maxScale",c)}},{key:"opacity",set:function(c){this._setAndNotifyLayer("opacity",c)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"renderer",set:function(c){if(c)for(const k of c.getSymbols())if(b.isSymbol3D(k)){na.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",c)}},{key:"source",get:function(){return this._get("source")||new ca.MapLayerSource({mapLayerId:this.id})},set:function(c){this._setAndNotifyLayer("source",c)}},{key:"sublayers",set:function(c){this._handleSublayersChange(c,this._get("sublayers"));this._set("sublayers",c)}},{key:"url",get:function(){var c,k;const w=null!=
(c=null==(k=this.layer)?void 0:k.parsedUrl)?c:this._lastParsedUrl;c=this.source;if(!w)return null;this._lastParsedUrl=w;if("map-layer"===(null==c?void 0:c.type))return`${w.path}/${c.mapLayerId}`;c={layer:JSON.stringify({source:this.source})};return`${w.path}/dynamicLayer?${h.objectToQuery(c)}`},set:function(c){c?this._override("url",c):this._clearOverride("url")}},{key:"visible",set:function(c){this._setAndNotifyLayer("visible",c)}}]);return aa}(ra.HandleOwnerMixin(Y.MultiOriginJSONMixin(C.IdentifiableMixin(f))));
r.test={isMapImageLayerOverridePolicy:T=>T===ea||T===pa,isTileImageLayerOverridePolicy:T=>T===qa};e.__decorate([v.property({readOnly:!0})],r.prototype,"capabilities",void 0);e.__decorate([L.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],r.prototype,"readCapabilities",null);e.__decorate([v.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:pa}}})],
r.prototype,"definitionExpression",null);e.__decorate([v.property({type:[p],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],r.prototype,"fields",void 0);e.__decorate([v.property({readOnly:!0})],r.prototype,"fieldsIndex",null);e.__decorate([v.property({type:N,json:{read:{source:"layerDefinition.extent"}}})],r.prototype,"fullExtent",void 0);e.__decorate([v.property({type:String})],r.prototype,"globalIdField",void 0);e.__decorate([L.reader("service","globalIdField",["layerDefinition.globalIdField",
"layerDefinition.fields"])],r.prototype,"readGlobalIdFieldFromService",null);e.__decorate([v.property({type:u.Integer,json:{write:{ignoreOrigin:!0}}})],r.prototype,"id",null);e.__decorate([v.property({value:null,type:[U],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ea}}})],r.prototype,"labelingInfo",null);e.__decorate([a.writer("labelingInfo")],r.prototype,"writeLabelingInfo",null);e.__decorate([v.property({type:Boolean,
value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ea}}})],r.prototype,"labelsVisible",null);e.__decorate([v.property({value:null})],r.prototype,"layer",null);e.__decorate([v.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ka}}})],r.prototype,"legendEnabled",void 0);e.__decorate([v.property({type:["show","hide","hide-children"],
value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],r.prototype,"listMode",null);e.__decorate([v.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],r.prototype,"minScale",null);e.__decorate([L.reader("minScale",["minScale","layerDefinition.minScale"])],r.prototype,"readMinScale",null);e.__decorate([v.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],r.prototype,"maxScale",null);e.__decorate([L.reader("maxScale",["maxScale","layerDefinition.maxScale"])],
r.prototype,"readMaxScale",null);e.__decorate([v.property({type:String})],r.prototype,"objectIdField",void 0);e.__decorate([L.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],r.prototype,"readObjectIdFieldFromService",null);e.__decorate([v.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ea}}})],r.prototype,"opacity",null);e.__decorate([L.reader("opacity",["layerDefinition.drawingInfo.transparency",
"layerDefinition.transparency"])],r.prototype,"readOpacity",null);e.__decorate([a.writer("opacity")],r.prototype,"writeOpacity",null);e.__decorate([v.property({json:{type:u.Integer,write:{target:"parentLayerId",allowNull:!0,overridePolicy:ea}}})],r.prototype,"parent",void 0);e.__decorate([a.writer("parent")],r.prototype,"writeParent",null);e.__decorate([v.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(T,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:ka,
writer(T,aa,E){aa[E]=!T}}}})],r.prototype,"popupEnabled",void 0);e.__decorate([v.property({type:G,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ka}}})],r.prototype,"popupTemplate",void 0);e.__decorate([v.property({readOnly:!0})],r.prototype,"defaultPopupTemplate",null);e.__decorate([v.property({types:X.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ea},origins:{"web-scene":{types:X.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",
write:{overridePolicy:ea}}}}})],r.prototype,"renderer",null);e.__decorate([v.property({types:{key:"type",base:null,typeMap:{"data-layer":ia.DataLayerSource,"map-layer":ca.MapLayerSource}},cast(T){if(T){if("mapLayerId"in T)return u.ensureClass(ca.MapLayerSource,T);if("dataSource"in T)return u.ensureClass(ia.DataLayerSource,T)}return T},json:{name:"layerDefinition.source",write:{overridePolicy:ea}}})],r.prototype,"source",null);e.__decorate([v.property()],r.prototype,"sourceJSON",void 0);e.__decorate([v.property({value:null,
json:{type:[u.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ea}}})],r.prototype,"sublayers",null);e.__decorate([z.cast("sublayers")],r.prototype,"castSublayers",null);e.__decorate([a.writer("sublayers")],r.prototype,"writeSublayers",null);e.__decorate([v.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:ka}}})],r.prototype,"title",void 0);e.__decorate([v.property({type:String})],r.prototype,"typeIdField",void 0);e.__decorate([L.reader("typeIdField",
["layerDefinition.typeIdField"])],r.prototype,"readTypeIdField",null);e.__decorate([v.property({type:[ba],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],r.prototype,"types",void 0);e.__decorate([v.property({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:qa}}})],r.prototype,"url",null);e.__decorate([v.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ea}}})],r.prototype,"visible",
null);e.__decorate([a.writer("visible")],r.prototype,"writeVisible",null);return r=la=e.__decorate([O.subclass("esri.layers.support.Sublayer")],r)})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/Collection ../../core/CollectionFlattener ../support/Sublayer ../support/sublayerUtils".split(" "),
function(m,t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W){function N(C,G){const D=[],f={};if(!C)return D;C.forEach(b=>{const g=new y;g.read(b,G);f[g.id]=g;null!=b.parentLayerId&&-1!==b.parentLayerId?(b=f[b.parentLayerId],b.sublayers||(b.sublayers=[]),b.sublayers.unshift(g)):D.unshift(g)});return D}function S(C,G){C&&C.forEach(D=>{G(D);D.sublayers&&D.sublayers.length&&S(D.sublayers,G)})}const M=B.getLogger("esri.layers.TileLayer"),K=h.ofType(y);m.SublayersOwner=C=>{C=function(G){function D(...b){var g=G.call(this,
...b)||this;g.allSublayers=new J({root:t._assertThisInitialized(g),rootCollectionNames:["sublayers"],getChildrenFunction(l){return l.sublayers}});g.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};g.watch("sublayers",(l,q)=>g._handleSublayersChange(l,q),!0);return g}t._inheritsLoose(D,G);var f=D.prototype;f.readSublayers=function(b,g){if(g&&b){var {sublayersSourceJSON:l}=this,q=a.nameToId(g.origin);if(!(2>q||(l[q]={context:g,visibleLayers:b.visibleLayers||l[q].visibleLayers,layers:b.layers||l[q].layers},
2<q))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:A,origin:Q}=this.createSublayersForOrigin("web-document");b=u.getProperties(this);b.setDefaultOrigin(Q);this._set("sublayers",new K(A));b.setDefaultOrigin("user")}}};f.findSublayerById=function(b){return this.allSublayers.find(g=>g.id===b)};f.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};f.createSublayersForOrigin=function(b){const g="web-document"===
b?a.nameToId("web-map"):a.nameToId(b);let l=2;b=this.sublayersSourceJSON[2].layers;let q=this.sublayersSourceJSON[2].context,A=null;var Q=[3,4,5].filter(p=>p<=g);for(var R of Q)Q=this.sublayersSourceJSON[R],W.isSublayerOverhaul(Q.layers)&&(l=R,b=Q.layers,q=Q.context,Q.visibleLayers&&(A={visibleLayers:Q.visibleLayers,context:Q.context}));R=[3,4,5].filter(p=>p>l&&p<=g);let P=null;for(var X of R){const {layers:p,visibleLayers:F,context:U}=this.sublayersSourceJSON[X];p&&(P={layers:p,context:U});F&&(A=
{visibleLayers:F,context:U})}X=N(b,q);const Z=new Map,Y=new Set;if(P)for(const p of P.layers)Z.set(p.id,p);if(A)for(const p of A.visibleLayers)Y.add(p);S(X,p=>{P&&p.read(Z.get(p.id),P.context);A&&p.read({defaultVisibility:Y.has(p.id)},A.context)});return{origin:a.idToName(l),sublayers:new K({items:X})}};f.read=function(b,g){G.prototype.read.call(this,b,g);this.readSublayers(b,g)};f._handleSublayersChange=function(b,g){g&&(g.forEach(l=>{l.parent=null;l.layer=null}),this.handles.remove("sublayers-owner"));
b&&(b.forEach(l=>{l.parent=this;l.layer=this}),this.handles.add([b.on("after-add",({item:l})=>{l.parent=this;l.layer=this}),b.on("after-remove",({item:l})=>{l.parent=null;l.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(b.on("before-changes",l=>{M.error(new H("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));l.preventDefault()}),"sublayers-owner"))};return D}(C);e.__decorate([x.property({readOnly:!0})],
C.prototype,"allSublayers",void 0);e.__decorate([x.property({readOnly:!0,type:h.ofType(y)})],C.prototype,"serviceSublayers",void 0);e.__decorate([x.property({value:null,type:K,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],C.prototype,"sublayers",void 0);e.__decorate([x.property({readOnly:!0})],C.prototype,"sublayersSourceJSON",void 0);return C=e.__decorate([z.subclass("esri.layers.mixins.SublayersOwner")],C)};m.forEachSublayer=S;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],
function(m){function t(e,r){if(!e||!e.length)return!0;r=r.slice().reverse().flatten(({sublayers:u})=>u&&u.toArray().reverse()).map(u=>u.id).toArray();if(e.length>r.length)return!1;let B=0;const n=r.length;for(const {id:u}of e){for(;B<n&&r[B]!==u;)B++;if(B>=n)return!1}return!0}m.isExportDynamic=function(e,r,B){return e.some(n=>{const u=n.source;return!(!u||"map-layer"===u.type&&u.mapLayerId===n.id&&(!u.gdbVersion||u.gdbVersion===B.gdbVersion))||2<n.originIdOf("renderer")||2<n.originIdOf("labelingInfo")||
2<n.originIdOf("opacity")||2<n.originIdOf("labelsVisible")})?!0:!t(e,r)};m.isSublayerOverhaul=function(e){return!!e&&e.some(r=>null!=r.minScale||r.layerDefinition&&null!=r.layerDefinition.minScale)};m.shouldWriteSublayerStructure=function(e,r,B){return r.flatten(({sublayers:n})=>n).length!==e.length||e.some(n=>n.originIdOf("minScale")>B||n.originIdOf("maxScale")>B||n.originIdOf("renderer")>B||n.originIdOf("labelingInfo")>B||n.originIdOf("opacity")>B||n.originIdOf("labelsVisible")>B||n.originIdOf("source")>
B)?!0:!t(e,r)};Object.defineProperty(m,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/SpatialReference ../geometry ../request ./Layer ../core/MultiOriginJSONSupport ./support/arcgisLayerUrl ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ../core/HandleOwner ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./support/Sublayer ./mixins/SublayersOwner".split(" "),function(m,
t,e,r,B,n,u,x,v,z,H,L,O,a,d,h,J,y,W,N,S,M,K,C,G,D,f,b,g,l,q,A,Q,R){const P="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");e=function(X){function Z(...p){p=
X.call(this,...p)||this;p.listMode="show";p.isReference=null;p.operationalLayerType="ArcGISTiledMapServiceLayer";p.resampling=!0;p.sourceJSON=null;p.spatialReference=null;p.path=null;p.sublayers=null;p.type="tile";p.url=null;return p}m._inheritsLoose(Z,X);var Y=Z.prototype;Y.normalizeCtorArgs=function(p,F){return"string"===typeof p?{url:p,...F}:p};Y.load=function(p){const F=r.isSome(p)?p.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},p).then(()=>this._fetchService(F),
()=>this._fetchService(F)));return Promise.resolve(this)};Y.readSpatialReference=function(p,F){return(p=p||F.tileInfo&&F.tileInfo.spatialReference)&&h.fromJSON(p)};Y.writeSublayers=function(p,F,U,ba){if(this.loaded&&p){p=p.slice().reverse().flatten(({sublayers:da})=>da&&da.toArray().reverse()).toArray();var ca=[],ia={writeSublayerStructure:!1,...ba};p.forEach(da=>{da=da.write({},ia);ca.push(da)});ca.some(da=>1<Object.keys(da).length)&&(F.layers=ca)}};Y.castTileServers=function(p){return Array.isArray(p)?
p.map(F=>O.urlToObject(F).path):null};Y.fetchTile=function(p,F,U,ba={}){const {signal:ca,timestamp:ia}=ba;p=this.getTileUrl(p,F,U);F={responseType:"image",signal:ca};null!=ia&&(F.query={_ts:ba.timestamp});return y(p,F).then(da=>da.data)};Y.getTileUrl=function(p,F,U){const ba=O.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters}),ca=this.tileServers;return`${ca&&ca.length?ca[F%ca.length]:this.parsedUrl.path}/tile/${p}/${F}/${U}${ba?
"?"+ba:""}`};Y._fetchService=function(p){return(new Promise((F,U)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new L("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");F({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new L("tile-layer:undefined-url","layer's url is not defined");var ba=S.parse(this.parsedUrl.path);if(r.isSome(ba)&&"ImageServer"===ba.serverType)throw new L("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
y(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},responseType:"json",signal:p}).then(F,U)}})).then(F=>{F.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=F.data;this.read(F.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!S.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,p).then(U=>{this.read({currentVersion:U})}).catch(()=>{})})};Y._fetchServerVersion=function(p,F){if(!S.isArcGISUrl(p))return Promise.reject();
p=p.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return y(p,{query:{f:"json",...this.customParameters},responseType:"json",signal:F}).then(U=>{if(U.data&&U.data.currentVersion)return U.data.currentVersion;throw new L("tile-layer:version-not-available");})};Y._getMapName=function(p){return(p=p.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&p[2]};Y._getDefaultAttribution=function(p){if(p){p=
p.toLowerCase();for(let U=0,ba=P.length;U<ba;U++){var F=P[U];if(-1<F.toLowerCase().indexOf(p))return O.makeAbsolute("//static.arcgis.com/attribution/"+F)}}};Y._getDefaultTileServers=function(p){const F=-1!==p.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),U=-1!==p.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return F||U?[p,p.replace(F?/server\.arcgisonline/i:/services\.arcgisonline/i,F?"services.arcgisonline":"server.arcgisonline")]:[]};m._createClass(Z,[{key:"attributionDataUrl",
get:function(){var p;const F=null==(p=this.parsedUrl)?void 0:p.path.toLowerCase();return F&&this._getDefaultAttribution(this._getMapName(F))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}}]);return Z}(G.BlendLayer(R.SublayersOwner(g.ScaleRangeLayer(b.RefreshableLayer(K.OperationalLayer(f.PortalLayer(q.ArcGISCachedService(A.ArcGISMapService(C.ArcGISService(N.MultiOriginJSONMixin(l.HandleOwnerMixin(D.CustomParametersMixin(W)))))))))))));t.__decorate([n.property({readOnly:!0})],
e.prototype,"attributionDataUrl",null);t.__decorate([n.property({type:["show","hide","hide-children"]})],e.prototype,"listMode",void 0);t.__decorate([n.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);t.__decorate([n.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],e.prototype,"operationalLayerType",void 0);t.__decorate([n.property({type:Boolean})],e.prototype,"resampling",void 0);t.__decorate([n.property()],
e.prototype,"sourceJSON",void 0);t.__decorate([n.property({type:h})],e.prototype,"spatialReference",void 0);t.__decorate([v.reader("spatialReference",["spatialReference","tileInfo"])],e.prototype,"readSpatialReference",null);t.__decorate([n.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],e.prototype,"path",void 0);t.__decorate([n.property({readOnly:!0})],e.prototype,"sublayers",void 0);t.__decorate([H.writer("sublayers",{layers:{type:[Q]}})],e.prototype,"writeSublayers",
null);t.__decorate([n.property({json:{read:!1,write:!1}})],e.prototype,"popupEnabled",void 0);t.__decorate([n.property()],e.prototype,"tileServers",null);t.__decorate([u.cast("tileServers")],e.prototype,"castTileServers",null);t.__decorate([n.property({readOnly:!0,json:{read:!1}})],e.prototype,"type",void 0);t.__decorate([n.property(M.url)],e.prototype,"url",void 0);return e=t.__decorate([z.subclass("esri.layers.TileLayer")],e)});