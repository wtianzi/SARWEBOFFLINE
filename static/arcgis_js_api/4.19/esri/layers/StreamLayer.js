// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/extensions/serializableProperty/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/SpatialReference ../geometry/Extent ../geometry ./support/fieldUtils ../PopupTemplate ../request ../symbols ./Layer ../renderers/Renderer ../renderers/ClassBreaksRenderer ../renderers/UniqueValueRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/SimpleRenderer ../renderers/support/types ../renderers/support/jsonUtils ../core/MultiOriginJSONSupport ../symbols/support/ElevationInfo ./support/commonProperties ./mixins/OperationalLayer ./support/Field ./support/FieldsIndex ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/LabelClass ./support/featureReductionUtils ./support/labelingInfo ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query ./support/PurgeOptions".split(" "),
function(v,c,C,w,D,E,x,e,F,n,G,H,p,l,fa,ha,ia,y,I,ja,q,J,K,L,b,ka,la,M,ma,na,oa,N,z,r,O,P,k,Q,R,S,T,U,V,W,X,Y,Z,t,aa,ba,ca,da,A){const ea=E.getLogger("esri.layers.StreamLayer");w=new F.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"});b=function(B){function m(...a){a=B.call(this,...a)||this;a.copyright=null;a.definitionExpression=null;a.displayField=null;a.elevationInfo=null;a.featureReduction=null;a.fields=null;
a.geometryDefinition=null;a.geometryType=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.maxReconnectionAttempts=0;a.maxReconnectionInterval=20;a.maxScale=0;a.minScale=0;a.objectIdField=null;a.operationalLayerType="ArcGISStreamLayer";a.popupEnabled=!0;a.popupTemplate=null;a.purgeOptions=new A;a.screenSizePerspectiveEnabled=!0;a.sourceJSON=null;a.spatialReference=y.WGS84;a.type="stream";a.url=null;a.updateInterval=300;a.webSocketUrl=null;return a}v._inheritsLoose(m,B);var g=m.prototype;
g.normalizeCtorArgs=function(a,d){return"string"===typeof a?{url:a,...d}:a};g.load=function(a){if(!("WebSocket"in C))return this.addResolvingPromise(Promise.reject(new l("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const d=D.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service"]},a).catch(f=>f).then(()=>this._fetchService(d)));
return Promise.resolve(this)};g.readFeatureReduction=function(a,d){return t.read(a,d)};g.writeWebSceneFeatureReduction=function(a,d,f,h){t.writeTarget(a,d,"layerDefinition.featureReduction",h)};g.readRenderer=function(a,d,f){d=d.layerDefinition||d;if(a=d.drawingInfo&&d.drawingInfo.renderer||void 0)return(a=r.read(a,d,f)||void 0)||ea.error("Failed to create renderer",{rendererDefinition:d.drawingInfo.renderer,layer:this,context:f}),a;if(d.defaultSymbol)return d.types&&d.types.length?new M({defaultSymbol:u(d.defaultSymbol,
d,f),field:d.typeIdField,uniqueValueInfos:d.types.map(h=>({id:h.id,symbol:u(h.symbol,h,f)}))}):new N({symbol:u(d.defaultSymbol,d,f)})};g.writeRenderer=function(a,d,f,h){r.write(a,d,f,h)};g.writeWebSceneRenderer=function(a,d,f,h){r.write(a,d,"layerDefinition.drawingInfo.renderer",h)};g.createPopupTemplate=function(a){return ca.createPopupTemplate(this,a)};g.createQuery=function(){const a=new da;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};g.getFieldDomain=
function(a,d){if(!this.fields)return null;let f=null;this.fields.some(h=>{h.name===a&&(f=h.domain);return!!f});return f};g.getField=function(a){return this.fieldsIndex.get(a)};g._fetchService=async function(a){var d;if(this.webSocketUrl){var f;if(null==(f=this.timeInfo)||!f.trackIdField)throw new l("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField)throw new l("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");
if(!this.fields)throw new l("stream-layer:missing-metadata","The stream layer fields must be specified.");if(!this.geometryType)throw new l("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.url=this.webSocketUrl}else this.sourceJSON||({data:a}=await K(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:a}),this.sourceJSON=a);this.sourceJSON={...null!=(d=this.sourceJSON)?d:{},objectIdField:"__esri_stream_id__"};this.read(this.sourceJSON,
{origin:"service",url:this.parsedUrl});q.fixRendererFields(this.renderer,this.fields);q.fixTimeInfoFields(this.timeInfo,this.fields);return ba.loadStyleRenderer(this,{origin:"service"})};v._createClass(m,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"fieldsIndex",get:function(){return new S(this.fields)}},{key:"renderer",set:function(a){q.fixRendererFields(a,this.fields);this._set("renderer",a)}}]);return m}(U.BlendLayer(Y.TemporalLayer(X.ScaleRangeLayer(W.RefreshableLayer(T.ArcGISService(Q.OperationalLayer(V.PortalLayer(O.MultiOriginJSONMixin(b)))))))));
c.__decorate([e.property({type:String})],b.prototype,"copyright",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);c.__decorate([e.property({type:String,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],b.prototype,"definitionExpression",void 0);c.__decorate([e.property({type:String})],b.prototype,"displayField",void 0);c.__decorate([e.property({type:P})],b.prototype,"elevationInfo",void 0);
c.__decorate([n.reader("featureReduction",["layerDefinition.featureReduction"])],b.prototype,"readFeatureReduction",null);c.__decorate([p.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:t.webSceneFeatureReductionTypes}})],b.prototype,"writeWebSceneFeatureReduction",null);c.__decorate([e.property({type:[R]})],b.prototype,"fields",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"fieldsIndex",null);c.__decorate([e.property({type:I})],b.prototype,"geometryDefinition",
void 0);c.__decorate([e.property({type:["point","polygon","polyline","multipoint"],json:{read:{reader:w.read}}})],b.prototype,"geometryType",void 0);c.__decorate([e.property(k.labelsVisible)],b.prototype,"labelsVisible",void 0);c.__decorate([e.property({type:[Z],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:aa.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);c.__decorate([e.property(k.legendEnabled)],b.prototype,"legendEnabled",
void 0);c.__decorate([e.property({type:["show","hide"]})],b.prototype,"listMode",void 0);c.__decorate([e.property({type:x.Integer})],b.prototype,"maxReconnectionAttempts",void 0);c.__decorate([e.property({type:x.Integer})],b.prototype,"maxReconnectionInterval",void 0);c.__decorate([e.property(k.maxScale)],b.prototype,"maxScale",void 0);c.__decorate([e.property(k.minScale)],b.prototype,"minScale",void 0);c.__decorate([e.property({type:String})],b.prototype,"objectIdField",void 0);c.__decorate([e.property({value:"ArcGISStreamLayer",
type:["ArcGISStreamLayer"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([e.property(k.popupEnabled)],b.prototype,"popupEnabled",void 0);c.__decorate([e.property({type:J,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],b.prototype,"popupTemplate",void 0);c.__decorate([e.property({type:A})],b.prototype,"purgeOptions",void 0);c.__decorate([e.property({types:z.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],
b.prototype,"renderer",null);c.__decorate([n.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),n.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],b.prototype,"readRenderer",null);c.__decorate([p.writer("renderer")],b.prototype,"writeRenderer",null);c.__decorate([p.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:z.webSceneRendererTypes}})],b.prototype,"writeWebSceneRenderer",null);c.__decorate([e.property(k.screenSizePerspectiveEnabled)],
b.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([e.property({type:y,json:{origins:{service:{read:{source:"spatialReference"}}}}})],b.prototype,"spatialReference",void 0);c.__decorate([e.property({json:{read:!1}})],b.prototype,"type",void 0);c.__decorate([e.property(k.url)],b.prototype,"url",void 0);c.__decorate([e.property({type:Number})],b.prototype,"updateInterval",void 0);c.__decorate([e.property({type:String})],b.prototype,"webSocketUrl",void 0);b=c.__decorate([H.subclass("esri.layers.StreamLayer")],
b);const u=G.createTypeReader({types:L.symbolTypesRenderer});return b});