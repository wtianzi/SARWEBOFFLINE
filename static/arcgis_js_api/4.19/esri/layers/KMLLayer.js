// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/SpatialReference ../geometry/Extent ../geometry ../core/Collection ../core/CollectionFlattener ./Layer ../core/MultiOriginJSONSupport ./support/commonProperties ./mixins/OperationalLayer ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/kmlUtils ./support/KMLSublayer".split(" "),
function(l,d,c,t,J,K,g,L,p,u,v,w,M,N,q,x,O,y,z,A,B,C,D,E,F,G,H,m,r){const I=["kml","xml"];c=function(n){function k(...a){a=n.call(this,...a)||this;a._visibleFolders=[];a.allSublayers=new z({root:l._assertThisInitialized(a),rootCollectionNames:["sublayers"],getChildrenFunction(b){return b.sublayers}});a.outSpatialReference=q.WGS84;a.path=null;a.legendEnabled=!1;a.operationalLayerType="KML";a.sublayers=null;a.type="kml";a.url=null;return a}l._inheritsLoose(k,n);var h=k.prototype;h.initialize=function(){this.watch("sublayers",
(a,b)=>{b&&b.forEach(e=>{e.parent=null;e.layer=null});a&&a.forEach(e=>{e.parent=this;e.layer=this})},!0);this.on("sublayer-update",()=>this.notifyChange("fullExtent"))};h.normalizeCtorArgs=function(a,b){return"string"===typeof a?{url:a,...b}:a};h.readSublayersFromItemOrWebMap=function(a,b){this._visibleFolders=b.visibleFolders};h.readSublayers=function(a,b,e){return m.sublayersFromJSON(r,b,e,this._visibleFolders)};h.writeSublayers=function(a,b){const e=[];for(a=a.toArray();a.length;){const f=a[0];
f.networkLink||(f.visible&&e.push(f.id),f.sublayers&&a.push(...f.sublayers.toArray()));a.shift()}b.visibleFolders=e};h.load=function(a){const b=t.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"]},a).then(()=>this._fetchService(b)));return Promise.resolve(this)};h.destroy=function(){n.prototype.destroy.call(this);this.allSublayers.destroy()};h._fetchService=async function(a){var b=await Promise.resolve().then(()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:
m.fetchService(this.url,this.outSpatialReference,this.refreshInterval,a));(b=m.parseKML(b.data))&&this.read(b,{origin:"service"})};h._recomputeFullExtent=function(){let a=null;this.extent&&(a=this.extent.clone());const b=e=>{if(e.sublayers)for(const f of e.sublayers.items)b(f),f.visible&&f.fullExtent&&(a?a.union(f.fullExtent):a=f.fullExtent.clone())};b(this);return a};l._createClass(k,[{key:"title",get:function(){const a=this._get("title");return a&&"defaults"!==this.originOf("title")?a:this.url?
w.getFilename(this.url,I)||"KML":a||""},set:function(a){this._set("title",a)}},{key:"visibleSublayers",get:function(){const a=this.sublayers,b=[],e=f=>{f.visible&&(b.push(f),f.sublayers&&f.sublayers.forEach(e))};a&&a.forEach(e);return b}},{key:"fullExtent",get:function(){return this._recomputeFullExtent()}}]);return k}(E.BlendLayer(G.RefreshableLayer(H.ScaleRangeLayer(D.OperationalLayer(F.PortalLayer(B.MultiOriginJSONMixin(A)))))));d.__decorate([g.property({readOnly:!0})],c.prototype,"allSublayers",
void 0);d.__decorate([g.property({type:q})],c.prototype,"outSpatialReference",void 0);d.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);d.__decorate([g.property({readOnly:!0,json:{read:!1,write:!1}})],c.prototype,"legendEnabled",void 0);d.__decorate([g.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);d.__decorate([g.property({type:["KML"]})],c.prototype,"operationalLayerType",void 0);d.__decorate([g.property({})],
c.prototype,"resourceInfo",void 0);d.__decorate([g.property({type:y.ofType(r),json:{write:{ignoreOrigin:!0}}})],c.prototype,"sublayers",void 0);d.__decorate([p.reader(["web-map","portal-item"],"sublayers",["visibleFolders"])],c.prototype,"readSublayersFromItemOrWebMap",null);d.__decorate([p.reader("service","sublayers",["sublayers"])],c.prototype,"readSublayers",null);d.__decorate([v.writer("sublayers")],c.prototype,"writeSublayers",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],c.prototype,
"type",void 0);d.__decorate([g.property({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],c.prototype,"title",null);d.__decorate([g.property(C.url)],c.prototype,"url",void 0);d.__decorate([g.property({readOnly:!0})],c.prototype,"visibleSublayers",null);d.__decorate([g.property({type:x})],c.prototype,"extent",void 0);d.__decorate([g.property()],c.prototype,"fullExtent",null);return c=d.__decorate([u.subclass("esri.layers.KMLLayer")],c)});