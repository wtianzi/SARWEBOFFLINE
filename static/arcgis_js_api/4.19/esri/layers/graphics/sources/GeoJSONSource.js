// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/typeUtils ../../../geometry ../../../core/Loadable ../../../core/workers/workers ../../../tasks/support/FeatureSet ../../support/TimeInfo ../data/QueryEngineCapabilities".split(" "),
function(e,y,g,z,t,A,J,h,K,B,u,L,M,N,v,C,D,O,E,F,G,H,I){const w=A.getLogger("esri.layers.graphics.sources.GeoJSONSource");e.GeoJSONSource=function(x){function p(){var a=x.apply(this,arguments)||this;a.type="geojson";a.fullExtent=null;a.timeInfo=null;return a}y._inheritsLoose(p,x);var d=p.prototype;d.load=function(a){a=t.isSome(a)?a.signal:null;this.addResolvingPromise(this._startWorker(a));return Promise.resolve(this)};d.destroy=function(){var a;null==(a=this._connection)?void 0:a.close();this._connection=
null};d.applyEdits=function(a){return this.load().then(()=>this._applyEdits(a))};d.openPorts=function(){return this.load().then(()=>this._connection.openPorts())};d.queryFeatures=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryFeatures",a?a.toJSON():null,b)).then(f=>G.fromJSON(f))};d.queryFeaturesJSON=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryFeatures",a?a.toJSON():null,b))};d.queryFeatureCount=function(a,b={}){return this.load(b).then(()=>
this._connection.invoke("queryFeatureCount",a?a.toJSON():null,b))};d.queryObjectIds=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryObjectIds",a?a.toJSON():null,b))};d.queryExtent=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryExtent",a?a.toJSON():null,b)).then(f=>({count:f.count,extent:v.fromJSON(f.extent)}))};d.querySnapping=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("querySnapping",a,b))};d._applyEdits=function(a){if(!this._connection)throw new u("geojson-layer-source:edit-failure",
"Memory source not loaded");const b=this.layer.objectIdField,f=[],k=[],l=[];if(a.addFeatures)for(const c of a.addFeatures)f.push(this._serializeFeature(c));if(a.deleteFeatures)for(const c of a.deleteFeatures)"objectId"in c&&null!=c.objectId?k.push(c.objectId):"attributes"in c&&null!=c.attributes[b]&&k.push(c.attributes[b]);if(a.updateFeatures)for(const c of a.updateFeatures)l.push(this._serializeFeature(c));return this._connection.invoke("applyEdits",{adds:f,updates:l,deletes:k}).then(({fullExtent:c,
timeExtent:q,featureEditResults:m})=>{this.fullExtent=c;this.timeInfo&&(c=this.timeInfo.clone(),c.read({timeExtent:q}),this.timeInfo=c);return this._createEditsResult(m)})};d._createEditsResult=function(a){return{addFeatureResults:a.addResults?a.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:a.updateResults?a.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:a.deleteResults?a.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],
updateAttachmentResults:[],deleteAttachmentResults:[]}};d._createFeatureEditResult=function(a){const b=!0===a.success?null:a.error||{code:void 0,description:void 0};return{objectId:a.objectId,globalId:a.globalId,error:b?new u("geojson-layer-source:edit-failure",b.description,{code:b.code}):null}};d._serializeFeature=function(a){const {attributes:b}=a;return(a=this._geometryForSerialization(a))?{geometry:a.toJSON(),attributes:b}:{attributes:b}};d._geometryForSerialization=function(a){({geometry:a}=
a);return t.isNone(a)?null:"mesh"===a.type||"extent"===a.type?C.fromExtent(a.extent):a};d._startWorker=async function(a){this._connection=await F.open("GeoJSONSourceWorker",{strategy:z("feature-layers-workers")?"dedicated":"local",signal:a});const {fields:b,spatialReference:f,hasZ:k,geometryType:l,objectIdField:c,url:q,timeInfo:m}=this.layer;var r="defaults"===this.layer.originOf("spatialReference");r={url:q,fields:b&&b.map(n=>n.toJSON()),geometryType:D.typeKebabDictionary.toJSON(l),hasZ:k,objectIdField:c,
timeInfo:m?m.toJSON():null,spatialReference:r?null:f&&f.toJSON()};a=await this._connection.invoke("load",r,{signal:a});for(const n of a.warnings)w.warn(n.message,{layer:this.layer,warning:n});a.featureErrors.length&&w.warn(`Encountered ${a.featureErrors.length} validation errors while loading features`,a.featureErrors);this.fullExtent=v.fromJSON(a.layerDefinition.extent);this.timeInfo=H.fromJSON(a.layerDefinition.timeInfo);this.sourceJSON=a.layerDefinition;this.capabilities={attachment:null,data:{isVersioned:!1,
supportsAttachment:!1,supportsM:!1,supportsZ:a.layerDefinition.hasZ},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!0,supportsDelete:!0,supportsEditing:!0,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!0,supportsExceedsLimitStatistics:!0},query:I.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0},
editing:{supportsGeometryUpdate:!0,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}};return p}(E);g.__decorate([h.property()],e.GeoJSONSource.prototype,"capabilities",void 0);g.__decorate([h.property()],e.GeoJSONSource.prototype,"type",void 0);g.__decorate([h.property()],e.GeoJSONSource.prototype,"fullExtent",void 0);g.__decorate([h.property({constructOnly:!0})],
e.GeoJSONSource.prototype,"layer",void 0);g.__decorate([h.property()],e.GeoJSONSource.prototype,"sourceJSON",void 0);g.__decorate([h.property()],e.GeoJSONSource.prototype,"timeInfo",void 0);e.GeoJSONSource=g.__decorate([B.subclass("esri.layers.graphics.sources.GeoJSONSource")],e.GeoJSONSource);e.default=e.GeoJSONSource;Object.defineProperty(e,"__esModule",{value:!0})});