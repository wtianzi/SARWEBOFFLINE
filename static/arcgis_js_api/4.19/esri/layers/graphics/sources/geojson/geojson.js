// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Error","../../OptimizedFeature","../../OptimizedGeometry"],function(u,w,G,H){function I(a){const b=[];a.forEach(c=>b.push(c));return b}function*A(a){switch(a.type){case "Feature":yield a;break;case "FeatureCollection":for(const b of a.features)b&&(yield b)}}function*J(a){if(!a)return null;switch(a.type){case "Point":yield a.coordinates;break;case "LineString":case "MultiPoint":yield*a.coordinates;break;case "MultiLineString":case "Polygon":for(const b of a.coordinates)yield*b;
break;case "MultiPolygon":for(const b of a.coordinates)for(const c of b)yield*c}}function*K(a,b={}){const {geometryType:c,objectIdFieldName:d}=b;for(;;){const {value:e,done:h}=a.next();if(h)break;const {geometry:k,properties:f,id:q}=e;if(k&&x[k.type]!==c)continue;const l=f||{};d&&null!=q&&!l[d]&&(l[d]=q);yield new G(k?L(new H,k,b):null,l)}}function M(a){for(;;){const {value:b,done:c}=a.next();if(c)return!1;if(2<b.length)return!0}}function B(a){let b=0;for(let c=0;c<a.length;c++){const d=a[c],e=a[(c+
1)%a.length];b+=d[0]*e[1]-e[0]*d[1]}return 0>=b}function C(a){const b=a[0],c=a[a.length-1];b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]||a.push(b);return a}function L(a,b,c){switch(b.type){case "LineString":return t(a,b.coordinates,c),a;case "MultiLineString":for(const e of b.coordinates)t(a,e,c);return a;case "MultiPoint":return t(a,b.coordinates,c),a;case "MultiPolygon":for(var d of b.coordinates)for(D(a,d[0],c),b=1;b<d.length;b++)E(a,d[b],c);return a;case "Point":return y(a,b.coordinates,c),a;case "Polygon":d=
b.coordinates;D(a,d[0],c);for(b=1;b<d.length;b++)E(a,d[b],c);return a}}function D(a,b,c){b=C(b);B(b)?t(a,b,c):F(a,b,c)}function E(a,b,c){b=C(b);B(b)?F(a,b,c):t(a,b,c)}function t(a,b,c){for(const d of b)y(a,d,c);a.lengths.push(b.length)}function F(a,b,c){for(let d=b.length-1;0<=d;d--)y(a,b[d],c);a.lengths.push(b.length)}function y(a,b,c){const [d,e,h]=b;a.coords.push(d,e);c.hasZ&&a.coords.push(h||0)}const x={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",
Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};u.createOptimizedFeatures=function(a,b){a:for(a=K(A(a),b),b=[];;){const {value:c,done:d}=a.next();if(d){a=b;break a}b.push(c)}return a};u.inferLayerProperties=function(a,b={}){const c=A(a);a=[];const d=new Set,e=new Set;var h=!1;let k=Number.NEGATIVE_INFINITY,f=null,q=!1,l=void 0;({geometryType:b=null}=b);for(var z=!1;;){const {value:N,done:O}=c.next();if(O){var g=f&&1===f.length&&f[0]||null;if(g)for(const r of a)r.name===
g&&(r.type="esriFieldTypeOID");return{fields:a,geometryType:b,hasZ:h,maxObjectId:Math.max(0,k),objectIdFieldName:g,objectIdFieldType:l,unknownFields:I(e)}}const {geometry:v,properties:m,id:n}=N;if(v&&(b||(b=x[v.type]),x[v.type]!==b))continue;h||(h=J(v),h=M(h));!q&&(q=null!=n)&&(l=typeof n,"number"===l&&(f=Object.keys(m).filter(r=>m[r]===n)));q&&"number"===l&&null!=n&&(k=Math.max(k,n),1<f.length?f=f.filter(r=>m[r]===n):1===f.length&&(f=m[f[0]]===n?f:[]));if(!z&&m)for(g in z=!0,m)if(!d.has(g)){var p=
m[g];if(null==p)z=!1,e.add(g);else{a:switch(typeof p){case "string":p="esriFieldTypeString";break a;case "number":p="esriFieldTypeDouble";break a;default:p="unknown"}"unknown"===p?e.add(g):(e.delete(g),d.add(g),a.push({name:g,alias:g,type:p}))}}}};u.validateGeoJSON=function(a){if(!a)throw new w("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==a.type&&"FeatureCollection"!==a.type)throw new w("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:a});
({crs:a}=a);if(a){var b="string"===typeof a?a:"name"===a.type?a.properties.name:null,c=/.*(CRS84H?|4326)$/i;if(!b||!c.test(b))throw new w("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:a});}};Object.defineProperty(u,"__esModule",{value:!0})});