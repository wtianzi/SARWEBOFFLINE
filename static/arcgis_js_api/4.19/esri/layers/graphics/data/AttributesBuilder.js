// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["../../../core/maybe","./attributeSupport"],function(l,g){return function(){function h(b,a,c){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=b.returnDistinctValues;this.fieldsIndex=c;this.featureAdapter=a;if((a=b.outFields)&&-1===a.indexOf("*")){this.outFields=a;b=0;for(const e of a){var d=g.getExpressionFromFieldName(e);d=(a=this.fieldsIndex.get(d))?null:g.getWhereClause(d,c);a=a?a.name:g.getAliasFromFieldName(e)||`FIELD_EXP_${b++}`;this._fieldDataCache.set(e,
{alias:a,clause:d})}}}var f=h.prototype;f.countDistinctValues=function(b){if(!this.returnDistinctValues)return b.length;b.forEach(a=>this.getAttributes(a));return this._returnDistinctMap.size};f.getAttributes=function(b){b=this._processAttributesForOutFields(b);return this._processAttributesForDistinctValues(b)};f.getFieldValue=function(b,a,c){const d=c?c.name:a;let e=null;this._fieldDataCache.has(d)?e=this._fieldDataCache.get(d).clause:c||(e=g.getWhereClause(a,this.fieldsIndex),this._fieldDataCache.set(d,
{alias:d,clause:e}));return c?this.featureAdapter.getAttribute(b,d):e.calculateValue(b,this.featureAdapter)};f.validateItem=function(b,a){this._fieldDataCache.has(a)||this._fieldDataCache.set(a,{alias:a,clause:g.getWhereClause(a,this.fieldsIndex)});return this._fieldDataCache.get(a).clause.testFeature(b,this.featureAdapter)};f.validateItems=function(b,a){this._fieldDataCache.has(a)||this._fieldDataCache.set(a,{alias:a,clause:g.getWhereClause(a,this.fieldsIndex)});return this._fieldDataCache.get(a).clause.testSet(b,
this.featureAdapter)};f._processAttributesForOutFields=function(b){const a=this.outFields;if(!a||!a.length)return this.featureAdapter.getAttributes(b);const c={};for(const d of a){const {alias:e,clause:k}=this._fieldDataCache.get(d);c[e]=k?k.calculateValue(b,this.featureAdapter):this.featureAdapter.getAttribute(b,e)}return c};f._processAttributesForDistinctValues=function(b){if(l.isNone(b)||!this.returnDistinctValues)return b;var a=this.outFields,c=[];if(a)for(const e of a){var {alias:d}=this._fieldDataCache.get(e);
c.push(b[d])}else for(d in b)c.push(b[d]);a=`${(a||["*"]).join(",")}=${c.join(",")}`;c=this._returnDistinctMap.get(a)||0;this._returnDistinctMap.set(a,++c);return 1<c?null:b};return h}()});