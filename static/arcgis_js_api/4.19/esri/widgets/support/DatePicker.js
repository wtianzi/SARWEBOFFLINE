// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/aliasOf ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/events ../../intl/date ../../intl ../../intl/moment ./widgetUtils ./decorators/accessibleHandler ./decorators/messageBundle ../../chunks/index ../Widget ./Popover ./DatePickerViewModel ./datePickerUtils".split(" "),
function(t,k,h,G,S,r,H,T,I,U,V,W,x,l,X,J,u,n,K,f,L,M,y,N){const p={year:"numeric",month:"2-digit",day:"2-digit"},O=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),P=G.getLogger("esri.widgets.support.DatePicker"),z="onfocusout"in HTMLElement.prototype,Q="formatToParts"in Intl.DateTimeFormat.prototype;h=function(A){function v(a,c){var b=A.call(this,a,c)||this;b._activeDate=null;b._calendarNode=null;b._calendarPopover=new M({owner:t._assertThisInitialized(b),placement:"bottom-start",
anchorElement:()=>b._rootNode,renderContentFunction:b._renderCalendar});b._closedByUserAction=!1;b._isOpen=!1;b._requestDayPickerFocusOnCreate=!1;b._rootNode=null;b.dateInputEnabled=!1;b.label=void 0;b.messages=null;b.value=null;b.commitOnMonthChange=!1;b.viewModel=new y;b._handleDatePickerBlur=z?null:b._handleDatePickerBlurOrFocusOut;b._handleDatePickerFocusOut=z?b._handleDatePickerBlurOrFocusOut:null;b._toggle=b._toggle.bind(t._assertThisInitialized(b));return b}t._inheritsLoose(v,A);var d=v.prototype;
d.loadLocale=async function(){this._moment=await J.loadMoment();this._isOpen&&(this._activeDate=this._moment(this._activeDate.toDate()))};d.destroy=function(){this._calendarPopover.destroy()};d.render=function(){return f.jsx("div",{afterCreate:u.storeNode,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},Q&&this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())};d.renderButtonOnlyMode=function(){const a=l.formatDate(this.viewModel.value,
p),{_isOpen:c,messages:b}=this;return f.jsx("div",{afterUpdate:this._focusSelectedOrClosed,"aria-controls":c?this._getCalendarId():null,"aria-expanded":c.toString(),"aria-haspopup":"true","aria-label":b.setDate,"aria-pressed":c.toString(),class:this.classes("esri-widget--button","esri-select","esri-date-picker__calendar-toggle"),onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0},f.jsx("span",{class:"esri-date-picker__date"},a))};d.renderInputAndButtonMode=function(){const a=l.formatDate(this.viewModel.value,
p),{_isOpen:c,messages:b}=this;return f.jsx("div",{class:this.classes("esri-date-picker__input")},f.jsx("input",{"aria-controls":c?this._getCalendarId():null,"aria-haspopup":"true","aria-label":b.setDate,bind:this,class:this.classes("esri-date-picker__text-input","esri-input"),key:"date-input",onblur:this._handleDateInputBlur,onfocus:this._handleDateInputFocus,onkeydown:this._handleDateInputKeyDown,type:"text",value:a}),f.jsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading",
"esri-icon-calendar")}))};d._handleDateInputKeyDown=function(a){"Enter"===a.key&&this._handleDateText(a)};d._handleDateInputBlur=function(a){this._handleDatePickerBlurOrFocusOut(a);this._isOpen||this._handleDateText(a)};d._handleDateInputFocus=function(){this._open(this.viewModel.value,!1)};d._handleDateText=function(a){a=a.currentTarget;try{var c=N.parseDateIntoParts(a.value,p)}catch(b){P.warn(b);a.value=l.formatDate(this.viewModel.value,p);return}c=this._moment(c);c.isValid()?(this.viewModel.value=
c.toDate(),this._activeDate=c):a.value=l.formatDate(this.viewModel.value,p)};d._focusSelectedOrClosed=function(a){this._closedByUserAction&&(this._closedByUserAction=!1,a.focus())};d._handleDatePickerKeydown=function(a){"Escape"===x.eventKey(a)&&(this._closedByUserAction=!0,this._close(),a.preventDefault(),a.stopPropagation())};d._renderCalendar=function(){const a=this._activeDate,c=this._moment(this.viewModel.value);return f.jsx("div",{afterCreate:u.storeNode,bind:this,class:this.classes("esri-date-picker__calendar",
"esri-widget"),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(a),this._renderDayPicker(a,c),this._renderYearPicker(a))};d._getCalendarId=function(){return`date-picker__calendar--${this.id}`};d._handleDatePickerBlurOrFocusOut=function(a){a.currentTarget===a.target&&(a=a.relatedTarget,this._calendarNode.contains(a)||this._rootNode.contains(a)||this._close())};d._renderMonthPicker=function(a){var c=
u.isRTL();const b=c?"esri-icon-right":"esri-icon-left";c=c?"esri-icon-left":"esri-icon-right";const g=this._moment.months().map((m,q)=>{q=a.month()===q;return f.jsx("option",{selected:q},m)}),{messages:e}=this;return f.jsx("div",{class:"esri-date-picker__month-picker"},f.jsx("div",{"aria-label":e.goToPreviousMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,onclick:this._setPreviousMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousMonth,role:"button",
tabIndex:0,title:e.goToPreviousMonth},f.jsx("span",{"aria-hidden":"true",class:b})),f.jsx("select",{"aria-live":"assertive","aria-label":e.selectMonth,bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),id:`${this.id}__month-picker`,onblur:this._handleDatePickerBlur,onchange:this._setMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setMonth,title:e.selectMonth},g),f.jsx("div",{"aria-label":e.goToNextMonth,bind:this,class:"esri-widget--button",onblur:this._handleDatePickerBlur,
onclick:this._setNextMonth,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:e.goToNextMonth},f.jsx("span",{"aria-hidden":"true",class:c})))};d._renderDayPicker=function(a,c){var b=a.clone().day(this._moment.localeData().firstDayOfWeek());b=this._getWeekLabels(b);const g=this._getDayId(a);a=this._renderMonth(a,c);return f.jsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":g,"aria-labelledby":`${this.id}__month-picker ${this.id}__selected-year`,
bind:this,class:"esri-date-picker__day-picker",id:`${this.id}__day-picker`,onblur:this._handleDatePickerBlur,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},f.jsx("div",{class:"esri-date-picker__week-item",role:"row"},b.map(e=>f.jsx("div",{"aria-label":e.name,class:this.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:e.name},e.abbr))),a)};d._getDayId=function(a){return`${this.id}__${l.formatDate(a.valueOf(),
p)}`};d._handleDayPickerCreate=function(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())};d._getWeekLabels=function(a){const c=[],b={weekday:"long"},g={weekday:"narrow"};for(let e=0;7>e;e++)c.push({name:l.formatDate(a.valueOf(),b),abbr:l.formatDate(a.valueOf(),g)}),a.add(1,"day");return c};d._handleDayPickerKeydown=function(a){const {ctrlKey:c,shiftKey:b}=a,g=x.eventKey(a),e=this._activeDate;if(-1!==O.indexOf(g)){if("ArrowLeft"===g)e.subtract(1,"day");else if("ArrowRight"===
g)e.add(1,"day");else if("ArrowUp"===g)e.subtract(1,"week");else if("ArrowDown"===g)e.add(1,"week");else if("PageUp"===g)e.subtract(1,b?"year":"month");else if("PageDown"===g)e.add(1,b?"year":"month");else if("Home"===g)e.startOf(c?"year":"month");else if("End"===g)e.endOf(c?"year":"month");else if("Enter"===g||" "===g)this.viewModel.value=e.toDate(),this._closedByUserAction=!0,this._close();a.preventDefault();a.stopPropagation()}};d._renderMonth=function(a,c){const b=this._moment(),g=a.clone().startOf("month"),
e=a.clone().endOf("month"),m=g.clone().subtract(g.weekday(),"day"),q=[];for(let B=0;6>B;B++){const C=[];for(let D=0;7>D;D++){const E=m.date(),F=m.isSame(a,"day");var w=m.isSame(c,"day");const R=this._getDayId(m);w={["esri-date-picker__day-item--nearby-month"]:!m.isBetween(g,e,null,"[]"),["esri-date-picker__day-item--today"]:m.isSame(b,"day"),["esri-date-picker__day-item--active"]:F,["esri-date-picker__day-item--selected"]:w};C.push(f.jsx("div",{"aria-label":E.toString(),"aria-selected":F.toString(),
bind:this,class:this.classes("esri-date-picker__day-item",w),"data-iso-date":m.toISOString(),id:R,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},E));m.add(1,"day")}q.push(f.jsx("div",{class:"esri-date-picker__week-item",role:"row"},C))}return q};d._renderYearPicker=function(a){var c={year:"numeric"},b=a.clone();a=l.formatDate(b.valueOf(),c);const g=l.formatDate(b.add(1,"year").valueOf(),c);c=l.formatDate(b.subtract(2,"year").valueOf(),c);({messages:b}=this);return f.jsx("div",
{class:"esri-date-picker__year-picker"},f.jsx("div",{"aria-label":b.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setPreviousYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setPreviousYear,tabIndex:0,title:b.goToPreviousYear},c),f.jsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},a),f.jsx("div",{"aria-label":b.goToNextYear,
bind:this,class:"esri-date-picker__year-picker-item",onblur:this._handleDatePickerBlur,onclick:this._setNextYear,onfocusout:this._handleDatePickerFocusOut,onkeydown:this._setNextYear,tabIndex:0,title:b.goToNextYear},g))};d._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value)};d._setMonth=function(a){this._activeDate.month(a.target.value);this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._close=function(){this._activeDate=null;this._isOpen=!1;this._calendarPopover.open=
!1};d._open=function(a,c=!0){this._activeDate=this._moment(a);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=c};d._setPreviousMonth=function(){this._activeDate.subtract(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._setNextMonth=function(){this._activeDate.add(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._setPreviousYear=function(){this._activeDate.subtract(1,"year")};d._setNextYear=
function(){this._activeDate.add(1,"year")};d._handleSelectedDate=function(a){this.viewModel.value=this._moment(a.target.getAttribute("data-iso-date")).toDate();this._closedByUserAction=!0;this._close()};return v}(L);k.__decorate([r.property()],h.prototype,"dateInputEnabled",void 0);k.__decorate([r.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);k.__decorate([r.property(),K.messageBundle("esri/widgets/support/t9n/DatePicker")],h.prototype,"messages",
void 0);k.__decorate([H.aliasOf("viewModel.value")],h.prototype,"value",void 0);k.__decorate([r.property()],h.prototype,"commitOnMonthChange",void 0);k.__decorate([r.property({type:y})],h.prototype,"viewModel",void 0);k.__decorate([n.accessibleHandler()],h.prototype,"_toggle",null);k.__decorate([n.accessibleHandler()],h.prototype,"_setPreviousMonth",null);k.__decorate([n.accessibleHandler()],h.prototype,"_setNextMonth",null);k.__decorate([n.accessibleHandler()],h.prototype,"_setPreviousYear",null);
k.__decorate([n.accessibleHandler()],h.prototype,"_setNextYear",null);k.__decorate([n.accessibleHandler()],h.prototype,"_handleSelectedDate",null);return h=k.__decorate([I.subclass("esri.widgets.support.DatePicker")],h)});