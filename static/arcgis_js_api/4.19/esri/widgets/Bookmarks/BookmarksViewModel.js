// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Evented ../../core/Collection ../../Viewpoint ../../webdoc/support/Thumbnail ../../webmap/Bookmark ../support/GoTo".split(" "),function(v,e,c,z,
I,f,J,A,m,K,L,M,B,C,D,E,w,F){const n=z.getLogger("esri.widgets.Bookmarks.BookmarksViewModel"),x=C.ofType(w),G={width:128,height:128,format:"png"},p={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0};c=function(y){function q(a){a=y.call(this,a)||this;a.activeBookmark=null;return a}v._inheritsLoose(q,y);var g=q.prototype;g.destroy=function(){this.view=null;this._set("activeBookmark",null)};g.createBookmark=async function(a){const {view:b,defaultCreateOptions:h}=this;if(!b)return a=
new m("create-bookmark:invalid-view","Cannot create a bookmark without a view."),n.error(a),Promise.reject(a);const {takeScreenshot:k,screenshotSettings:l,captureExtent:d,captureViewpoint:r,captureRotation:t,captureScale:u}={...h,...a};a=k?await this._createThumbnail(l):void 0;return new w({...a&&{thumbnail:a},...(r||d)&&{viewpoint:this._createViewpoint({view:b,captureScale:u,captureRotation:t})}})};g.editBookmark=async function(a,b){const {view:h,defaultEditOptions:k}=this;if(!h)return a=new m("edit-bookmark:invalid-view",
"Cannot edit a bookmark without a view."),n.error(a),Promise.reject(a);const {takeScreenshot:l,screenshotSettings:d,captureExtent:r,captureViewpoint:t,captureRotation:u,captureScale:H}={...k,...b};if(b=l?await this._createThumbnail(d):void 0)a.thumbnail=b;if(t||r)a.viewpoint=this._createViewpoint({view:h,captureScale:H,captureRotation:u});this.emit("bookmark-edit",{bookmark:a});return a};g.goTo=function(a){var {view:b}=this;if(!b)return a=new m("go-to:invalid-view","Cannot go to a bookmark without a view"),
n.error(a),Promise.reject(a);b=null==a?void 0:a.viewpoint;if(!b)return a=new m("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:a}),n.error(a),Promise.reject(a);this._set("activeBookmark",a);b=this.callGoTo({target:b});this.emit("select-bookmark",{bookmark:a});this.emit("bookmark-select",{bookmark:a});b.catch(()=>{}).then(()=>this._set("activeBookmark",null));return b};g._createThumbnail=async function(a){a=await this.view.takeScreenshot({...G,...a});
return new E({url:a.dataUrl})};g._createViewpoint=function({view:a,captureRotation:b,captureScale:h}){var k,l;const d=null==(k=a.viewpoint)?void 0:k.clone();return new D({targetGeometry:null==(l=a.extent)?void 0:l.clone(),rotation:b&&(null==d?void 0:d.rotation)||0,scale:h&&(null==d?void 0:d.scale)||0})};v._createClass(q,[{key:"bookmarks",get:function(){return this.get("view.map.bookmarks")||new x},set:function(a){void 0===a?this._clearOverride("bookmarks"):this._override("bookmarks",a)}},{key:"defaultCreateOptions",
get:function(){return p},set:function(a){this._set("defaultCreateOptions",{...p,...a})}},{key:"defaultEditOptions",get:function(){return p},set:function(a){this._set("defaultEditOptions",{...p,...a})}},{key:"state",get:function(){const a=this.get("view");return a&&!a.ready?"loading":"ready"}},{key:"view",get:function(){return this._get("view")},set:function(a){a&&"2d"!==a.type&&n.error(new m("view:invalid-view","SceneView is not supported",{view:a}));this._set("view",a)}}]);return q}(F.GoToMixin(B.EventedAccessor));
e.__decorate([f.property({readOnly:!0})],c.prototype,"activeBookmark",void 0);e.__decorate([f.property({type:x})],c.prototype,"bookmarks",null);e.__decorate([f.property()],c.prototype,"defaultCreateOptions",null);e.__decorate([f.property()],c.prototype,"defaultEditOptions",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([f.property({value:null})],c.prototype,"view",null);return c=e.__decorate([A.subclass("esri.widgets.Bookmarks.BookmarksViewModel")],c)});