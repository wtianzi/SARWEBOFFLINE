// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(A,l,k,G,H,n,I,C,J,K,L,D,E,F,h,x){k=function(B){function y(a){a=B.call(this,a)||this;a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}A._inheritsLoose(y,B);var q=y.prototype;q.setActiveMedia=function(a){this._setContentElementMedia(a)};q.next=function(){this._pageContentElementMedia(1)};q.previous=function(){this._pageContentElementMedia(-1)};
q._setContentElementMedia=function(a){const {formattedMediaInfoCount:c}=this;this.activeMediaInfoIndex=(a+c)%c};q._pageContentElementMedia=function(a){const {activeMediaInfoIndex:c}=this;this._setContentElementMedia(c+a)};q._formatMediaInfos=function(){const {attributes:a,mediaInfos:c,formattedAttributes:d,fieldInfoMap:g,layer:e}=this;return null==c?void 0:c.map(b=>{if(!b)return null;b.title=h.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:g,globalAttributes:d,layer:e,text:b.title});
b.caption=h.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:g,globalAttributes:d,layer:e,text:b.caption});b.altText=h.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:g,globalAttributes:d,layer:e,text:b.altText});if("image"===b.type){var {value:m}=b;this._setImageValue({value:m,formattedAttributes:d,layer:e});return b.value.sourceURL?b:void 0}return"pie-chart"===b.type||"line-chart"===b.type||"column-chart"===b.type||"bar-chart"===b.type?({value:m}=b,this._setChartValue({value:m,
chartType:b.type,attributes:a,formattedAttributes:d,layer:e}),b):null}).filter(Boolean)};q._setImageValue=function(a){const {fieldInfoMap:c}=this,{value:d,formattedAttributes:g,layer:e}=a,{linkURL:b,sourceURL:m}=d;m&&(a=h.fixTokens(m,e),d.sourceURL=h.substituteAttributes({formattedAttributes:g,template:a,fieldInfoMap:c}));b&&(a=h.fixTokens(b,e),d.linkURL=h.substituteAttributes({formattedAttributes:g,template:a,fieldInfoMap:c}))};q._setChartValue=function(a){const {value:c,attributes:d,formattedAttributes:g,
chartType:e,layer:b}=a,{popupTemplate:m,relatedInfos:t}=this,{fields:p,normalizeField:v}=c;c.fields=h.getFixedFieldNames(p,b);v&&(c.normalizeField=h.getFixedFieldName(v,b));if(p.some(f=>!!(null!=g[f]||h.isRelatedField(f)&&t.size))){var u=null==m?void 0:m.fieldInfos;p.forEach(f=>{h.isRelatedField(f)?c.series=[...c.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:f,formattedAttributes:g,chartType:e,value:c})]:(f=this._getChartOption({value:c,attributes:d,chartType:e,formattedAttributes:g,
fieldName:f,fieldInfos:u}),c.series.push(f))})}};q._getRelatedChartInfos=function(a){var c;const {fieldInfos:d,fieldName:g,formattedAttributes:e,chartType:b,value:m}=a,t=[];a=x.getRelatedFieldInfo(g);const {layerId:p,fieldName:v}=a;a=null==(c=this.relatedInfos)?void 0:c.get(p.toString());if(!a)return t;const {relatedFeatures:u,relation:f}=a;if(!f||!u)return t;({cardinality:c}=f);u.forEach(z=>{const {attributes:r}=z;r&&Object.keys(r).forEach(w=>{w===v&&t.push(this._getChartOption({value:m,attributes:r,
formattedAttributes:e,fieldName:g,chartType:b,relatedFieldName:w,fieldInfos:d}))})});return"one-to-many"===c||"many-to-many"===c?t:[t[0]]};q._getTooltip=function({label:a,value:c,chartType:d}){return"pie-chart"===d?a:`${a}: ${c}`};q._getChartOption=function(a){const {value:c,attributes:d,formattedAttributes:g,fieldName:e,relatedFieldName:b,fieldInfos:m,chartType:t}=a;var {layer:p}=this;const {normalizeField:v,tooltipField:u}=c;var f=v?h.isRelatedField(v)?d[x.getRelatedFieldInfo(v).fieldName]:d[v]:
null;a=b&&void 0!==d[b]?d[b]:void 0!==d[e]?d[e]:g[e];const z=void 0===a?null:a&&f?a/f:a;a=new F({value:z});if(h.isRelatedField(e)){var r=x.getRelatedFieldInfo(e);var w=x.getRelatedFieldInfo(u);w=w?w.fieldName:null;p=h.formatValueToFieldInfo(z,{fieldInfos:m,fieldName:b,layer:p,preventPlacesFormatting:!!f});r=r?r.label||r.fieldName:b;a.tooltip=this._getTooltip({label:w&&void 0!==d[w]?d[w]:r,value:p,chartType:t});return a}f=h.getFieldInfo(m,e);p=h.getFixedFieldName(e,p);f=u&&void 0!==g[u]?g[u]:h.getFieldInfoLabel(f||
new E({fieldName:p}),null==(r=this.popupTemplate)?void 0:r.expressionInfos);a.tooltip=this._getTooltip({label:f,value:g[p],chartType:t});return a};A._createClass(y,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return y}(D);l.__decorate([n.property()],k.prototype,"activeMediaInfoIndex",
void 0);l.__decorate([n.property({readOnly:!0})],k.prototype,"activeMediaInfo",null);l.__decorate([n.property()],k.prototype,"attributes",void 0);l.__decorate([n.property()],k.prototype,"description",void 0);l.__decorate([n.property()],k.prototype,"fieldInfoMap",void 0);l.__decorate([n.property()],k.prototype,"formattedAttributes",void 0);l.__decorate([n.property({readOnly:!0})],k.prototype,"formattedMediaInfos",null);l.__decorate([n.property()],k.prototype,"layer",void 0);l.__decorate([n.property({readOnly:!0})],
k.prototype,"formattedMediaInfoCount",null);l.__decorate([n.property()],k.prototype,"mediaInfos",void 0);l.__decorate([n.property()],k.prototype,"popupTemplate",void 0);l.__decorate([n.property()],k.prototype,"relatedInfos",void 0);l.__decorate([n.property()],k.prototype,"title",void 0);return k=l.__decorate([C.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],k)});