// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../geometry/Polygon ../../../Graphic ../../../tasks/support/AddressToLocationsParameters ../../../tasks/support/LocationToAddressParameters ../../../tasks/support/SuggestLocationsParameters ./geometryUtils".split(" "),function(r,w,B,C,D,E,F,v){function x(a){const c=null==a?void 0:a.scale;return"number"===typeof c&&3E5>=c?a.get("extent.center"):null}function G(a,c){const {source:b,spatialReference:e,location:f,sourceIndex:g,view:k}=a,{apiKey:p,locator:h,zoomScale:l,
defaultZoomScale:d}=b,m=k&&k.scale;a=c&&c.signal;c=new E;c.location=f;p&&(c.apiKey=p);e&&(c.outSpatialReference=e);return h.locationToAddress(c,{signal:a}).then(q=>z([q],{sourceIndex:g,scale:m,view:k,zoomScale:l,defaultZoomScale:d}))}function A(a,c){const {filter:b,withinViewEnabled:e}=a;a=c&&c.extent;return(c=v.createExtentFromGeometry(b&&b.geometry,c,c&&c.scale))||(e&&a?a:void 0)}function H(a,c){const {source:b,suggestResult:e,spatialReference:f,view:g,maxResults:k,sourceIndex:p}=a,h=b&&b.zoomScale,
l=b&&b.defaultZoomScale;if(!e.text.trim())return Promise.resolve(null);a=`${!e.key&&b.prefix?b.prefix:""}${e.text}${!e.key&&b.suffix?b.suffix:""}`;const d=new D,{apiKey:m,locator:q}=b,n=g&&g.scale,t=A(b,g);c=c&&c.signal;m&&(d.apiKey=m);if(!q)return Promise.resolve(null);b.categories&&(d.categories=b.categories);b.locationType&&(d.locationType=b.locationType);f&&(d.outSpatialReference=f);const u=x(g);u&&(d.location=u);d.maxLocations=k;t&&(d.searchExtent=w.unwrap(t));b.countryCode&&(d.countryCode=b.countryCode);
const {key:y}=e;y&&(d.magicKey=y);d.address={};d.address[b.singleLineFieldName||"Single Line Input"]=a;b.outFields&&(d.outFields=b.outFields);return q.addressToLocations(d,{signal:c}).then(I=>z(I,{key:y,scale:n,sourceIndex:p,view:g,zoomScale:h,defaultZoomScale:l}))}function J(a,c){return a.map(b=>({text:b.text,key:b.magicKey,sourceIndex:c}))}function z(a,c){return a.map(b=>{{const {key:g,scale:k,sourceIndex:p,view:h,zoomScale:l,defaultZoomScale:d}=c,{attributes:m,extent:q,location:n,address:t}=b;
b=new C({geometry:n,attributes:m});var e=q||n,f=v.createExtentFromGeometry(e,h,k);e="number"===typeof l?v.scaleExtent(f,h,l):"number"===typeof d&&"point"===e.type?v.scaleExtent(f,h,d):f;f=n?`${n.x},${n.y}`:"";f=t||f;const u=b.clone();w.isSome(e)&&(u.geometry=B.fromExtent(e));b={extent:e,feature:b,target:u,key:g,name:f,sourceIndex:p}}return b})}r.getLocation=x;r.getResults=function(a,c){return a.location?G(a,c):H(a,c)};r.getSuggestions=function(a,c){const {source:b,spatialReference:e,view:f,suggestTerm:g,
maxSuggestions:k,sourceIndex:p}=a;a=new F;const {apiKey:h,locator:l}=b,d=A(b,f);c=c&&c.signal;if(!l)return Promise.resolve(null);h&&(a.apiKey=h);b.categories&&(a.categories=b.categories);e&&(a.outSpatialReference=e);const m=x(f);m&&(a.location=m);if(!g.trim())return Promise.resolve(null);const {prefix:q="",suffix:n=""}=b;a.text=`${q}${g}${n}`;d&&(a.searchExtent=w.unwrap(d));a.maxSuggestions=k;b.countryCode&&(a.countryCode=b.countryCode);return l.suggestLocations(a,{signal:c}).then(t=>J(t,p))};r.isArcGISWorldGeocoder=
function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1};r.isMeteredArcGISWorldGeocoder=function(a){return a?/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1};r.isProxiedArcGISWorldGeocoder=function(a){return a?/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1};Object.defineProperty(r,"__esModule",{value:!0})});