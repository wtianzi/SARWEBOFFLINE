// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../views/support/spatialReferenceSupport ../../../layers/support/layerUtils ../../../views/3d/terrain/TilingScheme ../../../views/3d/terrain/terrainUtils".split(" "),function(g,m,e,h,n,p,q,k){function l(){throw new e("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}async function r(a,b){const {basemap:c,view:f}=a;await c.load(b);if(0!==
c.baseLayers.length){a=c.baseLayers.concat(c.referenceLayers);a=t(a);if(a.length)throw a[0];a=m.typeCast(c.baseLayers.getItemAt(0))();try{await a.load(b)}catch(u){const {name:v="basemap-compatibility:unknown-error",message:w="Unknown basemap compatibility error",details:x}=u;throw new e(v,w,x);}if(b=a.tileInfo){var d=f.viewingMode;if(d){if(!n.isSpatialReferenceSupported(b.spatialReference,d))throw new e(`basemapgalleryitem:spatial-reference-unsupported-${d}`,`Basemap spatial reference is unsupported in ${d} mode`);
if("global"===d){if((d=k.checkIfTileInfoSupportedForView(b,a.fullExtent,null,1))&&a.compatibleTileInfo256&&!k.checkIfTileInfoSupportedForView(a.compatibleTileInfo256,a.fullExtent,null,1)&&(d=null),d)throw new e(`basemapgalleryitem:tiling-scheme-unsupported-${b.spatialReference.isWebMercator?"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",{error:d});}else if(q.checkUnsupported(b))throw new e("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");
d=f.get("basemapTerrain.tilingScheme");if(!(!d||d.compatibleWith(b)||a.compatibleTileInfo256&&d.compatibleWith(a.compatibleTileInfo256)))throw new e("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}}}function t(a){const b=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return a.toArray().filter(c=>-1===b.indexOf(c.operationalLayerType)).map(c=>new e("basemap-compatibility:unsupported-basemap-layer-type",
"Unsupported basemap layer type ${operationalLayerType}",{layer:c,operationalLayerType:c.operationalLayerType||"unknown"}))}g.default2DCompatibility=async function(a,b={}){const {basemap:c,view:f}=a;await c.load(b);h.throwIfAborted(b);if(0!==c.baseLayers.length&&(a=c.baseLayers.getItemAt(0),p.isTiledLayer(a))){if(c.spatialReference){if(f.spatialReference.equals(c.spatialReference))return;l()}await a.load(b);h.throwIfAborted(b);b=(a.get("supportedSpatialReferences")||[a.get("tileInfo.spatialReference")]).filter(Boolean);
0!==b.length&&b.every(d=>!f.spatialReference.equals(d))&&l()}};g.default3DCompatibility=async function(a,b={}){await r(a,b);h.throwIfAborted(b)};Object.defineProperty(g,"__esModule",{value:!0})});