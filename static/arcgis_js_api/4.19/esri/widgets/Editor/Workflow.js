// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Evented ../../core/HandleOwner".split(" "),function(k,e,b,t,u,f,v,n,p,w,x,y,q,r){b=function(l){function h(a){a=l.call(this,a)||this;a._indexHistory=
[];a._lastStepIndex=-1;a._stepIndex=-1;a._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"};a.data=null;a.started=!1;a.steps=null;a.type=null;return a}k._inheritsLoose(h,l);var c=h.prototype;c.cancel=async function(a={force:!0}){return!1!==a.force?this._cancel():new Promise((d,g)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel().then(d)},deny:()=>g(new p("workflow:cancel-denied","Request to cancel workflow was denied."))}})})};c.commit=async function(){const {data:a}=
this;this.handles.remove(this._handleKeys.beforeCommit);const d=a.edits.feature,g=d.clone();if(!a.edits.attributesModified){const {objectIdField:m}=d.layer;g.attributes={[m]:d.getAttribute(m)}}a.edits.geometryModified||(g.geometry=null);await this.afterCommit(g);this.handles.remove(this._handleKeys.afterCommit);this.emit("commit");this.started&&await this.reset()};c.go=async function(a){var {steps:d}=this;d=d.findIndex(g=>g.id===a);this._indexHistory.push(this._stepIndex);await this._go(d)};c.next=
async function(){this._indexHistory.push(this._stepIndex);await this._go(this._stepIndex+1)};c.previous=async function(){await this._go(this._indexHistory.pop())};c.reset=async function(){await this._cancel(!1);await this.start()};c.start=async function(){this._set("started",!0);await this._go(-1===this._stepIndex?0:this._stepIndex)};c._cancel=async function(a=!0){this.started&&(this._set("started",!1),await this.steps[this._stepIndex].tearDown());this.handles.remove([this._handleKeys.afterCommit,
this._handleKeys.beforeCommit]);this._resetIndexing(a);a&&this.emit("cancel")};c._go=async function(a=-1){-1>=a||a>=this.steps.length||(this.started&&(-1<this._lastStepIndex&&await this.steps[this._lastStepIndex].tearDown(),await this.steps[a].setUp(),this._lastStepIndex=a),this._stepIndex=a,this._notifyStepProps())};c._resetIndexing=function(a=!0){this._lastStepIndex=this._stepIndex=-1;this._indexHistory.length=0;a&&this._notifyStepProps()};c._notifyStepProps=function(){this.notifyChange("stepId");
this.notifyChange("hasPreviousStep");this.notifyChange("hasNextStep")};k._createClass(h,[{key:"hasNextStep",get:function(){const {steps:a}=this;return!!(a&&this._stepIndex<a.filter(d=>!d.parent).length-1)}},{key:"hasPreviousStep",get:function(){return 0<this._stepIndex}},{key:"stepId",get:function(){var {steps:a}=this;return(a=a&&a[this._stepIndex])&&a.id}}]);return h}(r.HandleOwnerMixin(q.EventedAccessor));e.__decorate([f.property()],b.prototype,"afterCommit",void 0);e.__decorate([f.property()],
b.prototype,"data",void 0);e.__decorate([f.property()],b.prototype,"hasNextStep",null);e.__decorate([f.property()],b.prototype,"hasPreviousStep",null);e.__decorate([f.property()],b.prototype,"started",void 0);e.__decorate([f.property({readOnly:!0})],b.prototype,"stepId",null);e.__decorate([f.property()],b.prototype,"steps",void 0);e.__decorate([f.property()],b.prototype,"type",void 0);e.__decorate([f.property()],b.prototype,"commit",null);return b=e.__decorate([n.subclass("esri.widgets.Editor.Workflow")],
b)});