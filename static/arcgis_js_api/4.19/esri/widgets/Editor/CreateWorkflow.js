// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ./CreateWorkflowData ./Edits ./Workflow ./workflowUtils".split(" "),function(w,x,m,r,I,J,K,L,y,M,N,O,z,A,B,k){function C(d){if(1!==d.length)return null;[d]=
d;if("items"in d){if(1===d.items.length)return d.items[0]}else return d;return null}var n;m=n=function(d){function l(c){c=d.call(this,c)||this;c.type="create";return c}w._inheritsLoose(l,d);l.create=function(c,p,a){c=new z({edits:new A,viewModel:c});a=new n({data:c,afterCommit:a});a._set("steps",this._createWorkflowSteps(a,p));return a};l._createWorkflowSteps=function(c,p="awaiting-feature-creation-info"){const {data:a,handles:f}=c,G={"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",
async setUp(){a.creationInfo=null;a.edits.feature=null;f.add(a.viewModel.featureTemplatesViewModel.on("select",({item:b})=>{a.creationInfo={layer:b.layer,template:b.template};a.viewModel.activeWorkflow.next()}),this.id)},async tearDown(){f.remove(this.id)}}),"awaiting-feature-to-create":()=>({id:"awaiting-feature-to-create",async setUp(){f.add(await k.setUpFeatureAdd(a.viewModel.sketchViewModel,a.creationInfo,a.viewModel.view,b=>{a.edits.feature=b;a.viewModel.activeWorkflow.next()}),this.id)},async tearDown(){f.remove(this.id)}}),
"editing-new-feature":()=>({id:"editing-new-feature",async setUp(){const b=a.edits.feature,e=a.viewModel,t=k.findLayerInfo(e.layerInfos,b.layer);e.featureFormViewModel.set({feature:b,fieldConfig:t&&t.fieldConfig});const g=k.getVisualVariableAttributes(b),{interactive:D,visual:E}=await k.setUpGeometryUpdate(b,g,e.sketchViewModel,e.view,({geometry:F,attributes:q})=>{if(r.isSome(g.rotation)){var {field:h}=g.rotation;e.featureFormViewModel.setValue(h,q[h])}r.isSome(g.size)&&({field:h}=g.size,e.featureFormViewModel.setValue(h,
q[h]));a.edits.updateAttributes(q);a.edits.updateGeometry(F)});f.add([a.viewModel.featureFormViewModel.on("value-change",()=>{a.edits.updateAttributes(a.viewModel.featureFormViewModel.getValues());b.attributes=a.edits.feature.attributes}),D,E],this.id)},async tearDown(){f.remove(this.id)}})};let u=!1;c=["awaiting-feature-creation-info","awaiting-feature-to-create","editing-new-feature"].filter(b=>u?!0:u=b===p).map(b=>G[b]());a.viewModel.refreshCreationTemplates();const v=C(a.viewModel.featureTemplatesViewModel.items),
[H]=c;if("awaiting-feature-creation-info"===H.id&&v){const {layer:b,template:e}=v;a.creationInfo={layer:b,template:e};c.shift()}return c};return l}(B);return m=n=x.__decorate([y.subclass("esri.widgets.Editor.CreateWorkflow")],m)});