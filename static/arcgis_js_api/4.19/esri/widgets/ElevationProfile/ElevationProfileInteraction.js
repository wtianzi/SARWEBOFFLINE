// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/handleUtils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/accessorSupport/trackingUtils ../../core/Accessor ../../symbols/CIMSymbol ../../symbols/SimpleLineSymbol ../../Graphic ../../core/Handles ../../layers/GraphicsLayer ../../views/DOMContainer ../Sketch/SketchViewModel ./support/geometryUtils".split(" "),
function(b,v,k,L,c,M,N,n,l,O,x,P,Q,R,p,q,y,z,A,B,C,D,E,F,w){function G(g){return w.isPolyline(g)?(g=g.clone(),g.paths=[g.paths[0].slice(0,-1)],g):g}(function(g){g.Ready="ready";g.Creating="creating";g.Reshaping="reshaping";g.ReshapingDisabled="rehsaping-disabled";g.Selecting="selecting";g.Selected="selected"})(b.State||(b.State={}));b.ElevationProfileInteraction=function(g){function r(a){a=g.call(this,a)||this;a.state=b.State.Ready;a._handles=new C;a._pendingStartOptions=null;a._previousInputInfo=
null;a._shouldRemoveLastPoint=!1;a._sketchedGraphics=new WeakSet;a._creationToolPromise=null;a._updateToolPromise=null;a._updateDisabled=!1;return a}v._inheritsLoose(r,g);var f=r.prototype;f.initialize=function(){this._handles.add(q.reactionInit(()=>this.tool.viewModel.view,a=>{c.isSome(a)?this._initialize(a):this._destroy()}),"view")};f.destroy=function(){this._destroy();this._handles=c.destroyMaybe(this._handles)};f.start=function(a={mode:"sketch"}){if(this.tool.editable){var e=this._view;if(c.isNone(e)||
!e.ready)this._pendingStartOptions=a;else switch(this._pendingStartOptions=null,this._stopInteraction(),c.isNone(this._previousInputInfo)&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),a.mode){case "sketch":this._set("state",b.State.Creating);this._startCreationInteraction();break;case "select":this._set("state",b.State.Selecting),this._startSelectionInteraction()}}};f.stop=function(){this._pendingStartOptions=null;this._stopInteractionAndUpdate();this._clearPreviousInput()};
f.cancel=function(){this._pendingStartOptions=null;this._stopInteractionAndUpdate();this._restorePreviousInput()};f.clear=function(){this._stopInteractionAndUpdate();this._set("state",b.State.Ready);this._clearPreviousInput();this._pendingStartOptions=this._input=null};f.isSketchedGraphic=function(a){return c.isSome(a)&&this._sketchedGraphics.has(a)};f._initialize=function(a){this._destroy();this._graphicsLayer=new D({listMode:"hide",internal:!0,elevationInfo:{mode:"3d"===a.type?"relative-to-ground":
"on-the-ground",offset:null}});var e="2d"===a.type?new z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new A({color:[0,0,0,0]});this._sketchVM=new F({layer:this._graphicsLayer,
view:a,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMidpoints:!0,enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,enableMoveGraphic:!1,tool:"reshape"},polylineSymbol:e,updatePolylineSymbol:e,activeLineSymbol:e,activeFillSymbol:e});this._handles.add([q.when(()=>a.ready,()=>c.applySome(this._pendingStartOptions,d=>this.start(d))),q.reactionInit(()=>[this._input,this._visibleAndEditable],
()=>this._update()),q.reactionInit(()=>({map:a.map,graphicsLayer:this._graphicsLayer}),({map:d,graphicsLayer:h})=>{c.isSome(d)&&c.isSome(h)&&d.add(h);this._update()})],"main")};f._destroy=function(){this._handles.remove("main");this._sketchVM=c.destroyMaybe(this._sketchVM);this._updateToolPromise=this._creationToolPromise=null;const a=c.applySome(this._view,d=>d.map),e=this._graphicsLayer;c.isSome(a)&&c.isSome(e)&&a.remove(e);this._graphicsLayer=c.destroyMaybe(this._graphicsLayer)};f._startCreationInteraction=
function(){this._stopInteractionAndUpdate();const a=this._sketchVM;if(!c.isNone(this._view)&&!c.isNone(a)){this._shouldRemoveLastPoint=!1;var e=a.on("create",d=>{const h=d.graphic;switch(d.state){case "complete":this._shouldRemoveLastPoint=!1;this._setSketchedGraphic(h);this._stopInteractionAndUpdate();this._clearPreviousInput();break;case "cancel":this.cancel();break;case "active":this._setSketchedGraphic(h);"cursor-update"===d.toolEventInfo.type&&(this._shouldRemoveLastPoint=!0);break;case "start":this._setSketchedGraphic(h)}});
this._handles.remove("interaction");this._handles.add(n.makeHandle(()=>{e.remove();a.cancel();this._creationToolPromise=null;const d=this._input;c.isNone(d)||!this.canStopCreating?this._input=null:this._shouldRemoveLastPoint&&this._setSketchedGraphic(new B({geometry:G(d.geometry)}))}),"interaction");this._creationToolPromise=p.ignoreAbortErrors(a.create("polyline"))}};f._startReshapeInteraction=function(){this._stopInteraction();const a=this._sketchVM;if(!c.isNone(this._view)&&!c.isNone(a)){var e=
a.on("update",d=>{const h=d.graphics[0];switch(d.state){case "complete":this._setSketchedGraphic(h);this._stopInteractionAndUpdate();this._clearPreviousInput();break;case "active":this._setSketchedGraphic(h);break;case "start":this._setSketchedGraphic(h)}});this._handles.remove("interaction");this._handles.add(n.makeHandle(()=>{e.remove();a.cancel();this._updateToolPromise=null}),"interaction");c.applySome(this._input,d=>{d.visible=!0;this._updateToolPromise=p.ignoreAbortErrors(a.update(d,{tool:"reshape"}))})}};
f._startSelectionInteraction=function(){this._stopInteraction();const a=this._view;if(!c.isNone(a)){var e=a.cursor,d=n.makeHandle(()=>a.cursor=e);a.cursor="crosshair";a.popup.close();var h=null,H=n.makeHandle(()=>c.abortMaybe(h)),J=a.on("immediate-click",m=>{m.preventDefault();m.stopPropagation();c.abortMaybe(h);h=p.createTask(async u=>{const {results:I}=await a.hitTest(m);p.throwIfAborted(u);if(u=I.map(t=>t.graphic).find(t=>c.isSome(t.geometry)&&"polyline"===t.geometry.type))this._input=u,this._clearPreviousInput(),
this._stopInteractionAndUpdate()})}),K=a.on("key-down",m=>{"Escape"===m.key&&this.cancel()});this._handles.remove("interaction");this._handles.add([J,K,H,d],"interaction");a.ready&&E.isDOMContainer(a)&&a.focus()}};f._stopInteraction=function(){this._handles.remove("interaction")};f._stopInteractionAndUpdate=function(){this._handles.has("interaction")&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())};f._triggerUpdate=function(){this._set("state",b.State.Ready);
this._update()};f._update=function(){if(!this._updateDisabled){var a=this.state;if(a===b.State.Selecting)this.stop();else{if(this._visibleAndEditable){if(a===b.State.Creating||a===b.State.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState());this._updateVisuals()}}};f._getNextState=function(){return c.isNone(this._input)?b.State.Ready:this.isSketchedGraphic(this._input)?this.state===b.State.Creating?b.State.Creating:this._visibleAndEditable?
b.State.Reshaping:b.State.ReshapingDisabled:b.State.Selected};f._updateVisuals=function(){switch(this.state){case b.State.Reshaping:this._startReshapeInteraction();break;case b.State.ReshapingDisabled:{this._stopInteractionAndUpdate();const a=this._input;c.isSome(a)&&this.isSketchedGraphic(a)&&(a.visible=!1);break}case b.State.Ready:case b.State.Selected:this._stopInteractionAndUpdate()}this._updateSketchedGraphic()};f._storePreviousInput=function(a){this._previousInputInfo={graphic:a}};f._restorePreviousInput=
function(){const a=this._previousInputInfo;c.isNone(a)||(this._clearPreviousInput(),this._input=a.graphic,this._triggerUpdate())};f._clearPreviousInput=function(){this._previousInputInfo=null};f._updateSketchedGraphic=function(){var a=this._graphicsLayer;if(!c.isNone(a)){a=a.graphics;var e=this._input;if(c.isNone(e)||!this.isSketchedGraphic(e))a.removeAll();else if(-1!==a.indexOf(e)){if(1!==a.length){const d=a.filter(h=>h!==e);a.removeMany(d)}}else a.removeAll(),a.add(e)}};f._setSketchedGraphic=function(a){c.isSome(a)&&
this._sketchedGraphics.add(a);this._input=a;this._updateSketchedGraphic()};v._createClass(r,[{key:"canStopCreating",get:function(){const a=c.applySome(this.tool.viewModel.input,d=>d.geometry),e=this._shouldRemoveLastPoint?3:2;return w.isPolyline(a)&&0<a.paths.length&&a.paths[0].length>=e}},{key:"_input",get:function(){return this.tool.viewModel.input},set:function(a){this.tool.viewModel.input=a}},{key:"_visibleAndEditable",get:function(){return this.tool.visible&&this.tool.editable}},{key:"_view",
get:function(){return this.tool.viewModel.view}},{key:"test",get:function(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([c.unwrapOr(this._creationToolPromise,Promise.resolve()),c.unwrapOr(this._updateToolPromise,Promise.resolve())])}}}]);return r}(y);k.__decorate([l.property({nonNullable:!0})],b.ElevationProfileInteraction.prototype,"state",void 0);k.__decorate([l.property({nonNullable:!0})],b.ElevationProfileInteraction.prototype,"tool",void 0);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,
"canStopCreating",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_graphicsLayer",void 0);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_sketchVM",void 0);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_input",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_visibleAndEditable",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,"_view",null);k.__decorate([l.property()],b.ElevationProfileInteraction.prototype,
"_shouldRemoveLastPoint",void 0);b.ElevationProfileInteraction=k.__decorate([x.subclass("esri.widgets.ElevationProfile.ElevationProfileInteraction")],b.ElevationProfileInteraction);Object.defineProperty(b,"__esModule",{value:!0})});