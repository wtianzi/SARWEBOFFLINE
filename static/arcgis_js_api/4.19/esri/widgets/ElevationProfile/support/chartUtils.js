// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/handleUtils ../../../core/arrayUtils ../../../core/promiseUtils ../../../intl/number ../../../intl/substitute ../../../intl ../../../core/unitUtils ../../../core/unitFormatUtils ../../support/widgetUtils ../../support/chartUtils ../css ./constants ./intlUtils ./niceScale".split(" "),function(z,ha,h,ia,t,A,G,H,I,ja,v,w,u,J,K,r,L,M){function N(a){a=new a.amCharts4Index.am4charts.XYCursor;a.trackable=!0;a.lineY.disabled=
!0;a.behavior="zoomX";return a}function O(a){const b=a.theme,c=a.amChart.tooltip;({am4core:a}=a.amCharts4Index);c.id="series-tooltip";c.fitPointerToBounds=!0;c.pointerOrientation="vertical";c.zIndex=-1;c.getFillFromObject=!1;c.label.fontSize=b.seriesTooltipFontSize;c.label.fill=a.color(b.seriesTooltipLabelColor);c.label.padding(b.seriesTooltipPaddingVertical,b.seriesTooltipPaddingHorizontal,b.seriesTooltipPaddingVertical,b.seriesTooltipPaddingHorizontal);c.background.cornerRadius=b.tooltipBorderRadius;
c.background.stroke=null;c.background.fill=a.color(b.seriesTooltipBackgroundColor);c.background.padding(0,0,0,0);c.adapter.add("dy",()=>b.seriesTooltipSpacing*(0>=c.background.pointerY?1:-1));u.isRTL()&&(c.label.textAlign="middle")}function P(a){const {xAxis:b,theme:c}=a,{am4core:e}=a.amCharts4Index;b.numberFormatter=B(a,"distance");b.strictMinMax=!0;b.cursorTooltipEnabled=!1;b.title.visible=!1;a=b.renderer;a.line.visible=!1;a.minGridDistance=c.xAxisMinGridDistance;a.minLabelPosition=c.xAxisMinLabelPosition;
a.maxLabelPosition=c.xAxisMaxLabelPosition;a.fontWeight=c.axisFontWeight;a.fontSize=c.axisFontSize;a.baseGrid.disabled=!0;var d=a.labels.template;d.fontSize=c.axisLabelsFontSize;d.fontWeight=c.axisLabelsFontWeight;d.fill=e.color(c.axisLabelsColor);d.paddingTop=c.xAxisLabelsSpacing;d.horizontalCenter="left";d.paddingLeft=0;d=b.tooltip;d.id="axis-tooltip";d.background.fill=e.color(c.axisTooltipBackgroundColor);d.background.stroke=null;d.background.padding(0,0,0,0);d.label.fontSize=c.axisTooltipFontSize;
d.label.fill=e.color(c.axisTooltipLabelColor);d.label.padding(c.axisTooltipPaddingTop,c.axisTooltipPaddingHorizontal,c.axisTooltipPaddingBottom,c.axisTooltipPaddingHorizontal);a=a.grid.template;a.strokeOpacity=1;a.stroke=e.color(c.axisGridStroke)}function Q(a){const {yAxis:b,theme:c}=a,{am4core:e}=a.amCharts4Index;b.numberFormatter=B(a,"elevation");b.title.visible=!1;b.cursorTooltipEnabled=!1;b.strictMinMax=!0;b.baseValue=r.NO_DATA_VALUE;a=b.renderer;a.inside=!0;a.line.opacity=0;a.line.visible=!1;
a.minGridDistance=c.yAxisMinGridDistance;a.minLabelPosition=c.yAxisMinLabelPosition;a.maxLabelPosition=c.yAxisMaxLabelPosition;a.fontWeight=c.axisFontWeight;a.fontSize=c.axisFontSize;a.baseGrid.disabled=!0;const d=a.labels.template;d.fontSize=c.axisLabelsFontSize;d.fontWeight=c.axisLabelsFontWeight;d.fill=e.color(c.axisLabelsColor);d.verticalCenter="bottom";d.paddingLeft=c.yAxisLabelSpacing;d.paddingBottom=0;const g=a.grid.template;g.strokeOpacity=1;g.stroke=e.color(c.axisGridStroke);u.isRTL()&&(a.opposite=
!0,d.textAlign="middle",d.paddingLeft=0,d.paddingRight=c.yAxisLabelSpacing)}function R(a,{data:b,messages:c}){x(a);var e=h.isSome(b)&&b.fullyRefined;a.amChart.cursor.disabled=!e;a.amChart.htmlContainer.classList.toggle(K.CHART_CSS.cursorEnabled,e);e=a.data!==b;const d=h.applySome(a.data,g=>g.effectiveUnits)!==h.applySome(b,g=>g.effectiveUnits);a.data=b;a.messages=c;e&&(S(a),T(a),U(a));d&&(a.yAxis.invalidateLabels(),a.xAxis.invalidateLabels())}function S({xAxis:a,data:b}){if(!h.isNone(b)){var c=0;
for(const d of b.lines){var e;b=h.unwrapOr(d.samples,[]);b=null==(e=A.last(b))?void 0:e.distance;h.isSome(b)&&b>c&&(c=b)}a.min=0;a.max=c}}function T({yAxis:a,data:b,theme:c}){if(!h.isNone(b)){var e=h.applySome(b.statistics,l=>l.maxDistance),d=h.applySome(b.statistics,l=>l.minElevation),g=h.applySome(b.statistics,l=>l.maxElevation);if(h.isSome(e)&&h.isSome(d)&&h.isSome(g)){var f=d;let l=g;b.dynamicElevationRange&&(f=e,g-=d,b=b.effectiveUnits,f=v.convertUnit(e,b.distance,"meters"),e=v.convertUnit(g,
b.elevation,"meters"),e=Math.max(e,f/r.MAX_CHART_RATIO,e),e=v.convertUnit(e,"meters",b.elevation),f=d,l=f+e);d=Math.max(l-f,.001);f-=c.yAxisExtraFactorBottom*d;l+=c.yAxisExtraFactorTop*d;[a.min,a.max]=M.niceScale(f,l,10)}else a.min=void 0,a.max=void 0}}function U(a){const {amChart:b,data:c}=a;if(h.isNone(c)||0===c.lines.length)b.series.clear();else{var e=new Map,d=new Set(b.series.values),g=c.lines.length;for(let f=0;f<g;f++){const l=c.lines[f];let k=a.series.get(l.id);k?(h.applySome(k.fill,m=>d.delete(m)),
d.delete(k.line)):(k=V(a,l),h.applySome(k.fill,m=>b.series.push(m)),b.series.push(k.line));e.set(k.id,k);const n=g-f-1;h.applySome(k.fill,m=>m.zIndex=n);k.line.zIndex=g+n;W(a,k,l)}a.series=e;for(const f of d)b.series.removeValue(f)}}function W(a,{line:b,fill:c},e){const {theme:d}=a;({am4core:a}=a.amCharts4Index);const {r:g,g:f,b:l,a:k}=e.color,n=a.color({r:g,g:f,b:l,a:k}),m=h.unwrapOr(e.samples,[]),q=0<m.length;b.stroke=n;b.visible=q;h.applySome(c,p=>{p.visible=q;p.fill=n.lighten(d.seriesFillLighten)});
e=m.length;a=b.data;if(a.length===e){for(let p=0;p<e;++p)X(a[p],m[p]);b.invalidateRawData();h.applySome(c,p=>p.invalidateRawData())}else b.data=m,h.applySome(c,p=>p.data=m)}function X(a,b){a.x=b.x;a.y=b.y;a.z=b.z;a.distance=b.distance;a.elevation=b.elevation}function V(a,b){const {id:c}=b,e=C(a,`${"line"}-${c}`);e.strokeWidth=b.chartStrokeWidth;e.dy=b.chartStrokeOffsetY;let d=null;b.chartFillEnabled&&(d=C(a,`${"fill"}-${c}`),d.fillOpacity=1);return{id:c,line:e,fill:d}}function C(a,b){a=new a.amCharts4Index.am4charts.LineSeries;
a.id=b;a.showOnInit=!1;a.simplifiedProcessing=!0;a.minDistance=2;a.excludeFromTotal=!0;a.clickable=!1;a.contextMenuDisabled=!0;a.cursorHoverEnabled=!1;a.cursorTooltipEnabled=!1;a.connect=!1;a.fill=null;a.stroke=null;a.dataFields.valueX="distance";a.dataFields.valueY="elevation";return a}function Y({xAxis:a},b){const c=a.events.on("rangechangeended",()=>{b(a.zoomFactor)});return t.makeHandle(()=>c.dispose())}function Z({xAxis:a,yAxis:b}){const c=d=>()=>{d.renderer.grid.each(g=>{g.visible="none"!==
g.dataItem.label.dom.getAttribute("display")})},e=[a.events.on("rangechangeended",c(a)),a.events.on("validated",c(a)),b.events.on("rangechangeended",c(b)),b.events.on("validated",c(b))];return t.makeHandle(()=>{e.forEach(d=>d.dispose())})}function aa(a,b){const {amChart:c,xAxis:e,yAxis:d}=a,{cursor:g}=c;let f=!1;const l=()=>{f=!1;b(null,null);x(a)},k=[g.events.on("cursorpositionchanged",()=>{if(f){{const n=e.toAxisPosition(g.xPosition),m=d.toAxisPosition(g.yPosition);b(n,m);ba(a)}}}),c.events.on("over",
()=>{f=!0}),c.events.on("out",l),c.events.on("blur",l)];return t.makeHandle(()=>{k.forEach(n=>n.dispose())})}function ba(a){const {amChart:b,xAxis:c,theme:e}=a;x(a);if(h.applySome(a.data,l=>l.fullyRefined)){var d=b.tooltip,g=c.tooltip,f=ca(a);h.isSome(f)&&(d.text=f.text,d.show(0),d.validate(),d.pointerOrientation=30>f.y-d.contentHeight-e.seriesTooltipSpacing?"up":"down",d.pointTo(f,!0),g.text=da(a),g.show(),b.cursor.show())}}function x({amChart:a,xAxis:b}){a.cursor.hide();a.tooltip.hide();b.hideTooltip()}
function ca(a){const {amChart:b,yAxis:c,data:e}=a;if(h.isNone(e))return null;const d=e.lines.map(n=>({line:n,y:h.applySome(D(a,n),m=>m.elevation)})).sort(ea),g=d.length?d[0].y:null;if(h.isNone(g))return null;const f=b.cursor,l=c.measuredHeight,k=l+b.pixelPaddingTop;return{text:d.map(({y:n,line:m})=>{{const {data:q,messages:p}=a;h.isNone(q)||h.isNone(p)?m="":(n=I.substitute(p.chartTooltip,{name:L.getTranslatedLineTitle(m,p),elevation:h.isSome(n)?w.formatDecimal(p,n,q.effectiveUnits.elevation,r.FORMAT_PRECISION):
r.NOT_AVAILABLE}),m=`[${m.color.toHex()}]\u25cf[/] ${n}`)}return m}).join("\n"),x:f.point.x+f.parent.pixelX+b.pixelPaddingLeft,y:k-c.valueToPosition(g)*l}}function ea({y:a},{y:b}){return h.isNone(a)?1:h.isNone(b)?-1:b-a}function da(a){const {data:b,messages:c}=a;if(h.isNone(b)||h.isNone(c))return"";const e=b.lines[0];a=e?D(a,e):null;return h.isSome(a)?w.formatDecimal(c,a.distance,b.effectiveUnits.distance,r.FORMAT_PRECISION):"-"}function B(a,b){const c=a.xAxis.numberFormatter.clone();c.format=(e,
d,g)=>{const {messages:f,data:l}=a;return h.isNone(f)||h.isNone(l)||"string"===typeof e?"":`${H.formatNumber(e,{maximumFractionDigits:g})} ${w.unitName(f,l.effectiveUnits[b],"abbr")}`};return c}function D({amChart:a,xAxis:b},c){c=h.unwrapOr(c.samples,[]);if(0===c.length)return null;a=b.toAxisPosition(a.cursor.xPosition);b=b.positionToValue(a);return A.binaryFindClosest(c,b,e=>e.distance)}const E={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",
axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:"#a9a9a9",axisTooltipFontSize:12,axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",axisTooltipPaddingTop:3,axisTooltipPaddingBottom:3,axisTooltipPaddingHorizontal:4,xAxisMinGridDistance:50,xAxisLabelsSpacing:6,xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisExtraFactorTop:.25,yAxisExtraFactorBottom:.02,yAxisLabelSpacing:4,yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,
seriesTooltipFontSize:12,seriesTooltipBackgroundColor:"#f8f8f8",seriesTooltipLabelColor:"#323232",seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:4,seriesTooltipPaddingHorizontal:4,tooltipBorderRadius:0},fa={...E,axisGridStroke:"#323232",axisLabelsColor:"#a9a9a9",axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",seriesTooltipBackgroundColor:"#323232",seriesTooltipLabelColor:"#f8f8f8",seriesFillLighten:-.75};z.createChart=async function(a){const b=await J.loadChartsModule();
G.throwIfAborted(a.abortOptions);const {am4core:c,am4charts:e}=b;c.options.minPolylineStep=3;c.options.autoSetClassName=!0;c.options.animationsEnabled=!1;var d=u.isDarkTheme();const g=d?fa:E;d&&c.useTheme(b.am4themes_dark);const f=c.create(a.container,e.XYChart);f.arrangeTooltips=!1;f.preloader.disabled=!0;f.zoomOutButton.disabled=!0;d=u.isRTL();f.rtl=d;f.padding(g.paddingTop,d?g.paddingLeft:g.paddingRight,g.paddingBottom,d?g.paddingRight:g.paddingLeft);d=f.plotContainer.background;d.strokeWidth=
0;d.strokeOpacity=0;d.stroke=null;d=f.xAxes.push(new e.ValueAxis);const l=f.yAxes.push(new e.ValueAxis),k={params:a,amCharts4Index:b,amChart:f,xAxis:d,yAxis:l,series:new Map,data:null,messages:null,theme:g};f.cursor=N(k);O(k);P(k);Q(k);const n=[Y(k,a.onRangeChange),aa(k,a.onCursorPositionChange),Z(k)];let m=null,q=!1;const p=()=>{h.isNone(m)||("undefined"!==typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(m):clearTimeout(m),m=null)};return{...k,destroy(){q=!0;p();t.handlesGroup(n).remove();
f.dispose()},update(y){if(y.data!==k.data||y.messages!==k.messages)if(p(),!q){var F=()=>{q||(m=null,R(k,y))};m="undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(F,{timeout:30}):setTimeout(F,30)}},zoomOut(){q||k.xAxis.zoom({start:0,end:1},!1,!0)}}};Object.defineProperty(z,"__esModule",{value:!0})});