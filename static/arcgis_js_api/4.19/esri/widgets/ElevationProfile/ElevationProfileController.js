// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/handleUtils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/accessorSupport/trackingUtils ../../core/Accessor ../../core/Handles ../../core/memoize ../../core/throttle ../../support/elevationInfoUtils ./support/constants ./support/geometryUtils ./support/profileUtils".split(" "),
function(h,v,m,G,k,H,I,A,n,J,B,K,L,M,p,w,C,D,t,E,x,q,y,F){h.ElevationProfileController=function(z){function r(a){var b=z.call(this,a)||this;b._handles=new D;b._updateTask=null;b._paramsPerProfile=new Map;b._getUpdateParametersMemoized=t.memoize((c,f,e)=>({stationary:c,visibleProfiles:f,generationParameters:e}));b._getGenerationParametersMemoized=t.memoize((c,f,e,g,d,u)=>y.isPolyline(f)&&y.isValidInputPath(f)&&!k.isNone(g)?{view:c,geometry:f,elevationInfo:e,options:u,queue:g,cache:d}:null);b._getOptionsMemoized=
t.memoize((c,f,e)=>({geodesicDistanceThreshold:c,samplingDistance:k.unwrapOr(f,q.DEFAULT_DEM_RESOLUTION),densificationMaxSamples:Math.round(q.DENSIFICATION_MAX_SAMPLES/e),maxTotalSamples:q.MAX_TOTAL_SAMPLES}));b._updateThrottled=E.throttle(c=>p.ignoreAbortErrors(b._update(c)),q.UPDATE_THROTTLE_MILLIS);return b}v._inheritsLoose(r,z);var l=r.prototype;l.initialize=function(){const a=this.viewModel;this._handles.add([w.reactionInit(()=>a.profiles.toArray(),b=>{this._abortUpdate();this._paramsPerProfile.clear();
this._handles.remove("line-change");this._handles.add(b.map(c=>A.handlesGroup([c.attach(this.viewModel),c.on("change",()=>{this._invalidateProfile(c)})])),"line-change")}),this._updateThrottled,w.reactionInit(()=>this._updateParameters,this._updateThrottled)])};l.destroy=function(){this._handles.destroy();this._paramsPerProfile.clear()};l._update=async function({stationary:a,visibleProfiles:b,generationParameters:c}){this._abortUpdate();a&&(k.isNone(c)?this._clearResults():this._updateTask=p.createTask(async f=>
{this.viewModel.error=null;const e=b.filter(d=>!this._isProfileValid(d,c));var g=F.generateProfiles({...c,providers:e},{signal:f});try{for await(const d of g)for(p.throwIfAborted(f),this._clearInvalidResults(c),g=0;g<e.length;g++)e[g].result=d[g];for(const d of e)this._paramsPerProfile.set(d,c)}catch(d){p.throwIfAbortError(d),this._abortUpdate(),this.viewModel.error=d,e.forEach(u=>{u.result=null})}}))};l._abortUpdate=function(){this._updateTask=k.abortMaybe(this._updateTask)};l._isProfileValid=function(a,
b){return this._paramsPerProfile.has(a)&&this._paramsPerProfile.get(a)===b};l._invalidateProfile=function(a){this._paramsPerProfile.delete(a);this._updateThrottled(this._updateParameters)};l._clearInvalidResults=function(a){for(const b of this.viewModel.profiles.items)this._isProfileValid(b,a)||(b.result=null,this._paramsPerProfile.delete(b))};l._clearResults=function(){for(const a of this.viewModel.profiles.items)a.result=null,this._paramsPerProfile.delete(a)};v._createClass(r,[{key:"_updateParameters",
get:function(){var {viewModel:a}=this;a=a.view;return this._getUpdateParametersMemoized(k.isSome(a)?a.stationary:!0,this.viewModel.visibleProfiles,this._generationParameters)}},{key:"_generationParameters",get:function(){const {view:a,input:b,queue:c,tileCache:f}=this.viewModel;if(k.isNone(a))return null;const e=k.applySome(b,d=>d.geometry),g=k.applySome(b,d=>x.hasGraphicFeatureExpressionInfo(d)?null:x.getGraphicEffectiveElevationInfo(d));return this._getGenerationParametersMemoized(a,e,g,c,f,this._options)}},
{key:"_options",get:function(){const a=this.viewModel;return this._getOptionsMemoized(a.geodesicDistanceThreshold,a.minDemResolution,a.visibleProfiles.length)}}]);return r}(C);m.__decorate([n.property({nonNullable:!0})],h.ElevationProfileController.prototype,"viewModel",void 0);m.__decorate([n.property()],h.ElevationProfileController.prototype,"_updateParameters",null);m.__decorate([n.property()],h.ElevationProfileController.prototype,"_generationParameters",null);m.__decorate([n.property()],h.ElevationProfileController.prototype,
"_options",null);h.ElevationProfileController=m.__decorate([B.subclass("esri.widgets.ElevationProfile.ElevationProfileController")],h.ElevationProfileController);Object.defineProperty(h,"__esModule",{value:!0})});