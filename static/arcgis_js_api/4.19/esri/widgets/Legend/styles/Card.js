// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/screenUtils ../../../intl/substitute ../../../intl ../../../core/Handles ../../support/widgetUtils ../../support/decorators/accessibleHandler ../../support/decorators/messageBundle ../../../chunks/index ../../Widget ../../../symbols/support/svgUtils ./support/relationshipUtils ./support/univariateUtils ../support/styleUtils".split(" "),
function(F,u,r,N,O,w,P,G,Q,R,S,A,H,T,I,U,J,B,e,K,L,M,q,p){const x=window.devicePixelRatio;r=function(C){function z(a,d){a=C.call(this,a,d)||this;a._handles=new I;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout="stack";a.messages=null;a.messagesCommon=null;a.type="card";a.view=null;return a}F._inheritsLoose(z,C);var n=z.prototype;n.initialize=function(){this.own([this.watch("activeLayerInfos",a=>{this._handles.removeAll();this._watchForSectionChanges(a)})])};
n.destroy=function(){this._handles.destroy();this._handles=null};n.render=function(){this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var a=this.activeLayerInfos;a=a&&a.toArray().map(b=>this._renderLegendForLayer(b)).filter(b=>!!b);this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const d=
this._sectionNames.length;var c=this._sectionNames.map((b,f)=>{f=H.substitute(this.messagesCommon.pagination.pageText,{index:f+1,total:d});return e.jsx("div",{key:b,role:"tab",id:b,"aria-label":f,"aria-controls":`${b}-panel`,"aria-selected":(this._selectedSectionName===b).toString(),tabIndex:this._selectedSectionName===b?0:-1,title:f,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{["esri-legend--card__carousel-indicator--activated"]:this._selectedSectionName===
b}),"data-section-name":b})});c=this._hasIndicators&&1<d?e.jsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation",role:"tablist"},c):null;a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):a&&a.length?a:null;return e.jsx("div",{class:this.classes("esri-legend--card",{["esri-legend--stacked"]:this._hasIndicators})},a?a:e.jsx("div",{class:"esri-legend--card__message"},this.messages.noLegend),c)};n._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=
a};n._focusSection=function(a){switch(a.key){case "ArrowLeft":case "ArrowRight":this._switchSectionOnArrowPress(a);break;case "Enter":case " ":this._selectSection(a)}};n._switchSectionOnArrowPress=function(a){const d=a.key,c="ArrowLeft"===d?-1:1;a=a.target.getAttribute("data-section-name");a=this._sectionNames.indexOf(a);const b=this._sectionNames;let f=null;-1!==a&&(b[a+c]?f=document.getElementById(b[a+c]):"ArrowLeft"===d?f=document.getElementById(b[b.length-1]):"ArrowRight"===d&&(f=document.getElementById(b[0])),
f&&f.focus())};n._watchForSectionChanges=function(a){this._generateSectionNames();a&&(a.forEach(d=>{const c=`activeLayerInfo-${d.layer.uid}-version-change`;this._handles.remove(c);this._watchForSectionChanges(d.children);this._handles.add(d.watch("version",()=>this._generateSectionNames()),c)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",()=>this._watchForSectionChanges(a)),"activeLayerInfos-collection-change"))};n._generateSectionNames=function(){this._sectionNames.length=
0;this._selectedSectionName=null;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)};n._getSectionName=function(a,d,c){return`${this.id}${a.uid}-type-${d.type}-${c}`};n._generateSectionNamesForActiveLayerInfo=function(a){a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach((d,c)=>{this._sectionNames.push(this._getSectionName(a.layer,d,c))})};n._renderLegendForLayer=function(a){if(!a.ready)return null;
if(a.children.length){var d=a.children.map(c=>this._renderLegendForLayer(c)).toArray();return e.jsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},e.jsx("div",{class:"esri-legend--card__service-caption-container"},a.title),d)}{if((d=a.legendElements)&&!d.length)return null;const c=d.some(b=>"relationship-ramp"===b.type);d=d.map((b,f)=>this._renderLegendForElement(b,a,f,c)).filter(b=>!!b);return d.length?e.jsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",
{["esri-legend--card__group-layer-child"]:!!a.parent})},e.jsx("div",{class:"esri-legend--card__service-caption-container"},e.jsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),e.jsx("div",{class:"esri-legend--card__service-content"},d)):null}};n._renderLegendForElement=function(a,d,c,b=!1){const f="color-ramp"===a.type,h="opacity-ramp"===a.type;var g="size-ramp"===a.type;const k=d.layer;var l=a.title,m=null;"string"===typeof l?m=l:l&&(m=p.getTitle(this.messages,l,f||h),m=l.title?
`${l.title} (${m})`:m);c=this._getSectionName(k,a,c);l=this._hasIndicators?e.jsx("div",null,e.jsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},d.title),e.jsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m)):m?e.jsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m):null;m=null;"symbol-table"===a.type?(g=a.infos.map((t,v)=>this._renderLegendForElementInfo(t,d,a.legendType,v)).filter(t=>
!!t),g.length&&(m=e.jsx("div",{class:this.classes({["esri-legend--card__label-container"]:!(g[0].properties.classes&&g[0].properties.classes["esri-legend--card__symbol-row"])&&!b,["esri-legend--card__relationship-label-container"]:b})},g))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?m=this._renderLegendForRamp(a,k.opacity):g?m=this._renderSizeRamp(a,k.opacity):"relationship-ramp"===a.type?m=M.renderRelationshipRamp(a,this.id,k.opacity):"univariate-above-and-below-ramp"===
a.type?m=this._renderUnivariateAboveAndBelowRamp(a,k.opacity):"univariate-color-size-ramp"===a.type&&(m=this._renderUnivariateColorSizeRamp(a,k.opacity));if(!m)return null;b=e.jsx("div",{key:c,class:"esri-legend--card__section",id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[l,m]);this._sectionMap.set(c,b);return b};n._renderUnivariateAboveAndBelowRamp=function(a,d){const {sizeRampElement:c,colorRampElement:b}=q.getUnivariateAboveAndBelowRampElements(a,d,"horizontal");a=q.getUnivariateSizeRampSize(c,
"full",!0,"horizontal");var f=q.getUnivariateColorRampSize(c,"above",!0,"horizontal"),h=q.getUnivariateColorRampSize(c,"below",!0,"horizontal");f=q.getUnivariateColorRampPreview(b,{width:f,height:12,rampAlignment:"horizontal",opacity:d,type:"above"});d=q.getUnivariateColorRampPreview(b,{width:h,height:12,rampAlignment:"horizontal",opacity:d,type:"below"});var g=q.getUnivariateColorRampMargin(c,"card");h=c.infos.map(l=>l.label);const k=h.length-1;h=h.map((l,m)=>0===m||m===k?e.jsx("div",{key:m},l):
null);g={marginTop:"3px",marginLeft:`${g}px`,display:"flex"};a={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return e.jsx("div",{class:"esri-legend--card__layer-row",key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},e.jsx("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},c.infos.map((l,m)=>e.jsx("div",{key:m,class:"esri-legend--card__symbol",bind:l.preview,
afterCreate:p.attachToNode}))),f?e.jsx("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:g,key:"color-ramp-preview"},e.jsx("div",{bind:f,afterCreate:p.attachToNode}),e.jsx("div",{bind:d,afterCreate:p.attachToNode})):null,e.jsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},e.jsx("div",{class:"esri-legend__ramp-labels",styles:a},h)))};n._renderUnivariateColorSizeRamp=function(a,d){const {sizeRampElement:c,colorRampElement:b}=q.getUnivariateColorSizeRampElements(a,
"horizontal");a=q.getUnivariateSizeRampSize(c,"full",!1,"horizontal");var f=q.getUnivariateColorRampSize(c,"full",!1,"horizontal");d=q.getUnivariateColorRampPreview(b,{width:f,height:12,rampAlignment:"horizontal",opacity:d,type:"full"});var h=q.getUnivariateColorRampMargin(c,"card");const g=c.infos.length-1;f=c.infos.map((k,l)=>0===l||l===g?e.jsx("div",{key:l},k.label):null);h={marginTop:"3px",marginLeft:`${h}px`,display:"flex"};a={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};
return e.jsx("div",{class:"esri-legend--card__layer-row",key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},e.jsx("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},c.infos.map((k,l)=>e.jsx("div",{key:l,class:"esri-legend--card__symbol",bind:k.preview,afterCreate:p.attachToNode}))),e.jsx("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:h,key:"color-ramp-preview"},
e.jsx("div",{bind:d,afterCreate:p.attachToNode})),e.jsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},e.jsx("div",{class:"esri-legend__ramp-labels",styles:a},f)))};n._renderLegendForElementInfo=function(a,d,c,b){var f=d.layer;if(a.type)return this._renderLegendForElement(a,d,b);d=p.isImageryStretchedLegend(f,c);if(a.preview){var h;if(!a.symbol||-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return e.jsx("div",{key:b,bind:a.preview,afterCreate:p.attachToNode});var g=
{["esri-legend--card__symbol-cell"]:this._hasIndicators};return e.jsx("div",{key:b,class:this.classes("esri-legend--card__layer-row",{["esri-legend--card__symbol-row"]:this._hasIndicators})},e.jsx("div",{class:this.classes(g),bind:a.preview,afterCreate:p.attachToNode}),e.jsx("div",{class:this.classes("esri-legend--card__image-label",{["esri-legend--card__label-cell"]:this._hasIndicators})},p.getTitle(this.messages,a.label,!1)||""))}let k=c=d=255,l=0,m=255,t=255,v=255,y=0;const D=a.symbol.color&&a.symbol.color.a,
E=a.symbol.outline&&a.symbol.outline.color&&a.symbol.outline.color.a;D&&(d=a.symbol.color.r,c=a.symbol.color.g,k=a.symbol.color.b,l=a.symbol.color.a*f.opacity);E&&(m=a.symbol.outline.color.r,t=a.symbol.outline.color.g,v=a.symbol.outline.color.b,y=a.symbol.outline.color.a*f.opacity);g=(f=null!=(g=null==(h=a.symbol.color)?void 0:h.isBright)?g:!0)?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return e.jsx("div",{key:b,class:"esri-legend--card__layer-row"},e.jsx("div",{class:"esri-legend--card__label-element",
styles:{background:D?`rgba(${d}, ${c}, ${k}, ${l})`:"none",color:f?"black":"white",textShadow:`-1px -1px 0 ${g},
                                              1px -1px 0 ${g},
                                              -1px 1px 0 ${g},
                                              1px 1px 0 ${g}`,border:E?`1px solid rgba(${m}, ${t}, ${v}, ${y})`:"none"}}," ",a.label," "))}if(a.src)return g=this._renderImage(a,f,d),e.jsx("div",{key:b,class:"esri-legend--card__layer-row"},g,e.jsx("div",{class:"esri-legend--card__image-label"},a.label||""))};n._renderImage=function(a,d,c){const {label:b,src:f,opacity:h}=a;c={["esri-legend--card__imagery-layer-image--stretched"]:c,["esri-legend--card__symbol"]:!c};d={opacity:`${null!=h?h:d.opacity}`};
return e.jsx("img",{alt:p.getTitle(this.messages,b,!1),src:f,border:0,width:a.width,height:a.height,class:this.classes(c),styles:d})};n._renderSizeRampLines=function(a){a=a.infos;var d=a[0],c=a[a.length-1],b=d.symbol;a=this._hasIndicators;d=A.pt2px(d.size+d.outlineSize)*x;c=A.pt2px(c.size+c.outlineSize)*x;const f=a?d:d+50*x,h=a?d/2+50*x:d;var g;b?-1<b.type.indexOf("3d")?(g=b.symbolLayers&&b.symbolLayers.length)?(g=b.symbolLayers.getItemAt(g-1).get("resource.primitive"),g="triangle"===g||"cone"===
g||"tetrahedron"===g):g=void 0:g="triangle"===b.style:g=void 0;if(b)if(-1<b.type.indexOf("3d")){var k=b.symbolLayers&&b.symbolLayers.length;k?(b=b.symbolLayers.getItemAt(k-1),b=b.resource&&b.resource.primitive,b="circle"===b||"cross"===b||"kite"===b||"sphere"===b||"cube"===b||"diamond"===b):b=void 0}else b=b.style,b="circle"===b||"diamond"===b||"cross"===b;else b=void 0;k=document.createElement("canvas");k.width=f;k.height=h;k.style.width=`${k.width/x}px`;k.style.height=`${k.height/x}px`;const l=
k.getContext("2d");if(a){l.beginPath();var m=f/2-c/2;l.moveTo(0,0);l.lineTo(m,h);m=f/2+c/2;l.moveTo(f,0);l.lineTo(m,h)}else l.beginPath(),l.moveTo(0,h/2-c/2),l.lineTo(f,0),l.moveTo(0,h/2+c/2),l.lineTo(f,h);l.strokeStyle="#ddd";l.stroke();return e.jsx("div",{bind:k,afterCreate:p.attachToNode,styles:a?{display:"flex",marginTop:`-${g?0:b?d/2:0}px`,marginBottom:`-${g?c:b?c/2:0}px`}:{display:"flex",marginRight:`-${g?0:b?d/2:0}px`,marginLeft:`-${g?0:b?c/2:0}px`}})};n._renderSizeRamp=function(a,d){var c=
a.infos;const b=c[0].label,f=c[c.length-1].label;let h=c[0].preview;c=c[c.length-1].preview;const g=this._hasIndicators,k={"flex-direction":g?"column":"row-reverse"};h&&(h=h.cloneNode(!0),h.style.display="flex");c&&(c=c.cloneNode(!0),c.style.display="flex");d={opacity:null!=d?`${d}`:""};return e.jsx("div",{class:this.classes("esri-legend--card__layer-row",{["esri-legend--card__size-ramp-row"]:g})},e.jsx("div",{class:"esri-legend--card__ramp-label"},g?b:f),e.jsx("div",{class:"esri-legend--card__size-ramp-container",
styles:k},e.jsx("div",{bind:h,afterCreate:p.attachToNode,class:"esri-legend--card__size-ramp-preview",styles:d}),this._renderSizeRampLines(a),e.jsx("div",{bind:c,afterCreate:p.attachToNode,class:"esri-legend--card__size-ramp-container",styles:d})),e.jsx("div",{class:"esri-legend--card__ramp-label"},g?f:b))};n._renderLegendForRamp=function(a,d){var c=a.infos;const b="heatmap-ramp"===a.type,f=c.length-1;var h=2<f&&!b?25*f:100;const g=h+20,k=c.slice(0).reverse();k.forEach((v,y)=>{v.offset=b?v.ratio:
y/f});const l=k.length-1;a=(a=0!==k.length%2&&k[k.length/2|0])&&e.jsx("div",{class:"esri-legend--card__interval-separators-container"},e.jsx("div",{class:"esri-legend--card__interval-separator"},"|"),e.jsx("div",{class:"esri-legend--card__ramp-label"},a.label));const m=c[c.length-1].label;c=c[0].label;let t=null;null!=d&&(t=`opacity: ${d}`);d=L.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:k[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:h,height:25},fill:{type:"linear",
x1:10,y1:0,x2:h+10,y2:0,colors:k},stroke:{width:0}},{shape:{type:"path",path:`M${h+10} 0 L${g} ${12.5} L${h+10} ${25} Z`},fill:k[l].color,stroke:{width:0}}]],g,25);({messages:h}=this);return e.jsx("div",{class:"esri-legend--card__layer-row"},e.jsx("div",{class:"esri-legend--card__ramp-label"},b?h[m]:m),e.jsx("div",{class:"esri-legend--card__symbol-container"},e.jsx("div",{style:t},d),a),e.jsx("div",{class:"esri-legend--card__ramp-label"},b?h[c]:c))};return z}(K);u.__decorate([w.property()],r.prototype,
"activeLayerInfos",void 0);u.__decorate([w.property()],r.prototype,"layout",void 0);u.__decorate([w.property(),B.messageBundle("esri/widgets/Legend/t9n/Legend")],r.prototype,"messages",void 0);u.__decorate([w.property(),B.messageBundle("esri/t9n/common")],r.prototype,"messagesCommon",void 0);u.__decorate([w.property({readOnly:!0})],r.prototype,"type",void 0);u.__decorate([w.property()],r.prototype,"view",void 0);u.__decorate([J.accessibleHandler()],r.prototype,"_selectSection",null);return r=u.__decorate([G.subclass("esri.widgets.Legend.styles.Card")],
r)});