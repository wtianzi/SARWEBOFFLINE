// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../../../Color ../../../symbols ../../../symbols/support/cimSymbolUtils ../../../symbols/support/utils ../../../renderers/support/numberUtils ./utils".split(" "),function(E,y,M,F,N,C,t,O){function P(a,b){const c=a.length-1;return a.map((d,h)=>O.createStopLabel(d,h,c,b))}function Q(a,b){a=null==a?void 0:a.authoringInfo;const c="univariate-color-size"===(null==a?void 0:a.type);let d=[12,30];if(c){const h=b[0],n=b[b.length-1];d=b.map(k=>12+(k-h)/(n-h)*18)}c&&"below"===(null==
a?void 0:a.univariateTheme)&&d.reverse();return d}function R(a,b){const c=a.classBreakInfos,d=c.length;b=2>d||!(2<=b)?c[0].symbol.clone():c[d-1].symbol.clone();a.visualVariables.some(h=>"color"===h.type)&&(-1<b.type.indexOf("3d")?G(b):H(b));return b}function S(a,b){let c=null,d=null;"simple"===a.type?c=a.symbol:"class-breaks"===a.type?(c=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,d=1<a.length):"unique-value"===a.type&&(c=(a=a.uniqueValueInfos)&&a[0]&&a[0].symbol,d=1<a.length);if(!c||T(c))return null;
c=c.clone();if(b||d)-1<c.type.indexOf("3d")?G(c):H(c);return c}function T(a){return a?F.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(b=>b&&"fill"===b.type):!1:-1!==a.type.indexOf("fill"):!1}function G(a){"line-3d"===a.type?a.symbolLayers.forEach(b=>{b.material={color:z}}):a.symbolLayers.forEach(b=>{"icon"!==b.type||b.resource&&b.resource.href?b.material={color:I}:(b.material={color:J},b.outline={color:z,size:1.5})})}function H(a){"cim"===a.type?N.applyCIMSymbolColor(a,new M(I)):-1!==a.type.indexOf("line")?
a.color=z:(a.color=J,"simple-marker"===a.type&&(a.outline={color:z,width:1.5}))}async function U(a,b,c,d){const h=(await new Promise(function(f,g){E(["../../../renderers/visualVariables/support/visualVariableUtils"],f,g)})).getSizeRangeAtScale(a,c,d),n=h&&K(h);if(h||n){var k=n.map(f=>{{const g=h.minSize,l=h.maxSize,e=a.minDataValue,m=a.maxDataValue;let q=null;f=q=f<=g?e:f>=l?m:(f-g)/(l-g)*(m-e)+e}return f});k=t.round(k);for(let f=1;f<k.length-1;f++){const g=await V(a,b,k[f],k[f-1],c,d);g&&(k[f]=g[0],
n[f]=g[1])}return k}}function K(a){const b=a.minSize;a=(a.maxSize-b)/4;const c=[];for(let d=0;5>d;d++)c.push(b+a*d);return c}async function V(a,b,c,d,h,n){const k=await u(a,b,c,h,n);d=await u(a,b,d,h,n);var f=t.numDigits(c),g=f.fractional,l=f.integer;let e=f=null;0<c&&1>c&&(f=10**g,c*=f,l=t.numDigits(c).integer);for(g=l-1;0<=g;g--){var m=10**g;l=Math.floor(c/m)*m;m*=Math.ceil(c/m);null!=f&&(l/=f,m/=f);let q=(l+m)/2;[,q]=t.round([l,q,m],{indexes:[1]});const v=await u(a,b,l,h,n),w=await u(a,b,m,h,n),
x=await u(a,b,q,h,n),A=t.percentChange(k,v,d,null),B=t.percentChange(k,w,d,null),D=t.percentChange(k,x,d,null);let p=20>=A.previous,r=20>=B.previous;p&&r&&(A.previous<=B.previous?(p=!0,r=!1):(r=!0,p=!1));p?e=[l,v]:r?e=[m,w]:20>=D.previous&&(e=[q,x]);if(e)break}return e}async function u(a,b,c,d,h){const {getSize:n}=await new Promise(function(k,f){E(["../../../renderers/visualVariables/support/visualVariableUtils"],k,f)});return n(a,c,{scale:d,view:h,shape:"simple-marker"===b.type?b.style:null})}function W(a,
b){a=a.clone();if(F.isSymbol3D(a))C.isVolumetricSymbol(a)||a.symbolLayers.forEach(c=>{"fill"!==c.type&&(c.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){const c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=b);return a}const J=[255,255,255],I=[200,200,200],z=[128,128,128];y.REAL_WORLD_MAX_SIZE=
30;y.REAL_WORLD_MIN_SIZE=12;y.getRampStops=async function(a,b,c,d,h,n){var k,f,g=b.legendOptions;g=g&&g.customValues;const l=S(a,c);var e=null!=b.minSize&&null!=b.maxSize;c=b.stops&&1<b.stops.length;var m=!!b.target;if(l&&(g||e||c&&!m)){var q=C.isVolumetricSymbol(l),v=null,w=e=null;e=q&&!c?t.round([b.minDataValue,b.maxDataValue]):g||await U(b,l,d,h);g=null==a?void 0:a.authoringInfo;var x=(m="univariate-color-size"===(null==g?void 0:g.type))&&"above-and-below"===(null==g?void 0:g.univariateTheme);
!e&&c&&(e=b.stops.map(p=>p.value),(v=b.stops.some(p=>!!p.label))&&(w=b.stops.map(p=>p.label)));q&&2<(null==(k=e)?void 0:k.length)&&!x&&(e=[e[0],e[e.length-1]]);if(!e)return null;m&&5!==(null==(f=e)?void 0:f.length)&&(e=K({minSize:e[0],maxSize:e[e.length-1]}));var A=q?Q(a,e):null,B=C.getSymbolOutlineSize(l),D=v?null:P(e,n);return(await Promise.all(e.map(async(p,r)=>{const L=q?A[r]:await u(b,l,p,d,h),X=W(x&&"class-breaks"===a.type?R(a,r):l,L);return{value:p,symbol:X,label:v?w[r]:D[r],size:L,outlineSize:B}}))).reverse()}};
Object.defineProperty(y,"__esModule",{value:!0})});