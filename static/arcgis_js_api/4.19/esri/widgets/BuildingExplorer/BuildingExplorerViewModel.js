// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/Accessor ../../core/Collection ../../core/collectionUtils ../../core/Handles ../../core/watchUtils ../../layers/support/BuildingFilter ../../layers/BuildingSceneLayer ./support/buildingLayerUtils ./support/layerUtils ./BuildingDisciplinesViewModel ./support/filterUtils ./BuildingLevel ./BuildingPhase".split(" "),
function(m,c,b,n,w,H,d,I,x,J,K,L,y,z,p,A,B,g,C,D,E,F,q,h,r,t){const G=w.getLogger("esri.widgets.BuildingExplorer.BuildingExplorerViewModel");b=function(u){function k(a){a=u.call(this,a)||this;a.view=null;a.state="disabled";a.level=new r;a.phase=new t;a.disciplines=new q;a._handles=new B;a._loadLayers=F.createLoadLayersFunction();a.layers=new p;return a}m._inheritsLoose(k,u);var l=k.prototype;l.initialize=function(){this._handles.add([this.layers.on("change",()=>this._onLayersChange()),g.init(this,
"_filter",()=>h.setFilterOnLayers(this.layers,this._filter))]);this._onLayersChange()};l.destroy=function(){this._handles.destroy();this.level.destroyed||this.level.destroy();this.phase.destroyed||this.phase.destroy();this.disciplines.destroyed||this.disciplines.destroy()};l._onLayersChange=async function(){this.level.layers=this.layers;this.phase.layers=this.layers;this.disciplines.layers=this.layers;if(0===this.layers.length)this._set("state","disabled");else{this._set("state","loading");try{await this._loadLayers(this.layers),
await Promise.all([g.whenEqualOnce(this.level,"state","ready"),g.whenEqualOnce(this.phase,"state","ready"),g.whenEqualOnce(this.disciplines,"state","ready")]),this.layers.forEach(E.showFullModel),this._set("state","ready")}catch(a){y.isAbortError(a)||this._set("state","failed")}}};m._createClass(k,[{key:"isSupported",get:function(){var a;return"3d"===(null==(a=this.view)?void 0:a.type)}},{key:"layers",set:function(a){const f=a.filter(e=>e instanceof D);f.length!==a.length&&G.error("Some layers are not BuildingSceneLayers but only BuildingSceneLayers can be passed to the widget.");
this._set("layers",A.referenceSetter(f,this._get("layers")))}},{key:"_filter",get:function(){var a=this.level.filterExpressions;const f=this.phase.filterExpressions,e=[],v=h.getFilterBlockSolid([a.solid,f.solid]);n.isSome(v)&&e.push(v);a=h.getFilterBlockXRay([a.xRay,f.xRay]);n.isSome(a)&&e.push(a);return 0===e.length?null:new C({id:h.generateFilterId(),name:"Building Explorer Filter",filterBlocks:e})}}]);return k}(z);c.__decorate([d.property({value:null})],b.prototype,"view",void 0);c.__decorate([d.property()],
b.prototype,"isSupported",null);c.__decorate([d.property({type:p,nonNullable:!0})],b.prototype,"layers",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"state",void 0);c.__decorate([d.property({readOnly:!0,type:r})],b.prototype,"level",void 0);c.__decorate([d.property({readOnly:!0,type:t})],b.prototype,"phase",void 0);c.__decorate([d.property({readOnly:!0,type:q})],b.prototype,"disciplines",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"_filter",null);return b=c.__decorate([x.subclass("esri.widgets.BuildingExplorer.BuildingExplorerViewModel")],
b)});