// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Collection ../../intl/locale ../../intl/messages ../../intl ../../Graphic ../../core/Handles ../../core/watchUtils ../../layers/FeatureLayer ../../core/HandleOwner ../../views/support/layerViewUtils ./AttachmentsColumn ./FieldColumn ./Grid/Grid ./Grid/GridViewModel ./support/FeatureStore".split(" "),
function(t,f,e,P,Q,g,R,C,S,T,U,D,E,w,V,x,F,p,G,H,I,J,y,K,L,z){e=function(A){function u(a){var b=A.call(this,a)||this;b._defaultHiddenFields=["CreationDate","Creator","EditDate","Editor","GlobalID"];b._highlights=new F;b.cellClassNameGenerator=(h,k)=>h.path||null;b.dataProvider=async(h,k)=>{const {store:l}=t._assertThisInitialized(b),{page:q,pageSize:r,sortOrders:m}=h;h=b._sortOrdersToLayerOrderByFields(m);k&&(l?(await l.set({orderByFields:h}),"loaded"!==l.state&&"loading"!==l.state&&await l.load(),
k&&k(await l.fetchItems({page:q,pageSize:r}))):k&&k([]))};b.editingEnabled=!1;b.grid=null;b.hiddenFields=new D;b.highlightOnRowSelectEnabled=!0;b.itemIdPath="objectId";b.messagesCommon=null;b.relatedRecordsEnabled=!1;b.store=null;b.view=null;const {hiddenFields:c,itemIdPath:n}=t._assertThisInitialized(b);c.addMany(b._defaultHiddenFields);b._set("store",new z);b._set("grid",new K({itemIdPath:n,viewModel:t._assertThisInitialized(b)}));return b}t._inheritsLoose(u,A);var d=u.prototype;d.initialize=function(){const a=
async()=>{this.messages=await w.fetchMessageBundle("esri/widgets/FeatureTable/t9n/FeatureTable");this.messagesCommon=await w.fetchMessageBundle("esri/t9n/common")};a();this.handles.add([E.onLocaleChange(a),p.on(this,"grid.selectedItems","change",b=>this._onSelectionChange(b)),p.watch(this,"relatedRecordsEnabled",b=>this.store.relatedRecordsEnabled=b),p.watch(this,["layer.loaded"],()=>{var b;if(null!=(b=this.layer)&&b.loaded){if((b=this.layer.capabilities.query.maxRecordCount)&&b<this.pageSize){var c;
null==(c=this.grid)?void 0:c.set({pageSize:b})}this._generateColumns()}}),p.watch(this.store,"state",b=>{if("loaded"===b){var c;null==(c=this.grid)?void 0:c.scrollToTop()}}),p.watch(this,["editingEnabled","messages"],()=>{var b;return(null==(b=this.layer)?void 0:b.loaded)&&this._generateColumns()}),p.watch(this,"layer.definitionExpression",(b,c)=>(b||c)&&"loaded"===this.store.state&&this.refresh())])};d.destroy=function(){var a,b;this._resetColumns();this.handles.removeAll();this._highlights.removeAll();
this._highlights.destroy();null==(a=this.grid)?void 0:a.destroy();null==(b=this.columns)?void 0:b.destroy();this.view=this.layer=null};d.clearHighlights=function(){this._highlights.removeAll()};d.clearSelection=function(){var a;null==(a=this.grid)?void 0:a.clearSelection()};d.deselectRows=function(a){a=a instanceof Array?a:[a];a.forEach(b=>this._deselectRow(b))};d.getObjectIdIndex=function(a){var b;return null==(b=this.store)?void 0:b.getObjectIdIndex(a)};d.getValue=function(a,b){var c;a=this.store.getItemByObjectId(a);
return null==a?void 0:null==(c=a.feature)?void 0:c.attributes[b]};d.refresh=function(){var a;null==(a=this.grid)?void 0:a.refresh()};d.selectRows=function(a){a=a instanceof Array?a:[a];a.forEach(b=>this._selectRow(b))};d.scrollToIndex=function(a){var b;null==(b=this.grid)?void 0:b.scrollToIndex(a)};d._generateColumns=function(){this._resetColumns();this.columns.addMany([...this._createFieldColumns()]);this.attachmentsEnabled&&this.columns.push(this._createAttachmentsColumn())};d._createFieldColumns=
function(){return this.fieldConfigs&&this.fieldConfigs.length?this._createColumnsFromConfigs():this._createColumnsFromFields()};d._createColumnsFromConfigs=function(){const {editingEnabled:a,fieldConfigs:b,grid:c,hiddenFields:n,layer:h,messages:k,messagesCommon:l,store:q}=this,r=this.get("layer.fields")||[];return b.filter(m=>(r||[]).find(v=>m.name===v.name)).map(m=>{const v=m.direction||null,M=m.formatFunction||null,B=(r||[]).find(N=>m.name===N.name),O=!1===m.visible||!0!==m.visible&&-1<n.indexOf(B.name);
return new y({config:m,direction:v,editingEnabled:a,field:B,formatFunction:M,grid:c,hidden:O,layer:h,store:q,messages:k,messagesCommon:l})})};d._createColumnsFromFields=function(){const {editingEnabled:a,grid:b,hiddenFields:c,layer:n,messages:h,messagesCommon:k,store:l}=this;return(this.get("layer.fields")||[]).map(q=>{const r=-1<c.indexOf(q.name);return new y({editingEnabled:a,field:q,grid:b,hidden:r,layer:n,store:l,messages:h,messagesCommon:k})})};d._createAttachmentsColumn=function(){var a;return new J({header:null==
(a=this.messages)?void 0:a.attachments})};d._sortOrdersToLayerOrderByFields=function(a){return a&&a.length?a.filter((b,c,n)=>n.map(h=>h.path).indexOf(b.path)===c).map(({direction:b,path:c})=>c+" "+b.toUpperCase()):[]};d._highlight=function(a){var {view:b}=this;b=b&&a&&b.allLayerViews.items.find(({layer:c})=>c===a.layer);I.highlightsSupported(b)&&this._highlights.add(b.highlight(a),`feature-${a.getObjectId()}`)};d._unhighlight=function(a){a&&this._highlights.remove(`feature-${a.getObjectId()}`)};d._selectRow=
function(a){const {grid:b}=this;var c=a instanceof x?a:null;a=c?c.getObjectId():a;if("number"===typeof a||"string"===typeof a)c=this.getObjectIdIndex(a),-1===c?null==b?void 0:b.selectItem({objectId:a}):null==b?void 0:b.selectRow(c)};d._deselectRow=function(a){const {grid:b}=this;a=a instanceof x?a.getObjectId():a;const c=this.getObjectIdIndex(a);-1===c?null==b?void 0:b.deselectItem({objectId:a}):null==b?void 0:b.deselectRow(c)};d._onSelectionChange=function(a){const {highlightOnRowSelectEnabled:b}=
this,{added:c,removed:n}=a;b&&c.forEach(h=>this._highlight(h.feature));b&&n.forEach(h=>this._unhighlight(h.feature))};d._resetColumns=function(){this.columns.items.forEach(a=>a.destroy());this.columns.removeAll()};t._createClass(u,[{key:"attachmentsEnabled",set:function(a){this.attachmentsEnabled!==a&&(this._set("attachmentsEnabled",a),this._generateColumns(),this.store.attachmentsEnabled=a)}},{key:"fieldConfigs",set:function(a){var b;this._set("fieldConfigs",a);(null==(b=this.layer)?0:b.loaded)&&
this._generateColumns()}},{key:"filterGeometry",set:function(a){if(this.filterGeometry||a)this.clearSelection(),this._set("filterGeometry",a),this.store.filterGeometry=a}},{key:"layer",set:function(a){var b;this._set("layer",a);null==(b=this.grid)?void 0:b.clearSort();this._resetColumns();this.store.set({layer:a});a&&a.load();this.notifyChange("state")}},{key:"messages",set:function(a){var b;null==(b=this.grid)?void 0:b.set("messages",a);this._set("messages",a)}}]);return u}(H.HandleOwnerMixin(L));
f.__decorate([g.property()],e.prototype,"attachmentsEnabled",null);f.__decorate([g.property()],e.prototype,"cellClassNameGenerator",void 0);f.__decorate([g.property()],e.prototype,"dataProvider",void 0);f.__decorate([g.property()],e.prototype,"editingEnabled",void 0);f.__decorate([g.property()],e.prototype,"fieldConfigs",null);f.__decorate([g.property()],e.prototype,"filterGeometry",null);f.__decorate([g.property({readOnly:!0})],e.prototype,"grid",void 0);f.__decorate([g.property()],e.prototype,"hiddenFields",
void 0);f.__decorate([g.property()],e.prototype,"highlightOnRowSelectEnabled",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"itemIdPath",void 0);f.__decorate([g.property({type:G})],e.prototype,"layer",null);f.__decorate([g.property()],e.prototype,"messages",null);f.__decorate([g.property()],e.prototype,"messagesCommon",void 0);f.__decorate([g.property()],e.prototype,"relatedRecordsEnabled",void 0);f.__decorate([g.property({readOnly:!0,type:z})],e.prototype,"store",void 0);f.__decorate([g.property()],
e.prototype,"view",void 0);return e=f.__decorate([C.subclass("esri.widgets.FeatureTable.FeatureTableViewModel")],e)});