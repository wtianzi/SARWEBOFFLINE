// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["require","exports","../core/maybe","../geometry/SpatialReference","../geometry"],function(z,f,A,B,q){async function x(){r||(r=(async()=>{const c=await new Promise(function(b,a){z(["./arcadeUtils"],b,a)});await c.arcade.load();return{arcade:c.arcade,arcadeUtils:c,Dictionary:c.Dictionary,Feature:c.arcadeFeature}})());return r}let r;q=(c,b,a)=>l.create(c,b,a,null,["$feature","$view"]);let l=function(){function c(a,d,t,k,g,m,e,u){this.script=a;this.evaluate=g;this.fields=e;this._syntaxTree=k;
this._arcade=d;this._arcadeDictionary=t;this._arcadeFeature=m;this._spatialReference=u;this._referencesGeometry=d.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}c.create=async function(a,d,t,k,g,m){const {arcade:e,Feature:u,Dictionary:v}=await x(),w=B.fromJSON(d);d=e.parseScript(a,m);g=g.reduce((h,C)=>({...h,[C]:null}),{});let n=null;A.isSome(k)&&(n=new v(k),n.immutable=!0,g.$config=null);k=e.scriptUsesGeometryEngine(d)&&e.enableGeometrySupport();
m=e.scriptUsesFeatureSet(d)&&e.enableFeatureSetSupport();const y=e.scriptIsAsync(d)&&e.enableAsyncSupport();g={vars:g,spatialReference:w,useAsync:!!y};const p=new v;p.immutable=!1;p.setField("scale",0);const D=e.compileScript(d,g);await Promise.all([k,m,y]);return new c(a,e,v,d,h=>{"$view"in h&&h.$view&&(p.setField("scale",h.$view.scale),h.$view=p);n&&(h.$config=n);return D({vars:h,spatialReference:w})},new u,t,w)};var b=c.prototype;b.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&
(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this.fields});return this._arcadeFeature};b.repurposeAdapter=function(a){this._arcadeFeature.repurposeFromAdapter(a,{fields:this.fields});return this._arcadeFeature};b.createDictionary=function(){return new this._arcadeDictionary};b.referencesMember=function(a){return this._arcade.referencesMember(this._syntaxTree,a)};b.referencesFunction=function(a){return this._arcade.referencesFunction(this._syntaxTree,
a)};b.referencesGeometry=function(){return this._referencesGeometry};b.referencesScale=function(){return this._referencesScale};b.extractFieldLiterals=function(a){return this._arcade.extractFieldLiterals(this._syntaxTree,a)};return c}();f.ArcadeExpression=l;f.createDictionaryExpression=(c,b,a,d)=>l.create(c,b,a,d,["$feature","$view"]);f.createLabelExpression=(c,b,a)=>l.create(c,b,a,null,["$feature"]);f.createRendererExpression=q;f.createVVExpression=q;f.default=l;f.loadArcade=x;Object.defineProperty(f,
"__esModule",{value:!0})});