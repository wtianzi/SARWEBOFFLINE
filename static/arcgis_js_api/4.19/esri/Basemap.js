// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/has ./core/lang ./core/maybe ./core/Logger ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/property ./core/jsonMap ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/urlUtils ./core/uuid ./portal/support/resourceExtension ./core/promiseUtils ./core/JSONSupport ./geometry/SpatialReference ./core/Collection ./core/collectionUtils ./core/Loadable ./portal/Portal ./core/loadAll ./portal/PortalItem ./support/basemapDefinitions ./webdoc/support/writeUtils".split(" "),
function(C,p,h,g,D,v,E,P,l,Q,F,G,r,R,S,t,H,I,u,w,J,x,K,L,y,z){var q;let M=0;const A=E.getLogger("esri.Basemap");g=q=function(m){function k(a){var b=m.call(this,a)||this;b.id=null;b.portalItem=null;b.spatialReference=null;b.thumbnailUrl=null;b.title="Basemap";b.id=Date.now().toString(16)+"-basemap-"+M++;b.baseLayers=new u;b.referenceLayers=new u;const d=c=>{c.parent&&c.parent!==p._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=p._assertThisInitialized(b);"elevation"===c.type&&
A.error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a basemap layer and will therefore be ignored.`)};b.baseLayers.on("after-add",c=>d(c.item));b.referenceLayers.on("after-add",c=>d(c.item));b.baseLayers.on("after-remove",c=>{c.item.parent=null});b.referenceLayers.on("after-remove",c=>{c.item.parent=null});return b}p._inheritsLoose(k,m);var f=k.prototype;f.initialize=function(){this.when().catch(a=>{A.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,
a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};f.destroy=function(){var a,b=this.baseLayers.removeAll();for(const d of b)d.destroy();b=this.referenceLayers.removeAll();for(const d of b)d.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();null==(a=this.portalItem)?void 0:a.destroy();this.portalItem=null};f.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a={...a},delete a.resourceInfo);return a};f._writeBaseLayers=
function(a,b,d){const c=[];a&&(d={...d,layerContainerType:"basemap"},this.baseLayers.forEach(e=>{e=z.getLayerJSON(e,d.webmap?d.webmap.getLayerJSONFromResourceInfo(e):null,d);v.isSome(e)&&c.push(e)}),this.referenceLayers.forEach(e=>{e=z.getLayerJSON(e,d.webmap?d.webmap.getLayerJSONFromResourceInfo(e):null,d);v.isSome(e)&&(e.isReference=!0,c.push(e))}));b.baseMapLayers=c};f.writeTitle=function(a,b){b.title=a||"Basemap"};f.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};
f.loadAll=function(){return K.loadAll(this,a=>{a(this.baseLayers,this.referenceLayers)})};f.clone=function(){const a={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};this.loaded&&(a.loadStatus="loaded");return(new q({resourceInfo:this.resourceInfo})).set(a)};f.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});m.prototype.read.call(this,a,b)};f.write=function(a,b){a=a||{};b&&b.origin||
(b={origin:"web-map",...b});m.prototype.write.call(this,a,b);!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(d=>{d=D.clone(d);d.url&&r.isProtocolRelative(d.url)&&(d.url=`https:${d.url}`);d.templateUrl&&r.isProtocolRelative(d.templateUrl)&&(d.templateUrl=`https:${d.templateUrl}`);return d}));return a};f._loadFromSource=async function(a){const {resourceInfo:b,portalItem:d}=this;t.throwIfAborted(a);const c=[];b?(c.push(this._loadLayersFromJSON(b.data,
b.context?b.context.url:null,a)),b.data.id&&!b.data.title&&c.push(y.getBasemapTitle(b.data.id).then(e=>{e&&this.read({title:e},b.context)}))):d&&c.push(this._loadFromItem(d,a));await Promise.all(c)};f._loadLayersFromJSON=async function(a,b,d){var c=this.resourceInfo&&this.resourceInfo.context;const e=this.portalItem&&this.portalItem.portal||c&&c.portal||null,N=c&&"web-scene"===c.origin?"web-scene":"web-map",{populateOperationalLayers:B}=await new Promise(function(n,O){C(["./layers/support/layersCreator"],
n,O)});c=[];t.throwIfAborted(d);a.baseMapLayers&&Array.isArray(a.baseMapLayers)&&(b={context:{origin:N,url:b,portal:e,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=B(this.baseLayers,a.baseMapLayers.filter(n=>!n.isReference),b),c.push(d),a=B(this.referenceLayers,a.baseMapLayers.filter(n=>n.isReference),b),c.push(a));await t.eachAlways(c)};f._loadFromItem=async function(a,b){const d=await (await a.load(b)).fetchData("json",b),c=r.urlToObject(a.itemUrl);this._set("resourceInfo",
{data:d.baseMap,context:{origin:"web-map",portal:a.portal||x.getDefault(),url:c}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:d.spatialReference},this.resourceInfo.context);this.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||x.getDefault(),url:c});return this._loadLayersFromJSON(this.resourceInfo.data,c,b)};k.fromId=function(a){return(a=y.esriBasemapDefinitions[a])?q.fromJSON(a):null};p._createClass(k,[{key:"baseLayers",
set:function(a){this._set("baseLayers",w.referenceSetter(a,this._get("baseLayers")))}},{key:"referenceLayers",set:function(a){this._set("referenceLayers",w.referenceSetter(a,this._get("referenceLayers")))}}]);return k}(H.JSONSupportMixin(J));h.__decorate([l.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(m,k,f,a){this._writeBaseLayers(m,k,a)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:u}},writer(m,k,f,a){this._writeBaseLayers(m,k,a)}}}}}})],g.prototype,
"baseLayers",null);h.__decorate([l.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"id",void 0);h.__decorate([l.property({type:L})],g.prototype,"portalItem",void 0);h.__decorate([l.property()],g.prototype,"referenceLayers",null);h.__decorate([l.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);h.__decorate([l.property({type:I})],g.prototype,"spatialReference",void 0);h.__decorate([l.property()],g.prototype,"thumbnailUrl",void 0);h.__decorate([l.property({type:String,
json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"title",void 0);h.__decorate([G.writer("title")],g.prototype,"writeTitle",null);return g=q=h.__decorate([F.subclass("esri.Basemap")],g)});