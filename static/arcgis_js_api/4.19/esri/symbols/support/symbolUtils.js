// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./utils".split(" "),function(r,t,B,n,w,q){async function x(a,b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=await new Promise(function(e,d){r(["./previewWebStyleSymbol"],e,d)});return c(a,x,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=await new Promise(function(e,d){r(["./previewSymbol3D"],e,d)}),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=
await new Promise(function(e,d){r(["./previewSymbol2D"],e,d)}),c(a,b);case "cim":return{previewCIMSymbol:c}=await new Promise(function(e,d){r(["./previewCIMSymbol"],e,d)}),c(a,b)}}function v(a){return a&&"opacity"in a?a.opacity*v(a.parent):1}let u=null;t.getDisplayedColor=async function(a,b){var c;if(a){var e=v(a.layer||a.sourceLayer);if(n.isSome(a.symbol)&&(!n.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await a.symbol.fetchSymbol(n.isSome(b)?b.abortOptions:null):a.symbol.clone(),
q.getColorFromSymbol(a,e);var d=n.isSome(b)&&b.renderer||a.get("layer.renderer")||a.get("sourceLayer.renderer"),g=await d.getSymbolAsync(a,b);if(g){g="web-style"===g.type?await g.fetchSymbol(n.isSome(b)?b.abortOptions:null):g.clone();g=q.getColorFromSymbol(g,e);if(!("visualVariables"in d)||"visualVariables"in d&&!d.visualVariables||"visualVariables"in d&&(null==(c=d.visualVariables)||!c.length))return g;d.arcadeRequiredForVisualVariables&&(n.isNone(b)||n.isNone(b.arcade))&&(b={...n.unwrap(b)},b.arcade=
await w.loadArcade());c=await new Promise(function(h,k){r(["../../renderers/visualVariables/support/visualVariableUtils"],h,k)});var l=[],f=[];for(const h of d.visualVariables)switch(h.type){case "color":l.push(h);break;case "opacity":f.push(h)}d=(d=0<l.length?l[l.length-1]:null)?c.getColor(d,a,b):g;a=(g=0<f.length?f[f.length-1]:null)?c.getOpacity(g,a,b):null;null!=e&&(a=null!=a?a*e:e);return d?q.applyOpacityToColor(d,a):null}}};t.getDisplayedSymbol=async function(a,b){if(a){var c=v(a.layer||a.sourceLayer);
if(n.isSome(a.symbol)&&(!n.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await a.symbol.fetchSymbol(n.isSome(b)?b.abortOptions:null):a.symbol.clone(),q.applyColorToSymbol(a,null,c),a;var e=n.isSome(b)&&b.renderer||a.get("layer.renderer")||a.get("sourceLayer.renderer"),d=await e.getSymbolAsync(a,b);if(d){d="web-style"===d.type?await d.fetchSymbol(n.isSome(b)?b.abortOptions:null):d.clone();if(!("visualVariables"in e)||"visualVariables"in e&&!e.visualVariables||"visualVariables"in
e&&e.visualVariables&&!e.visualVariables.length)return d;e.arcadeRequiredForVisualVariables&&(n.isNone(b)||n.isNone(b.arcade))&&(b={...n.unwrap(b)},b.arcade=await w.loadArcade());var g=await new Promise(function(m,p){r(["../../renderers/visualVariables/support/visualVariableUtils"],m,p)}),l=[],f=[],h=[],k=[];for(const m of e.visualVariables)switch(m.type){case "color":l.push(m);break;case "opacity":f.push(m);break;case "rotation":k.push(m);break;case "size":m.target||h.push(m)}e=(e=!!l.length&&l[l.length-
1])?g.getColor(e,a,b):null;f=(f=!!f.length&&f[f.length-1])?g.getOpacity(f,a,b):null;null!=c&&(f=null!=f?f*c:c);q.applyColorToSymbol(d,e,f);h.length&&(c=g.getAllSizes(h,a,b),await q.applySizesToSymbol(d,c));for(const m of k)q.applyRotationToSymbol(d,g.getRotationAngle(m,a,b),m.axis);return d}}};t.renderColorRampPreviewHTML=function(a,b={}){const c="horizontal"===b.align,{width:e=c?75:24,height:d=c?24:75,gradient:g=!0}=b;b=window.devicePixelRatio;var l=e*b,f=d*b;b=document.createElement("canvas");b.width=
l;b.height=f;b.style.width=`${e}px`;b.style.height=`${d}px`;const h=b.getContext("2d");var k=c?l:0,m=c?0:f;if(g){const p=h.createLinearGradient(0,0,k,m),y=1/(a.length-1);a.forEach((z,A)=>p.addColorStop(A*y,z.toString()));h.fillStyle=p;h.fillRect(0,0,l,f)}else{l=c?l/a.length:l;f=c?f:f/a.length;m=k=0;for(const p of a)h.fillStyle=p.toString(),h.fillRect(k,m,l,f),k=c?k+l:0,m=c?0:m+f}a=document.createElement("div");a.style.width=`${e}px`;a.style.height=`${d}px`;a.appendChild(b);return a};t.renderDotDensityPreviewHTML=
function(a,b,c){const {backgroundColor:e,outline:d,dotSize:g}=a;c=c&&c.swatchSize||22;const l=Math.round(c*c/g**2*.8),f=window.devicePixelRatio;a=document.createElement("canvas");const h=c*f;a.width=h;a.height=h;a.style.width=`${a.width/f}px`;a.style.height=`${a.height/f}px`;const k=a.getContext("2d");e&&(k.fillStyle=e.toCss(!0),k.fillRect(0,0,h,h),k.fill());k.fillStyle=b.toCss(!0);if(u&&u.length/2===l)for(b=0;b<2*l;b+=2)k.fillRect(u[b],u[b+1],g*f,g*f),k.fill();else for(u=[],b=0;b<2*l;b+=2){const m=
Math.floor(Math.random()*(h-0+1)),p=Math.floor(Math.random()*(h-0+1));u.push(m,p);k.fillRect(m,p,g*f,g*f);k.fill()}d&&(d.color&&(k.strokeStyle=d.color.toCss(!0)),k.lineWidth=d.width,k.strokeRect(0,0,h,h));c=new Image(c,c);c.src=a.toDataURL();return c};t.renderPreviewHTML=x;Object.defineProperty(t,"__esModule",{value:!0})});