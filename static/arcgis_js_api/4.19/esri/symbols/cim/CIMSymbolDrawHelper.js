// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../geometry/support/boundsUtils ../../geometry/support/jsonUtils ../../geometry/support/aaBoundingRect ./CIMPlacements ./CIMEffects ./CIMOperators ./Rect".split(" "),function(q,y,r,B,n,C,D,E,z,F){const t=Math.PI/180,G=r.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let x=function(){function k(b){this._t=b}k.createIdentity=function(){return new k([1,0,0,0,1,0])};var h=k.prototype;h.clone=function(){return new k(this._t.slice())};
h.transform=function(b){const a=this._t;return[a[0]*b[0]+a[1]*b[1]+a[2],a[3]*b[0]+a[4]*b[1]+a[5]]};k.createScale=function(b,a){return new k([b,0,0,0,a,0])};h.scale=function(b,a){const c=this._t;c[0]*=b;c[1]*=b;c[2]*=b;c[3]*=a;c[4]*=a;c[5]*=a;return this};h.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};k.createTranslate=function(b,a){return new k([0,0,b,0,0,a])};h.translate=function(b,a){const c=this._t;c[2]+=b;c[5]+=a;return this};k.createRotate=function(b){const a=
Math.cos(b);b=Math.sin(b);return new k([a,-b,0,b,a,0])};h.rotate=function(b){return this.multiply(k.createRotate(b))};h.multiply=function(b){const a=this._t;b=b._t;const c=a[1]*b[0]+a[4]*b[1],d=a[2]*b[0]+a[5]*b[1]+b[2],f=a[0]*b[3]+a[3]*b[4],e=a[1]*b[3]+a[4]*b[4],g=a[2]*b[3]+a[5]*b[4]+b[5];a[0]=a[0]*b[0]+a[3]*b[1];a[1]=c;a[2]=d;a[3]=f;a[4]=e;a[5]=g;return this};return k}();r=function(){function k(b){this._transfos=[];this._sizeTransfos=[];this._transfos.push(b||x.createIdentity());this._sizeTransfos.push(b?
b.scaleRatio():1)}var h=k.prototype;h.transformPt=function(b){return this._transfos[this._transfos.length-1].transform(b)};h.transformSize=function(b){return b*this._sizeTransfos[this._sizeTransfos.length-1]};h.back=function(){return this._transfos[this._transfos.length-1]};h.push=function(b,a){a=a?b.scaleRatio():1;b.multiply(this.back());this._transfos.push(b);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*a)};h.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,
1)};h.drawSymbol=function(b,a){if(b)switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(b,a)}};h.drawMultiLayerSymbol=function(b,a){if(b){var c=b.symbolLayers;if(c)if(b=b.effects){if(a=this.executeEffects(b,a))for(b=a.next();b;)this.drawSymbolLayers(c,b),b=a.next()}else this.drawSymbolLayers(c,a)}};h.executeEffects=function(b,a){a=new E.SimpleGeometryCursor(a);for(const c of b)(b=z.getEffectOperator(c))&&(a=b.execute(a,c,1));return a};h.drawSymbolLayers=
function(b,a){let c=b.length;for(;c--;){const f=b[c];if(f&&!1!==f.enable){var d=f.effects;if(d){if(d=this.executeEffects(d,a)){let e=d.next();for(;e;)this.drawSymbolLayer(f,e),e=d.next()}}else this.drawSymbolLayer(f,a)}}};h.drawSymbolLayer=function(b,a){switch(b.type){case "CIMSolidFill":this.drawSolidFill(a,b.color);break;case "CIMHatchFill":this.drawHatchFill(b,a);break;case "CIMSolidStroke":this.drawSolidStroke(a,b.color,b.width,b.capStyle,b.joinStyle,b.miterLimit);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(b,
a)}};h.drawHatchFill=function(b,a){const c=this._buildHatchPolyline(b,a,1);c&&(this.pushClipPath(a),this.drawMultiLayerSymbol(b.lineSymbol,c),this.popClipPath())};h.drawMarkerLayer=function(b,a){var c=b.markerPlacement;if(c){const f=z.getPlacementOperator(c);if(f){var d="CIMMarkerPlacementInsidePolygon"===c.type;d&&this.pushClipPath(a);if(a=f.execute(a,c,1))for(c=a.next();c;)this.drawMarker(b,c),c=a.next();d&&this.popClipPath()}}else d=new D.Placement,d.tx=a.x,d.ty=a.y,this.drawMarker(b,d)};h.drawMarker=
function(b,a){switch(b.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(b,a);break;case "CIMVectorMarker":this.drawVectorMarker(b,a)}};h.drawPictureMarker=function(b,a){if(b){var c=b.size||10,d=x.createIdentity(),f=b.anchorPoint;if(f){let e=f.x;f=f.y;"Absolute"!==b.anchorPointUnits&&(e*=c,f*=c);d.translate(-e,-f)}b.rotation&&d.rotate(b.rotation*t);d.translate(b.offsetX||0,b.offsetY||0);d.translate(a.tx,a.ty);this.push(d,!1);this.drawImage(b.url,c,b.scaleX);this.pop()}};
h.drawVectorMarker=function(b,a){if(b){var c=b.markerGraphics;if(c){var d=b.size,f=b.frame,e=f?f.ymax-f.ymin:0;d=d&&e?d/e:1;e=x.createIdentity();f&&e.translate(.5*-(f.xmax+f.xmin),.5*-(f.ymax+f.ymin));var g=b.anchorPoint;if(g){let l=g.x;g=g.y;"Absolute"!==b.anchorPointUnits&&f&&(l*=f.xmax-f.xmin,g*=f.ymax-f.ymin);e.translate(-l,-g)}1!==d&&e.scale(d,d);b.rotation&&e.rotate(b.rotation*t);e.translate(b.offsetX||0,b.offsetY||0);e.translate(a.tx,a.ty);this.push(e,b.scaleSymbolsProportionally);for(const l of c)l&&
l.symbol&&l.geometry||G.error("Invalid marker graphic",l),this.drawSymbol(l.symbol,l.geometry);this.pop()}}};h._buildHatchPolyline=function(b,a,c){var d=(void 0!==b.separation?b.separation:4)*c,f=void 0!==b.rotation?b.rotation:0;if(0===d)return null;0>d&&(d=-d);for(var e=0,g=.5*d;e>g;)e-=d;for(;e<-g;)e+=d;e=C.create();B.getBoundsXY(e,a);e[0]-=g;e[1]-=g;e[2]+=g;e[3]+=g;for(var l=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]];180<f;)f-=180;for(;0>f;)f+=180;g=Math.cos(f*t);var m=Math.sin(f*t);f=-d*
m;a=d*g;e=(void 0!==b.offsetX?b.offsetX*c:0)*m-(void 0!==b.offsetY?b.offsetY*c:0)*g;let u;var p=b=Number.MAX_VALUE;u=c=-Number.MAX_VALUE;for(var v of l){var w=v[0];const A=v[1];l=g*w+m*A;w=-m*w+g*A;p=Math.min(p,l);b=Math.min(b,w);u=Math.max(u,l);c=Math.max(c,w)}b=Math.floor(b/d)*d;v=g*p-m*b-f*e/d;p=m*p+g*b-a*e/d;l=g*u-m*b-f*e/d;e=m*u+g*b-a*e/d;d=1+Math.round((c-b)/d);g=[];for(m=0;m<d;m++)v+=f,p+=a,l+=f,e+=a,g.push([[v,p],[l,e]]);return{paths:g}};return k}();let H=function(k){function h(){var a=k.call(this)||
this;a.reset();return a}y._inheritsLoose(h,k);var b=h.prototype;b.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0};b.envelope=function(){return new F(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};b.drawSolidFill=function(a){!a||0<this._clipCount||(n.isPolygon(a)?this._processPath(a.rings,0):n.isPolyline(a)&&this._processPath(a.paths,0))};b.drawSolidStroke=function(a,c,d){!a||0<this._clipCount||(c=.5*this.transformSize(d),n.isPolygon(a)?
this._processPath(a.rings,c):n.isPolyline(a)&&this._processPath(a.paths,c))};b.pushClipPath=function(a){this.drawSolidFill(a);++this._clipCount};b.popClipPath=function(){--this._clipCount};b.drawImage=function(a,c,d){a=c/2;this._merge(this.transformPt([0,0]),a)};b._processPath=function(a,c){if(a)for(const d of a)if(a=d?d.length:0,1<a){this._merge(this.transformPt(d[0]),c);for(let f=1;f<a;++f)this._merge(this.transformPt(d[f]),c)}};b._merge=function(a,c){a[0]-c<this._xmin&&(this._xmin=a[0]-c);a[0]+
c>this._xmax&&(this._xmax=a[0]+c);a[1]-c<this._ymin&&(this._ymin=a[1]-c);a[1]+c>this._ymax&&(this._ymax=a[1]+c)};return h}(r),I=function(k){function h(a,c){c=k.call(this,c)||this;c._ctx=a;return c}y._inheritsLoose(h,k);var b=h.prototype;b.drawSolidFill=function(a,c){if(a){if(n.isPolygon(a))this._buildPath(a.rings,!0);else if(n.isPolyline(a))this._buildPath(a.paths,!0);else return;a=this._ctx;a.fillStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/
255+")";a.fill("evenodd")}};b.drawSolidStroke=function(a,c,d,f,e,g){if(a&&c&&0!==d){if(n.isPolygon(a))this._buildPath(a.rings,!0);else if(n.isPolyline(a))this._buildPath(a.paths,!1);else return;a=this._ctx;a.strokeStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/255+")";a.lineWidth=this.transformSize(d)+.5;this._setCapStyle(f);this._setJoinStyle(e);a.miterLimit=g;a.stroke()}};b.pushClipPath=function(a){this._ctx.save();n.isPolygon(a)?this._buildPath(a.rings,
!0):n.isPolyline(a)&&this._buildPath(a.paths,!0);this._ctx.clip("evenodd")};b.popClipPath=function(){this._ctx.restore()};b.drawImage=function(a,c,d){};b._buildPath=function(a,c){const d=this._ctx;d.beginPath();if(a)for(const f of a)if(a=f?f.length:0,1<a){let e=this.transformPt(f[0]);d.moveTo(e[0],e[1]);for(let g=1;g<a;++g)e=this.transformPt(f[g]),d.lineTo(e[0],e[1]);c&&d.closePath()}};b._setCapStyle=function(a){switch(a){case "Butt":this._ctx.lineCap="butt";break;case "Round":this._ctx.lineCap="round";
break;case "Square":this._ctx.lineCap="square"}};b._setJoinStyle=function(a){switch(a){case "Bevel":this._ctx.lineJoin="bevel";break;case "Round":this._ctx.lineJoin="round";break;case "Miter":this._ctx.lineJoin="miter"}};return h}(r);q.CIMSymbolDrawHelper=r;q.C_DEG_TO_RAD=t;q.CanvasDrawHelper=I;q.EnvDrawHelper=H;q.Transformation=x;Object.defineProperty(q,"__esModule",{value:!0})});