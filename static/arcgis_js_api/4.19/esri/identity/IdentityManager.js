// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
/*
 tabbable 5.1.6
 @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
 focus-trap 6.3.0
 @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/lang ../core/object ../config ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/events ../core/promiseUtils ../core/Evented ../kernel ../request ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),
function(y,u,p,A,x,v,E,U,na,pa,O,ca,T,z,r,C,ha,X,L,H,F,V,ia,aa,R,ja,da){const Y={},ka=P=>{const S=(new r.Url(P.owningSystemUrl)).host;P=(new r.Url(P.server)).host;const n=/.+\.arcgis\.com$/i;return n.test(S)&&n.test(P)},ea=(P,S)=>!!(ka(P)&&S&&S.some(n=>n.test(P.server)));let la=null,ma=null;try{la=window.localStorage,ma=window.sessionStorage}catch{}y.IdentityManagerBase=function(P){function S(){var a=P.call(this)||this;a._portalConfig=A.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=
[];a._soReqs=[];a._xoReqs=[];a._portals=[];a.defaultOAuthInfo=null;a.defaultTokenValidity=60;a.dialog=null;a.formConstructor=ia;a.tokenValidity=null;a.normalizeWebTierAuth=!1;a._appUrlObj=r.urlToObject(window.location.href);a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._gwDomains=
[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,
customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",c=>{a._pageShowHandler(c)});return a}u._inheritsLoose(S,P);var n=S.prototype;n.registerServers=function(a){const c=this.serverInfos;c?(a=a.filter(b=>!this.findServerInfo(b.server)),this.serverInfos=c.concat(a)):
this.serverInfos=a;a.forEach(b=>{b.owningSystemUrl&&this._portals.push(b.owningSystemUrl);b.hasPortal&&this._portals.push(b.server)})};n.registerOAuthInfos=function(a){const c=this.oAuthInfos;if(c){for(const b of a){const d=this.findOAuthInfo(b.portalUrl);d&&c.splice(c.indexOf(d),1)}this.oAuthInfos=c.concat(a)}else this.oAuthInfos=a};n.registerToken=function(a){a={...a};const c=this._sanitizeUrl(a.server),b=this._isServerRsrc(c);let d=this.findServerInfo(c),e=!0,f;d||(d=new da,d.server=this._getServerInstanceRoot(c),
b?d.hasServer=!0:(d.tokenServiceUrl=this._getTokenSvcUrl(c),d.hasPortal=!0),this.registerServers([d]));(f=this._findCredential(c))?(delete a.server,Object.assign(f,a),e=!1):(f=new y.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:b?"server":"portal"}),f.resources=[c],this.credentials.push(f));f.emitTokenChange(!1);e||f.refreshServerTokens()};n.toJSON=function(){return v.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>
a.toJSON()),credentials:this.credentials.map(a=>a.toJSON())})};n.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var c=a.serverInfos,b=a.oAuthInfos;a=a.credentials;if(c){const d=[];c.forEach(e=>{e.server&&e.tokenServiceUrl&&d.push(e.declaredClass?e:new da(e))});d.length&&this.registerServers(d)}if(b){const d=[];b.forEach(e=>{e.appId&&d.push(e.declaredClass?e:new ja(e))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&d.token&&d.expires&&d.expires>Date.now()&&(d=
d.declaredClass?d:new y.Credential(d),d.emitTokenChange(),this.credentials.push(d))})}};n.findServerInfo=function(a){let c;a=this._sanitizeUrl(a);for(const b of this.serverInfos)if(this._hasSameServerInstance(b.server,a)){c=b;break}return c};n.findOAuthInfo=function(a){let c;a=this._sanitizeUrl(a);for(const b of this.oAuthInfos)if(this._hasSameServerInstance(b.portalUrl,a)){c=b;break}return c};n.findCredential=function(a,c){let b;a=this._sanitizeUrl(a);const d=this._isServerRsrc(a)?"server":"portal";
if(c)for(const e of this.credentials){if(this._hasSameServerInstance(e.server,a)&&c===e.userId&&e.scope===d){b=e;break}}else for(const e of this.credentials)if(this._hasSameServerInstance(e.server,a)&&-1!==this._getIdenticalSvcIdx(a,e)&&e.scope===d){b=e;break}return b};n.getCredential=function(a,c){let b=!0;if(c){var d=!!c.token;var e=c.error;b=!1!==c.prompt}c={...c};a=this._sanitizeUrl(a);const f=L.createAbortController(),h=L.createResolver();if(c.signal)L.onAbort(c.signal,()=>{f.abort()});L.onAbort(f,
()=>{h.reject(new z("identity-manager:user-aborted","ABORTED"))});if(L.isAborted(f))return h.promise;c.signal=f.signal;const l=this._isAdminResource(a);if((d=d?this.findCredential(a):null)&&e&&e.details&&498===e.details.httpStatus)d.destroy();else if(d)return a=new z("identity-manager:not-authorized","You are currently signed in as: '"+d.userId+"'. You do not have access to this resource: "+a,{error:e}),h.reject(a),h.promise;if(e=this._findCredential(a,c))return h.resolve(e),h.promise;let g=this.findServerInfo(a);
if(g)!g.hasServer&&this._isServerRsrc(a)&&(g._restInfoPms=this._getTokenSvcUrl(a),g.hasServer=!0);else{e=this._getTokenSvcUrl(a);if(!e)return a=new z("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),h.reject(a),h.promise;g=new da;g.server=this._getServerInstanceRoot(a);"string"===typeof e?(g.tokenServiceUrl=e,g.hasPortal=!0):(g._restInfoPms=e,g.hasServer=!0);this.registerServers([g])}g.hasPortal&&void 0===g._selfReq&&(b||r.hasSameOrigin(g.tokenServiceUrl,
window.location.origin)||this._gwDomains.some(k=>k.tokenServiceUrl===g.tokenServiceUrl))&&(g._selfReq={owningTenant:c&&c.owningTenant,selfDfd:this._getPortalSelf(g.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,g,c,h,l)};n.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,
"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};n.generateToken=function(a,c,b){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),e=new r.Url(window.location.href.toLowerCase());var f=a.shortLivedTokenValidity;let h,l,g,k,t,q,G;c&&(G=this.tokenValidity||f||this.defaultTokenValidity,G>f&&0<f&&(G=f));b&&(h=b.isAdmin,l=b.serverUrl,g=b.token,t=b.signal,q=b.ssl,a.customParameters=b.customParameters);h?f=a.adminTokenServiceUrl:(f=a.tokenServiceUrl,k=new r.Url(f.toLowerCase()),a.webTierAuth&&
b&&b.serverUrl&&!q&&"http"===e.scheme&&(r.hasSameOrigin(e.uri,f,!0)||"https"===k.scheme&&e.host===k.host&&"7080"===e.port&&"7443"===k.port)&&(f=f.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));b={query:{request:"getToken",username:null==c?void 0:c.username,password:null==c?void 0:c.password,serverUrl:l,token:g,expiration:G,referer:h||d?window.location.host:null,client:h?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,b),signal:t,
...null==b?void 0:b.ioArgs};d||(b.withCredentials=!1);return V(f,b).then(B=>{B=B.data;if(!B||!B.token)return new z("identity-manager:authentication-failed","Unable to generate token");const w=a.server;Y[w]||(Y[w]={});c&&(Y[w][c.username]=c.password);B.validity=G;return B})};n.isBusy=function(){return!!this._busy};n.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(c=>c.credential)};n.checkAppAccess=function(a,c,b){let d=!1;return this.getCredential(a,{prompt:!1}).then(e=>{let f;
const h={f:"json"};if("portal"===e.scope)if(c&&(this._doPortalSignIn(a)||b&&b.force))f=e.server+"/sharing/rest/oauth2/validateAppAccess",h.client_id=c;else if(e.token)f=e.server+"/sharing/rest";else return{credential:e};else if(e.token)f=e.server+"/rest/services";else return{credential:e};e.token&&(h.token=e.token);return V(f,{query:h,authMode:"anonymous"}).then(l=>{if(!1===l.data.valid)throw new z("identity-manager:not-authorized",`You are currently signed in as: '${e.userId}'.`,l.data);d=!!l.data.viewOnlyUserTypeApp;
return{credential:e}}).catch(l=>{if("identity-manager:not-authorized"===l.name)throw l;l=l.details&&l.details.httpStatus;if(498===l)throw e.destroy(),new z("identity-manager:not-authenticated","User is not signed in.");if(400===l)throw new z("identity-manager:invalid-request");return{credential:e}})}).then(e=>({credential:e.credential,viewOnly:d}))};n.setOAuthResponseHash=function(a){var c;const b=this._oAuthDfd;this._oAuthDfd=null;if(b&&a)if(clearInterval(this._oAuthIntervalId),null==(c=this._oAuthOnHashHandle)?
void 0:c.remove(),"#"===a.charAt(0)&&(a=a.substring(1)),a=r.queryToObject(a),a.error)c="access_denied"===a.error,a=new z(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":"OAuth: "+a.error+" - "+a.error_description),b.reject(a);else{c=b.oinfo_;const d=c._oAuthCred,e=new y.Credential({userId:a.username,server:b.sinfo_.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:d});c.userId=e.userId;d.storage=a.persist?la:
ma;d.token=e.token;d.expires=e.expires;d.userId=e.userId;d.ssl=e.ssl;d.save();b.resolve(e)}};n.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};n.setProtocolErrorHandler=function(a){this._protocolFunc=a};n.signIn=function(a,c,b={}){const d=L.createResolver(),e=()=>{var t,q,G,B,w;null==(t=l)?void 0:t.remove();null==(q=g)?void 0:q.remove();null==(G=k)?void 0:G.remove();null==(B=h)?void 0:B.destroy();null==(w=this.dialog)?void 0:w.destroy();this.dialog=h=l=g=k=null},f=()=>{e();this._oAuthDfd=
null;d.reject(new z("identity-manager:user-aborted","ABORTED"))};if(b.signal)L.onAbort(b.signal,()=>{f()});let h=new this.formConstructor;h.resource=this.getResourceName(a);h.server=c.server;this.dialog=new aa;this.dialog.content=h;this.dialog.open=!0;this.emit("dialog-create");let l=h.on("cancel",f),g=this.dialog.watch("open",f),k=h.on("submit",t=>{this.generateToken(c,t,{isAdmin:b.isAdmin,signal:b.signal}).then(q=>{e();q=new y.Credential({userId:t.username,server:c.server,token:q.token,expires:null!=
q.expires?Number(q.expires):null,ssl:!!q.ssl,isAdmin:b.isAdmin,validity:q.validity});d.resolve(q)}).catch(q=>{h.error=q;h.signingIn=!1})});return d.promise};n.oAuthSignIn=function(a,c,b,d){const e=this._oAuthDfd=L.createResolver();if(null!=d&&d.signal)L.onAbort(d.signal,()=>{const q=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;q&&!q.closed?q.close():this.dialog&&h()});e.resUrl_=a;e.sinfo_=c;e.oinfo_=b;d=!d||!1!==d.oAuthPopupConfirmation;if(!b.popup||!d)return this._doOAuthSignIn(a,c,b),e.promise;const f=
new this.formConstructor;f.oAuthPrompt=!0;f.server=c.server;this.dialog=new aa;this.dialog.content=f;this.dialog.open=!0;this.emit("dialog-create");const h=()=>{t();this._oAuthDfd=null;e.reject(new z("identity-manager:user-aborted","ABORTED"))},l=f.on("cancel",h),g=this.dialog.watch("open",h),k=f.on("submit",()=>{t();this._doOAuthSignIn(a,c,b)}),t=()=>{l.remove();g.remove();k.remove();f.destroy();this.dialog.destroy();this.dialog=null};return e.promise};n.destroyCredentials=function(){this.credentials&&
this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};n.enablePostMessageAuth=function(a="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=X.on(window,"message",c=>{var b;if((c.origin===window.location.origin||c.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(b=c.data)?void 0:b.type)){const d=c.source;this.getCredential(a).then(e=>{d.postMessage({type:"arcgis:auth:credential",
credential:{expires:e.expires,server:e.server,ssl:e.ssl,token:e.token,userId:e.userId}},c.origin)}).catch(e=>{d.postMessage({type:"arcgis:auth:error",error:{name:e.name,message:e.message}},c.origin)})}})};n.disablePostMessageAuth=function(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)};n._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));a=r.queryToObject(a);let c=!1;if(a.access_token&&a.expires_in&&
a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),"object"===typeof a.state&&a.state.portalUrl&&(this._oAuthHash=a,c=!0)}catch{}else a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(c=!0));c&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};n._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new z("identity-manager:user-aborted",
"ABORTED"),this._errbackFunc(a))};n._findCredential=function(a,c){let b=-1,d,e,f;const h=c&&c.token;c=c&&c.resource;const l=this._isServerRsrc(a)?"server":"portal",g=this.credentials.filter(k=>this._hasSameServerInstance(k.server,a)&&k.scope===l);a=c||a;if(g.length)if(1===g.length)if(c=g[0],e=(d=(f=this.findServerInfo(c.server))&&f.owningSystemUrl)&&this.findCredential(d,c.userId),b=this._getIdenticalSvcIdx(a,c),h)-1!==b&&(c.resources.splice(b,1),this._removeResource(a,e));else return-1===b&&c.resources.push(a),
this._addResource(a,e),c;else{let k,t;g.some(q=>{t=this._getIdenticalSvcIdx(a,q);return-1!==t?(k=q,e=(d=(f=this.findServerInfo(k.server))&&f.owningSystemUrl)&&this.findCredential(d,k.userId),b=t,!0):!1});if(h)k&&(k.resources.splice(b,1),this._removeResource(a,e));else if(k)return this._addResource(a,e),k}};n._findOAuthInfo=function(a){let c=this.findOAuthInfo(a);if(!c)for(const b of this.oAuthInfos)if(this._isIdProvider(b.portalUrl,a)){c=b;break}return c};n._addResource=function(a,c){c&&-1===this._getIdenticalSvcIdx(a,
c)&&c.resources.push(a)};n._removeResource=function(a,c){let b=-1;c&&(b=this._getIdenticalSvcIdx(a,c),-1<b&&c.resources.splice(b,1))};n._useProxy=function(a,c){return c&&c.isAdmin&&!r.hasSameOrigin(a.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!r.hasSameOrigin(a.tokenServiceUrl,window.location.href)};n._getOrigin=function(a){a=new r.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};n._getServerInstanceRoot=
function(a){const c=a.toLowerCase();let b=c.indexOf(this._agsRest);-1===b&&this._isAdminResource(a)&&(b=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===b&&(b=c.indexOf("/sharing"));-1===b&&"/"===c.substr(-1)&&(b=c.length-1);return-1<b?a.substring(0,b):a};n._hasSameServerInstance=function(a,c){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();c=this._getServerInstanceRoot(c).toLowerCase();a=this._normalizeAGOLorgDomain(a);c=this._normalizeAGOLorgDomain(c);
a=a.substr(a.indexOf(":"));c=c.substr(c.indexOf(":"));return a===c};n._normalizeAGOLorgDomain=function(a){const c=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,b=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;c.test(a)?a=a.replace(c,"https://www.arcgis.com"):b.test(a)?a=a.replace(b,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a};n._sanitizeUrl=function(a){const c=(U.request.proxyUrl||
"").toLowerCase(),b=c?a.toLowerCase().indexOf(c+"?"):-1;-1!==b&&(a=a.substring(b+c.length+1));a=r.normalize(a);return r.urlToObject(a).path};n._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};n._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};n._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};n._isIdenticalService=function(a,c){if(this._isRESTService(a)&&this._isRESTService(c)){a=this._getSuffix(a).toLowerCase();c=
this._getSuffix(c).toLowerCase();var b=a===c;b||(b=/(.*)\/(MapServer|FeatureServer).*/gi,b=a.replace(b,"$1")===c.replace(b,"$1"))}else this._isAdminResource(a)&&this._isAdminResource(c)?b=!0:this._isServerRsrc(a)||this._isServerRsrc(c)||!this._isPortalDomain(a)||(b=!0);return b};n._isPortalDomain=function(a){const c=new r.Url(a.toLowerCase());a=this._portalConfig;let b=this._gwDomains.some(d=>d.regex.test(c.uri));!b&&a&&(b=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),c.uri));
b||U.portalUrl&&(b=r.hasSameOrigin(c,U.portalUrl,!0));b||(b=this._portals.some(d=>this._hasSameServerInstance(d,c.uri)));return b=b||this._agsPortal.test(c.path)};n._isIdProvider=function(a,c){let b=-1,d=-1;this._gwDomains.forEach((f,h)=>{-1===b&&f.regex.test(a)&&(b=h);-1===d&&f.regex.test(c)&&(d=h)});let e=!1;if(-1<b&&-1<d)if(0===b||4===b){if(0===d||4===d)e=!0}else if(1===b){if(1===d||2===d)e=!0}else 2===b?2===d&&(e=!0):3===b&&3===d&&(e=!0);if(!e){const f=this.findServerInfo(c),h=f&&f.owningSystemUrl;
h&&ka(f)&&this._isPortalDomain(h)&&this._isIdProvider(a,h)&&(e=!0)}return e};n._getIdenticalSvcIdx=function(a,c){let b=-1;for(let d=0;d<c.resources.length;d++)if(this._isIdenticalService(a,c.resources[d])){b=d;break}return b};n._getSuffix=function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};n._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var c=this._getServerInstanceRoot(a);var b=c+"/admin/generateToken";a=c+"/rest/info";c=V(a,
{query:{f:"json"}}).then(d=>d.data);return{adminUrl:b,promise:c}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(e=>{e.regex.test(a)&&(d=e.tokenServiceUrl);return!!d});d||this._portals.some(e=>{this._hasSameServerInstance(e,a)&&(d=e+this._gwTokenUrl);return!!d});d||(b=a.toLowerCase().indexOf("/sharing"),-1!==b&&(d=a.substring(0,b)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(b=(new r.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===b&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,
"https:"));return d}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};n._exchangeToken=function(a,c,b){return V(`${a}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:c,token:b}}).then(d=>d.data.token)};n._getPlatformSelf=function(a,c){return V(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":c,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,
"")},method:"post",query:{f:"json"},withCredentials:!0}).then(b=>b.data)};n._getPortalSelf=function(a,c){let b;this._gwDomains.some(d=>{d.regex.test(a)&&(b=d.customBaseUrl);return!!b});if(b)return Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:b,portalMode:"multitenant",supportsOAuth:!0});"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(c)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return V(a,{query:{f:"json"},
authMode:"anonymous",withCredentials:!0}).then(d=>d.data)};n._doPortalSignIn=function(a){const c=this._portalConfig,b=window.location.href,d=this.findServerInfo(a);return(c||this._isPortalDomain(b))&&(d?d.hasPortal||d.owningSystemUrl&&this._isPortalDomain(d.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(b,a)||c&&(this._hasSameServerInstance(this._getServerInstanceRoot(c.restBaseUrl),a)||this._isIdProvider(c.restBaseUrl,a))||r.hasSameOrigin(b,a,!0))?!0:!1};n._checkProtocol=function(a,
c,b,d){let e=!0;d=d?c.adminTokenServiceUrl:c.tokenServiceUrl;0===d.trim().toLowerCase().indexOf("https:")&&0!==window.location.href.toLowerCase().indexOf("https:")&&r.getProxyRule(d)&&(e=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:c}):!1,e||(a=new z("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),b(a)));return e};n._enqueue=function(a,c,b,d,e,f){d||(d=L.createResolver());d.resUrl_=a;d.sinfo_=c;d.options_=b;d.admin_=
e;d.refresh_=f;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d.promise};n._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const c=g=>{var k=a.options_&&a.options_.resource;const t=a.resUrl_,q=a.refresh_;let G=!1;-1===this.credentials.indexOf(g)&&(q&&-1!==this.credentials.indexOf(q)?(q.userId=
g.userId,q.token=g.token,q.expires=g.expires,q.validity=g.validity,q.ssl=g.ssl,q.creationTime=g.creationTime,G=!0,g=q):this.credentials.push(g));g.resources||(g.resources=[]);g.resources.push(k||t);g.scope=this._isServerRsrc(t)?"server":"portal";g.emitTokenChange();k=this._soReqs;const B={};this._soReqs=[];k.forEach(w=>{if(!this._isIdenticalService(t,w.resUrl_)){const J=this._getSuffix(w.resUrl_);B[J]||(B[J]=!0,g.resources.push(w.resUrl_))}});a.resolve(g);k.forEach(w=>{this._hasSameServerInstance(this._getServerInstanceRoot(t),
w.resUrl_)?w.resolve(g):this._soReqs.push(w)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;G||this.emit("credential-create",{credential:g});this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},b=g=>{a.reject(g);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=(g,k,t,q)=>{var G,B;const w=a.sinfo_,J=!a.options_||!1!==a.options_.prompt,
M=w.hasPortal&&this._findOAuthInfo(a.resUrl_);let K,fa;if(g)c(new y.Credential({userId:g,server:w.server,token:t||null,expires:null!=q?Number(q):null,ssl:!!k}));else if(window!==window.parent&&null!=(G=this._appUrlObj.query)&&G["arcgis-auth-origin"]&&null!=(B=this._appUrlObj.query)&&B["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){var qa;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);
const D=X.on(window,"message",Q=>{Q.source===window.parent&&Q.data&&("arcgis:auth:credential"===Q.data.type?(D.remove(),c(new y.Credential(Q.data.credential))):"arcgis:auth:error"===Q.data.type&&(D.remove(),b(z.fromJSON(Q.data.error))))});L.onAbort(null==(qa=a.options_)?void 0:qa.signal,()=>{D.remove()})}else if(M){let D=M._oAuthCred;D||(g=new R(M,la),k=new R(M,ma),g.isValid()&&k.isValid()?g.expires>k.expires?(D=g,k.destroy()):(D=k,g.destroy()):D=g.isValid()?g:k,M._oAuthCred=D);if(D.isValid())K=new y.Credential({userId:D.userId,
server:w.server,token:D.token,expires:D.expires,ssl:D.ssl,_oAuthCred:D}),M.appId!==D.appId&&this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._exchangeToken(K.server,M.appId,K.token).then(Q=>{K.token=Q;D.token=Q;D.save();c(K)}).catch(()=>{c(K)}):c(K);else if(this._oAuthHash&&this._hasSameServerInstance(M.portalUrl,this._oAuthHash.state.portalUrl))g=this._oAuthHash,K=new y.Credential({userId:g.username,server:w.server,token:g.access_token,expires:Date.now()+1E3*Number(g.expires_in),ssl:"true"===g.ssl,
oAuthState:g.state,_oAuthCred:D}),M.userId=K.userId,D.storage=g.persist?la:ma,D.token=K.token,D.expires=K.expires,D.userId=K.userId,D.ssl=K.ssl,D.save(),this._oAuthHash=null,c(K);else{const Q=()=>{J?a._pendingDfd=this.oAuthSignIn(a.resUrl_,w,M,a.options_).then(c,b):(fa=new z("identity-manager:not-authenticated","User is not signed in."),b(fa))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(w.server,M.appId).then(({portalUrl:oa,token:ra,username:W})=>{!oa||r.hasSameOrigin(oa,
window.location.origin,!0)?(K=new y.Credential({server:w.server,userId:W,token:ra}),c(K)):Q()}).catch(Q):Q()}}else J?this._checkProtocol(a.resUrl_,w,b,a.admin_)&&(g=a.options_,a.admin_&&(g=g||{},g.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,w,g).then(c,b)):(fa=new z("identity-manager:not-authenticated","User is not signed in."),b(fa))},e=()=>{const g=a.sinfo_;var k=g.owningSystemUrl;const t=a.options_;let q,G,B,w;t&&(q=t.token,G=t.error,B=t.prompt);w=this._findCredential(k,{token:q,resource:a.resUrl_});
if(!w)for(const J of this.credentials)if(this._isIdProvider(k,J.server)){w=J;break}w?(k=this.findCredential(a.resUrl_,w.userId))?c(k):ea(g,this._legacyFed)?(k=w.toJSON(),k.server=g.server,k.resources=null,c(new y.Credential(k))):(a._pendingDfd=this.generateToken(this.findServerInfo(w.server),null,{serverUrl:a.resUrl_,token:w.token,signal:a.options_.signal,ssl:w.ssl})).then(J=>{c(new y.Credential({userId:w.userId,server:g.server,token:J.token,expires:null!=J.expires?Number(J.expires):null,ssl:!!J.ssl,
isAdmin:a.admin_,validity:J.validity}))},b):(this._busy=null,q&&(a.options_.token=null),(a._pendingDfd=this.getCredential(k.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:g.owningTenant,signal:a.options_.signal,token:q,error:G,prompt:B})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},J=>{b(J)}))};this._errbackFunc=b;const f=a.sinfo_.owningSystemUrl,h=this._isServerRsrc(a.resUrl_),l=a.sinfo_._restInfoPms;l?l.promise.then(g=>{const k=a.sinfo_;k._restInfoPms&&(k.adminTokenServiceUrl=
k._restInfoPms.adminUrl,k._restInfoPms=null,k.tokenServiceUrl=E.getDeepValue("authInfo.tokenServicesUrl",g)||E.getDeepValue("authInfo.tokenServiceUrl",g)||E.getDeepValue("tokenServiceUrl",g),k.shortLivedTokenValidity=E.getDeepValue("authInfo.shortLivedTokenValidity",g),k.currentVersion=g.currentVersion,k.owningTenant=g.owningTenant,(g=k.owningSystemUrl=g.owningSystemUrl)&&this._portals.push(g));h&&k.owningSystemUrl?e():d()},()=>{a.sinfo_._restInfoPms=null;const g=new z("identity-manager:server-identification-failed",
"Unknown resource - could not find token service endpoint.");b(g)}):h&&f?e():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(g=>{const k={};let t,q,G,B;g&&(t=g.user&&g.user.username,k.username=t,k.allSSL=g.allSSL,q=g.supportsOAuth,G=g.currentVersion,"multitenant"===g.portalMode&&(B=g.customBaseUrl));a.sinfo_.webTierAuth=!!t;return t&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:k.allSSL}).catch(()=>null).then(w=>{k.portalToken=w&&w.token;k.tokenExpiration=w&&w.expires;return k}):
!t&&q&&4.4<=parseFloat(G)&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:B,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>k):k}).catch(()=>null).then(g=>{a.sinfo_._selfReq=null;g?d(g.username,g.allSSL,g.portalToken,g.tokenExpiration):d()}):d()};n._generateOAuthInfo=function(a){let c,b=a.portalUrl;const d=a.customBaseUrl,e=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){c=
window.location.href;let f=c.indexOf("?");-1<f&&(c=c.slice(0,f));f=c.search(/\/(apps|home)\//);c=-1<f?c.slice(0,f):null}a&&c?(this._hasTestedIfAppIsOnPortal=!0,a=V(c+"/sharing/rest",{query:{f:"json"}}).then(()=>{this.defaultOAuthInfo=new ja({appId:"arcgisonline",popupCallbackUrl:c+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this.defaultOAuthInfo)return b=b.replace(/^http:/i,"https:"),V(b+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:e,client_id:this.defaultOAuthInfo.appId,
redirect_uri:r.makeAbsolute(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(f=>{if(f.data.valid){const h=this.defaultOAuthInfo.clone();h.portalUrl=f.data.urlKey&&d?"https://"+f.data.urlKey.toLowerCase()+"."+d:b;h.popup=window!==window.top||!(r.hasSameOrigin(b,window.location.origin)||this._gwDomains.some(l=>l.regex.test(b)&&l.regex.test(window.location.origin)));this.oAuthInfos.push(h)}})})};n._doOAuthSignIn=function(a,c,b){var d={portalUrl:b.portalUrl};!b.popup&&b.preserveUrlHash&&window.location.hash&&
(d.hash=window.location.hash);d={client_id:b.appId,response_type:"token",state:JSON.stringify(d),expiration:b.expiration,locale:b.locale,redirect_uri:b.popup?r.makeAbsolute(b.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};b.forceLogin&&(d.force_login=!0);b.forceUserId&&b.userId&&(d.prepopulatedusername=b.userId);!b.popup&&this._doPortalSignIn(a)&&(d.redirectToUserOrgUrl=!0);const e=b.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",f=e+"?"+r.objectToQuery(d);if(b.popup){const h=
window.open(f,"esriJSAPIOAuth",b.popupWindowFeatures);h?(h.focus(),this._oAuthDfd.oAuthWin_=h,this._oAuthIntervalId=setInterval(()=>{if(h.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnHashHandle.remove();const l=this._oAuthDfd;if(l){const g=new z("identity-manager:user-aborted","ABORTED");l.reject(g)}}},500),this._oAuthOnHashHandle=X.on(A,"arcgis:auth:hash",l=>{this.setOAuthResponseHash(l.detail)})):(a=new z("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=
!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:d,authorizeUrl:e,resourceUrl:a,serverInfo:c,oAuthInfo:b}):window.location.href=f};return S}(H);y.IdentityManagerBase=p.__decorate([T.subclass("esri.identity.IdentityManagerBase")],y.IdentityManagerBase);y.Credential=function(P){function S(a){var c=P.call(this,a)||this;c._oAuthCred=null;c.tokenRefreshBuffer=2;a&&a._oAuthCred&&(c._oAuthCred=a._oAuthCred);return c}u._inheritsLoose(S,P);var n=S.prototype;n.initialize=function(){this.resources=
this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};n.refreshToken=function(){const a=F.id.findServerInfo(this.server),c=a&&a.owningSystemUrl,b=!!c&&"server"===this.scope,d=b&&ea(a,F.id._legacyFed);var e=a.webTierAuth;const f=e&&F.id.normalizeWebTierAuth;var h=Y[this.server];h=h&&h[this.userId];let l=this.resources&&this.resources[0],g=b&&F.id.findServerInfo(c),k={username:this.userId,password:h},t;if(!e||f)if(b&&!g&&F.id.serverInfos.some(q=>{F.id._isIdProvider(c,q.server)&&
(g=q);return!!g}),e=g&&F.id.findCredential(g.server,this.userId),!b||e)if(d)e.refreshToken();else{if(b)t={serverUrl:l,token:e&&e.token,ssl:e&&e.ssl};else if(f)k=null,t={ssl:this.ssl};else if(h)this.isAdmin&&(t={isAdmin:!0});else{let q;l&&(l=F.id._sanitizeUrl(l),this._enqueued=1,q=F.id._enqueue(l,a,null,null,this.isAdmin,this),q.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return q}return F.id.generateToken(b?g:a,b?null:k,t).then(q=>{this.token=q.token;this.expires=
null!=q.expires?Number(q.expires):null;this.creationTime=Date.now();this.validity=q.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>{})}};n.refreshServerTokens=function(){"portal"===this.scope&&F.id.credentials.forEach(a=>{const c=F.id.findServerInfo(a.server),b=c&&c.owningSystemUrl;a!==this&&a.userId===this.userId&&b&&"server"===a.scope&&(F.id._hasSameServerInstance(this.server,b)||F.id._isIdProvider(b,this.server))&&(ea(c,F.id._legacyFed)?(a.token=this.token,a.expires=this.expires,
a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};n.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var c=this.server&&F.id.findServerInfo(this.server);const b=(c=c&&c.owningSystemUrl)&&F.id.findServerInfo(c);!1===a||c&&"portal"!==this.scope&&(!b||!b.webTierAuth||F.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};n.destroy=function(){this.userId=this.server=this.token=
this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=F.id.credentials.indexOf(this);-1<a&&F.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};n.toJSON=function(){const a=v.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),c=this.resources;c&&0<c.length&&
(a.resources=c.slice());return a};n._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,c=2**31-1;let b=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();0>b?b=0:b>c&&(b=c);this._refreshTimer=setTimeout(this.refreshToken.bind(this),b>a?b-a:b)};return S}(H.EventedAccessor);p.__decorate([O.property()],y.Credential.prototype,"creationTime",void 0);p.__decorate([O.property()],y.Credential.prototype,"expires",void 0);p.__decorate([O.property()],
y.Credential.prototype,"isAdmin",void 0);p.__decorate([O.property()],y.Credential.prototype,"oAuthState",void 0);p.__decorate([O.property()],y.Credential.prototype,"resources",void 0);p.__decorate([O.property()],y.Credential.prototype,"scope",void 0);p.__decorate([O.property()],y.Credential.prototype,"server",void 0);p.__decorate([O.property()],y.Credential.prototype,"ssl",void 0);p.__decorate([O.property()],y.Credential.prototype,"token",void 0);p.__decorate([O.property()],y.Credential.prototype,
"tokenRefreshBuffer",void 0);p.__decorate([O.property()],y.Credential.prototype,"userId",void 0);p.__decorate([O.property()],y.Credential.prototype,"validity",void 0);y.Credential=p.__decorate([T.subclass("esri.identity.Credential")],y.Credential);Object.defineProperty(y,"__esModule",{value:!0})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../intl/substitute ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../chunks/index ../widgets/Widget".split(" "),
function(y,u,p,A,x,v,E,U,na,pa,O,ca,T,z,r,C){p=function(ha){function X(H,F){H=ha.call(this,H,F)||this;H._usernameInputNode=null;H._passwordInputNode=null;H.messages=null;H.signingIn=!1;H.server=null;H.resource=null;H.error=null;H.oAuthPrompt=!1;return H}y._inheritsLoose(X,ha);var L=X.prototype;L.render=function(){const {error:H,server:F,resource:V,signingIn:ia,oAuthPrompt:aa,messages:R}=this,ja=r.jsx("div",{class:"esri-identity-form__group"},ca.substitute(aa?R.oAuthInfo:R.info,{server:/\.arcgis\.com/i.test(F)?
"ArcGIS Online":F,resource:`(${V||R.lblItem})`})),da=aa?null:r.jsx("div",{class:"esri-identity-form__group"},r.jsx("label",{class:"esri-identity-form__label"},R.lblUser,r.jsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:T.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),Y=aa?null:r.jsx("div",{class:"esri-identity-form__group"},r.jsx("label",{class:"esri-identity-form__label"},R.lblPwd,r.jsx("input",{value:"",required:!0,type:"password",
bind:this,afterCreate:T.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),ka=r.jsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},r.jsx("input",{type:"submit",disabled:!!ia,value:ia?R.lblSigning:R.lblOk,class:"esri-button"}),r.jsx("input",{type:"button",value:R.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),ea=H?r.jsx("div",null,H.details&&H.details.httpStatus?R.invalidUser:R.noAuthService):
null;return r.jsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},ja,ea,da,Y,ka)};L._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};L._submit=function(H){H.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})};
return X}(C);u.__decorate([v.property(),z.messageBundle("esri/identity/t9n/identity")],p.prototype,"messages",void 0);u.__decorate([v.property()],p.prototype,"signingIn",void 0);u.__decorate([v.property()],p.prototype,"server",void 0);u.__decorate([v.property()],p.prototype,"resource",void 0);u.__decorate([v.property()],p.prototype,"error",void 0);u.__decorate([v.property()],p.prototype,"oAuthPrompt",void 0);return p=u.__decorate([U.subclass("esri.identity.IdentityForm")],p)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/handleUtils ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../widgets/support/decorators/messageBundle ../chunks/index ../widgets/support/widget ../widgets/Widget".split(" "),
function(y,u,p,A,x,v,E,U,na,pa,O,ca,T,z,r,C){function ha(b,d){var e=Object.keys(b);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(b);d&&(f=f.filter(function(h){return Object.getOwnPropertyDescriptor(b,h).enumerable}));e.push.apply(e,f)}return e}function X(b){for(var d=1;d<arguments.length;d++){var e=null!=arguments[d]?arguments[d]:{};d%2?ha(Object(e),!0).forEach(function(f){var h=e[f];f in b?Object.defineProperty(b,f,{value:h,enumerable:!0,configurable:!0,writable:!0}):b[f]=h}):
Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(e)):ha(Object(e)).forEach(function(f){Object.defineProperty(b,f,Object.getOwnPropertyDescriptor(e,f))})}return b}p='input select textarea a[href] button [tabindex] audio[controls] video[controls] [contenteditable]:not([contenteditable\x3d"false"]) details\x3esummary:first-of-type details'.split(" ");var L=p.join(","),H="undefined"===typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||
Element.prototype.webkitMatchesSelector,F=function(b,d,e){var f=Array.prototype.slice.apply(b.querySelectorAll(L));d&&H.call(b,L)&&f.unshift(b);return f=f.filter(e)},V=function(b){var d=parseInt(b.getAttribute("tabindex"),10);return isNaN(d)?"true"===b.contentEditable||("AUDIO"===b.nodeName||"VIDEO"===b.nodeName||"DETAILS"===b.nodeName)&&null===b.getAttribute("tabindex")?0:b.tabIndex:d},ia=function(b,d){return b.tabIndex===d.tabIndex?b.documentOrder-d.documentOrder:b.tabIndex-d.tabIndex},aa=function(b){return"DETAILS"===
b.tagName&&Array.prototype.slice.apply(b.children).some(function(d){return"SUMMARY"===d.tagName})},R=function(b,d){for(var e=0;e<b.length;e++)if(b[e].checked&&b[e].form===d)return b[e]},ja=function(b){if(!b.name)return!0;var d=b.form||b.ownerDocument,e=function(h){return d.querySelectorAll('input[type\x3d"radio"][name\x3d"'+h+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var f=e(window.CSS.escape(b.name));else try{f=e(b.name)}catch(h){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",
h.message),!1}e=R(f,b.form);return!e||e===b},da=function(b){if("hidden"===getComputedStyle(b).visibility)return!0;var d=H.call(b,"details\x3esummary:first-of-type")?b.parentElement:b;if(H.call(d,"details:not([open]) *"))return!0;for(;b;){if("none"===getComputedStyle(b).display)return!0;b=b.parentElement}return!1},Y=function(b){var d;(d=b.disabled)||(d="INPUT"===b.tagName&&"hidden"===b.type);return d||da(b)||aa(b)?!1:!0},ka=function(b){var d;(d=!Y(b))||(d="INPUT"===b.tagName&&"radio"===b.type&&!ja(b));
return d||0>V(b)?!1:!0},ea=function(b,d){d=d||{};var e=[],f=[];F(b,d.includeContainer,ka).forEach(function(h,l){var g=V(h);0===g?e.push(h):f.push({documentOrder:l,tabIndex:g,node:h})});return f.sort(ia).map(function(h){return h.node}).concat(e)},la=p.concat("iframe").join(","),ma=function(b){if(!b)throw Error("No node provided");return!1===H.call(b,la)?!1:Y(b)},P,S=function(){var b=[];return{activateTrap:function(d){if(0<b.length){var e=b[b.length-1];e!==d&&e.pause()}e=b.indexOf(d);-1!==e&&b.splice(e,
1);b.push(d)},deactivateTrap:function(d){d=b.indexOf(d);-1!==d&&b.splice(d,1);0<b.length&&b[b.length-1].unpause()}}}(),n=function(b,d){var e=-1;b.every(function(f,h){return d(f)?(e=h,!1):!0});return e},a=function(b){for(var d=arguments.length,e=Array(1<d?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return"function"===typeof b?b.apply(void 0,e):b},c=function(b,d){var e=document,f=X({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},d),h=[],l=[],g=null,k=null,t=!1,q=!1,G=function(N){return h.some(function(m){return m.contains(N)})},
B=function(N){var m=f[N];if(!m)return null;var I=m;if("string"===typeof m&&(I=e.querySelector(m),!I))throw Error("`".concat(N,"` refers to no known node"));if("function"===typeof m&&(I=m(),!I))throw Error("`".concat(N,"` did not return a node"));return I},w=function(){var N=null!==B("initialFocus")?B("initialFocus"):G(e.activeElement)?e.activeElement:(N=l[0])&&N.firstTabbableNode||B("fallbackFocus");if(!N)throw Error("Your focus-trap needs to have at least one focusable element");return N},J=function(){l=
h.map(function(N){var m=ea(N);if(0<m.length)return{container:N,firstTabbableNode:m[0],lastTabbableNode:m[m.length-1]}}).filter(function(N){return!!N});if(0>=l.length&&!B("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},M=function I(m){m!==e.activeElement&&(m&&m.focus?(m.focus({preventScroll:!!f.preventScroll}),k=m,m.tagName&&"input"===m.tagName.toLowerCase()&&"function"===typeof m.select&&m.select()):I(w()))},K=function(m){G(m.target)||
(a(f.clickOutsideDeactivates,m)?W.deactivate({returnFocus:f.returnFocusOnDeactivate&&!ma(m.target)}):a(f.allowOutsideClick,m)||m.preventDefault())},fa=function(m){var I=G(m.target);I||m.target instanceof Document?I&&(k=m.target):(m.stopImmediatePropagation(),M(k||w()))},qa=function(m){J();var I=null;if(0<l.length)if(0>n(l,function(ba){return ba.container.contains(m.target)}))I=m.shiftKey?l[l.length-1].lastTabbableNode:l[0].firstTabbableNode;else if(m.shiftKey){var Z=n(l,function(ba){return m.target===
ba.firstTabbableNode});0<=Z&&(I=l[0===Z?l.length-1:Z-1].lastTabbableNode)}else Z=n(l,function(ba){return m.target===ba.lastTabbableNode}),0<=Z&&(I=l[Z===l.length-1?0:Z+1].firstTabbableNode);else I=B("fallbackFocus");I&&(m.preventDefault(),M(I))},D=function(m){!1===f.escapeDeactivates||"Escape"!==m.key&&"Esc"!==m.key&&27!==m.keyCode?"Tab"!==m.key&&9!==m.keyCode||qa(m):(m.preventDefault(),W.deactivate())},Q=function(m){a(f.clickOutsideDeactivates,m)||G(m.target)||a(f.allowOutsideClick,m)||(m.preventDefault(),
m.stopImmediatePropagation())},oa=function(){if(t)return S.activateTrap(W),P=f.delayInitialFocus?setTimeout(function(){M(w())},0):M(w()),e.addEventListener("focusin",fa,!0),e.addEventListener("mousedown",K,{capture:!0,passive:!1}),e.addEventListener("touchstart",K,{capture:!0,passive:!1}),e.addEventListener("click",Q,{capture:!0,passive:!1}),e.addEventListener("keydown",D,{capture:!0,passive:!1}),W},ra=function(){if(t)return e.removeEventListener("focusin",fa,!0),e.removeEventListener("mousedown",
K,!0),e.removeEventListener("touchstart",K,!0),e.removeEventListener("click",Q,!0),e.removeEventListener("keydown",D,!0),W};var W={activate:function(m){if(t)return this;J();t=!0;q=!1;g=e.activeElement;(m=m&&m.onActivate?m.onActivate:f.onActivate)&&m();oa();return this},deactivate:function(m){if(!t)return this;clearTimeout(P);ra();q=t=!1;S.deactivateTrap(W);var I=m&&void 0!==m.onDeactivate?m.onDeactivate:f.onDeactivate;I&&I();(m&&void 0!==m.returnFocus?m.returnFocus:f.returnFocusOnDeactivate)&&setTimeout(function(){var Z=
g,ba=B("setReturnFocus");M(ba?ba:Z)},0);return this},pause:function(){if(q||!t)return this;q=!0;ra();return this},unpause:function(){if(!q||!t)return this;q=!1;J();oa();return this},updateContainerElements:function(m){h=[].concat(m).filter(Boolean).map(function(I){return"string"===typeof I?e.querySelector(I):I});t&&J();return this}};W.updateContainerElements(b);return W};C=function(b){function d(f,h){var l=b.call(this,f,h)||this;l.container=document.createElement("div");l.content=null;l.open=!1;l._close=
()=>{l.open=!1};document.body.appendChild(l.container);l.own(l.watch("open",()=>l._toggleFocusTrap()));return l}y._inheritsLoose(d,b);var e=d.prototype;e.destroy=function(){this._destroyFocusTrap()};e.render=function(){var f=this.id;const {open:h,content:l,title:g,messages:k}=this;var t=h&&!!l;const q={["esri-identity-modal--open"]:t,["esri-identity-modal--closed"]:!t},G=z.jsx("button",{class:"esri-identity-modal__close-button","aria-label":k.close,title:k.close,bind:this,onclick:this._close},z.jsx("span",
{"aria-hidden":"true",class:"esri-icon-close"})),B=`${f}_title`;f=`${f}_content`;const w=g?z.jsx("h1",{id:B,class:"esri-identity-modal__title"},g):null;t=t?z.jsx("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":B,"aria-describedby":f,afterCreate:this._createFocusTrap},G,w,this._renderContent(f)):null;return z.jsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",q)},t)};e._destroyFocusTrap=function(){var f;null==(f=this._focusTrap)?void 0:f.deactivate({onDeactivate:null});
this._focusTrap=null};e._toggleFocusTrap=function(){const {_focusTrap:f,open:h}=this;f&&(h?f.activate():f.deactivate())};e._createFocusTrap=function(f){this._destroyFocusTrap();const h=requestAnimationFrame(()=>{this._focusTrap=c(f,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.own(v.makeHandle(()=>cancelAnimationFrame(h)))};e._renderContent=function(f){const h=this.content;return"string"===typeof h?z.jsx("div",{class:"esri-identity-modal__content",id:f,innerHTML:h}):
r.isWidget(h)?z.jsx("div",{class:"esri-identity-modal__content",id:f},h.render()):h instanceof HTMLElement?z.jsx("div",{class:"esri-identity-modal__content",id:f,bind:h,afterCreate:this._attachToNode}):null};e._attachToNode=function(f){f.appendChild(this)};return d}(C);u.__decorate([E.property({readOnly:!0})],C.prototype,"container",void 0);u.__decorate([E.property()],C.prototype,"content",void 0);u.__decorate([E.property()],C.prototype,"open",void 0);u.__decorate([E.property(),T.messageBundle("esri/t9n/common")],
C.prototype,"messages",void 0);u.__decorate([E.property({aliasOf:"messages.auth.signIn"})],C.prototype,"title",void 0);return C=u.__decorate([na.subclass("esri.identity.IdentityModal")],C)})},"esri/identity/OAuthCredential":function(){define(function(){let y=function(){function u(A,x){this.userId=this.token=this.ssl=this.expires=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=A;this.storage=x;this._init()}var p=u.prototype;p.isValid=function(){let A=!1;if(this.oAuthInfo&&this.token&&this.userId){const x=
Date.now();this.expires>x&&(this.expires-x)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(A=!0)}return A};p.save=function(){if(this.storage){var A=this._load(),x=this.oAuthInfo;if(x&&x.authNamespace&&x.portalUrl){let v=A[x.authNamespace];v||(v=A[x.authNamespace]={});v[x.portalUrl]={appId:this.appId=x.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(A))}catch(E){console.log(E)}}}};p.destroy=function(){const A=this._load(),
x=this.oAuthInfo;if(x&&x.appId&&x.portalUrl&&this.token&&this.expires>Date.now()){var v=x.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const E=new FormData;E.append("f","json");E.append("auth_token",this.token);E.append("client_id",x.appId);E.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(v,E);else{const U=new XMLHttpRequest;U.open("POST",v);U.send(E)}}if(x&&x.authNamespace&&x.portalUrl&&this.storage&&(v=A[x.authNamespace])){delete v[x.portalUrl];
try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(A))}catch(E){console.log(E)}}x&&(this.oAuthInfo=x._oAuthCred=null)};p._init=function(){var A=this._load();const x=this.oAuthInfo;x&&x.authNamespace&&x.portalUrl&&(A=A[x.authNamespace])&&(A=A[x.portalUrl])&&(this.appId=A.appId,this.expires=A.expires,this.ssl=A.ssl,this.token=A.token,this.userId=A.userId)};p._load=function(){let A={};if(this.storage){const x=this.storage.getItem("esriJSAPIOAuth");if(x)try{A=JSON.parse(x)}catch(v){console.log(v)}}return A};
return u}();y.prototype.declaredClass="esri.identity.OAuthCredential";return y})},"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),function(y,u,p,A,x,v,E,U,na,pa,O,ca){var T;p=T=function(z){function r(C){C=
z.call(this,C)||this;C._oAuthCred=null;C.appId=null;C.authNamespace="/";C.expiration=20160;C.forceLogin=!1;C.forceUserId=!1;C.locale=null;C.minTimeUntilExpiration=30;C.popup=!1;C.popupCallbackUrl="oauth-callback.html";C.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";C.portalUrl="https://www.arcgis.com";C.preserveUrlHash=!1;C.userId=null;return C}y._inheritsLoose(r,z);r.prototype.clone=function(){return T.fromJSON(this.toJSON())};return r}(ca.JSONSupport);u.__decorate([v.property({json:{write:!0}})],
p.prototype,"appId",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"authNamespace",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"expiration",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"forceLogin",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"forceUserId",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"locale",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"minTimeUntilExpiration",void 0);
u.__decorate([v.property({json:{write:!0}})],p.prototype,"popup",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"popupCallbackUrl",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"popupWindowFeatures",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"portalUrl",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"preserveUrlHash",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"userId",void 0);return p=T=u.__decorate([U.subclass("esri.identity.OAuthInfo")],
p)})},"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),function(y,u,p,A,x,v,E,U,na,pa,O,ca){p=function(T){function z(r){r=T.call(this,r)||this;r.adminTokenServiceUrl=null;r.currentVersion=
null;r.hasPortal=null;r.hasServer=null;r.owningSystemUrl=null;r.owningTenant=null;r.server=null;r.shortLivedTokenValidity=null;r.tokenServiceUrl=null;r.webTierAuth=null;return r}y._inheritsLoose(z,T);return z}(ca.JSONSupport);u.__decorate([v.property({json:{write:!0}})],p.prototype,"adminTokenServiceUrl",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"currentVersion",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"hasPortal",void 0);u.__decorate([v.property({json:{write:!0}})],
p.prototype,"hasServer",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"owningSystemUrl",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"owningTenant",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"server",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"shortLivedTokenValidity",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"tokenServiceUrl",void 0);u.__decorate([v.property({json:{write:!0}})],p.prototype,"webTierAuth",
void 0);return p=u.__decorate([U.subclass("esri.identity.ServerInfo")],p)})},"*noref":1}});define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/accessorSupport/decorators/subclass","../kernel","./IdentityManagerBase"],function(y,u,p,A,x){x=function(v){function E(){return v.apply(this,arguments)||this}y._inheritsLoose(E,v);return E}(x.IdentityManagerBase);x=u.__decorate([p.subclass("esri.identity.IdentityManager")],x);u=new x;A.setId(u);return u});