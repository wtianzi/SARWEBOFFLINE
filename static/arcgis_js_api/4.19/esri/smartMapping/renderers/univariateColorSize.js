// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../core/maybe ../../core/Error ../../symbols/support/Symbol3DMaterial ../../renderers/support/AuthoringInfo ../../renderers/visualVariables/support/SizeStop ../../renderers/visualVariables/support/visualVariableUtils ../../renderers/support/ClassBreakInfo ../../symbols/support/cimSymbolUtils ../support/utils ../support/adapters/support/layerUtils ./support/utils ./color ./size ../symbology/support/aboveAndBelowUtils".split(" "),function(v,x,m,G,H,n,q,y,I,z,w,r,J,A,K){async function L(a){var b,
c;if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new m("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-visual-variables:missing-parameters","View is required when 'valueExpression' is specified");if("above-and-below"===a.theme&&null!=(b=a.sizeOptions)&&b.sizeOptimizationEnabled)throw new m("univariate-colorsize-visual-variables:invalid-parameters",
"sizeOptimizationEnabled cannot be true for 'above-and-below' theme");a={...a};const e=[0,2,1,3];b=w.createLayerAdapter(a.layer,e);a.layer=b;a.theme=a.theme||null!=(c=a.colorOptions)&&c.theme?a.theme:"high-to-low";if("90-10"===a.theme)throw new m("univariate-colorsize-visual-variables:not-supported","Only 'high-to-low', 'above-and-below', 'above', 'below' themes are supported.");if(!b)throw new m("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+w.getLayerTypeLabels(e).join(", "));
c=x.isSome(a.signal)?{signal:a.signal}:null;await b.load(c);c=await z.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(c=r.verifyBasicFieldValidity(b,c,"univariate-colorsize-visual-variables:invalid-parameters"))throw c;return a}function M(a,b){var c;a={...a};const {sizeOptions:e,theme:h}=a,d=a.legendOptions||(null==(c=a.sizeOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,
theme:"above-and-below"===h?null:h,legendOptions:d}}function N(a,b){var c;a={...a};const e=a.colorOptions,h=a.theme||(null==e?void 0:e.theme),d=a.legendOptions||(null==(c=a.colorOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,theme:h,legendOptions:d}}async function O(a){var b;if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new m("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a={...a};a.symbolType=a.symbolType||"2d";a.colorOptions||(a.colorOptions={});a.colorOptions.isContinuous=null!=(b=a.colorOptions.isContinuous)?b:!1;var c=[0,2,1,3];b=w.createLayerAdapter(a.layer,c);a.layer=b;if(!b)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+
w.getLayerTypeLabels(c).join(", "));c=x.isSome(a.signal)?{signal:a.signal}:null;await b.load(c);if("above-and-below"===a.theme&&a.symbolOptions){if(-1<a.symbolType.indexOf("3d-volumetric"))throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' is applicable for '2d' and '3d-flat' 'symbolType' only");if("point"!==b.geometryType&&"polygon"!==b.geometryType)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' only apply to layers with 'point' or 'polygon' geometryType");
}c=await z.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(b=r.verifyBasicFieldValidity(b,c,"univariate-colorsize-continuous-renderer:invalid-parameters"))throw b;return a}function P(a){a={...a};const b={...a.sizeOptions};delete a.sizeOptions;delete a.colorOptions;delete b.sizeOptimizationEnabled;return{...a,...b}}function B(a,b){"type"in a&&"cim"===a.type?I.applyCIMSymbolColor(a,b):"type"in a&&-1<a.type.indexOf("3d")?a.symbolLayers.forEach(c=>
{"material"in c&&"color"in c.material&&(c.material?c.material.color=b:c.material=new G["default"]({color:b}))}):"color"in a&&(a.color=b)}function C(a,b,c=!0){var e;const h=null==b?void 0:null==(e=b.authoringInfo)?void 0:e.clone();e=b.size.visualVariables.map(d=>d.clone());c?e.push(b.color.visualVariable.clone()):h.visualVariables=h.visualVariables.filter(d=>"size"===d.type);e.push(...a.visualVariables.filter(d=>"target"in d&&"outline"===d.target).map(d=>d.clone()));a.authoringInfo=h;a.visualVariables=
e}async function Q(a,b,c,e){const h=b[0];b=b[1];const d=Math.round((b-h)/2)+h,f=a.clone();f.stops=[new n({value:c[0],size:b}),new n({value:c[1],size:d}),new n({value:c[2],size:h}),new n({value:c[3],size:d}),new n({value:c[4],size:b})];a.stops=[new n({value:e[0],size:q.getSize(f,e[0])}),new n({value:e[1],size:q.getSize(f,e[1])}),new n({value:e[2],size:q.getSize(f,e[2])}),new n({value:e[3],size:q.getSize(f,e[3])}),new n({value:e[4],size:q.getSize(f,e[4])})]}async function R(a,b,c,e){a=a.filter(f=>"width-and-depth"!==
f.axis&&!f.target)[0];const h="number"===typeof(null==a?void 0:a.minSize)?null==a?void 0:a.minSize:null,d="number"===typeof(null==a?void 0:a.maxSize)?null==a?void 0:a.maxSize:null;if(null!=(null==a?void 0:a.minDataValue)&&null!=h&&null!=d)if(e)if("above-and-below"===e){a.minDataValue=null;a.maxDataValue=null;a.minSize=null;a.maxSize=null;e=r.createStopValuesForAboveBelow(c);const f=r.clampAboveAndBelowStopValues(e,c);await Q(a,[h,d],e,f);b.stops.forEach((k,l)=>k.value=f[l])}else{const {minDataValue:f,
maxDataValue:k}=a,l=r.createDefaultStopValues(f,k,5);b.stops.forEach((g,p)=>g.value=l[p]);a.minDataValue=l[0];a.maxDataValue=l[l.length-1]}else a.minDataValue=b.stops[0].value,a.maxDataValue=b.stops[b.stops.length-1].value}async function D(a){var b=await L(a),c=await J.createVisualVariable(N(b));const {visualVariable:e,statistics:h}=c;var d=await A.createVisualVariables(M(b,h)),f=d.visualVariables;await R(f,e,h,b.theme);a=d.basemapId;var k=d.basemapTheme,l=c.defaultValuesUsed,g={visualVariable:e,
colorScheme:c.colorScheme};f={visualVariables:f,sizeScheme:d.sizeScheme};{const {theme:p,minValue:t,maxValue:u}=b;b=c.authoringInfo.visualVariables[0].clone();d=d.authoringInfo.visualVariables[0].clone();"above-and-below"===p&&(c=c.visualVariable.stops,b.minSliderValue=d.minSliderValue=null!=t?t:c[0].value,b.maxSliderValue=d.maxSliderValue=null!=u?u:c[c.length-1].value,d.theme="above-and-below");c=new H({type:"univariate-color-size",univariateTheme:p,visualVariables:[b,d]})}return{basemapId:a,basemapTheme:k,
statistics:h,defaultValuesUsed:l,color:g,size:f,authoringInfo:c}}async function E(a){var b;a=await O(a);const {renderer:c,statistics:e,defaultValuesUsed:h}=await A.createContinuousRenderer(P(a));var d={...a};var f=d.symbolType,k=-1<f.indexOf("3d-volumetric");delete d.symbolType;delete d.defaultSymbolEnabled;if(d.worldScale=k)d.sizeOptions={...d.sizeOptions},d.sizeOptions.axis="3d-volumetric-uniform"===f?"all":"height";d.statistics=e;d=await D(d);if("above-and-below"===a.theme){var l,g=a.symbolOptions,
p=a.layer;f=null!=g&&g.symbols?"custom":null==g?void 0:g.symbolStyle;k=null==(l=a.colorOptions)?void 0:l.isContinuous;C(c,d,k);if(f||!k){({stops:l}=d.size.visualVariables[0]);p=p.geometryType;!(null!=g&&g.symbolStyle||null!=g&&g.symbols)||"point"!==p&&"polygon"!==p?(g=c.classBreakInfos[0].symbol,g={above:g.clone(),below:g.clone()}):g=g.symbols||K.getAboveAndBelowSymbols(g.symbolStyle);const {above:t,below:u}=g;k||(k=d.color.colorScheme.colors,g=k[0],B(t,k[k.length-1]),B(u,g));c.classBreakInfos=[new y({minValue:-F,
maxValue:l[2].value,symbol:u}),new y({minValue:l[2].value,maxValue:F,symbol:t})];f&&(c.authoringInfo.univariateSymbolStyle=f)}}else C(c,d);return{renderer:c,statistics:e,defaultValuesUsed:h,color:null!=(b=a.colorOptions)&&b.isContinuous||"above-and-below"!==a.theme?d.color:null,size:d.size,basemapId:d.basemapId,basemapTheme:d.basemapTheme}}const F=2**53-1;v.createContinuousRenderer=async function(a){return E(a)};v.createRenderer=E;v.createVisualVariables=D;Object.defineProperty(v,"__esModule",{value:!0})});