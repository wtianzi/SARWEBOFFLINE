// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../core/maybe ../../core/Error ../../renderers/visualVariables/SizeVariable ../../geometry/support/scaleUtils ../support/adapters/support/layerUtils ../statistics/spatialStatistics".split(" "),function(k,f,l,m,h,n){async function p(a){var {view:b}=a;if(!(a&&b&&a.layer))throw new f("outline:missing-parameters","'view' and 'layer' parameters are required");const c=[0,2,3,1],{layer:g,...d}=a;a=h.createLayerAdapter(g,c);const e={layerAdapter:a,...d};if(!a)throw new f("outline:invalid-parameters",
"'layer' must be one of these types: "+h.getLayerTypeLabels(c).join(", "));await b.when();b=k.isSome(e.signal)?{signal:e.signal}:null;await a.load(b);if("polygon"!==a.geometryType)throw new f("outline:not-supported",`outline is not supported for geometryType: ${a.geometryType}`);return e}function q(a,b){const c=a.avgSize,g=m.getScaleForResolution(1,b.spatialReference);a=r.map(d=>({size:d.width,value:Math.round(c/d.size*g)}));a.sort((d,e)=>d.value-e.value);return{visualVariables:[new l({target:"outline",
valueExpression:"$view.scale",stops:a})],opacity:.25}}const r=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];return async function(a){const {layerAdapter:b,...c}=await p(a);a=await b.getSampleFeatures({sampleSize:-1,returnGeometry:!0,...c});a=await n({features:a,geometryType:b.geometryType});if(!("avgSize"in a&&a.avgSize))throw new f("outline:insufficient-info","average polygon size is invalid");return q(a,c.view)}});