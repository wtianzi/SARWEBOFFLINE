// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Evented ../../../core/Handles ../../../core/watchUtils ../../input/InputManager ../../support/screenUtils ./drawUtils ../../interactive/GraphicManipulator ./input/GraphicMoverEvents".split(" "),
function(x,k,g,C,D,H,I,m,J,E,K,L,M,F,y,z,n,r,A,G,h){g=function(B){function t(a){a=B.call(this,a)||this;a._activeGraphic=null;a._dragEvent=null;a._handles=new y;a._hoverGraphic=null;a._initialDragGeometry=null;a._viewHandles=new y;a._manipulators=[];a.type="graphic-mover";a.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}};a.enableMoveAllGraphics=
!1;a.graphics=[];a.view=null;return a}x._inheritsLoose(t,B);var f=t.prototype;f.initialize=function(){this._setUpManipulators();this._handles.add([z.watch(this,["graphics","graphics.length"],()=>{this._setUpManipulators()}),z.whenOnce(this,"view.ready",()=>{this._viewHandles.add([this.view.on("immediate-click",a=>this._clickHandler(a),n.ViewEventPriorities.TOOL),this.view.on("double-click",a=>this._doubleClickHandler(a),n.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>this._pointerDownHandler(a),
n.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>this._pointerMoveHandler(a),n.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>this._pointerUpHandler(a),n.ViewEventPriorities.TOOL),this.view.on("drag",a=>this._dragHandler(a),n.ViewEventPriorities.TOOL),this.view.on("key-down",a=>this._keyDownHandler(a),n.ViewEventPriorities.TOOL)])})])};f.destroy=function(){this.reset();this._manipulators.forEach(a=>a.destroy());this._manipulators=null;this._viewHandles.removeAll();this._handles.removeAll()};
f.reset=function(){this._dragEvent=this._hoverGraphic=this._activeGraphic=null};f.updateGeometry=function(a,b){(a=this.graphics[a])&&a.set("geometry",b)};f._clickHandler=function(a){const b=this._findTargetGraphic(r.createScreenPointFromEvent(a));b&&(a=new h.GraphicClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-click",a),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(a))};f._doubleClickHandler=function(a){const b=this._findTargetGraphic(r.createScreenPointFromEvent(a));
b&&(a=new h.GraphicDoubleClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-double-click",a),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(a))};f._pointerDownHandler=function(a){const b=this._findTargetGraphic(r.createScreenPointFromEvent(a));if(b){this._activeGraphic=b;const {x:c,y:e}=a;a=new h.GraphicPointerDownEvent(b,this.graphics.indexOf(b),c,e,a);this.emit("graphic-pointer-down",a);this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(a)}else this._activeGraphic=
null};f._pointerUpHandler=function(a){if(this._activeGraphic){const {x:b,y:c}=a,e=this.graphics.indexOf(this._activeGraphic);a=new h.GraphicPointerUpEvent(this._activeGraphic,e,b,c,a);this.emit("graphic-pointer-up",a);this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(a)}};f._pointerMoveHandler=function(a){if(!this._dragEvent){var b=this._findTargetGraphic(r.createScreenPointFromEvent(a));if(b){const {x:e,y:d}=a;if(this._hoverGraphic){if(this._hoverGraphic===b)return;var c=this.graphics.indexOf(this._hoverGraphic);
c=new h.GraphicPointerOutEvent(this.graphics[c],c,e,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",c);this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(c)}c=this.graphics.indexOf(b);a=new h.GraphicPointerOverEvent(b,c,e,d,a);this._hoverGraphic=b;this.emit("graphic-pointer-over",a);this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(a)}else if(this._hoverGraphic){const {x:e,y:d}=a;b=this.graphics.indexOf(this._hoverGraphic);a=new h.GraphicPointerOutEvent(this.graphics[b],
b,e,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",a);this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(a)}}};f._dragHandler=function(a){if(("start"===a.action||this._dragEvent)&&this._activeGraphic&&this._activeGraphic.geometry){a.stopPropagation();var {action:b,x:c,y:e}=a,d=this.graphics.indexOf(this._activeGraphic),l=this._activeGraphic.geometry,p=this._dragEvent?c-this._dragEvent.x:0,q=this._dragEvent?e-this._dragEvent.y:0,u=c-a.origin.x,v=e-a.origin.y;this._activeGraphic.geometry=
A.cloneMove(l,p,q,this.view);this.enableMoveAllGraphics&&this.graphics.forEach(w=>{w!==this._activeGraphic&&(w.geometry=A.cloneMove(w.geometry,p,q,this.view))});this._dragEvent=a;"start"===b?(this._initialDragGeometry=C.clone(l),d=new h.GraphicMoveStartEvent(this._activeGraphic,this.graphics,d,c,e,p,q,u,v,a),this.emit("graphic-move-start",d),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(d),d.defaultPrevented&&this._activeGraphic.set("geometry",l)):"update"===b?(d=new h.GraphicMoveEvent(this._activeGraphic,
this.graphics,d,c,e,p,q,u,v,a),this.emit("graphic-move",d),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(d),d.defaultPrevented&&this._activeGraphic.set("geometry",l)):(l=new h.GraphicMoveStopEvent(this._activeGraphic,this.graphics,d,c,e,p,q,u,v,a),this._activeGraphic=this._dragEvent=null,this.emit("graphic-move-stop",l),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(l),l.defaultPrevented&&this.graphics[d].set("geometry",this._initialDragGeometry),this._initialDragGeometry=
null)}};f._keyDownHandler=function(a){"a"!==a.key&&"d"!==a.key&&"n"!==a.key||"moving"!==this.state||a.stopPropagation()};f._findTargetGraphic=function(a){let b=null,c=Number.MAX_VALUE;this._manipulators.forEach(e=>{const d=e.intersectionDistance(a);D.isSome(d)&&d<c&&(c=d,b=e.graphic)});return b};f._setUpManipulators=function(){const {graphics:a,view:b}=this;this._manipulators.forEach(c=>c.destroy());this._manipulators=null!=a&&a.length?a.map(c=>new G.GraphicManipulator({graphic:c,view:b})):[]};x._createClass(t,
[{key:"state",get:function(){const a=!!this.get("view.ready"),b=!!this.get("graphics.length"),c=this._activeGraphic;return a&&b?c?"moving":"active":a?"ready":"disabled"}}]);return t}(F.EventedAccessor);k.__decorate([m.property()],g.prototype,"_activeGraphic",void 0);k.__decorate([m.property({readOnly:!0})],g.prototype,"type",void 0);k.__decorate([m.property()],g.prototype,"callbacks",void 0);k.__decorate([m.property()],g.prototype,"enableMoveAllGraphics",void 0);k.__decorate([m.property()],g.prototype,
"graphics",void 0);k.__decorate([m.property({readOnly:!0})],g.prototype,"state",null);k.__decorate([m.property()],g.prototype,"view",void 0);return g=k.__decorate([E.subclass("esri.views.draw.support.GraphicMover")],g)});