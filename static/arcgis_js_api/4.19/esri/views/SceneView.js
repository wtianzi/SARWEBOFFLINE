// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../../core/maybe","../Extent"],function(a,g,b,p){function f(v=u){return[v[0],v[1],v[2],v[3]]}function k(v){return v[0]>=v[2]?0:v[2]-v[0]}function c(v){return v[1]>=v[3]?0:v[3]-v[1]}function d(v,t,l){return t>=v[0]&&l>=v[1]&&t<=v[2]&&l<=v[3]}function e(v,t){v[0]=t[0];v[1]=t[1];v[2]=t[2];v[3]=t[3];return v}function h(v){return 4===v.length}function n(v,t,l){return v<t?t:v>l?l:v}const q=[Infinity,Infinity,
-Infinity,-Infinity],u=[0,0,0,0];a.NEGATIVE_INFINITY=q;a.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];a.UNIT=[0,0,1,1];a.ZERO=u;a.allFinite=function(v){for(let t=0;4>t;t++)if(!isFinite(v[t]))return!1;return!0};a.area=function(v){return k(v)*c(v)};a.center=function(v,t=[0,0]){t[0]=(v[0]+v[2])/2;t[1]=(v[1]+v[3])/2;return t};a.clone=function(v){return[v[0],v[1],v[2],v[3]]};a.contains=function(v,t){return t[0]>=v[0]&&t[2]<=v[2]&&t[1]>=v[1]&&t[3]<=v[3]};a.containsPoint=function(v,t){return d(v,
t[0],t[1])};a.containsPointObject=function(v,t){return d(v,t.x,t.y)};a.containsPointWithMargin=function(v,t,l){return t[0]>=v[0]-l&&t[1]>=v[1]-l&&t[0]<=v[2]+l&&t[1]<=v[3]+l};a.containsXY=d;a.create=f;a.diameter=function(v){const t=k(v);v=c(v);return Math.sqrt(t*t+v*v)};a.distance=function(v,t){const l=(v[1]+v[3])/2,w=Math.max(Math.abs(t[0]-(v[0]+v[2])/2)-k(v)/2,0);v=Math.max(Math.abs(t[1]-l)-c(v)/2,0);return Math.sqrt(w*w+v*v)};a.empty=function(v){return v?e(v,q):f(q)};a.equals=function(v,t,l){if(b.isNone(v)||
b.isNone(t))return v===t;if(!h(v)||!h(t))return!1;if(l)for(let w=0;w<v.length;w++){if(!l(v[w],t[w]))return!1}else for(l=0;l<v.length;l++)if(v[l]!==t[l])return!1;return!0};a.expand=function(v,t,l=v){if("length"in t)if(h(t))l[0]=Math.min(v[0],t[0]),l[1]=Math.min(v[1],t[1]),l[2]=Math.max(v[2],t[2]),l[3]=Math.max(v[3],t[3]);else{if(2===t.length||3===t.length)l[0]=Math.min(v[0],t[0]),l[1]=Math.min(v[1],t[1]),l[2]=Math.max(v[2],t[0]),l[3]=Math.max(v[3],t[1])}else switch(t.type){case "extent":l[0]=Math.min(v[0],
t.xmin);l[1]=Math.min(v[1],t.ymin);l[2]=Math.max(v[2],t.xmax);l[3]=Math.max(v[3],t.ymax);break;case "point":l[0]=Math.min(v[0],t.x),l[1]=Math.min(v[1],t.y),l[2]=Math.max(v[2],t.x),l[3]=Math.max(v[3],t.y)}return l};a.expandPointInPlace=function(v,t){t[0]<v[0]&&(v[0]=t[0]);t[0]>v[2]&&(v[2]=t[0]);t[1]<v[1]&&(v[1]=t[1]);t[1]>v[3]&&(v[3]=t[1])};a.expandWithNestedArray=function(v,t,l=v){const w=t.length;let y=v[0],D=v[1],z=v[2];v=v[3];for(let r=0;r<w;r++){const C=t[r];y=Math.min(y,C[0]);D=Math.min(D,C[1]);
z=Math.max(z,C[0]);v=Math.max(v,C[1])}l[0]=y;l[1]=D;l[2]=z;l[3]=v;return l};a.fromExtent=function(v,t=f()){t[0]=v.xmin;t[1]=v.ymin;t[2]=v.xmax;t[3]=v.ymax;return t};a.fromValues=function(v,t,l,w,y=f()){y[0]=v;y[1]=t;y[2]=l;y[3]=w;return y};a.height=c;a.intersection=function(v,t,l=v){const w=t[0],y=t[1],D=t[2];t=t[3];l[0]=n(v[0],w,D);l[1]=n(v[1],y,t);l[2]=n(v[2],w,D);l[3]=n(v[3],y,t);return l};a.intersects=function(v,t){return Math.max(t[0],v[0])<=Math.min(t[2],v[2])&&Math.max(t[1],v[1])<=Math.min(t[3],
v[3])};a.is=h;a.isPoint=function(v){return(0===k(v)||!isFinite(v[0]))&&(0===c(v)||!isFinite(v[1]))};a.offset=function(v,t,l,w=v){w[0]=v[0]+t;w[1]=v[1]+l;w[2]=v[2]+t;w[3]=v[3]+l;return w};a.pad=function(v,t,l=v){l[0]=v[0]-t;l[1]=v[1]-t;l[2]=v[2]+t;l[3]=v[3]+t;return l};a.set=e;a.setMax=function(v,t,l=v){l[2]=t[0];l[3]=t[1];l!==v&&(l[0]=v[0],l[1]=v[1]);return v};a.setMin=function(v,t,l=v){l[0]=t[0];l[1]=t[1];l!==v&&(l[2]=v[2],l[3]=v[3]);return l};a.size=function(v,t){t[0]=v[2]-v[0];t[1]=v[3]-v[1]};
a.toExtent=function(v,t){return new p({xmin:v[0],ymin:v[1],xmax:v[2],ymax:v[3],spatialReference:t})};a.width=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/projection":function(){define("require exports ../chunks/_rollupPluginBabelHelpers ../core/maybe ../core/Error ../core/promiseUtils ./support/spatialReferenceUtils ./support/Ellipsoid ./Point ./Extent ./Multipoint ./Polygon ./Polyline ../core/mathUtils ../chunks/vec3f64 ../chunks/vec3 ./projectionEllipsoid ../core/unitUtils ../chunks/mat4 ../chunks/pe ./support/aaBoundingRect ./support/geodesicConstants ./support/GeographicTransformation".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){function x(){return!!Ja&&z.isLoaded()}function m(va){p.isNone(Na)&&(Na=Promise.all([z.load(),(new Promise(function(za,Da){a(["../chunks/geometryEngineBase"],za,Da)})).then(function(za){return za.geometryEngineBase}),new Promise(function(za,Da){a(["./geometryAdapters/hydrated"],za,Da)})]));return Na.then(([,za,{hydratedAdapter:Da}])=>{k.throwIfAborted(va);Ha=Da;Ja=za.default;Ja._enableProjection(z.pe)})}function B(va,za,Da,Ga,Sa=null){if(p.isNone(Da)||
p.isNone(Ga))return za;if(F(Da,Ga,Sa))return za.map(Ta=>G(Ta,Da,Ga));if(p.isNone(Sa)){const Ta=A.cacheKey(Da,Ga);void 0!==Oa[Ta]?Sa=Oa[Ta]:(Sa=E(Da,Ga,null),p.isNone(Sa)&&(Sa=new A),Oa[Ta]=Sa)}if(p.isNone(Ja))throw new Va;return Ja._project(va,za,Da,Ga,Sa)}function E(va,za,Da=null){if(p.isNone(Ja))throw new Va;if(p.isNone(va)||p.isNone(za))return null;va=Ja._getTransformation(Ha,va,za,Da,null==Da?void 0:Da.spatialReference);return null!==va?A.fromGE(va):null}function F(va,za,Da){return Da?!1:c.equals(va,
za)?!0:c.isValid(va)&&c.isValid(za)&&!!qa(va,za,Pa)}function G(va,za,Da){if(!va)return va;if("x"in va){var Ga=new e;return I(va,za,Ga,Da)?Ga:null}return"xmin"in va?(Ga=new h,P(va,za,Ga,Da)?Ga:null):"rings"in va?(Ga=new q,L(va,za,Ga,Da)?Ga:null):"paths"in va?(Ga=new u,J(va,za,Ga,Da)?Ga:null):"points"in va?(Ga=new n,K(va,za,Ga,Da)?Ga:null):null}function I(va,za,Da,Ga,Sa=0){ta[0]=va.x;ta[1]=va.y;const Ta=va.z;ta[2]=void 0!==Ta?Ta:Sa;if(!S(ta,za,0,ta,Ga,0,1))return!1;Da.x=ta[0];Da.y=ta[1];Da.spatialReference=
Ga;void 0===Ta?(Da.z=void 0,Da.hasZ=!1):(Da.z=ta[2],Da.hasZ=!0);void 0===va.m?(Da.m=void 0,Da.hasM=!1):(Da.m=va.m,Da.hasM=!0);return!0}function K(va,za,Da,Ga,Sa=0){const {points:Ta,hasZ:Ra,hasM:ra}=va;va=[];const Aa=Ta.length,Ma=[];for(var Qa of Ta)Ma.push(Qa[0],Qa[1],Ra?Qa[2]:Sa);if(!S(Ma,za,0,Ma,Ga,0,Aa))return!1;for(za=0;za<Aa;++za){Sa=3*za;Qa=Ma[Sa];const Wa=Ma[Sa+1];Ra&&ra?va.push([Qa,Wa,Ma[Sa+2],Ta[za][3]]):Ra?va.push([Qa,Wa,Ma[Sa+2]]):ra?va.push([Qa,Wa,Ta[za][2]]):va.push([Qa,Wa])}Da.points=
va;Da.spatialReference=Ga;Da.hasZ=Ra;Da.hasM=ra;return!0}function J(va,za,Da,Ga,Sa=0){const {paths:Ta,hasZ:Ra,hasM:ra}=va;va=[];if(!H(Ta,Ra,ra,za,va,Ga,Sa))return!1;Da.paths=va;Da.spatialReference=Ga;Da.hasZ=Ra;Da.hasM=ra;return!0}function L(va,za,Da,Ga,Sa=0){const {rings:Ta,hasZ:Ra,hasM:ra}=va;va=[];if(!H(Ta,Ra,ra,za,va,Ga,Sa))return!1;Da.rings=va;Da.spatialReference=Ga;Da.hasZ=Ra;Da.hasM=ra;return!0}function P(va,za,Da,Ga,Sa=0){const {xmin:Ta,ymin:Ra,xmax:ra,ymax:Aa,hasZ:Ma,hasM:Qa}=va;if(!Q(Ta,
Ra,Ma?va.zmin:Sa,za,ta,Ga))return!1;Da.xmin=ta[0];Da.ymin=ta[1];Ma&&(Da.zmin=ta[2]);if(!Q(ra,Aa,Ma?va.zmax:Sa,za,ta,Ga))return!1;Da.xmax=ta[0];Da.ymax=ta[1];Ma&&(Da.zmax=ta[2]);Qa&&(Da.mmin=va.mmin,Da.mmax=va.mmax);Da.spatialReference=Ga;return!0}function Q(va,za,Da,Ga,Sa,Ta){cb[0]=va;cb[1]=za;cb[2]=Da;return S(cb,Ga,0,Sa,Ta,0,1)}function X(va,za,Da,Ga){if(p.isNone(za)||p.isNone(Ga)||2>va.length)return!1;2===va.length&&(cb[0]=va[0],cb[1]=va[1],cb[2]=0,va=cb);return S(va,za,0,Da,Ga,0,1)}function aa(va,
za,Da){p.isNone(za)?va=!1:(za=T(za,wa),za=Ka[za][6],p.isNone(za)?va=!1:(za(va,0,cb,0),Da!==cb&&(Da[0]=cb[0],Da[1]=cb[1],2<Da.length&&(Da[2]=cb[2])),va=!0));return va}function S(va,za,Da,Ga,Sa,Ta,Ra=1){za=qa(za,Sa,Pa);if(p.isNone(za))return!1;if(za===W){if(va===Ga&&Da===Ta)return!0;Ra=Da+3*Ra;for(let ra=Da,Aa=Ta;ra<Ra;ra++,Aa++)Ga[Aa]=va[ra];return!0}Ra=Da+3*Ra;for(let ra=Da,Aa=Ta;ra<Ra;ra+=3,Aa+=3)za(va,ra,Ga,Aa);return!0}function H(va,za,Da,Ga,Sa,Ta,Ra=0){const ra=[];for(const Aa of va)for(const Ma of Aa)ra.push(Ma[0],
Ma[1],za?Ma[2]:Ra);if(!S(ra,Ga,0,ra,Ta,0,ra.length/3))return!1;Ga=0;Sa.length=0;for(const Aa of va){va=[];for(const Ma of Aa)za&&Da?va.push([ra[Ga++],ra[Ga++],ra[Ga++],Ma[3]]):za?va.push([ra[Ga++],ra[Ga++],ra[Ga++]]):(Da?va.push([ra[Ga++],ra[Ga++],Ma[2]]):va.push([ra[Ga++],ra[Ga++]]),Ga++);Sa.push(va)}return!0}function R(va,za,Da){const Ga=Math.sin(za);za=Math.cos(za);const Sa=Math.sin(va);va=Math.cos(va);Da[0]=-Ga;Da[4]=-Sa*za;Da[8]=va*za;Da[12]=0;Da[1]=za;Da[5]=-Sa*Ga;Da[9]=va*Ga;Da[13]=0;Da[2]=
0;Da[6]=va;Da[10]=Sa;Da[14]=0;Da[3]=0;Da[7]=0;Da[11]=0;Da[15]=1;return Da}function T(va,za){if(za.spatialReference===va)return za.spatialReferenceId;za.spatialReference=va;"metersPerUnit"in za&&(za.metersPerUnit=y.getMetersPerUnitForSR(va,1));return va.wkt===w.SphericalECEFSpatialReference.wkt?za.spatialReferenceId=1:c.isWGS84(va)?za.spatialReferenceId=2:c.isWebMercator(va)?za.spatialReferenceId=3:va.wkt===w.WGS84ECEFSpatialReference.wkt?za.spatialReferenceId=4:4490===va.wkid?za.spatialReferenceId=
5:va.wkt===w.SphericalPCPFMars.wkt?za.spatialReferenceId=7:va.wkt===w.SphericalPCPFMoon.wkt?za.spatialReferenceId=9:c.isMars(va)?za.spatialReferenceId=8:c.isMoon(va)?za.spatialReferenceId=10:za.spatialReferenceId=0}function W(va,za,Da,Ga){va!==Da&&(Da[Ga++]=va[za++],Da[Ga++]=va[za++],Da[Ga]=va[za])}function Y(va,za,Da,Ga){Da[Ga++]=ab*(va[za++]/d.earth.radius);Da[Ga++]=ab*(Math.PI/2-2*Math.atan(Math.exp(-1*va[za++]/d.earth.radius)));Da[Ga]=va[za]}function U(va,za,Da,Ga){Y(va,za,Da,Ga);ia(Da,Ga,Da,
Ga)}function N(va,za,Da,Ga){Y(va,za,Da,Ga);ha(Da,Ga,Da,Ga)}function ca(va,za,Da,Ga,Sa){var Ta=.4999999*Math.PI;Ta=v.clamp(Ya*va[za+1],-Ta,Ta);Ta=Math.sin(Ta);Da[Ga++]=Ya*va[za]*Sa.radius;Da[Ga++]=Sa.halfSemiMajorAxis*Math.log((1+Ta)/(1-Ta));Da[Ga]=va[za+2]}function O(va,za,Da,Ga){ca(va,za,Da,Ga,d.earth)}function V(va,za,Da,Ga,Sa){Sa+=va[za+2];const Ta=Ya*va[za+1];va=Ya*va[za];za=Math.cos(Ta);Da[Ga++]=Math.cos(va)*za*Sa;Da[Ga++]=Math.sin(va)*za*Sa;Da[Ga]=Math.sin(Ta)*Sa}function ba(va,za,Da,Ga){V(va,
za,Da,Ga,d.moon.radius)}function fa(va,za,Da,Ga){V(va,za,Da,Ga,d.mars.radius)}function ia(va,za,Da,Ga){V(va,za,Da,Ga,d.earth.radius)}function ma(va,za,Da,Ga,Sa){var Ta=va[za];const Ra=va[za+1];za=va[za+2];va=Math.sqrt(Ta*Ta+Ra*Ra+za*za);za=v.asinClamped(za/(0===va?1:va));Ta=Math.atan2(Ra,Ta);Da[Ga++]=ab*Ta;Da[Ga++]=ab*za;Da[Ga]=va-Sa}function ea(va,za,Da,Ga){ma(va,za,Da,Ga,d.moon.radius)}function M(va,za,Da,Ga){ma(va,za,Da,Ga,d.mars.radius)}function Z(va,za,Da,Ga){ma(va,za,Da,Ga,d.earth.radius)}function la(va,
za,Da,Ga){Z(va,za,Da,Ga);O(Da,Ga,Da,Ga)}function ka(va,za,Da,Ga){Z(va,za,Da,Ga);ha(Da,Ga,Da,Ga)}function ha(va,za,Da,Ga){{var Sa=d.earth;const Ra=Ya*va[za];var Ta=Ya*va[za+1];va=va[za+2];za=Math.sin(Ta);Ta=Math.cos(Ta);const ra=Sa.radius/Math.sqrt(1-Sa.eccentricitySquared*za*za);Da[Ga++]=(ra+va)*Ta*Math.cos(Ra);Da[Ga++]=(ra+va)*Ta*Math.sin(Ra);Da[Ga++]=(ra*(1-Sa.eccentricitySquared)+va)*za}}function na(va,za,Da,Ga){var Sa=C.earthEllipsoidConstants,Ta=va[za],Ra=va[za+1];va=va[za+2];let ra;za=Math.abs(va);
var Aa=Ta*Ta+Ra*Ra;var Ma=Math.sqrt(Aa);var Qa=Aa+va*va;var Wa=Math.sqrt(Qa);Ta=Math.atan2(Ra,Ta);var bb=va*va/Qa;Qa=Aa/Qa;Ra=Sa.a2/Wa;Aa=Sa.a3-Sa.a4/Wa;.3<Qa?(bb=za/Wa*(1+Qa*(Sa.a1+Ra+bb*Aa)/Wa),Wa=Math.asin(bb),Ra=bb*bb,Qa=Math.sqrt(1-Ra)):(Qa=Ma/Wa*(1-bb*(Sa.a5-Ra-Qa*Aa)/Wa),Wa=Math.acos(Qa),Ra=1-Qa*Qa,bb=Math.sqrt(Ra));ra=1-d.earth.eccentricitySquared*Ra;Ra=d.earth.radius/Math.sqrt(ra);Sa=Sa.a6*Ra;Ra=Ma-Ra*Qa;Aa=za-Sa*bb;za=Qa*Ra+bb*Aa;Ma=Qa*Aa-bb*Ra;Sa=Ma/(Sa/ra+za);Wa+=Sa;0>va&&(Wa=-Wa);Da[Ga++]=
ab*Ta;Da[Ga++]=ab*Wa;Da[Ga]=za+Ma*Sa/2}function da(va,za,Da,Ga){na(va,za,Da,Ga);ia(Da,Ga,Da,Ga)}function oa(va,za,Da,Ga){na(va,za,Da,Ga);O(Da,Ga,Da,Ga)}function qa(va,za,Da=Ca()){return p.isNone(va)||p.isNone(za)?null:ua(va,za,Da).projector}function ua(va,za,Da){if(p.isNone(va)||p.isNone(za)||Da.source.spatialReference===va&&Da.dest.spatialReference===za)return Da;const Ga=T(va,Da.source),Sa=T(za,Da.dest);0===Ga&&0===Sa?c.equals(va,za)?Da.projector=W:Da.projector=null:Da.projector=Ka[Ga][Sa];return Da}
function Ca(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:W}}let Ja=null,Ha=null,Na=null,Oa={},Va=function(va){function za(){return va.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}b._inheritsLoose(za,va);return za}(f);const Ka={[2]:{[5]:null,[8]:null,[10]:null,[6]:W,[1]:ia,[7]:null,[9]:null,[0]:null,[3]:O,[2]:W,[4]:ha},[5]:{[5]:W,[8]:null,
[10]:null,[6]:W,[1]:ia,[7]:null,[9]:null,[0]:null,[3]:null,[2]:null,[4]:ha},[8]:{[5]:null,[8]:W,[10]:null,[6]:null,[1]:null,[7]:fa,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[10]:{[5]:null,[8]:null,[10]:W,[6]:null,[1]:null,[7]:null,[9]:ba,[0]:null,[3]:null,[2]:null,[4]:null},[3]:{[5]:null,[8]:null,[10]:null,[6]:Y,[1]:U,[7]:null,[9]:null,[0]:null,[3]:W,[2]:Y,[4]:N},[4]:{[5]:na,[8]:null,[10]:null,[6]:na,[1]:da,[7]:null,[9]:null,[0]:null,[3]:oa,[2]:na,[4]:W},[1]:{[5]:Z,[8]:null,[10]:null,[6]:Z,[1]:W,
[7]:null,[9]:null,[0]:null,[3]:la,[2]:Z,[4]:ka},[7]:{[5]:null,[8]:M,[10]:null,[6]:null,[1]:null,[7]:W,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[9]:{[5]:null,[8]:null,[10]:ea,[6]:null,[1]:null,[7]:null,[9]:W,[0]:null,[3]:null,[2]:null,[4]:null},[0]:{[5]:null,[8]:null,[10]:null,[6]:null,[1]:null,[7]:null,[9]:null,[0]:W,[3]:null,[2]:null,[4]:null},[6]:{[5]:null,[8]:null,[10]:null,[6]:W,[1]:ia,[7]:null,[9]:null,[0]:null,[3]:null,[2]:W,[4]:ha}},wa={spatialReference:null,spatialReferenceId:0},Ea={spatialReference:null,
spatialReferenceId:0},Pa=Ca(),ja=Ca(),Ya=v.deg2rad(1),ab=v.rad2deg(1),cb=t.create(),lb=t.create(),Xa=t.create(),ta=t.create(),Ba=t.create();g.canProjectToWGS84ComparableLonLat=function(va){if(p.isNone(va))return!1;va=T(va,wa);return!!Ka[va][6]};g.canProjectWithoutEngine=F;g.computeLatLonToENURotation=R;g.computeLinearTransformation=function(va,za,Da,Ga){if(p.isNone(va)||p.isNone(Ga))return!1;var Sa=T(va,wa),Ta=T(Ga,Ea);if(Sa===Ta&&1!==Ta&&(0!==Sa||c.equals(va,Ga)))return D.identity(Da),D.translate(Da,
Da,za),!0;if(1===Ta||7===Ta||9===Ta){Ga=va=0;if(1===Ta){Sa=Ka[Sa][6];Ta=Ka[6][Ta];if(p.isNone(Sa)||p.isNone(Ta))return!1;Sa(za,0,lb,0);Ta(lb,0,Xa,0);va=Ya*lb[0];Ga=Ya*lb[1]}else if(7===Ta||9===Ta){Ta=Ka[Sa][Ta];if(p.isNone(Ta))return!1;Ta(za,0,Xa,0);va=Ya*za[0];Ga=Ya*za[1]}R(Ga,va,Da);Da[12]=Xa[0];Da[13]=Xa[1];Da[14]=Xa[2];return!0}if(3===Ta&&(2===Sa||1===Sa)){Ta=Ka[Sa][6];if(p.isNone(Ta))return!1;Ta(za,0,lb,0);za=Ya*lb[1];O(lb,0,Xa,0);D.identity(Da);D.translate(Da,Da,Xa);za=1/Math.cos(za);D.scale(Da,
Da,[za,za,1]);return!0}return!1};g.getProjectorName=function(va,za){switch(qa(va,za,Pa)){case W:return"copy3";case ia:return"wgs84ToSphericalECEF";case O:return"wgs84ToWebMercator";case ha:return"wgs84ToWGS84ECEF";case Y:return"webMercatorToWGS84";case U:return"webMercatorToSphericalECEF";case N:return"webMercatorToWGS84ECEF";case na:return"wgs84ECEFToWGS84";case da:return"wgs84ECEFToSphericalECEF";case oa:return"wgs84ECEFToWebMercator";case Z:return"sphericalECEFToWGS84";case la:return"sphericalECEFToWebMercator";
case M:return"sphericalMarsPCPFToMars2000";case ea:return"sphericalMoonPCPFToMoon2000";case ka:return"sphericalECEFToWGS84ECEF";case fa:return"mars2000ToSphericalPCPF";case ba:return"moon2000ToSphericalPCPF";default:return null}};g.getTransformation=E;g.getTransformations=function(va,za,Da=null){if(p.isNone(Ja))throw new Va;va=Ja._getTransformationBySuitability(Ha,va,za,Da,null==Da?void 0:Da.spatialReference);if(null!==va){za=[];for(const Ga of va)za.push(A.fromGE(Ga));return za}return[]};g.initializeProjection=
async function(va,za){if(!x())for(const {source:Da,dest:Ga,geographicTransformation:Sa}of va)if(!F(Da,Ga,Sa))return m(za)};g.isLoaded=x;g.isSupported=function(){return!0};g.load=m;g.localLinearScaleFactors=function(va,za,Da,Ga){if(p.isNone(za)||p.isNone(Ga))return!1;const Sa=T(za,wa);var Ta=T(Ga,Ea);if(Sa===Ta&&0!==Sa||c.equals(za,Ga))return Da[0]=1,Da[1]=1,Da[2]=1,!0;if(1===Sa){za=l.length(va);va=za/Math.sqrt(va[0]*va[0]+va[1]*va[1]);za/=d.earth.radius;if(3===Ta)return Da[0]=va*za,Da[1]=va*za,Da[2]=
1,!0;if(2===Ta||5===Ta)return Ta=180/(d.earth.radius*Math.PI),Da[0]=Ta*va*za,Da[1]=Ta*za,Da[2]=1,!0}return!1};g.lonLatToSphericalPCPF=function(va,za,Da,Ga,Sa=0){Ga+=Sa;Sa=Math.cos(Da);va[0]=Math.cos(za)*Sa*Ga;va[1]=Math.sin(za)*Sa*Ga;va[2]=Math.sin(Da)*Ga};g.lonLatToWebMercatorComparable=ca;g.project=function(va,za,Da=null){return Array.isArray(va)?0===va.length?[]:B(Ha,va,va[0].spatialReference,za,Da):B(Ha,[va],va.spatialReference,za,Da)[0]};g.projectBoundingRect=function(va,za,Da,Ga){if(null==va)return!1;
if(c.equals(za,Ga))return r.set(Da,va),!0;cb[0]=va[0];cb[1]=va[1];cb[2]=0;if(!S(cb,za,0,cb,Ga,0,1))return!1;Da[0]=cb[0];Da[1]=cb[1];cb[0]=va[2];cb[1]=va[3];cb[2]=0;if(!S(cb,za,0,cb,Ga,0,1))return!1;Da[2]=cb[0];Da[3]=cb[1];return!0};g.projectBoundingSphere=function(va,za,Da,Ga){if(p.isNone(za)||p.isNone(Ga))return!1;za=ua(za,Ga,ja);if(za.projector===W)return Da[0]=va[0],Da[1]=va[1],Da[2]=va[2],Da[3]=va[3],!0;if(p.isNone(za.projector))return!1;const {source:Sa,dest:Ta}=za;if(3===Ta.spatialReferenceId){za=
Ka[Sa.spatialReferenceId][2];if(p.isNone(za))return!1;za(va,0,lb,0);za=Math.abs(Ya*lb[1])+Math.asin(va[3]/(d.earth.radius+va[2]));O(lb,0,Da,0);Da[3]=za>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(za)*va[3];return!0}za.projector(va,0,Da,0);Da[3]=va[3]*Sa.metersPerUnit/Ta.metersPerUnit;return!0};g.projectBuffer=S;g.projectDirection=function(va,za,Da,Ga,Sa){l.copy(ta,va);l.add(Ba,va,za);X(ta,Da,ta,Sa);X(Ba,Da,Ba,Sa);l.subtract(Ga,Ba,ta);l.normalize(Ga,Ga)};g.projectExtent=function(va,za,Da=za.spatialReference,
Ga=0){return p.isNone(Da)?!1:P(va,va.spatialReference,za,Da,Ga)};g.projectMany=B;g.projectMultipoint=function(va,za,Da=za.spatialReference,Ga=0){return p.isNone(Da)?!1:K(va,va.spatialReference,za,Da,Ga)};g.projectPoint=function(va,za,Da=za.spatialReference,Ga=0){return p.isNone(Da)?!1:I(va,va.spatialReference,za,Da,Ga)};g.projectPointToVector=function(va,za,Da,Ga=0){ta[0]=va.x;ta[1]=va.y;const Sa=va.z;ta[2]=void 0!==Sa?Sa:Ga;return S(ta,va.spatialReference,0,za,Da,0,1)};g.projectPointToWGS84ComparableLonLat=
function(va,za){ta[0]=va.x;ta[1]=va.y;const Da=va.z;ta[2]=void 0!==Da?Da:0;return aa(ta,va.spatialReference,za)};g.projectPolygon=function(va,za,Da=za.spatialReference,Ga=0){return p.isNone(Da)?!1:L(va,va.spatialReference,za,Da,Ga)};g.projectPolyline=function(va,za,Da=za.spatialReference,Ga=0){return p.isNone(Da)?!1:J(va,va.spatialReference,za,Da,Ga)};g.projectVectorToDehydratedPoint=function(va,za,Da){return S(va,za,0,ta,Da.spatialReference,0,1)?(Da.x=ta[0],Da.y=ta[1],Da.z=ta[2],Da):null};g.projectVectorToPoint=
function(va,za,Da){if(p.isNone(za)||p.isNone(Da))return null;const Ga=new e({spatialReference:Da});return S(va,za,0,ta,Da,0,1)?(Ga.x=ta[0],Ga.y=ta[1],Ga.z=ta[2],Ga):null};g.projectVectorToVector=X;g.projectVectorToWGS84ComparableLonLat=aa;g.projectXYZToVector=Q;g.sphericalPCPFtoLonLatElevation=ma;g.unload=function(){Na=Ha=Ja=null;Oa={}};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/mat4":function(){define(["exports","./vec3f64","./common"],function(a,g,b){function p(O,V){O[0]=V[0];
O[1]=V[1];O[2]=V[2];O[3]=V[3];O[4]=V[4];O[5]=V[5];O[6]=V[6];O[7]=V[7];O[8]=V[8];O[9]=V[9];O[10]=V[10];O[11]=V[11];O[12]=V[12];O[13]=V[13];O[14]=V[14];O[15]=V[15];return O}function f(O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha,na,da,oa,qa,ua){O[0]=V;O[1]=ba;O[2]=fa;O[3]=ia;O[4]=ma;O[5]=ea;O[6]=M;O[7]=Z;O[8]=la;O[9]=ka;O[10]=ha;O[11]=na;O[12]=da;O[13]=oa;O[14]=qa;O[15]=ua;return O}function k(O){O[0]=1;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=1;O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[10]=1;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;
return O}function c(O,V){if(O===V){const ba=V[1],fa=V[2],ia=V[3],ma=V[6],ea=V[7],M=V[11];O[1]=V[4];O[2]=V[8];O[3]=V[12];O[4]=ba;O[6]=V[9];O[7]=V[13];O[8]=fa;O[9]=ma;O[11]=V[14];O[12]=ia;O[13]=ea;O[14]=M}else O[0]=V[0],O[1]=V[4],O[2]=V[8],O[3]=V[12],O[4]=V[1],O[5]=V[5],O[6]=V[9],O[7]=V[13],O[8]=V[2],O[9]=V[6],O[10]=V[10],O[11]=V[14],O[12]=V[3],O[13]=V[7],O[14]=V[11],O[15]=V[15];return O}function d(O,V){const ba=V[0],fa=V[1],ia=V[2],ma=V[3],ea=V[4],M=V[5],Z=V[6],la=V[7],ka=V[8],ha=V[9],na=V[10],da=
V[11],oa=V[12],qa=V[13],ua=V[14];V=V[15];const Ca=ba*M-fa*ea,Ja=ba*Z-ia*ea,Ha=ba*la-ma*ea,Na=fa*Z-ia*M,Oa=fa*la-ma*M,Va=ia*la-ma*Z,Ka=ka*qa-ha*oa,wa=ka*ua-na*oa,Ea=ka*V-da*oa,Pa=ha*ua-na*qa,ja=ha*V-da*qa,Ya=na*V-da*ua;let ab=Ca*Ya-Ja*ja+Ha*Pa+Na*Ea-Oa*wa+Va*Ka;if(!ab)return null;ab=1/ab;O[0]=(M*Ya-Z*ja+la*Pa)*ab;O[1]=(ia*ja-fa*Ya-ma*Pa)*ab;O[2]=(qa*Va-ua*Oa+V*Na)*ab;O[3]=(na*Oa-ha*Va-da*Na)*ab;O[4]=(Z*Ea-ea*Ya-la*wa)*ab;O[5]=(ba*Ya-ia*Ea+ma*wa)*ab;O[6]=(ua*Ha-oa*Va-V*Ja)*ab;O[7]=(ka*Va-na*Ha+da*Ja)*
ab;O[8]=(ea*ja-M*Ea+la*Ka)*ab;O[9]=(fa*Ea-ba*ja-ma*Ka)*ab;O[10]=(oa*Oa-qa*Ha+V*Ca)*ab;O[11]=(ha*Ha-ka*Oa-da*Ca)*ab;O[12]=(M*wa-ea*Pa-Z*Ka)*ab;O[13]=(ba*Pa-fa*wa+ia*Ka)*ab;O[14]=(qa*Ja-oa*Na-ua*Ca)*ab;O[15]=(ka*Na-ha*Ja+na*Ca)*ab;return O}function e(O,V){const ba=V[0],fa=V[1],ia=V[2],ma=V[3],ea=V[4],M=V[5],Z=V[6],la=V[7],ka=V[8],ha=V[9],na=V[10],da=V[11],oa=V[12],qa=V[13],ua=V[14];V=V[15];O[0]=M*(na*V-da*ua)-ha*(Z*V-la*ua)+qa*(Z*da-la*na);O[1]=-(fa*(na*V-da*ua)-ha*(ia*V-ma*ua)+qa*(ia*da-ma*na));O[2]=
fa*(Z*V-la*ua)-M*(ia*V-ma*ua)+qa*(ia*la-ma*Z);O[3]=-(fa*(Z*da-la*na)-M*(ia*da-ma*na)+ha*(ia*la-ma*Z));O[4]=-(ea*(na*V-da*ua)-ka*(Z*V-la*ua)+oa*(Z*da-la*na));O[5]=ba*(na*V-da*ua)-ka*(ia*V-ma*ua)+oa*(ia*da-ma*na);O[6]=-(ba*(Z*V-la*ua)-ea*(ia*V-ma*ua)+oa*(ia*la-ma*Z));O[7]=ba*(Z*da-la*na)-ea*(ia*da-ma*na)+ka*(ia*la-ma*Z);O[8]=ea*(ha*V-da*qa)-ka*(M*V-la*qa)+oa*(M*da-la*ha);O[9]=-(ba*(ha*V-da*qa)-ka*(fa*V-ma*qa)+oa*(fa*da-ma*ha));O[10]=ba*(M*V-la*qa)-ea*(fa*V-ma*qa)+oa*(fa*la-ma*M);O[11]=-(ba*(M*da-la*
ha)-ea*(fa*da-ma*ha)+ka*(fa*la-ma*M));O[12]=-(ea*(ha*ua-na*qa)-ka*(M*ua-Z*qa)+oa*(M*na-Z*ha));O[13]=ba*(ha*ua-na*qa)-ka*(fa*ua-ia*qa)+oa*(fa*na-ia*ha);O[14]=-(ba*(M*ua-Z*qa)-ea*(fa*ua-ia*qa)+oa*(fa*Z-ia*M));O[15]=ba*(M*na-Z*ha)-ea*(fa*na-ia*ha)+ka*(fa*Z-ia*M);return O}function h(O){const V=O[0],ba=O[1],fa=O[2],ia=O[3],ma=O[4],ea=O[5],M=O[6],Z=O[7],la=O[8],ka=O[9],ha=O[10],na=O[11],da=O[12],oa=O[13],qa=O[14];O=O[15];return(V*ea-ba*ma)*(ha*O-na*qa)-(V*M-fa*ma)*(ka*O-na*oa)+(V*Z-ia*ma)*(ka*qa-ha*oa)+
(ba*M-fa*ea)*(la*O-na*da)-(ba*Z-ia*ea)*(la*qa-ha*da)+(fa*Z-ia*M)*(la*oa-ka*da)}function n(O,V,ba){const fa=V[0],ia=V[1],ma=V[2],ea=V[3],M=V[4],Z=V[5],la=V[6],ka=V[7],ha=V[8],na=V[9],da=V[10],oa=V[11],qa=V[12],ua=V[13],Ca=V[14];V=V[15];let Ja=ba[0],Ha=ba[1],Na=ba[2],Oa=ba[3];O[0]=Ja*fa+Ha*M+Na*ha+Oa*qa;O[1]=Ja*ia+Ha*Z+Na*na+Oa*ua;O[2]=Ja*ma+Ha*la+Na*da+Oa*Ca;O[3]=Ja*ea+Ha*ka+Na*oa+Oa*V;Ja=ba[4];Ha=ba[5];Na=ba[6];Oa=ba[7];O[4]=Ja*fa+Ha*M+Na*ha+Oa*qa;O[5]=Ja*ia+Ha*Z+Na*na+Oa*ua;O[6]=Ja*ma+Ha*la+Na*da+
Oa*Ca;O[7]=Ja*ea+Ha*ka+Na*oa+Oa*V;Ja=ba[8];Ha=ba[9];Na=ba[10];Oa=ba[11];O[8]=Ja*fa+Ha*M+Na*ha+Oa*qa;O[9]=Ja*ia+Ha*Z+Na*na+Oa*ua;O[10]=Ja*ma+Ha*la+Na*da+Oa*Ca;O[11]=Ja*ea+Ha*ka+Na*oa+Oa*V;Ja=ba[12];Ha=ba[13];Na=ba[14];Oa=ba[15];O[12]=Ja*fa+Ha*M+Na*ha+Oa*qa;O[13]=Ja*ia+Ha*Z+Na*na+Oa*ua;O[14]=Ja*ma+Ha*la+Na*da+Oa*Ca;O[15]=Ja*ea+Ha*ka+Na*oa+Oa*V;return O}function q(O,V,ba){const fa=ba[0],ia=ba[1];ba=ba[2];let ma=void 0,ea=void 0,M=void 0,Z=void 0,la=void 0,ka=void 0,ha=void 0,na=void 0,da=void 0,oa=void 0,
qa=void 0,ua=void 0;V===O?(O[12]=V[0]*fa+V[4]*ia+V[8]*ba+V[12],O[13]=V[1]*fa+V[5]*ia+V[9]*ba+V[13],O[14]=V[2]*fa+V[6]*ia+V[10]*ba+V[14],O[15]=V[3]*fa+V[7]*ia+V[11]*ba+V[15]):(ma=V[0],ea=V[1],M=V[2],Z=V[3],la=V[4],ka=V[5],ha=V[6],na=V[7],da=V[8],oa=V[9],qa=V[10],ua=V[11],O[0]=ma,O[1]=ea,O[2]=M,O[3]=Z,O[4]=la,O[5]=ka,O[6]=ha,O[7]=na,O[8]=da,O[9]=oa,O[10]=qa,O[11]=ua,O[12]=ma*fa+la*ia+da*ba+V[12],O[13]=ea*fa+ka*ia+oa*ba+V[13],O[14]=M*fa+ha*ia+qa*ba+V[14],O[15]=Z*fa+na*ia+ua*ba+V[15]);return O}function u(O,
V,ba){const fa=ba[0],ia=ba[1];ba=ba[2];O[0]=V[0]*fa;O[1]=V[1]*fa;O[2]=V[2]*fa;O[3]=V[3]*fa;O[4]=V[4]*ia;O[5]=V[5]*ia;O[6]=V[6]*ia;O[7]=V[7]*ia;O[8]=V[8]*ba;O[9]=V[9]*ba;O[10]=V[10]*ba;O[11]=V[11]*ba;O[12]=V[12];O[13]=V[13];O[14]=V[14];O[15]=V[15];return O}function v(O,V,ba,fa){let ia=fa[0],ma=fa[1];fa=fa[2];let ea=Math.sqrt(ia*ia+ma*ma+fa*fa);var M=void 0,Z=void 0;let la=void 0,ka=void 0,ha=void 0,na=void 0,da=void 0,oa=void 0,qa=void 0,ua=void 0,Ca=void 0,Ja=void 0,Ha=void 0,Na=void 0,Oa=void 0,
Va=void 0,Ka=void 0,wa=void 0,Ea=void 0,Pa=void 0,ja=void 0,Ya=void 0;Z=M=void 0;if(ea<b.EPSILON)return null;ea=1/ea;ia*=ea;ma*=ea;fa*=ea;M=Math.sin(ba);Z=Math.cos(ba);la=1-Z;ka=V[0];ha=V[1];na=V[2];da=V[3];oa=V[4];qa=V[5];ua=V[6];Ca=V[7];Ja=V[8];Ha=V[9];Na=V[10];Oa=V[11];Va=ia*ia*la+Z;Ka=ma*ia*la+fa*M;wa=fa*ia*la-ma*M;Ea=ia*ma*la-fa*M;Pa=ma*ma*la+Z;ja=fa*ma*la+ia*M;Ya=ia*fa*la+ma*M;M=ma*fa*la-ia*M;Z=fa*fa*la+Z;O[0]=ka*Va+oa*Ka+Ja*wa;O[1]=ha*Va+qa*Ka+Ha*wa;O[2]=na*Va+ua*Ka+Na*wa;O[3]=da*Va+Ca*Ka+
Oa*wa;O[4]=ka*Ea+oa*Pa+Ja*ja;O[5]=ha*Ea+qa*Pa+Ha*ja;O[6]=na*Ea+ua*Pa+Na*ja;O[7]=da*Ea+Ca*Pa+Oa*ja;O[8]=ka*Ya+oa*M+Ja*Z;O[9]=ha*Ya+qa*M+Ha*Z;O[10]=na*Ya+ua*M+Na*Z;O[11]=da*Ya+Ca*M+Oa*Z;V!==O&&(O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]);return O}function t(O,V,ba){const fa=Math.sin(ba);ba=Math.cos(ba);const ia=V[4],ma=V[5],ea=V[6],M=V[7],Z=V[8],la=V[9],ka=V[10],ha=V[11];V!==O&&(O[0]=V[0],O[1]=V[1],O[2]=V[2],O[3]=V[3],O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]);O[4]=ia*ba+Z*fa;O[5]=ma*ba+
la*fa;O[6]=ea*ba+ka*fa;O[7]=M*ba+ha*fa;O[8]=Z*ba-ia*fa;O[9]=la*ba-ma*fa;O[10]=ka*ba-ea*fa;O[11]=ha*ba-M*fa;return O}function l(O,V,ba){const fa=Math.sin(ba);ba=Math.cos(ba);const ia=V[0],ma=V[1],ea=V[2],M=V[3],Z=V[8],la=V[9],ka=V[10],ha=V[11];V!==O&&(O[4]=V[4],O[5]=V[5],O[6]=V[6],O[7]=V[7],O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]);O[0]=ia*ba-Z*fa;O[1]=ma*ba-la*fa;O[2]=ea*ba-ka*fa;O[3]=M*ba-ha*fa;O[8]=ia*fa+Z*ba;O[9]=ma*fa+la*ba;O[10]=ea*fa+ka*ba;O[11]=M*fa+ha*ba;return O}function w(O,V,ba){const fa=
Math.sin(ba);ba=Math.cos(ba);const ia=V[0],ma=V[1],ea=V[2],M=V[3],Z=V[4],la=V[5],ka=V[6],ha=V[7];V!==O&&(O[8]=V[8],O[9]=V[9],O[10]=V[10],O[11]=V[11],O[12]=V[12],O[13]=V[13],O[14]=V[14],O[15]=V[15]);O[0]=ia*ba+Z*fa;O[1]=ma*ba+la*fa;O[2]=ea*ba+ka*fa;O[3]=M*ba+ha*fa;O[4]=Z*ba-ia*fa;O[5]=la*ba-ma*fa;O[6]=ka*ba-ea*fa;O[7]=ha*ba-M*fa;return O}function y(O,V){O[0]=1;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=1;O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[10]=1;O[11]=0;O[12]=V[0];O[13]=V[1];O[14]=V[2];O[15]=1;return O}function D(O,
V){O[0]=V[0];O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=V[1];O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[10]=V[2];O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function z(O,V,ba){let fa=ba[0],ia=ba[1];ba=ba[2];let ma=Math.sqrt(fa*fa+ia*ia+ba*ba),ea=void 0,M=void 0,Z=void 0;if(ma<b.EPSILON)return null;ma=1/ma;fa*=ma;ia*=ma;ba*=ma;ea=Math.sin(V);M=Math.cos(V);Z=1-M;O[0]=fa*fa*Z+M;O[1]=ia*fa*Z+ba*ea;O[2]=ba*fa*Z-ia*ea;O[3]=0;O[4]=fa*ia*Z-ba*ea;O[5]=ia*ia*Z+M;O[6]=ba*ia*Z+fa*ea;O[7]=0;O[8]=fa*ba*Z+ia*ea;O[9]=ia*ba*Z-fa*ea;
O[10]=ba*ba*Z+M;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function r(O,V){const ba=Math.sin(V);V=Math.cos(V);O[0]=1;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=V;O[6]=ba;O[7]=0;O[8]=0;O[9]=-ba;O[10]=V;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function C(O,V){const ba=Math.sin(V);V=Math.cos(V);O[0]=V;O[1]=0;O[2]=-ba;O[3]=0;O[4]=0;O[5]=1;O[6]=0;O[7]=0;O[8]=ba;O[9]=0;O[10]=V;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function A(O,V){const ba=Math.sin(V);V=Math.cos(V);O[0]=V;O[1]=ba;O[2]=0;O[3]=
0;O[4]=-ba;O[5]=V;O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[10]=1;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function x(O,V,ba){var fa=V[0],ia=V[1],ma=V[2],ea=V[3],M=fa+fa,Z=ia+ia;const la=ma+ma;V=fa*M;const ka=fa*Z;fa*=la;const ha=ia*Z;ia*=la;ma*=la;M*=ea;Z*=ea;ea*=la;O[0]=1-(ha+ma);O[1]=ka+ea;O[2]=fa-Z;O[3]=0;O[4]=ka-ea;O[5]=1-(V+ma);O[6]=ia+M;O[7]=0;O[8]=fa+Z;O[9]=ia-M;O[10]=1-(V+ha);O[11]=0;O[12]=ba[0];O[13]=ba[1];O[14]=ba[2];O[15]=1;return O}function m(O,V){const ba=ca,fa=-V[0],ia=-V[1],ma=-V[2],ea=
V[3],M=V[4],Z=V[5],la=V[6],ka=V[7],ha=fa*fa+ia*ia+ma*ma+ea*ea;0<ha?(ba[0]=2*(M*ea+ka*fa+Z*ma-la*ia)/ha,ba[1]=2*(Z*ea+ka*ia+la*fa-M*ma)/ha,ba[2]=2*(la*ea+ka*ma+M*ia-Z*fa)/ha):(ba[0]=2*(M*ea+ka*fa+Z*ma-la*ia),ba[1]=2*(Z*ea+ka*ia+la*fa-M*ma),ba[2]=2*(la*ea+ka*ma+M*ia-Z*fa));x(O,V,ba);return O}function B(O,V){O[0]=V[12];O[1]=V[13];O[2]=V[14];return O}function E(O,V){const ba=V[0],fa=V[1],ia=V[2],ma=V[4],ea=V[5],M=V[6],Z=V[8],la=V[9];V=V[10];O[0]=Math.sqrt(ba*ba+fa*fa+ia*ia);O[1]=Math.sqrt(ma*ma+ea*ea+
M*M);O[2]=Math.sqrt(Z*Z+la*la+V*V);return O}function F(O,V){const ba=V[0]+V[5]+V[10];let fa=0;0<ba?(fa=2*Math.sqrt(ba+1),O[3]=.25*fa,O[0]=(V[6]-V[9])/fa,O[1]=(V[8]-V[2])/fa,O[2]=(V[1]-V[4])/fa):V[0]>V[5]&&V[0]>V[10]?(fa=2*Math.sqrt(1+V[0]-V[5]-V[10]),O[3]=(V[6]-V[9])/fa,O[0]=.25*fa,O[1]=(V[1]+V[4])/fa,O[2]=(V[8]+V[2])/fa):V[5]>V[10]?(fa=2*Math.sqrt(1+V[5]-V[0]-V[10]),O[3]=(V[8]-V[2])/fa,O[0]=(V[1]+V[4])/fa,O[1]=.25*fa,O[2]=(V[6]+V[9])/fa):(fa=2*Math.sqrt(1+V[10]-V[0]-V[5]),O[3]=(V[1]-V[4])/fa,O[0]=
(V[8]+V[2])/fa,O[1]=(V[6]+V[9])/fa,O[2]=.25*fa);return O}function G(O,V,ba,fa){var ia=V[0],ma=V[1],ea=V[2],M=V[3],Z=ia+ia,la=ma+ma,ka=ea+ea;V=ia*Z;const ha=ia*la;ia*=ka;const na=ma*la;ma*=ka;ea*=ka;Z*=M;la*=M;M*=ka;ka=fa[0];const da=fa[1];fa=fa[2];O[0]=(1-(na+ea))*ka;O[1]=(ha+M)*ka;O[2]=(ia-la)*ka;O[3]=0;O[4]=(ha-M)*da;O[5]=(1-(V+ea))*da;O[6]=(ma+Z)*da;O[7]=0;O[8]=(ia+la)*fa;O[9]=(ma-Z)*fa;O[10]=(1-(V+na))*fa;O[11]=0;O[12]=ba[0];O[13]=ba[1];O[14]=ba[2];O[15]=1;return O}function I(O,V,ba,fa,ia){var ma=
V[0],ea=V[1],M=V[2],Z=V[3],la=ma+ma,ka=ea+ea,ha=M+M;V=ma*la;var na=ma*ka,da=ma*ha;ma=ea*ka;ea*=ha;var oa=M*ha;M=Z*la;ka*=Z;const qa=Z*ha;var ua=fa[0],Ca=fa[1];ha=fa[2];fa=ia[0];Z=ia[1];ia=ia[2];la=(1-(ma+oa))*ua;const Ja=(na+qa)*ua;ua*=da-ka;na=(na-qa)*Ca;oa=(1-(V+oa))*Ca;Ca*=ea+M;da=(da+ka)*ha;ea=(ea-M)*ha;V=(1-(V+ma))*ha;O[0]=la;O[1]=Ja;O[2]=ua;O[3]=0;O[4]=na;O[5]=oa;O[6]=Ca;O[7]=0;O[8]=da;O[9]=ea;O[10]=V;O[11]=0;O[12]=ba[0]+fa-(la*fa+na*Z+da*ia);O[13]=ba[1]+Z-(Ja*fa+oa*Z+ea*ia);O[14]=ba[2]+ia-
(ua*fa+Ca*Z+V*ia);O[15]=1;return O}function K(O,V){var ba=V[0],fa=V[1],ia=V[2];V=V[3];var ma=ba+ba,ea=fa+fa;const M=ia+ia;ba*=ma;const Z=fa*ma;fa*=ea;const la=ia*ma,ka=ia*ea;ia*=M;ma*=V;ea*=V;V*=M;O[0]=1-fa-ia;O[1]=Z+V;O[2]=la-ea;O[3]=0;O[4]=Z-V;O[5]=1-ba-ia;O[6]=ka+ma;O[7]=0;O[8]=la+ea;O[9]=ka-ma;O[10]=1-ba-fa;O[11]=0;O[12]=0;O[13]=0;O[14]=0;O[15]=1;return O}function J(O,V,ba,fa,ia,ma,ea){const M=1/(ba-V),Z=1/(ia-fa),la=1/(ma-ea);O[0]=2*ma*M;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=2*ma*Z;O[6]=0;O[7]=0;
O[8]=(ba+V)*M;O[9]=(ia+fa)*Z;O[10]=(ea+ma)*la;O[11]=-1;O[12]=0;O[13]=0;O[14]=ea*ma*2*la;O[15]=0;return O}function L(O,V,ba,fa,ia){V=1/Math.tan(V/2);let ma=void 0;O[0]=V/ba;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=V;O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[11]=-1;O[12]=0;O[13]=0;O[15]=0;null!=ia&&Infinity!==ia?(ma=1/(fa-ia),O[10]=(ia+fa)*ma,O[14]=2*ia*fa*ma):(O[10]=-1,O[14]=-2*fa);return O}function P(O,V,ba,fa){const ia=Math.tan(V.upDegrees*Math.PI/180),ma=Math.tan(V.downDegrees*Math.PI/180),ea=Math.tan(V.leftDegrees*
Math.PI/180);V=Math.tan(V.rightDegrees*Math.PI/180);const M=2/(ea+V),Z=2/(ia+ma);O[0]=M;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=Z;O[6]=0;O[7]=0;O[8]=-((ea-V)*M*.5);O[9]=(ia-ma)*Z*.5;O[10]=fa/(ba-fa);O[11]=-1;O[12]=0;O[13]=0;O[14]=fa*ba/(ba-fa);O[15]=0;return O}function Q(O,V,ba,fa,ia,ma,ea){const M=1/(V-ba),Z=1/(fa-ia),la=1/(ma-ea);O[0]=-2*M;O[1]=0;O[2]=0;O[3]=0;O[4]=0;O[5]=-2*Z;O[6]=0;O[7]=0;O[8]=0;O[9]=0;O[10]=2*la;O[11]=0;O[12]=(V+ba)*M;O[13]=(ia+fa)*Z;O[14]=(ea+ma)*la;O[15]=1;return O}function X(O,V,
ba,fa){let ia=void 0,ma=void 0;var ea=void 0,M=void 0;let Z=void 0,la=void 0;var ka=void 0,ha=void 0;let na=void 0,da=void 0;const oa=V[0],qa=V[1];V=V[2];ea=fa[0];M=fa[1];fa=fa[2];ka=ba[0];ha=ba[1];ba=ba[2];if(Math.abs(oa-ka)<b.EPSILON&&Math.abs(qa-ha)<b.EPSILON&&Math.abs(V-ba)<b.EPSILON)return k(O);ka=oa-ka;ha=qa-ha;na=V-ba;da=1/Math.sqrt(ka*ka+ha*ha+na*na);ka*=da;ha*=da;na*=da;ia=M*na-fa*ha;ma=fa*ka-ea*na;ea=ea*ha-M*ka;(da=Math.sqrt(ia*ia+ma*ma+ea*ea))?(da=1/da,ia*=da,ma*=da,ea*=da):ea=ma=ia=0;
M=ha*ea-na*ma;Z=na*ia-ka*ea;la=ka*ma-ha*ia;(da=Math.sqrt(M*M+Z*Z+la*la))?(da=1/da,M*=da,Z*=da,la*=da):la=Z=M=0;O[0]=ia;O[1]=M;O[2]=ka;O[3]=0;O[4]=ma;O[5]=Z;O[6]=ha;O[7]=0;O[8]=ea;O[9]=la;O[10]=na;O[11]=0;O[12]=-(ia*oa+ma*qa+ea*V);O[13]=-(M*oa+Z*qa+la*V);O[14]=-(ka*oa+ha*qa+na*V);O[15]=1;return O}function aa(O,V,ba,fa){const ia=V[0],ma=V[1];V=V[2];var ea=fa[0];const M=fa[1];var Z=fa[2];fa=ia-ba[0];let la=ma-ba[1];ba=V-ba[2];let ka=fa*fa+la*la+ba*ba;0<ka&&(ka=1/Math.sqrt(ka),fa*=ka,la*=ka,ba*=ka);let ha=
M*ba-Z*la;Z=Z*fa-ea*ba;ea=ea*la-M*fa;ka=ha*ha+Z*Z+ea*ea;0<ka&&(ka=1/Math.sqrt(ka),ha*=ka,Z*=ka,ea*=ka);O[0]=ha;O[1]=Z;O[2]=ea;O[3]=0;O[4]=la*ea-ba*Z;O[5]=ba*ha-fa*ea;O[6]=fa*Z-la*ha;O[7]=0;O[8]=fa;O[9]=la;O[10]=ba;O[11]=0;O[12]=ia;O[13]=ma;O[14]=V;O[15]=1;return O}function S(O){return"mat4("+O[0]+", "+O[1]+", "+O[2]+", "+O[3]+", "+O[4]+", "+O[5]+", "+O[6]+", "+O[7]+", "+O[8]+", "+O[9]+", "+O[10]+", "+O[11]+", "+O[12]+", "+O[13]+", "+O[14]+", "+O[15]+")"}function H(O){return Math.sqrt(O[0]**2+O[1]**
2+O[2]**2+O[3]**2+O[4]**2+O[5]**2+O[6]**2+O[7]**2+O[8]**2+O[9]**2+O[10]**2+O[11]**2+O[12]**2+O[13]**2+O[14]**2+O[15]**2)}function R(O,V,ba){O[0]=V[0]+ba[0];O[1]=V[1]+ba[1];O[2]=V[2]+ba[2];O[3]=V[3]+ba[3];O[4]=V[4]+ba[4];O[5]=V[5]+ba[5];O[6]=V[6]+ba[6];O[7]=V[7]+ba[7];O[8]=V[8]+ba[8];O[9]=V[9]+ba[9];O[10]=V[10]+ba[10];O[11]=V[11]+ba[11];O[12]=V[12]+ba[12];O[13]=V[13]+ba[13];O[14]=V[14]+ba[14];O[15]=V[15]+ba[15];return O}function T(O,V,ba){O[0]=V[0]-ba[0];O[1]=V[1]-ba[1];O[2]=V[2]-ba[2];O[3]=V[3]-ba[3];
O[4]=V[4]-ba[4];O[5]=V[5]-ba[5];O[6]=V[6]-ba[6];O[7]=V[7]-ba[7];O[8]=V[8]-ba[8];O[9]=V[9]-ba[9];O[10]=V[10]-ba[10];O[11]=V[11]-ba[11];O[12]=V[12]-ba[12];O[13]=V[13]-ba[13];O[14]=V[14]-ba[14];O[15]=V[15]-ba[15];return O}function W(O,V,ba){O[0]=V[0]*ba;O[1]=V[1]*ba;O[2]=V[2]*ba;O[3]=V[3]*ba;O[4]=V[4]*ba;O[5]=V[5]*ba;O[6]=V[6]*ba;O[7]=V[7]*ba;O[8]=V[8]*ba;O[9]=V[9]*ba;O[10]=V[10]*ba;O[11]=V[11]*ba;O[12]=V[12]*ba;O[13]=V[13]*ba;O[14]=V[14]*ba;O[15]=V[15]*ba;return O}function Y(O,V,ba,fa){O[0]=V[0]+ba[0]*
fa;O[1]=V[1]+ba[1]*fa;O[2]=V[2]+ba[2]*fa;O[3]=V[3]+ba[3]*fa;O[4]=V[4]+ba[4]*fa;O[5]=V[5]+ba[5]*fa;O[6]=V[6]+ba[6]*fa;O[7]=V[7]+ba[7]*fa;O[8]=V[8]+ba[8]*fa;O[9]=V[9]+ba[9]*fa;O[10]=V[10]+ba[10]*fa;O[11]=V[11]+ba[11]*fa;O[12]=V[12]+ba[12]*fa;O[13]=V[13]+ba[13]*fa;O[14]=V[14]+ba[14]*fa;O[15]=V[15]+ba[15]*fa;return O}function U(O,V){return O[0]===V[0]&&O[1]===V[1]&&O[2]===V[2]&&O[3]===V[3]&&O[4]===V[4]&&O[5]===V[5]&&O[6]===V[6]&&O[7]===V[7]&&O[8]===V[8]&&O[9]===V[9]&&O[10]===V[10]&&O[11]===V[11]&&O[12]===
V[12]&&O[13]===V[13]&&O[14]===V[14]&&O[15]===V[15]}function N(O,V){const ba=O[0],fa=O[1],ia=O[2],ma=O[3],ea=O[4],M=O[5],Z=O[6],la=O[7],ka=O[8],ha=O[9],na=O[10],da=O[11],oa=O[12],qa=O[13],ua=O[14];O=O[15];const Ca=V[0],Ja=V[1],Ha=V[2],Na=V[3],Oa=V[4],Va=V[5],Ka=V[6],wa=V[7],Ea=V[8],Pa=V[9],ja=V[10],Ya=V[11],ab=V[12],cb=V[13],lb=V[14];V=V[15];return Math.abs(ba-Ca)<=b.EPSILON*Math.max(1,Math.abs(ba),Math.abs(Ca))&&Math.abs(fa-Ja)<=b.EPSILON*Math.max(1,Math.abs(fa),Math.abs(Ja))&&Math.abs(ia-Ha)<=b.EPSILON*
Math.max(1,Math.abs(ia),Math.abs(Ha))&&Math.abs(ma-Na)<=b.EPSILON*Math.max(1,Math.abs(ma),Math.abs(Na))&&Math.abs(ea-Oa)<=b.EPSILON*Math.max(1,Math.abs(ea),Math.abs(Oa))&&Math.abs(M-Va)<=b.EPSILON*Math.max(1,Math.abs(M),Math.abs(Va))&&Math.abs(Z-Ka)<=b.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ka))&&Math.abs(la-wa)<=b.EPSILON*Math.max(1,Math.abs(la),Math.abs(wa))&&Math.abs(ka-Ea)<=b.EPSILON*Math.max(1,Math.abs(ka),Math.abs(Ea))&&Math.abs(ha-Pa)<=b.EPSILON*Math.max(1,Math.abs(ha),Math.abs(Pa))&&Math.abs(na-
ja)<=b.EPSILON*Math.max(1,Math.abs(na),Math.abs(ja))&&Math.abs(da-Ya)<=b.EPSILON*Math.max(1,Math.abs(da),Math.abs(Ya))&&Math.abs(oa-ab)<=b.EPSILON*Math.max(1,Math.abs(oa),Math.abs(ab))&&Math.abs(qa-cb)<=b.EPSILON*Math.max(1,Math.abs(qa),Math.abs(cb))&&Math.abs(ua-lb)<=b.EPSILON*Math.max(1,Math.abs(ua),Math.abs(lb))&&Math.abs(O-V)<=b.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))}const ca=g.create();g=Object.freeze({__proto__:null,copy:p,set:f,identity:k,transpose:c,invert:d,adjoint:e,determinant:h,multiply:n,
translate:q,scale:u,rotate:v,rotateX:t,rotateY:l,rotateZ:w,fromTranslation:y,fromScaling:D,fromRotation:z,fromXRotation:r,fromYRotation:C,fromZRotation:A,fromRotationTranslation:x,fromQuat2:m,getTranslation:B,getScaling:E,getRotation:F,fromRotationTranslationScale:G,fromRotationTranslationScaleOrigin:I,fromQuat:K,frustum:J,perspective:L,perspectiveFromFieldOfView:P,ortho:Q,lookAt:X,targetTo:aa,str:S,frob:H,add:R,subtract:T,multiplyScalar:W,multiplyScalarAndAdd:Y,exactEquals:U,equals:N,mul:n,sub:T});
a.add=R;a.adjoint=e;a.copy=p;a.determinant=h;a.equals=N;a.exactEquals=U;a.frob=H;a.fromQuat=K;a.fromQuat2=m;a.fromRotation=z;a.fromRotationTranslation=x;a.fromRotationTranslationScale=G;a.fromRotationTranslationScaleOrigin=I;a.fromScaling=D;a.fromTranslation=y;a.fromXRotation=r;a.fromYRotation=C;a.fromZRotation=A;a.frustum=J;a.getRotation=F;a.getScaling=E;a.getTranslation=B;a.identity=k;a.invert=d;a.lookAt=X;a.mat4=g;a.mul=n;a.multiply=n;a.multiplyScalar=W;a.multiplyScalarAndAdd=Y;a.ortho=Q;a.perspective=
L;a.perspectiveFromFieldOfView=P;a.rotate=v;a.rotateX=t;a.rotateY=l;a.rotateZ=w;a.scale=u;a.set=f;a.str=S;a.sub=T;a.subtract=T;a.targetTo=aa;a.translate=q;a.transpose=c})},"esri/chunks/pe":function(){define(["require","exports","./_rollupPluginBabelHelpers","../core/has","../assets"],function(a,g,b,p,f){function k(){return!!g._pe}function c(){return!!p("esri-wasm")}function d(){return v?v:v=(new Promise(function(l,w){a(["./pe-wasm"],l,w)})).then(function(l){return l.peWasm}).then(({default:l})=>l({locateFile:w=>
f.getAssetUrl(`esri/geometry/support/${w}`)})).then(l=>{e(l)})}function e(l){function w(z,r,C){z[r]=C(z[r])}g._pe=l;g.PeDefs.init();g.PeGTlistExtended.init();g.PeNotationMgrs.init();g.PeNotationUtm.init();g.PePCSInfo.init();g.PeGCSExtent=function(z){function r(){return z.apply(this,arguments)||this}b._inheritsLoose(r,z);r.prototype.destroy=function(){g._pe.destroy(this)};return r}(g._pe.PeGCSExtent);l=[g._pe.PeDatum,g._pe.PeGeogcs,g._pe.PeGeogtran,g._pe.PeObject,g._pe.PeParameter,g._pe.PePrimem,g._pe.PeProjcs,
g._pe.PeSpheroid,g._pe.PeUnit];for(var y of l)w(y.prototype,"getName",z=>function(){return z.call(this,Array(g.PeDefs.PE_NAME_MAX))});for(const z of[g._pe.PeGeogtran,g._pe.PeProjcs])w(z.prototype,"getParameters",r=>function(){const C=Array(g.PeDefs.PE_PARM_MAX);let A=r.call(this);for(let x=0;x<C.length;x++){const m=g._pe.getValue(A,"*");C[x]=m?g._pe.wrapPointer(m,g._pe.PeParameter):null;A+=Int32Array.BYTES_PER_ELEMENT}return C});w(g._pe.PeHorizon.prototype,"getCoord",z=>function(){const r=this.getSize();
if(!r)return null;const C=[],A=z.call(this);u(C,r,A);return C});w(g._pe.PeGTlistExtendedEntry.prototype,"getEntries",z=>{const r=g._pe._pe_getPeGTlistExtendedGTsSize();return function(){let C=null;var A=z.call(this);if(!g._pe.compare(A,g._pe.NULL)){C=[A];const x=this.getSteps();if(1<x){A=g._pe.getPointer(A);for(let m=1;m<x;m++)C.push(g._pe.wrapPointer(A+r*m,g._pe.PeGTlistExtendedGTs))}}return C}});const D=g._pe._pe_getPeHorizonSize();y=z=>function(){let r=this._cache;r||(this._cache=r=new Map);if(r.has(z))return r.get(z);
let C=null;var A=z.call(this);if(!g._pe.compare(A,g._pe.NULL)){C=[A];const x=A.getNump();if(1<x){A=g._pe.getPointer(A);for(let m=1;m<x;m++)C.push(g._pe.wrapPointer(A+D*m,g._pe.PeHorizon))}}r.set(z,C);return C};w(g._pe.PeProjcs.prototype,"horizonGcsGenerate",y);w(g._pe.PeProjcs.prototype,"horizonPcsGenerate",y);g._pe.PeObject.prototype.toString=function(z=g.PeDefs.PE_STR_OPTS_NONE){g._pe.ensureCache.prepare();const r=g._pe.getPointer(this),C=g._pe.ensureInt8(Array(g.PeDefs.PE_BUFFER_MAX));return g._pe.UTF8ToString(g._pe._pe_object_to_string_ext(r,
z,C))}}function h(l){if(l){var w=g._pe.getClass(l);w&&(w=g._pe.getCache(w))&&(l=g._pe.getPointer(l))&&delete w[l]}}function n(l,w){const y=[];w=Array(w);for(let D=0;D<l;D++)y.push(g._pe.ensureInt8(w));return y}function q(l){let w;Array.isArray(l[0])?(w=[],l.forEach(y=>{w.push(y[0],y[1])})):w=l;return w}function u(l,w,y,D=!1){if(D)for(D=0;D<2*w;D++)l[D]=g._pe.getValue(y+D*Float64Array.BYTES_PER_ELEMENT,"double");else{D=0===l.length;for(let z=0;z<w;z++)D&&(l[z]=Array(2)),l[z][0]=g._pe.getValue(y,"double"),
l[z][1]=g._pe.getValue(y+Float64Array.BYTES_PER_ELEMENT,"double"),y+=2*Float64Array.BYTES_PER_ELEMENT}}let v;g._pe=null;(function(l){function w(z,r,C){g._pe.ensureCache.prepare();var A=q(C);const x=C===A;A=g._pe.ensureFloat64(A);(z=g._pe._pe_geog_to_proj(g._pe.getPointer(z),r,A))&&u(C,r,A,x);return z}function y(z,r,C){return D(z,r,C,0)}function D(z,r,C,A){g._pe.ensureCache.prepare();var x=q(C);const m=C===x;x=g._pe.ensureFloat64(x);(z=g._pe._pe_proj_to_geog_center(g._pe.getPointer(z),r,x,A))&&u(C,
r,x,m);return z}l.geogToProj=w;l.projGeog=function(z,r,C,A){switch(A){case g.PeDefs.PE_TRANSFORM_P_TO_G:return y(z,r,C);case g.PeDefs.PE_TRANSFORM_G_TO_P:return w(z,r,C)}return 0};l.projToGeog=y;l.projToGeogCenter=D})(g.PeCSTransformations||(g.PeCSTransformations={}));(function(l){l.init=function(){l.PE_BUFFER_MAX=g._pe.PeDefs.prototype.PE_BUFFER_MAX;l.PE_NAME_MAX=g._pe.PeDefs.prototype.PE_NAME_MAX;l.PE_MGRS_MAX=g._pe.PeDefs.prototype.PE_MGRS_MAX;l.PE_USNG_MAX=g._pe.PeDefs.prototype.PE_USNG_MAX;l.PE_DD_MAX=
g._pe.PeDefs.prototype.PE_DD_MAX;l.PE_DDM_MAX=g._pe.PeDefs.prototype.PE_DDM_MAX;l.PE_DMS_MAX=g._pe.PeDefs.prototype.PE_DMS_MAX;l.PE_UTM_MAX=g._pe.PeDefs.prototype.PE_UTM_MAX;l.PE_PARM_MAX=g._pe.PeDefs.prototype.PE_PARM_MAX;l.PE_TYPE_NONE=g._pe.PeDefs.prototype.PE_TYPE_NONE;l.PE_TYPE_GEOGCS=g._pe.PeDefs.prototype.PE_TYPE_GEOGCS;l.PE_TYPE_PROJCS=g._pe.PeDefs.prototype.PE_TYPE_PROJCS;l.PE_TYPE_GEOGTRAN=g._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;l.PE_TYPE_COORDSYS=g._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
l.PE_TYPE_UNIT=g._pe.PeDefs.prototype.PE_TYPE_UNIT;l.PE_TYPE_LINUNIT=g._pe.PeDefs.prototype.PE_TYPE_LINUNIT;l.PE_STR_OPTS_NONE=g._pe.PeDefs.prototype.PE_STR_OPTS_NONE;l.PE_STR_AUTH_NONE=g._pe.PeDefs.prototype.PE_STR_AUTH_NONE;l.PE_STR_AUTH_TOP=g._pe.PeDefs.prototype.PE_STR_AUTH_TOP;l.PE_STR_NAME_CANON=g._pe.PeDefs.prototype.PE_STR_NAME_CANON;l.PE_PARM_X0=g._pe.PeDefs.prototype.PE_PARM_X0;l.PE_PARM_ND=g._pe.PeDefs.prototype.PE_PARM_ND;l.PE_TRANSFORM_1_TO_2=g._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
l.PE_TRANSFORM_2_TO_1=g._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;l.PE_TRANSFORM_P_TO_G=g._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;l.PE_TRANSFORM_G_TO_P=g._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;l.PE_HORIZON_RECT=g._pe.PeDefs.prototype.PE_HORIZON_RECT;l.PE_HORIZON_POLY=g._pe.PeDefs.prototype.PE_HORIZON_POLY;l.PE_HORIZON_LINE=g._pe.PeDefs.prototype.PE_HORIZON_LINE;l.PE_HORIZON_DELTA=g._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(g.PeDefs||(g.PeDefs={}));(function(l){function w(r,C){let A=null,x=y[r];x||
(x={},y[r]=x);x.hasOwnProperty(String(C))?A=x[C]:(r=g._pe.PeFactory.prototype.factoryByType(r,C),g._pe.compare(r,g._pe.NULL)||(A=r,x[C]=A));return A=z(A)}const y={},D={},z=r=>{if(r){const C=r.getType();switch(C){case g.PeDefs.PE_TYPE_GEOGCS:r=g._pe.castObject(r,g._pe.PeGeogcs);break;case g.PeDefs.PE_TYPE_PROJCS:r=g._pe.castObject(r,g._pe.PeProjcs);break;case g.PeDefs.PE_TYPE_GEOGTRAN:r=g._pe.castObject(r,g._pe.PeGeogtran);break;default:C&g.PeDefs.PE_TYPE_UNIT&&(r=g._pe.castObject(r,g._pe.PeUnit))}}return r};
l.initialize=function(){g._pe.PeFactory.prototype.initialize(null)};l.coordsys=function(r){return w(g.PeDefs.PE_TYPE_COORDSYS,r)};l.factoryByType=w;l.fromString=function(r,C){let A=null,x=D[r];x||(x={},D[r]=x);x.hasOwnProperty(C)?A=x[C]:(r=g._pe.PeFactory.prototype.fromString(r,C),g._pe.compare(r,g._pe.NULL)||(A=r,x[C]=A));return A=z(A)};l.geogcs=function(r){return w(g.PeDefs.PE_TYPE_GEOGCS,r)};l.geogtran=function(r){return w(g.PeDefs.PE_TYPE_GEOGTRAN,r)};l.getCode=function(r){return g._pe.PeFactory.prototype.getCode(r)};
l.projcs=function(r){return w(g.PeDefs.PE_TYPE_PROJCS,r)};l.unit=function(r){return w(g.PeDefs.PE_TYPE_UNIT,r)}})(g.PeFactory||(g.PeFactory={}));g.PeGCSExtent=null;(function(l){let w;l.init=function(){l.PE_GTLIST_OPTS_COMMON=g._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;w=g._pe._pe_getPeGTlistExtendedEntrySize()};l.getGTlist=function(y,D,z,r,C,A){let x=null;const m=new g._pe.PeInteger(A);try{const B=g._pe.PeGTlistExtended.prototype.getGTlist(y,D,z,r,C,m);if(A=m.val)if(x=[B],1<A){const E=
g._pe.getPointer(B);for(y=1;y<A;y++)x.push(g._pe.wrapPointer(E+w*y,g._pe.PeGTlistExtendedEntry))}}finally{g._pe.destroy(m)}return x}})(g.PeGTlistExtended||(g.PeGTlistExtended={}));(function(l){l.destroy=function(w){if(w&&w.length){for(const y of w)h(y),y.getEntries().forEach(D=>{h(D);D=D.getGeogtran();h(D);D.getParameters().forEach(h);[D.getGeogcs1(),D.getGeogcs2()].forEach(z=>{h(z);const r=z.getDatum();h(r);h(r.getSpheroid());h(z.getPrimem());h(z.getUnit())})});g._pe.PeGTlistExtendedEntry.prototype.Delete(w[0])}}})(g.PeGTlistExtendedEntry||
(g.PeGTlistExtendedEntry={}));(function(l){l.geogToGeog=function(w,y,D,z,r){g._pe.ensureCache.prepare();var C=q(D);const A=D===C;C=g._pe.ensureFloat64(C);let x=0;z&&(x=g._pe.ensureFloat64(z));(w=g._pe._pe_geog_to_geog(g._pe.getPointer(w),y,C,x,r))&&u(D,y,C,A);return w}})(g.PeGTTransformations||(g.PeGTTransformations={}));(function(l){const w=(D,z,r,C,A,x)=>{g._pe.ensureCache.prepare();switch(D){case "dd":var m=g._pe._pe_geog_to_dd;var B=g.PeDefs.PE_DD_MAX;break;case "ddm":m=g._pe._pe_geog_to_ddm;
B=g.PeDefs.PE_DDM_MAX;break;case "dms":m=g._pe._pe_geog_to_dms,B=g.PeDefs.PE_DMS_MAX}D=0;z&&(D=g._pe.getPointer(z));z=q(C);z=g._pe.ensureFloat64(z);B=n(r,B);C=g._pe.ensureInt32(B);if(A=m(D,r,z,A,C))for(m=0;m<r;m++)x[m]=g._pe.UTF8ToString(B[m]);return A},y=(D,z,r,C,A)=>{g._pe.ensureCache.prepare();switch(D){case "dd":var x=g._pe._pe_dd_to_geog;break;case "ddm":x=g._pe._pe_ddm_to_geog;break;case "dms":x=g._pe._pe_dms_to_geog}D=0;z&&(D=g._pe.getPointer(z));z=C.map(m=>g._pe.ensureString(m));C=g._pe.ensureInt32(z);
z=g._pe.ensureFloat64(Array(2*r));(x=x(D,r,C,z))&&u(A,r,z);return x};l.geog_to_dms=function(D,z,r,C,A){return w("dms",D,z,r,C,A)};l.dms_to_geog=function(D,z,r,C){return y("dms",D,z,r,C)};l.geog_to_ddm=function(D,z,r,C,A){return w("ddm",D,z,r,C,A)};l.ddm_to_geog=function(D,z,r,C){return y("ddm",D,z,r,C)};l.geog_to_dd=function(D,z,r,C,A){return w("dd",D,z,r,C,A)};l.dd_to_geog=function(D,z,r,C){return y("dd",D,z,r,C)}})(g.PeNotationDms||(g.PeNotationDms={}));(function(l){l.init=function(){l.PE_MGRS_STYLE_NEW=
g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;l.PE_MGRS_STYLE_OLD=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;l.PE_MGRS_STYLE_AUTO=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;l.PE_MGRS_180_ZONE_1_PLUS=g._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;l.PE_MGRS_ADD_SPACES=g._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};l.geog_to_mgrs_extended=function(w,y,D,z,r,C,A){g._pe.ensureCache.prepare();let x=0;w&&(x=g._pe.getPointer(w));w=q(D);D=g._pe.ensureFloat64(w);w=n(y,g.PeDefs.PE_MGRS_MAX);
const m=g._pe.ensureInt32(w);if(z=g._pe._pe_geog_to_mgrs_extended(x,y,D,z,r,C,m))for(r=0;r<y;r++)A[r]=g._pe.UTF8ToString(w[r]);return z};l.mgrs_to_geog_extended=function(w,y,D,z,r){g._pe.ensureCache.prepare();let C=0;w&&(C=g._pe.getPointer(w));w=D.map(A=>g._pe.ensureString(A));D=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*y));(z=g._pe._pe_mgrs_to_geog_extended(C,y,D,z,w))&&u(r,y,w);return z}})(g.PeNotationMgrs||(g.PeNotationMgrs={}));(function(l){l.geog_to_usng=function(w,y,D,z,r,C,A){g._pe.ensureCache.prepare();
let x=0;w&&(x=g._pe.getPointer(w));w=q(D);D=g._pe.ensureFloat64(w);w=n(y,g.PeDefs.PE_MGRS_MAX);const m=g._pe.ensureInt32(w);if(z=g._pe._pe_geog_to_usng(x,y,D,z,r,C,m))for(r=0;r<y;r++)A[r]=g._pe.UTF8ToString(w[r]);return z};l.usng_to_geog=function(w,y,D,z){g._pe.ensureCache.prepare();var r=0;w&&(r=g._pe.getPointer(w));w=D.map(C=>g._pe.ensureString(C));D=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*y));(r=g._pe._pe_usng_to_geog(r,y,D,w))&&u(z,y,w);return r}})(g.PeNotationUsng||(g.PeNotationUsng=
{}));(function(l){l.init=function(){l.PE_UTM_OPTS_NONE=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;l.PE_UTM_OPTS_ADD_SPACES=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;l.PE_UTM_OPTS_NS=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};l.geog_to_utm=function(w,y,D,z,r){g._pe.ensureCache.prepare();var C=0;w&&(C=g._pe.getPointer(w));w=q(D);D=g._pe.ensureFloat64(w);w=n(y,g.PeDefs.PE_UTM_MAX);const A=g._pe.ensureInt32(w);if(z=g._pe._pe_geog_to_utm(C,y,D,z,A))for(C=0;C<y;C++)r[C]=g._pe.UTF8ToString(w[C]);
return z};l.utm_to_geog=function(w,y,D,z,r){g._pe.ensureCache.prepare();let C=0;w&&(C=g._pe.getPointer(w));w=D.map(A=>g._pe.ensureString(A));D=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*y));(z=g._pe._pe_utm_to_geog(C,y,D,z,w))&&u(r,y,w);return z}})(g.PeNotationUtm||(g.PeNotationUtm={}));(function(l){const w=new Map;l.init=function(){l.PE_PCSINFO_OPTION_NONE=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;l.PE_PCSINFO_OPTION_DOMAIN=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;l.PE_POLE_OUTSIDE_BOUNDARY=
g._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;l.PE_POLE_POINT=g._pe.PePCSInfo.prototype.PE_POLE_POINT};l.generate=function(y,D=l.PE_PCSINFO_OPTION_DOMAIN){let z,r;w.has(y)&&(r=w.get(y),r[D]&&(z=r[D]));z||(z=g._pe.PePCSInfo.prototype.generate(y,D),r||(r=[],w.set(y,r)),r[D]=z);return z}})(g.PePCSInfo||(g.PePCSInfo={}));(function(l){l.version_string=function(){return g._pe.PeVersion.prototype.version_string()}})(g.PeVersion||(g.PeVersion={}));var t=Object.freeze({__proto__:null,get _pe(){return g._pe},
isLoaded:k,isSupported:c,load:d,get PeCSTransformations(){return g.PeCSTransformations},get PeDefs(){return g.PeDefs},get PeFactory(){return g.PeFactory},get PeGCSExtent(){return g.PeGCSExtent},get PeGTlistExtended(){return g.PeGTlistExtended},get PeGTlistExtendedEntry(){return g.PeGTlistExtendedEntry},get PeGTTransformations(){return g.PeGTTransformations},get PeNotationDms(){return g.PeNotationDms},get PeNotationMgrs(){return g.PeNotationMgrs},get PeNotationUsng(){return g.PeNotationUsng},get PeNotationUtm(){return g.PeNotationUtm},
get PePCSInfo(){return g.PePCSInfo},get PeVersion(){return g.PeVersion},_init:e});g._init=e;g.isLoaded=k;g.isSupported=c;g.load=d;g.pe=t})},"esri/geometry/support/geodesicConstants":function(){define(["exports","./Ellipsoid"],function(a,g){const b=Math.PI/180;var p=g.earth.radius;const f=g.earth.eccentricitySquared;p={a1:p*f,a2:p*f*p*f,a3:p*f*f/2,a4:p*f*p*f*2.5,a5:p*f+p*f*f/2,a6:1-f};g={4326:{a:g.earth.radius,f:g.earth.flattening},104900:{a:2439700,f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},
104903:{a:g.moon.radius,f:g.moon.flattening},104904:{a:3393400,f:.005207166853303471},104905:{a:g.mars.radius,f:g.mars.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85E3,f:0},104918:{a:1821460,f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},104922:{a:18E3,f:0},
104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,f:0},104940:{a:764E3,f:0},104941:{a:11E3,f:0},104942:{a:529800,f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},104945:{a:578900,
f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},104964:{a:29E3,f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,f:0},104968:{a:1352600,
f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:g.mars.radius,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};a.WKT_SPHEROID_REGEX=/SPHEROID\[([^\]]+)]/i;a.earthEllipsoidConstants=p;a.spheroids=g;a.toRadians=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/GeographicTransformation":function(){define(["./GeographicTransformationStep"],function(a){return function(){function g(p){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=
null;if(p&&p.steps)for(const f of p.steps)f instanceof a?this.steps.push(f):this.steps.push(new a({wkid:f.wkid,wkt:f.wkt,isInverse:f.isInverse}))}g.cacheKey=function(p,f){return[void 0!==p.wkid&&null!==p.wkid?p.wkid.toString():"-1",void 0!==p.wkt&&null!==p.wkt?p.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&null!==f.wkt?f.wkt.toString():""].join()};g.fromGE=function(p){const f=new g;let k="";for(const c of p.steps)p=a.fromGE(c),f.steps.push(p),k+=p.uid.toString()+
",";f._cached_projection={};f._gtlistentry=null;f._chain=k;return f};var b=g.prototype;b.getInverse=function(){const p=new g;p.steps=[];for(let f=this.steps.length-1;0<=f;f--)p.steps.push(this.steps[f].getInverse());return p};b.getGTListEntry=function(){let p="";for(const f of this.steps)p+=f.uid.toString()+",";p!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=p);return this._gtlistentry};b.assignCachedGe=function(p,f,k){this._cached_projection[g.cacheKey(p,f)]=k};b.getCachedGeTransformation=
function(p,f){let k="";for(const c of this.steps)k+=c.uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);p=this._cached_projection[g.cacheKey(p,f)];return void 0===p?null:p};return g}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(a){let g=0;return function(){function b(p=null){this.uid=g++;p?(this._wkt=void 0!==p.wkt?p.wkt:null,this._wkid=void 0!==p.wkid?p.wkid:-1,this._isInverse=
void 0!==p.isInverse?!0===p.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(p){const f=new b;f._wkt=p.wkt;f._wkid=p.wkid;f._isInverse=p.isInverse;return f};b.prototype.getInverse=function(){const p=new b;p._wkt=this.wkt;p._wkid=this._wkid;p._isInverse=!this.isInverse;return p};a._createClass(b,[{key:"wkt",get:function(){return this._wkt},set:function(p){this._wkt=p;this.uid=g++}},{key:"wkid",get:function(){return this._wkid},set:function(p){this._wkid=p;this.uid=
g++}},{key:"isInverse",get:function(){return this._isInverse},set:function(p){this._isInverse=p;this.uid=g++}}]);return b}()})},"esri/views/support/spatialReferenceSupport":function(){define(["exports"],function(a){a.isSpatialReferenceSupported=function(g,b){return null==g?!1:"2d"===b?!0:"local"===b?!g.isGeographic:g.isWebMercator||g.isWGS84||4490===g.wkid||104971===g.wkid||104905===g.wkid||104903===g.wkid};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ./Lighting ./background/utils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;b=(w,y,D)=>({enabled:!D||!D.isPresentation});u=l=function(w){function y(z){z=w.call(this,z)||this;z.lighting=new v;z.background=null;z.atmosphereEnabled=!0;z.starsEnabled=!0;return z}a._inheritsLoose(y,w);var D=y.prototype;D.clone=function(){return new l(this.cloneConstructProperties())};D.cloneConstructProperties=function(){return{lighting:v.prototype.clone.call(this.lighting),background:p.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled}};return y}(u.JSONSupport);g.__decorate([c.property({type:v,json:{write:!0}})],u.prototype,"lighting",void 0);g.__decorate([c.property(t.backgroundProperty)],u.prototype,"background",void 0);g.__decorate([c.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],u.prototype,"atmosphereEnabled",void 0);g.__decorate([c.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],u.prototype,"starsEnabled",void 0);return u=l=g.__decorate([e.subclass("esri.webscene.Environment")],
u)})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){var t;b=t=
function(l){function w(D){D=l.call(this,D)||this;D.date=null;D.directShadowsEnabled=!1;D.displayUTCOffset=null;return D}a._inheritsLoose(w,l);var y=w.prototype;y.readDate=function(D,z){return null!=z.datetime&&new Date(z.datetime)||null};y.writeDate=function(D,z,r){z[r]=D.getTime()};y.readDirectShadowsEnabled=function(D,z){return!!z.directShadows};y.writedirectShadowsEnabled=function(D,z,r){D&&(z[r]=D)};y.writeDisplayUTCOffset=function(D,z){null!=D&&(z.displayUTCOffset=D)};y.clone=function(){return new t(this.cloneConstructProperties())};
y.cloneConstructProperties=function(){const D={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(D.date=new Date(this.date.getTime()));return D};return w}(v.JSONSupport);g.__decorate([k.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);g.__decorate([d.reader("date",["datetime"])],b.prototype,"readDate",null);g.__decorate([h.writer("date")],b.prototype,"writeDate",null);
g.__decorate([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);g.__decorate([d.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);g.__decorate([h.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);g.__decorate([k.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);g.__decorate([h.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",
null);return b=t=g.__decorate([e.subclass("esri.webscene.Lighting")],b)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,g,b){g={base:g,key:"type",typeMap:{color:b}};g={types:g,json:{read:function(p){return(f,k,c)=>{if(!f)return f;for(const d in p.typeMap)if(f.type===d)return k=new p.typeMap[d],k.read(f,c),k}}(g),write:{overridePolicy:(p,f,k)=>({enabled:!k||!k.isPresentation})}}};a.backgroundProperty=g;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(t){return u.call(this,
t)||this}a._inheritsLoose(v,u);v.prototype.clone=function(){};return v}(q.JSONSupport);g.__decorate([k.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=g.__decorate([d.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Color ../../symbols/support/materialUtils ./Background".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){var t;b={...u.colorAndTransparencyProperty,nonNullable:!0};v=t=function(l){function w(D){D=l.call(this,D)||this;D.type="color";D.color=new q([0,0,0,1]);return D}a._inheritsLoose(w,l);var y=w.prototype;y.clone=function(){return new t(this.cloneProperties())};y.cloneProperties=function(){return{color:this.color.clone()}};return w}(v);g.__decorate([c.enumeration({color:"color"},{readOnly:!0})],v.prototype,"type",void 0);g.__decorate([k.property(b)],v.prototype,"color",
void 0);return v=t=g.__decorate([d.subclass("esri.webscene.background.ColorBackground")],v)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(a,g,b){function p(t,l){const {format:w,quality:y,rotation:D,disableDecorations:z}=t||{};var r=e(t,l.padding);var C=l.width-r.left-r.right;l=l.height-r.top-r.bottom;r={x:0,y:0,width:C,height:l};if(t&&t.area){null!=t.area.x&&(r.x=Math.floor(t.area.x));null!=t.area.y&&(r.y=Math.floor(t.area.y));
var A=null!=t.area.width?Math.floor(t.area.width):null,x=null!=t.area.height?Math.floor(t.area.height):null;r.width=C-r.x;r.height=l-r.y;null!=A&&null!=x?(r.width=Math.min(r.width,A),r.height=Math.min(r.height,x)):null==A&&null!=x?(A=Math.min(r.width,A),r.height*=A/r.width,r.width=A):null!=A&&null==x&&(A=Math.min(r.height,x),r.width*=A/r.height,r.height=A)}r=d(r,t);A=Math.floor(Math.max(r.x,0));x=Math.floor(Math.max(r.y,0));C={x:A,y:x,width:Math.floor(Math.min(r.width,C-A)),height:Math.floor(Math.min(r.height,
l-x))};l=C.width/C.height;r=r.width/r.height;r!==l&&(r>l?(l=Math.floor(C.width/r),C={x:C.x,y:Math.floor(C.y+(C.height-l)/2),width:C.width,height:l}):(l=Math.floor(C.height*r),C={x:Math.floor(C.x+(C.width-l)/2),y:C.y,width:l,height:C.height}));const {width:m,height:B}=c(t,C);a:switch(w){case "png":case "jpg":case "jpeg":l=w;break a;case null:case void 0:l="png";break a;default:l="png"}r=u[l];r=b.clamp(null!=y?y:r,0,100);return{format:l,quality:r,area:C,width:m,height:B,rotation:D,disableDecorations:!!z,
ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function f(t,l){return t.toDataURL(q[l.format],l.quality/100)}function k(t,l,w){w||(h||(h=document.createElement("canvas"),h.width=1,h.height=1),w=h);return w.getContext("2d").createImageData(t,l)}function c(t,l){if(!t)return l;const w=t.width;t=t.height;if(null!=w&&null!=t)return{width:Math.floor(w),height:Math.floor(t)};if(null==w&&null==t)return l;l=l.width/l.height;return null==t?{width:Math.floor(w),height:Math.floor(w/
l)}:{width:Math.floor(t*l),height:Math.floor(t)}}function d(t,l){if(!l||null==l.width||null==l.height)return t;l=l.width/l.height;const w=t.width/t.height;if(w===l)return t;if(w<l)return l=Math.floor(t.height*l),t.x-=(l-t.width)/2,t.width=l,t;l=Math.floor(t.width/l);t.y-=(l-t.height)/2;t.height=l;return t}function e(t,l){return!l||t&&t.ignorePadding?v:l}let h=null,n=!0;const q={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},u={png:100,jpg:98,jpeg:98},v={top:0,right:0,bottom:0,left:0};a.completeUserSettings=
p;a.createEmptyImageData=function(t,l,w){if(!t||!l)throw Error("Cannot construct image data without dimensions");if(n)try{return new ImageData(t,l)}catch(y){n=!1}return k(t,l,w)};a.encodeResult=function(t,l,w,y){if(y.premultipliedAlpha){{var D=t.data;const r=D.length;for(let C=0;C<r;C+=4){var z=D[C+3];0<z&&(z/=255,D[C+0]/=z,D[C+1]/=z,D[C+2]/=z)}}}w.width=t.width;w.height=t.height;D=w.getContext("2d");D.putImageData(t,0,0);y.flipY&&(D.save(),D.globalCompositeOperation="copy",D.scale(1,-1),D.translate(0,
-D.canvas.height),D.drawImage(D.canvas,0,0),D.restore());t=D.getImageData(0,0,t.width,t.height);l=f(w,l);w.width=0;w.height=0;return{dataUrl:l,data:t}};a.resampleHermite=function(t,l,w,y=0,D=0,z=t.width-y,r=t.height-D,C=!1){const {data:A}=t,{width:x,height:m,data:B}=l;z/=x;r/=m;const E=Math.ceil(z/2),F=Math.ceil(r/2);t=t.width;for(let K=0;K<m;K++)for(let J=0;J<x;J++){const L=4*(J+(C?m-K-1:K)*x);let P=0,Q=0,X=0,aa=0,S=0,H=0;const R=(K+.5)*r;for(let T=Math.floor(K*r);T<(K+1)*r;T++){var G=Math.abs(R-
(T+.5))/F;const W=(J+.5)*z;G*=G;for(let Y=Math.floor(J*z);Y<(J+1)*z;Y++){var I=Math.abs(W-(Y+.5))/E;I=Math.sqrt(G+I*I);if(1<=I)continue;I=2*I*I*I-3*I*I+1;const U=4*(y+Y+(D+T)*t);H+=I*A[U+3];Q+=I;!w&&255>A[U+3]&&(I=I*A[U+3]/255);X+=I*A[U];aa+=I*A[U+1];S+=I*A[U+2];P+=I}}B[L]=X/P;B[L+1]=aa/P;B[L+2]=S/P;B[L+3]=H/Q}return l};a.screenshotSuperSampleSettings=function(t,l,w){if(!l)return t;const {framebufferWidth:y,framebufferHeight:D,pixelRatio:z,region:r}=t;l=e(t,w);w=l.left+l.right;const C=l.top+l.bottom,
A=y-w,x=D-C,m=Math.min(8,Math.min((2048-w)/A,(2048-C)/x));return 1.5>m?t:{...t,framebufferWidth:Math.round(A*m)+w,framebufferHeight:Math.round(x*m)+C,pixelRatio:z*m,resample:{region:{x:Math.round((r.x-l.left)*m)+l.left,y:Math.round((r.y-l.top)*m)+l.top,width:Math.round(r.width*m),height:Math.round(r.height*m)},width:y,height:D}}};a.toDataUrl=f;a.toRenderSettings=function(t,l){const w=p(t,l),y=w.area,D=w.width/y.width,z=e(w,l.padding),r=z.left+z.right,C=z.top+z.bottom;return{framebufferWidth:Math.floor((l.width-
r)*D+r),framebufferHeight:Math.floor((l.height-C)*D+C),region:{x:Math.floor(y.x*D)+z.left,y:Math.floor(y.y*D)+z.top,width:w.width,height:w.height},format:w.format,quality:w.quality,rotation:w.rotation,pixelRatio:D,layers:t&&t.layers?t.layers:[],disableDecorations:w.disableDecorations,ignoreBackground:w.ignoreBackground,ignorePadding:w.ignorePadding}};a.wrapImageData=function(t,l,w,y){if(!l||!w)throw Error("Cannot construct image data without dimensions");if(n)try{return new ImageData(t,l,w)}catch(D){n=
!1}l=k(l,w,y);l.data.set(t,0);return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(a,g){function b(p,f){f=g.getMetersPerUnitForSR(f);return p/(f*g.inchesPerMeter*96)}a.getExtentForScale=function(p,f){const k=p.extent;p=p.width;f=b(f,k.spatialReference);return k.clone().expand(f*p/k.width)};a.getResolutionForScale=b;a.getScale=function(p,f){f=f||p.extent;p=p.width;const k=g.getMetersPerUnitForSR(f&&
f.spatialReference);return f&&p?f.width/p*k*g.inchesPerMeter*96:0};a.getScaleForResolution=function(p,f){f=g.getMetersPerUnitForSR(f);return p*f*g.inchesPerMeter*96};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(a){a.areLabelsVisible=function(g){return!0===g.labelsVisible&&null!=g.labelingInfo&&0<g.labelingInfo.length};a.getLayersForScale=function(g,b){const p=[];if(0<g&&b)for(let f=0;f<b.length;f++)if(!(0<=b[f].parentLayerId&&
-1===p.indexOf(b[f].parentLayerId)&&b.some(function(k){return k.id===b[f].parentLayerId}))&&0<=b[f].id){let k=!0;const c=b[f].maxScale,d=b[f].minScale;if(0<c||0<d)0<c&&0<d?k=c<=g&&g<=d:0<c?k=c<=g:0<d&&(k=g<=d);k&&p.push(b[f].id)}return p};a.isBaseLayer=function(g){return g.parent&&"esri.Basemap"===g.parent.declaredClass&&-1<g.parent.baseLayers.indexOf(g)};a.isTiledLayer=function(g){return g&&"base-tile"===g.type||"tile"===g.type||"elevation"===g.type||"imagery-tile"===g.type||"base-elevation"===g.type||
"open-street-map"===g.type||"wcs"===g.type||"web-tile"===g.type||"wmts"===g.type||"vector-tile"===g.type};a.serializeLayerDefinitions=function(g){const b=/[:;]/,p=[];let f=!1;if(g&&(g.forEach(function(k,c){p.push([c,k]);!f&&b.test(k)&&(f=!0)}),0<p.length)){if(f){const k={};p.forEach(c=>{k[c[0]]=c[1]});g=JSON.stringify(k)}else{const k=[];p.forEach(c=>{k.push(c[0]+":"+c[1])});g=k.join(";")}return g}return null};a.serializeTimeOptions=function(g){if(g){var b=[];g.forEach(function(p,f){b.push('"'+f+'":'+
JSON.stringify(p))});if(b.length)return"{"+b.join(",")+"}"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/ArrayPool ../core/Handles ../core/watchUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){function l(D,z){return z?w[D].valueToClassName[z].split(" "):[]}const w={widthBreakpoint:{getValue(D){const z=D.viewSize[0];D=D.breakpoints;const r=this.values;return z<=D.xsmall?r.xsmall:z<=D.small?r.small:z<=D.medium?r.medium:z<=D.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(D){const z=D.viewSize[1];D=D.breakpoints;const r=this.values;return z<=D.xsmall?r.xsmall:z<=D.small?r.small:z<=D.medium?r.medium:z<=D.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(D){D=D.viewSize;const z=this.values;return D[1]>=D[0]?z.portrait:z.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},y={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
D=>{D=function(z){function r(...A){A=z.call(this,...A)||this;A._breakpointsHandles=new v;A.orientation=null;A.widthBreakpoint=null;A.heightBreakpoint=null;A.breakpoints=y;return A}g._inheritsLoose(r,z);var C=r.prototype;C.initialize=function(){this._breakpointsHandles.add(t.init(this,["breakpoints","size"],this._updateClassNames))};C.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};C._updateClassNames=function(){if(this.container){var A=
u.acquire(),x=u.acquire(),m=!1,B;for(B in w){const E=this[B],F=w[B].getValue({viewSize:this.size,breakpoints:this.breakpoints});E!==F&&(m=!0,this[B]=F,l(B,E).forEach(G=>x.push(G)),l(B,F).forEach(G=>A.push(G)))}m&&(this._applyClassNameChanges(A,x),u.release(A),u.release(x))}};C._applyClassNameChanges=function(A,x){const m=this.container;m&&(x.forEach(B=>m.classList.remove(B)),A.forEach(B=>m.classList.add(B)))};C._removeActiveClassNames=function(){const A=this.container;if(A)for(var x in w)l(x,this[x]).forEach(m=>
A.classList.remove(m))};g._createClass(r,[{key:"breakpoints",set:function(A){var x=this._get("breakpoints");if(A!==x){x=(x=A)&&x.xsmall<x.small&&x.small<x.medium&&x.medium<x.large;if(!x){const m=JSON.stringify(y,null,2);console.warn("provided breakpoints are not valid, using defaults:"+m)}A=x?A:y;this._set("breakpoints",{...A})}}}]);return r}(D);b.__decorate([c.property()],D.prototype,"breakpoints",null);b.__decorate([c.property()],D.prototype,"orientation",void 0);b.__decorate([c.property()],D.prototype,
"widthBreakpoint",void 0);b.__decorate([c.property()],D.prototype,"heightBreakpoint",void 0);return D=b.__decorate([e.subclass("esri.views.BreakpointsOwner")],D)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatures"],function(a,g,b){function p(f){return"array"in f}a.SamplePosition=function(f,k=null,c=0){this.array=f;this.spatialReference=k;this.offset=c};a.getElevationAtPoint=
function(f,k,c="ground"){if(b.isDehydratedPoint(k))return f.getElevation(k.x,k.y,k.z||0,k.spatialReference,c);if(p(k)){let d=k.offset;return f.getElevation(k.array[d++],k.array[d++],k.array[d]||0,g.unwrapOr(k.spatialReference,f.spatialReference),c)}return f.getElevation(k[0],k[1],k[2]||0,f.spatialReference,c)};a.isSamplePosition=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/has ../../core/typedArrayUtil ../../core/maybe ../../geometry/SpatialReference ../../geometry/support/typeUtils ../../core/uid ../../geometry/support/aaBoundingRect ../support/Field ../../core/byteSizeEstimations ../../geometry/support/aaBoundingBox ../../geometry/support/quantizationUtils ./dehydratedFeatureComparison".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){function v(z,r,C){if(!z)return null;switch(r){case "point":return{x:z.x,y:z.y,z:z.z,m:z.m,hasZ:null!=z.z,hasM:null!=z.m,type:"point",spatialReference:C};case "polyline":return{paths:z.paths,hasZ:!!z.hasZ,hasM:!!z.hasM,type:"polyline",spatialReference:C};case "polygon":return{rings:z.rings,hasZ:!!z.hasZ,hasM:!!z.hasM,type:"polygon",spatialReference:C};case "multipoint":return{points:z.points,hasZ:!!z.hasZ,hasM:!!z.hasM,type:"multipoint",spatialReference:C}}}function t(z){if(p.isNone(z))return 0;
let r=32;switch(z.type){case "point":r+=42;break;case "polyline":case "polygon":{var C=0;const A=2+(z.hasZ?1:0)+(z.hasM?1:0);z="polyline"===z.type?z.paths:z.rings;for(const x of z)C+=x.length;r+=8*C*A+64;r+=128*C;r=r+34+32*(z.length+1);break}case "multipoint":C=z.points.length;r+=8*C*(2+(z.hasZ?1:0)+(z.hasM?1:0))+64;r+=128*C;r=r+34+32;break;case "extent":r+=98;z.hasM&&(r+=32);z.hasZ&&(r+=32);break;case "mesh":r+=b.estimateSize(z.vertexAttributes.position),r+=b.estimateSize(z.vertexAttributes.normal),
r+=b.estimateSize(z.vertexAttributes.uv),r+=b.estimateSize(z.vertexAttributes.tangent)}return r}function l(z,r){n.empty(r);"mesh"===z.type&&(z=z.extent);switch(z.type){case "point":r[0]=r[3]=z.x;r[1]=r[4]=z.y;z.hasZ&&(r[2]=r[5]=z.z);break;case "polyline":for(var C=0;C<z.paths.length;C++)n.expandWithNestedArray(r,z.paths[C],z.hasZ);break;case "polygon":for(C=0;C<z.rings.length;C++)n.expandWithNestedArray(r,z.rings[C],z.hasZ);break;case "multipoint":n.expandWithNestedArray(r,z.points,z.hasZ);break;
case "extent":r[0]=z.xmin,r[1]=z.ymin,r[3]=z.xmax,r[4]=z.ymax,null!=z.zmin&&(r[2]=z.zmin),null!=z.zmax&&(r[5]=z.zmax)}}function w(z,r){d.empty(r);"mesh"===z.type&&(z=z.extent);switch(z.type){case "point":r[0]=r[2]=z.x;r[1]=r[3]=z.y;break;case "polyline":for(var C=0;C<z.paths.length;C++)d.expandWithNestedArray(r,z.paths[C]);break;case "polygon":for(C=0;C<z.rings.length;C++)d.expandWithNestedArray(r,z.rings[C]);break;case "multipoint":d.expandWithNestedArray(r,z.points);break;case "extent":r[0]=z.xmin,
r[1]=z.ymin,r[2]=z.xmax,r[3]=z.ymax}}const y=n.create(),D=d.create();a.equals=u.equals;a.DehydratedFeatureClass=function(z,r,C){this.uid=z;this.geometry=r;this.attributes=C;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=
l;a.computeAABR=w;a.estimateGeometryObjectSize=t;a.estimateSize=function(z){let r;r=32+h.estimateAttributesObjectSize(z.attributes);return r=r+3+(8+t(z.geometry))};a.expandAABB=function(z,r){l(z,y);n.expandWithAABB(r,y)};a.expandAABR=function(z,r){w(z,D);d.expand(r,D)};a.fromFeatureSetJSON=function(z){const r=k.featureGeometryTypeKebabDictionary.fromJSON(z.geometryType),C=f.fromJSON(z.spatialReference),A=z.transform,x=z.features.map(m=>{var B=z.objectIdFieldName;m={uid:c.generateUID(),objectId:B&&
m.attributes?m.attributes[B]:null,attributes:m.attributes,geometry:v(m.geometry,r,C),visible:!0};if((B=m.geometry)&&A)switch(B.type){case "point":m.geometry=q.unquantizePoint(A,B,B,B.hasZ,B.hasM);break;case "multipoint":m.geometry=q.unquantizeMultipoint(A,B,B,B.hasZ,B.hasM);break;case "polygon":m.geometry=q.unquantizePolygon(A,B,B,B.hasZ,B.hasM);break;case "polyline":m.geometry=q.unquantizePolyline(A,B,B,B.hasZ,B.hasM)}return m});return{geometryType:r,features:x,spatialReference:C,fields:z.fields?
z.fields.map(m=>e.fromJSON(m)):null,objectIdFieldName:z.objectIdFieldName,globalIdFieldName:z.globalIdFieldName,geohashFieldName:z.geohashFieldName,geometryProperties:z.geometryProperties,hasZ:z.hasZ,hasM:z.hasM,exceededTransferLimit:z.exceededTransferLimit,transform:null}};a.fromJSONGeometry=v;a.getObjectId=function(z,r){return null!=z.objectId?z.objectId:z.attributes&&r?z.attributes[r]:null};a.hasGeometry=function(z){return p.isSome(z.geometry)};a.hasVertices=function(z){if(!z)return!1;switch(z.type){case "extent":case "point":return!0;
case "polyline":for(const r of z.paths)if(0<r.length)return!0;return!1;case "polygon":for(const r of z.rings)if(0<r.length)return!0;return!1;case "multipoint":return 0<z.points.length;case "mesh":return z.vertexAttributes&&z.vertexAttributes.position&&0<z.vertexAttributes.position.length}};a.isDehydratedPoint=function(z){return"point"===z.type};a.isFeatureGeometry=function(z){return k.isFeatureGeometryType(z.type)};a.makeDehydratedPoint=function(z,r,C,A){return{x:z,y:r,z:C,hasZ:null!=C,hasM:!1,spatialReference:A,
type:"point"}};a.numVertices=function(z){if(p.isNone(z))return 0;switch(z.type){case "point":return 1;case "polyline":var r=0;for(var C of z.paths)r+=C.length;return r;case "polygon":C=0;for(r of z.rings)C+=r.length;return C;case "multipoint":return z.points.length;case "extent":return 2;case "mesh":return(z=z.vertexAttributes&&z.vertexAttributes.position)?z.length/3:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function g(b){return 32+
b.length}a.estimateAttributesObjectSize=function(b){if(!b)return 0;let p=32;for(const f in b)if(b.hasOwnProperty(f)){const k=b[f];switch(typeof k){case "string":p+=g(k);break;case "number":p+=16;break;case "boolean":p+=4}}return p};a.estimateFixedArraySize=function(b,p){return 32+b.length*p};a.estimateNumberByteSize=function(){return 16};a.estimateStringByteSize=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../../core/maybe",
"../Extent","./aaBoundingRect"],function(a,g,b,p){function f(l=v){return[l[0],l[1],l[2],l[3],l[4],l[5]]}function k(l,w,y,D,z,r,C=f()){C[0]=l;C[1]=w;C[2]=y;C[3]=D;C[4]=z;C[5]=r;return C}function c(l){return l[0]>=l[3]?0:l[3]-l[0]}function d(l){return l[1]>=l[4]?0:l[4]-l[1]}function e(l){return l[2]>=l[5]?0:l[5]-l[2]}function h(l,w){return Math.max(w[0],l[0])<=Math.min(w[3],l[3])&&Math.max(w[1],l[1])<=Math.min(w[4],l[4])&&Math.max(w[2],l[2])<=Math.min(w[5],l[5])}function n(l,w){l[0]=w[0];l[1]=w[1];
l[2]=w[2];l[3]=w[3];l[4]=w[4];l[5]=w[5];return l}function q(l){return 6===l.length}const u=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],v=[0,0,0,0,0,0],t=f();a.NEGATIVE_INFINITY=u;a.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];a.ZERO=v;a.allFinite=function(l){for(let w=0;6>w;w++)if(!isFinite(l[w]))return!1;return!0};a.center=function(l,w=[0,0,0]){w[0]=l[0]+c(l)/2;w[1]=l[1]+d(l)/2;w[2]=l[2]+e(l)/2;return w};a.contains=function(l,w){return w[0]>=l[0]&&w[1]>=
l[1]&&w[2]>=l[2]&&w[3]<=l[3]&&w[4]<=l[4]&&w[5]<=l[5]};a.containsPoint=function(l,w){return w[0]>=l[0]&&w[1]>=l[1]&&w[2]>=l[2]&&w[0]<=l[3]&&w[1]<=l[4]&&w[2]<=l[5]};a.containsPointWithMargin=function(l,w,y){return w[0]>=l[0]-y&&w[1]>=l[1]-y&&w[2]>=l[2]-y&&w[0]<=l[3]+y&&w[1]<=l[4]+y&&w[2]<=l[5]+y};a.create=f;a.depth=d;a.diameter=function(l){const w=c(l),y=e(l);l=d(l);return Math.sqrt(w*w+y*y+l*l)};a.empty=function(l){return l?n(l,u):f(u)};a.equals=function(l,w,y){if(g.isNone(l)||g.isNone(w))return l===
w;if(!q(l)||!q(w))return!1;if(y)for(let D=0;D<l.length;D++){if(!y(l[D],w[D]))return!1}else for(y=0;y<l.length;y++)if(l[y]!==w[y])return!1;return!0};a.expandWithAABB=function(l,w){l[0]=Math.min(l[0],w[0]);l[1]=Math.min(l[1],w[1]);l[2]=Math.min(l[2],w[2]);l[3]=Math.max(l[3],w[3]);l[4]=Math.max(l[4],w[4]);l[5]=Math.max(l[5],w[5])};a.expandWithBuffer=function(l,w,y=0,D=w.length/3){let z=l[0],r=l[1],C=l[2],A=l[3],x=l[4],m=l[5];for(let B=0;B<D;B++)z=Math.min(z,w[y+3*B]),r=Math.min(r,w[y+3*B+1]),C=Math.min(C,
w[y+3*B+2]),A=Math.max(A,w[y+3*B]),x=Math.max(x,w[y+3*B+1]),m=Math.max(m,w[y+3*B+2]);l[0]=z;l[1]=r;l[2]=C;l[3]=A;l[4]=x;l[5]=m};a.expandWithNestedArray=function(l,w,y){const D=w.length;let z=l[0],r=l[1],C=l[2],A=l[3],x=l[4],m=l[5];if(y)for(y=0;y<D;y++){var B=w[y];z=Math.min(z,B[0]);r=Math.min(r,B[1]);C=Math.min(C,B[2]);A=Math.max(A,B[0]);x=Math.max(x,B[1]);m=Math.max(m,B[2])}else for(y=0;y<D;y++)B=w[y],z=Math.min(z,B[0]),r=Math.min(r,B[1]),A=Math.max(A,B[0]),x=Math.max(x,B[1]);l[0]=z;l[1]=r;l[2]=
C;l[3]=A;l[4]=x;l[5]=m};a.expandWithOffset=function(l,w,y,D){l[0]=Math.min(l[0],l[0]+w);l[3]=Math.max(l[3],l[3]+w);l[1]=Math.min(l[1],l[1]+y);l[4]=Math.max(l[4],l[4]+y);l[2]=Math.min(l[2],l[2]+D);l[5]=Math.max(l[5],l[5]+D)};a.expandWithRect=function(l,w){l[0]=Math.min(l[0],w[0]);l[1]=Math.min(l[1],w[1]);l[3]=Math.max(l[3],w[2]);l[4]=Math.max(l[4],w[3])};a.expandWithVec3=function(l,w){l[0]=Math.min(l[0],w[0]);l[1]=Math.min(l[1],w[1]);l[2]=Math.min(l[2],w[2]);l[3]=Math.max(l[3],w[0]);l[4]=Math.max(l[4],
w[1]);l[5]=Math.max(l[5],w[2])};a.fromExtent=function(l,w=f()){w[0]=l.xmin;w[1]=l.ymin;w[2]=l.zmin;w[3]=l.xmax;w[4]=l.ymax;w[5]=l.zmax;return w};a.fromMinMax=function(l,w,y=f()){y[0]=l[0];y[1]=l[1];y[2]=l[2];y[3]=w[0];y[4]=w[1];y[5]=w[2];return y};a.fromRect=function(l,w){l[0]=w[0];l[1]=w[1];l[2]=Number.NEGATIVE_INFINITY;l[3]=w[2];l[4]=w[3];l[5]=Number.POSITIVE_INFINITY;return l};a.fromValues=k;a.getMax=function(l,w){w[0]=l[3];w[1]=l[4];w[2]=l[5];return w};a.getMin=function(l,w){w[0]=l[0];w[1]=l[1];
w[2]=l[2];return w};a.height=e;a.intersects=h;a.intersectsClippingArea=function(l,w){return g.isNone(w)?!0:h(l,w)};a.is=q;a.isPoint=function(l){return 0===c(l)&&0===d(l)&&0===e(l)};a.maximumDimension=function(l){return Math.max(c(l),e(l),d(l))};a.offset=function(l,w,y,D,z=l){z[0]=l[0]+w;z[1]=l[1]+y;z[2]=l[2]+D;z[3]=l[3]+w;z[4]=l[4]+y;z[5]=l[5]+D;return z};a.scale=function(l,w,y=l){const D=l[0]+c(l)/2,z=l[1]+d(l)/2,r=l[2]+e(l)/2;y[0]=D+(l[0]-D)*w;y[1]=z+(l[1]-z)*w;y[2]=r+(l[2]-r)*w;y[3]=D+(l[3]-D)*
w;y[4]=z+(l[4]-z)*w;y[5]=r+(l[5]-r)*w;return y};a.set=n;a.setMax=function(l,w,y=l){y[3]=w[0];y[4]=w[1];y[5]=w[2];y!==l&&(y[0]=l[0],y[1]=l[1],y[2]=l[2]);return l};a.setMin=function(l,w,y=l){y[0]=w[0];y[1]=w[1];y[2]=w[2];y!==l&&(y[3]=l[3],y[4]=l[4],y[5]=l[5]);return y};a.size=function(l,w=[0,0,0]){w[0]=c(l);w[1]=d(l);w[2]=e(l);return w};a.toExtent=function(l,w){return isFinite(l[2])||isFinite(l[5])?new b({xmin:l[0],xmax:l[3],ymin:l[1],ymax:l[4],zmin:l[2],zmax:l[5],spatialReference:w}):new b({xmin:l[0],
xmax:l[3],ymin:l[1],ymax:l[4],spatialReference:w})};a.toRect=function(l,w){w||(w=p.create());w[0]=l[0];w[1]=l[1];w[2]=l[3];w[3]=l[4];return w};a.width=c;a.wrap=function(l,w,y,D,z,r){return k(l,w,y,D,z,r,t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,g){function b({scale:B,translate:E},F){return Math.round((F-E[0])/B[0])}function p({scale:B,translate:E},F){return Math.round((E[1]-F)/B[1])}function f(B,
E,F){const G=[];let I,K,J,L;for(let P=0;P<F.length;P++){const Q=F[P];if(0<P){if(J=b(B,Q[0]),L=p(B,Q[1]),J!==I||L!==K)G.push(E(Q,J-I,L-K)),I=J,K=L}else I=b(B,Q[0]),K=p(B,Q[1]),G.push(E(Q,I,K))}return 0<G.length?G:null}function k(B,E,F,G){return f(B,F?G?m:x:G?x:A,E)}function c(B,E,F,G){const I=[];F=F?G?m:x:G?x:A;for(G=0;G<E.length;G++){const K=f(B,F,E[G]);K&&3<=K.length&&I.push(K)}return I.length?I:null}function d(B,E,F,G){const I=[];F=F?G?m:x:G?x:A;for(G=0;G<E.length;G++){const K=f(B,F,E[G]);K&&2<=
K.length&&I.push(K)}return I.length?I:null}function e({scale:B,translate:E},F){return F*B[0]+E[0]}function h({scale:B,translate:E},F){return E[1]-F*B[1]}function n(B,E,F){const G=Array(F.length);if(!F.length)return G;const [I,K]=B.scale;let J=e(B,F[0][0]);B=h(B,F[0][1]);G[0]=E(F[0],J,B);for(let L=1;L<F.length;L++){const P=F[L];J+=P[0]*I;B-=P[1]*K;G[L]=E(P,J,B)}return G}function q(B,E,F){const G=Array(F.length);for(let I=0;I<F.length;I++)G[I]=n(B,E,F[I]);return G}function u(B,E,F,G){return n(B,F?G?
m:x:G?x:A,E)}function v(B,E,F,G){return q(B,F?G?m:x:G?x:A,E)}function t(B,E,F,G){return q(B,F?G?m:x:G?x:A,E)}function l(B,E,F){let [G,I]=F[0],K=Math.min(G,E[0]),J=Math.min(I,E[1]),L=Math.max(G,E[2]);E=Math.max(I,E[3]);for(let P=1;P<F.length;P++){const [Q,X]=F[P];G+=Q;I+=X;0>Q&&(K=Math.min(K,G));0<Q&&(L=Math.max(L,G));0>X?J=Math.min(J,I):0<X&&(E=Math.max(E,I))}B[0]=K;B[1]=J;B[2]=L;B[3]=E;return B}function w(B,E){if(!E.length)return null;B[0]=B[1]=Number.POSITIVE_INFINITY;B[2]=B[3]=Number.NEGATIVE_INFINITY;
for(let F=0;F<E.length;F++)l(B,B,E[F]);return B}function y(B,E,F,G,I){E.xmin=b(B,F.xmin);E.ymin=p(B,F.ymin);E.xmax=b(B,F.xmax);E.ymax=p(B,F.ymax);E!==F&&(G&&(E.zmin=F.zmin,E.zmax=F.zmax),I&&(E.mmin=F.mmin,E.mmax=F.mmax));return E}function D(B,E,F,G,I){E.points=k(B,F.points,G,I);return E}function z(B,E,F,G,I){E.x=b(B,F.x);E.y=p(B,F.y);E!==F&&(G&&(E.z=F.z),I&&(E.m=F.m));return E}function r(B,E,F,G,I){B=c(B,F.rings,G,I);if(!B)return null;E.rings=B;return E}function C(B,E,F,G,I){B=d(B,F.paths,G,I);if(!B)return null;
E.paths=B;return E}const A=(B,E,F)=>[E,F],x=(B,E,F)=>[E,F,B[2]],m=(B,E,F)=>[E,F,B[2],B[3]];a.equals=function(B,E){if(B===E||null==B&&null==E)return!0;if(null==B||null==E)return!1;let F,G,I,K;B&&"upperLeft"===B.originPosition?(F=B.translate[0],G=B.translate[1],B=B.scale[0]):(F=B.extent.xmin,G=B.extent.ymax,B=B.tolerance);E&&"upperLeft"===E.originPosition?(I=E.translate[0],K=E.translate[1],E=E.scale[0]):(I=E.extent.xmin,K=E.extent.ymax,E=E.tolerance);return F===I&&G===K&&B===E};a.getQuantizedBoundsCoordsArray=
l;a.getQuantizedBoundsCoordsArrayArray=w;a.getQuantizedBoundsPaths=function(B){return w([0,0,0,0],B)};a.getQuantizedBoundsPoints=function(B){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return l(E,E,B)};a.getQuantizedBoundsRings=function(B){return w([0,0,0,0],B)};a.quantizeBounds=function(B,E,F){E[0]=b(B,F[0]);E[3]=p(B,F[1]);E[2]=b(B,F[2]);E[1]=p(B,F[3]);return E};a.quantizeExtent=y;a.quantizeGeometry=function(B,E){return B&&E?g.isPoint(E)?
z(B,{},E,!1,!1):g.isPolyline(E)?C(B,{},E,!1,!1):g.isPolygon(E)?r(B,{},E,!1,!1):g.isMultipoint(E)?D(B,{},E,!1,!1):g.isExtent(E)?y(B,{},E,!1,!1):null:null};a.quantizeMultipoint=D;a.quantizePaths=d;a.quantizePoint=z;a.quantizePoints=k;a.quantizePolygon=r;a.quantizePolyline=C;a.quantizeRings=c;a.quantizeX=b;a.quantizeY=p;a.toQuantizationTransform=function(B){return B?{originPosition:"upper-left"===B.originPosition?"upperLeft":"lower-left"===B.originPosition?"lowerLeft":B.originPosition,scale:B.tolerance?
[B.tolerance,B.tolerance]:[1,1],translate:B.extent?[B.extent.xmin,B.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(B,E,F){return F?(E[0]=e(B,F[0]),E[1]=h(B,F[3]),E[2]=e(B,F[2]),E[3]=h(B,F[1]),E):[e(B,E[0]),h(B,E[3]),e(B,E[2]),h(B,E[1])]};a.unquantizeCoordsArray=n;a.unquantizeCoordsArrayArray=q;a.unquantizeExtent=function(B,E,F,G,I){E.xmin=e(B,F.xmin);E.ymin=h(B,F.ymin);E.xmax=e(B,F.xmax);E.ymax=h(B,F.ymax);E!==F&&(G&&(E.zmin=F.zmin,E.zmax=F.zmax),I&&(E.mmin=F.mmin,E.mmax=F.mmax));return E};
a.unquantizeMultipoint=function(B,E,F,G,I){E.points=u(B,F.points,G,I);return E};a.unquantizePaths=v;a.unquantizePoint=function(B,E,F,G,I){E.x=e(B,F.x);E.y=h(B,F.y);E!==F&&(G&&(E.z=F.z),I&&(E.m=F.m));return E};a.unquantizePoints=u;a.unquantizePolygon=function(B,E,F,G,I){E.rings=t(B,F.rings,G,I);return E};a.unquantizePolyline=function(B,E,F,G,I){E.paths=v(B,F.paths,G,I);return E};a.unquantizeRings=t;a.unquantizeX=e;a.unquantizeY=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../core/maybe"],function(a,g,b){function p(h,n){if(h===n)return!0;if(null==h||null==n||h.length!==n.length)return!1;for(let q=0;q<h.length;q++){const u=h[q],v=n[q];if(u.length!==v.length)return!1;for(let t=0;t<u.length;t++)if(u[t]!==v[t])return!1}return!0}function f(h,n){if(h===n)return!0;if(null==h||null==n||h.length!==n.length)return!1;for(let q=0;q<h.length;q++)if(!p(h[q],n[q]))return!1;return!0}function k(h,n){return c(h.spatialReference,n.spatialReference)?h.x===n.x&&h.y===
n.y&&h.z===n.z&&h.m===n.m:!1}function c(h,n){return h===n||h&&n&&h.equals(n)}function d(h,n){if(h===n)return!0;if(b.isNone(h)||b.isNone(n)||h.type!==n.type)return!1;switch(h.type){case "point":return k(h,n);case "extent":return h=h.hasZ!==n.hasZ||h.hasM!==n.hasM?!1:c(h.spatialReference,n.spatialReference)?h.xmin===n.xmin&&h.ymin===n.ymin&&h.zmin===n.zmin&&h.xmax===n.xmax&&h.ymax===n.ymax&&h.zmax===n.zmax:!1,h;case "polyline":return h=h.hasZ!==n.hasZ||h.hasM!==n.hasM?!1:c(h.spatialReference,n.spatialReference)?
f(h.paths,n.paths):!1,h;case "polygon":return h=h.hasZ!==n.hasZ||h.hasM!==n.hasM?!1:c(h.spatialReference,n.spatialReference)?f(h.rings,n.rings):!1,h;case "multipoint":return h=h.hasZ!==n.hasZ||h.hasM!==n.hasM?!1:c(h.spatialReference,n.spatialReference)?p(h.points,n.points):!1,h;case "mesh":return!1}}function e(h,n){if(h===n)return!0;if(!h||!n)return!1;const q=Object.keys(h),u=Object.keys(n);if(q.length!==u.length)return!1;for(const v of q)if(h[v]!==n[v])return!1;return!0}a.equals=function(h,n){return h===
n?!0:null!=h&&null!=n&&h.objectId===n.objectId&&d(h.geometry,n.geometry)&&e(h.attributes,n.attributes)?!0:!1};a.pointEquals=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ./support/GroundViewElevationSampler".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){b=function(w){function y(z){z=w.call(this,z)||this;z.handles=new v;z.view=null;z.layerViews=new u;return z}a._inheritsLoose(y,w);var D=y.prototype;D.initialize=function(){this.handles.add(t.when(this,"view.map.ground",z=>z.load()));this.handles.add(this.layerViews.on("after-changes",()=>this.layerViewsAfterChangesHandler()))};D.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};D.layerViewsAfterChangesHandler=
function(){this.handles.remove("updating");this.handles.add(this.layerViews.map(z=>z.watch("updating",()=>this.updateUpdating(),!0)).toArray(),"updating");this.updateUpdating()};D.updateUpdating=function(){this.notifyChange("updating")};a._createClass(y,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new l({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(z=>
z.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return y}(q);g.__decorate([k.property({readOnly:!0})],b.prototype,"elevationSampler",null);g.__decorate([k.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);g.__decorate([k.property({constructOnly:!0})],b.prototype,"view",void 0);g.__decorate([k.property({type:u,readOnly:!0})],b.prototype,"layerViews",void 0);g.__decorate([k.property({readOnly:!0})],b.prototype,"suspended",null);return b=g.__decorate([d.subclass("esri.views.GroundView")],
b)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/support/webMercatorUtils ../../geometry/support/contains ../../core/Evented ../../geometry/support/aaBoundingRect ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){const D=p.getLogger("esri.views.support.GroundViewElevationSampler");b=function(z){function r(A){A=z.call(this,A)||this;A.demResolution={min:-1,max:-1};A.noDataValue=y.ELEVATION_NODATA_VALUE;return A}a._inheritsLoose(r,z);var C=r.prototype;C.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};C.elevationAt=function(A){var x=A.spatialReference;const m=this.spatialReference;if(!q.canProject(x,m))return D.error(`Cannot sample elevation at a location with spatial reference (${x?
x.wkid:"unknown"}) different from the view (${m.wkid})`),null;u.extentContainsPoint(this.extent,A)||(x=this.extent,D.warn("#elevationAt()",`Point used to sample elevation (${A.x}, ${A.y}) is outside of the sampler extent (${`${x.xmin}, ${x.ymin}, ${x.xmax}, ${x.ymax}`})`));return w.getElevationAtPoint(this.view.elevationProvider,A)};C.queryElevation=function(A){return l.updateGeometryElevation(A.clone(),this)};a._createClass(r,[{key:"extent",get:function(){const A=this.view.basemapTerrain;return A.extent&&
A.spatialReference?t.toExtent(A.extent,A.spatialReference):null}}]);return r}(v.EventedAccessor);g.__decorate([k.property({readOnly:!0})],b.prototype,"demResolution",void 0);g.__decorate([k.property({readOnly:!0})],b.prototype,"extent",null);g.__decorate([k.property({readOnly:!0})],b.prototype,"noDataValue",void 0);g.__decorate([k.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.prototype,"spatialReference",void 0);g.__decorate([k.property({constructOnly:!0})],b.prototype,
"view",void 0);return b=g.__decorate([d.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../core/Logger ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/support/contains ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){function q(y,D){const z=u(y,D.spatialReference);
if(!z)return null;switch(y.type){case "point":y.z=p.unwrapOr(D.elevationAt(z),0);break;case "polyline":l.spatialReference=z.spatialReference;var r=y.hasM&&!y.hasZ;for(var C=0;C<y.paths.length;C++){var A=y.paths[C],x=z.paths[C];for(let m=0;m<A.length;m++){const B=A[m],E=x[m];l.x=E[0];l.y=E[1];r&&(B[3]=B[2]);B[2]=p.unwrapOr(D.elevationAt(l),0)}}y.hasZ=!0;break;case "multipoint":l.spatialReference=z.spatialReference;r=y.hasM&&!y.hasZ;for(C=0;C<y.points.length;C++)A=y.points[C],x=z.points[C],l.x=x[0],
l.y=x[1],r&&(A[3]=A[2]),A[2]=p.unwrapOr(D.elevationAt(l),0);y.hasZ=!0}return y}function u(y,D){const z=y.spatialReference;return z.equals(D)?y:k.canProject(z,D)?k.project(y,D):(v.error(`Cannot project geometry spatial reference (wkid:${z.wkid}) to elevation sampler spatial reference (wkid:${D.wkid})`),null)}const v=f.getLogger("esri.layers.support.ElevationSampler");b=function(){function y(){}var D=y.prototype;D.queryElevation=function(z){return q(z.clone(),this)};D.on=function(){return w};D.projectIfRequired=
function(z,r){return u(z,r)};return y}();let t=function(y){function D(r,C,A){var x=y.call(this)||this;x.tile=r;x.noDataValue=A;x.extent=n.toExtent(r.tile.extent,C.spatialReference);A=h.getMetersPerUnitForSR(C.spatialReference);r=C.lodAt(r.tile.level).resolution*A;x.demResolution={min:r,max:r};return x}g._inheritsLoose(D,y);var z=D.prototype;z.contains=function(r){r=this.projectIfRequired(r,this.spatialReference);return d.extentContainsPoint(this.extent,r)};z.elevationAt=function(r){const C=this.projectIfRequired(r,
this.spatialReference);if(!C)return null;if(!this.contains(r)){const A=this.extent;v.warn("#elevationAt()",`Point used to sample elevation (${r.x}, ${r.y}) is outside of the sampler extent (${`${A.xmin}, ${A.ymin}, ${A.xmax}, ${A.ymax}`})`)}return this.tile.sample(C.x,C.y)};g._createClass(D,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return D}(b);f=function(y){function D(z,r,C){var A=y.call(this)||this;let x;"number"===typeof r?(A.noDataValue=r,x=null):(x=r,A.noDataValue=
C);A.samplers=x?z.map(m=>new t(m,x,A.noDataValue)):z;if(z=A.samplers[0]){A.extent=z.extent.clone();const {min:m,max:B}=z.demResolution;A.demResolution={min:m,max:B};for(z=1;z<A.samplers.length;z++)r=A.samplers[z],A.extent.union(r.extent),A.demResolution.min=Math.min(A.demResolution.min,r.demResolution.min),A.demResolution.max=Math.max(A.demResolution.max,r.demResolution.max)}else A.extent=n.toExtent(n.create(),x.spatialReference),A.demResolution={min:0,max:0};return A}g._inheritsLoose(D,y);D.prototype.elevationAt=
function(z){const r=this.projectIfRequired(z,this.spatialReference);if(!r)return null;for(const C of this.samplers)if(C.contains(r))return C.elevationAt(r);v.warn("#elevationAt()",`Point used to sample elevation (${z.x}, ${z.y}) is outside of the sampler`);return null};g._createClass(D,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return D}(b);const l=new c,w={remove(){}};a.ElevationSamplerBase=b;a.MultiTileElevationSampler=f;a.TileElevationSampler=t;a.updateGeometryElevation=
q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,g,b,p){g=g.clampFloat32(g.NUMBER_MAX_FLOAT32/10);const f=b.create();p.WebMercatorAuxiliarySphere.getExtent(0,0,0,f);b=b.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;a.ELEVATION_NODATA_VALUE=g;a.GEOGRAPHIC_WORLD_EXTENT=b;a.GEOMETRY_VERTEX_STRIDE=5;a.LOADING_LEVEL_MODULO=2;a.LayerClasses=[0,1];a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
a.WEBMERCATOR_WORLD_EXTENT=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../../../geometry/Extent ../../../geometry ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../layers/support/TileInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){d=function(){function t(w){var y=t.checkUnsupported(w);if(y)throw y;this.spatialReference=w.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=q.canProjectToWGS84ComparableLonLat(this.spatialReference)||p.isMars(this.spatialReference)||p.isMoon(this.spatialReference);this.origin=[w.origin.x,w.origin.y];this.pixelSize=w.size[0];this.dpi=w.dpi;var D=w.lods.reduce(function(C,A,x){A.level<C.min&&(C.min=A.level,C.minIndex=x);C.max=Math.max(C.max,
A.level);return C},{min:Infinity,minIndex:0,max:-Infinity}),z=w.lods[D.minIndex];const r=2**z.level;y=z.resolution*r;z=z.scale*r;this.levels=Array(D.max+1);for(D=0;D<this.levels.length;D++)this.levels[D]={resolution:y,scale:z,tileSize:[y*w.size[0],y*w.size[1]]},y/=2,z/=2}var l=t.prototype;l.clone=function(){return new t(this.toTileInfo())};l.toTileInfo=function(){return new u({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],
spatialReference:this.spatialReference,lods:this.levels.map((w,y)=>({level:y,scale:w.scale,resolution:w.resolution}))})};l.getExtent=function(w,y,D,z){var r=this.levels[w];w=r.tileSize[0];r=r.tileSize[1];z[0]=this.origin[0]+D*w;z[2]=z[0]+w;z[3]=this.origin[1]-y*r;z[1]=z[3]-r};l.convertExtentToRadians=function(w,y){this._isWebMercator?(y[0]=k.x2lon(w[0]),y[1]=k.y2lat(w[1]),y[2]=k.x2lon(w[2]),y[3]=k.y2lat(w[3])):this._isGCS&&(y[0]=e.deg2rad(w[0]),y[1]=e.deg2rad(w[1]),y[2]=e.deg2rad(w[2]),y[3]=e.deg2rad(w[3]))};
l.getExtentGeometry=function(w,y,D,z=new c){this.getExtent(w,y,D,v);z.spatialReference=this.spatialReference;z.xmin=v[0];z.ymin=v[1];z.xmax=v[2];z.ymax=v[3];z.zmin=void 0;z.zmax=void 0;return z};l.ensureMaxLod=function(w){if(null==w)return!1;for(var y=!1;this.levels.length<=w;){y=this.levels[this.levels.length-1];const D=y.resolution/2;this.levels.push({resolution:D,scale:y.scale/2,tileSize:[D*this.pixelSize,D*this.pixelSize]});y=!0}return y};l.capMaxLod=function(w){this.levels.length>w+1&&(this.levels.length=
w+1)};l.getMaxLod=function(){return this.levels.length-1};l.scaleAtLevel=function(w){return this.levels[0].scale/2**w};l.levelAtScale=function(w){const y=this.levels[0].scale;return w>=y?0:Math.log(y/w)*Math.LOG2E};l.resolutionAtLevel=function(w){return this.levels[0].resolution/2**w};l.compatibleWith=function(w){if(!(w instanceof t)){if(t.checkUnsupported(w))return!1;w=new t(w)}if(!w.spatialReference.equals(this.spatialReference)||w.pixelSize!==this.pixelSize)return!1;const y=Math.min(this.levels.length,
w.levels.length)-1,D=this.levels[y].resolution;let z=.5*D;if(!e.floatEqualAbsolute(w.origin[0],this.origin[0],z)||!e.floatEqualAbsolute(w.origin[1],this.origin[1],z))return!1;z=.5*D/2**y/this.pixelSize*12;return e.floatEqualAbsolute(D,w.levels[y].resolution,z)};l.rootTilesInExtent=function(w,y=null,D=Infinity){const z=this.levels[0].tileSize;if(0===z[0]||0===z[1])return[];t.computeRowColExtent(w,z,this.origin,v);w=v[1];let r=v[3],C=v[0],A=v[2];var x=A-C,m=r-w;x*m>D&&(D=Math.floor(Math.sqrt(D)),m>
D&&(w=w+Math.floor(.5*m)-Math.floor(.5*D),r=w+D),x>D&&(C=C+Math.floor(.5*x)-Math.floor(.5*D),A=C+D));D=[];for(x=w;x<r;x++)for(m=C;m<A;m++)D.push([0,x,m]);g.isSome(y)&&(y[0]=this.origin[0]+C*z[0],y[1]=this.origin[1]-r*z[1],y[2]=this.origin[0]+A*z[0],y[3]=this.origin[1]-w*z[1]);return D};t.computeRowColExtent=function(w,y,D,z){const r=.001*(w[2]-w[0]+(w[3]-w[1]));z[0]=Math.max(0,Math.floor((w[0]+r-D[0])/y[0]));z[2]=Math.max(0,Math.ceil((w[2]-r-D[0])/y[0]));z[1]=Math.max(0,Math.floor((D[1]-w[3]+r)/y[1]));
z[3]=Math.max(0,Math.ceil((D[1]-w[1]-r)/y[1]))};t.isPowerOfTwo=function(w){w=w.lods;const y=w[0].resolution*2**w[0].level;return!w.some(function(D){return!e.floatEqualRelative(D.resolution,y/2**D.level)})};t.hasGapInLevels=function(w){w=w.lods.map(function(y){return y.level});w.sort(function(y,D){return y-D});for(let y=1;y<w.length;y++)if(w[y]!==w[0]+y)return!0;return!1};t.tileSizeSupported=function(w){const y=w.size[1];return y===w.size[0]&&0===(y&y-1)&&128<=y&&512>=y};t.checkUnsupported=function(w){return w?
1>w.lods.length?new b("tilingscheme:generic","Tiling scheme must have at least one level"):t.isPowerOfTwo(w)?t.hasGapInLevels(w)?new b("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):t.tileSizeSupported(w)?null:new b("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new b("tilingscheme:power-of-two","Tiling scheme must be power of two"):new b("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};
t.fromExtent=function(w,y){const D=w[2]-w[0],z=w[3]-w[1],r=h.getMetersPerUnitForSR(y),C=1.2*Math.max(D,z);w=new t(new u({size:[256,256],origin:{x:w[0]-.5*(C-D),y:w[3]+.5*(C-z)},lods:[{level:0,resolution:C/256,scale:1/(256/96*.0254/(C*r))}],spatialReference:y}));w.ensureMaxLod(20);return w};t.makeWebMercatorAuxiliarySphere=function(w){const y=new t(t.WebMercatorAuxiliarySphereTileInfo);y.ensureMaxLod(w);return y};t.makeGCSWithTileSize=function(w,y=256,D=16){const z=256/y;w=new t(new u({size:[y,y],
origin:{x:-180,y:90,spatialReference:w},spatialReference:w,lods:[{level:0,resolution:.703125*z,scale:2.95497598570834E8*z}]}));w.ensureMaxLod(D);return w};a._createClass(t,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return t}();d.WebMercatorAuxiliarySphereTileInfo=new u({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:f.WebMercator},spatialReference:f.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});
d.WebMercatorAuxiliarySphere=d.makeWebMercatorAuxiliarySphere(19);const v=n.create();return d})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect ./LOD".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C){var A;b=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});v=A=function(x){function m(E){E=x.call(this,E)||this;E.dpi=96;E.format=null;E.origin=null;E.minScale=0;E.maxScale=0;E.size=null;E.spatialReference=null;return E}a._inheritsLoose(m,x);m.create=function(E=
{size:256,spatialReference:l.WebMercator}){var F=E.resolutionFactor||1,G=E.scales;const I=E.size||256,K=E.spatialReference||l.WebMercator;if(!t.isValid(K)){F=[];if(G)for(E=0;E<G.length;E++){var J=G[E];F.push({level:E,scale:J,resolution:J})}else for(G=5E-4,E=23;0<=E;E--)F.unshift({level:E,scale:G,resolution:G}),G*=2;return new A({dpi:96,lods:F,origin:new y(0,0,K),size:[I,I],spatialReference:K})}J=t.getInfo(K);E=E.origin?new y({x:E.origin.x,y:E.origin.y,spatialReference:K}):J?new y({x:J.origin[0],y:J.origin[1],
spatialReference:K}):new y({x:0,y:0,spatialReference:K});J=1/(39.37*z.getMetersPerUnitForSR(K)*96);const L=[];if(G)for(F=0;F<G.length;F++){var P=G[F];L.push({level:F,scale:P,resolution:P*J})}else{var Q=t.isGeographic(K)?512/I*5.916575275917094E8:256/I*5.91657527591555E8;G=Math.ceil(24/F);L.push({level:0,scale:Q,resolution:Q*J});for(P=1;P<G;P++)Q/=2**F,L.push({level:P,scale:Q,resolution:Q*J})}return new A({dpi:96,lods:L,origin:E,size:[I,I],spatialReference:K})};var B=m.prototype;B.readOrigin=function(E,
F){return y.fromJSON({spatialReference:F.spatialReference,...E})};B.readSize=function(E,F){return[F.cols,F.rows]};B.writeSize=function(E,F){F.cols=E[0];F.rows=E[0]};B.zoomToScale=function(E){const F=this.scales;if(0>=E)return F[0];if(E>=F.length)return F[F.length-1];{const G=Math.round(E);return F[G]+(G-E)*(F[Math.round(E-.5)]-F[G])}};B.scaleToZoom=function(E){const F=this.scales,G=F.length-1;let I=0;for(;I<G;I++){const K=F[I],J=F[I+1];if(K<=E)break;if(J===E)return I+1;if(K>E&&J<E)return I+1-(E-J)/
(K-J)}return I};B.snapScale=function(E,F=.95){E=this.scaleToZoom(E);return E%Math.floor(E)>=F?this.zoomToScale(Math.ceil(E)):this.zoomToScale(Math.floor(E))};B.tileAt=function(E,F,G,I){var K=this.lodAt(E);if(!K)return null;let J;if("number"===typeof F)J=F,F=G;else{if(t.equals(F.spatialReference,this.spatialReference))J=F.x,F=F.y;else{I=w.project(F,this.spatialReference);if(!I)return null;J=I.x;F=I.y}I=G}G=K.resolution*this.size[0];K=K.resolution*this.size[1];I||(I={id:null,level:0,row:0,col:0,extent:r.create()});
I.level=E;I.row=Math.floor((this.origin.y-F)/K+.001);I.col=Math.floor((J-this.origin.x)/G+.001);this.updateTileInfo(I);return I};B.updateTileInfo=function(E,F=0){var G=this.lodAt(E.level);G||1!==F||(F=this.lods[this.lods.length-1],F.level<E.level&&(G=F));if(G){var I=E.level-G.level;F=G.resolution*this.size[0]/2**I;G=G.resolution*this.size[1]/2**I;E.id=`${E.level}/${E.row}/${E.col}`;E.extent||(E.extent=r.create());E.extent[0]=this.origin.x+E.col*F;E.extent[1]=this.origin.y-(E.row+1)*G;E.extent[2]=
E.extent[0]+F;E.extent[3]=E.extent[1]+G}};B.upsampleTile=function(E){const F=this._upsampleLevels[E.level];if(!F||-1===F.parentLevel)return!1;E.level=F.parentLevel;E.row=Math.floor(E.row/F.factor+.001);E.col=Math.floor(E.col/F.factor+.001);this.updateTileInfo(E);return!0};B.getTileBounds=function(E,F){var {resolution:G}=this.lodAt(F.level);const I=G*this.size[0];G*=this.size[1];E[0]=this.origin.x+F.col*I;E[1]=this.origin.y-(F.row+1)*G;E[2]=E[0]+I;E[3]=E[1]+G;return E};B.lodAt=function(E){return this._levelToLOD&&
this._levelToLOD[E]||null};B.clone=function(){return A.fromJSON(this.write({}))};B._initializeUpsampleLevels=function(){const E=this.lods;this._upsampleLevels=[];let F=null;for(let G=0;G<E.length;G++){const I=E[G];this._upsampleLevels[I.level]={parentLevel:F?F.level:-1,factor:F?F.resolution/I.resolution:0};F=I}};a._createClass(m,[{key:"isWrappable",get:function(){const {spatialReference:E,origin:F}=this;if(E&&F){const G=t.getInfo(E);return E.isWrappable&&Math.abs(G.origin[0]-F.x)<=G.dx}return!1}},
{key:"lods",set:function(E){let F=0,G=0;const I=[];this._levelToLOD={};E&&(F=-Infinity,G=Infinity,E.forEach(K=>{I.push(K.scale);F=K.scale>F?K.scale:F;G=K.scale<G?K.scale:G;this._levelToLOD[K.level]=K}));this._set("scales",I);this._set("minScale",F);this._set("maxScale",G);this._set("lods",E);this._initializeUpsampleLevels()}}]);return m}(v.JSONSupport);g.__decorate([k.property({type:Number,json:{write:!0}})],v.prototype,"compressionQuality",void 0);g.__decorate([k.property({type:Number,json:{write:!0}})],
v.prototype,"dpi",void 0);g.__decorate([k.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],v.prototype,"format",void 0);g.__decorate([k.property({readOnly:!0})],v.prototype,"isWrappable",null);g.__decorate([k.property({type:y,json:{write:!0}})],v.prototype,"origin",void 0);g.__decorate([d.reader("origin")],v.prototype,"readOrigin",null);g.__decorate([k.property({type:[C],value:null,json:{write:!0}})],v.prototype,"lods",null);g.__decorate([k.property({readOnly:!0})],
v.prototype,"minScale",void 0);g.__decorate([k.property({readOnly:!0})],v.prototype,"maxScale",void 0);g.__decorate([k.property({readOnly:!0})],v.prototype,"scales",void 0);g.__decorate([k.property({cast:x=>Array.isArray(x)?x:"number"===typeof x?[x,x]:[256,256]})],v.prototype,"size",void 0);g.__decorate([d.reader("size",["rows","cols"])],v.prototype,"readSize",null);g.__decorate([h.writer("size",{cols:{type:f.Integer},rows:{type:f.Integer}})],v.prototype,"writeSize",null);g.__decorate([k.property({type:l,
json:{write:!0}})],v.prototype,"spatialReference",void 0);return v=A=g.__decorate([e.subclass("esri.layers.support.TileInfo")],v)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){var u;b=u=function(v){function t(l){l=v.call(this,l)||this;l.level=0;l.levelValue=null;l.resolution=0;l.scale=0;return l}a._inheritsLoose(t,v);t.prototype.clone=function(){return new u({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return t}(q.JSONSupport);g.__decorate([k.property({type:f.Integer,json:{write:!0}})],b.prototype,"level",void 0);g.__decorate([k.property({type:String,json:{write:!0}})],b.prototype,"levelValue",
void 0);g.__decorate([k.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);g.__decorate([k.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=u=g.__decorate([d.subclass("esri.layers.support.LOD")],b)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/arrayUtils ../core/promiseUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){a.PopupView=l=>{l=function(w){function y(){return w.apply(this,arguments)||this}g._inheritsLoose(y,w);var D=y.prototype;D.fetchPopupFeatures=async function(z,r){await this.when();const {location:C,queryArea:A,layerViewsAndGraphics:x,clientOnlyGraphics:m}=await this._prepareFetchPopupFeatures(z,r);z=Promise.resolve(m);r=this._queryLayerPopupFeatures({queryArea:A,layerViewsAndGraphics:x,options:r});const B=r.map(E=>E.promise);z=t.eachAlwaysValues([z,...B]).then(v.flatten);
return{location:C,clientOnlyGraphics:m,allGraphicsPromise:z,promisesPerLayerView:r}};D._queryLayerPopupFeatures=function({queryArea:z,layerViewsAndGraphics:r,options:C}){return r.map(({layerView:A,graphics:x})=>{x={clientGraphics:x,event:f.isSome(C)?C.event:null,signal:f.isSome(C)?C.signal:null,defaultPopupTemplateEnabled:f.isSome(C)?!!C.defaultPopupTemplateEnabled:!1};x=A.fetchPopupFeatures(z,x);return{layerView:A,promise:x}})};D._isValidPopupGraphic=function(z,r){return z&&!!z.getEffectivePopupTemplate(f.isSome(r)&&
r.defaultPopupTemplateEnabled)};D._prepareFetchPopupFeatures=async function(z,r){const {clientGraphics:C,queryArea:A,location:x}=await this._popupHitTestGraphics(z,r);z=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:m,clientOnlyGraphics:B}=this._graphicsPerFetchPopupLayerView(C,z);return{clientOnlyGraphics:B,layerViewsAndGraphics:m,queryArea:A,location:x}};D._popupHitTestGraphics=async function(z,r){const {results:C,mapPoint:A}=await this.popupHitTest(z);z=C.filter(m=>this._isValidPopupGraphic(m.graphic,
r));const x=z.length?z[0].mapPoint:null;return{clientGraphics:z.map(m=>m.graphic),queryArea:A,location:A||x}};D._getFetchPopupLayerViews=function(){const z=[];this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&z.push(r)});f.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&z.push(this.graphicsView);return z.reverse()};D._isValidPopupLayerView=function(z){return f.isSome(z)&&(!("layer"in z)||!z.suspended)&&"fetchPopupFeatures"in z};D._graphicsPerFetchPopupLayerView=
function(z,r){const C=[],A=new Map;r=r.map(x=>{const m=[];"layer"in x?A.set(x.layer,m):A.set(x.graphics,m);return{layerView:x,graphics:m}});for(const x of z)(z=A.get(x.layer)||null)?z.push(x):C.push(x);return{layerViewsAndGraphics:r,clientOnlyGraphics:C}};return y}(l);return l=b.__decorate([h.subclass("esri.views.PopupView")],l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities"],function(a,
g,b){const p={checkMajorWebPerformanceCaveat:!0};a.check=function(f){f={...p,...f};const k=b();return k.available?f.checkMajorWebPerformanceCaveat&&k.majorPerformanceCaveat?new g("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):k.supportsHighPrecisionFragment?k.supportsVertexShaderSamplers?k.supportsElementIndexUint?k.supportsStandardDerivatives?k.supportsInstancedArrays?
null:new g("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new g("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new g("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new g("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new g("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported."):new g("webgl:required","WebGL is required but not supported.")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["./context-util"],function(a){function g(){const p={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,
supportsTextureFloat:!1,supportsColorBufferFloat:!1};var f=document.createElement("canvas");if(!f)return p;var k=a.createContext(f,{failIfMajorPerformanceCaveat:!0},"webgl");!k&&(k=a.createContext(f,{},"webgl"))&&(p.majorPerformanceCaveat=!0);if(!k)return p;f=k.getParameter(k.VERSION);if(!f)return p;if(f=f.match(/^WebGL\s+([\d.]*)/)){f=parseFloat(f[1]);p.available=.94<=f;if(f=k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.HIGH_FLOAT))p.supportsHighPrecisionFragment=0<f.precision;p.supportsVertexShaderSamplers=
0<k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS);p.supportsElementIndexUint=null!==k.getExtension("OES_element_index_uint");p.supportsStandardDerivatives=null!==k.getExtension("OES_standard_derivatives");p.supportsInstancedArrays=null!==k.getExtension("ANGLE_instanced_arrays");p.supportsTextureFloat=null!==k.getExtension("OES_texture_float");p.supportsColorBufferFloat=null!==k.getExtension("WEBGL_color_buffer_float")&&null!==k.getExtension("EXT_float_blend")}p.maxTextureSize=k.getParameter(k.MAX_TEXTURE_SIZE);
k=(k=document.createElement("canvas"))&&a.createContext(k,{},"webgl2")?!0:!1;p.version=k?2:1;return p}let b;return function(){b||(b=g());return b}})},"esri/views/webgl/context-util":function(){define(["exports"],function(a){function g(p,f={},k){switch(k){case "webgl":k=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":k=["webgl2"];break;default:k=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}let c=null;for(const d of k){try{c=p.getContext(d,f)}catch(e){}if(c)break}return c}
function b(p,f){(p=p.parentNode)&&(p.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+f+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.createContext=g;a.createContextOrErrorHTML=function(p,f={},k){if(!window.WebGLRenderingContext)return b(p,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;f=g(p,f,k);return f?f:(b(p,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ViewingMode":function(){define(["exports"],function(a){a.stringFromViewingMode=function(g){return 1===g?"global":"local"};a.viewingModeFromString=function(g){return"global"===g?1:2};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/maybe","../../core/Error"],function(a,g,b,p){function f(e){return Object.freeze({__proto__:null,"default":e})}const k=()=>new Promise(function(e,h){a(["./layers/TileLayerView3D"],function(n){e(f(n))},h)}),c=()=>new Promise(function(e,h){a(["./layers/ElevationLayerView3D"],function(n){e(f(n))},h)}),d={"base-dynamic":()=>new Promise(function(e,h){a(["./layers/BaseDynamicLayerView3D"],function(n){e(f(n))},h)}),
"base-elevation":c,"base-tile":k,"bing-maps":k,"building-scene":()=>new Promise(function(e,h){a(["./layers/BuildingSceneLayerView3D"],function(n){e(f(n))},h)}),csv:()=>new Promise(function(e,h){a(["./layers/CSVLayerView3D"],function(n){e(f(n))},h)}),elevation:c,feature:()=>new Promise(function(e,h){a(["./layers/FeatureLayerView3D"],function(n){e(f(n))},h)}),geojson:()=>new Promise(function(e,h){a(["./layers/GeoJSONLayerView3D"],function(n){e(f(n))},h)}),graphics:()=>new Promise(function(e,h){a(["./layers/GraphicsLayerView3D"],
function(n){e(f(n))},h)}),group:()=>new Promise(function(e,h){a(["../layers/GroupLayerView"],function(n){e(f(n))},h)}),imagery:()=>new Promise(function(e,h){a(["./layers/ImageryLayerView3D"],function(n){e(f(n))},h)}),"integrated-mesh":()=>new Promise(function(e,h){a(["./layers/IntegratedMeshLayerView3D"],function(n){e(f(n))},h)}),"map-image":()=>new Promise(function(e,h){a(["./layers/MapImageLayerView3D"],function(n){e(f(n))},h)}),"ogc-feature":()=>new Promise(function(e,h){a(["./layers/OGCFeatureLayerView3D"],
function(n){e(f(n))},h)}),"open-street-map":k,"point-cloud":()=>new Promise(function(e,h){a(["./layers/PointCloudLayerView3D"],function(n){e(f(n))},h)}),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?new Promise(function(h,n){a(["./layers/SceneLayerView3D"],function(q){h(f(q))},n)}):new Promise(function(h,n){a(["./layers/SceneLayerGraphicsView3D"],function(q){h(f(q))},n)}),stream:()=>new Promise(function(e,h){a(["./layers/StreamLayerView3D"],function(n){e(f(n))},h)}),tile:k,"imagery-tile":()=>
new Promise(function(e,h){a(["./layers/ImageryTileLayerView3D"],function(n){e(f(n))},h)}),"vector-tile":()=>new Promise(function(e,h){a(["./layers/VectorTileLayerView3D"],function(n){e(f(n))},h)}),wcs:()=>new Promise(function(e,h){a(["./layers/ImageryTileLayerView3D"],function(n){e(f(n))},h)}),"web-tile":k,wms:()=>new Promise(function(e,h){a(["./layers/WMSLayerView3D"],function(n){e(f(n))},h)}),wmts:()=>new Promise(function(e,h){a(["./layers/WMTSLayerView3D"],function(n){e(f(n))},h)}),"geo-rss":null,
kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};g.layerView3DImporter={hasLayerViewModule:e=>b.isSome(d[e.type]),importLayerView:e=>{var h=d[e.type];if(!b.isSome(h))throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",h=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=new p(`${h}:view-not-supported`,`${e} is not supported in 3D`),e;return h(e)}};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.Constraints=function(w){function y(){var D=w.apply(this,arguments)||this;D.tilt=new l["default"];D.altitude=new v["default"];D.clipDistance=new t["default"];return D}g._inheritsLoose(y,w);return y}(u);b.__decorate([c.property({type:l["default"]})],a.Constraints.prototype,"tilt",void 0);b.__decorate([c.property({type:v["default"]})],a.Constraints.prototype,"altitude",void 0);b.__decorate([c.property({type:t["default"]})],a.Constraints.prototype,"clipDistance",
void 0);a.Constraints=b.__decorate([e.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);a.default=a.Constraints;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/deprecate ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../state/Constraints".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){a.AltitudeConstraint=function(l){function w(){var y=l.apply(this,arguments)||this;y.min=t.earthAltitudeConstraint.min;y.max=t.earthAltitudeConstraint.max;return y}g._inheritsLoose(w,l);g._createClass(w,[{key:"mode",get:function(){d.deprecated(f.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},
set:function(y){d.deprecated(f.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}}]);return w}(v);b.__decorate([c.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([c.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([h.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);a.default=a.AltitudeConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/Ellipsoid ../../../core/mathUtils ../support/mathUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=f.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(r){function C(x){x=r.call(this,x)||this;x.collision=new z;x.distance=Infinity;x.minimumPoiDistance=4;return x}g._inheritsLoose(C,r);var A=C.prototype;A.clampAltitude=function(x){return this.altitude?t.clamp(x,this.altitude.min,this.altitude.max):x};A.clampTilt=function(x,m){if(!this.tilt)return m;x=this.tilt(x);return t.clamp(m,x.min,x.max)};A.clampDistance=function(x){return Math.min(x,
this.distance)};A.createDefaultTilt=function(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};A.createConstantMaxTilt=function(x){return(m,B=D)=>{B.min=y.min;B.max=x;return B}};A.createDefaultTiltLocal=function(){const x=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,y.max],[1E4,t.deg2rad(88)],[6E6,t.deg2rad(88)]]):()=>y.max;return(m,B=D)=>{B.min=y.min;B.max=x(m);return B}};A.createDefaultTiltGlobal=function(){const x=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,
y.max],[5E4,t.deg2rad(88)],[6E6,t.deg2rad(88)],[2E7,y.min]]):l.makePiecewiseLinearFunction([[3E5,y.max],[3E6,t.deg2rad(88)],[6E6,t.deg2rad(88)],[2E7,y.min]]);return(m,B=D)=>{B.min=y.min;B.max=x(m);return B}};g._createClass(C,[{key:"altitude",get:function(){return 2===this.mode?null:this._get("altitude")||null},set:function(x){2===this.mode?w.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",x)}}]);return C}(u);b.__decorate([c.property()],a.Constraints.prototype,"altitude",
null);b.__decorate([c.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([c.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([c.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);b.__decorate([c.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([c.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([e.subclass("esri.views.3d.state.Constraints")],a.Constraints);p={min:-2E5,
max:4*v.earth.radius};const y={min:t.deg2rad(.5),max:t.deg2rad(179.5)},D={min:0,max:0};let z=function(r){function C(){var A=r.apply(this,arguments)||this;A.enabled=!0;A.elevationMargin=5;return A}g._inheritsLoose(C,r);return C}(u);b.__decorate([c.property({type:Boolean})],z.prototype,"enabled",void 0);b.__decorate([c.property({type:Number})],z.prototype,"elevationMargin",void 0);z=b.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],z);b=a.Constraints;a.TiltDefault=y;a.default=
b;a.earthAltitudeConstraint=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){a.ClipDistanceConstraint=function(v){function t(){var w=v.apply(this,arguments)||this;w.mode="auto";return w}g._inheritsLoose(t,v);var l=t.prototype;l.castNear=function(w){return Math.max(1E-8,w)};l.castFar=function(w){return Math.max(1E-8,w)};l.autoUpdate=function(w,y){"auto"===this.mode&&(this._get("near")!==w&&this._set("near",w),this._get("far")!==y&&this._set("far",y))};g._createClass(t,[{key:"near",get:function(){return this._get("near")},set:function(w){this._set("near",
w);w>=this._get("far")&&(this.far=w+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(w){this._set("far",w);w<=this._get("near")&&(this.near=w-1E-9);this.mode="manual"}}]);return t}(u);b.__decorate([k.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([c.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([k.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",
null);b.__decorate([c.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([k.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=b.__decorate([e.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);a.default=a.ClipDistanceConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../state/Constraints".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l=v.rad2deg(t.TiltDefault.min),w=v.rad2deg(t.TiltDefault.max);a.TiltConstraint=function(y){function D(){var r=y.apply(this,arguments)||this;r.mode="auto";return r}g._inheritsLoose(D,y);var z=D.prototype;z.castMax=function(r){return v.clamp(r,l,w)};z.autoUpdate=function(r){"auto"===this.mode&&this._get("max")!==r&&this._set("max",r)};g._createClass(D,[{key:"max",get:function(){return this._get("max")},set:function(r){this._set("max",r);this.mode="manual"}}]);
return D}(u);b.__decorate([k.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([k.property({type:Number,value:w})],a.TiltConstraint.prototype,"max",null);b.__decorate([c.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([e.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);a.default=a.TiltConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../webscene/Lighting ../../../webscene/Environment ./SceneViewAtmosphere ./SceneViewLighting".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){var y;b=y=function(D){function z(C){C=D.call(this,C)||this;C.atmosphere=new l["default"];return C}a._inheritsLoose(z,D);z.fromWebsceneEnvironment=function(C){C=C.cloneConstructProperties();return new y({...C,lighting:w.SceneViewLighting.fromWebsceneLighting(C.lighting)})};var r=z.prototype;r.castLighting=function(C){return this.convertLighting(C)};r.applyLighting=function(C){this.lighting=this.convertLighting(C)};r.convertLighting=function(C){return C?C instanceof
w.SceneViewLighting?C:C instanceof v?this.lighting?this.lighting.cloneWithWebsceneLighting(C):w.SceneViewLighting.fromWebsceneLighting(C):k.ensureType(w.SceneViewLighting,C):new w.SceneViewLighting};r.clone=function(){return new y({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:p.clone(this.background)})};r.cloneWithWebsceneEnvironment=function(C){return new y({atmosphere:this.atmosphere.clone(),
atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:p.clone(this.background),...C.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(C.lighting):w.SceneViewLighting.fromWebsceneLighting(C.lighting)})};return z}(t);g.__decorate([c.property({type:l["default"],json:{read:!1}})],b.prototype,"atmosphere",void 0);g.__decorate([c.property()],b.prototype,"lighting",void 0);g.__decorate([d.cast("lighting")],b.prototype,"castLighting",
null);return b=y=g.__decorate([h.subclass("esri.views.3d.environment.SceneViewEnvironment")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;a.SceneViewAtmosphere=v=function(t){function l(){return t.apply(this,arguments)||this}g._inheritsLoose(l,t);l.prototype.clone=function(){return new v({quality:this.quality})};g._createClass(l,[{key:"quality",set:function(w){-1!==["low","high"].indexOf(w)&&this._set("quality",w)}}]);return l}(u);b.__decorate([c.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=v=b.__decorate([e.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);a.default=a.SceneViewAtmosphere;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewLighting":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Evented ../../../webscene/Lighting".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t({hours:y,minutes:D,seconds:z}){return Math.round(y+D/60+z/3600)}var l;a.SceneViewLighting=l=function(y){function D(r){r=y.call(this,r)||this;r.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};r.cameraTrackingEnabled=!0;r.ambientOcclusionEnabled=!1;r.waterReflectionEnabled=!1;var C=(new Date).getFullYear();C=new Date("March 15, "+C+" 12:00:00 UTC");r._set("defaultDate",C);r._set("date",C);return r}g._inheritsLoose(D,y);D.fromWebsceneLighting=
function(r){return new l({...r.cloneConstructProperties()})};var z=D.prototype;z.autoUpdate=function(r,C){const A=t(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=C.hours;this.positionTimezoneInfo.minutes=C.minutes;this.positionTimezoneInfo.seconds=C.seconds;C=null;null!=r&&(this.positionTimezoneInfo.autoUpdated=!0,C=this.date&&this.date.getTime(),this._set("date",new Date(r.getTime())));const x=t(this.positionTimezoneInfo);A!==x&&(w.target=this,w.timezoneOffset=x,this.emit("timezone-will-change",
w));if(null!=r)return C!==r.getTime()};z.clone=function(){const r=this._get("date")===this._get("defaultDate"),C=new l({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});r&&C._set("date",C._get("defaultDate"));C.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;C.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;
C.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;C.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return C};z.cloneWithWebsceneLighting=function(r){const C=this.clone();null!=r.date&&(C.date=r.date);C.directShadowsEnabled=r.directShadowsEnabled;C.displayUTCOffset=r.displayUTCOffset;return C};g._createClass(D,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(r){const C=this._get("date")===this._get("defaultDate");r=
new Date(r.getTime());this._set("defaultDate",r);C&&this._set("date",r)}},{key:"date",set:function(r){null!=r&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(r.getTime())))}}]);return D}(u.EventedMixin(v));b.__decorate([c.property({type:Boolean})],a.SceneViewLighting.prototype,"cameraTrackingEnabled",void 0);b.__decorate([c.property({type:Boolean})],a.SceneViewLighting.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([c.property({type:Boolean})],a.SceneViewLighting.prototype,
"waterReflectionEnabled",void 0);b.__decorate([c.property({type:Date})],a.SceneViewLighting.prototype,"defaultDate",null);b.__decorate([c.property({type:Date})],a.SceneViewLighting.prototype,"date",null);a.SceneViewLighting=l=b.__decorate([e.subclass("esri.views.3d.environment.SceneViewLighting")],a.SceneViewLighting);const w={target:null,timezoneOffset:0};b=a.SceneViewLighting;a.calculateTimezoneOffset=t;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ./mat4 ../core/ObjectStack ./mat4f64 ../views/3d/support/stack ./vector ./lineSegment ./ray ./plane".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){function l(Z=O){return{plane:t.create(Z.plane),origin:f.clone(Z.origin),basis1:f.clone(Z.basis1),basis2:f.clone(Z.basis2)}}function w(Z,la,ka){const ha=ia.get();ha.origin=Z;ha.basis1=la;ha.basis2=ka;ha.plane=t.wrap(0,0,0,0);r(ha);return ha}function y(Z,la=l()){return z(Z.origin,Z.basis1,Z.basis2,la)}function D(Z,la){k.copy(la.origin,Z.origin);k.copy(la.basis1,Z.basis1);k.copy(la.basis2,Z.basis2);t.copy(Z.plane,la.plane)}function z(Z,la,ka,ha=l()){k.copy(ha.origin,
Z);k.copy(ha.basis1,la);k.copy(ha.basis2,ka);r(ha);1E-6<Math.abs(k.dot(ha.basis1,ha.basis2)/(k.length(ha.basis1)*k.length(ha.basis2)))&&ca.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(k.dot(ha.basis1,T(ha)))&&ca.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-k.dot(T(ha),ha.origin)-ha.plane[3])&&ca.warn("fromValues()","Plane offset is not consistent with plane origin");return ha}function r(Z){t.fromVectorsAndPoint(Z.basis2,
Z.basis1,Z.origin,Z.plane)}function C(Z,la,ka){Z!==ka&&y(Z,ka);Z=k.scale(n.sv3d.get(),T(Z),la);k.add(ka.origin,ka.origin,Z);ka.plane[3]-=la;return ka}function A(Z,la,ka){x(la,ka);C(ka,X(Z,Z.origin),ka);return ka}function x(Z,la=l()){const ka=(Z[2]-Z[0])/2,ha=(Z[3]-Z[1])/2;k.set(la.origin,Z[0]+ka,Z[1]+ha,0);k.set(la.basis1,ka,0,0);k.set(la.basis2,0,ha,0);t.fromValues(0,0,1,0,la.plane);return la}function m(Z,la,ka){return t.intersectRay(Z.plane,la,ka)?W(Z,ka):!1}function B(Z,la,ka){if(m(Z,la,ka))return ka;
Z=E(Z,la,n.sv3d.get());k.add(ka,la.origin,k.scale(n.sv3d.get(),la.direction,k.distance(la.origin,Z)/k.length(la.direction)));return ka}function E(Z,la,ka){const ha=V.get();var na=V.get();N(Z,la,ha,na);na=Number.POSITIVE_INFINITY;for(const oa of ma){var da=U(Z,oa,ba.get());const qa=n.sv3d.get();t.intersectLineSegment(ha,da,qa)&&(da=c.directionFromTo(n.sv3d.get(),la.origin,qa),da=Math.abs(p.acosClamped(k.dot(la.direction,da))),da<na&&(na=da,k.copy(ka,qa)))}return na===Number.POSITIVE_INFINITY?F(Z,la,
ka):ka}function F(Z,la,ka){if(m(Z,la,ka))return ka;const ha=V.get(),na=V.get();N(Z,la,ha,na);let da=Number.POSITIVE_INFINITY;for(const qa of ma){var oa=U(Z,qa,ba.get());const ua=n.sv3d.get();t.intersectLineSegmentClamp(ha,oa,ua)&&(oa=v.distance2(la,ua),t.isPointInside(na,ua)&&oa<da&&(da=oa,k.copy(ka,ua)))}K(Z,la.origin)<da&&G(Z,la.origin,ka);return ka}function G(Z,la,ka){var ha=t.projectPoint(Z.plane,la,n.sv3d.get());la=u.projectPointClamp(Y(Z,Z.basis1),ha,-1,1,n.sv3d.get());ha=u.projectPointClamp(Y(Z,
Z.basis2),ha,-1,1,n.sv3d.get());k.subtract(ka,k.add(n.sv3d.get(),la,ha),Z.origin);return ka}function I(Z,la,ka){const {origin:ha,basis1:na,basis2:da}=Z,oa=k.subtract(n.sv3d.get(),la,ha);la=q.projectPointSignedLength(na,oa);const qa=q.projectPointSignedLength(da,oa);Z=q.projectPointSignedLength(T(Z),oa);return k.set(ka,la,qa,Z)}function K(Z,la){la=I(Z,la,n.sv3d.get());const {basis1:ka,basis2:ha}=Z;Z=k.length(ka);var na=k.length(ha);Z=Math.max(Math.abs(la[0])-Z,0);na=Math.max(Math.abs(la[1])-na,0);
la=la[2];return Z*Z+na*na+la*la}function J(Z,la){return Math.sqrt(K(Z,la))}function L(Z,la){let ka=Number.NEGATIVE_INFINITY;for(const na of ma){var ha=U(Z,na,ba.get());ha=u.distance2(ha,la);ha>ka&&(ka=ha)}return Math.sqrt(ka)}function P(Z,la){return t.isPointInside(Z.plane,la)&&W(Z,la)}function Q(Z,la,ka,ha){switch(ka){case 0:k.copy(ha,Z.basis1);k.normalize(ha,ha);break;case 1:k.copy(ha,Z.basis2);k.normalize(ha,ha);break;case 2:k.copy(ha,T(Z))}return ha}function X(Z,la){const ka=-Z.plane[3];return q.projectPointSignedLength(T(Z),
la)-ka}function aa(Z,la,ka,ha){const na=X(Z,la);Z=k.scale(fa,T(Z),ka-na);k.add(ha,la,Z);return ha}function S(Z,la){return k.exactEquals(Z.basis1,la.basis1)&&k.exactEquals(Z.basis2,la.basis2)&&k.exactEquals(Z.origin,la.origin)}function H(Z,la,ka){Z!==ka&&y(Z,ka);d.invert(ea,la);d.transpose(ea,ea);k.transformMat4(ka.basis1,Z.basis1,ea);k.transformMat4(ka.basis2,Z.basis2,ea);k.transformMat4(t.normal(ka.plane),t.normal(Z.plane),ea);k.transformMat4(ka.origin,Z.origin,la);t.setOffsetFromPoint(ka.plane,
ka.origin,ka.plane);return ka}function R(Z,la,ka,ha){Z!==ha&&y(Z,ha);d.rotate(M,d.identity(M),la,ka);k.transformMat4(ha.basis1,Z.basis1,M);k.transformMat4(ha.basis2,Z.basis2,M);r(ha);return ha}function T(Z){return t.normal(Z.plane)}function W(Z,la){const ka=k.subtract(n.sv3d.get(),la,Z.origin);la=k.squaredLength(Z.basis1);const ha=k.squaredLength(Z.basis2),na=k.dot(Z.basis1,ka);Z=k.dot(Z.basis2,ka);return 0>-na-la&&0>na-la&&0>-Z-ha&&0>Z-ha}function Y(Z,la){const ka=ba.get();k.copy(ka.origin,Z.origin);
k.copy(ka.vector,la);return ka}function U(Z,la,ka){const {basis1:ha,basis2:na,origin:da}=Z;Z=k.scale(n.sv3d.get(),ha,la.origin[0]);const oa=k.scale(n.sv3d.get(),na,la.origin[1]);k.add(ka.origin,Z,oa);k.add(ka.origin,ka.origin,da);Z=k.scale(n.sv3d.get(),ha,la.direction[0]);la=k.scale(n.sv3d.get(),na,la.direction[1]);k.scale(ka.vector,k.add(Z,Z,la),2);return ka}function N(Z,la,ka,ha){Z=T(Z);t.fromVectorsAndPoint(Z,la.direction,la.origin,ka);t.fromVectorsAndPoint(t.normal(ka),Z,la.origin,ha)}const ca=
b.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");g=function(){this.plane=t.create();this.origin=f.create();this.basis1=f.create();this.basis2=f.create()};const O={plane:t.create(),origin:f.fromValues(0,0,0),basis1:f.fromValues(1,0,0),basis2:f.fromValues(0,1,0)},V=new e.ObjectStack(t.create),ba=new e.ObjectStack(u.create),fa=f.create(),ia=new e.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),ma=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,
1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ea=h.create(),M=h.create();e=Object.freeze({__proto__:null,BoundedPlaneClass:g,create:l,wrap:w,copy:y,copyWithoutVerify:D,fromValues:z,updateUnboundedPlane:r,elevate:C,setExtent:A,fromAABoundingRect:x,intersectRay:m,intersectRayClosestSilhouette:B,closestPointOnSilhouette:E,closestPoint:F,projectPoint:G,projectPointLocal:I,distance2:K,distance:J,distanceToSilhouette:L,extrusionContainsPoint:P,axisAt:Q,altitudeAt:X,setAltitudeAt:aa,equals:S,transform:H,
rotate:R,normal:T,UP:O});a.BoundedPlaneClass=g;a.UP=O;a.altitudeAt=X;a.axisAt=Q;a.boundedPlaneModule=e;a.closestPoint=F;a.closestPointOnSilhouette=E;a.copy=y;a.copyWithoutVerify=D;a.create=l;a.distance=J;a.distance2=K;a.distanceToSilhouette=L;a.elevate=C;a.equals=S;a.extrusionContainsPoint=P;a.fromAABoundingRect=x;a.fromValues=z;a.intersectRay=m;a.intersectRayClosestSilhouette=B;a.normal=T;a.projectPoint=G;a.projectPointLocal=I;a.rotate=R;a.setAltitudeAt=aa;a.setExtent=A;a.transform=H;a.updateUnboundedPlane=
r;a.wrap=w})},"esri/core/ObjectStack":function(){define(["exports","./maybe","./nextTick"],function(a,g,b){let p=function(){function f(c){this.allocator=c;this.items=[];this.itemsPtr=0;this.tickHandle=b.before(()=>this.reset());this.grow()}var k=f.prototype;k.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=g.nullifyNonnullableForDispose(this.tickHandle));this.items=g.nullifyNonnullableForDispose(this.items)};k.get=function(){0===this.itemsPtr&&b(()=>{});this.itemsPtr===
this.items.length&&this.grow();return this.items[this.itemsPtr++]};k.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3072),this.items.length);this.itemsPtr=0};k.grow=function(){for(let c=0;c<Math.max(8,Math.min(this.items.length,1024));c++)this.items.push(this.allocator())};return f}();a.ObjectStack=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function g(){return[1,0,
0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b(d){return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]]}function p(d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){return[d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A]}function f(d,e){return new Float64Array(d,e,16)}const k=g();var c=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,IDENTITY:k});a.IDENTITY=k;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat4f64=c})},"esri/views/3d/support/stack":function(){define(["exports",
"../../../core/VectorStack"],function(a,g){const b=g.VectorStack.createVec2f64(),p=g.VectorStack.createVec3f64(),f=g.VectorStack.createVec4f64(),k=g.VectorStack.createMat3f64(),c=g.VectorStack.createMat4f64();g=g.VectorStack.createQuatf64();a.sm3d=k;a.sm4d=c;a.sq4d=g;a.sv2d=b;a.sv3d=p;a.sv4d=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./maybe ./nextTick ../chunks/vec3f64 ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec4f64".split(" "),
function(a,g,b,p,f,k,c,d,e,h){let n=function(){function q(v,t,l){this.itemByteSize=v;this.itemCreate=t;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(l/this.itemByteSize);this.tickHandle=p.before(()=>this.reset())}var u=q.prototype;u.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=b.nullifyNonnullableForDispose(this.tickHandle));this.itemsPtr=0;this.items=b.nullifyNonnullableForDispose(this.items);this.buffers=b.nullifyNonnullableForDispose(this.buffers)};
u.get=function(){0===this.itemsPtr&&p(()=>{});const v=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=v;){const t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let l=0;l<this.itemsPerBuffer;++l)this.items.push(this.itemCreate(t,l*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]};u.reset=function(){const v=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>v;)this.buffers.pop(),this.items.length=this.buffers.length*
this.itemsPerBuffer;this.itemsPtr=0};q.createVec2f64=function(v=4096){return new q(16,e.createView,v)};q.createVec3f64=function(v=4096){return new q(24,f.createView,v)};q.createVec4f64=function(v=4096){return new q(32,h.createView,v)};q.createMat3f64=function(v=4096){return new q(72,k.createView,v)};q.createMat4f64=function(v=4096){return new q(128,c.createView,v)};q.createQuatf64=function(v=4096){return new q(32,d.createView,v)};g._createClass(q,[{key:"test",get:function(){return{size:this.buffers.length*
this.itemsPerBuffer*this.itemByteSize}}}]);return q}();a.VectorStack=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function g(){return[1,0,0,0,1,0,0,0,1]}function b(c){return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]]}function p(c,d,e,h,n,q,u,v,t){return[c,d,e,h,n,q,u,v,t]}function f(c,d){return new Float64Array(c,d,9)}var k=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f});a.clone=b;a.create=g;a.createView=
f;a.fromValues=p;a.mat3f64=k})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function g(){return[0,0,0,1]}function b(d){return[d[0],d[1],d[2],d[3]]}function p(d,e,h,n){return[d,e,h,n]}function f(d,e){return new Float64Array(d,e,4)}const k=g();var c=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,IDENTITY:k});a.IDENTITY=k;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.quatf64=c})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function g(){return[0,
0]}function b(l){return[l[0],l[1]]}function p(l,w){return[l,w]}function f(l){const w=[0,0],y=Math.min(2,l.length);for(let D=0;D<y;++D)w[D]=l[D];return w}function k(l,w){return new Float64Array(l,w,2)}function c(){return[0,0]}function d(){return[1,1]}function e(){return[1,0]}function h(){return[0,1]}const n=[0,0],q=[1,1],u=[1,0],v=[0,1];var t=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,fromArray:f,createView:k,zeros:c,ones:d,unitX:e,unitY:h,ZEROS:n,ONES:q,UNIT_X:u,UNIT_Y:v});a.ONES=
q;a.UNIT_X=u;a.UNIT_Y=v;a.ZEROS=n;a.clone=b;a.create=g;a.createView=k;a.fromArray=f;a.fromValues=p;a.ones=d;a.unitX=e;a.unitY=h;a.vec2f64=t;a.zeros=c})},"esri/chunks/vec4f64":function(){define(["exports"],function(a){function g(){return[0,0,0,0]}function b(z){return[z[0],z[1],z[2],z[3]]}function p(z,r,C,A){return[z,r,C,A]}function f(z){const r=g(),C=Math.min(4,z.length);for(let A=0;A<C;++A)r[A]=z[A];return r}function k(z,r){return new Float64Array(z,r,4)}function c(){return g()}function d(){return[1,
1,1,1]}function e(){return[1,0,0,0]}function h(){return[0,1,0,0]}function n(){return[0,0,1,0]}function q(){return[0,0,0,1]}const u=g(),v=d(),t=e(),l=h(),w=n(),y=q();var D=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,fromArray:f,createView:k,zeros:c,ones:d,unitX:e,unitY:h,unitZ:n,unitW:q,ZEROS:u,ONES:v,UNIT_X:t,UNIT_Y:l,UNIT_Z:w,UNIT_W:y});a.ONES=v;a.UNIT_W=y;a.UNIT_X=t;a.UNIT_Y=l;a.UNIT_Z=w;a.ZEROS=u;a.clone=b;a.create=g;a.createView=k;a.fromArray=f;a.fromValues=p;a.ones=d;a.unitW=
q;a.unitX=e;a.unitY=h;a.unitZ=n;a.vec4f64=D;a.zeros=c})},"esri/chunks/vector":function(){define(["exports","../core/mathUtils","./vec3f64","./vec3"],function(a,g,b,p){function f(n,q,u){q=p.dot(n,q)/p.dot(n,n);return p.scale(u,n,q)}function k(n,q){return p.dot(n,q)/p.length(n)}function c(n,q){n=p.dot(n,q)/(p.length(n)*p.length(q));return-g.acosClamped(n)}function d(n,q,u){p.normalize(e,n);p.normalize(h,q);n=p.dot(e,h);n=g.acosClamped(n);q=p.cross(e,e,h);return 0>p.dot(q,u)?2*Math.PI-n:n}const e=b.create(),
h=b.create();b=Object.freeze({__proto__:null,projectPoint:f,projectPointSignedLength:k,angle:c,angleAroundAxis:d});a.angle=c;a.angleAroundAxis=d;a.projectPoint=f;a.projectPointSignedLength=k;a.vectorModule=b})},"esri/chunks/lineSegment":function(){define("exports ../core/mathUtils ./vec3f64 ./vec3 ../core/ObjectStack ../views/3d/support/stack".split(" "),function(a,g,b,p,f,k){function c(A){return A?{origin:b.clone(A.origin),vector:b.clone(A.vector)}:{origin:b.create(),vector:b.create()}}function d(A,
x){const m=C.get();m.origin=A;m.vector=x;return m}function e(A,x=c()){return h(A.origin,A.vector,x)}function h(A,x,m=c()){p.copy(m.origin,A);p.copy(m.vector,x);return m}function n(A,x,m=c()){p.copy(m.origin,A);p.subtract(m.vector,x,A);return m}function q(A,x){x=p.subtract(k.sv3d.get(),x,A.origin);var m=p.dot(A.vector,x);const B=p.dot(A.vector,A.vector);m=g.clamp(m/B,0,1);A=p.subtract(k.sv3d.get(),p.scale(k.sv3d.get(),A.vector,m),x);return p.dot(A,A)}function u(A,x){return Math.sqrt(q(A,x))}function v(A,
x,m){return l(A,x,0,1,m)}function t(A,x,m){return p.add(m,A.origin,p.scale(m,A.vector,x))}function l(A,x,m,B,E){const {vector:F,origin:G}=A;x=p.subtract(k.sv3d.get(),x,G);x=p.dot(F,x)/p.squaredLength(F);p.scale(E,F,g.clamp(x,m,B));return p.add(E,E,A.origin)}function w(A,x){if(z(A,d(x.origin,x.direction),!1,r)){const {tA:m,pB:B,distance2:E}=r;if(0<=m&&1>=m)return E;if(0>m)return p.squaredDistance(A.origin,B);if(1<m)return p.squaredDistance(p.add(k.sv3d.get(),A.origin,A.vector),B)}return null}function y(A,
x,m){return z(A,x,!0,r)?(p.copy(m,r.pA),!0):!1}function D(A,x){return z(A,x,!0,r)?r.distance2:null}function z(A,x,m,B){const E=A.origin;var F=p.add(k.sv3d.get(),E,A.vector);A=x.origin;var G=p.add(k.sv3d.get(),A,x.vector),I=k.sv3d.get();x=k.sv3d.get();I[0]=E[0]-A[0];I[1]=E[1]-A[1];I[2]=E[2]-A[2];x[0]=G[0]-A[0];x[1]=G[1]-A[1];x[2]=G[2]-A[2];if(1E-6>Math.abs(x[0])&&1E-6>Math.abs(x[1])&&1E-6>Math.abs(x[2]))return!1;G=k.sv3d.get();G[0]=F[0]-E[0];G[1]=F[1]-E[1];G[2]=F[2]-E[2];if(1E-6>Math.abs(G[0])&&1E-6>
Math.abs(G[1])&&1E-6>Math.abs(G[2]))return!1;F=I[0]*x[0]+I[1]*x[1]+I[2]*x[2];var K=x[0]*G[0]+x[1]*G[1]+x[2]*G[2];const J=x[0]*x[0]+x[1]*x[1]+x[2]*x[2],L=(G[0]*G[0]+G[1]*G[1]+G[2]*G[2])*J-K*K;if(1E-6>Math.abs(L))return!1;I=(F*K-(I[0]*G[0]+I[1]*G[1]+I[2]*G[2])*J)/L;F=(F+K*I)/J;m&&(I=g.clamp(I,0,1),F=g.clamp(F,0,1));m=k.sv3d.get();K=k.sv3d.get();m[0]=E[0]+I*G[0];m[1]=E[1]+I*G[1];m[2]=E[2]+I*G[2];K[0]=A[0]+F*x[0];K[1]=A[1]+F*x[1];K[2]=A[2]+F*x[2];B.tA=I;B.tB=F;B.pA=m;B.pB=K;B.distance2=p.squaredDistance(m,
K);return!0}const r={tA:0,tB:0,pA:b.create(),pB:b.create(),distance2:0},C=new f.ObjectStack(()=>({origin:null,vector:null}));f=Object.freeze({__proto__:null,create:c,wrap:d,copy:e,fromValues:h,fromPoints:n,distance2:q,distance:u,projectPoint:v,pointAt:t,projectPointClamp:l,closestRayDistance2:w,closestLineSegmentPoint:y,closestLineSegmentDistance2:D});a.closestLineSegmentDistance2=D;a.closestLineSegmentPoint=y;a.closestRayDistance2=w;a.copy=e;a.create=c;a.distance=u;a.distance2=q;a.fromPoints=n;a.fromValues=
h;a.lineSegmentModule=f;a.pointAt=t;a.projectPoint=v;a.projectPointClamp=l;a.wrap=d})},"esri/chunks/ray":function(){define("exports ../core/maybe ../core/screenUtils ./vec3f64 ./vec3 ../core/ObjectStack ./vec2 ../views/3d/support/stack".split(" "),function(a,g,b,p,f,k,c,d){function e(A){return A?{origin:p.clone(A.origin),direction:p.clone(A.direction)}:{origin:p.create(),direction:p.create()}}function h(A,x){const m=C.get();m.origin=A;m.direction=x;return m}function n(A,x=e()){return u(A.origin,A.direction,
x)}function q(A,x,m=e()){f.copy(m.origin,A);f.subtract(m.direction,x,A);return m}function u(A,x,m=e()){f.copy(m.origin,A);f.copy(m.direction,x);return m}function v(A,x,m=e()){return t(A,A.screenToRender(x,b.castRenderScreenPointArray3(d.sv3d.get())),m)}function t(A,x,m=e()){const B=b.castRenderScreenPointArray3(c.copy(d.sv3d.get(),x));B[2]=0;if(!A.unprojectFromRenderScreen(B,m.origin))return null;x=b.castRenderScreenPointArray3(c.copy(d.sv3d.get(),x));x[2]=1;A=A.unprojectFromRenderScreen(x,d.sv3d.get());
if(g.isNone(A))return null;f.subtract(m.direction,A,m.origin);return m}function l(A,x,m=e()){return w(A,A.screenToRender(x,b.castRenderScreenPointArray3(d.sv3d.get())),m)}function w(A,x,m=e()){f.copy(m.origin,A.eye);x=f.set(d.sv3d.get(),x[0],x[1],1);A=A.unprojectFromRenderScreen(x,d.sv3d.get());if(g.isNone(A))return null;f.subtract(m.direction,A,m.origin);return m}function y(A,x){A=f.cross(d.sv3d.get(),f.normalize(d.sv3d.get(),A.direction),f.subtract(d.sv3d.get(),x,A.origin));return f.dot(A,A)}function D(A,
x){return Math.sqrt(y(A,x))}function z(A,x,m){x=f.dot(A.direction,f.subtract(m,x,A.origin));f.add(m,A.origin,f.scale(m,A.direction,x));return m}function r(){return{origin:null,direction:null}}const C=new k.ObjectStack(r);k=Object.freeze({__proto__:null,create:e,wrap:h,copy:n,fromPoints:q,fromValues:u,fromScreen:v,fromRender:t,fromScreenAtEye:l,fromRenderAtEye:w,distance2:y,distance:D,closestPoint:z,createWrapper:r});a.closestPoint=z;a.copy=n;a.create=e;a.createWrapper=r;a.distance=D;a.distance2=y;
a.fromPoints=q;a.fromRender=t;a.fromRenderAtEye=w;a.fromScreen=v;a.fromScreenAtEye=l;a.fromValues=u;a.rayModule=k;a.wrap=h})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,g){function b(aa,S){aa[0]=S[0];aa[1]=S[1];return aa}function p(aa,S,H){aa[0]=S;aa[1]=H;return aa}function f(aa,S,H){aa[0]=S[0]+H[0];aa[1]=S[1]+H[1];return aa}function k(aa,S,H){aa[0]=S[0]-H[0];aa[1]=S[1]-H[1];return aa}function c(aa,S,H){aa[0]=S[0]*H[0];aa[1]=S[1]*H[1];return aa}function d(aa,S,H){aa[0]=
S[0]/H[0];aa[1]=S[1]/H[1];return aa}function e(aa,S){aa[0]=Math.ceil(S[0]);aa[1]=Math.ceil(S[1]);return aa}function h(aa,S){aa[0]=Math.floor(S[0]);aa[1]=Math.floor(S[1]);return aa}function n(aa,S,H){aa[0]=Math.min(S[0],H[0]);aa[1]=Math.min(S[1],H[1]);return aa}function q(aa,S,H){aa[0]=Math.max(S[0],H[0]);aa[1]=Math.max(S[1],H[1]);return aa}function u(aa,S){aa[0]=Math.round(S[0]);aa[1]=Math.round(S[1]);return aa}function v(aa,S,H){aa[0]=S[0]*H;aa[1]=S[1]*H;return aa}function t(aa,S,H,R){aa[0]=S[0]+
H[0]*R;aa[1]=S[1]+H[1]*R;return aa}function l(aa,S){const H=S[0]-aa[0];aa=S[1]-aa[1];return Math.sqrt(H*H+aa*aa)}function w(aa,S){const H=S[0]-aa[0];aa=S[1]-aa[1];return H*H+aa*aa}function y(aa){const S=aa[0];aa=aa[1];return Math.sqrt(S*S+aa*aa)}function D(aa){const S=aa[0];aa=aa[1];return S*S+aa*aa}function z(aa,S){aa[0]=-S[0];aa[1]=-S[1];return aa}function r(aa,S){aa[0]=1/S[0];aa[1]=1/S[1];return aa}function C(aa,S){var H=S[0];const R=S[1];H=H*H+R*R;0<H&&(H=1/Math.sqrt(H),aa[0]=S[0]*H,aa[1]=S[1]*
H);return aa}function A(aa,S){return aa[0]*S[0]+aa[1]*S[1]}function x(aa,S,H){S=S[0]*H[1]-S[1]*H[0];aa[0]=aa[1]=0;aa[2]=S;return aa}function m(aa,S,H,R){const T=S[0];S=S[1];aa[0]=T+R*(H[0]-T);aa[1]=S+R*(H[1]-S);return aa}function B(aa,S){S=S||1;const H=2*g.RANDOM()*Math.PI;aa[0]=Math.cos(H)*S;aa[1]=Math.sin(H)*S;return aa}function E(aa,S,H){const R=S[0];S=S[1];aa[0]=H[0]*R+H[2]*S;aa[1]=H[1]*R+H[3]*S;return aa}function F(aa,S,H){const R=S[0];S=S[1];aa[0]=H[0]*R+H[2]*S+H[4];aa[1]=H[1]*R+H[3]*S+H[5];
return aa}function G(aa,S,H){const R=S[0];S=S[1];aa[0]=H[0]*R+H[3]*S+H[6];aa[1]=H[1]*R+H[4]*S+H[7];return aa}function I(aa,S,H){const R=S[0];S=S[1];aa[0]=H[0]*R+H[4]*S+H[12];aa[1]=H[1]*R+H[5]*S+H[13];return aa}function K(aa,S,H,R){const T=S[0]-H[0];S=S[1]-H[1];const W=Math.sin(R);R=Math.cos(R);aa[0]=T*R-S*W+H[0];aa[1]=T*W+S*R+H[1];return aa}function J(aa,S){var H=aa[0];aa=aa[1];const R=S[0];S=S[1];let T=H*H+aa*aa;0<T&&(T=1/Math.sqrt(T));let W=R*R+S*S;0<W&&(W=1/Math.sqrt(W));H=(H*R+aa*S)*T*W;return 1<
H?0:-1>H?Math.PI:Math.acos(H)}function L(aa){return"vec2("+aa[0]+", "+aa[1]+")"}function P(aa,S){return aa[0]===S[0]&&aa[1]===S[1]}function Q(aa,S){const H=aa[0];aa=aa[1];const R=S[0];S=S[1];return Math.abs(H-R)<=g.EPSILON*Math.max(1,Math.abs(H),Math.abs(R))&&Math.abs(aa-S)<=g.EPSILON*Math.max(1,Math.abs(aa),Math.abs(S))}var X=Object.freeze({__proto__:null,copy:b,set:p,add:f,subtract:k,multiply:c,divide:d,ceil:e,floor:h,min:n,max:q,round:u,scale:v,scaleAndAdd:t,distance:l,squaredDistance:w,length:y,
squaredLength:D,negate:z,inverse:r,normalize:C,dot:A,cross:x,lerp:m,random:B,transformMat2:E,transformMat2d:F,transformMat3:G,transformMat4:I,rotate:K,angle:J,str:L,exactEquals:P,equals:Q,len:y,sub:k,mul:c,div:d,dist:l,sqrDist:w,sqrLen:D});a.add=f;a.angle=J;a.ceil=e;a.copy=b;a.cross=x;a.dist=l;a.distance=l;a.div=d;a.divide=d;a.dot=A;a.equals=Q;a.exactEquals=P;a.floor=h;a.inverse=r;a.len=y;a.length=y;a.lerp=m;a.max=q;a.min=n;a.mul=c;a.multiply=c;a.negate=z;a.normalize=C;a.random=B;a.rotate=K;a.round=
u;a.scale=v;a.scaleAndAdd=t;a.set=p;a.sqrDist=w;a.sqrLen=D;a.squaredDistance=w;a.squaredLength=D;a.str=L;a.sub=k;a.subtract=k;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=G;a.transformMat4=I;a.vec2=X})},"esri/chunks/plane":function(){define("exports ../core/maybe ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/stack ./sphere".split(" "),function(a,g,b,p,f,k,c){function d(W=T){return[W[0],W[1],W[2],W[3]]}function e(W,Y,U,N){return n(W,Y,U,N,k.sv4d.get())}function h(W,Y=d()){return n(W[0],
W[1],W[2],W[3],Y)}function n(W,Y,U,N,ca=d()){ca[0]=W;ca[1]=Y;ca[2]=U;ca[3]=N;return ca}function q(W,Y,U=d()){f.copy(U,W);U[3]=Y;return U}function u(W,Y,U=d()){f.copy(U,Y);Y=f.dot(Y,Y);1E-5<Math.abs(Y-1)&&1E-12<Y&&f.scale(U,U,1/Math.sqrt(Y));w(U,W,U);return U}function v(W,Y,U,N=d()){return D(f.subtract(k.sv3d.get(),W,Y),f.subtract(k.sv3d.get(),U,Y),W,N)}function t(W,Y){return l(W,Y,0,1,2)}function l(W,Y,U,N,ca){if(3>W.count)return!1;W.getVec(U,X);let O=N,V=!1;for(;O<W.count-1&&!V;)W.getVec(O,aa),O++,
V=!f.exactEquals(X,aa);if(!V)return!1;O=Math.max(O,ca);for(V=!1;O<W.count&&!V;)W.getVec(O,S),O++,f.subtract(H,X,aa),f.normalize(H,H),f.subtract(R,aa,S),f.normalize(R,R),V=!f.exactEquals(X,S)&&!f.exactEquals(aa,S)&&.99619469809>Math.abs(f.dot(H,R));if(!V)return 0===U&&1===N&&2===ca?!1:l(W,Y,0,1,2);v(X,aa,S,Y);return!0}function w(W,Y,U){W!==U&&h(W,U);U[3]=-f.dot(U,Y);return U}function y(W,Y){Y[0]=-W[0];Y[1]=-W[1];Y[2]=-W[2];Y[3]=-W[3];return Y}function D(W,Y,U,N=d()){W=f.cross(k.sv3d.get(),Y,W);return u(U,
W,N)}function z(W,Y,U){return g.isSome(Y)?P(W,Y.origin,Y.direction,!0,!1,U):!1}function r(W,Y,U){return P(W,Y.origin,Y.vector,!1,!1,U)}function C(W,Y,U){return P(W,Y.origin,Y.vector,!1,!0,U)}function A(W,Y){return 0<=L(W,c.getCenter(Y))-Y[3]}function x(W,Y){return 0>L(W,c.getCenter(Y))+Y[3]}function m(W,Y){return 0<=L(W,Y)}function B(W,Y){return 0>L(W,Y)}function E(W,Y){const U=Y[0],N=Y[1],ca=Y[2],O=Y[3],V=Y[4];Y=Y[5];return 0<=W[0]*(0<W[0]?U:O)+W[1]*(0<W[1]?N:V)+W[2]*(0<W[2]?ca:Y)+W[3]}function F(W,
Y){const U=f.dot(W,Y.ray.direction);W=-L(W,Y.ray.origin);if(0>W&&0<=U)return!1;if(-1E-6<U&&1E-6>U)return 0<W;if((0>W||0>U)&&!(0>W&&0>U))return!0;W/=U;0<U?W<Y.c1&&(Y.c1=W):W>Y.c0&&(Y.c0=W);return Y.c0<=Y.c1}function G(W,Y){const U=f.dot(W,Y.ray.direction);W=-L(W,Y.ray.origin);if(-1E-6<U&&1E-6>U)return 0<W;W/=U;0<U?W<Y.c1&&(Y.c1=W):W>Y.c0&&(Y.c0=W);return Y.c0<=Y.c1}function I(W,Y,U){const N=f.scale(k.sv3d.get(),W,-W[3]);Y=f.subtract(k.sv3d.get(),Y,N);W=K(W,Y,k.sv3d.get());f.add(U,W,N);return U}function K(W,
Y,U){W=f.scale(k.sv3d.get(),W,f.dot(W,Y));f.subtract(U,Y,W);return U}function J(W,Y){return Math.abs(L(W,Y))}function L(W,Y){return f.dot(W,Y)+W[3]}function P(W,Y,U,N,ca,O){const V=f.dot(W,U);if(0===V)return!1;W=-(f.dot(W,Y)+W[3])/V;ca&&(W=N?Math.max(0,W):b.clamp(W,0,1));if(0>W||!N&&1<W)return!1;f.add(O,Y,f.scale(O,U,W));return!0}function Q(W){return W}const X=p.create(),aa=p.create(),S=p.create(),H=p.create(),R=p.create(),T=[0,0,1,0];p=Object.freeze({__proto__:null,create:d,wrap:e,copy:h,fromValues:n,
fromNormalAndOffset:q,fromPositionAndNormal:u,fromPoints:v,fromManyPoints:t,fromManyPointsSampleAt:l,setOffsetFromPoint:w,negate:y,fromVectorsAndPoint:D,intersectRay:z,intersectLineSegment:r,intersectLineSegmentClamp:C,isSphereFullyInside:A,isSphereFullyOutside:x,isPointInside:m,isPointOutside:B,isAABBFullyInside:E,clip:F,clipInfinite:G,projectPoint:I,projectVector:K,distance:J,signedDistance:L,normal:Q,UP:T});a.UP=T;a.clip=F;a.clipInfinite=G;a.copy=h;a.create=d;a.distance=J;a.fromManyPoints=t;a.fromManyPointsSampleAt=
l;a.fromNormalAndOffset=q;a.fromPoints=v;a.fromPositionAndNormal=u;a.fromValues=n;a.fromVectorsAndPoint=D;a.intersectLineSegment=r;a.intersectLineSegmentClamp=C;a.intersectRay=z;a.isAABBFullyInside=E;a.isPointInside=m;a.isPointOutside=B;a.isSphereFullyInside=A;a.isSphereFullyOutside=x;a.negate=y;a.normal=Q;a.planeModule=p;a.projectPoint=I;a.projectVector=K;a.setOffsetFromPoint=w;a.signedDistance=L;a.wrap=e})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/maybe ../core/Logger ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ./mat4 ./vec4f64 ./vec4 ../views/3d/support/stack ./vector ./ray".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(){return h.create()}function l(Y,U=t()){return n.copy(U,Y)}function w(Y,U){return h.fromValues(Y[0],Y[1],Y[2],U)}function y(Y){return Y}function D(Y){Y[0]=Y[1]=Y[2]=Y[3]=0}function z(Y){return Y}function r(Y){return Array.isArray(Y)?Y[3]:Y}function C(Y){return Array.isArray(Y)?Y:T}function A(Y,U,N,ca){return h.fromValues(Y,U,N,ca)}function x(Y,U,N){Y!==N&&c.copy(N,Y);N[3]=Y[3]+U;return N}function m(Y,U,N){S.error("sphere.setExtent is not yet supported");
return Y===N?N:l(Y,N)}function B(Y,U,N){if(b.isNone(U))return!1;var ca=c.subtract(q.sv3d.get(),U.origin,C(Y)),O=c.dot(U.direction,U.direction);const V=2*c.dot(U.direction,ca);Y=c.dot(ca,ca)-Y[3]*Y[3];Y=V*V-4*O*Y;if(0>Y)return!1;ca=Math.sqrt(Y);Y=(-V-ca)/(2*O);O=(-V+ca)/(2*O);if(0>Y||O<Y&&0<O)Y=O;if(0>Y)return!1;N&&c.add(N,U.origin,c.scale(q.sv3d.get(),U.direction,Y));return!0}function E(Y,U,N,ca){U=v.fromScreenAtEye(U,N,R);return B(Y,U,ca)}function F(Y,U){return B(Y,U,null)}function G(Y,U,N){if(B(Y,
U,N))return N;Y=I(Y,U,q.sv3d.get());c.add(N,U.origin,c.scale(q.sv3d.get(),U.direction,c.distance(U.origin,Y)/c.length(U.direction)));return N}function I(Y,U,N){const ca=q.sv3d.get(),O=q.sm4d.get();c.cross(ca,U.origin,U.direction);const V=r(Y);c.cross(N,ca,U.origin);c.scale(N,N,1/c.length(N)*V);Y=P(Y,U.origin);U=u.angle(U.origin,N);e.identity(O);e.rotate(O,O,U+Y,ca);c.transformMat4(N,N,O);return N}function K(Y,U,N){if(B(Y,U,N))return N;v.closestPoint(U,C(Y),N);return J(Y,N,N)}function J(Y,U,N){U=c.subtract(q.sv3d.get(),
U,C(Y));U=c.scale(q.sv3d.get(),U,Y[3]/c.length(U));return c.add(N,U,C(Y))}function L(Y,U){U=c.subtract(q.sv3d.get(),U,C(Y));U=c.squaredLength(U);return Math.sqrt(Math.abs(U-Y[3]*Y[3]))}function P(Y,U){U=c.subtract(q.sv3d.get(),U,C(Y));U=c.length(U);Y=r(Y);return f.acosClamped(Y/(Y+Math.abs(Y-U)))}function Q(Y,U,N,ca){Y=c.subtract(H,U,C(Y));switch(N){case 0:return N=d.cartesianToSpherical(Y,H)[2],c.set(ca,-Math.sin(N),Math.cos(N),0);case 1:return Y=d.cartesianToSpherical(Y,H),N=Y[1],Y=Y[2],U=Math.sin(N),
c.set(ca,-U*Math.cos(Y),-U*Math.sin(Y),Math.cos(N));case 2:return c.normalize(ca,Y)}}function X(Y,U){U=c.subtract(W,U,C(Y));return c.length(U)-Y[3]}function aa(Y,U,N,ca){const O=X(Y,U);Y=Q(Y,U,2,W);N=c.scale(W,Y,N-O);c.add(ca,U,N);return ca}const S=p.getLogger("esri.views.3d.support.geometryUtils.sphere"),H=k.create(),R=v.create(),T=k.create(),W=k.create();Object.freeze(T);g=Object.freeze({__proto__:null,create:t,copy:l,fromCenterAndRadius:w,wrap:y,clear:D,fromRadius:z,getRadius:r,getCenter:C,fromValues:A,
elevate:x,setExtent:m,intersectRay:B,intersectScreen:E,intersectsRay:F,intersectRayClosestSilhouette:G,closestPointOnSilhouette:I,closestPoint:K,projectPoint:J,distanceToSilhouette:L,angleToSilhouette:P,axisAt:Q,altitudeAt:X,setAltitudeAt:aa});a.altitudeAt=X;a.angleToSilhouette=P;a.axisAt=Q;a.clear=D;a.closestPoint=K;a.closestPointOnSilhouette=I;a.copy=l;a.create=t;a.distanceToSilhouette=L;a.elevate=x;a.fromCenterAndRadius=w;a.fromRadius=z;a.fromValues=A;a.getCenter=C;a.getRadius=r;a.intersectRay=
B;a.intersectRayClosestSilhouette=G;a.intersectScreen=E;a.intersectsRay=F;a.projectPoint=J;a.setAltitudeAt=aa;a.setExtent=m;a.sphereModule=g;a.wrap=y})},"esri/chunks/vec4":function(){define(["exports","./common"],function(a,g){function b(J,L){J[0]=L[0];J[1]=L[1];J[2]=L[2];J[3]=L[3];return J}function p(J,L,P,Q,X){J[0]=L;J[1]=P;J[2]=Q;J[3]=X;return J}function f(J,L,P){J[0]=L[0]+P[0];J[1]=L[1]+P[1];J[2]=L[2]+P[2];J[3]=L[3]+P[3];return J}function k(J,L,P){J[0]=L[0]-P[0];J[1]=L[1]-P[1];J[2]=L[2]-P[2];
J[3]=L[3]-P[3];return J}function c(J,L,P){J[0]=L[0]*P[0];J[1]=L[1]*P[1];J[2]=L[2]*P[2];J[3]=L[3]*P[3];return J}function d(J,L,P){J[0]=L[0]/P[0];J[1]=L[1]/P[1];J[2]=L[2]/P[2];J[3]=L[3]/P[3];return J}function e(J,L){J[0]=Math.ceil(L[0]);J[1]=Math.ceil(L[1]);J[2]=Math.ceil(L[2]);J[3]=Math.ceil(L[3]);return J}function h(J,L){J[0]=Math.floor(L[0]);J[1]=Math.floor(L[1]);J[2]=Math.floor(L[2]);J[3]=Math.floor(L[3]);return J}function n(J,L,P){J[0]=Math.min(L[0],P[0]);J[1]=Math.min(L[1],P[1]);J[2]=Math.min(L[2],
P[2]);J[3]=Math.min(L[3],P[3]);return J}function q(J,L,P){J[0]=Math.max(L[0],P[0]);J[1]=Math.max(L[1],P[1]);J[2]=Math.max(L[2],P[2]);J[3]=Math.max(L[3],P[3]);return J}function u(J,L){J[0]=Math.round(L[0]);J[1]=Math.round(L[1]);J[2]=Math.round(L[2]);J[3]=Math.round(L[3]);return J}function v(J,L,P){J[0]=L[0]*P;J[1]=L[1]*P;J[2]=L[2]*P;J[3]=L[3]*P;return J}function t(J,L,P,Q){J[0]=L[0]+P[0]*Q;J[1]=L[1]+P[1]*Q;J[2]=L[2]+P[2]*Q;J[3]=L[3]+P[3]*Q;return J}function l(J,L){const P=L[0]-J[0],Q=L[1]-J[1],X=L[2]-
J[2];J=L[3]-J[3];return Math.sqrt(P*P+Q*Q+X*X+J*J)}function w(J,L){const P=L[0]-J[0],Q=L[1]-J[1],X=L[2]-J[2];J=L[3]-J[3];return P*P+Q*Q+X*X+J*J}function y(J){const L=J[0],P=J[1],Q=J[2];J=J[3];return Math.sqrt(L*L+P*P+Q*Q+J*J)}function D(J){const L=J[0],P=J[1],Q=J[2];J=J[3];return L*L+P*P+Q*Q+J*J}function z(J,L){J[0]=-L[0];J[1]=-L[1];J[2]=-L[2];J[3]=-L[3];return J}function r(J,L){J[0]=1/L[0];J[1]=1/L[1];J[2]=1/L[2];J[3]=1/L[3];return J}function C(J,L){const P=L[0],Q=L[1],X=L[2];L=L[3];let aa=P*P+Q*
Q+X*X+L*L;0<aa&&(aa=1/Math.sqrt(aa),J[0]=P*aa,J[1]=Q*aa,J[2]=X*aa,J[3]=L*aa);return J}function A(J,L){return J[0]*L[0]+J[1]*L[1]+J[2]*L[2]+J[3]*L[3]}function x(J,L,P,Q){const X=L[0],aa=L[1],S=L[2];L=L[3];J[0]=X+Q*(P[0]-X);J[1]=aa+Q*(P[1]-aa);J[2]=S+Q*(P[2]-S);J[3]=L+Q*(P[3]-L);return J}function m(J,L){L=L||1;let P,Q,X,aa;let S;do{P=2*g.RANDOM()-1;Q=2*g.RANDOM()-1;var H=P*P+Q*Q}while(1<=H);do X=2*g.RANDOM()-1,aa=2*g.RANDOM()-1,S=X*X+aa*aa;while(1<=S);H=Math.sqrt((1-H)/S);J[0]=L*P;J[1]=L*Q;J[2]=L*X*
H;J[3]=L*aa*H;return J}function B(J,L,P){const Q=L[0],X=L[1],aa=L[2];L=L[3];J[0]=P[0]*Q+P[4]*X+P[8]*aa+P[12]*L;J[1]=P[1]*Q+P[5]*X+P[9]*aa+P[13]*L;J[2]=P[2]*Q+P[6]*X+P[10]*aa+P[14]*L;J[3]=P[3]*Q+P[7]*X+P[11]*aa+P[15]*L;return J}function E(J,L,P){var Q=L[0];const X=L[1],aa=L[2],S=P[0],H=P[1],R=P[2];P=P[3];const T=P*Q+H*aa-R*X,W=P*X+R*Q-S*aa,Y=P*aa+S*X-H*Q;Q=-S*Q-H*X-R*aa;J[0]=T*P+Q*-S+W*-R-Y*-H;J[1]=W*P+Q*-H+Y*-S-T*-R;J[2]=Y*P+Q*-R+T*-H-W*-S;J[3]=L[3];return J}function F(J){return"vec4("+J[0]+", "+
J[1]+", "+J[2]+", "+J[3]+")"}function G(J,L){return J[0]===L[0]&&J[1]===L[1]&&J[2]===L[2]&&J[3]===L[3]}function I(J,L){const P=J[0],Q=J[1],X=J[2];J=J[3];const aa=L[0],S=L[1],H=L[2];L=L[3];return Math.abs(P-aa)<=g.EPSILON*Math.max(1,Math.abs(P),Math.abs(aa))&&Math.abs(Q-S)<=g.EPSILON*Math.max(1,Math.abs(Q),Math.abs(S))&&Math.abs(X-H)<=g.EPSILON*Math.max(1,Math.abs(X),Math.abs(H))&&Math.abs(J-L)<=g.EPSILON*Math.max(1,Math.abs(J),Math.abs(L))}var K=Object.freeze({__proto__:null,copy:b,set:p,add:f,subtract:k,
multiply:c,divide:d,ceil:e,floor:h,min:n,max:q,round:u,scale:v,scaleAndAdd:t,distance:l,squaredDistance:w,length:y,squaredLength:D,negate:z,inverse:r,normalize:C,dot:A,lerp:x,random:m,transformMat4:B,transformQuat:E,str:F,exactEquals:G,equals:I,sub:k,mul:c,div:d,dist:l,sqrDist:w,len:y,sqrLen:D});a.add=f;a.ceil=e;a.copy=b;a.dist=l;a.distance=l;a.div=d;a.divide=d;a.dot=A;a.equals=I;a.exactEquals=G;a.floor=h;a.inverse=r;a.len=y;a.length=y;a.lerp=x;a.max=q;a.min=n;a.mul=c;a.multiply=c;a.negate=z;a.normalize=
C;a.random=m;a.round=u;a.scale=v;a.scaleAndAdd=t;a.set=p;a.sqrDist=w;a.sqrLen=D;a.squaredDistance=w;a.squaredLength=D;a.str=F;a.sub=k;a.subtract=k;a.transformMat4=B;a.transformQuat=E;a.vec4=K})},"esri/views/3d/support/geometryUtils":function(){define("exports ../../../chunks/vector ../../../chunks/axisAngle ../../../chunks/lineSegment ../../../chunks/ray ../../../chunks/sphere ../../../chunks/plane ../../../chunks/boundedPlane ../../../chunks/clipRay ../../../chunks/frustum ../../../chunks/triangle".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){c=c.planeModule;d=d.boundedPlaneModule;n=n.triangleModule;p=p.lineSegmentModule;f=f.rayModule;e=e.clipRayModule;k=k.sphereModule;h=h.frustumModule;g=g.vectorModule;a.axisAngle=b.axisAngleModule;a.boundedPlane=d;a.clipRay=e;a.frustum=h;a.lineSegment=p;a.plane=c;a.ray=f;a.sphere=k;a.triangle=n;a.vector=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/axisAngle":function(){define(["exports","./vec3","../views/3d/support/stack","./vector"],function(a,
g,b,p){function f(t=u){return[t[0],t[1],t[2],t[3]]}function k(t,l,w,y){return e(t,l,w,y,b.sv4d.get())}function c(t,l){return e(t[0],t[1],t[2],l,b.sv4d.get())}function d(t,l=f()){return e(t[0],t[1],t[2],t[3],l)}function e(t,l,w,y,D=f()){D[0]=t;D[1]=l;D[2]=w;D[3]=y;return D}function h(t,l,w=f()){g.copy(w,t);w[3]=l;return w}function n(t,l,w=f()){g.cross(w,t,l);g.normalize(w,w);w[3]=p.angle(t,l);return w}function q(t){return t}const u=[0,0,1,0];var v=Object.freeze({__proto__:null,create:f,wrap:k,wrapAxisAngle:c,
copy:d,fromValues:e,fromAxisAndAngle:h,fromPoints:n,axis:q,UP:u});a.UP=u;a.axis=q;a.axisAngleModule=v;a.copy=d;a.create=f;a.fromAxisAndAngle=h;a.fromPoints=n;a.fromValues=e;a.wrap=k;a.wrapAxisAngle=c})},"esri/chunks/clipRay":function(){define(["exports","./vec3","../core/ObjectStack","../views/3d/support/stack","./ray"],function(a,g,b,p,f){function k(w){return w?{ray:f.create(w.ray),c0:w.c0,c1:w.c1}:{ray:f.create(),c0:0,c1:Number.MAX_VALUE}}function c(w,y,D){const z=l.get();z.ray=w;z.c0=y;z.c1=D;
return z}function d(w,y=k()){return e(w.ray,w.c0,w.c1,y)}function e(w,y,D,z=k()){f.copy(w,z.ray);z.c0=y;z.c1=D;return z}function h(w,y=k()){f.copy(w,y.ray);y.c0=0;y.c1=Number.MAX_VALUE;return y}function n(w,y=k()){const D=g.normalize(p.sv3d.get(),w.vector);return q(w,D,y)}function q(w,y,D=k()){const z=g.length(w.vector);f.fromValues(w.origin,y,D.ray);D.c0=0;D.c1=z;return D}function u(w,y){return t(w,w.c0,y)}function v(w,y){return t(w,w.c1,y)}function t(w,y,D){return g.add(D,w.ray.origin,g.scale(D,
w.ray.direction,y))}const l=new b.ObjectStack(()=>({c0:0,c1:0,ray:null}));b=Object.freeze({__proto__:null,create:k,wrap:c,copy:d,fromValues:e,fromRay:h,fromLineSegment:n,fromLineSegmentAndDirection:q,getStart:u,getEnd:v,getAt:t});a.clipRayModule=b;a.copy=d;a.create=k;a.fromLineSegment=n;a.fromLineSegmentAndDirection=q;a.fromRay=h;a.fromValues=e;a.getAt=t;a.getEnd=v;a.getStart=u;a.wrap=c})},"esri/chunks/frustum":function(){define("exports ./vec3f64 ./vec3 ./mat4 ../core/ObjectStack ./vec4f64 ./vec4 ../views/3d/support/stack ./plane ./clipRay".split(" "),
function(a,g,b,p,f,k,c,d,e,h){function n(E){return E?[e.create(E[0]),e.create(E[1]),e.create(E[2]),e.create(E[3]),e.create(E[4]),e.create(E[5])]:[e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}function q(){return[g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create(),g.create()]}function u(E,F=n()){for(let G=0;6>G;G++)e.copy(E[G],F[G])}function v(E,F,G,I=B){E=p.multiply(d.sm4d.get(),F,E);p.invert(E,E);for(F=0;8>F;++F){const K=c.transformMat4(d.sv4d.get(),
x[F],E);b.set(I[F],K[0]/K[3],K[1]/K[3],K[2]/K[3])}t(G,I)}function t(E,F){e.fromPoints(F[4],F[0],F[3],E[0]);e.fromPoints(F[1],F[5],F[6],E[1]);e.fromPoints(F[4],F[5],F[1],E[2]);e.fromPoints(F[3],F[2],F[6],E[3]);e.fromPoints(F[0],F[1],F[2],E[4]);e.fromPoints(F[5],F[4],F[7],E[5])}function l(E,F){for(let G=0;6>G;G++)if(e.isSphereFullyInside(E[G],F))return!1;return!0}function w(E,F){return C(E,h.fromRay(F,m.get()))}function y(E,F){for(let G=0;6>G;G++)if(!e.clipInfinite(E[G],F))return!1;return!0}function D(E,
F,G){return C(E,h.fromLineSegmentAndDirection(F,G,m.get()))}function z(E,F){for(let G=0;6>G;G++)if(0<e.signedDistance(E[G],F))return!1;return!0}function r(E,F){for(let G=0;6>G;G++)if(e.isAABBFullyInside(E[G],F))return!1;return!0}function C(E,F){for(let G=0;6>G;G++)if(!e.clip(E[G],F))return!1;return!0}const A={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},x=[k.fromValues(-1,-1,-1,1),k.fromValues(1,-1,-1,1),k.fromValues(1,1,-1,1),k.fromValues(-1,1,-1,1),
k.fromValues(-1,-1,1,1),k.fromValues(1,-1,1,1),k.fromValues(1,1,1,1),k.fromValues(-1,1,1,1)],m=new f.ObjectStack(h.create),B=q();f=Object.freeze({__proto__:null,create:n,createPoints:q,copy:u,fromMatrix:v,computePlanes:t,intersectsSphere:l,intersectsRay:w,intersectClipRay:y,intersectsLineSegment:D,intersectsPoint:z,intersectsAABB:r,planePointIndices:A});a.computePlanes=t;a.copy=u;a.create=n;a.createPoints=q;a.fromMatrix=v;a.frustumModule=f;a.intersectClipRay=y;a.intersectsAABB=r;a.intersectsLineSegment=
D;a.intersectsPoint=z;a.intersectsRay=w;a.intersectsSphere=l;a.planePointIndices=A})},"esri/chunks/triangle":function(){define("exports ./vec3f64 ./vec3 ../core/ObjectStack ./vec2 ../views/3d/support/stack ./lineSegment".split(" "),function(a,g,b,p,f,k,c){function d(r){return r?{p0:g.clone(r.p0),p1:g.clone(r.p1),p2:g.clone(r.p2)}:{p0:g.create(),p1:g.create(),p2:g.create()}}function e(r,C,A){const x=y.get();x.p0=r;x.p1=C;x.p2=A;return x}function h(r,C=d()){return n(r.p0,r.p1,r.p2,C)}function n(r,C,
A,x=d()){b.copy(x.p0,r);b.copy(x.p1,C);b.copy(x.p2,A);return x}function q(r,C){var A=r.p0,x=r.p1;r=r.p2;const m=b.subtract(k.sv3d.get(),x,A),B=b.subtract(k.sv3d.get(),r,x),E=b.subtract(k.sv3d.get(),A,r),F=b.subtract(k.sv3d.get(),C,A);var G=b.subtract(k.sv3d.get(),C,x),I=b.subtract(k.sv3d.get(),C,r);const K=b.cross(m,m,E),J=b.dot(b.cross(k.sv3d.get(),m,K),F);G=b.dot(b.cross(k.sv3d.get(),B,K),G);I=b.dot(b.cross(k.sv3d.get(),E,K),I);if(0<J&&0<G&&0<I)return C=b.dot(K,F),C*C/b.dot(K,K);A=c.distance2(c.fromValues(A,
m,w.get()),C);x=c.distance2(c.fromValues(x,B,w.get()),C);C=c.distance2(c.fromValues(r,E,w.get()),C);return Math.min(A,x,C)}function u(r,C,A){const {direction:x,origin:m}=C,{p0:B,p1:E,p2:F}=r;var G=E[0]-B[0],I=E[1]-B[1],K=E[2]-B[2];r=F[0]-B[0];C=F[1]-B[1];const J=F[2]-B[2];var L=x[1]*J-C*x[2],P=x[2]*r-J*x[0];const Q=x[0]*C-r*x[1];var X=G*L+I*P+K*Q;if(-1E-5<X&&1E-5>X)return!1;X=1/X;const aa=m[0]-B[0],S=m[1]-B[1],H=m[2]-B[2];L=X*(aa*L+S*P+H*Q);if(0>L||1<L)return!1;P=S*K-I*H;K=H*G-K*aa;G=aa*I-G*S;I=X*
(x[0]*P+x[1]*K+x[2]*G);if(0>I||1<L+I)return!1;A&&(b.scale(A,x,X*(r*P+C*K+J*G)),b.add(A,m,A));return!0}function v(r,C,A){var x=f.distance(r,C);C=f.distance(C,A);r=f.distance(A,r);A=(x+C+r)/2;x=A*(A-x)*(A-C)*(A-r);return 0>=x?0:Math.sqrt(x)}function t(r){return v(r.p0,r.p1,r.p2)}function l(r,C,A){b.subtract(D,C,r);b.subtract(z,A,r);return b.length(b.cross(D,D,z))/2}const w=new p.ObjectStack(c.create),y=new p.ObjectStack(()=>({p0:null,p1:null,p2:null})),D=g.create(),z=g.create();p=Object.freeze({__proto__:null,
create:d,wrap:e,copy:h,fromValues:n,distance2:q,intersectRay:u,areaPoints2d:v,area2d:t,areaPoints3d:l});a.area2d=t;a.areaPoints2d=v;a.areaPoints3d=l;a.copy=h;a.create=d;a.distance2=q;a.fromValues=n;a.intersectRay=u;a.triangleModule=p;a.wrap=e})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../core/Evented ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/watchUtils ../../../geometry/projection ../../../webscene/background/ColorBackground ../../../chunks/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){const G=y.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);a.SceneViewEnvironmentManager=function(P){function Q(...aa){aa=P.call(this,...aa)||this;aa._referencePointUpdateDelay=200;aa._referencePointUpdateInterval=3E3;aa._referencePointUpdateDistThreshold=1E6;aa._referencePosUpdateQuery=null;aa._referencePosMapCoordsRequested=null;aa._viewHandles=new z;aa._preserveAbsoluteDateTime=!1;aa._trackingEnabled=!1;aa._referencePosResetPreserveAbsoluteTime=
!1;aa.referencePosUpdateTimer=null;aa._referencePosWGS84Comparable=null;aa._referencePosMapCoords=null;aa._mainLight=new F.MainLight;aa._ambientLight=new F.AmbientLight;aa._moonLight=new F.FillLight;aa._renderer=null;aa._resetReferencePosition();return aa}g._inheritsLoose(Q,P);var X=Q.prototype;X.destroy=function(){this.disconnectView();this._viewHandles.destroy()};X.connectView=function(aa){this._renderer||(this._view=aa,this._renderer=new m({view:aa}),this._viewHandles.add([aa.watch("environment.lighting.date",
S=>this._lightingDateHandler(S),!0),aa.watch("stationary",()=>this._interactingStationaryHandler()),aa.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],()=>this._updateRenderParamsHandler(),!0),aa.watch("spatialReference",()=>this._resetReferencePosition(!0),!0),r.init(aa,"viewingMode",()=>this._resetReferencePosition(!0),!0),r.init(aa,"environment.lighting.cameraTrackingEnabled",
S=>this._updateCameraTracking(S),!0),r.init(aa,"state.camera",()=>this._cameraHandler(null),!0),this.watch("disableQueries",()=>this._cameraHandler(null))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};X.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};X._updateCameraTracking=function(aa){if(this._trackingEnabled=aa)this._cameraHandler();
else if(aa=this._view.environment.lighting)aa.positionTimezoneInfo.autoUpdated=!1};X._lightingDateHandler=function(aa){if(aa){var S=this._view.environment.lighting;if(!S.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!C.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var H=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(H)){this._requestReferencePositionUpdate(H);return}}this._preupdateTracking(aa);this._referencePosWGS84Comparable&&
(H=B.positionToTimezone(this._referencePosWGS84Comparable,K),f.isSome(H)&&(S.autoUpdate(null,H),this._trackingEnabled&&(S.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(aa)}};X._preupdateTracking=function(aa){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(aa)};X._cameraHandler=function(aa=null){if(this._view.ready){var S=this._view.camera;S&&(this._cameraHandlerClientSide(S,aa)||this._cameraHandlerServerSide(S))}};X._cameraHandlerClientSide=
function(aa,S){const H=t.isEarth(this._view.spatialReference);if(H&&!C.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;aa=aa.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=y.create());H?C.projectPointToWGS84ComparableLonLat(aa,this._referencePosWGS84Comparable):D.set(this._referencePosWGS84Comparable,aa.longitude,aa.latitude,aa.z);this._autoUpdateTimezone(this._referencePosWGS84Comparable,S)||this._updateLightParams(S);return!0};X._cameraHandlerServerSide=
function(aa){aa=aa.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(aa))&&this._requestReferencePositionUpdate(aa,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=aa.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};X._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};X._updateLightParams=function(aa){var S=
this._view.environment.lighting;aa=aa||S.date;S=this._view._stage;let H;this._referencePosWGS84Comparable?(H=E.computeColorAndIntensity(aa,this._referencePosWGS84Comparable),E.computeDirection(aa,this._referencePosWGS84Comparable,this._view.viewingMode,H.diffuse.direction)):H={diffuse:{color:[1,1,1],intensity:.55,direction:G},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};D.scale(this._mainLight.intensity,H.diffuse.color,H.diffuse.intensity*Math.PI);D.negate(this._mainLight.direction,
H.diffuse.direction);D.scale(this._ambientLight.intensity,H.ambient.color,H.ambient.intensity);D.lerp(this._moonLight.intensity,J,L,H.globalFactor);D.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*H.globalFactor)*(1-.4*H.noonFactor*(1-H.globalFactor)));D.copy(this._moonLight.direction,H.diffuse.direction);S.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:H.globalFactor,groundLightingFactor:1-H.noonFactor});this._updateRenderParamsHandler()};X._autoUpdateTimezone=
function(aa,S=null){if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;const H=I;H.setTime((S||this._view.environment.lighting.date).getTime());aa=B.positionToTimezone(aa,K);if(f.isNone(aa))return!1;var R=this._view.environment.lighting.positionTimezoneInfo;if(!R.autoUpdated)R=aa;else if(R.hours===aa.hours&&R.minutes===aa.minutes&&R.seconds===aa.seconds)return!1;const T=H.getUTCHours()-(aa.hours-R.hours),W=H.getUTCMinutes()-(aa.minutes-R.minutes);R=H.getUTCSeconds()-(aa.seconds-R.seconds);
H.setUTCHours(T);H.setUTCMinutes(W);H.setUTCSeconds(R);return S?!1:this._view.environment.lighting.autoUpdate(H,aa)};X._updateRenderParamsHandler=function(){const aa=this._view._stage;if(aa){var S=this._referencePosWGS84Comparable?E.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,H=this._view.environment.background;H=H instanceof A?{type:"color",color:x.fromArray(w.toUnitRGBA(H.color))}:{type:"color",color:x.fromValues(0,0,0,1)};aa.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
S,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:H})}};X._resetReferencePosition=function(aa=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");aa&&this._cameraHandler(null)};X._requestReferencePositionUpdate=function(aa,S=!1){if(!this.disableQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(aa):this._referencePosMapCoordsRequested=aa.clone(),this._referencePosResetPreserveAbsoluteTime=!!S,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){const H=this._referencePosUpdateQuery=v.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===H)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==H)}).catch(T=>{"mapcoordshelper:missing-geometry-service"===
T.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===H&&(this._referencePosUpdateQuery=null,this.referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),R=this.referencePosUpdateTimer=v.after(this._referencePointUpdateInterval).then(()=>{this.referencePosUpdateTimer===R&&(this.referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};X._doReferencePositionUpdateQuery=
async function(aa){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const S=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);aa()||isNaN(S[0])||isNaN(S[1])||(aa=this._referencePosMapCoords.z*
this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=S[0],this._referencePosWGS84Comparable[1]=S[1],this._referencePosWGS84Comparable[2]=aa):this._referencePosWGS84Comparable=[S[0],S[1],aa],this._referencePosChanged())};X._executePendingReferencePositionUpdate=function(){const aa=this._referencePosMapCoordsRequested;aa&&this._requestReferencePositionUpdate(aa,this._referencePosResetPreserveAbsoluteTime)};X._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};X._exceedsReferencePosDistThreshold=function(aa){return this._referencePosMapCoords?(aa=this._referencePosMapCoords.distance(aa),this._view.mapCoordsHelper&&(aa*=this._view.mapCoordsHelper.unitInMeters),aa>this._referencePointUpdateDistThreshold):!0};X._cancelReferencePosUpdates=function(){const aa=!!this._referencePosUpdateQuery;this.referencePosUpdateTimer=this._referencePosUpdateQuery=
null;return aa};g._createClass(Q,[{key:"updating",get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)}},{key:"test",get:function(){const aa=this;return{renderer:this._renderer,set referencePointUpdateInterval(S){aa._referencePointUpdateInterval=S},set referencePointUpdateDistThreshold(S){aa._referencePointUpdateDistThreshold=S},set referencePosUpdateTimer(S){aa.referencePosUpdateTimer=S},set referencePointUpdateDelay(S){aa._referencePointUpdateDelay=
S}}}}]);return Q}(l.EventedAccessor);a.SceneViewEnvironmentManager.FIXED_LIGHT_DIRECTION=G;b.__decorate([d.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);b.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);a.SceneViewEnvironmentManager=b.__decorate([h.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);
const I=new Date,K={hours:0,minutes:0,seconds:0},J=y.fromValues(.22,.22,.33),L=y.fromValues(.22,.22,.22);a.default=a.SceneViewEnvironmentManager;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/spatialReferenceUtils ../../../core/Handles ../../../core/watchUtils ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=[14,15];b=function(C){function A(){var m=C.apply(this,arguments)||this;m._handles=new t;m._context=null;m._pendingAtmosphere=null;m._atmosphere=null;m._stars=null;return m}a._inheritsLoose(A,C);var x=A.prototype;x.initialize=function(){this.view._stage.addRenderPlugin(r,this)};x.destroy=function(){this._pendingAtmosphere=p.destroyMaybe(this._pendingAtmosphere);this._atmosphere=p.destroyMaybe(this._atmosphere);this._stars=p.destroyMaybe(this._stars);
this._handles=p.destroyMaybe(this._handles);this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};x.initializeRenderContext=function(m){this._context=m;this.setup()};x.setup=function(){this._handles.add(l.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0));this._handles.add([l.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],()=>this._updateAtmosphere(),!0),l.init(this.view,"environment.starsEnabled",()=>this._updateStars(),
!0)])};x.uninitializeRenderContext=function(){p.isSome(this._stars)&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);p.isSome(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};x.render=function(m){let B=!0;p.isSome(this._stars)&&this._stars.canRender&&(B=this._stars.render(m)&&B);p.isSome(this._atmosphere)&&this._atmosphere.canRender&&(B=this._atmosphere.render(m)&&B);return B};x._setNeedsRender=function(){this._context&&
this._context.requestRender()};x._updateStars=function(){var m,B,E;const F=null!=(m=null==(B=this.view)?void 0:null==(E=B.environment)?void 0:E.starsEnabled)?m:!1;F&&p.isNone(this._stars)?(this._stars=new z.Stars({view:this.view}),this._stars.initializeRenderContext(this._context),this._setNeedsRender()):!F&&p.isSome(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};x._updateAtmosphere=function(){var m=this._getAtmosphereType();if(this.atmosphereType!==m)if(this.atmosphereType=
m,p.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),m=this._getAtmosphereClass()){var B=new m(this.view);B.initializeRenderContext(this._context);p.isNone(this._atmosphere)&&(this._atmosphere=B,this._setNeedsRender());this._pendingAtmosphere=B;B.when().then(()=>{p.isSome(this._atmosphere)&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=
null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===B&&(this._pendingAtmosphere=null)})}else p.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};x._getAtmosphereClass=function(){const m=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(m);switch(m){case "none":return null;case "realistic":return y.RealisticAtmosphere;case "panoramic":return w;
case "simple":return D}};x._getAtmosphereType=function(){const m=this.view.get("environment.atmosphereEnabled"),B=this.view.get("environment.atmosphere.quality"),E=this.view.viewingMode;return!m||null==B||v.isMoon(this.view.spatialReference)?"none":"local"===E?"panoramic":"high"===B&&y.RealisticAtmosphere.isSupported(this._context)&&!v.isMars(this.view.spatialReference)?"realistic":"simple"};x._updateBasemapTerrain=function(){const m=this.view.basemapTerrain;m&&(m.velvetOverground=null!=this._atmosphere&&
"simple"===this.atmosphereType)};a._createClass(A,[{key:"canRender",get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"updating",get:function(){return p.isSome(this._pendingAtmosphere)||p.isSome(this._stars)&&this._stars.updating}},{key:"test",get:function(){return{atmosphere:this._atmosphere}}}]);return A}(u);g.__decorate([c.property({constructOnly:!0})],b.prototype,"view",void 0);g.__decorate([c.property({constructOnly:!0})],
b.prototype,"atmosphereClassFromType",void 0);g.__decorate([c.property()],b.prototype,"updating",null);g.__decorate([c.property()],b.prototype,"_pendingAtmosphere",void 0);g.__decorate([c.property()],b.prototype,"_stars",void 0);return b=g.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],b)})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/Logger ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){const D=b.getLogger("esri.views.3d.environment.PanoramicAtmosphere");b=function(){function C(x){this.slot=14;this._readyResolver=p.createResolver();this._readyController=p.createAbortController();this.view=x;this._atmosphereTechniqueConfig=new e.SimpleAtmosphereTechniqueConfiguration}var A=C.prototype;A.destroy=function(){this._readyResolver.reject();this._texture=g.disposeMaybe(this._texture);this._vao=g.disposeMaybe(this._vao);this._readyController=
g.abortMaybe(this._readyController)};A.when=function(){return this._readyResolver.promise};A.initializeRenderContext=function(x){const m=x.renderContext.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=x.shaderTechniqueRep.acquireAndReleaseExisting(e.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(m);this._vaoCount=w.vertexCount(this._vao,"geometry");c.requestImage(h,{signal:this._readyController.signal}).then(B=>
{this._texture=new l(m,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},B);x.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(B=>{p.isAbortError(B)||D.error("Unable to initialize atmosphere: image request failed",B);this._readyResolver.reject()})};A.uninitializeRenderContext=function(){this.destroy()};A.render=function(x){if(x.slot!==this.slot||0!==x.pass)return!1;const m=x.rctx,B=this._atmosphereTechnique.program;m.bindProgram(B);this._atmosphereTechnique.bindPipelineState(m);
m.bindTexture(this._texture,0);B.setUniform1i("tex",0);u.View.bindProjectionMatrix(B,x.camera.projectionMatrix);var E=z;f.copy(E,x.camera.viewMatrix);E[12]=0;E[13]=0;E[14]=0;E[15]=1;B.setUniformMatrix4fv("view",z);B.setUniform4f("color",1,1,1,1);x.scenelightingData.setLightDirectionUniform(B);m.bindVAO(this._vao);B.assertCompatibleVertexAttributeLocations(this._vao);m.drawArrays(4,0,this._vaoCount);return!0};A._createVertexArrayObject=function(x){var m=v.createPolySphereGeometry(1,2,!1);const B=m.indices.get("position");
for(var E=0;E<B.length;E+=3){var F=B[E];B[E]=B[E+2];B[E+2]=F}m=m.vertexAttributes.get("position").data;E=r.createBuffer(B.length);F=E.position;for(let G=0;G<B.length;++G){const I=3*B[G];F.set(G,0,m[I]);F.set(G,1,m[I+1]);F.set(G,2,m[I+2])}return new y(x,d.Default3D,{geometry:n.glLayout(r)},{geometry:t.createVertex(x,35044,E.buffer)})};a._createClass(C,[{key:"canRender",get:function(){return null!=this._texture}}]);return C}();const z=k.create(),r=q.newLayout().vec3f("position");return b})},"esri/support/requestImageUtils":function(){define(["exports",
"../request"],function(a,g){a.requestImage=async function(b,p){({data:b}=await g(b,{responseType:"image",...p}));return b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports"],function(a){a.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){c=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build({geometry:this.configuration.geometry});return new h(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),e.Default3D)};v.initializePipeline=function(){return 1===this.configuration.geometry?n.makePipelineState({blending:n.separateBlendingParams(770,1,771,771),culling:n.backFaceCullingParams,depthTest:{func:515},
colorWrite:n.defaultColorWriteParams}):n.makePipelineState({blending:n.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:n.defaultColorWriteParams})};return u}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(f.SimpleAtmosphereShader,()=>new Promise(function(q,u){a(["./SimpleAtmosphere.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.geometry=0;return v}b._inheritsLoose(u,q);return u}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:3})],
f.prototype,"geometry",void 0);g.SimpleAtmosphereTechnique=c;g.SimpleAtmosphereTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,g,b,p){function f(c){const d=new p.ShaderBuilder;2===c.geometry?(d.attributes.add("position",
"vec2"),d.varyings.add("color","vec4"),d.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),d.vertex.code.add(g.glsl`
      void main(void) {
          float ndotl = dot(normalize(cameraPosition), -lightingMainDirection);
          float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

          color = vec4(vec3(lighting), undergroundFadeAlpha);

          gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane
      }
  `),d.fragment.code.add(g.glsl`
      void main() {
          gl_FragColor = color;
      }
  `)):(d.include(b.Transform,{linearDepth:!1}),d.attributes.add("position","vec3"),d.varyings.add("vtc","vec2"),d.varyings.add("falloff","float"),1!==c.geometry&&d.varyings.add("innerFactor","float"),d.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==c.geometry&&d.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==c.geometry&&d.vertex.code.add(g.glsl`
			const float TWICEPI = 2.0*3.14159265;
			const float ATMOSPHERE_RIM_SEGMENTS = 128.0;
		`),d.vertex.code.add(g.glsl`
		void main(void) {
			vec3 lightDirection = -lightingMainDirection;
	`),1===c.geometry?d.vertex.code.add(g.glsl`
			vec3 pos = position;
			float ndotl = lightDirection.z;
			vtc = vec2(0.0, position.z+0.05);
			`):d.vertex.code.add(g.glsl`
			innerFactor = clamp(-position.z, 0.0, 1.0);
			float scale = position.y * (1.0 + innerFactor * innerScale);
			float phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;
			vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
			float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);

			vtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;
			vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
		`),d.vertex.code.add(g.glsl`
		falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		gl_Position = transformPosition(proj, view, pos);
		gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
			}
	`),d.fragment.uniforms.add("tex","sampler2D"),1!==c.geometry&&d.fragment.uniforms.add("altitudeFade","float"),d.fragment.code.add(g.glsl`
		void main() {
			vec4 texColor = texture2D(tex, vtc);
	`),1===c.geometry?d.fragment.code.add(g.glsl`
			gl_FragColor = texColor * falloff;
			}
		`):d.fragment.code.add(g.glsl`
			vec4 atmosphereColor = texColor * falloff;
			vec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
		}
		`));return d}var k=Object.freeze({__proto__:null,build:f});a.SimpleAtmosphereShader=k;a.build=f})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function g(b,...p){let f="";for(let k=0;k<p.length;k++)f+=b[k]+p[k];return f+=b[b.length-1]}(function(b){b.int=function(p){return Math.round(p).toString()};b.float=function(p){return p.toPrecision(8)}})(g||(g={}));a.glsl=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports",
"../shaderModules/interfaces"],function(a,g){a.Transform=function(b,p){p.linearDepth?b.vertex.code.add(g.glsl`
    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
      vec4 eye = view * vec4(pos, 1.0);
      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
      return proj * eye;
    }
    `):b.vertex.code.add(g.glsl`
    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
      // Make sure the order of operations is the same as in transformPositionWithDepth.
      return proj * (view * vec4(pos, 1.0));
    }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(a,g,b){const p=b.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");b=function(){function u(){this.includedModules=new Map}u.prototype.include=function(v,t){this.includedModules.has(v)?this.includedModules.get(v)!==t&&p.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(v,t),v(this.builder,t))};return u}();let f=function(u){function v(){var t=u.apply(this,arguments)||this;t.vertex=new d;t.fragment=new d;t.attributes=new e;t.varyings=new h;t.extensions=new n;t.constants=new q;return t}g._inheritsLoose(v,u);v.prototype.generateSource=function(t){const l=this.extensions.generateSource(t),w=this.attributes.generateSource(t),y=this.varyings.generateSource();var D="vertex"===t?this.vertex:this.fragment;const z=D.uniforms.generateSource(),r=D.code.generateSource();
t="vertex"===t?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";D=this.constants.generateSource().concat(D.constants.generateSource());return`
${l.join("\n")}

${t}

${D.join("\n")}

${z.join("\n")}

${w.join("\n")}

${y.join("\n")}

${r.join("\n")}`};g._createClass(v,[{key:"builder",get:function(){return this}}]);return v}(b),k=function(){function u(){this._entries=[];this._set=new Set}var v=u.prototype;v.add=function(t,l,w){const y=`${t}_${l}_${w}`;this._set.has(y)||(this._entries.push([t,l,w]),this._set.add(y));return this};v.generateSource=function(){return this._entries.map(t=>{var l=t[2];return`uniform ${t[1]} ${t[0]}${l?`[${l}]`:""};`})};return u}(),c=function(){function u(){this._entries=[]}var v=u.prototype;v.add=function(t){this._entries.push(t)};
v.generateSource=function(){return this._entries};return u}(),d=function(u){function v(){var t=u.apply(this,arguments)||this;t.uniforms=new k;t.code=new c;t.constants=new q;return t}g._inheritsLoose(v,u);g._createClass(v,[{key:"builder",get:function(){return this}}]);return v}(b),e=function(){function u(){this._entries=[]}var v=u.prototype;v.add=function(t,l){this._entries.push([t,l])};v.generateSource=function(t){return"fragment"===t?[]:this._entries.map(l=>`attribute ${l[1]} ${l[0]};`)};return u}(),
h=function(){function u(){this._entries=[]}var v=u.prototype;v.add=function(t,l){this._entries.push([t,l])};v.generateSource=function(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)};return u}(),n=function(){function u(){this._entries=new Set}var v=u.prototype;v.add=function(t){this._entries.add(t)};v.generateSource=function(t){const l="vertex"===t?u.ALLOWLIST_VERTEX:u.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(w=>l.includes(w)).map(w=>`#extension ${w} : enable`)};return u}();
n.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];n.ALLOWLIST_VERTEX=[];let q=function(){function u(){this._entries=[]}var v=u.prototype;v.add=function(t,l,w){let y="ERROR_CONSTRUCTOR_STRING";switch(l){case "float":y=u.numberToFloatStr(w);break;case "int":y=u.numberToIntStr(w);break;case "bool":y=w.toString();break;case "vec2":y=`vec2(${u.numberToFloatStr(w[0])},\
                            ${u.numberToFloatStr(w[1])})`;break;case "vec3":y=`vec3(${u.numberToFloatStr(w[0])},\
                            ${u.numberToFloatStr(w[1])},\
                            ${u.numberToFloatStr(w[2])})`;break;case "vec4":y=`vec4(${u.numberToFloatStr(w[0])},\
                            ${u.numberToFloatStr(w[1])},\
                            ${u.numberToFloatStr(w[2])},\
                            ${u.numberToFloatStr(w[3])})`;break;case "ivec2":y=`ivec2(${u.numberToIntStr(w[0])},\
                             ${u.numberToIntStr(w[1])})`;break;case "ivec3":y=`ivec3(${u.numberToIntStr(w[0])},\
                             ${u.numberToIntStr(w[1])},\
                             ${u.numberToIntStr(w[2])})`;break;case "ivec4":y=`ivec4(${u.numberToIntStr(w[0])},\
                             ${u.numberToIntStr(w[1])},\
                             ${u.numberToIntStr(w[2])},\
                             ${u.numberToIntStr(w[3])})`;break;case "bvec2":y=`bvec2(${w[0].toString()},\
                             ${w[1].toString()})`;break;case "bvec3":y=`bvec3(${w[0].toString()},\
                             ${w[1].toString()},\
                             ${w[2].toString()})`;break;case "bvec4":y=`bvec4(${w[0].toString()},\
                             ${w[1].toString()},\
                             ${w[2].toString()},\
                             ${w[3].toString()})`;break;case "mat2":case "mat3":case "mat4":y=`${l}(${Array.prototype.map.call(w,D=>u.numberToFloatStr(D)).join(", ")})`}this._entries.push(`const ${l} ${t} = ${y};`);return this};u.numberToIntStr=function(t){return t.toFixed(0)};u.numberToFloatStr=function(t){return Number.isInteger(t)?t.toFixed(1):t.toString()};v.generateSource=function(){return Array.from(this._entries)};return u}();a.Code=c;a.Includes=b;a.ShaderBuilder=f;a.Stage=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],function(a){let g=function(){function b(f,k){this._module=f;this._loadModule=k}var p=b.prototype;p.get=function(){return this._module};p.reload=async function(){return this._module=await this._loadModule()};return b}();a.ReloadableShaderModule=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k,c){c&&(this._config=c.snapshot());this._program=this.initializeProgram(k);k.commonUniformStore&&(this._commonUniformStore=k.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(k)}var f=p.prototype;f.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),
this._program=null)};f.reload=function(k){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(k);this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};f.bindPass=function(k,c,d){};f.bindMaterial=function(k,c,d){};f.bindDraw=function(k,c,d){};f.bindPipelineState=function(k){k.setPipelineState(this.pipeline)};f.ensureAttributeLocations=function(k){this.program.assertCompatibleVertexAttributeLocations(k)};
g._createClass(p,[{key:"program",get:function(){return this._program}},{key:"pipeline",get:function(){return this._pipeline}},{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return 4}}]);return p}();a.ShaderTechnique=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/mathUtils"],function(a,g,b){let p=function(){function f(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits.map(()=>0)}f.prototype.snapshot=function(){const k=this._parameterNames,c={key:this.key};for(const d of k)c[d]=this[d];return c};g._createClass(f,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return f}();a.ShaderTechniqueConfiguration=p;a.parameter=
function(f={}){return(k,c)=>{var d,e;k._parameterNames=null!=(d=k._parameterNames)?d:[];k._parameterNames.push(c);const h=k._parameterNames.length-1;d=Math.ceil(b.log2(f.count||2));const n=null!=(e=k._parameterBits)?e:[0];let q=0;for(;16<n[q]+d;)q++,q>=n.length&&n.push(0);k._parameterBits=n;const u=n[q],v=(1<<d)-1<<u;n[q]+=d;Object.defineProperty(k,c,{get(){return this[h]},set(t){if(this[h]!==t&&(this[h]=t,this._keyDirty=!0,this._parameterBits[q]=this._parameterBits[q]&~v|+t<<u&v,"number"!==typeof t&&
"boolean"!==typeof t))throw"Configuration value for "+c+" must be boolean or number, got "+typeof t;}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","./ShaderTranspiler"],function(a,g,b,p){function f(k,c){if(b.isNone(k)||k.length!==c.length)return!0;for(let d=0;d<k.length;++d)if(k[d]!==c[d])return!0;return!1}return function(){function k(d,e,h,n,q={}){this._glName=this._context=
null;this._locations={};this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};d||console.error("RenderingContext isn't initialized!");0===e.length&&console.error("Shaders source should not be empty!");d.instanceCounter.increment(3,this);this._context=
d;this._vertexShaderSource=e;this._fragmentShaderSource=h;if(Array.isArray(q))for(const u of q)this._defines[u]="1";else this._defines=q;this._locations=n}var c=k.prototype;c.getDefine=function(d){return this._defines[d]};c.dispose=function(){if(this._context){var d=this._context.gl;this._vShader&&(d.deleteShader(this._vShader),this._vShader=null);this._fShader&&(d.deleteShader(this._fShader),this._fShader=null);this._glName&&(d.deleteProgram(this._glName),this._glName=null);this._context.instanceCounter.decrement(3,
this);this._context=null}};c.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var d=this._context.gl,e=d.createProgram();d.attachShader(e,this._vShader);d.attachShader(e,this._fShader);for(const h in this._locations)d.bindAttribLocation(e,this._locations[h],h);d.linkProgram(e);this._glName=e;this._initialized=!0}};c.getUniformLocation=function(d){this.initialize();
void 0===this._nameToUniformLocation[d]&&(this._nameToUniformLocation[d]=this._context.gl.getUniformLocation(this._glName,d));return this._nameToUniformLocation[d]};c.hasUniform=function(d){return null!==this.getUniformLocation(d)};c.getAttribLocation=function(d){this.initialize();void 0===this._nameToAttribLocation[d]&&(this._nameToAttribLocation[d]=this._context.gl.getAttribLocation(this._glName,d));return this._nameToAttribLocation[d]};c.setUniform1i=function(d,e){const h=this._nameToUniform1[d];
if(void 0===h||e!==h)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(d),e),this._nameToUniform1[d]=e};c.setUniform1iv=function(d,e){const h=this._nameToUniform1v[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform1v[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform2iv=function(d,e){const h=this._nameToUniform2[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(d),
e),void 0===h?this._nameToUniform2[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform3iv=function(d,e){const h=this._nameToUniform3[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform3[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform4iv=function(d,e){const h=this._nameToUniform4[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform4[d]=
k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform1f=function(d,e){const h=this._nameToUniform1[d];if(void 0===h||e!==h)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(d),e),this._nameToUniform1[d]=e};c.setUniform1fv=function(d,e){const h=this._nameToUniform1v[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform1v[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform2f=function(d,e,h){const n=
this._nameToUniform2[d];if(void 0===n||e!==n[0]||h!==n[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(d),e,h),void 0===n?this._nameToUniform2[d]=[e,h]:(n[0]=e,n[1]=h)};c.setUniform2fv=function(d,e){const h=this._nameToUniform2[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform2[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform3f=function(d,e,h,n){const q=this._nameToUniform3[d];
if(void 0===q||e!==q[0]||h!==q[1]||n!==q[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(d),e,h,n),void 0===q?this._nameToUniform3[d]=[e,h,n]:(q[0]=e,q[1]=h,q[2]=n)};c.setUniform3fv=function(d,e){const h=this._nameToUniform3[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform3[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniform4f=function(d,e,h,n,q){const u=this._nameToUniform4[d];
if(void 0===u||e!==u[0]||h!==u[1]||n!==u[2]||q!==u[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(d),e,h,n,q),void 0===u?this._nameToUniform4[d]=[e,h,n,q]:(u[0]=e,u[1]=h,u[2]=n,u[3]=q)};c.setUniform4fv=function(d,e){const h=this._nameToUniform4[d];f(h,e)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(d),e),void 0===h?this._nameToUniform4[d]=k._arrayCopy(e):k._arrayAssign(e,h))};c.setUniformMatrix3fv=function(d,e,h=!1){const n=
this._nameToUniformMatrix3[d];var q=b.isNone(n)?!0:9!==n.length?f(n,e):9!==n.length||n[0]!==e[0]||n[1]!==e[1]||n[2]!==e[2]||n[3]!==e[3]||n[4]!==e[4]||n[5]!==e[5]||n[6]!==e[6]||n[7]!==e[7]||n[8]!==e[8];q&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),h,e),void 0===n?this._nameToUniformMatrix3[d]=k._arrayCopy(e):k._arrayAssign(e,n))};c.setUniformMatrix4fv=function(d,e,h=!1){const n=this._nameToUniformMatrix4[d];var q=b.isNone(n)?!0:16!==n.length?f(n,e):
16!==n.length||n[0]!==e[0]||n[1]!==e[1]||n[2]!==e[2]||n[3]!==e[3]||n[4]!==e[4]||n[5]!==e[5]||n[6]!==e[6]||n[7]!==e[7]||n[8]!==e[8]||n[9]!==e[9]||n[10]!==e[10]||n[11]!==e[11]||n[12]!==e[12]||n[13]!==e[13]||n[14]!==e[14]||n[15]!==e[15];q&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),h,e),void 0===n?this._nameToUniformMatrix4[d]=k._arrayCopy(e):k._arrayAssign(e,n))};c.assertCompatibleVertexAttributeLocations=function(d){(d=d.locations===this.locations)||
console.error("VertexAttributeLocations are incompatible");return d};k._padToThree=function(d){let e=d.toString();1E3>d&&(e=("  "+d).slice(-3));return e};c._addLineNumbers=function(d){let e=2;return d.replace(/\n/g,()=>"\n"+k._padToThree(e++)+":")};c._loadShader=function(d){var e=35633===d,h=e?this._vertexShaderSource:this._fragmentShaderSource;let n="";for(const q in this._defines)n+=`#define ${q} ${this._defines[q]}\n`;h=n+h;"webgl2"===this._context.contextVersion&&(h=p.transpileShader(h,e?"vertex":
"fragment"));e=this._context.gl;d=e.createShader(d);e.shaderSource(d,h);e.compileShader(d);return d};k._arrayCopy=function(d){const e=[];for(let h=0;h<d.length;++h)e.push(d[h]);return e};k._arrayAssign=function(d,e){for(let h=0;h<d.length;++h)e[h]=d[h]};a._createClass(k,[{key:"glName",get:function(){return this._glName}},{key:"locations",get:function(){return this._locations}}]);return k}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../chunks/_commonjsHelpers","./reservedWordsGLSL3"],
function(a,g,b){function p(){function l(aa){aa.length&&G.push({type:v[m],data:aa,position:J,line:I,column:K})}function w(){F=F.length?[]:F;if("/"===E&&"*"===B)return J=x+A-1,m=0,E=B,A+1;if("/"===E&&"/"===B)return J=x+A-1,m=1,E=B,A+1;if("#"===B)return m=2,J=x+A,A;if(/\s/.test(B))return m=9,J=x+A,A;L=/\d/.test(B);P=/[^\w_]/.test(B);J=x+A;m=L?4:P?3:9999;return A}function y(){if(("\r"===B||"\n"===B)&&"\\"!==E)return l(F.join("")),m=999,A;F.push(B);E=B;return A+1}function D(){if("."===E&&/\d/.test(B))return m=
5,A;if("/"===E&&"*"===B)return m=0,A;if("/"===E&&"/"===B)return m=1,A;if("."===B&&F.length){for(;z(F););m=5;return A}if(";"===B||")"===B||"("===B){if(F.length)for(;z(F););l(B);m=999;return A+1}var aa=2===F.length&&"\x3d"!==B;if(/[\w_\d\s]/.test(B)||aa){for(;z(F););m=999;return A}F.push(B);E=B;return A+1}function z(aa){var S=0;do{var H=q.indexOf(aa.slice(0,aa.length+S).join(""));var R=q[H];if(-1===H){if(0<S--+aa.length)continue;R=aa.slice(0,1).join("")}l(R);J+=R.length;F=F.slice(R.length);return F.length}while(1)}
function r(){if("."===B||/[eE]/.test(B))return F.push(B),m=5,E=B,A+1;if("x"===B&&1===F.length&&"0"===F[0])return m=11,F.push(B),E=B,A+1;if(/[^\d]/.test(B))return l(F.join("")),m=999,A;F.push(B);E=B;return A+1}function C(){"f"===B&&(F.push(B),E=B,A+=1);if(/[eE]/.test(B)||"-"===B&&/[eE]/.test(E))return F.push(B),E=B,A+1;if(/[^\d]/.test(B))return l(F.join("")),m=999,A;F.push(B);E=B;return A+1}var A=0,x=0,m=999,B,E,F=[],G=[],I=1,K=0,J=0,L=!1,P=!1,Q="",X;return function(aa){G=[];if(null!==aa){aa=aa.replace?
aa.replace(/\r\n/g,"\n"):aa;A=0;Q+=aa;for(X=Q.length;B=Q[A],A<X;){aa=A;switch(m){case 0:"/"===B&&"*"===E?(F.push(B),l(F.join("")),m=999):(F.push(B),E=B);A+=1;break;case 1:A=y();break;case 2:A=y();break;case 3:A=D();break;case 4:A=r();break;case 11:/[^a-fA-F0-9]/.test(B)?(l(F.join("")),m=999):(F.push(B),E=B,A+=1);break;case 5:A=C();break;case 9999:if(/[^\d\w_]/.test(B)){var S=F.join("");m=-1<n.indexOf(S)?8:-1<u.indexOf(S)?7:6;l(F.join(""));m=999}else F.push(B),E=B,A+=1;break;case 9:/[^\s]/g.test(B)?
(l(F.join("")),m=999):(F.push(B),E=B,A+=1);break;case 999:A=w()}if(aa!==A)switch(Q[aa]){case "\n":K=0;++I;break;default:++K}}x+=A;Q=Q.slice(A);return G}F.length&&l(F.join(""));m=10;l("(eof)");return G}}function f(l){return l.map(w=>"eof"!==w.type?w.data:"").join("")}function k(l,w="100",y="300 es"){const D=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const z of l)if("preprocessor"===z.type){const r=D.exec(z.data);if(r){l=r[1].replace(/\s\s+/g," ");if(l===y)return l;if(l===w)return z.data="#version "+
y,w;throw Error("unknown glsl version: "+l);}}l.splice(0,0,{type:"preprocessor",data:"#version "+y},{type:"whitespace",data:"\n"});return null}function c(l,w,y,D){D=D||y;for(const z of l)if("ident"===z.type&&z.data===y)return D in w?w[D]++:w[D]=0,c(l,w,D+"_"+w[D],D);return y}function d(l,w,y="afterVersion"){const D={data:"\n",type:"whitespace"},z=C=>C<l.length?/[^\r\n]$/.test(l[C].data):!1;let r=function(C){let A=-1,x=0,m=-1;for(let E=0;E<C.length;E++){var B=C[E];"preprocessor"===B.type&&(B.data.match(/#(if|ifdef|ifndef)\s+.+/)?
++x:B.data.match(/#endif\s*.*/)&&--x);("afterVersion"===y||"afterPrecision"===y)&&"preprocessor"===B.type&&/^#version/.test(B.data)&&(m=Math.max(m,E));if("afterPrecision"===y&&"keyword"===B.type&&"precision"===B.data){a:{for(B=E;B<C.length;B++){const F=C[B];if("operator"===F.type&&";"===F.data)break a}B=null}if(null===B)throw Error("precision statement not followed by any semicolons!");m=Math.max(m,B)}A<m&&0===x&&(A=E)}return A+1}(l);z(r-1)&&l.splice(r++,0,D);for(const C of w)l.splice(r++,0,C);z(r-
1)&&z(r)&&l.splice(r,0,D)}function e(l,w,y,D="lowp"){d(l,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:D},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:w},{type:"operator",data:";"}],"afterPrecision")}function h(l,w,y,D,z="lowp"){d(l,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},
{type:"integer",data:D.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:z},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:w},{type:"operator",data:";"}],"afterPrecision")}var n=g.createCommonjsModule(function(l){(function(w){w=w();void 0!==w&&(l.exports=w)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})}),
q=g.createCommonjsModule(function(l){(function(w){w=w();void 0!==w&&(l.exports=w)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})}),u=g.createCommonjsModule(function(l){(function(w){w=w();void 0!==w&&(l.exports=w)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})}),
v="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const t=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(l,w){var y=p(),D=[];D=D.concat(y(l));l=D=D.concat(y(null));if("300 es"===k(l,"100","300 es"))throw Error("shader is already glsl 300 es");D=y=null;const z={},r={};for(let m=0;m<l.length;++m){const B=l[m];switch(B.type){case "keyword":"vertex"===
w&&"attribute"===B.data?B.data="in":"varying"===B.data&&(B.data="vertex"===w?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(B.data.trim())&&(B.data=B.data.replace(/(2D|Cube|EXT)/g,""));"fragment"===w&&"gl_FragColor"===B.data&&(y||(y=c(l,z,"fragColor"),e(l,y,"vec4")),B.data=y);if("fragment"===w&&"gl_FragData"===B.data){{var C=void 0;let E=void 0;var A=l;var x=m+1;let F=-1;for(;x<A.length;x++){const G=A[x];if("operator"===G.type&&("["===G.data&&(E=x),"]"===G.data)){C=
x;break}"integer"===G.type&&(F=parseInt(G.data,10))}E&&C&&A.splice(E,C-E+1);A=F}C=c(l,z,"fragData");h(l,C,"vec4",A,"mediump");B.data=C}else"fragment"===w&&"gl_FragDepthEXT"===B.data&&(D||(D=c(l,z,"gl_FragDepth")),B.data=D);break;case "ident":if(0<=b.indexOf(B.data)){if(A="vertex"===w)a:{for(A=m-1;0<=A;A--)if(C=l[A],"whitespace"!==C.type&&"block-comment"!==C.type)if("keyword"===C.type){if("attribute"===C.data||"in"===C.data){A=!0;break a}}else break;A=!1}if(A)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
B.data in r||(r[B.data]=c(l,z,B.data));B.data=r[B.data]}}}for(w=l.length-1;0<=w;--w)y=l[w],"preprocessor"===y.type&&((D=y.data.match(/#extension\s+(.*):/))&&D[1]&&0<=t.indexOf(D[1].trim())&&(D=l[w+1],l.splice(w,D&&"whitespace"===D.type?2:1)),(D=y.data.match(/#ifdef\s+(.*)/))&&D[1]&&0<=t.indexOf(D[1].trim())&&(y.data="#if 1"),(D=y.data.match(/#ifndef\s+(.*)/))&&D[1]&&0<=t.indexOf(D[1].trim())&&(y.data="#if 0"));return f(l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/_commonjsHelpers":function(){define(["exports"],
function(a){function g(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs");}a.commonjsGlobal="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};a.commonjsRequire=g;a.createCommonjsModule=function(b,p,f){return f={path:p,exports:{},require:function(k,c){return g(k,void 0===c||null===c?f.path:c)}},b(f,f.exports),f.exports};a.getDefaultExportFromCjs=function(b){return b&&
b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b["default"]:b}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/renderState":function(){define(["exports"],function(a){function g(G){return z.intern(G)}function b(G){return r.intern(G)}function p(G){return C.intern(G)}function f(G){return A.intern(G)}function k(G){return x.intern(G)}function c(G){return m.intern(G)}function d(G){return B.intern(G)}function e(G){return E.intern(G)}function h(G){return"["+G.join(",")+"]"}function n(G){return G?h([G.srcRgb,G.srcAlpha,G.dstRgb,G.dstAlpha,G.opRgb,G.opAlpha,G.color.r,G.color.g,G.color.b,G.color.a]):
null}function q(G){return G?h([G.face,G.mode]):null}function u(G){return G?h([G.factor,G.units]):null}function v(G){return G?h([G.func]):null}function t(G){return G?h([G.function.func,G.function.ref,G.function.mask,G.operation.fail,G.operation.zFail,G.operation.zPass]):null}function l(G){return G?h([G.zNear,G.zFar]):null}function w(G){return G?h([G.r,G.g,G.b,G.a]):null}function y(G){return G?h([G.mask]):null}var D=function(){function G(I,K){this.makeKey=I;this.makeRef=K;this.interns=new Map}G.prototype.intern=
function(I){if(!I)return null;const K=this.makeKey(I),J=this.interns;J.has(K)||J.set(K,this.makeRef(I));return J.get(K)};return G}();const z=new D(n,G=>({__tag:"Blending",...G})),r=new D(q,G=>({__tag:"Culling",...G})),C=new D(u,G=>({__tag:"PolygonOffset",...G})),A=new D(v,G=>({__tag:"DepthTest",...G})),x=new D(t,G=>({__tag:"StencilTest",...G})),m=new D(l,G=>({__tag:"DepthWrite",...G})),B=new D(w,G=>({__tag:"ColorWrite",...G})),E=new D(y,G=>({__tag:"StencilWrite",...G})),F=new D(function(G){return G?
h([n(G.blending),q(G.culling),u(G.polygonOffset),v(G.depthTest),t(G.stencilTest),l(G.depthWrite),w(G.colorWrite),y(G.stencilWrite)]):null},G=>({blending:g(G.blending),culling:b(G.culling),polygonOffset:p(G.polygonOffset),depthTest:f(G.depthTest),stencilTest:k(G.stencilTest),depthWrite:c(G.depthWrite),colorWrite:d(G.colorWrite),stencilWrite:e(G.stencilWrite)}));D=function(){function G(K){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=
this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=K}var I=G.prototype;I.setPipeline=function(K){if(this._pipelineInvalid||K!==this._pipeline)this.setBlending(K.blending),this.setCulling(K.culling),this.setPolygonOffset(K.polygonOffset),this.setDepthTest(K.depthTest),this.setStencilTest(K.stencilTest),this.setDepthWrite(K.depthWrite),this.setColorWrite(K.colorWrite),this.setStencilWrite(K.stencilWrite),this._pipeline=K;this._pipelineInvalid=
!1};I.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};I.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};I.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};I.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};I.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};
I.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};I.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I.setBlending=function(K){this._blending=this.setSubState(K,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};I.setCulling=function(K){this._culling=this.setSubState(K,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};I.setPolygonOffset=function(K){this._polygonOffset=
this.setSubState(K,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};I.setDepthTest=function(K){this._depthTest=this.setSubState(K,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};I.setStencilTest=function(K){this._stencilTest=this.setSubState(K,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};I.setDepthWrite=function(K){this._depthWrite=
this.setSubState(K,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};I.setColorWrite=function(K){this._colorWrite=this.setSubState(K,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};I.setStencilWrite=function(K){this._stencilWrite=this.setSubState(K,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};I.setSubState=function(K,J,L,P){if(L||
K!==J)P(K),this._pipelineInvalid=!0;return K};return G}();a.StateTracker=D;a.backFaceCullingParams={face:1029,mode:2305};a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.makeBlending=g;a.makeColorWrite=d;a.makeCulling=b;a.makeDepthTest=f;a.makeDepthWrite=c;a.makePipelineState=function(G){return F.intern(G)};a.makePolygonOffset=p;a.makeStencilTest=k;a.makeStencilWrite=e;a.separateBlendingParams=function(G,I,K,J,L=32774,P=32774,Q=[0,0,0,0]){return{srcRgb:G,
srcAlpha:I,dstRgb:K,dstAlpha:J,opRgb:L,opAlpha:P,color:{r:Q[0],g:Q[1],b:Q[2],a:Q[3]}}};a.simpleBlendingParams=function(G,I,K=32774,J=[0,0,0,0]){return{srcRgb:G,srcAlpha:G,dstRgb:I,dstAlpha:I,opRgb:K,opAlpha:K,color:{r:J[0],g:J[1],b:J[2],a:J[3]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports"],function(a){const g={divisor:0},b={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126};a.glLayout=function(p,f={}){f={...g,...f};const k=p.stride;return p.fieldNames.filter(c=>{c=p.fields.get(c).optional;return!(c&&c.glPadding)}).map(c=>{const d=p.fields.get(c),e=d.constructor.ElementCount;var h=b[d.constructor.ElementType];if(!h)throw Error("BufferType not supported in WebGL");return{name:c,stride:k,count:e,type:h,offset:d.offset,
normalized:!(!d.optional||!d.optional.glNormalized),divisor:f.divisor}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./BufferView","./types"],function(a,g,b,p){let f=function(){function c(e,h){this.layout=e;this.buffer="number"===typeof h?new ArrayBuffer(h*e.stride):h;for(const n of e.fieldNames)h=e.fields.get(n),this[n]=new h.constructor(this.buffer,h.offset,this.stride)}
var d=c.prototype;d.getField=function(e,h){return(e=this[e])&&e.elementCount===h.ElementCount&&e.elementType===h.ElementType?e:null};d.slice=function(e,h){return new c(this.layout,this.buffer.slice(e*this.stride,h*this.stride))};d.copyFrom=function(e,h,n,q){const u=this.stride;0===u%4?(e=new Uint32Array(e.buffer,h*u,q*u/4),(new Uint32Array(this.buffer,n*u,q*u/4)).set(e)):(e=new Uint8Array(e.buffer,h*u,q*u),(new Uint8Array(this.buffer,n*u,q*u)).set(e))};g._createClass(c,[{key:"stride",get:function(){return this.layout.stride}},
{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return c}(),k=function(){function c(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var d=c.prototype;d.vec2f=function(e,h){this.appendField(e,b.BufferViewVec2f,h);return this};d.vec2f64=function(e,h){this.appendField(e,b.BufferViewVec2f64,h);return this};d.vec3f=function(e,h){this.appendField(e,b.BufferViewVec3f,h);return this};d.vec3f64=function(e,h){this.appendField(e,
b.BufferViewVec3f64,h);return this};d.vec4f=function(e,h){this.appendField(e,b.BufferViewVec4f,h);return this};d.vec4f64=function(e,h){this.appendField(e,b.BufferViewVec4f64,h);return this};d.mat3f=function(e,h){this.appendField(e,b.BufferViewMat3f,h);return this};d.mat3f64=function(e,h){this.appendField(e,b.BufferViewMat3f64,h);return this};d.mat4f=function(e,h){this.appendField(e,b.BufferViewMat4f,h);return this};d.mat4f64=function(e,h){this.appendField(e,b.BufferViewMat4f64,h);return this};d.vec4u8=
function(e,h){this.appendField(e,b.BufferViewVec4u8,h);return this};d.f32=function(e,h){this.appendField(e,b.BufferViewFloat,h);return this};d.f64=function(e,h){this.appendField(e,b.BufferViewFloat64,h);return this};d.u8=function(e,h){this.appendField(e,b.BufferViewUint8,h);return this};d.u16=function(e,h){this.appendField(e,b.BufferViewUint16,h);return this};d.i8=function(e,h){this.appendField(e,b.BufferViewInt8,h);return this};d.vec2i8=function(e,h){this.appendField(e,b.BufferViewVec2i8,h);return this};
d.vec2i16=function(e,h){this.appendField(e,b.BufferViewVec2i16,h);return this};d.vec2u8=function(e,h){this.appendField(e,b.BufferViewVec2u8,h);return this};d.vec4u16=function(e,h){this.appendField(e,b.BufferViewVec4u16,h);return this};d.u32=function(e,h){this.appendField(e,b.BufferViewUint32,h);return this};d.appendField=function(e,h,n){const q=h.ElementCount*p.elementTypeSize(h.ElementType);this.fields.set(e,{size:q,constructor:h,offset:this.stride,optional:n});this.stride+=q;this.fieldNames.push(e)};
d.alignTo=function(e){this.stride=Math.floor((this.stride+e-1)/e)*e;return this};d.hasField=function(e){return 0<=this.fieldNames.indexOf(e)};d.createBuffer=function(e){return new f(this,e)};d.createView=function(e){return new f(this,e)};d.clone=function(){const e=new c;e.stride=this.stride;e.fields=new Map;this.fields.forEach((h,n)=>e.fields.set(n,h));e.fieldNames=this.fieldNames.slice();e.BufferType=this.BufferType;return e};return c}();a.InterleavedBuffer=f;a.InterleavedLayout=k;a.newLayout=function(){return new k};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/BufferView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,g,b,p,f,k,c,d){let e=function(H){function R(T,W=0,Y,U){T=H.call(this,Float32Array,T,W,Y,U)||this;T.elementType="f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,
W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);e.ElementType="f32";let h=function(H){function R(T,W=0,Y,U){T=H.call(this,Float32Array,T,W,Y,U)||this;T.elementType="f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);h.ElementType="f32";let n=function(H){function R(T,W=0,Y,U){T=H.call(this,Float32Array,T,W,Y,U)||this;T.elementType="f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=
function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);n.ElementType="f32";let q=function(H){function R(T,W=0,Y,U){T=H.call(this,Float32Array,T,W,Y,U)||this;T.elementType="f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);q.ElementType="f32";let u=function(H){function R(T,W=0,Y,U){T=H.call(this,Float32Array,T,W,Y,U)||this;T.elementType=
"f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(b.BufferViewMat3Impl);u.ElementType="f32";b=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(b.BufferViewMat3Impl);b.ElementType="f64";let v=function(H){function R(T,W=0,Y,U){T=
H.call(this,Float32Array,T,W,Y,U)||this;T.elementType="f32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(p.BufferViewMat4Impl);v.ElementType="f32";p=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(p.BufferViewMat4Impl);p.ElementType=
"f64";let t=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);t.ElementType="f64";let l=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+
T.byteLength)};return R}(k.BufferViewVec2Impl);l.ElementType="f64";let w=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);w.ElementType="f64";let y=function(H){function R(T,W=0,Y,U){T=H.call(this,Float64Array,T,W,Y,U)||this;T.elementType="f64";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,
W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);y.ElementType="f64";let D=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint8Array,T,W,Y,U)||this;T.elementType="u8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);D.ElementType="u8";let z=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint8Array,T,W,Y,U)||this;T.elementType="u8";return T}
g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);z.ElementType="u8";let r=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint8Array,T,W,Y,U)||this;T.elementType="u8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);r.ElementType="u8";let C=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint8Array,
T,W,Y,U)||this;T.elementType="u8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);C.ElementType="u8";let A=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint16Array,T,W,Y,U)||this;T.elementType="u16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);A.ElementType="u16";let x=function(H){function R(T,
W=0,Y,U){T=H.call(this,Uint16Array,T,W,Y,U)||this;T.elementType="u16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);x.ElementType="u16";let m=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint16Array,T,W,Y,U)||this;T.elementType="u16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);
m.ElementType="u16";let B=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint16Array,T,W,Y,U)||this;T.elementType="u16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);B.ElementType="u16";let E=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint32Array,T,W,Y,U)||this;T.elementType="u32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+
T.byteLength)};return R}(f.BufferViewScalarImpl);E.ElementType="u32";let F=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint32Array,T,W,Y,U)||this;T.elementType="u32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);F.ElementType="u32";let G=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint32Array,T,W,Y,U)||this;T.elementType="u32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,
W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);G.ElementType="u32";let I=function(H){function R(T,W=0,Y,U){T=H.call(this,Uint32Array,T,W,Y,U)||this;T.elementType="u32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);I.ElementType="u32";let K=function(H){function R(T,W=0,Y,U){T=H.call(this,Int8Array,T,W,Y,U)||this;T.elementType="i8";return T}
g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);K.ElementType="i8";let J=function(H){function R(T,W=0,Y,U){T=H.call(this,Int8Array,T,W,Y,U)||this;T.elementType="i8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);J.ElementType="i8";let L=function(H){function R(T,W=0,Y,U){T=H.call(this,
Int8Array,T,W,Y,U)||this;T.elementType="i8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);L.ElementType="i8";let P=function(H){function R(T,W=0,Y,U){T=H.call(this,Int8Array,T,W,Y,U)||this;T.elementType="i8";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);P.ElementType="i8";let Q=
function(H){function R(T,W=0,Y,U){T=H.call(this,Int16Array,T,W,Y,U)||this;T.elementType="i16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);Q.ElementType="i16";let X=function(H){function R(T,W=0,Y,U){T=H.call(this,Int16Array,T,W,Y,U)||this;T.elementType="i16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};
return R}(k.BufferViewVec2Impl);X.ElementType="i16";let aa=function(H){function R(T,W=0,Y,U){T=H.call(this,Int16Array,T,W,Y,U)||this;T.elementType="i16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);aa.ElementType="i16";let S=function(H){function R(T,W=0,Y,U){T=H.call(this,Int16Array,T,W,Y,U)||this;T.elementType="i16";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,
T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);S.ElementType="i16";f=function(H){function R(T,W=0,Y,U){T=H.call(this,Int32Array,T,W,Y,U)||this;T.elementType="i32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(f.BufferViewScalarImpl);f.ElementType="i32";k=function(H){function R(T,W=0,Y,U){T=H.call(this,Int32Array,T,W,Y,U)||this;T.elementType="i32";return T}g._inheritsLoose(R,H);R.fromTypedArray=
function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(k.BufferViewVec2Impl);k.ElementType="i32";c=function(H){function R(T,W=0,Y,U){T=H.call(this,Int32Array,T,W,Y,U)||this;T.elementType="i32";return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(c.BufferViewVec3Impl);c.ElementType="i32";d=function(H){function R(T,W=0,Y,U){T=H.call(this,Int32Array,T,W,Y,U)||this;T.elementType="i32";
return T}g._inheritsLoose(R,H);R.fromTypedArray=function(T,W){return new R(T.buffer,T.byteOffset,W,T.byteOffset+T.byteLength)};return R}(d.BufferViewVec4Impl);d.ElementType="i32";a.BufferViewFloat=e;a.BufferViewFloat64=t;a.BufferViewInt16=Q;a.BufferViewInt32=f;a.BufferViewInt8=K;a.BufferViewMat3f=u;a.BufferViewMat3f64=b;a.BufferViewMat4f=v;a.BufferViewMat4f64=p;a.BufferViewUint16=A;a.BufferViewUint32=E;a.BufferViewUint8=D;a.BufferViewVec2f=h;a.BufferViewVec2f64=l;a.BufferViewVec2i16=X;a.BufferViewVec2i32=
k;a.BufferViewVec2i8=J;a.BufferViewVec2u16=x;a.BufferViewVec2u32=F;a.BufferViewVec2u8=z;a.BufferViewVec3f=n;a.BufferViewVec3f64=w;a.BufferViewVec3i16=aa;a.BufferViewVec3i32=c;a.BufferViewVec3i8=L;a.BufferViewVec3u16=m;a.BufferViewVec3u32=G;a.BufferViewVec3u8=r;a.BufferViewVec4f=q;a.BufferViewVec4f64=y;a.BufferViewVec4i16=S;a.BufferViewVec4i32=d;a.BufferViewVec4i8=P;a.BufferViewVec4u16=B;a.BufferViewVec4u32=I;a.BufferViewVec4u8=C;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k,c,d=0,e,h){this.TypedArrayConstructor=k;this.elementCount=9;k=this.TypedArrayConstructor;void 0===e&&(e=9*k.BYTES_PER_ELEMENT);const n=0===c.byteLength?0:d;this.typedBuffer=null==h?new k(c,n):new k(c,n,(h-d)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var f=p.prototype;f.getMat=function(k,c){k*=this.typedBufferStride;for(let d=0;9>d;d++)c[d]=this.typedBuffer[k+d];return c};f.setMat=function(k,c){k*=this.typedBufferStride;for(let d=0;9>d;d++)this.typedBuffer[k+d]=c[d]};f.get=function(k,c){return this.typedBuffer[k*this.typedBufferStride+c]};f.set=function(k,c,d){this.typedBuffer[k*this.typedBufferStride+c]=d};f.copyFrom=function(k,c,d){const e=this.typedBuffer,h=c.typedBuffer;k*=this.typedBufferStride;c=d*c.typedBufferStride;for(d=0;9>d;++d)e[k+
d]=h[c+d]};g._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k,c,d=0,e,h){this.TypedArrayConstructor=k;this.elementCount=16;k=this.TypedArrayConstructor;void 0===e&&(e=16*k.BYTES_PER_ELEMENT);const n=
0===c.byteLength?0:d;this.typedBuffer=null==h?new k(c,n):new k(c,n,(h-d)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var f=p.prototype;f.getMat=function(k,c){k*=this.typedBufferStride;for(let d=0;16>d;d++)c[d]=this.typedBuffer[k+d];return c};f.setMat=function(k,c){k*=this.typedBufferStride;for(let d=0;16>d;d++)this.typedBuffer[k+
d]=c[d]};f.get=function(k,c){return this.typedBuffer[k*this.typedBufferStride+c]};f.set=function(k,c,d){this.typedBuffer[k*this.typedBufferStride+c]=d};f.copyFrom=function(k,c,d){const e=this.typedBuffer,h=c.typedBuffer;k*=this.typedBufferStride;c=d*c.typedBufferStride;for(d=0;16>d;++d)e[k+d]=h[c+d]};g._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k,c,d=0,e,h){this.TypedArrayConstructor=k;this.elementCount=1;k=this.TypedArrayConstructor;void 0===e&&(e=k.BYTES_PER_ELEMENT);const n=0===c.byteLength?0:d;this.typedBuffer=null==h?new k(c,n):new k(c,n,(h-d)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var f=p.prototype;f.get=function(k){return this.typedBuffer[k*this.typedBufferStride]};f.set=function(k,c){this.typedBuffer[k*this.typedBufferStride]=c};g._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec2"],function(a,
g,b){let p=function(){function f(c,d,e=0,h,n){this.TypedArrayConstructor=c;this.elementCount=2;c=this.TypedArrayConstructor;void 0===h&&(h=2*c.BYTES_PER_ELEMENT);const q=0===d.byteLength?0:e;this.typedBuffer=null==n?new c(d,q):new c(d,q,(n-e)/c.BYTES_PER_ELEMENT);this.typedBufferStride=h/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var k=f.prototype;k.getVec=function(c,d){return b.set(d,
this.typedBuffer[c*this.typedBufferStride],this.typedBuffer[c*this.typedBufferStride+1])};k.setVec=function(c,d){this.typedBuffer[c*this.typedBufferStride]=d[0];this.typedBuffer[c*this.typedBufferStride+1]=d[1]};k.get=function(c,d){return this.typedBuffer[c*this.typedBufferStride+d]};k.set=function(c,d,e){this.typedBuffer[c*this.typedBufferStride+d]=e};k.setValues=function(c,d,e){this.typedBuffer[c*this.typedBufferStride]=d;this.typedBuffer[c*this.typedBufferStride+1]=e};k.copyFrom=function(c,d,e){const h=
this.typedBuffer,n=d.typedBuffer;c*=this.typedBufferStride;d=e*d.typedBufferStride;h[c]=n[d];h[c+1]=n[d+1]};g._createClass(f,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return f}();p.ElementCount=2;a.BufferViewVec2Impl=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3"],function(a,g,b){let p=function(){function f(c,d,e=0,
h,n){this.TypedArrayConstructor=c;this.elementCount=3;c=this.TypedArrayConstructor;void 0===h&&(h=3*c.BYTES_PER_ELEMENT);const q=0===d.byteLength?0:e;this.typedBuffer=null==n?new c(d,q):new c(d,q,(n-e)/c.BYTES_PER_ELEMENT);this.typedBufferStride=h/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var k=f.prototype;k.getVec=function(c,d){return b.set(d,this.typedBuffer[c*this.typedBufferStride],
this.typedBuffer[c*this.typedBufferStride+1],this.typedBuffer[c*this.typedBufferStride+2])};k.setVec=function(c,d){this.typedBuffer[c*this.typedBufferStride]=d[0];this.typedBuffer[c*this.typedBufferStride+1]=d[1];this.typedBuffer[c*this.typedBufferStride+2]=d[2]};k.get=function(c,d){return this.typedBuffer[c*this.typedBufferStride+d]};k.set=function(c,d,e){this.typedBuffer[c*this.typedBufferStride+d]=e};k.setValues=function(c,d,e,h){this.typedBuffer[c*this.typedBufferStride]=d;this.typedBuffer[c*
this.typedBufferStride+1]=e;this.typedBuffer[c*this.typedBufferStride+2]=h};k.copyFrom=function(c,d,e){const h=this.typedBuffer,n=d.typedBuffer;c*=this.typedBufferStride;d=e*d.typedBufferStride;h[c]=n[d];h[c+1]=n[d+1];h[c+2]=n[d+2]};g._createClass(f,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return f}();p.ElementCount=3;a.BufferViewVec3Impl=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/vec4"],function(a,g,b){let p=function(){function f(c,d,e=0,h,n){this.TypedArrayConstructor=c;this.elementCount=4;c=this.TypedArrayConstructor;void 0===h&&(h=4*c.BYTES_PER_ELEMENT);const q=0===d.byteLength?0:e;this.typedBuffer=null==n?new c(d,q):new c(d,q,(n-e)/c.BYTES_PER_ELEMENT);this.typedBufferStride=h/c.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var k=
f.prototype;k.getVec=function(c,d){return b.set(d,this.typedBuffer[c*this.typedBufferStride],this.typedBuffer[c*this.typedBufferStride+1],this.typedBuffer[c*this.typedBufferStride+2],this.typedBuffer[c*this.typedBufferStride+3])};k.setVec=function(c,d){this.typedBuffer[c*this.typedBufferStride]=d[0];this.typedBuffer[c*this.typedBufferStride+1]=d[1];this.typedBuffer[c*this.typedBufferStride+2]=d[2];this.typedBuffer[c*this.typedBufferStride+3]=d[3]};k.get=function(c,d){return this.typedBuffer[c*this.typedBufferStride+
d]};k.set=function(c,d,e){this.typedBuffer[c*this.typedBufferStride+d]=e};k.setValues=function(c,d,e,h,n){this.typedBuffer[c*this.typedBufferStride]=d;this.typedBuffer[c*this.typedBufferStride+1]=e;this.typedBuffer[c*this.typedBufferStride+2]=h;this.typedBuffer[c*this.typedBufferStride+3]=n};k.copyFrom=function(c,d,e){const h=this.typedBuffer,n=d.typedBuffer;c*=this.typedBufferStride;d=e*d.typedBufferStride;h[c]=n[d];h[c+1]=n[d+1];h[c+2]=n[d+2];h[c+3]=n[d+3]};g._createClass(f,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);
return f}();p.ElementCount=4;a.BufferViewVec4Impl=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/types":function(){define(["exports","../../../../core/has"],function(a,g){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;
case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(a,g,b){(function(f){function k(c,d,e){g.translate(p,e,d);c.setUniform3fv("localOrigin",d);c.setUniformMatrix4fv("view",p)}f.bindCamPosition=function(c,d,e){c.setUniform3f("camPos",e[3]-d[0],e[7]-d[1],e[11]-d[2])};f.bindProjectionMatrix=function(c,d){c.setUniformMatrix4fv("proj",d)};f.bindNearFar=function(c,d){c.setUniform2fv("nearFar",d)};f.bindViewCustomOrigin=k;f.bindView=function(c,d){k(c,d.origin,d.camera.viewMatrix)};
f.bindViewport=function(c,d){c.setUniform4fv("viewport",d.camera.fullViewport)}})(a.View||(a.View={}));const p=b.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f32":function(){define(["exports"],function(a){function g(){const d=new Float32Array(16);d[0]=1;d[5]=1;d[10]=1;d[15]=1;return d}function b(d){const e=new Float32Array(16);e[0]=d[0];e[1]=d[1];e[2]=d[2];e[3]=d[3];e[4]=d[4];e[5]=d[5];e[6]=d[6];e[7]=d[7];e[8]=d[8];e[9]=d[9];e[10]=d[10];e[11]=d[11];e[12]=d[12];e[13]=
d[13];e[14]=d[14];e[15]=d[15];return e}function p(d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){const x=new Float32Array(16);x[0]=d;x[1]=e;x[2]=h;x[3]=n;x[4]=q;x[5]=u;x[6]=v;x[7]=t;x[8]=l;x[9]=w;x[10]=y;x[11]=D;x[12]=z;x[13]=r;x[14]=C;x[15]=A;return x}function f(d,e){return new Float32Array(d,e,16)}const k=g();var c=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,IDENTITY:k});a.IDENTITY=k;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat4f32=c})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../support/geometryUtils ./BufferVectorMath ./Util ./geometryDataUtils ./Geometry".split(" "),
function(a,g,b,p,f,k,c,d){const e=f.Vec3Compact;var h;(function(t){const l=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],y=[0,0,1,0,1,1,0,1],D=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),z=new Uint16Array(36);for(var r=0;6>r;r++)for(let A=0;6>A;A++)z[6*r+A]=r;const C=new Uint16Array(36);for(r=0;6>r;r++)C[6*r]=0,C[6*r+1]=1,C[6*r+2]=2,C[6*r+3]=2,C[6*r+4]=
3,C[6*r+5]=0;t.createGeometry=function(A){Array.isArray(A)||(A=[A,A,A]);const x=Array(24);for(let m=0;8>m;m++)x[3*m]=l[m][0]*A[0],x[3*m+1]=l[m][1]*A[1],x[3*m+2]=l[m][2]*A[2];return new d.Geometry([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:w}],["uv0",{size:2,data:y}]],[["position",D],["normal",z],["uv0",C]])}})(h||(h={}));var n;(function(t){const l=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],w=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],y=new Uint16Array([5,
1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),D=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);t.createGeometry=function(z){Array.isArray(z)||(z=[z,z,z]);const r=Array(18);for(let C=0;6>C;C++)r[3*C]=l[C][0]*z[0],r[3*C+1]=l[C][1]*z[1],r[3*C+2]=l[C][2]*z[2];return new d.Geometry([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:w}]],[["position",y],["normal",D]])}})(n||(n={}));var q;(function(t){const l=b.fromValues(-.5,0,-.5),w=b.fromValues(.5,0,-.5),y=b.fromValues(0,
0,.5),D=b.fromValues(0,.5,0),z=b.create(),r=b.create(),C=b.create(),A=b.create(),x=b.create();g.subtract(z,l,D);g.subtract(r,l,w);g.cross(C,z,r);g.normalize(C,C);g.subtract(z,w,D);g.subtract(r,w,y);g.cross(A,z,r);g.normalize(A,A);g.subtract(z,y,D);g.subtract(r,y,l);g.cross(x,z,r);g.normalize(x,x);const m=[l,w,y,D],B=[0,-1,0,C[0],C[1],C[2],A[0],A[1],A[2],x[0],x[1],x[2]],E=[0,1,2,3,1,0,3,2,1,3,0,2],F=[0,0,0,1,1,1,2,2,2,3,3,3];t.createGeometry=function(G){Array.isArray(G)||(G=[G,G,G]);const I=Array(12);
for(let K=0;4>K;K++)I[3*K]=m[K][0]*G[0],I[3*K+1]=m[K][1]*G[1],I[3*K+2]=m[K][2]*G[2];return new d.Geometry([["position",{size:3,data:I,exclusive:!0}],["normal",{size:3,data:B}]],[["position",new Uint16Array(E)],["normal",new Uint16Array(F)]])}})(q||(q={}));var u;(function(t){function l(D,z,r,C,A){if(Math.abs(g.dot(z,D))>A)return!1;g.cross(r,D,z);g.normalize(r,r);g.cross(C,r,D);g.normalize(C,C);return!0}function w(D,z,r,C,A,x,m){return l(D,z,A,x,m)||l(D,r,A,x,m)||l(D,C,A,x,m)}t.createBoxGeometry=h.createGeometry;
t.createDiamondGeometry=n.createGeometry;t.createTetrahedronGeometry=q.createGeometry;t.createSphereGeometry=function(D,z,r,C={uv:!0}){var A=-Math.PI,x=2*Math.PI,m=-Math.PI/2,B=Math.PI;z=Math.max(3,Math.floor(z));const E=Math.max(2,Math.floor(r));var F=(z+1)*(E+1);r=new Float32Array(3*F);const G=new Float32Array(3*F);F=new Float32Array(2*F);const I=[];let K=0;for(var J=0;J<=E;J++){var L=[];const Q=J/E,X=m+Q*B,aa=Math.cos(X);for(let S=0;S<=z;S++){const H=S/z;var P=A+H*x;const R=Math.cos(P)*aa,T=Math.sin(X);
P=-Math.sin(P)*aa;r[3*K]=R*D;r[3*K+1]=T*D;r[3*K+2]=P*D;G[3*K]=R;G[3*K+1]=T;G[3*K+2]=P;F[2*K]=H;F[2*K+1]=Q;L.push(K);++K}I.push(L)}D=new Uint32Array(2*z*(E-1)*3);K=0;for(A=0;A<E;A++)for(x=0;x<z;x++)m=I[A][x],B=I[A][x+1],J=I[A+1][x+1],L=I[A+1][x],0===A?(D[K++]=m,D[K++]=J,D[K++]=L):A===E-1?(D[K++]=m,D[K++]=B,D[K++]=J):(D[K++]=m,D[K++]=B,D[K++]=J,D[K++]=J,D[K++]=L,D[K++]=m);z=[["position",D],["normal",D]];r=[["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:G,exclusive:!0}]];C.uv&&(r.push(["uv0",
{size:2,data:F,exclusive:!0}]),z.push(["uv0",D]));C.offset&&(z[0][0]="offset",r[0][0]="offset",z.push(["position",new Uint32Array(D.length)]),r.push(["position",{size:3,data:Float64Array.from(C.offset),exclusive:!0}]));return new d.Geometry(r,z)};t.createPolySphereGeometry=function(D,z,r){function C(B,E){B>E&&([B,E]=[E,B]);const F=B.toString()+"."+E.toString();if(m[F])return m[F];let G=A.length;A.length+=3;e.add(A,3*B,A,3*E,A,G);e.scale(A,G,D/e.length(A,G));G/=3;return m[F]=G}let A;r?(A=[0,-1,0,1,
0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(r=D*(1+Math.sqrt(5))/2,A=[-D,r,0,D,r,0,-D,-r,0,D,-r,0,0,-D,r,0,D,r,0,-D,-r,0,D,-r,r,0,-D,r,0,D,-r,0,-D,-r,0,D],r=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var x=0;x<A.length;x+=3)e.scale(A,x,D/e.length(A,x));let m={};for(x=0;x<z;x++){const B=r.length,E=new Uint32Array(4*B);for(let F=0;F<
B;F+=3){const G=r[F],I=r[F+1],K=r[F+2],J=C(G,I),L=C(I,K),P=C(K,G),Q=4*F;E[Q]=G;E[Q+1]=J;E[Q+2]=P;E[Q+3]=I;E[Q+4]=L;E[Q+5]=J;E[Q+6]=K;E[Q+7]=P;E[Q+8]=L;E[Q+9]=J;E[Q+10]=L;E[Q+11]=P}r=E;m={}}z=new Float32Array(A);for(x=0;x<z.length;x+=3)e.normalize(z,x);r=[["position",r],["normal",r]];z=[["position",{size:3,data:new Float32Array(A),exclusive:!0}],["normal",{size:3,data:z,exclusive:!0}]];return new d.Geometry(z,r)};t.createPointGeometry=function(D,z,r,C,A,x,m){z=z?[z[0],z[1],z[2]]:[0,0,0];D=D?[D[0],
D[1],D[2]]:[0,0,1];x=x||[0,0];r=[["position",{size:3,data:z,exclusive:!0}],["normal",{size:3,data:D,exclusive:!0}],["uv0",{size:x.length,data:x}],["color",{size:4,data:r?[255*r[0],255*r[1],255*r[2],3<r.length?255*r[3]:255]:[255,255,255,255],exclusive:!0}],["size",{size:2,data:null!=C&&2===C.length?C:[1,1]}]];null!=A&&(A=new Float32Array([A[0],A[1],A[2],A[3]]),r.push(["auxpos1",{size:4,data:A}]));null!=m&&(m=new Float32Array([m[0],m[1],m[2],m[3]]),r.push(["auxpos2",{size:4,data:m}]));return new d.Geometry(r,
null,1)};t.updatePointGeometry=function(D,z,r,C,A,x,m,B){if(null!=D){const {data:E}=B.getMutableAttribute("normal");E[0]=D[0];E[1]=D[1];E[2]=D[2]}null!=z&&({data:D}=B.getMutableAttribute("position"),D[0]=z[0],D[1]=z[1],D[2]=z[2]);null!=r&&({data:z}=B.getMutableAttribute("color"),z[0]=r[0],z[1]=r[1],z[2]=r[2],z[3]=r[3]);null!=C&&({data:r}=B.getMutableAttribute("size"),r[0]=C[0],r[1]=C[1]);null!=A&&({data:C}=B.getMutableAttribute("auxpos1"),C[0]=A[0],C[1]=A[1],C[2]=A[2],C[3]=A[3]);null!=x&&({data:A}=
B.getMutableAttribute("uv0"),A[0]=x[0],A[1]=x[1]);null!=m&&({data:x}=B.getMutableAttribute("auxpos2"),x[0]=m[0],x[1]=m[1],x[2]=m[2],x[3]=m[3])};t.createPointArrayGeometry=function(D,z){const r=new Float32Array(3*D.length),C=new Float32Array(z?3*D.length:3),A=new Uint32Array(D.length),x=new Uint32Array(D.length);for(let m=0;m<D.length;m++)r[3*m]=D[m][0],r[3*m+1]=D[m][1],r[3*m+2]=D[m][2],z&&(C[3*m]=z[m][0],C[3*m+1]=z[m][1],C[3*m+2]=z[m][2]),A[m]=m,x[m]=0;z||(C[0]=0,C[1]=1,C[2]=0);return new d.Geometry([["position",
{size:3,data:r,exclusive:!0}],["normal",{size:3,data:C,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",A],["normal",z?A:x],["uv0",x]],1)};t.createTriangleGeometry=function(){const D=new Uint16Array([0,1,2]),z=new Uint16Array([0,0,0]),r=new Uint16Array([0,0,0]);return new d.Geometry([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",D],["normal",z],["uv0",r]])};const y=
[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];t.createSquareGeometry=function(D=y){const z=Array(12);for(var r=0;4>r;r++)for(let C=0;3>C;C++)z[3*r+C]=D[r][C];D=new Uint32Array([0,1,2,2,3,0]);r=new Uint32Array([0,0,0,0,0,0]);return new d.Geometry([["position",{size:3,data:z,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",D],["normal",r],["uv0",D],["color",r]])};t.createConeGeometry=
function(D,z,r,C,A=!0,x=!0){var m=0,B=b.fromValues(0,m,0),E=b.fromValues(0,m+D,0),F=b.fromValues(0,-1,0),G=b.fromValues(0,1,0);C&&(m=D,E=b.fromValues(0,0,0),B=b.fromValues(0,m,0),F=b.fromValues(0,1,0),G=b.fromValues(0,-1,0));B=[E,B];F=[F,G];G=r+2;E=Math.sqrt(D*D+z*z);if(C)for(C=r-1;0<=C;C--){var I=2*Math.PI/r*C,K=b.fromValues(Math.cos(I)*z,m,Math.sin(I)*z);B.push(K);I=b.fromValues(D*Math.cos(I)/E,-z/E,D*Math.sin(I)/E);F.push(I)}else for(C=0;C<r;C++)I=2*Math.PI/r*C,K=b.fromValues(Math.cos(I)*z,m,Math.sin(I)*
z),B.push(K),I=b.fromValues(D*Math.cos(I)/E,z/E,D*Math.sin(I)/E),F.push(I);D=new Uint32Array(6*(r+2));r=new Uint32Array(6*(r+2));m=z=0;if(A){for(A=3;A<B.length;A++)D[z++]=1,D[z++]=A-1,D[z++]=A,r[m++]=0,r[m++]=0,r[m++]=0;D[z++]=B.length-1;D[z++]=2;D[z++]=1;r[m++]=0;r[m++]=0;r[m++]=0}if(x){for(x=3;x<B.length;x++)D[z++]=x,D[z++]=x-1,D[z++]=0,r[m++]=x,r[m++]=x-1,r[m++]=1;D[z++]=0;D[z++]=2;D[z++]=B.length-1;r[m++]=1;r[m++]=2;r[m++]=F.length-1}x=new Float32Array(3*G);for(A=0;A<G;A++)x[3*A]=B[A][0],x[3*
A+1]=B[A][1],x[3*A+2]=B[A][2];B=new Float32Array(3*G);for(A=0;A<G;A++)B[3*A]=F[A][0],B[3*A+1]=F[A][1],B[3*A+2]=F[A][2];return new d.Geometry([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:B,exclusive:!0}]],[["position",D],["normal",r]])};t.createCylinderGeometry=function(D,z,r,C,A,x){C=C?b.clone(C):b.fromValues(1,0,0);A=A?b.clone(A):b.fromValues(0,0,0);x=null==x?!0:x;var m=b.create();g.normalize(m,C);const B=b.create();g.scale(B,m,Math.abs(D));const E=b.create();g.scale(E,B,-.5);
g.add(E,E,A);const F=b.fromValues(0,1,0);.2>Math.abs(1-g.dot(m,F))&&g.set(F,0,0,1);const G=b.create();g.cross(G,m,F);g.normalize(G,G);g.cross(F,G,m);D=2*r+(x?2:0);A=r+(x?2:0);C=new Float32Array(3*D);const I=new Float32Array(3*A),K=new Float32Array(2*D),J=new Uint32Array(3*r*(x?4:2)),L=new Uint32Array(3*r*(x?4:2));x&&(C[3*(D-2)]=E[0],C[3*(D-2)+1]=E[1],C[3*(D-2)+2]=E[2],K[2*(D-2)]=0,K[2*(D-2)+1]=0,C[3*(D-1)]=C[3*(D-2)]+B[0],C[3*(D-1)+1]=C[3*(D-2)+1]+B[1],C[3*(D-1)+2]=C[3*(D-2)+2]+B[2],K[2*(D-1)]=1,
K[2*(D-1)+1]=1,I[3*(A-2)]=-m[0],I[3*(A-2)+1]=-m[1],I[3*(A-2)+2]=-m[2],I[3*(A-1)]=m[0],I[3*(A-1)+1]=m[1],I[3*(A-1)+2]=m[2]);m=function(S,H,R){J[S]=H;L[S]=R};let P=0;const Q=b.create(),X=b.create();for(let S=0;S<r;S++){var aa=2*Math.PI/r*S;g.scale(Q,F,Math.sin(aa));g.scale(X,G,Math.cos(aa));g.add(Q,Q,X);I[3*S]=Q[0];I[3*S+1]=Q[1];I[3*S+2]=Q[2];g.scale(Q,Q,z);g.add(Q,Q,E);C[3*S]=Q[0];C[3*S+1]=Q[1];C[3*S+2]=Q[2];K[2*S]=S/r;K[2*S+1]=0;C[3*(S+r)]=C[3*S]+B[0];C[3*(S+r)+1]=C[3*S+1]+B[1];C[3*(S+r)+2]=C[3*S+
2]+B[2];K[2*(S+r)]=S/r;K[2*S+1]=1;aa=(S+1)%r;m(P++,S,S);m(P++,S+r,S);m(P++,aa,aa);m(P++,aa,aa);m(P++,S+r,S);m(P++,aa+r,aa)}if(x){for(z=0;z<r;z++)x=(z+1)%r,m(P++,D-2,A-2),m(P++,z,A-2),m(P++,x,A-2);for(z=0;z<r;z++)x=(z+1)%r,m(P++,z+r,A-1),m(P++,D-1,A-1),m(P++,x+r,A-1)}return new d.Geometry([["position",{size:3,data:C,exclusive:!0}],["normal",{size:3,data:I,exclusive:!0}],["uv0",{size:2,data:K,exclusive:!0}]],[["position",J],["normal",L],["uv0",J]])};t.createTubeGeometry=function(D,z,r,C,A){r=r||10;
C=null!=C?C:!0;k.assert(1<D.length);const x=[],m=[];for(let B=0;B<r;B++){x.push([0,-B-1,-((B+1)%r)-1]);const E=B/r*2*Math.PI;m.push([Math.cos(E)*z,Math.sin(E)*z])}return t.createPathExtrusionGeometry(m,D,[[0,0,0]],x,C,A)};t.createPathExtrusionGeometry=function(D,z,r,C,A,x=b.fromValues(0,0,0)){var m=D.length;const B=new Float32Array(z.length*m*3+(6*r.length||0)),E=new Float32Array(z.length*m*3+(r?6:0));var F=(z.length-1)*m*6+6*C.length;const G=new Uint32Array(F);F=new Uint32Array(F);let I=0;var K=
0;let J=0,L=0;const P=b.create(),Q=b.create(),X=b.create(),aa=b.create(),S=b.create(),H=b.create(),R=b.create(),T=a.create(),W=b.create(),Y=b.create(),U=b.create(),N=b.create(),ca=b.create(),O=p.plane.create();g.set(W,0,1,0);g.subtract(Q,z[1],z[0]);g.normalize(Q,Q);A?(g.add(T,z[0],x),g.normalize(X,T)):g.set(X,0,0,1);w(Q,X,W,W,S,X,.99619469809);g.copy(aa,X);g.copy(N,S);for(var V=0;V<r.length;V++)g.scale(H,S,r[V][0]),g.scale(T,X,r[V][2]),g.add(H,H,T),g.add(H,H,z[0]),B[I++]=H[0],B[I++]=H[1],B[I++]=H[2];
E[K++]=-Q[0];E[K++]=-Q[1];E[K++]=-Q[2];for(V=0;V<C.length;V++)G[J++]=0<C[V][0]?C[V][0]:-C[V][0]-1+r.length,G[J++]=0<C[V][1]?C[V][1]:-C[V][1]-1+r.length,G[J++]=0<C[V][2]?C[V][2]:-C[V][2]-1+r.length,F[L++]=0,F[L++]=0,F[L++]=0;V=r.length;const ba=r.length-1;for(let ia=0;ia<z.length;ia++){let ma=!1;0<ia&&(g.copy(P,Q),ia<z.length-1?(g.subtract(Q,z[ia+1],z[ia]),g.normalize(Q,Q)):ma=!0,g.add(Y,P,Q),g.normalize(Y,Y),g.add(U,z[ia-1],aa),p.plane.fromPositionAndNormal(z[ia],Y,O),p.plane.intersectRay(O,p.ray.wrap(U,
P),T)?(g.subtract(T,T,z[ia]),g.normalize(X,T),g.cross(S,Y,X),g.normalize(S,S)):w(Y,aa,N,W,S,X,.99619469809),g.copy(aa,X),g.copy(N,S));A&&(g.add(T,z[ia],x),g.normalize(ca,T));for(let ea=0;ea<m;ea++)if(g.scale(H,S,D[ea][0]),g.scale(T,X,D[ea][1]),g.add(H,H,T),g.normalize(R,H),E[K++]=R[0],E[K++]=R[1],E[K++]=R[2],g.add(H,H,z[ia]),B[I++]=H[0],B[I++]=H[1],B[I++]=H[2],!ma){var fa=(ea+1)%m;G[J++]=V+ea;G[J++]=V+m+ea;G[J++]=V+fa;G[J++]=V+fa;G[J++]=V+m+ea;G[J++]=V+m+fa;for(fa=0;6>fa;fa++)F[L++]=G[J-6+fa]-ba}V+=
m}D=z[z.length-1];for(z=0;z<r.length;z++)g.scale(H,S,r[z][0]),g.scale(T,X,r[z][1]),g.add(H,H,T),g.add(H,H,D),B[I++]=H[0],B[I++]=H[1],B[I++]=H[2];r=K/3;E[K++]=Q[0];E[K++]=Q[1];E[K++]=Q[2];m=V-m;for(K=0;K<C.length;K++)G[J++]=0<=C[K][0]?V+C[K][0]:-C[K][0]-1+m,G[J++]=0<=C[K][2]?V+C[K][2]:-C[K][2]-1+m,G[J++]=0<=C[K][1]?V+C[K][1]:-C[K][1]-1+m,F[L++]=r,F[L++]=r,F[L++]=r;return new d.Geometry([["position",{size:3,data:B,exclusive:!0}],["normal",{size:3,data:E,exclusive:!0}]],[["position",G],["normal",F]])};
t.createPolylineGeometry=function(D,z,r){k.assert(1<D.length,"createPolylineGeometry(): polyline needs at least 2 points");k.assert(3===D[0].length,"createPolylineGeometry(): malformed vertex");k.assert(null==z||z.length===D.length,"createPolylineGeometry: need same number of points and normals");k.assert(null==z||3===z[0].length,"createPolylineGeometry(): malformed normal");var C=new Float64Array(3*D.length);const A=new Uint32Array(2*(D.length-1));var x=0,m=0;for(var B=0;B<D.length;B++){for(var E=
0;3>E;E++)C[x++]=D[B][E];0<B&&(A[m++]=B-1,A[m++]=B)}x=[];m=[];x.push(["position",A]);m.push(["position",{size:3,data:C,exclusive:!0}]);if(z){C=new Float32Array(3*z.length);B=0;for(E=0;E<D.length;E++)for(let F=0;3>F;F++)C[B++]=z[E][F];x.push(["normal",A]);m.push(["normal",{size:3,data:C,exclusive:!0}])}r&&(m.push(["color",{size:4,data:r}]),x.push(["color",c.generateDefaultIndexArray(r.length/4)]));return new d.Geometry(m,x,2)};t.createExtrudedTriangle=function(D,z,r,C){const A=Array(18);D=[[-z,0,C/
2],[r,0,C/2],[0,D,C/2],[-z,0,-C/2],[r,0,-C/2],[0,D,-C/2]];z=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(r=0;6>r;r++)A[3*r]=D[r][0],A[3*r+1]=D[r][1],A[3*r+2]=D[r][2];return new d.Geometry([["position",{size:3,data:A,exclusive:!0}]],[["position",z]])};t.transformInPlace=function(D,z){D=D.getMutableAttribute("position").data;for(let r=0;r<D.length;r+=3)g.set(v,D[r],D[r+1],D[r+2]),g.transformMat4(v,v,z),D[r]=v[0],D[r+1]=v[1],D[r+2]=v[2]};t.cgToGIS=function(D,z=D){var r=D.vertexAttributes;
D=r.get("position").data;if(r=r.get("normal").data){var C=z.getMutableAttribute("normal").data;for(var A=0;A<r.length;A+=3){const x=r[A+1];C[A+1]=-r[A+2];C[A+2]=x}}if(D)for(r=z.getMutableAttribute("position").data,C=0;C<D.length;C+=3)A=D[C+1],r[C+1]=-D[C+2],r[C+2]=A;return z};t.makeOrthoBasisDirUp=l;t.makeOrthoBasisDirUpFallback=w})(u||(u={}));const v=b.create();return u})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function g(){return new Float32Array(3)}function b(w){const y=
new Float32Array(3);y[0]=w[0];y[1]=w[1];y[2]=w[2];return y}function p(w,y,D){const z=new Float32Array(3);z[0]=w;z[1]=y;z[2]=D;return z}function f(w,y){return new Float32Array(w,y,3)}function k(){return g()}function c(){return p(1,1,1)}function d(){return p(1,0,0)}function e(){return p(0,1,0)}function h(){return p(0,0,1)}const n=g(),q=c(),u=d(),v=e(),t=h();var l=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,zeros:k,ones:c,unitX:d,unitY:e,unitZ:h,ZEROS:n,ONES:q,UNIT_X:u,UNIT_Y:v,
UNIT_Z:t});a.ONES=q;a.UNIT_X=u;a.UNIT_Y=v;a.UNIT_Z=t;a.ZEROS=n;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.ones=c;a.unitX=d;a.unitY=e;a.unitZ=h;a.vec3f32=l;a.zeros=k})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){(function(g){g.length=function(b,p){const f=b[p],k=b[p+1];b=b[p+2];return Math.sqrt(f*f+k*k+b*b)};g.normalize=function(b,p){var f=b[p];const k=b[p+1],c=b[p+2];f=1/Math.sqrt(f*f+k*k+c*c);b[p]*=f;b[p+1]*=f;b[p+2]*=f};g.scale=function(b,
p,f){b[p]*=f;b[p+1]*=f;b[p+2]*=f};g.add=function(b,p,f,k,c,d=p){c=c||b;c[d]=b[p]+f[k];c[d+1]=b[p+1]+f[k+1];c[d+2]=b[p+2]+f[k+2]};g.subtract=function(b,p,f,k,c,d=p){c=c||b;c[d]=b[p]-f[k];c[d+1]=b[p+1]-f[k+1];c[d+2]=b[p+2]-f[k+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Util":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4".split(" "),
function(a,g,b,p,f,k,c,d){function e(y,D){if(!y)throw D=D||"assert",y=Error(D),y.stack&&console.log(y.stack),new v(D);}function h(y,D){y[12]=D[0];y[13]=D[1];y[14]=D[2]}function n(y,D=0){let z=0;for(let r=0;4>r;r++)z+=y[D+r]*l[r];return z}function q(y){return y-Math.floor(y)}const u=k.create();let v=function(){function y(D){this.message=D}y.prototype.toString=function(){return`AssertException: ${this.message}`};return y}();const t=[1,256,65536,16777216],l=[1/256,1/65536,1/16777216,1/4294967296],w=
n(new Uint8ClampedArray([255,255,255,255]));a.AssertException=v;a.assert=e;a.createTranslationMatrix=function(y,D){y=p.identity(y);h(y,D);return y};a.dec2hex=function(y){y=y.toString(16);return"00000000".substr(0,8-y.length)+y};a.encodeInt16=function(y){return g.clamp(Math.round(32767*y),-32767,32767)};a.encodeNormal=function(y,D){const z=Math.abs(y[0]),r=Math.abs(y[1]),C=1/(z+r+Math.abs(y[2])),A=Math.min(y[2]*C,0);D[0]=(0>y[0]?-1:1)*(z*C-A);D[1]=(0>y[1]?-1:1)*(r*C-A)};a.fallbackIfUndefined=function(y,
D){return void 0===y?D:y};a.fovd2fovx=function(y,D,z){return 2*Math.atan(D*Math.tan(.5*y)/Math.sqrt(D*D+z*z))};a.fovd2fovy=function(y,D,z){return 2*Math.atan(z*Math.tan(.5*y)/Math.sqrt(D*D+z*z))};a.fovx2fovd=function(y,D,z){return 2*Math.atan(Math.sqrt(D*D+z*z)*Math.tan(.5*y)/D)};a.fovx2fovy=function(y,D,z){return 2*Math.atan(z*Math.tan(.5*y)/D)};a.fovy2fovd=function(y,D,z){return 2*Math.atan(Math.sqrt(D*D+z*z)*Math.tan(.5*y)/z)};a.fovy2fovx=function(y,D,z){return 2*Math.atan(D*Math.tan(.5*y)/z)};
a.getFirstObjectKey=function(y){for(const D in y)return D};a.getMatrixTranslation=function(y,D=b.create()){D[0]=y[12];D[1]=y[13];D[2]=y[14];return D};a.hex2rgb=function(y){y=Math.floor(y);return[(y>>16&255)/255,(y>>8&255)/255,(y&255)/255]};a.inverseProjectionInfo=function(y,D,z,r,C){0===y[11]?(r[0]=2/(D*y[0]),r[1]=2/(z*y[5]),r[2]=(1+y[12])/y[0],r[3]=(1+y[13])/y[5],c.set(C,0,1)):(r[0]=-2/(D*y[0]),r[1]=-2/(z*y[5]),r[2]=(1-y[8])/y[0],r[3]=(1-y[9])/y[5],c.set(C,1,0))};a.isTranslationMatrix=function(y){return 1===
y[0]&&0===y[1]&&0===y[2]&&0===y[3]&&0===y[4]&&1===y[5]&&0===y[6]&&0===y[7]&&0===y[8]&&0===y[9]&&1===y[10]&&0===y[11]&&1===y[15]};a.logWithBase=function(y,D){return Math.log(y)/Math.log(D)};a.objectEmpty=function(y){for(const D in y)return!1;return!0};a.packFloatRGBA=function(y,D,z=0){y=g.clamp(y,0,w);for(let r=0;4>r;r++)D[z+r]=Math.floor(256*q(y*t[r]))};a.project=function(y,D,z,r,C){C||(C=y);u[0]=y[0];u[1]=y[1];u[2]=y[2];u[3]=1;d.transformMat4(u,u,D);2<C.length&&(C[2]=-u[2]);d.transformMat4(u,u,z);
e(0!==u[3]);C[0]=u[0]/u[3];C[1]=u[1]/u[3];C[2]=u[2]/u[3];C[0]=(.5*C[0]+.5)*r[2]+r[0];C[1]=(.5*C[1]+.5)*r[3]+r[1]};a.rayBoxTest=function(y,D,z,r){let C,A=(z[0]-y[0])/D[0],x=(r[0]-y[0])/D[0];A>x&&(C=A,A=x,x=C);let m=(z[1]-y[1])/D[1],B=(r[1]-y[1])/D[1];m>B&&(C=m,m=B,B=C);if(A>B||m>x)return!1;m>A&&(A=m);B<x&&(x=B);z=(z[2]-y[2])/D[2];y=(r[2]-y[2])/D[2];z>y&&(C=z,z=y,y=C);if(A>y||z>x)return!1;y<x&&(x=y);return 0>x?!1:!0};a.rayRay2D=function(y,D,z,r,C,A=f.create()){const x=(r[C]-z[C])*(D[0]-y[0])-(r[0]-
z[0])*(D[C]-y[C]);if(0===x)return!1;z=((r[0]-z[0])*(y[C]-z[C])-(r[C]-z[C])*(y[0]-z[0]))/x;A[0]=y[0]+z*(D[0]-y[0]);A[1]=y[C]+z*(D[C]-y[C]);return!0};a.rayTriangle3D=function(y,D,z,r,C,A,x,m,B=b.create()){var E=r[x]-z[A];const F=r[x+1]-z[A+1],G=r[x+2]-z[A+2];r=C[m]-z[A];x=C[m+1]-z[A+1];C=C[m+2]-z[A+2];const I=D[1]*C-x*D[2],K=D[2]*r-C*D[0],J=D[0]*x-r*D[1];m=E*I+F*K+G*J;if(-1E-5<m&&1E-5>m)return!1;m=1/m;const L=y[0]-z[A],P=y[1]-z[A+1];y=y[2]-z[A+2];B[1]=m*(L*I+P*K+y*J);if(0>B[1]||1<B[1])return!1;z=P*
G-F*y;y=y*E-G*L;E=L*F-E*P;B[2]=m*(D[0]*z+D[1]*y+D[2]*E);if(0>B[2]||1<B[1]+B[2])return!1;B[0]=m*(r*z+x*y+C*E);return!0};a.rgb2hex=function(y){const D=g.clamp(Math.round(255*y[0]),0,255),z=g.clamp(Math.round(255*y[1]),0,255);y=g.clamp(Math.round(255*y[2]),0,255);return"0x"+((D<<16)+(z<<8)+y).toString(16)};a.setMatrixTranslation=h;a.setMatrixTranslation3=function(y,D,z,r){y[12]=D;y[13]=z;y[14]=r};a.unpackFloatRGBA=n;a.verify=function(y,D){y||console.warn("Verify failed: "+(D||"")+"\n"+Error("verify").stack)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../chunks/triangle"],function(a,g,b,p){let f=(()=>{const q=new Uint32Array(131072);for(let u=0;u<q.length;++u)q[u]=u;return q})();const k=new Uint16Array([0]),c=(()=>{const q=new Uint16Array(65536);for(let u=0;u<q.length;++u)q[u]=u;return q})(),d=g.create(),e=g.create(),h=g.create(),n=g.create();a.computeAttachmentOriginLines=
function(q,u,v,t){if(!q)return!1;const {size:l,data:w}=q;b.set(t,0,0,0);b.set(n,0,0,0);let y=q=0;const D=u?u.length-1:w.length/l-1;v=D+(v?2:0);for(let C=0;C<v;C+=2){var z=C<D?C:D,r=C<D?C+1:0;z=(u?u[z]:z)*l;r=(u?u[r]:r)*l;d[0]=w[z+0];d[1]=w[z+1];d[2]=w[z+2];e[0]=w[r+0];e[1]=w[r+1];e[2]=w[r+2];b.scale(d,b.add(d,d,e),.5);r=b.dist(d,e);0<r?(b.add(t,t,b.scale(d,d,r)),q+=r):(b.add(n,n,d),y++)}return 0!==q?(b.scale(t,t,1/q),!0):0!==y?(b.scale(t,n,1/y),!0):!1};a.computeAttachmentOriginPoints=function(q,u,
v){if(!q||!u)return!1;const {size:t,data:l}=q;b.set(v,0,0,0);q=-1;let w=0;for(let y=0;y<u.length;y++){const D=u[y]*t;q!==D&&(v[0]+=l[D+0],v[1]+=l[D+1],v[2]+=l[D+2],w++);q=D}1<w&&b.scale(v,v,1/w);return 0<w};a.computeAttachmentOriginTriangles=function(q,u,v){if(!q)return!1;const {size:t,data:l}=q;b.set(v,0,0,0);b.set(n,0,0,0);let w=q=0;for(let D=0;D<u.length-2;D+=3){var y=u[D+0]*t;const z=u[D+1]*t,r=u[D+2]*t;b.set(d,l[y+0],l[y+1],l[y+2]);b.set(e,l[z+0],l[z+1],l[z+2]);b.set(h,l[r+0],l[r+1],l[r+2]);
(y=p.areaPoints3d(d,e,h))?(b.add(d,d,e),b.add(d,d,h),b.scale(d,d,1/3*y),b.add(v,v,d),q+=y):(b.add(n,n,d),b.add(n,n,e),b.add(n,n,h),w+=3)}return 0===w&&0===q?!1:0!==q?(b.scale(v,v,1/q),!0):0!==w?(b.scale(v,n,1/w),!0):!1};a.generateDefaultIndexArray=function(q){if(1===q)return k;if(q<c.length)return new Uint16Array(c.buffer,0,q);if(q>f.length){f=new Uint32Array(Math.max(2*f.length,q));for(let u=0;u<f.length;u++)f[u]=u}return new Uint32Array(f.buffer,0,q)};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./Util ./BoundingInfo ./ContentObject ./geometryDataUtils".split(" "),function(a,g,b,p,f,k,c){function d(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const h of e)if(65536<=h)return e;return new Uint16Array(e)}k=function(e){function h(q,u=[],v=0,t=-1){var l=e.call(this)||this;l._primitiveType=v;l.edgeIndicesLength=t;l.type=2;l._vertexAttributes=
new Map;l._indices=new Map;l._boundingInfo=null;for(const [w,y]of q)y&&l._vertexAttributes.set(w,{...y});if(null==u||0===u.length){q=l._vertexAttributes.values().next().value;q=null==q?0:q.data.length/q.size;u=c.generateDefaultIndexArray(q);l.edgeIndicesLength=0>l.edgeIndicesLength?q:l.edgeIndicesLength;for(const w of l._vertexAttributes.keys())l._indices.set(w,u)}else for(const [w,y]of u)y&&(l._indices.set(w,d(y)),"position"===w&&(l.edgeIndicesLength=0>l.edgeIndicesLength?l._indices.get(w).length:
l.edgeIndicesLength));return l}g._inheritsLoose(h,e);var n=h.prototype;n.getMutableAttribute=function(q){(q=this._vertexAttributes.get(q))&&!q.exclusive&&(q.data=Array.from(q.data),q.exclusive=!0);return q};n.computeAttachmentOrigin=function(q){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(q):this.computeAttachmentOriginPoints(q)};n.computeAttachmentOriginTriangles=function(q){const u=this.indices.get("position"),v=this.vertexAttributes.get("position");return c.computeAttachmentOriginTriangles(v,
u,q)};n.computeAttachmentOriginPoints=function(q){const u=this.indices.get("position"),v=this.vertexAttributes.get("position");return c.computeAttachmentOriginPoints(v,u,q)};n.invalidateBoundingInfo=function(){this._boundingInfo=null};n._calculateBoundingInfo=function(){const q=this.indices.get("position");if(0===q.length)return null;const u=0===this.primitiveType?3:1;p.assert(0===q.length%u,"Indexing error: "+q.length+" not divisible by "+u);const v=c.generateDefaultIndexArray(q.length/u),t=this.vertexAttributes.get("position");
return new f.BoundingInfo(v,u,q,t)};g._createClass(h,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const q=this._indices.values().next().value;return q?q.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){b.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());
return this._boundingInfo}}]);return h}(k.ContentObject);a.Geometry=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3f64","../../../../chunks/vec3","./Util"],function(a,g,b,p,f){let k=function(){function d(h,n,q,u){this.primitiveIndices=h;this._numIndexPerPrimitive=n;this.indices=q;this.position=u;this.center=b.create();f.assert(1<=h.length);f.assert(0===q.length%
this._numIndexPerPrimitive);f.assert(q.length>=h.length*this._numIndexPerPrimitive);f.assert(3===u.size||4===u.size);const {data:v,size:t}=u;u=h.length;n=t*q[this._numIndexPerPrimitive*h[0]];c.clear();c.push(n);this.bbMin=b.fromValues(v[n],v[n+1],v[n+2]);this.bbMax=b.clone(this.bbMin);for(var l=0;l<u;++l){var w=this._numIndexPerPrimitive*h[l];for(var y=0;y<this._numIndexPerPrimitive;++y){n=t*q[w+y];c.push(n);let D=v[n];this.bbMin[0]=Math.min(D,this.bbMin[0]);this.bbMax[0]=Math.max(D,this.bbMax[0]);
D=v[n+1];this.bbMin[1]=Math.min(D,this.bbMin[1]);this.bbMax[1]=Math.max(D,this.bbMax[1]);D=v[n+2];this.bbMin[2]=Math.min(D,this.bbMin[2]);this.bbMax[2]=Math.max(D,this.bbMax[2])}}p.lerp(this.center,this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);h=this.radius*this.radius;for(q=0;q<c.length;++q)n=c.getItemAt(q),u=v[n]-this.center[0],l=v[n+1]-this.center[1],n=v[n+2]-this.center[2],w=u*u+l*l+n*n,w<=h||(w=
Math.sqrt(w),y=.5*(w-this.radius),this.radius+=y,h=this.radius*this.radius,w=y/w,this.center[0]+=u*w,this.center[1]+=l*w,this.center[2]+=n*w);c.clear()}var e=d.prototype;e.getCenter=function(){return this.center};e.getBSRadius=function(){return this.radius};e.getBBMin=function(){return this.bbMin};e.getBBMax=function(){return this.bbMax};e.getChildren=function(){if(this._children)return this._children;if(1<p.squaredDistance(this.bbMin,this.bbMax)){var h=p.lerp(b.create(),this.bbMin,this.bbMax,.5),
n=this.primitiveIndices.length;const t=new Uint8Array(n),l=Array(8);for(var q=0;8>q;++q)l[q]=0;const {data:w,size:y}=this.position;for(q=0;q<n;++q){var u=0;const D=this._numIndexPerPrimitive*this.primitiveIndices[q];var v=y*this.indices[D];let z=w[v],r=w[v+1],C=w[v+2];for(let A=1;A<this._numIndexPerPrimitive;++A){v=y*this.indices[D+A];const x=w[v],m=w[v+1];v=w[v+2];x<z&&(z=x);m<r&&(r=m);v<C&&(C=v)}z<h[0]&&(u|=1);r<h[1]&&(u|=2);C<h[2]&&(u|=4);t[q]=u;++l[u]}h=0;for(q=0;8>q;++q)0<l[q]&&++h;if(2>h)return;
h=Array(8);for(q=0;8>q;++q)h[q]=0<l[q]?new Uint32Array(l[q]):void 0;for(q=0;8>q;++q)l[q]=0;for(q=0;q<n;++q)u=t[q],h[u][l[u]++]=this.primitiveIndices[q];this._children=Array(8);for(n=0;8>n;++n)void 0!==h[n]&&(this._children[n]=new d(h[n],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};d.prune=function(){c.prune()};return d}();const c=new g({deallocator:null});a.BoundingInfo=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports",
"../../../../core/uid"],function(a,g){let b=function(){function p(){this.id=g.generateUID()}p.prototype.unload=function(){};return p}();a.ContentObject=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/typedArrayUtil","./checkWebGLError"],function(a,g,b){return function(){function p(k,c,d,e,h){this._context=k;this.bufferType=c;this.usage=d;this._glName=null;this._size=-1;this._indexType=void 0;
k.instanceCounter.increment(1,this);this._glName=this._context.gl.createBuffer();b.checkWebGLError(this._context.gl);e&&this.setData(e,h)}p.createIndex=function(k,c,d,e){return new p(k,34963,c,d,e)};p.createVertex=function(k,c,d){return new p(k,34962,c,d)};var f=p.prototype;f.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(1,this),this._context=null)};f.setData=function(k,c){if(k){if("number"===
typeof k){if(0>k&&console.error("Buffer size cannot be negative!"),34963===this.bufferType&&c)switch(this._indexType=c,this._size=k,c){case 5123:k*=2;break;case 5125:k*=4}}else c=k.byteLength,g.isUint16Array(k)&&(c/=2,this._indexType=5123),g.isUint32Array(k)&&(c/=4,this._indexType=5125),this._size=c;c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this.bufferType,k,this.usage);this._context.bindVAO(c)}};f.setSubData=function(k,c=
0,d=0,e=k.byteLength){if(k){(0>c||c>=this._size)&&console.error("offset is out of range!");var h=c,n=d,q=e,u=k.byteLength;g.isUint16Array(k)&&(u/=2,h*=2,n*=2,q*=2);g.isUint32Array(k)&&(u/=4,h*=4,n*=4,q*=4);void 0===e&&(e=u-1);d>=e&&console.error("end must be bigger than start!");c+d-e>this._size&&console.error("An attempt to write beyond the end of the buffer!");c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);d=this._context.gl;e=ArrayBuffer.isView(k)?k.buffer:
k;k=0===n&&q===k.byteLength?e:e.slice(n,q);d.bufferSubData(this.bufferType,h,k);this._context.bindVAO(c)}};a._createClass(p,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]);return p}()})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/has",
"../../core/Logger","../../core/Error"],function(a,g,b,p){b.getLogger("esri/views/webgl");a.checkWebGLError=function(f){};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Texture":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/mathUtils","./capabilities/isWebGL2Context"],function(a,g,b,p){return function(){function f(c,d,e=null){this._glName=this._context=null;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;c.instanceCounter.increment(0,
this);this._context=c;this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...d};this.setData(e)}var k=f.prototype;k.dispose=function(){if(this._context&&this._context.gl){if(this._glName){const c=this._context.gl;this._context.unbindTextureAllUnits(this);c.deleteTexture(this._glName);this._glName=null}this._context.instanceCounter.decrement(0,this);this._context=null}};k.release=function(){this.dispose()};k.resize=
function(c,d){const e=this._descriptor;if(e.width!==c||e.height!==d)e.width=c,e.height=d,this.setData(null)};k.setData=function(c){if(this._context&&this._context.gl){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===c&&(c=null);null===c&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var h=this._descriptor;f._validateTexture(this._context,h);
d.pixelStorei(d.UNPACK_ALIGNMENT,h.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,h.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.preMultiplyAlpha?1:0);var n=h.pixelFormat,q=h.internalFormat?h.internalFormat:n;if(c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement){var u=c.width,v=c.height;c instanceof HTMLVideoElement&&(u=c.videoWidth,v=c.videoHeight);h.width&&h.height&&console.assert(u===h.width&&v===h.height);
d.texImage2D(d.TEXTURE_2D,0,q,n,h.dataType,c);h.hasMipmap&&this.generateMipmap();void 0===h.width&&(h.width=u);void 0===h.height&&(h.height=v)}else{null!=h.width&&null!=h.height||console.error("Width and height must be specified!");d.DEPTH24_STENCIL8&&q===d.DEPTH_STENCIL&&(q=d.DEPTH24_STENCIL8);u=h.width;v=h.height;var t=c;if(g.isSome(t)&&"type"in t&&"compressed"===t.type)for(n=Math.round(Math.log(Math.max(u,v))/Math.LN2)+1,h.hasMipmap=h.hasMipmap&&n===c.levels.length,n=0;;++n){d.compressedTexImage2D(d.TEXTURE_2D,
n,q,u,v,0,c.levels[Math.min(n,c.levels.length-1)]);if(1===u&&1===v||!h.hasMipmap)break;u=Math.max(1,u>>1);v=Math.max(1,v>>1)}else if(g.isSome(c))d.texImage2D(d.TEXTURE_2D,0,q,u,v,0,n,h.dataType,c),h.hasMipmap&&this.generateMipmap();else for(c=0;;++c){d.texImage2D(d.TEXTURE_2D,c,q,u,v,0,n,h.dataType,null);if(1===u&&1===v||!h.hasMipmap)break;u=Math.max(1,u>>1);v=Math.max(1,v>>1)}}f._applySamplingMode(d,this._descriptor);f._applyWrapMode(d,this._descriptor);f._applyAnisotropicFilteringParameters(this._context,
this._descriptor);e&&this._context.bindTexture(e,0)}};k.updateData=function(c,d,e,h,n,q){q||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const u=this._context.gl,v=this._descriptor,t=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>e||h>v.width||n>v.height||d+h>v.width||e+n>v.height)&&console.error("An attempt to update out of bounds of the texture!");u.pixelStorei(u.UNPACK_ALIGNMENT,v.unpackAlignment);
u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,v.flipped?1:0);u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,v.preMultiplyAlpha?1:0);q instanceof ImageData||q instanceof HTMLImageElement||q instanceof HTMLCanvasElement||q instanceof HTMLVideoElement?u.texSubImage2D(u.TEXTURE_2D,c,d,e,v.pixelFormat,v.dataType,q):u.texSubImage2D(u.TEXTURE_2D,c,d,e,h,n,v.pixelFormat,v.dataType,q);this._context.bindTexture(t,0)};k.generateMipmap=function(){var c=this._descriptor;c.hasMipmap||(this._samplingModeDirty=c.hasMipmap=
!0,f._validateTexture(this._context,c));9729===c.samplingMode?(this._samplingModeDirty=!0,c.samplingMode=9985):9728===c.samplingMode&&(this._samplingModeDirty=!0,c.samplingMode=9984);c=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(c,0)};k.setSamplingMode=function(c){c!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=c,f._validateTexture(this._context,this._descriptor),this._samplingModeDirty=
!0)};k.setWrapMode=function(c){c!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=c,f._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};k.applyChanges=function(){const c=this._context.gl,d=this._descriptor;this._samplingModeDirty&&(f._applySamplingMode(c,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(f._applyWrapMode(c,d),this._wrapModeDirty=!1)};f._validateTexture=function(c,d){(0>d.width||0>d.height)&&console.error("Negative dimension parameters are not allowed!");
const e=b.isPowerOfTwo(d.width)&&b.isPowerOfTwo(d.height);p(c.gl)||e||("number"===typeof d.wrapMode?33071!==d.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(33071!==d.wrapMode.s||33071!==d.wrapMode.t)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),d.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};f._applySamplingMode=function(c,d){let e=d.samplingMode,h=d.samplingMode;if(9985===e||9987===e)e=
9729,d.hasMipmap||(h=9729);else if(9984===e||9986===e)e=9728,d.hasMipmap||(h=9728);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,h)};f._applyWrapMode=function(c,d){"number"===typeof d.wrapMode?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d.wrapMode),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d.wrapMode)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d.wrapMode.s),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d.wrapMode.t))};f._applyAnisotropicFilteringParameters=
function(c,d){if(null!=d.maxAnisotropy){var e=c.capabilities.textureFilterAnisotropic;e&&(c=c.gl,c.texParameterf(c.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};a._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]);return f}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/Util":function(){define(["exports",
"../../core/has","../../core/maybe"],function(a,g,b){function p(d){return d[0].stride}function f(d){switch(d){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function k(d){switch(d){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;
case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function c(d){if(b.isNone(d))return 0;if("colorAttachment"in d)return d.glName?c(d.colorAttachment)+c(d.depthStencilAttachment):0;if("descriptor"in d)return d.glName?c(d.descriptor):0;const e=d.internalFormat||"pixelFormat"in d&&d.pixelFormat;if(!e)return 0;
const h="hasMipmap"in d&&d.hasMipmap?1.3:1;d=d.width*d.height;return k(e)*d*h}a.addDescriptor=function(d,e,h,n,q,u){const v=f(n);if(0<d.length){const t=d[0].stride,l=t+v*h;d.forEach(w=>w.stride=l);d.push({name:e,count:h,type:n,offset:t,stride:l,normalized:q,divisor:u})}else d.push({name:e,count:h,type:n,offset:0,stride:v*h,normalized:q,divisor:u})};a.bindVertexBufferLayout=function(d,e,h,n,q){const u=d.gl,v=d.capabilities.instancing;d.bindBuffer(h);for(const t of n)if(d=e[t.name],h=(q?q:0+t.baseInstance?
t.baseInstance:0)*t.stride,void 0===d&&console.error(`There is no location for vertex attribute '${t.name}' defined.`),t.baseInstance&&!t.divisor&&console.error(`Vertex attribute '${t.name}' uses baseInstanceOffset without divisor.`),4>=t.count)u.vertexAttribPointer(d,t.count,t.type,t.normalized,t.stride,t.offset+h),u.enableVertexAttribArray(d),t.divisor&&0<t.divisor&&v&&v.vertexAttribDivisor(d,t.divisor);else if(9===t.count)for(n=0;3>n;n++)u.vertexAttribPointer(d+n,3,t.type,t.normalized,t.stride,
t.offset+12*n+h),u.enableVertexAttribArray(d+n),t.divisor&&0<t.divisor&&v&&v.vertexAttribDivisor(d+n,t.divisor);else if(16===t.count)for(n=0;4>n;n++)u.vertexAttribPointer(d+n,4,t.type,t.normalized,t.stride,t.offset+16*n+h),u.enableVertexAttribArray(d+n),t.divisor&&0<t.divisor&&v&&v.vertexAttribDivisor(d+n,t.divisor);else console.error("Unsupported vertex attribute element count: "+t.count)};a.copyFramebufferToTexture=function(d,e,h,n,q=0){const u=d.getBoundFramebufferObject(),v=d.getBoundTexture(0);
d.bindFramebuffer(e);d.bindTexture(h,0);d.gl.copyTexImage2D(d.gl.TEXTURE_2D,q,h.descriptor.pixelFormat,n[0],n[1],n[2],n[3],0);d.gl.flush();d.bindFramebuffer(u);d.bindTexture(v,0)};a.findAttribute=function(d,e){for(let h=0;h<d.length;h++)if(d[h].name===e)return d[h];return null};a.getBytesPerElement=f;a.getBytesPerElementFormat=k;a.getGpuMemoryUsage=c;a.getStride=p;a.getTypedArrayConstructor=function(d){switch(d){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;
case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw Error("Unknown data type");}};a.hasAttribute=function(d,e){for(let h=0;h<d.length;h++)if(d[h].name===e)return!0;return!1};a.setBaseInstanceOffset=function(d,e){const h={};for(const n in d)h[n]=d[n].map(q=>q.divisor?{...q,baseInstance:e}:q);return h};a.unbindVertexBufferLayout=function(d,e,h,n){const q=d.gl,u=d.capabilities.instancing;d.bindBuffer(h);for(const v of n)if(h=
e[v.name],4>=v.count)q.disableVertexAttribArray(h),v.divisor&&0<v.divisor&&u&&u.vertexAttribDivisor(h,0);else if(9===v.count)for(n=0;3>n;n++)q.disableVertexAttribArray(h+n),v.divisor&&0<v.divisor&&u&&u.vertexAttribDivisor(h+n,0);else if(16===v.count)for(n=0;4>n;n++)q.disableVertexAttribArray(h+n),v.divisor&&0<v.divisor&&u&&u.vertexAttribDivisor(h+n,0);else console.error("Unsupported vertex attribute element count: "+v.count);d.unbindBuffer(34962)};a.vertexCount=function(d,e){return d.vertexBuffers[e].size/
p(d.layout[e])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/VertexArrayObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./Util"],function(a,g,b){return function(){function p(k,c,d,e,h){this._context=k;this._locations=c;this._layout=d;this._buffers=e;this._indexBuffer=h;this._glName=null;this._initialized=!1;k.instanceCounter.increment(2,this)}var f=p.prototype;f.dispose=function(k=!0){if(this._context){var c=this._context.capabilities.vao;
c&&this._glName&&(c.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(k){for(const d in this._buffers)this._buffers[d].dispose(),delete this._buffers[d];this._indexBuffer=g.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(2,this);this._context=null}};f.initialize=function(){if(!this._initialized){var k=this._context.capabilities.vao;if(k){const c=k.createVertexArray();k.bindVertexArray(c);this._bindLayout();
k.bindVertexArray(null);this._glName=c}this._initialized=!0}};f.bind=function(){this.initialize();const k=this._context.capabilities.vao;k?k.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};f._bindLayout=function(){const k=this._buffers,c=!!this._context.capabilities.vao,d=this._layout,e=this._indexBuffer;k||console.error("Vertex buffer dictionary is empty!");const h=this._context.gl;for(const n in k){const q=k[n];q||console.error("Vertex buffer is uninitialized!");const u=
d[n];u||console.error("Vertex element descriptor is empty!");b.bindVertexBufferLayout(this._context,this._locations,q,u)}e&&(c?h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))};f.unbind=function(){this.initialize();const k=this._context.capabilities.vao;k?k.bindVertexArray(null):this._unbindLayout()};f._unbindLayout=function(){const k=this._buffers,c=this._layout;k||console.error("Vertex buffer dictionary is empty!");for(const d in k){const e=k[d];e||console.error("Vertex buffer is uninitialized!");
b.unbindVertexBufferLayout(this._context,this._locations,e,c[d])}this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)};a._createClass(p,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((k,c)=>k+this._buffers[c].size,this._indexBuffer?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},
{key:"locations",get:function(){return this._locations}}]);return p}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("exports ../../../geometry/support/Ellipsoid ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../../webgl/BufferObject ../../webgl/VertexArrayObject ./atmosphereUtils ./RealisticAtmosphereTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){let z=function(){function E(G){this._view=G;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:e.create(),cameraPosition:b.create(),projectionInverse:d.create(),viewInverse:d.create(),heightParameters:h.create(),atmosphereParameters1:h.create(),atmosphereParameters2:h.create(),atmosphereParameters3:b.create(),invWavelength:A,invWavelengthScaled:x,radii:e.create(),scale:0,scaleDepth:.25,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,
oneOverScaleDepth:0,scaleDepthBlue:.05,oneOverScaleDepthBlue:20,scaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,miePhaseCoefficients:m,nearFar:e.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._lowerBoundEarthRadius=g.earth.radius;this._updateRadius(g.earth.radius);this._atmosphereTechniqueConfig=new D.RealisticAtmosphereTechniqueConfiguration}var F=E.prototype;F.destroy=function(){this._handles&&(this._handles.destroy(),
this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};F.when=function(){return Promise.resolve()};F.initializeRenderContext=function(G){const I=G.renderContext.rctx;this._handles=new f;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(k.on(this._view,"basemapTerrain","elevation-change",K=>this._updateElevation(K),()=>
this._updateElevation()));this._handles.add(k.on(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds(),()=>this._updateVisibleElevationBounds()));this._atmosphereTechniqueConfig.haze=!1;this._atmosphereTechnique=G.shaderTechniqueRep.acquireAndReleaseExisting(D.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.haze=!0;this._atmosphereHazeTechnique=G.shaderTechniqueRep.acquireAndReleaseExisting(D.RealisticAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique);this._vao=this._createVertexArrayObject(I)};F.uninitializeRenderContext=function(){this.destroy()};F.render=function(G){if(G.slot!==this._hazeSlot&&G.slot!==this._skyslot||0!==G.pass)return!1;this._update(G.camera);G.slot===this._skyslot&&this._renderSky(G);G.slot===this._hazeSlot&&this._renderHaze(G);return!0};F._renderSky=function(G){const I=G.rctx,K=this._atmosphereTechnique.program;I.bindProgram(K);this._atmosphereTechnique.bindPipelineState(I);
K.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(K,G)};F._renderHaze=function(G){const I=G.rctx,K=G.offscreenRenderingHelper,J=this._atmosphereHazeTechnique.program;I.bindProgram(J);this._atmosphereHazeTechnique.bindPipelineState(I);K.renderDepthDetached(()=>{I.bindTexture(K.depthTexture,0);J.setUniform1i("depthTex",0);this._renderCommon(J,G)})};F._renderCommon=function(G,I){const K=I.rctx;G.setUniform3fv("invWavelength",this._renderData.invWavelength);
G.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);I.scenelightingData.setLightDirectionUniform(G);G.setUniform4fv("heightParameters",this._renderData.heightParameters);G.setUniform3fv("cameraPosition",this._renderData.cameraPosition);G.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse);G.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);G.setUniform2fv("nearFar",this._renderData.nearFar);G.setUniform2fv("radii",this._renderData.radii);
G.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);G.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);G.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);G.setUniform1f("altitudeFade",this._renderData.altitudeFade);K.bindVAO(this._vao);G.assertCompatibleVertexAttributeLocations(this._vao);K.drawArrays(5,0,4)};F._createVertexArrayObject=function(G){const I=B.createBuffer(4);I.position.setVec(0,[-1,-1]);I.position.setVec(1,
[1,-1]);I.position.setVec(2,[-1,1]);I.position.setVec(3,[1,1]);I.uv0.setVec(0,[0,0]);I.uv0.setVec(1,[1,0]);I.uv0.setVec(2,[0,1]);I.uv0.setVec(3,[1,1]);return new w(G,u.Default3D,{geometry:v.glLayout(B)},{geometry:l.createVertex(G,35044,I.buffer)})};F._adjustRadiusForTesselation=function(G){return G*Math.cos(Math.PI/16/16)};F._updateElevation=function(G){G=G?G.tile:this._view.basemapTerrain.rootTiles[0];0===G.lij[0]&&(G=this._adjustRadiusForTesselation(g.earth.radius+G.elevationBounds[0]),G!==this._lowerElevationBoundRadius&&
(this._lowerElevationBoundRadius=G,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};F._updateVisibleElevationBounds=function(){const G=this._adjustRadiusForTesselation(g.earth.radius+this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||G<this._lowerBoundEarthRadius)&&this._updateRadius(G)};F._updateRadius=function(G){this._lowerBoundEarthRadius=G;var I=G/10*10.25;const K=1/(I-G),J=K/.25,L=K/.05,P=.3*(I-G)+G,Q=this._renderData;q.set(Q.atmosphereParameters1,
K,.25,J,4);q.set(Q.atmosphereParameters2,-.99999,.05,L,20);p.set(Q.atmosphereParameters3,-.99999*-.99999,m,P);n.set(Q.radii,G,I);Q.scale=K;Q.lowerAlphaBlendBound=P;Q.scaleOverScaleDepth=J;Q.scaleOverScaleDepthBlue=L;I=y.INNER_ATMOSPHERE_DEPTH;Q.innerFadeDistance=2*Math.sqrt((2*G-I)*I)};F._update=function(G){G&&(this._renderData.cameraHeight=p.length(G.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-
this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=h.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),p.copy(this._renderData.cameraPosition,G.eye),c.invert(this._renderData.projectionInverse,G.projectionMatrix),c.invert(this._renderData.viewInverse,G.viewMatrix),n.set(this._renderData.nearFar,
G.near,G.far),this._renderData.altitudeFade=y.computeInnerAltitudeFade(this._renderData.cameraHeight-this._lowerBoundEarthRadius))};E.isSupported=function(G){return G.renderContext.rctx.capabilities.depthTexture};return E}();const r=.02*Math.PI,C=.004*Math.PI,A=b.fromValues(1/.65**4,1/.57**4,1/.475**4),x=b.clone(A);p.scale(x,x,r);p.add(x,x,b.fromValues(C,C,C));const m=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5,B=t.newLayout().vec2f("position").vec2f("uv0");a.RealisticAtmosphere=z;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports"],function(a){a.INNER_ATMOSPHERE_DEPTH=1E4;a.computeInnerAltitudeFade=function(g){return Math.min(1,Math.max(0,(g-1E5)/9E5))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/RealisticAtmosphere.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build({haze:this.configuration.haze});return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.initializePipeline=function(){return this.configuration.haze?h.makePipelineState({blending:h.separateBlendingParams(1,0,769,1),colorWrite:h.defaultColorWriteParams}):h.makePipelineState({blending:h.separateBlendingParams(770,
1,771,771),depthTest:{func:515},colorWrite:h.defaultColorWriteParams})};return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.RealisticAtmosphereShader,()=>new Promise(function(q,u){a(["./RealisticAtmosphere.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.haze=!1;return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter()],f.prototype,"haze",void 0);g.RealisticAtmosphereTechnique=k;g.RealisticAtmosphereTechniqueConfiguration=
f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/RealisticAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl"],function(a,g,b,p){function f(c){const d=new b.ShaderBuilder;d.attributes.add("position","vec2");d.attributes.add("uv0","vec2");d.varyings.add("worldRay","vec3");d.varyings.add("vtc","vec2");
c.haze&&d.varyings.add("eyeDir","vec3");d.vertex.uniforms.add("projectionInverse","mat4");d.vertex.uniforms.add("viewInverse","mat4");d.vertex.code.add(g.glsl`
    void main(void) {
      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;

      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
      vtc = uv0;

      ${c.haze?g.glsl`eyeDir = posViewNear;`:""}

      gl_Position = vec4(position, 1, 1);
    }
  `);d.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");c.haze?d.fragment.uniforms.add("depthTex","sampler2D"):d.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");d.fragment.include(p.ColorConversion);
d.fragment.code.add(g.glsl`
  // Atmosphere
  const float krESun = 0.075;        // Kr * ESun = 0.005 * 15.0
  const float kmESun = 0.015;        // Km * ESun = 0.005 * 15

  // The inner (planetary) radius
  #define innerRadius radii[0]
  // The outer (atmosphere) radius
  #define outerRadius radii[1]

  // Atmosphere parameters:

  // shellScale:               1.0 / (outerRadius - innerRadius)
  #define shellScale atmosphereParameters1.x

  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)
  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)
  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)

  // scaleOverScaleDepth:      scale / shellDepth
  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue
  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)

  // oneOverScaleDepth:        1.0 / shellDepth
  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue
  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)
  `);c.haze||d.fragment.code.add(g.glsl`
      #define g atmosphereParameters2.x
      #define gSq atmosphereParameters3.x
      #define miePhaseCoefficients atmosphereParameters3.y
      #define lowerAlphaBlendBound atmosphereParameters3.z
    `);d.fragment.code.add(g.glsl`
  // The camera's current height
  #define cameraHeight heightParameters[0]
  // cameraHeight^2
  #define cameraHeightSq heightParameters[1]
  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2
  #define C heightParameters[2]
  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2
  #define CSur heightParameters[3]

  ${c.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "}
    // Loop constants for integral approximation
    const float samples = 5.0;
    const int maxSamples = 5;

    // ToneMapping operators
    vec3 expTM(vec3 inputColor,float _exposure) {
        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);
    }

    // Approximation for inner integral based on a radii ratio of 10.25:10
    float scale(float _cos) {
      float x = 1.0 - _cos;
      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));
    }

    void main() {
      // Obtain ray from Camera
      vec3 worldSpaceRay = normalize(worldRay);

      // Compute Atmosphere intersection; i.e. ray/sphere intersection
      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))
      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C

      // idealized sphere intersection to discard early some pixels
      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C

      // the minimal sample start position:
      // at the camera by default, on the earth radius surface if the camera is underground.
      float minRayStart = 0.0;
  `);c.haze||d.fragment.code.add(g.glsl`
      float surfaceBlend = 0.0;
      vec4 surfaceColor = vec4(0.0);
      if (detSur >= 0.0) {
        float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));
        float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));

        if (nearSurface == 0.0) {
          minRayStart = farSurface;
        }

        // Compute lighting at the point where the ray enters the earth surface
        // Lighting computation is copied from the terrain shader.
        vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;
        float lightAngle = dot(-lightingMainDirection, normalize(vPos));
        float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));

        // Make the surface transparent based on altitude
        surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);

        // Fade based on the distance the ray travels below the earth surface
        float relDist = (farSurface - nearSurface) / innerFadeDistance;

        // early exit
        if (relDist > 1.0) {
          gl_FragColor = surfaceColor;
          return;
        }

        surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);
      }
    `);d.fragment.code.add(g.glsl`
    if (det >= 0.0) {
    ${c.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
""}
    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere
    ${c.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere"}

    float scatterDistance; // calculate its scattering offset
    // Calculate the ray's starting position
    if (rayStart < minRayStart)
    { // ray starts from camera or inner radius sphere to far
      rayStart = minRayStart;
      ${c.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);"}
    }
    ${c.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"}
    // Initialize the scattering loop variables
    vec3 start = cameraPosition + worldSpaceRay * rayStart;
  `);c.haze&&d.fragment.code.add(g.glsl`
      vec3 end = cameraPosition + worldSpaceRay * rayEnd;

      float endLength = length(end);
      //altitudeStart, altitudeEnd
      vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);

      // for camera positions below altitude 0, invert the altitudes, to achieve
      // a similar haze as above ground. Note that there is a small but visible change
      // when the camera passes altitude 0.
      if (altitudeInterval.x < 0.0) {
        altitudeInterval = -altitudeInterval;
      }

      // computed for the original end point to get consistent light angles after possible inversions
      float lightAngle = dot(-lightingMainDirection, end) / endLength;

      if (near > far)
      {
        if (altitudeInterval.x < altitudeInterval.y)
        {
          // Switch positive slopes for flipped rays
          end = cameraPosition + worldSpaceRay * rayStart;
          start = cameraPosition + worldSpaceRay * rayEnd;
          worldSpaceRay *= -1.0;
          float tmp = altitudeInterval.x;
          altitudeInterval.x = altitudeInterval.y;
          altitudeInterval.y = tmp;
        }
        else if (altitudeInterval.x == altitudeInterval.y)
        { // create minuscule fake slope for integration if the slope is zero
          altitudeInterval.x += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get
          // slope for the camera function
        }
      }

      // Calculate its scattering offset
      // Assumes camera constrains of WSV 3.8
      if (altitudeInterval.x > outerRadius - innerRadius)
      { // outside atmosphere
        scatterDistance = innerRadius - outerRadius;
      } else
      {
        scatterDistance = altitudeInterval.y - altitudeInterval.x;
      }
    `);d.fragment.code.add(g.glsl`
    vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);

    float rayLength = rayEnd - rayStart;
    float sampleLength = rayLength / samples;
    float scaledLength = sampleLength * shellScale;
    vec3 sampleRay = worldSpaceRay * sampleLength;
    vec3 samplePoint = start + sampleRay * 0.5;
  `);c.haze?d.fragment.code.add(g.glsl`
      float cameraAngle = dot(-worldSpaceRay, end) / length(end);
      float scaleCameraAngle = scale(cameraAngle);
      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;

      float scaledValues = scale(lightAngle) + scaleCameraAngle;
      vec2 scaledValuesDepth = scaledValues * shellDepth;
    `):d.fragment.code.add(g.glsl`
      float cameraAngle = dot(worldSpaceRay, start / length(start));
      float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;

      float scaleCameraAngle = scale(cameraAngle);
      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;
    `);d.fragment.code.add(g.glsl`
    // Loop variables
    vec3 frontColor = vec3(0.0);
    vec3 frontColorBlue = vec3(0.0);
    vec3 attenuate = vec3(0.0);
    vec3 attenuateBlue = vec3(0.0);

    // Now loop through the sample rays
    for(int i=0; i<maxSamples; i++) {
      float height = length(samplePoint);
      float altitude = abs(height - innerRadius);

      vec2 depth = exp(-altitude * scaleOverScaleDepth);
  `);c.haze?d.fragment.code.add(g.glsl`
      vec2 scatter = depth * scaledValuesDepth - cameraOffset;
    `):d.fragment.code.add(g.glsl`
      float lightAngle = dot(-lightingMainDirection, samplePoint) / height;
      float cameraAngle = dot(worldSpaceRay, samplePoint) / height;
      float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);
      vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;
    `);d.fragment.code.add(g.glsl`
      attenuate = exp(-scatter.x * invWavelengthScaled);
      attenuateBlue = exp(-scatter.y * invWavelengthScaled);

      frontColor += attenuate * depth.x;
      frontColorBlue += attenuateBlue * depth.y;

      samplePoint += sampleRay;
    }

    // Phase computation
    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun
    float LdotR = clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);
    float LdotRSq = LdotR * LdotR + 1.0;
  `);c.haze?d.fragment.code.add(g.glsl`
      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader
      vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );

      // Scaled Length is only applied afterwards to save multiplications
      vec3 color = colorCoefficients * frontColor;
      vec3 colorBlue = colorCoefficients * frontColorBlue;
    `):d.fragment.code.add(g.glsl`
      vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;
      float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);

      // Calculate the attenuation factor for the ground
      vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;
      vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;
    `);d.fragment.code.add(g.glsl`
    // HDR to LDR conversion
    vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);
    vec3 ldrRed = expTM(color, exposure);

    // mix reddish and blueish atmosphere
    vec3 LDR = mix(ldrBlue, ldrRed, 0.2);
  `);c.haze?d.fragment.code.add(g.glsl`
      LDR *= (1.0 - cameraAngle);
      vec3 hsv = rgb2hsv(LDR);
      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%
      LDR = hsv2rgb(hsv);
      vec3 finalColor = LDR;
      // when rendering we specify the blend functions such that
      // newDestColor = oldDestColor*(1.0-finalColor) + finalColor
    `):d.fragment.code.add(g.glsl`
      // reinhard tonemapper for looking upwards
      vec3 ldrReinhard = reinhardTM(color, exposure);
      LDR += angleMultiplier * ldrReinhard;

      // height dependent parameter to smooth out reddish atmosphere
      float side = (rayEnd + rayStart) * 0.5;
      float atmoHeight = sqrt(cameraHeightSq - side * side);
      float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);

      vec3 finalColor = LDR * h2;
      vec3 hsv = rgb2hsv(finalColor);
      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%
      finalColor = hsv2rgb(hsv);
    `);d.fragment.code.add(g.glsl`
    ${c.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"}
      } else { // Outside Atmosphere
        gl_FragColor = vec4(0.0);
      }
    }
  `);return d}var k=Object.freeze({__proto__:null,build:f});a.RealisticAtmosphereShader=k;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.ColorConversion=function(b){b.code.add(g.glsl`
    vec4 premultiplyAlpha(vec4 v) {
      return vec4(v.rgb * v.a, v.a);
    }

    // Note: the min in the last line has been added to fix an instability in chrome.
    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911
    // With proper floating point handling, the value could never be >1.
    vec3 rgb2hsv(vec3 c) {
      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);

      float d = q.x - min(q.w, q.y);
      float e = 1.0e-10;
      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
    }

    vec3 hsv2rgb(vec3 c) {
      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }

    float rgb2v(vec3 c) {
      return max(c.x, max(c.y, c.z));
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../geometry/projectionEllipsoid ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f64 ../../../chunks/vec2 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ./atmosphereUtils ./resources/MarsAtmosphereTexture ../webgl-engine/lib/glUtil3D".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(aa,S,H,R,T){const W=c.length(aa),Y=R*Math.sqrt(W*W-R*R)/W,U=T.silCircleV1,N=T.silCircleV2;c.scale(T.silCircleCenter,aa,Math.sqrt(R*R-Y*Y)/W);c.cross(U,aa,S);1>c.squaredLength(U)&&c.cross(U,aa,H);c.scale(U,U,Y/c.length(U));c.cross(N,U,aa);c.scale(N,N,Y/c.length(N));return Y}const I=g.getLogger("esri.views.3d.environment.SimpleAtmosphere"),K=-B.INNER_ATMOSPHERE_DEPTH,J=d.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],
[5E3,.51171875],[5E4,.4140625]]);g=function(){function aa(H){this.slot=14;this._renderData={texV:u.create(),silCircleCenter:k.create(),silCircleV1:k.create(),silCircleV2:k.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=b.createResolver();this._readyController=b.createAbortController();this.texV1=1;this.isOnMars=p.isMars(H.spatialReference);const R=e.getReferenceEllipsoid(H.spatialReference);this.planetRadius=R.radius;this.outerRimWidth=R.outerAtmosphereRimWidth;
this.innerRimFactor=(this.planetRadius+K)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0;this._atmosphereTechniqueConfig=new w.SimpleAtmosphereTechniqueConfiguration;this.view=H}var S=aa.prototype;S.when=function(){return this._readyResolver.promise};S.initializeRenderContext=function(H){const R=H.renderContext.rctx;this._cameraChangeHandle=
h.init(this.view,"state.camera",()=>H.requestRender(),!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=H.shaderTechniqueRep.acquireAndReleaseExisting(w.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=2;this._atmosphereUndergroundTechnique=H.shaderTechniqueRep.acquireAndReleaseExisting(w.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=
this._createRibbon(R);this._vaoCount=x.vertexCount(this._vao,"geometry");this._fadeVao=F.createQuadVAO(R);this._fadeVaoCount=x.vertexCount(this._fadeVao,"geometry");t.requestImage(this.isOnMars?E:y,{signal:this._readyController.signal}).then(T=>{this._texture=new A(R,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},T);H.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(T=>{b.isAbortError(T)||I.error("Unable to initialize simple atmosphere: image request failed",
T);this._readyResolver.reject()})};S.uninitializeRenderContext=function(){this.destroy()};S.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};S.render=function(H){if(H.slot!==
this.slot||0!==H.pass)return!1;this._update(H.camera);const R=H.rctx;this._atmosphereConeTechnique.bindPipelineState(R);if(1>this._renderData.undergroundFadeAlpha){var T=this._atmosphereConeTechnique.program;R.bindProgram(T);T.setUniformMatrix4fv("proj",H.camera.projectionMatrix);T.setUniformMatrix4fv("view",H.camera.viewMatrix);T.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);T.setUniform3fv("silCircleV1",this._renderData.silCircleV1);T.setUniform3fv("silCircleV2",this._renderData.silCircleV2);
T.setUniform2fv("texV",this._renderData.texV);R.bindTexture(this._texture,0);T.setUniform1i("tex",0);H.scenelightingData.setLightDirectionUniform(T);T.setUniform1f("altitudeFade",this._renderData.altitudeFade);T.setUniform1f("innerScale",this._renderData.innerScale);R.bindVAO(this._vao);R.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(T=this._atmosphereUndergroundTechnique.program,R.bindProgram(T),T.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),
H.scenelightingData.setLightDirectionUniform(T),T.setUniform3fv("cameraPosition",H.camera.eye),R.bindVAO(this._fadeVao),R.drawArrays(5,0,this._fadeVaoCount));return!0};S._update=function(H){var R=k.create();const T=this.planetRadius;var W=c.length(H.eye);const Y=W-T;this._renderData.undergroundFadeAlpha=0>Y?Math.min(-Y/5E3,1):0;var U=T+K,N=T+Math.max(50,Y);this._renderData.innerScale=N*N/(Math.sqrt(N*N-T*T)*Math.sqrt(N*N-U*U)+T*U)-1;this._renderData.altitudeFade=B.computeInnerAltitudeFade(Y);c.scale(R,
H.eye,(T+50)/W);G(R,H.center,H.up,T,this._renderData);R=this._computeScreenRimWidth(H,R,H.up,this._renderData);W=J(Y);U=this.texV0+.001953125*this.texVScale;N=this.texV0+R*W*this.texVScale;50<Y&&(G(H.eye,H.center,H.up,T,this._renderData),H=this._computeScreenRimWidth(H,H.eye,H.up,this._renderData),H=f.clamp((H-1.5)/(R-1.5),0,1),U=this.texV0+.001953125*H*this.texVScale,N=this.texV0+f.lerp(this.texV1,R*W,H)*this.texVScale);v.set(this._renderData.texV,U,N)};S._createRibbon=function(H){const R=new Float32Array(1155),
T=new Uint32Array(1920);R[0]=0;R[1]=0;R[2]=-1;for(var W=0;128>W;W++){var Y=9*W+3;R[Y+0]=W;R[Y+1]=this.innerRimFactor;R[Y+2]=-1;R[Y+3]=W;R[Y+4]=this.middleRimFactor;R[Y+5]=0;R[Y+6]=W;R[Y+7]=this.outerRimFactor;R[Y+8]=1;Y=3*W+1;var U=127===W?1:Y+3,N=15*W;T[N+0]=Y;T[N+1]=Y+1;T[N+2]=U+1;T[N+3]=U+1;T[N+4]=U;T[N+5]=Y;T[N+6]=Y+1;T[N+7]=Y+2;T[N+8]=U+2;T[N+9]=U+2;T[N+10]=U+1;T[N+11]=Y+1;T[N+12]=Y;T[N+13]=U;T[N+14]=0}W=X.createBuffer(T.length);Y=W.position;for(U=0;U<T.length;++U)N=3*T[U],Y.set(U,0,R[N]),Y.set(U,
1,R[N+1]),Y.set(U,2,R[N+2]);return new m(H,l.Default3D,{geometry:D.glLayout(X)},{geometry:C.createVertex(H,35044,W.buffer)})};S._computeScreenRimWidth=function(H,R,T,W){c.add(P,W.silCircleCenter,W.silCircleV2);c.scale(Q,P,this.outerRimFactor);n.lookAt(L,R,P,T);r.project(P,L,H.projectionMatrix,H.viewport);r.project(Q,L,H.projectionMatrix,H.viewport);return c.distance(P,Q)/H.height};a._createClass(aa,[{key:"canRender",get:function(){return null!=this._texture}}]);return aa}();const L=q.create(),P=k.create(),
Q=k.create(),X=z.newLayout().vec3f("position");return g})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts".split(" "),function(a,g,b,p,f,k){a.createColorTexture=function(c,d,e=4){const h=new Uint8Array(e*e*4);for(let n=0;n<h.length;n+=4)h[n+0]=255*d[0],h[n+1]=255*d[1],h[n+2]=255*d[2],h[n+3]=255*d[3];return new p(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:e},
h)};a.createEmptyDepthTexture=function(c){return new p(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(c,d=4){return new p(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d})};a.createQuadVAO=function(c,d=k.Pos2,e=g.Default3D,h=-1,n=1){let q=null;switch(d){case k.Pos2Tex:q=new Float32Array([h,h,0,0,n,h,1,0,h,n,0,1,n,n,1,1]);break;default:q=new Float32Array([h,h,n,h,h,
n,n,n])}return new f(c,e,{geometry:d},{geometry:b.createVertex(c,35044,q)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports"],function(a){a.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];a.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];a.Pos3=[{name:"position",count:3,type:5126,offset:0,
stride:12,normalized:!1}];a.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];a.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];a.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,
offset:12,stride:20,normalized:!1}];Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../assets ../../../chunks/mat4 ../../support/WatchUpdatingTracking ../../../chunks/mat4f64 ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../../webgl/BufferObject ../../webgl/VertexArrayObject ./StarsTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){const E=k.getLogger("esri.views.3d.environment.Stars");a.Stars=function(L){function P(X){X=L.call(this,X)||this;X.slot=14;X._loadDataTask=null;X._resources=null;X._modelMatrix=z.create();X._updatingTracking=new D.WatchUpdatingTracking;X._requestRender=()=>{};return X}g._inheritsLoose(P,L);var Q=P.prototype;Q.initialize=function(){this._loadDataTask=this._createLoadDataTask()};Q.destroy=function(){f.isSome(this._loadDataTask)&&(this._loadDataTask.abort(),
this._loadDataTask=null);this._updatingTracking.destroy();f.isSome(this._resources)&&(this._resources.vao.dispose(),this._resources.technique.dispose(),this._resources=null);this._requestRender=null};Q.initializeRenderContext=function(X){this._requestRender=X.requestRender};Q.uninitializeRenderContext=function(){this.destroy()};Q.render=function(X){if(X.slot!==this.slot||0!==X.pass)return!1;this._ensureResources(X);if(f.isNone(this._resources))return!0;const {technique:aa,vao:S,num:H}=this._resources,
R=X.rctx,T=aa.program;R.bindProgram(T);aa.bindPass(R,{camera:X.camera,modelMatrix:this._modelMatrix});aa.bindPipelineState(R);R.bindVAO(S);T.assertCompatibleVertexAttributeLocations(S);R.drawArrays(0,0,H);return!0};Q._ensureResources=function(X){if(!f.isSome(this._resources)&&!f.isNone(J)){var aa=new B.StarsTechnique({rctx:X.rctx,viewingMode:this.view.state.mode},null),S=J.byteLength/9,H=new Float32Array(J,0,2*S),R=new Uint8Array(J,8*S,S);this._resources={vao:this._createVertexArrayObject(X.rctx,
H,R,S),technique:aa,num:S};this._updatingTracking.add(this.view,"environment.lighting.date",T=>this._update(T),2)}};Q._computeDayDuration=function(X){const aa=new Date(X.getFullYear(),0,1,11,58,56),S=new Date(X.getFullYear()+1,0,1,11,58,55);return(+X-+aa)/(+S-+aa)};Q._update=function(X){if(X){var aa=X.getHours()/12,S=X.getMinutes()/60*(2/24),H=X.getSeconds()/60*(2/1440);aa=(aa+S+H-.9972222)%2;X=2*this._computeDayDuration(X);S=this._modelMatrix;y.copy(S,I);y.rotateZ(S,S,-X*Math.PI);y.multiply(S,G,
S);y.rotateZ(S,S,-aa*Math.PI);this._requestRender()}};Q._hexToRGB=function(X){return[parseInt(X.substring(0,2),16),parseInt(X.substring(2,4),16),parseInt(X.substring(4,6),16)]};Q._unpackUint8Attributes=function(X){return 192<=X?[2.9,X-192]:160<=X?[2.5,X-160]:128<=X?[2,X-128]:96<=X?[1.5,X-96]:64<=X?[1,X-64]:32<=X?[.7,X-32]:[.4,X]};Q._createVertexArrayObject=function(X,aa,S,H){const R=K.createBuffer(H),T=R.position,W=R.color,Y=R.size;for(let ca=0;ca<H;ca++){var U=aa[2*ca],N=aa[2*ca+1];T.set(ca,0,-Math.cos(U)*
Math.sin(N));T.set(ca,1,-Math.sin(U)*Math.sin(N));T.set(ca,2,-Math.cos(N));U=this._unpackUint8Attributes(S[ca]);N=this._hexToRGB(F[U[1]]);W.set(ca,0,255*N[0]);W.set(ca,1,255*N[1]);W.set(ca,2,255*N[2]);W.set(ca,3,255);Y.set(ca,U[0])}return new m(X,r.Default3D,{geometry:C.glLayout(K)},{geometry:x.createVertex(X,35044,R.buffer)})};Q._createLoadDataTask=function(){if(f.isSome(J))return null;const X=t.createTask(async aa=>{({data:aa}=await w.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",
signal:aa}));this._verifyStarData(aa);J=aa});X.promise.catch(aa=>{t.isAbortError(aa)||E.error(aa)}).then(()=>{this.destroyed||(this._requestRender(),this.notifyChange("updating"))});return X};Q._verifyStarData=function(X){if(!X)throw new n("stars:no-data-received","Failed to create stars because star catalogue is missing");X=X.byteLength/9;if(0!==X%1||5E4<X||5E3>X)throw new n("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};g._createClass(P,[{key:"updating",
get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return f.isSome(this._loadDataTask)&&!this._loadDataTask.finished}},{key:"canRender",get:function(){return!this.loading}}]);return P}(l);b.__decorate([d.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([d.property()],a.Stars.prototype,"_loadDataTask",void 0);b.__decorate([d.property()],a.Stars.prototype,
"_updatingTracking",void 0);a.Stars=b.__decorate([h.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=z.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),I=z.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,
.9174771405229186,0,0,0,0,1),K=A.newLayout().vec3f("position").vec4u8("color").f32("size");let J=null;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/Stars.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){c=function(u){function v(){return u.apply(this,arguments)||this}b._inheritsLoose(v,u);var t=v.prototype;t.initializeProgram=function(l){const w=v.shader.get().build();return new e(l.rctx,w.generateSource("vertex"),w.generateSource("fragment"),d.Default3D)};t.initializePipeline=function(){return h.makePipelineState({blending:h.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:h.defaultColorWriteParams})};t.bindPass=function(l,{camera:w,modelMatrix:y}){l=
this.makeInfiniteProjectionMatrix(w.projectionMatrix,w.near,q);p.multiply(l,l,w.viewMatrix);p.multiply(l,l,y);this.program.setUniformMatrix4fv("transform",l);this.program.setUniform4fv("viewport",w.fullViewport);this.program.setUniform1f("pixelRatio",w.pixelRatio)};t.makeInfiniteProjectionMatrix=function(l,w,y){p.copy(y,l);y[10]=2.4E-7-1;y[11]=-1;y[14]=(2.4E-7-2)*w;return y};return v}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(n.StarsShader,()=>new Promise(function(u,v){a(["./Stars.glsl"],
u,v)}));const q=f.create();g.StarsTechnique=c;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl"],function(a,g,b,p){function f(){const c=new b.ShaderBuilder;c.attributes.add("position","vec3");c.attributes.add("color","vec4");c.attributes.add("size","float");c.varyings.add("vcolor",
"vec4");c.varyings.add("vsize","float");c.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");c.include(p.AlignPixel);c.vertex.code.add(g.glsl`
    void main(void) {
      vec4 posProj = transform * vec4(position, 0);
      gl_Position = alignToPixelCenter(posProj, viewport.zw);
      vcolor = color / 1.2;
      vsize = size * 5.0 * pixelRatio;
      gl_PointSize = vsize;
    }
  `);c.fragment.code.add(g.glsl`
    void main() {
      float cap = 0.7;
      float scale = 1.0 / cap;
      float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
      float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
      float intensity = alpha * alpha * alpha;
      if (vsize < 3.0) {
        intensity *= 0.5;
      }
      gl_FragColor = vec4(vcolor.xyz, intensity);
    }
  `);return c}var k=Object.freeze({__proto__:null,build:f});a.StarsShader=k;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.AlignPixel=function(b){const p=g.glsl`
    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `,f=g.glsl`

    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `;b.vertex.code.add(p);b.vertex.code.add(f);b.fragment.code.add(p);b.fragment.code.add(f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../geometry/Point","../../../core/mathUtils","../../../geometry/projectionEllipsoid"],function(a,g,b,p){function f(d,e,h){return k(d,e.longitude,e.latitude,h.longitude,h.latitude)}function k(d,e,h,n,q){h=b.deg2rad(h);q=b.deg2rad(q);e=b.deg2rad(e);const u=b.deg2rad(n);n=Math.sin((h-q)/
2);e=Math.sin((e-u)/2);h=2*b.asinClamped(Math.sqrt(n*n+Math.cos(h)*Math.cos(q)*e*e));return Math.round(h*d*1E4)/1E4}function c(d,e){d/=15;e||(d=Math.round(d));return d}a.getGreatCircleDistance=k;a.getGreatCircleDistanceFromPoints=f;a.getGreatCircleSpanAt=function(d,e,h){const n=e.spatialReference,q=p.getReferenceEllipsoid(n),u=new g(e.x,d.y,n),v=new g(h.x,d.y,n);e=new g(d.x,e.y,n);d=new g(d.x,h.y,n);return{lon:f(q.radius,u,v),lat:f(q.radius,e,d)}};a.getLatDeltaForDistance=function(d,e){return b.rad2deg(d/
e)};a.getLonDeltaForDistance=function(d,e,h){e/=h;d=b.deg2rad(d);e=Math.sin(e/2);d=Math.cos(d);d=2*b.asinClamped(Math.sqrt(e*e/(d*d)));return b.rad2deg(d)};a.getMaxCameraAltitude=function(d,e){d=b.deg2rad(d/2);return(1-Math.sin(d))*e/Math.sin(d)};a.longitudeToTimezone=c;a.positionToTimezone=function(d,e){e||(e={hours:0,minutes:0,seconds:0});e.hours=c(d[0],!0);d=e.hours%1;e.hours-=d;e.minutes=60*d;d=e.minutes%1;e.minutes-=d;e.seconds=Math.round(60*d);return e};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/SunCalc".split(" "),function(a,g,b,p,f,k,c){function d(u,v,t,l){const w=[];for(let y=0;y<t.length;y++)w[y]=(l[y]-t[y])*u/v+t[y];return w}const e={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,
diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},h=k.create(),n={azimuth:0,altitude:0},q={ambient:{color:b.create(),intensity:0},diffuse:{color:b.create(),intensity:0,direction:b.create()},globalFactor:0,noonFactor:0};a.computeColorAndIntensity=function(u,v){var t=v[2];p.set(q.ambient.color,1,1,1);q.ambient.intensity=e.global.ambient;p.set(q.diffuse.color,1,1,1);q.diffuse.intensity=e.global.diffuse;t=(Math.abs(t)-e.local.altitude)/
(e.global.altitude-e.local.altitude);t=g.clamp(t,0,1);q.globalFactor=t;v=c.SunCalc.getTimes(u,v[1],v[0]);if(1>t){{var l=u.valueOf();if(v.polarException===c.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var w=l-36E5*(u.getHours()+48)-6E4*u.getMinutes();var y=w+432E6}else v.polarException===c.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(w=l-2,y=l-1):(w=v.sunrise.valueOf(),y=v.sunset.valueOf());var D=y-w;var z=w+D/2;var r=D/4;var C=z-r;r=z+r;var A=.06*D;D=w-A/2;w+=A/2;const x=y-A/2,m=y+A/2;y=e.local;const B=[.01,y.ambientAtNight],
E=[.8,.8,1],F=[.01,.01,.01],G=[y.diffuseAtTwilight,y.ambientAtTwilight],I=[1,.75,.75],K=[.8,.8,1],J=[.9*y.diffuseAtNoon,y.ambientAtNoon],L=[1,.98,.98],P=[.98,.98,1],Q=[y.diffuseAtNoon,y.ambientAtNoon],X=[1,1,1],aa=[1,1,1];y=[0,0];let S=[0,0,0];A=[0,0,0];l<D||l>m?(y=B,S=F,A=E):l<w?(A=w-D,y=d(l-D,A,B,G),S=d(l-D,A,F,I),A=d(l-D,A,E,K)):l<C?(A=C-w,y=d(l-w,A,G,J),S=d(l-w,A,I,L),A=d(l-w,A,K,P)):l<z?(A=z-C,y=d(l-C,A,J,Q),S=d(l-C,A,L,X),A=d(l-C,A,P,aa)):l<r?(A=r-z,y=d(l-z,A,Q,J),S=d(l-z,A,X,L),A=d(l-z,A,aa,
P)):l<x?(A=x-r,y=d(l-r,A,J,G),S=d(l-r,A,L,I),A=d(l-r,A,P,K)):l<m&&(A=m-x,y=d(l-x,A,G,B),S=d(l-x,A,I,F),A=d(l-x,A,K,E));l=y[0];z=b.fromValues(S[0],S[1],S[2]);C=y[1];r=b.fromValues(A[0],A[1],A[2])}p.lerp(q.ambient.color,r,q.ambient.color,t);q.ambient.intensity=g.lerp(C,q.ambient.intensity,t);p.lerp(q.diffuse.color,z,q.diffuse.color,t);q.diffuse.intensity=g.lerp(l,q.diffuse.intensity,t)}t=u.valueOf();v.polarException===c.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(u=t-36E5*(u.getHours()+48)-6E4*u.getMinutes(),
v=u+432E6):v.polarException===c.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(u=t-2,v=t-1):(u=v.sunrise.valueOf(),v=v.sunset.valueOf());u=1-g.clamp(Math.abs(t-(u+(v-u)/2))/432E5,0,1);q.noonFactor=u;return q};a.computeDirection=function(u,v,t,l){l||(l=b.create());const w=f.identity(h);if("global"===t)c.SunCalc.getPosition(u,0,0,n),p.set(l,0,0,-1),f.rotateX(w,w,-n.azimuth),f.rotateY(w,w,-n.altitude);else{var y=e.planarDirection;t=y.globalAngles;y=(Math.abs(v[2])-y.localAltitude)/(y.globalAltitude-y.localAltitude);
y=g.clamp(y,0,1);1>y?(c.SunCalc.getPosition(u,v[1],v[0],n),n.azimuth=(1-y)*n.azimuth+y*t.azimuth,n.altitude=(1-y)*n.altitude+y*t.altitude):(n.azimuth=t.azimuth,n.altitude=t.altitude);p.set(l,0,-1,0);f.rotateZ(w,w,-n.azimuth);f.rotateX(w,w,-n.altitude)}p.transformMat4(l,l,w);return l};a.computeShadowsEnabled=function(u,v){return"global"===v?!0:Math.abs(u[2])<e.planarDirection.localAltitude};a.settings=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports",
"./_commonjsHelpers"],function(a,g){g=g.createCommonjsModule(function(b){(function(p){p=p();void 0!==p&&(b.exports=p)})(function(){function p(m){return new Date(864E5*(m+.5-2440588))}function f(m,B){return y(v(m)*t(C)-l(B)*v(C),t(m))}function k(m,B){return w(v(B)*t(C)+t(B)*v(C)*v(m))}function c(m,B,E){return y(v(m),t(m)*v(B)-l(E)*t(B))}function d(m,B,E){return w(v(B)*v(E)+t(B)*t(E)*t(m))}function e(m){return z*(1.9148*v(m)+.02*v(2*m)+3E-4*v(3*m))}function h(m,B){m=z*(357.5291+.98560028*m);var E=e(m);
m=m+E+102.9372*z+u;B||(B={dec:0,ra:0});B.dec=k(m,0);B.ra=f(m,0);return B}function n(m,B,E){return 2451545+m+.0053*v(B)-.0069*v(2*E)}function q(m){var B=z*(134.963+13.064993*m),E=z*(93.272+13.22935*m);m=z*(218.316+13.176396*m)+6.289*z*v(B);E=5.128*z*v(E);B=385001-20905*t(B);return{ra:f(m,E),dec:k(m,E),dist:B}}var u=Math.PI,v=Math.sin,t=Math.cos,l=Math.tan,w=Math.asin,y=Math.atan2,D=Math.acos,z=u/180,r={dec:0,ra:0},C=23.4397*z,A={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(m,
B,E,F){E=z*-E;B*=z;var G=m.valueOf()/864E5-.5+2440588-2451545;m=h(G,r);E=z*(280.16+360.9856235*G)-E-m.ra;F||(F={azimuth:0,altitude:0});F.azimuth=c(E,B,m.dec);F.altitude=d(E,B,m.dec);return F}},x=[[-.83,"sunrise","sunset"]];A.addTime=function(m,B,E){x.push([m,B,E])};A.getTimes=function(m,B,E){function F(H){var R=I,T=P;H=D((v(H)-v(R)*v(T))/(t(R)*t(T)));return n(9E-4+(H+G)/(2*u)+K,J,L)}var G=z*-E,I=z*B,K=Math.round(m.valueOf()/864E5-.5+2440588-2451545-9E-4-G/(2*u));m=9E-4+(0+G)/(2*u)+K;var J=z*(357.5291+
.98560028*m);B=e(J);var L=J+B+102.9372*z+u,P=k(L,0);m=n(m,J,L);B={solarNoon:p(m),nadir:p(m-.5),polarException:A.POLAR_EXCEPTION.NORMAL};var Q;E=0;for(Q=x.length;E<Q;E+=1){var X=x[E];var aa=F(X[0]*z);var S=m-(aa-m);B[X[1]]=p(S);B[X[2]]=p(aa)}B.polarException=function(H){H=(v(H)-v(I)*v(P))/(t(I)*t(P));return-1>H?A.POLAR_EXCEPTION.MIDNIGHT_SUN:1<H?A.POLAR_EXCEPTION.POLAR_NIGHT:A.POLAR_EXCEPTION.NORMAL}(x[0][0]*z);return B};A.getMoonPosition=function(m,B,E){E=z*-E;B*=z;var F=m.valueOf()/864E5-.5+2440588-
2451545;m=q(F);E=z*(280.16+360.9856235*F)-E-m.ra;F=d(E,B,m.dec);F+=.017*z/l(F+10.26*z/(F+5.1*z));return{azimuth:c(E,B,m.dec),altitude:F,distance:m.dist}};A.getMoonFraction=function(m){var B=m.valueOf()/864E5-.5+2440588-2451545;m=h(B);B=q(B);m=D(v(m.dec)*v(B.dec)+t(m.dec)*t(B.dec)*t(m.ra-B.ra));m=y(149598E3*v(m),B.dist-149598E3*t(m));return(1+t(m))/2};return A})});a.SunCalc=g})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,
g){a.AmbientLight=function(b=g.create()){this.intensity=b};a.FillLight=function(b=g.create(),p=g.fromValues(.57735,.57735,.57735)){this.intensity=g.create();this.direction=g.create();this.intensity=b;this.direction=p};a.MainLight=function(b=g.create(),p=g.fromValues(.57735,.57735,.57735),f=!0){this.intensity=b;this.direction=p;this.castShadows=f};a.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/quatf64 ../../../../chunks/vec4f64 ../../../../chunks/mat3 ../../../../chunks/vec4 ../../../../chunks/quat ../../../../chunks/vec3f32 ../../../../chunks/sphere ../../../../chunks/boundedPlane ../../support/geometryUtils ./Object3D".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){function D(X,aa){return b.isNone(X)||null==X.layerUid?null:b.isSome(aa.graphicsView)&&X.layerUid===aa.graphicsView.graphics3d.layer.id?aa.graphics:aa.map.findLayerByUid(X.layerUid)}function z(X,aa){if(b.isNone(X))return null;const S=D(X,aa);return b.isNone(S)?null:S===aa.graphics?b.isSome(aa.graphicsView)?b.unwrap(aa.graphicsView.getGraphicFromGraphicUid(X.graphicUid)):null:(aa=aa.allLayerViews.find(H=>H.layer===S))?r(aa,X):null}function r(X,aa){return!X||
X.suspended?null:"getGraphicFromIntersectorMetadata"in X&&aa?X.getGraphicFromIntersectorMetadata(aa):"getGraphicFromGraphicUid"in X&&null!=aa.graphicUid?X.getGraphicFromGraphicUid(aa.graphicUid):null}let C=function(){function X(){this._transform=d.create();this._transformInverse=new A({value:this._transform},k.invert,d.create);this._transformInverseTranspose=new A(this._transformInverse,k.transpose,d.create);this._transformTranspose=new A({value:this._transform},k.transpose,d.create);this._transformInverseRotation=
new A({value:this._transform},n.normalFromMat4Legacy,c.create)}var aa=X.prototype;aa.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};aa.setTransformMatrix=function(S){k.copy(this._transform,S)};aa.multiplyTransform=function(S){k.multiply(this._transform,this._transform,S)};aa.set=function(S){k.copy(this._transform,S);this.invalidateLazyTransforms()};
aa.setAndInvalidateLazyTransforms=function(S,H){this.setTransformMatrix(S);this.multiplyTransform(H);this.invalidateLazyTransforms()};g._createClass(X,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);
return X}(),A=function(){function X(aa,S,H){this.original=aa;this.update=S;this.dirty=!0;this.transform=H()}X.prototype.invalidate=function(){this.dirty=!0};g._createClass(X,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return X}(),x=function(){function X(){this.min=new m;this.max=new m;this.hud=new m;this.ground=new m}X.prototype.init=function(aa){this.min.init(aa);this.max.init(aa);this.hud.init(aa);this.ground.init(aa);
this.all=[]};return X}(),m=function(){function X(S){this.normal=p.create();this.transformation=d.create();this._ray=w.ray.create();this.init(S)}var aa=X.prototype;aa.getIntersectionPoint=function(S){if(!this.hasIntersectionPoint)return!1;f.scale(L,this.ray.direction,this.dist);f.add(S,this.ray.origin,L);return!0};aa.getTransformedNormal=function(S){f.copy(P,this.normal);P[3]=0;q.transformMat4(P,P,this.transformation);f.copy(S,P);f.normalize(S,S);return S};aa.init=function(S){this.drapedLayerGraphicOrder=
this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";S?w.ray.copy(S,this._ray):this._ray=w.ray.create()};aa.set=function(S,H,R,T,W,Y,U,N,ca,O){S instanceof y.Object3D&&(S={type:"stage",obj:S});this.dist=R;f.copy(this.normal,T);k.copy(this.transformation,W);this.target=S;this.name=H;this.drapedLayerOrder=Y;this.center=U?p.clone(U):null;this.geometryId=N;this.triangleNr=ca;this.drapedLayerGraphicOrder=O};aa.copyFrom=function(S){w.ray.copy(S._ray,
this._ray);this.dist=S.dist;this.target=S.target;this.name=S.name;this.drapedLayerOrder=S.drapedLayerOrder;this.center=S.center?p.clone(S.center):null;this.geometryId=S.geometryId;this.triangleNr=S.triangleNr;this.intersector=S.intersector;this.drapedLayerGraphicOrder=S.drapedLayerGraphicOrder;f.copy(this.normal,S.normal);k.copy(this.transformation,S.transformation)};aa.toOwner=function(S){if(!this.target)return null;switch(this.target.type){case "stage":return D(this.target.obj.metadata,S);case "external":switch(this.intersector){case "PointRenderer":{const H=
this.target.metadata.layerUid;S=null!=H?S.map.findLayerByUid(H):null}return S;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return D(this.target.metadata,S);case "TerrainRenderer":return S.map&&S.map.ground}}return null};aa.toGraphic=function(S){if(!this.target)return null;switch(this.target.type){case "stage":return z(this.target.obj.metadata,S);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return z(this.target.metadata,
S)}}return null};g._createClass(X,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return f.scale(L,this.ray.direction,this.dist),f.length(L)}}]);return X}(),B=function(){function X(S=0){this.offset=S;this.tmpVertex=p.create()}var aa=X.prototype;aa.applyToVertex=function(S,H,R){const T=S+this.localOrigin[0],W=H+this.localOrigin[1],Y=R+this.localOrigin[2],U=this.offset/Math.sqrt(T*
T+W*W+Y*Y);this.tmpVertex[0]=S+T*U;this.tmpVertex[1]=H+W*U;this.tmpVertex[2]=R+Y*U;return this.tmpVertex};aa.applyToAabb=function(S){var H=S[0]+this.localOrigin[0];const R=S[1]+this.localOrigin[1],T=S[2]+this.localOrigin[2],W=S[3]+this.localOrigin[0],Y=S[4]+this.localOrigin[1],U=S[5]+this.localOrigin[2],N=this.offset/Math.sqrt(H*H+R*R+T*T);S[0]+=H*N;S[1]+=R*N;S[2]+=T*N;H=this.offset/Math.sqrt(W*W+Y*Y+U*U);S[3]+=W*H;S[4]+=Y*H;S[5]+=U*H;return S};return X}(),E=function(){function X(S=0){this.offset=
S;this.componentLocalOriginLength=0;this.tmpVertex=p.create();this.mbs=h.create();this.obb={center:p.create(),halfSize:v.create(),quaternion:null}}var aa=X.prototype;aa.applyToVertex=function(S,H,R){const T=R+this.componentLocalOriginLength,W=this.offset/Math.sqrt(S*S+H*H+T*T);this.tmpVertex[0]=S+S*W;this.tmpVertex[1]=H+H*W;this.tmpVertex[2]=R+T*W;return this.tmpVertex};aa.applyToAabb=function(S){var H=S[0];const R=S[1],T=S[2]+this.componentLocalOriginLength,W=S[3],Y=S[4],U=S[5]+this.componentLocalOriginLength,
N=this.offset/Math.sqrt(H*H+R*R+T*T);S[0]+=H*N;S[1]+=R*N;S[2]+=T*N;H=this.offset/Math.sqrt(W*W+Y*Y+U*U);S[3]+=W*H;S[4]+=Y*H;S[5]+=U*H;return S};aa.applyToMbs=function(S){const H=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]),R=this.offset/H;this.mbs[0]=S[0]+S[0]*R;this.mbs[1]=S[1]+S[1]*R;this.mbs[2]=S[2]+S[2]*R;this.mbs[3]=S[3]+S[3]*this.offset/H;return this.mbs};aa.applyToObb=function(S){var H=S.center;const R=this.offset/Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]);this.obb.center[0]=H[0]+H[0]*R;this.obb.center[1]=
H[1]+H[1]*R;this.obb.center[2]=H[2]+H[2]*R;f.transformQuat(this.obb.halfSize,S.halfSize,S.quaternion);f.add(this.obb.halfSize,this.obb.halfSize,S.center);H=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*H;this.obb.halfSize[1]+=this.obb.halfSize[1]*H;this.obb.halfSize[2]+=this.obb.halfSize[2]*H;f.subtract(this.obb.halfSize,this.obb.halfSize,S.center);u.conjugate(Q,
S.quaternion);f.transformQuat(this.obb.halfSize,this.obb.halfSize,Q);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=S.quaternion;return this.obb};g._createClass(X,[{key:"localOrigin",set:function(S){this.componentLocalOriginLength=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])}}]);return X}(),F=function(){function X(S=0){this.offset=S;this.sphere=t.create();this.tmpVertex=p.create()}
var aa=X.prototype;aa.applyToVertex=function(S,H,R){const T=this.objectTransform.transform;let W=T[0]*S+T[4]*H+T[8]*R+T[12],Y=T[1]*S+T[5]*H+T[9]*R+T[13];S=T[2]*S+T[6]*H+T[10]*R+T[14];H=this.offset/Math.sqrt(W*W+Y*Y+S*S);W+=W*H;Y+=Y*H;S+=S*H;H=this.objectTransform.inverse;this.tmpVertex[0]=H[0]*W+H[4]*Y+H[8]*S+H[12];this.tmpVertex[1]=H[1]*W+H[5]*Y+H[9]*S+H[13];this.tmpVertex[2]=H[2]*W+H[6]*Y+H[10]*S+H[14];return this.tmpVertex};aa.applyToMinMax=function(S,H){const R=this.offset/Math.sqrt(S[0]*S[0]+
S[1]*S[1]+S[2]*S[2]);S[0]+=S[0]*R;S[1]+=S[1]*R;S[2]+=S[2]*R;S=this.offset/Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]);H[0]+=H[0]*S;H[1]+=H[1]*S;H[2]+=H[2]*S};aa.applyToAabb=function(S){var H=this.offset/Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]);S[0]+=S[0]*H;S[1]+=S[1]*H;S[2]+=S[2]*H;H=this.offset/Math.sqrt(S[3]*S[3]+S[4]*S[4]+S[5]*S[5]);S[3]+=S[3]*H;S[4]+=S[4]*H;S[5]+=S[5]*H;return S};aa.applyToBoundingSphere=function(S){const H=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]),R=this.offset/H;this.sphere[0]=
S[0]+S[0]*R;this.sphere[1]=S[1]+S[1]*R;this.sphere[2]=S[2]+S[2]*R;this.sphere[3]=S[3]+S[3]*this.offset/H;return this.sphere};return X}();const G=new F,I=new E,K=new B,J=p.create(),L=p.create(),P=h.create(),Q=e.create();a.I3SVerticalOffsetGlobalViewingMode=E;a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2};a.IntersectorResult=m;a.IntersectorResults=
x;a.IntersectorTransform=C;a.Object3DVerticalOffsetGlobalViewingMode=F;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=B;a.getVerticalOffsetI3S=function(X){return b.isSome(X)?(I.offset=X,I):null};a.getVerticalOffsetObject3D=function(X){return b.isSome(X)?(G.offset=X,G):null};a.getVerticalOffsetTerrain=function(X){return b.isSome(X)?(K.offset=X,K):null};a.sliceFilterPredicate=function(X){return(aa,S,H)=>{f.lerp(J,aa,S,H);return!l.extrusionContainsPoint(X,J)}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,g){function b(L,P){L[0]=P[0];L[1]=P[1];L[2]=P[2];L[3]=P[4];L[4]=P[5];L[5]=P[6];L[6]=P[8];L[7]=P[9];L[8]=P[10];return L}function p(L,P){L[0]=P[0];L[1]=P[1];L[2]=P[2];L[3]=P[3];L[4]=P[4];L[5]=P[5];L[6]=P[6];L[7]=P[7];L[8]=P[8];return L}function f(L,P,Q,X,aa,S,H,R,T,W){L[0]=P;L[1]=Q;L[2]=X;L[3]=aa;L[4]=S;L[5]=H;L[6]=R;L[7]=T;L[8]=W;return L}function k(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=0;L[6]=0;
L[7]=0;L[8]=1;return L}function c(L,P){if(L===P){const Q=P[1],X=P[2],aa=P[5];L[1]=P[3];L[2]=P[6];L[3]=Q;L[5]=P[7];L[6]=X;L[7]=aa}else L[0]=P[0],L[1]=P[3],L[2]=P[6],L[3]=P[1],L[4]=P[4],L[5]=P[7],L[6]=P[2],L[7]=P[5],L[8]=P[8];return L}function d(L,P){const Q=P[0],X=P[1],aa=P[2],S=P[3],H=P[4],R=P[5],T=P[6],W=P[7];P=P[8];const Y=P*H-R*W,U=-P*S+R*T,N=W*S-H*T;let ca=Q*Y+X*U+aa*N;if(!ca)return null;ca=1/ca;L[0]=Y*ca;L[1]=(-P*X+aa*W)*ca;L[2]=(R*X-aa*H)*ca;L[3]=U*ca;L[4]=(P*Q-aa*T)*ca;L[5]=(-R*Q+aa*S)*ca;
L[6]=N*ca;L[7]=(-W*Q+X*T)*ca;L[8]=(H*Q-X*S)*ca;return L}function e(L,P){const Q=P[0],X=P[1],aa=P[2],S=P[3],H=P[4],R=P[5],T=P[6],W=P[7];P=P[8];L[0]=H*P-R*W;L[1]=aa*W-X*P;L[2]=X*R-aa*H;L[3]=R*T-S*P;L[4]=Q*P-aa*T;L[5]=aa*S-Q*R;L[6]=S*W-H*T;L[7]=X*T-Q*W;L[8]=Q*H-X*S;return L}function h(L){const P=L[3],Q=L[4],X=L[5],aa=L[6],S=L[7],H=L[8];return L[0]*(H*Q-X*S)+L[1]*(-H*P+X*aa)+L[2]*(S*P-Q*aa)}function n(L,P,Q){const X=P[0],aa=P[1],S=P[2],H=P[3],R=P[4],T=P[5],W=P[6],Y=P[7];P=P[8];const U=Q[0],N=Q[1],ca=
Q[2],O=Q[3],V=Q[4],ba=Q[5],fa=Q[6],ia=Q[7];Q=Q[8];L[0]=U*X+N*H+ca*W;L[1]=U*aa+N*R+ca*Y;L[2]=U*S+N*T+ca*P;L[3]=O*X+V*H+ba*W;L[4]=O*aa+V*R+ba*Y;L[5]=O*S+V*T+ba*P;L[6]=fa*X+ia*H+Q*W;L[7]=fa*aa+ia*R+Q*Y;L[8]=fa*S+ia*T+Q*P;return L}function q(L,P,Q){const X=P[0],aa=P[1],S=P[2],H=P[3],R=P[4],T=P[5],W=P[6],Y=P[7];P=P[8];const U=Q[0];Q=Q[1];L[0]=X;L[1]=aa;L[2]=S;L[3]=H;L[4]=R;L[5]=T;L[6]=U*X+Q*H+W;L[7]=U*aa+Q*R+Y;L[8]=U*S+Q*T+P;return L}function u(L,P,Q){const X=P[0],aa=P[1],S=P[2],H=P[3],R=P[4],T=P[5],W=
P[6],Y=P[7];P=P[8];const U=Math.sin(Q);Q=Math.cos(Q);L[0]=Q*X+U*H;L[1]=Q*aa+U*R;L[2]=Q*S+U*T;L[3]=Q*H-U*X;L[4]=Q*R-U*aa;L[5]=Q*T-U*S;L[6]=W;L[7]=Y;L[8]=P;return L}function v(L,P,Q){const X=Q[0],aa=Q[1];Q=Q[2];L[0]=X*P[0];L[1]=X*P[1];L[2]=X*P[2];L[3]=aa*P[3];L[4]=aa*P[4];L[5]=aa*P[5];L[6]=Q*P[6];L[7]=Q*P[7];L[8]=Q*P[8];return L}function t(L,P,Q){const X=Q[0];Q=Q[1];L[0]=X*P[0];L[1]=X*P[1];L[2]=X*P[2];L[3]=Q*P[3];L[4]=Q*P[4];L[5]=Q*P[5];return L}function l(L,P){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=
0;L[6]=P[0];L[7]=P[1];L[8]=1;return L}function w(L,P){const Q=Math.sin(P);P=Math.cos(P);L[0]=P;L[1]=Q;L[2]=0;L[3]=-Q;L[4]=P;L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function y(L,P){L[0]=P[0];L[1]=0;L[2]=0;L[3]=0;L[4]=P[1];L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function D(L,P){L[0]=P[0];L[1]=P[1];L[2]=0;L[3]=P[2];L[4]=P[3];L[5]=0;L[6]=P[4];L[7]=P[5];L[8]=1;return L}function z(L,P){var Q=P[0],X=P[1],aa=P[2];P=P[3];var S=Q+Q,H=X+X;const R=aa+aa;Q*=S;const T=X*S;X*=H;const W=aa*S,Y=aa*H;aa*=R;S*=P;H*=P;P*=
R;L[0]=1-X-aa;L[3]=T-P;L[6]=W+H;L[1]=T+P;L[4]=1-Q-aa;L[7]=Y-S;L[2]=W-H;L[5]=Y+S;L[8]=1-Q-X;return L}function r(L,P){const Q=P[0],X=P[1],aa=P[2],S=P[4],H=P[5],R=P[6],T=P[8],W=P[9];P=P[10];const Y=P*H-R*W,U=-P*S+R*T,N=W*S-H*T;var ca=Q*Y+X*U+aa*N;if(!ca)return null;ca=1/ca;L[0]=Y*ca;L[1]=(-P*X+aa*W)*ca;L[2]=(R*X-aa*H)*ca;L[3]=U*ca;L[4]=(P*Q-aa*T)*ca;L[5]=(-R*Q+aa*S)*ca;L[6]=N*ca;L[7]=(-W*Q+X*T)*ca;L[8]=(H*Q-X*S)*ca;return L}function C(L,P){const Q=P[0],X=P[1],aa=P[2],S=P[3],H=P[4],R=P[5],T=P[6],W=P[7];
var Y=P[8],U=P[9],N=P[10],ca=P[11];const O=P[12],V=P[13],ba=P[14];P=P[15];const fa=Q*R-X*H,ia=Q*T-aa*H,ma=Q*W-S*H,ea=X*T-aa*R,M=X*W-S*R,Z=aa*W-S*T,la=Y*V-U*O,ka=Y*ba-N*O;Y=Y*P-ca*O;const ha=U*ba-N*V;U=U*P-ca*V;N=N*P-ca*ba;ca=fa*N-ia*U+ma*ha+ea*Y-M*ka+Z*la;if(!ca)return null;ca=1/ca;L[0]=(R*N-T*U+W*ha)*ca;L[1]=(T*Y-H*N-W*ka)*ca;L[2]=(H*U-R*Y+W*la)*ca;L[3]=(aa*U-X*N-S*ha)*ca;L[4]=(Q*N-aa*Y+S*ka)*ca;L[5]=(X*Y-Q*U-S*la)*ca;L[6]=(V*Z-ba*M+P*ea)*ca;L[7]=(ba*ma-O*Z-P*ia)*ca;L[8]=(O*M-V*ma+P*fa)*ca;return L}
function A(L,P,Q){L[0]=2/P;L[1]=0;L[2]=0;L[3]=0;L[4]=-2/Q;L[5]=0;L[6]=-1;L[7]=1;L[8]=1;return L}function x(L){return"mat3("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+")"}function m(L){return Math.sqrt(L[0]**2+L[1]**2+L[2]**2+L[3]**2+L[4]**2+L[5]**2+L[6]**2+L[7]**2+L[8]**2)}function B(L,P,Q){L[0]=P[0]+Q[0];L[1]=P[1]+Q[1];L[2]=P[2]+Q[2];L[3]=P[3]+Q[3];L[4]=P[4]+Q[4];L[5]=P[5]+Q[5];L[6]=P[6]+Q[6];L[7]=P[7]+Q[7];L[8]=P[8]+Q[8];return L}function E(L,P,Q){L[0]=
P[0]-Q[0];L[1]=P[1]-Q[1];L[2]=P[2]-Q[2];L[3]=P[3]-Q[3];L[4]=P[4]-Q[4];L[5]=P[5]-Q[5];L[6]=P[6]-Q[6];L[7]=P[7]-Q[7];L[8]=P[8]-Q[8];return L}function F(L,P,Q){L[0]=P[0]*Q;L[1]=P[1]*Q;L[2]=P[2]*Q;L[3]=P[3]*Q;L[4]=P[4]*Q;L[5]=P[5]*Q;L[6]=P[6]*Q;L[7]=P[7]*Q;L[8]=P[8]*Q;return L}function G(L,P,Q,X){L[0]=P[0]+Q[0]*X;L[1]=P[1]+Q[1]*X;L[2]=P[2]+Q[2]*X;L[3]=P[3]+Q[3]*X;L[4]=P[4]+Q[4]*X;L[5]=P[5]+Q[5]*X;L[6]=P[6]+Q[6]*X;L[7]=P[7]+Q[7]*X;L[8]=P[8]+Q[8]*X;return L}function I(L,P){return L[0]===P[0]&&L[1]===P[1]&&
L[2]===P[2]&&L[3]===P[3]&&L[4]===P[4]&&L[5]===P[5]&&L[6]===P[6]&&L[7]===P[7]&&L[8]===P[8]}function K(L,P){const Q=L[0],X=L[1],aa=L[2],S=L[3],H=L[4],R=L[5],T=L[6],W=L[7];L=L[8];const Y=P[0],U=P[1],N=P[2],ca=P[3],O=P[4],V=P[5],ba=P[6],fa=P[7];P=P[8];return Math.abs(Q-Y)<=g.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Y))&&Math.abs(X-U)<=g.EPSILON*Math.max(1,Math.abs(X),Math.abs(U))&&Math.abs(aa-N)<=g.EPSILON*Math.max(1,Math.abs(aa),Math.abs(N))&&Math.abs(S-ca)<=g.EPSILON*Math.max(1,Math.abs(S),Math.abs(ca))&&
Math.abs(H-O)<=g.EPSILON*Math.max(1,Math.abs(H),Math.abs(O))&&Math.abs(R-V)<=g.EPSILON*Math.max(1,Math.abs(R),Math.abs(V))&&Math.abs(T-ba)<=g.EPSILON*Math.max(1,Math.abs(T),Math.abs(ba))&&Math.abs(W-fa)<=g.EPSILON*Math.max(1,Math.abs(W),Math.abs(fa))&&Math.abs(L-P)<=g.EPSILON*Math.max(1,Math.abs(L),Math.abs(P))}var J=Object.freeze({__proto__:null,fromMat4:b,copy:p,set:f,identity:k,transpose:c,invert:d,adjoint:e,determinant:h,multiply:n,translate:q,rotate:u,scale:v,scaleByVec2:t,fromTranslation:l,
fromRotation:w,fromScaling:y,fromMat2d:D,fromQuat:z,normalFromMat4Legacy:r,normalFromMat4:C,projection:A,str:x,frob:m,add:B,subtract:E,multiplyScalar:F,multiplyScalarAndAdd:G,exactEquals:I,equals:K,mul:n,sub:E});a.add=B;a.adjoint=e;a.copy=p;a.determinant=h;a.equals=K;a.exactEquals=I;a.frob=m;a.fromMat2d=D;a.fromMat4=b;a.fromQuat=z;a.fromRotation=w;a.fromScaling=y;a.fromTranslation=l;a.identity=k;a.invert=d;a.mat3=J;a.mul=n;a.multiply=n;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=
C;a.normalFromMat4Legacy=r;a.projection=A;a.rotate=u;a.scale=v;a.scaleByVec2=t;a.set=f;a.str=x;a.sub=E;a.subtract=E;a.translate=q;a.transpose=c})},"esri/chunks/quat":function(){define("exports ./vec3f64 ./common ./vec3 ./mat3f64 ./quatf64 ./vec4".split(" "),function(a,g,b,p,f,k,c){function d(W){W[0]=0;W[1]=0;W[2]=0;W[3]=1;return W}function e(W,Y,U){U*=.5;const N=Math.sin(U);W[0]=N*Y[0];W[1]=N*Y[1];W[2]=N*Y[2];W[3]=Math.cos(U);return W}function h(W,Y){const U=2*Math.acos(Y[3]),N=Math.sin(U/2);N>b.EPSILON?
(W[0]=Y[0]/N,W[1]=Y[1]/N,W[2]=Y[2]/N):(W[0]=1,W[1]=0,W[2]=0);return U}function n(W,Y,U){const N=Y[0],ca=Y[1],O=Y[2];Y=Y[3];const V=U[0],ba=U[1],fa=U[2];U=U[3];W[0]=N*U+Y*V+ca*fa-O*ba;W[1]=ca*U+Y*ba+O*V-N*fa;W[2]=O*U+Y*fa+N*ba-ca*V;W[3]=Y*U-N*V-ca*ba-O*fa;return W}function q(W,Y,U){U*=.5;const N=Y[0],ca=Y[1],O=Y[2];Y=Y[3];const V=Math.sin(U);U=Math.cos(U);W[0]=N*U+Y*V;W[1]=ca*U+O*V;W[2]=O*U-ca*V;W[3]=Y*U-N*V;return W}function u(W,Y,U){U*=.5;const N=Y[0],ca=Y[1],O=Y[2];Y=Y[3];const V=Math.sin(U);U=
Math.cos(U);W[0]=N*U-O*V;W[1]=ca*U+Y*V;W[2]=O*U+N*V;W[3]=Y*U-ca*V;return W}function v(W,Y,U){U*=.5;const N=Y[0],ca=Y[1],O=Y[2];Y=Y[3];const V=Math.sin(U);U=Math.cos(U);W[0]=N*U+ca*V;W[1]=ca*U-N*V;W[2]=O*U+Y*V;W[3]=Y*U-O*V;return W}function t(W,Y){const U=Y[0],N=Y[1];Y=Y[2];W[0]=U;W[1]=N;W[2]=Y;W[3]=Math.sqrt(Math.abs(1-U*U-N*N-Y*Y));return W}function l(W,Y,U,N){const ca=Y[0],O=Y[1],V=Y[2];Y=Y[3];let ba=U[0],fa=U[1],ia=U[2];U=U[3];let ma;let ea;var M=ca*ba+O*fa+V*ia+Y*U;0>M&&(M=-M,ba=-ba,fa=-fa,ia=
-ia,U=-U);1-M>b.EPSILON?(ma=Math.acos(M),ea=Math.sin(ma),M=Math.sin((1-N)*ma)/ea,N=Math.sin(N*ma)/ea):M=1-N;W[0]=M*ca+N*ba;W[1]=M*O+N*fa;W[2]=M*V+N*ia;W[3]=M*Y+N*U;return W}function w(W){var Y=b.RANDOM();const U=b.RANDOM(),N=b.RANDOM(),ca=Math.sqrt(1-Y);Y=Math.sqrt(Y);W[0]=ca*Math.sin(2*Math.PI*U);W[1]=ca*Math.cos(2*Math.PI*U);W[2]=Y*Math.sin(2*Math.PI*N);W[3]=Y*Math.cos(2*Math.PI*N);return W}function y(W,Y){const U=Y[0],N=Y[1],ca=Y[2];Y=Y[3];var O=U*U+N*N+ca*ca+Y*Y;O=O?1/O:0;W[0]=-U*O;W[1]=-N*O;
W[2]=-ca*O;W[3]=Y*O;return W}function D(W,Y){W[0]=-Y[0];W[1]=-Y[1];W[2]=-Y[2];W[3]=Y[3];return W}function z(W,Y){var U=Y[0]+Y[4]+Y[8];if(0<U)U=Math.sqrt(U+1),W[3]=.5*U,U=.5/U,W[0]=(Y[5]-Y[7])*U,W[1]=(Y[6]-Y[2])*U,W[2]=(Y[1]-Y[3])*U;else{let N=0;Y[4]>Y[0]&&(N=1);Y[8]>Y[3*N+N]&&(N=2);const ca=(N+1)%3,O=(N+2)%3;U=Math.sqrt(Y[3*N+N]-Y[3*ca+ca]-Y[3*O+O]+1);W[N]=.5*U;U=.5/U;W[3]=(Y[3*ca+O]-Y[3*O+ca])*U;W[ca]=(Y[3*ca+N]+Y[3*N+ca])*U;W[O]=(Y[3*O+N]+Y[3*N+O])*U}return W}function r(W,Y,U,N){var ca=.5*Math.PI/
180;Y*=ca;U*=ca;N*=ca;ca=Math.sin(Y);Y=Math.cos(Y);const O=Math.sin(U);U=Math.cos(U);const V=Math.sin(N);N=Math.cos(N);W[0]=ca*U*N-Y*O*V;W[1]=Y*O*N+ca*U*V;W[2]=Y*U*V-ca*O*N;W[3]=Y*U*N+ca*O*V;return W}function C(W){return"quat("+W[0]+", "+W[1]+", "+W[2]+", "+W[3]+")"}function A(W,Y,U){const N=p.dot(Y,U);if(-.999999>N)return p.cross(X,aa,Y),1E-6>p.len(X)&&p.cross(X,S,Y),p.normalize(X,X),e(W,X,Math.PI),W;if(.999999<N)return W[0]=0,W[1]=0,W[2]=0,W[3]=1,W;p.cross(X,Y,U);W[0]=X[0];W[1]=X[1];W[2]=X[2];W[3]=
1+N;return P(W,W)}function x(W,Y,U,N,ca,O){l(H,Y,ca,O);l(R,U,N,O);l(W,H,R,2*O*(1-O));return W}function m(W,Y,U,N){const ca=T;ca[0]=U[0];ca[3]=U[1];ca[6]=U[2];ca[1]=N[0];ca[4]=N[1];ca[7]=N[2];ca[2]=-Y[0];ca[5]=-Y[1];ca[8]=-Y[2];return P(W,z(W,ca))}const B=c.copy,E=c.set,F=c.add,G=c.scale,I=c.dot,K=c.lerp,J=c.length,L=c.squaredLength,P=c.normalize,Q=c.exactEquals;c=c.equals;const X=g.create(),aa=g.fromValues(1,0,0),S=g.fromValues(0,1,0),H=k.create(),R=k.create(),T=f.create();g=Object.freeze({__proto__:null,
identity:d,setAxisAngle:e,getAxisAngle:h,multiply:n,rotateX:q,rotateY:u,rotateZ:v,calculateW:t,slerp:l,random:w,invert:y,conjugate:D,fromMat3:z,fromEuler:r,str:C,copy:B,set:E,add:F,mul:n,scale:G,dot:I,lerp:K,length:J,len:J,squaredLength:L,sqrLen:L,normalize:P,exactEquals:Q,equals:c,rotationTo:A,sqlerp:x,setAxes:m});a.add=F;a.calculateW=t;a.conjugate=D;a.copy=B;a.dot=I;a.equals=c;a.exactEquals=Q;a.fromEuler=r;a.fromMat3=z;a.getAxisAngle=h;a.identity=d;a.invert=y;a.len=J;a.length=J;a.lerp=K;a.mul=n;
a.multiply=n;a.normalize=P;a.quat=g;a.random=w;a.rotateX=q;a.rotateY=u;a.rotateZ=v;a.rotationTo=A;a.scale=G;a.set=E;a.setAxes=m;a.setAxisAngle=e;a.slerp=l;a.sqlerp=x;a.sqrLen=L;a.squaredLength=L;a.str=C})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/sphere ./Util ./ContentObject ./GeometryRecord ./Object3DStateID ../materials/renderers/utils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){n=function(w){function y(z={}){var r=w.call(this)||this;r.type=1;r._geometryRecords=[];r._geometries=[];r._objectTransformation=d.create();r._bvObjectSpace=new l;r._bvWorldSpace=new l;r._bvDirty=!0;r._hasVolatileTransformation=!1;r._visible=!0;r.castShadow=null!=z.castShadow?z.castShadow:!0;r.metadata=z.metadata;r.metadata&&r.metadata.isElevationSource&&(r.metadata.lastValidElevationBB=new t);r.transformation=d.create();const {geometries:C,materials:A,transformations:x,
origins:m}=z;if(!Array.isArray(C))return g._assertThisInitialized(r);h.assert(A.length===C.length,"Object3D: materials don't match geometries");h.assert(x.length===C.length,"Object3D: transformations don't match geometries");r._geometryRecords.length=C.length;r._geometries.length=C.length;for(z=0;z<C.length;z++)r._geometries[z]=C[z],r._geometryRecords[z]=q.GeometryRecord.pool.acquire(C[z],A[z],d.clone(x[z]),{highlights:null,occludees:null,visible:!0},m&&m[z]);return r}g._inheritsLoose(y,w);var D=
y.prototype;D.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};D.getNumGeometryRecords=function(){return this._geometryRecords.length};D.getGeometryRecord=function(z){h.assert(0<=z&&z<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[z]};D.addGeometry=function(z,r,C,A,x,m){C=C?C:d.IDENTITY;this._geometries.push(z);z=q.GeometryRecord.pool.acquire(z,r,C,A||{highlights:null,occludees:null,visible:!0},x,m);this._geometryRecords.push(z);
this._hasVolatileTransformation=this._hasVolatileTransformation||b.isSome(z.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:z});this._invalidateBoundingVolume();return z};D.removeGeometry=function(z){const r=this._geometryRecords.splice(z,1)[0];this._hasVolatileTransformation=b.isSome(r.shaderTransformation)?this._geometryRecords.some(C=>b.isSome(C.shaderTransformation)):this._hasVolatileTransformation;r.dispose();this._geometries.splice(z,1);this._emit("objectGeometryRemoved",
{object:this,record:r});this._invalidateBoundingVolume();return r};D.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};D.geometryVertexAttrsUpdated=function(z){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[z]});this._invalidateBoundingVolume()};D.setVisible=function(z){this._visible=z;for(const r of this._geometryRecords)r.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)};D.maskOccludee=function(){const z=
new u.Object3DStateID(1);for(const r of this._geometryRecords)r.instanceParameters.occludees=v.addObject3DStateID(r.instanceParameters.occludees,z);this._emit("occlusionChanged",this);return z};D.removeOcclude=function(z){for(const r of this._geometryRecords)r.instanceParameters.occludees=v.removeObject3DStateID(r.instanceParameters.occludees,z);this._emit("occlusionChanged",this)};D.highlight=function(){const z=new u.Object3DStateID(0);for(const r of this._geometryRecords)r.instanceParameters.highlights=
v.addObject3DStateID(r.instanceParameters.highlights,z);this._emit("highlightChanged",this);return z};D.removeHighlight=function(z){for(const r of this._geometryRecords)r.instanceParameters.highlights=v.removeObject3DStateID(r.instanceParameters.highlights,z);this._emit("highlightChanged",this)};D.getCombinedStaticTransformation=function(z,r){return c.multiply(b.unwrapOr(r,d.create()),this.transformation,z.getStaticTransformation())};D.getCombinedShaderTransformation=function(z,r){r=r||d.create();
c.multiply(r,this.transformation,z.getShaderTransformation());return r};D.hasVolativeTransformation=function(){return this._hasVolatileTransformation};D.getBBMin=function(z){this._validateBoundingVolume();return z?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};D.getBBMax=function(z){this._validateBoundingVolume();return z?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};D.getBounds=function(z){this._validateBoundingVolume();return z?this._bvObjectSpace.bounds:this._bvWorldSpace.bounds};D._validateBoundingVolume=
function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var z=0;z<this._geometryRecords.length;++z){var r=this._geometryRecords[z],C=this._geometries[z].boundingInfo;b.isSome(C)&&(this._calculateTransformedBoundingVolume(C,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(C,this._bvWorldSpace,this.getCombinedShaderTransformation(r)))}f.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,
.5);f.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);z=p.create();r=p.create();C=k.maxScale(this.transformation);for(let B=0;B<this._geometryRecords.length;++B){var A=this._geometries[B].boundingInfo;if(!b.isNone(A)){var x=this._geometryRecords[B].getShaderTransformation(),m=k.maxScale(x);f.transformMat4(z,A.getCenter(),x);x=f.distance(z,this._bvObjectSpace.bounds);A=A.getBSRadius()*m;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],x+A);f.transformMat4(r,
z,this.transformation);m=f.distance(r,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],m+A*C)}}this._bvDirty=!1}};D._calculateTransformedBoundingVolume=function(z,r,C){const A=z.getBBMin();z=z.getBBMax();const x=p.clone(A),m=p.clone(z);f.transformMat4(x,x,C);f.transformMat4(m,m,C);for(var B=0;3>B;++B)r.bbMin[B]=Math.min(r.bbMin[B],x[B],m[B]),r.bbMax[B]=Math.max(r.bbMax[B],x[B],m[B]);for(B=0;3>B;++B){f.copy(x,A);f.copy(m,z);x[B]=z[B];m[B]=A[B];f.transformMat4(x,
x,C);f.transformMat4(m,m,C);for(let E=0;3>E;++E)r.bbMin[E]=Math.min(r.bbMin[E],x[E],m[E]),r.bbMax[E]=Math.max(r.bbMax[E],x[E],m[E])}};D._invalidateBoundingVolume=function(){this._bvDirty=!0;b.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};D._emit=function(z,r){b.isSome(this._parentLayer)&&this._parentLayer.events.emit(z,r)};g._createClass(y,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},
{key:"transformation",get:function(){return this._objectTransformation},set:function(z){c.copy(this._objectTransformation,z);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(z){h.assert(null==this._parentLayer||null==z,"Object3D can only be added to a single Layer");this._parentLayer=z}},{key:"isVisible",get:function(){return this._visible}},{key:"test",get:function(){const z=this;return{hasGeometry:r=>
-1<z._geometries.indexOf(r),getGeometryIndex:r=>z._geometries.indexOf(r)}}}]);return y}(n.ContentObject);let t=function(){function w(){this.bbMin=p.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=p.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}w.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return w}(),l=function(w){function y(){var D=w.apply(this,arguments)||this;D.bounds=e.create();
return D}g._inheritsLoose(y,w);y.prototype.init=function(){f.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);f.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);e.clear(this.bounds)};return y}(t);a.Object3D=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,g,b,p,f,k){let c=function(){function d(){this._disposed=!1}var e=d.prototype;e.acquire=function(h,n,q,u,v,t){this.id=f.generateUID();this.geometry=h;this.material=n;this.transformation=q;this.instanceParameters=u;this.origin=v;this._shaderTransformation=t;this._disposed=!1};e.release=function(){this._disposed=!1};e.dispose=function(){this._disposed=!0};e.getStaticTransformation=function(){return this.transformation};e.getShaderTransformation=function(){return b.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};e.computeAttachmentOrigin=function(h){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,h):this.geometry.computeAttachmentOrigin(h))?(k.transformMat4(h,h,this.getStaticTransformation()),!0):!1};g._createClass(d,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return d}();c.pool=new p(c);a.GeometryRecord=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,g){a.Object3DStateID=function(b){this.channel=b;this.id=g.generateUID()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../lib/doublePrecisionUtils".split(" "),
function(a,g,b,p,f,k){const c=new Float64Array(3),d=new Float32Array(6),e=p.create();a.acquireMaterials=function(h,n){const q=new Map;q.set(0,n.acquire(h,0));q.set(1,n.acquire(h,7));q.set(4,n.acquire(h,3));q.set(3,n.acquire(h,2));q.set(2,n.acquire(h,1));q.set(5,n.acquire(h,4));q.set(7,n.acquire(h,3));q.set(6,n.acquire(h,3));return q};a.addObject3DStateID=function(h,n){g.isNone(h)&&(h=[]);h.push(n);return h};a.calculateTransformRelToOrigin=function(h,n,q){const u=h.origin.vec3;f.setMatrixTranslation3(e,
-u[0],-u[1],-u[2]);g.isSome(h.transformation)?b.multiply(n,e,h.transformation):b.copy(n,e);q&&(b.invert(q,n),b.transpose(q,q))};a.encodeDoubleVec3=function(h,n,q,u,v){c[0]=h.get(n,0);c[1]=h.get(n,1);c[2]=h.get(n,2);k.encodeDoubleArray(c,d,3);q.set(v,0,d[0]);u.set(v,0,d[1]);q.set(v,1,d[2]);u.set(v,1,d[3]);q.set(v,2,d[4]);u.set(v,2,d[5])};a.isInstanceHidden=function(h){return g.isSome(h)?!h.visible:!1};a.releaseMaterials=function(h,n){n.release(h,0);n.release(h,7);n.release(h,3);n.release(h,2);n.release(h,
1);n.release(h,4)};a.removeObject3DStateID=function(h,n){if(g.isNone(h))return h;h=h.filter(q=>q!==n);return 0===h.length?null:h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["exports"],function(a){function g(f,k,c){for(let d=0;d<c;++d)k[2*d]=f[d],k[2*d+1]=f[d]-k[2*d]}const b=new Float64Array(1),p=new Float32Array(2);a.decodeDoubleArray=function(f,k,c){for(let d=0;d<c;++d)k[d]=f[2*d]+f[2*d+1]};a.encodeDouble=function(f,
k){p[0]=f;p[1]=f-p[0];k[0]=p[0];k[1]=p[1]};a.encodeDoubleArray=g;a.encodeDoubleArraySplit=function(f,k,c,d){for(let e=0;e<d;++e)b[0]=f[e],g(b,p,1),k[e]=p[0],c[e]=p[1]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4f64 ../../support/geometryUtils ../materials/renderers/utils ./intersectorUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h){b=function(){function n(u){this.options=new h.IntersectorOptions;this.results=new h.IntersectorResults;this.transform=new h.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:f.create(),direction:f.create()};this._rayEndPoint=f.create();this._rayStartPointTransformed=f.create();this._rayEndPointTransformed=f.create();this.viewingMode=null==u?1:u}var q=n.prototype;q.reset=function(u,
v){this.resetWithRay(d.ray.fromPoints(u,v,this._ray))};q.resetWithRay=function(u){u!==this._ray&&d.ray.copy(u,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;k.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};q.intersect=function(u,v,t,l,w,y){this.point=v;this.camera=t;this.filterPredicate=w;this.tolerance=
null==l?1E-5:l;v=h.getVerticalOffsetObject3D(this.verticalOffset);const D=y?z=>{y(z)&&this.intersectObject(z)}:z=>{this.intersectObject(z)};if(u&&0<u.length)for(const z of u)u=z.getSpatialQueryAccelerator&&z.getSpatialQueryAccelerator(),p.isSome(u)?(p.isSome(v)?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,D,v):u.forEachAlongRay(this._ray.origin,this._ray.direction,D),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(D)):z.getObjects().forAll(r=>D(r));
this.sortResults()};q.intersectObject=function(u){this._numObjectsTested++;const v=u.geometryRecords;if(v){var t=u.id,l=u.transformation,w=h.getVerticalOffsetObject3D(this.verticalOffset);for(const D of v){const {geometry:z,material:r,instanceParameters:C}=D;if(e.isInstanceHidden(C))continue;var y=z.id;this.transform.setAndInvalidateLazyTransforms(l,D.getShaderTransformation());k.transformMat4(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse);k.transformMat4(this._rayEndPointTransformed,
this._rayEndPoint,this.transform.inverse);const A=this.transform.transform;p.isSome(w)&&(w.objectTransform=this.transform);r.intersect(z,C,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(x,m,B,E,F,G)=>{if(0<=x&&(!p.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEndPoint,x))){var I=`Object3D ${t}`;F?(null==this.results.hud.dist||x<this.results.hud.dist)&&this.results.hud.set(u,I,x,m,c.IDENTITY,E,G,y,B):((null==this.results.min.drapedLayerOrder||
E>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||x<this.results.min.dist)&&this.results.min.set(u,I,x,m,A,E,null,y,B),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||E<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||x>this.results.max.dist)&&this.results.max.set(u,I,x,m,A,E,null,y,B),2===this.options.store&&(F=new h.IntersectorResult(this._ray),F.set(u,I,x,m,A,E,null,y,B),this.results.all.push(F)))}},D.shaderTransformation)}}};q.sortResults=
function(){this.results.all.sort((u,v)=>u.dist!==v.dist?u.dist-v.dist:u.drapedLayerOrder!==v.drapedLayerOrder?(void 0!==u.drapedLayerOrder?u.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==v.drapedLayerOrder?v.drapedLayerOrder:Number.MAX_VALUE):(void 0!==v.drapedLayerGraphicOrder?v.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==u.drapedLayerGraphicOrder?u.drapedLayerGraphicOrder:Number.MIN_VALUE))};g._createClass(n,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},
{key:"rayEndPoint",get:function(){return this._rayEndPoint}}]);return n}();b.DEFAULT_TOLERANCE=1E-5;a.Intersector=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../input/InputManager ../../input/BrowserEventSource ../../input/handlers/PreventContextMenu ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L){b=function(Q){function X(){var S=Q.apply(this,arguments)||this;S._handles=new u;return S}a._inheritsLoose(X,Q);var aa=X.prototype;aa.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};aa.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};
aa.connect=function(){const S=this.view;this._source=new l.BrowserEventSource(this.view.surface,S.input);var H=[new z.ImmediateDoubleClick,new r.PointerClickHoldAndDrag,new y.SingleAndDoubleClick,new D.Drag(this.view.navigation),new L.VerticalTwoFingerDrag];this._inputManager=H=new t.InputManager({eventSource:this._source,recognizers:H});H.installHandlers("prevent-context-menu",[new w.PreventContextMenu],t.ViewEventPriorities.INTERNAL);this._modeDragPan=new F.PinchAndPanNavigation(S,"primary");this._modeDragRotate=
new A.DragRotate(S,"secondary","center");this._modeDragZoom=new x.DragZoom(S,"tertiary");H.installHandlers("navigation",[new G.PointerDownCancelAnimation(S),new C.DoubleClickZoom(S),new m.GamepadNavigation(S),new B.KeyboardNavigation(S,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new E.MouseWheelZoom(S),new K.SingleKeyResetTilt(S,"p"),new I.SingleKeyResetHeading(S,"n"),
new A.DragRotate(S,"primary","eye",["b"]),new A.DragRotate(S,"secondary","center",["b"]),new F.PinchAndPanNavigation(S,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new J.TwoFingerTilt(S)],t.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(H);this._updateMode();v.init(this.view.navigation,"browserTouchPanEnabled",R=>{this._source.browserTouchPanningEnabled=!R})};aa._updateMode=function(){var S=this.primaryDragAction;S=P.get(this.mode).get(S);this._modeDragPan&&
(this._modeDragPan.pointerAction=S.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=S.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=S.zoom)};a._createClass(X,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(S){"pan"!==S&&"rotate"!==S||S===this._get("primaryDragAction")||(this._set("primaryDragAction",S),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(S){"default"!==S&&"pro"!==S||S===this._get("mode")||
(this._set("mode",S),this._updateMode())}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return X}(q);g.__decorate([k.property()],b.prototype,"view",void 0);g.__decorate([k.property({value:"pan"})],b.prototype,"primaryDragAction",null);g.__decorate([k.property({value:"default"})],b.prototype,"mode",null);g.__decorate([k.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],
b.prototype,"hasPendingInputs",void 0);g.__decorate([k.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],b.prototype,"latestPointerType",void 0);g.__decorate([k.property()],b.prototype,"_inputManager",void 0);b=g.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],b);const P=new Map;g=new Map;k=new Map;g.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});g.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});k.set("pan",{pan:"primary",rotate:"tertiary",
zoom:"secondary"});k.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});P.set("default",g);P.set("pro",k);return b})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ../support/screenUtils ./gamepad/GamepadSource".split(" "),function(a,g,b,p,f,k){const c=b("trident"),d=b("edge"),e=b("chrome"),h=b("ff"),n=b("safari");b=function(){function u(t,l){this.input=l;this._active={};this._activePointerCaptures=new Set;
this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=t;t.getAttribute("tabindex")||t.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,
"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new k.GamepadSource(t,this.input);this._gamepadSource.onEvent=w=>this._callback("gamepad",w)}var v=u.prototype;v.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=
null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};v.setPointerCapture=function(t,l){l?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))};v._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?
"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};v._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};v._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};
v._releasePointerCaptureSafe=function(t){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(t)||this._element.releasePointerCapture(t)}catch(l){}};v._updateNormalizedPointerLikeEvent=function(t,l){t=f.createScreenPointFromNativeEvent(this._element,t);u.test.disableSubpixelCoordinates&&(t.x=Math.round(t.x),t.y=Math.round(t.y));l.x=t.x;l.y=t.y;return l};v._handleKey=function(t,l){const w=p.eventKey(l);w&&"key-up"===t&&this._keyDownState.delete(w);l={native:l,key:w,repeat:w&&this._keyDownState.has(w)};
w&&"key-down"===t&&this._keyDownState.add(l.key);this._callback(t,l)};v._handlePointer=function(t,l){l=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,pointerType:l.pointerType,button:l.button,buttons:l.buttons,eventId:this._eventId++});this._callback(t,l)};v._handlePointerPreventDefault=function(t,l){const w=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,pointerType:l.pointerType,button:l.button,buttons:l.buttons,eventId:this._eventId++});l.preventDefault();this._callback(t,
w)};v._handleMouseWheel=function(t,l){let w=l.deltaY;switch(l.deltaMode){case 0:if(c||d)w=w/document.documentElement.clientHeight*600;break;case 1:w*=30;break;case 2:w*=900}c||d?w*=.7:e||n?w*=.6:h&&(w*=1.375);const y=Math.abs(w);100<y&&(w=w/y*200/(1+Math.exp(-.02*(y-100))));l=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,deltaY:w});this._callback(t,l)};v._handlePointerCaptureLost=function(t,l){this._activePointerCaptures.delete(l.pointerId);this._handleDefault(t,l)};v._handleDefault=
function(t,l){const w={native:l};l.preventDefault();this._callback(t,w)};v._preventAltKeyDefault=function(t){"Alt"===t.key&&t.preventDefault()};v._preventMultiTouchPanning=function(t){1<t.touches.length&&t.preventDefault()};g._createClass(u,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(t){this._browserTouchPanningEnabled=t;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(t){this._callback=t}},
{key:"activeEvents",set:function(t){for(const l in this._active)t&&t.has(l)||(this._element.removeEventListener(q[l],this._active[l]),delete this._active[l]);t&&t.forEach(l=>{if(!this._active[l]&&q[l]){const w=(this._eventHandlers[l]||this._handleDefault).bind(this,l);this._element.addEventListener(q[l],w);this._active[l]=w}});this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}}]);return u}();b.test={disableSubpixelCoordinates:!1};const q={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown",
"pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,g,b,p,f){let k=function(){function c(e,h){this.element=e;this.input=h;this._hasEventListeners=!1;this.onConnectGamepad=n=>{this.connectGamepad(n.gamepad)};this.onDisconnectGamepad=n=>{n=n.gamepad;const q=n.index,u=this.inputDevices[q];u&&(this.emitGamepadEvent(n,f.extractState(u),!1),this.inputDevices.splice(q,1),this.latestUpdate.splice(q,1),this.input.gamepad.devices.remove(u),this.ensurePollingState())};this.frameTask=
null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;e=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&e)this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}var d=c.prototype;d.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),
window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))};d.connectGamepad=function(e){const h=new p(e);"unknown"!==h.deviceType&&(this.inputDevices[e.index]=h,this.input.gamepad.devices.add(h));this.ensurePollingState()};d.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};d.startPolling=function(){null==this.frameTask&&(this.frameTask=b.addFrameTask({update:()=>this.readGamepadState()}))};d.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),
this.frameTask=null,this.latestUpdate=[])};d.readGamepadState=function(){const e=document.hasFocus(),h=this.element.contains(document.activeElement),n="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!h;this.forEachGamepad(q=>{var u=this.inputDevices[q.index];if(u){var v=this.latestUpdate[q.index];u=f.extractState(u);var t=n||f.stateIdle(u);v&&(v.timestamp===q.timestamp||!v.active&&t||f.stateEqual(v.state,u))||this.emitGamepadEvent(q,u,!t)}})};d.forEachGamepad=
function(e){const h=window.navigator.getGamepads();for(let n=0;n<h.length;n++){const q=h[n];this.validate(q)&&e(q)}};d.emitGamepadEvent=function(e,h,n){var q=this.latestUpdate[e.index];if((q=q&&q.active)||n)this.latestUpdate[e.index]={timestamp:e.timestamp,state:h,active:n},this.callback&&this.callback({device:this.inputDevices[e.index],state:h,action:!q&&n?"start":q&&n?"update":"end"})};d.validate=function(e){if(!e||!e.connected)return!1;for(let h=0;h<e.axes.length;h++)if(isNaN(e.axes[h]))return!1;
return!0};g._createClass(c,[{key:"hasEventListeners",set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(e){this.callback=e}}]);return c}();a.GamepadSource=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports","../../../core/mathUtils"],function(a,
g){a.extractState=function(b){const p=b.native;return p?{buttons:p.buttons.map(f=>f.pressed?f.value?f.value:1:0),axes:p.axes.map(f=>{{var k=b.axisThreshold;const c=Math.abs(f);f=c<k?0:g.sign(f)*(c-k)/(1-k)}return f})}:{buttons:[],axes:[]}};a.stateEqual=function(b,p){if(b.axes.length!==p.axes.length||b.buttons.length!==p.buttons.length)return!1;for(var f=0;f<b.axes.length;f++)if(b.axes[f]!==p.axes[f])return!1;for(f=0;f<b.buttons.length;f++)if(b.buttons[f]!==p.buttons[f])return!1;return!0};a.stateIdle=
function(b){for(var p=0;p<b.axes.length;p++)if(0!==b.axes[p])return!1;for(p=0;p<b.buttons.length;p++)if(0!==b.buttons[p])return!1;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,g,b){b=function(p){function f(){var k=p.call(this,!0)||this;k.registerIncoming("context-menu",c=>{c.data.native.preventDefault()});return k}g._inheritsLoose(f,
p);return f}(b.InputHandler);a.PreventContextMenu=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(a,g,b,p,f,k){const c={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};f=function(d){function e(n=c.maximumDoubleClickDelay,
q=c.maximumDoubleClickDistance,u=c.maximumDoubleTouchDelay,v=c.maximumDoubleTouchDistance,t=b["default"]){var l=d.call(this,!1)||this;l.maximumDoubleClickDelay=n;l.maximumDoubleClickDistance=q;l.maximumDoubleTouchDelay=u;l.maximumDoubleTouchDistance=v;l._clock=t;l._pointerState=new Map;l._click=l.registerOutgoing("click");l._doubleClick=l.registerOutgoing("double-click");l.registerIncoming("immediate-click",l._handleImmediateClick.bind(g._assertThisInitialized(l)));l.registerIncoming("pointer-drag",
l._handlePointerDrag.bind(g._assertThisInitialized(l)));l.registerIncoming("drag",l._handleDrag.bind(g._assertThisInitialized(l)));return l}g._inheritsLoose(e,d);var h=e.prototype;h.onUninstall=function(){this._pointerState.forEach(n=>{null!=n.doubleClickTimeout&&(n.doubleClickTimeout.remove(),n.doubleClickTimeout=null)})};h._pointerId=function(n){n=n.native;return"mouse"===n.pointerType?`${n.pointerId}:${n.button}`:`${n.pointerType}`};h._handleImmediateClick=function(n){const q=n.data,u=this._pointerId(q),
v=this._pointerState.get(u);if(v){const t="touch"===q.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;k.manhattanDistance(v.event.data,q)>t?(this._clearDoubleClickTimeout(u,!0),this._startClick(n)):(this._clearDoubleClickTimeout(u,!1),this._doubleClick.emit(v.event.data,void 0,v.event.modifiers))}else this._startClick(n)};h._startClick=function(n){const q=this._pointerId(n.data);this._pointerState.set(q,{event:n,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(q),
"touch"===n.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};h._handlePointerDrag=function(n){n=this._pointerId(n.data.currentEvent);this._clearDoubleClickTimeout(n,!0)};h._handleDrag=function(n){n=this._pointerId(n.data.pointer);this._clearDoubleClickTimeout(n,!0)};h._clearDoubleClickTimeout=function(n,q){const u=this._pointerState.get(n);u&&(u.doubleClickTimeout.remove(),u.doubleClickTimeout=null,q&&this._doubleClickTimeoutExceeded(n),
this._pointerState.delete(n),this.refreshHasPendingInputs())};h._doubleClickTimeoutExceeded=function(n){const q=this._pointerState.get(n);this._click.emit(q.event.data,void 0,q.event.modifiers);q.doubleClickTimeout=null;this._pointerState.delete(n);this.refreshHasPendingInputs()};g._createClass(e,[{key:"hasPendingInputs",get:function(){return p.someMap(this._pointerState,n=>null!=n.doubleClickTimeout)}}]);return e}(f.InputHandler);a.DefaultParameters=c;a.SingleAndDoubleClick=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,g){a.euclideanDistance=function(b,p){const f=p.x-b.x;b=p.y-b.y;return Math.sqrt(f*f+b*b)};a.fitCircleLSQ=function(b,p){p?(p.radius=0,p.center.x=0,p.center.y=0):p={radius:0,center:g.createScreenPoint()};if(0===b.length)return p;if(1===b.length)return p.center.x=b[0].x,p.center.y=b[0].y,p;if(2===b.length){const [l,w]=b,[y,D]=[w.x-l.x,w.y-l.y];p.radius=Math.sqrt(y*y+
D*D)/2;p.center.x=(l.x+w.x)/2;p.center.y=(l.y+w.y)/2;return p}let f=0,k=0;for(p=0;p<b.length;p++)f+=b[p].x,k+=b[p].y;f/=b.length;k/=b.length;var c=b.map(l=>l.x-f),d=b.map(l=>l.y-k);let e=p=0;var h=0,n=0,q=0,u=0,v=0;for(var t=0;t<c.length;t++){const l=c[t],w=d[t],y=l*l,D=w*w;p+=y;e+=D;h+=l*w;n+=y*l;q+=D*w;u+=l*D;v+=w*y}c=p;d=h;t=e;n=.5*(n+u);q=.5*(q+v);v=c*t-h*d;u=(n*t-q*d)/v;q=(c*q-h*n)/v;v=g.createScreenPoint(u+f,q+k);return{radius:Math.sqrt(u*u+q*q+(p+e)/b.length),center:v}};a.manhattanDistance=
function(b,p){return Math.abs(p.x-b.x)+Math.abs(p.y-b.y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),function(a,g,b,p,f,k){function c(n){const q=[];n.forEach(u=>{q.push(b.createScreenPoint(u.event.x,u.event.y))});return k.fitCircleLSQ(q)}function d(n){const q=c(n);let u=0;n.forEach(v=>{var t=
h(v,q);for(t-=v.lastAngle;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;t=v.lastAngle+t;v.lastAngle=t;u+=t-v.initialAngle});u/=n.size||1;return{angle:u,radius:q.radius,center:q.center}}function e(n){const q=new Map;n.forEach((u,v)=>q.set(v,u.event));return q}function h(n,q){n=n.event;return Math.atan2(n.y-q.center.y,n.x-q.center.x)}f=function(n){function q(v){var t=n.call(this,!1)||this;t.navigationTouch=v;t.startStateModifiers=new Set;t.activePointerMap=new Map;t.isDragging=!1;t.isCurrentDragSuppressed=
!1;t.drag=t.registerOutgoing("drag");t.registerIncoming("pointer-drag",t.handlePointerDrag.bind(g._assertThisInitialized(t)));t.registerIncoming("pointer-up",t.handlePointerUpAndPointerLost.bind(g._assertThisInitialized(t)));t.registerIncoming("pointer-capture-lost",t.handlePointerUpAndPointerLost.bind(g._assertThisInitialized(t)));t.registerIncoming("pointer-cancel",t.handlePointerUpAndPointerLost.bind(g._assertThisInitialized(t)));return t}g._inheritsLoose(q,n);var u=q.prototype;u.createPayload=
function(v,t,l,w){return{action:v,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:w,pointers:e(this.activePointerMap),pointer:t,angle:l.angle,radius:l.radius,center:l.center}};u.addPointer=function(v){var t=v.native.pointerId;const l=d(this.activePointerMap).angle;v={event:v,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,v);t=h(v,c(this.activePointerMap));v.initialAngle=t;v.lastAngle=t;this.updatePointerAngles(l)};u.updatePointer=function(v){if(!v||null!=
v.x||null!=v.y){var t=this.activePointerMap.get(v.native.pointerId);t?t.event=v:this.addPointer(v)}};u.removePointer=function(v){const t=d(this.activePointerMap).angle;this.activePointerMap.delete(v);this.updatePointerAngles(t)};u.updatePointerAngles=function(v){const t=d(this.activePointerMap);this.activePointerMap.forEach(l=>{l.initialAngle=h(l,t)-v;l.lastAngle=h(l,t)-v})};u.emitEvent=function(v,t,l){const w=d(this.activePointerMap);this.drag.emit(this.createPayload(v,t,w,l),void 0,this.startStateModifiers)};
u.handlePointerUpAndPointerLost=function(v){const t=v.data.native.pointerId,l=p.Milliseconds(v.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(v.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",v.data,l),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",v.data,p.Milliseconds(v.timestamp))))};u.handlePointerDrag=function(v){const t=v.data,l=t.currentEvent,w=p.Milliseconds(v.timestamp);
switch(t.action){case "start":case "update":this.isDragging?this.activePointerMap.has(l.native.pointerId)?(this.updatePointer(l),!this.isCurrentDragSuppressed&&this.emitEvent("update",l,w)):(this.addPointer(l),this.emitEvent("added",l,w),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(l),this.pointerType=v.data.startEvent.pointerType,this.mouseButton=v.data.startEvent.button,this.startStateModifiers=v.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,
!this.isCurrentDragSuppressed&&this.emitEvent("start",l,w))}};g._createClass(q,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return q}(f.InputHandler);(function(n){n[n.Left=0]="Left";n[n.Middle=1]="Middle";n[n.Right=2]="Right";n[n.Back=3]="Back";n[n.Forward=4]="Forward";n[n.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=f;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./support ./SingleAndDoubleClick".split(" "),function(a,g,b,p,f,k){p=function(c){function d(h=k.DefaultParameters.maximumDoubleClickDelay,n=k.DefaultParameters.maximumDoubleClickDistance,q=k.DefaultParameters.maximumDoubleTouchDelay,u=k.DefaultParameters.maximumDoubleTouchDistance,v=b["default"]){var t=c.call(this,!1)||this;t.maximumDoubleClickDelay=
h;t.maximumDoubleClickDistance=n;t.maximumDoubleTouchDelay=q;t.maximumDoubleTouchDistance=u;t._clock=v;t._pointerState=new Map;t._immediateDoubleClick=t.registerOutgoing("immediate-double-click");t.registerIncoming("pointer-down",t._handlePointerDown.bind(g._assertThisInitialized(t)));t.registerIncoming("pointer-up",l=>{t._handlePointerLoss(l,"pointer-up")});t.registerIncoming("pointer-capture-lost",l=>{t._handlePointerLoss(l,"pointer-capture-lost")});t.registerIncoming("pointer-cancel",l=>{t._handlePointerLoss(l,
"pointer-cancel")});return t}g._inheritsLoose(d,c);var e=d.prototype;e.onUninstall=function(){this._pointerState.forEach(h=>{h.immediateDoubleClick&&h.immediateDoubleClick.timeoutHandle.remove()});c.prototype.onUninstall.call(this)};e._handlePointerDown=function(h){h=h.data;const n=this._pointerId(h);this._pointerState.has(n)||(this._pointerState.set(n,{downButton:h.native.button,immediateDoubleClick:null}),this.startCapturingPointer(h.native))};e._handlePointerLoss=function(h,n){const q=h.data;var u=
this._pointerId(q);if((u=this._pointerState.get(u))&&"pointer-up"===n&&u.downButton===q.native.button)if(n=u.immediateDoubleClick){n.timeoutHandle.remove();const v="touch"===h.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(n,h.data)>v?this._startImmediateDoubleClick(h,u):(this._immediateDoubleClick.emit(h.data,void 0,n.modifiers),this._removeState(q))}else this._startImmediateDoubleClick(h,u)};e._startImmediateDoubleClick=function(h,n){n.immediateDoubleClick=
{x:h.data.x,y:h.data.y,modifiers:h.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(h.data),"touch"===h.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};e._pointerId=function(h){h=h.native;return"mouse"===h.pointerType?`${h.pointerId}:${h.button}`:`${h.pointerType}`};e._removeState=function(h){const n=this._pointerId(h);this._pointerState.delete(n);this.stopCapturingPointer(h.native);this.refreshHasPendingInputs()};return d}(p.InputHandler);
a.ImmediateDoubleClick=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,g,b,p,f){const k={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};p=function(c){function d(h=k.maximumClickDelay,n=k.movementUntilMouseDrag,q=k.movementUntilPenDrag,u=k.movementUntilTouchDrag,
v=k.holdDelay,t=b["default"]){var l=c.call(this,!1)||this;l.maximumClickDelay=h;l.movementUntilMouseDrag=n;l.movementUntilPenDrag=q;l.movementUntilTouchDrag=u;l.holdDelay=v;l._clock=t;l._pointerState=new Map;l._pointerDrag=l.registerOutgoing("pointer-drag");l._immediateClick=l.registerOutgoing("immediate-click");l._pointerHold=l.registerOutgoing("hold");l.registerIncoming("pointer-down",l._handlePointerDown.bind(g._assertThisInitialized(l)));l.registerIncoming("pointer-up",w=>{l._handlePointerLoss(w,
"pointer-up")});l.registerIncoming("pointer-capture-lost",w=>{l._handlePointerLoss(w,"pointer-capture-lost")});l.registerIncoming("pointer-cancel",w=>{l._handlePointerLoss(w,"pointer-cancel")});l._moveHandle=l.registerIncoming("pointer-move",l._handlePointerMove.bind(g._assertThisInitialized(l)));l._moveHandle.pause();return l}g._inheritsLoose(d,c);var e=d.prototype;e.onUninstall=function(){this._pointerState.forEach(h=>{null!=h.holdTimeout&&(h.holdTimeout.remove(),h.holdTimeout=null)});c.prototype.onUninstall.call(this)};
e._handlePointerDown=function(h){const n=h.data,q=n.native.pointerId;var u=null;0===this._pointerState.size&&(u=this._clock.setTimeout(()=>{const v=this._pointerState.get(q);v&&(v.isDragging||(this._pointerHold.emit(v.previousEvent,void 0,h.modifiers),v.holdEmitted=!0),v.holdTimeout=null)},this.holdDelay));u={startEvent:n,previousEvent:n,startTimestamp:h.timestamp,isDragging:!1,downButton:n.native.button,holdTimeout:u,modifiers:new Set};this._pointerState.set(q,u);this.startCapturingPointer(n.native);
this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(h)};e._createPointerDragData=function(h,n,q){return{action:h,startEvent:n.startEvent,previousEvent:n.previousEvent,currentEvent:q}};e._handlePointerMove=function(h){const n=h.data,q=this._pointerState.get(n.native.pointerId);if(q){if(q.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",q,n),void 0,q.modifiers);else{const u=f.euclideanDistance(n,q.startEvent),v=this._getDragThreshold(n.native.pointerType);u>
v&&this.startDragging(h)}q.previousEvent=n}};e._getDragThreshold=function(h){switch(h){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};e.startDragging=function(h){const n=h.data,q=n.native.pointerId;this._pointerState.forEach(u=>{null!=u.holdTimeout&&(u.holdTimeout.remove(),u.holdTimeout=null);u.isDragging||(u.modifiers=h.modifiers,u.isDragging=!0,q===u.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",
u,n)):this._pointerDrag.emit(this._createPointerDragData("start",u,u.previousEvent),h.timestamp))})};e._handlePointerLoss=function(h,n){const q=h.data,u=q.native.pointerId,v=this._pointerState.get(u);v&&(null!=v.holdTimeout&&(v.holdTimeout.remove(),v.holdTimeout=null),v.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",v,"pointer-up"===n?q:v.previousEvent),void 0,v.modifiers):"pointer-up"===n&&v.downButton===q.native.button&&h.timestamp-v.startTimestamp<=this.maximumClickDelay&&
!v.holdEmitted&&this._immediateClick.emit(q),this._pointerState.delete(u),this.stopCapturingPointer(q.native),0===this._pointerState.size&&this._moveHandle.pause())};return d}(p.InputHandler);a.DefaultParameters=k;a.PointerClickHoldAndDrag=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),
function(a,g,b,p,f,k,c){p=function(d){function e(h,n){var q=d.call(this,!0)||this;q.view=h;q.registerIncoming("double-click",n,u=>q.handleDoubleClick(u));return q}g._inheritsLoose(e,d);e.prototype.handleDoubleClick=function(h){const n=h.data;if(f.eventMatchesPointerAction(n,"primary")){const q=this.view.state.isGlobal?new k.ZoomStepController({view:this.view,mode:"animation"}):new c.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(q);q.zoomStep(Math.log(.5)/
Math.log(.6),b.createScreenPointArray(n.x,n.y));h.stopPropagation()}};return e}(p.InputHandler);a.DoubleClickZoom=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(g,b){if("touch"===g.pointerType)return!1;switch(b){case "primary":return 0===g.button;case "secondary":return 2===g.button;case "tertiary":return 1===g.button}};a.eventMatchesPointerAction=function(g,b){switch(b){case "primary":return"touch"===
g.pointerType||0===g.button;case "secondary":return"touch"!==g.pointerType&&2===g.button;case "tertiary":return"touch"!==g.pointerType&&1===g.button}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../support/geometryUtils ../../../webgl-engine/lib/Intersector ../../../camera/constraintUtils/surfaceCollision ../../../../animation/easing ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../PointToPointAnimationController ../../utils/navigationUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){a.ZoomStepController=function(x){function m(){var E=x.apply(this,arguments)||this;E.zoomLocation=u.create();E.tmpCamera=new r;E.tmpViewDir=u.create();E.tmpRayDir={origin:u.create(),direction:u.create()};E.targetOnSphere=u.create();E.tmpCenter=u.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new r,interactionDirection:null,tiltMode:0};E.sphere=l.sphere.create();return E}g._inheritsLoose(m,
x);var B=m.prototype;B.initialize=function(){this.intersector=new w.Intersector(this.view.state.mode)};B.zoomStep=function(E,F){if(this.active){var G=this.view.state,{interactionStartCamera:I}=this.constraintOptions;this.animation.finished?I.copyFrom(G.camera):this.animation.cameraAt(1,I);var K=I=!1;this.intersectionHelper.intersectScreen(F,this.zoomLocation)&&(I=0<E?!0:!1,K=!0);this.tmpCamera.copyFrom(G.camera);I?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:v.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,E,this.zoomLocation,F,K);this.begin(this.tmpCamera)}};B.animationSettings=function(){return{apex:null,duration:.6,easing:D.outExpo}};B.updateCamera=function(E,F,G,I,K){var J=t.getReferenceEllipsoid(this.view.spatialReference);if(A.decideNavigationMode(E,
I,K,J)===A.NavigationMode.Horizontal||p("disable-feature:context-navigation")){F=.6**F;this.sphere[3]=v.length(G);v.subtract(this.tmpViewDir,E.center,E.eye);K=v.length(this.tmpViewDir);J=K*F;1>=F&&4>J&&(J=4,F=J/K);if(1E-6>Math.abs(K-J))return;K=v.length(E.center);this.sphere[3]!==K&&v.scale(E.center,E.center,(this.sphere[3]+F*(K-this.sphere[3]))/K);v.scale(this.tmpViewDir,this.tmpViewDir,-F);v.add(E.eye,E.center,this.tmpViewDir);z.applyAll(this.view,E,this.constraintOptions);1E-12<v.squaredDistance(G,
E.center)&&l.sphere.intersectScreen(this.sphere,E,I,this.targetOnSphere)&&A.panToPosition(this.sphere,E,G,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{K=.6**Math.abs(F);J=0<F?1:-1;l.ray.fromScreenAtEye(E,I,this.tmpRayDir);v.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var L;this.view.camera.position.hasZ&&(L=Math.abs(this.view.camera.position.z));L=Math.max(12*L,20);I=this.view._stage.renderView.getMinimalDepthForArea(I[0],I[1],this.view._stage.camera,
60);L=L>I?I:L;v.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,L);v.add(G,this.tmpRayDir.origin,this.tmpRayDir.direction);G=L*K;0<F&&4>G&&(G=4,K=G/L);if(1E-6>Math.abs(L-G))return;v.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,J*(1-K));v.add(E.eye,E.eye,this.tmpRayDir.direction);v.add(E.center,E.center,this.tmpRayDir.direction)}y.applySurfaceCollisionConstraint(this.view,E)};return m}(C.PointToPointAnimationController);a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3f64","../../../../chunks/vec3","../intersectionUtils"],function(a,g,b,p){const f=g.create();a.applySurfaceCollisionConstraint=function(k,c,d=0){var e=k.state.constraints;if(!e.collision.enabled)return!1;var h=p.surfaceElevationBelowRenderLocation(k,c.eye);const n=k.renderCoordsHelper.getAltitude(c.eye);e=h+e.collision.elevationMargin;
if(n>=e)return!1;h=b.length(c.eye);b.subtract(f,c.center,c.eye);k.renderCoordsHelper.setAltitude(e,c.eye);1===d?b.add(c.center,c.eye,f):2===d&&b.scale(c.center,c.center,(h-n+e)/h);c.markViewDirty();return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,g,b,p,f,k,c){function d(l,w){return l.elevationProvider?g.unwrapOr(l.elevationProvider.getElevation(w[0],w[1],w[2],l.renderCoordsHelper.spatialReference,"ground"),0):0}function e(l,w,y){if(!l.state.isGlobal)return!1;const D=d(l,w);({far:l}=l.stateManager.constraintsManager.nearFarHeuristic.compute(w,y,l.dataExtent,D,t));l*=l;return p.squaredDistance(w,y)>l}function h(l,w,y=b.create()){let D=n[l.viewingMode];D||(D=new c.Intersector(l.state.mode),D.options.backfacesTerrain=!l.state.isGlobal,
D.options.invisibleTerrain=!0,n[l.viewingMode]=D);const {isGlobal:z}=l.state;return l.sceneIntersectionHelper.intersectRay(w,D,y)&&!e(l,w.origin,y)?!0:!l.renderCoordsHelper.intersectManifold(w,0,y)||e(l,w.origin,y)?z?(l=f.getReferenceEllipsoid(l.spatialReference).radius,l=p.dot(w.origin,w.origin)-l*l,p.scale(y,w.direction,(0<l?Math.sqrt(l)/3:1)/p.length(w.direction)),p.add(y,y,w.origin),!0):!1:!0}const n={},q=b.create(),u=b.create(),v=b.create(),t={near:0,far:0};a.cameraOnContentAlongViewDirection=
function(l,w,y,D){const z=l.state.camera.clone();w&&(z.eye=w);y&&(z.center=y);D&&(z.up=D);h(l,z.ray,u)||p.copy(u,z.center);y=l.state.constraints;D=y.minimumPoiDistance;p.squaredDistance(z.eye,u)<D&&(w=y.collision.enabled,p.copy(v,z.viewForward),p.scale(v,v,D),w?p.subtract(z.eye,u,v):p.add(u,z.eye,v),l=l.renderCoordsHelper,D=l.getAltitude(z.eye),y=y.collision.elevationMargin,w&&D<y&&(p.subtract(v,u,z.eye),l.setAltitude(y,z.eye),p.add(u,z.eye,v)));z.center=u;return z};a.eyeWithinExtent=function(l,w,
y,D){return g.isSome(l.renderCoordsHelper.fromRenderCoords(w.eye,q,D))&&k.containsPoint(y,q)};a.surfaceElevationBelowRenderLocation=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function g(H){return H}function b(H){const R=2*(H-Math.sqrt((H-1)*H)),T=R/2/H;return W=>W<T?H*W*W:R*W-R+1}function p(H,R){return T=>T<R?R*H(T/R):1-H((1-T)/(1-R))*(1-R)}const f=H=>H*H,k=H=>1-f(1-H),c=H=>.5>H?f(2*H)/2:(1-f(1-2*(H-.5))+1)/2,d=H=>
H*H*H,e=H=>1-d(1-H),h=H=>.5>H?d(2*H)/2:(1-d(1-2*(H-.5))+1)/2,n=H=>H*H*H*H,q=H=>1-n(1-H),u=H=>.5>H?n(2*H)/2:(1-n(1-2*(H-.5))+1)/2,v=H=>H*H*H*H*H,t=H=>1-v(1-H),l=H=>.5>H?v(2*H)/2:(1-v(1-2*(H-.5))+1)/2,w=H=>-Math.cos(H*Math.PI/2)+1,y=H=>1-w(1-H),D=H=>.5>H?w(2*H)/2:(1-w(1-2*(H-.5))+1)/2,z=H=>2**(10*(H-1)),r=H=>1-2**(10*(1-H-1)),C=H=>.5>H?2**(10*(2*H-1))/2:(1-2**(10*(1-2*(H-.5)-1))+1)/2,A=H=>-(Math.sqrt(1-H*H)-1),x=H=>1-A(1-H),m=H=>.5>H?A(2*H)/2:(1-A(1-2*(H-.5))+1)/2,B=p(b(1),1),E=p(b(1),0),F=p(b(1),.5),
G=p(b(2),1),I=p(b(2),0),K=p(b(2),.5),J=p(b(3),1),L=p(b(3),0),P=p(b(3),.5),Q=p(b(4),1),X=p(b(4),0),aa=p(b(4),.5),S={linear:g,"in-quad":f,"out-quad":k,"in-out-quad":c,"in-coast-quad":B,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":d,"out-cubic":e,"in-out-cubic":h,"in-coast-cubic":G,"out-coast-cubic":I,"in-out-coast-cubic":K,"in-quart":n,"out-quart":q,"in-out-quart":u,"in-coast-quart":J,"out-coast-quart":L,"in-out-coast-quart":P,"in-quint":v,"out-quint":t,"in-out-quint":l,"in-coast-quint":Q,"out-coast-quint":X,
"in-out-coast-quint":aa,"in-sine":w,"out-sine":y,"in-out-sine":D,"in-expo":z,"out-expo":r,"in-out-expo":C,"in-circ":A,"out-circ":x,"in-out-circ":m};a.inCirc=A;a.inCoastCubic=G;a.inCoastQuad=B;a.inCoastQuart=J;a.inCoastQuint=Q;a.inCubic=d;a.inExpo=z;a.inOutCirc=m;a.inOutCoastCubic=K;a.inOutCoastQuad=F;a.inOutCoastQuart=P;a.inOutCoastQuint=aa;a.inOutCubic=h;a.inOutExpo=C;a.inOutQuad=c;a.inOutQuart=u;a.inOutQuint=l;a.inOutSine=D;a.inQuad=f;a.inQuart=n;a.inQuint=v;a.inSine=w;a.linear=g;a.named=S;a.outCirc=
x;a.outCoastCubic=I;a.outCoastQuad=E;a.outCoastQuart=L;a.outCoastQuint=X;a.outCubic=e;a.outExpo=r;a.outQuad=k;a.outQuart=q;a.outQuint=t;a.outSine=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/common ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,g,b,p,f,k,c,d){const e=[{type:1,
error:function(n,q,u){return c.getTiltConstraintError(n,q,u)*q.distance},apply:c.applyTiltConstraint},{type:2,error:p.getAltitudeConstraintError,apply:p.applyAltitudeConstraint},{type:4,error:f.getDistanceConstraintError,apply:f.applyDistanceConstraint}],h={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.applyAltitudeConstraint=p.applyAltitudeConstraint;a.getAltitudeConstraintError=p.getAltitudeConstraintError;a.applyDistanceConstraint=
f.applyDistanceConstraint;a.getDistanceConstraintError=f.getDistanceConstraintError;a.applySurfaceCollisionConstraint=k.applySurfaceCollisionConstraint;a.applyTiltConstraint=c.applyTiltConstraint;a.getTiltConstraintError=c.getTiltConstraintError;a.applyAll=function(n,q,u=h,v=q){let t=!1;v!==q&&v.copyFrom(q);v.markViewDirty();v.computeUp(n.state.mode);for(q=0;5>q;q++){let w=0;for(var l of e)if(b.hasConstraintType(u.selection,l.type)){const y=Math.abs(l.error(n,v,u));l.apply(n,v,u)&&(t=!0,w+=y)}if(0===
w)break}l=b.hasConstraintType(u.selection,8);a:switch(u.interactionType){case 4:u=1;break a;case 5:u=n.state.isGlobal?2:1;break a;default:u=0}l&&k.applySurfaceCollisionConstraint(n,v,u)&&(t=!0);t&&v.computeUp(n.state.mode);return t};a.pixelDistanceToInteractionFactor=function(n,q){n="number"===typeof n?n:g.distance(n,q);return d.inOutCubic(Math.min(1,n/150))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../core/mathUtils",
"../../../../chunks/vec3"],function(a,g,b){a.adjustRangeForInteraction=function(p,f,k,c,d,e){0!==p&&(k?(e.min=Math.min(e.min,f),e.max=Math.max(e.max,f)):null!=c?(e.min-=Math.max(0,(f-e.min)*(1-c)),e.max+=Math.max(0,(f-e.max)*(1-c))):d&&(e.min-=Math.max(0,f-e.min-d),e.max+=Math.max(0,f-e.max-d)))};a.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.hasConstraintType=function(p,f){return 0!==(p&f)};a.interactionDirectionTowardsConstraintMinimization=
function(p,f,k,c){f=f||p.viewForward;b.copy(c,f);b.scale(c,c,g.sign(b.dot(f,k)));return c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/geometryUtils ./common ../../support/intersectionUtils".split(" "),function(a,g,b,p,f,k,c){function d(v,t,l=k.defaultApplyOptions){var w=v.state.constraints.altitude;w=v.state.isGlobal&&w?2===
l.interactionType&&k.hasConstraintType(l.selection,1)?!1:!0:!1;if(!w)return 0;var y=v.state.constraints.altitude;w=h;w.min=y.min;w.max=y.max;y=l.interactionType;if(0!==y){var {min:D,max:z}=w,{interactionStartCamera:r,interactionFactor:C}=l;l=2===y||1===y;y=d(v,r);var A=0===y?0:v.renderCoordsHelper.getAltitude(r.eye);w.min=D;w.max=z;k.adjustRangeForInteraction(y,A,l,C,.05*A,w)}v=v.renderCoordsHelper.getAltitude(t.eye);v=g.clamp(v,w.min,w.max)-v;return 1E-6>=Math.abs(v)?0:v}function e(v,t,l,w){v.renderCoordsHelper.worldUpAtPosition(t.eye,
w);p.scale(w,w,l);return w}const h={min:0,max:0},n=b.create(),q=b.create(),u=b.create();a.applyAltitudeConstraint=function(v,t,l=k.defaultApplyOptions){const w=d(v,t,l);if(0===w)return!1;const y=v.renderCoordsHelper,D=y.getAltitude(t.eye)+w;v=k.interactionDirectionTowardsConstraintMinimization(t,l.interactionDirection,e(v,t,g.sign(w),q),n);l=p.copy(u,t.viewForward);y.intersectInfiniteManifold(f.ray.wrap(t.eye,v),D,t.eye)||y.setAltitude(D,t.eye);c.closestPointOnRay(t.eye,l,t.center,t.center);t.markViewDirty();
return!0};a.getAltitudeConstraintError=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/vec2f64","./geometryUtils"],function(a,g,b,p,f){function k(e,h,n,q){const u=d;e?(n&&q&&(u.len=b.distance(h,n)),b.copy(u.dir,e)):q?(u.len=b.distance(h,n),b.subtract(u.dir,n,h),b.scale(u.dir,u.dir,1/u.len)):(b.subtract(u.dir,n,h),b.normalize(u.dir,u.dir));return u}function c(e,
h,n,q){q.clip[0]=0;q.clip[1]=n?q.len:Number.MAX_VALUE;for(n=0;n<e.length;n++){{var u=e[n],v=h;var t=q;const l=b.dot(f.plane.normal(u),t.dir);u=-f.plane.signedDistance(u,v);0>u&&0<=l?t=!1:-1E-6<l&&1E-6>l?t=0<u:!(0>u||0>l)||0>u&&0>l?(u/=l,0<l?u<t.clip[1]&&(t.clip[1]=u):u>t.clip[0]&&(t.clip[0]=u),t=t.clip[0]<=t.clip[1]):t=!0}if(!t)return!1}return!0}const d={dir:g.create(),len:0,clip:p.create()};a.closestPointOnRay=function(e,h,n,q){n=b.dot(h,b.subtract(q,n,e));b.add(q,e,b.scale(q,h,n));return q};a.frustumLineSegment=
function(e,h,n,q){q=k(q,h,n,!0);return c(e,h,n,q)};a.frustumPoint=function(e,h){for(let n=0;6>n;n++)if(0<f.plane.signedDistance(e[n],h))return!1;return!0};a.frustumRay=function(e,h,n,q){n=k(q,h,n,!1);return c(e,h,null,n)};a.frustumSphere=function(e,h,n){const q=h[0],u=h[1];h=h[2];return e[0][0]*q+e[0][1]*u+e[0][2]*h+e[0][3]>n||e[1][0]*q+e[1][1]*u+e[1][2]*h+e[1][3]>n||e[2][0]*q+e[2][1]*u+e[2][2]*h+e[2][3]>n||e[3][0]*q+e[3][1]*u+e[3][2]*h+e[3][3]>n||e[4][0]*q+e[4][1]*u+e[4][2]*h+e[4][3]>n||e[5][0]*
q+e[5][1]*u+e[5][2]*h+e[5][3]>n?!1:!0};a.planeSphere=function(e,h,n){return e[0]*h[0]+e[1]*h[1]+e[2]*h[2]+e[3]<n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../support/geometryUtils ./common".split(" "),function(a,g,b,p,f,k){function c(u,v,t=k.defaultApplyOptions){if(!u.state.isLocal)return 0;var l=u.state.constraints.distance;if(!u.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===l)return 0;d.min=0;d.max=l;l=d;var w=t.interactionType;if(0!==w){var {min:y,max:D}=l,{interactionStartCamera:z,interactionFactor:r}=t;t=1===w||4===w;w=c(u,z);var C=0===w?0:b.distance(z.eye,u.pointsOfInterest.surfaceOrigin.renderLocation);l.min=y;l.max=D;k.adjustRangeForInteraction(w,C,t,r,.05*C,l)}u=b.distance(v.eye,u.pointsOfInterest.surfaceOrigin.renderLocation);u=d.max-u;return-1E-6<=u?0:u}const d={min:0,max:0},e=g.create(),h=g.create(),n=g.create(),q=g.create();a.applyDistanceConstraint=
function(u,v,t=k.defaultApplyOptions){var l=c(u,v,t);if(0===l)return!1;var w=u.pointsOfInterest.surfaceOrigin;l=b.distance(v.eye,u.pointsOfInterest.surfaceOrigin.renderLocation)+l;const y=b.copy(e,v.eye);t=k.interactionDirectionTowardsConstraintMinimization(v,t.interactionDirection,p.directionFromTo(q,v.eye,u.pointsOfInterest.surfaceOrigin.renderLocation),n);return f.sphere.intersectRay(f.sphere.fromCenterAndRadius(w.renderLocation,l),f.ray.wrap(v.eye,t),v.eye)?(w=b.subtract(h,v.eye,y),b.add(v.center,
v.center,w),v.markViewDirty(),w=u.renderCoordsHelper.getAltitude(v.center),u.renderCoordsHelper.intersectInfiniteManifold(v.ray,w,v.center),v.markViewDirty(),!0):!1};a.getDistanceConstraintError=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../support/geometryUtils ./common ../../state/utils/viewUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){function q(A,x,m=h.defaultApplyOptions,B=!0){C.eyeCenterDistance=0;C.requiresTwoSteps=!1;const E=u(A,x,m,void 0,C);if(0===E)return!1;c.identity(w);c.rotate(w,w,-E,x.viewRight);switch(m.tiltMode){case 1:f.transformMat4(l,x.viewForward,w);f.scale(l,l,C.eyeCenterDistance);f.add(x.center,x.eye,l);break;case 0:f.subtract(l,x.center,x.eye);f.transformMat4(l,l,w);f.subtract(x.eye,x.center,l);break;default:g.neverReached(m.tiltMode)}f.transformMat4(x.up,x.up,w);x.markViewDirty();
return C.requiresTwoSteps&&B?q(A,x,m,!1):!0}function u(A,x,m=h.defaultApplyOptions,B=h.defaultApplyOptions,E){if(!A.state.constraints.tilt)return 0;var F=A.state.constraints.tilt(x.distance,z);if(0!==m.interactionType){var {interactionStartCamera:G,interactionFactor:I}=m,{min:K,max:J}=F,L=u(A,G,h.defaultApplyOptions,m),P=0===L?0:n.viewAngle(A.renderCoordsHelper,G.center,G.eye);F.min=K;F.max=J;2===m.interactionType?(h.hasConstraintType(m.selection,2)&&t(A,G,F),h.adjustRangeForInteraction(L,P,!0,I,
D,F)):h.adjustRangeForInteraction(L,P,!1,I,D,F)}2===B.interactionType&&h.hasConstraintType(B.selection,2)&&t(A,B.interactionStartCamera,F);if(1===m.tiltMode||1===B.tiltMode){a:switch(E&&(E.requiresTwoSteps=!1),A.viewingMode){case "global":m=r;L=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;B=L+k.getReferenceEllipsoid(A.spatialReference).radius;L=A.renderCoordsHelper.intersectManifold(x.ray,L,y);m.eyeCenterDistance=x.distance;L?(m.eyeCenterDistance=f.distance(x.eye,y),m.tiltAtCenter=
n.viewAngle(A.renderCoordsHelper,y,x.eye)):A.state.isLocal?m.tiltAtCenter=n.viewAngle(A.renderCoordsHelper,x.center,x.eye):(e.sphere.closestPointOnSilhouette(e.sphere.fromRadius(B),x.ray,y),m.eyeCenterDistance=f.distance(x.eye,y),m.tiltAtCenter=b.acosClamped(-f.dot(x.viewForward,f.normalize(y,y))));m.radius=B;m.eyeRadius=f.length(x.eye);m.constraints=A.state.constraints;m.centerIsOnSurface=L;x=b.clamp(m.tiltAtCenter,F.min,F.max);if(1E-9<Math.abs(m.tiltAtCenter-x)){if(m.centerIsOnSurface){{const {constraints:Q,
eyeCenterDistance:X,tiltAtCenter:aa}=m;x=aa;A=Q.clampTilt(X,aa);F=v(m,A);if(Q.clampTilt(F,aa)!==A)for(F=0;10>F&&1E-9<Math.abs(A-x);)B=(x+A)/2,L=v(m,B),L=Q.clampTilt(L,B),1E-9<Math.abs(L-B)?x=B:A=B,F++;x=A}F=x;A=b.asinClamped(m.radius/m.eyeRadius*Math.sin(m.tiltAtCenter));F=b.asinClamped(m.radius/m.eyeRadius*Math.sin(F));A=m.eyeRadius>m.radius?A-F:F-A}else x=m.constraints.clampTilt(m.eyeCenterDistance,m.tiltAtCenter),E&&x<Math.PI/2&&(E.requiresTwoSteps=!0,x=Math.PI/2-1E-5),A=m.tiltAtCenter-Math.PI/
2-(x-Math.PI/2);E&&(E.eyeCenterDistance=v(m,x));E=A}else E=0;break a;case "local":B=n.viewAngle(A.renderCoordsHelper,x.center,x.eye);m=b.clamp(B,F.min,F.max);F=B-m;1E-9<Math.abs(F)?(E&&(B=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,A=A.renderCoordsHelper.getAltitude(x.eye)-B,m=Math.cos(m),E.eyeCenterDistance=1E-4<Math.abs(m)?A/m:x.distance),E=F):E=0;break a;default:g.neverReached(A.viewingMode),E=void 0}return E}E=n.viewAngle(A.renderCoordsHelper,x.center,x.eye);m=b.clamp(E,
F.min,F.max);E-=m;E=1E-9<Math.abs(E)?E:0;return E}function v(A,x){if(!A.centerIsOnSurface)return A.eyeCenterDistance;x=Math.PI-b.clamp(x,0,Math.PI);const m=b.asinClamped(A.radius/A.eyeRadius*Math.sin(x)),B=Math.sin(Math.PI-x-m)/Math.sin(x);return A.eyeRadius<A.radius&&1<B?Math.sin(Math.PI-x-(Math.PI-m))/Math.sin(x)*A.eyeRadius:B*A.eyeRadius}function t(A,x,m){if(!A.state.isLocal){var B=A.state.constraints;if(B.altitude){var E=f.squaredLength(x.center),F=Math.sqrt(E);x=x.distance;var G=k.getReferenceEllipsoid(A.spatialReference).radius;
A=B.altitude.min+G;B=B.altitude.max+G;A=(A*A-x*x-E)/(-2*F*x);m.min=Math.max(m.min,Math.min(Math.PI-b.acosClamped((B*B-x*x-E)/(-2*F*x)),m.max));m.max=Math.min(m.max,Math.PI-b.acosClamped(A))}}}const l=p.create(),w=d.create(),y=p.create(),D=b.deg2rad(5),z={min:0,max:0},r={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},C={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=q;a.getTiltConstraintError=u;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3"],function(a,g,b,p){const f=b.create(),k=b.create();a.viewAngle=function(c,d,e){c.worldUpAtPosition(d,f);p.subtract(k,e,d);c=p.length(k);return 0===c?0:g.acosClamped(p.dot(k,f)/c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vector ../../support/geometryUtils ./Util".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){let w=function(){function A(m=null,B=null,E=null){this._viewUp=f.create();this._viewForward=f.create();this._viewRight=f.create();this._ray=t.ray.createWrapper();this._viewport=n.fromValues(0,0,1,1);this._padding=n.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=h.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=e.create();this._projectionDirty=!0;this._projectionMatrix=e.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=e.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.create();this._frustumDirty=!0;this._frustum=t.frustum.create();this._fullViewport=n.create();this.pixelRatio=1;this.relativeElevation=0;this._eye=g.isSome(m)?f.clone(m):f.create();this._center=g.isSome(B)?f.clone(B):f.create();this._up=g.isSome(E)?f.clone(E):f.fromValues(0,0,1)}var x=A.prototype;x.depthNDCToWorld=function(m){return 2*this.near*this.far/(this.far+this.near-(2*m-1)*(this.far-this.near))};x.copyFrom=function(m){k.copy(this._eye,
m._eye);k.copy(this._center,m._center);k.copy(this._up,m._up);u.copy(this._viewport,m._viewport);u.copy(this._padding,m._padding);q.copy(this._nearFar,m._nearFar);this._fov=m._fov;this.relativeElevation=m.relativeElevation;this._viewDirty=m._viewDirty;this._viewDirty||(d.copy(this._viewMatrix,m._viewMatrix),k.copy(this._viewRight,m._viewRight),k.copy(this._viewUp,m._viewUp),k.copy(this._viewForward,m._viewForward));m._projectionDirty?this._projectionDirty=!0:(d.copy(this._projectionMatrix,m._projectionMatrix),
this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=m._frustumDirty;this._frustumDirty||(t.frustum.copy(m._frustum,this._frustum),this._frustumDirty=!1);m._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(d.copy(this._viewInverseTransposeMatrix,m._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);u.copy(this._fullViewport,m._fullViewport);this.pixelRatio=m.pixelRatio;return this};x.copyViewFrom=function(m){this.eye=m.eye;this.center=
m.center;this.up=m.up};x.clone=function(){return(new A).copyFrom(this)};x.equals=function(m){return k.exactEquals(this._eye,m._eye)&&k.exactEquals(this._center,m._center)&&k.exactEquals(this._up,m._up)&&u.exactEquals(this._viewport,m._viewport)&&u.exactEquals(this._padding,m._padding)&&q.exactEquals(this._nearFar,m._nearFar)&&this._fov===m._fov&&this.pixelRatio===m.pixelRatio&&this.relativeElevation===m.relativeElevation};x.almostEquals=function(m){if(this.pixelRatio!==m.pixelRatio||.001<=Math.abs(m.fov-
this._fov))return!1;const B=1-1E-10;k.sub(z,m.eye,m.center);k.sub(r,this._eye,this._center);const E=k.dot(z,r),F=k.sqrLen(z),G=k.sqrLen(r);return E*E>=B*F*G&&k.sqrDist(m.eye,this._eye)<2.5E-7*Math.max(F,G)&&.5>u.squaredDistance(m.padding,this._padding)&&.5>u.squaredDistance(m.viewport,this._viewport)};x.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};x.computeRenderPixelSizeAt=function(m){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(m))};
x.computeRenderPixelSizeAtDist=function(m){return m*this.perRenderPixelRatio};x.computeScreenPixelSizeAt=function(m){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(m))};x.viewDirectionDistance=function(m){return Math.abs(v.projectPointSignedLength(this.viewForward,k.subtract(z,m,this._eye)))};x.computeScreenPixelSizeAtDist=function(m){return m*this.perScreenPixelRatio};x.computeDistanceFromRadius=function(m,B){return m/Math.tan(Math.min(this.fovX,this.fovY)/(2*(B||1)))};x.getScreenCenter=
function(m=p.createScreenPointArray()){m[0]=(this.padding[3]+this.width/2)/this.pixelRatio;m[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return m};x.getRenderCenter=function(m,B=.5,E=.5){m||(m=p.createRenderScreenPointArray3());m[0]=this.padding[3]+this.width*B;m[1]=this.padding[2]+this.height*E;2<m.length&&(m[2]=.5);return m};x.setGLViewport=function(m){const B=this.viewport,E=this.padding;m.setViewport(B[0]-E[3],B[1]-E[2],B[2]+E[1]+E[3],B[3]+E[0]+E[2])};x.applyProjection=function(m,B,E=!1){m!==
y&&k.copy(y,m);y[3]=1;E&&(B[2]=-y[2]);u.transformMat4(y,y,this.projectionMatrix);k.scale(y,y,1/Math.abs(y[3]));m=this.fullViewport;B[0]=b.lerp(0,m[0]+m[2],.5+.5*y[0]);B[1]=b.lerp(0,m[1]+m[3],.5+.5*y[1]);E||(B[2]=.5*(y[2]+1));return B};x.projectToScreen=function(m,B){this.projectToRenderScreen(m,C);return this.renderToScreen(C,B)};x.projectToRenderScreen=function(m,B){y[0]=m[0];y[1]=m[1];y[2]=m[2];y[3]=1;u.transformMat4(y,y,this.viewProjectionMatrix);if(0===y[3])return null;k.scale(y,y,1/Math.abs(y[3]));
m=this.fullViewport;"x"in B?(B.x=b.lerp(0,m[0]+m[2],.5+.5*y[0]),B.y=b.lerp(0,m[1]+m[3],.5+.5*y[1])):(B[0]=b.lerp(0,m[0]+m[2],.5+.5*y[0]),B[1]=b.lerp(0,m[1]+m[3],.5+.5*y[1]),2<B.length&&(B[2]=.5*(y[2]+1)));return B};x.unprojectFromScreen=function(m,B){return this.unprojectFromRenderScreen(this.screenToRender(m,C),B)};x.unprojectFromRenderScreen=function(m,B){d.multiply(D,this.projectionMatrix,this.viewMatrix);if(!d.invert(D,D))return null;const E=this.fullViewport;y[0]=2*(m[0]-E[0])/E[2]-1;y[1]=2*
(m[1]-E[1])/E[3]-1;y[2]=2*m[2]-1;y[3]=1;u.transformMat4(y,y,D);if(0===y[3])return null;B[0]=y[0]/y[3];B[1]=y[1]/y[3];B[2]=y[2]/y[3];return B};x.constrainWindowSize=function(m,B,E,F=1){m*=this.pixelRatio;B*=this.pixelRatio;return[Math.max(m-E*F/2,0),Math.max(this.fullHeight-B-E/2,0),E*F- -Math.min(m-E*F/2,0)- -Math.min(this.fullWidth-m-E*F/2,0),E- -Math.min(this.fullHeight-B-E/2,0)- -Math.min(B-E/2,0)]};x.computeUp=function(m){1===m?this.computeUpGlobal():this.computeUpLocal()};x.screenToRender=function(m,
B){const E=this.fullHeight-m[1]*this.pixelRatio;B[0]=m[0]*this.pixelRatio;B[1]=E;return B};x.renderToScreen=function(m,B){const E=(this.fullHeight-m[1])/this.pixelRatio;B[0]=m[0]/this.pixelRatio;B[1]=E;return B};x.computeUpGlobal=function(){k.subtract(z,this.center,this.eye);const m=k.length(this.center);1>m?(k.set(this.up,0,0,1),this.markViewDirty()):Math.abs(k.dot(z,this.center))>.9999*k.length(z)*m||(k.cross(this.up,z,this.center),k.cross(this.up,this.up,z),k.normalize(this.up,this.up),this.markViewDirty())};
x.computeUpLocal=function(){c.directionFromTo(z,this.eye,this.center);.9999>=Math.abs(z[2])&&(k.scale(z,z,z[2]),k.set(this.up,-z[0],-z[1],1-z[2]),k.normalize(this.up,this.up),this.markViewDirty())};x._compareAndSetView=function(m,B){k.exactEquals(m,B)||(k.copy(B,m),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};x._recomputeFrustum=function(){this._frustumDirty&&(t.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};x._ensureViewClean=
function(){this._viewDirty&&(d.lookAt(this._viewMatrix,this._eye,this._center,this._up),k.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),k.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),k.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};a._createClass(A,[{key:"eye",get:function(){return this._eye},set:function(m){this._compareAndSetView(m,
this._eye)}},{key:"center",get:function(){return this._center},set:function(m){this._compareAndSetView(m,this._center)}},{key:"ray",get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=f.create());k.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(m){this._compareAndSetView(m,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(m){d.copy(this._viewMatrix,
m);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(m){this._nearFar[0]!==m&&(this._nearFar[0]=
m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(m){this._nearFar[1]!==m&&(this._nearFar[1]=m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(m){this.x=m[0];this.y=m[1];this.width=m[2];this.height=m[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(m){m+=this._padding[3];this._viewport[0]!==m&&(this._viewport[0]=
m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(m){m+=this._padding[2];this._viewport[1]!==m&&(this._viewport[1]=m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(m){this._viewport[2]!==m&&(this._viewport[2]=m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},
set:function(m){this._viewport[3]!==m&&(this._viewport[3]=m,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(m){this.width=m-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(m){this.height=m-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){this._fullViewport[0]=
this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(m){if(this._padding[0]!==m[0]||this._padding[1]!==m[1]||this._padding[2]!==m[2]||this._padding[3]!==m[3])this._viewport[0]+=m[3]-this._padding[3],this._viewport[1]+=m[2]-this._padding[2],
this._viewport[2]-=m[1]+m[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=m[0]+m[2]-(this._padding[0]+this._padding[2]),u.copy(this._padding,m),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(d.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const m=
this.width,B=this.height,E=this.near*Math.tan(this.fovY/2),F=E*this.aspect;d.frustum(this._projectionMatrix,-F*(1+2*this._padding[3]/m),F*(1+2*this._padding[1]/m),-E*(1+2*this._padding[2]/B),E*(1+2*this._padding[0]/B),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(m){d.copy(this._projectionMatrix,m);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(m){this._fov=m;this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return l.fovd2fovx(this._fov,this.width,this.height)},set:function(m){this._fov=l.fovx2fovd(m,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return l.fovd2fovy(this._fov,this.width,this.height)},set:function(m){this._fov=l.fovy2fovd(m,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"distance",
get:function(){return k.distance(this._center,this._eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)d.invert(this._viewInverseTransposeMatrix,this.viewMatrix),d.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/
2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return A}();const y=n.create(),D=e.create(),z=f.create(),r=f.create(),C=p.createRenderScreenPointArray3();return w})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../chunks/vec3f64 ../../../ViewAnimation ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/Camera ../../animation/pointToPoint/Animation ./AnimationController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){a.PointToPointAnimationController=function(r){function C(x){x=r.call(this,x)||this;x.view=null;x.mode="interaction";x.hasTarget=!1;return x}g._inheritsLoose(C,r);var A=C.prototype;A.initialize=function(){this.animation=new w.Animation(this.view.state.mode);this.viewAnimation="interaction"===this.mode?null:new v};A.begin=function(x,m){this.hasTarget=!0;m=this.animationSettings(m);D.copyFrom(this.view.state.camera);const B=new t.Intersector(this.view.state.mode);
this.intersectionHelper.intersectRay(D.ray,B,z)&&(D.center=z);this.animation.update(D,x,m);this.animation.finished&&this.finish()};A.finish=function(){this.animation.currentTime=this.animation.time;r.prototype.finish.call(this)};A.stepController=function(x,m){this.hasTarget&&this.animation.step(x,m)};A.onControllerEnd=function(x){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,x),this.animation.currentTime=this.animation.time);r.prototype.onControllerEnd.call(this,
x)};A.animationSettings=function(x={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:x.speedFactor,duration:x.duration,maxDuration:x.maxDuration,easing:x.easing}};g._createClass(C,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return C}(y.AnimationController);b.__decorate([c.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);b.__decorate([c.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=b.__decorate([e.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const D=new l,z=u.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec3 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,g,b,p,f,k,c){const d=b.create();b=function(){function e(n){this.currentTime=0;this.animation=new c.Animation(()=>new f(n));this._current=new f(n)}var h=e.prototype;h.update=function(n,q,u){const v=this.animation.definition.source,t=this.animation.definition.target,l=p.subtract(d,q.center,n.center),w=p.length(l);1E-5<=w?(l[0]/=w,l[1]/=w,l[2]/=w):(l[0]=0,l[1]=1,l[0]=0);p.copy(v.lookAtDirection,l);p.copy(t.lookAtDirection,l);v.copyFromRenderCamera(n);t.copyFromRenderCamera(q);this._current.copyFrom(v);
this.animation.update(v,t,u);this.currentTime=0;n.almostEquals(q)&&(this.currentTime=this.animation.time)};h.cameraAt=function(n,q){this.animation.cameraAt(n,this._current);q=q||new k;this._current.copyToRenderCamera(q);return q};h.step=function(n,q){this.finished||(this.currentTime+=n,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,q)};g._createClass(e,[{key:"finished",get:function(){return this.currentTime>=this.animation.time}},{key:"time",
get:function(){return this.animation.time}}]);return e}();a.Animation=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat3f64 ../../../../chunks/mat3".split(" "),function(a,g,b,p,f,k){const c=g.create(),d=g.create(),e=g.create(),h=g.create(),n=g.create(),q=g.create();var u=g.fromValues(0,0,1),v=g.fromValues(0,
1,0),t=g.fromValues(1,0,0);const l=f.create();return function(){function w(D=1){this.viewingMode=D;this.center=g.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=g.clone(v)}var y=w.prototype;y.pixelsPerPanAtZoom=function(D){return this.size/2/(this._zoomToPanScale*D)};y.zoomAtPixelsPerPan=function(D){return this.size/2/(this._zoomToPanScale*D)};y.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};y.compareTo=function(D,z){z||(z={pan:0,
rotate:0,sourceZoom:0,targetZoom:0});if(1===this.viewingMode){var r=b.length(this.center);const C=b.length(D.center);r=(r+C)/2;z.pan=p.angle(this.center,D.center)*r}else z.pan=b.distance(this.center,D.center);r=Math.abs(D.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);z.rotate=Math.max(r,Math.abs(D.pitch-this.pitch));z.sourceZoom=this.distance;z.targetZoom=D.distance;return z};y.interpolate=function(D,z,r){1===this.viewingMode?p.slerp(D.center,z.center,r.pan,this.center):b.lerp(this.center,D.center,z.center,
r.pan);this.distance=a.lerp(D.distance,z.distance,r.zoom);this.pitch=a.lerp(D.pitch,z.pitch,r.rotate);D=D.yaw;z=z.yaw;Math.abs(z-D)>=Math.PI&&(D+=2*(D<z?1:-1)*Math.PI);this.yaw=a.lerp(D,z,r.rotate)};y.copyFrom=function(D){b.copy(this.center,D.center);this.pitch=D.pitch;this.yaw=D.yaw;this.distance=D.distance;b.copy(this.lookAtDirection,D.lookAtDirection);this.size=D.size;this.copyFromCommon(D);this.viewingMode=D.viewingMode};y.copyFromRenderCamera=function(D){const z=this._lookAtOrientation(D.center,
l);b.copy(this.center,D.center);b.subtract(h,D.center,D.eye);b.transformMat3(h,h,z);b.transformMat3(n,D.up,z);this.distance=b.length(h);h[0]/=this.distance;h[1]/=this.distance;h[2]/=this.distance;this.pitch=this._eyeUpToPitch(h);this.yaw=this._eyeUpToYaw(h,n);this.size=Math.sqrt(D.width*D.width+D.height*D.height);this.copyFromCommon(D)};y.copyFromCommon=function(D){this.fov=D.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};y.copyToRenderCamera=function(D){const z=this._lookAtOrientation(this.center,
l);k.transpose(z,z);this._axisAngleVec3(t,this.pitch-Math.PI/2,v,h);this._axisAngleVec3(u,this.yaw,h);this._axisAngleVec3(t,this.pitch-Math.PI/2,u,n);this._axisAngleVec3(u,this.yaw,n);b.scale(h,h,this.distance);b.transformMat3(h,h,z);b.transformMat3(n,n,z);D.center=this.center;D.eye=b.subtract(h,this.center,h);D.up=n};y._axisAngleVec3=function(D,z,r,C=r){const A=Math.cos(z);z=Math.sin(z);b.scale(c,r,A);b.cross(d,D,r);b.scale(d,d,z);b.scale(e,D,(1-A)*b.dot(D,r));return b.add(C,b.add(C,c,d),e)};y._lookAtOrientation=
function(D,z){this._upAtLookAt(D,e);b.cross(c,this.lookAtDirection,e);b.normalize(c,c);0===c[0]&&0===c[1]&&0===c[2]&&b.copy(c,t);b.cross(d,e,c);b.normalize(d,d);z||(z=f.create());z[0]=c[0];z[1]=d[0];z[2]=e[0];z[3]=c[1];z[4]=d[1];z[5]=e[1];z[6]=c[2];z[7]=d[2];z[8]=e[2];return z};y._upAtLookAt=function(D,z){return 2===this.viewingMode?b.copy(z,u):b.normalize(z,D)};y._eyeUpToPitch=function(D){return Math.PI-p.angle(u,D)};y._eyeUpToYaw=function(D,z){.5>Math.abs(z[2])?(b.copy(q,z),0<D[2]&&b.scale(q,q,
-1)):b.copy(q,D);b.cross(d,q,u);b.normalize(d,d);return p.angle(t,d,u)};return w}()})},"esri/views/animation/pointToPoint/Animation":function(){define(["exports","../easing","./Settings","./Definition","./apex/Path"],function(a,g,b,p,f){const k={zoom:0,pan:0,rotate:0};let c=function(){function d(h){this.createCamera=h;this.time=0;this.definition=new p.Definition(h);this.path=new f.Path}var e=d.prototype;e.update=function(h,n,q){this.definition.update(h,n,q);this.path.update(this.definition,q);this.time=
this._applyTimeSettings(this.path.time,q);this.settings=q};e.cameraAt=function(h,n){n=n||this.createCamera();h=Math.min(Math.max(0,h),1);h=this.settings.easing?this.normalizedEasing(this.settings.easing,h):1<=this.time?this.normalizedEasing(g.inOutCoastQuad,h):this.normalizedEasing(g.outExpo,h);h=this.path.interpolateComponentsAt(h,k);n.interpolate(this.definition.source,this.definition.target,h);return n};e.normalizedEasing=function(h,n){const q=h(0),u=h(1);return(h(n)-q)/(u-q)};e._applyTimeSettings=
function(h,n){const q=null!=n.speedFactor?n.speedFactor:1;null!=n.duration?h=n.duration:null!=n.speedFactor&&(h/=q);return h=Math.min(Math.max(null!=n.minDuration?n.minDuration:b.defaultSettings.minDuration/q,h),null!=n.maxDuration?n.maxDuration:b.defaultSettings.maxDuration/q)};return d}();a.Animation=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports"],function(a){a.defaultSettings={desiredScreenFlow:2,minDuration:.5,
maxDuration:8};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,g,b){let p=function(){function f(c){this.createCamera=c;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=c();this.target=c()}var k=f.prototype;k.clone=function(){const c=new f(this.createCamera);c.copyFrom(this);
return c};k.copyFrom=function(c){this.update(c.source,c.target,c.settings)};k.update=function(c,d,e){this.source!==c&&this.source.copyFrom(c);this.target!==d&&this.target.copyFrom(d);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=e.desiredScreenFlow?e.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};k.halfWindowPanAtZoom=function(c){c=
this.target.pixelsPerPanAtZoom(c);return this.halfWindowSize/c};g._createClass(f,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return f}();a.Definition=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(a,g,b,p,f,k){p=function(c){function d(h,n){var q=c.call(this)||this;q._preallocSegments=[new f.Segment,new f.Segment,new f.Segment];q.update(h,n);return q}g._inheritsLoose(d,c);var e=d.prototype;e.update=function(h,n){if(h){this.definition?this.definition.copyFrom(h):this.definition=h.clone();var q=null;n&&n.apex&&(q=k.optimalDistance(h,n.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==q?this._updateWithoutApex():this._updateWithApex(q,n.apex)}};e.segmentInterpolateComponentsAt=
function(h,n,q){q=h.interpolateComponentsAt(n,q);h===this._ascensionSegment?q.zoom=b.outQuad(q.zoom):h===this._descensionSegment&&(q.zoom=b.inQuad(q.zoom));return q};e._updateWithApex=function(h,n){const [q,u,v]=this._preallocSegments,t=null!=n.ascensionFactor?n.ascensionFactor:.5;n=Math.min(1-t,null!=n.ascensionFactor?n.descensionFactor:.5);const l=1-t-n;q.definition?q.definition.copyFrom(this.definition):q.definition=this.definition.clone();q.definition.compared.targetZoom=h;q.definition.compared.pan=
this.definition.compared.pan*t;q.definition.compared.rotate=this.definition.compared.rotate*t;q.update();this._ascensionSegment=q;this.segments.push(q);0<l&&(u.definition?u.definition.copyFrom(this.definition):u.definition=this.definition.clone(),u.definition.copyFrom(this.definition),u.definition.compared.sourceZoom=h,u.definition.compared.targetZoom=h,u.definition.compared.pan=this.definition.compared.pan*l,u.definition.compared.rotate=this.definition.compared.rotate*l,u.update(),this.segments.push(u));
v.definition?v.definition.copyFrom(this.definition):v.definition=this.definition.clone();v.definition.compared.sourceZoom=h;v.definition.compared.pan=this.definition.compared.pan*n;v.definition.compared.rotate=this.definition.compared.rotate*n;v.update();this._descensionSegment=v;this.segments.push(v)};e._updateWithoutApex=function(){const [h]=this._preallocSegments;h.update(this.definition);this.segments.push(h)};return d}(p.Path);a.Path=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(){this.segments=[]}var f=p.prototype;f.interpolateComponentsAt=function(k,c){k=Math.min(Math.max(k,0),1);k*=this.time;var d=0,e=0;const h=this.definition;for(let n=0;n<this.segments.length;n++){const q=this.segments[n],u=q.definition;if(k<=q.time||n===this.segments.length-1)return c=this.segmentInterpolateComponentsAt(q,k/q.time,c),c.pan=h.hasPan?
(d+u.compared.pan*c.pan)/h.compared.pan:1,c.rotate=h.hasRotate?(e+u.compared.rotate*c.rotate)/h.compared.rotate:1,k=c.zoom*(u.compared.targetZoom-u.compared.sourceZoom)+u.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,e=this.segments[this.segments.length-1].definition.compared.targetZoom,c.zoom=h.hasZoom?(k-d)/(e-d):1,c;k-=q.time;d+=u.compared.pan;e+=u.compared.rotate}};f.segmentInterpolateComponentsAt=function(k,c,d){return k.interpolateComponentsAt(c,d)};g._createClass(p,
[{key:"time",get:function(){return this.segments.reduce((k,c)=>k+c.time,0)}}]);return p}();a.Path=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k){k&&this.update(k)}var f=p.prototype;f.update=function(k){k&&(this.definition?this.definition.copyFrom(k):this.definition=k.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};
f._updatePrecomputedVariables=function(){var k=this.definition;const c=k.compared,d=c.sourceZoom,e=c.targetZoom;this._zoomSign=d>e?1:-1;this._panPixelsAtSource=c.pan*k.source.pixelsPerPanAtZoom(d);k=(k.source.pixelsPerRotateAtZoom(d)+k.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=c.rotate*k};f._updatePixelFlow=function(){var k=this.definition.compared.sourceZoom,c=this.definition.compared.targetZoom;const {hasZoom:d,hasPan:e,hasRotate:h}=this.definition;var n=0,q=0;d&&(e&&(n=(c/k-1)/(-1/
(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),h&&(q=Math.log(k/c)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;k=this.definition.desiredPixelFlow;d&&e&&h?(c=n+q+n*q,this._zoomPixelFlow=n*q/c*k,this._panPixelFlow=q/c*k,this._rotatePixelFlow=n/c*k):d&&e?(q=1+n,this._zoomPixelFlow=n/q*k,this._panPixelFlow=1/q*k):d&&h?(n=1+q,this._zoomPixelFlow=q/n*k,this._rotatePixelFlow=
1/n*k):e&&h?(n=this._panPixelsAtSource/this._rotatePixels,q=1+n,this._panPixelFlow=n/q*k,this._rotatePixelFlow=1/q*k):e?this._panPixelFlow=k:d?this._zoomPixelFlow=k:h&&(this._rotatePixelFlow=k);this.time=h?this.rotateTime:d?this.zoomTime:e?this.panTime:0};f._interpolateComponentsZoom=function(k){if(0===k||1===k)return k;if(this.definition.hasZoom){const c=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(c*(c/d)**-k-c)/(d-c)}return k};f._interpolateComponentsPan=function(k){if(0===
k||1===k)return k;if(this.definition.hasPan&&this.definition.hasZoom){const c=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(c*k*this.time)-1)/(c*Math.LN2)}return k};f._interpolateComponentsRotate=function(k){return k};f.interpolateComponentsAt=function(k,c){k=Math.min(Math.max(k,0),1);const d=this._interpolateComponentsZoom(k),e=this._interpolateComponentsPan(k);k=this._interpolateComponentsRotate(k);c?(c.zoom=d,c.pan=
e,c.rotate=k):c={zoom:d,pan:e,rotate:k};return c};g._createClass(p,[{key:"zoomTime",get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const k=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*
k+1)/(k*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}},{key:"rotateTime",get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}}]);return p}();a.Segment=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,g){function b(p,f){const k=Math.max(p.compared.sourceZoom,p.compared.targetZoom);p=p.source.zoomAtPixelsPerPan(p.desiredPixelFlow/
p.compared.pan)/2;return p<k?null!=f.maximumDistance?k+(f.maximumDistance-k)/2:1.5*k:f.maximumDistance?Math.min(f.maximumDistance,p):p}a.optimalDistance=function(p,f){let k=b(p,f);const c={ascensionFactor:null!=f.ascensionFactor?f.ascensionFactor:.5,descensionFactor:null!=f.descensionFactor?f.descensionFactor:.5};var d=0===c.ascensionFactor,e=0===c.descensionFactor;const h=d?g.tAscensionZoomOnly:g.tAscensionZoomPan,n=d?g.dtAscensionZoomOnly:g.dtAscensionZoomPan,q=d?g.ddtAscensionZoomOnly:g.ddtAscensionZoomPan,
u=e?g.tDescensionZoomOnly:g.tDescensionZoomPan,v=e?g.dtDescensionZoomOnly:g.dtDescensionZoomPan,t=e?g.ddtDescensionZoomOnly:g.ddtDescensionZoomPan;d=C=>h(p,C,c)+g.tPanion(p,C,c)+u(p,C,c);e=C=>n(p,C,c)+g.dtPanion(p,C,c)+v(p,C,c);const l=C=>q(p,C,c)+g.ddtPanion(p,C,c)+t(p,C,c);let w=d(k);const y=g.tBaseLine(p),D=f.maximumIterations||20,z=null!=f.maximumDistance?f.maximumDistance:Infinity;for(f=0;f<D;f++){var r=(e(k)+1E-6)/l(k);if(isNaN(r)||k>=z&&0>r){if(!isFinite(z))return null;k=z;w=d(k);break}k-=
r;if(k<p.compared.sourceZoom||k<p.compared.targetZoom)return null;r=d(k);if(.005>=Math.abs(r-w)/w)break;w=r}return w>.7*y||k<p.compared.sourceZoom||k<p.compared.targetZoom?null:k};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(g,b){return-g.halfWindowSize/(b*b*g.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(g,b,p){const f=b-g.compared.sourceZoom,k=1/f,c=1/
b,d=Math.log(g.compared.sourceZoom*c);p=(p.ascensionFactor*Math.LN2*g.compared.pan+g.halfWindowPanAtZoom(f))/g.halfWindowPanAtZoom(1);return g.halfWindowSize*k*(-2*k*c*p+2*k*d+2*c-2*d*p/(f*f)-p/(b*b))/(g.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(g,b){return-g.halfWindowSize/(b*b*g.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(g,b,p){const f=b-g.compared.targetZoom,k=1/f,c=1/b,d=Math.log(b/g.compared.targetZoom);p=(g.halfWindowPanAtZoom(b)+p.descensionFactor*Math.LN2*
g.compared.pan-g.halfWindowPanAtZoom(g.compared.targetZoom))/g.halfWindowPanAtZoom(1);return g.halfWindowSize*k*(-2*k*c*p-2*k*d+2*c+2*d*p/(f*f)-p/(b*b))/(g.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(g,b,p){return-2*g.compared.pan*g.halfWindowSize*(p.ascensionFactor+p.descensionFactor-1)/(g.desiredPixelFlow*g.halfWindowPanAtZoom(b*b*b))};a.dtAscensionZoomOnly=function(g,b){return g.halfWindowSize/(b*g.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(g,b,p){const f=1/b,k=Math.log(g.compared.sourceZoom*
f),c=1/g.desiredPixelFlow,d=1/Math.LN2;b-=g.compared.sourceZoom;const e=1/b;p=(p.ascensionFactor*Math.LN2*g.compared.pan+g.halfWindowPanAtZoom(b))/g.halfWindowPanAtZoom(1);return g.halfWindowSize*f*c*d*e*p-g.halfWindowSize*k*c*d*e+g.halfWindowSize*k*c*d*p/(b*b)};a.dtDescensionZoomOnly=function(g,b){return g.halfWindowSize/(b*g.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(g,b,p){const f=Math.log(b/g.compared.targetZoom),k=1/g.desiredPixelFlow,c=1/Math.LN2,d=-b+g.compared.targetZoom,e=
1/d;p=(-g.halfWindowPanAtZoom(b)-p.descensionFactor*Math.LN2*g.compared.pan+g.halfWindowPanAtZoom(g.compared.targetZoom))/g.halfWindowPanAtZoom(1);return-g.halfWindowSize*f*k*c*e+g.halfWindowSize*f*k*c*p/(d*d)+g.halfWindowSize*k*c*e*p/b};a.dtPanion=function(g,b,p){return g.compared.pan*g.halfWindowSize*(p.ascensionFactor+p.descensionFactor-1)/(g.desiredPixelFlow*g.halfWindowPanAtZoom(b*b))};a.tAscensionZoomOnly=function(g,b){return-g.halfWindowSize*Math.log(g.compared.sourceZoom/b)/(g.desiredPixelFlow*
Math.LN2)};a.tAscensionZoomPan=function(g,b,p){const f=g.halfWindowPanAtZoom(b-g.compared.sourceZoom);return-g.halfWindowSize*(p.ascensionFactor*Math.LN2*g.compared.pan+f)*Math.log(g.compared.sourceZoom/b)/(g.desiredPixelFlow*Math.LN2*f)};a.tBaseLine=function(g){const b=Math.LN2*g.compared.pan,p=g.halfWindowPanAtZoom(g.compared.sourceZoom-g.compared.targetZoom),f=g.halfWindowSize*Math.log(g.compared.sourceZoom/g.compared.targetZoom)/(g.desiredPixelFlow*Math.LN2*p);return g.compared.sourceZoom<=g.compared.targetZoom?
f*(b-p):f*(b+p)};a.tDescensionZoomOnly=function(g,b){return g.halfWindowSize*Math.log(b/g.compared.targetZoom)/(g.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(g,b,p){return g.halfWindowSize*(-g.halfWindowPanAtZoom(b)-p.descensionFactor*Math.LN2*g.compared.pan+g.halfWindowPanAtZoom(g.compared.targetZoom))*Math.log(b/g.compared.targetZoom)/(g.desiredPixelFlow*Math.LN2*g.halfWindowPanAtZoom(-b+g.compared.targetZoom))};a.tPanion=function(g,b,p){return-g.compared.pan*g.halfWindowSize*(p.ascensionFactor+
p.descensionFactor-1)/(g.desiredPixelFlow*g.halfWindowPanAtZoom(b))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.AnimationController=function(w){function y(){return w.apply(this,arguments)||this}g._inheritsLoose(y,w);var D=y.prototype;D.onControllerStart=function(){this.state=l.State.Running;f.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};D.updateStateFromViewAnimation=function(){!f.isSome(this.viewAnimation)||this.state!==l.State.Ready&&this.state!==l.State.Running||(this.viewAnimation.state===
t.State.FINISHED?this.finish():this.viewAnimation.state===t.State.STOPPED&&(this.state=l.State.Stopped))};D.onControllerEnd=function(){f.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===l.State.Finished?this.viewAnimation.finish():this.state===l.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(v.createAbortError()))};D.finish=function(){this.finishController()};g._createClass(y,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(z){this._asyncResult&&(this._asyncResult.reject(v.createAbortError()),this._asyncResult=null);this.state===l.State.Finished||this.state===l.State.Stopped?this.state===l.State.Finished?z.resolve():z.reject(v.createAbortError()):this._asyncResult=z}}]);return y}(l.CameraController);a.AnimationController=b.__decorate([h.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){(function(v){v.Ready="ready";v.Rejected="rejected";v.Running="running";v.Stopped="stopped";v.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(v){function t(){var w=v.apply(this,arguments)||this;w.state=a.State.Ready;return w}g._inheritsLoose(t,v);var l=t.prototype;l.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};l.finishController=function(){this.state=a.State.Finished};g._createClass(t,[{key:"active",get:function(){return this.state===
a.State.Running}},{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return t}(u);b.__decorate([c.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([c.property()],a.CameraController.prototype,"state",void 0);a.CameraController=b.__decorate([e.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/stack ../../../../chunks/vector ../../support/geometryUtils ../../webgl-engine/lib/Camera ../../support/geometryUtils/coordinateSystem".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){function w(da,oa,qa){const ua=q.sm4d.get();d.identity(ua);d.rotate(ua,ua,qa[3],v.axisAngle.axis(qa));k.subtract(da.eye,da.eye,oa);k.transformMat4(da.eye,da.eye,ua);k.add(da.eye,da.eye,oa);k.subtract(da.center,da.center,oa);k.transformMat4(da.center,da.center,ua);k.add(da.center,da.center,oa);k.transformMat4(da.up,da.up,ua);da.markViewDirty()}function y(da,oa){k.set(oa,0,0,0);for(const qa of da)k.add(oa,oa,qa);k.scale(oa,oa,1/da.length)}function D(da,oa,qa,
ua){return Math.sin(da/k.length(oa))*(qa+ua.radius)}function z(da,oa,qa,ua){qa=v.ray.fromScreenAtEye(oa,qa,ha);if(g.isNone(qa))return!1;v.sphere.closestPointOnSilhouette(da,qa,Q);return v.sphere.intersectRay(da,qa,ua)?k.squaredDistance(Q,qa.origin)<k.squaredDistance(ua,qa.origin)?(k.copy(ua,Q),!1):!0:(k.subtract(X,oa.eye,oa.center),k.normalize(X,X),v.plane.fromNormalAndOffset(X,-k.dot(k.normalize(X,X),Q),aa),v.plane.intersectRay(aa,qa,ua),!1)}function r(da,oa,qa,ua,Ca,Ja){k.cross(la,da,oa);k.subtract(M,
da,oa);k.length(da)<=Ca||!ua.aboveGround?(k.cross(qa,M,ua.eye),da=k.dot(da,oa)/(k.length(da)*k.length(oa)),Ja=Math.cos(b.clamp(c.cyclicalPI.normalize(b.deg2rad(Ja)),0,L)),oa=-b.acosClamped(da)-Math.max(0,k.length(oa)-Ca)/(Ja*Ca)):(k.subtract(S,ua.eye,ua.center),k.cross(qa,M,S),oa=-k.length(M)/Ca);k.normalize(qa,qa);k.scale(qa,qa,k.length(la));return oa}function C(da,oa,qa,ua){ua=Math.cos(b.clamp(c.cyclicalPI.normalize(b.deg2rad(ua)),0,L));oa=oa>qa?-(oa-qa)/(ua*qa):oa<-qa?Math.PI-(oa+qa)/(ua*qa):b.acosClamped(oa/
qa);return((da>qa?-(da-qa)/(ua*qa):da<-qa?Math.PI-(da+qa)/(ua*qa):b.acosClamped(da/qa))-oa)*qa}function A(da,oa,qa,ua,Ca,Ja,Ha,Na,Oa,Va){Oa=C(da[2],oa[2],Ha[3],Oa);oa=Va?C(da[0],oa[0],Ha[3],180):oa[0]-da[0];da=Math.sin(Na)*oa-Math.cos(Na)*Oa;Na=Math.cos(Na)*oa+Math.sin(Na)*Oa;k.normalize(ea,Ca);Ca=Va?da/Math.sqrt(Math.abs(Ha[3]**2-k.dot(qa,ea)**2)):da/Ha[3];qa=Na/Math.sqrt(Math.abs(Ha[3]**2-k.dot(qa,ua)**2));n.set(Ja,Ca,qa)}function x(da,oa,qa,ua,Ca,Ja,Ha,Na,Oa,Va){k.cross(la,da,oa);l.coordinateSystemFromOneAxisAndNormalVector(Ja.up,
Ja.eye,W,Y,U);l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ja.eye,H,R,T);k.copy(qa,R);k.copy(ua,H);k.normalize(qa,qa);k.scale(qa,qa,k.length(la));l.vectorCoordinates(da,k.normalize(Y,Y),k.normalize(U,U),k.normalize(W,W),N);l.vectorCoordinates(oa,Y,U,W,ca);A(N,ca,da,H,R,Ca,Ha,Na,Oa,Va)}function m(da,oa,qa,ua,Ca,Ja,Ha){d.identity(ba);d.identity(fa);d.identity(ia);d.rotate(ba,ba,Ca,ua);d.rotate(fa,fa,Ha,Ja);d.multiply(ia,ba,fa);k.subtract(oa,da,qa);k.transformMat4(oa,oa,ia);k.add(oa,oa,qa)}function B(da,
oa,qa,ua,Ca,Ja){d.identity(ba);d.identity(fa);d.identity(ia);d.rotate(ba,ba,ua,qa);d.rotate(fa,fa,Ja,Ca);d.multiply(ia,ba,fa);k.subtract(da.eye,da.eye,oa);k.transformMat4(da.eye,da.eye,ia);k.add(da.eye,da.eye,oa);k.subtract(da.center,da.center,oa);k.transformMat4(da.center,da.center,ia);k.add(da.center,da.center,oa);k.subtract(da.up,da.up,oa);k.transformMat4(da.up,da.up,ia);k.add(da.up,da.up,oa);da.markViewDirty()}function E(da,oa,qa,ua,Ca,Ja,Ha=J.Pole,Na=J.Angle){da=Math.abs(da[2])<qa*Ha||Math.abs(oa)>
qa;return(Math.abs(ua)>Math.PI-Na||Math.abs(ua)<Na)&&da&&Ja.aboveGround&&Ca<J.Tilt?!0:!1}function F(da,oa,qa,ua,Ca,Ja){Ja?(v.axisAngle.fromPoints(qa,ua,V),w(oa,da,V)):(qa=r(qa,ua,ka,oa,da[3],Ca),w(oa,da,v.axisAngle.wrapAxisAngle(ka,qa)))}function G(da,oa,qa,ua,Ca,Ja,Ha){const Na=Ha?20:1;k.copy(ma,ua);Z.copyFrom(oa);let Oa;for(let Va=0;Va<Na&&1E-12<k.squaredDistance(qa,ma);Va++)if(ua=k.squaredDistance(qa,ma),x(qa,ma,R,H,O,Z,da,Ca,Ja,Ha),B(Z,da,H,O[1],R,O[0]),m(ma,ma,da,H,O[1],R,O[0]),Oa=k.squaredDistance(qa,
ma),Oa<ua||0===Va)oa.copyFrom(Z);else break}const I=p.createScreenPointArray();(function(da){da[da.Vertical=0]="Vertical";da[da.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const K={Elevation:3E4,Angle:b.deg2rad(6)},J={Pole:.95,Angle:b.deg2rad(18),Tilt:45},L=b.deg2rad(80),P=f.create(),Q=f.create(),X=f.create(),aa=v.plane.create(),S=f.create(),H=f.create(),R=f.create(),T=f.create(),W=f.create(),Y=f.create(),U=f.create(),N=f.create(),ca=f.create(),O=h.create(),V=v.axisAngle.create(),
ba=e.create(),fa=e.create(),ia=e.create(),ma=f.create(),ea=f.create(),M=f.create(),Z=new t,la=f.create(),ka=f.create(),ha={origin:f.create(),direction:f.create()},na={origin:f.create(),direction:f.create()};a.PreservingHeadingThreshold=J;a.TiltThresholdPanningSpeed=L;a.VerticalPanTresholds=K;a.applyPanPlanar=function(da,oa,qa){k.subtract(P,qa,oa);k.subtract(da.eye,da.eye,P);k.subtract(da.center,da.center,P);da.markViewDirty()};a.applyPanSphericalDirectRotation=F;a.applyPanSphericalPreserveHeading=
G;a.applyRotation=w;a.applyRotationWithTwoAxes=B;a.applyZoomOnSphere=function(da,oa,qa){oa.getScreenCenter(I);v.sphere.intersectScreen(da,oa,I,oa.center);oa.markViewDirty();da=oa.distance;qa*=da;1E-6>Math.abs(da-qa)||(qa=k.scale(q.sv3d.get(),oa.viewForward,qa),k.subtract(oa.eye,oa.center,qa),oa.markViewDirty())};a.applyZoomToPoint=function(da,oa,qa,ua){const Ca=q.sv3d.get();qa=1-qa;k.subtract(Ca,oa,da.eye);const Ja=k.length(Ca);let Ha=Ja*(1-qa);0<=qa&&Ha<ua&&(Ha=ua,qa=-(Ha-Ja)/Ja);1E-6>Math.abs(Ja-
Ha)||(k.scale(Ca,Ca,qa),k.add(da.eye,da.eye,Ca),k.lerp(da.center,da.center,oa,qa))};a.centroid=y;a.centroidOnSphere=function(da,oa,qa){y(oa,qa);k.normalize(qa,qa);k.scale(qa,qa,da)};a.decideNavigationMode=function(da,oa,qa,ua){if(k.length(da.eye)-ua.radius>K.Elevation)return a.NavigationMode.Horizontal;if(!qa)return a.NavigationMode.Vertical;v.ray.fromScreenAtEye(da,oa,na);return-b.sign(da.relativeElevation)*(.5*Math.PI+u.angle(da.eye,na.direction))<K.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};
a.intersectPlaneFromScreenPoint=function(da,oa,qa,ua){return v.plane.intersectRay(da,v.ray.fromScreen(oa,qa,ha),ua)};a.lengthFromPoints=C;a.normalizeCoordinate=function(da,oa,qa){qa[0]=oa[0]/(da.fullWidth/da.pixelRatio);qa[1]=oa[1]/(da.fullHeight/da.pixelRatio);return qa};a.normalizeRotationDelta=function(da){for(;da>Math.PI;)da-=2*Math.PI;for(;da<-Math.PI;)da+=2*Math.PI;return da};a.offSurfaceTiltToEyeTiltGlobal=function(da,oa,qa,ua){return D(Math.PI/2,oa,qa,ua)+(da-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=
D;a.panMotionToRotationMatrix=function(da,oa,qa,ua,Ca,Ja,Ha,Na,Oa){if(E(da.center,k.dot(da.up,da.center),k.length(da.center),-c.cyclicalPI.normalize(b.deg2rad(Ja)),Ha,oa))switch(da=-c.cyclicalPI.normalize(b.deg2rad(Ca)),{eye:Ca}=oa,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ca,H,R,T),Ca=qa.translation[0]*ua.pan,Ja="zoom"===Oa.mode?0:qa.translation[1]*ua.pan,oa=Math.max(Math.sqrt(Math.abs(1-k.dot(oa.center,H)**2/k.length(oa.center)**2)),.5),Ha=-Math.cos(da)*Ja+Math.sin(da)*Ca,d.rotate(Na.pan.matrix,
Na.pan.matrix,(Math.sin(da)*Ja+Math.cos(da)*Ca)/oa,H),Na.pan.enabled=!0,Oa.mode){case "pan":d.rotate(Na.pan.matrix,Na.pan.matrix,Ha,R);Na.pan.enabled=!0;break;case "zoom":Na.zoom=-qa.translation[1]*ua.zoom}else{{const {eye:Va,viewRight:Ka}=oa;oa=k.cross(q.sv3d.get(),Ka,Va);da=qa.translation[0]*ua.pan;0!==da&&(d.rotate(Na.pan.matrix,Na.pan.matrix,-da,oa),Na.pan.enabled=!0);switch(Oa.mode){case "pan":qa=qa.translation[1]*ua.pan;0!==qa&&(d.rotate(Na.pan.matrix,Na.pan.matrix,qa,Ka),Na.pan.enabled=!0);
break;case "zoom":Na.zoom=-qa.translation[1]*ua.zoom}}}};a.panToPosition=function(da,oa,qa,ua,Ca,Ja,Ha){E(qa,k.dot(oa.up,qa),da[3],-c.cyclicalPI.normalize(b.deg2rad(Ca)),Ja,oa,J.Pole,J.Angle)?G(da,oa,qa,ua,-c.cyclicalPI.normalize(b.deg2rad(Ca)),Ja,Ha):F(da,oa,qa,ua,Ja,Ha)};a.pickPointAndInitSphere=function(da,oa,qa,ua,Ca){const Ja=f.create(),Ha=v.sphere.create();let Na=!0,Oa=!0;da.intersectScreen(qa,Ja)?Ha[3]=k.length(Ja):(Oa=!1,Ha[3]=oa.aboveGround?Math.max(k.length(oa.center),.9*Ca.radius):k.length(oa.eye)-
oa.relativeElevation,ua?z(Ha,oa,qa,Ja):Na=v.sphere.intersectScreen(Ha,oa,qa,Ja));return{sphere:Ha,scenePickPoint:Na?Ja:null,hasGeometryIntersection:Oa}};a.preserveHeadingThreshold=E;a.rotatePointAroundTwoAxes=m;a.rotationAngleAndAxisDirectRotation=r;a.rotationAnglesAndAxesHeadingPreserving=x;a.rotationAnglesHeadingPreserving=A;a.rotationFromPointsAroundAxis=function(da,oa,qa){const ua=q.sv3d.get(),Ca=q.sv3d.get(),Ja=q.sv3d.get();k.copy(Ca,da);k.copy(Ja,oa);da=k.dot(Ca,qa);oa=k.dot(Ja,qa);k.scale(ua,
qa,da);k.subtract(Ca,Ca,ua);k.normalize(Ca,Ca);k.scale(ua,qa,oa);k.subtract(Ja,Ja,ua);k.normalize(Ja,Ja);da=k.dot(Ca,Ja);k.cross(ua,qa,Ca);qa=k.dot(Ja,ua);return Math.atan2(qa,da)};a.sphereOrPlanePointFromScreenPoint=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define("exports ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../geometryUtils".split(" "),function(a,
g,b,p,f,k){function c(v){return{operations:v,value:v.create()}}function d(v,t,l=c(v)){l.operations=v;v.copy(t,l.value);return l}function e(v,t,l,w){return v.operations.setAltitudeAt(v.value,t,l,w)}const h=2**50,n=g.create(),q={operations:null,value:null},u=g.create();a.altitudeAt=function(v,t){return v.operations.altitudeAt(v.value,t)};a.axisAt=function(v,t,l,w){return v.operations.axisAt(v.value,t,l,w)};a.closestPoint=function(v,t,l){return v.operations.closestPoint(v.value,t,l)};a.closestPointOnSilhouette=
function(v,t,l){return v.operations.closestPointOnSilhouette(v.value,t,l)};a.coordinateSystemFromOneAxisAndNormalVector=function(v,t,l,w,y){b.copy(l,v);b.copy(u,t);b.normalize(u,u);b.cross(w,u,l);b.cross(y,w,l)};a.create=function(v){const {value:t,operations:l}=v;return{operations:l,value:l.create(t)}};a.createFromOperations=c;a.createGlobal=function(v){return d(k.sphere,k.sphere.fromValues(0,0,0,p.getReferenceEllipsoid(v).radius))};a.createLocal=function(){return d(k.boundedPlane,k.boundedPlane.fromValues([0,
0,0],[h,0,0],[0,h,0]))};a.distanceToSilhouette=function(v,t){return v.operations.distanceToSilhouette(v.value,t)};a.elevate=function(v,t,l){return v.operations.elevate(v.value,t,l.value)};a.fromValues=d;a.intersectRay=function(v,t,l){return v.operations.intersectRay(v.value,t,l)};a.intersectRayClosestSilhouette=function(v,t,l){return v.operations.intersectRayClosestSilhouette(v.value,t,l)};a.intersectsRay=function(v,t){return v.operations.intersectRay(v.value,t,null)};a.normalAt=function(v,t,l){return v.operations.axisAt(v.value,
t,2,l)};a.setAltitudeAt=e;a.setAltitudeOfTransformation=function(v,t,l,w){t!==w&&f.copy(w,t);b.set(n,w[12],w[13],w[14]);e(v,n,l,n);w[12]=n[0];w[13]=n[1];w[14]=n[2];return w};a.setExtent=function(v,t,l){v.operations.setExtent(v.value,t,l.value);return l};a.vectorCoordinates=function(v,t,l,w,y){y[0]=b.dot(v,t);y[1]=b.dot(v,l);y[2]=b.dot(v,w);return y};a.wrap=function(v,t){q.operations=v;q.value=t;return q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../support/featureFlags ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../PointToPointAnimationController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){a.ZoomStepController=function(r){function C(){var x=r.apply(this,arguments)||this;x.zoomLocation=u.create();x.tmpCamera=new D;x.tmpRayDir=u.create();x.tmpCenter=u.create();x.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new D,interactionDirection:null,tiltMode:0};return x}g._inheritsLoose(C,r);var A=C.prototype;A.zoomStep=function(x,m){if(this.active){var B=this.view.state,{interactionStartCamera:E}=
this.constraintOptions;this.animation.finished?E.copyFrom(B.camera):this.animation.cameraAt(1,E);this.tmpCamera.copyFrom(B.camera);B=new l.Intersector(this.view.state.mode);0<x?(this.intersectionHelper.intersectScreenFreePointFallback(m,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,B,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,B,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:v.copy(this.zoomLocation,
this.tmpCamera.center);x=.6**x;!t.disableContextNavigation()&&(m=this.view._stage.renderView.getMinimalDepthForArea(m[0],m[1],this.view._stage.camera,60),B=Math.max(14*Math.abs(this.view.camera.position.z),20),m=m?Math.min(m,B):B)&&(B=u.create(),v.subtract(B,this.zoomLocation,this.tmpCamera.eye),m<v.length(B)&&(v.normalize(B,B),v.add(this.zoomLocation,this.tmpCamera.eye,v.scale(B,B,m))));this.updateCamera(this.tmpCamera,x,this.zoomLocation);this.begin(this.tmpCamera)}};A.animationSettings=function(){return{apex:null,
duration:.6,easing:w.outExpo}};A.updateCamera=function(x,m,B){v.subtract(this.tmpRayDir,B,x.eye);const E=v.length(this.tmpRayDir);let F=E*m;1>=m&&4>F&&(F=4,m=F/E);1E-6>Math.abs(E-F)||(v.scale(this.tmpRayDir,this.tmpRayDir,m),v.subtract(x.eye,B,this.tmpRayDir),v.lerp(x.center,x.center,B,1-m),y.applyAll(this.view,x,this.constraintOptions))};return C}(z.PointToPointAnimationController);a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/RotateController".split(" "),function(a,g,b,p,f,k){p=function(c){function d(e,h,n,q){var u=c.call(this,!0)||this;u.view=e;u.pointerAction=h;u.pivotPoint=n;u.registerIncoming("drag",q,v=>u.handleDrag(v));return u}g._inheritsLoose(d,
c);d.prototype.handleDrag=function(e){const h=e.data;if(!(1<h.pointers.size)&&f.eventMatchesMousePointerAction(e.data,this.pointerAction)){var n=b.createScreenPointArray(h.center.x,h.center.y);switch(h.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new k.RotateController({view:this.view,pivot:this.pivotPoint});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(n);break;case "update":this.cameraController&&
this.cameraController.update(n);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}};return d}(p.InputHandler);a.DragRotate=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../Constraints ../../camera/constraintUtils ../utils/navigationUtils ./InteractiveController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){a.RotateController=function(B){function E(G){G=B.call(this,G)||this;G.view=null;G.pivot="center";G.lastPoint=z.create();G.tmpWorldUp=t.create();G.tmpViewDir=t.create();G.tmpRotCurPoint=z.create();G.tmpTransf=D.create();G.tmpAxis=t.create();G.tmpPivotPoint=t.create();G.pivotPos=t.create();G.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return G}g._inheritsLoose(E,
B);var F=E.prototype;F.initialize=function(){this.rotScale="center"===this.pivot?3:1.5};F.begin=function(G){if(this.active){switch(this.pivot){case "eye":l.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||l.copy(this.pivotPos,this.beginCamera.center),p("disable-feature:context-navigation")||
this.constrainPivotPoint(G),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;x.normalizeCoordinate(this.beginCamera,G,this.lastPoint)}};F.constrainPivotPoint=function(G){const I=this.beginCamera,K=t.create();var J;l.subtract(K,this.pivotPos,I.eye);this.view.camera.position.hasZ&&(J=Math.abs(this.view.camera.position.z));let L=l.length(K);
this.view.camera.position.hasZ&&L>7*J&&(L=7*J);J=w.getReferenceEllipsoid(this.view.spatialReference);var P=v.createScreenPointArray(I.width/I.pixelRatio*.5,I.height/I.pixelRatio*.5);J=x.decideNavigationMode(this.beginCamera,P,!0,J);P=this.view._stage.renderView.getMinimalDepthForArea(I.fullWidth/I.pixelRatio*.5,I.fullHeight/I.pixelRatio*.5,I,90,2.5);G=this.view._stage.renderView.getMinimalDepthForArea(G[0],G[1],I,90);if(void 0!==P||void 0!==G)P=void 0===P?G:P,G=void 0===G||J===x.NavigationMode.Horizontal?
P:G,L=P>G?G:P;l.normalize(K,K);l.copy(this.pivotPos,l.add(this.tmpPivotPoint,I.eye,l.scale(this.tmpPivotPoint,K,L)))};F.update=function(G){if(this.active){switch(this.pivot){case "eye":var I=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,I=this.currentCamera.eye}this.applyRotation(this.currentCamera,G,I,this.pivotPos);A.applyAll(this.view,this.currentCamera,this.constraintOptions)}};F.end=function(){this.active&&this.finishController()};F.applyRotation=function(G,
I,K,J){this.view.renderCoordsHelper.worldUpAtPosition(J,this.tmpWorldUp);x.normalizeCoordinate(G,I,this.tmpRotCurPoint);I=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let L=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;l.subtract(this.tmpViewDir,K,J);var P=l.length(this.tmpViewDir);P=u.acosClamped(l.dot(this.tmpViewDir,this.tmpWorldUp)/P);if("eye"===this.pivot){const Q=.5*Math.PI-P,X=.495*Math.PI;I=Q-Math.max(-X,Math.min(X,Q+-.5*I))}I=u.clamp(I+P,C.TiltDefault.min,C.TiltDefault.max)-
P;y.identity(this.tmpTransf);l.cross(this.tmpAxis,G.up,this.tmpViewDir);"center"===this.pivot&&(L=-L);y.rotate(this.tmpTransf,this.tmpTransf,L,this.tmpWorldUp);y.rotate(this.tmpTransf,this.tmpTransf,I,this.tmpAxis);l.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);l.add(K,J,this.tmpViewDir);l.transformMat4(G.up,G.up,this.tmpTransf);r.copy(this.lastPoint,this.tmpRotCurPoint);G.markViewDirty()};g._createClass(E,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return E}(m.InteractiveController);b.__decorate([c.property({constructOnly:!0})],a.RotateController.prototype,"view",void 0);b.__decorate([c.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([e.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../webgl-engine/lib/Camera ./CameraController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){a.InteractiveController=function(t){function l(){var y=t.apply(this,arguments)||this;y.beginCamera=new u;y.currentCamera=new u;return y}g._inheritsLoose(l,t);var w=l.prototype;w.stepController=function(y,D){D.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(D)};w.onControllerStart=function(y){this.state=v.State.Running;this.beginCamera.copyFrom(y);this.currentCamera.copyFrom(y)};w.onControllerEnd=function(y){y.copyViewFrom(this.currentCamera)};g._createClass(l,
[{key:"isInteractive",get:function(){return!0}}]);return l}(v.CameraController);a.InteractiveController=b.__decorate([e.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController".split(" "),
function(a,g,b,p,f,k,c){p=function(d){function e(h,n,q){var u=d.call(this,!0)||this;u.view=h;u.pointerAction=n;u.registerIncoming("drag",q,v=>u.handleDrag(v));return u}g._inheritsLoose(e,d);e.prototype.handleDrag=function(h){const n=h.data;if(!(1<n.pointers.size)&&f.eventMatchesMousePointerAction(h.data,this.pointerAction)){var q=b.createScreenPointArray(n.center.x,n.center.y);switch(n.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new k.ZoomController({view:this.view}):new c.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(q);break;case "update":this.cameraController&&this.cameraController.update(q);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}h.stopPropagation()}};return e}(p.InputHandler);a.DragZoom=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/vec2f64 ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils ../../utils/navigationUtils ../InteractiveController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){a.ZoomController=function(x){function m(E){E=x.call(this,E)||this;E.view=null;E.pickPoint=v.create();E.tmpP0=w.create();E.panAxisAngle=D.axisAngle.create();E.tmpRayDir=v.create();E.targetOnSphere=v.create();E.tmpRay={origin:v.create(),direction:v.create()};E.dragBeginPoint=u.createScreenPointArray();E.normalizedAnchorPoint=w.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};E.sphere=D.sphere.create();E.hasPickPoint=!1;return E}g._inheritsLoose(m,x);var B=m.prototype;B.begin=function(E){if(this.active){y.copy(this.dragBeginPoint,E);C.normalizeCoordinate(this.beginCamera,E,this.normalizedAnchorPoint);var F=l.getReferenceEllipsoid(this.view.spatialReference),G=C.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,E,!1,F);this.navMode=C.decideNavigationMode(this.beginCamera,E,G.hasGeometryIntersection,F);if(this.navMode===C.NavigationMode.Horizontal||
p("disable-feature:context-navigation"))this.hasPickPoint=!!G.scenePickPoint,this.pickPoint=G.scenePickPoint,this.sphere=G.sphere;else{D.ray.fromScreenAtEye(this.beginCamera,E,this.tmpRay);t.normalize(this.tmpRay.direction,this.tmpRay.direction);let I;this.view.camera.position.hasZ&&(I=Math.abs(this.view.camera.position.z));F=30*I;E=this.view._stage.renderView.getMinimalDepthForArea(E[0],E[1],this.view._stage.camera,70);F=F>E?E:F;this.hasPickPoint=!0;t.scale(this.tmpRay.direction,this.tmpRay.direction,
F);t.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.beginCamera}};B.update=function(E){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;if(this.navMode===C.NavigationMode.Horizontal||p("disable-feature:context-navigation")){t.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var F=t.length(this.tmpRayDir);C.normalizeCoordinate(this.currentCamera,
E,this.tmpP0);var G=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),I=F*2**G;const K=this.view.state.constraints.minimumPoiDistance;0>G&&I<K&&(I=K);if(1E-6>Math.abs(F-I))return;this.hasPickPoint&&I<F&&(G=1-(1-I/F)*(1-this.sphere[3]/t.length(this.currentCamera.center)),t.scale(this.currentCamera.center,this.currentCamera.center,G));t.scale(this.tmpRayDir,this.tmpRayDir,-I/F);t.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(this.dragBeginPoint,
E);r.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&(C.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),D.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),C.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{F=t.length(this.tmpRay.direction);C.normalizeCoordinate(this.currentCamera,E,this.tmpP0);E=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);I=F*2**E;G=this.view.state.constraints.minimumPoiDistance;
0>E&&I<G&&(I=G);if(1E-6>Math.abs(F-I))return;t.scale(this.tmpRayDir,this.tmpRay.direction,1-I/F);t.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir);t.add(this.currentCamera.center,this.currentCamera.center,this.tmpRayDir)}z.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};B.end=function(){this.active&&this.finishController()};g._createClass(m,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return m}(A.InteractiveController);b.__decorate([c.property({constructOnly:!0})],
a.ZoomController.prototype,"view",void 0);a.ZoomController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/vec2f64 ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils ../../utils/navigationUtils ../InteractiveController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C){a.ZoomController=function(A){function x(B){B=A.call(this,B)||this;B.view=null;B.tmpP=t.create();B.tmpDir=t.create();B.tmpN=t.create();B.tmpP0=w.create();B.tmpPoi=t.create();B.tmpRayDir=t.create();B.dragBeginPoint=v.createScreenPointArray();B.normalizedAnchorPoint=w.create();B.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:t.create(),tiltMode:0};B.plane=D.plane.create();return B}
g._inheritsLoose(x,A);var m=x.prototype;m.begin=function(B){if(this.active){y.copy(this.dragBeginPoint,B);r.normalizeCoordinate(this.beginCamera,B,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(B,this.tmpP);l.subtract(this.tmpDir,this.tmpP,this.beginCamera.eye);l.normalize(this.tmpDir,this.tmpDir);var E;this.view.camera.position.hasZ&&(E=Math.abs(this.view.camera.position.z));E*=30;B=this.view._stage.renderView.getMinimalDepthForArea(B[0],B[1],this.view._stage.camera,
70);l.scale(this.tmpDir,this.tmpDir,E>B?B:E);l.add(this.tmpP,this.beginCamera.eye,this.tmpDir);l.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center);l.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&l.negate(this.tmpN,this.tmpN);D.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.beginCamera}};m.update=function(B){if(this.active){r.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||
l.copy(this.tmpPoi,this.currentCamera.center);r.normalizeCoordinate(this.currentCamera,B,this.tmpP0);var E=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);y.copy(this.normalizedAnchorPoint,this.tmpP0);l.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var F=l.length(this.tmpRayDir),G=F*(1-E);l.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);l.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,u.sign(E)/F);var I=this.view.state.constraints.minimumPoiDistance;
0<=E&&G<I&&(G=I,E=-(G-F)/F);1E-6>Math.abs(F-G)||(l.scale(this.tmpRayDir,this.tmpRayDir,E),l.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),l.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,E),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=
z.pixelDistanceToInteractionFactor(this.dragBeginPoint,B),z.applyAll(this.view,this.currentCamera,this.constraintOptions))}};m.end=function(){this.active&&this.finishController()};g._createClass(x,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return x}(C.InteractiveController);b.__decorate([c.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],
a.ZoomController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../../input/InputHandler ../../state/controllers/GamepadKeyboardController".split(" "),function(a,g,b,p,f,k){f=function(c){function d(h){var n=c.call(this,!0)||this;n.view=h;n.watchHandles=new b;n.handle=n.registerIncoming("gamepad",q=>n.handleEventGamepad(q));
n.handle.pause();return n}g._inheritsLoose(d,c);var e=d.prototype;e.onInstall=function(h){c.prototype.onInstall.call(this,h);this.watchHandles.add([p.init(this.view.navigation.gamepad,"enabled",n=>{n?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",n=>{this.cameraControllerGamepad&&n&&this.cameraControllerGamepad.gamepadDevice!==n&&(this.cameraControllerGamepad.finishController(),
this.cameraControllerGamepad=null)})])};e.onUninstall=function(){this.watchHandles.removeAll();c.prototype.onUninstall.call(this)};e.handleEventGamepad=function(h){var n=this.view.navigation.gamepad.device;if(!n||h.data.device===n)if((n=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||k.GamepadKeyboardController.activatesFor(this.view,h.data))n||(n=new k.GamepadKeyboardController({view:this.view,gamepadDevice:h.data.device}),this.view.state.switchCameraController(n)&&(this.cameraControllerGamepad=
n)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===h.data.device&&this.cameraControllerGamepad.handleEventGamepad(h.data)};return d}(f.InputHandler);a.GamepadNavigation=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../navigation/gamepadAndKeyboardUtils ../Constraints ../../support/stack ../../support/geometryUtils ../utils/viewUtils ../../camera/constraintUtils ../../webgl-engine/lib/Camera ../utils/navigationUtils ./InteractiveController ../../support/cameraUtilsInternal ../../support/cameraUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J){a.GamepadKeyboardController=function(R){function T(Y){Y=R.call(this,Y)||this;Y.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};Y.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];Y.tmpCamera=new F;Y.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new F,interactionFactor:0,interactionDirection:null,tiltMode:1};return Y}g._inheritsLoose(T,R);var W=T.prototype;W.handleEventGamepad=function(Y){const U=
C.extractTransformation(Y,this.view.navigation.gamepad,this.transformation);("end"===Y.action||C.isZeroTransformation(U))&&this.finishController()};W.activateDirection=function(Y){this.keysButtonState[Y]=1;C.extractTransformationKeyboard(this.keysButtonState,this.transformation)};W.deactivateDirection=function(Y){this.keysButtonState[Y]=0;Y=C.extractTransformationKeyboard(this.keysButtonState,this.transformation);C.isZeroTransformation(Y)&&this.finishController()};W.onControllerStart=function(Y){this.filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;R.prototype.onControllerStart.call(this,Y)};W.updateFilteredSurfaceElevation=function(Y){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*Y};W.stepController=function(Y,U){this.updateStartHeading();this.updateFilteredSurfaceElevation(Y);this.currentCamera.copyViewFrom(U);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);
this.calculateControlTransformation(Y,this.currentCamera,aa);this.applyDisabledMovementTypes(aa);this.applyPan(aa.pan);this.applyRotate(aa.rotate);this.applyZoom(aa.zoom);this.applyAscend(aa.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;E.applyAll(this.view,this.currentCamera,this.constraintOptions);R.prototype.stepController.call(this,Y,U)};W.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};W.applyRotate=
function(Y){if(Y.enabled){var U=this.currentCamera,{center:N,up:ca,eye:O}=U;w.subtract(N,N,O);w.transformMat4(N,N,Y.matrix);w.add(N,N,O);w.transformMat4(ca,ca,Y.matrix);U.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;E.applyAll(this.view,U,this.constraintOptions)}};W.applyPan=function(Y,U=this.currentCamera){if(Y.enabled){var {center:N,eye:ca,up:O}=U;w.transformMat4(ca,ca,Y.matrix);w.transformMat4(N,N,Y.matrix);this.view.state.isGlobal&&w.transformMat4(O,
O,Y.matrix);U.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;E.applyAll(this.view,U,this.constraintOptions)}};W.applyZoom=function(Y){if(Y){var {eye:U,viewForward:N}=this.currentCamera;w.add(U,U,w.scale(x.sv3d.get(),N,Y));this.currentCamera.markViewDirty();w.copy(S,N);w.negate(S,S);this.constraintOptions.interactionDirection=S;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;E.applyAll(this.view,this.currentCamera,this.constraintOptions);
this.constraintOptions.interactionDirection=null}};W.applyAscend=function(Y){if(Y){var {center:U,eye:N}=this.currentCamera,ca=this.view.renderCoordsHelper.worldUpAtPosition(N,x.sv3d.get());this.constraintOptions.interactionDirection=w.copy(S,ca);this.view.state.isGlobal?(ca=w.length(N),Y=(ca+Y)/ca,w.scale(N,N,Y),w.scale(U,U,Y)):(Y=w.scale(x.sv3d.get(),ca,Y),w.add(N,N,Y),w.add(U,U,Y));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=
8;E.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;E.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};W.calculateControlTransformation=function(Y,U,N){N.zoom=0;N.ascend=0;N.pan.enabled=!1;z.identity(N.pan.matrix);N.rotate.enabled=!1;z.identity(N.rotate.matrix);Y=this.computeVelocities(Y);this.view.state.isLocal?this.calculateControlTransformationLocal(Y,U,N):
this.calculateControlTransformationGlobal(Y,U,N)};W.updateCameraCenter=function(){const {ray:Y,center:U}=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(Y,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,U);this.currentCamera.markViewDirty()};W.calculateControlTransformationLocal=function(Y,U,N){const {viewRight:ca,viewForward:O}=U,V=this.transformation;var ba=this.view.navigation.gamepad,fa=w.set(x.sv3d.get(),O[0],O[1],0);w.normalize(fa,
fa);var ia=V.translation[0]*Y.pan;0!==ia&&(ia=w.scale(x.sv3d.get(),ca,ia),z.translate(N.pan.matrix,N.pan.matrix,ia),N.pan.enabled=!0);switch(ba.mode){case "pan":ba=-V.translation[1]*Y.pan;0!==ba&&(fa=w.scale(x.sv3d.get(),fa,ba),z.translate(N.pan.matrix,N.pan.matrix,fa),N.pan.enabled=!0);N.zoom=V.zoom*Y.zoom;break;case "zoom":N.zoom=(-V.translation[1]+V.zoom)*Y.zoom;break;default:f.neverReached(ba.mode)}N.ascend=V.translation[2]*Y.ascend;fa=-V.heading*Y.rotate;0!==fa&&(z.rotate(N.rotate.matrix,N.rotate.matrix,
fa,this.view.renderCoordsHelper.worldUpAtPosition(U.eye,x.sv3d.get())),N.rotate.enabled=!0);Y=V.tilt*Y.rotate;U=B.viewAngle(this.view.renderCoordsHelper,U.center,U.eye);if(U=t.clamp(U+Y,A.TiltDefault.min,A.TiltDefault.max)-U)z.rotate(N.rotate.matrix,N.rotate.matrix,U,ca),N.rotate.enabled=!0};W.calculateControlTransformationGlobal=function(Y,U,N){const {eye:ca,viewRight:O}=U,V=this.transformation;var ba=this.view.navigation.gamepad,fa=w.cross(x.sv3d.get(),O,ca);w.normalize(fa,fa);w.negate(fa,fa);G.panMotionToRotationMatrix(this.beginCamera,
U,V,Y,this.view.camera.heading,this.headingStart,this.view.camera.tilt,N,ba);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(aa.pan,this.tmpCamera);ba=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;N.ascend=V.translation[2]*Y.ascend;fa=-V.heading*Y.rotate;0!==fa&&(z.rotate(N.rotate.matrix,N.rotate.matrix,fa,this.tmpCamera.eye),N.rotate.enabled=!0);U=this.clampTiltDeltaGlobalToValidRange(V.tilt*Y.rotate,U.ray,ba);0!==U&&(z.rotate(N.rotate.matrix,N.rotate.matrix,
U,this.tmpCamera.viewRight),N.rotate.enabled=!0);N.zoom+=V.zoom*Y.zoom};W.clampTiltDeltaGlobalToValidRange=function(Y,U,N){const ca=D.getReferenceEllipsoid(this.view.spatialReference),O=G.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.min,U.origin,N,ca);var V=0;let ba=0;V=x.sv3d.get();this.view.renderCoordsHelper.intersectManifold(U,N,V)?(V=B.viewAngle(this.view.renderCoordsHelper,V,U.origin),V=G.onSurfaceTiltToEyeTiltGlobal(V,U.origin,N,ca),ba=G.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,U.origin,
N,ca)):(m.sphere.closestPointOnSilhouette(m.sphere.fromRadius(N+ca.radius),U,V),V=t.acosClamped(-w.dot(U.direction,w.normalize(V,V))),V=G.offSurfaceTiltToEyeTiltGlobal(V,U.origin,N,ca),ba=G.offSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,U.origin,N,ca));return t.clamp(V+Y,O,ba)-V};W.getPointAbsoluteSurfaceElevation=function(Y,U,N){const {renderCoordsHelper:ca}=this.view,O=ca.getAltitude(Y);U+=Math.abs(O-U);w.copy(N,Y);ca.setAltitude(U,N);return U};W.clampedDistanceToSurface=function(Y,U){const {renderCoordsHelper:N}=
this.view,{camera:ca}=this.view.state;var {direction:O}=J.headingTiltToDirectionUp(this.view,U,0,80,H);O=N.intersectManifoldClosestSilhouette(m.ray.wrap(U,O),Y,x.sv3d.get());O=w.distance(U,O);Y=N.intersectManifoldClosestSilhouette(m.ray.wrap(U,y.directionFromTo(x.sv3d.get(),U,ca.center)),Y,x.sv3d.get());U=w.distance(U,Y);return Math.min(O,U)};W.computeHeadingRotateRadius=function(Y){const {renderCoordsHelper:U,state:N}=this.view,{camera:ca,isGlobal:O}=N;var V=U.intersectManifoldClosestSilhouette(ca.ray,
this.filteredSurfaceElevation,x.sv3d.get());if(O){const ba=w.subtract(x.sv3d.get(),Y,V);V=w.length(ba);w.scale(ba,ba,1/V);Y=w.normalize(x.sv3d.get(),Y);Y=t.acosClamped(w.dot(Y,ba));return V*Math.sin(Math.min(P,Y))}Y=w.copy(x.sv3d.get(),Y);U.setAltitude(this.filteredSurfaceElevation,Y);return w.distance(V,Y)};W.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};W.computeVelocities=function(Y){var U=this.filteredSurfaceElevation,N=U+D.getReferenceEllipsoid(this.view.spatialReference).radius;
const {camera:ca,isGlobal:O}=this.view.state;var V=x.sv3d.get();const ba=this.getPointAbsoluteSurfaceElevation(ca.eye,U,V);var fa=this.clampedDistanceToSurface(U,V);const ia=ca.width/2,ma=.75*ca.width,ea=.75*ca.width;var M=fa*Math.tan(.5*ca.fovX)/ia;N=M/N;V=M/this.computeHeadingRotateRadius(V);M=(O?N:M)*ma*Y;U=ba-U;U=Math.max(this.minimumAscendVelocity()*Y,2**(ma*Y/ia)*U-U);fa=2**(ma*Y/ia)*fa-fa;Y*=t.clamp(V*ea,Q,X);return{pan:M,ascend:U,zoom:fa,rotate:Y}};W.applyDisabledMovementTypes=function(Y){!k.isSome(this.disableMovements)||
void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(Y.zoom=this.disableMovements.zoom?0:Y.zoom,Y.ascend=this.disableMovements.ascend?0:Y.ascend,Y.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&z.identity(Y.pan.matrix),Y.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&z.identity(Y.rotate.matrix))};T.activatesFor=function(Y,U){Y=C.extractTransformation(U,Y.navigation.gamepad,L);return!("end"===U.action||C.isZeroTransformation(Y))};
return T}(I.InteractiveController);b.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([n.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const L=
{translation:[0,0,0],heading:0,tilt:0,zoom:0},P=t.deg2rad(80),Q=t.deg2rad(30),X=t.deg2rad(80),aa={zoom:0,ascend:0,pan:{enabled:!1,matrix:r.create()},rotate:{enabled:!1,matrix:r.create()}},S=l.create(),H=K.createDirectionUp();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,g){function b(p){let f=p*p;0>p&&(f*=-1);return f}a.extractTransformation=function(p,f,k){const c=p.state;p=p.device;
f="forward-down"===f.tiltDirection?1:-1;"standard"===p.deviceType?(k.translation[0]=b(c.axes[0]),k.translation[1]=b(c.axes[1]),k.translation[2]=b(c.buttons[7])-b(c.buttons[6]),k.heading=b(c.axes[2]),k.tilt=b(c.axes[3])):"spacemouse"===p.deviceType&&(k.translation[0]=1.2*b(c.axes[0]),k.translation[1]=1.2*b(c.axes[1]),k.translation[2]=2*-b(c.axes[2]),k.heading=1.2*b(c.axes[5]),k.tilt=1.2*b(c.axes[3]));k.tilt*=f;g.scale(k.translation,k.translation,1);return k};a.extractTransformationKeyboard=function(p,
f){f.translation[0]=p[1]-p[0];f.translation[1]=p[3]-p[2];f.translation[2]=p[4]-p[5];f.heading=p[7]-p[6];f.tilt=p[8]-p[9];f.zoom=p[10]-p[11];return f};a.isZeroTransformation=function(p){return 0===p.translation[0]&&0===p.translation[1]&&0===p.translation[2]&&0===p.heading&&0===p.tilt&&0===p.zoom};a.quadraticAccentuation=b;a.resetTransformation=function(p){p.translation[0]=0;p.translation[1]=0;p.translation[2]=0;p.heading=0;p.tilt=0;return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports",
"../../../core/mathUtils","../../../chunks/vec3f64","../../../chunks/vec3"],function(a,g,b,p){const f=b.create(),k=b.create();a.createDirectionUp=function(){return{direction:b.create(),up:b.create()}};a.directionToHeadingTilt=function(c,d,e,h,n){let q=p.normalize(f,c),u=p.dot(q,h);const v=0<u;u=Math.abs(u);.99<u&&(u=Math.abs(p.dot(d,h)),.99>u?(p.copy(q,d),v&&p.scale(q,q,-1)):q=null);d=0;q&&(p.scale(k,h,p.dot(h,q)),p.subtract(q,q,k),d=p.dot(q,n)/(p.length(q)*p.length(n)),p.cross(k,q,n),d=(0<p.dot(k,
h)?1:-1)*g.rad2deg(g.acosClamped(d)));c=g.rad2deg(g.acosClamped(-p.dot(h,c)/p.length(c)));if(!e)return{heading:d,tilt:c};e.heading=d;e.tilt=c;return e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../core/maybe ../../../core/Logger ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Point ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../Camera ../../../geometry/projectionEllipsoid ../../../geometry/projection ../../support/spatialReferenceSupport ../../../geometry/support/scaleUtils ./ElevationProvider ./earthUtils ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){function r(U){return"global"===U.viewingMode?z.cameraUtilsSpherical:D.cameraUtilsPlanar}function C(U,N,ca){const O=U.state.camera,V=O.width/2/O.pixelRatio;1===U.renderCoordsHelper.viewingMode&&null!=ca&&(N*=Math.cos(c.deg2rad(ca)));N/=U.renderCoordsHelper.unitInMeters;return V/(96*39.37/N)/Math.tan(O.fovX/2)}function A(U,N,ca){const O=U.state.camera;N=96*39.37/(O.width/2/O.pixelRatio/(N*Math.tan(O.fovX/2)));1===U.renderCoordsHelper.viewingMode&&(N/=
Math.cos(c.deg2rad(ca)));return N*=U.renderCoordsHelper.unitInMeters}function x(U,N,ca,O,V,ba){if(P(ba)){const fa=new Y(ba.signal);I(U,O.heading,O.tilt,N,ca,V,fa);fa.resolver.promise.then(ia=>{ia=L(U,ia,O.fov);if(g.isNone(ia))ba.resolver.reject();else return ba.resolver.resolve(ia)},ia=>ba.resolver.reject(ia))}else return N=I(U,O.heading,O.tilt,N,ca,V),L(U,N,O.fov,ba)}function m(U,N,ca,O,V){return r(U).directionToHeadingTilt(N,ca,O,V)}function B(U,N){return!!(U.basemapTerrain&&U.renderCoordsHelper.fromRenderCoords(N,
H,U.spatialReference)&&g.unwrapOr(l.getElevationAtPoint(U.elevationProvider,H),0)>H.z-1)}async function E(U,N,ca){if(!U.renderCoordsHelper.fromRenderCoords(N,H,U.spatialReference))return!1;U=await U.elevationProvider.queryElevation(H.x,H.y,H.z,H.spatialReference,"ground",ca);return g.unwrapOr(U,0)>H.z-1}async function F(U,N,ca){const O=d.create();N?N instanceof k?(u.projectPointToVector(N,O,U.renderSpatialReference),null==N.z&&null!=U.basemapTerrain&&(N=await U.elevationProvider.queryElevation(N.x,
N.y,N.z,N.spatialReference,"ground",ca),g.isSome(N)&&U.renderCoordsHelper.setAltitude(N,O))):e.copy(O,N):e.copy(O,U.state.camera.center);return O}function G(U,N){const ca=d.create();N&&N instanceof k?(u.projectPointToVector(N,ca,U.renderSpatialReference),null==N.z&&null!=U.basemapTerrain&&(N=l.getElevationAtPoint(U.elevationProvider,N),g.isSome(N)&&U.renderCoordsHelper.setAltitude(N,ca))):N?e.copy(ca,N):e.copy(ca,U.state.camera.center);return ca}function I(U,N,ca,O,V,ba,fa){const ia=O&&O instanceof
k?O:null;if(P(fa))return F(U,O,fa.signal).then(ma=>{K(U,N,ca,ia,ma,V,ba,fa)},ma=>fa.resolver.reject(ma)),null;O=G(U,O);return K(U,N,ca,ia,O,V,ba,fa)}function K(U,N,ca,O,V,ba,fa,ia){if(g.isNone(O)&&(O=u.projectVectorToPoint(V,U.renderSpatialReference,U.spatialReference||f.WGS84),g.isNone(O)))return null;ba=Math.max(ba,U.state.constraints.minimumPoiDistance);var ma=J(U,N,ca,V,ba,fa);const ea=r(U).eyeForCenterWithHeadingTilt,M=ea(V,ba,ma.heading,ma.tilt);if(1===fa&&"global"===U.viewingMode&&0<ca){const Z=
()=>{var la=ba,ka=ba;var ha=U.state.constraints.tilt(ka);ka=r(U).eyeTiltToLookAtTilt(ca,V,ka);ka=Math.min(ka,.5*Math.PI);ha=ha.min*(1-.7)+.7*ka;la=r(U).lookAtTiltToEyeTilt(ha,V,la);fa=1>ca-la?0:1;return K(U,N,la,O,V,ba,fa,ia)};ma=U.map.ground.navigationConstraint;if(!ma||"stay-above"===ma.type){if(B(U,M.eye))return Z();if(P(ia))return E(U,M.eye,ia.signal).then(la=>{if(la)return Z();ia.resolver.resolve({eye:M.eye,up:M.up,center:d.clone(V),heading:M.heading,tilt:M.tilt});return null}),null}}ma=!ia||
P(ia)?{center:d.create(),eye:d.create(),up:d.create(),tilt:0,heading:0}:ia;ma.eye=M.eye;ma.up=M.up;ma.center=d.clone(V);ma.heading=M.heading;ma.tilt=M.tilt;P(ia)&&ia.resolver.resolve(ma);return ma}function J(U,N,ca,O,V,ba){var fa=0;if(ba=1===ba)if(fa=U.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(V/fa)/Math.LN2)ba=!0;else{var ia=U.renderSpatialReference,ma=U.spatialReference||f.WGS84;ba=u.projectVectorToPoint(O,ia,ma);ia=u.projectVectorToPoint(U.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
ia,ma);g.isNone(ba)||g.isNone(ia)?ba=!1:(fa*=Math.tan(.5*U.state.camera.fov),ba=5<ia.distance(ba)/fa)}ba?(N=0,ba=U.state.constraints.tilt(V),ba.max=Math.min(ba.max,.5*Math.PI),ba=ba.min*(1-.7)+.7*ba.max,ca=r(U).eyeTiltToLookAtTilt(ca,O,V),fa=Math.min(ca,ba)):fa=r(U).eyeTiltToLookAtTilt(ca,O,V);ca=fa=U.state.constraints.clampTilt(V,fa);ca=r(U).lookAtTiltToEyeTilt(ca,O,V);return{heading:N,tilt:ca}}function L(U,N,ca,O){if(g.isNone(N))return null;U=u.projectVectorToPoint(N.eye,U.renderSpatialReference,
U.spatialReference||f.WGS84);return g.isNone(U)?null:g.isSome(O)?(O.position=U,O.heading=N.heading,O.tilt=N.tilt,O.fov=ca,O):new n(U,N.heading,N.tilt,ca)}function P(U){return U&&"resolver"in U}const Q=b.getLogger("esri.views.3d.support.cameraUtils"),X=d.create(),aa=d.create(),S={heading:0,tilt:0},H=new k,R=new h.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),T=new h.Cyclical(-180,180),W=d.create();let Y=function(U){this.signal=U;this.resolver=p.createResolver()};a.AsyncContext=Y;a.computeScale=
function(U,N,ca){const O=U.renderSpatialReference;N||(N=U.state.camera);var V=f.WGS84;N instanceof n?(V=N.position.latitude,u.projectPointToVector(N.position,X,O),u.projectPointToVector(ca,aa,O),N=e.distance(X,aa)):(u.projectVectorToVector(N.center,O,aa,V),V=aa[1],N=N.distance);return A(U,N,V)};a.directionToHeadingTilt=m;a.distanceToScale=A;a.externalToInternal=function(U,N){if(g.isNone(N))return null;var ca=U.renderSpatialReference;const O=r(U).headingTiltToDirectionUp,V=d.create();if(!u.projectPointToVector(N.position,
V,ca))return null;ca=O(V,N.heading,N.tilt);e.scale(ca.direction,ca.direction,U.state.camera.distance);e.add(ca.direction,ca.direction,V);U=y.cameraOnContentAlongViewDirection(U,V,ca.direction,ca.up);U.fov=c.deg2rad(N.fov);return U};a.fromCenterDistance=x;a.fromCenterScale=function(U,N,ca,O,V,ba){ca=C(U,ca,N.latitude);return x(U,N,ca,O,V,ba)};a.fromExtent=function(U,N,ca,O,V,ba=null){let fa;var ia=0;null!=N.zmax&&null!=N.zmin&&(fa=(N.zmax+N.zmin)/2,ia=N.zmax-N.zmin);if("global"===U.viewingMode){if(!v.isSpatialReferenceSupported(N.spatialReference,
"global"))return P(ba)&&ba.resolver.reject(),null;var ma=new k(N.xmin,N.ymin,N.spatialReference);const la=new k(N.xmax,N.ymax,N.spatialReference),ka=N.spatialReference.isGeographic?T:R;var ea=new k(ka.center(ma.x,la.x),(la.y+ma.y)/2,N.spatialReference);null!=fa&&(ea.z=fa);N=q.getReferenceEllipsoid(N.spatialReference);var M=w.getGreatCircleSpanAt(ea,ma,la);var Z=M.lon;M=M.lat;ka.diff(ma.x,la.x)>ka.range/2&&(Z+=N.halfCircumference);Z=Math.min(Z,N.halfCircumference);M=Math.min(M,N.halfCircumference)}else ea=
U.spatialReference||f.WGS84,Z=N.xmax-N.xmin,M=N.ymax-N.ymin,ea=new k({x:N.xmin+.5*Z,y:N.ymin+.5*M,z:fa,spatialReference:ea});ma=U.state.camera;ia=Math.max(1/Math.tan(ma.fovX/2)*Z*.5,1/Math.tan(ma.fovY/2)*M*.5,1/Math.tan(ma.fov/2)*ia*.5)/1;if(P(ba))Z=new Y(ba.signal),I(U,ca,O,ea,ia,V,Z),Z.resolver.promise.then(la=>{la=L(U,la,U.camera.fov);if(g.isNone(la))ba.resolver.reject();else return ba.resolver.resolve(la)},la=>ba.resolver.reject(la));else return ca=I(U,ca,O,ea,ia,V),L(U,ca,U.camera.fov,ba)};a.getObserverForPointAtDistance=
I;a.headingTiltToDirectionUp=function(U,N,ca,O,V){return r(U).headingTiltToDirectionUp(N,ca,O,V)};a.internalToExternal=function(U,N,ca){const O=U.renderSpatialReference,V=m(U,N.eye,N.viewForward,N.up,S);U=U.spatialReference||f.WGS84;u.projectVectorToVector(N.eye,O,W,U)||(U=f.WGS84,u.projectVectorToVector(N.eye,O,W,U));if(g.isNone(ca))return new n(new k(W,U),V.heading,V.tilt,c.rad2deg(N.fov));ca.position.x=W[0];ca.position.y=W[1];ca.position.z=W[2];ca.position.spatialReference=U;ca.heading=V.heading;
ca.tilt=V.tilt;ca.fov=c.rad2deg(N.fov);return ca};a.observerToCamera=L;a.scaleToDistance=C;a.scaleToResolution=function(U,N){return U.spatialReference?t.getResolutionForScale(N,U.spatialReference):void 0};a.scaleToZoom=function(U,N){var ca;if(U=null==(ca=U.basemapTerrain)?void 0:ca.tilingScheme)return U.levelAtScale(N);Q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(U,N,ca){const O=u.projectVectorToPoint(ca,U.renderSpatialReference,U.spatialReference||
f.WGS84);if(g.isNone(O))return null;var V=Math.tan(N.fovX/2),ba=Math.tan(N.fovY/2);N=e.dist(N.eye,ca);V*=2*N;ba*=2*N;return"global"===U.viewingMode?z.toExtent(U,O,V,ba):D.toExtent(U,O,V,ba)};a.zoomToScale=function(U,N){var ca;if(U=null==(ca=U.basemapTerrain)?void 0:ca.tilingScheme)return U.scaleAtLevel(N);Q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../geometry/Extent ../core/mathUtils ./vec3f64 ./vec3 ./mat4 ../geometry/projection ./mat4f64 ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,g,b,p,f,k,c,d,e){function h(r,C,A,x=e.createDirectionUp()){k.identity(y);const {direction:m,up:B}=x;k.rotateZ(y,y,-b.deg2rad(C));k.rotateX(y,y,b.deg2rad(A));f.transformMat4(m,w,y);f.scale(m,m,-1);f.transformMat4(B,l,y);return x}function n(r,C,A,x){return e.directionToHeadingTilt(C,A,x,w,l)}function q(r,C,A,x){const m=h(r,A,x),B=p.create();f.scale(B,m.direction,-C);f.add(B,B,r);return{up:m.up,eye:B,heading:A,tilt:x}}function u(r){return b.rad2deg(r)}function v(r){return b.deg2rad(r)}function t(r,
C,A,x,m){const B=r.renderSpatialReference;r=r.map&&r.spatialReference||C.spatialReference;c.projectPointToVector(C,D,B);c.projectPointToVector(C,z,B);D[0]-=A/2;z[0]+=A/2;D[1]-=x/2;z[1]+=x/2;c.projectVectorToVector(D,B,D,r);c.projectVectorToVector(z,B,z,r);m?(m.xmin=D[0],m.ymin=D[1],m.xmax=z[0],m.ymax=z[1],m.spatialReference=r):m=new g(D[0],D[1],z[0],z[1],r);return m}const l=p.fromValues(0,1,0),w=p.fromValues(0,0,1),y=d.create(),D=p.create(),z=p.create();d=Object.freeze({__proto__:null,headingTiltToDirectionUp:h,
directionToHeadingTilt:n,eyeForCenterWithHeadingTilt:q,lookAtTiltToEyeTilt:u,eyeTiltToLookAtTilt:v,toExtent:t});a.cameraUtilsPlanar=d;a.directionToHeadingTilt=n;a.eyeForCenterWithHeadingTilt=q;a.eyeTiltToLookAtTilt=v;a.headingTiltToDirectionUp=h;a.lookAtTiltToEyeTilt=u;a.toExtent=t})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../geometry/Extent ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ../geometry/projectionEllipsoid ./mat4 ./mat4f64 ../views/3d/support/earthUtils ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){function v(F,G,I,K=u.createDirectionUp()){c.cross(B,F,C);0===c.dot(B,B)&&c.cross(B,F,A);h.identity(m);h.rotate(m,m,-f.deg2rad(G),F);h.rotate(m,m,-f.deg2rad(I),B);const {up:J,direction:L}=K;c.cross(J,B,F);c.normalize(J,J);c.transformMat4(J,J,m);c.normalize(L,F);c.negate(L,L);c.transformMat4(L,L,m);return K}function t(F,G,I,K){const J=B,L=E;c.normalize(J,F);c.cross(E,J,C);0===c.dot(E,E)&&c.cross(E,J,A);c.cross(L,E,J);return u.directionToHeadingTilt(G,I,K,J,L)}function l(F,
G,I,K){const J={eye:k.create(),up:null,tilt:K,heading:I},L=B;L[0]=F[0];L[1]=F[2];L[2]=-F[1];I=f.deg2rad(I);var P=f.deg2rad(K);K=Math.sin(I);I=Math.cos(I);var Q=Math.sin(P),X=Math.cos(P);const aa=c.length(L);if(1E-8>Math.abs(P))P=G+aa;else{var S=aa/Q,H=f.asinClamped(G/S);P=S*Math.sin(Math.PI-P-H)}X*=G;S=G*G*Q*Q;H=I*I*S;const R=P-X,T=R*R;var W=H*(H+T-L[1]*L[1]);if(0>W)return c.scale(J.eye,L,P/aa),J.tilt=0,J;var Y=Math.sqrt(W);const U=L[1]*R;W=H+T;Y=0<I?-Y+U:Y+U;if(1E-8>Math.abs(W))return 1E-8>aa?(J.eye[0]=
0,J.eye[1]=0,J.eye[2]=G):c.scale(J.eye,L,P/aa),J.tilt=0,w(J.eye),y(J,F);J.eye[1]=Y/W;G*=Q;Y=J.eye[1]*J.eye[1];Q=1-Y;W=Math.sqrt(Q);S=H*Y+K*K*S-2*I*G*J.eye[1]*W*R+Q*T;if(1E-8>Math.abs(S))return c.scale(J.eye,L,P/aa),J.tilt=0,w(J.eye),y(J,F);J.eye[0]=(Q*(P*L[0]-X*L[0])-G*W*(L[0]*J.eye[1]*I+L[2]*K))/S;J.eye[2]=(Q*(P*L[2]-X*L[2])-G*W*(L[2]*J.eye[1]*I-L[0]*K))/S;c.scale(J.eye,J.eye,P);w(J.eye);return y(J,F)}function w(F){const G=F[1];F[1]=-F[2];F[2]=G}function y(F,G){G=v(G,F.heading,F.tilt);F.up=G.up;
return F}function D(F,G,I){G=c.length(G);I=f.asinClamped(I/(Math.sqrt(I*I+G*G-2*I*G*Math.cos(Math.PI-F))/Math.sin(F)));return f.rad2deg(F-I)}function z(F,G,I){F=f.deg2rad(F);G=c.length(G);return f.asinClamped(I/(G/Math.sin(F)))+F}function r(F,G,I,K,J){function L(aa){const S=Math.PI/2;aa=d.cyclical2PI.normalize(aa,-S);aa>S&&(aa=Math.PI-aa);return aa}var P=G.latitude;G=G.longitude;var Q=q.getLonDeltaForDistance(P,I,e.getReferenceEllipsoid(F.spatialReference).radius)/2;I=G-Q;G+=Q;P=f.deg2rad(P);Q=e.getReferenceEllipsoid(F.spatialReference).radius;
P=(1+Math.sin(P))/(1-Math.sin(P));const X=(P+1)*Math.tan(K/Q/2);P=1.5*Math.PI-2*Math.atan(.5*(X+Math.sqrt(4*P+X*X)));K=P+K/Q;P=L(P);K=L(K);K<P&&(Q=K,K=P,P=Q);P=Math.max(f.rad2deg(P),-90);K=Math.min(f.rad2deg(K),90);G=x.monotonic(I,G);180<G-I&&(Q=(G-I-180)/2,I+=Q,G-=Q);Q=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:g.WGS84;J?(J.xmin=I,J.ymin=P,J.xmax=G,J.ymax=K,J.spatialReference=Q):J=new p(I,P,G,K,Q);F.spatialReference&&F.spatialReference.isWebMercator&&b.geographicToWebMercator(J,
!1,J);return J}const C=k.fromValues(0,0,1),A=c.normalize(k.create(),k.fromValues(1,1,1)),x=new d.Cyclical(-180,180),m=n.create(),B=k.create(),E=k.create();n=Object.freeze({__proto__:null,headingTiltToDirectionUp:v,directionToHeadingTilt:t,eyeForCenterWithHeadingTilt:l,lookAtTiltToEyeTilt:D,eyeTiltToLookAtTilt:z,toExtent:r});a.cameraUtilsSpherical=n;a.directionToHeadingTilt=t;a.eyeForCenterWithHeadingTilt=l;a.eyeTiltToLookAtTilt=z;a.headingTiltToDirectionUp=v;a.lookAtTiltToEyeTilt=D;a.toExtent=r})},
"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler","../../state/controllers/GamepadKeyboardController"],function(a,g,b,p){b=function(f){function k(d,e){var h=f.call(this,!0)||this;h.view=d;h.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2};h.keyToNumber={[e.left]:0,[e.right]:1,[e.forward]:2,[e.backward]:3,[e.up]:4,[e.down]:5,[e.headingLeft]:6,[e.headingRight]:7,[e.tiltUp]:8,[e.tiltDown]:9,
[e.zoomIn]:10,[e.zoomOut]:11};h.registerIncoming("key-down",null,n=>h.handleKeyDown(n));h.registerIncoming("key-up",null,n=>h.handleKeyUp(n));h.registerIncoming("blur",null,()=>h.handleBlur());return h}g._inheritsLoose(k,f);var c=k.prototype;c.handleKeyDown=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var e=this.keyToNumber[d.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new p.GamepadKeyboardController({view:this.view,
disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),d.stopPropagation()))}};c.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};c.handleKeyUp=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var e=this.keyToNumber[d.data.key];
null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),d.stopPropagation())}};return k}(b.InputHandler);a.KeyboardNavigation=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),
function(a,g,b,p,f,k){p=function(c){function d(e,h){var n=c.call(this,!0)||this;n.view=e;n.registerIncoming("mouse-wheel",h,q=>n.handleMouseWheel(q));return n}g._inheritsLoose(d,c);d.prototype.handleMouseWheel=function(e){if(this.view.navigation.mouseWheelZoomEnabled){var h=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new f.ZoomStepController({view:this.view,mode:"interaction"}):new k.ZoomStepController({view:this.view,mode:"interaction"}),
this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*h.deltaY,b.createScreenPointArray(h.x,h.y));e.preventDefault();e.stopPropagation()}};return d}(p.InputHandler);a.MouseWheelZoom=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController".split(" "),
function(a,g,b,p,f,k){b=function(c){function d(h,n,q){var u=c.call(this,!0)||this;u.view=h;u.pointerAction=n;u.lastEndTimestamp=0;u.lastTimestamp=0;u.registerIncoming("drag",q,v=>u.handleDrag(v));return u}g._inheritsLoose(d,c);var e=d.prototype;e.handleDrag=function(h){if("mouse"!==h.data.pointerType||p.eventMatchesMousePointerAction(h.data,this.pointerAction)){var n=h.timestamp-this.lastEndTimestamp;n=this.momentum&&this.momentum.active&&40>n;switch(h.data.action){case "start":case "update":if(n)break;
this.controller&&this.controller.active?2<h.data.timestamp-this.lastTimestamp&&(this.controller.update(h.data),this.lastTimestamp=h.timestamp):this.startController(h);break;case "end":case "removed":this.endController(h,!0);break;case "added":this.endController(h,!1),this.startController(h)}h.stopPropagation()}};e.endController=function(h,n){this.controller&&this.controller.active&&(this.lastEndTimestamp=h.timestamp,h=this.controller.end(h.data),n&&h&&(this.momentum=h,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.startController=function(h){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(h.data);this.lastTimestamp=h.timestamp};e.createController=function(){return this.view.state.isGlobal?new f.PinchAndPanController({view:this.view}):new k.PinchAndPanController({view:this.view})};return d}(b.InputHandler);a.PinchAndPanNavigation=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../geometry/projectionEllipsoid ../../../../../support/featureFlags ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../../utils/navigationUtils ../InteractiveController ../../../input/util ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q){a.PinchAndPanController=function(X){function aa(H){H=X.call(this,H)||this;H.view=null;H.smoothRotation=new B.ExponentialFalloff(.05);H.rotationAxis=t.create();H.panningPlane=r.plane.create();H.smoothScaling=new B.ExponentialFalloff(.05);H.zoomCenterScreen=v.createScreenPointArray();H.zoomMomentumEstimator=new Q.ZoomMomentumEstimator;H.rotationMomentumEstimator=new P.RotationMomentumEstimator;H.panSphericalMomentumEstimator=
new L.PanSphericalMomentumEstimator;H.panPlanarMomentumEstimator=new J.PanPlanarMomentumEstimator;H.adjustedSphere=r.sphere.create();H.tmp3d=t.create();H.tmpScreenPointArray=v.createScreenPointArray();H.beginScreenPoint=v.createScreenPointArray();H.beginScenePoint=t.create();H.screenPickPoint=v.createScreenPointArray();H.navMode=x.NavigationMode.Horizontal;H.tmpInteractionDirection=t.create();H.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new A,interactionDirection:null,
tiltMode:0};return H}g._inheritsLoose(aa,X);var S=aa.prototype;S.begin=function(H){if(this.active){var R=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=R;this.rotationMomentumEstimator.enabled=R;this.panPlanarMomentumEstimator.enabled=R;this.panSphericalMomentumEstimator.enabled=R;this.beginHeading=-w.cyclicalPI.normalize(u.deg2rad(this.view.camera.heading));this.beginRadius=H.radius;this.pointerCount=H.pointers.size;this.beginAngle=H.angle;this.smoothRotation.reset();v.screenPointObjectToArray(H.center,
this.screenPickPoint);z.copy(this.beginScreenPoint,this.screenPickPoint);R=y.getReferenceEllipsoid(this.view.spatialReference);var T=x.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0,R);this.scenePickPoint=T.scenePickPoint;this.sphere=T.sphere;l.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=x.decideNavigationMode(this.beginCamera,this.screenPickPoint,T.hasGeometryIntersection,R);this.navMode===x.NavigationMode.Vertical&&this.preparePlanarPanMode(H);
this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};S.preparePlanarPanMode=function(H){var R=l.negate(this.tmp3d,this.beginCamera.viewForward);r.plane.fromPositionAndNormal(this.scenePickPoint,R,this.panningPlane);var T=v.createScreenPointArray(this.screenPickPoint[0],0);R=t.create();var W=l.length(this.beginCamera.eye);this.adjustedSphere[3]=W<this.sphere[3]?W-100:this.sphere[3];x.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,T,R);T=v.createRenderScreenPointArray3();
this.beginCamera.projectToRenderScreen(R,T);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*T[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&r.plane.fromPositionAndNormal(this.scenePickPoint,r.plane.normal(this.panningPlane),this.panningPlane);if(!D.disableContextNavigation()){R=t.create();T=t.create();W=t.create();l.subtract(R,this.scenePickPoint,this.currentCamera.eye);l.normalize(R,R);const Y=5*Math.max(Math.abs(this.view.camera.position.z),50),
U=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],this.screenPickPoint[1],this.view._stage.camera,80);l.copy(W,l.add(T,this.currentCamera.eye,l.scale(T,R,U?Math.min(U,Y):Y)));this.panningPlane[3]=-l.dot(this.panningPlane,W)}H=v.screenPointObjectToArray(H.center,this.tmpScreenPointArray);x.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,H,this.beginScenePoint)};S.update=function(H){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var R=1<H.pointers.size;
this.navMode===x.NavigationMode.Horizontal?(R&&this.zoomSpherical(H),this.panningSpherical(H),R&&this.rotateSpherical(H)):(R&&this.zoomPlanar(H),this.panningPlanar(H),R&&this.rotatePlanar(H));this.currentCamera.markViewDirty()}};S.end=function(H){H.pointers.size===this.pointerCount&&this.update(H);this.finishController();if(H=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===x.NavigationMode.Horizontal?new K.ZoomSphericalMomentumController({view:this.view,momentum:H,screenCenter:this.zoomCenterScreen,
sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new I.ZoomPlanarMomentumController({view:this.view,momentum:H,zoomCenter:this.beginScenePoint});if(H=this.rotationMomentumEstimator.evaluateMomentum())return new G.RotationMomentumController({view:this.view,momentum:H,center:this.sphere,axis:this.rotationAxis});if(this.navMode===x.NavigationMode.Horizontal){if(H=this.panSphericalMomentumEstimator.evaluateMomentum())return new F.PanSphericalMomentumController({view:this.view,momentum:H})}else if(H=
this.panPlanarMomentumEstimator.evaluateMomentum())return new E.PanPlanarMomentumController({view:this.view,momentum:H});return null};S.zoomSpherical=function(H){const R=this.beginRadius/H.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(H.radius,40),120);this.smoothScaling.update(R);x.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);v.screenPointObjectToArray(H.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*H.timestamp);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(H.radius-this.beginRadius);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};S.panningSpherical=function(H){const R=v.screenPointObjectToArray(H.center,this.tmpScreenPointArray);x.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,R,this.tmp3d);x.preserveHeadingThreshold(this.beginScenePoint,l.dot(this.currentCamera.up,this.beginScenePoint),this.sphere[3],
this.beginHeading,this.view.camera.tilt,this.beginCamera)?(x.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(R,this.tmp3d,.001*H.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(x.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(R,
this.tmp3d,.001*H.timestamp,this.beginCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(this.screenPickPoint,R);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};S.rotateSpherical=function(H){l.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||l.negate(this.rotationAxis,this.rotationAxis);var R=this.smoothRotation.value,T=x.normalizeRotationDelta(H.angle-
R);R+=T;this.smoothRotation.gain=.00125*Math.min(Math.max(H.radius,40),120);this.smoothRotation.update(R);T=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(T,.001*H.timestamp);x.applyRotation(this.currentCamera,this.sphere,r.axisAngle.wrapAxisAngle(this.rotationAxis,T));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(H.radius*R);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};S.panningPlanar=
function(H){const R=v.screenPointObjectToArray(H.center,this.tmpScreenPointArray);x.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,R,this.tmp3d)&&(x.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(R,this.tmp3d,.001*H.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(this.beginScreenPoint,R),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this.tmpInteractionDirection),C.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};S.zoomPlanar=function(H){const R=this.beginRadius/H.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(H.radius,40),120);this.smoothScaling.update(R);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*H.timestamp);x.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(H.radius-this.beginRadius);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};S.rotatePlanar=function(H){l.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||l.negate(this.rotationAxis,this.rotationAxis);var R=this.smoothRotation.value;let T=H.angle-R;T=x.normalizeRotationDelta(T);this.smoothRotation.gain=.00125*Math.min(Math.max(H.radius,40),
120);this.smoothRotation.update(R+T);R=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(R,.001*H.timestamp);x.applyRotation(this.currentCamera,this.sphere,r.axisAngle.wrapAxisAngle(this.rotationAxis,R));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(H.radius*R);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};g._createClass(aa,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return aa}(m.InteractiveController);b.__decorate([c.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k){this._gain=k}var f=p.prototype;f.reset=
function(k){this._value=k};f.update=function(k){this._value=void 0===this._value?k:this._gain*k+(1-this._gain)*this._value};g._createClass(p,[{key:"gain",set:function(k){this._gain=k}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return p}();a.ExponentialFalloff=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ./MomentumController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){a.PanPlanarMomentumController=function(l){function w(y){y=l.call(this,y)||this;y.interactionType=4;y.tmpPan=u.create();return y}g._inheritsLoose(w,l);w.prototype.momentumStep=function(y,D){y=this.momentum.value(y);v.scale(this.tmpPan,this.momentum.direction,y);v.subtract(D.eye,D.eye,this.tmpPan);v.subtract(D.center,D.center,this.tmpPan);D.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return w}(t.MomentumController);b.__decorate([c.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../ViewAnimation ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../AnimationController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.MomentumController=function(w){function y(z){z=w.call(this,z)||this;z.view=null;z.beginCamera=new t;z.elapsedTimeSec=0;z.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new t,interactionDirection:null,tiltMode:0};return z}g._inheritsLoose(y,w);var D=y.prototype;D.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new u};D.onControllerStart=function(z){this.beginCamera.copyFrom(z);
this.constraintOptions.interactionStartCamera=this.beginCamera;w.prototype.onControllerStart.call(this,z)};D.stepController=function(z,r){r.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=z;this.momentumStep(this.elapsedTimeSec,r);v.applyAll(this.view,r,this.constraintOptions)};g._createClass(y,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return y}(l.AnimationController);b.__decorate([c.property({constructOnly:!0})],a.MomentumController.prototype,
"view",void 0);a.MomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../utils/navigationUtils ./MomentumController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=u.create(),y=u.create();a.PanSphericalMomentumController=function(D){function z(r){r=D.call(this,r)||this;r.interactionType=4;return r}g._inheritsLoose(z,D);z.prototype.momentumStep=function(r,C){const A=this.momentum.value1(r);r=this.momentum.value2(r);v.copy(y,C.eye);v.normalize(y,y);v.cross(this.momentum.axis2,y,this.momentum.axis1);t.applyRotationWithTwoAxes(C,w,this.momentum.axis1,A,this.momentum.axis2,r)};return z}(l.MomentumController);b.__decorate([c.property({constructOnly:!0})],
a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../support/geometryUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.RotationMomentumController=function(w){function y(D){D=w.call(this,D)||this;D.interactionType=2;return D}g._inheritsLoose(y,w);y.prototype.momentumStep=function(D,z){D=this.momentum.value(D);t.applyRotation(z,this.center,v.axisAngle.wrapAxisAngle(this.axis,D))};g._createClass(y,[{key:"center",set:function(D){this._set("center",u.clone(D))}},{key:"axis",set:function(D){this._set("axis",u.clone(D))}}]);return y}(l.MomentumController);b.__decorate([c.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([c.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);b.__decorate([c.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){a.ZoomPlanarMomentumController=function(y){function D(z){z=y.call(this,z)||this;z.interactionType=1;z.constraintOptions.interactionDirection=u.create();return z}g._inheritsLoose(D,y);D.prototype.momentumStep=function(z,r){v.copy(this.constraintOptions.interactionDirection,r.eye);z=this.momentum.valueDelta(0,z);l.applyZoomToPoint(r,this.zoomCenter,z,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=t.directionFromTo(this.constraintOptions.interactionDirection,
r.eye,this.constraintOptions.interactionDirection)};g._createClass(D,[{key:"zoomCenter",set:function(z){this._set("zoomCenter",u.clone(z))}}]);return D}(w.MomentumController);b.__decorate([c.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([c.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../support/geometryUtils ../../../camera/constraintUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){a.ZoomSphericalMomentumController=function(D){function z(C){C=D.call(this,C)||this;C.interactionType=1;C.radius=0;C.tmpSceneCenter=v.create();C.tmpZoomAxisAngle=t.axisAngle.create();C.sphere=t.sphere.create();return C}g._inheritsLoose(z,D);var r=z.prototype;r.initialize=function(){this.sphere[3]=this.radius};r.momentumStep=function(C,A){C=this.momentum.valueDelta(0,C);w.applyZoomOnSphere(this.sphere,A,C);this.constraintOptions.interactionType=1;l.applyAll(this.view,
A,this.constraintOptions);w.sphereOrPlanePointFromScreenPoint(this.sphere,A,this.screenCenter,this.tmpSceneCenter);t.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);w.applyRotation(A,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};g._createClass(z,[{key:"screenCenter",set:function(C){this._set("screenCenter",u.createScreenPointArray(C[0],C[1]))}},{key:"sceneCenter",set:function(C){this._set("sceneCenter",v.clone(C))}}]);return z}(y.MomentumController);
b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([c.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],
a.ZoomSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3f64 ../../chunks/vec3 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,g,b,p,f,k){let c=function(d){function e(h,n,q,u,v){h=d.call(this,h,n,q)||this;h.sceneVelocity=u;h.direction=v;return h}g._inheritsLoose(e,d);e.prototype.value=function(h){return d.prototype.valueFromInitialVelocity.call(this,
this.sceneVelocity,h)};return e}(k.Momentum);k=function(){function d(h=300,n=12,q=.84){this.minimumInitialVelocity=h;this.stopVelocity=n;this.friction=q;this.enabled=!0;this.time=new f.FilteredFiniteDifference(.6);this.screen=[new f.FilteredFiniteDifference(.4),new f.FilteredFiniteDifference(.4)];this.scene=[new f.FilteredFiniteDifference(.6),new f.FilteredFiniteDifference(.6),new f.FilteredFiniteDifference(.6)];this.tmpDirection=b.create()}var e=d.prototype;e.add=function(h,n,q){!this.enabled||this.time.hasLastValue&&
.015>this.time.computeDelta(q)||(this.screen[0].update(h[0]),this.screen[1].update(h[1]),this.scene[0].update(n[0]),this.scene[1].update(n[1]),this.scene[2].update(n[2]),this.time.update(q))};e.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var h=this.screen[0].filteredDelta;const n=this.screen[1].filteredDelta;
h=Math.sqrt(h*h+n*n)/this.time.filteredDelta;return Math.abs(h)<this.minimumInitialVelocity?null:this.createMomentum(h,this.stopVelocity,this.friction)};e.createMomentum=function(h,n,q){p.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const u=p.length(this.tmpDirection);0<u&&p.scale(this.tmpDirection,this.tmpDirection,1/u);return new c(h,n,q,u/this.time.filteredDelta,this.tmpDirection)};return d}();a.PanPlanarMomentum=c;a.PanPlanarMomentumEstimator=
k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k){this.gain=k}var f=p.prototype;f.update=function(k){if(this.hasLastValue){const c=this.computeDelta(k);this.updateDelta(c)}this.lastValue=k};f.reset=function(){this.filteredDelta=this.lastValue=void 0};f.computeDelta=function(k){return k-this.lastValue};f.updateDelta=function(k){this.filteredDelta=
this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*k:k};g._createClass(p,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return p}();a.FilteredFiniteDifference=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k,c,d){this._initialVelocity=
k;this._stopVelocity=c;this._friction=d;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var f=p.prototype;f.isFinished=function(k){return k>this.duration};f.value=function(k){return this.valueFromInitialVelocity(this._initialVelocity,k)};f.valueDelta=function(k,c){const d=this.value(k);return this.value(k+c)-d};f.valueFromInitialVelocity=function(k,c){c=Math.min(c,this.duration);const d=1-this.friction;return k*(d**c-1)/Math.log(d)};
g._createClass(p,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return p}();a.Momentum=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3f64 ../../chunks/vec3 ../../chunks/vec2f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./Momentum ./FilteredValue".split(" "),function(a,g,b,
p,f,k,c,d,e){let h=function(n){function q(v,t,l,w,y,D=0,z){v=n.call(this,v,t,l)||this;v.angularVelocity1=w;v.axis1=y;v.angularVelocity2=D;v.axis2=z;return v}g._inheritsLoose(q,n);var u=q.prototype;u.value1=function(v){return n.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,v)};u.value2=function(v){return n.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,v)};return q}(d.Momentum);d=function(){function n(u=300,v=12,t=.84){this.minimumInitialVelocity=u;this.stopVelocity=
v;this.friction=t;this.enabled=!0;this.tmpAxis1=b.create();this.tmpAxis2=b.create();this.tmpAngles=f.create();this.time=new c.FilteredFiniteDifference(.3);this.screen=[new c.FilteredFiniteDifference(.4),new c.FilteredFiniteDifference(.4)];this.angle1=new e.FilteredValue(.6);this.angle2=new e.FilteredValue(.6);this.axis1=b.create();this.axis2=b.create();this.lastScene=b.create()}var q=n.prototype;q.addMomentumDirectRotation=function(u,v,t,l,w,y){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(t))return;
l=k.rotationAngleAndAxisDirectRotation(this.lastScene,v,this.tmpAxis2,l,w,y);this.angle2.update(0);1E-5>p.squaredLength(this.tmpAxis2)?l=0:p.normalize(this.axis1,this.tmpAxis2);this.angle1.update(l);p.copy(this.lastScene,v)}this.screen[0].update(u[0]);this.screen[1].update(u[1]);this.time.update(t)}};q.addMomentumPreserveHeading=function(u,v,t,l,w,y,D){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(t))return;k.rotationAnglesAndAxesHeadingPreserving(this.lastScene,v,this.tmpAxis2,
this.tmpAxis1,this.tmpAngles,l,w,y,D,!1);1E-5>p.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),p.normalize(this.axis1,this.tmpAxis1),p.normalize(this.axis2,this.tmpAxis2));p.copy(this.lastScene,v)}this.screen[0].update(u[0]);this.screen[1].update(u[1]);this.time.update(t)}};q.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};
q.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var u=this.screen[0].filteredDelta;const v=this.screen[1].filteredDelta;u=Math.sqrt(u*u+v*v)/this.time.filteredDelta;return Math.abs(u)<this.minimumInitialVelocity?null:this.createMomentum(u,this.stopVelocity,this.friction)};q.createMomentum=function(u,v,t){return new h(u,v,t,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return n}();
a.PanSphericalMomentum=h;a.PanSphericalMomentumEstimator=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k){this.gain=k}var f=p.prototype;f.update=function(k){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*k:k};f.reset=function(){this.filteredValue=void 0};g._createClass(p,[{key:"hasFilteredValue",get:function(){return void 0!==
this.filteredValue}}]);return p}();a.FilteredValue=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,g,b){b=function(p){function f(k=3,c=.01,d=.95,e=12){return p.call(this,k,c,d,e)||this}g._inheritsLoose(f,p);f.prototype.add=function(k,c){if(this.value.hasLastValue){const d=this.value.lastValue;for(k-=d;k>Math.PI;)k-=2*Math.PI;for(;k<-Math.PI;)k+=
2*Math.PI;k=d+k}p.prototype.add.call(this,k,c)};return f}(b.MomentumEstimator);a.RotationMomentumEstimator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,g,b,p){let f=function(){function k(d=2.5,e=.01,h=.95,n=12){this.minimumInitialVelocity=d;this.stopVelocity=e;this.friction=h;this.maxVelocity=n;this.enabled=!0;this.value=new b.FilteredFiniteDifference(.8);
this.time=new b.FilteredFiniteDifference(.3)}var c=k.prototype;c.add=function(d,e){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){const h=this.value.computeDelta(d);0>this.value.filteredDelta*h&&this.value.reset()}}this.time.update(e);this.value.update(d)}};c.reset=function(){this.value.reset();this.time.reset()};c.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let d=this.value.filteredDelta/
this.time.filteredDelta;d=g.clamp(d,-this.maxVelocity,this.maxVelocity);return Math.abs(d)<this.minimumInitialVelocity?null:this.createMomentum(d,this.stopVelocity,this.friction)};c.createMomentum=function(d,e,h){return new p.Momentum(d,e,h)};return k}();a.MomentumEstimator=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,g,b,p){let f=
function(k){function c(e,h,n){return k.call(this,e,h,n)||this}g._inheritsLoose(c,k);var d=c.prototype;d.value=function(e){e=k.prototype.value.call(this,e);return Math.exp(e)};d.valueDelta=function(e,h){const n=k.prototype.value.call(this,e);e=k.prototype.value.call(this,e+h);return Math.exp(e-n)};return c}(b.Momentum);b=function(k){function c(e=2.5,h=.01,n=.95,q=12){return k.call(this,e,h,n,q)||this}g._inheritsLoose(c,k);var d=c.prototype;d.add=function(e,h){k.prototype.add.call(this,Math.log(e),
h)};d.createMomentum=function(e,h,n){return new f(e,h,n)};return c}(p.MomentumEstimator);a.ZoomMomentum=f;a.ZoomMomentumEstimator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../support/featureFlags ../../../support/geometryUtils ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../../utils/navigationUtils ../InteractiveController ../../../input/util ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G){const I=t.fromValues(0,0,1);var K=16/180*Math.PI;a.PinchAndPanController=function(J){function L(Q){Q=J.call(this,Q)||this;Q.view=null;Q.rotationValueSmooth=new A.ExponentialFalloff(.05);Q.scalingValueSmooth=new A.ExponentialFalloff(.05);Q.planeHorizontal=y.plane.create();Q.planeVertical=y.plane.create();Q.rotationMomentumEstimator=new F.RotationMomentumEstimator;Q.panMomentumEstimator=new E.PanPlanarMomentumEstimator(300,12,.9);Q.zoomMomentumEstimator=
new G.ZoomMomentumEstimator;Q.beginCenter=t.create();Q.tmpPoints=[];Q.beginCenterScreen=v.createScreenPointArray();Q.tmpCentroid3d=t.create();Q.tmpCentroid2d=v.createScreenPointArray();Q.tmp2d=v.createScreenPointArray();Q.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new z,interactionDirection:null,tiltMode:0};return Q}g._inheritsLoose(L,J);var P=L.prototype;P.begin=function(Q){if(this.active){var X=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=
X;this.rotationMomentumEstimator.enabled=X;this.panMomentumEstimator.enabled=X;this.beginRadius=Q.radius;this.pointerCount=Q.pointers.size;this.beginAngle=Q.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();v.screenPointObjectToArray(Q.center,this.beginCenterScreen);y.plane.fromNormalAndOffset(I,0,this.planeHorizontal);X=t.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,X);var aa=t.create();l.negate(aa,this.beginCamera.viewForward);var S=
t.create();l.copy(S,I);var H=l.dot(aa,S);this.panMode=u.asinClamped(0>H?-H:H)>=K?r.NavigationMode.Horizontal:r.NavigationMode.Vertical;y.plane.setOffsetFromPoint(this.planeHorizontal,X,this.planeHorizontal);this.beginCamera.aboveGround||y.plane.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===r.NavigationMode.Vertical){l.scale(S,S,H);l.subtract(this.planeVertical,aa,S);l.normalize(this.planeVertical,this.planeVertical);y.plane.setOffsetFromPoint(this.planeVertical,X,this.planeVertical);
if(!w.disableContextNavigation()){aa=t.create();S=t.create();H=t.create();l.subtract(aa,X,this.currentCamera.eye);l.normalize(aa,aa);X=5*Math.max(Math.abs(this.view.camera.position.z),50);const R=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view._stage.camera,80);l.copy(H,l.add(S,this.currentCamera.eye,l.scale(S,aa,R?Math.min(R,X):X)));this.planeVertical[3]=-l.dot(this.planeVertical,H)}this.computePlanePoints(Q.pointers,this.planeVertical,
this.beginCamera,this.tmpPoints)}else this.computePlanePoints(Q.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);r.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};P.update=function(Q){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var X=1<Q.pointers.size,aa=this.panMode===r.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,S=this.beginCenter;if(X){var H=this.beginRadius/Q.radius;this.scalingValueSmooth.gain=
.001875*Math.min(Math.max(Q.radius,40),120);this.scalingValueSmooth.update(H);r.applyZoomToPoint(this.currentCamera,S,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*Q.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(Math.abs(Q.radius-this.beginRadius));D.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(Q.pointers,
aa,this.currentCamera,this.tmpPoints);r.centroid(this.tmpPoints,this.tmpCentroid3d);v.screenPointObjectToArray(Q.center,this.tmpCentroid2d);r.applyPanPlanar(this.currentCamera,S,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*Q.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);D.applyAll(this.view,this.currentCamera,this.constraintOptions);
X&&(X=this.planeHorizontal,aa=this.rotationValueSmooth.value,H=r.normalizeRotationDelta(Q.angle-aa),aa+=H,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(Q.radius,40),120),this.rotationValueSmooth.update(aa),aa=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(aa,.001*Q.timestamp),r.applyRotation(this.currentCamera,S,y.axisAngle.wrapAxisAngle(X,aa)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=D.pixelDistanceToInteractionFactor(Math.abs(Q.radius*
aa)),D.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};P.end=function(Q){Q.pointers.size===this.pointerCount&&this.update(Q);this.finishController();return(Q=this.zoomMomentumEstimator.evaluateMomentum())?new B.ZoomPlanarMomentumController({view:this.view,momentum:Q,zoomCenter:this.beginCenter}):(Q=this.rotationMomentumEstimator.evaluateMomentum())?new m.RotationMomentumController({view:this.view,momentum:Q,center:this.beginCenter,axis:y.plane.normal(this.planeHorizontal)}):
(Q=this.panMomentumEstimator.evaluateMomentum())?new x.PanPlanarMomentumController({view:this.view,momentum:Q}):null};P.computePlanePoints=function(Q,X,aa,S){S.length=Q.size;const H=this.tmp2d;let R=0;Q.forEach(T=>{H[0]=T.x;H[1]=T.y;void 0===S[R]&&(S[R]=t.create());r.intersectPlaneFromScreenPoint(X,aa,H,S[R]);R+=1});return S};g._createClass(L,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return L}(C.InteractiveController);b.__decorate([c.property({constructOnly:!0})],
a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,g,b){b=function(p){function f(k,c){var d=p.call(this,!0)||this;d.view=k;d.registerIncoming("pointer-down",
c,()=>d.view.state.stopActiveCameraController());return d}g._inheritsLoose(f,p);return f}(b.InputHandler);a.PointerDownCancelAnimation=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,g,b){b=function(p){function f(k,c,d){d=p.call(this,c,d)||this;d.view=k;d.key=c;return d}g._inheritsLoose(f,p);f.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>
{})};return f}(b.SingleKey);a.SingleKeyResetHeading=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,g,b){b=function(p){function f(k,c){var d=p.call(this,!0)||this;d.key=k;d.registerIncoming("key-down",c,e=>d._handleKeyDown(e));return d}g._inheritsLoose(f,p);f.prototype._handleKeyDown=function(k){k.data.key===this.key&&(this.activate(),
k.stopPropagation())};return f}(b.InputHandler);a.SingleKey=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,g,b){b=function(p){function f(k,c,d){d=p.call(this,c,d)||this;d.view=k;d.key=c;return d}g._inheritsLoose(f,p);f.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return f}(b.SingleKey);a.SingleKeyResetTilt=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../../input/InputHandler","../../state/controllers/RotateController"],function(a,g,b,p,f){p=function(k){function c(d,e=!1){var h=k.call(this,!0)||this;h.view=d;h.invert=e;h.registerIncoming("vertical-two-finger-drag",n=>h.handleTwoFinger(n));return h}g._inheritsLoose(c,k);c.prototype.handleTwoFinger=function(d){const e=
b.createScreenPointArray(0,d.data.delta*(this.invert?-1:1));switch(d.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new f.RotateController({view:this.view,pivot:"center"});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=
null)}};return c}(p.InputHandler);a.TwoFingerTilt=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler","../DragEventSeparator"],function(a,g,b,p){b=function(f){function k(d=20,e=40){var h=f.call(this,!1)||this;h._threshold=d;h._maxDelta=e;h.state="ready";h.emittedArtificalEnd2=!1;h._vertical=h.registerOutgoing("vertical-two-finger-drag");h._artificalDrag=
h.registerOutgoing("drag");h.dragEventSeparator=new p.DragEventSeparator({start:(n,q)=>h.observeStart(n,q),update:(n,q,u)=>h.observeUpdate(n,q,u),end:(n,q)=>h.observeEnd(q)});h.registerIncoming("drag",n=>h.dragEventSeparator.handle(n));return h}g._inheritsLoose(k,f);var c=k.prototype;c.observeStart=function(d,e){1===d&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,
pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),e.stopPropagation());this.state=2===d?"ready":"failed"};c.observeUpdate=function(d,e,h){"failed"!==this.state&&2===d&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,h.data)?this.checkVerticalThresholdReached(e.data,h.data)&&(this.state="active",this.emittedArtificalEnd2=
!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")};c.observeEnd=function(d){"active"===this.state&&(this._vertical.emit({delta:d.data.center.y-
this._thresholdReachedCenter.y,action:"end"}),this.state="ready",d.stopPropagation())};c.checkMovementWithinLimits=function(d,e){let h=-Infinity,n=Infinity,q=-Infinity,u=Infinity;e.pointers.forEach(y=>{h=Math.max(h,y.x);n=Math.min(n,y.x);q=Math.max(q,y.y);u=Math.min(u,y.y)});let v=-Infinity,t=Infinity,l=-Infinity,w=Infinity;d.pointers.forEach(y=>{v=Math.max(v,y.x);t=Math.min(t,y.x);l=Math.max(l,y.y);w=Math.min(w,y.y)});return Math.abs(d.center.x-e.center.x)<this._threshold&&Math.abs(v-t-(h-n))<=this._maxDelta&&
Math.abs(l-w-(q-u))<=this._maxDelta};c.checkVerticalThresholdReached=function(d,e){let h=Math.abs(d.center.y-e.center.y);d.pointers.forEach((n,q)=>{q=e.pointers.get(q);h=Math.min(h,Math.abs(n.y-q.y))});return h>=this._threshold};g._createClass(k,[{key:"failed",get:function(){return"failed"===this.state}}]);return k}(b.InputHandler);a.VerticalTwoFingerDrag=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let g=function(){function b(f){this.callbacks=
f;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var p=b.prototype;p.handle=function(f){const k=f.data,c=k.pointers.size;switch(k.action){case "start":this.currentCount=c;this.emitStart(f);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=c;this.emitStart(f);break;case "update":this.emitUpdate(f);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=c;this.emitStart(f);break;case "end":this.emitEnd(f),this.currentCount=
0}this.previousEvent=f};p.emitStart=function(f){this.startEvent=f;this.callbacks.condition(this.currentCount,f)&&this.callbacks.start(this.currentCount,f,this.startEvent)};p.emitUpdate=function(f){this.callbacks.condition(this.currentCount,f)&&this.callbacks.update(this.currentCount,f,this.startEvent)};p.emitEnd=function(f){this.callbacks.condition(this.currentCount,f)&&this.callbacks.end(this.currentCount,f,this.startEvent);this.startEvent=null};return b}();a.DragEventSeparator=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/interactive/graphics/analysisFactoryUtils":function(){define(["require","exports"],function(a,g){async function b(f){if(!(f in p))switch(f){case "DirectLineMeasurement3D":p[f]=Promise.all([new Promise(function(k,c){a(["./DirectLineMeasurement3D/DirectLineMeasurement3DView"],k,c)}),new Promise(function(k,c){a(["./DirectLineMeasurement3D/DirectLineMeasurement3DController"],k,c)})]).then(k=>({viewConstructor:k[0].DirectLineMeasurement3DView,controllerConstructor:k[1].DirectLineMeasurement3DController}))}return p[f]}
const p={};g.analysisControllerFactory=async function(f,k){return"3d"===f.type?new ((await b(k.type)).controllerConstructor)({view:f,dataObject:k}):null};g.analysisViewFactory=async function(f,k){return"3d"===f.type?new ((await b(k.type)).viewConstructor)({view:f,dataObject:k}):null};g.preloadAnalysisModules=async function(f){await b(f)};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(){var t=u.apply(this,arguments)||this;t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;t.SCENEVIEW_LOCKING_LOG=!1;t.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0;t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;t.DECONFLICTOR_SHOW_VISIBLE=!1;t.DECONFLICTOR_SHOW_INVISIBLE=!1;t.DECONFLICTOR_SHOW_GRID=!1;t.LABELS_SHOW_BORDER=!1;t.OVERLAY_DRAW_DEBUG_TEXTURE=!1;t.OVERLAY_SHOW_CENTER=!1;t.SHOW_POI=!1;t.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;t.DRAW_MESH_GEOMETRY_NORMALS=!1;t.FEATURE_TILE_FETCH_SHOW_TILES=!1;t.FEATURE_TILE_TREE_SHOW_TILES=!1;t.TERRAIN_TILE_TREE_SHOW_TILES=!1;t.I3S_TREE_SHOW_TILES=!1;t.I3S_SHOW_MODIFICATIONS=!1;t.ENABLE_PROFILE_DEPTH_RANGE=!1;t.DISABLE_FAST_UPDATES=!1;t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;t.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return t}a._inheritsLoose(v,u);return v}(q);g.__decorate([k.property()],b.prototype,
"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);g.__decorate([k.property()],b.prototype,"SCENEVIEW_LOCKING_LOG",void 0);g.__decorate([k.property()],b.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0);g.__decorate([k.property()],b.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);g.__decorate([k.property()],b.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);g.__decorate([k.property()],b.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);g.__decorate([k.property()],b.prototype,"DECONFLICTOR_SHOW_GRID",
void 0);g.__decorate([k.property()],b.prototype,"LABELS_SHOW_BORDER",void 0);g.__decorate([k.property()],b.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);g.__decorate([k.property()],b.prototype,"OVERLAY_SHOW_CENTER",void 0);g.__decorate([k.property()],b.prototype,"SHOW_POI",void 0);g.__decorate([k.property()],b.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);g.__decorate([k.property()],b.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);g.__decorate([k.property()],b.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",
void 0);g.__decorate([k.property()],b.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);g.__decorate([k.property()],b.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);g.__decorate([k.property()],b.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);g.__decorate([k.property()],b.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);g.__decorate([k.property()],b.prototype,"I3S_TREE_SHOW_TILES",void 0);g.__decorate([k.property()],b.prototype,"I3S_SHOW_MODIFICATIONS",void 0);g.__decorate([k.property()],b.prototype,
"ENABLE_PROFILE_DEPTH_RANGE",void 0);g.__decorate([k.property()],b.prototype,"DISABLE_FAST_UPDATES",void 0);g.__decorate([k.property()],b.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);g.__decorate([k.property()],b.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);g.__decorate([k.property()],b.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b=g.__decorate([d.subclass("esri.views.3d.support.DebugFlags")],b);return new b})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Handles ../../../../core/watchUtils ../../../support/Scheduler ../../../../core/MapUtils ../../support/geometryUtils ./Deconflictor ./LabelDeconflictor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){function r(A){A=A.layer;return!(!A||!A.featureReduction||"selection"!==A.featureReduction.type)}function C(A){(A=A.graphics3DGraphics)&&A.forEach(x=>x.clearVisibilityFlag(3))}a.GraphicsDeconflictor=function(A){function x(){var B=A.apply(this,arguments)||this;B._handles=new v;B._contexts=new Map;B._viewState=new D.DeconflictorViewState;B.visibilityGroup=0;B._iconMarginFactor=-.1;return B}g._inheritsLoose(x,A);var m=x.prototype;m.initialize=function(){this._handles.add([this.view.watch("state.camera",
()=>{this.updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(B,E)=>{1!==B&&1!==E||this.setDirty()}),t.init(this.view,"slicePlane",()=>{this.updateSlicePlane();this.slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(l.Task.GRAPHICS_DECONFLICTOR,B=>this.update(B),()=>this.needsUpdate());this._labels=new z.LabelDeconflictor({view:this.view,parent:this})};m.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();
this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};m.setDirty=function(){0<this._contexts.size&&(A.prototype.setDirty.call(this),this._labels.setDirty())};m.update=function(B){A.prototype.update.call(this,B);this.needsUpdate()||this._labels.setDirty()};m.setInitialIconVisibilityFlag=function(B,E){B=!(this._graphicSupportsDeconfliction(E)&&r(B));E.setVisibilityFlag(3,B,0)};m.updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this.updateSlicePlane())};m.updateSlicePlane=function(){const B=this.view?this.view.slicePlane:null;f.isSome(B)&&y.boundedPlane.transform(B,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=f.isSome(B)};m.slicePlaneChanged=function(){w.someMap(this._contexts,(B,E)=>E.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};m.addGraphicsOwner=function(B){let E=this._contexts.get(B);null==E&&(E=new Map,this._contexts.set(B,E),this.setDirty());return{addGraphic:F=>
this.addGraphic(B,E,F),removeGraphic:F=>this.removeGraphic(E,F),labelingInfoChange:()=>this._labels.enabledChanged(B,E),featureReductionChange:()=>this.enabledChanged(B,E),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(B,E),clear:()=>E.forEach(F=>this.removeGraphic(E,F.graphics3DGraphic))}};m.removeGraphicsOwner=function(B){const E=this._contexts.get(B);E&&(E.forEach(F=>this.removeGraphic(E,F.graphics3DGraphic)),this._contexts.delete(B),this.setDirty())};m.addGraphic=function(B,E,F){const G=
F.graphic.uid;F=new D.DeconflictorGraphic(F,B.symbolCreationContext.slicePlaneEnabled);E.set(G,F);r(B)&&this.addToActiveGraphics(F);B.labelsEnabled&&this._labels.addToActiveGraphics(F)};m.removeGraphic=function(B,E){E=E.graphic.uid;const F=B.get(E);F&&(this.removeFromActiveGraphics(F),this._labels.removeFromActiveGraphics(F),B.delete(E),this.setDirty())};m.enabledChanged=function(B,E){const F=r(B);F||C(B);this.modifyGraphics(E,F)};m._slicePlaneEnabledChanged=function(B,E){const F=B.symbolCreationContext.slicePlaneEnabled;
E.forEach(G=>G.slicePlaneEnabled=F);this.setDirty()};m.getGraphicsLayers=function(B){return B._graphics};m._graphicSupportsDeconfliction=function(B){if(B.isDraped)return!1;B=B._graphics;if(!B||!B.length)return!1;for(const E of B)if(this.layerSupportsDeconfliction(E))return!0;return!1};g._createClass(x,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(B){this._iconMarginFactor=
B;this.setDirty()}}]);return x}(D.Deconflictor);a.GraphicsDeconflictor=b.__decorate([h.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../chunks/sphere ../../support/geometryUtils ../../webgl-engine/lib/Camera ../../support/debugFlags ./deconflictorDebug ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J){function*L(ia){if(Map.prototype.entries){ia=ia.entries();for(let ma=ia.next();!ma.done;ma=ia.next())yield ma.value[1]}else yield*ia.values()}function*P(ia,ma,ea){ma.clear();ia.forEach((Z,la)=>{const ka=ma.pushNew();ka.id=la;ka.prio=Z.info?-Z.info[ea].distance:Number.MAX_VALUE});yield;const M=ma.iterableSort((Z,la)=>la.prio-Z.prio);for(let Z=M.next();!Z.done;Z=M.next())yield;ma.forAll(Z=>{const la=ia.get(Z.id);la&&(ia.delete(Z.id),
ia.set(Z.id,la))});ma.clear()}const Q=w.create(),X=x.create(),aa=x.create(),S=w.create(),H=C.create(),R=E.sphere.create(),T=E.ray.create(),W=w.create(),Y=r.create();let U=function(){this.aabr=r.create();this.distance=0;this.visible=this.culled=!1},N=function(){function ia(){this.active=new Map;this.visible=new Map}ia.prototype.clear=function(){this.active.clear();this.visible.clear()};return ia}(),ca=function(){},O=function(){this.sortArray=new v({allocator:ia=>ia||new ca})},V=function(){function ia(){this.camera=
new F;this.slicePlane=E.boundedPlane.create();this.slicePlaneEnabled=!1}ia.prototype.copyFrom=function(ma){this.camera.copyFrom(ma.camera);E.boundedPlane.copy(ma.slicePlane,this.slicePlane);this.slicePlaneEnabled=ma.slicePlaneEnabled};return ia}();a.Deconflictor=function(ia){function ma(){var M=ia.apply(this,arguments)||this;M._dirty=!1;M._runningViewState=new V;M._state=0;M.graphics=new N;M.iterators=new O;M.accBinsNumX=15;M.accBinsNumY=20;M.accBinsSizeX=0;M.accBinsSizeY=0;M.accBins=null;M.accNumTests=
0;return M}g._inheritsLoose(ma,ia);var ea=ma.prototype;ea.destroy=function(){this.graphics.clear();this.iterators=null};ea.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};ea.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};ea.update=function(M){switch(this._state){case 0:this.startUpdate(),M.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(M))break;case 2:if(this._state=2,!this.sortVisibleGraphics(M))break;
case 3:if(this._state=3,!this.deconflictVisibleGraphics(M))break;default:I.drawAccelerationStruct(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}};ea.modifyGraphics=function(M,Z){Z?M.forEach(la=>this.addToActiveGraphics(la)):M.forEach(la=>this.removeFromActiveGraphics(la));this.setDirty()};ea.layerSupportsDeconfliction=function(M){if(f.isNone(M)||"object3d"!==M.type)return!1;M=M.stageObject;return 1===(M?M.getNumGeometryRecords():0)&&M.getGeometryRecord(0).material instanceof
J.HUDMaterial?!0:!1};ea.startUpdate=function(){I.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:M,fullHeight:Z}=this._runningViewState.camera;this.initBins(M,Z);this.resetIterators()};ea.addToActiveGraphics=function(M){M.info[this.visibilityGroup]=new U;this.graphics.active.set(M.graphics3DGraphic.graphic.uid,M);this.setDirty()};ea.removeFromActiveGraphics=function(M){this.removeFromVisibleGraphics(M);{const Z=M.graphics3DGraphic;Z.destroyed||Z.clearVisibilityFlag(3,
this.visibilityGroup)}delete M.info[this.visibilityGroup];this.graphics.active.delete(M.graphics3DGraphic.graphic.uid);this.setDirty()};ea.addToVisibleGraphics=function(M){this.graphics.visible.set(M.graphics3DGraphic.graphic.uid,M)};ea.removeFromVisibleGraphics=function(M){this.graphics.visible.delete(M.graphics3DGraphic.graphic.uid)};ea.processActiveGraphics=function(M){const Z=this.ensureActiveGraphicsIterator(),la=z.invert(H,this._runningViewState.camera.projectionMatrix),ka="global"===this.view.viewingMode&&
1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?R:null;let ha=0;f.isSome(ka)&&(y.transformMat4(ka,w.ZEROS,this._runningViewState.camera.viewMatrix),ka[3]=D.getReferenceEllipsoid(this.view.spatialReference).radius,ha=E.sphere.distanceToSilhouette(ka,w.ZEROS));for(;!M.done;){M.madeProgress();var na=Z.next();if(na.done)return this.resetActiveGraphicsIterator(),!0;const da=(na=na.value)&&na.info[this.visibilityGroup];da&&(this.collectGraphics3DGraphics(na,la,ka,ha),
da.culled?this.removeFromVisibleGraphics(na):this.addToVisibleGraphics(na))}return!1};ea.sortVisibleGraphics=function(M){const Z=this.ensureSortGraphicsIterator();for(;!M.done;){const la=Z.next();M.madeProgress();if(la.done)return this.resetSortGraphicsIterator(),!0}return!1};ea.deconflictVisibleGraphics=function(M){const Z=this.ensureVisibleGraphicsIterator(),la=1===this.visibilityGroup;for(;!M.done;){M.madeProgress();var ka=Z.next();if(ka.done)return this.resetVisibleGraphicsIterator(),!0;ka=ka.value;
const na=ka.info[this.visibilityGroup];if(na&&!na.culled){var ha=ka.graphics3DGraphic;(ha=(!la||ha.isVisible())&&!this.isConflicted(ka))&&this.addToBins(ka);na.visible=ha;this.setGraphicVisibility(ka,ha);I.drawPoly(na,ha)}}return!1};ea.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};ea.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=L(this.graphics.active));return this.iterators.active};ea.resetActiveGraphicsIterator=
function(){this.iterators.active=null};ea.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=L(this.graphics.visible));return this.iterators.visible};ea.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};ea.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=P(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};ea.resetSortGraphicsIterator=function(){this.iterators.sort=
null};ea.collectGraphics3DGraphics=function(M,Z,la,ka){var ha=M.graphics3DGraphic;if(!ha.destroyed){var na=M.info[this.visibilityGroup];if(ha.isVisible(0,3)){var da=this.getGraphicsLayers(ha);r.empty(na.aabr);ha=null;for(const oa of da)if(this.layerSupportsDeconfliction(oa)){da=oa.stageObject.getGeometryRecord(0).material;if(f.isNone(ha)){ha=this.getProjectionInfo(oa,Z,fa);if(ha.isOutsideScreen||this.isCulledBySlice(M,Q)||f.isSome(la)&&this.isCulledByHorizon(ha,la,ka)){na.culled=!0;return}!G.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&
na.visible&&(ha.distance*=.7)}this.expandBoundingRect(na,oa,da,ha)}f.isNone(ha)?na.culled=!0:(na.distance=ha.distance,na.culled=!1)}else na.culled=!0}};ea.getProjectionInfo=function(M,Z,la){const ka=this._runningViewState.camera;M=M.stageObject;var ha=M.getGeometryRecord(0);const na=ha.material;var da=E.sphere.getCenter(M.getBounds());y.transformMat4(Q,da,ka.viewMatrix);da=ha.geometry.vertexAttributes;ha=da.get("normal").data;da=da.get("auxpos1").data;na.applyShaderOffsetsView(Q,ha,M.transformation,
da,ka,la.scaleInfo,Q);m.set(X,Q[0],Q[1],Q[2],1);m.transformMat4(aa,X,ka.projectionMatrix);y.scale(la.positionNDC,aa,1/aa[3]);na.applyShaderOffsetsNDC(la.positionNDC,da,ka,la.positionNDC,S);la.distanceWithoutPolygonOffset=ka.depthNDCToWorld(S[2]);la.distance=S[2]===la.positionNDC[2]?la.distanceWithoutPolygonOffset:ka.depthNDCToWorld(la.positionNDC[2]);m.set(aa,la.positionNDC[0],la.positionNDC[1],la.positionNDC[2],1);m.transformMat4(X,aa,Z);m.scale(X,X,1/X[3]);y.set(la.positionView,Q[0],Q[1],Q[2]);
return la};ea.isCulledByHorizon=function(M,Z,la){y.copy(T.direction,M.positionView);y.set(T.origin,0,0,0);return B.intersectRay(Z,T,W)?M.distanceWithoutPolygonOffset>la:!1};ea.isCulledBySlice=function(M,Z){return M.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&E.boundedPlane.extrusionContainsPoint(this._runningViewState.slicePlane,Z)};ea.expandBoundingRect=function(M,Z,la,{positionNDC:ka,scaleInfo:ha}){const na=this._runningViewState.camera;Z=Z.getScreenSize(ba);K.applyPrecomputedScaleFactor(Z,
ha.factor,Z);Z[0]*=na.pixelRatio;Z[1]*=na.pixelRatio;la=r.offset(la.calculateRelativeScreenBounds(Z,ha.factorAlignment.scale,Y),l.lerp(0,na.fullWidth,.5+.5*ka[0]),l.lerp(0,na.fullHeight,.5+.5*ka[1]));ka=this.iconMarginFactor;0!==ka&&(ka*=Math.min(r.width(la),r.height(la)),la[0]-=ka,la[1]-=ka,la[2]+=ka,la[3]+=ka);r.expand(M.aabr,la)};ea.isConflicted=function(M){const Z=M.graphics3DGraphic.graphic.uid;M=M.info[this.visibilityGroup];for(let la=Math.floor(M.aabr[0]/this.accBinsSizeX);la<=Math.floor(M.aabr[2]/
this.accBinsSizeX);la++)if(!(0>la||la>=this.accBinsNumX))for(let ka=Math.floor(M.aabr[1]/this.accBinsSizeY);ka<=Math.floor(M.aabr[3]/this.accBinsSizeY);ka++){if(0>ka||ka>=this.accBinsNumY)continue;const ha=this.accBins[la][ka];for(let na=0;na<ha.length;na++){const da=ha.data[na],oa=da.info[this.visibilityGroup];if(oa&&oa.visible&&da.graphics3DGraphic.graphic.uid!==Z&&(this.accNumTests++,r.intersects(oa.aabr,M.aabr)))return!0}}return!1};ea.initBins=function(M,Z){if(null==this.accBins){this.accBins=
[];for(var la=0;la<this.accBinsNumX;la++){this.accBins.push([]);var ka=this.accBins[this.accBins.length-1];for(let ha=0;ha<this.accBinsNumY;ha++)ka.push(new v)}}else for(la=0;la<this.accBinsNumX;la++)for(ka=0;ka<this.accBinsNumY;ka++)this.accBins[la][ka].clear();this.accBinsSizeX=M/this.accBinsNumX;this.accBinsSizeY=Z/this.accBinsNumY;this.accNumTests=0};ea.addToBins=function(M){var Z=M.info[this.visibilityGroup],la=Math.floor(Z.aabr[0]/this.accBinsSizeX);const ka=Math.floor(Z.aabr[2]/this.accBinsSizeX),
ha=Math.floor(Z.aabr[1]/this.accBinsSizeY);for(Z=Math.floor(Z.aabr[3]/this.accBinsSizeY);la<=ka;la++)if(!(0>la||la>=this.accBinsNumX))for(let na=ha;na<=Z;na++)0>na||na>=this.accBinsNumY||this.accBins[la][na].push(M)};ea.setGraphicVisibility=function(M,Z){M=M.graphics3DGraphic;M.destroyed||(M.setVisibilityFlag(3,Z,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(M,Z))};g._createClass(ma,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},
{key:"updating",get:function(){return 0!==this._state||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const M=this._state/4;return this._dirty?.5*M:M}}]);return ma}(t);b.__decorate([d.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);const ba=A.create(),
fa=new (function(){function ia(){this.positionView=w.create();this.positionNDC=w.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}g._createClass(ia,[{key:"isOutsideScreen",get:function(){const ma=this.positionNDC;return-1>ma[0]||-1>ma[1]||-1>ma[2]||1<=ma[0]||1<=ma[1]}}]);return ia}());a.DeconflictorGraphic=function(ia,ma,ea={}){this.graphics3DGraphic=
ia;this.slicePlaneEnabled=ma;this.info=ea};a.DeconflictorViewState=V;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,g){function b(n,q,u,v,t){d&&(d(),d=null);const l=e.height,w=h;w.beginPath();w.lineWidth=1;w.strokeStyle=t;w.moveTo(n,l-u);w.lineTo(q,l-u);w.stroke();w.lineTo(q,l-v);w.stroke();w.lineTo(q,l-u);w.stroke();w.lineTo(n,l-u);w.stroke();w.lineTo(n,l-u);w.stroke();w.closePath()}
let p=!1,f=!1,k=!1,c=!1,d=null,e,h;a.drawAccelerationStruct=function(n,q){if(f&&h){d&&(d(),d=null);var u=h,v=0;for(let t=0;t<n.accBinsNumX;t++)for(let l=0;l<n.accBinsNumY;l++){const w=n.accBins[t][n.accBinsNumY-1-l];v+=w.length;const y=t*n.accBinsSizeX,D=(t+1)*n.accBinsSizeX,z=l*n.accBinsSizeY,r=(l+1)*n.accBinsSizeY;u.fillText(w.length.toFixed(),y+5,z+15);b(y,D,z,r,"blue")}u.fillText("total totalShownLabels: "+v,70,40);u.fillText("total visible labels: "+q.size,70,50);u.fillText("total numTests: "+
n.accNumTests,70,30)}};a.drawPoly=function(n,q){p&&(q&&k||!q&&c)&&b(n.aabr[0],n.aabr[2],n.aabr[1],n.aabr[3],q?"green":"red")};a.prepare=function(n){k=g.DECONFLICTOR_SHOW_VISIBLE;c=g.DECONFLICTOR_SHOW_INVISIBLE;p=k||c;f=g.DECONFLICTOR_SHOW_GRID;d=null;p||f?d=()=>{{null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),n.surface.parentElement.style.position="relative",n.surface.parentElement.appendChild(e));const q=n.height*n.pixelRatio;e.setAttribute("width",`${n.width*n.pixelRatio}px`);
e.setAttribute("height",`${q}px`);e.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n.width}px;height:${n.height}px`);h=e.getContext("2d");h.clearRect(0,0,n.width,n.height);h.font="12px Arial"}}:e&&(e.parentElement.removeChild(e),e=null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],
function(a,g,b){function p(n,q,u){const v=u.parameters;u=u.paddingPixelsOverride;e.scale=Math.min(v.divisor/(q-v.offset),1);e.factor=Math.abs(n*n*n);e.minPixelSize=v.minPixelSize;e.paddingPixels=u;return e}function f(n,q){return 0===n?q.minPixelSize:q.minPixelSize*(1+2*q.paddingPixels/n)}function k(n,q){return Math.max(b.lerp(n*q.scale,n,q.factor),f(n,q))}let c=function(){function n(u,v,t,l={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},w){this.viewingMode=u;this.description=
v;this.ellipsoidRadius=t;this.parameters=l;this._paddingPixelsOverride=w;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}var q=n.prototype;q.update=function(u){if(this.parameters&&this.parameters.camera.fovY===u.fovY&&
this.parameters.camera.distance===u.distance)return!1;this.calculateParameters(u,this.ellipsoidRadius,this.parameters);return!0};q.overridePadding=function(u){return u!==this.paddingPixelsOverride?new n(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,u):this};q.calculateParameters=function(u,v,t){const {scaleStart:l,scaleFallOffRange:w,minPixelSize:y}=this.description,{fovY:D,distance:z}=u;var r=this.calculateCurvatureDependentParameters(u,v);v=this.coverageCompensation(u,v,
r);const {tiltAngle:C,scaleFallOffFactor:A}=r,x=Math.sin(C)*z,m=.5*Math.PI-C-D*(.5-l*v);r=x/Math.cos(m);v=(r-x/Math.cos(m+D*w*v)*A)/(1-A);t.camera.fovY=u.fovY;t.camera.distance=u.distance;t.offset=v;t.divisor=r-v;t.minPixelSize=y;return t};q.calculateCurvatureDependentParametersLocal=function(u,v,t=h){t.tiltAngle=this.description.curvatureDependent.min.tiltAngle;t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return t};q.calculateCurvatureDependentParametersGlobal=
function(u,v,t=h){const l=this.description.curvatureDependent;u=1+u.distance/v;u=Math.sqrt(u*u-1);const [w,y]=[l.min.curvature,l.max.curvature];u=b.clamp((u-w)/(y-w),0,1);const [D,z]=[l.min,l.max];t.tiltAngle=b.lerp(D.tiltAngle,z.tiltAngle,u);t.scaleFallOffFactor=b.lerp(D.scaleFallOffFactor,z.scaleFallOffFactor,u);return t};q.surfaceCoverageCompensationLocal=function(u,v,t){return(u.fovY-t.tiltAngle)/u.fovY};q.surfaceCoverageCompensationGlobal=function(u,v,t){const l=v*v;t=t.tiltAngle+.5*Math.PI;
const {fovY:w,distance:y}=u;u=y*y+l-2*Math.cos(t)*y*v;const D=Math.sqrt(u);return(Math.acos(Math.sqrt(u-l)/D)-Math.asin(v/(D/Math.sin(t)))+.5*w)/w};g._createClass(n,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return n}();const d={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,
minPixelSize:0},e={scale:0,factor:0,minPixelSize:0,paddingPixels:0},h={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(n,q,u=[0,0]){q=Math.min(Math.max(q.scale,f(n[1],q)/n[1]),1);u[0]=n[0]*q;u[1]=n[1]*q;return u};a.applyScaleFactor=k;a.applyScaleFactorVec2=function(n,q,u=[0,0]){const v=Math.min(Math.max(q.scale,f(n[1],q)/n[1]),1);u[0]=b.lerp(n[0]*v,n[0],q.factor);u[1]=b.lerp(n[1]*v,n[1],q.factor);return u};a.getLabelSettings=function(n,q){const {curvatureDependent:u,scaleStart:v,
scaleFallOffRange:t}=d;return new c(n,{curvatureDependent:{min:{curvature:u.min.curvature,tiltAngle:u.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:u.max.curvature,tiltAngle:u.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:v,scaleFallOffRange:t,minPixelSize:14},q)};a.getSettings=function(n,q){return new c(n,d,q)};a.precomputeScaleFactor=function(n,q,u,v){n=p(n,q,u);n.minPixelSize=0;n.paddingPixels=0;n=k(1,n);v.scale=n;v.factor=0;v.minPixelSize=u.parameters.minPixelSize;v.paddingPixels=u.paddingPixelsOverride};
a.scale=function(n,q,u,v){return k(n,p(q,u,v))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/mat3 ../../../../chunks/vec2 ../../support/buffer/InterleavedLayout ../lib/Util ../lib/geometryDataUtils ./renderers/utils ../lib/screenSizePerspectiveUtils ../../../../core/libs/gl-matrix-2/types/mat4 ../lib/GLMaterialTexture ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){function E(fa,ia,ma,ea=L){v.copy(ea,fa.anchorPos);ea[0]*=-ia[0];ea[1]*=-ia[1];ea[0]+=fa.screenOffset[0]*ma;ea[1]+=fa.screenOffset[1]*ma;return ea}function F(fa,ia,ma,ea,M,Z,la,ka){ia=ia-M-(0<ka[0]?ea[0]*ka[0]:0);let ha=ia+ea[0]+2*M;ma=ma-M-(0<ka[1]?ea[1]*ka[1]:0);M=ma+ea[1]+2*M;la.textureIsSignedDistanceField&&(la=la.distanceFieldBoundingBox,ia+=ea[0]*la[0],ma+=ea[1]*la[1],ha-=ea[0]*(1-la[2]),M-=ea[1]*(1-la[3]),ia-=Z,ha+=Z,ma-=Z,M+=Z);
return fa[0]>ia&&fa[0]<ha&&fa[1]>ma&&fa[1]<M}let G=function(fa){function ia(ea){ea=fa.call(this,ea,O)||this;ea.techniqueConfig=new B.HUDMaterialTechniqueConfiguration;return ea}g._inheritsLoose(ia,fa);var ma=ia.prototype;ma.getTechniqueConfig=function(ea,M){this.techniqueConfig.output=ea;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;
this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=
!!this.params.vvColorEnabled;0===ea&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder);4===ea&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;this.techniqueConfig.transparencyPassType=M?M.transparencyPassType:3;this.techniqueConfig.multipassGeometryEnabled=M?M.multipassGeometryEnabled:!1;return this.techniqueConfig};ma.intersect=function(ea,M,Z,la,ka,ha,na,da,oa){oa?this.intersectDrapedHudGeometry(ea,
ha,na,da):this.intersectHudGeometry(ea,M,Z,la,na,da)};ma.intersectDrapedHudGeometry=function(ea,M,Z,la){const ka=ea.vertexAttributes.get("position"),ha=ea.vertexAttributes.get("size"),na=this.params,da=m.calculateAnchorPosForRendering(na);let oa=1;var qa=1;b.isSome(la)&&(qa=la(U),oa=qa[0],qa=qa[5]);oa*=ea.screenToWorldRatio;qa*=ea.screenToWorldRatio;la=2*ea.screenToWorldRatio;for(let Ca=0;Ca<ka.data.length/ka.size;Ca++){var ua=Ca*ka.size;const Ja=ka.data[ua];ua=ka.data[ua+1];const Ha=Ca*ha.size;N[0]=
ha.data[Ha]*oa;N[1]=ha.data[Ha+1]*qa;let Na;na.textureIsSignedDistanceField&&(Na=na.outlineSize*ea.screenToWorldRatio/2);F(M,Ja,ua,N,la,Na,na,da)&&Z()}};ma.intersectHudGeometry=function(ea,M,Z,la,ka,ha){if(la.options.selectionMode&&la.options.hud&&!y.isInstanceHidden(M)){M=this.params;var na=1,da=1;u.fromMat4(H,Z);if(b.isSome(ha)){da=ha(U);na=da[0];da=da[5];{ha=H;var oa=ha[0],qa=ha[1],ua=ha[2],Ca=ha[3],Ja=ha[4],Ha=ha[5],Na=ha[6],Oa=ha[7],Va=ha[8],Ka=1/Math.sqrt(oa*oa+qa*qa+ua*ua);const wa=1/Math.sqrt(Ca*
Ca+Ja*Ja+Ha*Ha),Ea=1/Math.sqrt(Na*Na+Oa*Oa+Va*Va);ha[0]=oa*Ka;ha[1]=qa*Ka;ha[2]=ua*Ka;ha[3]=Ca*wa;ha[4]=Ja*wa;ha[5]=Ha*wa;ha[6]=Na*Ea;ha[7]=Oa*Ea;ha[8]=Va*Ea}}ha=ea.vertexAttributes.get("position");oa=ea.vertexAttributes.get("size");qa=ea.vertexAttributes.get("normal");ea=ea.vertexAttributes.get("auxpos1");l.assert(3<=ha.size);ua=la.point;Ca=la.camera;Ja=m.calculateAnchorPosForRendering(M);na*=Ca.pixelRatio;da*=Ca.pixelRatio;Ha="screen"===this.params.centerOffsetUnits;for(Na=0;Na<ha.data.length/ha.size;Na++)if(Oa=
Na*ha.size,c.set(P,ha.data[Oa],ha.data[Oa+1],ha.data[Oa+2]),c.transformMat4(P,P,Z),Oa=Na*oa.size,N[0]=oa.data[Oa]*na,N[1]=oa.data[Oa+1]*da,c.transformMat4(P,P,Ca.viewMatrix),Oa=Na*ea.size,c.set(W,ea.data[Oa+0],ea.data[Oa+1],ea.data[Oa+2]),Ha||(P[0]+=W[0],P[1]+=W[1],0!==W[2]&&(Oa=W[2],c.normalize(W,P),c.subtract(P,P,c.scale(W,W,Oa)))),Oa=Na*qa.size,c.set(Q,qa.data[Oa],qa.data[Oa+1],qa.data[Oa+2]),this.normalAndViewAngle(Q,H,Ca,Y),this.applyVerticalOffsetTransformationView(P,Y,Ca,J),Ca.applyProjection(P,
X),-1<X[0]){Oa=Math.floor(X[0])+this.params.screenOffset[0];Va=Math.floor(X[1])+this.params.screenOffset[1];Ha&&(Oa+=W[0],0!==W[1]&&(Va+=D.applyScaleFactor(W[1],J.factorAlignment)));D.applyPrecomputedScaleFactor(N,J.factor,N);Ka=1*Ca.pixelRatio;let wa;M.textureIsSignedDistanceField&&(wa=M.outlineSize*Ca.pixelRatio/2);F(ua,Oa,Va,N,Ka,wa,M,Ja)&&(Va=la.ray,c.transformMat4(S,P,d.invert(T,Ca.viewMatrix)),X[0]=ua[0],X[1]=ua[1],Ca.unprojectFromRenderScreen(X,P)&&(Oa=k.create(),c.copy(Oa,Va.direction),Ka=
1/c.length(Oa),c.scale(Oa,Oa,Ka),Va=c.distance(Va.origin,P)*Ka,ka(Va,Oa,-1,1,!0,S)))}}};ma.computeAttachmentOrigin=function(ea,M){var Z=ea.vertexAttributes;if(!Z)return!1;Z=Z.get("position");ea=ea.indices.get("position");return w.computeAttachmentOriginPoints(Z,ea,M)};ma.createBufferWriter=function(){return new ba(this)};ma.normalAndViewAngle=function(ea,M,Z,la){z.isMat4(M)&&(M=u.fromMat4(R,M));c.transformMat3(la.normal,ea,M);c.transformMat4(la.normal,la.normal,Z.viewInverseTransposeMatrix);la.cosAngle=
c.dot(aa,ca);return la};ma.updateScaleInfo=function(ea,M,Z){const la=this.params;la.screenSizePerspective?D.precomputeScaleFactor(Z,M,la.screenSizePerspective,ea.factor):(ea.factor.scale=1,ea.factor.factor=0,ea.factor.minPixelSize=0,ea.factor.paddingPixels=0);la.screenSizePerspectiveAlignment?D.precomputeScaleFactor(Z,M,la.screenSizePerspectiveAlignment,ea.factorAlignment):(ea.factorAlignment.factor=ea.factor.factor,ea.factorAlignment.scale=ea.factor.scale,ea.factorAlignment.minPixelSize=ea.factor.minPixelSize,
ea.factorAlignment.paddingPixels=ea.factor.paddingPixels)};ma.applyShaderOffsetsView=function(ea,M,Z,la,ka,ha,na){M=this.normalAndViewAngle(M,Z,ka,Y);this.applyVerticalGroundOffsetView(ea,M,ka,na);this.applyVerticalOffsetTransformationView(na,M,ka,ha);this.applyPolygonOffsetView(na,M,la[3],ka,na);this.applyCenterOffsetView(na,la,na);return na};ma.applyShaderOffsetsNDC=function(ea,M,Z,la,ka){this.applyCenterOffsetNDC(ea,M,Z,la);b.isSome(ka)&&c.copy(ka,la);this.applyPolygonOffsetNDC(la,M,Z,la);return la};
ma.applyPolygonOffsetView=function(ea,M,Z,la,ka){var ha=la.aboveGround?1:-1;Z=p.sign(Z);0===Z&&(Z=ha);ha*=Z;if(0>=this.params.shaderPolygonOffset)return c.copy(ka,ea);M=p.clamp(Math.abs(M.cosAngle),.01,1);la=1-Math.sqrt(1-M*M)/M/la.viewport[2];0<ha?c.scale(ka,ea,la):c.scale(ka,ea,1/la);return ka};ma.applyVerticalGroundOffsetView=function(ea,M,Z,la){const ka=c.length(ea),ha=Z.aboveGround?1:-1;Z=.5*Z.computeRenderPixelSizeAtDist(ka);M=c.scale(P,M.normal,ha*Z);c.add(la,ea,M);return la};ma.applyVerticalOffsetTransformationView=
function(ea,M,Z,la){const ka=this.params;if(!ka.verticalOffset||!ka.verticalOffset.screenLength){if(ka.screenSizePerspective||ka.screenSizePerspectiveAlignment){var ha=c.length(ea);this.updateScaleInfo(la,ha,M.cosAngle)}else la.factor.scale=1,la.factorAlignment.scale=1;return ea}ha=c.length(ea);Z=C.verticalOffsetAtDistance(Z,ha,ka.verticalOffset,M.cosAngle,ka.screenSizePerspectiveAlignment||ka.screenSizePerspective);this.updateScaleInfo(la,ha,M.cosAngle);c.scale(M.normal,M.normal,Z);return c.add(ea,
ea,M.normal)};ma.applyCenterOffsetView=function(ea,M,Z){const la="screen"!==this.params.centerOffsetUnits;Z!==ea&&c.copy(Z,ea);la&&(Z[0]+=M[0],Z[1]+=M[1],M[2]&&(c.normalize(Q,Z),c.add(Z,Z,c.scale(Q,Q,M[2]))));return Z};ma.applyCenterOffsetNDC=function(ea,M,Z,la){const ka="screen"!==this.params.centerOffsetUnits;la!==ea&&c.copy(la,ea);ka||(la[0]+=M[0]/Z.fullWidth*2,la[1]+=M[1]/Z.fullHeight*2);return la};ma.applyPolygonOffsetNDC=function(ea,M,Z,la){const ka=this.params.shaderPolygonOffset;ea!==la&&
c.copy(la,ea);ka&&(ea=Z.aboveGround?1:-1,M=ea*p.sign(M[3]),la[2]-=(M||ea)*ka);return la};ma.getGLMaterial=function(ea){if(0===ea.output||7===ea.output)return new I(ea);if(4===ea.output)return new K(ea)};ma.calculateRelativeScreenBounds=function(ea,M,Z=e.create()){E(this.params,ea,M,Z);Z[2]=Z[0]+ea[0];Z[3]=Z[1]+ea[1];return Z};return ia}(A.Material);r=function(fa){function ia(ea){ea=fa.call(this,{...ea,...ea.material.params})||this;ea.updateParameters();return ea}g._inheritsLoose(ia,fa);var ma=ia.prototype;
ma.beginSlot=function(ea){return ea===(this.material.params.drawInSecondSlot?19:18)};ma.updateParameters=function(ea){this.updateTexture(this.material.params.textureId);this.selectProgram(ea)};ma.selectProgram=function(ea){this.technique=this.techniqueRep.acquireAndReleaseExisting(B.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,ea),this.technique)};ma.ensureParameters=function(ea){this.updateParameters(ea)};ma.bind=function(ea,M){ea.bindProgram(this.technique.program);this.bindTexture(ea,
this.technique.program);this.bindTextureScale(ea,this.technique.program);this.technique.bindPass(ea,this.material.params,M)};return ia}(r);let I=function(fa){function ia(ea){ea=fa.call(this,ea)||this;ea.isOcclusionSlot=!1;return ea}g._inheritsLoose(ia,fa);var ma=ia.prototype;ma.beginSlot=function(ea){const M=this.material.params.drawInSecondSlot?19:18;if(this.material.params.occlusionTest)return this.isOcclusionSlot=12===ea,12===ea||ea===M;this.isOcclusionSlot=!1;return ea===M};ma.getTechnique=function(){return this.isOcclusionSlot?
this.occlusionTechnique:this.technique};ma.selectProgram=function(ea){this.technique=this.techniqueRep.acquireAndReleaseExisting(B.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,ea),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(B.HUDMaterialTechnique,this.material.getTechniqueConfig(6,ea),this.occlusionTechnique)};ma.bind=function(ea,M){const Z=this.getTechnique();ea.bindProgram(Z.program);this.isOcclusionSlot||(this.bindTexture(ea,Z.program),
this.bindTextureScale(ea,Z.program));Z.bindPass(ea,this.material.params,M)};return ia}(r),K=function(fa){function ia(ma){return fa.call(this,{...ma,output:4})||this}g._inheritsLoose(ia,fa);return ia}(r);const J={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=q.create(),P=k.create(),Q=k.create(),X=f.createRenderScreenPointArray3(),aa=k.create(),S=k.create(),H=h.create(),R=h.create(),T=n.create(),W=k.create(),Y={normal:aa,
cosAngle:0},U=n.create(),N=[0,0],ca=k.fromValues(0,0,1),O={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,
0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:q.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...A.materialParametersDefaults},V=t.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");let ba=function(){function fa(ma){this.material=ma;
this.vertexBufferLayout=V}var ia=fa.prototype;ia.allocate=function(ma){return this.vertexBufferLayout.createBuffer(ma)};ia.elementCount=function(ma){return 6*ma.indices.get("position").length};ia.write=function(ma,ea,M,Z){x.writePosition(ea.indices.get("position"),ea.vertexAttributes.get("position").data,ma.transformation,M.position,Z,6);x.writeNormal(ea.indices.get("normal"),ea.vertexAttributes.get("normal").data,ma.invTranspTransformation,M.normal,Z,6);var la=ea.vertexAttributes.get("uv0").data;
if(null==la||4>la.length){la=this.material.params;var ka=ma=0;var ha=la.texCoordScale[0];la=la.texCoordScale[1]}else ma=la[0],ka=la[1],ha=la[2],la=la[3];ha=Math.min(1.99999,ha+1);la=Math.min(1.99999,la+1);var na=ea.indices.get("position").length,da=M.uv0,oa=Z;for(var qa=0;qa<na;++qa)da.set(oa,0,ma),da.set(oa,1,ka),oa+=1,da.set(oa,0,ha),da.set(oa,1,ka),oa+=1,da.set(oa,0,ha),da.set(oa,1,la),oa+=1,da.set(oa,0,ha),da.set(oa,1,la),oa+=1,da.set(oa,0,ma),da.set(oa,1,la),oa+=1,da.set(oa,0,ma),da.set(oa,1,
ka),oa+=1;x.writeColor(ea.indices.get("color"),ea.vertexAttributes.get("color").data,4,M.color,Z,6);ma=ea.indices.get("size");ka=ea.vertexAttributes.get("size").data;ha=ma.length;la=M.size;na=Z;for(da=0;da<ha;++da){oa=ka[2*ma[da]];qa=ka[2*ma[da]+1];for(let ua=0;6>ua;++ua)la.set(na,0,oa),la.set(na,1,qa),na+=1}ea.indices.get("auxpos1")&&ea.vertexAttributes.get("auxpos1")&&x.writeBufferVec4(ea.indices.get("auxpos1"),ea.vertexAttributes.get("auxpos1").data,M.auxpos1,Z,6);ea.indices.get("auxpos2")&&ea.vertexAttributes.get("auxpos2")&&
x.writeBufferVec4(ea.indices.get("auxpos2"),ea.vertexAttributes.get("auxpos2").data,M.auxpos2,Z,6)};return fa}();a.HUDMaterial=G;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function g(p){return p instanceof Float32Array&&16<=p.length}function b(p){return Array.isArray(p)&&16<=p.length}a.isMat4=function(p){return g(p)||b(p)};a.isMat4f32=g;a.isMat4f64=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./DefaultTextureUnits","./GLMaterial"],function(a,g,b,p){return function(f){function k(d){var e=f.call(this,d)||this;e._textureIDs=new Set;e._textureRepository=d.textureRep;e._textureId=d.textureId;e._initTransparent=!!d.initTextureTransparent;e._texture=e._acquireIfNotUndefined(e._textureId);e._textureNormal=e._acquireIfNotUndefined(d.normalTextureId);e._textureEmissive=e._acquireIfNotUndefined(d.emissiveTextureId);e._textureOcclusion=e._acquireIfNotUndefined(d.occlusionTextureId);
e._textureMetallicRoughness=e._acquireIfNotUndefined(d.metallicRoughnessTextureId);return e}a._inheritsLoose(k,f);var c=k.prototype;c.dispose=function(){this._textureIDs.forEach(d=>this._textureRepository.release(d));this._textureIDs.clear()};c.updateTexture=function(d){d!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=d,this._texture=this._acquireIfNotUndefined(this._textureId))};c.bindTexture=function(d,e){g.isSome(this._texture)&&(e.setUniform1i("tex",b.DefaultTextureUnits.DIFFUSE),
d.bindTexture(this._texture.glTexture,b.DefaultTextureUnits.DIFFUSE));g.isSome(this._textureNormal)&&(e.setUniform1i("normalTexture",b.DefaultTextureUnits.NORMAL),d.bindTexture(this._textureNormal.glTexture,b.DefaultTextureUnits.NORMAL));g.isSome(this._textureEmissive)&&(e.setUniform1i("texEmission",b.DefaultTextureUnits.EMISSION),d.bindTexture(this._textureEmissive.glTexture,b.DefaultTextureUnits.EMISSION));g.isSome(this._textureOcclusion)&&(e.setUniform1i("texOcclusion",b.DefaultTextureUnits.OCCLUSION),
d.bindTexture(this._textureOcclusion.glTexture,b.DefaultTextureUnits.OCCLUSION));g.isSome(this._textureMetallicRoughness)&&(e.setUniform1i("texMetallicRoughness",b.DefaultTextureUnits.METALLIC_ROUGHNESS),d.bindTexture(this._textureMetallicRoughness.glTexture,b.DefaultTextureUnits.METALLIC_ROUGHNESS))};c.bindTextureScale=function(d,e){(d=g.isSome(this._texture)&&this._texture.glTexture)&&d.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",d.descriptor.textureCoordinateScaleFactor):
e.setUniform2f("textureCoordinateScaleFactor",1,1)};c._acquireIfNotUndefined=function(d){if(!g.isNone(d))return this._textureIDs.add(d),this._textureRepository.acquire(d,this._initTransparent)};c._releaseIfNotUndefined=function(d){g.isNone(d)||(this._textureIDs.delete(d),this._textureRepository.release(d))};return k}(p)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["exports"],function(a){a.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,
SSAO:6,SHADOW_MAP:7};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./AutoDisposable"],function(a,g){return function(b){function p(k){var c=b.call(this)||this;c.material=k.material;c.techniqueRep=k.techniqueRep;c.output=k.output;return c}a._inheritsLoose(p,b);var f=p.prototype;f.getTechnique=function(){return this.technique};f.getPipelineState=function(k,c){return this.getTechnique().pipeline};
f.ensureResources=function(k){return 2};f.ensureParameters=function(k){};return p}(g.AutoDisposable)})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){const b=f=>function(k){function c(){var d=k.apply(this,arguments)||this;d._isDisposed=!1;return d}g._inheritsLoose(c,k);c.prototype.dispose=function(){for(const e of null!=(d=this._managedDisposables)?d:[]){var d;d=this[e];this[e]=null;d&&"function"===typeof d.dispose&&
d.dispose()}this._isDisposed=!0};g._createClass(c,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return c}(f);let p=function(f){function k(){return f.apply(this,arguments)||this}g._inheritsLoose(k,f);return k}(b(function(){return function(){}}()));a.AutoDisposable=p;a.AutoDisposableMixin=b;a.autoDispose=function(){return(f,k)=>{if(!f.hasOwnProperty("_managedDisposables")){var c,d;f._managedDisposables=null!=(c=null==(d=f._managedDisposables)?void 0:d.slice())?c:[]}f._managedDisposables.unshift(k)}};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/maybe ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/support/aaBoundingBox ../../lib/Util ../renderers/utils ../../lib/screenSizePerspectiveUtils".split(" "),function(a,g,b,p,f,k,c,d,e){function h(A,x,m,B,E,F){if(!g.isNone(A)){var G=u(x,m,D);k.setMin(y,A.getBBMin());k.setMax(y,
A.getBBMax());g.isSome(E)&&E.applyToAabb(y);if(v(y,x,G,B)){const {primitiveIndices:I,indices:K,position:J}=A;G=I?I.length:K.length/3;if(1E3<G&&(A=A.getChildren(),void 0!==A)){for(G=0;8>G;++G)void 0!==A[G]&&h(A[G],x,m,B,E,F);return}n(x,m,0,G,K,J,I,E,F)}}}function n(A,x,m,B,E,F,G,I,K){if(G){var J=F.data;F=F.stride||F.size;var L=A[0],P=A[1];A=A[2];var Q=x[0]-L,X=x[1]-P;for(x=x[2]-A;m<B;++m){var aa=G[m],S=3*aa,H=F*E[S++],R=J[H++],T=J[H++],W=J[H];H=F*E[S++];var Y=J[H++],U=J[H++],N=J[H];H=F*E[S];S=J[H++];
var ca=J[H++];H=J[H];g.isSome(I)&&([R,T,W]=I.applyToVertex(R,T,W,m),[Y,U,N]=I.applyToVertex(Y,U,N,m),[S,ca,H]=I.applyToVertex(S,ca,H,m));Y-=R;U-=T;N-=W;S-=R;ca-=T;H-=W;var O=X*H-ca*x,V=x*S-H*Q;const fa=Q*ca-S*X;var ba=Y*O+U*V+N*fa;if(!(Math.abs(ba)<=Number.EPSILON)){R=L-R;T=P-T;W=A-W;O=R*O+T*V+W*fa;if(0<ba){if(0>O||O>ba)continue}else if(0<O||O<ba)continue;V=T*N-U*W;W=W*Y-N*R;T=R*U-Y*T;R=Q*V+X*W+x*T;if(0<ba){if(0>R||O+R>ba)continue}else if(0<R||O+R<ba)continue;W=(S*V+ca*W+H*T)/ba;0<=W&&(Y=q(Y,U,N,
S,ca,H,z),K(W,Y,aa))}}}else{G=F.data;J=F.stride||F.size;F=A[0];L=A[1];P=A[2];A=x[0]-F;Q=x[1]-L;X=x[2]-P;for(let fa=m,ia=3*m;fa<B;++fa)if(S=J*E[ia++],T=G[S++],W=G[S++],N=G[S],S=J*E[ia++],x=G[S++],m=G[S++],aa=G[S],S=J*E[ia++],Y=G[S++],U=G[S++],S=G[S],g.isSome(I)&&([T,W,N]=I.applyToVertex(T,W,N,fa),[x,m,aa]=I.applyToVertex(x,m,aa,fa),[Y,U,S]=I.applyToVertex(Y,U,S,fa)),x-=T,m-=W,aa-=N,Y-=T,U-=W,S-=N,H=Q*S-U*X,R=X*Y-S*A,ba=A*U-Y*Q,ca=x*H+m*R+aa*ba,!(Math.abs(ca)<=Number.EPSILON)){T=F-T;W=L-W;N=P-N;H=T*
H+W*R+N*ba;if(0<ca){if(0>H||H>ca)continue}else if(0<H||H<ca)continue;R=W*aa-m*N;N=N*x-aa*T;W=T*m-x*W;T=A*R+Q*N+X*W;if(0<ca){if(0>T||H+T>ca)continue}else if(0<T||H+T<ca)continue;N=(Y*R+U*N+S*W)/ca;0<=N&&(x=q(x,m,aa,Y,U,S,z),K(N,x,fa))}}}function q(A,x,m,B,E,F,G){f.set(r,A,x,m);f.set(C,B,E,F);f.cross(G,r,C);f.normalize(G,G);return G}function u(A,x,m){return f.set(m,1/(x[0]-A[0]),1/(x[1]-A[1]),1/(x[2]-A[2]))}function v(A,x,m,B){return t(A,x,m,B,Infinity)}function t(A,x,m,B,E){var F=(A[0]-B-x[0])*m[0],
G=(A[3]+B-x[0])*m[0];let I=Math.min(F,G);F=Math.max(F,G);G=(A[1]-B-x[1])*m[1];const K=(A[4]+B-x[1])*m[1];F=Math.min(F,Math.max(G,K));if(0>F)return!1;I=Math.max(I,Math.min(G,K));if(I>F)return!1;G=(A[2]-B-x[2])*m[2];A=(A[5]+B-x[2])*m[2];F=Math.min(F,Math.max(G,A));if(0>F)return!1;I=Math.max(I,Math.min(G,A));return I>F?!1:I<E}function l(A,x){x=x?l(x):{};for(const m in A){let B=A[m];B&&B.forEach&&(B=w(B));null==B&&m in x||(x[m]=B)}return x}function w(A){const x=[];A.forEach(m=>x.push(m));return x}const y=
k.create(),D=p.create(),z=p.create(),r=p.create(),C=p.create();a.bindScreenSizePerspective=function(A,x,m){if(A){var B=A.parameters;x.setUniform4f(m,B.divisor,B.offset,B.minPixelSize,A.paddingPixelsOverride)}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=u;a.computeNormal=q;a.copyParameters=l;a.intersectAabbInvDir=v;a.intersectAabbInvDirBefore=t;a.intersectDrapedRenderLineGeometry=function(A,x,m,B,E){if(x.options.selectionMode){x=A.vertexAttributes.get("position").data;var F=
A.vertexAttributes.get("size"),G=m[0];m=m[1];A=(((F&&F.data[0])+B)/2+4)*A.screenToWorldRatio;B=Number.MAX_VALUE;for(F=0;F<x.length-5;F+=3){var I=x[F],K=x[F+1],J=G-I,L=m-K;I=x[F+3]-I;K=x[F+4]-K;const P=b.clamp((I*J+K*L)/(I*I+K*K),0,1);J=I*P-J;L=K*P-L;L=J*J+L*L;L<B&&(B=L)}B<A*A&&E()}};a.intersectTriangleGeometry=function(A,x,m,B,E,F,G){x=d.isInstanceHidden(x);m=m.tolerance;x||(A.boundingInfo?(c.assert(0===A.primitiveType),h(A.boundingInfo,B,E,m,F,G)):(m=A.indices.get("position"),A=A.vertexAttributes.get("position"),
n(B,E,0,m.length/3,m,A,void 0,F,G)))};a.intersectTriangles=n;a.updateParameters=function(A,x){let m=!1;for(const B in x){const E=x[B];void 0!==E&&(m=!0,Array.isArray(E)?A[B]=E.slice():A[B]=E)}return m};a.verticalOffsetAtDistance=function(A,x,m,B,E){let F=(m.screenLength||0)*A.pixelRatio;E&&(F=e.scale(F,B,x,E));return b.glClamp(F*Math.tan(.5*A.fovY)/(.5*A.fullHeight)*x,m.minWorldLength||0,null!=m.maxWorldLength?m.maxWorldLength:Infinity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./DefaultVertexAttributeLocations ./ContentObject ../materials/internal/MaterialUtil".split(" "),
function(a,g,b,p,f,k){f=function(c){function d(h,n){var q=c.call(this)||this;q.type=3;q.supportsEdges=!1;q._visible=!0;q._renderPriority=0;q._insertOrder=0;q._vertexAttributeLocations=p.Default3D;q._params=k.copyParameters(h,n);q.validateParameterValues(q._params);return q}g._inheritsLoose(d,c);var e=d.prototype;e.dispose=function(){};e.update=function(h){return!1};e.setParameterValues=function(h){k.updateParameters(this._params,h)&&(this.validateParameterValues(this._params),this.parametersChanged())};
e.validateParameterValues=function(h){};e.isVisibleInPass=function(h){return!0};e.isVisible=function(){return this._visible};e.parametersChanged=function(){b.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};g._createClass(d,[{key:"params",get:function(){return this._params}},{key:"visible",get:function(){return this._visible},set:function(h){h!==this._visible&&(this._visible=h,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.params.renderOccluded}},
{key:"renderPriority",get:function(){return this._renderPriority},set:function(h){h!==this._renderPriority&&(this._renderPriority=h,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(h){h!==this._insertOrder&&(this._insertOrder=h,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return d}(f.ContentObject);a.Material=f;a.materialParametersDefaults={renderOccluded:1};a.materialPredicate=
function(c,d){return c.isVisible()&&c.isVisibleInPass(d.pass)&&0!==(c.renderOccluded&d.renderOccludedMask)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../support/buffer/BufferView","../../lib/Util"],function(a,g,b){function p(h,n,q,u){const v=q.typedBuffer;q=q.typedBufferStride;const t=h.length;u*=q;for(let l=0;l<t;++l){const w=2*h[l];v[u]=n[w];v[u+1]=n[w+1];u+=q}}function f(h,n,q,u,v){const t=
q.typedBuffer;q=q.typedBufferStride;const l=h.length;u*=q;if(null==v||1===v)for(v=0;v<l;++v){var w=3*h[v];t[u]=n[w];t[u+1]=n[w+1];t[u+2]=n[w+2];u+=q}else for(w=0;w<l;++w){const y=3*h[w];for(let D=0;D<v;++D)t[u]=n[y],t[u+1]=n[y+1],t[u+2]=n[y+2],u+=q}}function k(h,n,q,u,v=1){const t=q.typedBuffer;q=q.typedBufferStride;const l=h.length;u*=q;if(1===v)for(v=0;v<l;++v){var w=4*h[v];t[u]=n[w];t[u+1]=n[w+1];t[u+2]=n[w+2];t[u+3]=n[w+3];u+=q}else for(w=0;w<l;++w){const y=4*h[w];for(let D=0;D<v;++D)t[u]=n[y],
t[u+1]=n[y+1],t[u+2]=n[y+2],t[u+3]=n[y+3],u+=q}}function c(h,n,q,u,v,t=1){if(q){const r=u.typedBuffer;u=u.typedBufferStride;const C=h.length,A=q[0],x=q[1],m=q[2],B=q[4],E=q[5],F=q[6],G=q[8],I=q[9],K=q[10],J=q[12],L=q[13];q=q[14];v*=u;if(1===t)for(t=0;t<C;++t){var l=3*h[t],w=n[l],y=n[l+1];l=n[l+2];r[v]=A*w+B*y+G*l+J;r[v+1]=x*w+E*y+I*l+L;r[v+2]=m*w+F*y+K*l+q;v+=u}else for(w=0;w<C;++w){y=3*h[w];var D=n[y],z=n[y+1];const P=n[y+2];y=A*D+B*z+G*P+J;l=x*D+E*z+I*P+L;D=m*D+F*z+K*P+q;for(z=0;z<t;++z)r[v]=y,
r[v+1]=l,r[v+2]=D,v+=u}}else f(h,n,u,v,t)}function d(h,n,q,u,v,t){if(q){const r=u.typedBuffer;u=u.typedBufferStride;const C=h.length,A=q[0],x=q[1],m=q[2],B=q[4],E=q[5],F=q[6],G=q[8],I=q[9];q=q[10];const K=1E-5<Math.abs(1-A*A+B*B+G*G)||1E-5<Math.abs(1-x*x+E*E+I*I)||1E-5<Math.abs(1-m*m+F*F+q*q);v*=u;if(1===t)for(t=0;t<C;++t){var l=3*h[t],w=n[l],y=n[l+1],D=n[l+2];l=A*w+B*y+G*D;var z=x*w+E*y+I*D;w=m*w+F*y+q*D;K&&(y=l*l+z*z+w*w,.999999>y&&1E-6<y&&(y=Math.sqrt(y),l/=y,z/=y,w/=y));r[v+0]=l;r[v+1]=z;r[v+
2]=w;v+=u}else for(l=0;l<C;++l){z=3*h[l];y=n[z];D=n[z+1];const J=n[z+2];z=A*y+B*D+G*J;w=x*y+E*D+I*J;y=m*y+F*D+q*J;K&&(D=z*z+w*w+y*y,.999999>D&&1E-6<D&&(D=Math.sqrt(D),z/=D,w/=D,y/=D));for(D=0;D<t;++D)r[v+0]=z,r[v+1]=w,r[v+2]=y,v+=u}}else f(h,n,u,v,t)}function e(h,n,q,u,v,t=1){const l=u.typedBuffer;u=u.typedBufferStride;const w=h.length;v*=u;if(1===t)if(4===q)for(t=0;t<w;++t)q=4*h[t],l[v]=n[q],l[v+1]=n[q+1],l[v+2]=n[q+2],l[v+3]=n[q+3],v+=u;else{if(3===q)for(t=0;t<w;++t)q=3*h[t],l[v]=n[q],l[v+1]=n[q+
1],l[v+2]=n[q+2],l[v+3]=255,v+=u}else if(4===q)for(q=0;q<w;++q){var y=4*h[q];for(var D=0;D<t;++D)l[v]=n[y],l[v+1]=n[y+1],l[v+2]=n[y+2],l[v+3]=n[y+3],v+=u}else if(3===q)for(q=0;q<w;++q)for(y=3*h[q],D=0;D<t;++D)l[v]=n[y],l[v+1]=n[y+1],l[v+2]=n[y+2],l[v+3]=255,v+=u}a.writeBufferMat3f=function(h,n,q,u){const v=q.typedBuffer;q=q.typedBufferStride;const t=h.length;u*=q;for(let l=0;l<t;++l){const w=9*h[l];for(let y=0;9>y;++y)v[u+y]=n[w+y];u+=q}};a.writeBufferMat4f=function(h,n,q,u){const v=q.typedBuffer;
q=q.typedBufferStride;const t=h.length;u*=q;for(let l=0;l<t;++l){const w=16*h[l];for(let y=0;16>y;++y)v[u+y]=n[w+y];u+=q}};a.writeBufferVec2=p;a.writeBufferVec3=f;a.writeBufferVec4=k;a.writeColor=e;a.writeDefaultAttributes=function(h,n,q,u,v,t){for(const w of n.fieldNames){n=h.vertexAttributes.get(w);const y=h.indices.get(w);if(n&&y)switch(w){case "position":b.assert(3===n.size);var l=v.getField(w,g.BufferViewVec3f);l&&c(y,n.data,q,l,t);break;case "normal":b.assert(3===n.size);(l=v.getField(w,g.BufferViewVec3f))&&
d(y,n.data,u,l,t,1);break;case "uv0":b.assert(2===n.size);(l=v.getField(w,g.BufferViewVec2f))&&p(y,n.data,l,t);break;case "color":b.assert(3===n.size||4===n.size);(l=v.getField(w,g.BufferViewVec4u8))&&e(y,n.data,n.size,l,t);break;case "symbolColor":b.assert(3===n.size||4===n.size);(l=v.getField(w,g.BufferViewVec4u8))&&e(y,n.data,n.size,l,t);break;case "tangent":b.assert(4===n.size),(l=v.getField(w,g.BufferViewVec4f))&&k(y,n.data,l,t)}}};a.writeNormal=d;a.writePosition=c;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2f64 ./vec4f64 ./vec2 ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){function w(z){const r=new k.ShaderBuilder;var C=z.signedDistanceFieldEnabled;r.include(d.AlignPixel);r.include(n.HUD,z);r.include(e.Slice,z);if(6===z.output)return r.include(u.HUDOcclusionPass,z),r;r.include(h.ScreenSizePerspective);r.fragment.include(q.RgbaFloatEncoding);r.fragment.include(c.ColorConversion);r.include(t.VisualVariables,z);r.varyings.add("vcolor","vec4");r.varyings.add("vtc","vec2");r.varyings.add("vsize","vec2");z.binaryHighlightOcclusionEnabled&&
r.varyings.add("voccluded","float");r.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");C&&r.vertex.uniforms.add("outlineColor","vec4");z.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspective","vec4");(z.debugDrawBorder||z.binaryHighlightOcclusionEnabled)&&r.varyings.add("debugBorderCoords","vec4");r.attributes.add("uv0","vec2");r.attributes.add("color","vec4");r.attributes.add("size","vec2");
r.attributes.add("auxpos2","vec4");r.vertex.code.add(f.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${z.screenSizePerspectiveEnabled?f.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:f.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${z.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${z.occlusionTestEnabled||z.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${z.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var A=f.glsl`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `;const x=z.pixelSnappingEnabled?C?f.glsl`
  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:f.glsl`
  posProj += quadOffset;
  if (inputSize.x == size.x) {
    posProj = alignToPixelOrigin(posProj, viewport.zw);
  }`:f.glsl`posProj += quadOffset;`;r.vertex.code.add(f.glsl`
      ${z.occlusionTestEnabled?"if (visible) {":""}
      ${A}
      ${z.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${f.glsl.float(l.symbolAlphaCutoff)};
      ${C?`alphaDiscard = alphaDiscard && outlineColor.a < ${f.glsl.float(l.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${x}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${z.debugDrawBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${z.occlusionTestEnabled?f.glsl`} else { vtc = vec2(0.0);
        ${z.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);r.fragment.uniforms.add("tex","sampler2D");C&&(r.fragment.uniforms.add("outlineColor","vec4"),r.fragment.uniforms.add("outlineSize","float"));A=z.debugDrawBorder?f.glsl`(isBorder > 0.0 ? 0.0 : ${f.glsl.float(l.defaultMaskAlphaCutoff)})`:f.glsl.float(l.defaultMaskAlphaCutoff);C=f.glsl`
    ${z.debugDrawBorder?f.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${C?f.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${A} ||
          fillPixelColor.a + outlinePixelColor.a < ${f.glsl.float(l.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${A}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:f.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${A}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${z.debugDrawBorder?f.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;7===z.output&&r.fragment.code.add(f.glsl`
      void main() {
        ${C}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);0===z.output&&r.fragment.code.add(f.glsl`
    void main() {
      ${C}
      ${z.FrontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);4===z.output&&(r.include(v.OutputHighlight),r.fragment.code.add(f.glsl`
    void main() {
      ${C}
      ${z.binaryHighlightOcclusionEnabled?f.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return r}function y(z,r=D){if(z.textureIsSignedDistanceField){var C=z.anchorPos;z=z.distanceFieldBoundingBox;r[0]=C[0]*(z[2]-z[0])+z[0];r[1]=C[1]*(z[3]-z[1])+z[1]}else p.copy(r,z.anchorPos);return r}(function(z){z.bindUniforms=function(r,C,A){r.setUniform4fv("materialColor",C.color);C.textureIsSignedDistanceField&&(0>=C.outlineColor[3]||0>=C.outlineSize?(r.setUniform4fv("outlineColor",b.ZEROS),r.setUniform1f("outlineSize",0)):(r.setUniform4fv("outlineColor",C.outlineColor),r.setUniform1f("outlineSize",
C.outlineSize)));r.setUniform2f("screenOffset",2*C.screenOffset[0]*A,2*C.screenOffset[1]*A);r.setUniform2fv("anchorPos",y(C))}})(a.HUDMaterial||(a.HUDMaterial={}));const D=g.create();g=Object.freeze({__proto__:null,build:w,get HUDMaterial(){return a.HUDMaterial},calculateAnchorPosForRendering:y});a.HUDMaterialShader=g;a.build=w;a.calculateAnchorPosForRendering=y})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3f64",
"../../../../../chunks/vec3","../shaderModules/interfaces"],function(a,g,b,p,f){function k(d,e){if(e.slicePlaneEnabled){d.extensions.add("GL_OES_standard_derivatives");e.sliceEnabledForVertexPrograms&&(d.vertex.uniforms.add("slicePlaneOrigin","vec3"),d.vertex.uniforms.add("slicePlaneBasis1","vec3"),d.vertex.uniforms.add("slicePlaneBasis2","vec3"));d.fragment.uniforms.add("slicePlaneOrigin","vec3");d.fragment.uniforms.add("slicePlaneBasis1","vec3");d.fragment.uniforms.add("slicePlaneBasis2","vec3");
var h=f.glsl`
      struct SliceFactors {
        float front;
        float side0;
        float side1;
        float side2;
        float side3;
      };

      SliceFactors calculateSliceFactors(vec3 pos) {
        vec3 rel = pos - slicePlaneOrigin;

        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);

        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);

        float basis1Dot = dot(slicePlaneBasis1, rel);
        float basis2Dot = dot(slicePlaneBasis2, rel);

        return SliceFactors(
          dot(slicePlaneNormal, pos) + slicePlaneW,
          -basis1Dot - basis1Len2,
          basis1Dot - basis1Len2,
          -basis2Dot - basis2Len2,
          basis2Dot - basis2Len2
        );
      }

      bool sliceByFactors(SliceFactors factors) {
        return factors.front < 0.0
          && factors.side0 < 0.0
          && factors.side1 < 0.0
          && factors.side2 < 0.0
          && factors.side3 < 0.0;
      }

      bool sliceEnabled() {
        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.
        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
      }

      bool sliceByPlane(vec3 pos) {
        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
      }

      #define rejectBySlice(_pos_) sliceByPlane(_pos_)
      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }
    `,n=f.glsl`
      vec4 applySliceHighlight(vec4 color, vec3 pos) {
        SliceFactors factors = calculateSliceFactors(pos);

        if (sliceByFactors(factors)) {
          return color;
        }

        const float HIGHLIGHT_WIDTH = 1.0;
        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);

        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);

        float highlightFactor = (1.0 - step(0.5, factors.front))
          * (1.0 - step(0.5, factors.side0))
          * (1.0 - step(0.5, factors.side1))
          * (1.0 - step(0.5, factors.side2))
          * (1.0 - step(0.5, factors.side3));

        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
      }
    `;n=e.sliceHighlightDisabled?f.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:f.glsl`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;e.sliceEnabledForVertexPrograms&&d.vertex.code.add(h);d.fragment.code.add(h);d.fragment.code.add(n)}else h=f.glsl`
      #define rejectBySlice(_pos_) false
      #define discardBySlice(_pos_) {}
      #define highlightSlice(_color_, _pos_) (_color_)
    `,e.sliceEnabledForVertexPrograms&&d.vertex.code.add(h),d.fragment.code.add(h)}(function(d){d.bindUniformsWithOrigin=function(e,h,n){d.bindUniforms(e,h,n.slicePlane,n.origin)};d.bindUniforms=function(e,h,n,q){h.slicePlaneEnabled&&(g.isSome(n)?(q?(p.subtract(c,n.origin,q),e.setUniform3fv("slicePlaneOrigin",c)):e.setUniform3fv("slicePlaneOrigin",n.origin),e.setUniform3fv("slicePlaneBasis1",n.basis1),e.setUniform3fv("slicePlaneBasis2",n.basis2)):(e.setUniform3fv("slicePlaneBasis1",b.ZEROS),e.setUniform3fv("slicePlaneBasis2",
b.ZEROS),e.setUniform3fv("slicePlaneOrigin",b.ZEROS)))}})(k||(k={}));const c=b.create();a.Slice=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(a,g,b){function p(f){f.vertex.code.add(g.glsl`
    float screenSizePerspectiveMinSize(float size, vec4 factor) {
      float nonZeroSize = 1.0 - step(size, 0.0);

      return (
        factor.z * (
          1.0 +
          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding
          nonZeroSize *
          2.0 * factor.w / (
            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1
          )
        )
      );
    }
  `);f.vertex.code.add(g.glsl`
    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
      return absCosAngle * absCosAngle * absCosAngle;
    }
  `);f.vertex.code.add(g.glsl`
    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
      return vec4(
        min(params.x / (distanceToCamera - params.y), 1.0),
        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
        params.z,
        params.w
      );
    }
  `);f.vertex.code.add(g.glsl`
    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
    }
  `);f.vertex.code.add(g.glsl`
    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorFloat(
        size,
        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
      );
    }
  `);f.vertex.code.add(g.glsl`
    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
    }
  `);f.vertex.code.add(g.glsl`
    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
    }
  `)}(function(f){f.bindUniforms=function(k,c){c.screenSizePerspective&&(b.bindScreenSizePerspective(c.screenSizePerspective,k,"screenSizePerspective"),b.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||c.screenSizePerspective,k,"screenSizePerspectiveAlignment"))}})(p||(p={}));a.ScreenSizePerspective=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/ScreenSizePerspective.glsl"],
function(a,g,b){function p(f,k){f.include(b.ScreenSizePerspective);f.attributes.add("position","vec3");f.attributes.add("normal","vec3");f.attributes.add("auxpos1","vec4");f.vertex.uniforms.add("proj","mat4");f.vertex.uniforms.add("view","mat4");f.vertex.uniforms.add("viewNormal","mat4");f.vertex.uniforms.add("viewport","vec4");f.vertex.uniforms.add("camPos","vec3");f.vertex.uniforms.add("polygonOffset","float");f.vertex.uniforms.add("cameraGroundRelative","float");f.vertex.uniforms.add("pixelRatio",
"float");f.vertex.uniforms.add("perDistancePixelRatio","float");f.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");k.verticalOffsetEnabled&&f.vertex.uniforms.add("verticalOffset","vec4");k.screenSizePerspectiveEnabled&&f.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");f.vertex.uniforms.add("hudVisibilityTexture","sampler2D");f.vertex.constants.add("smallOffsetAngle","float",.984807753012208);f.vertex.code.add(g.glsl`
    struct ProjectHUDAux {
      vec3 posModel;
      vec3 posView;
      vec3 vnormal;

      float distanceToCamera;
      float absCosAngle;
    };
  `);f.vertex.code.add(g.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = sign(pointGroundDistance);

      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation
      // we take the absolute value because the sign that is dropped is
      // instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);

        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);k.isDraped||f.vertex.code.add(g.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `);f.vertex.code.add(g.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${k.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${k.screenSizePerspectiveEnabled?k.verticalOffsetEnabled||1===k.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${k.verticalOffsetEnabled?k.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${k.verticalOffsetEnabled?g.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==k.screenCenterOffsetUnitsEnabled?g.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===k.screenCenterOffsetUnitsEnabled?k.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${1===k.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);f.vertex.code.add(g.glsl`
    bool testVisibilityHUD(vec4 posProj) {
      // For occlusion testing, use the nearest pixel center to avoid
      // subpixel filtering messing up the color we use to test for
      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);

      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written
      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)
      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts

      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here
      if (uRenderTransparentlyOccludedHUD > 0.5) {
        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if
        // uRenderTransparentlyOccludedHUD = 0.75
        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
      }

      // and visible pixels that are not occluded by semi-transparent geometry here
      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
    }
  `)}(function(f){f.bindUniforms=function(k,c){k.setUniform1f("uRenderTransparentlyOccludedHUD",0===c.renderTransparentlyOccludedHUD?1:1===c.renderTransparentlyOccludedHUD?0:.75)};f.bindVisibilityTexture=function(k,c,d){c.setUniform1i("hudVisibilityTexture",4);k.bindTexture(d.hudVisibilityTexture,4);k.setActiveTexture(0)}})(p||(p={}));a.HUD=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,g){a.RgbaFloatEncoding=function(b){b.code.add(g.glsl`
    // This is the maximum float value representable as 32bit fixed point,
    // it is rgba2float(vec4(1)) inlined.
    const float MAX_RGBA_FLOAT =
      255.0 / 256.0 +
      255.0 / 256.0 / 256.0 +
      255.0 / 256.0 / 256.0 / 256.0 +
      255.0 / 256.0 / 256.0 / 256.0 / 256.0;

    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)
    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

    vec4 float2rgba(const float value) {
      // Make sure value is in the domain we can represent
      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

      // Decompose value in 32bit fixed point parts represented as
      // uint8 rgba components. Decomposition uses the fractional part after multiplying
      // by a power of 256 (this removes the bits that are represented in the previous
      // component) and then converts the fractional part to 8bits.
      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

      // Convert uint8 values (from 0 to 255) to floating point representation for
      // the shader
      const float toU8AsFloat = 1.0 / 255.0;

      return fixedPointU8 * toU8AsFloat;
    }

    // Factors to convert rgba back to float
    const vec4 RGBA_2_FLOAT_FACTORS = vec4(
      255.0 / (256.0),
      255.0 / (256.0 * 256.0),
      255.0 / (256.0 * 256.0 * 256.0),
      255.0 / (256.0 * 256.0 * 256.0 * 256.0)
    );

    float rgba2float(vec4 rgba) {
      // Convert components from 0->1 back to 0->255 and then
      // add the components together with their corresponding
      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)
      return dot(rgba, RGBA_2_FLOAT_FACTORS);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../../shaderModules/interfaces","../shading/MultipassGeometryTest.glsl"],function(a,g,b){(function(p){p.bindUniforms=function(f){f.setUniform4f("color",1,1,1,1)}})(a.HUDOcclusion||(a.HUDOcclusion={}));a.HUDOcclusionPass=function(p,f){f.multipassGeometryEnabled&&p.vertex.include(b.multipassGeometryTest);p.vertex.code.add(g.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${f.multipassGeometryEnabled?g.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    }
    else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);p.fragment.uniforms.add("color","vec4");p.fragment.code.add(g.glsl`
  void main() {
    gl_FragColor = color;
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../../shaderModules/interfaces","../output/ReadLinearDepth.glsl"],function(a,g,b){a.bindMultipassGeometryUniforms=function(p,f,k){k.multipassGeometryEnabled&&k.geometryLinearDepthTexture&&(p.setUniform1i("geometryDepthTexture",11),f.bindTexture(k.geometryLinearDepthTexture,11))};a.multipassGeometryTest=function(p){p.include(b.ReadLinearDepth);
p.uniforms.add("geometryDepthTexture","sampler2D");p.uniforms.add("cameraNearFar","vec2");p.code.add(g.glsl`
    //Compare the linearized depths of the vertex/fragment and the geometry in the scene. If vertex/fragment is behind geometry, don't draw it.
    bool geometryDepthTest(vec2 pos, float elementDepth){

      float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
      if(elementDepth < (geometryDepth - 1.0)){
        return true;
      }
      return false;
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(a,g,b){a.ReadLinearDepth=function(p){p.include(b.RgbaFloatEncoding);p.code.add(g.glsl`
    float linearDepthFromFloat(float depth, vec2 nearFar) {
      return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
    }

    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
      return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces"],function(a,g,b){function p(c){c.fragment.uniforms.add("depthTex","sampler2D");c.fragment.uniforms.add("highlightViewportPixelSz","vec4");c.fragment.constants.add("occludedHighlightFlag","vec4",f).add("unoccludedHighlightFlag","vec4",k);c.fragment.code.add(b.glsl`
    void outputHighlight() {
      vec4 fragCoord = gl_FragCoord;

      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}const f=g.fromValues(1,1,0,1),k=g.fromValues(1,0,1,1);(function(c){c.bindOutputHighlight=function(d,e,h){d.bindTexture(h.highlightDepthTexture,5);e.setUniform1i("depthTex",5);e.setUniform4f("highlightViewportPixelSz",0,0,h.inverseViewport[0],h.inverseViewport[1])}})(p||(p={}));a.OutputHighlight=p;a.occludedHighlightFlag=f;a.unoccludedHighlightFlag=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,g){function b(p,f){f.vvInstancingEnabled&&(f.vvSize||f.vvColor)&&p.attributes.add("instanceFeatureAttribute","vec4");f.vvSize?(p.vertex.uniforms.add("vvSizeMinSize","vec3"),p.vertex.uniforms.add("vvSizeMaxSize","vec3"),p.vertex.uniforms.add("vvSizeOffset","vec3"),p.vertex.uniforms.add("vvSizeFactor","vec3"),p.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),p.vertex.uniforms.add("vvSymbolAnchor","vec3"),p.vertex.code.add(g.glsl`
      vec3 vvScale(vec4 _featureAttribute) {
        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
      }

      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
      }
    `),p.vertex.code.add(g.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${f.vvInstancingEnabled?g.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):p.vertex.code.add(g.glsl`
      vec4 localPosition() { return vec4(position, 1.0); }

      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }
    `);f.vvColor?(p.vertex.constants.add("vvColorNumber","int",8),p.vertex.code.add(g.glsl`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${f.vvInstancingEnabled?g.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):p.vertex.code.add(g.glsl`
      vec4 vvColor() { return vec4(1.0); }
    `)}(function(p){function f(k,c){c.vvSizeEnabled&&(k.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),k.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),k.setUniform3fv("vvSizeOffset",c.vvSizeOffset),k.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(k.setUniform1fv("vvColorValues",c.vvColorValues),k.setUniform4fv("vvColorColors",c.vvColorColors))}p.bindUniforms=f;p.bindUniformsWithOpacity=function(k,c){f(k,c);c.vvOpacityEnabled&&(k.setUniform1fv("vvOpacityValues",c.vvOpacityValues),
k.setUniform1fv("vvOpacityOpacities",c.vvOpacityOpacities))};p.bindUniformsForSymbols=function(k,c){f(k,c);c.vvSizeEnabled&&(k.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),k.setUniformMatrix3fv("vvSymbolRotationMatrix",c.vvSymbolRotationMatrix))}})(b||(b={}));a.VisualVariables=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.DiscardOrAdjustAlpha=
function(b,p){const f=b.fragment;switch(p.alphaDiscardMode){case 0:f.code.add(g.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${g.glsl.float(.001)}) { discard; } }
      `);break;case 1:f.code.add(g.glsl`
        void discardOrAdjustAlpha(inout vec4 color) {
          color.a = 1.0;
        }
      `);break;case 2:f.uniforms.add("textureAlphaCutoff","float");f.code.add(g.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }
      `);break;case 3:b.fragment.uniforms.add("textureAlphaCutoff","float"),b.fragment.code.add(g.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }
      `)}};a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../../../../chunks/HUDMaterial.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../lib/OrderIndependentTransparency".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r){k=function(x){function m(){return x.apply(this,arguments)||this}b._inheritsLoose(m,x);var B=m.prototype;B.initializeProgram=function(E){var F=m.shader.get();const G=this.configuration;F=F.build({output:G.output,FrontFacePass:2===G.transparencyPassType,viewingMode:E.viewingMode,occlusionTestEnabled:G.occlusionTestEnabled,signedDistanceFieldEnabled:G.sdf,slicePlaneEnabled:G.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,
debugDrawBorder:G.debugDrawBorder,binaryHighlightOcclusionEnabled:G.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:G.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:G.screenSizePerspective,verticalOffsetEnabled:G.verticalOffset,pixelSnappingEnabled:G.pixelSnappingEnabled,vvSize:G.vvSize,vvColor:G.vvColor,vvInstancingEnabled:!1,isDraped:G.isDraped,multipassGeometryEnabled:G.multipassGeometryEnabled});return new e(E.rctx,F.generateSource("vertex"),F.generateSource("fragment"),d.Default3D)};
B.bindPass=function(E,F,G){n.View.bindProjectionMatrix(this.program,G.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",G.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(G.camera.fovY/2)/(G.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",G.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",F.shaderPolygonOffset);z.VerticalOffset.bindUniforms(this.program,F,G);u.ScreenSizePerspective.bindUniforms(this.program,
F);this.program.setUniform1f("pixelRatio",G.camera.pixelRatio||1);n.View.bindViewport(this.program,G);6===this.configuration.output?(l.HUDOcclusion.bindUniforms(this.program),this.program.setUniform2fv("cameraNearFar",G.camera.nearFar),this.program.setUniform2fv("inverseViewport",G.inverseViewport),t.bindMultipassGeometryUniforms(this.program,E,G)):(v.HUD.bindUniforms(this.program,G),D.HUDMaterial.bindUniforms(this.program,F,G.camera.pixelRatio||1),y.VisualVariables.bindUniforms(this.program,F),this.configuration.occlusionTestEnabled&&
v.HUD.bindVisibilityTexture(E,this.program,G));4===this.configuration.output&&w.OutputHighlight.bindOutputHighlight(E,this.program,G)};B.bindDraw=function(E){n.View.bindView(this.program,E);n.View.bindCamPosition(this.program,E.origin,E.camera.viewInverseTransposeMatrix);q.Slice.bindUniformsWithOrigin(this.program,this.configuration,E)};B.setPipelineState=function(E){const F=this.configuration,G=3===E,I=this.configuration.polygonOffsetEnabled&&C,K=!G&&2!==E||4===F.output?null:(F.depthEnabled||6===
F.output)&&h.defaultDepthWriteParams;return h.makePipelineState({blending:0===F.output||7===F.output||4===F.output?G?A:r.OITBlending(E):null,depthTest:{func:515},depthWrite:K,colorWrite:h.defaultColorWriteParams,polygonOffset:I})};B.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};b._createClass(m,[{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]);return m}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(D.HUDMaterialShader,
()=>new Promise(function(x,m){a(["./HUDMaterial.glsl"],x,m)}));const C={factor:0,units:-4},A=h.simpleBlendingParams(1,771);f=function(x){function m(){var B=x.apply(this,arguments)||this;B.output=0;B.occlusionTestEnabled=!0;B.sdf=!1;B.vvSize=!1;B.vvColor=!1;B.verticalOffset=!1;B.screenSizePerspective=!1;B.screenCenterOffsetUnitsEnabled=0;B.debugDrawBorder=!0;B.binaryHighlightOcclusion=!0;B.slicePlaneEnabled=!1;B.polygonOffsetEnabled=!1;B.depthEnabled=!0;B.transparencyPassType=3;B.pixelSnappingEnabled=
!0;B.isDraped=!1;B.multipassGeometryEnabled=!1;return B}b._inheritsLoose(m,x);return m}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter()],f.prototype,"occlusionTestEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"sdf",void 0);p.__decorate([c.parameter()],f.prototype,"vvSize",void 0);p.__decorate([c.parameter()],f.prototype,"vvColor",void 0);p.__decorate([c.parameter()],f.prototype,"verticalOffset",void 0);p.__decorate([c.parameter()],
f.prototype,"screenSizePerspective",void 0);p.__decorate([c.parameter({count:2})],f.prototype,"screenCenterOffsetUnitsEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"debugDrawBorder",void 0);p.__decorate([c.parameter()],f.prototype,"binaryHighlightOcclusion",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"polygonOffsetEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"depthEnabled",void 0);p.__decorate([c.parameter({count:4})],
f.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],f.prototype,"pixelSnappingEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"isDraped",void 0);p.__decorate([c.parameter()],f.prototype,"multipassGeometryEnabled",void 0);g.HUDMaterialTechnique=k;g.HUDMaterialTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../util/ScreenSizePerspective.glsl"],function(a,g,b){function p(c,d){const e=c.vertex.code;d.verticalOffsetEnabled?(c.vertex.uniforms.add("verticalOffset","vec4"),d.screenSizePerspectiveEnabled&&(c.include(b.ScreenSizePerspective),c.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),e.add(g.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===d.viewingMode?g.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:g.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${d.screenSizePerspectiveEnabled?g.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:g.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):e.add(g.glsl`
    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }
    `)}function f(c,d,e,h=k){h.screenLength=c.screenLength;h.perDistance=Math.tan(.5*d)/(.5*e);h.minWorldLength=c.minWorldLength;h.maxWorldLength=c.maxWorldLength;return h}(function(c){c.bindUniforms=function(d,e,h){e.verticalOffset&&(e=f(e.verticalOffset,h.camera.fovY,h.camera.fullViewport[3]),d.setUniform4f("verticalOffset",e.screenLength*(h.camera.pixelRatio||1),e.perDistance,e.minWorldLength,e.maxWorldLength))}})(p||(p={}));const k={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};
a.VerticalOffset=p;a.calculateVerticalOffsetFactors=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../../../webgl/renderState"],function(a,g){const b=g.separateBlendingParams(770,1,771,771),p=g.simpleBlendingParams(1,1),f=g.simpleBlendingParams(0,771),k={factor:-1,units:-2};a.OITBlending=function(c){return 2===c?null:1===c?f:p};a.OITDepthTest=function(c){return 3===c||2===c?513:515};a.OITDepthWrite=
function(c){return 2===c?g.defaultDepthWriteParams:null};a.OITPolygonOffset=k;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=f;a.blendingColor=p;a.blendingDefault=b;a.getOITPolygonOffset=function(c){return c?k:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ./Deconflictor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){a.LabelDeconflictor=function(v){function t(){var w=v.apply(this,arguments)||this;w.visibilityGroup=1;w.iconMarginFactor=0;w._lastDeconfliction=0;return w}g._inheritsLoose(t,v);var l=t.prototype;l.update=function(w){if(!this.parent.needsUpdate()){var y=performance.now();if(2===w.state||2E3<y-this._lastDeconfliction)v.prototype.update.call(this,w),0===this.state&&(this._lastDeconfliction=y)}};l.enabledChanged=function(w,y){this.modifyGraphics(y,w.labelsEnabled)};
l.getGraphicsLayers=function(w){return w.labelGraphics};g._createClass(t,[{key:"viewState",get:function(){return this.parent.viewState}}]);return t}(u.Deconflictor);b.__decorate([c.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([e.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../symbols/callouts/calloutUtils ../../../../core/asyncUtils ../../../../core/Handles ../../../support/Scheduler ../../../../core/MapUtils ../../../../layers/support/layerUtils ../../support/debugFlags ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ../../webgl-engine/lib/WebGLLayer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextRenderer ./graphicSymbolUtils ./labelPlacement ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L){const P=k.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(X){function aa(){var H=X.apply(this,arguments)||this;H._dirty=!1;H.labels=new Map;H.labelsToAdd=new Map;H.labelsToRemove=new Map;H.labelingContexts=[];return H}g._inheritsLoose(aa,X);var S=aa.prototype;S.setup=function(){if(f.isNone(this.handles)){const H=this.view.resourceController.scheduler;this.handles=new y;this.handles.add([this.view.watch("state.camera",
()=>this.setDirty()),this.view.watch("pixelRatio",()=>this.resetAllLabels()),H.registerTask(D.Task.LABELER,R=>this.update(R),()=>this.needsUpdate())])}f.isNone(this.textTextureAtlas)&&(this.textTextureAtlas=new L["default"]({view:this.view}),this.hudMaterialCollection=new J.MaterialCollection(this.view._stage),this.calloutMaterialCollection=new J.MaterialCollection(this.view._stage))};S.dispose=function(){this.handles=f.destroyMaybe(this.handles);this.textTextureAtlas=f.disposeMaybe(this.textTextureAtlas);
this.hudMaterialCollection=f.disposeMaybe(this.hudMaterialCollection);this.calloutMaterialCollection=f.disposeMaybe(this.calloutMaterialCollection);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};S.isActiveLabelingContext=function(H){return H.active&&r.areLabelsVisible(H.layer)};S.activateLabelingContext=function(H){H.labels.forEach((R,T)=>{this.labels.set(T,R);R.graphics3DGraphic.setVisibilityFlag(0,!0,1)});H.active=!0};S.deactivateLabelingContext=
function(H){H.labels.forEach((R,T)=>{R.graphics3DGraphic.setVisibilityFlag(0,!1,1);this.setLabelGraphicVisibility(R.graphics3DGraphic,!1);this.labels.delete(T)});H.active=!1};S.addLabelTextureToAtlas=function(H){for(const R of H.graphics3DGraphic.labelGraphics){if(!R._labelClass)continue;const T=H.textRenderers[R._labelIndex];T&&this.textTextureAtlas.addTextTexture(T,R.stageObject)}H.rendered=!0};S.removeLabelTextureFromAtlas=function(H){for(const R of H.graphics3DGraphic.labelGraphics){if(!R._labelClass)continue;
const T=H.textRenderers[R._labelIndex];T&&this.textTextureAtlas.removeTextTexture(T,R.stageObject)}H.rendered=!1};S.needsUpdate=function(){return this.view.ready&&this.isDirty};S.update=function(H){this._updateLabels(H);!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(H)};S._updateLabels=function(H){if(this._dirty){this._dirty=!1;for(const R of this.labelingContexts)if(this.isActiveLabelingContext(R)){if(!this.hasValidLabelClassContext(R)){if(this.hasInvalidLabelClassContext(R)){this.deactivateLabelingContext(R);
continue}this.createLabelClassContext(R);if(this.hasPendingLabelClassContext(R)){this._dirty=!0;continue}if(!this.hasValidLabelClassContext(R))continue}z.someMap(R.labelsToInitialize,(T,W)=>{this.ensureGraphics3DResources(T)&&(this.labels.set(W,T),this.deconflictor.setDirty(),H.madeProgress());if(T.visible&&T.hasTextTextureResources||!T.visible&&T.hasGraphics3DResources)R.labelsToInitialize.delete(W),H.madeProgress();return H.done})&&(this._dirty=!0)}this.labelsToRemove.forEach(R=>this.removeLabelTextureFromAtlas(R));
this.labelsToRemove.clear();this.labelsToAdd.forEach(R=>this.addLabelTextureToAtlas(R));this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};S.hasPendingLabelClassContext=function(H){return H.labelClassPromise&&!!H.labelClassAbortController};S.hasValidLabelClassContext=function(H){return H.labelClassContexts&&H.labelClassContexts.length};S.hasInvalidLabelClassContext=function(H){return null===H.labelClassContexts};S.createLabelClassContextAsync=async function(H){const R=H.labelClassAbortController.signal;
await H.layer.when();v.throwIfAborted(R);H.scaleVisibility&&H.scaleVisibility.updateScaleRangeActive();const T=H.graphics3DCore;var W=T.layer;if((W=W.labelingInfo&&W.labelingInfo.filter(N=>!!N.symbol))&&0!==W.length){var Y=Array(W.length),U=!1;await w.forEach(W,async(N,ca)=>{var O=N.symbol;const V=I.getGraphics3DSymbol(T.getOrCreateGraphics3DSymbol(O));if(f.isNone(V))P.error("Failed to create Graphics3DSymbol for label");else{await V.load();v.throwIfAborted(R);var ba=null;l.isCalloutSupport(O)&&O.hasVisibleCallout()&&
(ba=m.make(O,T.symbolCreationContext),await ba.load(),v.throwIfAborted(R));O=await w.result(x.createLabelFunction(N,H.layer.fields.map(fa=>fa.toJSON()),this.view.spatialReference));v.throwIfAborted(R);!0===O.ok?Y[ca]={labelClass:N,labelFunction:O.value,graphics3DSymbol:V,graphics3DCalloutSymbolLayer:ba,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(V.symbol)}:(P.error(`Label expression failed to evaluate: ${O.error}`),U=!0)}});v.throwIfAborted(R);U||(H.labelClassContexts=
Y)}};S.createLabelClassContext=async function(H){H.labelClassPromise||(H.labelClassPromise=this.createLabelClassContextAsync(H).catch(R=>{if(v.isAbortError(R))throw R;H.labelClassContexts=null}).then(()=>{H.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return H.labelClassPromise};S.createTextRenderParameters=function(H){return(H=H.symbolLayers.getItemAt(0))&&"text"===H.type?F.TextRenderParameters.fromSymbol(H,this.view.pixelRatio):null};
S.destroyLabelClassContext=function(H){for(var R of H.labelClassContexts)--R.graphics3DSymbol.referenced,R.graphics3DSymbol=null;R=H.labelClassAbortController;H.labelClassAbortController=v.createAbortController();R&&R.abort();H.labelClassContexts=[];H.labelClassPromise=null;this.notifyChange("updating")};S.createTextSymbolGraphic=function(H,R,T,W,Y){H={text:H.text,centerOffset:T.centerOffset,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,anchor:T.anchor,centerOffsetUnits:T.centerOffsetUnits,
verticalOffset:T.verticalOffset,debugDrawBorder:C.LABELS_SHOW_BORDER,displayWidth:H.displayWidth,displayHeight:H.displayHeight};Q.graphic=R;Q.renderingInfo=null;Q.layer=W;return Y.createLabel(Q,H,this.hudMaterialCollection,this.textTextureAtlas)};S.createLineCalloutGraphic=function(H,R,T,W,Y){R={symbol:R,translation:W.translation,elevationOffset:W.elevationOffset,screenOffset:W.screenOffset,centerOffset:W.centerOffset,centerOffsetUnits:W.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};
Q.graphic=H;Q.renderingInfo=R;Q.layer=Y;return T.createGraphics3DGraphic(Q)};S.ensureGraphics3DResources=function(H){if(H.hasGraphics3DResources)return!1;const R=H.graphics3DGraphic;if(R.destroyed)return!1;this.ensureTextTextureResources(H);const T=H.labelingContext,W=T.labelClassContexts;if(!W||0===W.length||!T.emptySymbolLabelSupported&&0===R._graphics.length)return!1;var Y=!1,U=R.graphic;const N=T.layer;var ca=r.areLabelsVisible(T.layer);const O=this.view._stage;for(let ba=0;ba<W.length;ba++){const fa=
H.textRenderers[ba];if(!fa)continue;const ia=W[ba];var V=ia.graphics3DSymbol;let ma=null;V.symbol&&"label-3d"===V.symbol.type&&(ma=V.symbol);const ea=V.symbolLayers[0];if(!ea)continue;const M=ia.labelClass;V=K.get({graphics3DGraphic:R,labelSymbol:ma,labelClass:M,disablePlacement:T.disablePlacement});if(!f.isNone(V)){ea.setElevationInfoOverride(T.elevationInfoOverride);Y=this.createTextSymbolGraphic(fa,U,V,N,ea);if(!Y)return!1;Y._labelClass=M;Y._labelIndex=ba;R.addLabelGraphic(Y,O,T.stageLayer);R.setVisibilityFlag(0,
ca,1);R.clearVisibilityFlag(1,1);R.setVisibilityFlag(3,!1,1);Y=!0;(ca=ia.graphics3DCalloutSymbolLayer)&&V.hasLabelVerticalOffset&&(ca.setElevationInfoOverride(T.elevationInfoOverride),U=this.createLineCalloutGraphic(U,ma,ca,V,N))&&(ia.calloutSymbolLayerIndex=R.labelGraphics.length,R.addLabelGraphic(U,O,T.stageLayer));break}}T.scaleVisibility&&Y&&T.scaleVisibility.updateGraphicLabelScaleVisibility(R);return H.hasGraphics3DResources=!0};S.destroyGraphics3DResources=function(H){const R=H.labelingContext.labelClassContexts;
for(const T of H.graphics3DGraphic.labelGraphics){if(null==T._labelClass)continue;const W=R[T._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=W)W.onRemoveGraphic(T)}H.graphics3DGraphic.clearLabelGraphics();H.hasGraphics3DResources=!1};S.ensureTextTextureResources=function(H){if(!H.hasTextTextureResources){var R=H.labelingContext,T=R.labelClassContexts;if(T&&0!==T.length){var W=H.graphics3DGraphic.graphic;for(let Y=0;Y<T.length;Y++){const U=T[Y];H.textRenderers[Y]=null;if(!U.textRenderParameters)continue;
const N=U.labelFunction;let ca;if("arcade"===N.type)try{const O=N.needsHydrationToEvaluate()?A.hydrateGraphic(W,R.layer):W;ca=N.evaluate(O)}catch(O){ca=null}else ca=N.evaluate(W);f.isNone(ca)||""===ca||/^\s+$/.test(ca)||(H.textRenderers[Y]=new G.TextRenderer(ca,U.textRenderParameters))}H.hasTextTextureResources=!0}}};S.destroyTextTextureResources=function(H){H.textRenderers=[];H.hasTextTextureResources=!1};S.addGraphic=function(H,R){const T={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,
rendered:!1,labelingContext:H,graphics3DGraphic:R,textRenderers:[]};R=R.graphic.uid;H.labels.set(R,T);H.labelsToInitialize.set(R,T);this.setDirty();this.deconflictor.setDirty()};S.removeGraphic=function(H,R){R=R.graphic.uid;const T=H.labels.get(R);T&&(this.destroyGraphic(T,R),H.labels.delete(R),H.labelsToInitialize.delete(R),this.setDirty(),this.deconflictor.setDirty())};S.destroyGraphic=function(H,R){this.labels.has(R)&&(this.labels.delete(R),this.labelsToAdd.delete(R),this.labelsToRemove.delete(R));
H.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(H),this.destroyTextTextureResources(H));H.hasGraphics3DResources&&this.destroyGraphics3DResources(H)};S.labelingInfoChange=async function(H,R){if(R)for(const T of R){if(R=H.labels.get(T))this.removeGraphic(H,R.graphics3DGraphic),this.addGraphic(H,R.graphics3DGraphic)}else return this.visibilityInfoChange(H),this.resetLabels(H),this.createLabelClassContext(H)};S.globalPropertyChanged=function(H,R){for(const T of R.labelClassContexts){const W=
new Map;R.labels.forEach(Y=>{Y=Y.graphics3DGraphic;W.set(Y.graphic.uid,Y)});f.unwrap(T.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(H,W,Y=>Y.labelGraphics[0]);T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(H,W,Y=>Y.labelGraphics[T.calloutSymbolLayerIndex])}};S.visibilityInfoChange=function(H){const R=H.layer.labelsVisible;R&&!H.active&&this.activateLabelingContext(H);!R&&H.active&&this.deactivateLabelingContext(H);this.setDirty()};S.resetAllLabels=
function(){for(const H of this.labelingContexts)this.resetLabels(H)};S.resetLabels=function(H){H.labels.forEach((R,T)=>{this.destroyGraphic(R,T);R.visible=!1;R.rendered=!1;H.labelsToInitialize.set(T,R)});this.destroyLabelClassContext(H);this.setDirty();this.deconflictor.setDirty()};S.findLabelingContext=function(H){for(const R of this.labelingContexts)if(R.graphics3DCore===H)return R;return null};S.addGraphicsOwner=function(H,R,T){const W=T&&T.emptySymbolLabelSupported||!1,Y=T&&T.elevationInfoOverride||
null;T=T&&T.disablePlacement||null;if(!this.findLabelingContext(H)){var U=H.layer,N={graphics3DCore:H,layer:U,scaleVisibility:R,emptySymbolLabelSupported:W,elevationInfoOverride:Y,disablePlacement:T,active:U.labelsVisible,labelClassPromise:null,labelClassAbortController:v.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new E.WebGLLayer({isPickable:!0},U.uid)};this.view._stage.add(N.stageLayer);this.labelingContexts.push(N);this.setDirty();return{addGraphic:ca=>
this.addGraphic(N,ca),removeGraphic:ca=>this.removeGraphic(N,ca),featureReductionChange:()=>{},layerLabelsEnabled:()=>r.areLabelsVisible(N.layer),labelingInfoChange:ca=>this.labelingInfoChange(N,ca),elevationInfoChange:()=>this.globalPropertyChanged("elevationInfo",N),slicePlaneEnabledChange:()=>this.globalPropertyChanged("slicePlaneEnabled",N),visibilityInfoChange:()=>this.visibilityInfoChange(N),reset:()=>this.resetLabels(N),clear:()=>{},processStageDirty:()=>N.stageLayer.commit()}}};S.removeGraphicsOwner=
function(H){const R=this.findLabelingContext(H);R&&(H=this.labelingContexts.indexOf(R),this.labelingContexts.splice(H,1),R.labels.forEach(T=>this.removeGraphic(R,T.graphics3DGraphic)),this.view._stage.remove(R.stageLayer),R.stageLayer=null,this.setDirty())};S.setLabelGraphicVisibility=function(H,R){H=H.graphic.uid;const T=this.labels.get(H);T&&T.visible!==R&&(R&&!T.rendered?(this.labelsToAdd.set(H,T),this.labelsToRemove.delete(H),T.hasTextTextureResources||T.labelingContext.labelsToInitialize.set(H,
T)):!R&&T.rendered&&(this.labelsToRemove.set(H,T),this.labelsToAdd.delete(H)),T.visible=R,this.setDirty())};S.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};g._createClass(aa,[{key:"isDirty",get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.needsUpdate()}},{key:"updating",get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some(H=>
this.hasPendingLabelClassContext(H))}},{key:"updatingProgress",get:function(){if(!this.updating||!this.textTextureAtlas)return 1;const H=0<this.labelingContexts.length?this.labelingContexts.reduce((R,T)=>R+(this.hasPendingLabelClassContext(T)?0:1),0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?0:.1)+.1*H+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this.textTextureAtlas,resetAllLabels:()=>this.resetAllLabels()}}}]);
return aa}(t);b.__decorate([d.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([d.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([d.property()],a.Labeler.prototype,"textTextureAtlas",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const Q=new B(null,null,null);Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../core/has ../../core/typedArrayUtil ../../core/lang ../../core/maybe ../../geometry/support/jsonUtils ../../Graphic ./dehydratedFeatures".split(" "),function(a,g,b,p,f,k,c,d){function e(y){return"declaredClass"in y}function h(y){return"declaredClass"in y}function n(y){return"declaredClass"in y}function q(y){return f.isNone(y)?null:e(y)?y:k.fromJSON(u(y))}function u(y){const D=y.spatialReference.toJSON();switch(y.type){case "point":{const {x:z,
y:r,z:C,m:A}=y;return{x:z,y:r,z:C,m:A,spatialReference:D}}case "polygon":{const {rings:z,hasZ:r,hasM:C}=y;return{rings:v(z),hasZ:r,hasM:C,spatialReference:D}}case "polyline":{const {paths:z,hasZ:r,hasM:C}=y;return{paths:v(z),hasZ:r,hasM:C,spatialReference:D}}case "extent":{const {xmin:z,xmax:r,ymin:C,ymax:A,zmin:x,zmax:m,mmin:B,mmax:E,hasZ:F,hasM:G}=y;return{xmin:z,xmax:r,ymin:C,ymax:A,zmin:x,zmax:m,mmin:B,mmax:E,hasZ:F,hasM:G,spatialReference:D}}case "multipoint":{const {points:z,hasZ:r,hasM:C}=
y;return{points:w(z)?t(z):z,hasZ:r,hasM:C,spatialReference:D}}}}function v(y){return l(y)?y.map(D=>t(D)):y}function t(y){return y.map(D=>b.toArray(D))}function l(y){for(const D of y)if(0!==D.length)return w(D);return!1}function w(y){return y.length&&(b.isFloat32Array(y[0])||b.isFloat64Array(y[0]))}a.clonePoint=function(y,D){if(!y)return null;if(h(y)){if(null==D)return y.clone();if(h(D))return D.copy(y)}null!=D?(D.x=y.x,D.y=y.y,D.spatialReference=y.spatialReference,y.hasZ?(D.z=y.z,D.hasZ=y.hasZ):(D.z=
null,D.hasZ=!1),y.hasM?(D.m=y.m,D.hasM=!0):(D.m=null,D.hasM=!1)):(D=d.makeDehydratedPoint(y.x,y.y,y.z,y.spatialReference),y.hasM&&(D.m=y.m,D.hasM=!0));return D};a.hydrateGeometry=q;a.hydrateGraphic=function(y,D){if(!y)return null;if(n(y))return y;D=new c({layer:D,sourceLayer:D});D.visible=y.visible;D.symbol=p.clone(y.symbol);D.attributes=p.clone(y.attributes);D.geometry=q(y.geometry);return D};a.isHydratedGeometry=e;a.isHydratedGraphic=n;a.isHydratedPoint=h;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/Logger ../../core/Error ../../support/arcadeOnDemand ./fieldUtils ../../intl/date ../../intl/number ./FieldsIndex ./labelUtils".split(" "),function(a,g,b,p,f,k,c,d,e,h){function n(t,l){if(null==t)return"";const w=l.domain;if(w)if("codedValue"===w.type||"coded-value"===w.type)for(var y of w.codedValues){if(y.code===t)return y.name}else if("range"===w.type){y=+t;const D="range"in w?w.range[1]:w.maxValue;if(("range"in
w?w.range[0]:w.minValue)<=y&&y<=D)return w.name}"date"===l.type||"esriFieldTypeDate"===l.type?t=c.formatDate(t,c.convertDateFormatToIntlOptions("short-date")):k.isNumericField(l)&&(t=d.formatNumber(+t));return t?t:""}const q=b.getLogger("esri.layers.support.labelFormatUtils"),u={type:"simple",evaluate(){return null}},v={getAttribute(t,l){return t.field(l)}};g.createLabelFunction=async function(t,l,w){if(!t||!t.symbol)return u;const y=t.where,D=h.getLabelExpression(t);t=y?await new Promise(function(z,
r){a(["../../core/sql/WhereClause"],z,r)}):null;if("arcade"===D.type){const z=await f.createLabelExpression(D.expression,w,l);w={type:"arcade",evaluate(r){try{const C=z.evaluate({$feature:"attributes"in r?z.repurposeFeature(r):z.repurposeAdapter(r)});if(null!=C)return C.toString()}catch(C){q.error(new p("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:r,expression:D}))}return null},needsHydrationToEvaluate(){return null==h.getSingleFieldArcadeExpression(D.expression)}}}else w=
{type:"simple",evaluate(z){return D.expression.replace(/{[^}]*}/g,r=>{var C=r.slice(1,-1);C=k.getField(l,C);if(!C)return r;r=null;"attributes"in z?z&&z.attributes&&(r=z.attributes[C.name]):r=z.field(C.name);return null==r?"":n(r,C)})}};if(y){let z;try{z=t.WhereClause.create(y,new e(l))}catch(C){return u}const r=w.evaluate;w.evaluate=C=>z.testFeature(C,"attributes"in C?void 0:v)?r(C):null}return w};g.formatField=n;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,g,b,p){const f=g.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),k={line:p.Graphics3DLineCalloutSymbolLayer};a.make=function(c,d){if(!b.isCalloutSupport(c))return f.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${c.type}' does not support callouts`),null;if(!c.callout)return null;const e=k[c.callout.type];return e?new e(c,d):(f.error("Graphics3DCalloutSymbolLayerFactory#make",
`unknown or unsupported callout type ${c.callout.type}`),null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ./symbolComplexity ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){v=function(r){function C(x,m){x=r.call(this,x,null,m,z)||this;x._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};x.ensureDrapedStatus(!1);return x}g._inheritsLoose(C,r);var A=C.prototype;A.doLoad=async function(){this._material=new l.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)};A.destroy=function(){r.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};A.perInstanceMaterialParameters=
function(x){const m=this.materialParameters;m.screenOffset=x.screenOffset||[0,0];m.centerOffsetUnits=x.centerOffsetUnits||"world";return m};A._defaultElevationInfoNoZ=function(){return D};A.createGraphics3DGraphic=function(x){const m=x.renderingInfo;x=x.graphic;const B=this.setGraphicElevationContext(x,new n.ElevationContext,m.elevationOffset||0);var E=m.symbol;const F="on-the-ground"===this._elevationContext.mode&&("cim"===E.type||!E.symbolLayers.some(G=>"object"===G.type||"text"===G.type));if("label-3d"!==
E.type&&F)return null;E=d.computeCentroid(x.geometry);return b.isNone(E)?null:this._createAs3DShape(E,B,m,x.uid)};A.layerOpacityChanged=function(){if(b.isNone(this._material))return!0;this._material.setParameterValues(this.materialParameters);return!0};A.layerElevationInfoChanged=function(x,m,B){B=e.elevationModeChangeUpdateType(C.elevationModeChangeTypes,B,this._elevationContext.mode);if(B!==e.SymbolUpdateType.UPDATE)return B;x.forEach(E=>{const F=m(E);b.isSome(F)&&this.updateGraphicElevationContext(E.graphic,
F)});return B};A.slicePlaneEnabledChanged=function(){if(b.isNone(this._material))return!0;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};A.physicalBasedRenderingChanged=function(){return!0};A.pixelRatioChanged=function(){return!0};A.setGraphicElevationContext=function(x,m,B=0){x=r.prototype.setGraphicElevationContext.call(this,x,m);x.addOffsetRenderUnits(B);return x};A.updateGraphicElevationContext=function(x,m){this.setGraphicElevationContext(x,m.elevationContext,
m.metadata.elevationOffset);m.needsElevationUpdates=e.needsElevationUpdates2D(m.elevationContext.mode)};A.updateGeometry=function(x,m){return!1};A.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:u.emptySymbolComplexity.memory}};A.createVertexData=function(x){const {translation:m,centerOffset:B}=x;return[["position",m?{size:3,data:[m[0],m[1],m[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,
0,1],exclusive:!0}],["auxpos1",B?{size:4,data:[B[0],B[1],B[2],B[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};A._getOrCreateMaterial=function(x){const m=this.perInstanceMaterialParameters(x),B=l.LineCalloutMaterial.uniqueMaterialIdentifier(m);if(b.isSome(this._material)&&B===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(x.materialCollection){let E=x.materialCollection.get(B);b.isNone(E)&&(E=new l.LineCalloutMaterial(m),x.materialCollection.add(B,
E));return{material:E,isUnique:!1}}return{material:new l.LineCalloutMaterial(m),isUnique:!0}};A._createAs3DShape=function(x,m,B,E){var F=[new k.Geometry(this.createVertexData(B),y,1)];const G=this._getOrCreateMaterial(B);E=t.createStageObjectForHUD(this._context,x,F,[G.material],null,null,m,this._context.layer.uid,E);if(null===E)return null;F=new q(this,E.object,F,G.isUnique?[G.material]:null,null,h.perObjectElevationAligner,m);F.metadata={elevationOffset:B.elevationOffset||0};F.alignedSampledElevation=
E.sampledElevation;F.needsElevationUpdates=e.needsElevationUpdates2D(m.mode);t.extendPointGraphicElevationContext(F,x,this._context.elevationProvider);return F};g._createClass(C,[{key:"materialParameters",get:function(){const x=this.symbol;var m=x.callout;const B=b.isSome(m.color)?p.toUnitRGBA(m.color):[0,0,0,0];B[3]*=this._getLayerOpacity();const E=f.pt2px(m.size||0);let F=null;if(x.verticalOffset){const {screenLength:I,minWorldLength:K,maxWorldLength:J}=x.verticalOffset;F={screenLength:f.pt2px(I),
minWorldLength:K||0,maxWorldLength:null!=J?J:Infinity}}m=b.isSome(m.border)&&b.isSome(m.border.color)?p.toUnitRGBA(m.border.color):null;const G="object"===x.symbolLayers.getItemAt(0).type;return{color:B,size:E,verticalOffset:F,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:m,occlusionTest:!G,shaderPolygonOffset:G?0:void 0,depthHUDAlignStart:"label-3d"===x.type,
slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:c.materialParametersDefaults.renderOccluded}}}]);return C}(v.Graphics3DSymbolLayer);v.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.UPDATE,staysOnTheGround:e.SymbolUpdateType.UPDATE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const w=new Uint16Array([0]),y=[["position",w],["normal",w],["auxpos1",w]],D={mode:"relative-to-ground",offset:0},z={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=
v;a.default=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/support/coordsUtils ../../../../geometry/support/centroid ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){function w(z){var r=z.paths[0];if(!r||0===r.length)return null;r=b.getPointOnPath(r,b.getPathLength(r)/2);return t.makeDehydratedPoint(r[0],r[1],r[2],z.spatialReference)}function y(z,r,C){C=C?z:l.clonePoint(z);return r&&z?e.projectPoint(z,C,r)?C:null:C}function D(z){if(Array.isArray(z)){for(const r of z)if(!D(r))return!1;return!0}return null==z||0<=z}n={"bottom-left":n.fromValues(0,0),bottom:n.fromValues(.5,0),"bottom-right":n.fromValues(1,0),left:n.fromValues(0,
.5),center:n.fromValues(.5,.5),right:n.fromValues(1,.5),"top-left":n.fromValues(0,1),top:n.fromValues(.5,1),"top-right":n.fromValues(1,1)};a.computeCentroid=function(z,r){if("point"===z.type)return y(z,r,!1);if(l.isHydratedGeometry(z))switch(z.type){case "extent":return y(z.center,r,!1);case "polygon":return y(z.centroid,r,!1);case "polyline":return y(w(z),r,!0);case "mesh":return y(z.extent.center,r,!1)}else switch(z.type){case "extent":var C=f.isFinite(z.zmin);z=t.makeDehydratedPoint(.5*(z.xmax+
z.xmin),.5*(z.ymax+z.ymin),C?.5*(z.zmax+z.zmin):void 0,z.spatialReference);return y(z,r,!0);case "polygon":return(C=z.rings[0])&&0!==C.length?(C=p.ringsCentroid(z.rings,z.hasZ),z=t.makeDehydratedPoint(C[0],C[1],C[2],z.spatialReference)):z=null,y(z,r,!0);case "polyline":return y(w(z),r,!0)}};a.computeObjectRotation=function(z,r,C,A=h.create()){z=z||0;r=r||0;C=C||0;0!==z&&c.rotateZ(A,A,-z/180*Math.PI);0!==r&&c.rotateX(A,A,r/180*Math.PI);0!==C&&c.rotateY(A,A,C/180*Math.PI);return A};a.computeObjectScale=
function(z=k.ONES,r,C,A=1){const x=Array(3);if(g.isNone(r)||g.isNone(C))x[0]=1,x[1]=1,x[2]=1;else{let B=0;for(let E=2;0<=E;E--){const F=z[E];let G;const I=null!=F,K=0===E&&!m&&!I,J=C[E];"symbol-value"===F||K?G=0!==J?r[E]/J:1:I&&"proportional"!==F&&isFinite(F)&&(G=0!==J?F/J:1);if(null!=G){var m=x[E]=G;B=Math.max(B,Math.abs(G))}}for(z=2;0<=z;z--)null==x[z]?x[z]=m:0===x[z]&&(x[z]=.001*B)}for(m=2;0<=m;m--)x[m]/=A;return k.fromArray(x)};a.demResolutionForBoundingBox=function(z,r){return null!=r.minDemResolution?
r.minDemResolution:v.isPoint(z)?r.minDemResolutionForPoints:.01*v.maximumDimension(z)};a.enlargeExtent=function(z,r,C,A=0){if(z){r||(r=d.create());let x=.5*z.width*(C-1);C=.5*z.height*(C-1);z.width<1E-7*z.height?x+=C/20:z.height<1E-7*z.width&&(C+=x/20);u.set(r,z.xmin-x-A,z.ymin-C-A,z.xmax+x+A,z.ymax+C+A);return r}return null};a.isValidSize=D;a.mixinColorAndOpacity=function(z,r){const C=q.clone(q.ONES);g.isSome(z)&&(C[0]=z[0],C[1]=z[1],C[2]=z[2]);g.isSome(r)?C[3]=r:g.isSome(z)&&3<z.length&&(C[3]=z[3]);
return C};a.namedAnchorToHUDMaterialAnchorPos=n;a.overrideColor=function(z,r,C,A,x,m=[0,0,0,0]){for(let B=0;3>B;++B)g.isSome(z)&&null!=z[B]?m[B]=z[B]:g.isSome(C)&&null!=C[B]?m[B]=C[B]:m[B]=x[B];g.isSome(r)?m[3]=r:g.isSome(A)?m[3]=A:m[3]=x[3];return m};a.updateVertexAttributeAuxpos1w=function(z,r){for(let C=0;C<z.geometries.length;++C){const A=z.geometries[C].getMutableAttribute("auxpos1");A&&A.data[3]!==r&&(A.data[3]=r,z.geometryVertexAttrsUpdated(C))}};a.validateSymbolLayerSize=function(z){null!=
z.isPrimitive&&(z=[z.width,z.depth,z.height]);return D(z)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../layers/graphics/dehydratedFeatures ../../support/ElevationProvider ./graphicUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h){function n(l,w,y,D,z){const r=(d.isDehydratedPoint(l)?l.z:e.isSamplePosition(l)?l.array[l.offset+2]:l[2])||0;switch(y.mode){case "on-the-ground":return y=b.unwrapOr(e.getElevationAtPoint(w,l,"ground"),0),z&&(z.verticalDistanceToGround=0,z.sampledElevation=y),y;case "relative-to-ground":return l=b.unwrapOr(e.getElevationAtPoint(w,l,"ground"),0),y=y.geometryZWithOffset(r,D),z&&(z.verticalDistanceToGround=y,z.sampledElevation=l),y+l;case "relative-to-scene":return l=b.unwrapOr(e.getElevationAtPoint(w,
l,"scene"),0),y=y.geometryZWithOffset(r,D),z&&(z.verticalDistanceToGround=y,z.sampledElevation=l),y+l;case "absolute-height":return y=y.geometryZWithOffset(r,D),z&&(D=b.unwrapOr(e.getElevationAtPoint(w,l,"ground"),0),z.verticalDistanceToGround=y-D,z.sampledElevation=D),y;default:return g.neverReached(y.mode),0}}(function(l){l[l.NONE=0]="NONE";l[l.UPDATE=1]="UPDATE";l[l.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const q={"absolute-height":{applyElevationAlignmentBuffer:function(l,
w,y,D,z,r,C,A){r=A.calculateOffsetRenderUnits(C);A=A.featureExpressionInfoContext;w*=3;D*=3;for(C=0;C<z;++C){const x=l[w+1],m=l[w+2];y[D+0]=l[w+0];y[D+1]=x;y[D+2]=null==A?m+r:r;w+=3;D+=3}return 0},requiresAlignment:function(l){const w=l.featureExpressionInfoContext;return 0!==l.meterUnitOffset||null!=w}},"on-the-ground":{applyElevationAlignmentBuffer:function(l,w,y,D,z,r){let C=0;const A=r.spatialReference;w*=3;D*=3;for(let x=0;x<z;++x){const m=l[w+0],B=l[w+1],E=b.unwrapOr(r.getElevation(m,B,l[w+
2],A,"ground"),0);C+=E;y[D+0]=m;y[D+1]=B;y[D+2]=E;w+=3;D+=3}return C/z},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(l,w,y,D,z,r,C,A){let x=0;C=A.calculateOffsetRenderUnits(C);A=A.featureExpressionInfoContext;const m=r.spatialReference;w*=3;D*=3;for(let B=0;B<z;++B){const E=l[w+0],F=l[w+1],G=l[w+2],I=b.unwrapOr(r.getElevation(E,F,G,m,"ground"),0);x+=I;y[D+0]=E;y[D+1]=F;y[D+2]=null==A?G+I+C:I+C;w+=3;D+=3}return x/z},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(l,
w,y,D,z,r,C,A){let x=0;C=A.calculateOffsetRenderUnits(C);A=A.featureExpressionInfoContext;const m=r.spatialReference;w*=3;D*=3;for(let B=0;B<z;++B){const E=l[w+0],F=l[w+1],G=l[w+2],I=b.unwrapOr(r.getElevation(E,F,G,m,"scene"),0);x+=I;y[D+0]=E;y[D+1]=F;y[D+2]=null==A?G+I+C:I+C;w+=3;D+=3}return x/z},requiresAlignment:()=>!0}},u=c.create(),v={verticalDistanceToGround:0,sampledElevation:0},t=p.create();a.applyElevationAlignmentForHUD=function(l,w,y,D,z){y=n(w,y,z,D,v);h.updateVertexAttributeAuxpos1w(l,
v.verticalDistanceToGround);z=v.sampledElevation;const r=f.copy(u,l.transformation);t[0]=w.x;t[1]=w.y;t[2]=y;k.computeLinearTransformation(w.spatialReference,t,r,D.spatialReference)?l.transformation=r:console.warn("Could not locate symbol object properly, it might be misplaced");return z};a.applyPerVertexElevationAlignment=function(l,w,y,D,z,r,C,A,x,m,B){const E=q[B.mode];let F=0;if(k.projectBuffer(l,w,y,D,x.spatialReference,z,A)&&(E.requiresAlignment(B)?(F=E.applyElevationAlignmentBuffer(D,z,r,C,
A,x,m,B),l=r,z=C):l=D,k.projectBuffer(l,x.spatialReference,z,r,m.spatialReference,C,A)))return F};a.elevationModeChangeUpdateType=function(l,w,y){return null==w||null==y?l.definedChanged:"on-the-ground"===w&&"on-the-ground"===y?l.staysOnTheGround:w===y||"on-the-ground"!==w&&"on-the-ground"!==y?a.SymbolUpdateType.UPDATE:l.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=n;a.needsElevationUpdates2D=function(l){return"relative-to-ground"===l||"relative-to-scene"===l};a.needsElevationUpdates3D=
function(l){return"absolute-height"!==l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../support/ElevationProvider ../../support/debugFlags ./graphicUtils ./elevationAlignmentUtils".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){const q=c.create(),u=b.create(),
v=b.create(),t=b.create(),l=c.create(),w=b.create(),y={verticalDistanceToGround:0,sampledElevation:0};a.perLodInstanceElevationAligner=function(D,z,r,C){const A=D.graphics3DSymbolLayer.lodRenderer;if(g.isNone(A))return 0;const x=z.centerPointInElevationSR;let m=0,B=0;const E="absolute-height"!==z.mode;m=n.evaluateElevationAlignmentAtPoint(x,r,z,C,E?y:null);E&&(B=y.sampledElevation);z=A.instanceData;D=D.instanceIndex;z.getGlobalTransform(D,l);r=p.set(w,l[12],l[13],l[14]);e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?
(u[0]=x.x,u[1]=x.y,u[2]=m,k.computeLinearTransformation(x.spatialReference,u,l,C.spatialReference)&&z.setGlobalTransform(D,l)):C.setAltitudeOfTransformation(m,l);C=.01/C.unitInMeters;(e.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(l[12]-r[0])>=C||Math.abs(l[13]-r[1])>=C||Math.abs(l[14]-r[2])>=C)&&z.setGlobalTransform(D,l);return B};a.perObjectElevationAligner=function(D,z,r,C){D=D.stageObject;const A=z.centerPointInElevationSR;let x=0,m=0;if(D.metadata.usesVerticalDistanceToGround)x=n.evaluateElevationAlignmentAtPoint(A,
r,z,C,y),h.updateVertexAttributeAuxpos1w(D,y.verticalDistanceToGround),m=y.sampledElevation;else{const B="absolute-height"!==z.mode;x=n.evaluateElevationAlignmentAtPoint(A,r,z,C,B?y:null);B&&(m=y.sampledElevation)}z=f.copy(q,D.transformation);r=p.set(w,z[12],z[13],z[14]);e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=A.x,u[1]=A.y,u[2]=x,k.computeLinearTransformation(A.spatialReference,u,z,C.spatialReference)&&(D.transformation=z)):C.setAltitudeOfTransformation(x,z);C=.01/C.unitInMeters;if(Math.abs(z[12]-
r[0])>=C||Math.abs(z[13]-r[1])>=C||Math.abs(z[14]-r[2])>=C)D.transformation=z;return m};a.perVertexElevationAligner=function(D,z,r,C){D=D.stageObject;const A=r.spatialReference,x=D.geometryRecords,m=x.length,B="absolute-height"!==z.mode;let E=0;for(let L=0;L<m;L++){var F=x[L].geometry,G=x[L].getShaderTransformation();v[0]=G[12];v[1]=G[13];v[2]=G[14];F.invalidateBoundingInfo();var I=F.getMutableAttribute("position");G=I.data;var K=F.vertexAttributes.get("mapPos").data;F=I.size;I=G.length/F;K=new d.SamplePosition(K,
A);let P=0,Q=!1,X=0;for(let aa=0;aa<I;aa++){t[0]=G[P];t[1]=G[P+1];t[2]=G[P+2];var J=n.evaluateElevationAlignmentAtPoint(K,r,z,C,B?y:null);B&&(X+=y.sampledElevation);e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(G[P]=K.array[K.offset],G[P+1]=K.array[K.offset+1],G[P+2]=J,k.projectBuffer(G,A,P,G,C.spatialReference,P,1),G[P]-=v[0],G[P+1]-=v[1],G[P+2]-=v[2]):(u[0]=G[P]+v[0],u[1]=G[P+1]+v[1],u[2]=G[P+2]+v[2],C.setAltitude(J,u),G[P]=u[0]-v[0],G[P+1]=u[1]-v[1],G[P+2]=u[2]-v[2]);if(e.TESTS_DISABLE_UPDATE_THRESHOLDS)Q=
!0;else if(J=.01/C.unitInMeters,Math.abs(t[0]-G[P])>=J||Math.abs(t[1]-G[P+1])>=J||Math.abs(t[2]-G[P+2])>=J)Q=!0;P+=F;K.offset+=3}E+=X/I;Q&&D.geometryVertexAttrsUpdated(L)}return E/m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,g,b,p,f){let k=function(){function c(){this._renderUnitOffset=
this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var d=c.prototype;d.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};d.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e};d.geometryZWithOffset=function(e,h){h=this.calculateOffsetRenderUnits(h);return null!=this.featureExpressionInfoContext?h:
e+h};d.calculateOffsetRenderUnits=function(e){let h=this._meterUnitOffset;const n=this.featureExpressionInfoContext;null!=n&&(h+=f.execute(n)*this._metersPerElevationInfoUnit);return h/e.unitInMeters+this._renderUnitOffset};d.setFromElevationInfo=function(e){this.mode=e.mode;this.unit=p.supportsUnit(e.unit)?e.unit:"meters";this.offsetElevationInfoUnits=b.unwrapOr(e.offset,0)};d.updateFeatureExpressionInfoContext=function(e,h,n){if(b.isNone(e))this._featureExpressionInfoContext=null;else{var q=e&&
e.arcade;q&&b.isSome(h)&&b.isSome(n)?(this._featureExpressionInfoContext=f.clone(e),f.setContextFeature(this._featureExpressionInfoContext,f.createFeature(q.modules,h,n))):this._featureExpressionInfoContext=e}};c.fromElevationInfo=function(e){const h=new c;b.isSome(e)&&h.setFromElevationInfo(e);return h};g._createClass(c,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},
set:function(e){this._unit=e;this._metersPerElevationInfoUnit=p.getMetersPerUnit(e)}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return c}();a.ElevationContext=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger",
"../../../../support/arcadeOnDemand","../../../../layers/graphics/hydratedFeatures"],function(a,g,b,p){const f=g.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(k){return{cachedResult:k.cachedResult,arcade:k.arcade?{func:k.arcade.func,context:k.arcade.modules.arcadeUtils.createExecContext(null,{sr:k.arcade.context.spatialReference}),modules:k.arcade.modules}:null}};a.createContext=async function(k,c,d){k=k&&k.expression;if("string"!==typeof k)return null;var e=
"0"===k?0:null;if(null!=e)return{cachedResult:e};e=await b.loadArcade();const h=e.arcadeUtils;k=h.createSyntaxTree(k);return h.dependsOnView(k)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:h.createFunction(k),context:h.createExecContext(null,{sr:c}),modules:e}}};a.createContextWithoutExpressionSupport=function(k){k=k&&k.expression;return"string"===typeof k&&(k="0"===k?0:null,null!=k)?{cachedResult:k}:null};a.createFeature=function(k,
c,d){return k.arcadeUtils.createFeature(c.attributes,c.geometry,d)};a.execute=function(k){if(null!=k){if(null!=k.cachedResult)return k.cachedResult;var c=k.arcade;c=k.arcade.modules.arcadeUtils.executeFunction(c.func,c.context);"number"!==typeof c&&(c=k.cachedResult=0);return c}return 0};a.extractExpressionInfo=function(k,c=!1){const d=(k=k&&k.featureExpressionInfo)&&k.expression;c||"0"===d||(k=null);return k};a.setContextFeature=function(k,c){null!=k&&null==k.cachedResult&&(c&&k.arcade?(c._geometry&&
(c._geometry=p.hydrateGeometry(c._geometry)),k.arcade.modules.arcadeUtils.updateExecContext(k.arcade.context,c)):f.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./graphicUtils ./featureExpressionInfoUtils".split(" "),
function(a,g,b,p,f,k,c,d){function e(t){return t.isVisible?t.params.transparent?1:2:0}let h=function(){function t(w,y,D,z,r,C,A,x=null){this.graphics3DSymbolLayer=w;this.stageObject=y;this._uniqueGeometries=D;this._uniqueMaterials=z;this._uniqueTextures=r;this.elevationAligner=C;this.elevationContext=A;this._edgeState=x;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=w;
this.stageObject=y}var l=t.prototype;l.getBSRadius=function(){throw Error("Method not implemented.");};l.initialize=function(w,y){this.stageLayer=y;this.stage=w;w.addMany(this._uniqueMaterials);w.addMany(this._uniqueGeometries);w.addMany(this._uniqueTextures);w.add(this.stageObject)};l.destroy=function(){var w=this.stage;this.stageLayer&&(w.removeMany(this._uniqueMaterials),w.removeMany(this._uniqueGeometries),w.removeMany(this._uniqueTextures));w.remove(this.stageObject);this._addedToStage&&(this.stageLayer.remove(this.stageObject),
this._addedToStage=!1);w=this.stage.renderView.ensureEdgeView();w.hasObject(this.stageObject)&&w.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};l.layerOpacityChanged=function(w,y){if(!g.isNone(this._edgeState)){var D=e(this._edgeState.baseMaterial),z=!1;for(const r of this._edgeState.edgeMaterials)r.objectTransparency!==D&&(r.objectTransparency=D,z=!0);z&&this.resetEdgeObject(y);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[w])}};l.slicePlaneEnabledChanged=function(w,y){g.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:w},!y),this._edgeState.properties.slicePlaneEnabled=w)};l.setVisibility=function(w){if(null!=this.stage&&this._visible!==w&&((this._visible=w)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),g.isSome(this._edgeState))){const y=
this.stage.renderView.ensureEdgeView();y.hasObject(this.stageObject)?y.updateObjectVisibility(this.stageObject,w):w&&this.addOrUpdateEdgeObject(y,!1)}};l.alignWithElevation=function(w,y,D,z){null!=this.elevationAligner&&(g.isSome(D)&&d.setContextFeature(this.elevationContext.featureExpressionInfoContext,D),w=this.elevationAligner(this,this.elevationContext,w,y),null!=w&&(this.alignedSampledElevation=w),this.resetEdgeObject(z))};l.getCenterObjectSpace=function(w=b.create()){return p.copy(w,k.getCenter(this.stageObject.getBounds(!0)))};
l.getBoundingBoxObjectSpace=function(w=f.create()){var y=this.stageObject;w||(w=f.create());f.setMin(w,y.getBBMin(!0));f.setMax(w,y.getBBMax(!0));return w};l.computeAttachmentOrigin=function(w){for(const y of this.stageObject.geometryRecords)y.computeAttachmentOrigin(u)&&(p.transformMat4(u,u,this.stageObject.transformation),p.add(w.render.origin,w.render.origin,u),w.render.num++)};l.getProjectedBoundingBox=async function(w,y,D,z,r){r=this.getBoundingBoxObjectSpace(r);var C=v,A=f.isPoint(r)?1:C.length;
for(var x=0;x<A;x++){const m=C[x];q[0]=r[m[0]];q[1]=r[m[1]];q[2]=r[m[2]];p.transformMat4(q,q,this.stageObject.transformation);n[3*x]=q[0];n[3*x+1]=q[1];n[3*x+2]=q[2]}if(!w(n,0,A))return null;f.empty(r);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(C=0;C<3*A;C+=3){for(x=0;3>x;x++)r[x]=Math.min(r[x],n[C+x]),r[x+3]=Math.max(r[x+3],n[C+x]);w&&D.push({location:n.slice(C,C+3),screenSpaceBoundingRect:w})}if(y&&y.service&&"absolute-height"!==this.elevationContext.mode){f.center(r,
u);D="relative-to-scene"===this.elevationContext.mode?"scene":"ground";A=0;if(y.useViewElevation)A=g.unwrapOr(y.service.getElevation(u[0],u[1],D),0);else try{const m=c.demResolutionForBoundingBox(r,y);A=g.unwrapOr(await y.service.queryElevation(u[0],u[1],z,m,D),0)}catch(m){}f.offset(r,0,0,-this.alignedSampledElevation+A)}return r};l.addObjectState=function(w,y){0===w&&y.addObject(this.stageObject,this.stageObject.highlight());1===w&&y.addObject(this.stageObject,this.stageObject.maskOccludee())};l.removeObjectState=
function(w){w.removeObject(this.stageObject)};l.resetEdgeObject=function(w){if(!g.isNone(this._edgeState)){var y=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(y,w):y.removeObject(this.stageObject)}};l.addOrUpdateEdgeObject=function(w,y){const D=this._edgeState;if(!g.isNone(D)){var z=e(D.baseMaterial);for(const r of D.edgeMaterials)r.objectTransparency=z;w.addOrUpdateObject3D(this.stageObject,D.edgeMaterials,D.properties,!y).then(()=>{var r;return null==(r=this.stageLayer)?
void 0:r.commit()})}};a._createClass(t,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return t}();(function(t){t=t.VisibilityModes||(t.VisibilityModes={});t[t.REMOVE_OBJECT=0]="REMOVE_OBJECT";t[t.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(h||(h={}));const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=b.create(),u=b.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,
5],[3,1,5],[0,4,5],[3,4,5]];return h})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(a,g,b,p,f,k,c){function d(t){let l=0,w=0,y=0,D=!1,z=0;const r={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,
bytesPerCoordinate:0}};for(const C of t)b.isNone(C)||(l+=C.primitivesPerFeature,w+=C.primitivesPerCoordinate,y+=C.drawCallsPerFeature,r.bytesPerFeature+=C.memory.bytesPerFeature,r.bytesPerFeatureLabel+=C.memory.bytesPerFeatureLabel,r.bytesPerCoordinate+=C.memory.bytesPerCoordinate,r.draped.bytesPerFeature+=C.memory.bytesPerFeature,r.draped.bytesPerFeatureLabel+=C.memory.bytesPerFeatureLabel,r.draped.bytesPerCoordinate+=C.memory.bytesPerCoordinate,D=D||C.estimated,++z);return{primitivesPerFeature:l,
primitivesPerCoordinate:w,drawCallsPerFeature:y,estimated:D,memory:r,numComplexities:z}}function e(t,l){const w=h(t,l);var y=k.hasEdges(l)?2:0;switch(l.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:y,estimated:!1,memory:w};case "fill":return"mesh-3d"===t.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:y,estimated:!1,memory:w}:b.isSome(l.outline)&&0<l.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,
estimated:!1,memory:w}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:w};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:w};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:w};case "object":return l.resource&&l.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:w}:{...n(l.resource&&
l.resource.primitive||p.defaultPrimitive),memory:w};case "path":{var D=t=0;switch(l.profile){case "circle":t=10;break;case "quad":t=4;break;default:g.neverReached(l.profile);return}switch(l.join){case "round":D=3;break;case "miter":case "bevel":D=1;break;default:g.neverReached(l.join);return}y=2*t;D=t*D*2;let z=-2*D-y;switch(l.cap){case "none":break;case "butt":case "square":z+=2*(t-1);break;case "round":z+=2*(4*t+t);break;default:g.neverReached(l.cap);return}return{primitivesPerFeature:z,primitivesPerCoordinate:D+
y,drawCallsPerFeature:0,estimated:!1,memory:w}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:w}}}function h(t,l){t="point-3d"===t.type;switch(l.type){case "extrude":return l.edges&&0<l.edges.size?v.EXTRUDE_EDGES:v.EXTRUDE;case "fill":return b.isSome(l.outline)&&0<l.outline.size?v.FILL_OUTLINE:v.FILL;case "water":return v.FILL;case "line":return"round"===l.join?v.LINE_ROUND:v.LINE_MITER;case "path":switch(l.join){case "round":switch(l.profile){case "circle":return v.PATH_ROUND_CIRCLE;
case "quad":return v.PATH_ROUND_QUAD;default:g.neverReached(l.profile);return}case "miter":case "bevel":switch(l.profile){case "circle":return v.PATH_MITER_CIRCLE;case "quad":return v.PATH_MITER_QUAD;default:g.neverReached(l.profile);return}default:g.neverReached(l.join);return}case "object":return t?v.OBJECT_POINT:v.OBJECT_POLYGON;case "icon":case "text":return t?v.ICON_POINT:v.ICON_POLYGON}}function n(t){var l=u[t];if(l)return l;l=f.primitiveLodResources(t,null);l={primitivesPerFeature:c.geometriesFromLodLevelResources(l.levels[0]).reduce((w,
y)=>w+y.indices.get("position").length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return u[t]=l}const q={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},u={},v={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(t){t=d(t);0<t.numComplexities&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=
t.numComplexities);return t};a.defaultSymbolComplexity=function(t){if("web-style"===t.type)return q;const l=t.symbolLayers.toArray().map(w=>e(t,w));return d(l)};a.defaultSymbolLayerComplexity=e;a.defaultSymbolLayerMemoryComplexity=h;a.emptySymbolComplexity=q;a.memoryEstimators=v;a.totalSymbolComplexities=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],
function(a,g,b){const p=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(f){switch(f){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(f,k){const c=(d,e,h=!1)=>({levels:d.map(n=>{const q=e(n.tesselation);h&&b.cgToGIS(q);return{components:[{geometry:q,material:k}],faceCount:q.indexCount/3,
minScreenSpaceRadius:n.minScreenSpaceRadius}})});switch(f){case "sphere":return c([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],d=>b.createPolySphereGeometry(.5,d,!0));case "cube":return c([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createBoxGeometry(1));case "cone":return c(p,d=>b.createConeGeometry(1,.5,d,!1),!0);case "inverted-cone":return c(p,
d=>b.createConeGeometry(1,.5,d,!0),!0);case "cylinder":return c(p,d=>b.createCylinderGeometry(1,.5,d,[0,0,1],[0,0,.5]));case "tetrahedron":return c([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createTetrahedronGeometry(1),!0);case "diamond":return c([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createDiamondGeometry(1),!0)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils".split(" "),
function(a,g,b,p,f,k,c){function d(q,u){if(b.isNone(q))return null;const v=b.isSome(q.color)?k.fromArray(p.toUnitRGBA(q.color)):k.fromValues(0,0,0,0),t=f.pt2px(q.size),l=f.pt2px(q.extensionLength);switch(q.type){case "solid":return e({color:v,size:t,extensionLength:l,...u});case "sketch":return{...n,color:v,size:t,extensionLength:l,...u,type:"sketch"}}}function e(q){return{...h,...q,type:"solid"}}const h={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},n={color:k.fromValues(0,
0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2};a.createMaterial=function(q,u){return d(q&&q.enabled&&q.edges||null,u)};a.createMaterialFromEdges=d;a.createSolidEdgeMaterial=e;a.hasEdges=function(q){return q&&q.enabled&&(c.isExtrudeSymbol3DLayer(q)||c.isFillSymbol3DLayer(q))&&b.isSome(q.edges)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(g){return"extrude"===
g.type};a.isFillSymbol3DLayer=function(g){return"fill"===g.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],function(a,g){function b(p){const f=[];p.components.forEach(k=>{f.push(k.geometry)});return g.unique(f)}a.computeFaceCount=function(p){return b(p).reduce((f,k)=>f+k.indexCount/3,0)};a.geometriesFromLodLevelResources=b;a.geometriesFromLodResources=function(p){const f=
[];p.levels.forEach(k=>{k.components.forEach(c=>{f.push(c.geometry)})});return g.unique(f)};a.materialsFromLodResources=function(p){const f=[];p.levels.forEach(k=>{k.components.forEach(c=>{f.push(c.material)})});return g.unique(f)};a.texturesFromLodResources=function(p){const f=[];p.levels.forEach(k=>{k.components.forEach(c=>{c.textures&&f.push(...c.textures)})});return g.unique(f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/mathUtils ../../../../Color ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./graphicUtils ./elevationAlignmentUtils ./featureExpressionInfoUtils ./ElevationContext ./Loadable ./symbolComplexity".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){function l(r,C){r=null!=r?C.attributes[r]:0;return null!=r&&isFinite(r)?r:0}const w=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");b=function(r){function C(x,m,B,E){var F=r.call(this)||this;F._elevationInfoOverride=null;F.complexity=null;F.logger=w;F._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};F.symbol=x;F.symbolLayer=m;F._context=B;F._renderPriority=E.renderPriority;F._renderPriorityStep=E.renderPriorityStep;F._elevationContext=
new u.ElevationContext;F.complexity=F.computeComplexity();F._updateDrivenProperties(E.ignoreDrivers);F._updateElevationContext();return F}g._inheritsLoose(C,r);var A=C.prototype;A.getCachedSize=function(){return null};A._logGeometryCreationWarnings=function(x,m,B,E){const F="polygons"in x?x.polygons:null;E=`${E} geometry failed to be created`;let G=null;x.projectionSuccess?!m.length||1===m.length&&!m[0].length?G=`${E} (no ${B} were defined)`:Array.isArray(m)&&Array.isArray(m[0])?F&&0===F.length&&
"rings"===B&&0<m.length&&2<m[0].length&&(G=`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):G=`${E} (${B} should be defined as a 2D array)`:G=`${E} (failed to project geometry to view spatial reference)`;G&&w.warnOncePerTick(G)};A._validateGeometry=function(x,m=null,B=null){return p.isSome(m)&&!m.includes(x.type)?(this.logger.warn("unsupported geometry type for "+B+` symbol: ${x.type}`),!1):"point"!==x.type||k.isFinite(x.x)&&k.isFinite(x.y)?!0:(w.warn("point coordinate is not a valid number, graphic skipped"),
!1)};A._defaultElevationInfoNoZ=function(){return y};A._defaultElevationInfoZ=function(){return D};A._updateElevationContext=function(){p.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};A.getDefaultElevationInfo=function(x){return x.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};A.getGeometryElevationMode=function(x,m=this.getDefaultElevationInfo(x)){return this._elevationContext.mode||m.mode};A.setElevationInfoOverride=function(x){this._elevationInfoOverride=x;this._updateElevationContext()};A.setGraphicElevationContext=function(x,m){var B=p.unwrap(x.geometry);const E=this.getDefaultElevationInfo(B);m.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:E.unit;m.mode=this.getGeometryElevationMode(B,E);m.offsetMeters=p.unwrapOr(this._elevationContext.meterUnitOffset,p.unwrapOr(E.offset,0));if(B=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===m.mode)m.mode="relative-to-ground",m.offsetMeters=0;m.updateFeatureExpressionInfoContext(B?q.zeroContext:this._elevationContext.featureExpressionInfoContext,x,this._context.layer);return m};A.prepareSymbolLayerPatch=function(x){};A.updateGeometry=function(x,m){return!1};
A.onRemoveGraphic=function(x){};A._updateDrivenProperties=function(x){const m={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};x||(x=this._context.renderer)&&"visualVariables"in x&&x.visualVariables&&x.visualVariables.forEach(B=>{switch(B.type){case "color":m.color=!0;if(B.stops)for(let E=0;E<B.stops.length;E++){const F=B.stops[E].color;F&&(m.opacity=!0,1>F.a&&(m.opacityAlwaysOpaque=!1))}break;case "opacity":m.opacity=!0;m.opacityAlwaysOpaque=!1;break;case "size":m.size=!0}});this._drivenProperties=
m};A._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const x=this._context.layer.opacity;return null==x?1:x};A._getCombinedOpacity=function(x,m=z){let B=1;this.draped||(B*=this._getLayerOpacity());if(this._drivenProperties.opacity)return B;p.isSome(x)?B*=x.a:m.hasIntrinsicColor||(B=0);return B};A._getCombinedOpacityAndColor=function(x,m=z){m=this._getCombinedOpacity(x,m);if(this._drivenProperties.color)return h.mixinColorAndOpacity(null,
m);x=p.isSome(x)?c.toUnitRGB(x):d.ONES;return h.mixinColorAndOpacity(x,m)};A._getVertexOpacityAndColor=function(x,m=null){x=h.mixinColorAndOpacity(this._drivenProperties.color?x.color:null,this._drivenProperties.opacity?x.opacity:null);p.isSome(m)&&(x[0]*=m,x[1]*=m,x[2]*=m,x[3]*=m);return x};A.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};A.computeComplexity=function(){return t.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};A.destroy=function(){this.abortLoad()};
A.globalPropertyChanged=function(x,m,B){switch(x){case "opacity":return this.layerOpacityChanged(m,B);case "elevationInfo":return x=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(m,B,x)===n.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(m,B);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};A.updateGraphics3DGraphicElevationInfo=
function(x,m,B){let E=n.SymbolUpdateType.UPDATE;x.forEach(F=>{const G=m(F);p.isSome(G)?(this.setGraphicElevationContext(F.graphic,G.elevationContext),G.needsElevationUpdates=B(G.elevationContext.mode)):E=n.SymbolUpdateType.RECREATE});return E};A.applyRendererDiff=function(x,m){return!1};A.getFastUpdateAttrValues=function(x){if(!this._fastUpdates.enabled)return null;const m=this._fastUpdates.visualVariables,B=m.size?l(m.size.field,x):0,E=m.color?l(m.color.field,x):0;x=m.opacity?l(m.opacity.field,x):
0;return e.fromValues(B,E,x,0)};A.ensureDrapedStatus=function(x){if(null==this._draped)return this._draped=x,!0;x!==this.draped&&w.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};g._createClass(C,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},
{key:"draped",get:function(){return this._draped}}]);return C}(v.Loadable);const y={mode:"on-the-ground",offset:0,unit:"meters"},D={mode:"absolute-height",offset:0,unit:"meters"},z={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=b;a.default=b;a.getAttributeValue=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,g,b){let p=function(){function f(){this._abortController=
null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}var k=f.prototype;k.load=function(c,d){if(1===this._loadStatus)return c&&c(),this._loader;if(2===this._loadStatus)return d&&d(this._loadError),this._loader;this._loader||(this._abortController=b.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=1},e=>{this._loadError=e;this._abortController=null;this._loadStatus=2;!b.isAbortError(e)&&this.logger&&
e.message&&this.logger.warn(e.message);throw e;}));this._loader.then(c,d).catch(()=>{});return this._loader};k.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};g._createClass(f,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return f}();a.Loadable=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/support/coordsUtils ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){const q=p.create();a.createStageObjectForHUD=function(u,v,t,l,w,y,D,z,r,C){const A=t?t.length:0;var x=u.clippingExtent;f.projectPointToVector(v,q,u.elevationProvider.spatialReference);if(g.isSome(x)&&!c.containsPoint(x,q))return null;f.projectPointToVector(v,q,u.renderCoordsHelper.spatialReference);x=u.localOriginFactory.getOrigin(q);z=new e.Object3D({castShadow:!1,metadata:{layerUid:z,graphicUid:r,usesVerticalDistanceToGround:!0}});for(r=0;r<A;r++)z.addGeometry(t[r],
l[r],w?w[r]:k.IDENTITY,y,x,C);u=n.applyElevationAlignmentForHUD(z,v,u.elevationProvider,u.renderCoordsHelper,D);return{object:z,sampledElevation:u}};a.extendPointGraphicElevationContext=function(u,v,t){u=u.elevationContext;t=t.spatialReference;f.projectPointToVector(v,q,t);u.centerPointInElevationSR=d.makeDehydratedPoint(q[0],q[1],v.hasZ?q[2]:0,t)};a.geometryToRenderInfo=function(u,v,t,l,w){const y=new Float64Array(3*u.length),D=new Float64Array(y.length);u.forEach((z,r)=>{y[3*r]=z[0];y[3*r+1]=z[1];
y[3*r+2]=2<z.length?z[2]:0});v=n.applyPerVertexElevationAlignment(y,v,0,D,0,y,0,y.length/3,t,l,w);return{numVertices:u.length,position:y,mapPosition:D,projectionSuccess:null!=v,sampledElevation:v}};a.placePointOnGeometry=function(u){switch(u.type){case "point":return u;case "polygon":case "extent":return h.computeCentroid(u);case "polyline":var v=u.paths[0];if(!v||0===v.length)break;v=b.getPointOnPath(v,b.getPathLength(v)/2);return d.makeDehydratedPoint(v[0],v[1],v[2],u.spatialReference);case "mesh":return u.extent.center}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),function(a,g,b,p,f,k,c,d){let e=function(t){function l(y){y=t.call(this,y,n)||this;y.techniqueConfig=new d.LineCalloutTechniqueConfiguration;y._uniqueMaterialIdentifier=
l.uniqueMaterialIdentifier(y.params);return y}g._inheritsLoose(l,t);var w=l.prototype;w.dispose=function(){};w.getGLMaterial=function(y){return 0===y.output?new h(y):void 0};w.getPassParameters=function(){return this.params};w.getTechniqueConfig=function(y,D){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=
y;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.multipassGeometryEnabled=D?D.multipassGeometryEnabled:!1;return this.techniqueConfig};w.intersect=function(){};w.createBufferWriter=function(){return new v};w.validateParameterValues=function(y){y=l.uniqueMaterialIdentifier(y);y!==this._uniqueMaterialIdentifier&&
(this._uniqueMaterialIdentifier=y)};l.uniqueMaterialIdentifier=function(y){return JSON.stringify({screenOffset:y.screenOffset||[0,0],centerOffsetUnits:y.centerOffsetUnits||"world"})};g._createClass(l,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return l}(k.Material),h=function(t){function l(y){y=t.call(this,y)||this;y.isRenderSlot=!0;y.updateParameters();return y}g._inheritsLoose(l,t);var w=l.prototype;w.updateParameters=function(y){this.technique=this.techniqueRep.acquireAndReleaseExisting(d.LineCalloutTechnique,
this.material.getTechniqueConfig(!1,y),this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(d.LineCalloutTechnique,this.material.getTechniqueConfig(!0,y),this.depthTechnique)};w.beginSlot=function(y){switch(y){case 20:return this.isRenderSlot=!0;case 21:return this.isRenderSlot=!1,!0}return!1};w.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};w.ensureParameters=function(y){this.updateParameters(y)};w.bind=function(y,D){const z=this.getTechnique();
y.bindProgram(z.program);z.bindPass(y,this.material.getPassParameters(),D)};return l}(f);const n={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...k.materialParametersDefaults},q=p.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),u=[b.fromValues(0,0),b.fromValues(1,0),b.fromValues(0,1),b.fromValues(1,0),
b.fromValues(1,1),b.fromValues(0,1)];let v=function(){function t(){this.vertexBufferLayout=q}var l=t.prototype;l.allocate=function(w){return this.vertexBufferLayout.createBuffer(w)};l.elementCount=function(w){return 6*w.indices.get("position").length};l.write=function(w,y,D,z){c.writePosition(y.indices.get("position"),y.vertexAttributes.get("position").data,w.transformation,D.position,z,6);c.writeNormal(y.indices.get("normal"),y.vertexAttributes.get("normal").data,w.invTranspTransformation,D.normal,
z,6);c.writeBufferVec4(y.indices.get("auxpos1"),y.vertexAttributes.get("auxpos1").data,D.auxpos1,z,6);for(w=0;w<u.length;++w)D.uv0.setVec(z+w,u[w])};return t}();a.LineCalloutMaterial=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function g(){return new Float32Array(2)}function b(t){const l=new Float32Array(2);l[0]=t[0];l[1]=t[1];return l}function p(t,l){const w=new Float32Array(2);w[0]=t;w[1]=l;return w}function f(t,l){return new Float32Array(t,
l,2)}function k(){return g()}function c(){return p(1,1)}function d(){return p(1,0)}function e(){return p(0,1)}const h=g(),n=c(),q=d(),u=e();var v=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,zeros:k,ones:c,unitX:d,unitY:e,ZEROS:h,ONES:n,UNIT_X:q,UNIT_Y:u});a.ONES=n;a.UNIT_X=q;a.UNIT_Y=u;a.ZEROS=h;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.ones=c;a.unitX=d;a.unitY=e;a.vec2f32=v;a.zeros=k})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../materials/internal/MaterialUtil ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../../../../chunks/LineCallout.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){k=function(y){function D(){return y.apply(this,arguments)||this}b._inheritsLoose(D,y);var z=D.prototype;z.initializeProgram=function(r){var C=D.shader.get();const A=this.configuration;C=C.build({occlusionTestEnabled:A.occlusionTestEnabled,verticalOffsetEnabled:A.verticalOffset,screenSizePerspectiveEnabled:A.screenSizePerspective,depthHudEnabled:A.depthHudEnabled,depthHudAlignStartEnabled:A.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:A.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:r.viewingMode,isDraped:!1,multipassGeometryEnabled:A.multipassGeometryEnabled});return new e(r.rctx,C.generateSource("vertex"),C.generateSource("fragment"),d.Default3D)};z.bindPass=function(r,C,A){n.View.bindProjectionMatrix(this.program,A.camera.projectionMatrix);w.LineCallout.bindUniforms(this.program,C,A.camera.pixelRatio||1);l.VerticalOffset.bindUniforms(this.program,C,A);v.HUD.bindUniforms(this.program,
A);this.program.setUniform2fv("cameraNearFar",A.camera.nearFar);this.program.setUniform2fv("inverseViewport",A.inverseViewport);t.bindMultipassGeometryUniforms(this.program,r,A);this.program.setUniform1i("hudVisibilityTexture",4);r.bindTexture(A.hudVisibilityTexture,4);this.program.setUniform1f("cameraGroundRelative",A.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",C.shaderPolygonOffset);n.View.bindViewport(this.program,A);this.program.setUniform1f("perDistancePixelRatio",Math.tan(A.camera.fovY/
2)/(A.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",A.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/A.camera.fullViewport[2],2/A.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(C.size)*(A.camera.pixelRatio||1));q.bindScreenSizePerspective(C.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};z.bindDraw=function(r){n.View.bindView(this.program,r);n.View.bindCamPosition(this.program,r.origin,r.camera.viewInverseTransposeMatrix);
u.Slice.bindUniformsWithOrigin(this.program,this.configuration,r)};z.setPipelineState=function(r){r=r?519:513;return this.configuration.depthHudEnabled?h.makePipelineState({depthTest:{func:r},depthWrite:h.defaultDepthWriteParams}):h.makePipelineState({blending:h.separateBlendingParams(1,770,771,771),depthTest:{func:r},colorWrite:h.defaultColorWriteParams})};z.initializePipeline=function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)};return D}(k.ShaderTechnique);k.shader=
new f.ReloadableShaderModule(w.LineCalloutShader,()=>new Promise(function(y,D){a(["./LineCallout.glsl"],y,D)}));f=function(y){function D(){var z=y.apply(this,arguments)||this;z.occlusionTestEnabled=!0;z.verticalOffset=!1;z.screenSizePerspective=!1;z.depthHudEnabled=!1;z.depthHudAlignStartEnabled=!1;z.screenCenterOffsetUnitsEnabled=0;z.slicePlaneEnabled=!1;z.multipassGeometryEnabled=!1;return z}b._inheritsLoose(D,y);return D}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter()],f.prototype,
"occlusionTestEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"verticalOffset",void 0);p.__decorate([c.parameter()],f.prototype,"screenSizePerspective",void 0);p.__decorate([c.parameter()],f.prototype,"depthHudEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"depthHudAlignStartEnabled",void 0);p.__decorate([c.parameter({count:2})],f.prototype,"screenCenterOffsetUnitsEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],
f.prototype,"multipassGeometryEnabled",void 0);g.LineCalloutTechnique=k;g.LineCalloutTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl".split(" "),
function(a,g,b,p,f,k,c){function d(n){const q=new b.ShaderBuilder;q.include(p.AlignPixel);q.include(k.HUD,n);q.include(f.Slice,n);q.attributes.add("uv0","vec2");q.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");q.varyings.add("coverageSampling","vec4");q.varyings.add("lineSizes","vec2");n.multipassGeometryEnabled&&q.varyings.add("depth","float");q.vertex.code.add(g.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${n.occlusionTestEnabled?g.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${n.screenSizePerspectiveEnabled?g.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:g.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${n.multipassGeometryEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${n.depthHudEnabled?n.depthHudAlignStartEnabled?g.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:g.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${n.screenSizePerspectiveEnabled?g.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:g.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);q.fragment.uniforms.add("color","vec4");q.fragment.uniforms.add("borderColor","vec4");n.multipassGeometryEnabled&&(q.fragment.include(c.multipassGeometryTest,n),q.fragment.uniforms.add("inverseViewport","vec2"));q.fragment.code.add(g.glsl`
    void main() {
      ${n.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${n.depthHudEnabled?g.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:g.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return q}function e(n,q,u){3===u.length?n.setUniform4f(q,u[0],u[1],u[2],1):n.setUniform4fv(q,u)}(function(n){n.bindUniforms=function(q,u,v){e(q,"color",u.color);q.setUniform1f("pixelRatio",v);q.setUniform2f("screenOffset",u.screenOffset[0]*v,u.screenOffset[1]*v);null!==u.borderColor?(e(q,"borderColor",u.borderColor),q.setUniform1f("borderSize",v)):(q.setUniform4f("borderColor",0,0,0,0),q.setUniform1f("borderSize",0))}})(a.LineCallout||(a.LineCallout={}));var h=Object.freeze({__proto__:null,build:d,
get LineCallout(){return a.LineCallout}});a.LineCalloutShader=h;a.build=d})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,g,b){this.graphic=a;this.renderingInfo=g;this.layer=b}})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../core/Handles ./ContentObject ./DirtyEvents ./Octree".split(" "),
function(a,g,b,p,f,k,c,d,e,h){d=function(n){function q(v,t=""){var l=n.call(this)||this;l.apiLayerUid=t;l.type=0;l.events=new f;l.isSliceable=!1;l._objects=new p;l._stageHandles=new c;l.apiLayerUid=t;v=v||{};l.group=v.group||"";l.isVisible=null!=v.isVisible?v.isVisible:!0;l.isPickable=null!=v.isPickable?v.isPickable:!0;l.translation=v.translation?k.clone(v.translation):k.create();return l}g._inheritsLoose(q,n);var u=q.prototype;u.destroy=function(){this.detachStage();this._stage=null};u.attachStage=
function(v){this.detachStage();this._stage=v;for(const t of e.DirtyEventNames)this._stageHandles.add(this.events.on(t,l=>v.handleEvent(t,l)))};u.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};u.getObjectIds=function(){return this._objects.map(v=>v.id)};u.getObjects=function(){return this._objects};u.add=function(v){this._objects.push(v);v.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:v});b.isSome(this._octree)&&this._octree.add([v])};
u.remove=function(v){this._objects.removeUnordered(v)&&(v.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:v}),b.isSome(this._octree)&&this._octree.remove([v]))};u.addMany=function(v){this._objects.pushArray(v);for(const t of v)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:v});b.isSome(this._octree)&&this._octree.add(v)};u.removeMany=function(v){const t=[];this._objects.removeUnorderedMany(v,v.length,t);if(0!==t.length){for(const l of t)l.parentLayer=
null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t});b.isSome(this._octree)&&this._octree.remove(t)}};u.commit=function(){b.isSome(this._stage)&&this._stage.processDirtyLayer(this.id)};u.notifyObjectBBChanged=function(v,t){b.isSome(this._octree)&&this._octree.update(v,t)};u.getSpatialQueryAccelerator=function(){b.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};u.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();
this.events.emit("shaderTransformationChanged",this)};u.invalidateSpatialQueryAccelerator=function(){this._octree=b.destroyMaybe(this._octree)};u._createOctree=function(){this._octree=new h(v=>v.getBounds());this._octree.add(this._objects.data,this._objects.length)};return q}(d.ContentObject);a.WebGLLayer=d;a.isWebGLLayer=function(n){return b.isSome(n)&&0===n.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames=
"layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/geometryUtils ./Util".split(" "),
function(a,g,b,p,f,k,c,d){function e(L,P,Q){Q[0]=L[0]+P;Q[1]=L[1]+P;Q[2]=L[2]+P}function h(L,P,Q,X){if(1===P)L=Q(L[0]),c.sphere.copy(L,X);else{A[0]=Infinity;A[1]=Infinity;A[2]=Infinity;x[0]=-Infinity;x[1]=-Infinity;x[2]=-Infinity;for(let R=0;R<P;R++){var aa=Q(L[R]);if(v(aa[3])){var S=A,H=aa;S[0]=Math.min(S[0],H[0]-H[3]);S[1]=Math.min(S[1],H[1]-H[3]);S[2]=Math.min(S[2],H[2]-H[3]);S=x;S[0]=Math.max(S[0],aa[0]+aa[3]);S[1]=Math.max(S[1],aa[1]+aa[3]);S[2]=Math.max(S[2],aa[2]+aa[3])}}k.lerp(X,A,x,.5);X[3]=
Math.max(x[0]-A[0],x[1]-A[1],x[2]-A[2])/2}}function n(L,P,Q){if(!K.length)for(var X=0;8>X;++X)K.push({index:0,distance:0});for(X=0;8>X;++X){const aa=w[X];K.data[X].index=X;K.data[X].distance=u(L,P,aa)}K.sort((aa,S)=>aa.distance-S.distance);for(L=0;8>L;++L)Q[L]=K.data[L].index}function q(L,P){let Q=Infinity,X=null;for(let aa=0;8>aa;++aa){const S=u(L,P,y[aa]);S<Q&&(Q=S,X=y[aa])}return X}function u(L,P,Q){return P*(L[0]*Q[0]+L[1]*Q[1]+L[2]*Q[2])}function v(L){return!isNaN(L)&&-Infinity!==L&&Infinity!==
L&&0<L}let t=function(){function L(Q,X){this._objectToBoundingSphere=Q;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new l;this._objectCount=0;X&&(void 0!==X.maximumObjectsPerNode&&(this._maximumObjectsPerNode=X.maximumObjectsPerNode),void 0!==X.maximumDepth&&(this._maximumDepth=X.maximumDepth))}var P=L.prototype;P.destroy=function(){this._degenerateObjects.clear();l.clearPool();z[0]=null;m.prune();K.prune()};P.add=function(Q,X=Q.length){this._objectCount+=
X;this._grow(Q,X);const aa=l.acquire();for(let S=0;S<X;S++){const H=Q[S];this._isDegenerate(H)?this._degenerateObjects.add(H):(aa.init(this._root),this._add(H,aa))}l.release(aa)};P.remove=function(Q,X=null){this._objectCount-=Q.length;const aa=l.acquire();for(const S of Q)Q=g.isSome(X)?X:c.sphere.copy(this._objectToBoundingSphere(S),B),v(Q[3])?(aa.init(this._root),this._remove(S,Q,aa)):this._degenerateObjects.delete(S);l.release(aa);this._shrink()};P.update=function(Q,X){if(v(X[3])||!this._isDegenerate(Q))z[0]=
Q,Q=z,this.remove(Q,X),this.add(Q)};P.forEachAlongRay=function(Q,X,aa){const S=c.ray.wrap(Q,X);this._forEachNode(this._root,H=>{if(!this._intersectsNode(S,H))return!1;H=H.node;H.terminals.forAll(R=>{this._intersectsObject(S,R)&&aa(R)});null!==H.residents&&H.residents.forAll(R=>{this._intersectsObject(S,R)&&aa(R)});return!0})};P.forEachAlongRayWithVerticalOffset=function(Q,X,aa,S){const H=c.ray.wrap(Q,X);this._forEachNode(this._root,R=>{if(!this._intersectsNodeWithOffset(H,R,S))return!1;R=R.node;R.terminals.forAll(T=>
{this._intersectsObjectWithOffset(H,T,S)&&aa(T)});null!==R.residents&&R.residents.forAll(T=>{this._intersectsObjectWithOffset(H,T,S)&&aa(T)});return!0})};P.forEach=function(Q){this._forEachNode(this._root,X=>{X=X.node;X.terminals.forAll(Q);null!==X.residents&&X.residents.forAll(Q);return!0});this._degenerateObjects.forEach(Q)};P.forEachDegenerateObject=function(Q){this._degenerateObjects.forEach(Q)};P.findClosest=function(Q,X,aa,S,H){return this._findClosest(Q,"front-to-back"===X?1:-1,aa,S,H)};P.forEachInDepthRange=
function(Q,X,aa,S,H,R,T,W){this._forEachInDepthRange(Q,X,"front-to-back"===aa?1:-1,S,H,R,T,W)};P.forEachNode=function(Q){this._forEachNode(this._root,X=>Q(X.node,X.bounds,X.halfSize))};P._intersectsNode=function(Q,X){e(X.bounds,2*-X.halfSize,A);e(X.bounds,2*X.halfSize,x);return d.rayBoxTest(Q.origin,Q.direction,A,x)};P._intersectsNodeWithOffset=function(Q,X,aa){e(X.bounds,2*-X.halfSize,A);e(X.bounds,2*X.halfSize,x);aa.applyToMinMax(A,x);return d.rayBoxTest(Q.origin,Q.direction,A,x)};P._intersectsObject=
function(Q,X){X=this._objectToBoundingSphere(X);return 0<X[3]?c.sphere.intersectsRay(X,Q):!0};P._intersectsObjectWithOffset=function(Q,X,aa){X=this._objectToBoundingSphere(X);return 0<X[3]?c.sphere.intersectsRay(aa.applyToBoundingSphere(X),Q):!0};P._forEachNode=function(Q,X){Q=l.acquire().init(Q);const aa=[Q];for(;0!==aa.length;){Q=aa.pop();if(X(Q)&&!Q.isLeaf())for(let S=0;S<Q.node.children.length;S++)Q.node.children[S]&&aa.push(l.acquire().init(Q).advance(S));l.release(Q)}};P._forEachNodeDepthOrdered=
function(Q,X,aa,S=1){Q=l.acquire().init(Q);const H=[Q];for(n(aa,S,J);0!==H.length;){Q=H.pop();if(X(Q)&&!Q.isLeaf())for(aa=7;0<=aa;--aa)S=J[aa],S>=Q.node.children.length||Q.node.children[S]&&H.push(l.acquire().init(Q).advance(S));l.release(Q)}};P._findClosest=function(Q,X,aa,S,H){let R=Infinity,T=Infinity,W=null;const Y=q(Q,X);let U=0;const N=ca=>{++U;if(!S||S(ca)){var O=this._objectToBoundingSphere(ca);if(!aa||c.frustum.intersectsSphere(aa,O)){var V=u(Q,X,c.sphere.getCenter(O)),ba=V-O[3];O=V+O[3];
ba<R&&(R=ba,T=O,W=ca)}}};this._forEachNodeDepthOrdered(this._root,ca=>{if(null!=H&&U>=H||aa&&!c.frustum.intersectsSphere(aa,ca.bounds))return!1;k.scale(C,Y,ca.halfSize);k.add(C,C,ca.bounds);if(u(Q,X,C)>T)return!1;ca=ca.node;ca.terminals.forAll(O=>{N(O)});null!==ca.residents&&ca.residents.forAll(O=>{N(O)});return!0},Q,X);return W};P._forEachInDepthRange=function(Q,X,aa,S,H,R,T,W){let Y=-Infinity,U=Infinity;const N={setRange:ia=>{1===aa?(Y=Math.max(Y,ia.near),U=Math.min(U,ia.far)):(Y=Math.max(Y,-ia.far),
U=Math.min(U,-ia.near))}};N.setRange(S);const ca=u(X,aa,Q),O=q(X,aa),V=q(X,-1*aa);let ba=0;const fa=ia=>{++ba;if(!T||T(ia)){var ma=this._objectToBoundingSphere(ia),ea=c.sphere.getCenter(ma);ea=u(X,aa,ea)-ca;var M=ea+ma[3];ea-ma[3]>U||M<Y||(!R||c.frustum.intersectsSphere(R,ma))&&H(ia,N)}};this._forEachNodeDepthOrdered(this._root,ia=>{if(null!=W&&ba>=W||R&&!c.frustum.intersectsSphere(R,ia.bounds))return!1;k.scale(C,O,ia.halfSize);k.add(C,C,ia.bounds);if(u(X,aa,C)-ca>U)return!1;k.scale(C,V,ia.halfSize);
k.add(C,C,ia.bounds);if(u(X,aa,C)-ca<Y)return!1;ia=ia.node;ia.terminals.forAll(ma=>{fa(ma)});null!==ia.residents&&ia.residents.forAll(ma=>{fa(ma)});return!0},X,aa)};P._remove=function(Q,X,aa){m.clear();X=aa.advanceTo(X,(S,H)=>{m.push(S.node);m.push(H)})?aa.node.terminals:aa.node.residents;X.removeUnordered(Q);if(0===X.length)for(Q=m.length-2;0<=Q&&this._purge(m.data[Q],m.data[Q+1]);Q-=2);};P._nodeIsEmpty=function(Q){if(0!==Q.terminals.length)return!1;if(null!==Q.residents)return 0===Q.residents.length;
for(let X=0;X<Q.children.length;X++)if(Q.children[X])return!1;return!0};P._purge=function(Q,X){0<=X&&(Q.children[X]=null);return this._nodeIsEmpty(Q)?(null===Q.residents&&(Q.residents=new p({shrink:!0})),!0):!1};P._add=function(Q,X){X.advanceTo(this._objectToBoundingSphere(Q))?X.node.terminals.push(Q):(X.node.residents.push(Q),X.node.residents.length>this._maximumObjectsPerNode&&X.depth<this._maximumDepth&&this._split(X))};P._split=function(Q){const X=Q.node.residents;Q.node.residents=null;for(let aa=
0;aa<X.length;aa++){const S=l.acquire().init(Q);this._add(X.getItemAt(aa),S);l.release(S)}};P._grow=function(Q,X){0!==X&&(h(Q,X,aa=>this._objectToBoundingSphere(aa),E),v(E[3])&&!this._fitsInsideTree(E)&&(this._nodeIsEmpty(this._root.node)?(c.sphere.copy(E,this._root.bounds),this._root.halfSize=1.25*E[3]):(Q=this._rootBoundsForRootAsSubNode(E),this._placingRootViolatesMaxDepth(Q)?this._rebuildTree(E,Q):this._growRootAsSubNode(Q),l.release(Q))))};P._rebuildTree=function(Q,X){k.copy(F,X.bounds);F[3]=
X.halfSize;h([Q,F],2,aa=>aa,G);Q=l.acquire().init(this._root);this._root.initFrom(null,G,1.25*G[3]);this._forEachNode(Q,aa=>{this.add(aa.node.terminals.data,aa.node.terminals.length);null!==aa.node.residents&&this.add(aa.node.residents.data,aa.node.residents.length);return!0});l.release(Q)};P._placingRootViolatesMaxDepth=function(Q){const X=Math.log(Q.halfSize/this._root.halfSize)*Math.LOG2E;let aa=0;this._forEachNode(this._root,S=>{aa=Math.max(aa,S.depth);return aa+X<=this._maximumDepth});return aa+
X>this._maximumDepth};P._rootBoundsForRootAsSubNode=function(Q){var X=Q[3];let aa=-Infinity;const S=this._root.bounds,H=this._root.halfSize;for(var R=0;3>R;R++){var T=Math.max(0,Math.ceil((S[R]-H-(Q[R]-X))/(2*H)));const W=Math.max(0,Math.ceil((Q[R]+X-(S[R]+H))/(2*H)))+1;aa=Math.max(aa,2**Math.ceil(Math.log(T+W)*Math.LOG2E));I[R].min=T;I[R].max=W}for(Q=0;3>Q;Q++)X=I[Q].min,R=I[Q].max,T=(aa-(X+R))/2,X+=Math.ceil(T),R+=Math.floor(T),r[Q]=S[Q]-H-X*H*2+(R+X)*H;r[3]=aa*H*D;return l.acquire().initFrom(null,
r,aa*H,0)};P._growRootAsSubNode=function(Q){const X=this._root.node;k.copy(E,this._root.bounds);E[3]=this._root.halfSize;this._root.init(Q);Q.advanceTo(E,null,!0);Q.node.children=X.children;Q.node.residents=X.residents;Q.node.terminals=X.terminals};P._shrink=function(){for(;;){const Q=this._findShrinkIndex();if(-1===Q)break;this._root.advance(Q);this._root.depth=0}};P._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let Q=null;const X=this._root.node.children;
let aa=0,S=0;for(;S<X.length&&null==Q;)aa=S++,Q=X[aa];for(;S<X.length;)if(X[S++])return-1;return aa};P._isDegenerate=function(Q){Q=this._objectToBoundingSphere(Q)[3];return!v(Q)};P._fitsInsideTree=function(Q){const X=this._root.bounds,aa=this._root.halfSize;return Q[3]<=aa&&Q[0]>=X[0]-aa&&Q[0]<=X[0]+aa&&Q[1]>=X[1]-aa&&Q[1]<=X[1]+aa&&Q[2]>=X[2]-aa&&Q[2]<=X[2]+aa};a._createClass(L,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",
get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return L}(),l=function(){function L(){this.bounds=c.sphere.create();this.halfSize=0;this.initFrom(null,null,0,0)}var P=L.prototype;P.init=function(Q){return this.initFrom(Q.node,Q.bounds,Q.halfSize,Q.depth)};P.initFrom=function(Q,X,aa,S=this.depth){this.node=
g.isSome(Q)?Q:L.createEmptyNode();g.isSome(X)&&c.sphere.copy(X,this.bounds);this.halfSize=aa;this.depth=S;return this};P.advance=function(Q){let X=this.node.children[Q];X||(X=L.createEmptyNode(),this.node.children[Q]=X);this.node=X;this.halfSize/=2;this.depth++;Q=w[Q];this.bounds[0]+=Q[0]*this.halfSize;this.bounds[1]+=Q[1]*this.halfSize;this.bounds[2]+=Q[2]*this.halfSize;this.bounds[3]=this.halfSize*D;return this};P.advanceTo=function(Q,X,aa=!1){for(;;){if(this.isTerminalFor(Q))return X&&X(this,-1),
!0;if(this.isLeaf()){if(!aa)return X&&X(this,-1),!1;this.node.residents=null}const S=this._childIndex(Q);X&&X(this,S);this.advance(S)}};P.isLeaf=function(){return null!=this.node.residents};P.isTerminalFor=function(Q){return Q[3]>this.halfSize/2};P._childIndex=function(Q){const X=this.bounds;return(X[0]<Q[0]?1:0)+(X[1]<Q[1]?2:0)+(X[2]<Q[2]?4:0)};L.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new p({shrink:!0}),residents:new p({shrink:!0})}};L.acquire=
function(){return L._pool.acquire()};L.release=function(Q){L._pool.release(Q)};L.clearPool=function(){L._pool.prune()};return L}();l._pool=new b(l);const w=[f.fromValues(-1,-1,-1),f.fromValues(1,-1,-1),f.fromValues(-1,1,-1),f.fromValues(1,1,-1),f.fromValues(-1,-1,1),f.fromValues(1,-1,1),f.fromValues(-1,1,1),f.fromValues(1,1,1)],y=[f.fromValues(-1,-1,-1),f.fromValues(-1,-1,1),f.fromValues(-1,1,-1),f.fromValues(-1,1,1),f.fromValues(1,-1,-1),f.fromValues(1,-1,1),f.fromValues(1,1,-1),f.fromValues(1,1,
1)],D=Math.sqrt(3),z=[null],r=c.sphere.create(),C=f.create(),A=f.create(),x=f.create(),m=new p,B=c.sphere.create(),E=c.sphere.create(),F=c.sphere.create(),G=c.sphere.create(),I=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],K=new p,J=[0,0,0,0,0,0,0,0];return t})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["exports","../../../../core/maybe","../../../../Color","../../../../core/screenUtils","../../../../chunks/vec4f64"],function(a,g,b,p,f){let k=function(){function c(e){this.definition=
e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.fillStyle=this.colorToRGBA(e.color);this.haloStyle=this.colorToRGB(e.halo.color)}var d=c.prototype;d.colorToRGB=function(e){return`rgb(${e.slice(0,3).map(h=>Math.floor(255*h)).toString()})`};d.colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(h=>Math.floor(255*h)).toString()},${e[3]})`};c.fromSymbol=function(e,h=1){var n=g.get(e,"material","color");n=g.isSome(n)?b.toUnitRGBA(n):f.ZEROS;var q=e.halo;const u=null!=e.size?p.pt2px(e.size):
12;e={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"};q=g.isSome(q)&&g.isSome(q.color)&&0<q.size?{size:p.pt2px(q.size),color:b.toUnitRGBA(q.color)}:{size:0,color:f.ZEROS};return new c({size:u,color:n,font:e,halo:q,pixelRatio:h})};return c}();a.TextRenderParameters=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],function(a,g,b){function p(d,e,h){d.canvas||(d.canvas=document.createElement("canvas"));d.canvas.width=e;d.canvas.height=h;return d.canvas}let f=function(){function d(h,n,q=2048){this.text=h;this._parameters=n;this.maxSize=q;this._lineWidths=[];this._displayWidth=this._renderPixelRatio=null;this.key=`${this._parameters.key}--${h}`;this._lines=h.split(/\r?\n/);this._lineHeight=this.computeLineHeight()}var e=d.prototype;e.getLineXOffset=
function(h){return Math.round((this.renderedWidth-this._lineWidths[h]*this.renderPixelRatio)/2)};e.render=function(h,n=0,q=0){const u=this.renderedLineHeight;var v=this.renderedHaloSize,t=h.textAlign,l=this.renderedWidth;t=("center"===t?.5*l:"right"===t?l:0)+v;l=v+1;h.save();0<v&&this.renderHalo(h,t,l,n,q);this.setFontProperties(h,this.renderedFontSize);q+=l;n+=t;for(v=0;v<this._lines.length;++v)h.globalCompositeOperation="destination-out",h.fillStyle="rgb(0, 0, 0)",t=this._lines[v],l=this.getLineXOffset(v),
h.fillText(t,n+l,q),h.globalCompositeOperation="source-over",h.fillStyle=this._parameters.fillStyle,h.fillText(t,n+this.getLineXOffset(v),q),q+=u;h.restore()};e.renderHalo=function(h,n,q,u,v){const t=this.renderedWidth,l=this.renderedHeight,w=p(c,Math.max(t,512),Math.max(l,512)),y=w.getContext("2d");y.clearRect(0,0,t,l);this.setFontProperties(y,this.renderedFontSize);y.fillStyle=this._parameters.haloStyle;y.strokeStyle=this._parameters.haloStyle;const D=3>this.renderedHaloSize;y.lineJoin=D?"miter":
"round";D?this.renderHaloEmulated(y,n,q):this.renderHaloNative(y,n,q);h.globalAlpha=this._parameters.definition.halo.color[3];h.drawImage(w,0,0,t,l,u,v,t,l);h.globalAlpha=1};e.renderHaloEmulated=function(h,n,q){const u=this.renderedLineHeight,v=this.renderedHaloSize;for(let t=0;t<this._lines.length;++t){const l=this._lines[t],w=this.getLineXOffset(t);for(const [y,D]of k)h.fillText(l,n+w+v*y,q+v*D);q+=u}};e.renderHaloNative=function(h,n,q){const u=this.renderedLineHeight,v=this.renderedHaloSize;for(let t=
0;t<this._lines.length;++t){const l=2*v,w=this._lines[t],y=this.getLineXOffset(t);for(let D=0;5>D;D++)h.lineWidth=(.6+.1*D)*l,h.strokeText(w,n+y,q);q+=u}};e.setFontProperties=function(h,n){const q=this._parameters.definition.font;h.font=`${q.style} ${q.weight} ${n}px ${q.family}, sans-serif`;h.textAlign="left";h.textBaseline="top"};e._ensureTextWidth=function(){if(b.isSome(this._displayWidth))return this._displayWidth;const h=p(c,512,512).getContext("2d");this.setFontProperties(h,this._parameters.definition.size);
let n=0,q=2*this._parameters.haloSize;this._lineWidths.length=0;var u=this._parameters.definition.font;if("italic"===u.style||"oblique"===u.style||"string"===typeof u.weight&&("bold"===u.weight||"bolder"===u.weight)||"number"===typeof u.weight&&600<u.weight)q+=.3*h.measureText("A").width;for(const v of this._lines)u=Math.round(h.measureText(v).width+q),this._lineWidths.push(u),n=Math.max(n,u);return this._displayWidth=n};e.computeLineHeight=function(){return Math.ceil(1.275*this._parameters.definition.size+
2*this._parameters.haloSize)+1};g._createClass(d,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",
get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(b.isNone(this._renderPixelRatio)){const h=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(h,Math.min(this.maxSize/(this.displayWidth*h),this.maxSize/(this.displayHeight*h))):h}return this._renderPixelRatio}}]);return d}();const k=[];for(let d=0;360>
d;d+=22.5)k.push([Math.cos(Math.PI*d/180),Math.sin(Math.PI*d/180)]);const c={canvas:null};a.TextRenderer=f;a.default=f;a.getTextHelperCanvas=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,g,b){a.getGraphics3DSymbol=function(p){return p instanceof b?p.graphics3DSymbol:p instanceof g?p:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/asyncUtils ./Graphics3DObject3DGraphicLayer ./Loadable ./symbolComplexity ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),
function(a,g,b,p,f,k,c,d,e){const h={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(n){function q(v,t,l){var w=n.call(this)||this;w._symbol=v;w._context=t;w._backgroundLayers=l;w._destroyed=!1;w.symbolLayers=[];w.referenced=0;w._extentPadding=0;return w}a._inheritsLoose(q,n);var u=q.prototype;u.doLoad=async function(v){let t=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const l=t.length;for(;this.symbolLayers.length<
t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const w=[];for(let y=0;y<l;y++){const D=t.getItemAt(y);if(!1===D.enabled)continue;h.renderPriority=1-(1+y)/l;h.renderPriorityStep=1/l;h.ignoreDrivers=D._ignoreDrivers;const z=e.make(this.symbol,D,this._context,h);w.push(b.onAbortOrThrow(v,()=>{this.symbolLayers[y]=null;z.destroy()}));this.symbolLayers[y]=z}await p.forEach(this.symbolLayers,async(y,D)=>{if(g.isSome(y))try{await y.load(),this._extentPadding+=Math.max(this._extentPadding,
y.extentPadding)}catch{this.symbolLayers[D]=null}});for(const y of w)null==y?void 0:y.remove();w.length=0;b.throwIfAborted(v);if(this.symbolLayers.length&&!this.symbolLayers.some(y=>!!y))throw Error();};u.getSymbolLayerSize=function(v){v=this.symbolLayers[v];return g.isSome(v)?v.getCachedSize():null};u.createGraphics3DGraphic=function(v,t){const l=v.graphic,w=Array(this.symbolLayers.length);for(let y=0;y<this.symbolLayers.length;y++){const D=this.symbolLayers[y];w[y]=g.isSome(D)?D.createGraphics3DGraphic(v):
null}return new d(l,t||this,w,v.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};u.globalPropertyChanged=function(v,t){const l=this.symbolLayers.length;for(let w=0;w<l;w++){const y=this.symbolLayers[w],D=z=>{z=z._graphics[w];return z instanceof f?z:null};if(g.isSome(y)&&!y.globalPropertyChanged(v,t,D))return!1}return!0};u.applyRendererDiff=function(v,t){return 1!==
this.loadStatus?!1:this.symbolLayers.reduce((l,w)=>l&&(g.isNone(w)||w.applyRendererDiff(v,t)),!0)};u.prepareSymbolPatch=function(v){if(2!==this.loadStatus&&"partial"===v.diff.type){var t=v.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var l=t.symbolLayers.diff;this.symbolLayers.forEach((w,y)=>{if(!g.isNone(w)){var D=l[y];if(D){const z={diff:D,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};w.prepareSymbolLayerPatch(z);v.symbolStatePatches.push(...z.symbolLayerStatePatches);
z.graphics3DGraphicPatches.length&&v.graphics3DGraphicPatches.push((r,C)=>{const A=r._graphics[y];g.isSome(A)&&z.graphics3DGraphicPatches.forEach(x=>x(A,C))})}}})}}};u.updateGeometry=function(v,t){for(let l=0;l<this.symbolLayers.length;l++){const w=this.symbolLayers[l];if(g.isNone(w))continue;const y=v._graphics[l];if(g.isNone(y)||!w.updateGeometry(y,t))return!1}return!0};u.onRemoveGraphic=function(v){for(let t=0;t<this.symbolLayers.length;t++){const l=this.symbolLayers[t];if(g.isNone(l))continue;
const w=v._graphics[t];if(g.isSome(w))l.onRemoveGraphic(w)}};u.getFastUpdateStatus=function(){let v=0,t=0,l=0;this.symbolLayers.forEach(w=>{g.isNone(w)||(0===w.loadStatus?v++:w.isFastUpdatesEnabled()?l++:t++)});return{loading:v,slow:t,fast:l}};u.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(const v of this.symbolLayers)g.isSome(v)&&v.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(q,
[{key:"symbol",get:function(){return this._symbol},set:function(v){this._symbol=v;if(this.symbolLayers)for(let t=0;t<v.symbolLayers.length;t++){const l=this.symbolLayers[t];g.isNone(l)||(l.symbol=v,l.symbolLayer=v.symbolLayers.items[t])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return c.totalSymbolComplexities(this.symbolLayers.map(v=>g.get(v,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return q}(k.Loadable)})},
"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../geometry/Polygon ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../layers/graphics/featureConversionUtils ../../../../core/byteSizeEstimations ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=new b(Array,D=>v.set(D,v.ZERO),null,10,5),y=d.create();return function(){function D(r,C,A,x,m){this._labelGraphics=[];this._auxiliaryGraphics=[];var B=Array(2);for(let E=0;E<B.length;E++)B[E]=Array(4);this._visibilityFlags=B;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++C.referenced;this.graphics3DSymbol=C;this.graphic=r;this._graphics=A;this._featureExpressionFeature=
m?l.createFeature(m,r,x):null;for(const E of this._graphics)g.isSome(E)&&(this.isElevationSource=this.isElevationSource||E.isElevationSource)}var z=D.prototype;z.initialize=function(r,C,A){this._layer=C;this._stage=r;this.forEachSymbolLayerGraphic(x=>{x.initialize(r,C,A);x.setVisibility(this.isVisible())})};z.destroy=function(){this.forEachSymbolLayerGraphic(r=>r.destroy());this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};z.clearLabelGraphics=
function(){this.forEachLabelGraphic(r=>r.destroy());this._labelGraphics.length=0};z.addLabelGraphic=function(r,C,A){this._labelGraphics.push(r);r.initialize(C,A);r.setVisibility(this.isVisible(1))};z.addAuxiliaryGraphic=function(r){this._auxiliaryGraphics.push(r);this._layer&&(r.initialize(this._stage,this._layer),r.setVisibility(this.isVisible()))};z.isVisible=function(r=0,C){for(let A=0;A<=r;A++){const x=this._visibilityFlags[A];for(let m=0;m<x.length;++m)if(!1===x[m]&&m!==C)return!1}return!0};
z.hasVisibilityFlag=function(r,C){return null!=this._visibilityFlags[C][r]};z.setVisibilityFlag=function(r,C,A){const x=this.isVisible(A);this._visibilityFlags[A][r]=C;const m=this.isVisible(A);if(x===m)return!1;if(1===A)this.forEachLabelGraphic(B=>B.setVisibility(m));else{this.forEachSymbolLayerGraphic(E=>E.setVisibility(m));const B=this.isVisible(1);this.forEachLabelGraphic(E=>E.setVisibility(B))}return!0};z.clearVisibilityFlag=function(r,C=0){return this.setVisibilityFlag(r,void 0,C)};z.getBSRadius=
function(){let r=0;this.forEachSymbolLayerGraphic(C=>{r=Math.max(r,C.getBSRadius())});return r};z.getCenterObjectSpace=function(r=k.create()){if(0===this._graphics.length)return c.set(r,0,0,0),r;const C=this._graphics[0];return g.isSome(C)?C.getCenterObjectSpace(r):r};z.computeExtent=function(r){if(!this._extent){var C=this.graphic.geometry;if(g.isNone(C))return!1;this._extent=d.create();t.computeAABR(C,this._extent);C=C.spatialReference;if(!C.equals(r)&&!e.projectBoundingRect(this._extent,C,this._extent,
r))return this._extent=null,!1}return!0};z.getAsOptimizedGeometry=function(r,C){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===r&&this._optimizedGeometry.hasM===C)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,r,C);this._optimizedGeometry.hasZ=r;this._optimizedGeometry.hasM=C;return this._optimizedGeometry.geometry};z._convertGraphicToOptimizedGeometry=function(r,C,A){r=r.geometry;if("mesh"===r.type||
"extent"===r.type)r=p.fromExtent("mesh"===r.type?r.extent:r);return h.convertFromGeometry(r,C,A)};z.computeAttachmentOrigin=function(){const r={render:{origin:k.create(),num:0},draped:{origin:q.create(),num:0}};for(const C of this._graphics)g.isNone(C)||C.computeAttachmentOrigin(r);r.render.num&&c.scale(r.render.origin,r.render.origin,1/r.render.num);r.draped.num&&u.scale(r.draped.origin,r.draped.origin,1/r.draped.num);return r};z.getProjectedBoundingBox=async function(r,C,A,x,m){m||(m={boundingBox:null,
requiresDrapedElevation:!1,screenSpaceObjects:[]});m.boundingBox?v.empty(m.boundingBox):m.boundingBox=v.empty();m.requiresDrapedElevation=!1;await f.forEach(this._graphics,async B=>{if(!g.isNone(B)){var E="draped"===B.type?C:r,F=w.acquire();B=await B.getProjectedBoundingBox(E,A,m.screenSpaceObjects,x,F);isFinite(B[2])&&isFinite(B[5])||(m.requiresDrapedElevation=!0);B&&v.expandWithAABB(m.boundingBox,F);w.release(F)}});return v.allFinite(m.boundingBox)||d.allFinite(v.toRect(m.boundingBox,y))?m:null};
z.needsElevationUpdates=function(){for(const r of this._graphics)if(g.isSome(r)&&("object3d"===r.type||"lod-instance"===r.type)&&r.needsElevationUpdates)return!0;for(const r of this._labelGraphics)if(r&&r.needsElevationUpdates)return!0;return!1};z.alignWithElevation=function(r,C,A){this.forEachRenderedGraphic(x=>{"object3d"!==x.type&&"lod-instance"!==x.type||x.alignWithElevation(r,C,this._featureExpressionFeature,A)})};z.addObjectStateSet=function(r,C){this.forEachSymbolLayerGraphic(A=>A.addObjectState(r,
C))};z.removeObjectState=function(r){this.forEachSymbolLayerGraphic(C=>C.removeObjectState(r))};z.forEachGraphicList=function(r,C){r.forEach(A=>A&&C(A))};z.forEachSymbolLayerGraphic=function(r){this.forEachGraphicList(this._graphics,r);this.forEachGraphicList(this._auxiliaryGraphics,r)};z.forEachLabelGraphic=function(r){this.forEachGraphicList(this._labelGraphics,r)};z.forEachRenderedGraphic=function(r){this.forEachSymbolLayerGraphic(r);this.forEachLabelGraphic(r)};a._createClass(D,[{key:"labelGraphics",
get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this._graphics}},{key:"isDraped",get:function(){let r=!1;this.forEachSymbolLayerGraphic(C=>{"draped"===C.type&&(r=!0)});return r}},{key:"usedMemory",get:function(){let r=n.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(C=>{const A=C.graphics3DSymbolLayer.complexity;g.isNone(A)||(C="draped"===C.type?A.memory.draped:A.memory,
r+=C.bytesPerFeature,C.bytesPerCoordinate&&(r+=t.numVertices(this.graphic.geometry)*C.bytesPerCoordinate))});return r}}]);return D}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){const q=g.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),u={icon:p.Graphics3DIconSymbolLayer,object:c.Graphics3DObjectSymbolLayer,line:f.Graphics3DLineSymbolLayer,path:d.Graphics3DPathSymbolLayer,fill:e.Graphics3DPolygonFillSymbolLayer,extrude:b.Graphics3DExtrudeSymbolLayer,text:h.Graphics3DTextSymbolLayer,water:n.Graphics3DWaterSymbolLayer},v={"mesh-3d":{fill:k.Graphics3DMeshFillSymbolLayer}};a.make=function(t,l,w,y){const D=v[t.type]&&v[t.type][l.type]||
u[l.type];return D?new D(t,l,w,y):(q.error("GraphicsLayerFactory#make",`unknown symbol type ${l.type}`),null)};a.setSymbolClass=function(t,l){u[t]=l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../core/libs/earcut/earcut ../../../../chunks/mat3 ../../support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/aaBoundingBox ../../support/ElevationProvider ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../support/debugFlags ./graphicUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ../support/edgeUtils ./Graphics3DSymbolLayer ../../../../renderers/support/renderingInfoUtils ./polygonUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(ca,O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha,na){let da=0;var oa=2*ba.count;{var qa=ba.index,ua=ba.count,Ca=V.length/3,Ja=M;k.copy(W,ha);const Ha=0<ka?1:-1;qa*=3;let Na=Ja;ha=3*Na;let Oa=Ja+ua;Ja=3*Oa;for(let Va=0;Va<ua;++Va)na&&(W[0]=ca[qa+0],W[1]=ca[qa+1],W[2]=ca[qa+2],k.normalize(W,W)),fa[ha+0]=ca[qa+0],fa[ha+1]=ca[qa+1],fa[ha+2]=ca[qa+2],ia[ha+0]=O[qa+0],ia[ha+1]=O[qa+1],ia[ha+2]=O[qa+2],ma[ha+0]=-Ha*W[0],ma[ha+1]=-Ha*W[1],ma[ha+
2]=-Ha*W[2],ea[Na]=0,fa[Ja+0]=ca[qa+0]+ka*W[0],fa[Ja+1]=ca[qa+1]+ka*W[1],fa[Ja+2]=ca[qa+2]+ka*W[2],ia[Ja+0]=O[qa+0],ia[Ja+1]=O[qa+1],ia[Ja+2]=O[qa+2],ma[Ja+0]=Ha*W[0],ma[Ja+1]=Ha*W[1],ma[Ja+2]=Ha*W[2],ea[Oa]=ka,ha+=3,Ja+=3,qa+=3,Na+=1,Oa+=1;ha=qa=0;Ja=3*oa;ca=0>ka?U:Y;O=0>ka?Y:U;for(na=0;na<Ca;++na)la[ha+0]=V[qa+ca[0]],la[ha+1]=V[qa+ca[1]],la[ha+2]=V[qa+ca[2]],Z[Ja+0]=V[qa+O[0]]+ua,Z[Ja+1]=V[qa+O[1]]+ua,Z[Ja+2]=V[qa+O[2]]+ua,ha+=3,Ja+=3,qa+=3}M+=2*ba.count;oa=0;K(fa,ia,ea,ma,da,ba.pathLengths[0],
ba.count,M,Z,oa,ka);M+=4*ba.pathLengths[0];oa+=2*ba.pathLengths[0];da+=ba.pathLengths[0];for(V=1;V<ba.pathLengths.length;++V)K(fa,ia,ea,ma,da,ba.pathLengths[V],ba.count,M,Z,oa,ka),M+=4*ba.pathLengths[V],oa+=2*ba.pathLengths[V],da+=ba.pathLengths[V]}function I(ca,O,V,ba,fa,ia,ma){ba[ia]=ba[ma];ma*=3;ia*=3;ca[ia+0]=ca[ma+0];ca[ia+1]=ca[ma+1];ca[ia+2]=ca[ma+2];O[ia+0]=O[ma+0];O[ia+1]=O[ma+1];O[ia+2]=O[ma+2];V[ia+0]=fa[0];V[ia+1]=fa[1];V[ia+2]=fa[2]}function K(ca,O,V,ba,fa,ia,ma,ea,M,Z,la){let ka=fa,
ha=fa+1,na=fa+ma,da=fa+ma+1,oa=ea,qa=ea+1,ua=ea+2*ia;ea=ea+2*ia+1;0>la&&(ka=fa+ma+1,da=fa);Z*=3;for(let Va=0;Va<ia;++Va){Va===ia-1&&(0<la?(ha=fa,da=fa+ma):(ha=fa,ka=fa+ma));var Ca=ca,Ja=ka,Ha=ha,Na=na,Oa=P;Ja*=3;Ha*=3;Na*=3;k.set(Q,Ca[Ja++],Ca[Ja++],Ca[Ja++]);k.set(X,Ca[Ha++],Ca[Ha++],Ca[Ha++]);k.set(aa,Ca[Na++],Ca[Na++],Ca[Na++]);k.subtract(S,X,Q);k.subtract(H,aa,Q);k.cross(Oa,H,S);k.normalize(Oa,Oa);I(ca,O,ba,V,P,oa,ka);I(ca,O,ba,V,P,qa,ha);I(ca,O,ba,V,P,ua,na);I(ca,O,ba,V,P,ea,da);M[Z++]=oa;M[Z++]=
ua;M[Z++]=ea;M[Z++]=oa;M[Z++]=ea;M[Z++]=qa;ka++;ha++;na++;da++;oa+=2;qa+=2;ua+=2;ea+=2}}function J(ca,O,V,ba){ca=ca.stageObject;const fa=ca.geometryRecords,ia=fa.length,ma="absolute-height"!==O.mode;let ea=0;const M=ca.transformation,Z=c.invert(h.create(),M);for(let ha=0;ha<ia;ha+=2){const na=fa[ha].geometry,da=na.getMutableAttribute("position").data,oa=na.vertexAttributes.get("size").data;var la=na.vertexAttributes.get("mapPos").data;la=new l.SamplePosition(la);const qa=da.length/3;let ua=0,Ca=!1,
Ja=0;const Ha=V.spatialReference;for(let Na=0;Na<qa;Na++){R[0]=da[ua];R[1]=da[ua+1];R[2]=da[ua+2];var ka=r.evaluateElevationAlignmentAtPoint(la,V,O,ba,ma?N:null);ma&&(Ja+=N.sampledElevation);D.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(k.set(T,la.array[la.offset+0],la.array[la.offset+1],ka+oa[ua/3]),ba.toRenderCoords(T,Ha,T)):(k.set(T,da[ua+0],da[ua+1],da[ua+2]),k.transformMat4(T,T,M),ba.setAltitude(ka+oa[ua/3],T));k.transformMat4(T,T,Z);da[ua]=T[0];da[ua+1]=T[1];da[ua+2]=T[2];ka=.01/ba.unitInMeters;
if(Math.abs(R[0]-da[ua])>=ka||Math.abs(R[1]-da[ua+1])>=ka||Math.abs(R[2]-da[ua+2])>=ka)Ca=!0;la.offset+=3;ua+=3}Ca&&(na.invalidateBoundingInfo(),ca.geometryVertexAttrsUpdated(ha),fa[ha+1].geometry.invalidateBoundingInfo(),ca.geometryVertexAttrsUpdated(ha+1));ea+=Ja/qa}return ea/ia}const L=["polygon","extent"];m=function(ca){function O(ba,fa,ia,ma){ba=ca.call(this,ba,fa,ia,ma)||this;ba.ensureDrapedStatus(!1);return ba}g._inheritsLoose(O,ca);var V=O.prototype;V.doLoad=async function(){if(!this._drivenProperties.size){var ba=
z.validateSymbolLayerSize(this._getSymbolSize());if(ba)throw new p("graphics3dextrudesymbollayer:invalid-size",ba);}ba=b.get(this.symbolLayer,"material","color");var fa=this._getCombinedOpacityAndColor(ba);ba=f.fromArray(fa);fa=fa[3];ba={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:ba,ambient:ba,opacity:fa,transparent:1>fa||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};
this._material=new F.DefaultMaterial(ba);this._bottomMaterial=new F.DefaultMaterial({...ba,cullFace:2});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)};V.destroy=function(){ca.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};V.createGraphics3DGraphic=function(ba){const fa=ba.graphic;if(!this._validateGeometry(fa.geometry,L,this.symbolLayer.type))return null;const ia=this._getVertexOpacityAndColor(ba.renderingInfo,
255),ma=this.setGraphicElevationContext(fa,new C.ElevationContext);return this._createAs3DShape(fa,ba.renderingInfo,ia,ma,fa.uid)};V.layerOpacityChanged=function(ba,fa){var ia=b.get(this.symbolLayer,"material","color");ia=this._getCombinedOpacity(ia);const ma=1>ia||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:ia,transparent:ma});this._bottomMaterial.setParameterValues({opacity:ia,transparent:ma});const ea=this._getLayerOpacity();ba.forEach(M=>{M=fa(M);b.isSome(M)&&M.layerOpacityChanged(ea,
this._context.isAsync)});return!0};V.layerElevationInfoChanged=function(ba,fa){return this.updateGraphics3DGraphicElevationInfo(ba,fa,r.needsElevationUpdates3D)};V.slicePlaneEnabledChanged=function(ba,fa){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});ba.forEach(ia=>{ia=fa(ia);b.isSome(ia)&&ia.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});
return!0};V.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};V.pixelRatioChanged=function(){return!0};V._getExtrusionSize=function(ba){if(ba.size&&this._drivenProperties.size){var fa;ba=null!=(fa=B.getDriverAxisSizeValue(ba.size,2))?fa:0}else ba=this._getSymbolSize();return ba/=this._context.renderCoordsHelper.unitInMeters};
V._getSymbolSize=function(){var ba;return null!=(ba=this.symbolLayer.size)?ba:1};V._createAs3DShape=function(ba,fa,ia,ma,ea){var M=E.geometryAsPolygon(ba.geometry);if(b.isNone(M))return null;ba=E.geometryToRenderInfo(M,this._context.elevationProvider,this._context.renderCoordsHelper,ma);this._logGeometryCreationWarnings(ba,M.rings,"rings","ExtrudeSymbol3DLayer");if(0===M.rings.length||!M.rings.some(ab=>0<ab.length))return null;var Z=z.computeCentroid(M);if(b.isNone(Z))return null;var la=[];const ka=
[],ha=[],na=t.create(),da=h.create(),oa=f.create(),qa=1===this._context.renderCoordsHelper.viewingMode;qa||this._context.renderCoordsHelper.worldUpAtPosition(null,oa);d.computeLinearTransformation(M.spatialReference,[Z.x,Z.y,0],da,this._context.renderCoordsHelper.spatialReference);M=h.create();c.invert(M,da);Z=e.create();q.normalFromMat4(Z,M);const {polygons:ua,mapPosition:Ca,position:Ja}=ba;var Ha=Ja.length/3;const Na=new Float64Array(18*Ha),Oa=new Float64Array(18*Ha),Va=new Float64Array(18*Ha);
Ha=new Float64Array(6*Ha);let Ka=0;for(let ab=0;ab<ua.length;++ab){var wa=ua[ab];const cb=wa.count;if(this._context.clippingExtent&&(t.empty(na),t.expandWithBuffer(na,wa.mapPosition),!t.intersectsClippingArea(na,this._context.clippingExtent)))continue;const lb=n.earcut(wa.mapPosition,wa.holeIndices,3);if(0===lb.length)continue;const Xa=new Uint32Array(6*cb+lb.length);var Ea=new Uint32Array(lb.length),Pa=6*cb,ja=3*Na.BYTES_PER_ELEMENT;ja=new u.BufferViewVec3f64(Na.buffer,Ka*ja,ja,(Ka+Pa)*ja);var Ya=
3*Oa.BYTES_PER_ELEMENT;Ya=new u.BufferViewVec3f64(Oa.buffer,Ka*Ya,Ya,(Ka+Pa)*Ya);const ta=new Float64Array(Va.buffer,3*Ka*Va.BYTES_PER_ELEMENT,3*Pa);Pa=new Float64Array(Ha.buffer,1*Ka*Ha.BYTES_PER_ELEMENT,1*Pa);const Ba=this._getExtrusionSize(fa);G(Ja,Ca,lb,wa,ja.typedBuffer,ta,Ya.typedBuffer,Pa,0,Xa,Ea,Ba,oa,qa);v.transformMat4(ja,ja,M);v.transformMat3(Ya,Ya,Z);Ka+=6*cb;wa=this._createExtrudeGeometry(Xa,Xa.length-Ea.length,{positions:ja.typedBuffer,elevation:ta,normals:Ya.typedBuffer,heights:Pa},
ia);la.push(wa);ka.push(this._material);ha.push(h.IDENTITY);Ea=this._createExtrudeGeometry(Ea,0,{positions:ja.typedBuffer,elevation:ta,normals:Ya.typedBuffer,heights:Pa},ia);la.push(Ea);ka.push(this._bottomMaterial);ha.push(h.IDENTITY)}if(0===la.length)return null;fa=new y.Object3D({geometries:la,materials:ka,transformations:ha,metadata:{layerUid:this._context.layer.uid,graphicUid:ea,isElevationSource:!0}});fa.transformation=da;ia=x.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});
ia=b.isSome(ia)?{baseMaterial:this._material,edgeMaterials:[ia],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;la=new A(this,fa,la,null,null,J,ma,ia);la.alignedSampledElevation=ba.sampledElevation;la.needsElevationUpdates=r.needsElevationUpdates3D(ma.mode);return la};V._createExtrudeGeometry=function(ba,fa,ia,ma){var ea=new Uint32Array(ba.length);ma=[["position",{size:3,data:ia.positions,exclusive:!0}],["normal",{size:3,data:ia.normals,exclusive:!0}],["color",
{size:4,data:ma,exclusive:!0}],["size",{size:1,data:ia.heights,exclusive:!0}]];ea=[["position",ba],["normal",ba],["color",ea]];ia.elevation&&(ma.push(["mapPos",{size:3,data:ia.elevation}]),ea.push(["mapPos",ba]));return new w.Geometry(ma,ea,0,fa)};return O}(m.Graphics3DSymbolLayer);const P=f.create(),Q=f.create(),X=f.create(),aa=f.create(),S=f.create(),H=f.create(),R=f.create(),T=f.create(),W=f.create(),Y=[0,2,1],U=[0,1,2],N={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DExtrudeSymbolLayer=
m;a.default=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/earcut/earcut":function(){define(["exports"],function(a){function g(r,C,A,x,m){let B;if(m===0<u(r,C,A,x))for(;C<A;C+=x)B=k(C,r[C],r[C+1],B);else for(A-=x;A>=C;A-=x)B=k(A,r[A],r[A+1],B);B&&w(B,B.next)&&(c(B),B=B.next);return B}function b(r,C=r){if(!r)return r;let A;do if(A=!1,r.steiner||!w(r,r.next)&&0!==n(r.prev,r,r.next))r=r.next;else{c(r);r=C=r.prev;if(r===r.next)break;A=!0}while(A||r!==C);return C}function p(r,C,
A,x,m,B,E=0){if(r){!E&&B&&(r=h(r,x,m,B));for(var F=r;r.prev!==r.next;){var G=r.prev,I=r.next;if(B)var K=f(r,x,m,B);else a:{K=r;var J=K.prev,L=K;const P=K.next;if(0<=n(J,L,P)){K=!1;break a}let Q=K.next.next;const X=Q;let aa=0;for(;Q!==K.prev&&(0===aa||Q!==X);){aa++;if(v(J.x,J.y,L.x,L.y,P.x,P.y,Q.x,Q.y)&&0<=n(Q.prev,Q,Q.next)){K=!1;break a}Q=Q.next}K=!0}if(K)C.push(G.index/A),C.push(r.index/A),C.push(I.index/A),c(r),F=r=I.next;else if(r=I,r===F){if(!E)p(b(r),C,A,x,m,B,1);else if(1===E){E=C;F=A;G=r;
do I=G.prev,K=G.next.next,!w(I,K)&&q(I,G,G.next,K)&&t(I,K)&&t(K,I)&&(E.push(I.index/F),E.push(G.index/F),E.push(K.index/F),c(G),c(G.next),G=r=K),G=G.next;while(G!==r);r=G;p(r,C,A,x,m,B,2)}else if(2===E)a:{E=r;do{for(F=E.next.next;F!==E.prev;){if(G=E.index!==F.index){K=K=K=void 0;G=E;I=F;if(K=G.next.index!==I.index&&G.prev.index!==I.index){b:{K=G;do{if(K.index!==G.index&&K.next.index!==G.index&&K.index!==I.index&&K.next.index!==I.index&&q(K,K.next,G,I)){K=!0;break b}K=K.next}while(K!==G);K=!1}K=!K}if(K=
K&&t(G,I)&&t(I,G)){K=G;J=!1;L=(G.x+I.x)/2;I=(G.y+I.y)/2;do K.y>I!==K.next.y>I&&K.next.y!==K.y&&L<(K.next.x-K.x)*(I-K.y)/(K.next.y-K.y)+K.x&&(J=!J),K=K.next;while(K!==G);K=J}G=K}if(G){r=D(E,F);E=b(E,E.next);r=b(r,r.next);p(E,C,A,x,m,B);p(r,C,A,x,m,B);break a}F=F.next}E=E.next}while(E!==r)}break}}}}function f(r,C,A,x){const m=r.prev,B=r.next;if(0<=n(m,r,B))return!1;const E=m.x>r.x?m.x>B.x?m.x:B.x:r.x>B.x?r.x:B.x,F=m.y>r.y?m.y>B.y?m.y:B.y:r.y>B.y?r.y:B.y,G=l(m.x<r.x?m.x<B.x?m.x:B.x:r.x<B.x?r.x:B.x,m.y<
r.y?m.y<B.y?m.y:B.y:r.y<B.y?r.y:B.y,C,A,x);C=l(E,F,C,A,x);A=r.prevZ;for(x=r.nextZ;A&&A.z>=G&&x&&x.z<=C;){if(A!==r.prev&&A!==r.next&&v(m.x,m.y,r.x,r.y,B.x,B.y,A.x,A.y)&&0<=n(A.prev,A,A.next))return!1;A=A.prevZ;if(x!==r.prev&&x!==r.next&&v(m.x,m.y,r.x,r.y,B.x,B.y,x.x,x.y)&&0<=n(x.prev,x,x.next))return!1;x=x.nextZ}for(;A&&A.z>=G;){if(A!==r.prev&&A!==r.next&&v(m.x,m.y,r.x,r.y,B.x,B.y,A.x,A.y)&&0<=n(A.prev,A,A.next))return!1;A=A.prevZ}for(;x&&x.z<=C;){if(x!==r.prev&&x!==r.next&&v(m.x,m.y,r.x,r.y,B.x,B.y,
x.x,x.y)&&0<=n(x.prev,x,x.next))return!1;x=x.nextZ}return!0}function k(r,C,A,x){r=new z(r,C,A);x?(r.next=x.next,r.prev=x,x.next.prev=r,x.next=r):(r.prev=r,r.next=r);return r}function c(r){r.next.prev=r.prev;r.prev.next=r.next;r.prevZ&&(r.prevZ.nextZ=r.nextZ);r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function d(r){let C=r,A=r;do{if(C.x<A.x||C.x===A.x&&C.y<A.y)A=C;C=C.next}while(C!==r);return A}function e(r,C){let A=C;const x=r.x,m=r.y;let B=-Infinity,E;do{if(m<=A.y&&m>=A.next.y&&A.next.y!==A.y){var F=A.x+(m-
A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(F<=x&&F>B){B=F;if(F===x){if(m===A.y)return A;if(m===A.next.y)return A.next}E=A.x<A.next.x?A:A.next}}A=A.next}while(A!==C);if(!E)return null;if(x===B)return E.prev;C=E;F=E.x;const G=E.y;let I=Infinity,K;for(A=E.next;A!==C;)x>=A.x&&A.x>=F&&x!==A.x&&v(m<G?x:B,m,F,G,m<G?B:x,m,A.x,A.y)&&(K=Math.abs(m-A.y)/(x-A.x),(K<I||K===I&&A.x>E.x)&&t(A,r)&&(E=A,I=K)),A=A.next;return E}function h(r,C,A,x){for(var m;m!==r;m=m.next){m=m||r;null===m.z&&(m.z=l(m.x,m.y,C,A,x));if(m.prev.next!==
m||m.next.prev!==m)return m.prev.next=m,m.next.prev=m,h(r,C,A,x);m.prevZ=m.prev;m.nextZ=m.next}r.prevZ.nextZ=null;r.prevZ=null;a:for(A=1;;){x=r;C=r=null;let B=0;for(;x;){B++;m=x;let E=0;for(;E<A&&m;E++)m=m.nextZ;let F=A;for(;0<E||0<F&&m;){let G;0===E?(G=m,m=m.nextZ,F--):0!==F&&m?x.z<=m.z?(G=x,x=x.nextZ,E--):(G=m,m=m.nextZ,F--):(G=x,x=x.nextZ,E--);C?C.nextZ=G:r=G;G.prevZ=C;C=G}x=m}C.nextZ=null;A*=2;if(2>B)break a}return r}function n(r,C,A){return(C.y-r.y)*(A.x-C.x)-(C.x-r.x)*(A.y-C.y)}function q(r,
C,A,x){return w(r,C)&&w(A,x)||w(r,x)&&w(A,C)?!0:0<n(r,C,A)!==0<n(r,C,x)&&0<n(A,x,r)!==0<n(A,x,C)}function u(r,C,A,x){let m=0;for(let B=C,E=A-x;B<A;B+=x)m+=(r[E]-r[B])*(r[B+1]+r[E+1]),E=B;return m}function v(r,C,A,x,m,B,E,F){return 0<=(m-E)*(C-F)-(r-E)*(B-F)&&0<=(r-E)*(x-F)-(A-E)*(C-F)&&0<=(A-E)*(B-F)-(m-E)*(x-F)}function t(r,C){return 0>n(r.prev,r,r.next)?0<=n(r,C,r.next)&&0<=n(r,r.prev,C):0>n(r,C,r.prev)||0>n(r,r.next,C)}function l(r,C,A,x,m){r=32767*(r-A)*m;C=32767*(C-x)*m;r=(r|r<<8)&16711935;r=
(r|r<<4)&252645135;r=(r|r<<2)&858993459;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;return(r|r<<1)&1431655765|((C|C<<1)&1431655765)<<1}function w(r,C){return r.x===C.x&&r.y===C.y}function y(r,C){return r.x-C.x}function D(r,C){const A=new z(r.index,r.x,r.y),x=new z(C.index,C.x,C.y),m=r.next,B=C.prev;r.next=C;C.prev=r;A.next=m;m.prev=A;x.next=A;A.prev=x;B.next=x;x.prev=B;return x}let z=function(r,C,A){this.index=r;this.x=C;this.y=A;this.nextZ=this.prevZ=this.z=this.next=this.prev=
null;this.steiner=!1};a.deviation=function(r,C,A,x){var m=C&&C.length;let B=Math.abs(u(r,0,m?C[0]*A:r.length,A));if(m)for(let E=0,F=C.length;E<F;E++)B-=Math.abs(u(r,C[E]*A,E<F-1?C[E+1]*A:r.length,A));C=0;for(m=0;m<x.length;m+=3){const E=x[m]*A,F=x[m+1]*A,G=x[m+2]*A;C+=Math.abs((r[E]-r[G])*(r[F+1]-r[E+1])-(r[E]-r[F])*(r[G+1]-r[E+1]))}return 0===B&&0===C?0:Math.abs((C-B)/B)};a.earcut=function(r,C,A){var x=C&&C.length;const m=x?C[0]*A:r.length;var B=g(r,0,m,A,!0);const E=[];if(!B||B.next===B.prev)return E;
let F,G;var I,K;if(x){x=[];for(let L=0,P=C.length;L<P;L++){var J=g(r,C[L]*A,L<P-1?C[L+1]*A:r.length,A,!1);J===J.next&&(J.steiner=!0);x.push(d(J))}x.sort(y);for(K of x){C=K;x=B;if(x=e(C,x))C=D(x,C),b(C,C.next);B=b(B,B.next)}}if(r.length>80*A){F=I=r[0];G=K=r[1];for(C=A;C<m;C+=A)x=r[C],J=r[C+1],F=Math.min(F,x),G=Math.min(G,J),I=Math.max(I,x),K=Math.max(K,J);I=Math.max(I-F,K-G);I=0!==I?1/I:0}p(B,E,A,F,G,I);return E};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec32":function(){define(["exports",
"../views/3d/support/buffer/math/common"],function(a,g){function b(d,e,h){if(d.count!==e.count)g.logger.error("source and destination buffers need to have the same number of elements");else{var n=d.count,q=h[0],u=h[1],v=h[2],t=h[4],l=h[5],w=h[6],y=h[8],D=h[9],z=h[10],r=h[12],C=h[13];h=h[14];var A=d.typedBuffer;d=d.typedBufferStride;var x=e.typedBuffer;e=e.typedBufferStride;for(let B=0;B<n;B++){const E=B*d;var m=B*e;const F=x[m],G=x[m+1];m=x[m+2];A[E]=q*F+t*G+y*m+r;A[E+1]=u*F+l*G+D*m+C;A[E+2]=v*F+
w*G+z*m+h}}}function p(d,e,h){if(d.count!==e.count)g.logger.error("source and destination buffers need to have the same number of elements");else{var n=d.count,q=h[0],u=h[1],v=h[2],t=h[3],l=h[4],w=h[5],y=h[6],D=h[7];h=h[8];var z=d.typedBuffer;d=d.typedBufferStride;var r=e.typedBuffer;e=e.typedBufferStride;for(let A=0;A<n;A++){const x=A*d;var C=A*e;const m=r[C],B=r[C+1];C=r[C+2];z[x]=q*m+t*B+y*C;z[x+1]=u*m+l*B+D*C;z[x+2]=v*m+w*B+h*C}}}function f(d,e,h){const n=Math.min(d.count,e.count),q=d.typedBuffer;
d=d.typedBufferStride;const u=e.typedBuffer;e=e.typedBufferStride;for(let v=0;v<n;v++){const t=v*d,l=v*e;q[t]=h*u[l];q[t+1]=h*u[l+1];q[t+2]=h*u[l+2]}}function k(d,e,h){const n=Math.min(d.count,e.count),q=d.typedBuffer;d=d.typedBufferStride;const u=e.typedBuffer;e=e.typedBufferStride;for(let v=0;v<n;v++){const t=v*d,l=v*e;q[t]=u[l]>>h;q[t+1]=u[l+1]>>h;q[t+2]=u[l+2]>>h}}var c=Object.freeze({__proto__:null,transformMat4:b,transformMat3:p,scale:f,shiftRight:k});a.scale=f;a.shiftRight=k;a.transformMat3=
p;a.transformMat4=b;a.vec3=c})},"esri/views/3d/support/buffer/math/common":function(){define(["exports","../../../../../core/Logger"],function(a,g){g=g.getLogger("esri.views.3d.support.buffer.math");a.logger=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../core/maybe","../../Color","../visualVariables/support/visualVariableUtils"],function(a,g,b,p){function f(c,d){if(!c||c.symbol)return null;d=d&&d.renderer;return c&&
g.isSome(d)&&d.getObservationRenderer?d.getObservationRenderer(c):d}async function k(c,d){if(g.isSome(c.symbol))return c.symbol;const e=f(c,d);return g.isSome(e)&&e.getSymbolAsync(c,{...d,abortOptions:{signal:d.signal}})}a.getDriverAxisSizeValue=function(c,d=0){c=c[d];return"number"===typeof c&&isFinite(c)?c:null};a.getDriverAxisSizeValueAny=function(c){for(let d=0;3>d;d++){const e=c[d];if("number"===typeof e)return isFinite(e)?e:0}return 0};a.getRenderer=f;a.getRenderingInfo=function(c,d){const e=
f(c,d);if(g.isSome(c.symbol))var h=c.symbol;else h=f(c,d),h=g.isSome(h)&&"dot-density"!==h.type?h.getSymbol(c,d):null;if(g.isNone(h))return null;h={renderer:e,symbol:h};if(g.isNone(e)||!("visualVariables"in e)||!e.visualVariables)return h;d=p.getVisualVariableValues(e,c,d);c=["proportional","proportional","proportional"];for(const {variable:n,value:q}of d)switch(n.type){case "color":h.color=q.toRgba();break;case "size":if("outline"===n.target)h.outlineSize=q;else switch(d=n.useSymbolValue?"symbol-value":
q,n.axis){case "width":c[0]=d;break;case "depth":c[1]=d;break;case "height":c[2]=d;break;case "width-and-depth":c[0]=c[1]=d;break;default:c[0]=c[1]=c[2]=d}break;case "opacity":h.opacity=q;break;case "rotation":switch(n.axis){case "tilt":h.tilt=q;break;case "roll":h.roll=q;break;default:h.heading=q}}if("proportional"!==c[0]||"proportional"!==c[1]||"proportional"!==c[2])h.size=c;return h};a.getRenderingInfoAsync=async function(c,d){var e=f(c,d),h=await k(c,d);if(!h)return null;h={renderer:e,symbol:h};
if(!(e&&"visualVariables"in e&&e.visualVariables))return h;d=p.getVisualVariableValues(e,c,d);c=["proportional","proportional","proportional"];for(const {variable:n,value:q}of d)"color"===n.type?h.color=b.toUnitRGBA(q):"size"===n.type?"outline"===n.target?h.outlineSize=q:(d=n.axis,e=n.useSymbolValue?"symbol-value":q,"width"===d?c[0]=e:"depth"===d?c[1]=e:"height"===d?c[2]=e:c[0]="width-and-depth"===d?c[1]=e:c[1]=c[2]=e):"opacity"===n.type?h.opacity=q:"rotation"===n.type&&"tilt"===n.axis?h.tilt=q:"rotation"===
n.type&&"roll"===n.axis?h.roll=q:"rotation"===n.type&&(h.heading=q);if(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))h.size=c;return h};a.getSymbolAsync=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/Extent ../../../../geometry/Polygon ../../../../geometry ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../webgl-engine/lib/Geometry ./elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(a,g,b,p,f,k,c,d,e,h){function n(u,v,t){const l=[];for(const {index:w,count:y}of u){if(1>=y)continue;u=3*w;const D=u+3*y;l.push({index:w,count:y,position:v.subarray(u,D),mapPosition:t?t.subarray(u,D):void 0})}return l}function q(u,v,t){const l=[];for(const {index:w,count:y,holeIndices:D,pathLengths:z}of u){if(1>=y)continue;u=3*w;const r=u+3*y,C=D.map(A=>A-w);l.push({index:w,count:y,holeIndices:C,pathLengths:z,position:v.subarray(u,r),mapPosition:t?t.subarray(u,r):void 0})}return l}a.createColorGeometry=
function(u){const v=[["position",u.indices]],t=[["position",{size:3,data:u.attributeData.position,exclusive:!0}]];g.isSome(u.attributeData.color)&&(t.push(["color",{size:4,data:u.attributeData.color,exclusive:!0}]),v.push(["color",new Uint32Array(u.indices.length)]));g.isSome(u.attributeData.uvMapSpace)&&(t.push(["uvMapSpace",{size:4,data:u.attributeData.uvMapSpace,exclusive:!0}]),v.push(["uvMapSpace",u.indices]));g.isSome(u.attributeData.boundingRect)&&(t.push(["boundingRect",{size:9,data:u.attributeData.boundingRect,
exclusive:!0}]),v.push(["boundingRect",u.indices]));g.isSome(u.attributeData.mapPosition)&&(t.push(["mapPos",{size:3,data:u.attributeData.mapPosition,exclusive:!0}]),v.push(["mapPos",u.indices]));return new d.Geometry(t,v)};a.createWaterGeometry=function(u){const v=[["position",u.indices],["uv0",u.indices]],t=[["position",{size:3,data:u.attributeData.position,exclusive:!0}],["uv0",{size:2,data:u.attributeData.uv0,exclusive:!0}]];g.isSome(u.attributeData.mapPosition)&&(t.push(["mapPos",{size:3,data:u.attributeData.mapPosition,
exclusive:!0}]),v.push(["mapPos",u.indices]));return new d.Geometry(t,v)};a.geometryAsPolygon=function(u){switch(u.type){case "extent":if(u instanceof b)return p.fromExtent(u);break;case "polygon":return u}return null};a.geometryToRenderInfo=function(u,v,t,l){const w=c.pathsToTriangulationInfo(u.rings,u.hasZ,1),y=new Float64Array(w.position.length);u=e.applyPerVertexElevationAlignment(w.position,u.spatialReference,0,y,0,w.position,0,w.position.length/3,v,t,l);v=null!=u;return{position:w.position,
mapPosition:y,polygons:q(w.polygons,w.position,y),outlines:n(w.outlines,w.position,y),projectionSuccess:v,sampledElevation:u}};a.geometryToRenderInfoDraped=function(u,v){const t=c.pathsToTriangulationInfo(u.rings,!1,1);u=k.projectBuffer(t.position,u.spatialReference,0,t.position,v,0,t.position.length/3);for(v=2;v<t.position.length;v+=3)t.position[v]=h.DRAPED_Z;return{position:t.position,polygons:q(t.polygons,t.position),outlines:n(t.outlines,t.position),projectionSuccess:u}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","./coordsUtils","../../core/libs/earcut/earcut","./meshUtils/deduplicate"],function(a,g,b,p){function f(d,e,h){if(1===d.length)return d[0];e=new Float64Array(e);h=new Uint32Array(h);let n=0,q=0,u=0;for(const v of d){for(d=0;d<v.position.length;d++)e[n++]=v.position[d];for(d=0;d<v.faces.length;d++)h[q++]=v.faces[d]+u;u=n/3}return{position:e,faces:h}}function k(d,e,h){const n=d.length,q=Array(n),u=Array(n),
v=Array(n);let t=0,l=0,w=0;var y=0;for(var D=0;D<n;++D)y+=d[D].length;y=new Float64Array(3*y);D=0;for(let A=n-1;0<=A;A--){var z=d[A],r=1===h?!g.isClockwise(z,!1,!1):!1;if(r&&1!==n)q[t++]=z;else{var C=z.length;for(let x=0;x<t;++x)C+=q[x].length;C={index:D,pathLengths:Array(t+1),count:C,holeIndices:Array(t)};C.pathLengths[0]=z.length;0<z.length&&(v[w++]={index:D,count:z.length});D=r?c(z,z.length-1,-1,y,D,z.length,e):c(z,0,1,y,D,z.length,e);for(z=0;z<t;++z)r=q[z],C.holeIndices[z]=D,C.pathLengths[z+1]=
r.length,0<r.length&&(v[w++]={index:D,count:r.length}),D=c(r,0,1,y,D,r.length,e);t=0;0<C.count&&(u[l++]=C)}}for(d=0;d<t;++d)h=q[d],0<h.length&&(v[w++]={index:D,count:h.length}),D=c(h,0,1,y,D,h.length,e);l<n&&(u.length=l);w<n&&(v.length=w);return{position:y,polygons:u,outlines:v}}function c(d,e,h,n,q,u,v){q*=3;for(let t=0;t<u;++t){const l=d[e];n[q++]=l[0];n[q++]=l[1];n[q++]=v?l[2]:0;e+=h}return q/3}a.pathsToTriangulationInfo=k;a.triangulate=function(d){d=k(d.rings,d.hasZ,1);const e=[];let h=0,n=0;
for(var q of d.polygons){const v=q.index,t=new Float64Array(d.position.buffer,3*v*d.position.BYTES_PER_ELEMENT,3*q.count);var u=q.holeIndices.map(l=>l-v);u=new Uint32Array(b.earcut(t,u,3));e.push({position:t,faces:u});h+=t.length;n+=u.length}q=f(e,h,n);d=p.deduplicate(q.position.buffer,6,{originalIndices:q.faces});q.position=new Float64Array(d.buffer);q.faces=d.indices;return q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports",
"../../../core/mathUtils"],function(a,g){function b(f,k,c){var d,e=f.byteLength/(4*k),h=new Uint32Array(f,0,e*k);f=new Uint32Array(e);var n=null!=(d=null==c?void 0:c.minReduction)?d:0;const q=(d=(null==c?void 0:c.originalIndices)||null)?d.length:0;var u=(null==c?void 0:c.componentOffsets)||null;c=0;if(u)for(var v=0;v<u.length-1;v++){var t=u[v+1]-u[v];t>c&&(c=t)}else c=e;var l=Math.floor(1.1*c)+1;if(null==p||p.length<2*l)p=new Uint32Array(g.nextHighestPowerOfTwo(2*l));for(c=0;c<2*l;c++)p[c]=0;c=0;
t=(v=!!u&&!!d)?q:e;var w=v?new Uint32Array(q):null,y=0!==n?Math.ceil(7.84*1.96/(n*n)*n*(1-n)):t,D=1,z=u?u[1]:t;for(var r=0;r<t;r++){if(r===y){var C=1-c/r;if(C+1.96*Math.sqrt(C*(1-C)/r)<n)return null;y*=2}if(r===z){for(z=0;z<2*l;z++)p[z]=0;if(d)for(z=u[D-1];z<u[D];z++)w[z]=f[d[z]];z=u[++D]}C=v?d[r]:r;const B=C*k;var A=0;for(var x=0;x<k;x++)A=h[B+x]+A|0,A=A+(A<<11)+(A>>>2)|0;A>>>=0;x=A%l;let E=c;for(;0!==p[2*x+1];){if(p[2*x]===A){const F=p[2*x+1]-1;var m=F*k;a:{for(let G=0;G<k;G++)if(h[B+G]!==h[m+G]){m=
!1;break a}m=!0}if(m){E=f[F];break}}x++;x>=l&&(x-=l)}E===c&&(p[2*x]=A,p[2*x+1]=C+1,c++);f[C]=E}if(0!==n&&1-c/e<n)return null;if(v){for(e=u[D-1];e<w.length;e++)w[e]=f[d[e]];f=w}e=new Uint32Array(k*c);c=0;for(D=0;D<t;D++)if(f[D]===c){n=h;u=(v?d[D]:D)*k;l=e;w=c*k;y=k;for(r=0;r<y;r++)l[w+r]=n[u+r];c++}if(d&&!v){k=new Uint32Array(q);for(h=0;h<k.length;h++)k[h]=f[d[h]];f=k}return{buffer:e.buffer,indices:f,uniqueCount:c}}let p=null;a.deduplicate=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/Accessor ../../../core/uid ../../../chunks/vec3f64 ../../../core/Handles ../../../core/watchUtils ../../../chunks/mat4 ../../support/Scheduler ../../../core/MapUtils ../../../chunks/vec2f64 ../../webgl/Texture ../../webgl/Util ../webgl-engine/lib/glUtil3D ../webgl-engine/lighting/Lightsources ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/Camera ../support/debugFlags ../webgl-engine/lib/AutoDisposable ./OverlayRenderTarget ./Overlay ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/RenderContext ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/lineStippleUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W){const Y=k.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");a.OverlayRenderer=function(ba){function fa(ma){ma=ba.call(this,ma)||this;ma._overlays=null;ma._hasHighlights=!1;ma._rendersOccluded=!1;ma._hasWater=!1;ma._lighting=new T.SceneLighting;ma._localOrigins=new aa;ma._handles=new y;ma._layerRenderers=new Map;ma._sortedLayerRenderersDirty=!1;ma._sortedLayerRenderers=new v;ma._geometries=new Map;
ma.globalUnitScale=1;ma.longitudeCyclical=null;return ma}g._inheritsLoose(fa,ba);var ia=fa.prototype;ia.initialize=function(){this._rctx=this.renderView.renderingContext;this._renderContext=new S(this._rctx,null,null,null,null,null);this._stippleTextureRepository=new W.StippleTextureRepository;this.waterTextureRepository=this.renderView.waterTextureRepository;this._shaderTechniqueRepository=new Q.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,commonUniformStore:new P.CommonUniformStore,
stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository});D.init(this.waterTextureRepository,"loadingState",()=>this.emitContentChanged());this._materialRepository=new X(this.renderView.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=ma=>{0<(ma.renderOccluded&4)!==this._rendersOccluded&&this.updateRendersOccluded();this.emitContentChanged();this.notifyChange("updating")};this._compositingHelper=this.renderView.compositingHelper;
this._lighting.set({lights:[new E.AmbientLight(w.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0});this._bindParameters={slot:null,highlightDepthTexture:B.createEmptyDepthTexture(this._rctx),camera:ca,inverseViewport:A.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureUnit:0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,
ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!0,multipassGeometryEnabled:!1};this._handles.add(this.scheduler.registerTask(r.Task.STAGE,()=>this.commitChanges(),()=>this.updating))};ia.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(ma=>ma.dispose());this._layerRenderers.clear();this._bindParameters.highlightDepthTexture=f.disposeMaybe(this._bindParameters.highlightDepthTexture);
this._shaderTechniqueRepository=f.disposeMaybe(this._shaderTechniqueRepository);this._temporaryRenderTarget=f.disposeMaybe(this._temporaryRenderTarget);this._debugPatternTexture=f.disposeMaybe(this._debugPatternTexture);this._quadVAO=f.disposeMaybe(this._quadVAO)};ia.forEachOverlay=function(ma){f.isSome(this._overlays)&&(ma(this._overlays[0],0),ma(this._overlays[1],1))};ia.ensureOverlays=function(){if(f.isNone(this._overlays)){const ma=this.renderView.renderingContext;this._overlays=[new L.Overlay(ma),
new L.Overlay(ma)]}};ia.disposeOverlays=function(){f.isSome(this._overlays)&&(this._overlays.forEach(ma=>ma.dispose()),this._overlays=null)};ia.commitChanges=function(){let ma=!1;this._layerRenderers.forEach((ea,M)=>{ea.commitChanges()&&(ma=!0);ea.isEmpty&&(this._layerRenderers.delete(M),this._sortedLayerRenderersDirty=!0,this._handles.remove(M))});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),ma=!0);ma&&(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),
this.updateRendersOccluded(),this.updateHasWater())};ia.addGeometries=function(ma,ea,M){for(const Z of ma)null==Z.origin&&(Z.origin=this._localOrigins.getOrigin(Z.boundingSphere)),f.isNone(Z.id)&&(Z.id=l.generateUID()),this._geometries.set(Z.id,Z);this.ensureLayerRenderer(ea).add(ma);2===M&&this.notifyGraphicGeometryChanged(ma,ea)};ia.removeGeometries=function(ma,ea,M){for(var Z of ma)this._geometries.delete(f.unwrap(Z.id));if(Z=this._layerRenderers.get(ea))Z.remove(ma),2===M&&this.notifyGraphicGeometryChanged(ma,
ea)};ia.updateGeometries=function(ma,ea,M){const Z=this._layerRenderers.get(ea);if(Z)switch(Z.modify(ma,M),M){case 4:case 2:return this.notifyGraphicGeometryChanged(ma,ea);case 1:return this.notifyGraphicVisibilityChanged(ma,ea)}else Y.warn("Attempted to update geometry for nonexistent layer")};ia.notifyGraphicGeometryChanged=function(ma,ea){if(!f.isNone(ea.notifyGraphicGeometryChanged))for(const Z of ma)if(ma=Z.graphicUid,ma!==M){ea.notifyGraphicGeometryChanged(ma);var M=ma}};ia.notifyGraphicVisibilityChanged=
function(ma,ea){if(!f.isNone(ea.notifyGraphicVisibilityChanged))for(const Z of ma)if(ma=Z.graphicUid,ma!==M){ea.notifyGraphicVisibilityChanged(ma);var M=ma}};ia.updateHighlights=function(ma,ea){(ea=this._layerRenderers.get(ea))?ea.modify(ma,8):Y.warn("Attempted to update highlights for nonexistent layer")};ia.isEmpty=function(){return 0===this._geometries.size&&!I.OVERLAY_DRAW_DEBUG_TEXTURE};ia.updateLogic=function(ma){let ea=!1;this._layerRenderers.forEach(M=>{M.updateLogic(ma)&&(ea=!0)});return ea};
ia.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};ia.drawPass=function(ma,ea,M,Z=0){if(0===M.numViews)return!1;this._screenToWorldRatio=M.pixelRatio*Math.abs(M.views[0].extent[2]-M.views[0].extent[0])/Math.abs(M.views[0].viewport[2]-M.views[0].viewport[0]);if(this.isEmpty()||5===ma&&!this.hasHighlights||3===ma&&!this.hasWater||!this.hasNonZeroSizedView(M))return!1;const la=M.width,ka=M.height;if(!ea.isValid())return!1;ea.resize(la,ka);const ha=this._rctx;ca.pixelRatio=M.pixelRatio||
1;this._renderContext.pass=ma;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale;ea.bind(ha);ha.setClearColor(0,0,0,0);ha.clearSafe(16384);1===Z&&(this._renderContext.renderOccludedMask=4);if(I.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==Z)for(let na=0;na<M.numViews;na++)this.setViewParameters(M.views[na],ca),this.drawDebugTexture(la,ka,N[M.index%N.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({layerView:na,
renderer:da})=>{if(2!==Z||!f.isSome(na)||0!==na.drapeSourceType){var oa=f.isSome(na)&&f.isSome(na.fullOpacity)&&1>na.fullOpacity&&0===ma;oa&&(this.bindTemporaryFramebuffer(this._rctx,la,ka),ha.clearSafe(16384));for(let qa=0;qa<M.numViews;qa++)this.setViewParameters(M.views[qa],ca),da.draw(this._renderContext,this._bindParameters);oa&&f.isSome(this._temporaryRenderTarget)&&(ea.bind(ha),this._compositingHelper.composite(this._temporaryRenderTarget.getTexture(),2,f.unwrap(f.unwrap(na).fullOpacity)))}});
ha.bindFramebuffer(null);ea.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};ia.bindTemporaryFramebuffer=function(ma,ea,M){f.isNone(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new J.OverlayRenderTarget(ma,!1));this._temporaryRenderTarget.resize(ea,M);this._temporaryRenderTarget.bind(ma)};ia.reloadShaders=async function(){await this._shaderTechniqueRepository.hotReload()};ia.intersect=function(ma,ea,M){let Z=0;this._geometries.forEach(la=>{if(!M||M(la)){this.intersectRenderGeometry(la,
ea,0,ma,Z);var ka=this.longitudeCyclical;ka&&(la.boundingSphere[0]-la.boundingSphere[3]<ka.min&&this.intersectRenderGeometry(la,ea,ka.range,ma,Z),la.boundingSphere[0]+la.boundingSphere[3]>ka.max&&this.intersectRenderGeometry(la,ea,-ka.range,ma,Z));Z++}})};ia.intersectRenderGeometry=function(ma,ea,M,Z,la){if(ma.instanceParameters.visible){var ka=0;f.isSome(ma.transformation)&&(M+=ma.transformation[12],ka=ma.transformation[13]);O[0]=ea[0]-M;O[1]=ea[1]-ka;O[2]=1;V[0]=ea[0]-M;V[1]=ea[1]-ka;V[2]=0;ma.screenToWorldRatio=
this._screenToWorldRatio;ma.material.intersect(ma,null,ma.getShaderTransformation(),Z,O,V,(ha,na,da)=>{this.addIntersectionResult(da,ma.material.renderPriority,la,Z,ma.layerUid,ma.graphicUid)},ma.calculateShaderTransformation,!0)}};ia.addIntersectionResult=function(ma,ea,M,Z,la,ka){const ha={type:"external",metadata:{layerUid:la,graphicUid:ka}};la=na=>{na.set(ha,null,Z.results.ground.dist,Z.results.ground.normal,Z.results.ground.transformation,ea,null,null,ma,M);na.intersector="OverlayRenderer"};
(null==Z.results.min.drapedLayerOrder||ea>=Z.results.min.drapedLayerOrder)&&(null==Z.results.min.dist||Z.results.ground.dist<=Z.results.min.dist)&&la(Z.results.min);0!==Z.options.store&&(null==Z.results.max.drapedLayerOrder||ea<Z.results.max.drapedLayerOrder)&&(null==Z.results.max.dist||Z.results.ground.dist>Z.results.max.dist)&&la(Z.results.max);2===Z.options.store&&(ka=new F.IntersectorResult(Z.ray),la(ka),Z.results.all.push(ka))};ia.stopAnimationsAtTime=function(ma){this._sortedLayerRenderers.forAll(ea=>
ea.renderer.stopAnimationsAtTime(ma))};ia.ensureLayerRenderer=function(ma){let ea=this._layerRenderers.get(ma);ea||(ea=new H.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(ma,ea),this._sortedLayerRenderersDirty=!0,"fullOpacity"in ma&&this._handles.add(ma.watch("fullOpacity",()=>this.emitContentChanged()),ma),this._handles.add(D.init(ea,"updating",()=>this.notifyChange("updating")),ma));return ea};ia.updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&
(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var [{view:{allLayerViews:ma}}]=this._layerRenderers.keys(),ea=new Set(this._layerRenderers.values());ma.forEach(M=>{const Z=this._layerRenderers.get(M);Z&&(this._sortedLayerRenderers.push(new U(M,Z)),ea.delete(Z))});ea.forEach(M=>{this._sortedLayerRenderers.push(new U(null,M))})}};ia.setViewParameters=function(ma,ea){ea.viewport=ma.viewport;const M=ma.extent;z.ortho(ea.projectionMatrix,0,M[2]-M[0],
0,M[3]-M[1],ea.near,ea.far);z.identity(ea.viewMatrix);z.translate(ea.viewMatrix,ea.viewMatrix,[-ma.extent[0],-ma.extent[1],0]);ea.setGLViewport(this._rctx);this._renderContext.camera=ea;this._bindParameters.camera=ea;this._bindParameters.inverseViewport[0]=1/ea.fullViewport[2];this._bindParameters.inverseViewport[1]=1/ea.fullViewport[3]};ia.hasNonZeroSizedView=function(ma){for(let ea=0;ea<ma.numViews;ea++){const M=ma.views[ea];if(M.extent[0]!==M.extent[2]&&M.extent[1]!==M.extent[3])return!0}return!1};
ia.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};ia.updateHasWater=function(){const ma=C.someMap(this._layerRenderers,ea=>ea.hasWater);ma!==this._hasWater&&(this._hasWater=ma)};ia.updateHasHighlights=function(){const ma=C.someMap(this._layerRenderers,ea=>ea.hasHighlights);if(ma!==this._hasHighlights&&(this._hasHighlights=ma,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};ia.updateRendersOccluded=function(){const ma=C.someMap(this._layerRenderers,
ea=>ea.rendersOccluded);if(ma!==this._rendersOccluded&&(this._rendersOccluded=ma,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};ia.drawDebugTexture=function(ma,ea,M){const Z=this._rctx;this.ensureDebugPatternResources(ma,ea);ma=this._debugTextureTechnique.program;Z.bindProgram(ma);Z.setPipelineState(this._debugTextureTechnique.pipeline);ma.setUniform4f("color",M[0],M[1],M[2],1);ma.setUniform1i("tex",0);Z.bindTexture(this._debugPatternTexture,0);Z.bindVAO(this._quadVAO);
Z.drawArrays(5,0,m.vertexCount(this._quadVAO,"geometry"))};ia.ensureDebugPatternResources=function(ma,ea){if(!this._debugPatternTexture){var M=new Uint8Array(ma*ea*4),Z=0;for(let la=0;la<ea;la++)for(let ka=0;ka<ma;ka++){const ha=Math.floor(ka/10),na=Math.floor(la/10);2>ha||2>na||10*ha>ma-20||10*na>ea-20?(M[Z++]=255,M[Z++]=255,M[Z++]=255,M[Z++]=255):(M[Z++]=255,M[Z++]=255,M[Z++]=255,ha&1&&na&1?M[Z++]=ka&1^la&1?0:255:M[Z++]=ha&1^na&1?0:128)}this._debugPatternTexture=new x(this._rctx,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,width:ma,height:ea},M);ma=new R.TextureTechniqueConfiguration;ma.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(R.TextureTechnique,ma,this._debugTextureTechnique);this._quadVAO=B.createQuadVAO(this._rctx)}};g._createClass(fa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||C.someMap(this._layerRenderers,ma=>ma.updating)||this.waterTextureRepository.updating}},{key:"hasOverlays",get:function(){return f.isSome(this._overlays)}},
{key:"gpuMemoryUsage",get:function(){return f.isSome(this._overlays)?this._overlays[0].getGpuMemoryUsage()+this._overlays[1].getGpuMemoryUsage():0}},{key:"overlays",get:function(){return this._overlays}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);return fa}(K.AutoDisposableMixin(t));
b.__decorate([K.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);b.__decorate([K.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);b.__decorate([d.property(),K.autoDispose()],a.OverlayRenderer.prototype,"waterTextureRepository",void 0);b.__decorate([d.property({constructOnly:!0})],a.OverlayRenderer.prototype,"renderView",void 0);b.__decorate([d.property({constructOnly:!0})],a.OverlayRenderer.prototype,"scheduler",void 0);b.__decorate([d.property()],
a.OverlayRenderer.prototype,"globalUnitScale",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=b.__decorate([h.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);let U=function(ba,fa){this.layerView=ba;this.renderer=fa};const N=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],ca=new G;ca.near=1;ca.far=1E4;ca.relativeElevation=null;const O=w.create(),V=w.create();a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=4;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../../core/maybe ../../../core/uid ../../webgl/Program ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ../../webgl/Renderbuffer ../../webgl/FramebufferObject ../../webgl/ProgramCache ../../webgl/RenderingContext ../../webgl/ShaderCompiler".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q,u){p=function(){function v(l,w){this.id=b.generateUID();this._renderTarget=
null;this._renderTarget=new h(l,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:w,maxAnisotropy:8,width:0,height:0})}var t=v.prototype;t.dispose=function(){this._renderTarget=g.disposeMaybe(this._renderTarget)};t.getTexture=function(){return this._renderTarget?this._renderTarget.colorTexture:null};t.isValid=function(){return null!==this._renderTarget};t.resize=function(l,w){this._renderTarget.resize(l,w)};t.bind=function(l){l.bindFramebuffer(this._renderTarget)};
t.generateMipMap=function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()};t.disposeRenderTargetMemory=function(){this._renderTarget&&this._renderTarget.resize(0,0)};t.getGpuMemoryUsage=function(){let l=0;this._renderTarget&&(l+=c.getGpuMemoryUsage(this._renderTarget));return l};return v}();a.OverlayRenderTarget=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Renderbuffer":function(){define(["../../chunks/_rollupPluginBabelHelpers"],
function(a){return function(){function g(p,f){this._context=p;this._desc=f;this._context.instanceCounter.increment(5,this);p=this._context.gl;this.glName=p.createRenderbuffer();this._context.bindRenderbuffer(this);p.renderbufferStorage(p.RENDERBUFFER,f.internalFormat,f.width,f.height)}var b=g.prototype;b.resize=function(p,f){const k=this._desc;if(k.width!==p||k.height!==f)k.width=p,k.height=f,p=this._context.gl,this._context.bindRenderbuffer(this),p.renderbufferStorage(p.RENDERBUFFER,k.internalFormat,
k.width,k.height)};b.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(5,this),this._context=null)};a._createClass(g,[{key:"descriptor",get:function(){return this._desc}}]);return g}()})},"esri/views/webgl/FramebufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/Logger","./Texture","./Renderbuffer"],function(a,g,b,p,f){const k=b.getLogger("esri.views.webgl.FrameBufferObject");
g=function(){function c(e,h,n,q){this._context=e;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;this._initialized=!1;this._desc={...h};e.instanceCounter.increment(4,this);if(n)if(Array.isArray(n))for(const t of n){const {attachmentPoint:l,texture:w}=t;n=w instanceof p?w:new p(e,w);h=n.descriptor;this._colorAttachments.set(l,n);this._validateColorAttachmentPoint(l);this._validateTextureDimensions(h,this._desc)}else{var u;n instanceof p?(h=n.descriptor,
this._colorAttachments.set(36064,n)):(h=n,this._colorAttachments.set(36064,new p(e,n)));0!==(null==(u=this._desc)?void 0:u.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!");this._validateTextureDimensions(h,this._desc)}if(q instanceof f){var v;e=null!=(v=this._desc.depthStencilTarget)?v:3;2===e?this._stencilAttachment=q:1===e||3===e?this._depthAttachment=q:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');
c._validateBufferDimensions(q.descriptor,this._desc)}else q&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),q instanceof p?(this._depthStencilTexture=q,q=this._depthStencilTexture.descriptor):this._depthStencilTexture=new p(this._context,q),this._validateTextureDimensions(q,this._desc))}var d=c.prototype;d.dispose=function(){if(this._desc){var e=this._context.getBoundFramebufferObject();
this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(e);this._context.instanceCounter.decrement(4,this);this._desc=null}};d.getColorTexture=function(e){return(e=this._colorAttachments.get(e))&&e instanceof p?e:null};d.attachColorTexture=function(e,h=36064){if(e){this._validateColorAttachmentPoint(h);this._validateTextureDimensions(e.descriptor,this._desc);this._disposeColorAttachments();
if(this._initialized){this._context.bindFramebuffer(this);const n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_2D,e.glName,0)}this._colorAttachments.set(h,e)}};d.detachColorTexture=function(e=36064){const h=this._colorAttachments.get(e);if(h instanceof p){if(this._initialized){this._context.bindFramebuffer(this);const n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,e,n.TEXTURE_2D,null,0)}this._colorAttachments.delete(e);return h}};d.attachDepthStencilTexture=function(e){if(e){var h=
e.descriptor;34041!==h.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==h.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDimensions(h,this._desc);this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=
4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),h=this._context.gl,h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.TEXTURE_2D,e.glName,0));this._depthStencilTexture=e}};d.detachDepthStencilTexture=function(){const e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);const h=this._context.gl;this._context.gl.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.TEXTURE_2D,null,0)}this._depthStencilTexture=
null;return e};d.attachDepthStencilBuffer=function(e){if(e){var h=e.descriptor;34041!==h.internalFormat&&33189!==h.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");c._validateBufferDimensions(h,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===h.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),h=this._context.gl,h.framebufferRenderbuffer(h.FRAMEBUFFER,1===this._desc.depthStencilTarget?h.DEPTH_ATTACHMENT:
h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,e.glName));this._depthAttachment=e}};d.detachDepthStencilBuffer=function(){const e=this._context.gl,h=this._depthAttachment;h&&this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,null));this._depthAttachment=null;return h};d.copyToTexture=function(e,h,n,q,u,v,t){(0>e||0>h||0>u||0>v)&&console.error("Offsets cannot be negative!");
(0>=n||0>=q)&&console.error("Copy width and height must be greater than zero!");var l=this._desc;const w=t.descriptor;3553!==t.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(e+n>l.width||h+q>l.height||u+n>w.width||v+q>w.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");l=this._context;l.bindTexture(t,0);l.bindFramebuffer(this);l.gl.copyTexSubImage2D(3553,0,u,v,e,h,n,q)};d.readPixels=function(e,h,n,q,u,v,t){(0>=n||
0>=q)&&console.error("Copy width and height must be greater than zero!");t||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(e,h,n,q,u,v,t)};d.resize=function(e,h){const n=this._desc;if(n.width!==e||n.height!==h)if(this._initialized){n.width=e;n.height=h;this._colorAttachments.forEach(q=>{q&&q.resize(e,h)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(e,h);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&
this._depthAttachment.resize(e,h),this._stencilAttachment&&this._stencilAttachment.resize(e,h);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else n.width=e,n.height=h,this._colorAttachments.forEach(q=>{q&&q.resize(e,h)}),this._depthStencilTexture&&this._depthStencilTexture.resize(e,h)};d.initializeAndBind=function(){var e,h,n,q;const u=this._context.gl;if(this._initialized)u.bindFramebuffer(u.FRAMEBUFFER,this.glName);else{this._glName&&
u.deleteFramebuffer(this._glName);var v=this._context,t=u.createFramebuffer(),l=this._desc,w=null!=(e=l.colorTarget)?e:1;e=null!=(h=l.width)?h:1;h=null!=(n=l.height)?n:1;u.bindFramebuffer(u.FRAMEBUFFER,t);0===this._colorAttachments.size&&(0===w?this._colorAttachments.set(36064,new p(v,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:l.width,height:l.height})):(n=new f(v,{internalFormat:32854,width:e,height:h}),this._colorAttachments.set(36064,n)));this._colorAttachments.forEach((y,
D)=>{y&&(y instanceof p?u.framebufferTexture2D(u.FRAMEBUFFER,D,u.TEXTURE_2D,y.glName,0):u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,y.glName))});n=null!=(q=l.depthStencilTarget)?q:0;switch(n){case 1:case 3:this._depthAttachment||(this._depthAttachment=new f(v,{internalFormat:1===l.depthStencilTarget?33189:34041,width:e,height:h}));u.framebufferRenderbuffer(u.FRAMEBUFFER,1===n?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,this._depthAttachment.glName);
break;case 2:this._stencilAttachment||(this._stencilAttachment=new f(v,{internalFormat:36168,width:e,height:h}));u.framebufferRenderbuffer(u.FRAMEBUFFER,u.STENCIL_ATTACHMENT,u.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(v.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new p(v,{target:3553,pixelFormat:34041,dataType:34042,
samplingMode:9728,wrapMode:33071,width:e,height:h})),u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,this._depthStencilTexture.glName,0)}this._glName=t;this._initialized=!0}};d._disposeColorAttachments=function(){this._colorAttachments.forEach((e,h)=>{if(e instanceof p){if(this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,h,n.TEXTURE_2D,null,0)}e.dispose()}else e instanceof WebGLRenderbuffer&&(n=this._context.gl,
this._initialized&&(this._context.bindFramebuffer(this),n.framebufferRenderbuffer(n.FRAMEBUFFER,h,n.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(e))});this._colorAttachments.clear()};d._disposeDepthStencilAttachments=function(){const e=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};c._validateBufferDimensions=
function(e,h){console.assert(0<=e.width&&0<=e.height);void 0!==h.width&&0<=h.width&&void 0!==h.height&&0<=h.height?h.width===e.width&&h.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(h.width=e.width,h.height=e.height)};d._validateTextureDimensions=function(e,h){console.assert(0<=e.width&&0<=e.height);3553!==e.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==h.width&&0<=h.width&&void 0!==h.height&&0<=h.height?h.width===e.width&&h.height===
e.height||console.error("Color attachment texture must match the framebuffer's!"):(h.width=e.width,h.height=e.height)};d._validateColorAttachmentPoint=function(e){if(-1===c._MAX_COLOR_ATTACHMENTS){const h=this._context.capabilities.drawBuffers;c._MAX_COLOR_ATTACHMENTS=h?this._context.gl.getParameter(h.MAX_COLOR_ATTACHMENTS):1}e-=36064;e+1>c._MAX_COLOR_ATTACHMENTS&&k.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${c._MAX_COLOR_ATTACHMENTS} color attachments`)};
a._createClass(c,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const e=this._colorAttachments.get(36064);return e&&e instanceof p?e:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(36064)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},
{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}}]);return c}();g._MAX_COLOR_ATTACHMENTS=-1;return g})},"esri/views/webgl/ProgramCache":function(){define(["./programUtils"],function(a){return function(){function g(p){this._programCacheByTemplate=new Map;this._rctx=p}var b=g.prototype;b.dispose=function(){this._programCacheByTemplate.forEach(p=>{p.programs.forEach(f=>{f.dispose()})});this._programCacheByTemplate=null};b.getProgram=function(p,
f){this._programCacheByTemplate.has(p)||this.addProgramTemplate(p,k=>a.createProgram(this._rctx,p,k));return this.getProgramTemplateInstance(p,f)};b.addProgramTemplate=function(p,f){this._programCacheByTemplate.set(p,{constructor:f,programs:new Map})};b.getProgramTemplateInstance=function(p,f){if(p=this._programCacheByTemplate.get(p)){const k=f?JSON.stringify(f):"default";p.programs.has(k)||(f=p.constructor(f),p.programs.set(k,f));return p.programs.get(k)}return null};return g}()})},"esri/views/webgl/programUtils":function(){define(["exports",
"./Program"],function(a,g){a.createProgram=function(b,p,f,k){f=f||{};k=k||"";f="function"===typeof p.shaders?p.shaders(f):p.shaders;return new g(b,k+f.vertexShader,k+f.fragmentShader,p.attributes)};a.glslifyDefineMap=function(b){let p="";for(const f in b){const k=b[f];if("boolean"===typeof k)k&&(p+=`#define ${f}\n`);else if("number"===typeof k)p+=`#define ${f} ${k.toFixed()}\n`;else if("object"===typeof k){const c=k.options;let d=0;for(const e in c)p+=`#define ${c[e]} ${(d++).toFixed()}\n`;p+=`#define ${f} ${c[k.value]}\n`}}return p};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./renderState ./capabilities/isWebGL2Context ./enums ./InstanceCounter ./capabilities/load".split(" "),function(a,g,b,p,f,k,c,d){function e(h,n,q,u){n?u!==n&&h.bindBuffer(q,n.glName):h.bindBuffer(q,null);return n}return function(){function h(q,u){this.gl=null;this.instanceCounter=new c.InstanceCounter;this._blendEnabled=!1;
this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=
this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=[];this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=
f(q)?"webgl2":"webgl";this.gl=q;q instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=d.loadCapabilities(q,u);q=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:q[0],y:q[1],width:q[2],height:q[3]};this._stateTracker=new p.StateTracker({setBlending:v=>{v?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(v.opRgb,v.opAlpha),this.setBlendFunctionSeparate(v.srcRgb,v.dstRgb,v.srcAlpha,v.dstAlpha),v=v.color,this.setBlendColor(v.r,v.g,v.b,v.a)):
this.setBlendingEnabled(!1)},setCulling:v=>{v?(this.setFaceCullingEnabled(!0),this.setCullFace(v.face),this.setFrontFace(v.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:v=>{v?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(v.factor,v.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:v=>{v?(this.setDepthTestEnabled(!0),this.setDepthFunction(v.func)):this.setDepthTestEnabled(!1)},setStencilTest:v=>{if(v){this.setStencilTestEnabled(!0);const t=v.function;this.setStencilFunction(t.func,
t.ref,t.mask);v=v.operation;this.setStencilOp(v.fail,v.zFail,v.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:v=>{v?(this.setDepthWriteEnabled(!0),this.setDepthRange(v.zNear,v.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:v=>{v?this.setColorMask(v.r,v.g,v.b,v.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:v=>{v?this.setStencilWriteMask(v.mask):this.setStencilWriteMask(0)}});this.enforceState()}var n=h.prototype;n.isWebGL2Context=function(){return"webgl2"===this.contextVersion};
n.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap=[];this._capabilities=this.gl=null};n.setPipelineState=function(q){this._stateTracker.setPipeline(q)};n.setBlendingEnabled=function(q){this._blendEnabled!==q&&(!0===q?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=q,this._stateTracker.invalidateBlending())};n.setBlendColor=function(q,u,v,t){if(q!==this._blendColorState.r||u!==this._blendColorState.g||v!==
this._blendColorState.b||t!==this._blendColorState.a)this.gl.blendColor(q,u,v,t),this._blendColorState.r=q,this._blendColorState.g=u,this._blendColorState.b=v,this._blendColorState.a=t,this._stateTracker.invalidateBlending()};n.setBlendFunction=function(q,u){if(q!==this._blendFunctionState.srcRGB||u!==this._blendFunctionState.dstRGB)this.gl.blendFunc(q,u),this._blendFunctionState.srcRGB=q,this._blendFunctionState.srcAlpha=q,this._blendFunctionState.dstRGB=u,this._blendFunctionState.dstAlpha=u,this._stateTracker.invalidateBlending()};
n.setBlendFunctionSeparate=function(q,u,v,t){if(this._blendFunctionState.srcRGB!==q||this._blendFunctionState.srcAlpha!==v||this._blendFunctionState.dstRGB!==u||this._blendFunctionState.dstAlpha!==t)this.gl.blendFuncSeparate(q,u,v,t),this._blendFunctionState.srcRGB=q,this._blendFunctionState.srcAlpha=v,this._blendFunctionState.dstRGB=u,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending()};n.setBlendEquation=function(q){this._blendEquationState.mode!==q&&(this.gl.blendEquation(q),
this._blendEquationState.mode=q,this._blendEquationState.modeAlpha=q,this._stateTracker.invalidateBlending())};n.setBlendEquationSeparate=function(q,u){if(this._blendEquationState.mode!==q||this._blendEquationState.modeAlpha!==u)this.gl.blendEquationSeparate(q,u),this._blendEquationState.mode=q,this._blendEquationState.modeAlpha=u,this._stateTracker.invalidateBlending()};n.setColorMask=function(q,u,v,t){if(this._colorMaskState.r!==q||this._colorMaskState.g!==u||this._colorMaskState.b!==v||this._colorMaskState.a!==
t)this.gl.colorMask(q,u,v,t),this._colorMaskState.r=q,this._colorMaskState.g=u,this._colorMaskState.b=v,this._colorMaskState.a=t,this._stateTracker.invalidateColorWrite()};n.setClearColor=function(q,u,v,t){if(this._clearColor.r!==q||this._clearColor.g!==u||this._clearColor.b!==v||this._clearColor.a!==t)this.gl.clearColor(q,u,v,t),this._clearColor.r=q,this._clearColor.g=u,this._clearColor.b=v,this._clearColor.a=t};n.setFaceCullingEnabled=function(q){this._polygonCullingEnabled!==q&&(!0===q?this.gl.enable(this.gl.CULL_FACE):
this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=q,this._stateTracker.invalidateCulling())};n.setPolygonOffsetFillEnabled=function(q){this._polygonOffsetFillEnabled!==q&&(!0===q?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=q,this._stateTracker.invalidatePolygonOffset())};n.setPolygonOffset=function(q,u){if(this._polygonOffset[0]!==q||this._polygonOffset[1]!==u)this._polygonOffset[0]=q,this._polygonOffset[1]=u,
this.gl.polygonOffset(q,u),this._stateTracker.invalidatePolygonOffset()};n.setCullFace=function(q){this._cullFace!==q&&(this.gl.cullFace(q),this._cullFace=q,this._stateTracker.invalidateCulling())};n.setFrontFace=function(q){this._frontFace!==q&&(this.gl.frontFace(q),this._frontFace=q,this._stateTracker.invalidateCulling())};n.setScissorTestEnabled=function(q){this._scissorTestEnabled!==q&&(!0===q?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=
q)};n.setScissorRect=function(q,u,v,t){if(this._scissorRect.x!==q||this._scissorRect.y!==u||this._scissorRect.width!==v||this._scissorRect.height!==t)this.gl.scissor(q,u,v,t),this._scissorRect.x=q,this._scissorRect.y=u,this._scissorRect.width=v,this._scissorRect.height=t};n.setDepthTestEnabled=function(q){this._depthTestEnabled!==q&&(!0===q?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=q,this._stateTracker.invalidateDepthTest())};n.setClearDepth=function(q){this._clearDepth!==
q&&(this.gl.clearDepth(q),this._clearDepth=q)};n.setDepthFunction=function(q){this._depthFunction!==q&&(this.gl.depthFunc(q),this._depthFunction=q,this._stateTracker.invalidateDepthTest())};n.setDepthWriteEnabled=function(q){this._depthWriteEnabled!==q&&(this.gl.depthMask(q),this._depthWriteEnabled=q,this._stateTracker.invalidateDepthWrite())};n.setDepthRange=function(q,u){if(this._depthRange.zNear!==q||this._depthRange.zFar!==u)this.gl.depthRange(q,u),this._depthRange.zNear=q,this._depthRange.zFar=
u,this._stateTracker.invalidateDepthWrite()};n.setStencilTestEnabled=function(q){this._stencilTestEnabled!==q&&(!0===q?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=q,this._stateTracker.invalidateStencilTest())};n.setClearStencil=function(q){q!==this._clearStencil&&(this.gl.clearStencil(q),this._clearStencil=q)};n.setStencilFunction=function(q,u,v){if(this._stencilFunction.func!==q||this._stencilFunction.ref!==u||this._stencilFunction.mask!==v)this.gl.stencilFunc(q,
u,v),this._stencilFunction.face=1032,this._stencilFunction.func=q,this._stencilFunction.ref=u,this._stencilFunction.mask=v,this._stateTracker.invalidateStencilTest()};n.setStencilFunctionSeparate=function(q,u,v,t){if(this._stencilFunction.face!==q||this._stencilFunction.func!==u||this._stencilFunction.ref!==v||this._stencilFunction.mask!==t)this.gl.stencilFuncSeparate(q,u,v,t),this._stencilFunction.face=q,this._stencilFunction.func=u,this._stencilFunction.ref=v,this._stencilFunction.mask=t,this._stateTracker.invalidateStencilTest()};
n.setStencilWriteMask=function(q){this._stencilWriteMask!==q&&(this.gl.stencilMask(q),this._stencilWriteMask=q,this._stateTracker.invalidateStencilWrite())};n.setStencilOp=function(q,u,v){if(this._stencilOperation.fail!==q||this._stencilOperation.zFail!==u||this._stencilOperation.zPass!==v)this.gl.stencilOp(q,u,v),this._stencilOperation.face=1032,this._stencilOperation.fail=q,this._stencilOperation.zFail=u,this._stencilOperation.zPass=v,this._stateTracker.invalidateStencilTest()};n.setStencilOpSeparate=
function(q,u,v,t){if(this._stencilOperation.face!==q||this._stencilOperation.fail!==u||this._stencilOperation.zFail!==v||this._stencilOperation.zPass!==t)this.gl.stencilOpSeparate(q,u,v,t),this._stencilOperation.face=q,this._stencilOperation.face=q,this._stencilOperation.fail=u,this._stencilOperation.zFail=v,this._stencilOperation.zPass=t,this._stateTracker.invalidateStencilTest()};n.setActiveTexture=function(q){const u=this._activeTextureUnit;0<=q&&q!==this._activeTextureUnit&&(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+
q),this._activeTextureUnit=q);return u};n.clear=function(q){q&&this.gl.clear(q)};n.clearSafe=function(q,u=255){q&&(q&16384&&this.setColorMask(!0,!0,!0,!0),q&256&&this.setDepthWriteEnabled(!0),q&1024&&this.setStencilWriteMask(u),this.gl.clear(q))};n.drawArrays=function(q,u,v){this.gl.drawArrays(q,u,v)};n.drawElements=function(q,u,v,t){5123===v?this.gl.drawElements(q,u,v,t):5125===v&&this.gl.drawElements(q,u,v,t)};n.logIno=function(){};n.setViewport=function(q,u,v,t){const l=this._viewport;if(l.x!==
q||l.y!==u||l.width!==v||l.height!==t)l.x=q,l.y=u,l.width=v,l.height=t,this.gl.viewport(q,u,v,t)};n.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};n.bindProgram=function(q){q?this._activeShaderProgram!==q&&(q.initialize(),this.gl.useProgram(q.glName),this._activeShaderProgram=q):(this.gl.useProgram(null),this._activeShaderProgram=null)};n.bindTexture=function(q,u){(u>=this.parameters.maxTextureImageUnits||0>u)&&console.error("Input texture unit is out of range of available units!");
const v=this._textureUnitMap[u];this.setActiveTexture(u);null==q||null==q.glName?(null!=v&&this.gl.bindTexture(v.descriptor.target,null),this._textureUnitMap[u]=null):v===q?q.applyChanges():(this.gl.bindTexture(q.descriptor.target,q.glName),q.applyChanges(),this._textureUnitMap[u]=q)};n.unbindTextureAllUnits=function(q){for(let u=0;u<this.parameters.maxTextureImageUnits;u++)this._textureUnitMap[u]===q&&this.bindTexture(null,u)};n.bindFramebuffer=function(q){b.isNone(q)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,
null),this._activeFramebuffer=null):this._activeFramebuffer!==q&&(q.initializeAndBind(),this._activeFramebuffer=q)};n.bindBuffer=function(q){q&&(34962===q.bufferType?this._activeVertexBuffer=e(this.gl,q,q.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e(this.gl,q,q.bufferType,this._activeIndexBuffer))};n.bindRenderbuffer=function(q){const u=this.gl;q||(u.bindRenderbuffer(u.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==q&&(u.bindRenderbuffer(u.RENDERBUFFER,
q.glName),this._activeRenderbuffer=q)};n.unbindBuffer=function(q){34962===q?this._activeVertexBuffer=e(this.gl,null,q,this._activeVertexBuffer):this._activeIndexBuffer=e(this.gl,null,q,this._activeIndexBuffer)};n.bindVAO=function(q){q?this._activeVertexArrayObject&&this._activeVertexArrayObject===q||(q.bind(),this._activeVertexArrayObject=q):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};n.getBoundTexture=function(q){return this._textureUnitMap[q]};
n.getBoundFramebufferObject=function(){return this._activeFramebuffer};n.getBoundVAO=function(){return this._activeVertexArrayObject};n.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(let q=0;q<this.parameters.maxTextureImageUnits;q++)this.bindTexture(null,q);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);
this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);
this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};n.enforceState=function(){const q=this.gl;var u=this.capabilities.vao;u&&u.bindVertexArray(null);for(var v=0;v<this.parameters.maxVertexAttributes;v++)q.disableVertexAttribArray(v);this._activeVertexBuffer?q.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):q.bindBuffer(34962,null);this._activeIndexBuffer?q.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):
q.bindBuffer(34963,null);if(u&&this._activeVertexArrayObject){if(u=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(u)}q.bindFramebuffer(q.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);q.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);q.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);q.bindRenderbuffer(q.RENDERBUFFER,
this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?q.enable(this.gl.BLEND):q.disable(this.gl.BLEND);q.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);q.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);q.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);q.clearDepth(this._clearDepth);q.clearStencil(this._clearStencil);
q.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);q.cullFace(this._cullFace);q.depthFunc(this._depthFunction);q.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST);q.depthMask(this._depthWriteEnabled);q.frontFace(this._frontFace);q.lineWidth(1);!0===this._polygonCullingEnabled?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE);q.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);
!0===this._polygonOffsetFillEnabled?q.enable(q.POLYGON_OFFSET_FILL):q.disable(q.POLYGON_OFFSET_FILL);q.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?q.enable(q.SCISSOR_TEST):q.disable(q.SCISSOR_TEST);q.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);q.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);
!0===this._stencilTestEnabled?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST);q.stencilMask(this._stencilWriteMask);for(u=0;u<this.parameters.maxTextureImageUnits;u++)q.activeTexture(k.BASE_TEXTURE_UNIT+u),q.bindTexture(3553,null),(v=this._textureUnitMap[u])&&q.bindTexture(v.descriptor.target,v.glName);q.activeTexture(k.BASE_TEXTURE_UNIT+this._activeTextureUnit);q.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._createClass(h,[{key:"contextAttributes",
get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){if(!this._parameters){const q=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:q?this.gl.getParameter(q.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),
maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return h}()})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.BASE_TEXTURE_UNIT=33984;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(){this._current=[];this._max=[];for(this._allocations=
new Map;6>this._current.length;)this._current.push(0),this._max.push(0)}var f=p.prototype;f.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};f.increment=function(k,c){c=++this._current[k];this._max[k]=Math.max(c,this._max[k])};f.decrement=function(k,c){--this._current[k]};f.printResourceCount=function(){console.log("Live objects:");console.log(`Textures: ${this._current[0]}`);console.log(`Buffers: ${this._current[1]}`);console.log(`VAOs: ${this._current[2]}`);
console.log(`Programs: ${this._current[3]}`);console.log(`Framebuffers: ${this._current[4]}`);console.log(`Renderbuffers: ${this._current[5]}`);if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const k=new Map;this._allocations.forEach(c=>{var d;k.set(c,(null!=(d=k.get(c))?d:0)+1)});k.forEach((c,d)=>console.log(c," : ",d))}};g._createClass(p,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}}]);return p}();
a.InstanceCounter=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/load":function(){define("exports ./isWebGL2Context ./DisjointTimerQuery ./DrawBuffers ./Instancing ./LoseContext ./VertexArrayObjects".split(" "),function(a,g,b,p,f,k,c){function d(e,h,n,q,u){if(q&&g(e))return!0;if(h[n])return!1;for(const v of u)if(e.getExtension(v))return!0;return!1}a.loadCapabilities=function(e,h){const n=h&&h.disabledExtensions||{},q=h&&h.debugWebGLExtensions||{};let u,v,t,l,
w,y,D,z,r,C,A,x=null,m=null,B=null,E=null;return{get drawBuffers(){A||(A=p.load(e,n));return A},get instancing(){u||(u=f.load(e));return u},get vao(){v||(v=c.load(e,n));return v},get compressedTextureETC(){if(!t)if(n.compressedTextureETC)t=null;else{var F=e.getExtension("WEBGL_compressed_texture_etc");t=F?{COMPRESSED_R11_EAC:F.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:F.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:F.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:F.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:F.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:F.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:F.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}return t},get compressedTextureS3TC(){if(!l)if(n.compressedTextureS3TC)l=null;else{var F=e.getExtension("WEBGL_compressed_texture_s3tc");l=F?{COMPRESSED_RGB_S3TC_DXT1:F.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:F.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:F.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:F.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return l},get textureFilterAnisotropic(){if(!w)if(n.textureFilterAnisotropic)w=null;else{var F=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");w=F?{MAX_TEXTURE_MAX_ANISOTROPY:F.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:F.TEXTURE_MAX_ANISOTROPY_EXT}:
null}return w},get disjointTimerQuery(){y||(y=b.createDisjointTimerQuery(e,n));return y},get textureFloat(){if(!D)if(g(e))D={textureFloat:!0,textureFloatLinear:!n.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!n.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};else if(e instanceof WebGLRenderingContext){const F=!n.textureHalfFloat&&e.getExtension("OES_texture_half_float");D={textureFloat:!n.textureFloat&&
!!e.getExtension("OES_texture_float"),textureFloatLinear:!n.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!F,textureHalfFloatLinear:!n.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:F?F.HALF_FLOAT_OES:void 0}}else D=null;return D},get colorBufferFloat(){if(!z)if(g(e)){var F=!n.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),G=!n.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),I=!n.colorBufferFloat&&
e.getExtension("EXT_float_blend");z=F||G||I?{textureFloat:!!G,textureHalfFloat:!!F,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}else e instanceof WebGLRenderingContext?(F=!n.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),G=!n.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),I=!n.colorBufferFloat&&e.getExtension("EXT_float_blend"),z=F||G||I?{textureFloat:!!G,textureHalfFloat:!!F,
RGBA16F:F?F.RGBA16F_EXT:void 0,RGB16F:F?F.RGB16F_EXT:void 0,RGBA32F:G?G.RGBA32F_EXT:void 0}:null):z=null;return z},get blendMinMax(){if(!r)if(g(e))r={MIN:e.MIN,MAX:e.MAX};else if(n.blendMinMax)r=null;else{{const F=e.getExtension("EXT_blend_minmax");r=F?{MIN:F.MIN_EXT,MAX:F.MAX_EXT}:null}}return r},get depthTexture(){null===x&&(x=d(e,n,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return x},get standardDerivatives(){null===m&&(m=d(e,n,"standardDerivatives",
!0,["OES_standard_derivatives"]));return m},get shaderTextureLOD(){null===B&&(B=d(e,n,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return B},get fragDepth(){null===E&&(E=d(e,n,"fragDepth",!0,["EXT_frag_depth"]));return E},get loseContext(){C||(C=k.load(e,q));return C},enable(F){return this[F]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,g){let b=function(p,f,k,c,d,e,h,n){this.createQuery=
p;this.resultAvailable=f;this.getResult=k;this.disjoint=c;this.beginTimeElapsed=d;this.endTimeElapsed=e;this.createTimestamp=h;this.timestampBits=n};a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(p,f){if(f.disjointTimerQuery)return null;let k=p.getExtension("EXT_disjoint_timer_query_webgl2");return k&&g(p)?new b(()=>p.createQuery(),c=>p.getQueryParameter(c,p.QUERY_RESULT_AVAILABLE),c=>p.getQueryParameter(c,p.QUERY_RESULT),()=>p.getParameter(k.GPU_DISJOINT_EXT),c=>p.beginQuery(k.TIME_ELAPSED_EXT,
c),()=>p.endQuery(k.TIME_ELAPSED_EXT),c=>k.queryCounterEXT(c,k.TIMESTAMP_EXT),()=>p.getQuery(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):(k=p.getExtension("EXT_disjoint_timer_query"))?new b(()=>k.createQueryEXT(),c=>k.getQueryObjectEXT(c,k.QUERY_RESULT_AVAILABLE_EXT),c=>k.getQueryObjectEXT(c,k.QUERY_RESULT_EXT),()=>p.getParameter(k.GPU_DISJOINT_EXT),c=>k.beginQueryEXT(k.TIME_ELAPSED_EXT,c),()=>k.endQueryEXT(k.TIME_ELAPSED_EXT),c=>k.queryCounterEXT(c,k.TIMESTAMP_EXT),()=>k.getQueryEXT(k.TIMESTAMP_EXT,
k.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,g){a.load=function(b,p){return p.disjointTimerQuery?null:g(b)?{drawBuffers:b.drawBuffers.bind(b),MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS}:p.drawBuffers?null:(b=b.getExtension("WEBGL_draw_buffers"))?{drawBuffers:b.drawBuffersWEBGL.bind(b),MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS_WEBGL,
MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,g){a.load=function(b){return g(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),
drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(g,b){const p=b.loseContext&&g.getExtension("WEBGL_lose_context");return p?{loseRenderingContext:()=>p.loseContext()}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports",
"./isWebGL2Context"],function(a,g){a.load=function(b,p){return g(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:p.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:
null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderCompiler":function(){define(function(){return function(){function a(b){this.readFile=b}var g=a.prototype;g.resolveIncludes=function(b){return this.resolve(b)};g.resolve=function(b,p=new Map){if(p.has(b))return p.get(b);const f=this.read(b);if(!f)throw Error(`cannot find shader file ${b}`);const k=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let c=k.exec(f);const d=[];for(;null!=c;)d.push({path:c[1],start:c.index,length:c[0].length}),
c=k.exec(f);let e=0,h="";d.forEach(n=>{h+=f.slice(e,n.start);h+=p.has(n.path)?"":this.resolve(n.path,p);e=n.start+n.length});h+=f.slice(e);p.set(b,h);return h};g.read=function(b){return this.readFile(b)};return a}()})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../geometry/support/aaBoundingRect","./OverlayRenderTarget","../webgl-engine/lib/localOrigin"],function(a,g,b,p){let f=function(){function k(d){this.extent=g.create();this.resolution=0;this.renderLocalOrigin=p.fromValues(0,
0,0,"O");this.pixelRatio=1;this.renderTargets={color:{fbo:new b.OverlayRenderTarget(d,!0),valid:!1,lastUsed:Infinity},colorWithoutRasterImage:{fbo:new b.OverlayRenderTarget(d,!0),valid:!1,lastUsed:Infinity},highlight:{fbo:new b.OverlayRenderTarget(d,!1),valid:!1,lastUsed:Infinity},water:{fbo:new b.OverlayRenderTarget(d,!0),valid:!1,lastUsed:Infinity},occluded:{fbo:new b.OverlayRenderTarget(d,!0),valid:!1,lastUsed:Infinity}}}var c=k.prototype;c.dispose=function(){this.renderTargets.color.fbo.dispose();
this.renderTargets.colorWithoutRasterImage.fbo.dispose();this.renderTargets.highlight.fbo.dispose();this.renderTargets.water.fbo.dispose();this.renderTargets.occluded.fbo.dispose()};c.drawRenderTargets=function(d,e,h){const n=this.renderTargets;n.color.valid=d.drawPass(0,n.color.fbo,e);n.highlight.valid=d.drawPass(5,n.highlight.fbo,e);n.water.valid=d.drawPass(3,n.water.fbo,e);n.occluded.valid=d.drawPass(0,n.occluded.fbo,e,1);n.colorWithoutRasterImage.valid=h&&d.drawPass(0,n.colorWithoutRasterImage.fbo,
e,2)};c.computeRenderTargetValidityBitfield=function(){const d=this.renderTargets;return+d.color.valid|+d.colorWithoutRasterImage.valid<<1|+d.highlight.valid<<2|+d.water.valid<<3|+d.occluded.valid<<4};c.validateUsage=function(d,e){if(d.valid)d.lastUsed=e;else if(1E3<e-d.lastUsed)d.fbo.disposeRenderTargetMemory(),d.lastUsed=Infinity;else if(Infinity>d.lastUsed)return!0;return!1};c.collectUnusedMemory=function(d){let e=!1;e=this.validateUsage(this.renderTargets.color,d)||e;e=this.validateUsage(this.renderTargets.colorWithoutRasterImage,
d)||e;e=this.validateUsage(this.renderTargets.highlight,d)||e;e=this.validateUsage(this.renderTargets.occluded,d)||e;return e=this.validateUsage(this.renderTargets.water,d)||e};c.getGpuMemoryUsage=function(){return this.renderTargets.color.fbo.getGpuMemoryUsage()+this.renderTargets.colorWithoutRasterImage.fbo.getGpuMemoryUsage()+this.renderTargets.highlight.fbo.getGpuMemoryUsage()+this.renderTargets.water.fbo.getGpuMemoryUsage()+this.renderTargets.occluded.fbo.getGpuMemoryUsage()};return k}();a.Overlay=
f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["exports","../../../../chunks/vec3f64"],function(a,g){let b=function(p,f){this.vec3=p;this.id=f};a.LocalOrigin=b;a.fromValues=function(p,f,k,c){return new b(g.fromValues(p,f,k),c)};a.fromVector=function(p,f){return new b(g.clone(p),f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["exports",
"../../../../../core/arrayUtils"],function(a,g){let b=function(){function p(){this._uniforms={proj:[],uShadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}var f=p.prototype;f.dispose=function(){this._uniforms=null};f.getPrograms=function(k){return this._uniforms[k]||[]};f.subscribeProgram=function(k){for(const c in this._uniforms)k.hasUniform(c)&&this._uniforms[c].push(k)};f.unsubscribeProgram=function(k){for(const c in this._uniforms)g.removeUnordered(this._uniforms[c],k)};return p}();
a.CommonUniformStore=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(a,g,b){let p=function(k){this.technique=k;this.refZeroFrame=this.refCount=0},f=function(){function k(d){this._context=d;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}var c=k.prototype;c.dispose=
function(){this._perConstructorInstances.forEach(d=>d.forEach(e=>e.technique.dispose()));this._perConstructorInstances.clear()};c.acquire=function(d,e){const h=e.key;let n=this._perConstructorInstances.get(d);n||(n=new Map,this._perConstructorInstances.set(d,n));let q=n.get(h);void 0===q&&(q=new p(new d(this._context,e)),n.set(h,q));++q.refCount;return q.technique};c.acquireAndReleaseExisting=function(d,e,h){return b.isNone(h)?this.acquire(d,e):e.key===h.key&&h instanceof d?h:(this.release(h),this.acquire(d,
e))};c.release=function(d){b.isNone(d)||(d=this._perConstructorInstances.get(d.constructor).get(d.key),--d.refCount,0===d.refCount&&(d.refZeroFrame=this._frameCounter))};c.frameUpdate=function(){this._frameCounter++;this._perConstructorInstances.forEach((d,e)=>{d.forEach((h,n)=>{0===h.refCount&&h.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(h.technique.dispose(),d.delete(n))});0===d.size&&this._perConstructorInstances.delete(e)})};c.getProgramsUsingUniform=function(d){return this._context.commonUniformStore.getPrograms(d)};
c.hotReload=async function(){const d=[];this._perConstructorInstances.forEach((e,h)=>{d.push((async(n,q)=>{if(q=q.shader)await q.reload(),n.forEach(u=>{u.technique.reload(this._context)})})(e,h))});await Promise.all(d)};g._createClass(k,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return k}();a.ShaderTechniqueRepository=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["../../../../core/maybe",
"../../../../core/Logger","./Util","../core/shaderLibrary/ShaderOutputOptions"],function(a,g,b,p){const f=g.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let k=function(){function c(e){this.refCnt=0;this.glMaterial=e}var d=c.prototype;d.incRefCnt=function(){++this.refCnt};d.decRefCnt=function(){--this.refCnt;b.assert(0<=this.refCnt)};d.getRefCnt=function(){return this.refCnt};d.getGLMaterial=function(){return this.glMaterial};return c}();return function(){function c(e,h,n){this._textureRep=
e;this._techniqueRep=h;this.onMaterialChanged=n;this._id2glMaterialRef=new Map}var d=c.prototype;d.dispose=function(){this._textureRep.dispose()};d.acquire=function(e,h){this.ownMaterial(e);const n=p.getShaderOutputID(e.id,h);let q=this._id2glMaterialRef.get(n);if(null==q)return e=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:h}),q=new k(e),q.incRefCnt(),this._id2glMaterialRef.set(n,q),e;q.incRefCnt();return q.getGLMaterial()};d.release=function(e,
h){e=p.getShaderOutputID(e.id,h);h=this._id2glMaterialRef.get(e);h.decRefCnt();0===h.getRefCnt()&&((h=h.getGLMaterial())&&h.dispose(),this._id2glMaterialRef.delete(e))};d.materialChanged=function(e){for(const n of p.ShaderOutputTypes)if(5!==n.output&&6!==n.output){var h=this._id2glMaterialRef.get(p.getShaderOutputID(e.id,n.output));h&&h.getGLMaterial()&&(h=h.getGLMaterial(),h.updateParameters&&h.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(e)};d.ownMaterial=function(e){a.isSome(e.materialRepository)&&
e.materialRepository!==this&&f.error("Material is already owned by a different material repository");e.materialRepository=this};return c}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){const g=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];a.ShaderOutputTypes=g;a.getShaderOutputID=
function(b,p){return b+"_"+g.find(f=>f.output===p).name};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("../../../../core/maybe ../../../../geometry/SpatialReference ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/mat4f64 ./Geometry ./Object3D ./localOrigin ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){let q=0,u=function(){function t(){this.ROOT_ORIGIN_ID=
"rg_root_"+q++;this._origins=new Map;this._gridSize=42E5}var l=t.prototype;l.getOrigin=function(w){var y=this._origins.get(this.ROOT_ORIGIN_ID);if(null==y){if(a.isSome(t.testOrigin)){var D=t.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,e.fromValues(D[0],D[1],D[2],this.ROOT_ORIGIN_ID));return this.getOrigin(w)}D=e.fromValues(w[0]+Math.random()-.5,w[1]+Math.random()-.5,w[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,D);return D}p.subtract(v,w,y.vec3);v[0]=Math.abs(v[0]);
v[1]=Math.abs(v[1]);v[2]=Math.abs(v[2]);D=this._gridSize;if(v[0]<D&&v[1]<D&&v[2]<D)return y;y=Math.round(w[0]/D);const z=Math.round(w[1]/D);w=Math.round(w[2]/D);const r=`${"rg_"}${y}/${z}/${w}`;let C=this._origins.get(r);C||(C=e.fromValues(y*D,z*D,w*D,r),this._origins.set(r,C));return C};l._drawOriginBox=function(w){var y=window.view;const D=y._stage;if(null==this._object){this._material=new n.RibbonLineMaterial({width:2,color:[0,1,0,1]});D.add(this._material);var z=new h.WebGLLayer({isPickable:!1});
this._object=new d.Object3D({castShadow:!1});D.add(this._object);z.add(this._object);D.add(z)}z=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];const r=z.length,C=Array(3*r),A=new Uint16Array(2*(r-1)),x=.5*this._gridSize;for(let m=0;m<r;m++)C[3*m]=w[0]+(z[m]&1?x:-x),C[3*m+1]=w[1]+(z[m]&2?x:-x),C[3*m+2]=w[2]+(z[m]&4?x:-x),0<m&&(A[2*m]=m-1,A[2*m+1]=m);f.projectBuffer(C,g.WebMercator,0,C,y.spatialReference,0,r);y=new c.Geometry([["position",{size:3,data:C,exclusive:!0}]],[["position",A]],2);D.add(y);this._object.addGeometry(y,
this._material,k.IDENTITY);console.log(this._origins.size,w)};return t}();const v=b.create();(u||(u={})).testOrigin=null;return u})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2 ../../support/buffer/InterleavedLayout ../../support/geometryUtils ../lib/Util ../lib/geometryDataUtils ./renderers/utils ../lib/GLMaterial ../lib/Material ./VisualVariableMaterialParameters ../shaders/RibbonLineTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){function D(N,ca,O,V,ba){for(let fa=0;fa<ba;fa++)O[V++]=N[ca++];return V}function z(N,ca,O){ca=ca.get("position").data;O=O?O.get("position"):null;return N.isClosed?O?2<O.length:6<ca.length:!1}const r=p.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");p=function(N){function ca(V){V=N.call(this,V,A)||this;V._vertexAttributeLocations=y.ribbonVertexAttributeLocations;V.techniqueConfig=new y.RibbonLineTechniqueConfiguration;V.layout=V.createLayout();
return V}g._inheritsLoose(ca,N);var O=ca.prototype;O.isClosed=function(V,ba){return this.params.isClosed?ba?2<ba.length:6<V.length:!1};O.dispose=function(){};O.getPassParameters=function(){return this.params};O.getTechniqueConfig=function(V,ba){this.techniqueConfig.output=V;V=b.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=V;this.techniqueConfig.stippleIntegerRepeatsEnabled=V&&this.params.stippleIntegerRepeats;this.techniqueConfig.stippleOffColorEnabled=V&&b.isSome(this.params.stippleOffColor);
this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=
this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&b.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=0<this.params.falloff;this.techniqueConfig.occluder=8===this.params.renderOccluded;this.techniqueConfig.transparencyPassType=ba?ba.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=ba?ba.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=ba?ba.cullAboveGround:
!0;return this.techniqueConfig};O.intersect=function(V,ba,fa,ia,ma,ea,M,Z,la){la?this.intersectDrapedLineGeometry(V,ia,ea,M):this.intersectLineGeometry(V,ba,fa,ia,this.params.width,M)};O.intersectDrapedLineGeometry=function(V,ba,fa,ia){if(ba.options.selectionMode){ba=V.vertexAttributes.get("position").data;var ma=V.vertexAttributes.get("size"),ea=this.params.width;this.params.vvSizeEnabled?(ma=V.vertexAttributes.get("sizeFeatureAttribute").data[0],ea*=f.clamp(this.params.vvSizeOffset[0]+ma*this.params.vvSizeFactor[0],
this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):ma&&(ea*=ma.data[0]);ma=fa[0];fa=fa[1];V=(ea/2+4)*V.screenToWorldRatio;ea=Number.MAX_VALUE;for(let ha=0;ha<ba.length-5;ha+=3){var M=ba[ha],Z=ba[ha+1],la=ma-M,ka=fa-Z;M=ba[ha+3]-M;Z=ba[ha+4]-Z;const na=f.clamp((M*la+Z*ka)/(M*M+Z*Z),0,1);la=M*na-la;ka=Z*na-ka;ka=la*la+ka*ka;ka<ea&&(ea=ka)}ea<V*V&&ia()}};O.intersectLineGeometry=function(V,ba,fa,ia,ma,ea){if(ia.options.selectionMode&&!v.isInstanceHidden(ba))if(q.isTranslationMatrix(fa)){var M=
V.vertexAttributes;ba=M.get("position").data;if(this.params.vvSizeEnabled){var Z=M.get("sizeFeatureAttribute").data[0];ma*=f.clamp(this.params.vvSizeOffset[0]+Z*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else M.has("size")&&(ma*=M.get("size").data[0]);Z=ia.camera;var la=G;e.copy(la,ia.point);ma=ma*Z.pixelRatio/2+4*Z.pixelRatio;d.set(H[0],la[0]-ma,la[1]+ma,0);d.set(H[1],la[0]+ma,la[1]+ma,0);d.set(H[2],la[0]+ma,la[1]-ma,0);d.set(H[3],la[0]-ma,la[1]-ma,0);
for(var ka=0;4>ka;ka++)if(!Z.unprojectFromRenderScreen(H[ka],R[ka]))return;n.plane.fromPoints(Z.eye,R[0],R[1],T);n.plane.fromPoints(Z.eye,R[1],R[2],W);n.plane.fromPoints(Z.eye,R[2],R[3],Y);n.plane.fromPoints(Z.eye,R[3],R[0],U);ka=Number.MAX_VALUE;V=z(this.params,M,V.indices)?ba.length-2:ba.length-5;for(M=0;M<V;M+=3){m[0]=ba[M]+fa[12];m[1]=ba[M+1]+fa[13];m[2]=ba[M+2]+fa[14];var ha=(M+3)%ba.length;B[0]=ba[ha]+fa[12];B[1]=ba[ha+1]+fa[13];B[2]=ba[ha+2]+fa[14];if(!(0>n.plane.signedDistance(T,m)&&0>n.plane.signedDistance(T,
B)||0>n.plane.signedDistance(W,m)&&0>n.plane.signedDistance(W,B)||0>n.plane.signedDistance(Y,m)&&0>n.plane.signedDistance(Y,B)||0>n.plane.signedDistance(U,m)&&0>n.plane.signedDistance(U,B))){Z.projectToRenderScreen(m,I);Z.projectToRenderScreen(B,K);if(0>I[2]&&0<K[2])d.subtract(E,m,B),ha=Z.frustum,ha=-n.plane.signedDistance(ha[4],m)/d.dot(E,n.plane.normal(ha[4])),d.scale(E,E,ha),d.add(m,m,E),Z.projectToRenderScreen(m,I);else if(0<I[2]&&0>K[2])d.subtract(E,B,m),ha=Z.frustum,ha=-n.plane.signedDistance(ha[4],
B)/d.dot(E,n.plane.normal(ha[4])),d.scale(E,E,ha),d.add(B,B,E),Z.projectToRenderScreen(B,K);else if(0>I[2]&&0>K[2])continue;I[2]=0;K[2]=0;ha=n.lineSegment.distance2(n.lineSegment.fromPoints(I,K,P),la);ha<ka&&(ka=ha,d.copy(J,m),d.copy(L,B))}}fa=ia.rayBeginPoint;ia=ia.rayEndPoint;ka<ma*ma&&(ba=Number.MAX_VALUE,n.lineSegment.closestLineSegmentPoint(n.lineSegment.fromPoints(J,L,P),n.lineSegment.fromPoints(fa,ia,Q),F)&&(d.subtract(F,F,fa),ba=d.length(F),d.scale(F,F,1/ba),ba/=d.distance(fa,ia)),ea(ba,F))}else r.error("intersection assumes a translation-only matrix")};
O.computeAttachmentOrigin=function(V,ba){const fa=V.vertexAttributes;if(!fa)return null;V=V.indices;const ia=fa.get("position");return u.computeAttachmentOriginLines(ia,V?V.get("position"):null,V&&z(this.params,fa,V),ba)};O.createLayout=function(){const V=h.newLayout().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");this.params.vvSizeEnabled?V.f32("sizeFeatureAttribute"):V.f32("size");this.params.vvColorEnabled?V.f32("colorFeatureAttribute"):V.vec4f("color");
this.params.vvOpacityEnabled&&V.f32("opacityFeatureAttribute");return V};O.createBufferWriter=function(){return new x(this.layout,this.params)};O.getGLMaterial=function(V){return 0===V.output||7===V.output||4===V.output||1===V.output?new C(V):void 0};O.validateParameterValues=function(V){"miter"!==V.join&&(V.miterLimit=0);this.requiresTransparent(V)&&(V.transparent=!0)};O.requiresTransparent=function(V){return!!(1>(V.color&&V.color[3])||0<V.innerWidth&&this.colorRequiresTransparent(V.innerColor)||
V.stipplePattern&&this.colorRequiresTransparent(V.stippleOffColor)||0<V.falloff)};O.colorRequiresTransparent=function(V){return b.isSome(V)&&1>V[3]&&0<V[3]};return ca}(l.Material);let C=function(N){function ca(V){V=N.call(this,V)||this;V.updateParameters();return V}g._inheritsLoose(ca,N);var O=ca.prototype;O.updateParameters=function(V){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.RibbonLineTechnique,this.material.getTechniqueConfig(this.output,V),this.technique)};O.beginSlot=function(V){return this.technique.configuration.occluder?
3===V||10===V||11===V:0===this.output||7===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,V===this.targetSlot):3===V};O._updateOccludeeState=function(V){V.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:V.hasOccludees})};O.ensureParameters=function(V){0!==this.output&&7!==this.output||this._updateOccludeeState(V);this.updateParameters(V)};O.bind=function(V,ba){V.bindProgram(this.technique.program);this.technique.bindPass(V,
this.material.getPassParameters(),ba)};O.getPipelineState=function(V,ba){return this.technique.getPipelineState(V,ba)};return ca}(t);const A={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...l.materialParametersDefaults,...w.Default};let x=function(){function N(O,V){this.params=
V;this.numJoinSubdivisions=0;this.vertexBufferLayout=O;switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=V.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=1}}var ca=N.prototype;ca.isClosed=function(O){return z(this.params,O.vertexAttributes,O.indices)};ca.numCapSubdivisions=function(O){if(this.isClosed(O))return 0;switch(this.params.cap){case "butt":return 0;case "square":return 1;case "round":return 3}};ca.allocate=function(O){return this.vertexBufferLayout.createBuffer(O)};
ca.elementCount=function(O){var V=2*this.numCapSubdivisions(O)+2,ba=O.indices.get("position").length/2+1;const fa=this.isClosed(O);V=fa?2:2*V;var ia=fa?0:1;ba=fa?ba:ba-1;if(O.vertexAttributes.has("subdivisions"))for(O=O.vertexAttributes.get("subdivisions").data;ia<ba;++ia)V+=4+2*O[ia];else V+=(ba-ia)*(2*this.numJoinSubdivisions+4);return V+2};ca.write=function(O,V,ba,fa){const ia=X,ma=aa,ea=S;var M=V.vertexAttributes.get("position").data,Z=V.indices&&V.indices.get("position");const la=this.numCapSubdivisions(V);
Z&&Z.length!==2*(M.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");Z=null;V.vertexAttributes.has("subdivisions")&&(Z=V.vertexAttributes.get("subdivisions").data);let ka=1,ha=0;this.params.vvSizeEnabled?ha=V.vertexAttributes.get("sizeFeatureAttribute").data[0]:V.vertexAttributes.has("size")&&(ka=V.vertexAttributes.get("size").data[0]);let na=[1,1,1,1],da=0;this.params.vvColorEnabled?da=V.vertexAttributes.get("colorFeatureAttribute").data[0]:V.vertexAttributes.has("color")&&
(na=V.vertexAttributes.get("color").data);let oa=0;this.params.vvOpacityEnabled&&(oa=V.vertexAttributes.get("opacityFeatureAttribute").data[0]);const qa=M.length/3;O=O.transformation;const ua=new Float32Array(ba.buffer);ba=this.vertexBufferLayout.stride/4;let Ca=fa*ba;fa=Ca;const Ja=(Va,Ka,wa,Ea,Pa,ja,Ya)=>{ua[Ca++]=Ka[0];ua[Ca++]=Ka[1];ua[Ca++]=Ka[2];ua[Ca++]=Ea;ua[Ca++]=Pa;ua[Ca++]=ja;ua[Ca++]=Va[0];ua[Ca++]=Va[1];ua[Ca++]=Va[2];ua[Ca++]=wa[0];ua[Ca++]=wa[1];ua[Ca++]=wa[2];this.params.vvSizeEnabled?
ua[Ca++]=ha:ua[Ca++]=ka;this.params.vvColorEnabled?ua[Ca++]=da:(Va=Math.min(4*Ya,na.length-4),ua[Ca++]=na[Va+0],ua[Ca++]=na[Va+1],ua[Ca++]=na[Va+2],ua[Ca++]=na[Va+3]);this.params.vvOpacityEnabled&&(ua[Ca++]=oa)};Ca+=ba;d.set(ma,M[0],M[1],M[2]);O&&d.transformMat4(ma,ma,O);if(V=this.isClosed(V)){var Ha=M.length-3;d.set(ia,M[Ha],M[Ha+1],M[Ha+2]);O&&d.transformMat4(ia,ia,O)}else{d.copy(ia,ma);d.set(ea,M[3],M[4],M[5]);O&&d.transformMat4(ea,ea,O);for(Ha=0;Ha<la;++Ha){var Na=1-Ha/la;Ja(ia,ma,ea,Na,1,-4,
0);Ja(ia,ma,ea,Na,1,4,0)}Ja(ia,ma,ea,0,0,-4,0);Ja(ia,ma,ea,0,0,4,0);d.copy(ia,ma);d.copy(ma,ea)}Na=V?0:1;for(Ha=V?qa:qa-1;Na<Ha;Na++){var Oa=(Na+1)%qa*3;d.set(ea,M[Oa+0],M[Oa+1],M[Oa+2]);O&&d.transformMat4(ea,ea,O);Ja(ia,ma,ea,0,1,-1,Na);Ja(ia,ma,ea,0,1,1,Na);Oa=Z?Z[Na]:this.numJoinSubdivisions;for(let Va=0;Va<Oa;++Va){const Ka=(Va+1)/(Oa+1);Ja(ia,ma,ea,Ka,1,-2,Na);Ja(ia,ma,ea,Ka,1,2,Na)}Ja(ia,ma,ea,1,0,-2,Na);Ja(ia,ma,ea,1,0,2,Na);d.copy(ia,ma);d.copy(ma,ea)}if(V)Ca=D(ua,fa+ba,ua,Ca,2*ba);else for(Ja(ia,
ma,ea,0,1,-5,Ha),Ja(ia,ma,ea,0,1,5,Ha),M=0;M<la;++M)Z=(M+1)/la,Ja(ia,ma,ea,Z,1,-5,Ha),Ja(ia,ma,ea,Z,1,5,Ha);D(ua,fa+ba,ua,fa,ba);Ca=D(ua,Ca-ba,ua,Ca,ba)};return N}();const m=c.create(),B=c.create(),E=c.create(),F=c.create(),G=c.create(),I=k.createRenderScreenPointArray3(),K=k.createRenderScreenPointArray3(),J=c.create(),L=c.create(),P=n.lineSegment.create(),Q=n.lineSegment.create(),X=c.create(),aa=c.create(),S=c.create(),H=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),
k.createRenderScreenPointArray3()],R=[c.create(),c.create(),c.create(),c.create()],T=n.plane.create(),W=n.plane.create(),Y=n.plane.create(),U=n.plane.create();a.RibbonLineMaterial=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["../../../../chunks/mat3f64","../../../../chunks/vec3f32"],function(a,g){var b;(b||(b={})).Default={vvSizeEnabled:!1,vvSizeMinSize:g.fromValues(1,1,1),vvSizeMaxSize:g.fromValues(100,
100,100),vvSizeOffset:g.fromValues(0,0,0),vvSizeFactor:g.fromValues(1,1,1),vvSizeValue:g.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:a.create()};return b})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../../../../chunks/RibbonLine.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){const D={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};c=function(r){function C(x,m){m=r.call(this,x,m)||this;m.stipplePattern=null;m.stippleTextureBind=null;m.stippleTextureRepository=x.stippleTextureRepository;return m}b._inheritsLoose(C,r);var A=C.prototype;A.initializeProgram=function(x){var m=C.shader.get();const B=this.configuration;m=m.build({OITEnabled:0===
B.transparencyPassType,output:B.output,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:B.stippleEnabled,stippleOffColorEnabled:B.stippleOffColorEnabled,stippleUVMaxEnabled:B.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:B.stippleIntegerRepeatsEnabled,roundCaps:B.roundCaps,roundJoins:B.roundJoins,vvColor:B.vvColor,vvSize:B.vvSize,vvInstancingEnabled:!0,vvOpacity:B.vvOpacity,falloffEnabled:B.falloffEnabled,innerColorEnabled:B.innerColorEnabled,
multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new e(x.rctx,m.generateSource("vertex"),m.generateSource("fragment"),D)};A.dispose=function(){r.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};A.bindPass=function(x,m,B){n.View.bindProjectionMatrix(this.program,B.camera.projectionMatrix);4===this.configuration.output&&u.OutputHighlight.bindOutputHighlight(x,this.program,
B);B.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",B.inverseViewport),l.bindMultipassTerrainUniforms(this.program,x,B));this.program.setUniform1f("intrinsicWidth",m.width);this.program.setUniform4fv("intrinsicColor",m.color);this.program.setUniform1f("miterLimit","miter"!==m.join?0:m.miterLimit);this.program.setUniform2fv("cameraNearFar",B.camera.nearFar);this.program.setUniform1f("pixelRatio",B.camera.pixelRatio);this.program.setUniform2f("screenSize",B.camera.fullViewport[2],
B.camera.fullViewport[3]);v.VisualVariables.bindUniformsWithOpacity(this.program,m);if(this.stipplePattern!==m.stipplePattern){const E=m.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,E);this.stipplePattern=E}this.configuration.stippleEnabled&&(x=f.isSome(this.stippleTextureBind)?this.stippleTextureBind(x,0)*B.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/x),this.configuration.stippleOffColorEnabled&&
(x=f.unwrap(m.stippleOffColor),this.program.setUniform4f("stippleOffColor",x[0],x[1],x[2],3<x.length?x[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",m.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",f.unwrapOr(m.innerColor,m.color)),this.program.setUniform1f("innerWidth",m.innerWidth*B.camera.pixelRatio))};A.bindDraw=function(x){n.View.bindView(this.program,x);q.Slice.bindUniformsWithOrigin(this.program,this.configuration,x)};
A.setPipelineState=function(x,m){const B=this.configuration,E=3===x,F=2===x;return h.makePipelineState({blending:0===B.output||7===B.output?E?t.blendingDefault:t.OITBlending(x):null,depthTest:{func:t.OITDepthTest(x)},depthWrite:E?!B.transparent&&B.writeDepth&&h.defaultDepthWriteParams:t.OITDepthWrite(x),colorWrite:h.defaultColorWriteParams,stencilWrite:B.sceneHasOcludees?w.stencilWriteMaskOn:null,stencilTest:B.sceneHasOcludees?m?w.stencilToolMaskBaseParams:w.stencilBaseAllZerosParams:null,polygonOffset:E||
F?B.polygonOffset&&z:t.OITPolygonOffset})};A.initializePipeline=function(){const x=this.configuration,m=x.polygonOffset&&z;x.occluder&&(this._occluderPipelineTransparent=h.makePipelineState({blending:t.blendingDefault,polygonOffset:m,depthTest:w.depthCompareAlways,depthWrite:null,colorWrite:h.defaultColorWriteParams,stencilWrite:null,stencilTest:w.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=h.makePipelineState({blending:t.blendingDefault,polygonOffset:m,depthTest:w.depthCompareAlways,
depthWrite:null,colorWrite:h.defaultColorWriteParams,stencilWrite:w.stencilWriteMaskOff,stencilTest:w.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=h.makePipelineState({blending:null,polygonOffset:m,depthTest:w.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:w.stencilWriteMaskOn,stencilTest:w.stencilToolMaskBaseParams}));this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,
!1)};A.getPipelineState=function(x,m){return m?this._occludeePipelineState:this.configuration.occluder?11===x?this._occluderPipelineTransparent:10===x?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline};b._createClass(C,[{key:"primitiveType",get:function(){return 5}}]);return C}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(y.RibbonLineShader,()=>new Promise(function(r,C){a(["./RibbonLine.glsl"],r,C)}));const z={factor:0,units:-4};k=function(r){function C(){var A=
r.apply(this,arguments)||this;A.output=0;A.occluder=!1;A.slicePlaneEnabled=!1;A.transparent=!1;A.polygonOffset=!1;A.writeDepth=!1;A.stippleEnabled=!1;A.stippleOffColorEnabled=!1;A.stippleIntegerRepeatsEnabled=!1;A.roundCaps=!1;A.roundJoins=!1;A.vvSize=!1;A.vvColor=!1;A.vvOpacity=!1;A.falloffEnabled=!1;A.innerColorEnabled=!1;A.sceneHasOcludees=!1;A.transparencyPassType=3;A.multipassTerrainEnabled=!1;A.cullAboveGround=!0;return A}b._inheritsLoose(C,r);return C}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:8})],
k.prototype,"output",void 0);p.__decorate([d.parameter()],k.prototype,"occluder",void 0);p.__decorate([d.parameter()],k.prototype,"slicePlaneEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"transparent",void 0);p.__decorate([d.parameter()],k.prototype,"polygonOffset",void 0);p.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);p.__decorate([d.parameter()],k.prototype,"stippleEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"stippleOffColorEnabled",void 0);p.__decorate([d.parameter()],
k.prototype,"stippleIntegerRepeatsEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"roundCaps",void 0);p.__decorate([d.parameter()],k.prototype,"roundJoins",void 0);p.__decorate([d.parameter()],k.prototype,"vvSize",void 0);p.__decorate([d.parameter()],k.prototype,"vvColor",void 0);p.__decorate([d.parameter()],k.prototype,"vvOpacity",void 0);p.__decorate([d.parameter()],k.prototype,"falloffEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"innerColorEnabled",void 0);p.__decorate([d.parameter()],
k.prototype,"sceneHasOcludees",void 0);p.__decorate([d.parameter({count:4})],k.prototype,"transparencyPassType",void 0);p.__decorate([d.parameter()],k.prototype,"multipassTerrainEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);g.RibbonLineTechnique=c;g.RibbonLineTechniqueConfiguration=k;g.ribbonVertexAttributeLocations=D;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,g){a.bindMultipassTerrainUniforms=function(b,p,f){f.multipassTerrainEnabled&&f.terrainLinearDepthTexture&&(b.setUniform1i("terrainDepthTexture",10),p.bindTexture(f.terrainLinearDepthTexture,10))};a.multipassTerrainTest=function(b,p){b.fragment.uniforms.add("terrainDepthTexture","sampler2D");b.fragment.uniforms.add("cameraNearFar","vec2");b.fragment.uniforms.add("inverseViewport","vec2");b.fragment.code.add(g.glsl`
    //Compare the linearized depths of the fragment and the terrain. If fragment is on the wrong side of the terrain, discard it.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${p.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports"],function(a){a.depthCompareAlways={func:519};a.depthCompareLess={func:513};a.renderWhenBitIsNotSet=g=>({function:{func:517,ref:g,mask:g},operation:{fail:7680,zFail:7680,zPass:7680}});a.replaceBitWhenDepthTestPasses=g=>({function:{func:519,ref:g,mask:g},operation:{fail:7680,zFail:7680,zPass:7681}});a.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,
zFail:7680,zPass:0}};a.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};a.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){function u(t){const l=new b.ShaderBuilder;l.extensions.add("GL_OES_standard_derivatives");l.include(q.PiUtils);l.include(e.RibbonVertexPosition,t);l.include(n.LineStipple,t);1===t.output&&l.include(h.OutputDepth,t);l.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");l.attributes.add("position","vec3");l.attributes.add("subdivisionFactor","float");l.attributes.add("uv0",
"vec2");l.attributes.add("auxpos1","vec3");l.attributes.add("auxpos2","vec3");l.varyings.add("vColor","vec4");l.varyings.add("vpos","vec3");l.varyings.add("linearDepth","float");t.multipassTerrainEnabled&&l.varyings.add("depth","float");const w=t.falloffEnabled,y=t.innerColorEnabled;y&&l.varyings.add("vLineDistance","float");w&&l.varyings.add("vLineDistanceNorm","float");t.falloffEnabled&&l.fragment.uniforms.add("falloff","float");t.innerColorEnabled&&(l.fragment.uniforms.add("innerColor","vec4"),
l.fragment.uniforms.add("innerWidth","float"));l.vertex.code.add(g.glsl`
		#define PERPENDICULAR(v) vec2(v.y, -v.x);
		#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0

		float interp(float ncp, vec4 a, vec4 b) {
			return (-ncp - a.z) / (b.z - a.z);
		}

		vec2 rotate(vec2 v, float a) {
			float s = sin(a);
			float c = cos(a);
			mat2 m = mat2(c, -s, s, c);
			return m * v;
		}
`);l.vertex.code.add(g.glsl`
    vec4 projectAndScale(vec4 pos) {
      vec4 posNdc = proj * pos;

      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system
      // that is twice scaled (going from -size:size).
      posNdc.xy *= screenSize / posNdc.w;
      return posNdc;
    }
`);l.vertex.code.add(g.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${t.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`);l.vertex.code.add(g.glsl`
  void main(void) {
    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
      bool isJoin = abs(uv0.y)-3.0 < 0.0;

      float lineWidth = getSize() * pixelRatio;

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);t.stippleEnabled&&l.vertex.code.add(g.glsl`
      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment
      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment
      // vector
      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;

      // Scale s.t. it's in units of stipple pattern size.
      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;
    `);l.vertex.code.add(g.glsl`
    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);

    vec2 capDisplacementDir = vec2(0, 0);
    vec2 joinDisplacementDir = vec2(0, 0);
    float displacementLen = lineWidth;

    if (isJoin) {

      // JOIN handling ---------------------------------------------------
      // determine if vertex is on the "outside or "inside" of the join
      bool isOutside = ISOUTSIDE;

      // compute miter join position first
      joinDisplacementDir = normalize(left + right);
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      // compute miter stretch
      if (leftLen > 0.001 && rightLen > 0.001) {
        float nDotSeg = dot(joinDisplacementDir, left);
        displacementLen /= length(nDotSeg * left - joinDisplacementDir);

        // limit displacement of inner vertices
        if (!isOutside) {
          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
        }
      }

      if (isOutside && (displacementLen > miterLimit * lineWidth)) {
    `);t.roundJoins?l.vertex.code.add(g.glsl`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);
      `):l.vertex.code.add(g.glsl`
        // convert to bevel join if miterLimit is exceeded
        if (leftLen < 0.001) {
          joinDisplacementDir = right;
        }
        else if (rightLen < 0.001) {
          joinDisplacementDir = left;
        }
        else {
          joinDisplacementDir = isStartVertex ? right : left;
        }
        joinDisplacementDir = normalize(joinDisplacementDir);
        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
  `);l.vertex.code.add(g.glsl`
        displacementLen = lineWidth;
      }
    } else {
    // CAP handling ---------------------------------------------------
    if (leftLen < 0.001) {
      joinDisplacementDir = right;
    }
    else if (rightLen < 0.001) {
      joinDisplacementDir = left;
    }
    else {
      joinDisplacementDir = isStartVertex ? right : left;
    }
    joinDisplacementDir = normalize(joinDisplacementDir);
    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
    displacementLen = lineWidth;

    capDisplacementDir = isStartVertex ? -right : left;
  `);t.roundCaps?l.vertex.code.add(g.glsl`
    float angle = subdivisionFactor*PI*0.5;
    joinDisplacementDir *= cos(angle);
    capDisplacementDir *= sin(angle);
    `):l.vertex.code.add(g.glsl`
    capDisplacementDir *= subdivisionFactor;
    `);l.vertex.code.add(g.glsl`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${w||y?g.glsl`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${y?g.glsl`vLineDistance = lineDist;`:""}
  ${w?g.glsl`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `);t.stippleEnabled&&(l.vertex.code.add(g.glsl`
    {
      // Compute the stipple pattern UV coordinate from the actual position, based on the origin
      // and direction of the line segment on which the stipple pattern is based.

      // Project the vector from the origin of the segment to the vertex onto the line segment.
      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)
      vec2 posVec = pos.xy - stippleSegmentOrigin;

      float stippleSegmentDirectionLength = length(stippleSegmentDirection);
    `),t.stippleIntegerRepeatsEnabled&&l.vertex.code.add(g.glsl`
      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
      float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
      stipplePatternUvMax = roundedNumberOfPatternRepeats;
      `),l.vertex.code.add(g.glsl`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${t.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `));l.vertex.code.add(g.glsl`
      // Convert back into NDC
      pos.xy = pos.xy / screenSize * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      gl_Position = pos;
    }
  }
  `);t.multipassTerrainEnabled&&(l.fragment.include(k.ReadLinearDepth),l.include(d.multipassTerrainTest,t));l.include(f.Slice,t);l.fragment.uniforms.add("intrinsicColor","vec4");l.fragment.include(p.ColorConversion);l.fragment.code.add(g.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 color = intrinsicColor * vColor;
  `);t.innerColorEnabled&&(l.fragment.uniforms.add("pixelRatio","float"),l.fragment.code.add(g.glsl`
    float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
    float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
    float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
    color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);
    `));l.fragment.code.add(g.glsl`
    vec4 finalColor = blendStipple(color, stippleAlpha);
  `);t.falloffEnabled&&l.fragment.code.add(g.glsl`
    finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);
    `);l.fragment.code.add(g.glsl`
    if (finalColor.a < ${g.glsl.float(c.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===t.output?g.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===t.output?g.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===t.output&&t.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${4===t.output?g.glsl`gl_FragColor = vec4(1.0);`:""}
    ${1===t.output?g.glsl`outputDepth(linearDepth);`:""}
  }
  `);return l}var v=Object.freeze({__proto__:null,build:u});a.RibbonLineShader=v;a.build=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.RibbonVertexPosition=function(b,p){b.vertex.uniforms.add("intrinsicWidth","float");p.vvSize?(b.attributes.add("sizeFeatureAttribute","float"),b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset",
"vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(g.glsl`
    float getSize() {
      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
    }
    `)):(b.attributes.add("size","float"),b.vertex.code.add(g.glsl`
    float getSize(){
      return intrinsicWidth * size;
    }
    `));p.vvOpacity?(b.attributes.add("opacityFeatureAttribute","float"),b.vertex.constants.add("vvOpacityNumber","int",8),b.vertex.code.add(g.glsl`
    uniform float vvOpacityValues[vvOpacityNumber];
    uniform float vvOpacityOpacities[vvOpacityNumber];

    float interpolateOpacity( float value ){
      if (value <= vvOpacityValues[0]) {
        return vvOpacityOpacities[0];
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
        }
      }

      return vvOpacityOpacities[vvOpacityNumber - 1];
    }

    vec4 applyOpacity( vec4 color ){
      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
    }
    `)):b.vertex.code.add(g.glsl`
    vec4 applyOpacity( vec4 color ){
      return color;
    }
    `);p.vvColor?(b.attributes.add("colorFeatureAttribute","float"),b.vertex.constants.add("vvColorNumber","int",8),b.vertex.code.add(g.glsl`
    uniform float vvColorValues[vvColorNumber];
    uniform vec4 vvColorColors[vvColorNumber];

    vec4 interpolateColor( float value ) {
      if (value <= vvColorValues[0]) {
        return vvColorColors[0];
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return mix(vvColorColors[i-1], vvColorColors[i], f);
        }
      }

      return vvColorColors[vvColorNumber - 1];
    }

    vec4 getColor(){
      return applyOpacity(interpolateColor(colorFeatureAttribute));
    }
    `)):(b.attributes.add("color","vec4"),b.vertex.code.add(g.glsl`
    vec4 getColor(){
      return applyOpacity(color);
    }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(a,g,b){a.OutputDepth=function(p,f){p.fragment.include(b.RgbaFloatEncoding);3===f.output?(p.extensions.add("GL_OES_standard_derivatives"),p.fragment.code.add(g.glsl`
      float _calculateFragDepth(const in float depth) {
        // calc polygon offset
        const float SLOPE_SCALE = 2.0;
        const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)
        float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
        float result = depth + SLOPE_SCALE * m + BIAS;
        return clamp(result, .0, .999999);
      }

      void outputDepth(float _linearDepth) {
        gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
      }
    `)):1===f.output&&p.fragment.code.add(g.glsl`
      void outputDepth(float _linearDepth) {
        gl_FragColor = float2rgba(_linearDepth);
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.LineStipple=function(b,p){b.constants.add("stippleAlphaColorDiscard","float",.001);b.constants.add("stippleAlphaHighlightDiscard","float",.5);p.stippleEnabled?(b.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),p.stippleUVMaxEnabled&&b.varyings.add("stipplePatternUvMax","float"),
b.varyings.add("stipplePatternUv","float"),b.fragment.uniforms.add("stipplePatternTexture","sampler2D"),p.stippleOffColorEnabled&&b.fragment.uniforms.add("stippleOffColor","vec4"),b.fragment.code.add(g.glsl`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${p.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),p.stippleOffColorEnabled?b.fragment.code.add(g.glsl`
    #define discardByStippleAlpha(stippleAlpha, threshold) {}
    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)
    `):b.fragment.code.add(g.glsl`
    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)
    `)):b.fragment.code.add(g.glsl`
  float getStippleAlpha() { return 1.0; }

  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
  #define blendStipple(color, _stippleAlpha_) color
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.PiUtils=function(b){b.vertex.code.add(g.glsl`
    const float PI = 3.141592653589793;
  `);b.fragment.code.add(g.glsl`
    const float PI = 3.141592653589793;
    const float LIGHT_NORMALIZATION = 1.0 / PI;
    const float INV_PI = 0.3183098861837907;
    const float HALF_PI = 1.570796326794897;
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./Camera"],function(a,g){return function(){function b(p,f,k,c,d,e){this.rctx=p;this.offscreenRenderingHelper=f;this.scenelightingData=k;this.shadowMap=c;this.ssaoHelper=d;this.sliceHelper=e;this.camera=null;this.lastFrameCamera=new g;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=
!1}b.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=13};a._createClass(b,[{key:"isHighlightPass",get:function(){return 5===this.pass}}]);return b}()})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/MapUtils ./Material ./ChangeSet ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){a.SortedRenderGeometryRenderer=function(r){function C(){var x=r.apply(this,arguments)||this;x._pendingAddsRemoves=new Map;x._changes=new y.ChangeSet;x._materialRenderers=new Map;x._sortedMaterialRenderers=new v;x._hasHighlights=!1;x._hasWater=!1;return x}g._inheritsLoose(C,r);var A=C.prototype;A.dispose=function(){this._changes.prune();this._materialRenderers&&(this._materialRenderers.forEach(x=>x.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())};
A.stopAnimationsAtTime=function(x){this._sortedMaterialRenderers.forAll(m=>f.applySome(m.material.animation,B=>B.stopAtTime(x)))};A.commitChanges=function(){let x=!1;if(!this.updating)return!1;this.updateAddsRemoves();let m=!1,B=!1;D.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((E,F)=>{let G=this._materialRenderers.get(F);!G&&0<E.adds.length&&(G=new z(this.rctx,this.materialRepository,F),this._materialRenderers.set(F,G),B=m=x=!0);if(G){var I=m||G.hasHighlights,K=B||G.hasWater;G.modify(E);
m=m||I!==G.hasHighlights;B=B||K!==G.hasWater;G.isEmpty&&(this._materialRenderers.delete(F),G.dispose(),x=!0)}});this._changes.clear();this._pendingAddsRemoves.clear();x&&this.updateSortedMaterialRenderers();m&&(this._hasHighlights=l.someMap(this._materialRenderers,E=>E.hasHighlights));B&&(this._hasWater=l.someMap(this._materialRenderers,E=>E.hasWater));this.notifyChange("updating");return!0};A.add=function(x){if(0!==x.length){var m=0===this._pendingAddsRemoves.size;for(const B of x)this._pendingAddsRemoves.set(B,
0);m&&this.notifyChange("updating")}};A.remove=function(x){const m=0===this._pendingAddsRemoves.size;for(const B of x)x=this._pendingAddsRemoves.get(B),0===x?this._pendingAddsRemoves.set(B,2):2!==x&&this._pendingAddsRemoves.set(B,1);m&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};A.modify=function(x,m){const B=0===this._changes.updates.length;for(const E of x)x=this._changes.updates.pushNew(),x.renderGeometry=E,x.updateType=m;B&&0<this._changes.updates.length&&this.notifyChange("updating")};
A.updateLogic=function(x){let m=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:B})=>{B.updateLogic&&B.updateLogic(x)&&(m=!0)});return m};A.draw=function(x,m){for(let B=0;B<this._sortedMaterialRenderers.length;B++){const E=this._sortedMaterialRenderers.data[B];w.materialPredicate(E.material,x)&&E.materialRenderer.render(null,x,m,null)}};A.updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let x=0;this._materialRenderers.forEach((m,B)=>{B.insertOrder=x++;this._sortedMaterialRenderers.push({material:B,
materialRenderer:m})});this._sortedMaterialRenderers.sort((m,B)=>{const E=B.material.renderPriority-m.material.renderPriority;return 0!==E?E:m.material.insertOrder-B.material.insertOrder})};A.updateAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._pendingAddsRemoves.forEach((m,B)=>{switch(m){case 0:this._changes.adds.push(B);break;case 1:this._changes.removes.push(B)}});let x=0;for(;x<this._changes.updates.length;)this._pendingAddsRemoves.has(this._changes.updates.data[x].renderGeometry)?
this._changes.updates.removeUnorderedIndex(x):x++};g._createClass(C,[{key:"updating",get:function(){return 0<this._pendingAddsRemoves.size||0<this._changes.updates.length}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return l.someMap(this._materialRenderers,x=>x.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);
return C}(t);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",void 0);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);a.SortedRenderGeometryRenderer=b.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports",
"../../../../core/PooledArray"],function(a,g){let b=function(){function f(){this.adds=new g;this.removes=new g;this.updates=new g({allocator:c=>c||new p,deallocator:c=>{c.renderGeometry=null;return c}})}var k=f.prototype;k.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};k.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return f}(),p=function(){};a.ChangeSet=b;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,g){a.splitRenderGeometryChangeSetByMaterial=function(b){const p=new Map,f=k=>{let c=p.get(k);c||(c=new g.MaterialChangeSet,p.set(k,c));return c};b.adds.forAll(k=>{1<=k.data.indexCount&&f(k.material).adds.push(k)});b.removes.forAll(k=>{1<=k.data.indexCount&&f(k.material).removes.push(k)});b.updates.forAll(k=>{1<=k.renderGeometry.data.indexCount&&
f(k.renderGeometry.material).updates.push(k)});return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../core/MapUtils ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/Util ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject ./utils ../../lib/ResizableFloat32Array ../WaterGLMaterial ./Instance ../../statistics/RendererPerformanceInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){function l(C,A,x,m){const B=new Map,E=A.vertexBufferLayout.stride/4,F=(G,I)=>{var K=G.origin;const J=C.get(K.id);let L=B.get(K.id);null==L&&(L={optimalCount:null==J?0:J.optimalCount,sparseCount:null==J?0:J.buffer.size,toAdd:[],toRemove:[],origin:K.vec3},B.set(K.id,L));K=A.elementCount(G.data)*E;I?(L.optimalCount+=K,L.sparseCount+=K,L.toAdd.push(G)):(L.optimalCount-=K,L.toRemove.push(G))};for(const G of x)F(G,!0);for(const G of m)F(G,!1);return B}let w=function(){function C(x,
m,B){this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=x;this._material=B;this._materialRep=m;this._glMaterials=n.acquireMaterials(this._material,this._materialRep);this._bufferWriter=B.createBufferWriter()}var A=C.prototype;A.dispose=function(){n.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(x=>{x.vao.dispose(!0);x.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=null);this._glMaterials&&
(this._glMaterials.forEach(x=>{x&&x.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};A.modify=function(x){this.updateGeometries(x.updates);this.addAndRemoveGeometries(x.adds,x.removes);this.updateRenderCommands()};A.addAndRemoveGeometries=function(x,m){const B=this._bufferWriter,E=B.vertexBufferLayout,F=E.stride/4,G=this._dataByOrigin,I=l(G,B,x,m);I.forEach((K,J)=>{I.delete(J);var L=K.optimalCount;const P=K.sparseCount;let Q=G.get(J);if(null==Q)c.assert(0<L),Q=this.createData(E,L,K.origin),
G.set(J,Q);else if(0===L){Q.vao.dispose(!0);Q.vao=null;G.delete(J);return}const X=L<K.sparseCount/2;J=y;const aa=Q.buffer.size,S=Q.buffer.array;L=Q.buffer.resize(X?L:P,!1);X||L?this.removeAndRebuild(Q,K.toRemove,F,S,J):0<K.toRemove.length?(this.removeByErasing(Q,K.toRemove,F,J),0<K.toAdd.length&&(J.end=aa)):(J.begin=aa,J.end=aa);L=D;c.setMatrixTranslation3(L,-K.origin[0],-K.origin[1],-K.origin[2]);this.append(Q,K.toAdd,F,L,J);K=Q.vao.vertexBuffers.geometry;if(K.byteSize!==Q.buffer.array.buffer.byteLength)K.setData(Q.buffer.array);
else{const {begin:H,end:R}=J;H<R&&(J=4*H,K.setSubData(Q.buffer.array,J,J,4*R))}Q.drawCommandsDirty=!0})};A.updateGeometries=function(x){const m=this._bufferWriter,B=m.vertexBufferLayout.stride/4;for(const G of x){var E=G.updateType;x=G.renderGeometry;const I=this._dataByOrigin.get(x.origin.id),K=I&&I.instances.get(x.id);if(!K)break;E&1&&(K.isVisible=x.instanceParameters.visible);if(E&9){var F=x.instanceParameters.visible;K.hasHighlights=!!x.instanceParameters.highlights&&F}E&16&&(K.hasOccludees=!!x.instanceParameters.occludees);
E&6&&(E=I.buffer.array,F=I.vao,n.calculateTransformRelToOrigin(x,z,r),m.write({transformation:z,invTranspTransformation:r},x.data,m.vertexBufferLayout.createView(E.buffer),K.from),c.assert(K.from+m.elementCount(x.data)===K.to,"material VBO layout has changed"),F.vertexBuffers.geometry.setSubData(E,K.from*B*4,K.from*B*4,K.to*B*4));I.drawCommandsDirty=!0}};A.updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(m=>{m.hasHiddenInstances=!1;m.hasHighlights=
!1;m.hasOccludees=!1;p.someMap(m.instances,B=>{B.isVisible?(B.hasHighlights&&(this._hasHighlights=!0,m.hasHighlights=!0),B.hasOccludees&&(this._hasOccludees=!0,m.hasOccludees=!0)):m.hasHiddenInstances=!0;return m.hasHiddenInstances&&m.hasHighlights&&m.hasOccludees})});const x=m=>{m.drawCommandsDefault=null;m.drawCommandsHighlight=null;m.drawCommandsOccludees=null;m.drawCommandsShadowHighlightRest=null;m.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0};if(0!==m.instances.size)if(m.hasOccludees||
m.hasHighlights||m.hasHiddenInstances){var B=v.sortInstancesAccordingToRange([...m.instances.values()]);m.drawCommandsDefault=[];m.drawCommandsHighlight=[];m.drawCommandsOccludees=[];m.drawCommandsShadowHighlightRest=[];for(const E of B)E.isVisible&&(E.hasOccludees?v.addOrMerge(m.drawCommandsOccludees,E):v.addOrMerge(m.drawCommandsDefault,E),E.hasHighlights?v.addOrMerge(m.drawCommandsHighlight,E):v.addOrMerge(m.drawCommandsShadowHighlightRest,E));B=E=>{let F=0;for(const G of E)F+=G.count;return F/
3};m.stats={default:B(m.drawCommandsDefault),highlight:B(m.drawCommandsHighlight),occludees:B(m.drawCommandsOccludees),shadowHighlightRest:B(m.drawCommandsShadowHighlightRest)}}else B=4*m.buffer.size/e.getStride(m.vao.layout.geometry),m.drawCommandsDefault=[{first:0,count:B}],m.stats={default:B,highlight:0,occludees:0,shadowHighlightRest:0}};this._dataByOrigin.forEach(m=>{m.drawCommandsDirty&&(x(m),m.drawCommandsDirty=!1)})};A.updateLogic=function(x){return this._material.update(x)};A.render=function(x,
m,B,E){const F=this._rctx,G=this._glMaterials.get(m.pass),I=5===m.pass||7===m.pass,K=6===m.pass,J=!(I||K);let L=x;3===m.pass&&null===L&&(L=22);if(!G||2!==G.ensureResources(F)||null!=L&&!G.beginSlot(L)||I&&!this._hasHighlights)return!1;G.ensureParameters(B);const P=G.getTechnique(),Q=G.getPipelineState(L,!1);F.setPipelineState(Q);G.bind(F,B);let X=!1;this._dataByOrigin.forEach(aa=>{if(!(g.isNone(aa.drawCommandsDefault)&&g.isNone(aa.drawCommandsHighlight)&&g.isNone(aa.drawCommandsOccludees)&&g.isNone(aa.drawCommandsShadowHighlightRest)||
I&&!aa.hasHighlights)){B.origin=aa.origin;P.bindDraw(B);P.ensureAttributeLocations(aa.vao);F.bindVAO(aa.vao);var S=P.primitiveType,H=I?aa.drawCommandsHighlight:K&&(aa.hasOccludees||aa.hasHighlights||aa.hasHiddenInstances)?aa.drawCommandsShadowHighlightRest:aa.drawCommandsDefault,R=I?aa.stats.highlight:K&&(aa.hasOccludees||aa.hasHighlights||aa.hasHiddenInstances)?aa.stats.shadowHighlightRest:aa.stats.default;g.isSome(H)&&(this.renderCommands(F,S,H),t.addToRenderStats(H.length,R,E),X=!0);J&&(H=aa.drawCommandsOccludees,
g.isSome(H)&&(R=G.getPipelineState(L,!0),F.setPipelineState(R),this.renderCommands(F,S,H),F.setPipelineState(Q),t.addToRenderStats(H.length,aa.stats.occludees,E),X=!0))}});return X};A.renderCommands=function(x,m,B){for(let E=0;E<B.length;E++)x.drawArrays(m,B[E].first,B[E].count)};A.createData=function(x,m,B){return{instances:new Map,vao:new h(this._rctx,this._material.vertexAttributeLocations,{geometry:k.glLayout(x)},{geometry:d.createVertex(this._rctx,35044)}),buffer:new q.ResizableFloat32Array(m),
optimalCount:0,origin:B,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}};A.removeAndRebuild=function(x,m,B,E,F){for(const P of m){m=P.id;const Q=x.instances.get(m);x.optimalCount-=(Q.to-Q.from)*B;x.instances.delete(m)}let G=0;const I=x.buffer.array;F.begin=0;F.end=0;let K=-1,J=-1,L=0;x.instances.forEach(P=>
{const Q=P.from*B,X=P.to*B,aa=X-Q;K!==J&&J!==Q?(I.set(E.subarray(K,J),L),L+=J-K,K=Q):-1===K&&(K=Q);J=X;P.from=G/B;G+=aa;P.to=G/B});K!==J&&I.set(E.subarray(K,J),L);F.end=G};A.removeByErasing=function(x,m,B,E){E.begin=Infinity;E.end=-Infinity;let F=-1,G=-1;for(const K of m){m=K.id;var I=x.instances.get(m);const J=I.from*B;I=I.to*B;F!==G&&G!==J?(x.buffer.erase(F,G),F=J):-1===F&&(F=J);G=I;x.instances.delete(m);x.optimalCount-=I-J;J<E.begin&&(E.begin=J);I>E.end&&(E.end=I)}F!==G&&x.buffer.erase(F,G)};A.append=
function(x,m,B,E,F){const G=this._bufferWriter;for(const K of m){var I=g.isSome(K.transformation)?b.multiply(z,E,K.transformation):E;b.invert(r,I);b.transpose(r,r);m=F.end;G.write({transformation:I,invTranspTransformation:r},K.data,G.vertexBufferLayout.createView(x.buffer.array.buffer),F.end/B);I=G.elementCount(K.data)*B;const J=m+I;c.assert(null==x.instances.get(K.id));const L=K.instanceParameters.visible;m=new v.Instance(m/B,J/B,L,!!K.instanceParameters.highlights&&L,!!K.instanceParameters.occludees);
x.instances.set(K.id,m);x.optimalCount+=I;F.end+=I}};a._createClass(C,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&p.someMap(this._glMaterials,x=>x instanceof u.WaterGLMaterial)}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"test",get:function(){return{material:this._material,
glMaterials:this._glMaterials}}}]);return C}();const y={begin:0,end:0},D=f.create(),z=f.create(),r=f.create();return w})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(a,g,b){let p=function(){function f(c){null==c?c=16:65536>c&&(c=b.nextHighestPowerOfTwo(c));this._array=new Float32Array(c);this._size=0}var k=f.prototype;k.resize=function(c,d){this._size=c;if(this._size>this._array.length){for(c=
this._array.length||1;c<this._size;)c*=2;c=new Float32Array(c);d&&c.set(this._array);this._array=c;return!0}var e=2*this._size;if(e<=this._array.length){for(c=this._array.length;c>=e;)c=Math.floor(c/2);e=new Float32Array(c);d&&e.set(this._array.subarray(0,c));this._array=e;return!0}return!1};k.append=function(c){const d=this._size;this.resize(this._size+c.length,!0);this._array.set(c,d)};k.erase=function(c,d){for(;c<d;++c)this._array[c]=0};g._createClass(f,[{key:"array",get:function(){return this._array}},
{key:"size",get:function(){return this._size}}]);return f}();a.ResizableFloat32Array=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/GLMaterial","./WaterTechnique"],function(a,g,b,p){b=function(f){function k(d){d=f.call(this,d)||this;d.updateParameters();return d}g._inheritsLoose(k,f);var c=k.prototype;c.updateParameters=function(d){this.technique=this.techniqueRep.acquireAndReleaseExisting(p.WaterTechnique,
this.material.getTechniqueConfig(this.output,d),this.technique)};c.beginSlot=function(d){if(2===this.output)return 22===d;if(5===this.output)return null==d;if(4===this.output)return 3===d;let e=3;this.material.params.transparent&&(e=this.material.params.writeDepth?5:8);return d===e};c.setElapsedTimeUniform=function(d){d.setUniform1f("timeElapsed",.001*this.material.animation.time*this.material.params.animationSpeed)};c._updateShadowState=function(d){d.shadowMappingEnabled!==this.material.params.receiveShadows&&
this.material.setParameterValues({receiveShadows:d.shadowMappingEnabled})};c._updateSSRState=function(d){d.ssrEnabled!==this.material.params.ssrEnabled&&this.material.setParameterValues({ssrEnabled:d.ssrEnabled})};c.ensureResources=function(d){return this.technique.ensureResource(d)};c.ensureParameters=function(d){0===this.output&&(this._updateShadowState(d),this._updateSSRState(d));this.updateParameters(d)};c.bind=function(d,e){d.bindProgram(this.technique.program);this.technique.bindPass(d,this.material.params,
e);2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)};return k}(b);a.WaterGLMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../lib/DefaultTextureUnits ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../../../../chunks/WaterSurface.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){k=function(r){function C(x,m){m=r.call(this,x,m)||this;m.waterTextureRepository=x.waterTextureRepository;return m}b._inheritsLoose(C,r);var A=C.prototype;A.initializeProgram=function(x){var m=C.shader.get();const B=this.configuration;m=m.build({OITEnabled:0===B.transparencyPassType,output:B.output,viewingMode:x.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:B.receiveShadows,
pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:B.useSSR,highStepCount:!0,multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new e(x.rctx,m.generateSource("vertex"),m.generateSource("fragment"),d.Default3D)};A.ensureResource=function(x){this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(x);return this.waterTextureRepository.ready?2:1};A.bindPass=function(x,m,B){n.View.bindProjectionMatrix(this.program,
B.camera.projectionMatrix);B.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",B.camera.nearFar),this.program.setUniform2fv("inverseViewport",B.inverseViewport),l.bindMultipassTerrainUniforms(this.program,x,B));0===this.configuration.output&&(B.lighting.setUniforms(this.program,!1),y.ScreenSpaceReflections.bindUniforms(this.program,x,B));if(0===this.configuration.output||2===this.configuration.output)D.WaterDistortion.bindUniforms(this.program,m),this.waterTextureRepository.bindRepo(x);
this.program.setUniform4fv("waterColor",m.color);4===this.configuration.output&&v.OutputHighlight.bindOutputHighlight(x,this.program,B)};A.bindDraw=function(x){n.View.bindView(this.program,x);0!==this.configuration.output&&7!==this.configuration.output||n.View.bindCamPosition(this.program,x.origin,x.camera.viewInverseTransposeMatrix);0===this.configuration.output&&w.ReadShadowMap.bindUniforms(this.program,x,q.DefaultTextureUnits.SHADOW_MAP);0!==this.configuration.output&&7!==this.configuration.output&&
4!==this.configuration.output||u.Slice.bindUniformsWithOrigin(this.program,this.configuration,x)};A.setPipelineState=function(x){const m=this.configuration,B=3===x,E=2===x;return h.makePipelineState({blending:2!==m.output&&4!==m.output&&m.transparent?B?t.blendingDefault:t.OITBlending(x):null,depthTest:{func:t.OITDepthTest(x)},depthWrite:B?m.writeDepth&&h.defaultDepthWriteParams:t.OITDepthWrite(x),colorWrite:h.defaultColorWriteParams,polygonOffset:B||E?null:t.getOITPolygonOffset(m.enableOffset)})};
A.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return C}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(z.WaterSurface,()=>new Promise(function(r,C){a(["../shaders/WaterSurface.glsl"],r,C)}));f=function(r){function C(){var A=r.apply(this,arguments)||this;A.output=0;A.receiveShadows=!1;A.slicePlaneEnabled=!1;A.transparent=!1;A.enableOffset=!0;A.writeDepth=!1;A.useSSR=!1;A.isDraped=!1;A.transparencyPassType=3;A.multipassTerrainEnabled=
!1;A.cullAboveGround=!0;return A}b._inheritsLoose(C,r);return C}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter()],f.prototype,"receiveShadows",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"transparent",void 0);p.__decorate([c.parameter()],f.prototype,"enableOffset",void 0);p.__decorate([c.parameter()],f.prototype,"writeDepth",void 0);p.__decorate([c.parameter()],
f.prototype,"useSSR",void 0);p.__decorate([c.parameter()],f.prototype,"isDraped",void 0);p.__decorate([c.parameter({count:4})],f.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],f.prototype,"multipassTerrainEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"cullAboveGround",void 0);g.WaterTechnique=k;g.WaterTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports",
"../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(a,g,b){function p(f){f.fragment.include(b.RgbaFloatEncoding);f.fragment.uniforms.add("uShadowMapTex","sampler2D");f.fragment.uniforms.add("uShadowMapNum","int");f.fragment.uniforms.add("uShadowMapDistance","vec4");f.fragment.uniforms.add("uShadowMapMatrix","mat4",4);f.fragment.uniforms.add("uDepthHalfPixelSz","float");f.fragment.code.add(g.glsl`
    int chooseCascade(float _linearDepth, out mat4 mat) {
      vec4 distance = uShadowMapDistance;
      float depth = _linearDepth;

      //choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
      float texSize = 0.5 / halfPixelSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= uShadowMapNum) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
    }
  `)}(function(f){f.bindUniforms=function(k,c,d){c.shadowMappingEnabled&&(c.shadowMap.bind(k,d),c.shadowMap.bindView(k,c.origin))};f.bindViewCustomOrigin=function(k,c,d){c.shadowMappingEnabled&&c.shadowMap.bindView(k,d)};f.bindView=function(k,c){c.shadowMappingEnabled&&c.shadowMap.bindView(k,c.origin)}})(p||(p={}));a.ReadShadowMap=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../output/ReadLinearDepth.glsl","./Reprojection.glsl"],function(a,g,b,p){function f(k,c){k.fragment.uniforms.add("nearFar","vec2");k.fragment.uniforms.add("depthMapView","sampler2D");k.fragment.uniforms.add("ssrViewMat","mat4");k.fragment.uniforms.add("invResolutionHeight","float");k.fragment.include(b.ReadLinearDepth);k.include(p.Reprojection);k.fragment.code.add(g.glsl`
  const int maxSteps = ${c.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}(function(k){k.bindUniforms=function(c,d,e){e.ssrEnabled&&(c.setUniform1i("depthMapView",e.linearDepthTextureUnit),d.bindTexture(e.linearDepthTexture,e.linearDepthTextureUnit),c.setUniform2fv("nearFar",e.camera.nearFar),c.setUniformMatrix4fv("ssrViewMat",e.camera.viewMatrix),c.setUniform1f("invResolutionHeight",1/e.camera.height),p.Reprojection.bindUniforms(c,d,e))}})(f||(f={}));a.ScreenSpaceReflections=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,g){function b(p){p.fragment.uniforms.add("lastFrameColorMap","sampler2D");p.fragment.uniforms.add("reprojectionMat","mat4");p.fragment.uniforms.add("rpProjectionMat","mat4");p.fragment.code.add(g.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy*0.5 + 0.5;
  }
  `)}(function(p){p.bindUniforms=function(f,k,c){f.setUniform1i("lastFrameColorMap",c.lastFrameColorTextureUnit);k.bindTexture(c.lastFrameColorTexture,c.lastFrameColorTextureUnit);f.setUniformMatrix4fv("reprojectionMat",c.reprojectionMat);f.setUniformMatrix4fv("rpProjectionMat",c.camera.projectionMatrix)}})(b||(b={}));a.Reprojection=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","../../shaderModules/interfaces",
"./FoamRendering.glsl"],function(a,g,b){function p(f){f.fragment.uniforms.add("texWaveNormal","sampler2D");f.fragment.uniforms.add("texWavePerturbation","sampler2D");f.fragment.uniforms.add("waveParams","vec4");f.fragment.uniforms.add("waveDirection","vec2");f.include(b.FoamIntensity);f.fragment.code.add(g.glsl`
      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);

      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rg - 1.0;
      }

      float sampleNoiseTexture(vec2 _uv) {
        return texture2D(texWavePerturbation, _uv).b;
      }

      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
      }

      float computeProgress(vec2 uv, float time) {
        return fract(time);
      }

      float computeWeight(vec2 uv, float time) {
        float progress = computeProgress(uv, time);
        return 1.0 - abs(1.0 - 2.0 * progress);
      }

      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
        float flowStrength = waveParams[2];
        float flowOffset = waveParams[3];

        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;

        float progress = computeProgress(uv, time + phaseOffset);
        float weight = computeWeight(uv, time + phaseOffset);

        vec2 result = uv;
        result -= flowVector * (progress + flowOffset);
        result += phaseOffset;
        result += (time - progress) * FLOW_JUMP;

        return vec3(result, weight);
      }

      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
      const float TIME_NOISE_STRENGTH = 7.77;

      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
        float waveStrength = waveParams[0];

        // overall directional shift in uv's for directional wave movement for
        // now we do a hard coded scale for wave speed such that a unit length
        // direction is not too fast.
        vec2 waveMovement = time * -_waveDir;

        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;

        // compute two perturbed uvs and blend weights
        // then sample the wave normals at the two positions and blend
        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);

        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;

        // logic to flatten the wave pattern
        // scale xy components of the normal, then adjust z (up) component
        vec3 mixNormal = normalize(normal_A + normal_B);
        mixNormal.xy *= waveStrength;
        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));

        return mixNormal;
      }

      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
        float waveTextureRepeat = waveParams[1];
        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
        float foam  = normals2FoamIntensity(normal, waveParams[0]);
        return vec4(normal, foam);
      }
    `)}(function(f){f.bindUniforms=function(k,c){k.setUniform1i("texWaveNormal",0);k.setUniform1i("texWavePerturbation",1);k.setUniform4f("waveParams",c.waveStrength,c.waveTextureRepeat,c.flowStrength,c.flowOffset);k.setUniform2f("waveDirection",c.waveDirection[0]*c.waveVelocity,c.waveDirection[1]*c.waveVelocity)}})(p||(p={}));a.WaterDistortion=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,g){a.FoamColor=function(b){b.fragment.code.add(g.glsl`
    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
    }
  `)};a.FoamIntensity=function(b){b.fragment.code.add(g.glsl`
    float normals2FoamIntensity(vec3 n, float waveStrength){
      float normalizationFactor =  max(0.015, waveStrength);
      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){function l(y){const D=new p.ShaderBuilder;D.include(b.Transform,{linearDepth:!1});D.attributes.add("position","vec3");D.attributes.add("uv0","vec2");D.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");D.vertex.uniforms.add("waterColor","vec4");if(0===y.output||7===y.output)D.include(v.NormalUtils,y),D.include(u.ForwardLinearDepth,y),D.varyings.add("vuv","vec2"),D.varyings.add("vpos","vec3"),D.varyings.add("vnormal","vec3"),D.varyings.add("vtbnMatrix",
"mat3"),y.multipassTerrainEnabled&&D.varyings.add("depth","float"),D.vertex.code.add(g.glsl`
      void main(void) {
        if (waterColor.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${y.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===y.output?"forwardLinearDepth();":""}
      }
    `);y.multipassTerrainEnabled&&(D.fragment.include(c.ReadLinearDepth),D.include(h.multipassTerrainTest,y));7===y.output&&(D.include(k.Slice,y),D.fragment.uniforms.add("waterColor","vec4"),D.fragment.code.add(g.glsl`
        void main() {
          discardBySlice(vpos);
          ${y.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));0===y.output&&(D.include(q.WaterDistortion,y),D.include(k.Slice,y),y.receiveShadows&&D.include(n.ReadShadowMap,y),D.include(t.Water,y),D.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),D.fragment.include(f.ColorConversion),D.fragment.code.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${y.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        vec3 l = normalize(-lightingMainDirection);
        float shadow = ${y.receiveShadows?g.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${y.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));2===y.output&&(D.include(v.NormalUtils,y),D.include(q.WaterDistortion,y),D.include(k.Slice,y),D.varyings.add("vpos","vec3"),D.varyings.add("vuv","vec2"),D.vertex.code.add(g.glsl`
        void main(void) {
          if (waterColor.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),D.fragment.uniforms.add("timeElapsed","float"),D.fragment.code.add(g.glsl`
        void main() {
          discardBySlice(vpos);

          // the created normal is in tangent space and foam
          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);

          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
        }
    `));5===y.output&&(D.varyings.add("vpos","vec3"),D.vertex.code.add(g.glsl`
        void main(void) {
          if (waterColor.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),D.fragment.uniforms.add("waterColor","vec4"),D.fragment.code.add(g.glsl`
        void main() {
          gl_FragColor = waterColor;
        }
    `));4===y.output&&(D.include(d.OutputHighlight),D.varyings.add("vpos","vec3"),D.vertex.code.add(g.glsl`
      void main(void) {
        if (waterColor.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),D.include(k.Slice,y),D.fragment.code.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        outputHighlight();
      }
    `));return D}var w=Object.freeze({__proto__:null,build:l});a.WaterSurface=w;a.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,g){a.ForwardLinearDepth=function(b,p){0===p.output&&p.receiveShadows?(b.varyings.add("linearDepth","float"),b.vertex.code.add(g.glsl`
      void forwardLinearDepth() { linearDepth = gl_Position.w; }
    `)):1===p.output||3===p.output?(b.varyings.add("linearDepth","float"),b.vertex.uniforms.add("cameraNearFar","vec2"),b.vertex.code.add(g.glsl`
      void forwardLinearDepth() {
        linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
      }
    `)):b.vertex.code.add(g.glsl`
      void forwardLinearDepth() {}
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.NormalUtils=function(b,p){1===p.viewingMode?b.vertex.code.add(g.glsl`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return normalize(pos + origin);
      }
    `):b.vertex.code.add(g.glsl`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code
      }
    `);1===p.viewingMode?b.vertex.code.add(g.glsl`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `):b.vertex.code.add(g.glsl`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = vec3(1.0, 0.0, 0.0);
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ../../shaderModules/interfaces ./ScreenSpaceReflections.glsl ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl".split(" "),function(a,g,b,p,f,k){a.Water=function(c,d){c.include(k.PhysicallyBasedRendering,d);c.include(f.Gamma);c.include(p.FoamColor);d.ssrEnabled&&c.include(b.ScreenSpaceReflections,d);c.fragment.constants.add("fresnelSky",
"vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]);c.fragment.code.add(g.glsl`
    PBRShadingWater shadingInfo;

    /*
    *   This function is an approximation for the sky gradient reflected
    *   the water surface and describes a combination of two fresnel terms.
    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)
    *   @parameter: horizon = the dominant color of the sky horizon
    *   @parameter: cosTheta = the dominant color of the sky zenit
    */
    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
      return mix(zenit, horizon, exponent);
    }

    /*
    *   This function determines the water color per pixel.
    *   @parameter: n = normal facing away from the surface
    *   @parameter: v = view direction facing away from the surface.
    *   @parameter: l = light direction facing away from the surface
    *   @parameter: lightIntensity = light intensity, currently between 0...PI
    *   @parameter: localUp = a normal for the general direction of the surface
    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)
    */
    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {

      float reflectionHit = 0.;
      vec3 seaWaterColor = linearizeGamma(color);
      // using half vector to determine the specular light
      vec3 h = normalize(l + v);
      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);

      // angle between vertex normal and view direction
      float upDotV = max(dot(localUp,v), 0.0);
      // reflected sky color: the reflected sky color consists of two main colors, the
      // reflected color at the horizon and the reflected color of the zenit.
      // the reflected sky color is then an approximation based on the fresnel term.
      vec3 skyHorizon = linearizeGamma(skyColor);
      vec3 skyZenit = linearizeGamma(skyZenitColor);
      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );

      // we use the upDotL to smoothen out the
      // reflected color of the water
      float upDotL = max(dot(localUp,l),0.0);

      // The approximated sky color is adjusted according to the sun position.
      // This is done as approximation for e.g. night views.
      float daytimeMod = 0.1 + upDotL * 0.9;
      skyColor *= daytimeMod;

      // If a water surface is in shadow we just use a slight darkening of the
      // water surface expressed with this shadowModifier.
      float shadowModifier = clamp(shadow, 0.8, 1.0);

      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.
      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long
      // as reflection are absent there is a need to have a slight shadow for depth perception.
      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;

      // The reflected sea color is the input water color combined with the reflected sky color.
      // The reflected sky color is modified by the incoming light.
      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;

      vec3 specular = vec3(0.0);
      // This prevents the specular light to be rendered when:
      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)
      // - viewer is under water (for this localUp is better than n)
      if(upDotV > 0.0 && upDotL > 0.0) {
        // calculate the cook torrance BRDF but with simplified occlusion
        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);

        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here
        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;

        specular = shadingInfo.NdotL * incidentLight * specularSun;
      }

      vec3 foam = vec3(0.0);
      if(upDotV > 0.0) {
        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
      }
      `);d.ssrEnabled?c.fragment.code.add(g.glsl`
      // Convert the world position to view position
      vec4 viewPosition = vec4(positionView.xyz, 1.0);
      vec3 viewDir = normalize(viewPosition.xyz);
      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);

      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal
      // this removes some artifacts of normal mapping
      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);

      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));

      // perform screen space reflection to detect hit
      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
      vec3 reflectedColor = vec3(0.0);

      // if there is a hit with ssr find reflected color from the reprojeted frame
      if (hitCoordinate.z > 0.0)
      {
        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);

        // fade out if there if the hit is near end of Y axis
        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;

        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
      }
      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
    }
  `):c.fragment.code.add(g.glsl`
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.Gamma=function(b){b.fragment.code.add(g.glsl`
    const float GAMMA = 2.2;
    const float INV_GAMMA = 0.4545454545;

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","../../shaderModules/interfaces","./PiUtils.glsl","./AnalyticalSkyModel.glsl"],function(a,g,b,p){a.PhysicallyBasedRendering=function(f,k){const c=f.fragment.code;f.include(b.PiUtils);if(3===k.pbrMode||4===k.pbrMode)c.add(g.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${k.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),c.add(g.glsl`
    vec3 fresnelReflection(float angle, vec3 f0, float f90) {
      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
    }
    `),c.add(g.glsl`
    float normalDistributionWater(float NdotH, float roughness)
    {
      float r2 = roughness * roughness;
      float NdotH2 = NdotH * NdotH;
      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
      return r2 / denom;
    }
    `),c.add(g.glsl`
    float geometricOcclusionKelemen(float LoH)
    {
        return 0.25 / (LoH * LoH);
    }
    `),c.add(g.glsl`
    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
    {
      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
      float dSun = normalDistributionWater(props.NdotH, roughness);
      float V = geometricOcclusionKelemen(props.LdotH);

      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
      float strengthSunHaze  = 1.2;
      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;

      return ((dSun + dSunHaze) * V) * F;
    }

    vec3 tonemapACES(const vec3 x) {
      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
    }
    `);else if(1===k.pbrMode||2===k.pbrMode)f.include(p.AnalyticalSkyModel),c.add(g.glsl`
    struct PBRShadingInfo
    {
        float NdotL;                  // cos angle between normal and light direction
        float NdotV;                  // cos angle between normal and view direction
        float NdotH;                  // cos angle between normal and half vector
        float VdotH;                  // cos angle between view direction and half vector
        float LdotH;                  // cos angle between view light direction and half vector
        float NdotNG;                 // cos angle between normal and normal of the ground
        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground
        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination
        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination
        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)
        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)
        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)
        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)

        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping
        float ssao;                   // ssao coefficient
        vec3 albedoLinear;            // linear color of the albedo
        vec3 f0;                      // fresnel value at normal incident light
        vec3 f90;                     // fresnel value at 90o of incident light

        vec3 diffuseColor;            // diffuse color of the material used in environment illumination
        float metalness;              // metalness of the material
        float roughness;              // roughness of the material
    };
    `),c.add(g.glsl`
    float normalDistribution(float NdotH, float roughness)
    {
        float a = NdotH * roughness;
        float b = roughness / (1.0 - NdotH * NdotH + a * a);
        return b * b * INV_PI;
    }
    `),c.add(g.glsl`
    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
    const vec2 c2 = vec2(-1.04, 1.04);

    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
        vec4 r = roughness * c0 + c1;
        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
        return c2 * a004 + r.zw;
    }
    `),c.add(g.glsl`
    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);

      // From diffuse illumination calculate reflected color
      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;

      // From specular illumination calculate reflected color
      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
      vec3 specularComponent = specularColor * indirectSpecular;

      return (diffuseComponent + specularComponent);
    }
    `),c.add(g.glsl`
    float gamutMapChanel(float x, vec2 p){
      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
    }`),c.add(g.glsl`
    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
      vec3 outColor;
      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
      outColor.x = gamutMapChanel(inColor.x, p) ;
      outColor.y = gamutMapChanel(inColor.y, p) ;
      outColor.z = gamutMapChanel(inColor.z, p) ;
      return outColor;
    }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(g.glsl`
    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
    {
      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
    }
    `);b.add(g.glsl`
    float integratedRadiance(float cosTheta2, float roughness)
    {
      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
    }
    `);b.add(g.glsl`
    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
    {
      float cosTheta2 = 1.0 - RdotNG * RdotNG;
      float intRadTheta = integratedRadiance(cosTheta2, roughness);

      // Calculate the integrated directional radiance of the ground and the sky
      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
      float sky = 2.0 - ground;
      return (ground * ambientGround + sky * ambientSky) * 0.5;
    }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/mat4","../../../../../chunks/mat4f64"],function(a,g,b){a.Instance=function(p,f,k,c,d,e){this.from=p;this.to=f;this.isVisible=k;this.hasHighlights=c;this.hasOccludees=d;this.transformation=e;null!=e&&(this.transformationNormal=b.clone(e),g.invert(this.transformationNormal,this.transformationNormal),g.transpose(this.transformationNormal,
this.transformationNormal))};a.addOrMerge=function(p,f){if(0===p.length)p.push({first:f.from,count:f.to-f.from});else{var k=p[p.length-1];var c=k.first+k.count>=f.from?!0:!1;c?k.count=f.from-k.first+f.to-f.from:p.push({first:f.from,count:f.to-f.from})}};a.sortInstancesAccordingToRange=function(p){return p.sort((f,k)=>f.from===k.from?f.to>k.to?1:f.to<k.to?-1:0:f.from>k.from?1:f.from<k.from?-1:0)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/accessorSupport/utils ../../../../core/PerformanceSampler ../../../webgl/Measurement".split(" "),
function(a,g,b,p,f,k){const c="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let d=function(){function n(){this.drawCalls=this.triangles=0}n.prototype.reset=function(){this.drawCalls=this.triangles=0};return n}(),e=function(n){function q(){var u=n.call(this,"total")||this;u.total=0;u.frameCount=0;return u}g._inheritsLoose(q,n);
return q}(f),h=function(){function n(){this._enableGPUTimer=this._lastSample=this._startTime=0;this.totalTime=new e;this.gpuTime=new f("gpu",9);this.renderPassTimings=c.map(u=>new f(u));this.stats=new d}var q=n.prototype;q.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:p.once(()=>--this._enableGPUTimer)}};q.prerender=function(u){this._startTime=this._lastSample=performance.now();this._enableGPUTimer&&(this._gpuTimer=k.startMeasurement(u))};q.advance=function(u){const v=performance.now();
this.renderPassTimings[u].record(v-this._lastSample);this._lastSample=v};q.postrender=function(){b.isSome(this._gpuTimer)&&(this._gpuTimer.stop(v=>b.isSome(v)&&this.gpuTime.record(v),16),this._gpuTimer=null);const u=performance.now()-this._startTime;this.totalTime.record(u);this.totalTime.total+=u;this.totalTime.frameCount++};return n}();a.RenderStats=d;a.RenderTime=e;a.RendererPerformanceInfo=h;a.addToRenderStats=function(n,q,u){b.isSome(u)&&(u.drawCalls+=n,u.triangles+=q)};a.performanceStatsCategories=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(a,g){let b=function(){function k(d){this.timer=d;this.start=d.createQuery();d.createTimestamp(this.start)}var c=k.prototype;c.stop=function(d,e=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this.checkQueryResult(d,e)};c.checkQueryResult=function(d,e){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())d(null);else{var h=
this.timer.getResult(this.start),n=this.timer.getResult(this.end);d((n-h)/1E6)}else setTimeout(()=>this.checkQueryResult(d,e),e)};return k}(),p=function(){function k(d){this.timer=d;this.query=d.createQuery();f=!0;this.timer.beginTimeElapsed(this.query)}var c=k.prototype;c.stop=function(d,e=50){this.timer.endTimeElapsed();f=!1;this.checkQueryResult(d,e)};c.checkQueryResult=function(d,e){var h=this.timer.resultAvailable(this.query);const n=this.timer.disjoint();h&&!n?(h=this.timer.getResult(this.query),
d(h/1E6)):n?d(null):setTimeout(()=>this.checkQueryResult(d,e),e)};return k}(),f=!1;a.startMeasurement=function(k){k=k.capabilities.disjointTimerQuery;return g.isNone(k)?null:0<k.timestampBits()?new b(k):f?null:new p(k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/TextureOnly.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build();return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.initializePipeline=function(){return this.configuration.hasAlpha?h.makePipelineState({blending:h.separateBlendingParams(770,1,771,771),colorWrite:h.defaultColorWriteParams}):h.makePipelineState({colorWrite:h.defaultColorWriteParams})};
return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.TextureOnlyShader,()=>new Promise(function(q,u){a(["../core/shaderLibrary/util/TextureOnly.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.hasAlpha=!1;return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter()],f.prototype,"hasAlpha",void 0);g.TextureTechnique=k;g.TextureTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass"],function(a,g,b,p){function f(){const c=new b.ShaderBuilder;c.include(p.ScreenSpacePass);c.fragment.uniforms.add("tex","sampler2D");c.fragment.uniforms.add("color","vec4");c.fragment.code.add(g.glsl`
    void main() {
      vec4 texColor = texture2D(tex, uv);
      gl_FragColor = texColor * color;
    }
  `);return c}var k=Object.freeze({__proto__:null,build:f});a.TextureOnlyShader=k;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces"],function(a,g){a.ScreenSpacePass=function(b){b.attributes.add("position","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(g.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../../../../chunks/vec3","./SphericalHarmonics"],function(a,g,b,p,f){const k=b.create();let c=function(){function d(){this._renderLighting={main:{intensity:b.create(),direction:b.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight=
{direction:b.create(),ambient:{color:b.create(),intensity:0},diffuse:{color:b.create(),intensity:0}}}var e=d.prototype;e.setLightDirectionUniform=function(h){h.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};e.setUniforms=function(h,n=!1){n?h.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):h.setUniform1f("lightingFixedFactor",0);h.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(h);
h.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);h.setUniform1f("ambientBoostFactor",.4);n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?h.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(h.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),h.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),h.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(h.setUniform3f("lightingAmbientSH0",
n.r[0],n.g[0],n.b[0]),h.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),h.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),h.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),h.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),h.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),h.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))};e.set=function(h){this._info=h;f.combineLights(h.lights,this._shOrder,this._renderLighting);
p.negate(this._oldSunlight.direction,this._renderLighting.main.direction);h=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*h;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*h;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*h;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*h;this._oldSunlight.diffuse.color[1]=
this._renderLighting.main.intensity[1]*h;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*h;this._oldSunlight.diffuse.intensity=1;h=p.copy(k,this._oldSunlight.diffuse.color);p.scale(h,h,.4*this._info.globalFactor);p.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,h)};g._createClass(d,[{key:"globalFactor",get:function(){return this._info.globalFactor}},{key:"old",get:function(){return this._oldSunlight}}]);return d}();a.SceneLighting=c;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ./Lightsources ../lib/LongVectorMath".split(" "),function(a,g,b,p,f,k){function c(z){return(z+1)*(z+1)}function d(z){return g.clamp(Math.floor(Math.sqrt(z)-1),0,2)}function e(z,r,C){const A=z[0],x=z[1];z=z[2];C=C||[];C.length=c(r);0<=r&&(C[0]=.28209479177);1<=r&&(C[1]=.4886025119*A,C[2]=.4886025119*z,C[3]=.4886025119*
x);2<=r&&(C[4]=1.09254843059*A*x,C[5]=1.09254843059*x*z,C[6]=.31539156525*(3*z*z-1),C[7]=1.09254843059*A*z,C[8]=.54627421529*(A*A-x*x));return C}function h(z,r){z=c(z);r=r||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=z;for(let C=0;C<z;C++)r.r[C]=r.g[C]=r.b[C]=0;return r}function n(z,r){const C=d(r.r.length);for(const A of z)p.negate(y,A.direction),e(y,C,l),k.elementwiseProduct(l,D),k.scalarProduct(l,A.intensity[0],w),k.add(r.r,w),k.scalarProduct(l,A.intensity[1],w),k.add(r.g,w),k.scalarProduct(l,
A.intensity[2],w),k.add(r.b,w);return r}function q(z,r){e(y,0,l);for(const C of z)r.r[0]+=l[0]*D[0]*C.intensity[0]*4*Math.PI,r.g[0]+=l[0]*D[0]*C.intensity[1]*4*Math.PI,r.b[0]+=l[0]*D[0]*C.intensity[2]*4*Math.PI;return r}const u=[],v=[],t=[],l=[0],w=[0],y=b.create(),D=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(z,r,C){h(r,C.sphericalHarmonics.sh);p.set(C.main.intensity,0,0,0);r=!1;u.length=0;v.length=0;t.length=0;for(const A of z)A instanceof
f.MainLight&&!r?(p.copy(C.main.direction,A.direction),C.main.intensity[0]=A.intensity[0],C.main.intensity[1]=A.intensity[1],C.main.intensity[2]=A.intensity[2],C.main.castShadows=A.castShadows,r=!0):A instanceof f.MainLight||A instanceof f.FillLight?u.push(A):A instanceof f.AmbientLight?v.push(A):A instanceof f.SphericalHarmonicsLight&&t.push(A);n(u,C.sphericalHarmonics.sh);q(v,C.sphericalHarmonics.sh);for(const A of t)k.add(C.sphericalHarmonics.sh.r,A.sh.r),k.add(C.sphericalHarmonics.sh.g,A.sh.g),
k.add(C.sphericalHarmonics.sh.b,A.sh.b)};a.computeCoefficients=e;a.initSHCoefficients=h;a.numberOfCoefficients=c;a.numberOfCoefficientsInBand=function(z){return 2*z+1};a.orderFromNumberOfCoefficients=d;a.projectAmbientLights=q;a.projectFillLights=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(g,b,p){p=p||g;p.length=g.length;for(let f=0;f<g.length;f++)p[f]=g[f]+b[f];return p};a.dotProduct=
function(g,b){let p=0;for(let f=0;f<g.length;f++)p+=g[f]*b[f];return p};a.elementwiseProduct=function(g,b,p){p=p||g;p.length=g.length;for(let f=0;f<g.length;f++)p[f]=g[f]*b[f];return p};a.scalarProduct=function(g,b,p){p=p||g;p.length=g.length;for(let f=0;f<g.length;f++)p[f]=g[f]*b;return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define("exports ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){b=function(){function q(){this.cache=new Map}var u=q.prototype;u.dispose=function(){this.cache.forEach(v=>{g.isSome(v.texture)&&(v.texture.dispose(),v.texture=null)});this.cache.clear()};u.acquire=function(v){if(g.isNone(v))return null;const t=this.patternId(v),l=this.cache.get(t);if(l)return l.refCount++,l.bind;const w=this.patternToTextureData(v,2),y=w.length/2,D={refCount:1,texture:null,bind:(z,r)=>{g.isNone(D.texture)&&(D.texture=new f(z,{width:w.length,height:1,
internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},w));z.bindTexture(D.texture,r);return y}};this.cache.set(t,D);return D.bind};u.release=function(v){if(!g.isNone(v)){v=this.patternId(v);var t=this.cache.get(v);t&&(t.refCount--,0===t.refCount&&(g.isSome(t.texture)&&t.texture.dispose(),this.cache.delete(v)))}};u.swap=function(v,t){t=this.acquire(t);this.release(v);return t};u.patternId=function(v){return v.join(",")};u.patternToTextureData=function(v,t){var l=v.reduce((D,z)=>D+z)*t;
l=new Uint8Array(l);let w=!0,y=0;for(const D of v){for(v=0;v<D*t;v++)l[y++]=w?255:0;w=!w}return l};return q}();a.StippleTextureRepository=b;a.createStipplePattern=function(q){return g.isNone(q)?q:q.slice()};a.createStipplePatternSimple=function(q){return[q,q]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat3f64 ../../support/buffer/InterleavedLayout ../lib/intersectorUtils ../lib/GLMaterialTexture ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/OrderIndependentTransparency ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){let l=function(E){function F(I){var K=E.call(this,I,y)||this;K.supportsEdges=!0;K.techniqueConfig=new v.DefaultMaterialTechniqueConfiguration;K.vertexBufferLayout=F.getVertexBufferLayout(K.params);K.instanceBufferLayout=I.instanced?F.getInstanceBufferLayout(K.params):null;return K}g._inheritsLoose(F,E);var G=F.prototype;G.isVisibleInPass=function(I){return 4===I||6===I||7===I?this.params.castShadows:!0};G.isVisible=function(){var I=this.params;if(!E.prototype.isVisible.call(this)||
0===I.layerOpacity)return!1;var K=I.instanced;const J=I.vertexColors,L=I.symbolColors;K=!!K&&-1<K.indexOf("color");const P=I.vvColorEnabled,Q="replace"===I.colorMixMode,X=0<I.opacity;I=I.externalColor&&0<I.externalColor[3];return J&&(K||P||L)?Q?!0:X:J?Q?I:X:K||P||L?Q?!0:X:Q?I:X};G.getTechniqueConfig=function(I,K){this.techniqueConfig.output=I;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.cullFace=null!=this.params.cullFace?this.params.cullFace:0;this.techniqueConfig.multipassTerrainEnabled=K?K.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=
K?K.cullAboveGround:!0;if(0===I||7===I)this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.techniqueConfig.doubleSidedMode=this.params.treeRendering?2:this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=
this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=K&&K.ssaoEnabled?this.params.receiveSSAO:!1,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,
this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=K?K.transparencyPassType:3,this.techniqueConfig.enableOffset=K?K.camera.relativeElevation<u.OITPolygonOffsetLimit:!0;return this.techniqueConfig};G.intersect=function(I,K,J,L,P,Q,X){if(null!==this.params.verticalOffset){const S=
L.camera;p.set(m,J[12],J[13],J[14]);J=null;switch(L.viewingMode){case 1:J=p.normalize(A,m);break;case 2:J=p.copy(A,C)}let H=0;if(null!==this.params.verticalOffset){var aa=p.subtract(B,m,S.eye);const R=p.length(aa);aa=p.scale(aa,aa,1/R);let T=null;this.params.screenSizePerspective&&(T=p.dot(J,aa));H+=e.verticalOffsetAtDistance(S,R,this.params.verticalOffset,T,this.params.screenSizePerspective)}p.scale(J,J,H);p.transformMat3(x,J,L.transform.inverseRotation);P=p.subtract(z,P,x);Q=p.subtract(r,Q,x)}e.intersectTriangleGeometry(I,
K,L,P,Q,c.getVerticalOffsetObject3D(L.verticalOffset),X)};G.getGLMaterial=function(I){if(0===I.output||7===I.output||1===I.output||2===I.output||3===I.output||4===I.output)return new w(I)};G.createBufferWriter=function(){return new D(this.vertexBufferLayout,this.instanceBufferLayout)};F.getVertexBufferLayout=function(I){const K=I.textureId||I.normalTextureId||I.metallicRoughnessTextureId||I.emissiveTextureId||I.occlusionTextureId,J=k.newLayout().vec3f("position").vec3f("normal");I.vertexTangents&&
J.vec4f("tangent");K&&J.vec2f("uv0");I.vertexColors&&J.vec4u8("color");I.symbolColors&&J.vec4u8("symbolColor");return J};F.getInstanceBufferLayout=function(I){let K=k.newLayout();K=I.instancedDoublePrecision?K.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):K.mat4f("model").mat4f("modelNormal");I.instanced&&-1<I.instanced.indexOf("color")&&(K=K.vec4f("instanceColor"));I.instanced&&-1<I.instanced.indexOf("featureAttribute")&&(K=K.vec4f("instanceFeatureAttribute"));
return K};return F}(h.Material),w=function(E){function F(I){I=E.call(this,{...I,...I.material.params})||this;I.updateParameters();return I}g._inheritsLoose(F,E);var G=F.prototype;G.updateParameters=function(I){const K=this.material.params;this.updateTexture(K.textureId);this.technique=K.treeRendering?this.techniqueRep.acquireAndReleaseExisting(t.RealisticTreeTechnique,this.material.getTechniqueConfig(this.output,I),this.technique):this.techniqueRep.acquireAndReleaseExisting(v.DefaultMaterialTechnique,
this.material.getTechniqueConfig(this.output,I),this.technique)};G.selectPipelines=function(){};G._updateShadowState=function(I){I.shadowMappingEnabled!==this.material.params.shadowMappingEnabled&&this.material.setParameterValues({shadowMappingEnabled:I.shadowMappingEnabled})};G._updateOccludeeState=function(I){I.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:I.hasOccludees})};G.ensureParameters=function(I){if(0===this.output||7===this.output)this._updateShadowState(I),
this._updateOccludeeState(I);this.updateParameters(I)};G.bind=function(I,K){I.bindProgram(this.technique.program);this.technique.bindPass(I,this.material.params,K);this.bindTexture(I,this.technique.program)};G.beginSlot=function(I){return I===(this.material.params.transparent?this.material.params.writeDepth?5:8:3)};G.getPipelineState=function(I,K){return this.technique.getPipelineState(K)};return F}(d);const y={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,
vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,
slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:f.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:q.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,
sceneHasOcludees:!1,...h.materialParametersDefaults};let D=function(){function E(G,I){this.vertexBufferLayout=G;this.instanceBufferLayout=I}var F=E.prototype;F.allocate=function(G){return this.vertexBufferLayout.createBuffer(G)};F.elementCount=function(G){return G.indices.get("position").length};F.write=function(G,I,K,J){n.writeDefaultAttributes(I,this.vertexBufferLayout,G.transformation,G.invTranspTransformation,K,J)};return E}();const z=b.create(),r=b.create(),C=b.fromValues(0,0,1),A=b.create(),
x=b.create(),m=b.create(),B=b.create();a.COLOR_GAMMA=2.1;a.DefaultMaterial=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../materials/internal/MaterialUtil ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../chunks/DefaultMaterial.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){c=function(E){function F(){return E.apply(this,arguments)||this}b._inheritsLoose(F,E);var G=F.prototype;G.initializeProgram=function(I){var K=F.shader.get();const J=this.configuration;K=K.build({OITEnabled:0===J.transparencyPassType,output:J.output,viewingMode:I.viewingMode,receiveShadows:J.receiveShadows,slicePlaneEnabled:J.slicePlaneEnabled,sliceHighlightDisabled:J.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:J.symbolColors,
vvSize:J.vvSize,vvColor:J.vvColor,vvInstancingEnabled:!0,instanced:J.instanced,instancedColor:J.instancedColor,instancedDoublePrecision:J.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:J.usePBR?J.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:J.hasMetalnessAndRoughnessTexture,hasEmissionTexture:J.hasEmissionTexture,hasOcclusionTexture:J.hasOcclusionTexture,hasNormalTexture:J.hasNormalTexture,hasColorTexture:J.hasColorTexture,receiveAmbientOcclusion:J.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,
normalType:J.normalsTypeDerivate?3:0,doubleSidedMode:J.doubleSidedMode,vertexTangets:J.vertexTangents,attributeTextureCoordinates:J.hasMetalnessAndRoughnessTexture||J.hasEmissionTexture||J.hasOcclusionTexture||J.hasNormalTexture||J.hasColorTexture?1:0,textureAlphaPremultiplied:J.textureAlphaPremultiplied,attributeColor:J.vertexColors,screenSizePerspectiveEnabled:J.screenSizePerspective,verticalOffsetEnabled:J.verticalOffset,offsetBackfaces:J.offsetBackfaces,doublePrecisionRequiresObfuscation:C.doublePrecisionRequiresObfuscation(I.rctx),
alphaDiscardMode:J.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:J.multipassTerrainEnabled,cullAboveGround:J.cullAboveGround});return new h(I.rctx,K.generateSource("vertex"),K.generateSource("fragment"),e.Default3D)};G.bindPass=function(I,K,J){q.View.bindProjectionMatrix(this.program,J.camera.projectionMatrix);const L=this.configuration.output;(1===this.configuration.output||J.multipassTerrainEnabled||3===L)&&this.program.setUniform2fv("cameraNearFar",J.camera.nearFar);J.multipassTerrainEnabled&&
(this.program.setUniform2fv("inverseViewport",J.inverseViewport),D.bindMultipassTerrainUniforms(this.program,I,J));7===L&&(this.program.setUniform1f("opacity",K.opacity),this.program.setUniform1f("layerOpacity",K.layerOpacity),this.program.setUniform4fv("externalColor",K.externalColor),this.program.setUniform1i("colorMixMode",u.colorMixModes[K.colorMixMode]));0===L?(J.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",K.ambient),this.program.setUniform3fv("diffuse",K.diffuse),
this.program.setUniform4fv("externalColor",K.externalColor),this.program.setUniform1i("colorMixMode",u.colorMixModes[K.colorMixMode]),this.program.setUniform1f("opacity",K.opacity),this.program.setUniform1f("layerOpacity",K.layerOpacity),this.configuration.usePBR&&x.PhysicallyBasedRenderingParameters.bindUniforms(this.program,K,this.configuration.isSchematic)):4===L&&t.OutputHighlight.bindOutputHighlight(I,this.program,J);l.VisualVariables.bindUniformsForSymbols(this.program,K);w.VerticalOffset.bindUniforms(this.program,
K,J);u.bindScreenSizePerspective(K.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");2!==K.textureAlphaMode&&3!==K.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",K.textureAlphaCutoff)};G.bindDraw=function(I){const K=this.configuration.instancedDoublePrecision?f.fromValues(I.camera.viewInverseTransposeMatrix[3],I.camera.viewInverseTransposeMatrix[7],I.camera.viewInverseTransposeMatrix[11]):I.origin;q.View.bindViewCustomOrigin(this.program,K,I.camera.viewMatrix);
(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&q.View.bindCamPosition(this.program,K,I.camera.viewInverseTransposeMatrix);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",I.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&
A.InstancedDoublePrecision.bindCustomOrigin(this.program,K);v.Slice.bindUniforms(this.program,this.configuration,I.slicePlane,K);0===this.configuration.output&&r.ReadShadowMap.bindViewCustomOrigin(this.program,I,K)};G.setPipeline=function(I,K){const J=this.configuration,L=3===I,P=2===I;return n.makePipelineState({blending:0!==J.output&&7!==J.output||!J.transparent?null:L?y.blendingDefault:y.OITBlending(I),culling:B(J),depthTest:{func:y.OITDepthTest(I)},depthWrite:L||P?J.writeDepth&&n.defaultDepthWriteParams:
null,colorWrite:n.defaultColorWriteParams,stencilWrite:J.sceneHasOcludees?z.stencilWriteMaskOn:null,stencilTest:J.sceneHasOcludees?K?z.stencilToolMaskBaseParams:z.stencilBaseAllZerosParams:null,polygonOffset:L||P?null:y.getOITPolygonOffset(J.enableOffset)})};G.initializePipeline=function(){this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0);return this.setPipeline(this.configuration.transparencyPassType,!1)};G.getPipelineState=function(I){return I?this._occludeePipelineState:
this.pipeline};return F}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(m.DefaultMaterialShader,()=>new Promise(function(E,F){a(["./DefaultMaterial.glsl"],E,F)}));const B=E=>{var F=E.cullFace?0!==E.cullFace:E.slicePlaneEnabled?!1:!E.transparent&&!E.doubleSidedMode;return F&&{face:1===E.cullFace?1028:1029,mode:2305}};k=function(E){function F(){var G=E.apply(this,arguments)||this;G.output=0;G.alphaDiscardMode=1;G.doubleSidedMode=0;G.isSchematic=!1;G.vertexColors=!1;G.offsetBackfaces=!1;G.symbolColors=
!1;G.vvSize=!1;G.vvColor=!1;G.verticalOffset=!1;G.receiveShadows=!1;G.slicePlaneEnabled=!1;G.sliceHighlightDisabled=!1;G.receiveAmbientOcclusion=!1;G.screenSizePerspective=!1;G.textureAlphaPremultiplied=!1;G.hasColorTexture=!1;G.usePBR=!1;G.hasMetalnessAndRoughnessTexture=!1;G.hasEmissionTexture=!1;G.hasOcclusionTexture=!1;G.hasNormalTexture=!1;G.instanced=!1;G.instancedColor=!1;G.instancedDoublePrecision=!1;G.vertexTangents=!1;G.normalsTypeDerivate=!1;G.writeDepth=!0;G.sceneHasOcludees=!1;G.transparent=
!1;G.enableOffset=!0;G.cullFace=0;G.transparencyPassType=3;G.multipassTerrainEnabled=!1;G.cullAboveGround=!0;return G}b._inheritsLoose(F,E);return F}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:8})],k.prototype,"output",void 0);p.__decorate([d.parameter({count:4})],k.prototype,"alphaDiscardMode",void 0);p.__decorate([d.parameter({count:3})],k.prototype,"doubleSidedMode",void 0);p.__decorate([d.parameter()],k.prototype,"isSchematic",void 0);p.__decorate([d.parameter()],k.prototype,
"vertexColors",void 0);p.__decorate([d.parameter()],k.prototype,"offsetBackfaces",void 0);p.__decorate([d.parameter()],k.prototype,"symbolColors",void 0);p.__decorate([d.parameter()],k.prototype,"vvSize",void 0);p.__decorate([d.parameter()],k.prototype,"vvColor",void 0);p.__decorate([d.parameter()],k.prototype,"verticalOffset",void 0);p.__decorate([d.parameter()],k.prototype,"receiveShadows",void 0);p.__decorate([d.parameter()],k.prototype,"slicePlaneEnabled",void 0);p.__decorate([d.parameter()],
k.prototype,"sliceHighlightDisabled",void 0);p.__decorate([d.parameter()],k.prototype,"receiveAmbientOcclusion",void 0);p.__decorate([d.parameter()],k.prototype,"screenSizePerspective",void 0);p.__decorate([d.parameter()],k.prototype,"textureAlphaPremultiplied",void 0);p.__decorate([d.parameter()],k.prototype,"hasColorTexture",void 0);p.__decorate([d.parameter()],k.prototype,"usePBR",void 0);p.__decorate([d.parameter()],k.prototype,"hasMetalnessAndRoughnessTexture",void 0);p.__decorate([d.parameter()],
k.prototype,"hasEmissionTexture",void 0);p.__decorate([d.parameter()],k.prototype,"hasOcclusionTexture",void 0);p.__decorate([d.parameter()],k.prototype,"hasNormalTexture",void 0);p.__decorate([d.parameter()],k.prototype,"instanced",void 0);p.__decorate([d.parameter()],k.prototype,"instancedColor",void 0);p.__decorate([d.parameter()],k.prototype,"instancedDoublePrecision",void 0);p.__decorate([d.parameter()],k.prototype,"vertexTangents",void 0);p.__decorate([d.parameter()],k.prototype,"normalsTypeDerivate",
void 0);p.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);p.__decorate([d.parameter()],k.prototype,"sceneHasOcludees",void 0);p.__decorate([d.parameter()],k.prototype,"transparent",void 0);p.__decorate([d.parameter()],k.prototype,"enableOffset",void 0);p.__decorate([d.parameter({count:3})],k.prototype,"cullFace",void 0);p.__decorate([d.parameter({count:4})],k.prototype,"transparencyPassType",void 0);p.__decorate([d.parameter()],k.prototype,"multipassTerrainEnabled",void 0);p.__decorate([d.parameter()],
k.prototype,"cullAboveGround",void 0);g.DefaultMaterialTechnique=c;g.DefaultMaterialTechniqueConfiguration=k;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces","../../../lib/WebGLDriverTest"],function(a,g,b,p){a.DoublePrecision=function({code:f},k){k.doublePrecisionRequiresObfuscation?f.add(b.glsl`
      vec3 dpPlusFrc(vec3 a, vec3 b) {
        return mix(a, a + b, vec3(notEqual(b, vec3(0))));
      }

      vec3 dpMinusFrc(vec3 a, vec3 b) {
        return mix(vec3(0), a - b, vec3(notEqual(a, b)));
      }

      // based on https://www.thasler.com/blog/blog/glsl-part2-emu
      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
        vec3 t1 = dpPlusFrc(hiA, hiB);
        vec3 e = dpMinusFrc(t1, hiA);
        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
        return t1 + t2;
      }
    `):f.add(b.glsl`
      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
        vec3 t1 = hiA + hiB;
        vec3 e = t1 - hiA;
        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
        return t1 + t2;
      }
    `)};a.doublePrecisionRequiresObfuscation=function(f){return g("force-double-precision-obfuscation")?!0:p.testWebGLDriver(f).doublePrecisionRequiresObfuscation};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../webgl/Program ./Util ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./doublePrecisionUtils ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/testSVGPremultipliedAlpha".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){function w(z,r){var C=new q(z,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});const A=c.createVertex(z,35044,new Uint16Array([0,0,1,0,0,1,1,1])),x=new e(z,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:A}),m=p.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),B=p.fromValues(5633271.46742708,2626873.6381334523,
1434963.231608387);r=new f(z,`

  precision highp float;

  attribute vec2 a_pos;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${r?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var E=new Float32Array(6);h.encodeDoubleArray(m,E,3);var F=new Float32Array(6);h.encodeDoubleArray(B,F,3);z.bindProgram(r);r.setUniform3f("u_highA",E[0],E[2],E[4]);r.setUniform3f("u_lowA",E[1],E[3],E[5]);r.setUniform3f("u_highB",F[0],F[2],F[4]);r.setUniform3f("u_lowB",F[1],F[3],F[5]);E=r;F=z.getBoundFramebufferObject();const {x:G,y:I,width:K,height:J}=z.getViewport();
z.bindFramebuffer(C);z.setViewport(0,0,1,1);z.bindVAO(x);z.drawArrays(5,0,4);r=new Uint8Array(4);C.readPixels(0,0,1,1,6408,5121,r);E.dispose();x.dispose(!1);A.dispose();C.dispose();z.setViewport(G,I,K,J);z.bindFramebuffer(F);z=(m[2]-B[2])/25;C=k.unpackFloatRGBA(r);return Math.abs(z-C)}let y=function(){function z(r){this.context=r;this.svgAlwaysPremultipliesAlpha=!1;this._doublePrecisionRequiresObfuscation=null;l.testSVGPremultipliedAlpha(r).then(C=>{this.svgAlwaysPremultipliesAlpha=!C})}g._createClass(z,
[{key:"doublePrecisionRequiresObfuscation",get:function(){if(b.isNone(this._doublePrecisionRequiresObfuscation)){const r=w(this.context,!1),C=w(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==r&&(0===C||5<r/C)}return this._doublePrecisionRequiresObfuscation}}]);return z}(),D=null;a.clearTestWebGLDriver=function(z){b.isSome(D)&&D.context===z&&(D=null)};a.testWebGLDriver=function(z){if(b.isNone(D)||D.context!==z)D=new y(z);return D};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ./Program ./BufferObject ./Texture ./VertexArrayObject ./Renderbuffer ./FramebufferObject ./ProgramCache ./RenderingContext ./ShaderCompiler".split(" "),function(a,g,b,p,f,k,c,d,e,h){a.testSVGPremultipliedAlpha=async function(n){const q=new Image;q.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
q.width=5;q.height=5;await q.decode();if(!n.gl)return!0;const u=new c(n,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),v=b.createVertex(n,35044,new Uint16Array([0,0,1,0,0,1,1,1])),t=new f(n,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:v}),l=new g(n,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",{a_pos:0});n.bindProgram(l);const w=new p(n,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},q);n.bindTexture(w,0);l.setUniform1i("u_texture",0);const y=n.getBoundFramebufferObject(),{x:D,y:z,width:r,height:C}=n.getViewport();n.bindFramebuffer(u);n.setViewport(0,0,1,1);n.bindVAO(t);n.drawArrays(5,0,
4);const A=new Uint8Array(4);u.readPixels(0,0,1,1,6408,5121,A);l.dispose();t.dispose(!1);v.dispose();u.dispose();w.dispose();n.setViewport(D,z,r,C);n.bindFramebuffer(y);q.src="";return 255===A[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../chunks/vec3f64","../../shaderModules/interfaces","../../../lib/doublePrecisionUtils","../util/DoublePrecision.glsl"],
function(a,g,b,p,f){function k(e,h){h.instanced&&h.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3"));h.instancedDoublePrecision&&(e.vertex.include(f.DoublePrecision,h),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const n=[b.glsl`
    vec3 calculateVPos() {
      ${h.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,b.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${h.instancedDoublePrecision?b.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,b.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,b.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,h.vertexTangets?b.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${h.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:b.glsl``];e.vertex.code.add(n[0]);e.vertex.code.add(n[1]);e.vertex.code.add(n[2]);2===h.output&&e.vertex.code.add(n[3]);e.vertex.code.add(n[4])}(function(e){e.Uniforms=function(){};e.bindCustomOrigin=function(h,n){p.encodeDoubleArraySplit(n,c,d,3);h.setUniform3fv("viewOriginHi",c);h.setUniform3fv("viewOriginLo",d)}})(k||(k={}));const c=g.create(),d=g.create();a.InstancedDoublePrecision=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports",
"../../shaderModules/interfaces","../../../../../../chunks/vec3f32","../attributes/VertexTextureCoordinates.glsl"],function(a,g,b,p){function f(k,c){const d=k.fragment,e=c.hasMetalnessAndRoughnessTexture||c.hasEmissionTexture||c.hasOcclusionTexture;1===c.pbrMode&&e&&k.include(p.VertexTextureCoordinates,c);2===c.pbrMode?d.code.add(g.glsl`
      const vec3 mrr = vec3(0.0, 0.6, 0.2);
      const vec3 emission = vec3(0.0);
      float occlusion = 1.0;

      void applyPBRFactors() {}

      float getBakedOcclusion() { return 1.0; }
    `):(0===c.pbrMode&&d.code.add(g.glsl`
      float getBakedOcclusion() { return 1.0; }
  `),1===c.pbrMode&&(d.uniforms.add("emissionFactor","vec3"),d.uniforms.add("mrrFactors","vec3"),d.code.add(g.glsl`
      vec3 mrr;
      vec3 emission;
      float occlusion;
    `),c.hasMetalnessAndRoughnessTexture&&(d.uniforms.add("texMetallicRoughness","sampler2D"),c.supportsTextureAtlas&&d.uniforms.add("texMetallicRoughnessSize","vec2"),d.code.add(g.glsl`
      void applyMetallnessAndRoughness(TextureLookupParameter params) {
        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;

        mrr[0] *= metallicRoughness.b;
        mrr[1] *= metallicRoughness.g;
      }`)),c.hasEmissionTexture&&(d.uniforms.add("texEmission","sampler2D"),c.supportsTextureAtlas&&d.uniforms.add("texEmissionSize","vec2"),d.code.add(g.glsl`
      void applyEmission(TextureLookupParameter params) {
        emission *= textureLookup(texEmission, params).rgb;
      }`)),c.hasOcclusionTexture?(d.uniforms.add("texOcclusion","sampler2D"),c.supportsTextureAtlas&&d.uniforms.add("texOcclusionSize","vec2"),d.code.add(g.glsl`
      void applyOcclusion(TextureLookupParameter params) {
        occlusion *= textureLookup(texOcclusion, params).r;
      }

      float getBakedOcclusion() {
        return occlusion;
      }
      `)):d.code.add(g.glsl`
      float getBakedOcclusion() { return 1.0; }
      `),d.code.add(g.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${e?"vtc.uv \x3d vuv0;":""}
      ${c.hasMetalnessAndRoughnessTexture?c.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${c.hasEmissionTexture?c.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${c.hasOcclusionTexture?c.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))}b=b.fromValues(0,.6,.2);(function(k){k.bindUniforms=function(c,d,e=!1){e||(c.setUniform3fv("mrrFactors",d.mrrFactors),c.setUniform3fv("emissionFactor",d.emissiveFactor))}})(f||(f={}));a.PBRSchematicMRRValues=b;a.PhysicallyBasedRenderingParameters=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../shaderModules/interfaces","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl"],
function(a,g,b,p){a.VertexTextureCoordinates=function(f,k){f.include(b.TextureCoordinateAttribute,k);f.fragment.code.add(g.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${k.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);1===k.attributeTextureCoordinates&&f.fragment.code.add(g.glsl`
      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
        return texture2D(tex, params.uv);
      }
    `);2===k.attributeTextureCoordinates&&(f.include(p.TextureAtlasLookup),f.fragment.code.add(g.glsl`
    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.TextureCoordinateAttribute=function(b,p){1===p.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.vertex.code.add(g.glsl`
      void forwardTextureCoordinates() {
        vuv0 = uv0;
      }
    `));2===p.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.attributes.add("uvRegion","vec4"),b.varyings.add("vuvRegion","vec4"),b.vertex.code.add(g.glsl`
      void forwardTextureCoordinates() {
        vuv0 = uv0;
        vuvRegion = uvRegion;
      }
    `));0===p.attributeTextureCoordinates&&b.vertex.code.add(g.glsl`
      void forwardTextureCoordinates() {}
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.TextureAtlasLookup=function(b){b.extensions.add("GL_EXT_shader_texture_lod");b.extensions.add("GL_OES_standard_derivatives");b.fragment.code.add(g.glsl`
    #ifndef GL_EXT_shader_texture_lod
      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
        return max(0.0, 0.5 * log2(deltaMaxSqr));
      }
    #endif

    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
      //[umin, vmin, umax, vmax]
      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;

      // calculate derivative of continuous texture coordinate
      // to avoid mipmapping artifacts caused by manual wrapping in shader
      // clamp the derivatives to avoid discoloring when zooming out.
      float maxdUV = 0.125; // Emprirically tuned compromise between discoloring and aliasing noise.
      vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
      vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;

      #ifdef GL_EXT_shader_texture_lod
        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
      #else
        // use bias to compensate for difference in automatic vs desired mipmap level
        vec2 dUVdxAuto = dFdx(uvAtlas);
        vec2 dUVdyAuto = dFdy(uvAtlas);
        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);

        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
      #endif
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G){function I(J){const L=new p.ShaderBuilder,P=L.vertex.code,Q=L.fragment.code;L.include(F.HeaderComment,{name:"Default Material Shader",output:J.output});L.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");L.include(D.PositionAttribute);L.varyings.add("vpos","vec3");L.include(c.VisualVariables,J);L.include(v.InstancedDoublePrecision,J);L.include(e.VerticalOffset,J);if(0===J.output||
7===J.output)L.include(y.NormalAttribute,J),L.include(b.Transform,{linearDepth:!1}),0===J.normalType&&J.offsetBackfaces&&L.include(w.Offset),L.include(x.ComputeNormalTexture,J),L.include(C.VertexNormal,J),J.instancedColor&&L.attributes.add("instanceColor","vec4"),L.varyings.add("localvpos","vec3"),L.include(t.TextureCoordinateAttribute,J),L.include(q.ForwardLinearDepth,J),L.include(z.SymbolColor,J),L.include(r.VertexColor,J),L.vertex.uniforms.add("externalColor","vec4"),L.varyings.add("vcolorExt",
"vec4"),J.multipassTerrainEnabled&&L.varyings.add("depth","float"),P.add(g.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${J.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${g.glsl.float(d.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===J.normalType?g.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${J.vertexTangets?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===J.normalType&&J.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${J.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);7===J.output&&(L.include(f.Slice,J),L.include(d.DiscardOrAdjustAlpha,J),J.multipassTerrainEnabled&&(L.fragment.include(k.ReadLinearDepth),L.include(h.multipassTerrainTest,J)),L.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),J.hasColorTexture&&L.fragment.uniforms.add("tex","sampler2D"),L.fragment.include(G.MixExternalColor),Q.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${J.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${J.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${J.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:g.glsl`vec4 texColor = vec4(1.0);`}
        ${J.attributeColor?g.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:g.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));0===J.output&&(L.include(f.Slice,J),L.include(B.EvaluateSceneLighting,J),L.include(m.EvaluateAmbientOcclusion,J),L.include(d.DiscardOrAdjustAlpha,J),J.receiveShadows&&L.include(n.ReadShadowMap,J),J.multipassTerrainEnabled&&(L.fragment.include(k.ReadLinearDepth),L.include(h.multipassTerrainTest,J)),L.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),J.hasColorTexture&&L.fragment.uniforms.add("tex",
"sampler2D"),L.include(l.PhysicallyBasedRenderingParameters,J),L.include(u.PhysicallyBasedRendering,J),L.fragment.include(G.MixExternalColor),L.include(E.Normals,J),Q.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${J.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${J.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${J.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:g.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===J.normalType?g.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:g.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===J.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${J.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===J.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${J.attributeColor?g.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:g.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${J.hasNormalTexture?g.glsl`
              mat3 tangentSpace = ${J.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${1===J.pbrMode||2===J.pbrMode?1===J.viewingMode?g.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:g.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:g.glsl``}
        ${1===J.pbrMode||2===J.pbrMode?g.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${J.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));L.include(A.DefaultMaterialAuxiliaryPasses,J);return L}var K=Object.freeze({__proto__:null,build:I});a.DefaultMaterialShader=K;a.build=I})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,g){a.Offset=function(b){b.vertex.code.add(g.glsl`
    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
      vec3 camToVert = posWorld - camPosWorld;

      bool isBackface = dot(camToVert, normalWorld) > 0.0;
      if (isBackface) {
        posClip.z += 0.0000003 * posClip.w;
      }
      return posClip;
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/DecodeNormal.glsl"],function(a,g,b){a.NormalAttribute=function(p,f){0===f.normalType&&(p.attributes.add("normal","vec3"),p.vertex.code.add(g.glsl`
      vec3 normalModel() {
        return normal;
      }
    `));1===f.normalType&&(p.include(b.DecodeNormal),p.attributes.add("normalCompressed","vec2"),p.vertex.code.add(g.glsl`
      vec3 normalModel() {
        return decodeNormal(normalCompressed);
      }
    `));3===f.normalType&&(p.extensions.add("GL_OES_standard_derivatives"),p.fragment.code.add(g.glsl`
      vec3 screenDerivativeNormal(vec3 positionView) {
        return normalize(cross(dFdx(positionView), dFdy(positionView)));
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.DecodeNormal=function(b){const p=g.glsl`
    vec3 decodeNormal(vec2 f) {
      float z = 1.0 - abs(f.x) - abs(f.y);
      return vec3(f + sign(f) * min(z, 0.0), z);
    }
  `;b.fragment.code.add(p);b.vertex.code.add(p)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.PositionAttribute=function(b){b.attributes.add("position","vec3");b.vertex.code.add(g.glsl`
    vec3 positionModel() { return position; }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl"],function(a,g,b){a.SymbolColor=function(p,f){f.symbolColor?(p.include(b.DecodeSymbolColor),p.attributes.add("symbolColor","vec4"),p.varyings.add("colorMixMode","mediump float")):p.fragment.uniforms.add("colorMixMode","int");f.symbolColor?
p.vertex.code.add(g.glsl`
    int symbolColorMixMode;

    vec4 getSymbolColor() {
      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
    }

    void forwardColorMixMode() {
      colorMixMode = float(symbolColorMixMode) + 0.5;
    }
  `):p.vertex.code.add(g.glsl`
    vec4 getSymbolColor() { return vec4(1.0); }
    void forwardColorMixMode() {}
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,g){a.DecodeSymbolColor=function(b){b.vertex.code.add(g.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${g.glsl.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${g.glsl.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${g.glsl.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${g.glsl.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.VertexColor=function(b,p){p.attributeColor?(b.attributes.add("color","vec4"),b.varyings.add("vColor","vec4"),b.vertex.code.add(g.glsl`
      void forwardVertexColor() { vColor = color; }
    `),b.vertex.code.add(g.glsl`
      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }
    `)):b.vertex.code.add(g.glsl`
      void forwardVertexColor() {}
      void forwardNormalizedVertexColor() {}
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../shaderModules/interfaces","./NormalAttribute.glsl","./VertexPosition.glsl"],function(a,g,b,p){function f(k,c){0===c.normalType||1===c.normalType?(k.include(b.NormalAttribute,c),k.varyings.add("vNormalWorld","vec3"),k.varyings.add("vNormalView","vec3"),k.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),k.vertex.uniforms.add("uTransformNormal_ViewFromGlobal",
"mat3"),k.vertex.code.add(g.glsl`
      void forwardNormal() {
        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
      }
    `)):2===c.normalType?(k.include(p.VertexPosition,c),k.varyings.add("vNormalWorld","vec3"),k.vertex.code.add(g.glsl`
    void forwardNormal() {
      vNormalWorld = ${1===c.viewingMode?g.glsl`normalize(vPositionWorldCameraRelative);`:g.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):k.vertex.code.add(g.glsl`
      void forwardNormal() {}
    `)}(function(k){k.bindUniforms=function(c,d){c.setUniformMatrix4fv("viewNormal",d)}})(f||(f={}));a.VertexNormal=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../shaderModules/interfaces ../util/DoublePrecision.glsl ./PositionAttribute.glsl".split(" "),function(a,g,b,p,f,k,c){function d(e,
h){e.include(c.PositionAttribute);e.vertex.include(k.DoublePrecision,h);e.varyings.add("vPositionWorldCameraRelative","vec3");e.varyings.add("vPosition_view","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS",
"mat3");e.vertex.uniforms.add("uTransform_ProjFromView","mat4");e.vertex.code.add(f.glsl`
    // compute position in world space orientation, but relative to the camera position
    vec3 positionWorldCameraRelative() {
      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();

      vec3 transform_CameraRelativeFromModel = dpAdd(
        uTransform_WorldFromModel_TL,
        uTransform_WorldFromModel_TH,
        -uTransform_WorldFromView_TL,
        -uTransform_WorldFromView_TH
      );

      return transform_CameraRelativeFromModel + rotatedModelPosition;
    }

    // position in view space, that is relative to the camera position and orientation
    vec3 position_view() {
      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
    }

    // compute gl_Position and forward related varyings to fragment shader
    void forwardPosition() {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      vPosition_view = position_view();
      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
    }

    vec3 positionWorld() {
      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
    }
  `);e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");e.fragment.code.add(f.glsl`
    vec3 positionWorld() {
      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
    }
  `)}(function(e){e.ModelTransform=function(){this.worldFromModel_RS=b.create();this.worldFromModel_TH=g.create();this.worldFromModel_TL=g.create()};e.ViewProjectionTransform=function(){this.worldFromView_TH=g.create();this.worldFromView_TL=g.create();this.viewFromCameraRelative_RS=b.create();this.projFromView=p.create()};e.bindModelTransform=function(h,n){h.setUniformMatrix3fv("uTransform_WorldFromModel_RS",n.worldFromModel_RS);h.setUniform3fv("uTransform_WorldFromModel_TH",n.worldFromModel_TH);
h.setUniform3fv("uTransform_WorldFromModel_TL",n.worldFromModel_TL)};e.bindViewProjTransform=function(h,n){h.setUniform3fv("uTransform_WorldFromView_TH",n.worldFromView_TH);h.setUniform3fv("uTransform_WorldFromView_TL",n.worldFromView_TL);h.setUniformMatrix4fv("uTransform_ProjFromView",n.projFromView);h.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",n.viewFromCameraRelative_RS)}})(d||(d={}));a.VertexPosition=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../shaderModules/interfaces ../Transform.glsl ../Slice.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../output/OutputDepth.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){a.DefaultMaterialAuxiliaryPasses=function(q,u){const v=q.vertex.code,t=q.fragment.code;if(1===u.output||3===u.output)q.include(b.Transform,{linearDepth:!0}),q.include(e.TextureCoordinateAttribute,u),q.include(k.VisualVariables,u),q.include(d.OutputDepth,u),q.include(p.Slice,u),q.vertex.uniforms.add("cameraNearFar","vec2"),q.varyings.add("depth","float"),u.hasColorTexture&&q.fragment.uniforms.add("tex","sampler2D"),v.add(g.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
        forwardTextureCoordinates();
      }
    `),q.include(c.DiscardOrAdjustAlpha,u),t.add(g.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${u.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);2===u.output&&(q.include(b.Transform,{linearDepth:!1}),q.include(h.NormalAttribute,u),q.include(n.VertexNormal,u),q.include(e.TextureCoordinateAttribute,u),q.include(k.VisualVariables,u),u.hasColorTexture&&q.fragment.uniforms.add("tex","sampler2D"),q.vertex.uniforms.add("viewNormal","mat4"),q.varyings.add("vPositionView","vec3"),v.add(g.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===u.normalType?g.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),q.include(p.Slice,u),q.include(c.DiscardOrAdjustAlpha,u),t.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${u.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===u.normalType?g.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:g.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));4===u.output&&(q.include(b.Transform,{linearDepth:!1}),q.include(e.TextureCoordinateAttribute,u),q.include(k.VisualVariables,u),u.hasColorTexture&&q.fragment.uniforms.add("tex","sampler2D"),v.add(g.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),q.include(p.Slice,u),q.include(c.DiscardOrAdjustAlpha,u),q.include(f.OutputHighlight),t.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${u.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexTextureCoordinates.glsl"],function(a,g,b){a.ComputeNormalTexture=function(p,f){const k=p.fragment;k.uniforms.add("normalTexture","sampler2D");k.uniforms.add("normalTextureSize","vec2");f.vertexTangets?(p.attributes.add("tangent","vec4"),p.varyings.add("vTangent","vec4"),2===
f.doubleSidedMode?k.code.add(g.glsl`
      mat3 computeTangentSpace(vec3 normal) {
        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
        return mat3(tangent, bitangent, normal);
      }
    `):k.code.add(g.glsl`
      mat3 computeTangentSpace(vec3 normal) {
        float tangentHeadedness = vTangent.w;
        vec3 tangent = normalize(vTangent.xyz);
        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
        return mat3(tangent, bitangent, normal);
      }
    `)):(p.extensions.add("GL_OES_standard_derivatives"),k.code.add(g.glsl`
    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {

      vec3 Q1 = dFdx(pos);
      vec3 Q2 = dFdy(pos);

      vec2 stx = dFdx(st);
      vec2 sty = dFdy(st);

      float det = stx.t * sty.s - sty.t * stx.s;

      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent
      T = T - normal * dot(normal, T); // orthogonalize tangent
      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0
      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B
      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates
    }
  `));0!==f.attributeTextureCoordinates&&(p.include(b.VertexTextureCoordinates,f),k.code.add(g.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${f.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.EvaluateAmbientOcclusion=function(b,p){b=b.fragment;p.receiveAmbientOcclusion?(b.uniforms.add("ssaoTex","sampler2D"),b.uniforms.add("viewportPixelSz","vec4"),b.code.add(g.glsl`
      float evaluateAmbientOcclusion() {
        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
      }

      float evaluateAmbientOcclusionInverse() {
        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
      }
    `)):b.code.add(g.glsl`
      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion
      float evaluateAmbientOcclusionInverse() { return 1.0; }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../shaderModules/interfaces ./PiUtils.glsl ./ReadShadowMap.glsl ./PhysicallyBasedRendering.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateAmbientLighting.glsl ./EvaluateMainLighting.glsl".split(" "),function(a,g,b,p,f,k,c,d){a.EvaluateSceneLighting=function(e,h){const n=e.fragment;e.include(d.EvaluateMainLighting);e.include(k.EvaluateAmbientOcclusion,
h);0!==h.pbrMode&&e.include(f.PhysicallyBasedRendering,h);e.include(c.EvaluateAmbientLighting,h);h.receiveShadows&&e.include(p.ReadShadowMap,h);n.uniforms.add("lightingGlobalFactor","float");n.uniforms.add("ambientBoostFactor","float");e.include(b.PiUtils);n.code.add(g.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===h.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);if(h.useOldSceneLightInterface)n.code.add(g.glsl`
    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
      // evaluate the main light
      #if defined(TREE_RENDERING)
        // Special case for tree rendering:
        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere
        // facing away from the light. The idea is to get an effect where light is transmitted
        // through the tree.
        float minDot = -0.5;
        float dotRange = 1.0 - minDot;
        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere

        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);
      #else
        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);
      #endif

      // move lighting towards (1.0, 1.0, 1.0) if requested
      dotVal = mix(dotVal, 1.0, lightingFixedFactor);

      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;
      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);

      // inverse gamma correction on the albedo color
      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));

      // physically correct BRDF normalizes by PI
      vec3 totalLight = mainLight + ambientLight + additionalLight;
      totalLight = min(totalLight, vec3(PI));
      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));

      // apply gamma correction to the computed color
      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));

      return outColor;
    }
  `);else if(1===h.viewingMode?n.code.add(g.glsl`
      float _oldHeuristicLighting(vec3 vPosWorld) {
        vec3 shadingNormalWorld = normalize(vPosWorld);
        float vndl = -dot(shadingNormalWorld, lightingMainDirection);

        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
      }
    `):n.code.add(g.glsl`
      float _oldHeuristicLighting(vec3 vPosWorld) {
        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);
        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
      }
    `),n.code.add(g.glsl`
      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);
        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
      }
    `),0===h.pbrMode||4===h.pbrMode)n.code.add(g.glsl`
      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)
      {
        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);
        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);
        // inverse gamma correction on the base color
        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));

        // physically correct BRDF normalizes by PI
        vec3 totalLight = mainLighting + ambientLighting + additionalLight;
        totalLight = min(totalLight, vec3(PI));
        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);

        // apply gamma correction to the computed color
        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));

        return outColor;
      }
      `);else if(1===h.pbrMode||2===h.pbrMode)n.code.add(g.glsl`
      const float fillLightIntensity = 0.25;
      const float horizonLightDiffusion = 0.4;
      const float additionalAmbientIrradianceFactor = 0.02;

      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
      {
        // Calculate half vector between view and light direction
        vec3 viewDirection = -viewDir;
        vec3 mainLightDirection = -lightingMainDirection;
        vec3 h = normalize(viewDirection + mainLightDirection);

        PBRShadingInfo inputs;
        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
        vec3 reflectedView = normalize(reflect(viewDirection, normal));
        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);

        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
        inputs.ssao = ssao;

        inputs.metalness = mrr[0];
        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);
      `),n.code.add(g.glsl`
        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0
        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);
      `),n.code.add(g.glsl`
        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));

        inputs.NdotAmbDir = abs(dot(normal, ambientDir));

        // Calculate the irradiance components: sun, fill lights and the sky.
        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
        // calculateAmbientIrradiance for localView and additionalLight for gloabalView
        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;

        // Assemble the overall irradiance of the sky that illuminates the surface
        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance
        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
      `),n.code.add(g.glsl`
        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
        inputs.NdotH_Horizon = dot(normal, horizonRingH);

        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView

        // Assemble the overall radiance of the sky that illuminates the surface
        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance
        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;

        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed
        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);
        `),n.code.add(g.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===h.pbrMode?g.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:g.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.EvaluateAmbientLighting=function(b,p){b=b.fragment;const f=void 0!==p.lightingSphericalHarmonicsOrder?p.lightingSphericalHarmonicsOrder:2;0===f?(b.uniforms.add("lightingAmbientSH0","vec3"),b.code.add(g.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec3 ambientLight = 0.282095 * lightingAmbientSH0;
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `)):1===f?(b.uniforms.add("lightingAmbientSH_R","vec4"),b.uniforms.add("lightingAmbientSH_G","vec4"),b.uniforms.add("lightingAmbientSH_B","vec4"),b.code.add(g.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec4 sh0 = vec4(
          0.282095,
          0.488603 * normal.x,
          0.488603 * normal.z,
          0.488603 * normal.y
        );
        vec3 ambientLight = vec3(
          dot(lightingAmbientSH_R, sh0),
          dot(lightingAmbientSH_G, sh0),
          dot(lightingAmbientSH_B, sh0)
        );
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `)):2===f&&(b.uniforms.add("lightingAmbientSH0","vec3"),b.uniforms.add("lightingAmbientSH_R1","vec4"),b.uniforms.add("lightingAmbientSH_G1","vec4"),b.uniforms.add("lightingAmbientSH_B1","vec4"),b.uniforms.add("lightingAmbientSH_R2","vec4"),b.uniforms.add("lightingAmbientSH_G2","vec4"),b.uniforms.add("lightingAmbientSH_B2","vec4"),b.code.add(g.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec3 ambientLight = 0.282095 * lightingAmbientSH0;

        vec4 sh1 = vec4(
          0.488603 * normal.x,
          0.488603 * normal.z,
          0.488603 * normal.y,
          1.092548 * normal.x * normal.y
        );
        vec4 sh2 = vec4(
          1.092548 * normal.y * normal.z,
          0.315392 * (3.0 * normal.z * normal.z - 1.0),
          1.092548 * normal.x * normal.z,
          0.546274 * (normal.x * normal.x - normal.y * normal.y)
        );
        ambientLight += vec3(
          dot(lightingAmbientSH_R1, sh1),
          dot(lightingAmbientSH_G1, sh1),
          dot(lightingAmbientSH_B1, sh1)
        );
        ambientLight += vec3(
          dot(lightingAmbientSH_R2, sh2),
          dot(lightingAmbientSH_G2, sh2),
          dot(lightingAmbientSH_B2, sh2)
        );
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `),1!==p.pbrMode&&2!==p.pbrMode||b.code.add(g.glsl`
        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);

        vec3 calculateAmbientRadiance(float ambientOcclusion)
        {
          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
        }
      `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.EvaluateMainLighting=function(b){b=b.fragment;b.uniforms.add("lightingMainDirection","vec3");b.uniforms.add("lightingMainIntensity","vec3");b.uniforms.add("lightingFixedFactor","float");b.code.add(g.glsl`
    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);

      // move lighting towards (1.0, 1.0, 1.0) if requested
      dotVal = mix(dotVal, 1.0, lightingFixedFactor);

      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.Normals=function(b,p){b=b.fragment;b.code.add(g.glsl`
    struct ShadingNormalParameters {
      vec3 normalView;
      vec3 viewDirection;
    } shadingParams;
    `);1===p.doubleSidedMode?b.code.add(g.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
      }
    `):2===p.doubleSidedMode?b.code.add(g.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
      }
    `):b.code.add(g.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return normalize(params.normalView);
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces"],function(a,g,b){a.HeaderComment=function(p,f){b.glsl`
  /*
  *  ${f.name}
  *  ${0===f.output?"RenderOutput: Color":1===f.output?"RenderOutput: Depth":3===f.output?"RenderOutput: Shadow":2===f.output?"RenderOutput: Normal":4===f.output?"RenderOutput: Highlight":""}
  */
  `};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../shaderModules/interfaces","./ColorConversion.glsl"],function(a,g,b){a.MixExternalColor=function(p){p.include(b.ColorConversion);p.code.add(g.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${g.glsl.int(1)}) {
        return allMixed;
      }
      else if (mode == ${g.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${g.glsl.int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${g.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${g.glsl.int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../core/shaderLibrary/util/DoublePrecision.glsl ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),function(a,g,b,p,f,k,c,d,e){d=function(h){function n(){return h.apply(this,
arguments)||this}b._inheritsLoose(n,h);n.prototype.initializeProgram=function(q){var u=n.shader.get();const v=this.configuration;u=u.build({OITEnabled:0===v.transparencyPassType,output:v.output,viewingMode:q.viewingMode,receiveShadows:v.receiveShadows,slicePlaneEnabled:v.slicePlaneEnabled,sliceHighlightDisabled:v.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:v.symbolColors,vvSize:v.vvSize,vvColor:v.vvColor,vvInstancingEnabled:!0,instanced:v.instanced,instancedColor:v.instancedColor,
instancedDoublePrecision:v.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:v.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:v.hasColorTexture,receiveAmbientOcclusion:v.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:v.hasColorTexture?1:0,textureAlphaPremultiplied:v.textureAlphaPremultiplied,attributeColor:v.vertexColors,screenSizePerspectiveEnabled:v.screenSizePerspective,
verticalOffsetEnabled:v.verticalOffset,offsetBackfaces:v.offsetBackfaces,doublePrecisionRequiresObfuscation:c.doublePrecisionRequiresObfuscation(q.rctx),alphaDiscardMode:v.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:v.multipassTerrainEnabled,cullAboveGround:v.cullAboveGround});return new k(q.rctx,u.generateSource("vertex"),u.generateSource("fragment"),f.Default3D)};return n}(d.DefaultMaterialTechnique);d.shader=new p.ReloadableShaderModule(e.RealisticTreeShader,()=>new Promise(function(h,
n){a(["../core/shaderLibrary/default/RealisticTree.glsl"],h,n)}));g.RealisticTreeTechnique=d;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){function B(F){const G=new p.ShaderBuilder,I=G.vertex.code,K=G.fragment.code;G.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");G.include(D.PositionAttribute);G.varyings.add("vpos","vec3");G.include(c.VisualVariables,F);G.include(v.InstancedDoublePrecision,F);G.include(e.VerticalOffset,F);if(0===F.output||7===F.output)G.include(y.NormalAttribute,F),G.include(b.Transform,{linearDepth:!1}),
F.offsetBackfaces&&G.include(w.Offset),F.instancedColor&&G.attributes.add("instanceColor","vec4"),G.varyings.add("vNormalWorld","vec3"),G.varyings.add("localvpos","vec3"),F.multipassTerrainEnabled&&G.varyings.add("depth","float"),G.include(t.TextureCoordinateAttribute,F),G.include(q.ForwardLinearDepth,F),G.include(z.SymbolColor,F),G.include(r.VertexColor,F),G.vertex.uniforms.add("externalColor","vec4"),G.varyings.add("vcolorExt","vec4"),I.add(g.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${F.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${g.glsl.float(d.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${F.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${F.multipassTerrainEnabled?g.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);7===F.output&&(G.include(f.Slice,F),G.include(d.DiscardOrAdjustAlpha,F),F.multipassTerrainEnabled&&(G.fragment.include(k.ReadLinearDepth),G.include(h.multipassTerrainTest,F)),G.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),G.fragment.uniforms.add("view","mat4"),F.hasColorTexture&&G.fragment.uniforms.add("tex","sampler2D"),G.fragment.include(m.MixExternalColor),K.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.multipassTerrainEnabled?g.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${F.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${F.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:g.glsl`vec4 texColor = vec4(1.0);`}
        ${F.attributeColor?g.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:g.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));0===F.output&&(G.include(f.Slice,F),G.include(x.EvaluateSceneLighting,F),G.include(A.EvaluateAmbientOcclusion,F),G.include(d.DiscardOrAdjustAlpha,F),F.receiveShadows&&G.include(n.ReadShadowMap,F),F.multipassTerrainEnabled&&(G.fragment.include(k.ReadLinearDepth),G.include(h.multipassTerrainTest,F)),G.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),G.fragment.uniforms.add("view","mat4"),
F.hasColorTexture&&G.fragment.uniforms.add("tex","sampler2D"),G.include(l.PhysicallyBasedRenderingParameters,F),G.include(u.PhysicallyBasedRendering,F),G.fragment.include(m.MixExternalColor),K.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.multipassTerrainEnabled?g.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${F.hasColorTexture?g.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${F.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:g.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===F.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${F.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===F.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${F.attributeColor?g.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:g.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${g.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===F.pbrMode||2===F.pbrMode?1===F.viewingMode?g.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:g.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:g.glsl``}
        ${1===F.pbrMode||2===F.pbrMode?g.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${F.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));G.include(C.DefaultMaterialAuxiliaryPasses,F);return G}var E=Object.freeze({__proto__:null,build:B});a.RealisticTreeShader=E;a.build=B})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../core/Error ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../support/arcadeOnDemand ../../../../Color ../../../../symbols/CIMSymbol ../../../../core/screenUtils ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../symbols/support/utils ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/HUDMaterial ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./pointUtils ../../terrain/OverlayRenderer ../../../2d/arcade/callExpressionWithFeature ./constants ./Graphics3DDrapedGraphicLayer ./sdfPrimitives ../support/FastSymbolUpdates ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R){function T(O){return f.isSome(O)?"cross"===O||"x"===O:!1}const W=D.create(),Y=l.fromValues(0,0,1),U=[.25,.25,.75,.75];v=function(O){function V(fa,ia,ma,ea){fa=O.call(this,fa,ia,ma,ea)||this;fa._cimLayers=null;fa._cimSymbolMaterials=new Map;fa._cimSymbolTextures=new Map;fa._cimMaterialParametersInfo=null;fa._cimRequiredFields=null;fa._cimScaleFactorOrFunction=null;fa._size=null;fa._symbolTextureRatio=1;fa._outlineSize=
0;fa._texture=null;fa._releaseTexture=null;fa._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return fa}b._inheritsLoose(V,O);var ba=V.prototype;ba.getCachedSize=function(){return{size:this._getIconSize()}};ba.doLoad=async function(fa){this._validateOrThrow();const ia=this._prepareMaterialParameters();var ma=this._getPrimitive();if(f.isSome(ma))this._prepareResourcesPrimitive(ia,ma);else{ma=w.getIconHref(this.symbol,this.symbolLayer);const ea=c.dataComponents(ma);ea&&"application/json"===
ea.mediaType?await this._prepareResourcesCIM(ia,JSON.parse(ea.data),fa):await this._prepareResourcesHref(ia,ma,fa)}};ba._validateOrThrow=function(){if(!this._drivenProperties.size){var fa=B.validateSymbolLayerSize(this._getIconSize());if(fa)throw new k("graphics3diconsymbollayer:invalid-size",fa);}};ba._getIconSize=function(){var fa=this.symbolLayer;fa=Math.round(null!=fa.size?q.pt2px(fa.size):16);return this._drivenProperties.size?Math.max(fa,64):fa};ba._generateTextureCIM=function(fa){const ia=
this._getGraphicHash(fa);let ma=""===ia?null:this._cimSymbolTextures.get(ia);ma||(fa=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,fa,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",fa.anchorPosition),ma=new R.Texture(fa.imageData,{width:fa.imageData.width,height:fa.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(ia,ma),this._context.stage.add(ma));
return ma};ba._computeSize=function(fa,ia){fa=fa.width/fa.height;return 1<fa?[ia,Math.round(ia/fa)]:[Math.round(ia*fa),ia]};ba._prepareMaterialParameters=function(){const fa={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ia=this.symbol;if(ia&&"point-3d"===ia.type&&ia.hasVisibleVerticalOffset()){const {screenLength:ma,minWorldLength:ea,maxWorldLength:M}=ia.verticalOffset;fa.verticalOffset={screenLength:q.pt2px(ma),minWorldLength:ea||0,maxWorldLength:null!=M?
M:Infinity}}this._context.screenSizePerspectiveEnabled&&(fa.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);fa.occlusionTest=!0;fa.slicePlaneEnabled=this._context.slicePlaneEnabled;return fa};ba._prepareResourcesPrimitive=function(fa,ia){var ma=this._getOutlineSize();if(T(ia)&&0===ma)throw Error("Nothing to render");this._outlineSize=ma;fa.color=this._getFillColor();fa.outlineColor=this._getOutlineColor();fa.outlineSize=this._outlineSize;const ea=this._context.sharedResources.textures.fromData(ia,
()=>{switch(ia){case "circle":var M=aa.createCircle(128,64);break;case "square":M=aa.createSquare(128,64);break;case "kite":M=aa.createKite(128,64);break;case "cross":M=aa.createCross(128,64);break;case "x":M=aa.createX(128,64);break;case "triangle":M=aa.createTriangle(128,64)}return M=new R.Texture(M,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=ea.texture;this._releaseTexture=()=>this._context.sharedResources.textures.release(ea.uid);fa.textureIsSignedDistanceField=
!0;fa.distanceFieldBoundingBox=U;fa.textureId=this._texture.id;ma=this._getIconSize();this._size=[ma,ma];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(fa,this._context.stage)};ba._prepareResourcesHref=async function(fa,ia,ma){if(!p("esri-canvas-svg-support")&&c.isSVG(ia))throw new k("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();fa.color=this._getFillColor();fa.outlineColor=
this._getOutlineColor();fa.outlineSize=this._outlineSize;fa.textureIsSignedDistanceField=!1;const ea=this._getIconSize();ma=await t.result(this._context.sharedResources.textures.fromUrl(ia,ea*this._context.layerView.view.pixelRatio,{signal:ma}));if(!1===ma.ok)throw d.throwIfAbortError(ma.error),new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ia})`);const {uid:M,texture:Z}=ma.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(M);
this._size=this._computeSize(Z.params,ea);fa.textureId=Z.id;this._createMaterialAndAddToStage(fa,this._context.stage)};ba._prepareResourcesCIM=async function(fa,ia,ma){ia=new n({data:ia});if(!this._context.sharedResources.cimSymbolRasterizer){var ea=(await new Promise(function(ka,ha){a(["../../../../symbols/cim/CIMSymbolRasterizer"],ka,ha)})).CIMSymbolRasterizer;d.throwIfAborted(ma);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new ea(this._context.renderCoordsHelper.spatialReference,
!0))}ea=this._context.layer.fields?this._context.layer.fields.map(ka=>ka.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(ia,ea,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ma});let M;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(ia=this._context.renderer,isNaN(ia.scaleExpression)){const ka=
await e.createRendererExpression(ia.scaleExpression,this._context.layer.spatialReference,ea);M=(ha,na,da)=>{ha=P(ka,ha,{$view:da},"esriGeometryPoint",na);return null!==ha?ha:1}}else var Z=Number(ia.scaleExpression);this._cimScaleFactorOrFunction=Z||M||1;Z=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fields):[];d.throwIfAborted(ma);const la=this._context.layer.fieldsIndex;this._cimRequiredFields=Z.map(ka=>la.get(ka).name);this._cimMaterialParametersInfo=
fa;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1};ba._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||u.defaultPrimitive};ba._getOutlineSize=function(){var fa=0;fa=this.symbolLayer;if(f.isSome(fa.outline)&&null!=fa.outline.size)return Math.max(q.pt2px(fa.outline.size),
0);fa=this._getPrimitive();fa=T(fa)?1.5:0;return Math.max(fa,0)};ba._getOutlineColor=function(){const fa=this._getLayerOpacity(),ia=f.get(this.symbolLayer,"outline","color");if(f.isSome(ia)){const ma=h.toUnitRGB(ia);return[ma[0],ma[1],ma[2],ia.a*fa]}return[0,0,0,0]};ba._getFillColor=function(){if(T(this._getPrimitive()))return Q.TRANSPARENT_UNIT;const fa=f.isNone(this._getPrimitive()),ia=f.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ia,{hasIntrinsicColor:fa})};
ba._getAnchorPos=function(fa,ia){return"relative"===fa?z.fromValues((ia.x||0)+.5,-(ia.y||0)+.5):fa in B.namedAnchorToHUDMaterialAnchorPos?B.namedAnchorToHUDMaterialAnchorPos[fa]:B.namedAnchorToHUDMaterialAnchorPos.center};ba._createMaterialAndAddToStage=function(fa,ia){this._fastUpdates=this._cimLayers?{enabled:!1}:S.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(fa,this._fastUpdates.materialParameters);if(this._cimLayers){let ma=
this._cimSymbolMaterials.get(fa.textureId);ma||(ma=new m.HUDMaterial(fa),this._cimSymbolMaterials.set(fa.textureId,ma),ia.add(ma));return ma}this._material=new m.HUDMaterial(fa);ia.add(this._material);return this._material};ba._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(fa=>{fa.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};
ba.destroy=function(){O.prototype.destroy.call(this);this._forEachMaterial(fa=>this._context.stage.remove(fa));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(fa=>this._context.stage.remove(fa));this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};ba._getScaleFactor=function(fa,ia){if(this._drivenProperties.size&&fa.size){for(let ma=0;3>ma;ma++){const ea=fa.size[ma];ea&&"symbol-value"!==ea&&"proportional"!==
ea&&(fa.size[ma]=q.pt2px(ea))}if("symbol-value"===fa.size[0])return 1;if(isFinite(+fa.size[0]))return+fa.size[0]/ia;if(isFinite(+fa.size[2]))return+fa.size[2]/ia}return 1};ba.createGraphics3DGraphic=function(fa){const ia=fa.graphic;if(!this._validateGeometry(ia.geometry))return null;let ma;if(this._cimLayers){if(!this._cimLayers.length)return null;var ea=this._generateTextureCIM(ia);ma=this._createMaterialAndAddToStage({textureId:ea.id,...this._cimMaterialParametersInfo},this._context.stage);var M=
[ea.params.width,ea.params.height]}else M=this._size,ma=f.unwrap(this._material);ea=J.placePointOnGeometry(ia.geometry);if(f.isNone(ea))return this.logger.warn(`unsupported geometry type for icon symbol: ${ia.geometry.type}`),null;var Z=fa.renderingInfo;const la=this._getVertexOpacityAndColor(Z);let ka=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(ka=this._getScaleFactor(Z,M[0]>M[1]?M[0]:M[1]));ka*=this._symbolTextureRatio;M=[M[0]*ka,M[1]*ka];Z=this.setGraphicElevationContext(ia,
new G.ElevationContext);this.ensureDrapedStatus("on-the-ground"===Z.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ia,ea,ma,la,M,fa.layer.uid):this._createAs3DShape(ia,ea,ma,la,M,Z,ia.uid)};ba.layerOpacityChanged=function(){const fa=this._getFillColor(),ia=this._getOutlineColor();this._forEachMaterial(ma=>{ma.setParameterValues({color:fa});ma.setParameterValues({outlineColor:ia})});return!0};ba.layerElevationInfoChanged=function(fa,ia,ma){const ea=this._elevationContext.mode;
ma=E.elevationModeChangeUpdateType(V.elevationModeChangeTypes,ma,ea);if(ma!==E.SymbolUpdateType.UPDATE)return ma;const M=E.needsElevationUpdates2D(ea)||"absolute-height"===ea;return this.updateGraphics3DGraphicElevationInfo(fa,ia,()=>M)};ba.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(fa=>{fa.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};ba.physicalBasedRenderingChanged=function(){return!0};ba.pixelRatioChanged=function(){return this._getPrimitive()?
!0:!1};ba.applyRendererDiff=function(fa,ia){for(const ma in fa.diff)switch(ma){case "visualVariables":if(S.updateFastSymbolUpdatesState(this._fastUpdates,ia,this._fastVisualVariableConvertOptions()))f.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};ba._defaultElevationInfoNoZ=function(){return N};ba._createAs3DShape=function(fa,ia,ma,ea,M,Z,la){const ka=this.getFastUpdateAttrValues(fa);fa=ka?na=>S.evaluateModelTransform(this._fastUpdates.materialParameters,
ka,na):null;ea=[x.createPointGeometry(Y,null,ea,M,ca,null,ka)];la=J.createStageObjectForHUD(this._context,ia,ea,[ma],null,null,Z,this._context.layer.uid,la,fa);if(null===la)return null;const ha=new I(this,la.object,ea,null,null,F.perObjectElevationAligner,Z);ha.alignedSampledElevation=la.sampledElevation;ha.needsElevationUpdates=E.needsElevationUpdates2D(Z.mode)||"absolute-height"===Z.mode;ha.getScreenSize=this._createScreenSizeGetter(M,fa);ha.calculateRelativeScreenBounds=na=>ma.calculateRelativeScreenBounds(ha.getScreenSize(),
1,na);J.extendPointGraphicElevationContext(ha,ia,this._context.elevationProvider);return ha};ba._createAsOverlay=function(fa,ia,ma,ea,M,Z){ma.renderPriority=this._renderPriority;const la=r.create();y.projectPointToVector(ia,la,this._context.overlaySR);la[2]=L.DRAPED_Z;ia=this._context.clippingExtent;if(f.isSome(ia)&&!A.containsPoint(ia,la))return null;const ka=this.getFastUpdateAttrValues(fa);ia=ka?na=>S.evaluateModelTransform(this._fastUpdates.materialParameters,ka,na):null;ea=x.createPointGeometry(Y,
la,ea,M,null,null,ka);fa=new H.RenderGeometry(ea,ma,Z,fa.uid);la[3]=0;C.copy(fa.boundingSphere,la);fa.calculateShaderTransformation=ia;const ha=new X(this,[fa],null);ha.getScreenSize=this._createScreenSizeGetter(M,ia);ha.calculateRelativeScreenBounds=na=>ma.calculateRelativeScreenBounds(ha.getScreenSize(),1,na);return ha};ba._createScreenSizeGetter=function(fa,ia){const ma=this._outlineSize+2;if(this._fastUpdates.enabled){const ea=fa[0]/this._symbolTextureRatio,M=fa[1]/this._symbolTextureRatio;return(Z=
z.create())=>{const la=ia(W);Z[0]=la[0]*ea+ma;Z[1]=la[5]*M+ma;return Z}}{const ea=fa[0]/this._symbolTextureRatio+ma,M=fa[1]/this._symbolTextureRatio+ma;return(Z=z.create())=>{Z[0]=ea;Z[1]=M;return Z}}};ba._fastVisualVariableConvertOptions=function(){var fa=this._size[0]>this._size[1]?this._size[0]:this._size[1];const ia=l.fromValues(fa,fa,fa),ma=q.px2pt(1);fa*=ma;fa=l.fromValues(fa,fa,fa);return{modelSize:ia,symbolSize:fa,unitInMeters:ma,transformation:{anchor:l.ZEROS,scale:l.ONES,rotation:l.ZEROS}}};
ba._getGraphicHash=function(fa){let ia="";for(const ma of this._cimRequiredFields)ia+=ma+fa.attributes[ma];return ia};ba._forEachMaterial=function(fa){f.isSome(this._material)&&fa(this._material);this._cimSymbolMaterials.forEach(fa)};return V}(K.Graphics3DSymbolLayer);v.PRIMITIVE_SIZE=[64,64];v.elevationModeChangeTypes={definedChanged:E.SymbolUpdateType.UPDATE,staysOnTheGround:E.SymbolUpdateType.NONE,onTheGroundChanged:E.SymbolUpdateType.RECREATE};const N={mode:"relative-to-ground",offset:0},ca=r.fromValues(0,
0,0,1);g.Graphics3DIconSymbolLayer=v;g.default=v;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Logger","../../../core/Error","../../../geometry/support/quantizationUtils"],function(a,g,b){function p(k){const c={};switch(k){case "esriGeometryPoint":return(d,e,h,n)=>b.unquantizePoint(e,c,d,h,n);case "esriGeometryPolygon":return(d,e,h,n)=>b.unquantizePolygon(e,c,d,h,n);case "esriGeometryPolyline":return(d,e,h,n)=>
b.unquantizePolyline(e,c,d,h,n);case "esriGeometryMultipoint":return(d,e,h,n)=>b.unquantizeMultipoint(e,c,d,h,n);default:return a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new g("mapview-arcade",`Unable to handle geometryType: ${k}`)),d=>d}}const f=new Map;return function(k,c,d,e,h){if(k.referencesGeometry()&&h){{const {transform:n,hasZ:q,hasM:u}=h;f.has(e)||f.set(e,p(e));e=f.get(e)(c.geometry,n,q,u);c={...c,geometry:e}}}c=k.repurposeFeature(c);try{return k.evaluate({...d,$feature:c})}catch(n){return a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
n),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,g){const b=g.ZEROS;g=g.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=b;a.WHITE_UNIT=g;a.defaultIconElevationOffset=1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/aaBoundingBox ./graphicUtils".split(" "),
function(a,g,b,p,f,k){let c=function(){function n(u,v,t){this.graphics3DSymbolLayer=u;this.renderGeometries=v;this.boundingBox=t;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}var q=n.prototype;q.initialize=function(u,v,t){this.stage=u;this._layerView=t;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};q.setVisibility=function(u){if(null!=this.stage&&this._visible!==u)if((this._visible=u)&&!this._addedToStage)this._addedToStage=
!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);else if(u||this._addedToStage){for(const v of this.renderGeometries)v.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}};q.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};q.getBSRadius=function(){return this.renderGeometries.reduce((u,
v)=>Math.max(u,v.boundingSphere[3]),0)};q.getCenterObjectSpace=function(u=g.create()){return b.set(u,0,0,0)};q.getBoundingBoxObjectSpace=function(u=f.create()){return f.empty(u)};q.addObjectState=function(u,v){0===u&&(this.renderGeometries.forEach(t=>{const l=t.addHighlight();v.addRenderGeometry(t,l,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};q.removeObjectState=function(u){this.renderGeometries.forEach(v=>{u.removeRenderGeometry(v)})};
q.removeRenderGeometryObjectState=function(u,v){u.removeHighlight(v);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};q.computeAttachmentOrigin=function(u){for(const v of this.renderGeometries)v.computeAttachmentOrigin(h)&&(u.draped.origin[0]+=h[0],u.draped.origin[1]+=h[1],u.draped.num++)};q.getProjectedBoundingBox=async function(u,v,t,l,w){f.empty(w);for(let y=0;y<this.renderGeometries.length;y++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[y],
u,d,t),f.expandWithRect(w,d);if(v){f.center(w,h);let y;u=k.demResolutionForBoundingBox(w,v);try{y=await v.service.queryElevation(h[0],h[1],l,u,"ground")}catch(D){}a.isSome(y)&&(w[2]=Math.min(w[2],y),w[5]=Math.max(w[5],y))}return w};q._getRenderGeometryProjectedBoundingRect=function(u,v,t,l){if(this.boundingBox)f.set(e,this.boundingBox);else{u=u.boundingSphere;const w=u[3];e[0]=u[0]-w;e[1]=u[1]-w;e[2]=u[2]-w;e[3]=u[0]+w;e[4]=u[1]+w;e[5]=u[2]+w}v(e,0,2);this.calculateRelativeScreenBounds&&l.push({location:f.center(e),
screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return f.toRect(e,t)};return n}();const d=p.create(),e=f.create(),h=g.create();return c})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/Util"],function(a,g,b){function p(q,u){const v=new Uint8Array(4*q*q),t=q/2-.5;u/=2;for(let w=0;w<q;w++)for(let y=0;y<q;y++){const D=y+q*w;var l=y-t;const z=w-t;l=Math.sqrt(l*l+z*z)-u;l=l/q+.5;b.packFloatRGBA(l,v,4*D)}return v}
function f(q,u){return h(q,u,!1)}function k(q,u){return h(q,u,!0)}function c(q,u){return n(q,u,!1)}function d(q,u){return n(q,u,!0)}function e(q,u){const v=new Uint8Array(4*q*q),t=Math.sqrt(1.25),l=(q-u)/2;for(let w=0;w<q;w++)for(let y=0;y<q;y++){const D=(y-l)/u,z=(w-l+.75)/u;b.packFloatRGBA(Math.max(-(1*D+-.5*z)/t,(D-1+-.5*-z)/t,-z)*u/q+.5,v,4*(w*q+y))}return v}function h(q,u,v){v&&(u/=Math.SQRT2);const t=new Uint8Array(4*q*q);for(let w=0;w<q;w++)for(let y=0;y<q;y++){var l=y-.5*q+.25;let D=-w+.5*
q-.75;const z=w*q+y;if(v){const r=(l+D)/Math.SQRT2;D=(D-l)/Math.SQRT2;l=r}l=Math.max(Math.abs(l),Math.abs(D))-.5*u;l=l/q+.5;b.packFloatRGBA(l,t,4*z)}return t}function n(q,u,v){v&&(u*=Math.SQRT2);u*=.5;const t=new Uint8Array(4*q*q);for(let w=0;w<q;w++)for(let y=0;y<q;y++){var l=y-.5*q;let D=-w+.5*q-1;const z=w*q+y;if(v){const r=(l+D)/Math.SQRT2;D=(D-l)/Math.SQRT2;l=r}l=Math.abs(l);D=Math.abs(D);l=l>D?l>u?Math.sqrt((l-u)*(l-u)+D*D):D:D>u?Math.sqrt(l*l+(D-u)*(D-u)):l;l=l/q+.5;b.packFloatRGBA(l,t,4*z)}return t}
a.createCircle=p;a.createCross=c;a.createKite=k;a.createSquare=f;a.createTriangle=e;a.createType=function(q,u,v){switch(q){case "circle":return p(u,v);case "square":return f(u,v);case "cross":return c(u,v);case "x":return d(u,v);case "kite":return k(u,v);case "triangle":return e(u,v);default:return p(u,v)}};a.createX=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../renderers/support/lengthUtils ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/mat3 ../../support/debugFlags".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){function q(K){return null!==K&&void 0!==K}function u(K){return"number"===typeof K}function v(K){return"string"===typeof K}function t(K,J){K&&K.push(J)}function l(K,J,L,P=e.create()){K=K||0;J=J||0;L=L||0;0!==K&&c.rotateZ(P,P,-K/180*Math.PI);0!==J&&c.rotateX(P,P,J/180*Math.PI);0!==L&&c.rotateY(P,P,L/180*Math.PI);return P}function w(K,J,L,P,Q){const X=K.minSize,aa=K.maxSize;if(K.expression)return t(Q,"Could not convert size info: expression not supported"),!1;if(K.useSymbolValue)return K=
P.symbolSize[L],J.minSize[L]=K,J.maxSize[L]=K,J.offset[L]=J.minSize[L],J.factor[L]=0,J.type[L]=1,!0;if(q(K.field)){if(q(K.stops)){if(2===K.stops.length&&u(K.stops[0].size)&&u(K.stops[1].size))return y(K.stops[0].size,K.stops[1].size,K.stops[0].value,K.stops[1].value,J,L),J.type[L]=1,!0;t(Q,"Could not convert size info: stops only supported with 2 elements");return!1}if(u(X)&&u(aa)&&q(K.minDataValue)&&q(K.maxDataValue))return y(X,aa,K.minDataValue,K.maxDataValue,J,L),J.type[L]=1,!0;if(null!=k.meterIn[K.valueUnit])return J.minSize[L]=
-Infinity,J.maxSize[L]=Infinity,J.offset[L]=0,J.factor[L]=1/k.meterIn[K.valueUnit],J.type[L]=1,!0;if("unknown"===K.valueUnit)return t(Q,"Could not convert size info: proportional size not supported"),!1;t(Q,"Could not convert size info: scale-dependent size not supported");return!1}if(!q(K.field)){if(K.stops&&K.stops[0]&&u(K.stops[0].size))return J.minSize[L]=K.stops[0].size,J.maxSize[L]=K.stops[0].size,J.offset[L]=J.minSize[L],J.factor[L]=0,J.type[L]=1,!0;if(u(X))return J.minSize[L]=X,J.maxSize[L]=
X,J.offset[L]=X,J.factor[L]=0,J.type[L]=1,!0}t(Q,"Could not convert size info: unsupported variant of sizeInfo");return!1}function y(K,J,L,P,Q,X){P=0<Math.abs(P-L)?(J-K)/(P-L):0;Q.minSize[X]=0<P?K:J;Q.maxSize[X]=0<P?J:K;Q.offset[X]=K-L*P;Q.factor[X]=P}function D(K,J,L,P){if(K.normalizationField||K.valueRepresentation)return t(P,"Could not convert size info: unsupported property"),null;var Q=K.field;if(null!=Q&&!v(Q))return t(P,"Could not convert size info: field is not a string"),null;if(!J.size)J.size=
{field:K.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(K.field)if(!J.size.field)J.size.field=K.field;else if(K.field!==J.size.field)return t(P,"Could not convert size info: multiple fields in use"),null;switch(K.axis){case "width":return(Q=w(K,J.size,0,L,P))?J:null;case "height":return(Q=w(K,J.size,2,L,P))?J:null;case "depth":return(Q=w(K,J.size,1,L,P))?J:null;case "width-and-depth":return(Q=w(K,J.size,0,L,P))&&w(K,J.size,1,L,P),Q?J:null;case null:case void 0:case "all":return(Q=
(Q=(Q=w(K,J.size,0,L,P))&&w(K,J.size,1,L,P))&&w(K,J.size,2,L,P))?J:null;default:return t(P,`Could not convert size info: unknown axis "${K.axis}""`),null}}function z(K,J,L){for(let P=0;3>P;++P){let Q=J.unitInMeters;1===K.type[P]&&(Q*=J.modelSize[P],K.type[P]=2);K.minSize[P]/=Q;K.maxSize[P]/=Q;K.offset[P]/=Q;K.factor[P]/=Q}if(0!==K.type[0])J=0;else if(0!==K.type[1])J=1;else if(0!==K.type[2])J=2;else return t(L,"No size axis contains a valid size or scale"),!1;for(L=0;3>L;++L)0===K.type[L]&&(K.minSize[L]=
K.minSize[J],K.maxSize[L]=K.maxSize[J],K.offset[L]=K.offset[J],K.factor[L]=K.factor[J],K.type[L]=K.type[J]);return!0}function r(K,J,L){K[4*J]=L.r/255;K[4*J+1]=L.g/255;K[4*J+2]=L.b/255;K[4*J+3]=L.a}function C(K,J,L){if(K.normalizationField)return t(L,"Could not convert color info: unsupported property"),null;if(v(K.field))if(K.stops){if(8<K.stops.length)return t(L,"Could not convert color info: too many color stops"),null;J.color={field:K.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};K=K.stops;for(L=0;8>L;++L){const P=K[Math.min(L,K.length-1)];J.color.values[L]=P.value;r(J.color.colors,L,P.color)}}else return t(L,"Could not convert color info: missing stops or colors"),null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].color,J.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},L=0;8>L;L++)J.color.values[L]=Infinity,r(J.color.colors,
L,K);else return t(L,"Could not convert color info: no field and no colors/stops"),null;return J}function A(K,J,L){if(K.normalizationField)return t(L,"Could not convert opacity info: unsupported property"),null;if(v(K.field))if(K.stops){if(8<K.stops.length)return t(L,"Could not convert opacity info: too many opacity stops"),null;J.opacity={field:K.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};K=K.stops;for(L=0;8>L;++L){const P=K[Math.min(L,K.length-1)];J.opacity.values[L]=P.value;
J.opacity.opacityValues[L]=P.opacity}}else return t(L,"Could not convert opacity info: missing stops or opacities"),null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].opacity,J.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},L=0;8>L;L++)J.opacity.values[L]=Infinity,J.opacity.opacityValues[L]=K;else return t(L,"Could not convert opacity info: no field and no opacities/stops"),null;return J}function x(K,J,L){K=2===L&&"arithmetic"===K.rotationType;
J.offset[L]=K?90:0;J.factor[L]=K?-1:1;J.type[L]=1}function m(K,J,L){if(!v(K.field))return t(L,"Could not convert rotation info: field is not a string"),null;if(!J.rotation)J.rotation={field:K.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(K.field)if(!J.rotation.field)J.rotation.field=K.field;else if(K.field!==J.rotation.field)return t(L,"Could not convert rotation info: multiple fields in use"),null;switch(K.axis){case "tilt":return x(K,J.rotation,0),J;case "roll":return x(K,J.rotation,
1),J;case null:case void 0:case "heading":return x(K,J.rotation,2),J;default:return t(L,`Could not convert rotation info: unknown axis "${K.axis}""`),null}}function B(K,J,L){if(!K)return null;const P=!J.supportedTypes||!!J.supportedTypes.size,Q=!J.supportedTypes||!!J.supportedTypes.color,X=!J.supportedTypes||!!J.supportedTypes.rotation,aa=!!J.supportedTypes&&!!J.supportedTypes.opacity,S=K.reduce((H,R)=>{if(!H)return H;if(R.valueExpression)return t(L,"Could not convert visual variables: arcade expressions not supported"),
null;switch(R.type){case "size":return P?D(R,H,J,L):H;case "color":return Q?C(R,H,L):H;case "opacity":return aa?A(R,H,L):null;case "rotation":return X?m(R,H,L):H;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<K.length&&S&&!S.size&&!S.color&&!S.opacity&&!S.rotation||S&&S.size&&!z(S.size,J,L)?null:S}function E(K,J,L){if(!!K!==!!J||K&&K.field!==J.field)return!1;if(K&&"rotation"===L)for(L=0;3>L;L++)if(K.type[L]!==J.type[L]||K.offset[L]!==J.offset[L]||K.factor[L]!==J.factor[L])return!1;
return!0}function F(K,J){const L={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},P=K&&null!=K.size;K&&K.size?(L.vvSizeEnabled=!0,L.vvSizeMinSize=K.size.minSize,L.vvSizeMaxSize=K.size.maxSize,L.vvSizeOffset=K.size.offset,L.vvSizeFactor=K.size.factor):K&&P&&(L.vvSizeValue=
J.transformation.scale);K&&P&&(L.vvSymbolAnchor=J.transformation.anchor,L.vvSymbolRotationMatrix=d.create(),c.identity(I),l(J.transformation.rotation[2],J.transformation.rotation[0],J.transformation.rotation[1],I),h.fromMat4(L.vvSymbolRotationMatrix,I));K&&K.color&&(L.vvColorEnabled=!0,L.vvColorValues=K.color.values,L.vvColorColors=K.color.colors);K&&K.opacity&&(L.vvOpacityEnabled=!0,L.vvOpacityValues=K.opacity.values,L.vvOpacityOpacities=K.opacity.opacityValues);return L}var G;(function(K){const J=
e.create(),L=p.create();K.evaluateModelTransform=function(P,Q,X){if(!P.vvSizeEnabled)return X;c.copy(J,X);X=P.vvSymbolRotationMatrix;c.set(I,X[0],X[1],X[2],0,X[3],X[4],X[5],0,X[6],X[7],X[8],0,0,0,0,1);c.multiply(J,J,I);for(X=0;3>X;++X)L[X]=b.clamp(P.vvSizeOffset[X]+Q[0]*P.vvSizeFactor[X],P.vvSizeMinSize[X],P.vvSizeMaxSize[X]);c.scale(J,J,L);c.translate(J,J,P.vvSymbolAnchor);return J};K.evaluateModelTransformScale=function(P,Q,X){if(!Q.vvSizeEnabled)return f.set(P,1,1,1);for(let aa=0;3>aa;++aa)P[aa]=
b.clamp(Q.vvSizeOffset[aa]+X[0]*Q.vvSizeFactor[aa],Q.vvSizeMinSize[aa],Q.vvSizeMaxSize[aa]);return P}})(G||(G={}));const I=e.create();g=G.evaluateModelTransform;G=G.evaluateModelTransformScale;a.convertVisualVariables=B;a.evaluateModelTransform=g;a.evaluateModelTransformScale=G;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(K,J){return!K||n.DISABLE_FAST_UPDATES?{enabled:!1}:(K=B(K.visualVariables,J))?{enabled:!0,visualVariables:K,materialParameters:F(K,J),requiresShaderTransformation:K&&
null!=K.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(K,J,L){if(!J||!K.enabled)return!1;const P=K.visualVariables;J=B(J.visualVariables,L);if(!(J&&E(P.size,J.size,"size")&&E(P.color,J.color,"color")&&E(P.rotation,J.rotation,"rotation")&&E(P.opacity,J.opacity,"opacity")))return!1;K.visualVariables=J;K.materialParameters=F(J,L);K.requiresShaderTransformation=J&&null!=J.size;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ./geometryDataUtils ./Object3DStateID ../materials/renderers/utils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){let q=function(){function u(t,l,w=null,y=null,D,z,r,C,A){this.data=t;this.material=l;this.layerUid=w;this.graphicUid=y;this.boundingSphere=d.create();this.instanceParameters={highlights:null,occludees:null,visible:!0};this.shaderTransformationDirty=!0;this.boundingInfo=D;this.material=l;this.transformation=this.origin=null;this.calculateShaderTransformation=r;z&&this.updateTransformation(z,C);this.castShadow=A}var v=u.prototype;v.updateTransformation=function(t,l){this.transformation=
t;this.shaderTransformationDirty=!0;this.computeBoundingSphere(t,l,this.boundingSphere)};v.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};v.computeBoundingSphere=function(t,l,w){b.isNone(this.boundingInfo)||(l=l||f.maxScale(t),p.transformMat4(w,this.boundingInfo.getCenter(),t),w[3]=this.boundingInfo.getBSRadius()*l)};v.getShaderTransformation=function(){if(b.isNone(this.calculateShaderTransformation))return b.unwrapOr(this.transformation,c.IDENTITY);this.shaderTransformationDirty&&
(this.shaderTransformation||(this.shaderTransformation=c.create()),k.copy(this.shaderTransformation,this.calculateShaderTransformation(b.unwrapOr(this.transformation,c.IDENTITY))),this.shaderTransformationDirty=!1);return this.shaderTransformation};v.computeAttachmentOrigin=function(t){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,t)?(b.isSome(this.transformation)&&p.transformMat4(t,t,this.transformation),!0):!1;const l=this.indices.get("position"),w=this.vertexAttributes.get("position");
return e.computeAttachmentOriginTriangles(w,l,t)?(b.isSome(this.transformation)&&p.transformMat4(t,t,this.transformation),!0):!1};v.addHighlight=function(){const t=new h.Object3DStateID(0),l=this.instanceParameters;l.highlights=n.addObject3DStateID(l.highlights,t);return t};v.removeHighlight=function(t){const l=this.instanceParameters;l.highlights=n.removeObject3DStateID(l.highlights,t)};g._createClass(u,[{key:"hasShaderTransformation",get:function(){return b.isSome(this.calculateShaderTransformation)}},
{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return u}();a.RenderGeometry=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/Error ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../support/requestUtils ../../../../support/requestImageUtils ./Util ./ContentObject ../../../webgl/capabilities/isWebGL2Context ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ../../../webgl/FramebufferObject ./BasisUtil ./DDSUtil".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r){v=function(C){function A(m,B){var E=C.call(this)||this;E.data=m;E.type=4;E.glTexture=null;E.powerOfTwoStretchInfo=null;E.loadingPromise=null;E.loadingController=null;E.events=new e;E.params=B||{};E.params.mipmap=!1!==E.params.mipmap;E.params.noUnpackFlip=E.params.noUnpackFlip||!1;E.params.preMultiplyAlpha=E.params.preMultiplyAlpha||!1;E.params.wrap=E.params.wrap||{s:10497,t:10497};E.params.powerOfTwoResizeMode=E.params.powerOfTwoResizeMode||1;E.estimatedTexMemRequired=
A.estimateTexMemRequired(E.data,E.params);E.startPreload();return E}g._inheritsLoose(A,C);var x=A.prototype;x.startPreload=function(){const m=this.data;f.isNone(m)||(m instanceof HTMLVideoElement?this.startPreloadVideoElement(m):m instanceof HTMLImageElement&&this.startPreloadImageElement(m))};x.startPreloadVideoElement=function(m){c.isBlobProtocol(m.src)||"auto"===m.preload&&m.crossOrigin||(m.preload="auto",m.crossOrigin="anonymous",m.src=m.src)};x.startPreloadImageElement=function(m){c.isDataProtocol(m.src)||
c.isBlobProtocol(m.src)||m.crossOrigin||(m.crossOrigin="anonymous",m.src=m.src)};A.getDataDimensions=function(m){return m instanceof HTMLVideoElement?{width:m.videoWidth,height:m.videoHeight}:m};A.estimateTexMemRequired=function(m,B){if(f.isNone(m))return 0;if(p.isArrayBuffer(m)||p.isUint8Array(m))return B.encoding===A.BASIS_ENCODING?z.estimateBasisTextureMemoryUsage(m):m.byteLength;const {width:E,height:F}=m instanceof Image||m instanceof ImageData||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement?
A.getDataDimensions(m):B;return(B.mipmap?4/3:1)*E*F*(B.components||4)||0};x.dispose=function(){this.data=void 0};x.createDescriptor=function(m){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?m.parameters.maxMaxAnisotropy:void 0}};x.load=function(m,B){if(f.isSome(this.glTexture))return this.glTexture;
if(f.isSome(this.loadingPromise))return this.loadingPromise;const E=this.data;return f.isNone(E)?(this.glTexture=new l(m,this.createDescriptor(m),null),m.bindTexture(this.glTexture,0),this.glTexture):"string"===typeof E?this.loadFromURL(m,B,E):E instanceof Image?this.loadFromImageElement(m,B,E):E instanceof HTMLVideoElement?this.loadFromVideoElement(m,B,E):E instanceof ImageData||E instanceof HTMLCanvasElement?this.loadFromImage(m,E,B):(p.isArrayBuffer(E)||p.isUint8Array(E))&&this.params.encoding===
A.DDS_ENCODING?this.loadFromDDSData(m,E):(p.isArrayBuffer(E)||p.isUint8Array(E))&&this.params.encoding===A.BASIS_ENCODING?this.loadFromBasis(m,E):p.isUint8Array(E)?this.loadFromPixelData(m,E):p.isArrayBuffer(E)?this.loadFromPixelData(m,new Uint8Array(E)):null};x.frameUpdate=function(m,B,E){if(!(this.data instanceof HTMLVideoElement)||f.isNone(this.glTexture)||2>this.data.readyState||E===this.data.currentTime)return E;if(f.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:F,vao:G,sourceTexture:I}=
this.powerOfTwoStretchInfo;I.setData(this.data);this.drawStretchedTexture(m,B,F,G,I,this.glTexture)}else{const {width:F,height:G}=this.data,{width:I,height:K}=this.glTexture.descriptor;F!==I||G!==K?this.glTexture.updateData(0,0,0,Math.min(F,I),Math.min(G,K),this.data):this.glTexture.setData(this.data)}this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};x.loadFromDDSData=function(m,B){this.glTexture=r.createDDSTexture(m,this.createDescriptor(m),B,this.params.mipmap);
m.bindTexture(this.glTexture,0);return this.glTexture};x.loadFromBasis=function(m,B){return this.loadAsync(()=>z.createTextureFromBasis(m,this.createDescriptor(m),B).then(E=>this.glTexture=E))};x.loadFromPixelData=function(m,B){u.assert(0<this.params.width&&0<this.params.height);const E=this.createDescriptor(m);E.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;E.width=this.params.width;E.height=this.params.height;this.glTexture=new l(m,E,B);m.bindTexture(this.glTexture,
0);return this.glTexture};x.loadAsync=async function(m){const B=d.createAbortController();this.loadingController=B;const E=m(B.signal);this.loadingPromise=E;m=()=>{this.loadingController===B&&(this.loadingController=null);this.loadingPromise===E&&(this.loadingPromise=null)};E.then(m,m);return E};x.loadFromURL=function(m,B,E){return this.loadAsync(async F=>{F=await q.requestImage(E,{signal:F});return this.loadFromImage(m,F,B)})};x.loadFromImageElement=function(m,B,E){return E.complete?this.loadFromImage(m,
E,B):this.loadAsync(async F=>{F=await n.loadImageAsync(E,E.src,!1,F);return this.loadFromImage(m,F,B)})};x.loadFromVideoElement=function(m,B,E){return 2<=E.readyState?this.loadFromImage(m,E,B):this.loadFromVideoElementAsync(m,B,E)};x.loadFromVideoElementAsync=function(m,B,E){return this.loadAsync(F=>new Promise((G,I)=>{const K=()=>{E.removeEventListener("loadeddata",J);E.removeEventListener("error",L);f.isSome(P)&&P.remove()},J=()=>{2<=E.readyState&&(K(),G(this.loadFromImage(m,E,B)))},L=Q=>{K();I(Q||
new k("Failed to load video"))};E.addEventListener("loadeddata",J);E.addEventListener("error",L);const P=d.onAbort(F,()=>L(d.createAbortError()))}))};x.loadFromImage=function(m,B,E){const F=A.getDataDimensions(B);this.params.width=F.width;this.params.height=F.height;const G=this.createDescriptor(m);G.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(m,G)&&(!h.isPowerOfTwo(F.width)||!h.isPowerOfTwo(F.height)))return this.glTexture=this.makePowerOfTwoTexture(m,B,F,G,E),m.bindTexture(this.glTexture,
0),this.glTexture;G.width=F.width;G.height=F.height;this.glTexture=new l(m,G,B);m.bindTexture(this.glTexture,0);return this.glTexture};x.requiresPowerOfTwo=function(m,B){const E="number"===typeof B.wrapMode?33071===B.wrapMode:33071===B.wrapMode.s&&33071===B.wrapMode.t;return!t(m.gl)&&(B.hasMipmap||!E)};x.makePowerOfTwoTexture=function(m,B,E,F,G){const {width:I,height:K}=E;E=h.nextHighestPowerOfTwo(I);const J=h.nextHighestPowerOfTwo(K);F.width=E;F.height=J;let L;switch(this.params.powerOfTwoResizeMode){case 2:F.textureCoordinateScaleFactor=
[I/E,K/J];L=new l(m,F);L.updateData(0,0,0,I,K,B);break;case 1:case null:case void 0:L=this.stretchToPowerOfTwo(m,B,F,G);break;default:b.neverReached(this.params.powerOfTwoResizeMode)}F.hasMipmap&&L.generateMipmap();return L};x.stretchToPowerOfTwo=function(m,B,E,F){const G=new l(m,E),I=new D(m,{colorTarget:0,depthStencilTarget:0},G);B=new l(m,{target:3553,pixelFormat:E.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!E.flipped,maxAnisotropy:8,preMultiplyAlpha:E.preMultiplyAlpha},
B);E=y.createQuadVAO(m);this.drawStretchedTexture(m,F,I,E,B,G);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:E,sourceTexture:B,framebuffer:I}:(E.dispose(!0),B.dispose(),I.detachColorTexture(),m.bindFramebuffer(null),I.dispose());return G};x.drawStretchedTexture=function(m,B,E,F,G,I){m.bindFramebuffer(E);E=m.getViewport();m.setViewport(0,0,I.descriptor.width,I.descriptor.height);I=B.program;m.bindProgram(I);I.setUniform4f("color",1,1,1,1);I.setUniform1i("tex",0);m.bindTexture(G,0);m.bindVAO(F);
m.setPipelineState(B.pipeline);m.drawArrays(5,0,w.vertexCount(F,"geometry"));m.bindFramebuffer(null);m.setViewport(E.x,E.y,E.width,E.height)};x.unload=function(){if(f.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:m,vao:B,sourceTexture:E}=this.powerOfTwoStretchInfo;B.dispose(!0);E.dispose();m.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}f.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);if(f.isSome(this.loadingController)){const m=this.loadingController;this.loadingPromise=
this.loadingController=null;m.abort()}this.events.emit("unloaded")};g._createClass(A,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}}]);return A}(v.ContentObject);v.DDS_ENCODING="image/vnd-ms.dds";v.BASIS_ENCODING="image/x.basis";a.Texture=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define(["exports",
"../../../../core/maybe","../../../webgl/Texture","../../../webgl/Util","../../../../libs/basisu/BasisU"],function(a,g,b,p,f){async function k(){g.isNone(d)&&(d=f.getBasisTranscoder(),c=await d);return d}let c=null,d=null;a.createTextureFromBasis=async function(e,h,n){g.isNone(c)&&(c=await k());n=new c.BasisFile(new Uint8Array(n));if(1>n.getNumImages())return null;const q=n.getNumLevels(0);var u=n.getHasAlpha();const v=n.getImageWidth(0,0),t=n.getImageHeight(0,0),{compressedTextureETC:l,compressedTextureS3TC:w}=
e.capabilities,[y,D]=l?u?[1,37496]:[0,37492]:w?u?[3,33779]:[2,33776]:[13,6408];n.startTranscoding();u=[];for(let z=0;z<q;z++)u.push(new Uint8Array(n.getImageTranscodedSizeInBytes(0,z,y))),n.transcodeImage(u[z],0,z,y,0,0);n.close();n.delete();return new b(e,{...h,samplingMode:1<q?9987:9729,hasMipmap:1<q,internalFormat:D,width:v,height:t},{type:"compressed",levels:u})};a.estimateBasisTextureMemoryUsage=function(e){if(g.isNone(c))return e.byteLength;var h=new c.BasisFile(new Uint8Array(e));if(1>h.getNumImages())return 0;
e=h.getNumLevels(0);const n=h.getHasAlpha(),q=h.getImageWidth(0,0),u=h.getImageHeight(0,0);h.close();h.delete();h=p.getBytesPerElementFormat(n?37496:37492);return Math.ceil((4**e-1)/(3*4**(e-1))*u*h*q)};a.loadBasis=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../core/maybe","../../assets"],function(a,g,b,p){let f;g.getBasisTranscoder=function(){if(b.isNone(f)){const k=c=>p.getAssetUrl(`esri/libs/basisu/${c}`);f=(new Promise(function(c,
d){a(["../../chunks/basis_transcoder"],c,d)})).then(function(c){return c.basis_transcoder}).then(({default:c})=>c({locateFile:k}).then(d=>{d.initializeBasis();delete d.then;return d}))}return f};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(a,g,b,p){function f(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<
24)}function k(n,q){var u=new Int32Array(n,0,31);if(542327876!==u[0])return c.error("Invalid magic number in DDS header"),null;if(!(u[20]&4))return c.error("Unsupported format, must contain a FourCC code"),null;var v=u[21];let t;switch(v){case d:v=8;t=33776;break;case e:v=16;t=33778;break;case h:v=16;t=33779;break;default:return c.error("Unsupported FourCC code:",String.fromCharCode(v&255,v>>8&255,v>>16&255,v>>24&255)),null}let l=1,w=u[4],y=u[3];if(0!==(w&3)||0!==(y&3))c.warn("Rounding up compressed texture size to nearest multiple of 4."),
w=w+3&-4,y=y+3&-4;const D=w,z=y;u[2]&131072&&!1!==q&&(l=Math.max(1,u[7]));1===l||b.isPowerOfTwo(w)&&b.isPowerOfTwo(y)||(c.warn("Ignoring mipmaps of non power of two sized compressed texture."),l=1);let r=u[1]+4;const C=[];for(let A=0;A<l;++A)u=(w+3>>2)*(y+3>>2)*v,q=new Uint8Array(n,r,u),C.push(q),r+=u,w=Math.max(1,w>>1),y=Math.max(1,y>>1);return{textureData:{type:"compressed",levels:C},internalFormat:t,width:D,height:z}}const c=g.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),d=f("DXT1"),e=f("DXT3"),
h=f("DXT5");a.createDDSTexture=function(n,q,u,v){const {textureData:t,internalFormat:l,width:w,height:y}=k(u,v);q.samplingMode=1<t.levels.length?9987:9729;q.hasMipmap=1<t.levels.length;q.internalFormat=l;q.width=w;q.height=y;q=new p(n,q,t);n.bindTexture(q,0);return q};a.createDDSTextureData=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../geometry/Extent ../../../../geometry/Polygon ../../../../geometry ../../../../Color ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3D ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../../../../renderers/support/renderingInfoUtils ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/lineStippleUtils ./Graphics3DDrapedGraphicLayer ../support/FastSymbolUpdates ../../webgl-engine/lib/RenderGeometry ./lineUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){const E=["polyline","polygon","extent"];c=function(F){function G(K,J,L,P){K=F.call(this,K,J,L,P)||this;K._uniformSize=1;return K}g._inheritsLoose(G,F);var I=G.prototype;I.doLoad=async function(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&
0<this._context.renderer.visualVariables.length?x.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const K=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1);if(0>K)throw new p("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=K}};I.getMaterialParameters=function(K){var J=b.get(this.symbolLayer,"material","color");J=this._getCombinedOpacityAndColor(J);K={width:1,color:J,
polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>J[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:K,stipplePattern:this.symbolLayer.stipplePattern?C.createStipplePattern(this.symbolLayer.stipplePattern.map(e.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?d.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.size&&(K.width=e.pt2px(1)):(J=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1),K.width=e.pt2px(J));return this._fastUpdates&&this._fastUpdates.visualVariables?{...K,...this._fastUpdates.materialParameters}:K};I.destroy=function(){F.prototype.destroy.call(this);this._context.stage.remove(this._lineMaterial);this._lineMaterial=null;this._context.stage.remove(this._ringMaterial);this._ringMaterial=null};I.getDrivenSize=function(K){return this._drivenProperties.size&&
K.size?e.pt2px(z.getDriverAxisSizeValueAny(K.size)):1};I.getSizeFeatureAttributeData=function(K){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?D.getAttributeValue(this._fastUpdates.visualVariables.size.field,K):null};I.getDrivenColor=function(K){const J=n.fromValues(1,1,1,1);this._drivenProperties.color&&K.color&&(J[0]=K.color[0],J[1]=K.color[1],J[2]=K.color[2],0<K.color.length&&(J[3]=K.color[3]));this._drivenProperties.opacity&&K.opacity&&(J[3]=K.opacity);return J};I.getColorFeatureAttributeData=
function(K){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?D.getAttributeValue(this._fastUpdates.visualVariables.color.field,K):null};I.getOpacityFeatureAttributeData=function(K){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?D.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,K):null};I.createGraphics3DGraphic=function(K){const J=K.graphic;if(!this._validateGeometry(J.geometry,E,this.symbolLayer.type))return null;const L=this.setGraphicElevationContext(J,
new w.ElevationContext);this.ensureDrapedStatus("on-the-ground"===L.mode);return this.draped?this._createAsOverlay(K,this._context.layer.uid):this._createAs3DShape(K,L,J.uid)};I.applyRendererDiff=function(K,J){for(const L in K.diff)switch(L){case "visualVariables":if(x.updateFastSymbolUpdatesState(this._fastUpdates,J,this._vvConvertOptions))b.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),b.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};I.layerOpacityChanged=function(){b.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);b.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};I.updateMaterialLayerOpacity=function(K){const J=K.params.color;var L=b.get(this.symbolLayer,"material","color");L=this._getCombinedOpacity(L);K.setParameterValues({color:[J[0],J[1],J[2],L],transparent:1>L||this.needsDrivenTransparentPass})};I.layerElevationInfoChanged=
function(K,J,L){const P=this._elevationContext.mode;L=t.elevationModeChangeUpdateType(G.elevationModeChangeTypes,L,P);if(L!==t.SymbolUpdateType.UPDATE)return L;const Q=t.needsElevationUpdates2D(P);return this.updateGraphics3DGraphicElevationInfo(K,J,()=>Q)};I.slicePlaneEnabledChanged=function(){b.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});b.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};I.physicalBasedRenderingChanged=function(){return!0};I.pixelRatioChanged=function(){return!0};I._getGeometryAsPolygonOrPolyline=function(K){switch(K.type){case "extent":if(K instanceof f)return k.fromExtent(K);break;case "polygon":case "polyline":return K}return null};I._createAs3DShape=function(K,J,L){const P=this._getGeometryAsPolygonOrPolyline(K.graphic.geometry);var Q="polygon"===P.type?P.rings:P.paths,X=[];const aa=[],S=[],H=u.create(),R=B.geometryToRenderInfo(P,this._context.elevationProvider,
this._context.renderCoordsHelper,J);this._logGeometryCreationWarnings(R,Q,"polygon"===P.type?"rings":"paths","LineSymbol3DLayer");for(Q=0;Q<R.lines.length;Q++){const {position:T,mapPosition:W}=R.lines[Q];if(b.isSome(this._context.clippingExtent)&&(u.empty(H),u.expandWithBuffer(H,W),!u.intersectsClippingArea(H,this._context.clippingExtent)))continue;const Y=this._createGeometry(K,T,W,P.type);X.push(Y);aa.push("polygon"===P.type?this.ringMaterial:this.lineMaterial);S.push(h.IDENTITY)}if(0===X.length)return null;
K=new v.Object3D({geometries:X,materials:aa,transformations:S,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:L}});X=new y(this,K,X,null,null,l.perVertexElevationAligner,J);X.alignedSampledElevation=R.sampledElevation;X.needsElevationUpdates=t.needsElevationUpdates2D(J.mode);return X};I._createGeometry=function(K,J,L,P){const Q=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return B.createGeometry({removeDuplicateStartEnd:"polygon"===P?1:0,uniformSize:this._uniformSize,
attributeData:{position:J,mapPosition:L,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(K.renderingInfo),color:Q?null:this.getDrivenColor(K.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(K.graphic),colorFeature:this.getColorFeatureAttributeData(K.graphic),opacityFeature:this.getOpacityFeatureAttributeData(K.graphic)}})};I._createAsOverlay=function(K,J){const L=K.graphic,P=this._getGeometryAsPolygonOrPolyline(L.geometry);var Q="polygon"===
P.type?P.rings:P.paths;const X="polygon"===P.type?this.ringMaterial:this.lineMaterial;X.renderPriority=this._renderPriority;const aa=[],S=u.create(),H=u.empty();var R=B.geometryToRenderInfoDraped(P,this._context.overlaySR);this._logGeometryCreationWarnings(R,Q,"polygon"===P.type?"rings":"paths","LineSymbol3DLayer");if(0<Q.length){({lines:Q}=R);for(R=0;R<Q.length;++R){var T=Q[R];u.empty(S);u.expandWithBuffer(S,T.position);u.intersectsClippingArea(S,this._context.clippingExtent)&&(u.expandWithAABB(H,
S),T=this._createGeometry(K,T.position,null,P.type),T=new m.RenderGeometry(T,X,J,L.uid),q.set(T.boundingSphere,.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1]))),aa.push(T))}return new A(this,aa,H)}return null};g._createClass(G,[{key:"lineMaterial",get:function(){b.isNone(this._lineMaterial)&&(this._lineMaterial=new r.RibbonLineMaterial(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",
get:function(){b.isNone(this._ringMaterial)&&(this._ringMaterial=new r.RibbonLineMaterial(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}}]);return G}(D.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:t.SymbolUpdateType.RECREATE,staysOnTheGround:t.SymbolUpdateType.NONE,onTheGroundChanged:t.SymbolUpdateType.RECREATE};a.Graphics3DLineSymbolLayer=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../webgl-engine/lib/Geometry ./elevationAlignmentUtils ../../terrain/OverlayRenderer ./constants".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){function u(w,y,D){const z=[];for(const {index:r,count:C}of w){if(1>=C)continue;w=3*r;const A=w+3*C;z.push({position:y.subarray(w,A),mapPosition:D?D.subarray(w,A):void 0})}return z}const v=f.create(),t=f.create(),l=4/Math.PI;a.createGeometry=function(w){const y=[],D=[];{const {attributeData:{position:B},removeDuplicateStartEnd:E}=w;var z=B.length;z=(z=B[0]===B[z-3]&&B[1]===B[z-2]&&B[2]===B[z-1])&&1===E;var r=B.length/3-(z?1:0),C=new Uint32Array(2*(r-1)),A=z?g.slice(B,
0,B.length-3):B,x=0;for(var m=0;m<r-1;m++)C[x++]=m,C[x++]=m+1;D.push(["position",{size:3,data:A,exclusive:z}]);y.push(["position",C])}z=D[0][1].data;r=new Uint16Array(y[0][1].length);C=w.attributeData.mapPosition;b.isNone(C)||(y.push(["mapPos",y[0][1]]),D.push(["mapPos",{size:3,data:C}]));b.isSome(w.attributeData.colorFeature)||(D.push(["color",{size:4,data:b.unwrapOr(w.attributeData.color,q.WHITE_UNIT)}]),y.push(["color",r]));b.isSome(w.attributeData.sizeFeature)||(D.push(["size",{size:1,data:[b.unwrapOr(w.attributeData.size,
1)]}]),y.push(["size",r]));C=w.attributeData.colorFeature;b.isNone(C)||(D.push(["colorFeatureAttribute",{size:1,data:new Float32Array([C])}]),y.push(["color",r]));C=w.attributeData.sizeFeature;b.isNone(C)||(D.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([C])}]),y.push(["sizeFeatureAttribute",r]));C=w.attributeData.opacityFeature;b.isNone(C)||(D.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([C])}]),y.push(["opacityFeatureAttribute",r]));if("round"===w.join){r=z.length/
3;C=new Float32Array(r);k.set(v,0,0,0);w=b.unwrapOr(w.uniformSize,1);for(A=-1;A<r;++A)x=0>A?r+A:A,m=(A+1)%r,k.set(t,z[3*m]-z[3*x],z[3*m+1]-z[3*x+1],z[3*m+2]-z[3*x+2]),k.normalize(t,t),0<=A&&(x=(Math.PI-p.acosClamped(k.dot(v,t)))*l*(1.863798+-2.0062872/(1+w/18.2313)**.8856294),C[A]=Math.max(Math.floor(x),0)),k.scale(v,t,-1);D.push(["subdivisions",{size:1,data:C}]);y.push(["subdivisions",y[0][1]])}return new e.Geometry(D,y,2)};a.geometryToRenderInfo=function(w,y,D,z){const {position:r,outlines:C}=d.pathsToTriangulationInfo("polygon"===
w.type?w.rings:w.paths,w.hasZ,"polygon"===w.type?1:0),A=new Float64Array(r.length);w=h.applyPerVertexElevationAlignment(r,w.spatialReference,0,A,0,r,0,r.length/3,y,D,z);y=null!=w;return{lines:y?u(C,r,A):[],projectionSuccess:y,sampledElevation:w}};a.geometryToRenderInfoDraped=function(w,y){const {position:D,outlines:z}=d.pathsToTriangulationInfo("polygon"===w.type?w.rings:w.paths,!1,"polygon"===w.type?1:0);w=c.projectBuffer(D,w.spatialReference,0,D,y,0,D.length/3);for(y=2;y<D.length;y+=3)D[y]=n.DRAPED_Z;
return{lines:w?u(z,D):[],projectionSuccess:w}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../Color ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshComponent ../../../../chunks/mat3 ../../../../geometry/support/meshUtils/projection ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../support/debugFlags ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../support/edgeUtils ./Graphics3DSymbolLayer ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture ../support/symbolColorUtils ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K){const J=["mesh"];b=function(W){function Y(N,ca,O,V){N=W.call(this,N,ca,O,V)||this;N._materials=new Map;N._textures=new Map;N.ensureDrapedStatus(!1);return N}g._inheritsLoose(Y,W);var U=Y.prototype;U.doLoad=async function(){r.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new K.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new K.NativeLineMaterial({color:[0,1,1,1]}))};U.destroy=function(){W.prototype.destroy.call(this);
this._context.stage.removeMany(Array.from(this._materials.values(),N=>N.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};U.createGraphics3DGraphic=function(N){const ca=N.graphic;if(!this._validateGeometry(ca.geometry,J,"fill on mesh-3d"))return null;const O=this.setGraphicElevationContext(ca,new x.ElevationContext);return this._createAs3DShape(ca,N.renderingInfo,O,ca.uid)};U.layerOpacityChanged=function(N,ca){const O=this._getLayerOpacity();
this._materials.forEach(V=>{V.material.setParameterValues({layerOpacity:O});const ba=V.material.params;this._setMaterialTransparentParameter(ba,V);V.material.setParameterValues({transparent:ba.transparent})});N.forEach(V=>{V=ca(V);p.isSome(V)&&V.layerOpacityChanged(O,this._context.isAsync)});return!0};U.layerElevationInfoChanged=function(N,ca){return this.updateGraphics3DGraphicElevationInfo(N,ca,C.needsElevationUpdates3D)};U.slicePlaneEnabledChanged=function(N,ca){this._materials.forEach(O=>{O.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});
N.forEach(O=>{O=ca(O);p.isSome(O)&&O.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};U.physicalBasedRenderingChanged=function(){const N=this._usePBR();this._materials.forEach(ca=>ca.material.setParameterValues({usePBR:N}));return!0};U.pixelRatioChanged=function(){return!0};U._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};U._colorOrTextureUid=function(N){return N?N instanceof f?N.toHex():N.contentHash:
"-"};U._materialPropertiesDefault=function(N,ca){const O=this._requiresSymbolVertexColors(),V=!!N.vertexAttributes.color;N=!!N.vertexAttributes.tangent;return{hasSymbolVertexColors:O,hasVertexColors:V,hasVertexTangents:N,uid:`vc:${V},vt:${N},vct${ca},svc:${O}`}};U._materialProperties=function(N,ca,O){N=this._materialPropertiesDefault(N,O);if(!ca.material)return N;const {color:V,colorTexture:ba,normalTexture:fa,doubleSided:ia,alphaCutoff:ma,alphaMode:ea}=ca.material;O=this._colorOrTextureUid(V);var M=
this._colorOrTextureUid(ba),Z=this._colorOrTextureUid(fa);N.color=V;N.colorTexture=ba;N.normalTexture=fa;N.uid=`${N.uid},cmuid:${O},ctmuid:${M},ntmuid:${Z},ds:${ia},ac:${ma},am:${ea}`;if(ca.material instanceof u){const {metallic:la,roughness:ka,metallicRoughnessTexture:ha,emissiveColor:na,emissiveTexture:da,occlusionTexture:oa}=ca.material;ca=this._colorOrTextureUid(ha);O=this._colorOrTextureUid(na);M=this._colorOrTextureUid(da);Z=this._colorOrTextureUid(oa);N.metallic=la;N.roughness=ka;N.metallicRoughnessTexture=
ha;N.emissiveColor=na;N.emissiveTexture=da;N.occlusionTexture=oa;N.uid=`${N.uid},mrm:${la},mrr:${ka},mrt:${ca},emuid:${O},etmuid:${M},otmuid:${Z}`}return N};U._setInternalColorValueParameters=function(N,ca){ca.diffuse=f.toUnitRGB(N);ca.opacity=N.a};U._getLoadableTextureResource=function(N){return N.data?N.data:N.url};U._getInternalTextureId=function(N){const ca=this._getLoadableTextureResource(N);if(ca){var O=N.contentHash,V=this._textures.get(O);V||(V=new G.Texture(ca,{mipmap:!0,wrap:this._castTextureWrap(N.wrap),
noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(O,V),this._context.stage.add(V));return V.id}};U._castTextureWrap=function(N="repeat"){return"string"===typeof N?(N=this._castTextureWrapIndividual(N),{s:N,t:N}):{s:this._castTextureWrapIndividual(N.horizontal),t:this._castTextureWrapIndividual(N.vertical)}};U._castTextureWrapIndividual=function(N){switch(N){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};U._setInternalMaterialParameters=function(N,ca){N.color&&this._setInternalColorValueParameters(N.color,
ca);N.colorTexture&&(ca.textureId=this._getInternalTextureId(N.colorTexture));N.normalTexture&&(ca.normalTextureId=this._getInternalTextureId(N.normalTexture));N.emissiveColor&&(ca.emissiveFactor=f.toUnitRGB(N.emissiveColor));N.emissiveTexture&&(ca.emissiveTextureId=this._getInternalTextureId(N.emissiveTexture));N.occlusionTexture&&(ca.occlusionTextureId=this._getInternalTextureId(N.occlusionTexture));N.metallicRoughnessTexture&&(ca.metallicRoughnessTextureId=this._getInternalTextureId(N.metallicRoughnessTexture))};
U._setExternalMaterialParameters=function(N){var ca=this._drivenProperties.color;let O=p.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;ca?N.externalColor=q.ONES:(ca=p.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,p.isSome(ca)?N.externalColor=f.toUnitRGBA(ca):(O=null,N.externalColor=q.ONES));O&&(N.colorMixMode=O);N.castShadows=!!this.symbolLayer.castShadows};U._hasTransparentVertexColors=function(N){N=N.vertexAttributes.color;if(!N)return!1;
for(let ca=3;ca<N.length;ca+=4)if(255!==N[ca])return!0;return!1};U._getOrCreateMaterial=function(N,ca){var O=ca.material&&ca.material.color,V=ca.material&&ca.material.colorTexture,ba=ca.material&&"blend"===ca.material.alphaMode;O=!(ca.material&&"opaque"===ca.material.alphaMode)&&(this._hasTransparentVertexColors(N)||O&&1>O.a||V&&V.transparent||ba);N=this._materialProperties(N,ca,O);if(V=this._materials.get(N.uid))return V.material;O={material:null,isComponentTransparent:O,alphaMode:ca.material?ca.material.alphaMode:
"opaque"};V=null==N.metallicRoughnessTexture&&null==N.metallic&&null==N.roughness;ba={usePBR:this._usePBR(),isSchematic:V,vertexColors:N.hasVertexColors,symbolColors:N.hasSymbolVertexColors,vertexTangents:N.hasVertexTangents,ambient:k.ZEROS,diffuse:k.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};V||(ba.mrrFactors=[null!=N.metallic?
N.metallic:1,null!=N.roughness?N.roughness:1,.5]);ca.material&&(ba.doubleSided=ca.material.doubleSided,ba.cullFace=ca.material.doubleSided?0:2,ba.textureAlphaCutoff=ca.material.alphaCutoff);this._setInternalMaterialParameters(N,ba);this._setExternalMaterialParameters(ba);this._setMaterialTransparentParameter(ba,O);ca=new F.DefaultMaterial(ba);O.material=ca;this._materials.set(N.uid,O);this._context.stage.add(ca);return ca};U._usePBR=function(){return this._context.physicalBasedRenderingEnabled};U._setMaterialTransparentParameter=
function(N,ca){N.transparent=this.needsDrivenTransparentPass||ca.isComponentTransparent||1>N.layerOpacity||1>N.opacity||N.externalColor&&1>N.externalColor[3];N.textureAlphaMode="auto"===ca.alphaMode?N.transparent?3:1:"opaque"===ca.alphaMode?1:"mask"===ca.alphaMode?2:0};U._addDebugNormals=function(N,ca,O,V){var ba=ca.length,fa=N.spatialReference.isGeographic?20015077/180:1;const ia=.1*Math.max(N.extent.width*fa,N.extent.height*fa,N.extent.zmax-N.extent.zmin),ma=[],ea=[];N=[];fa=[];for(let na=0;na<
ba;na++){var M=ca[na],Z=M.vertexAttributes.get("position"),la=M.vertexAttributes.get("normal");const da=M.indices.get("position");M=M.indices.get("normal");Z=Z.data;la=la.data;for(let oa=0;oa<da.length;oa++){var ka=3*da[oa];const qa=3*M[oa];for(var ha=0;3>ha;ha++)ma.push(Z[ka+ha]);for(ha=0;3>ha;ha++)ma.push(Z[ka+ha]+la[qa+ha]*ia);ea.push(ea.length);ea.push(ea.length);if(0===oa%3){this._calculateFaceNormal(Z,da,oa,aa);this._getFaceVertices(Z,da,oa,P,Q,X);c.add(P,P,Q);c.add(P,P,X);c.scale(P,P,1/3);
for(ka=0;3>ka;ka++)N.push(P[ka]);for(ka=0;3>ka;ka++)N.push(P[ka]+aa[ka]*ia);fa.push(fa.length);fa.push(fa.length)}}}ba=new D.Geometry([["position",{data:ma,size:3,exclusive:!0}]],[["position",new Uint32Array(ea)]],2);ca.push(ba);O.push(this._debugVertexNormalMaterial);V.push(n.clone(V[0]));ba=new D.Geometry([["position",{data:N,size:3,exclusive:!0}]],[["position",new Uint32Array(fa)]],2);ca.push(ba);O.push(this._debugFaceNormalMaterial);V.push(n.clone(V[0]))};U._createAs3DShape=function(N,ca,O,V){N=
N.geometry;if("mesh"!==N.type)return null;ca=this._createGeometryInfo(N,ca);if(!ca)return null;const {geometries:ba,materials:fa,transformations:ia,objectTransformation:ma}=ca;r.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(N,ba,fa,ia);ca=new z.Object3D({geometries:ba,materials:fa,transformations:ia,metadata:{layerUid:this._context.layer.uid,graphicUid:V}});ca.transformation=ma;V=A.perObjectElevationAligner;var ea=this._createEdgeMaterial();ea=p.isSome(ea)?{baseMaterial:fa[0],edgeMaterials:[ea],
properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;ca=new m(this,ca,ba,null,null,V,O,ea);ca.needsElevationUpdates=C.needsElevationUpdates3D(O.mode);O=N.extent.center.clone();O.z=0;ca.elevationContext.centerPointInElevationSR=O;ca.alignedSampledElevation=V(ca,ca.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return ca};U._createComponentNormals=function(N,ca,O,V){switch(O.shading||"flat"){case "source":return this._createComponentNormalsSource(N,
ca,O,V);case "flat":return this._createComponentNormalsFlat(N,V);case "smooth":return this._createComponentNormalsSmooth(N,V)}};U._createComponentNormalsSource=function(N,ca,O,V){if(!ca)return this._createComponentNormalsFlat(N,V);let ba=!1;if(!O.trustSourceNormals)for(O=0;O<V.length;O+=3){this._calculateFaceNormal(N,V,O,aa);for(let fa=0;3>fa;fa++){const ia=3*V[O+fa];P[0]=ca[ia+0];P[1]=ca[ia+1];P[2]=ca[ia+2];0>c.dot(aa,P)&&(ca[ia+0]=-ca[ia+0],ca[ia+1]=-ca[ia+1],ca[ia+2]=-ca[ia+2],ba=!0)}}return{normals:ca,
indices:V,didFlipNormals:ba}};U._createComponentNormalsFlat=function(N,ca){const O=new Float32Array(ca.length),V=new Uint32Array(3*ca.length);for(let ba=0;ba<ca.length;ba+=3){const fa=this._calculateFaceNormal(N,ca,ba,aa);for(let ia=0;3>ia;ia++)O[ba+ia]=fa[ia],V[ba+ia]=ba/3}return{normals:O,indices:V,didFlipNormals:!1}};U._createComponentNormalsSmooth=function(N,ca){const O={};for(var V=0;V<ca.length;V+=3){var ba=this._calculateFaceNormal(N,ca,V,aa);for(var fa=0;3>fa;fa++){var ia=ca[V+fa];let ma=
O[ia];ma||(ma={normal:k.create(),count:0},O[ia]=ma);c.add(ma.normal,ma.normal,ba);ma.count++}}N=new Float32Array(3*ca.length);V=new Uint32Array(3*ca.length);for(ba=0;ba<ca.length;ba++){fa=O[ca[ba]];1!==fa.count&&(c.normalize(fa.normal,fa.normal),fa.count=1);for(ia=0;3>ia;ia++)N[3*ba+ia]=fa.normal[ia];V[ba]=ba}return{normals:N,indices:V,didFlipNormals:!1}};U._getFaceVertices=function(N,ca,O,V,ba,fa){const ia=3*ca[O+0],ma=3*ca[O+1];ca=3*ca[O+2];V[0]=N[ia+0];V[1]=N[ia+1];V[2]=N[ia+2];ba[0]=N[ma+0];ba[1]=
N[ma+1];ba[2]=N[ma+2];fa[0]=N[ca+0];fa[1]=N[ca+1];fa[2]=N[ca+2]};U._calculateFaceNormal=function(N,ca,O,V){this._getFaceVertices(N,ca,O,P,Q,X);c.subtract(Q,Q,P);c.subtract(X,X,P);c.cross(P,Q,X);c.normalize(V,P);return V};U._getOrCreateComponents=function(N){return N.components?N.components:T};U._createPositionBuffer=function(N){const ca=N.vertexAttributes.position,O=new Float64Array(ca.length);e.projectBuffer(N.vertexAttributes.position,N.spatialReference,0,O,this._context.renderCoordsHelper.spatialReference,
0,ca.length/3);return O};U._createNormalBuffer=function(N,ca){const O=N.vertexAttributes.normal;if(!O)return null;if("local"===this._context.layerView.view.viewingMode)return O;const V=N.vertexAttributes.position,ba=new Float32Array(O.length);return l.projectNormalToECEF(O,V,ca,N.spatialReference,ba)};U._createTangentBuffer=function(N,ca){const O=N.vertexAttributes.tangent;if(!O)return null;if("local"===this._context.layerView.view.viewingMode)return O;const V=N.vertexAttributes.position,ba=new Float32Array(O.length);
return l.projectTangentToECEF(O,V,ca,N.spatialReference,ba)};U._createColorBuffer=function(N){return N.vertexAttributes.color};U._createSymbolColorBuffer=function(N){if(this._requiresSymbolVertexColors()){N=this._getVertexOpacityAndColor(N);const ca=I.parseColorMixMode(p.get(this.symbolLayer,"material","colorMixMode")),O=new Uint8Array(4);I.encodeSymbolColor(N,ca,O);return O}return null};U._createBuffers=function(N,ca){var O=N.vertexAttributes&&N.vertexAttributes.position;if(!O)return this.logger.warn("Mesh geometry must contain position vertex attributes"),
null;var V=N.vertexAttributes.normal;const ba=N.vertexAttributes.uv;var fa=N.vertexAttributes.tangent;if(V&&V.length!==O.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(fa&&fa.length/4!==O.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(ba&&ba.length/2!==O.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;O=this._createPositionBuffer(N);V=this._createColorBuffer(N);ca=this._createSymbolColorBuffer(ca);fa=this._createNormalBuffer(N,O);const ia=this._createTangentBuffer(N,O);N=this._transformCenterLocal(N,O,fa);return{positionBuffer:O,normalBuffer:fa,tangentBuffer:ia,uvBuffer:ba,colorBuffer:V,symbolColorBuffer:ca,objectTransformation:N}};U._transformCenterLocal=function(N,ca,O){var V=N.extent.center;const ba=this._context.renderCoordsHelper.spatialReference;L[0]=V.x;L[1]=V.y;L[2]=0;V=n.create();
e.computeLinearTransformation(N.spatialReference,L,V,ba);d.invert(S,V);for(N=0;N<ca.length;N+=3)P[0]=ca[N+0],P[1]=ca[N+1],P[2]=ca[N+2],c.transformMat4(P,P,S),ca[N+0]=P[0],ca[N+1]=P[1],ca[N+2]=P[2];if(O)for(t.fromMat4(H,V),t.transpose(H,H),ca=0;ca<O.length;ca+=3)P[0]=O[ca+0],P[1]=O[ca+1],P[2]=O[ca+2],c.transformMat3(P,P,H),O[ca+0]=P[0],O[ca+1]=P[1],O[ca+2]=P[2];return V};U._validateFaces=function(N,ca){N=N.vertexAttributes.position.length/3;if(ca=ca.faces){let O=-1;for(let V=0;V<ca.length;V++){const ba=
ca[V];ba>O&&(O=ba)}if(N<=O)return this.logger.warn(`Vertex index ${O} is out of bounds of the mesh position buffer`),!1}else if(0!==N%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};U._getOrCreateFaces=function(N,ca){return ca.faces?ca.faces:y.generateDefaultIndexArray(N.vertexAttributes.position.length/3)};U._isOutsideClippingArea=function(N){if(!this._context.clippingExtent)return!1;
var ca=N.vertexAttributes&&N.vertexAttributes.position;if(!ca)return!1;const O=this._context.elevationProvider.spatialReference,V=ca.length/3;N.spatialReference.equals(O)||(ca=new Float64Array(ca.length),e.projectBuffer(N.vertexAttributes.position,N.spatialReference,0,ca,O,0,V));w.empty(R);w.expandWithBuffer(R,ca,0,V);return!w.intersectsClippingArea(R,this._context.clippingExtent)};U._createGeometryInfo=function(N,ca){if(!e.canProjectWithoutEngine(N.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(N))return null;ca=this._createBuffers(N,ca);if(!ca)return null;const {positionBuffer:O,uvBuffer:V,colorBuffer:ba,symbolColorBuffer:fa,normalBuffer:ia,tangentBuffer:ma,objectTransformation:ea}=ca;var M=this._getOrCreateComponents(N);ca=[];const Z=[],la=[];let ka=!1;for(const na of M){if(!this._validateFaces(N,na))return null;M=this._getOrCreateFaces(N,na);if(0===M.length)continue;var ha=this._createComponentNormals(O,ia,na,M);ha.didFlipNormals&&(ka=!0);const da=
[["position",{size:3,data:O,exclusive:!0}],["normal",{size:3,data:ha.normals,exclusive:!0}]];ha=[["position",M],["normal",ha.indices]];ba&&(da.push(["color",{size:4,data:ba,exclusive:!0}]),ha.push(["color",M]));fa&&(da.push(["symbolColor",{size:4,data:fa,exclusive:!0}]),ha.push(["symbolColor",new Uint16Array(M.length)]));N.vertexAttributes.uv&&(da.push(["uv0",{size:2,data:V,exclusive:!0}]),ha.push(["uv0",M]));N.vertexAttributes.tangent&&(da.push(["tangent",{size:4,data:ma,exclusive:!0}]),ha.push(["tangent",
M]));M=new D.Geometry(da,ha);ca.push(M);Z.push(n.create());la.push(this._getOrCreateMaterial(N,na))}ka&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:ca,transformations:Z,materials:la,objectTransformation:ea}};U._createEdgeMaterial=function(){const N={opacity:this._getLayerOpacity()};return B.createMaterial(this.symbolLayer,N)};return Y}(E.Graphics3DSymbolLayer);
const L=k.create(),P=k.create(),Q=k.create(),X=k.create(),aa=k.create(),S=n.create(),H=h.create(),R=w.create(),T=[new v];a.Graphics3DMeshFillSymbolLayer=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Color ./MeshTexture ./MeshMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;b=l=function(w){function y(z){z=w.call(this,z)||this;z.emissiveColor=null;z.emissiveTexture=null;z.occlusionTexture=null;z.metallic=1;z.roughness=1;z.metallicRoughnessTexture=null;return z}a._inheritsLoose(y,w);var D=y.prototype;D.clone=function(){return this.cloneWithDeduplication(null,new Map)};D.cloneWithDeduplication=function(z,r){const C=p.isSome(z)?z.get(this):null;if(C)return C;r=new l(this.clonePropertiesWithDeduplication(r));p.isSome(z)&&z.set(this,
r);return r};D.clonePropertiesWithDeduplication=function(z){return{...w.prototype.clonePropertiesWithDeduplication.call(this,z),emissiveColor:this.emissiveColor?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(z):null,occlusionTexture:this.occlusionTexture?this.occlusionTexture.cloneWithDeduplication(z):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(z):
null}};return y}(t);g.__decorate([c.property({type:u,json:{write:!0}})],b.prototype,"emissiveColor",void 0);g.__decorate([c.property({type:v,json:{write:!0}})],b.prototype,"emissiveTexture",void 0);g.__decorate([c.property({type:v,json:{write:!0}})],b.prototype,"occlusionTexture",void 0);g.__decorate([c.property({type:Number,json:{write:!0},range:{min:0,max:1}})],b.prototype,"metallic",void 0);g.__decorate([c.property({type:Number,json:{write:!0},range:{min:0,max:1}})],b.prototype,"roughness",void 0);
g.__decorate([c.property({type:v,json:{write:!0}})],b.prototype,"metallicRoughnessTexture",void 0);return b=l=g.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],b)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../chunks/persistableUrlUtils ../../core/JSONSupport ../../views/support/screenshotUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){var w;const y=new WeakMap;let D=0;b=w=function(z){function r(A){A=z.call(this,A)||this;A.wrap="repeat";return A}a._inheritsLoose(r,z);var C=r.prototype;C.writeData=function(A,x,m,B){A instanceof HTMLImageElement?(A={type:"image-element",src:v.toJSON(A.src,B),crossOrigin:A.crossOrigin},x[m]=A):A instanceof HTMLCanvasElement?(A=A.getContext("2d").getImageData(0,0,A.width,A.height),A={type:"canvas-element",imageData:this.encodeImageData(A)},x[m]=A):A instanceof
HTMLVideoElement?(A={type:"video-element",src:v.toJSON(A.src,B),autoplay:A.autoplay,loop:A.loop,muted:A.muted,crossOrigin:A.crossOrigin,preload:A.preload},x[m]=A):(A={type:"image-data",imageData:this.encodeImageData(A)},x[m]=A)};C.readData=function(A){switch(A.type){case "image-element":var x=new Image;x.src=A.src;x.crossOrigin=A.crossOrigin;return x;case "canvas-element":return A=this.decodeImageData(A.imageData),x=document.createElement("canvas"),x.width=A.width,x.height=A.height,x.getContext("2d").putImageData(A,
0,0),x;case "image-data":return this.decodeImageData(A.imageData);case "video-element":return x=document.createElement("video"),x.src=A.src,x.crossOrigin=A.crossOrigin,x.autoplay=A.autoplay,x.loop=A.loop,x.muted=A.muted,x.preload=A.preload,x}};C.clone=function(){return new w({url:this.url,data:this.data,wrap:this.cloneWrap()})};C.cloneWithDeduplication=function(A){var x=A.get(this);if(x)return x;x=new w({url:this.url,data:this.data,wrap:this.cloneWrap()});A.set(this,x);return x};C.cloneWrap=function(){return"string"===
typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};C.encodeImageData=function(A){let x="";for(let m=0;m<A.data.length;m++)x+=String.fromCharCode(A.data[m]);return{data:btoa(x),width:A.width,height:A.height}};C.decodeImageData=function(A){const x=atob(A.data),m=new Uint8ClampedArray(x.length);for(let B=0;B<x.length;B++)m[B]=x.charCodeAt(B);return l.wrapImageData(m,A.width,A.height)};C.imageDataContainsTransparent=function(A){for(let x=3;x<A.data.length;x+=4)if(255!==
A.data[x])return!0;return!1};r.from=function(A){return"string"===typeof A?new w({url:A}):A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof ImageData||A instanceof HTMLVideoElement?new w({data:A}):f.ensureClass(w,A)};a._createClass(r,[{key:"url",get:function(){return this._get("url")||null},set:function(A){this._set("url",A);A&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(A){this._set("data",A);A&&this._set("url",null)}},
{key:"transparent",get:function(){var A=this.data,x=this.url;return A instanceof HTMLCanvasElement?this.imageDataContainsTransparent(A.getContext("2d").getImageData(0,0,A.width,A.height)):A instanceof ImageData?this.imageDataContainsTransparent(A):x&&(A=x.substr(x.length-4,4).toLowerCase(),x=x.substr(0,15).toLocaleLowerCase(),".png"===A||"data:image/png;"===x)?!0:!1},set:function(A){null!=A?this._override("transparent",A):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const A=
"string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",x=(m="")=>`d:${m},t:${this.transparent},w:${A}`;if(null!=this.url)return x(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return x(this.data.src);y.has(this.data)||y.set(this.data,++D);return x(y.get(this.data))}return x()}}]);return r}(t.JSONSupport);g.__decorate([k.property({type:String,json:{write:v.write}})],b.prototype,
"url",null);g.__decorate([k.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),k.property()],b.prototype,"data",null);g.__decorate([h.writer("data")],b.prototype,"writeData",null);g.__decorate([d.reader("data")],b.prototype,"readData",null);g.__decorate([k.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);g.__decorate([k.property({json:{write:!0}})],b.prototype,"wrap",void 0);g.__decorate([k.property({readOnly:!0})],
b.prototype,"contentHash",null);return b=w=g.__decorate([e.subclass("esri.geometry.support.MeshTexture")],b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../Color ./MeshTexture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){var w;b=w=function(y){function D(r){r=y.call(this,r)||this;r.color=null;r.colorTexture=null;r.normalTexture=null;r.alphaMode="auto";r.alphaCutoff=.5;r.doubleSided=!0;return r}a._inheritsLoose(D,y);var z=D.prototype;z.clone=function(){return this.cloneWithDeduplication(null,new Map)};z.cloneWithDeduplication=function(r,C){const A=f.isSome(r)?r.get(this):null;if(A)return A;C=new w(this.clonePropertiesWithDeduplication(C));f.isSome(r)&&r.set(this,C);return C};
z.clonePropertiesWithDeduplication=function(r){return{color:p.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(r):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(r):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return D}(v.JSONSupport);g.__decorate([d.property({type:t,json:{write:!0}})],b.prototype,"color",void 0);g.__decorate([d.property({type:l,json:{write:!0}})],b.prototype,"colorTexture",
void 0);g.__decorate([d.property({type:l,json:{write:!0}})],b.prototype,"normalTexture",void 0);g.__decorate([d.property({json:{write:!0}})],b.prototype,"alphaMode",void 0);g.__decorate([d.property({json:{write:!0}})],b.prototype,"alphaCutoff",void 0);g.__decorate([d.property({json:{write:!0}})],b.prototype,"doubleSided",void 0);return b=w=g.__decorate([h.subclass("esri.geometry.support.MeshMaterial")],b)})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){var y;const D=f.getLogger("esri.geometry.support.MeshComponent");b=y=function(z){function r(A){A=z.call(this,A)||this;A.faces=null;A.material=null;A.shading="source";A.trustSourceNormals=!1;return A}a._inheritsLoose(r,z);r.from=function(A){return k.ensureClass(y,A)};var C=r.prototype;C.castFaces=function(A){return w.castArray(A,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},D)};C.castMaterial=function(A){return A&&"object"===typeof A&&("metallic"in
A||"roughness"in A||"metallicRoughnessTexture"in A)?k.ensureClass(l,A):k.ensureClass(t,A)};C.clone=function(){return new y({faces:p.clone(this.faces),shading:this.shading,material:p.clone(this.material),trustSourceNormals:this.trustSourceNormals})};C.cloneWithDeduplication=function(A,x){return new y({faces:p.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(A,x):null,trustSourceNormals:this.trustSourceNormals})};return r}(v);g.__decorate([c.property({json:{write:!0}})],
b.prototype,"faces",void 0);g.__decorate([d.cast("faces")],b.prototype,"castFaces",null);g.__decorate([c.property({type:t,json:{write:!0}})],b.prototype,"material",void 0);g.__decorate([d.cast("material")],b.prototype,"castMaterial",null);g.__decorate([c.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);g.__decorate([c.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=y=g.__decorate([h.subclass("esri.geometry.support.MeshComponent")],b)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(z,r,C,A){const {loggerTag:x,stride:m}=r;return 0!==z.length%m?(A.error(x,`Invalid array length, expected a multiple of ${m}`),new C([])):z}function l(z,r,C,A,x){if(!z)return z;if(z instanceof r)return t(z,A,r,x);for(const m of C)if(z instanceof m)return t(new r(z),A,r,x);if(Array.isArray(z))return t(new r(z),A,r,x);C=C.map(m=>`'${m.name}'`);x.error(`Failed to set property, expected one of ${C}, but got ${z.constructor.name}`);return new r([])}function w(z,
r,C){{const A=Array(z.length);for(let x=0;x<z.length;x++)A[x]=z[x];z=A}r[C]=z}var y;const D=k.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=y=function(z){function r(A){A=z.call(this,A)||this;A.color=null;A.position=new Float64Array(0);A.uv=null;A.normal=null;A.tangent=null;return A}g._inheritsLoose(r,z);var C=r.prototype;C.castColor=function(A){return l(A,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},D)};C.castPosition=function(A){A&&A instanceof
Float32Array&&D.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return l(A,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},D)};C.castUv=function(A){return l(A,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},D)};C.castNormal=function(A){return l(A,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},D)};C.castTangent=function(A){return l(A,Float32Array,
[Float64Array],{loggerTag:".tangent\x3d",stride:4},D)};C.clone=function(){const A={position:f.clone(this.position),uv:f.clone(this.uv),normal:f.clone(this.normal),tangent:f.clone(this.tangent),color:f.clone(this.color)};return new y(A)};return r}(v.JSONSupport);b.__decorate([c.property({json:{write:w}})],a.MeshVertexAttributes.prototype,"color",void 0);b.__decorate([d.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([c.property({nonNullable:!0,json:{write:w}})],a.MeshVertexAttributes.prototype,
"position",void 0);b.__decorate([d.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([c.property({json:{write:w}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([d.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([c.property({json:{write:w}})],a.MeshVertexAttributes.prototype,"normal",void 0);b.__decorate([d.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([c.property({json:{write:w}})],a.MeshVertexAttributes.prototype,
"tangent",void 0);b.__decorate([d.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=y=b.__decorate([h.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);b=a.MeshVertexAttributes;a.castArray=l;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../spatialReferenceUtils ../webMercatorUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../projectionEllipsoid ../../projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../views/3d/support/buffer/BufferView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){function u(D,z,r,C,A,x){if(z){var m=A.isWGS84||b.isCGCS2000(A)||b.isMars(A)||b.isMoon(A),B=r.count;if(m)for(r=0;r<B;r++)C.getVec(r,t),z.getVec(r,l),m=c.getSphericalPCPF(A),d.computeLinearTransformation(m,t,w,m),n.fromMat4(y,w),1===D&&n.transpose(y,y),k.transformMat3(l,l,y),x.setVec(r,l);else for(A=0;A<B;A++)C.getVec(A,t),z.getVec(A,l),d.computeLinearTransformation(c.SphericalECEFSpatialReference,t,w,c.SphericalECEFSpatialReference),n.fromMat4(y,w),m=p.y2lat(r.get(A,
1)),m=Math.cos(m),0===D&&(m=1/m),y[0]*=m,y[1]*=m,y[2]*=m,y[3]*=m,y[4]*=m,y[5]*=m,1===D&&n.transpose(y,y),k.transformMat3(l,l,y),k.normalize(l,l),x.setVec(A,l);return x}}const v=g.getLogger("esri.geometry.support.meshUtils.normalProjection"),t=f.create(),l=f.create(),w=h.create(),y=e.create();a.projectFromECEF=function(D,z,r){d.projectBuffer(D,c.getSphericalPCPF(r),0,z,r,0,D.length/3);return z};a.projectNormalFromECEF=function(D,z,r,C,A){if(!C.isWebMercator&&!C.isWGS84)return v.error("Cannot convert to PCS spatial reference buffer from ECEF"),
A;u(1,q.BufferViewVec3f.fromTypedArray(D),q.BufferViewVec3f64.fromTypedArray(z),q.BufferViewVec3f64.fromTypedArray(r),C,q.BufferViewVec3f.fromTypedArray(A));return A};a.projectNormalToECEF=function(D,z,r,C,A){if(!C.isWebMercator&&!C.isWGS84)return v.error("Cannot convert PCS spatial reference buffer to ECEF"),A;u(0,q.BufferViewVec3f.fromTypedArray(D),q.BufferViewVec3f64.fromTypedArray(z),q.BufferViewVec3f64.fromTypedArray(r),C,q.BufferViewVec3f.fromTypedArray(A));return A};a.projectTangentFromECEF=
function(D,z,r,C,A){if(!C.isWebMercator&&!C.isWGS84)return v.error("Cannot convert to PCS spatial reference buffer from ECEF"),A;u(1,q.BufferViewVec3f.fromTypedArray(D,16),q.BufferViewVec3f64.fromTypedArray(z),q.BufferViewVec3f64.fromTypedArray(r),C,q.BufferViewVec3f.fromTypedArray(A,16));for(z=3;z<D.length;z+=4)A[z]=D[z];return A};a.projectTangentToECEF=function(D,z,r,C,A){if(!C.isWebMercator&&!C.isWGS84)return v.error("Cannot convert PCS spatial reference buffer to ECEF"),A;u(0,q.BufferViewVec3f.fromTypedArray(D,
4*Float32Array.BYTES_PER_ELEMENT),q.BufferViewVec3f64.fromTypedArray(z),q.BufferViewVec3f64.fromTypedArray(r),C,q.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT));for(z=3;z<D.length;z+=4)A[z]=D[z];return A};a.projectToECEF=function(D,z,r){d.projectBuffer(D,z,0,r,c.getSphericalPCPF(z),0,D.length/3);return r};a.transformBufferInPlace=function(D,z,r=!1){if(D)for(let A=0;A<D.length;A+=3){for(var C=0;3>C;C++)t[C]=D[A+C];k.transformMat4(t,t,z);r&&k.normalize(t,t);for(C=0;3>C;C++)D[A+
C]=t[C]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/maybe","../../../../core/mathUtils"],function(a,g,b){a.encodeSymbolColor=function(p,f,k){if(g.isNone(p)||2===f)k[0]=255,k[1]=255,k[2]=255,k[3]=255;else{var c=b.clamp(Math.round(85*p[3]),0,85);f=0===c||4===f?0:3===f?85:170;k[0]=b.clamp(Math.round(255*p[0]),0,255);k[1]=b.clamp(Math.round(255*p[1]),0,255);k[2]=b.clamp(Math.round(255*p[2]),0,255);
k[3]=c+f}};a.parseColorMixMode=function(p){switch(p){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;default:return 1}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2 ../../support/buffer/BufferView ../../support/geometryUtils ../lib/Util ../lib/geometryDataUtils ./renderers/utils ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ../shaders/NativeLineTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){const z=p.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");p=function(T){function W(U){U=T.call(this,U,A)||this;U.techniqueConfig=new D.NativeLineTechniqueConfiguration;return U}g._inheritsLoose(W,T);var Y=W.prototype;Y.getTechniqueConfig=function(U){this.techniqueConfig.output=U;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=
1>this.params.color[3]||1>this.params.width;U=b.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=U;this.techniqueConfig.stippleOffColorEnabled=U&&b.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=U&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};Y.getPassParameters=function(){return this.params};Y.intersect=function(U,N,ca,O,V,ba,fa,ia,ma){ma?t.intersectDrapedRenderLineGeometry(U,
O,ba,1,fa):this.intersectLineGeometry(U,N,ca,O,fa)};Y.intersectLineGeometry=function(U,N,ca,O,V){if(O.options.selectionMode&&!u.isInstanceHidden(N))if(n.isTranslationMatrix(ca)){N=U.vertexAttributes.get("position").data;var ba=O.camera,fa=P;d.copy(fa,O.point);c.set(Q[0],fa[0]-2,fa[1]+2,0);c.set(Q[1],fa[0]+2,fa[1]+2,0);c.set(Q[2],fa[0]+2,fa[1]-2,0);c.set(Q[3],fa[0]-2,fa[1]-2,0);for(U=0;4>U;U++)if(!ba.unprojectFromRenderScreen(Q[U],X[U]))return;h.plane.fromPoints(ba.eye,X[0],X[1],aa);h.plane.fromPoints(ba.eye,
X[1],X[2],S);h.plane.fromPoints(ba.eye,X[2],X[3],H);h.plane.fromPoints(ba.eye,X[3],X[0],R);U=Number.MAX_VALUE;for(let ma=0;ma<N.length-5;ma+=3)if(x[0]=N[ma]+ca[12],x[1]=N[ma+1]+ca[13],x[2]=N[ma+2]+ca[14],m[0]=N[ma+3]+ca[12],m[1]=N[ma+4]+ca[13],m[2]=N[ma+5]+ca[14],!(0>h.plane.signedDistance(aa,x)&&0>h.plane.signedDistance(aa,m)||0>h.plane.signedDistance(S,x)&&0>h.plane.signedDistance(S,m)||0>h.plane.signedDistance(H,x)&&0>h.plane.signedDistance(H,m)||0>h.plane.signedDistance(R,x)&&0>h.plane.signedDistance(R,
m))){ba.projectToRenderScreen(x,F);ba.projectToRenderScreen(m,G);if(0>F[2]&&0<G[2]){c.subtract(B,x,m);var ia=ba.frustum;ia=-h.plane.signedDistance(ia[4],x)/c.dot(B,h.plane.normal(ia[4]));c.scale(B,B,ia);c.add(x,x,B);ba.projectToRenderScreen(x,F)}else if(0<F[2]&&0>G[2])c.subtract(B,m,x),ia=ba.frustum,ia=-h.plane.signedDistance(ia[4],m)/c.dot(B,h.plane.normal(ia[4])),c.scale(B,B,ia),c.add(m,m,B),ba.projectToRenderScreen(m,G);else if(0>F[2]&&0>G[2])continue;F[2]=0;G[2]=0;ia=h.lineSegment.distance2(h.lineSegment.fromPoints(F,
G,J),fa);ia<U&&(U=ia,c.copy(I,x),c.copy(K,m))}ca=O.rayBeginPoint;O=O.rayEndPoint;4>U&&(U=Number.MAX_VALUE,h.lineSegment.closestLineSegmentPoint(h.lineSegment.fromPoints(I,K,J),h.lineSegment.fromPoints(ca,O,L),E)&&(c.subtract(E,E,ca),U=c.length(E),c.scale(E,E,1/U),U/=c.distance(ca,O)),V(U,E))}else z.error("intersection assumes a translation-only matrix")};Y.computeAttachmentOrigin=function(U,N){U=U.vertexAttributes;if(!U)return!1;U=U.get("position");return q.computeAttachmentOriginLines(U,null,!1,
N)};Y.createBufferWriter=function(){const U=this.params.vertexColors?y.PositionColorLayout:y.PositionLayout;return b.isNone(this.params.stipplePattern)?new y.DefaultBufferWriter(U):new C(U.clone().vec3f("auxpos1"))};Y.getGLMaterial=function(U){return 0===U.output||4===U.output?new r(U):void 0};return W}(l.Material);let r=function(T){function W(U){U=T.call(this,U)||this;U.updateParameters();return U}g._inheritsLoose(W,T);var Y=W.prototype;Y.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(D.NativeLineTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};Y.beginSlot=function(U){return 3===U};Y._updateOccludeeState=function(U){U.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:U.hasOccludees}),this.updateParameters())};Y.ensureParameters=function(U){0===this.output&&this._updateOccludeeState(U)};Y.bind=function(U,N){U.bindProgram(this.technique.program);this.technique.bindPass(U,this.material.getPassParameters(),N)};Y.getPipelineState=
function(U,N){return this.technique.getPipelineState(N)};return W}(v),C=function(){function T(Y){this.vertexBufferLayout=Y}var W=T.prototype;W.allocate=function(Y){return this.vertexBufferLayout.createBuffer(Y)};W.elementCount=function(Y){return Y.indices.get("position").length};W.write=function(Y,U,N,ca){w.writeDefaultAttributes(U,this.vertexBufferLayout,Y.transformation,Y.invTranspTransformation,N,ca);this.writeAuxpos1(Y,U,N,ca)};W.writeAuxpos1=function(Y,U,N,ca){var O=N.getField("auxpos1",e.BufferViewVec3f);
N=U.indices.get("position");U=U.vertexAttributes.get("position").data;Y=Y.transformation;const V=O.typedBufferStride;O=O.typedBuffer;ca*=V;for(let ma=0;ma<N.length;ma+=2){var ba=3*N[ma],fa=U[ba],ia=U[ba+1];const ea=U[ba+2];ba=Y[0]*fa+Y[4]*ia+Y[8]*ea+Y[12];const M=Y[1]*fa+Y[5]*ia+Y[9]*ea+Y[13];fa=Y[2]*fa+Y[6]*ia+Y[10]*ea+Y[14];for(ia=0;2>ia;++ia)O[ca]=ba,O[ca+1]=M,O[ca+2]=fa,ca+=V}};return T}();const A={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,
stippleOffColor:null,sceneHasOcludees:!1,...l.materialParametersDefaults},x=k.create(),m=k.create(),B=k.create(),E=k.create(),F=f.createRenderScreenPointArray3(),G=f.createRenderScreenPointArray3(),I=k.create(),K=k.create(),J=h.lineSegment.create(),L=h.lineSegment.create(),P=k.create(),Q=[f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3()],X=[k.create(),k.create(),k.create(),k.create()],aa=h.plane.create(),S=h.plane.create(),
H=h.plane.create(),R=h.plane.create();a.NativeLineMaterial=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","./bufferWriterUtils"],function(a,g,b){const p=g.newLayout().vec3f("position"),f=g.newLayout().vec3f("position").vec2f("uv0");g=g.newLayout().vec3f("position").vec4u8("color");let k=function(){function c(e){this.vertexBufferLayout=e}var d=c.prototype;
d.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)};d.elementCount=function(e){return e.indices.get("position").length};d.write=function(e,h,n,q){b.writeDefaultAttributes(h,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,q)};return c}();a.DefaultBufferWriter=k;a.PositionColorLayout=g;a.PositionLayout=p;a.PositionUVLayout=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/StencilUtils ../../../../chunks/NativeLine.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){c=function(w){function y(z,r){r=w.call(this,z,r)||this;r.stipplePattern=null;r.stippleTextureBind=null;r.stippleTextureRepository=z.stippleTextureRepository;return r}b._inheritsLoose(y,w);var D=y.prototype;D.initializeProgram=function(z){var r=y.shader.get();const C=this.configuration;r=r.build({output:C.output,attributeColor:C.vertexColors,slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:C.stippleEnabled,
stippleOffColorEnabled:C.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:C.stippleIntegerRepeatsEnabled});return new h(z.rctx,r.generateSource("vertex"),r.generateSource("fragment"),e.Default3D)};D.dispose=function(){w.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};D.bindPass=function(z,r,C){q.View.bindProjectionMatrix(this.program,C.camera.projectionMatrix);if(this.stipplePattern!==
r.stipplePattern){var A=r.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,A);this.stipplePattern=A}this.configuration.stippleEnabled&&(A=f.isSome(this.stippleTextureBind)?this.stippleTextureBind(z,0)*C.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/A),this.program.setUniform2f("ndcToPixel",C.camera.fullViewport[2]/2,C.camera.fullViewport[3]/2));this.program.setUniform4fv("constantColor",
r.color);this.program.setUniform1f("alphaCoverage",Math.min(1,r.width*C.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(r=f.unwrap(r.stippleOffColor),this.program.setUniform4f("stippleOffColor",r[0],r[1],r[2],3<r.length?r[3]:1));4===this.configuration.output&&v.OutputHighlight.bindOutputHighlight(z,this.program,C)};D.bindDraw=function(z){q.View.bindView(this.program,z);u.Slice.bindUniformsWithOrigin(this.program,this.configuration,z)};D.initializePipeline=function(){const z=this.configuration,
r=n.separateBlendingParams(770,1,771,771),C=(A,x=null,m=null)=>n.makePipelineState({blending:x,depthTest:t.depthCompareLess,depthWrite:m,colorWrite:n.defaultColorWriteParams,stencilWrite:z.sceneHasOcludees?t.stencilWriteMaskOn:null,stencilTest:z.sceneHasOcludees?A?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null});return 0===z.output?(this._occludeePipelineState=C(!0,z.transparent||z.stippleEnabled?r:null,n.defaultDepthWriteParams),C(!1,z.transparent||z.stippleEnabled?r:null,n.defaultDepthWriteParams)):
C(!1)};D.getPipelineState=function(z){return z?this._occludeePipelineState:this.pipeline};b._createClass(y,[{key:"primitiveType",get:function(){return 1}}]);return y}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(l.NativeLineShader,()=>new Promise(function(w,y){a(["./NativeLine.glsl"],w,y)}));k=function(w){function y(){var D=w.apply(this,arguments)||this;D.output=0;D.slicePlaneEnabled=!1;D.vertexColors=!1;D.transparent=!1;D.stippleEnabled=!1;D.stippleOffColorEnabled=!1;D.stippleIntegerRepeatsEnabled=
!1;D.sceneHasOcludees=!1;return D}b._inheritsLoose(y,w);return y}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:8})],k.prototype,"output",void 0);p.__decorate([d.parameter()],k.prototype,"slicePlaneEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"vertexColors",void 0);p.__decorate([d.parameter()],k.prototype,"transparent",void 0);p.__decorate([d.parameter()],k.prototype,"stippleEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"stippleOffColorEnabled",void 0);
p.__decorate([d.parameter()],k.prototype,"stippleIntegerRepeatsEnabled",void 0);p.__decorate([d.parameter()],k.prototype,"sceneHasOcludees",void 0);g.NativeLineTechnique=c;g.NativeLineTechniqueConfiguration=k;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e){function h(q){const u=new p.ShaderBuilder;u.include(b.Transform,{linearDepth:!1});u.include(e.VertexColor,q);u.include(d.LineStipple,q);u.vertex.uniforms.add("proj","mat4").add("view","mat4");u.attributes.add("position","vec3");u.varyings.add("vpos","vec3");u.vertex.code.add(g.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = transformPosition(proj, view, vpos);
  `);q.stippleEnabled&&(u.attributes.add("auxpos1","vec3"),u.vertex.uniforms.add("ndcToPixel","vec2"),u.vertex.code.add(g.glsl`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${q.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `));u.vertex.code.add(g.glsl`
  }
  `);4===q.output&&u.include(k.OutputHighlight);u.include(f.Slice,q);u.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");u.fragment.code.add(g.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${q.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${g.glsl.float(c.symbolAlphaCutoff)}) {
      discard;
    }

    ${0===q.output?g.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===q.output?g.glsl`outputHighlight();`:""}
  }
  `);return u}var n=Object.freeze({__proto__:null,build:h});a.NativeLineShader=n;a.build=h})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./primitiveObjectSymbolUtils ../../webgl-engine/lib/lodRendering/LodResources ./symbolComplexity ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/materials/DefaultMaterial ../support/FastSymbolUpdates ../../../../symbols/support/symbolLayerUtils3D ./Graphics3DLodInstanceGraphicLayer ./lodResourceUtils ./objectResourceUtils ../../webgl-engine/lib/lodRendering/LodRenderer".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G){r=function(Q){function X(S,H,R,T){S=Q.call(this,S,H,R,T)||this;S._resources=null;S._optionalFields=[];S._instanceIndexToGraphicUid=new Map;S.hasLoadedPBRTextures=!1;S.ensureDrapedStatus(!1);S.hasLoadedPBRTextures=R.physicalBasedRenderingEnabled;return S}g._inheritsLoose(X,Q);var aa=X.prototype;aa.getCachedSize=function(){const [S,H,R]=b.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:S,depth:H,height:R}};aa.doLoad=
async function(S){if(!this._drivenProperties.size&&v.validateSymbolLayerSize(this.symbolLayer))throw Error();const H=this.symbolLayer;this._resources=this.isPrimitive?this._createResourcesForPrimitive(H.resource?H.resource.primitive:k.defaultPrimitive):await this._createResourcesForUrl(H.resource.href,S);this.complexity=this.computeComplexity()};aa.setMaterialTransparencyParams=function(S,H=b.get(this.symbolLayer,"material","color")){H=this._getCombinedOpacity(H);S.transparent=1>H||this.needsDrivenTransparentPass;
S.opacity=H;return S};aa._createResourcesForPrimitive=function(S){if(!y.isValidPrimitive(S))throw Error(`Unknown object symbol primitive: ${S}`);var H=this.symbolLayer;const R=u.create(m.objectSymbolLayerPrimitiveBoundingBox(S)),T=c.fromArray(u.size(R)),W=c.fromArray(m.objectSymbolLayerSizeWithResourceSize(T,H)),Y=d.length(W);var U={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:c.ONES,diffuse:c.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,
sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const N=U.usePBR;this.setMaterialTransparencyParams(U);var ca=this.symbol;if("point-3d"===ca.type&&ca.verticalOffset){const {screenLength:O,minWorldLength:V,maxWorldLength:ba}=ca.verticalOffset;U.verticalOffset={screenLength:f.pt2px(O),minWorldLength:V||0,maxWorldLength:null!=ba?ba:Infinity};U.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(U.screenSizePerspective=
this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?U.externalColor=q.ONES:(H=b.isSome(H.material)&&H.material.color,H=b.isSome(H)?p.toUnitRGBA(H):q.ONES,U.externalColor=H);this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(R,W,T,b.none));this._fastUpdates.enabled?(Object.assign(U,this._fastUpdates.materialParameters),U.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&
(U.instanced.push("color"),this._optionalFields.push("color"));U=new A.DefaultMaterial(U);U=y.primitiveLodResources(S,U);if(!U)throw Error(`Unknown object symbol primitive: ${S}`);S=D.materialsFromLodResources(U).map(O=>({opacity:1,transparent:O.params.transparent}));H=this._createStageResources(U,N);ca=this._createLodRenderer(U);return{lodResources:U,lodRenderer:ca,stageResources:H,symbolSize:W,extentPadding:Y,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:S,physicalBasedRenderingEnabled:N,
resourceBoundingBox:R,resourceSize:T,dispose:b.none,pivotOffset:b.none}};aa._createResourcesForUrl=async function(S,H){var R=["transformation"],T={materialParamsMixin:{instanced:R,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(b.none,b.none,
b.none,b.none));this._fastUpdates.enabled?(Object.assign(T.materialParamsMixin,this._fastUpdates.materialParameters),R.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(R.push("color"),this._optionalFields.push("color"));R=this.symbol;if("point-3d"===R.type&&R.verticalOffset){const {screenLength:Z,minWorldLength:la,maxWorldLength:ka}=R.verticalOffset;T.materialParamsMixin.verticalOffset={screenLength:f.pt2px(Z),minWorldLength:la||0,maxWorldLength:null!=
ka?ka:Infinity};T.materialParamsMixin.castShadows=!1}T.signal=H;T.usePBR=this._context.physicalBasedRenderingEnabled;H=T.usePBR;var W=await F.fetch(S,T);S=W.isEsriSymbolResource;T=W.isWosr;R=W.remove;const Y=E.makeLodResources(W.lods);E.fillEstimatedMinScreenSpaceRadius(Y);Y.levels.sort((Z,la)=>Z.minScreenSpaceRadius-la.minScreenSpaceRadius);Y.levels[0].minScreenSpaceRadius=Math.min(2,Y.levels[0].minScreenSpaceRadius);const U=this._context,N=this._getExternalColorParameters(this.symbolLayer.material);
var ca=b.get(this.symbolLayer,"material","color");const O=this._getCombinedOpacity(ca,{hasIntrinsicColor:!0}),V=this.needsDrivenTransparentPass;var ba=D.materialsFromLodResources(Y);ca=D.materialsFromLodResources(Y).map(Z=>{Z=Z.params;return{opacity:Z.opacity||1,transparent:Z.transparent}});ba.forEach(Z=>{const la=Z.params;Z.setParameterValues(N);const ka=la.opacity*O;Z.setParameterValues({opacity:ka,transparent:1>ka||V||la.transparent});U.screenSizePerspectiveEnabled&&Z.setParameterValues({screenSizePerspective:U.sharedResources.screenSizePerspectiveSettings})});
W=W.referenceBoundingBox;const fa=c.fromArray(u.size(W)),ia=c.fromArray(Y.levels[0].pivotOffset),ma=c.fromArray(m.objectSymbolLayerSizeWithResourceSize(fa,this.symbolLayer)),ea=d.length(ma);x.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(W,ma,fa,ia))&&ba.forEach(Z=>Z.setParameterValues(this._fastUpdates.materialParameters));ba=this._createStageResources(Y,H);const M=this._createLodRenderer(Y);return{lodResources:Y,lodRenderer:M,stageResources:ba,
symbolSize:ma,extentPadding:ea,isEsriSymbolResource:S,isWosr:T,originalMaterialParameters:ca,physicalBasedRenderingEnabled:H,resourceBoundingBox:W,resourceSize:fa,dispose:R,pivotOffset:ia}};aa._createStageResources=function(S,H){const R=this._context.stage,T=D.materialsFromLodResources(S);H!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();R.addMany(T);H=D.texturesFromLodResources(S);R.addMany(H);S=D.geometriesFromLodResources(S);R.addMany(S);return{materials:T,textures:H,
geometries:S}};aa._createLodRenderer=function(S){const H=this._context.stage;S=new G.LodRenderer(S,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:R=>this._instanceIndexToGraphicUid.get(R),notifyGraphicGeometryChanged:R=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(R)),notifyGraphicVisibilityChanged:R=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(R))},this._fastUpdates.enabled?{applyTransform:(R,T,W)=>{R.getFeatureAttribute(T,
L);e.copy(W,x.evaluateModelTransform(this._fastUpdates.materialParameters,L,W))},scaleFactor:(R,T,W)=>{T.getFeatureAttribute(W,L);return x.evaluateModelTransformScale(R,this._fastUpdates.materialParameters,L)}}:null);S.slicePlane=this._context.slicePlaneEnabled;H.addRenderPlugin(S.slots,S);return S};aa._getExternalColorParameters=function(S){const H={};this._drivenProperties.color?H.externalColor=q.ONES:b.isSome(S)&&b.isSome(S.color)?H.externalColor=p.toUnitRGBA(S.color):(H.externalColor=q.ONES,H.colorMixMode=
"ignore");return H};aa.destroy=function(){Q.prototype.destroy.call(this);const S=this._context.stage;if(b.isSome(this._resources)){S.removeRenderPlugin(this._resources.lodRenderer);this._resources.lodRenderer.destroy();const H=this._resources.stageResources;S.removeMany(H.materials);S.removeMany(H.textures);S.removeMany(H.geometries);b.isSome(this._resources.dispose)&&this._resources.dispose()}this._resources=null};aa.createGraphics3DGraphic=function(S){const H=S.graphic;if(!this._validateGeometry(H.geometry))return null;
const R=C.placePointOnGeometry(H.geometry);if(b.isNone(R))return this.logger.warn(`unsupported geometry type for icon symbol: ${H.geometry.type}`),null;const T=this.setGraphicElevationContext(H,new w.ElevationContext);return this._createAs3DShape(H,R,S.renderingInfo,T,H.uid)};aa.notifyDestroyGraphicLayer=function(S){this._instanceIndexToGraphicUid.delete(S.instanceIndex)};aa.graphicLayerToGraphicId=function(){return 0};aa.layerOpacityChanged=function(){if(b.isNone(this._resources))return!0;const S=
this._drivenProperties.opacity,H=!this.isPrimitive,R=this._resources.stageResources.materials,T=this._resources.originalMaterialParameters;for(let Y=0;Y<R.length;Y++){const U=R[Y];var W=b.get(this.symbolLayer,"material","color");const N=T[Y];W=this._getCombinedOpacity(W,{hasIntrinsicColor:H})*N.opacity;U.setParameterValues({opacity:W,transparent:1>W||S||N.transparent})}return!0};aa.layerElevationInfoChanged=function(S,H){return this.updateGraphics3DGraphicElevationInfo(S,H,t.needsElevationUpdates3D)};
aa.slicePlaneEnabledChanged=function(){if(b.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const S of this._resources.stageResources.materials)S.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};aa.physicalBasedRenderingChanged=function(){if(b.isNone(this._resources))return!0;const {stageResources:S,isWosr:H}=this._resources;for(const R of S.materials)this.isPrimitive?R.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0}):H||R.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};aa.pixelRatioChanged=function(){return!0};aa.applyRendererDiff=function(S,H){if(b.isNone(this._resources))return!0;const {stageResources:{materials:R},lodRenderer:T,resourceBoundingBox:W,symbolSize:Y,resourceSize:U,pivotOffset:N}=this._resources;for(const ca in S.diff)switch(ca){case "visualVariables":if(x.updateFastSymbolUpdatesState(this._fastUpdates,
H,this._fastVisualVariableConvertOptions(W,Y,U,N))){for(const O of R)O.setParameterValues(this._fastUpdates.materialParameters);T.notifyShaderTransformationChanged()}else return!1;break;default:return!1}return!0};aa.computeComplexity=function(){if(b.isNone(this._resources))return Q.prototype.computeComplexity.call(this);const S=D.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((R,T)=>R+T.indices.get("position").length,0)/3,H=z.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer);return{primitivesPerFeature:S,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:H}};aa.hasLodRenderer=function(){return b.isSome(this._resources)};aa._createAs3DShape=function(S,H,R,T,W){if(!this.hasLodRenderer()||b.isNone(this._resources))return null;S=this.getFastUpdateAttrValues(S);const Y=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?v.mixinColorAndOpacity(R.color,R.opacity):null;var U=this._context.clippingExtent;h.projectPointToVector(H,I,this._context.elevationProvider.spatialReference);
if(b.isSome(U)&&!u.containsPoint(U,I))return null;U=this._requiresTerrainElevation(T);const N=this._computeGlobalTransform(H,T,J,U?P:null);R=this._computeLocalTransform(this._resources,this.symbolLayer,R,K);const ca=this._resources.lodRenderer.instanceData,O=ca.addInstance();this._instanceIndexToGraphicUid.set(O,W);ca.setLocalTransform(O,R,!1);ca.setGlobalTransform(O,N);S&&ca.setFeatureAttribute(O,S);Y&&ca.setColor(O,Y);W=new B(this,O,l.perLodInstanceElevationAligner,T);U&&(W.alignedSampledElevation=
P.sampledElevation);W.needsElevationUpdates=t.needsElevationUpdates3D(T.mode);C.extendPointGraphicElevationContext(W,H,this._context.elevationProvider);return W};aa._computeGlobalTransform=function(S,H,R,T){H=t.evaluateElevationAlignmentAtPoint(S,this._context.elevationProvider,H,this._context.renderCoordsHelper,T);I[0]=S.x;I[1]=S.y;I[2]=H;h.computeLinearTransformation(S.spatialReference,I,R,this._context.renderCoordsHelper.spatialReference);return R};aa._computeLocalTransform=function(S,H,R,T){e.identity(T);
this._applyObjectRotation(R,!1,T);this._applyObjectRotation(H,!0,T);this._applyObjectScale(S,R,T);this._applyAnchor(S,H,T);return T};aa._applyObjectScale=function(S,H,R){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(S=v.computeObjectScale(this._drivenProperties.size&&H.size?H.size:S.symbolSize,S.symbolSize,S.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===S[0]&&1===S[1]&&1===S[2]||e.scale(R,R,S))};aa.prepareSymbolLayerPatch=function(S){if("partial"===
S.diff.type){var H=S.diff.diff;this._preparePatchTransform(S,H);this._preparePatchColor(S,H)}};aa.updateGeometry=function(S,H){if(b.isNone(this._resources))return!0;const R=H&&C.placePointOnGeometry(H);if(b.isNone(R))return!1;H=this.getGeometryElevationMode(H);if(S.elevationContext.mode!==H)return!1;H=this._requiresTerrainElevation(S.elevationContext);this._computeGlobalTransform(R,S.elevationContext,J,H?P:null);H&&(S.alignedSampledElevation=P.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(S.instanceIndex,
J,!0);C.extendPointGraphicElevationContext(S,R,this._context.elevationProvider);return!0};aa._preparePatchTransform=function(S,H){if((H.heading||H.tilt||H.roll||H.width||H.height||H.depth||H.anchor||H.anchorPosition)&&!b.isNone(this._resources)){var R=(fa,ia,ma)=>b.unwrapOr(null!=fa&&"complete"===fa.type?fa.newValue:ia,ma),T=R(H.heading,this.symbolLayer.heading,0),W=R(H.tilt,this.symbolLayer.tilt,0),Y=R(H.roll,this.symbolLayer.roll,0),U=R(H.width,this.symbolLayer.width,void 0),N=R(H.height,this.symbolLayer.height,
void 0),ca=R(H.depth,this.symbolLayer.depth,void 0),O=R(H.anchor,this.symbolLayer.anchor,void 0);R=R(H.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete H.heading;delete H.tilt;delete H.roll;delete H.width;delete H.height;delete H.depth;delete H.anchor;delete H.anchorPosition;var V={heading:T,tilt:W,roll:Y,anchor:O,anchorPosition:R},ba=this._resources;1===this.loadStatus&&S.symbolLayerStatePatches.push(()=>{ba.symbolSize=c.fromArray(m.objectSymbolLayerSizeWithResourceSize(ba.resourceSize,
{width:U,height:N,depth:ca,isPrimitive:this.symbolLayer.isPrimitive}))});S.graphics3DGraphicPatches.push((fa,ia)=>{ia=this._computeLocalTransform(ba,V,ia,K);ba.lodRenderer.instanceData.setLocalTransform(fa.instanceIndex,ia,!0)})}};aa._preparePatchColor=function(S,H){if(H.material&&"partial"===H.material.type&&(H=H.material.diff,H.color&&"complete"===H.color.type&&null!=H.color.newValue&&null!=H.color.oldValue)){var R=H.color.newValue,T=b.isSome(R)?p.toUnitRGBA(R):q.ONES;delete H.color;var W=this._resources;
b.isNone(W)||S.graphics3DGraphicPatches.push(Y=>{this._hasPerInstanceColor()?(W.lodRenderer.instanceData.setColor(Y.instanceIndex,T),Y=this.setMaterialTransparencyParams({},R)):Y=this.setMaterialTransparencyParams({externalColor:T},R);for(const U of W.stageResources.materials)U.setParameterValues(Y)})}};aa._requiresTerrainElevation=function(S){return"absolute-height"!==S.mode};aa._applyObjectRotation=function(S,H,R){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&H))return v.computeObjectRotation(S.heading,
S.tilt,S.roll,R)};aa._computeAnchor=function(S,H,R){const T=c.create();switch(R.anchor){case "center":d.copy(T,u.center(S));d.negate(T,T);break;case "top":H=u.center(S);d.set(T,-H[0],-H[1],-S[5]);break;case "bottom":H=u.center(S);d.set(T,-H[0],-H[1],-S[2]);break;case "relative":H=u.center(S);S=u.size(S);R=(R=R.anchorPosition)?c.fromValues(R.x,R.y,R.z):c.ZEROS;d.multiply(T,S,R);d.add(T,T,H);d.negate(T,T);break;default:b.isSome(H)?d.negate(T,H):d.copy(T,c.ZEROS)}return T};aa._applyAnchor=function(S,
H,R){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(S=this._computeAnchor(S.resourceBoundingBox,S.pivotOffset,H))&&e.translate(R,R,S)};aa._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};aa._fastVisualVariableConvertOptions=function(S,H,R,T){const W=b.isSome(S)?c.fromArray(u.size(S)):c.ONES;S=b.isSome(S)?this._computeAnchor(S,T,this.symbolLayer):c.ZEROS;T=this._context.renderCoordsHelper.unitInMeters;R=v.computeObjectScale(b.isSome(H)?
H:void 0,H,R,T);const Y=c.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:W,symbolSize:b.isSome(H)?H:c.ONES,unitInMeters:T,transformation:{anchor:S,scale:R,rotation:Y}}};g._createClass(X,[{key:"extentPadding",get:function(){return b.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return b.get(this._resources,
"lodRenderer")}}]);return X}(r.Graphics3DSymbolLayer);const I=c.create(),K=n.create(),J=n.create(),L=q.create(),P={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DObjectSymbolLayer=r;a.default=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/symbolLayerUtils3D":function(){define(["exports","../../core/has","../../chunks/vec3f64","../../geometry/support/aaBoundingBox"],function(a,g,b,p){const f=p.fromValues(-.5,-.5,-.5,.5,.5,.5),k=p.fromValues(-.5,-.5,0,.5,.5,
1),c=p.fromValues(-.5,-.5,0,.5,.5,.5);a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON=c;a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE=f;a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER=k;a.objectSymbolLayerPrimitiveBoundingBox=function(d){switch(d){case "sphere":case "cube":case "diamond":return f;case "cylinder":case "cone":case "inverted-cone":return k;case "tetrahedron":return c}};a.objectSymbolLayerSizeWithResourceSize=function(d,{isPrimitive:e,width:h,depth:n,height:q}){e=e?10:1;if(null==h&&null==
q&&null==n)return[e*d[0],e*d[1],e*d[2]];h=b.fromValues(h,n,q);let u;for(n=0;3>n;n++)if(q=h[n],null!=q){u=q/d[n];break}for(n=0;3>n;n++)null==h[n]&&(h[n]=d[n]*u);return h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3DStateID ./graphicUtils ./featureExpressionInfoUtils".split(" "),
function(a,g,b,p,f,k,c,d,e){let h=function(){function l(y,D,z,r){this.graphics3DSymbolLayer=y;this.instanceIndex=D;this.elevationAligner=z;this.elevationContext=r;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var w=l.prototype;w.initialize=function(){};w.setVisibility=function(y){const D=this.lodRenderer.instanceData;y!==D.getVisible(this.instanceIndex)&&D.setVisible(this.instanceIndex,y)};w.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};w.alignWithElevation=function(y,D,z){this.elevationAligner&&(e.setContextFeature(this.elevationContext.featureExpressionInfoContext,z),y=this.elevationAligner(this,this.elevationContext,y,D),null!=y&&(this.alignedSampledElevation=y))};w.getBSRadius=function(){const y=this.lodRenderer;return y.baseBoundingSphere.radius*y.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
w.getCenterObjectSpace=function(y=b.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);return p.transformMat4(y,this.lodRenderer.baseBoundingSphere.center,t)};w.getBoundingBoxObjectSpace=function(y=k.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);const D=this.lodRenderer.baseBoundingBox;k.empty(y);for(let z=0;8>z;++z)p.set(q,0===(z&1)?D[0]:D[3],0===(z&2)?D[1]:D[4],0===(z&4)?D[2]:D[5]),p.transformMat4(q,q,t),k.expandWithVec3(y,
q);return y};w.computeAttachmentOrigin=function(y){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);y.render.origin[0]+=t[12];y.render.origin[1]+=t[13];y.render.origin[2]+=t[14];y.render.num++};w.getProjectedBoundingBox=async function(y,D,z,r,C){C=this.getBoundingBoxObjectSpace(C);var A=v;const x=k.isPoint(C)?1:A.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);for(var m=0;m<x;m++){const B=A[m];q[0]=C[B[0]];q[1]=C[B[1]];q[2]=C[B[2]];p.transformMat4(q,
q,t);n[3*m]=q[0];n[3*m+1]=q[1];n[3*m+2]=q[2]}if(!y(n,0,x))return null;k.empty(C);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(A=0;A<3*x;A+=3){for(m=0;3>m;m++)C[m]=Math.min(C[m],n[A+m]),C[m+3]=Math.max(C[m+3],n[A+m]);y&&z.push({location:n.slice(A,A+3),screenSpaceBoundingRect:y})}if(D&&(k.center(C,u),"absolute-height"!==this.elevationContext.mode)){let B;z=d.demResolutionForBoundingBox(C,D);try{B=await D.service.queryElevation(u[0],u[1],r,z,"ground")}catch(E){}g.isSome(B)&&
k.offset(C,0,0,-this.alignedSampledElevation+B)}return C};w.addObjectState=function(y,D){0===y&&(y=new c.Object3DStateID(y),this.addHighlightId(y),D.addExternal(z=>{this.removeHighlightId(z)},y))};w.removeObjectState=function(y){this.highlights&&this.highlights.forEach(D=>y.remove(D))};w.addHighlightId=function(y){this.highlights=this.highlights||new Set;this.highlights.add(y);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};w.removeHighlightId=function(y){this.highlights&&(this.highlights.delete(y),
this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};a._createClass(l,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return l}();const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=b.create(),u=b.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=f.create();return h})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports",
"../../webgl-engine/lib/lodRendering/LodResources"],function(a,g){function b(f){const k=[];f.stageResources.geometries.forEach((c,d)=>{k.push({material:f.stageResources.materials[d],geometry:c,textures:f.stageResources.textures})});return{components:k,minScreenSpaceRadius:f.lodThreshold,pivotOffset:f.pivotOffset}}function p(f,k=.05){f=g.computeFaceCount(f);return Math.sqrt(f/(k*Math.PI))}a.estimateMinScreenSpaceRadius=p;a.fillEstimatedMinScreenSpaceRadius=function(f){f.levels.forEach(k=>{k.minScreenSpaceRadius||
(k.minScreenSpaceRadius=p(k))})};a.makeLodLevelResources=b;a.makeLodResources=function(f){return{levels:f.map(k=>b(k))}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/devEnvironmentUtils ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/mat3 ../../support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture ../../glTF/DefaultLoadingContext ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../support/buffer/utils ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../../../chunks/vec42".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x){function m(F){const G=F.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return G?{fileType:"gltf",url:G[1],specifiedLodIndex:null!=G[4]?Number(G[4]):null}:F.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:F,specifiedLodIndex:null}:{fileType:"unknown",url:F,specifiedLodIndex:null}}function B(F,G,I,K){const J=F.model,L=c.create(),P=[],Q=new Map,X=new Map;J.lods.forEach((aa,S)=>{if(void 0===K||S===K){var H={name:aa.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:g.isSome(aa.lodThreshold)?aa.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:q.empty()};P.push(H);aa.parts.forEach(R=>{var T=R.material+(R.attributes.normal?"_normal":"")+(R.attributes.color?"_color":"")+(R.attributes.texCoord0?"_texCoord0":"")+(R.attributes.tangent?"_tangent":"");const W=J.materials.get(R.material),Y=g.isSome(R.attributes.texCoord0);var U=g.isSome(R.attributes.normal);if(!Q.has(T)){if(Y){if(g.isSome(W.textureColor)&&!X.has(W.textureColor)){var N=
J.textures.get(W.textureColor);X.set(W.textureColor,new t.Texture(N.data,{...N.parameters,preMultiplyAlpha:!0}))}g.isSome(W.textureNormal)&&!X.has(W.textureNormal)&&(N=J.textures.get(W.textureNormal),X.set(W.textureNormal,new t.Texture(N.data,{...N.parameters,preMultiplyAlpha:!0})));g.isSome(W.textureOcclusion)&&!X.has(W.textureOcclusion)&&(N=J.textures.get(W.textureOcclusion),X.set(W.textureOcclusion,new t.Texture(N.data,{...N.parameters,preMultiplyAlpha:!0})));g.isSome(W.textureEmissive)&&!X.has(W.textureEmissive)&&
(N=J.textures.get(W.textureEmissive),X.set(W.textureEmissive,new t.Texture(N.data,{...N.parameters,preMultiplyAlpha:!0})));g.isSome(W.textureMetallicRoughness)&&!X.has(W.textureMetallicRoughness)&&(N=J.textures.get(W.textureMetallicRoughness),X.set(W.textureMetallicRoughness,new t.Texture(N.data,{...N.parameters,preMultiplyAlpha:!0})))}N=W.color[0]**(1/v.COLOR_GAMMA);var ca=W.color[1]**(1/v.COLOR_GAMMA),O=W.color[2]**(1/v.COLOR_GAMMA),V=W.emissiveFactor[0]**(1/v.COLOR_GAMMA),ba=W.emissiveFactor[1]**
(1/v.COLOR_GAMMA);const fa=W.emissiveFactor[2]**(1/v.COLOR_GAMMA);Q.set(T,new v.DefaultMaterial({...G,transparent:"BLEND"===W.alphaMode,textureAlphaMode:E(W.alphaMode),textureAlphaCutoff:W.alphaCutoff,diffuse:[N,ca,O],ambient:[N,ca,O],opacity:W.opacity,doubleSided:W.doubleSided,doubleSidedType:"winding-order",cullFace:W.doubleSided?0:2,vertexColors:!!R.attributes.color,vertexTangents:!!R.attributes.tangent,normals:U?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:g.isSome(W.textureColor)&&
Y?X.get(W.textureColor).id:void 0,colorMixMode:W.colorMixMode,normalTextureId:g.isSome(W.textureNormal)&&Y?X.get(W.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:g.isSome(W.textureOcclusion)&&Y?X.get(W.textureOcclusion).id:void 0,emissiveTextureId:g.isSome(W.textureEmissive)&&Y?X.get(W.textureEmissive).id:void 0,metallicRoughnessTextureId:g.isSome(W.textureMetallicRoughness)&&Y?X.get(W.textureMetallicRoughness).id:void 0,emissiveFactor:[V,ba,fa],mrrFactors:[W.metallicFactor,
W.roughnessFactor,G.mrrFactors[2]],isSchematic:!1,...I}))}a:{U=R.indices||R.attributes.position.count;switch(R.primitiveType){case 4:U=C.trianglesToTriangles(U);break a;case 5:U=C.triangleStripToTriangles(U);break a;case 6:U=C.triangleFanToTriangles(U);break a}U=void 0}N=U;U=R.attributes.position.count;ca=z.createBuffer(h.BufferViewVec3f,U);n.transformMat4(ca,R.attributes.position,R.transform);ca=[["position",{data:ca.typedBuffer,size:ca.elementCount,exclusive:!0}]];O=[["position",N]];g.isSome(R.attributes.normal)&&
(V=z.createBuffer(h.BufferViewVec3f,U),e.normalFromMat4(L,R.transform),n.transformMat3(V,R.attributes.normal,L),ca.push(["normal",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),O.push(["normal",N]));g.isSome(R.attributes.tangent)&&(V=z.createBuffer(h.BufferViewVec4f,U),e.normalFromMat4(L,R.transform),x.transformMat3(V,R.attributes.tangent,L),ca.push(["tangent",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),O.push(["tangent",N]));g.isSome(R.attributes.texCoord0)&&(V=z.createBuffer(h.BufferViewVec2f,
U),w.normalizeIntegerBuffer(V,R.attributes.texCoord0),ca.push(["uv0",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),O.push(["uv0",N]));g.isSome(R.attributes.color)&&(V=z.createBuffer(h.BufferViewVec4u8,U),4===R.attributes.color.elementCount?R.attributes.color instanceof h.BufferViewVec4f?x.scale(V,R.attributes.color,255):R.attributes.color instanceof h.BufferViewVec4u8?D.copy(V,R.attributes.color):R.attributes.color instanceof h.BufferViewVec4u16&&x.scale(V,R.attributes.color,1/256):(D.fill(V,
255,255,255,255),ba=new h.BufferViewVec3u8(V.buffer,0,4),R.attributes.color instanceof h.BufferViewVec3f?n.scale(ba,R.attributes.color,255):R.attributes.color instanceof h.BufferViewVec3u8?y.copy(ba,R.attributes.color):R.attributes.color instanceof h.BufferViewVec3u16&&n.scale(ba,R.attributes.color,1/256)),ca.push(["color",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),O.push(["color",N]));R=new u.Geometry(ca,O);H.stageResources.geometries.push(R);H.stageResources.materials.push(Q.get(T));
Y&&(g.isSome(W.textureColor)&&H.stageResources.textures.push(X.get(W.textureColor)),g.isSome(W.textureNormal)&&H.stageResources.textures.push(X.get(W.textureNormal)),g.isSome(W.textureOcclusion)&&H.stageResources.textures.push(X.get(W.textureOcclusion)),g.isSome(W.textureEmissive)&&H.stageResources.textures.push(X.get(W.textureEmissive)),g.isSome(W.textureMetallicRoughness)&&H.stageResources.textures.push(X.get(W.textureMetallicRoughness)));H.numberOfVertices+=U;T=R.boundingInfo;g.isSome(T)&&(q.expandWithVec3(H.boundingBox,
T.getBBMin()),q.expandWithVec3(H.boundingBox,T.getBBMax()))})}});return P}function E(F){switch(F){case "BLEND":return 0;case "MASK":return 2;case "OPAQUE":return 1;default:return 0}}a.fetch=async function(F,G){var I=m(f.adjustStaticAGOUrl(F));if("wosr"===I.fileType)return F=await (G.cache?G.cache.loadWOSR(I.url,G):A.load(I.url,G)),I=A.processLoadResult(F,G),{lods:[I],referenceBoundingBox:I.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:F.remove};F=await (G.cache?G.cache.loadGLTF(I.url,G,G.usePBR):
r.load(new l.DefaultLoadingContext(G.streamDataRequester),I.url,G,G.usePBR));var K=g.get(F.model.meta,"ESRI_proxyEllipsoid");if(F.meta.isEsriSymbolResource&&g.isSome(K)&&-1!==F.meta.uri.indexOf("/RealisticTrees/"))a:for(var J=0;J<F.model.lods.length;++J){var L=F.model.lods[J];F.customMeta.esriTreeRendering=!0;for(var P of L.parts){L=P.attributes.normal;if(g.isNone(L))break a;const X=P.attributes.position,aa=X.count,S=b.create(),H=b.create(),R=b.create(),T=z.createBuffer(h.BufferViewVec4u8,aa),W=z.createBuffer(h.BufferViewVec3f,
aa),Y=k.invert(d.create(),P.transform);for(let U=0;U<aa;U++){X.getVec(U,H);L.getVec(U,S);p.transformMat4(H,H,P.transform);p.subtract(R,H,K.center);p.divide(R,R,K.radius);const N=R[2];var Q=p.length(R);Q=Math.min(.45+.55*Q*Q,1);p.divide(R,R,K.radius);p.transformMat4(R,R,Y);p.normalize(R,R);J+1!==F.model.lods.length&&1<F.model.lods.length&&(-1<N?p.lerp(R,R,S,.2):p.lerp(R,R,S,Math.min(-4*N-3.8,1)));W.setVec(U,R);T.set(U,0,255*Q);T.set(U,1,255*Q);T.set(U,2,255*Q);T.set(U,3,255)}P.attributes.normal=W;
P.attributes.color=T}}P=F.meta.isEsriSymbolResource?{usePBR:G.usePBR,isSchematic:!1,treeRendering:F.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:G.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]};G={...G.materialParamsMixin,treeRendering:F.customMeta.esriTreeRendering};if(null!=I.specifiedLodIndex)return K=B(F,P,G,I.specifiedLodIndex),J=K[0].boundingBox,0!==I.specifiedLodIndex&&(J=B(F,P,G,0)[0].boundingBox),{lods:K,referenceBoundingBox:J,isEsriSymbolResource:F.meta.isEsriSymbolResource,isWosr:!1,
remove:F.remove};I=B(F,P,G);return{lods:I,referenceBoundingBox:I[0].boundingBox,isEsriSymbolResource:F.meta.isEsriSymbolResource,isWosr:!1,remove:F.remove}};a.gltfToEngineResources=B;a.parseUrl=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../core/maybe ../../../core/Error ../../../core/urlUtils ../../../core/promiseUtils ../../../request ../../../core/asyncUtils".split(" "),function(a,g,b,p,f,k,c){let d=function(){function h(q){this.streamDataRequester=
q}var n=h.prototype;n.loadJSON=async function(q,u){return this.load("json",q,u)};n.loadBinary=async function(q,u){return p.isDataProtocol(q)?(f.throwIfAborted(u),p.dataToArrayBuffer(q)):this.load("binary",q,u)};n.loadImage=async function(q,u){return this.load("image",q,u)};n.load=async function(q,u,v){if(g.isNone(this.streamDataRequester))return(await k(u,{responseType:e[q]})).data;q=await c.result(this.streamDataRequester.request(u,q,v));if(!0===q.ok)return q.value;f.throwIfAbortError(q.error);throw new b("",
`Request for resource failed: ${q.error}`);};return h}();const e={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec22":function(){define(["exports","../views/3d/support/buffer/types"],function(a,g){function b(k,c,d){const e=k.typedBuffer;k=k.typedBufferStride;const h=c.typedBuffer,n=c.typedBufferStride;c=d?d.count:c.count;let q=(d&&d.dstIndex?d.dstIndex:0)*k;d=(d&&d.srcIndex?d.srcIndex:0)*n;for(let u=0;u<
c;++u)e[q]=h[d],e[q+1]=h[d+1],q+=k,d+=n}function p(k,c,d){const e=k.typedBuffer,h=k.typedBufferStride,n=c.typedBuffer,q=c.typedBufferStride,u=d?d.count:c.count;let v=(d&&d.dstIndex?d.dstIndex:0)*h,t=(d&&d.srcIndex?d.srcIndex:0)*q;if(g.isInteger(c.elementType))if(d=g.maximumValue(c.elementType),g.isSigned(c.elementType))for(c=0;c<u;++c)e[v]=Math.max(n[t]/d,-1),e[v+1]=Math.max(n[t+1]/d,-1),v+=h,t+=q;else for(c=0;c<u;++c)e[v]=n[t]/d,e[v+1]=n[t+1]/d,v+=h,t+=q;else b(k,c,d);return k}var f=Object.freeze({__proto__:null,
copy:b,normalizeIntegerBuffer:p});a.copy=b;a.normalizeIntegerBuffer=p;a.vec2=f})},"esri/chunks/vec33":function(){define(["exports"],function(a){function g(p,f,k){const c=p.typedBuffer;p=p.typedBufferStride;const d=f.typedBuffer,e=f.typedBufferStride;f=k?k.count:f.count;let h=(k&&k.dstIndex?k.dstIndex:0)*p;k=(k&&k.srcIndex?k.srcIndex:0)*e;for(let n=0;n<f;++n)c[h]=d[k],c[h+1]=d[k+1],c[h+2]=d[k+2],h+=p,k+=e}var b=Object.freeze({__proto__:null,copy:g});a.copy=g;a.vec3=b})},"esri/chunks/vec43":function(){define(["exports"],
function(a){function g(f,k,c){const d=f.typedBuffer;f=f.typedBufferStride;const e=k.typedBuffer,h=k.typedBufferStride;k=c?c.count:k.count;let n=(c&&c.dstIndex?c.dstIndex:0)*f;c=(c&&c.srcIndex?c.srcIndex:0)*h;for(let q=0;q<k;++q)d[n]=e[c],d[n+1]=e[c+1],d[n+2]=e[c+2],d[n+3]=e[c+3],n+=f,c+=h}function b(f,k,c,d,e,h){const n=f.typedBuffer,q=f.typedBufferStride;f=h?h.count:f.count;h=(h&&h.dstIndex?h.dstIndex:0)*q;for(let u=0;u<f;++u)n[h]=k,n[h+1]=c,n[h+2]=d,n[h+3]=e,h+=q}var p=Object.freeze({__proto__:null,
copy:g,fill:b});a.copy=g;a.fill=b;a.vec4=p})},"esri/views/3d/support/buffer/utils":function(){define("exports ./types ../../../../chunks/mat32 ../../../../chunks/mat42 ../../../../chunks/scalar ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43".split(" "),function(a,g,b,p,f,k,c,d){a.mat3=b.mat3;a.mat4=p.mat4;a.scalar=f.scalar;a.vec2=k.vec2;a.vec3=c.vec3;a.vec4=d.vec4;a.createBuffer=function(e,h){return new e(new ArrayBuffer(h*e.ElementCount*g.elementTypeSize(e.ElementType)))};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function g(p,f,k){const c=p.typedBuffer;p=p.typedBufferStride;const d=f.typedBuffer,e=f.typedBufferStride;f=k?k.count:f.count;let h=(k&&k.dstIndex?k.dstIndex:0)*p;k=(k&&k.srcIndex?k.srcIndex:0)*e;for(let n=0;n<f;++n){for(let q=0;9>q;++q)c[h+q]=d[k+q];h+=p;k+=e}}var b=Object.freeze({__proto__:null,copy:g});a.copy=g;a.mat3=b})},"esri/chunks/mat42":function(){define(["exports"],function(a){function g(p,
f,k){const c=p.typedBuffer;p=p.typedBufferStride;const d=f.typedBuffer,e=f.typedBufferStride;f=k?k.count:f.count;let h=(k&&k.dstIndex?k.dstIndex:0)*p;k=(k&&k.srcIndex?k.srcIndex:0)*e;for(let n=0;n<f;++n){for(let q=0;16>q;++q)c[h+q]=d[k+q];h+=p;k+=e}}var b=Object.freeze({__proto__:null,copy:g});a.copy=g;a.mat4=b})},"esri/chunks/scalar":function(){define(["exports"],function(a){function g(f,k,c){const d=f.typedBuffer;f=f.typedBufferStride;const e=k.typedBuffer,h=k.typedBufferStride;k=c?c.count:k.count;
let n=(c&&c.dstIndex?c.dstIndex:0)*f;c=(c&&c.srcIndex?c.srcIndex:0)*h;for(let q=0;q<k;++q)d[n]=e[c],n+=f,c+=h}function b(f,k){const c=f.count;k||(k=new f.TypedArrayConstructor(c));for(let d=0;d<c;d++)k[d]=f.get(d);return k}var p=Object.freeze({__proto__:null,copy:g,makeDense:b});a.copy=g;a.makeDense=b;a.scalar=p})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(a,g,b,p,
f,k){function c(t){let l=null;t.json.nodes.forEach(w=>{w=w.extras;g.isSome(w)&&(w.ESRI_proxyEllipsoid||w.ESRI_lod)&&(l=w)});return l}async function d(t,l){async function w(r,C){const A=y.nodes[r];r=t.getNodeTransform(r);q.warnUnsupportedIf(null!=A.weights,"Morph targets are not supported.");if(null!=A.mesh){const x=y.meshes[A.mesh];for(const m of x.primitives)await l(m,r,C,x.name)}for(const x of A.children||[])await w(x,C)}const y=t.json;var D=y.scenes[y.scene||0].nodes;const z=1<D.length;for(const r of D){D=
y.nodes[r];const C=[w(r,0)];D.extensions&&D.extensions.MSFT_lod&&Array.isArray(D.extensions.MSFT_lod.ids)&&!z&&C.push(...D.extensions.MSFT_lod.ids.map((A,x)=>w(A,x+1)));await Promise.all(C)}}function e(t,l,w){const y=z=>{const r=`${w}_tex_${z&&z.id}${z&&z.name?"_"+z.name:""}`;if(z&&!t.textures.has(r)){const C=f.makeTextureSource(z.data,{wrap:{s:h(z.wrapS),t:h(z.wrapT)},mipmap:u.some(A=>A===z.minFilter),noUnpackFlip:!0});t.textures.set(r,C)}return r},D=`${w}_mat_${l.id}_${l.name}`;t.materials.has(D)||
(l=f.makeMaterialParameters({color:[l.color[0],l.color[1],l.color[2]],opacity:l.color[3],alphaMode:l.alphaMode,alphaCutoff:l.alphaCutoff,doubleSided:l.doubleSided,colorMixMode:l.ESRI_externalColorMixMode,textureColor:l.colorTexture?y(l.colorTexture):void 0,textureNormal:l.normalTexture?y(l.normalTexture):void 0,textureOcclusion:l.occlusionTexture?y(l.occlusionTexture):void 0,textureEmissive:l.emissiveTexture?y(l.emissiveTexture):void 0,textureMetallicRoughness:l.metallicRoughnessTexture?y(l.metallicRoughnessTexture):
void 0,emissiveFactor:[l.emissiveFactor[0],l.emissiveFactor[1],l.emissiveFactor[2]],metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor}),t.materials.set(D,l));return D}function h(t){if(33071===t||33648===t||10497===t)return t;q.error(`Unexpected TextureSampler WrapMode: ${t}`)}let n=0;const q=new p.DefaultErrorContext,u=[9987,9985],v="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=async function(t,l,w={},y=!0){const D=await k.Resource.load(t,
q,l,w),z=`gltf_${n++}`,r={lods:[],materials:new Map,textures:new Map,meta:c(D)};t=!(!D.json.asset.extras||"symbolResource"!==D.json.asset.extras.ESRI_type);await d(D,async(C,A,x,m)=>{var B=void 0!==C.mode?C.mode:4;a:switch(B){case 4:case 5:case 6:var E=B;break a;default:E=null}g.isNone(E)?q.warnUnsupported("Unsupported primitive mode ("+v[B]+"). Skipping primitive."):D.hasPositions(C)?(B=await D.getMaterial(C,w,y),A={transform:b.clone(A),attributes:{position:await D.getPositionData(C,w),normal:null,
texCoord0:null,color:null,tangent:null},indices:await D.getIndexData(C,w),primitiveType:E,material:e(r,B,z)},D.hasNormals(C)&&(A.attributes.normal=await D.getNormalData(C,w)),D.hasTangents(C)&&(A.attributes.tangent=await D.getTangentData(C,w)),D.hasTextureCoordinates(C)&&(A.attributes.texCoord0=await D.getTextureCoordinates(C,w)),D.hasVertexColors(C)&&(A.attributes.color=await D.getVertexColors(C,w)),C=null,g.isSome(r.meta)&&g.isSome(r.meta.ESRI_lod)&&"screenSpaceRadius"===r.meta.ESRI_lod.metric&&
(C=r.meta.ESRI_lod.thresholds[x]),r.lods[x]=r.lods[x]||{parts:[],name:m,lodThreshold:C},r.lods[x].parts.push(A)):q.warn("Skipping primitive without POSITION vertex attribute.")});return{model:r,meta:{isEsriSymbolResource:t,uri:D.uri},customMeta:{}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Logger","../../../core/Error"],function(a,g,b){const p=g.getLogger("esri.views.3d.glTF");g=function(){function f(){}
var k=f.prototype;k.error=function(c){throw new b("gltf-loader-error",c);};k.errorUnsupported=function(c){throw new b("gltf-loader-unsupported-feature",c);};k.errorUnsupportedIf=function(c,d){c&&this.errorUnsupported(d)};k.assert=function(c,d){c||this.error(d)};k.warn=function(c){p.warn(c)};k.warnUnsupported=function(c){this.warn("[Unsupported Feature] "+c)};k.warnUnsupportedIf=function(c,d){c&&this.warnUnsupported(d)};return f}();a.DefaultErrorContext=g;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/glTF/LoaderResult":function(){define(["exports"],function(a){a.makeMaterialParameters=function(g={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...g}};a.makeTextureSource=function(g,b={}){return{data:g,
parameters:{wrap:{s:10497,t:10497,...b.wrap},noUnpackFlip:!0,mipmap:!1,...b}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/compilerUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quatf64 ../../support/buffer/BufferView ../../../../chunks/quat ./BinaryStreamReader ./fillDefaults ./pathUtils ../../../../chunks/scalar".split(" "),function(a,
g,b,p,f,k,c,d,e,h,n,q,u){function v(x){switch(x.componentType){case 5120:return new d.BufferViewVec2i8(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);case 5121:return new d.BufferViewVec2u8(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);case 5122:return new d.BufferViewVec2i16(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);case 5123:return new d.BufferViewVec2u16(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);
case 5125:return new d.BufferViewVec2u32(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);case 5126:return new d.BufferViewVec2f(x.raw,x.byteOffset,x.byteStride,x.byteOffset+x.byteStride*x.entryCount);default:g.neverReached(x.componentType)}}async function t(x){return new Promise((m,B)=>{const E=new Blob([x]),F=new FileReader;F.onload=()=>{m(JSON.parse(F.result))};F.onerror=G=>{B(G)};F.readAsText(E)})}async function l(x,m){return new Promise((B,E)=>{const F=new Blob([x],{type:m}),
G=URL.createObjectURL(F),I=new Image;I.addEventListener("load",()=>{URL.revokeObjectURL(G);"decode"in I?I.decode().then(()=>B(I),()=>B(I)):B(I)});I.addEventListener("error",K=>{URL.revokeObjectURL(G);E(K)});I.src=G})}let w=function(){function x(B,E,F,G,I){this.context=B;this.errorContext=E;this.uri=F;this.json=G;this.glbBuffer=I;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=q.splitURI(this.uri).dirPart;
this.checkVersionSupported();this.checkRequiredExtensionsSupported();E.errorUnsupportedIf(null==G.scenes,"Scenes must be defined.");E.errorUnsupportedIf(null==G.meshes,"Meshes must be defined");E.errorUnsupportedIf(null==G.nodes,"Nodes must be defined.");this.computeNodeParents()}x.load=async function(B,E,F,G){if(b.isDataProtocol(F)){var I=b.dataComponents(F);if("model/gltf-binary"!==I.mediaType)try{const K=JSON.parse(I.isBase64?atob(I.data):I.data);return new x(B,E,F,K)}catch{}I=b.dataToArrayBuffer(F);
if(x.isGLBData(I))return this.fromGLBData(B,E,F,I)}if(F.endsWith(".gltf"))return G=await B.loadJSON(F,G),new x(B,E,F,G);I=await B.loadBinary(F,G);if(x.isGLBData(I))return this.fromGLBData(B,E,F,I);G=await B.loadJSON(F,G);return new x(B,E,F,G)};x.isGLBData=function(B){B=new h.BinaryStreamReader(B);return 4<=B.remainingBytes()&&1179937895===B.readUint32()};x.fromGLBData=async function(B,E,F,G){G=await x.parseGLBData(E,G);return new x(B,E,F,G.json,G.binaryData)};x.parseGLBData=async function(B,E){const F=
new h.BinaryStreamReader(E);B.assert(12<=F.remainingBytes(),"GLB binary data is insufficiently large.");var G=F.readUint32(),I=F.readUint32();const K=F.readUint32();B.assert(1179937895===G,"Magic first 4 bytes do not fit to expected GLB value.");B.assert(E.byteLength>=K,"GLB binary data is smaller than header specifies.");B.errorUnsupportedIf(2!==I,"An unsupported GLB container version was detected. Only version 2 is supported.");E=0;let J,L;for(;8<=F.remainingBytes();)G=F.readUint32(),I=F.readUint32(),
0===E?(B.assert(1313821514===I,"First GLB chunk must be JSON."),B.assert(0<=G,"No JSON data found."),J=await t(F.readUint8Array(G))):1===E?(B.errorUnsupportedIf(5130562!==I,"Second GLB chunk expected to be BIN."),L=F.readUint8Array(G)):B.warnUnsupported("More than 2 GLB chunks detected. Skipping."),E+=1;J||B.error("No GLB JSON chunk detected.");return{json:J,binaryData:L}};var m=x.prototype;m.getBuffer=async function(B,E){const F=this.json.buffers[B],G=this.errorContext;if(null==F.uri)return G.assert(null!=
this.glbBuffer,"GLB buffer not present"),this.glbBuffer;let I=this.bufferCache.get(B);I||(E=await this.context.loadBinary(this.resolveUri(F.uri),E),I=new Uint8Array(E),this.bufferCache.set(B,I),G.assert(I.byteLength===F.byteLength,"Buffer byte lengths should match."));return I};m.getAccessor=async function(B,E){B=this.json.accessors[B];var F=this.errorContext;F.errorUnsupportedIf(null==B.bufferView,"Some accessor does not specify a bufferView.");F.errorUnsupportedIf(B.type in["MAT2","MAT3","MAT4"],
`AttributeType ${B.type} is not supported`);F=this.json.bufferViews[B.bufferView];E=await this.getBuffer(F.buffer,E);const G=r[B.type],I=C[B.componentType],K=G*I,J=F.byteStride||K;return{raw:E.buffer,byteStride:J,byteOffset:E.byteOffset+(F.byteOffset||0)+(B.byteOffset||0),entryCount:B.count,isDenselyPacked:J===K,componentCount:G,componentByteSize:I,componentType:B.componentType,min:B.min,max:B.max,normalized:!!B.normalized}};m.getIndexData=async function(B,E){if(null==B.indices)return null;B=await this.getAccessor(B.indices,
E);if(B.isDenselyPacked)switch(B.componentType){case 5121:return new Uint8Array(B.raw,B.byteOffset,B.entryCount);case 5123:return new Uint16Array(B.raw,B.byteOffset,B.entryCount);case 5125:return new Uint32Array(B.raw,B.byteOffset,B.entryCount)}else switch(B.componentType){case 5121:return u.makeDense(this.wrapAccessor(d.BufferViewUint8,B));case 5123:return u.makeDense(this.wrapAccessor(d.BufferViewUint16,B));case 5125:return u.makeDense(this.wrapAccessor(d.BufferViewUint32,B))}};m.getPositionData=
async function(B,E){const F=this.errorContext;F.errorUnsupportedIf(null==B.attributes.POSITION,"No POSITION vertex data found.");B=await this.getAccessor(B.attributes.POSITION,E);F.errorUnsupportedIf(5126!==B.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+A[B.componentType]);F.errorUnsupportedIf(3!==B.componentCount,"POSITION vertex attribute must have 3 components, but found "+B.componentCount.toFixed());return this.wrapAccessor(d.BufferViewVec3f,B)};m.getNormalData=
async function(B,E){const F=this.errorContext;F.assert(null!=B.attributes.NORMAL,"No NORMAL vertex data found.");B=await this.getAccessor(B.attributes.NORMAL,E);F.errorUnsupportedIf(5126!==B.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+A[B.componentType]);F.errorUnsupportedIf(3!==B.componentCount,"NORMAL vertex attribute must have 3 components, but found "+B.componentCount.toFixed());return this.wrapAccessor(d.BufferViewVec3f,B)};m.getTangentData=async function(B,E){const F=
this.errorContext;F.assert(null!=B.attributes.TANGENT,"No TANGENT vertex data found.");B=await this.getAccessor(B.attributes.TANGENT,E);F.errorUnsupportedIf(5126!==B.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+A[B.componentType]);F.errorUnsupportedIf(4!==B.componentCount,"TANGENT vertex attribute must have 4 components, but found "+B.componentCount.toFixed());return new d.BufferViewVec4f(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount)};m.getTextureCoordinates=
async function(B,E){const F=this.errorContext;F.assert(null!=B.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");B=await this.getAccessor(B.attributes.TEXCOORD_0,E);F.errorUnsupportedIf(2!==B.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+B.componentCount.toFixed());if(5126===B.componentType)return this.wrapAccessor(d.BufferViewVec2f,B);F.errorUnsupportedIf(!B.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");
return v(B)};m.getVertexColors=async function(B,E){const F=this.errorContext;F.assert(null!=B.attributes.COLOR_0,"No COLOR_0 vertex data found.");B=await this.getAccessor(B.attributes.COLOR_0,E);F.errorUnsupportedIf(4!==B.componentCount&&3!==B.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+B.componentCount.toFixed());if(4===B.componentCount){if(5126===B.componentType)return this.wrapAccessor(d.BufferViewVec4f,B);if(5121===B.componentType)return this.wrapAccessor(d.BufferViewVec4u8,
B);if(5123===B.componentType)return this.wrapAccessor(d.BufferViewVec4u16,B)}else if(3===B.componentCount){if(5126===B.componentType)return this.wrapAccessor(d.BufferViewVec3f,B);if(5121===B.componentType)return this.wrapAccessor(d.BufferViewVec3u8,B);if(5123===B.componentType)return this.wrapAccessor(d.BufferViewVec3u16,B)}F.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+A[B.componentType])};m.hasPositions=function(B){return void 0!==B.attributes.POSITION};m.hasNormals=function(B){return void 0!==
B.attributes.NORMAL};m.hasVertexColors=function(B){return void 0!==B.attributes.COLOR_0};m.hasTextureCoordinates=function(B){return void 0!==B.attributes.TEXCOORD_0};m.hasTangents=function(B){return void 0!==B.attributes.TANGENT};m.getMaterial=async function(B,E,F){const G=this.errorContext;var I=this.materialCache.get(B.material);if(!I){I=null!=B.material?n.material(this.json.materials[B.material]):n.material();const K=I.pbrMetallicRoughness,J=this.hasVertexColors(B);let L;K.baseColorTexture&&(G.errorUnsupportedIf(0!==
(K.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),L=await this.getTexture(K.baseColorTexture.index,E));let P;I.normalTexture&&(0!==(I.normalTexture.texCoord||0)?G.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."):P=await this.getTexture(I.normalTexture.index,E));let Q;I.occlusionTexture&&F&&(0!==(I.occlusionTexture.texCoord||0)?G.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."):Q=await this.getTexture(I.occlusionTexture.index,
E));let X;I.emissiveTexture&&F&&(0!==(I.emissiveTexture.texCoord||0)?G.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."):X=await this.getTexture(I.emissiveTexture.index,E));let aa;K.metallicRoughnessTexture&&F&&(0!==(K.metallicRoughnessTexture.texCoord||0)?G.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."):aa=await this.getTexture(K.metallicRoughnessTexture.index,E));I={alphaMode:I.alphaMode,alphaCutoff:I.alphaCutoff,
color:K.baseColorFactor,doubleSided:!!I.doubleSided,colorTexture:L,normalTexture:P,name:I.name,id:null!=B.material?B.material:-1,occlusionTexture:Q,emissiveTexture:X,emissiveFactor:I.emissiveFactor,metallicFactor:K.metallicFactor,roughnessFactor:K.roughnessFactor,metallicRoughnessTexture:aa,vertexColors:J,ESRI_externalColorMixMode:I.extras.ESRI_externalColorMixMode}}return I};m.getTexture=async function(B,E){var F=this.errorContext,G=this.json.textures[B];const I=n.textureSampler(null!=G.sampler?
this.json.samplers[G.sampler]:{});F.errorUnsupportedIf(null==G.source,"Source is expected to be defined for a texture.");G=this.json.images[G.source];var K=this.textureCache.get(B);K||(G.uri?F=await this.context.loadImage(this.resolveUri(G.uri),E):(F.errorUnsupportedIf(null==G.bufferView,"Image bufferView must be defined."),F.errorUnsupportedIf(null==G.mimeType,"Image mimeType must be defined."),K=this.json.bufferViews[G.bufferView],E=await this.getBuffer(K.buffer,E),F.errorUnsupportedIf(null!=K.byteStride,
"byteStride not supported for image buffer"),F=await l(new Uint8Array(E.buffer,E.byteOffset+(K.byteOffset||0),K.byteLength),G.mimeType)),K={data:F,wrapS:I.wrapS,wrapT:I.wrapT,minFilter:I.minFilter,name:G.name,id:B},this.textureCache.set(B,K));return K};m.getNodeTransform=function(B){if(void 0===B)return D;var E=this.nodeTransformCache.get(B);if(!E){E=this.getNodeTransform(this.getNodeParent(B));const F=this.json.nodes[B];if(F.matrix)E=f.multiply(k.create(),E,F.matrix);else if(F.translation||F.rotation||
F.scale)E=k.clone(E),F.translation&&f.translate(E,E,F.translation),F.rotation&&(z[3]=e.getAxisAngle(z,F.rotation),f.rotate(E,E,z[3],z)),F.scale&&f.scale(E,E,F.scale);this.nodeTransformCache.set(B,E)}return E};m.wrapAccessor=function(B,E){return new B(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*(E.entryCount-1)+E.componentByteSize*E.componentCount)};m.resolveUri=function(B){return b.makeAbsolute(B,this.baseUri)};m.getNodeParent=function(B){return this.nodeParentMap.get(B)};m.checkVersionSupported=
function(){const B=p.Version.parse(this.json.asset.version,"glTF");y.validate(B)};m.checkRequiredExtensionsSupported=function(){const B=this.json,E=this.errorContext;B.extensionsRequired&&0!==B.extensionsRequired.length&&E.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+B.extensionsRequired.join(", "))};m.computeNodeParents=function(){this.json.nodes.forEach((B,E)=>{B.children&&B.children.forEach(F=>{this.nodeParentMap.set(F,E)})})};return x}();const y=
new p.Version(2,0,"glTF"),D=f.fromXRotation(k.create(),Math.PI/2),z=c.create(),r={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},C={[5120]:1,[5121]:1,[5122]:2,[5123]:2,[5126]:4,[5125]:4},A={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,g){let b=function(){function p(k,c,d=""){this.major=k;this.minor=c;this._context=d}var f=
p.prototype;f.lessThan=function(k,c){return this.major<k||k===this.major&&this.minor<c};f.since=function(k,c){return!this.lessThan(k,c)};f.validate=function(k){if(this.major!==k.major)throw new g((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:k});};f.clone=function(){return new p(this.major,this.minor,this._context)};p.parse=function(k,c=""){const [d,e]=
k.split(".");var h=/^\s*\d+\s*$/;if(!d||!d.match||!d.match(h))throw new g((c&&c+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:k});if(!e||!e.match||!e.match(h))throw new g((c&&c+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:k});k=parseInt(d,10);h=parseInt(e,10);return new p(k,h,c)};return p}();a.Version=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],
function(a){let g=function(){function b(f){this.data=f;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var p=b.prototype;p.readUint32=function(){const f=this.offset4;this.offset4+=1;return this.dataUint32[f]};p.readUint8Array=function(f){const k=4*this.offset4;this.offset4+=f/4;return new Uint8Array(this.data,k,f)};p.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return b}();a.BinaryStreamReader=g;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils"],function(a,g){const b={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},p={pbrMetallicRoughness:b,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},f={ESRI_externalColorMixMode:"tint"},k={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};a.material=(c={})=>{const d={...b,...c.pbrMetallicRoughness};var e={...f,...c.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:g.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...p,...c,pbrMetallicRoughness:d,extras:e}};a.textureSampler=c=>({...k,...c});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(g){let b,p;g.replace(/^(.*\/)?([^/]*)$/,(f,k,c)=>{b=k||"";p=c||"";return""});return{dirPart:b,filePart:p}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports",
"../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,g,b){a.triangleFanToTriangles=function(p){var f="number"===typeof p?p:p.length;if(3>f)return new Uint16Array(0);f-=2;const k=65536>=f?new Uint16Array(3*f):new Uint32Array(3*f);if("number"===typeof p){p=0;for(var c=0;c<f;++c)k[p++]=0,k[p++]=c+1,k[p++]=c+2;return k}{c=p[0];let d=p[1],e=0;for(let h=0;h<f;++h){const n=p[h+2];k[e++]=c;k[e++]=d;d=k[e++]=n}return k}};a.triangleStripToTriangles=function(p){var f="number"===
typeof p?p:p.length;if(3>f)return new Uint16Array(0);f-=2;const k=65536>=f?new Uint16Array(3*f):new Uint32Array(3*f);if("number"===typeof p){p=0;for(var c=0;c<f;c+=1)0===c%2?(k[p++]=c,k[p++]=c+1):(k[p++]=c+1,k[p++]=c),k[p++]=c+2}else{c=0;for(let n=0;n<f;n+=1)if(0===n%2){var d=p[n],e=p[n+1],h=p[n+2];k[c++]=d;k[c++]=e;k[c++]=h}else d=p[n+1],e=p[n],h=p[n+2],k[c++]=d,k[c++]=e,k[c++]=h}return k};a.trianglesToTriangles=function(p){return"number"===typeof p?b.generateDefaultIndexArray(p):g.isUint16Array(p)||
g.isUint8Array(p)?new Uint32Array(p):p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../core/maybe ../../../../core/Logger ../../../../core/Error ../../../../core/promiseUtils ../../../../request ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){async function t(A,x){const m=g.isSome(x)&&x.streamDataRequester;if(m)return l(A,m,x);A=await c.result(k(A,g.unwrap(x)));if(!0===A.ok)return A.value.data;f.throwIfAbortError(A.error);w(A.error)}async function l(A,x,m){A=await c.result(x.request(A,"json",m));if(!0===A.ok)return A.value;f.throwIfAbortError(A.error);w(A.error.details.url)}function w(A){throw new p("",`Request for object resource failed: ${A}`);}function y(A){const x=h.empty();A.forEach(m=>{m=m.boundingInfo;
g.isSome(m)&&(h.expandWithVec3(x,m.getBBMin()),h.expandWithVec3(x,m.getBBMax()))});return x}async function D(A,x){const m=[];for(const E in A){const F=A[E];var B=F.images[0].data;if(!B){r.warn("Externally referenced texture data is not yet supported");continue}B=F.encoding+";base64,"+B;const G="/textureDefinitions/"+E,I={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};B=g.isSome(x)&&x.disableTextures?Promise.resolve(null):n.requestImage(B,x);m.push(B.then(K=>({refId:G,image:K,params:I,
alphaChannelUsage:"rgba"===F.channels?F.alphaChannelUsage||"transparency":"none"})))}A=await Promise.all(m);x={};for(const E of A)x[E.refId]=E;return x}function z(A){switch(A){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}const r=b.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),C=new e.Version(1,2,"wosr");a.createTextureResources=D;a.load=async function(A,x){A=await t(A,x);x=await D(A.textureDefinitions,
x);return{resource:A,textures:x}};a.processLoadResult=function(A,x){const m=[],B=[],E=[],F=[],G=A.resource;var I=e.Version.parse(G.version||"1.0","wosr");C.validate(I);I=G.model.name;const K=G.model.geometries,J=G.materialDefinitions;A=A.textures;let L=0;const P=new Map;for(let W=0;W<K.length;W++){var Q=K[W],X=Q,aa=X.params,S=aa.topology;var H=!0;aa.vertexAttributes||(r.warn("Geometry must specify vertex attributes"),H=!1);switch(aa.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:S=
aa.faces;if(!S)r.warn("Indexed geometries must specify faces"),H=!1;else if(aa.vertexAttributes)for(const Y in aa.vertexAttributes)(aa=S[Y])&&aa.values?(null!=aa.valueType&&"UInt32"!==aa.valueType&&(r.warn(`Unsupported indexed geometry indices type '${aa.valueType}', only UInt32 is currently supported`),H=!1),null!=aa.valuesPerElement&&1!==aa.valuesPerElement&&(r.warn(`Unsupported indexed geometry values per element '${aa.valuesPerElement}', only 1 is currently supported`),H=!1)):(r.warn(`Indexed geometry does not specify face indices for '${Y}' attribute`),
H=!1);break;default:r.warn(`Unsupported topology '${S}'`),H=!1}X.params.material||(r.warn("Geometry requires material"),H=!1);X=X.params.vertexAttributes;for(const Y in X)X[Y].values||(r.warn("Geometries with externally defined attributes are not yet supported"),H=!1);if(H){H=Q.params;H={id:1,material:H.material,texture:H.texture,region:H.texture};aa=Q.params.vertexAttributes;X=[];for(const Y in aa)S=aa[Y],X.push([Y,{data:S.values,size:S.valuesPerElement,exclusive:!0}]);aa=[];if("PerAttributeArray"!==
Q.params.topology){Q=Q.params.faces;for(const Y in Q)aa.push([Y,new Uint32Array(Q[Y].values)])}if((Q=A&&A[H.texture])&&!P.has(H.texture)){const {image:Y,params:U}=Q;S=new v.Texture(Y,U);F.push(S);P.set(H.texture,S)}S=(S=P.get(H.texture))?S.id:void 0;var R=E[H.material]?E[H.material][H.texture]:null;if(!R){R=H.material.substring(H.material.lastIndexOf("/")+1);R=J[R].params;1===R.transparency&&(R.transparency=0);var T=Q&&Q.alphaChannelUsage;T=0<R.transparency||"transparency"===T||"maskAndTransparency"===
T;Q={ambient:d.fromArray(R.diffuse),diffuse:d.fromArray(R.diffuse),opacity:1-(R.transparency||0),transparent:T,textureAlphaMode:Q?z(Q.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:S,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:R.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};g.isSome(x)&&x.materialParamsMixin&&Object.assign(Q,x.materialParamsMixin);R=new u.DefaultMaterial(Q);E[H.material]||(E[H.material]={});E[H.material][H.texture]=R}B.push(R);H=new q.Geometry(X,
aa);L+=aa.position?aa.position.length:0;m.push(H)}}return{name:I,stageResources:{textures:F,materials:B,geometries:m},pivotOffset:G.model.pivotOffset,boundingBox:y(m),numberOfVertices:L,lodThreshold:null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports","../views/3d/support/buffer/math/common"],function(a,g){function b(d,e,h){if(d.count!==e.count)g.logger.error("source and destination buffers need to have the same number of elements");else{var n=
d.count,q=h[0],u=h[1],v=h[2],t=h[3],l=h[4],w=h[5],y=h[6],D=h[7],z=h[8],r=h[9],C=h[10],A=h[11],x=h[12],m=h[13],B=h[14];h=h[15];var E=d.typedBuffer;d=d.typedBufferStride;var F=e.typedBuffer;e=e.typedBufferStride;for(let I=0;I<n;I++){const K=I*d;var G=I*e;const J=F[G],L=F[G+1],P=F[G+2];G=F[G+3];E[K]=q*J+l*L+z*P+x*G;E[K+1]=u*J+w*L+r*P+m*G;E[K+2]=v*J+y*L+C*P+B*G;E[K+3]=t*J+D*L+A*P+h*G}}}function p(d,e,h){if(d.count!==e.count)g.logger.error("source and destination buffers need to have the same number of elements");
else{var n=d.count,q=h[0],u=h[1],v=h[2],t=h[3],l=h[4],w=h[5],y=h[6],D=h[7];h=h[8];var z=d.typedBuffer;d=d.typedBufferStride;var r=e.typedBuffer;e=e.typedBufferStride;for(let A=0;A<n;A++){const x=A*d;var C=A*e;const m=r[C],B=r[C+1],E=r[C+2];C=r[C+3];z[x]=q*m+t*B+y*E;z[x+1]=u*m+l*B+D*E;z[x+2]=v*m+w*B+h*E;z[x+3]=C}}}function f(d,e,h){const n=Math.min(d.count,e.count),q=d.typedBuffer;d=d.typedBufferStride;const u=e.typedBuffer;e=e.typedBufferStride;for(let v=0;v<n;v++){const t=v*d,l=v*e;q[t]=h*u[l];q[t+
1]=h*u[l+1];q[t+2]=h*u[l+2];q[t+3]=h*u[l+3]}}function k(d,e,h){const n=Math.min(d.count,e.count),q=d.typedBuffer;d=d.typedBufferStride;const u=e.typedBuffer;e=e.typedBufferStride;for(let v=0;v<n;v++){const t=v*d,l=v*e;q[t]=u[l]>>h;q[t+1]=u[l+1]>>h;q[t+2]=u[l+2]>>h;q[t+3]=u[l+3]>>h}}var c=Object.freeze({__proto__:null,transformMat4:b,transformMat3:p,scale:f,shiftRight:k});a.scale=f;a.shiftRight=k;a.transformMat3=p;a.transformMat4=b;a.vec4=c})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../geometry/support/aaBoundingBox ../DefaultVertexAttributeLocations ../../../support/buffer/glUtil ../Util ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject ../../materials/renderers/utils ../intersectorUtils ../Camera ../../../support/debugFlags ../../materials/internal/MaterialUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../../materials/DefaultMaterial ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){function E(H,R,T){const W=H.allocateHead();H=H.view;l.encodeDoubleVec3(R.modelOrigin,T,H.modelOriginHi,H.modelOriginLo,W);H.model.copyFrom(W,R.model,T);H.modelNormal.copyFrom(W,R.modelNormal,T);R.color&&H.color&&H.color.copyFrom(W,R.color,T);R.featureAttribute&&H.featureAttribute&&H.featureAttribute.copyFrom(W,R.featureAttribute,T)}let F=function(H){const R=H.baseBoundingSphere.radius;H=H.levels.map(T=>T.minScreenSpaceRadius);return new m.LevelSelector(R,
H)},G=function(){function H(T,W){const Y=T.renderContext.rctx,U=W.geometry;W=W.material;this.materialRep=T.materialRep;W.setParameterValues({instancedDoublePrecision:!0});T=W.createBufferWriter();const N=T.vertexBufferLayout,ca=T.elementCount(U),O=T.allocate(ca);T.write({},U,O,0);this.geometry=U;this.material=W;this.glMaterials=l.acquireMaterials(W,this.materialRep);this.vertexBufferLayout=N;this.vbo=u.createVertex(Y,35044,O.buffer);this.vao=new t(Y,h.Default3D,{geometry:n.glLayout(N)},{geometry:this.vbo});
this.vertexCount=ca}var R=H.prototype;R.destroy=function(){l.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};R.intersect=function(T,W,Y,U,N,ca){const O=this.geometry.id,V=N.toString();this.material.intersect(this.geometry,null,T.transform.transform,T,Y,U,(ba,fa,ia,ma)=>{if(0<=ba&&(null==W||W(T.rayBeginPoint,T.rayEndPoint,ba))){var ea={type:"external",metadata:{layerUid:ca.layerUid,graphicUid:ca.graphicUid(N)}};if(null==T.results.min.drapedLayerOrder||ma>=T.results.min.drapedLayerOrder)if(null==
T.results.min.dist||ba<T.results.min.dist)T.results.min.set(ea,V,ba,fa,T.transform.transform,ma,null,O,ia),T.results.min.intersector="LodRenderer";0!==T.options.store&&(null==T.results.max.drapedLayerOrder||ma>=T.results.max.drapedLayerOrder)&&(null==T.results.max.dist||ba>T.results.max.dist)&&(T.results.max.set(ea,V,ba,fa,T.transform.transform,ma,null,O,ia),T.results.min.intersector="LodRenderer");if(2===T.options.store){const M=new w.IntersectorResult(T.results.min.ray);M.set(ea,V,ba,fa,T.transform.transform,
ma,null,O,ia);M.intersector="LodRenderer";T.results.all.push(M)}}})};g._createClass(H,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return H}(),I=function(){function H(T,W){this.components=[];this.minScreenSpaceRadius=W.minScreenSpaceRadius;W.components.forEach(Y=>{this.components.push(new G(T,Y))})}var R=H.prototype;R.destroy=function(){this.components.forEach(T=>{T.destroy()})};R.intersect=function(T,W,Y,
U,N,ca){this.components.forEach(O=>{O.intersect(T,W,Y,U,N,ca)})};g._createClass(H,[{key:"boundingBox",get:function(){if(!this._boundingBox){const T=e.empty();this.components.forEach(W=>{b.isSome(W.boundingInfo)&&(e.expandWithVec3(T,W.boundingInfo.bbMin),e.expandWithVec3(T,W.boundingInfo.bbMax))});this._boundingBox=T}return this._boundingBox}},{key:"boundingSphere",get:function(){if(!this._boundingSphere){const T=this.boundingBox,W=p.create();e.center(T,W);this._boundingSphere={center:W,radius:.5*
e.diameter(T)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((T,W)=>T+W.triangleCount,0)}}]);return H}(),K=function(){function H(T,W,Y,U){this.type="Lod";this.isGround=!1;this._inverseViewport=c.create();this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new y;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=
!0;this._symbol=T;this._optionalFields=W;this._metadata=Y;this._instanceBufferLayout=C.DefaultMaterial.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:W});this._glInstanceBufferLayout=n.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new A.InstanceData(this._optionalFields,U);this._instanceData.on("instance-added",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-removed",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",
N=>{this.requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(N.index)});this._instanceData.on("instance-visibility-changed",N=>{this.requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(N.index)});this._instanceData.on("instance-highlight-changed",()=>{this.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;J.push(this)}var R=H.prototype;R.destroy=function(){J.splice(J.indexOf(this),1)};R.initializeRenderContext=function(T){this._context=
T;const W=T.renderContext.rctx;this._symbol.levels.forEach(Y=>{this._levels.push(new I(T,Y));this._defaultRenderInstanceData.push(new B.RenderInstanceData(W,this._instanceBufferLayout));this._highlightRenderInstanceData.push(new B.RenderInstanceData(W,this._instanceBufferLayout))});this._levelSelector=F(this)};R.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(T=>{T.destroy()});this._defaultRenderInstanceData.forEach(T=>{T.destroy()});this._highlightRenderInstanceData.forEach(T=>
{T.destroy()})};R.prepareRender=function(T){this.runUpdates(T)};R.render=function(T){var W=T.rctx;const Y=4===T.slot?3:6===T.slot?5:null;if(Y){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(T.pass))return!1;var U=T.camera;this._inverseViewport[0]=1/U.fullViewport[2];this._inverseViewport[1]=1/U.fullViewport[3];U={slot:Y,origin:[0,0,0],camera:U,inverseViewport:this._inverseViewport,shadowMap:T.shadowMap,shadowMappingEnabled:!!T.shadowMap&&T.shadowMap.enabled,ssaoEnabled:!!T.ssaoHelper&&
T.ssaoHelper.enabled,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:T.sliceHelper&&T.sliceHelper.plane,hudVisibilityTexture:T.offscreenRenderingHelper?T.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:T.offscreenRenderingHelper?T.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureUnit:0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,ssrEnabled:!1,lighting:T.scenelightingData,
transparencyPassType:T.transparencyPassType,terrainLinearDepthTexture:T.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:T.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:T.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:T.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:T.multipassGeometryParams.multipassGeometryEnabled};W.bindVAO();W=6!==T.pass;5!==T.pass&&7!==T.pass&&this.renderComponents(T,Y,U,this._defaultRenderInstanceData);
W&&this.renderComponents(T,Y,U,this._highlightRenderInstanceData);return!0}};R.intersect=function(T,W,Y,U){if(this.baseMaterial.isVisible()){var N=p.create();f.subtract(N,U,Y);var ca=O=>{this._instanceData.getCombinedModelTransform(O,Q);T.transform.set(Q);f.transformMat4(X,Y,T.transform.inverse);f.transformMat4(aa,U,T.transform.inverse);const V=this._instanceData.getState(O),ba=this._instanceData.getLodLevel(O);q.assert(V&A.StateFlags.ACTIVE,"invalid instance state");q.assert(0<=ba&&ba<this._levels.length,
"invaid lod level");this._levels[ba].intersect(T,W,X,aa,O,this._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(ca):this.octree.forEachAlongRay(Y,N,ca)}};R.queryDepthRange=function(T){return this.queryDepthRangeOctree(T)};R.notifyShaderTransformationChanged=function(){this.invalidateOctree()};R.requestUpdateCycle=function(T=!1){this._updateCyclesWithStaticCamera=-1;T&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};R.runUpdates=function(T){if(!D.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var W=
T.equals(this._lastCamera);this._lastCamera.copyFrom(T);W||this.requestUpdateCycle()}W=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(T,W);this.needsUpdates&&this._context.requestRender()}};R.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};R.buildOctree=function(){const T=new x.InstanceOctree(this._instanceData,this.baseBoundingSphere);var W=this._instanceData;W=W.view?W.view.state:null;for(let Y=0;Y<this._instanceData.capacity;++Y)W.get(Y)&
A.StateFlags.ACTIVE&&T.addInstance(Y);return T};R.queryDepthRangeOctree=function(T){var W=T.eye;const Y=T.viewForward;var U=this.octree.findClosest(Y,"front-to-back",T.frustum);const N=this.octree.findClosest(Y,"back-to-front",T.frustum);return null!=U&&null!=N?(this._instanceData.view.boundingSphere.getVec(U,P),f.subtract(P,P,W),U=f.dot(P,Y)-P[3],this._instanceData.view.boundingSphere.getVec(N,P),f.subtract(P,P,W),W=f.dot(P,Y)+P[3],{near:Math.max(T.near,U),far:Math.min(T.far,W)}):{near:Infinity,
far:-Infinity}};R.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(T=>{T.startUpdateCylce()});this._highlightRenderInstanceData.forEach(T=>{T.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};R.updateInstances=function(T,W){const Y=this._enableLevelSelection,U=this._levelSelector;U.updateCamera(T);this._defaultRenderInstanceData.forEach(fa=>{fa.beginUpdate()});this._highlightRenderInstanceData.forEach(fa=>{fa.beginUpdate()});
T=this._instanceData;const N=this._instanceData.view,ca=T.capacity;let O=this._instanceIndex;W=Math.min(T.size,W);for(let fa=0;fa<W;++fa){0===O&&this.startUpdateCycle();const ia=N.state.get(O);var V=0;if(ia&A.StateFlags.ALLOCATED){var ba=N.lodLevel.get(O);ia&A.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[ba].freeTail();ia&A.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[ba].freeTail();ia&A.StateFlags.REMOVE?T.freeInstance(O):ia&A.StateFlags.VISIBLE?(ba=0,Y&&(N.modelOrigin.getVec(O,
L),ba=U.selectLevel(L,T.getCombinedMedianScaleFactor(O))),V=ia&~(A.StateFlags.ACTIVE|A.StateFlags.TRANSFORM_CHANGED),0<=ba&&(ia&A.StateFlags.HIGHLIGHT?(E(this._highlightRenderInstanceData[ba],N,O),V|=A.StateFlags.HIGHLIGHT_ACTIVE):(E(this._defaultRenderInstanceData[ba],N,O),V|=A.StateFlags.DEFAULT_ACTIVE)),N.state.set(O,V),N.lodLevel.set(O,ba)):(V=ia&~(A.StateFlags.ACTIVE|A.StateFlags.TRANSFORM_CHANGED),N.state.set(O,V));this._octree&&(ba=!!(ia&A.StateFlags.ACTIVE),V=!!(V&A.StateFlags.ACTIVE),!ba&&
V?this._octree.addInstance(O):ba&&!V?this._octree.removeInstance(O):ba&&V&&ia&A.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(O),this._octree.addInstance(O)));O=(O+1)%ca}else O=(O+1)%ca,W++}this._instanceIndex=O;this._defaultRenderInstanceData.forEach(fa=>{fa.endUpdate()});this._highlightRenderInstanceData.forEach(fa=>{fa.endUpdate()})};R.renderComponents=function(T,W,Y,U){this.levels.forEach((N,ca)=>{N.components.forEach(O=>{this.renderComponent(T,W,Y,U[ca],O,ca)})})};R.renderComponent=
function(T,W,Y,U,N,ca){var O=N.glMaterials.get(T.pass);if(O&&O.beginSlot(W)&&0!==U.size){var V=T.rctx,ba=V.capabilities.instancing;O.ensureParameters(Y);var fa=O.getTechnique();W=O.getPipelineState(W);V.setPipelineState(W);O.bind(V,Y);V.bindVAO(N.vao);fa.ensureAttributeLocations(N.vao);O=fa.program;T.isHighlightPass&&r.OutputHighlight.bindOutputHighlight(V,O,Y);fa.bindDraw(Y);D.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===T.pass&&(O.setUniform4fv("externalColor",S[Math.min(ca,S.length-1)]),O.setUniform1i("colorMixMode",
z.colorMixModes.replace));T=U.capacity;Y=U.headIndex;ca=U.tailIndex;O=U.firstIndex;var ia=this._glInstanceBufferLayout;W=(ma,ea)=>{v.bindVertexBufferLayout(V,h.Default3D,U.buffer,ia,ma);ba.drawArraysInstanced(fa.primitiveType,0,N.vertexCount,ea-ma);v.unbindVertexBufferLayout(V,h.Default3D,U.buffer,ia)};N.material.params.transparent&&null!=O?Y>ca?(q.assert(O>=ca&&O<=Y,"invalid firstIndex"),W(O,Y),W(ca,O)):Y<ca&&(O<=Y?(q.assert(0<=O&&O<=Y,"invalid firstIndex"),W(O,Y),W(ca,T),W(0,O)):(q.assert(O>=ca&&
O<=T,"invalid firstIndex"),W(O,T),W(0,Y),W(ca,O))):Y>ca?W(ca,Y):Y<ca&&(W(0,Y),W(ca,T));V.bindVAO(null)}};g._createClass(H,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlane",get:function(){return this._slicePlane},
set:function(T){this._slicePlane=T}},{key:"intersectionHandlerId",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const T={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(W=>{W=W.memoryUsage;T.cpu+=W.cpu;T.gpu+=W.gpu});this._highlightRenderInstanceData.forEach(W=>{W=W.memoryUsage;T.cpu+=W.cpu;T.gpu+=W.gpu});return T}},{key:"renderStats",get:function(){const T=this._instanceData.size,W=[];this._levels.forEach((Y,
U)=>{U=this._defaultRenderInstanceData[U].size+this._highlightRenderInstanceData[U].size;Y=Y.triangleCount;W.push({renderedInstances:U,renderedTriangles:U*Y,trianglesPerInstance:Y})});return{totalInstances:T,renderedInstances:W.reduce((Y,U)=>Y+U.renderedInstances,0),renderedTriangles:W.reduce((Y,U)=>Y+U.renderedTriangles,0),levels:W}}},{key:"slots",get:function(){return[4,6]}},{key:"needsHighlight",get:function(){return 0<this._highlightRenderInstanceData.reduce((T,W)=>T+W.size,0)}},{key:"needsUpdates",
get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this.buildOctree());return this._octree}}]);return H}();const J=[],L=p.create(),P=d.create(),Q=k.create(),X=p.create(),aa=p.create(),S=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];a.LodComponentData=G;a.LodLevelData=I;a.LodRenderer=K;a.lodRenderers=J;a.setLevelSelectorFactory=function(H){F=H};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../chunks/mat4 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/mat3 ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){(function(D){D[D.ALLOCATED=1]="ALLOCATED";D[D.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";D[D.VISIBLE=4]="VISIBLE";D[D.HIGHLIGHT=8]="HIGHLIGHT";D[D.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";D[D.REMOVE=32]="REMOVE";D[D.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";D[D.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let v=function(D){this.localTransform=D.getField("localTransform",n.BufferViewMat4f64);this.globalTransform=D.getField("globalTransform",n.BufferViewMat4f64);
this.modelOrigin=D.getField("modelOrigin",n.BufferViewVec3f64);this.model=D.getField("model",n.BufferViewMat3f);this.modelNormal=D.getField("modelNormal",n.BufferViewMat3f);this.modelScaleFactors=D.getField("modelScaleFactors",n.BufferViewVec2f);this.boundingSphere=D.getField("boundingSphere",n.BufferViewVec4f64);this.color=D.getField("color",n.BufferViewVec4f);this.featureAttribute=D.getField("featureAttribute",n.BufferViewVec4f);this.state=D.getField("state",n.BufferViewUint8);this.lodLevel=D.getField("lodLevel",
n.BufferViewUint8)};b=function(D){function z(C,A){var x=D.call(this)||this;x._capacity=0;x._size=0;x._next=0;{let m=q.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=C.indexOf("color")&&(m=m.vec4f("color"));0<=C.indexOf("featureAttribute")&&(m=m.vec4f("featureAttribute"));C=m=m.u8("state").u8("lodLevel").alignTo(8)}x._layout=C;x._shaderTransformation=A;return x}g._inheritsLoose(z,
D);var r=z.prototype;r.addInstance=function(){this._size+1>this._capacity&&this.grow();const C=this.findSlot();this._view.state.set(C,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:C});return C};r.removeInstance=function(C){const A=this._view.state;u.assert(0<=C&&C<this._capacity&&A.get(C)&a.StateFlags.ALLOCATED,"invalid instance handle");this.getStateFlag(C,a.StateFlags.ACTIVE)?this.setStateFlags(C,a.StateFlags.REMOVE):this.freeInstance(C);this.emit("instance-removed",{index:C})};
r.freeInstance=function(C){const A=this._view.state;u.assert(0<=C&&C<this._capacity&&A.get(C)&a.StateFlags.ALLOCATED,"invalid instance handle");A.set(C,0);this._size--};r.setLocalTransform=function(C,A,x=!0){this._view.localTransform.setMat(C,A);x&&this.updateModelTransform(C)};r.getLocalTransform=function(C,A){this._view.localTransform.getMat(C,A)};r.setGlobalTransform=function(C,A,x=!0){this._view.globalTransform.setMat(C,A);x&&this.updateModelTransform(C)};r.getGlobalTransform=function(C,A){this._view.globalTransform.getMat(C,
A)};r.updateModelTransform=function(C){const A=this._view;var x=t;const m=l;A.localTransform.getMat(C,w);A.globalTransform.getMat(C,y);const B=c.multiply(y,y,w);f.set(x,B[12],B[13],B[14]);A.modelOrigin.setVec(C,x);h.fromMat4(m,B);A.model.setMat(C,m);x=k.scaleFromMatrix(t,B);x.sort();A.modelScaleFactors.set(C,0,x[1]);A.modelScaleFactors.set(C,1,x[2]);h.invert(m,m);h.transpose(m,m);A.modelNormal.setMat(C,m);this.setStateFlags(C,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:C})};r.getModelTransform=function(C,A){const x=this._view;x.model.getMat(C,l);x.modelOrigin.getVec(C,t);A[0]=l[0];A[1]=l[1];A[2]=l[2];A[3]=0;A[4]=l[3];A[5]=l[4];A[6]=l[5];A[7]=0;A[8]=l[6];A[9]=l[7];A[10]=l[8];A[11]=0;A[12]=t[0];A[13]=t[1];A[14]=t[2];A[15]=1};r.applyShaderTransformation=function(C,A){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,C,A)};r.getCombinedModelTransform=function(C,A){this.getModelTransform(C,A);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,
C,A);return A};r.getCombinedLocalTransform=function(C,A){this._view.localTransform.getMat(C,A);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,C,A);return A};r.getCombinedMaxScaleFactor=function(C){let A=this._view.modelScaleFactors.get(C,1);this._shaderTransformation&&(C=this._shaderTransformation.scaleFactor(t,this,C),A*=Math.max(C[0],C[1],C[2]));return A};r.getCombinedMedianScaleFactor=function(C){let A=this._view.modelScaleFactors.get(C,0);this._shaderTransformation&&
(C=this._shaderTransformation.scaleFactor(t,this,C),C.sort(),A*=C[1]);return A};r.getModel=function(C,A){this._view.model.getMat(C,A)};r.setFeatureAttribute=function(C,A){this._view.featureAttribute.setVec(C,A)};r.getFeatureAttribute=function(C,A){this._view.featureAttribute.getVec(C,A)};r.setColor=function(C,A){this._view.color.setVec(C,A)};r.getColor=function(C,A){this._view.color.getVec(C,A)};r.setVisible=function(C,A){A!==this.getVisible(C)&&(this.setStateFlag(C,a.StateFlags.VISIBLE,A),this.emit("instance-visibility-changed",
{index:C}))};r.getVisible=function(C){return this.getStateFlag(C,a.StateFlags.VISIBLE)};r.setHighlight=function(C,A){A!==this.getHighlight(C)&&(this.setStateFlag(C,a.StateFlags.HIGHLIGHT,A),this.emit("instance-highlight-changed",{index:C}))};r.getHighlight=function(C){return this.getStateFlag(C,a.StateFlags.HIGHLIGHT)};r.getState=function(C){return this._view.state.get(C)};r.getLodLevel=function(C){return this._view.lodLevel.get(C)};r.countFlags=function(C){let A=0;for(let x=0;x<this._capacity;++x)this.getState(x)&
C&&++A;return A};r.setStateFlags=function(C,A){const x=this._view.state;A|=x.get(C);x.set(C,A)};r.clearStateFlags=function(C,A){const x=this._view.state;A=x.get(C)&~A;x.set(C,A)};r.setStateFlag=function(C,A,x){x?this.setStateFlags(C,A):this.clearStateFlags(C,A)};r.getStateFlag=function(C,A){return!!(this._view.state.get(C)&A)};r.grow=function(){const C=Math.max(1024,Math.floor(2*this._capacity)),A=this._layout.createBuffer(C);if(this._buffer){const x=new Uint8Array(this._buffer.buffer);(new Uint8Array(A.buffer)).set(x)}this._capacity=
C;this._buffer=A;this._view=new v(this._buffer)};r.findSlot=function(){const C=this._view.state;let A=this._next;for(;C.get(A)&a.StateFlags.ALLOCATED;)A=(A+1)%this._capacity;this._next=(A+1)%this._capacity;return A};g._createClass(z,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return z}(b);const t=p.create(),l=d.create(),w=e.create(),
y=e.create();a.InstanceData=b;a.InstanceDataView=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../chunks/mat4f64 ../../../support/geometryUtils ../Octree".split(" "),function(a,g,b,p,f,k,c){c=function(d){function e(n,q){var u=d.call(this,v=>k.sphere.wrap(u._instanceData.view.boundingSphere.getVec(v,
u._tmpSphere)),{maximumDepth:25})||this;u._tmpSphere=k.sphere.create();u._tmpMat4=f.create();u._instanceData=n;u._boundingSphere=q;return u}g._inheritsLoose(e,d);var h=e.prototype;h.addInstance=function(n){const q=this._instanceData.view.boundingSphere,u=this._instanceData.getCombinedModelTransform(n,this._tmpMat4);b.transformMat4(this._tmpSphere,this._boundingSphere.center,u);this._tmpSphere[3]=this._boundingSphere.radius*p.maxScale(u);q.setVec(n,this._tmpSphere);this.add([n])};h.removeInstance=
function(n){this.remove([n])};return e}(c);a.InstanceOctree=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,g){let b=function(){function p(k,c){this.thresholdScale=1;this._camera=new g;this._worldSpaceRadius=k;this._thresholds=c.map(d=>d)}var f=p.prototype;f.updateCamera=function(k){this._camera.copyFrom(k)};f.selectLevel=function(k,c){k=this._camera.computeScreenPixelSizeAt(k);c=
this._worldSpaceRadius*c/k;k=this._thresholds;let d=-1;for(let e=0;e<k.length;++e)c>=k[e]*this.thresholdScale&&(d=e);return d};return p}();a.LevelSelector=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(a,g,b,p,f){let k=function(d){this.modelOriginHi=d.getField("modelOriginHi",
b.BufferViewVec3f);this.modelOriginLo=d.getField("modelOriginLo",b.BufferViewVec3f);this.model=d.getField("model",b.BufferViewMat3f);this.modelNormal=d.getField("modelNormal",b.BufferViewMat3f);this.color=d.getField("instanceColor",b.BufferViewVec4f);this.featureAttribute=d.getField("instanceFeatureAttribute",b.BufferViewVec4f)},c=function(){function d(h,n){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=h;this._instanceBufferLayout=
n;this._elementSize=n.stride;this._capacity=1}var e=d.prototype;e.destroy=function(){this._buffer&&this._buffer.destroy()};e.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};e.startUpdateCylce=function(){this._captureFirstIndex=!0};e.beginUpdate=function(){p.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};e.endUpdate=function(){p.assert(this._updating,"not updating");this.size<.3*this.capacity&&this.shrink();this._resized?
(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};e.allocateHead=function(){p.assert(this._updating,"not updating");this.isFull&&this.grow();const h=this.headIndex;this._captureFirstIndex&&(this._firstIndex=h,this._captureFirstIndex=!1);this.incrementHead();p.assert(this._headIndex!==this._tailIndex,"invalid pointers");return h};e.freeTail=function(){p.assert(this._updating,"not updating");p.assert(0<this.size,"invalid size");
const h=this._tailIndex===this._firstIndex;this.incrementTail();h&&(this._firstIndex=this._tailIndex)};e.grow=function(){this.resize(Math.max(1024,Math.floor(2*this._capacity)))};e.shrink=function(){this.resize(Math.max(1024,Math.floor(.5*this._capacity)))};e.resize=function(h){p.assert(this._updating,"not updating");if(h!==this._capacity){var n=new f(this._rctx,this._elementSize,h);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);
const q=this.size,u=this.compactInstances(n);p.assert(u===q,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=u;this._prevHeadIndex=0}this._resized=!0;this._capacity=h;this._buffer=n;this._view=new k(this._instanceBufferLayout.createView(this._buffer.array))}};e.compactInstances=function(h){const n=this._headIndex,q=this._tailIndex;return q<n?(this._buffer.copyRange(q,n,h),n-q):q>n?(this._buffer.copyRange(q,this._capacity,h),0<n&&this._buffer.copyRange(0,n,h,this._capacity-
q),n+(this._capacity-q)):0};e.incrementHead=function(h=1){this._headIndex=(this._headIndex+h)%this._capacity};e.incrementTail=function(h=1){this._tailIndex=(this._tailIndex+h)%this._capacity};e.transferRange=function(h,n){h<n?this._buffer.transferRange(h,n):h>n&&(0<n&&this._buffer.transferRange(0,n),this._buffer.transferRange(h,this._capacity))};g._createClass(d,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},
{key:"size",get:function(){const h=this._headIndex,n=this._tailIndex;return h>=n?h-n:h+this._capacity-n}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:
{cpu:0,gpu:0}}}]);return d}();a.RenderInstanceData=c;a.RenderInstanceDataView=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject"],function(a,g){return function(){function b(f,k,c){this._elementSize=k;this._buffer=g.createVertex(f,35044);this.resize(c)}var p=b.prototype;p.destroy=function(){this._buffer.dispose()};p.copyRange=function(f,
k,c,d=0){f=new Uint8Array(this.array,f*this.elementSize,(k-f)*this.elementSize);(new Uint8Array(c.array,d*this.elementSize)).set(f)};p.transferAll=function(){this._buffer.setData(this._array)};p.transferRange=function(f,k){f*=this._elementSize;this._buffer.setSubData(this._array,f,f,k*this._elementSize)};p.resize=function(f){const k=f*this._elementSize,c=new ArrayBuffer(k);this._array&&(f>=this._capacity?(new Uint8Array(c)).set(new Uint8Array(this._array)):(new Uint8Array(c)).set((new Uint8Array(this._array)).subarray(0,
f*this._elementSize)));this._array=c;this._buffer.setData(k);this._capacity=f};a._createClass(b,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return b}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../chunks/vec3f32 ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../../webgl-engine/materials/DefaultMaterial ../support/FastSymbolUpdates ../../../../chunks/mat2 ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){function B(X,aa,S){switch(aa){case "world":for(const H of X.vertices)c.add(L,H.pos,X.offset),S.worldUpAtPosition(L,J),H.setFrameFromUpVector(J),H.computeRotationAxisAndAngleFromUpVector();break;case "path":c.add(L,X.vertices[0].pos,X.offset);S.worldUpAtPosition(L,J);x.computeMinimumRotationTangentFrame(X,J);for(const H of X.vertices)X=f.sign(c.dot(H.frame.right,H.vRight)),c.cross(H.rotationFrame.up,H.vRight,H.vLeft),c.scale(H.rotationFrame.up,
H.rotationFrame.up,X),c.normalize(H.rotationFrame.up,H.rotationFrame.up),aa=c.dot(H.rotationFrame.up,H.frame.up),S=c.dot(H.rotationFrame.up,H.frame.right),c.scale(L,H.frame.up,-S),c.scale(P,H.frame.right,aa),c.add(L,L,P),c.normalize(H.rotationFrame.right,L),x.vertexSpaceToProfileSpace(H.rotationRight,H.frame,H.rotationFrame.right),c.negate(L,H.vLeft),H.rotationAngle=-X*(Math.PI-f.acosClamped(c.dot(L,H.vRight))),0<Math.abs(H.rotationAngle)&&(X=f.reciprocalClamped(Math.cos(.5*H.rotationAngle)),C.set(H.miterStretch,
1+(X-1)*H.rotationRight[0]*H.rotationRight[0],(X-1)*H.rotationRight[0]*H.rotationRight[1],(X-1)*H.rotationRight[0]*H.rotationRight[1],1+(X-1)*H.rotationRight[1]*H.rotationRight[1])),H.maxStretchDistance=Math.abs(Math.min(H.vLeftLength,H.vRightLength)*f.reciprocalClamped(Math.cos(.5*(Math.PI-H.rotationAngle))))}}function E(X,aa,S){switch(X){case "symbol-value":return S;case "proportional":return aa;default:return X}}function F(X,aa,S,H){X=X.stageObject;const R=X.geometryRecords,T=R.length;var W=0;
K.spatialReference=H.spatialReference;for(let O=0;O<T;O++){const V=R[O].geometry;if(!A.isPathGeometry(V))continue;const ba=V.path,fa=ba.builder.path;{var Y=fa;var U=aa,N=S,ca=H;let ia=0;for(const ma of Y.vertices){const ea=l.evaluateElevationAlignmentAtPoint(ma.posES,N,U,ca,Q);ia+=Q.sampledElevation;c.add(J,ma.pos,Y.offset);ca.setAltitude(ea,J);c.subtract(ma.pos,J,Y.offset)}Y.updatePathVertexInformation();Y=ia/Y.vertices.length}W+=Y;"world"!==V.upVectorAlignment&&B(fa,V.upVectorAlignment,H);ba.onPathChanged();
V.invalidateBoundingInfo();X.geometryVertexAttrsUpdated(O)}return W/T}const G=["polyline"];let I=function(X){function aa(H,R,T,W){H=X.call(this,H,R,T,W)||this;H._intrinsicSize=e.fromValues(1,1);H.upVectorAlignment="path";H.stencilWidth=.1;H.ensureDrapedStatus(!1);return H}g._inheritsLoose(aa,X);var S=aa.prototype;S.doLoad=async function(){const H=b.isSome(this.symbolLayer.width)?this.symbolLayer.width:b.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size,R=b.isSome(this.symbolLayer.height)?
this.symbolLayer.height:H;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[H,1,R],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?r.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var T=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var W=this.symbolLayer.profile||"circle";switch(W){default:this._profile=x.Profile.circle(10);break;case "quad":this._profile=x.Profile.rect()}var Y=[0,0];"center"!==T&&(Y={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[T],this._profile.translate(Y[0],Y[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new x.MiterExtruder(0,3);break;case "bevel":this._extruder=
new x.MiterExtruder(0,1);break;case "miter":this._extruder=new x.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new x.SimpleExtruder}T=this.symbolLayer.cap||"butt";switch(T){case "none":this._startCap=new x.NoCapBuilder;this._endCap=new x.NoCapBuilder;break;default:this._startCap=new x.TriangulationCapBuilder(this._profile,0);this._endCap=new x.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new x.TriangulationCapBuilder(this._profile,-.5);this._endCap=new x.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":W="quad"===W?!0:!1,this._startCap=new x.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:W,subdivisions:3}),this._endCap=new x.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:W,subdivisions:3})}W=b.get(this.symbolLayer,"material","color");Y=this._getCombinedOpacityAndColor(W);W=k.fromArray(Y);Y=Y[3];T={diffuse:W,ambient:W,opacity:Y,transparent:1>Y||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,
cullFace:"none"===T?0:void 0,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(h.set(this._intrinsicSize,H,R),!t.isValidSize(this._intrinsicSize[0])||!t.isValidSize(this._intrinsicSize[1])))throw new p("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||h.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(Object.assign(T,
this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new m.PathMaterial(T)):(T.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new z.DefaultMaterial(T));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)};S.destroy=function(){X.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=
null};S.createGraphics3DGraphic=function(H){const R=H.graphic;if(!this._validateGeometry(R.geometry,G,this.symbolLayer.type))return null;const T=this.setGraphicElevationContext(R,new w.ElevationContext);return this._createAs3DShape(R,H.renderingInfo,T,R.uid)};S.layerOpacityChanged=function(){var H=b.get(this.symbolLayer,"material","color");H=this._getCombinedOpacity(H);this._material.setParameterValues({opacity:H,transparent:1>H||this.needsDrivenTransparentPass});return!0};S.layerElevationInfoChanged=
function(H,R){return this.updateGraphics3DGraphicElevationInfo(H,R,l.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};S.pixelRatioChanged=function(){return!0};S.applyRendererDiff=function(H,R){for(const T in H.diff)switch(T){case "visualVariables":if(r.updateFastSymbolUpdatesState(this._fastUpdates,
R,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};S.getVertexData=function(H){let R=0;const T=H.paths,W=[],Y=H.spatialReference,U=this._context.elevationProvider.spatialReference,N=this._context.renderCoordsHelper.spatialReference;for(var ca of T)R+=ca.length;ca=new Float64Array(3*R);const O=new Float64Array(3*R),V=new Float64Array(3*R);let ba=0;for(const fa of T){W.push({index:ba,numVertices:fa.length});
for(const ia of fa)ca[ba++]=ia[0],ca[ba++]=ia[1],ca[ba++]=H.hasZ?ia[2]:0}H=!0;Y.equals(U)?this._copyVertices(ca,0,O,0,R):H=d.projectBuffer(ca,Y,0,O,U,0,R);U.equals(N)?this._copyVertices(O,0,V,0,R):d.projectBuffer(O,U,0,V,N,0,R);return{pathVertexDataInfos:W,vertexDataGS:ca,vertexDataES:O,vertexDataRS:V,projectionSuccess:H,terrainElevation:0}};S._copyVertices=function(H,R,T,W,Y){R*=3;W*=3;for(let U=0;U<Y;++U)T[W++]=H[R++],T[W++]=H[R++],T[W++]=H[R++]};S._createAs3DShape=function(H,R,T,W){var Y=H.geometry,
U=[];const N=[],ca=[],O=Y.spatialReference,V=n.create(),ba=this._context.renderCoordsHelper;Y=this.getVertexData(Y);if(!Y.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<Y.pathVertexDataInfos.length){for(let M=0;M<Y.pathVertexDataInfos.length;++M){var fa=Y.pathVertexDataInfos[M],ia=fa.index;fa=fa.numVertices;if(2>fa){this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");
continue}if(b.isSome(this._context.clippingExtent)&&(n.empty(V),n.expandWithBuffer(V,Y.vertexDataES,3*ia,fa),!n.intersectsClippingArea(V,this._context.clippingExtent)))continue;var ma=[];for(var ea=ia;ea<ia+3*fa;){const ka=ea++,ha=ea++,na=ea++,da=new x.PathVertex;c.set(da.posGS,Y.vertexDataGS[ka],Y.vertexDataGS[ha],Y.vertexDataGS[na]);c.set(da.posES,Y.vertexDataES[ka],Y.vertexDataES[ha],Y.vertexDataES[na]);const oa=l.evaluateElevationAlignmentAtPoint(da.posES,this._context.elevationProvider,T,ba,
null);c.set(J,Y.vertexDataRS[ka],Y.vertexDataRS[ha],Y.vertexDataRS[na]);ba.setAltitude(oa,J);c.set(da.pos,J[0],J[1],J[2]);ma.push(da)}ia=new x.Path(ma);B(ia,this.upVectorAlignment,this._context.renderCoordsHelper);ia=new x.Builder(ia,this._profile,this._extruder,this._startCap,this._endCap);fa=null;this._fastUpdates.enabled?(ea=this._fastUpdates.visualVariables,fa=ea.size?D.getAttributeValue(ea.size.field,H):0,ma=ea.color?D.getAttributeValue(ea.color.field,H):0,ea=ea.opacity?D.getAttributeValue(ea.opacity.field,
H):0,fa=new x.FastUpdatePathGeometry(ia,fa,ma,ea)):(fa=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(fa[0]*=E(R.size[0],"symbol-value"===R.size[2]?this.symbolLayer.height||0:R.size[2],this.symbolLayer.width||0),fa[1]*=E(R.size[2],"symbol-value"===R.size[0]?this.symbolLayer.width||0:R.size[0],this.symbolLayer.height||0)),ma=null,this._drivenProperties.color&&(ma=R.color),this._drivenProperties.opacity&&null!=R.opacity&&(ma=ma?[ma[0],ma[1],ma[2],R.opacity]:[1,1,1,R.opacity]),
ia=new x.StaticPathGeometry(ia),ia.bake(fa),ma&&ia.bakeVertexColors(ma),fa=ia);const {vertexAttributes:Z,indices:la}=fa.createGeometryData();ia=new A.PathGeometry(Z,la,fa,O,this.upVectorAlignment,this.stencilWidth);U.push(ia);N.push(this._material);ca.push(fa.xform)}if(0<U.length)return H=new v.Object3D({geometries:U,materials:N,transformations:ca,metadata:{layerUid:this._context.layer.uid,graphicUid:W}}),U=new y(this,H,U,null,null,F,T),U.alignedSampledElevation=Y.terrainElevation,U.needsElevationUpdates=
l.needsElevationUpdates3D(T.mode),U}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return aa}(D.Graphics3DSymbolLayer);const K=q.makeDehydratedPoint(0,0,0,null),J=k.create(),L=u.create(),P=u.create(),Q={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DPathSymbolLayer=I;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;a.default=I;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,g){function b(m,B){m[0]=B[0];m[1]=B[1];m[2]=B[2];m[3]=B[3];return m}function p(m){m[0]=1;m[1]=0;m[2]=0;m[3]=1;return m}function f(m,B,E,F,G){m[0]=B;m[1]=E;m[2]=F;m[3]=G;return m}function k(m,B){if(m===B){const E=B[1];m[1]=B[2];m[2]=E}else m[0]=B[0],m[1]=B[2],m[2]=B[1],m[3]=B[3];return m}function c(m,B){const E=B[0],F=B[1],G=B[2];B=B[3];let I=E*B-G*F;if(!I)return null;I=1/I;m[0]=B*I;m[1]=-F*I;m[2]=-G*I;m[3]=E*I;return m}
function d(m,B){const E=B[0];m[0]=B[3];m[1]=-B[1];m[2]=-B[2];m[3]=E;return m}function e(m){return m[0]*m[3]-m[2]*m[1]}function h(m,B,E){const F=B[0],G=B[1],I=B[2];B=B[3];const K=E[0],J=E[1],L=E[2];E=E[3];m[0]=F*K+I*J;m[1]=G*K+B*J;m[2]=F*L+I*E;m[3]=G*L+B*E;return m}function n(m,B,E){const F=B[0],G=B[1],I=B[2];B=B[3];const K=Math.sin(E);E=Math.cos(E);m[0]=F*E+I*K;m[1]=G*E+B*K;m[2]=F*-K+I*E;m[3]=G*-K+B*E;return m}function q(m,B,E){const F=B[1],G=B[2],I=B[3],K=E[0];E=E[1];m[0]=B[0]*K;m[1]=F*K;m[2]=G*
E;m[3]=I*E;return m}function u(m,B){const E=Math.sin(B);B=Math.cos(B);m[0]=B;m[1]=E;m[2]=-E;m[3]=B;return m}function v(m,B){m[0]=B[0];m[1]=0;m[2]=0;m[3]=B[1];return m}function t(m){return"mat2("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+")"}function l(m){return Math.sqrt(m[0]**2+m[1]**2+m[2]**2+m[3]**2)}function w(m,B,E,F){m[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];E[3]=F[3]-m[2]*E[1];return[m,B,E]}function y(m,B,E){m[0]=B[0]+E[0];m[1]=B[1]+E[1];m[2]=B[2]+E[2];m[3]=B[3]+E[3];return m}function D(m,B,E){m[0]=B[0]-
E[0];m[1]=B[1]-E[1];m[2]=B[2]-E[2];m[3]=B[3]-E[3];return m}function z(m,B){return m[0]===B[0]&&m[1]===B[1]&&m[2]===B[2]&&m[3]===B[3]}function r(m,B){const E=m[0],F=m[1],G=m[2];m=m[3];const I=B[0],K=B[1],J=B[2];B=B[3];return Math.abs(E-I)<=g.EPSILON*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(F-K)<=g.EPSILON*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(G-J)<=g.EPSILON*Math.max(1,Math.abs(G),Math.abs(J))&&Math.abs(m-B)<=g.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))}function C(m,B,E){m[0]=B[0]*E;
m[1]=B[1]*E;m[2]=B[2]*E;m[3]=B[3]*E;return m}function A(m,B,E,F){m[0]=B[0]+E[0]*F;m[1]=B[1]+E[1]*F;m[2]=B[2]+E[2]*F;m[3]=B[3]+E[3]*F;return m}var x=Object.freeze({__proto__:null,copy:b,identity:p,set:f,transpose:k,invert:c,adjoint:d,determinant:e,multiply:h,rotate:n,scale:q,fromRotation:u,fromScaling:v,str:t,frob:l,LDU:w,add:y,subtract:D,exactEquals:z,equals:r,multiplyScalar:C,multiplyScalarAndAdd:A,mul:h,sub:D});a.LDU=w;a.add=y;a.adjoint=d;a.copy=b;a.determinant=e;a.equals=r;a.exactEquals=z;a.frob=
l;a.fromRotation=u;a.fromScaling=v;a.identity=p;a.invert=c;a.mat2=x;a.mul=h;a.multiply=h;a.multiplyScalar=C;a.multiplyScalarAndAdd=A;a.rotate=n;a.scale=q;a.set=f;a.str=t;a.sub=D;a.subtract=D;a.transpose=k})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,g,b){b=function(p){function f(k,c,d,e,h,n){k=p.call(this,k,c)||this;k.path=d;k.geometrySR=e;k.upVectorAlignment=h;k.stencilWidth=n;return k}g._inheritsLoose(f,
p);return f}(b.Geometry);a.PathGeometry=b;a.isPathGeometry=function(p){return"upVectorAlignment"in p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/geometryUtils ./GeometryUtil ../materials/internal/MaterialUtil ../../../../chunks/mat2 ../../../../chunks/mat2f64".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(){return{up:p.create(),right:p.create()}}let l=function(){function T(){this.pos=p.create();this.posES=p.create();this.posGS=p.create();this.vRight=p.create();this.vLeft=p.create();this.frame=t();this.rotationFrame=t();this.rotationRight=d.create();this.rotationAngle=0;this.miterStretch=v.create()}var W=T.prototype;W.setFrameFromUpVector=function(Y){f.copy(this.frame.up,Y);f.add(Q,this.vLeft,this.vRight);f.normalize(Q,Q);f.scale(P,this.frame.up,f.dot(Q,
this.frame.up));f.subtract(S,Q,P);f.normalize(S,S);f.cross(this.frame.right,S,this.frame.up)};W.computeRotationAxisAndAngleFromUpVector=function(){f.copy(this.rotationFrame.up,this.frame.up);f.copy(this.rotationFrame.right,this.frame.right);e.set(this.rotationRight,1,0);f.scale(P,this.frame.up,f.dot(this.frame.up,this.vLeft));f.subtract(P,this.vLeft,P);f.negate(P,P);f.normalize(P,P);f.scale(Q,this.frame.up,f.dot(this.frame.up,this.vRight));f.subtract(Q,this.vRight,Q);f.normalize(Q,Q);f.cross(X,this.rotationFrame.up,
this.vLeft);this.rotationAngle=b.sign(f.dot(X,this.vRight))*(Math.PI-b.acosClamped(f.dot(P,Q)));if(0<Math.abs(this.rotationAngle)){const Y=b.reciprocalClamped(Math.cos(.5*this.rotationAngle));u.set(this.miterStretch,1+(Y-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return T}(),w=function(){function T(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=
this.uvs=null}var W=T.prototype;W.addVertex=function(Y,U){this.vertices.push(d.clone(Y));this.vertexNormals.push(d.clone(U));return this.vertices.length-1};W.addUV=function(Y){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(Y);return this.uvs.length-1};W.addPole=function(Y,U=null){this.poles.push({position:d.clone(Y),normal:U?d.clone(U):null});return this.poles.length-1};W.addSegment=function(Y,U=null,N=null){this.vertexIndices.push(Y.v0);this.vertexIndices.push(Y.v1);U&&(this.uvIndices.push(U.v0),
this.uvIndices.push(U.v1));N&&(this.poleIndices.push(N.v0),this.poleIndices.push(N.v1))};W.hasUV=function(){return null!=this.uvs};W.translate=function(Y,U){for(const N of this.vertices)N[0]+=Y,N[1]+=U;for(const N of this.poles)N.position[0]+=Y,N.position[1]+=U};T.circle=function(Y=20){const U=new T,N={v0:0,v1:0};U.addPole(d.fromValues(0,0));for(var ca=0;ca<Y;++ca){var O=2*ca*Math.PI/Y,V=Math.cos(O);const ba=Math.sin(O);O=d.fromValues(.5*V,.5*ba);V=d.fromValues(V,ba);U.addVertex(O,V);U.addUV(ca/Y)}U.addUV(1);
for(ca=0;ca<Y-1;++ca)V={v0:ca,v1:ca+1},U.addSegment(V,V,N);U.addSegment({v0:Y-1,v1:0},{v0:Y-1,v1:Y},N);return U};T.rect=function(){const Y=new T,U=d.fromValues(-.5,-.5),N=d.fromValues(.5,-.5),ca=d.fromValues(.5,.5),O=d.fromValues(-.5,.5),V=d.fromValues(0,-1),ba=d.fromValues(1,0),fa=d.fromValues(0,1),ia=d.fromValues(-1,0);Y.addUV(0);Y.addUV(1);Y.addPole(d.fromValues(0,.5),fa);Y.addPole(d.fromValues(0,.5));Y.addPole(d.fromValues(0,-.5));Y.addPole(d.fromValues(0,-.5),V);const ma={v0:0,v1:1};Y.addVertex(U,
V);Y.addVertex(N,V);Y.addSegment({v0:0,v1:1},ma,{v0:3,v1:3});Y.addVertex(N,ba);Y.addVertex(ca,ba);Y.addSegment({v0:2,v1:3},ma,{v0:2,v1:1});Y.addVertex(ca,fa);Y.addVertex(O,fa);Y.addSegment({v0:4,v1:5},ma,{v0:0,v1:0});Y.addVertex(O,ia);Y.addVertex(U,ia);Y.addSegment({v0:6,v1:7},ma,{v0:1,v1:2});return Y};g._createClass(T,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return T}(),y=function(){function T(W){this.vertices=[];this.offset=p.create();this.xform=c.create();this.vertices=
W;f.copy(this.offset,this.vertices[Math.floor((W.length-1)/2)].pos);for(const Y of this.vertices)f.subtract(Y.pos,Y.pos,this.offset);k.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}T.prototype.updatePathVertexInformation=function(){const W=this.vertices.length;let Y=this.vertices[0];Y.index=0;f.set(Y.vLeft,0,0,0);Y.vLeftLength=0;f.subtract(Y.vRight,this.vertices[1].pos,Y.pos);Y.vRightLength=f.length(Y.vRight);f.normalize(Y.vRight,Y.vRight);let U=Y;for(let N=1;N<W;++N)Y=
this.vertices[N],Y.index=N,f.copy(Y.vLeft,U.vRight),Y.vLeftLength=U.vRightLength,N<W-1?(f.subtract(Y.vRight,this.vertices[N+1].pos,Y.pos),Y.vRightLength=f.length(Y.vRight),f.normalize(Y.vRight,Y.vRight)):(f.copy(Y.vRight,Y.vLeft),Y.vRightLength=Y.vLeftLength),U=Y};return T}(),D=function(){function T(){}var W=T.prototype;W.numProfilesPerJoin=function(){return 1};W.extrude=function(Y,U,N){for(let ca=0;ca<U.vertices.length;++ca)N(Y.index,Y.frame,U.vertices[ca],U.vertexNormals[ca],!1)};return T}(),z=
function(){function T(Y=.8*Math.PI,U=1){this.cutoffAngle=Y;this.numBendSubdivisions=U}var W=T.prototype;W.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};W.extrude=function(Y,U,N){var ca=H;if(Math.abs(Y.rotationAngle)>=this.cutoffAngle)for(var O=0;O<this.numBendSubdivisions+1;++O){k.identity(R);k.rotate(R,R,.5*-Y.rotationAngle+O*Y.rotationAngle/this.numBendSubdivisions,Y.rotationFrame.up);var V=ca,ba=Y.frame,fa=R;f.transformMat4(V.up,ba.up,fa);f.transformMat4(V.right,ba.right,fa);
for(V=0;V<U.vertices.length;++V)0<=e.dot(U.vertices[V],Y.rotationRight)*Y.rotationAngle?N(Y.index,ca,U.vertices[V],U.vertexNormals[V],!1):(e.transformMat2(K,U.vertices[V],Y.miterStretch),N(Y.index,Y.frame,K,U.vertexNormals[V],!0))}else for(ca=0;ca<this.numBendSubdivisions+1;++ca)for(O=0;O<U.vertices.length;++O)V=0<=e.dot(U.vertices[O],Y.rotationRight)*Y.rotationAngle,e.transformMat2(K,U.vertices[O],Y.miterStretch),N(Y.index,Y.frame,K,U.vertexNormals[O],V?!1:!0)};return T}();const r={generateUV:!1};
let C=function(){function T(){}T.prototype.rebuildConnectingProfileGeometry=function(W,Y,U){for(let N=0;N<Y.vertices.length;++N)U(W.index,W.frame,Y.vertices[N],Y.vertexNormals[N],0,0)};return T}(),A=function(T){function W(){return T.call(this)||this}g._inheritsLoose(W,T);var Y=W.prototype;Y.getNumVertices=function(){return 0};Y.getNumIndices=function(){return 0};Y.rebuildCapGeometry=function(){};Y.buildTopology=function(){};return W}(C),x=function(T){function W(U,N=0,ca=!1){var O=T.call(this)||this;
O.profile=U;O.profilePlaneOffset=N;O.flip=ca;return O}g._inheritsLoose(W,T);var Y=W.prototype;Y.getNumVertices=function(){return this.profile.vertices.length};Y.getNumIndices=function(){return 3*this.profile.numSegments};Y.rebuildConnectingProfileGeometry=function(U,N,ca){for(let O=0;O<N.vertices.length;++O)ca(U.index,U.frame,N.vertices[O],N.vertexNormals[O],this.profilePlaneOffset,0)};Y.rebuildCapGeometry=function(U,N){const ca=J;e.set(ca,0,0);const O=this.flip?1:-1;for(let V=0;V<this.profile.vertices.length;++V)N(U.index,
U.frame,this.profile.vertices[V],ca,this.profilePlaneOffset,O)};Y.buildTopology=function(U,N){U=this.vertexBufferStart+this.profile.vertexIndices[0];for(let ca=1;ca<this.profile.numSegments;++ca){const O=this.vertexBufferStart+this.profile.vertexIndices[2*ca],V=this.vertexBufferStart+this.profile.vertexIndices[2*ca+1];this.flip?N(V,O,U):N(U,O,V)}};return W}(C),m=function(T){function W(U){var N=T.call(this)||this;N.flip=!1;N.sign=0;N.breakNormals=!1;N.numSegments=3;N.profile=U.profile;N.flip=U.flip;
N.sign=N.flip?1:-1;N.breakNormals=U.breakNormals;N.numSegments=U.subdivisions;return N}g._inheritsLoose(W,T);var Y=W.prototype;Y.getNumVertices=function(){let U=0;U=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(U+=this.profile.vertices.length);return U+=this.profile.poles.length};Y.getNumIndices=function(){let U;U=2*this.profile.numSegments*(this.numSegments-1);for(let N=0;N<this.profile.numSegments;++N)U=this.profile.poleIndices[this.profile.vertexIndices[2*N]]===this.profile.poleIndices[this.profile.vertexIndices[2*
N+1]]?U+1:U+2;return 3*U};Y.rebuildCapGeometry=function(U,N){const ca=U.frame,O=.5*this.sign,V=K,ba=J;e.set(ba,0,0);for(var fa=0;fa<this.profile.poles.length;++fa){var ia=this.profile.poles[fa];ia.normal?N(U.index,ca,ia.position,ia.normal,O,0):N(U.index,ca,ia.position,ba,O,this.sign)}if(this.breakNormals)for(fa=0;fa<this.profile.vertices.length;++fa)N(U.index,ca,this.profile.vertices[fa],this.profile.vertexNormals[fa],0,0);for(fa=0;fa<this.numSegments-1;++fa){var ma=(1-(fa+1)/this.numSegments)*Math.PI*
.5;ia=Math.sin(ma);ma=Math.cos(ma);for(let ea=0;ea<this.profile.vertices.length;++ea){const M=this.profile.poles[this.profile.poleIndices[ea]];e.subtract(V,this.profile.vertices[ea],M.position);e.scale(V,V,ia);M.normal?(e.add(V,V,M.position),N(U.index,ca,V,M.normal,O*ma,0)):(e.normalize(ba,V),e.scale(ba,ba,ia),e.add(V,V,M.position),N(U.index,ca,V,ba,O*ma,this.sign*ma))}}};Y.buildTopology=function(U,N){U=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;
const ca=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let O=0;O<this.profile.numSegments;++O){const V=this.profile.vertexIndices[2*O],ba=this.profile.vertexIndices[2*O+1],fa=this.vertexBufferStart+this.profile.poleIndices[V],ia=this.vertexBufferStart+this.profile.poleIndices[ba];let ma=U+V,ea=U+ba;for(let M=0;M<this.numSegments-1;++M){const Z=ca+M*this.profile.vertices.length+V,la=ca+M*this.profile.vertices.length+
ba;this.flip?(N(Z,ea,ma),N(ea,Z,la)):(N(ma,ea,Z),N(la,Z,ea));ma=Z;ea=la}this.flip?(N(fa,ea,ma),fa!==ia&&N(fa,ia,ea)):(N(ma,ea,fa),fa!==ia&&N(ea,ia,fa))}};return W}(C),B=function(){function T(Y,U,N,ca,O,V=r){this.options=V;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=U;this.path=Y;this.extruder=N;this.startCap=ca;this.endCap=O;Y=this.path.vertices.length-2;this.numExtrusionProfiles=N.numProfilesPerJoin()*
Y+2;this.numNormalsTotal=this.numVerticesTotal=U.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;U=this.startCap.getNumVertices();this.numVerticesTotal+=U;this.numNormalsTotal+=U;this.endCap.vertexBufferStart=this.numVerticesTotal;U=this.endCap.getNumVertices();this.numVerticesTotal+=U;this.numNormalsTotal+=U;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=
new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}var W=T.prototype;W.emitVertex=function(Y,U,N,ca,O){this.profileRightAxisData[4*this._extrusionVertexCount]=U.right[0];this.profileRightAxisData[4*
this._extrusionVertexCount+1]=U.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=U.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=U.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=U.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=U.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=N[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=N[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ca[0];
this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ca[1];this.pathVertexData[this._extrusionVertexCount]=Y;O?(Y=this.path.vertices[Y],this.profileRightAxisData[4*this._extrusionVertexCount+3]=Y.rotationRight[0]*Y.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=Y.rotationRight[1]*Y.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};W.emitCapVertex=
function(Y,U,N,ca,O,V){this.profileRightAxisData[4*this._extrusionVertexCount]=U.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=U.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=U.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=U.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=U.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=U.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=N[0];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+1]=N[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ca[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ca[1];this.pathVertexData[this._extrusionVertexCount]=Y;this.profileRightAxisData[4*this._extrusionVertexCount+3]=O;this.profileUpAxisData[4*this._extrusionVertexCount+3]=V;++this._extrusionVertexCount};W.emitTriangle=function(Y,U,N){this.vertexIndices[3*this._triangleCount]=Y;this.vertexIndices[3*this._triangleCount+1]=U;this.vertexIndices[3*
this._triangleCount+2]=N;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[Y];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[U];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[N];this.normalIndices[3*this._triangleCount]=Y;this.normalIndices[3*this._triangleCount+1]=U;this.normalIndices[3*this._triangleCount+2]=N;++this._triangleCount};W.rebuildGeometry=function(){var Y=(ca,O,V,ba,fa)=>this.emitVertex(ca,O,V,ba,fa);const U=(ca,O,V,ba,fa,ia)=>
this.emitCapVertex(ca,O,V,ba,fa,ia);this._extrusionVertexCount=0;for(var N of this.path.vertices)this.originData[3*N.index]=N.pos[0],this.originData[3*N.index+1]=N.pos[1],this.originData[3*N.index+2]=N.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,U);for(N=1;N<this.path.vertices.length-1;++N)this.extruder.extrude(this.path.vertices[N],this.profile,Y);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,
U);this.startCap.rebuildCapGeometry(this.path.vertices[0],U);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],U);if(this.profile.hasUV()&&this.options.generateUV)for(Y=0;Y<this.profile.uvs.length;++Y)this.uvData[2*Y]=this.profile.uvs[Y],this.uvData[2*Y+1]=0};W.buildTopology=function(){const Y=(V,ba,fa)=>this.emitTriangle(V,ba,fa);this._triangleCount=0;const U=this.profile.vertices.length,N=this.profile.numSegments,ca=this.numExtrusionProfiles-1;var O=N*ca*6;this.startCap.indexBufferStart=
O;this.startCap.firstProfileVertexIndex=0;O+=this.startCap.getNumIndices();this.endCap.indexBufferStart=O;this.endCap.firstProfileVertexIndex=U*(this.numExtrusionProfiles-1);O+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(O);this.normalIndices=new Uint32Array(O);this.pathVertexIndices=new Uint32Array(O);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(O));for(O=0;O<N;++O){const V=this.profile.vertexIndices[2*O],ba=this.profile.vertexIndices[2*O+1];for(let fa=
0;fa<ca;++fa){const ia=fa*U+V,ma=(fa+1)*U+ba,ea=fa*U+ba;Y(ia,(fa+1)*U+V,ma);Y(ia,ma,ea)}}this.startCap.buildTopology(this.path.vertices[0],Y);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],Y)};W.onPathChanged=function(){this.rebuildGeometry()};return T}(),E=function(){function T(W){this.builder=W}T.prototype.onPathChanged=function(){this.builder.onPathChanged()};g._createClass(T,[{key:"xform",get:function(){return this.builder.path.xform}}]);return T}(),F=function(T){function W(U){U=
T.call(this,U)||this;U.vertexAttributePosition=null;U.vertexAttributeNormal=null;U.vertexAttributeColor=null;U.vertexAttributePosition=new Float32Array(3*U.builder.numVerticesTotal);U.vertexAttributeNormal=new Float32Array(3*U.builder.numNormalsTotal);U.vertexAttributeColor=new Uint8Array(4);U.vertexAttributeColor[0]=255;U.vertexAttributeColor[1]=255;U.vertexAttributeColor[2]=255;U.vertexAttributeColor[3]=255;return U}g._inheritsLoose(W,T);var Y=W.prototype;Y.bakeVertexColors=function(U){this.vertexAttributeColor[0]=
255*U[0];this.vertexAttributeColor[1]=255*U[1];this.vertexAttributeColor[2]=255*U[2];this.vertexAttributeColor[3]=255*(3<U.length?U[3]:1)};Y.bake=function(U){this.size=U;for(let V=0;V<this.builder.numVerticesTotal;++V){var N=this.builder.pathVertexData[V],ca=0===N||N===this.builder.path.vertices.length-1,O=I;f.set(O,this.builder.originData[3*N],this.builder.originData[3*N+1],this.builder.originData[3*N+2]);const ba=P,fa=K;N=Q;const ia=X,ma=aa;let ea=0,M=0;f.set(ia,this.builder.profileRightAxisData[4*
V],this.builder.profileRightAxisData[4*V+1],this.builder.profileRightAxisData[4*V+2]);f.set(ma,this.builder.profileUpAxisData[4*V],this.builder.profileUpAxisData[4*V+1],this.builder.profileUpAxisData[4*V+2]);e.set(fa,this.builder.profileVertexAndNormalData[4*V]*U[0],this.builder.profileVertexAndNormalData[4*V+1]*U[1]);if(ca)f.cross(N,ma,ia),ea=this.builder.profileRightAxisData[4*V+3]*U[0],M=this.builder.profileUpAxisData[4*V+3];else{ca=J;const Z=L;e.set(ca,this.builder.profileRightAxisData[4*V+3],
this.builder.profileUpAxisData[4*V+3]);const la=e.length(ca);e.normalize(ca,ca);const ka=e.dot(fa,ca);if(Math.abs(ka)>la){e.set(Z,-ca[1],ca[0]);const ha=e.dot(fa,Z);e.scale(ca,ca,la*b.sign(ka));e.scale(Z,Z,ha);e.add(fa,ca,Z)}f.set(N,0,0,0)}f.set(ba,ia[0]*fa[0]+ma[0]*fa[1],ia[1]*fa[0]+ma[1]*fa[1],ia[2]*fa[0]+ma[2]*fa[1]);this.vertexAttributePosition[3*V]=O[0]+ba[0]+N[0]*ea;this.vertexAttributePosition[3*V+1]=O[1]+ba[1]+N[1]*ea;this.vertexAttributePosition[3*V+2]=O[2]+ba[2]+N[2]*ea;O=K;e.set(O,this.builder.profileVertexAndNormalData[4*
V+2],this.builder.profileVertexAndNormalData[4*V+3]);this.vertexAttributeNormal[3*V]=ia[0]*O[0]+ma[0]*O[1]+N[0]*M;this.vertexAttributeNormal[3*V+1]=ia[1]*O[0]+ma[1]*O[1]+N[1]*M;this.vertexAttributeNormal[3*V+2]=ia[2]*O[0]+ma[2]*O[1]+N[2]*M}};Y.createGeometryData=function(){const U=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],N=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&
(U.push(["color",new Uint32Array(this.builder.vertexIndices.length)]),N.push(["color",{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:N,indices:U}};Y.onPathChanged=function(){T.prototype.onPathChanged.call(this);this.bake(this.size)};Y.intersect=function(U,N,ca){const O=this.builder.vertexIndices;q.intersectTriangles(U,N,0,O.length/3,O,{size:3,data:this.vertexAttributePosition},void 0,void 0,ca)};return W}(E),G=function(T){function W(Y,U,N,ca){var O=T.call(this,Y)||this;O.sizeAttributeValue=
U;O.colorAttributeValue=N;O.opacityAttributeValue=ca;O.vvData=null;O.baked=new F(Y);O.vvData=new Float32Array(4*O.builder.path.vertices.length);for(Y=0;Y<O.builder.path.vertices.length;++Y)O.vvData[4*Y]=U,O.vvData[4*Y+1]=N,O.vvData[4*Y+2]=ca,O.vvData[4*Y+3]=0===Y||Y===O.builder.path.vertices.length-1?1:0;return O}g._inheritsLoose(W,T);W.prototype.createGeometryData=function(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,
exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}};return W}(E);const I=
p.create(),K=d.create(),J=d.create(),L=d.create(),P=p.create(),Q=p.create(),X=p.create(),aa=p.create(),S=p.create(),H=t(),R=c.create();a.Builder=B;a.CapBuilder=C;a.Extruder=function(){};a.FastUpdatePathGeometry=G;a.MiterExtruder=z;a.NoCapBuilder=A;a.Path=y;a.PathGeometryData=E;a.PathVertex=l;a.Profile=w;a.RoundCapBuilder=m;a.SimpleExtruder=D;a.StaticPathGeometry=F;a.TriangulationCapBuilder=x;a.computeMinimumRotationTangentFrame=function(T,W){let Y=null;const U=T.vertices.length,N=p.create(),ca=p.create(),
O=p.create(),V=p.create(),ba=p.create(),fa=p.create(),ia=h.plane.create();let ma=T.vertices[0];f.copy(ca,W);f.set(N,0,1,0);n.makeOrthoBasisDirUpFallback(ma.vRight,ca,N,N,O,ca,.99619469809);f.copy(ma.frame.up,ca);f.copy(ma.frame.right,O);Y=ma;for(W=1;W<U;++W){ma=T.vertices[W];f.add(ba,ma.vLeft,ma.vRight);let ea=f.length(ba);0<ea?(ea=1/Math.sqrt(ea),ba[0]*=ea,ba[1]*=ea,ba[2]*=ea):(ba[0]=ma.vRight[0],ba[1]=ma.vRight[1],ba[2]=ma.vRight[2]);f.add(fa,Y.pos,Y.frame.up);h.plane.fromPositionAndNormal(ma.pos,
ba,ia);h.plane.intersectRay(ia,h.ray.wrap(fa,ma.vLeft),V)?(f.subtract(V,V,ma.pos),f.normalize(ca,V),f.cross(O,ba,ca),f.normalize(O,O)):n.makeOrthoBasisDirUpFallback(ba,Y.frame.up,Y.frame.right,N,O,ca,.99619469809);f.copy(ma.frame.up,ca);f.copy(ma.frame.right,O);Y=ma}};a.makeFrame=t;a.profileSpaceToVertexSpace=function(T,W,Y){T[0]=Y[0]*W.right[0]+Y[1]*W.up[0];T[1]=Y[0]*W.right[1]+Y[1]*W.up[1];T[2]=Y[0]*W.right[2]+Y[1]*W.up[2]};a.vertexSpaceToProfileSpace=function(T,W,Y){e.set(T,f.dot(Y,W.right),f.dot(Y,
W.up))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function g(){return[1,0,0,1]}function b(c){return[c[0],c[1],c[2],c[3]]}function p(c,d,e,h){return[c,d,e,h]}function f(c,d){return new Float64Array(c,d,4)}var k=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f});a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat2f64=k})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../support/buffer/BufferView ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../lib/Util ../lib/geometryDataUtils ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ./VisualVariableMaterialParameters ../lib/PathGeometry ./PathTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=d.assert;d=function(r){function C(x){x=r.call(this,x,D)||this;x.supportsEdges=!0;x._vertexAttributeLocations=l.pathVertexAttributeLocations;x.techniqueConfig=new l.PathTechniqueConfiguration;x.vertexBufferLayout=C.getVertexBufferLayout(x.params);return x}g._inheritsLoose(C,r);var A=C.prototype;A.getTechniqueConfig=function(x,m){this.techniqueConfig.output=x;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;if(0===x||7===x)this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,
this.techniqueConfig.receiveSSAO=m&&m.ssaoEnabled?this.params.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=m?m.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=m?m.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=m?m.cullAboveGround:!0;return this.techniqueConfig};A.getPassParameters=function(){return this.params};A.isVisibleInPass=function(x){return 4===x||6===x||7===x?this.params.castShadows:!0};A.isVisible=function(){const x=this.params;return r.prototype.isVisible.call(this)?
0<x.opacity:!1};A.intersect=function(x,m,B,E,F,G,I){if(t.isPathGeometry(x)){m=x.path;B=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var K=this.params.vvSizeOffset,J=this.params.vvSizeFactor;const L=this.params.vvSizeMinSize,P=this.params.vvSizeMaxSize,Q=m.sizeAttributeValue;B[0]*=p.clamp(K[0]+Q*J[0],L[0],P[0]);B[1]*=p.clamp(K[2]+Q*J[2],L[2],P[2])}K=Math.max(B[0],B[1]);x=x.boundingInfo;b.isNone(x)?this._intersectTriangles(m,B,F,G,I):(x=k.fromValues(x.bbMin[0]-K,x.bbMin[1]-
K,x.bbMin[2]-K,x.bbMax[0]+K,x.bbMax[1]+K,x.bbMax[2]+K),K=[G[0]-F[0],G[1]-F[1],G[2]-F[2]],J=Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2]),n.intersectAabbInvDir(x,F,[J/K[0],J/K[1],J/K[2]],E.tolerance)&&this._intersectTriangles(m,B,F,G,I))}};A._intersectTriangles=function(x,m,B,E,F){x.baked.size&&x.baked.size[0]===m[0]&&x.baked.size[1]===m[1]||x.baked.bake(m);x.baked.intersect(B,E,F)};A.computeAttachmentOrigin=function(x,m){x=x.vertexAttributes;if(!x)return null;x=x.get("position");return e.computeAttachmentOriginLines(x,
null,!1,m)};A.createBufferWriter=function(){return new z(this.vertexBufferLayout)};A.getGLMaterial=function(x){if(0===x.output||7===x.output||1===x.output||2===x.output||4===x.output||3===x.output&&this.params.castShadows)return new y(x)};C.getVertexBufferLayout=function(x){let m=c.newLayout().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");if(x.vvColorEnabled||x.vvSizeEnabled||x.vvOpacityEnabled)m=m.vec4f("featureValue");return m};return C}(q.Material);
let y=function(r){function C(x){x=r.call(this,x)||this;x.updateParameters();return x}g._inheritsLoose(C,r);var A=C.prototype;A.updateParameters=function(x){this.technique=this.techniqueRep.acquireAndReleaseExisting(l.PathTechnique,this.material.getTechniqueConfig(this.output,x),this.technique)};A.beginSlot=function(x){return x===(this.technique.configuration.transparent?5:3)};A._updateOccludeeState=function(x){x.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:x.hasOccludees})};
A._updateShadowState=function(x){x.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&this.material.setParameterValues({receiveShadows:x.shadowMappingEnabled})};A.ensureParameters=function(x){if(0===this.output||7===this.output)this._updateShadowState(x),this._updateOccludeeState(x);this.updateParameters(x)};A.bind=function(x,m){x.bindProgram(this.technique.program);this.technique.bindPass(x,this.material.getPassParameters(),m)};return C}(h);const D={size:[1,1,1],ambient:[.2,.2,.2],
diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...v.Default,...q.materialParametersDefaults};let z=function(){function r(A){this.vertexBufferLayout=A}var C=r.prototype;C.allocate=function(A){return this.vertexBufferLayout.createBuffer(A)};C.elementCount=function(A){return A.indices.get("position").length};C.write=function(A,x,m,B){const E=F=>{if(x.vertexAttributes.has(F)){const G=
x.vertexAttributes.get(F),I=x.indices.get(F);w(4===G.size);const K=m.getField(F,f.BufferViewVec4f);if(K)u.writeBufferVec4(I,G.data,K,B);else throw Error("unable to acquire view for "+F);}};E("profileRight");E("profileUp");E("profileVertexAndNormal");this.vertexBufferLayout.hasField("featureValue")&&E("featureValue");u.writeDefaultAttributes(x,this.vertexBufferLayout,A.transformation,A.invTranspTransformation,m,B)};return r}();a.PathMaterial=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../../../../chunks/Path.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){const D={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};k=function(z){function r(){return z.apply(this,arguments)||this}b._inheritsLoose(r,z);var C=r.prototype;C.initializeProgram=function(A){var x=r.shader.get();const m=this.configuration;x=x.build({OITEnabled:0===m.transparencyPassType,output:m.output,viewingMode:A.viewingMode,slicePlaneEnabled:m.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
receiveShadows:m.receiveShadows,vvSize:m.vvSize,vvColor:m.vvColor,vvInstancingEnabled:!0,vvOpacity:m.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:m.receiveSSAO,doubleSidedMode:m.doubleSidedMode,multipassTerrainEnabled:m.multipassTerrainEnabled,cullAboveGround:m.cullAboveGround});return new d(A.rctx,x.generateSource("vertex"),x.generateSource("fragment"),D)};C.bindPass=function(A,x,m){h.View.bindProjectionMatrix(this.program,m.camera.projectionMatrix);
this.program.setUniform3fv("size",x.size);m.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",m.camera.nearFar),this.program.setUniform2fv("inverseViewport",m.inverseViewport),u.bindMultipassTerrainUniforms(this.program,A,m));0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",x.opacity);0===this.configuration.output?(m.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",x.ambient),this.program.setUniform3fv("diffuse",
x.diffuse),this.program.setUniform3fv("specular",x.specular),this.program.setUniform1f("opacity",x.opacity)):1!==this.configuration.output&&3!==this.configuration.output||h.View.bindNearFar(this.program,m.camera.nearFar);w.setVVUniforms(this.program,x)};C.bindDraw=function(A){h.View.bindView(this.program,A);n.Slice.bindUniformsWithOrigin(this.program,this.configuration,A);0!==this.configuration.output&&7!==this.configuration.output||h.View.bindCamPosition(this.program,A.origin,A.camera.viewInverseTransposeMatrix);
0===this.configuration.output&&t.ReadShadowMap.bindView(this.program,A);2===this.configuration.output&&l.VertexNormal.bindUniforms(this.program,A.camera.viewInverseTransposeMatrix)};C.setPipelineState=function(A){const x=this.configuration,m=3===A,B=2===A;return e.makePipelineState({blending:0!==x.output&&7!==x.output||!x.transparent?null:m?q.blendingDefault:q.OITBlending(A),culling:(x.slicePlaneEnabled?!1:!x.transparent&&0!==x.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:q.OITDepthTest(A)},
depthWrite:m||B?e.defaultDepthWriteParams:null,colorWrite:e.defaultColorWriteParams,stencilWrite:x.sceneHasOcludees?v.stencilWriteMaskOn:null,stencilTest:x.sceneHasOcludees?v.stencilBaseAllZerosParams:null,polygonOffset:m||B?null:q.OITPolygonOffset})};C.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return r}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(y.PathShader,()=>new Promise(function(z,r){a(["../shaders/Path.glsl"],z,r)}));f=
function(z){function r(){var C=z.apply(this,arguments)||this;C.output=0;C.doubleSidedMode=0;C.receiveShadows=!1;C.receiveSSAO=!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.slicePlaneEnabled=!1;C.transparent=!1;C.sceneHasOcludees=!1;C.transparencyPassType=3;C.multipassTerrainEnabled=!1;C.cullAboveGround=!0;return C}b._inheritsLoose(r,z);return r}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter({count:3})],f.prototype,"doubleSidedMode",
void 0);p.__decorate([c.parameter()],f.prototype,"receiveShadows",void 0);p.__decorate([c.parameter()],f.prototype,"receiveSSAO",void 0);p.__decorate([c.parameter()],f.prototype,"vvSize",void 0);p.__decorate([c.parameter()],f.prototype,"vvColor",void 0);p.__decorate([c.parameter()],f.prototype,"vvOpacity",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"transparent",void 0);p.__decorate([c.parameter()],f.prototype,"sceneHasOcludees",
void 0);p.__decorate([c.parameter({count:4})],f.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],f.prototype,"multipassTerrainEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"cullAboveGround",void 0);g.PathTechnique=k;g.PathTechniqueConfiguration=f;g.pathVertexAttributeLocations=D;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces",
"./PositionAttribute.glsl"],function(a,g,b){a.PathVertexPosition=function(p,f){p.attributes.add("featureValue","vec4");p.vertex.code.add(g.glsl`
  bool isCapVertex() {
    return featureValue.w == 1.0;
  }
  `);p.vertex.uniforms.add("size","vec3");f.vvSize?(p.vertex.uniforms.add("vvSizeMinSize","vec3"),p.vertex.uniforms.add("vvSizeMaxSize","vec3"),p.vertex.uniforms.add("vvSizeOffset","vec3"),p.vertex.uniforms.add("vvSizeFactor","vec3"),p.vertex.code.add(g.glsl`
    vec2 getSize() {
      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):p.vertex.code.add(g.glsl`
    vec2 getSize(){
      return size.xy;
    }
    `);f.vvOpacity?(p.vertex.constants.add("vvOpacityNumber","int",8),p.vertex.code.add(g.glsl`
    uniform float vvOpacityValues[vvOpacityNumber];
    uniform float vvOpacityOpacities[vvOpacityNumber];

    vec4 applyOpacity(vec4 color) {
      float value = featureValue.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):p.vertex.code.add(g.glsl`
    vec4 applyOpacity(vec4 color){
      return color;
    }
    `);f.vvColor?(p.vertex.constants.add("vvColorNumber","int",8),p.vertex.code.add(g.glsl`
    uniform float vvColorValues[vvColorNumber];
    uniform vec4 vvColorColors[vvColorNumber];

    vec4 getColor() {
      float value = featureValue.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):p.vertex.code.add(g.glsl`
    vec4 getColor(){
      return applyOpacity(vec4(1, 1, 1, 1));
    }
    `);p.include(b.PositionAttribute);p.attributes.add("profileRight","vec4");p.attributes.add("profileUp","vec4");p.attributes.add("profileVertexAndNormal","vec4");p.vertex.code.add(g.glsl`
  vec3 calculateVPos() {
    vec2 size = getSize();
    vec3 origin = position;
    vec3 right = profileRight.xyz;
    vec3 up = profileUp.xyz;
    vec3 forward = cross(up, right);
    vec2 profileVertex = profileVertexAndNormal.xy * size;
    vec2 profileNormal = profileVertexAndNormal.zw;
    float positionOffsetAlongProfilePlaneNormal = 0.0;
    float normalOffsetAlongProfilePlaneNormal = 0.0;
    `);p.vertex.code.add(g.glsl`
    if(!isCapVertex()) {
      vec2 rotationRight = vec2(profileRight.w, profileUp.w);
      float maxDistance = length(rotationRight);
  `);p.vertex.code.add(g.glsl`
      rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);

      // decompose vertex into rotationRight and rotationUp
      // limit rotation right component to maxDistance
      // and reassemble profile vertex from rotationRight and rotationUp
      float rx = dot(profileVertex, rotationRight);
      if (abs(rx) > maxDistance) {
        // NB: we do the tangent by x=-y and y=x
        vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
        float ry = dot(profileVertex, rotationUp);
        profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
      }
    }else{
       positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
       normalOffsetAlongProfilePlaneNormal = profileUp.w;
    }

    vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;

    return origin + offset; // localPosition
  }
  `);p.vertex.code.add(g.glsl`
  vec3 localNormal() {
    vec3 right = profileRight.xyz;
    vec3 up = profileUp.xyz;
    vec3 forward = cross(up, right);
    vec2 profileNormal = profileVertexAndNormal.zw;

    vec3 normal = right * profileNormal.x + up * profileNormal.y;

    if(isCapVertex()) {
      normal += forward * profileUp.w;
    }

    return normal;
  }
  `)};a.setVVUniforms=function(p,f){f.vvSizeEnabled&&(p.setUniform3fv("vvSizeMinSize",f.vvSizeMinSize),p.setUniform3fv("vvSizeMaxSize",f.vvSizeMaxSize),p.setUniform3fv("vvSizeOffset",f.vvSizeOffset),p.setUniform3fv("vvSizeFactor",f.vvSizeFactor));f.vvColorEnabled&&(p.setUniform1fv("vvColorValues",f.vvColorValues),p.setUniform4fv("vvColorColors",f.vvColorColors));f.vvOpacityEnabled&&(p.setUniform1fv("vvOpacityValues",f.vvOpacityValues),p.setUniform1fv("vvOpacityOpacities",f.vvOpacityOpacities))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){function y(z){const r=new p.ShaderBuilder;r.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");r.varyings.add("vpos","vec3");r.include(w.PathVertexPosition,z);if(0===z.output||7===z.output)r.include(b.Transform,{linearDepth:!1}),z.receiveShadows&&r.include(n.ReadShadowMap,z),r.include(q.ForwardLinearDepth,z),r.varyings.add("vnormal","vec3"),r.varyings.add("vcolor","vec4"),z.multipassTerrainEnabled&&r.varyings.add("depth",
"float"),r.vertex.code.add(g.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${z.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===z.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);z.multipassTerrainEnabled&&(r.fragment.include(c.ReadLinearDepth),r.include(e.multipassTerrainTest,z));7===z.output&&(r.include(k.Slice,z),r.fragment.uniforms.add("camPos","vec3"),r.fragment.uniforms.add("localOrigin","vec3"),r.fragment.uniforms.add("opacity","float"),r.fragment.code.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${z.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));0===z.output&&(r.include(k.Slice,z),r.include(t.EvaluateSceneLighting,z),r.include(v.EvaluateAmbientOcclusion,z),z.receiveShadows&&r.include(n.ReadShadowMap,z),r.include(l.Normals,z),r.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),r.fragment.include(f.ColorConversion),r.fragment.code.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        ${z.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
    `),z.receiveShadows?r.fragment.code.add(g.glsl`
        float shadow = readShadowMap(vpos, linearDepth);
      `):1===z.viewingMode?r.fragment.code.add(g.glsl`
        float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);
      `):r.fragment.code.add(g.glsl`
        float shadow = 0.0;
      `),r.fragment.code.add(g.glsl`
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${z.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===z.output||3===z.output)r.include(b.Transform,{linearDepth:!0}),r.vertex.uniforms.add("nearFar","vec2"),r.varyings.add("depth","float"),r.vertex.code.add(g.glsl`
        void main() {
          vpos = calculateVPos();
          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
        }
    `),r.include(k.Slice,z),r.include(h.OutputDepth,z),r.fragment.uniforms.add("timeElapsed","float"),r.fragment.code.add(g.glsl`
        void main() {
          discardBySlice(vpos);
          outputDepth(depth);
        }
    `);2===z.output&&(r.include(b.Transform,{linearDepth:!1}),r.include(u.NormalUtils,z),r.vertex.uniforms.add("viewNormal","mat4"),r.varyings.add("vnormal","vec3"),r.vertex.code.add(g.glsl`
        void main(void) {
          vpos = calculateVPos();
          vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.include(k.Slice,z),r.fragment.uniforms.add("waterColor","vec4"),r.fragment.code.add(g.glsl`
        void main() {
          discardBySlice(vpos);
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) normal = -normal;
          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
    `));4===z.output&&(r.include(b.Transform,{linearDepth:!1}),r.include(u.NormalUtils,z),r.vertex.uniforms.add("viewNormal","mat4"),r.varyings.add("vnormal","vec3"),r.vertex.code.add(g.glsl`
        void main(void) {
          vpos = calculateVPos();
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.include(k.Slice,z),r.include(d.OutputHighlight),r.fragment.code.add(g.glsl`
      void main() {
        discardBySlice(vpos);
        outputHighlight();
      }
    `));return r}var D=Object.freeze({__proto__:null,build:y});a.PathShader=D;a.build=y})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../core/libs/earcut/earcut ../../../../chunks/vec4 ../../support/buffer/BufferView ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/lineStippleUtils ./polygonUtils ./Graphics3DDrapedGraphicLayer ../../webgl-engine/lib/RenderGeometry ./lineUtils ../../webgl-engine/materials/NativeLineMaterial ../support/uvUtils ../../webgl-engine/materials/PatternMaterial ../support/patternUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){const E=["polyline","polygon","extent"];l=function(K){function J(P,Q,X,aa){P=K.call(this,P,Q,X,aa)||this;P._needsUV=!1;P._hasOutline=!1;return P}g._inheritsLoose(J,K);var L=J.prototype;L.doLoad=async function(){};L.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};L.ensureFillMaterial=function(){if(!b.isSome(this._material)){var P=b.get(this.symbolLayer,"material","color");P=this._getCombinedOpacityAndColor(P);
this._material=B.createMaterial(this.symbolLayer,{color:P,transparent:1>P[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof m.PatternMaterial;this._context.stage.add(this._material)}};L.ensureOutlineMaterial=function(){const P=this.symbolLayer.outline;!b.isSome(this._outlineMaterial)&&this._isValidOutline(P)&&(this._hasOutline=!0,this._outlineMaterial=
(Q=>{const X=P.stipplePattern?y.createStipplePattern(P.stipplePattern.map(f.pt2px)):null,aa=P.stippleOffColor?p.toUnitRGBA(P.stippleOffColor):null;return 1.5<Q?new w.RibbonLineMaterial({width:Q,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:X,stippleIntegerRepeats:!0,stippleOffColor:aa}):new A.NativeLineMaterial({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:Q,stipplePattern:X,stippleIntegerRepeats:!0,
stippleOffColor:aa})})(f.pt2px(P.size)),this._context.stage.add(this._outlineMaterial))};L._isValidOutline=function(P){return b.isSome(P)&&P.size&&0<P.size&&b.isSome(P.color)};L.destroy=function(){K.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};L.createGraphics3DGraphic=function(P){const Q=P.graphic;if(!this._validateGeometry(Q.geometry,E,this.symbolLayer.type))return null;P=
this._getVertexOpacityAndColor(P.renderingInfo,255);const X=this.setGraphicElevationContext(Q,new v.ElevationContext);this.ensureDrapedStatus("on-the-ground"===X.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(Q,P):this._createAs3DShape(Q,P,X)};L.layerOpacityChanged=function(){if(b.isSome(this._material)){var P=this._material.params.color,Q=b.get(this.symbolLayer,"material","color");Q=this._getCombinedOpacity(Q);this._material.setParameterValues({color:[P[0],P[1],P[2],Q],transparent:1>
Q||this.needsDrivenTransparentPass})}b.isSome(this._outlineMaterial)&&(P=this._outlineMaterial.params.color,this._outlineMaterial.setParameterValues({color:[P[0],P[1],P[2],this._getOutlineOpacity()]}));return!0};L.layerElevationInfoChanged=function(P,Q,X){const aa=this._elevationContext.mode;X=u.elevationModeChangeUpdateType(J.elevationModeChangeTypes,X,aa);if(X!==u.SymbolUpdateType.UPDATE)return X;const S=u.needsElevationUpdates2D(aa);return this.updateGraphics3DGraphicElevationInfo(P,Q,()=>S)};
L.slicePlaneEnabledChanged=function(){b.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});b.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};L.physicalBasedRenderingChanged=function(){return!0};L.pixelRatioChanged=function(){return!0};L._createAs3DShape=function(P,Q,X){const aa=D.geometryAsPolygon(P.geometry);if(b.isNone(aa))return null;G.renderData=D.geometryToRenderInfo(aa,
this._context.elevationProvider,this._context.renderCoordsHelper,X);G.color=Q;Q=G.renderData.position.length/3;this._needsUV&&(G.uvMapSpace=new Float32Array(4*Q),G.boundingRect=new Float64Array(9*Q));G.outNum=0;G.outGeometries=[];G.outTransforms=[];G.outMaterials=[];this._createAs3DShapeFill(G);this._hasOutline&&this._createAs3DShapeOutline(G);this._logGeometryCreationWarnings(G.renderData,aa.rings,"rings","FillSymbol3DLayer");if(0===G.outNum)return null;this._needsUV&&x.createMapSpaceUVCoords(e.BufferViewVec4f.fromTypedArray(G.uvMapSpace),
e.BufferViewVec3f64.fromTypedArray(G.renderData.position),this._context.renderCoordsHelper,e.BufferViewMat3f64.fromTypedArray(G.boundingRect));P=new n.Object3D({geometries:G.outGeometries,materials:G.outMaterials,transformations:G.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:P.uid}});P=new t(this,P,G.outGeometries,null,null,B.uvElevationAligner,X);P.alignedSampledElevation=G.renderData.sampledElevation;P.needsElevationUpdates=u.needsElevationUpdates2D(X.mode);
return P};L._createAs3DShapeFill=function(P){var Q=P.renderData.polygons;for(const {position:X,mapPosition:aa,holeIndices:S,index:H,count:R}of Q){if(b.isSome(this._context.clippingExtent)&&(h.empty(F),h.expandWithBuffer(F,aa),!h.intersectsClippingArea(F,this._context.clippingExtent)))continue;Q=c.earcut(aa,S,3);0!==Q.length&&(Q=new Uint32Array(Q),Q=D.createColorGeometry({indices:Q,attributeData:{position:X,color:P.color,mapPosition:aa,uvMapSpace:this._needsUV?new Float32Array(P.uvMapSpace.buffer,
4*H*P.uvMapSpace.BYTES_PER_ELEMENT,4*R):null,boundingRect:this._needsUV?new Float64Array(P.boundingRect.buffer,9*H*P.boundingRect.BYTES_PER_ELEMENT,9*R):null}}),P.outGeometries.push(Q),P.outMaterials.push(b.unwrap(this._material)),P.outTransforms.push(k.IDENTITY),P.outNum++)}};L._createAs3DShapeOutline=function(P){if(this._hasOutline){var Q=P.renderData.outlines,X=this._outlineMaterial instanceof A.NativeLineMaterial;for(let aa=0;aa<Q.length;++aa){const {mapPosition:S,position:H}=Q[aa];if(b.isSome(this._context.clippingExtent)&&
(h.empty(F),h.expandWithBuffer(F,S),!h.intersectsClippingArea(F,this._context.clippingExtent)))continue;const R=C.createGeometry({removeDuplicateStartEnd:X?0:1,attributeData:{position:H,mapPosition:S}}),T=R.vertexAttributes.get("position");T.data===H&&(T.data=new Float64Array(H));P.outGeometries.push(R);P.outMaterials.push(b.unwrap(this._outlineMaterial));P.outTransforms.push(k.IDENTITY);P.outNum++}}};L._createAsOverlay=function(P,Q){const X=D.geometryAsPolygon(P.geometry);if(b.isNone(X))return null;
b.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;b.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);I.renderData=D.geometryToRenderInfoDraped(X,this._context.overlaySR);I.color=Q;Q=I.renderData.position.length/3;this._needsUV&&(I.uvMapSpace=new Float32Array(4*Q));I.outNum=0;I.outGeometries=[];I.outBoundingBox=h.empty();I.layerUid=this._context.layer.uid;I.graphicsUid=P.uid;this._createAsOverlayFill(I);this._hasOutline&&
this._createAsOverlayOutline(I);this._logGeometryCreationWarnings(I.renderData,X.rings,"rings","FillSymbol3DLayer");if(0===I.outNum)return null;this._needsUV&&x.createMapSpaceUVCoordsDraped(e.BufferViewVec4f.fromTypedArray(I.uvMapSpace),e.BufferViewVec3f64.fromTypedArray(I.renderData.position),this._context.overlaySR);return 0<I.outNum?new z(this,I.outGeometries,I.outBoundingBox):null};L._createAsOverlayFill=function(P){var Q=P.renderData.polygons;for(const {position:X,holeIndices:aa,index:S,count:H}of Q){h.empty(F);
h.expandWithBuffer(F,X);if(!h.intersectsClippingArea(F,this._context.clippingExtent))continue;Q=c.earcut(X,aa,3);if(0===Q.length)continue;h.expandWithAABB(P.outBoundingBox,F);Q=new Uint32Array(Q);Q=D.createColorGeometry({indices:Q,attributeData:{position:X,color:P.color,uvMapSpace:this._needsUV?new Float32Array(P.uvMapSpace.buffer,4*S*P.uvMapSpace.BYTES_PER_ELEMENT,4*H):null}});Q=new r.RenderGeometry(Q,b.unwrap(this._material),P.layerUid,P.graphicsUid);const R=F;d.set(Q.boundingSphere,.5*(R[0]+R[3]),
.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-R[1])));P.outGeometries.push(Q);P.outNum++}};L._createAsOverlayOutline=function(P){if(this._hasOutline){var Q=P.renderData.outlines;for(let aa=0;aa<Q.length;++aa){var {position:X}=Q[aa];h.empty(F);h.expandWithBuffer(F,X);if(!h.intersectsClippingArea(F,this._context.clippingExtent))continue;h.expandWithAABB(P.outBoundingBox,F);X=C.createGeometry({removeDuplicateStartEnd:this._outlineMaterial instanceof A.NativeLineMaterial?0:1,
attributeData:{position:X}});X=new r.RenderGeometry(X,b.unwrap(this._outlineMaterial),P.layerUid,P.graphicsUid);const S=F;d.set(X.boundingSphere,.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1])));P.outGeometries.push(X);P.outNum++}}};L._getOutlineOpacity=function(){const P=b.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(b.isSome(P)?P.a:0)};L._getOutlineColor=function(){const P=b.get(this.symbolLayer,"outline","color"),
Q=this._getOutlineOpacity();return q.mixinColorAndOpacity(b.isSome(P)?p.toUnitRGB(P):null,Q)};g._createClass(J,[{key:"test",get:function(){return{createAsOverlay:(P,Q)=>this._createAsOverlay(P,Q),createAs3DShape:(P,Q,X)=>this._createAs3DShape(P,Q,X)}}}]);return J}(l.Graphics3DSymbolLayer);l.elevationModeChangeTypes={definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};const F=h.create(),G={renderData:null,color:null,uvMapSpace:null,
boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},I={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=l;a.default=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/buffer/BufferView ../../../../chunks/plane".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){function q(I,K,J,L,P,Q,X){p.set(I,K*P[0]+J*Q[0]+L*X[0],K*P[1]+J*Q[1]+L*X[1],K*P[2]+J*Q[2]+L*X[2])}const u=b.create(),v=b.create(),t=n.create(),l=b.create(),w=b.create(),y=b.create(),D=d.create(),z=d.create(),r=d.create(),C=b.create(),A=b.create(),x=b.create(),m=c.create(),B=b.create(),E=b.create(),F=b.create(),G=b.create();a.createMapSpaceUVCoords=function(I,K,J,L,P=1){p.set(l,1,0,0);p.set(w,0,1,0);p.set(y,0,0,1);p.set(G,0,0,0);for(var Q=0;Q<K.count-1;Q++)K.getVec(Q,
v),p.add(G,G,v);p.scale(u,G,1/(K.count-1));Q=K.count-1;if(Q=n.fromManyPointsSampleAt(K,t,0,Math.floor(Q/3),Math.floor(2/3*Q))){g.isSome(J)?(J.basisMatrixAtPosition(u,m),p.set(B,m[0],m[1],m[2]),p.set(E,m[4],m[5],m[6]),p.set(F,m[8],m[9],m[10])):(p.set(B,1,0,0),p.set(E,0,1,0),p.set(F,0,0,1));J=n.normal(t);0>p.dot(J,F)&&p.scale(J,J,-1);p.copy(y,J);Q=p.dot(J,E);var X=p.dot(J,B);Math.abs(Q)<Math.abs(X)?(p.scaleAndAdd(l,B,J,-X),p.normalize(l,l),p.cross(w,l,J),p.normalize(w,w),p.scale(w,w,-1)):(p.scaleAndAdd(w,
E,J,-Q),p.normalize(w,w),p.cross(l,w,J),p.normalize(l,l))}e.set(D,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);e.set(z,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(J=0;J<K.count;J++)K.getVec(J,v),Q=p.dot(l,v),X=p.dot(w,v),D[0]=Math.min(D[0],Q),D[1]=Math.min(D[1],X),z[0]=Math.max(z[0],Q),z[1]=Math.max(z[1],X);J=p.dot(y,u);q(C,D[0],D[1],J,l,w,y);q(A,z[0],D[1],J,l,w,y);q(x,D[0],z[1],J,l,w,y);p.subtract(A,A,C);p.scale(A,A,.5);p.subtract(x,x,C);p.scale(x,x,.5);p.add(C,C,A);p.add(C,C,x);
J=D[1]%P;r[0]=D[0]-D[0]%P;r[1]=D[1]-J;for(J=0;J<K.count;J++)for(K.getVec(J,v),I.setValues(J,(p.dot(l,v)-r[0])/P,(p.dot(w,v)-r[1])/P,r[0]/P,r[1]/P),Q=0;3>Q;Q++)L.set(J,Q,C[Q]),L.set(J,Q+3,A[Q]),L.set(J,Q+6,x[Q])};a.createMapSpaceUVCoordsDraped=function(I,K,J,L=1){if(J.isGeographic){const P=new Float64Array(K.typedBuffer.length),Q=3*K.count;for(let X=0;X<Q;X+=3)k.lonLatToWebMercatorComparable(K.typedBuffer,X,P,X,f.getReferenceEllipsoid(J));K=h.BufferViewVec3f64.fromTypedArray(P)}e.set(D,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY);for(J=0;J<K.count;J++)K.getVec(J,v),D[0]=Math.min(D[0],v[0]),D[1]=Math.min(D[1],v[1]);J=D[1]%L;r[0]=D[0]-D[0]%L;r[1]=D[1]-J;for(J=0;J<K.count;J++)K.getVec(J,v),I.setValues(J,(v[0]-r[0])/L,(v[1]-r[1])/L,r[0]/L,r[1]/L)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/Util ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ../shaders/PatternTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){let u=function(w){function y(z){z=w.call(this,z,l)||this;z.supportsEdges=!0;z._vertexAttributeLocations=q.patternVertexAttributeLocations;z.techniqueConfig=new q.PatternTechniqueConfiguration;return z}g._inheritsLoose(y,w);var D=y.prototype;D.getTechniqueConfig=function(z,r){this.techniqueConfig.output=z;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;
this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.style=this.params.style;this.techniqueConfig.patternSpacing=this.params.patternSpacing;this.techniqueConfig.lineWidth=this.params.lineWidth;this.techniqueConfig.draped=this.params.draped;this.techniqueConfig.transparencyPassType=r?r.transparencyPassType:3;this.techniqueConfig.enableOffset=r?r.camera.relativeElevation<h.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=
r?r.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=r?r.cullAboveGround:!0;return this.techniqueConfig};D.getPassParameters=function(){return this.params};D.intersect=function(z,r,C,A,x,m,B){c.intersectTriangleGeometry(z,r,A,x,m,void 0,B)};D.getGLMaterial=function(z){return 0===z.output||7===z.output||4===z.output||1===z.output&&this.params.writeLinearDepth?new v(z):void 0};D.createBufferWriter=function(){const z=p.newLayout().vec3f("position").vec4u8("color").vec4f("uvMapSpace");
this.params.draped||z.mat3f("boundingRect");return new t(z)};return y}(d.Material),v=function(w){function y(z){z=w.call(this,z)||this;z.updateParameters();return z}g._inheritsLoose(y,w);var D=y.prototype;D.updateParameters=function(z){this.technique=this.techniqueRep.acquireAndReleaseExisting(q.PatternTechnique,this.material.getTechniqueConfig(this.output,z),this.technique)};D.beginSlot=function(z){return 4===this.output?3===z:z===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?
5:8:3)};D._updateOccludeeState=function(z){z.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:z.hasOccludees})};D.ensureParameters=function(z){0!==this.output&&7!==this.output||this._updateOccludeeState(z);this.updateParameters(z)};D.bind=function(z,r){z.bindProgram(this.technique.program);this.technique.bindPass(z,this.material.getPassParameters(),r)};D.getPipelineState=function(z,r){return this.technique.getPipelineState(r)};return y}(k),t=
function(w){function y(){return w.apply(this,arguments)||this}g._inheritsLoose(y,w);var D=y.prototype;D.write=function(z,r,C,A){for(const m of this.vertexBufferLayout.fieldNames){const B=r.vertexAttributes.get(m),E=r.indices.get(m);if(B&&E)switch(m){case "position":f.assert(3===B.size);var x=C.getField(m,b.BufferViewVec3f);x&&e.writePosition(E,B.data,z.transformation,x,A);break;case "color":f.assert(3===B.size||4===B.size);(x=C.getField(m,b.BufferViewVec4u8))&&e.writeColor(E,B.data,B.size,x,A);break;
case "uvMapSpace":f.assert(4===B.size);(x=C.getField(m,b.BufferViewVec4f))&&e.writeBufferVec4(E,B.data,x,A);break;case "boundingRect":f.assert(9===B.size),(x=C.getField(m,b.BufferViewMat3f))&&this.writeBoundingRect(E,B.data,z.transformation,x,A)}}};D.writeBoundingRect=function(z,r,C,A,x){const m=A.typedBuffer;A=A.typedBufferStride;const B=z.length;x*=A;for(let F=0;F<B;++F){const G=9*z[F];var E=r[G];const I=r[G+1],K=r[G+2];m[x]=C[0]*E+C[4]*I+C[8]*K+C[12];m[x+1]=C[1]*E+C[5]*I+C[9]*K+C[13];m[x+2]=C[2]*
E+C[6]*I+C[10]*K+C[14];for(E=3;9>E;++E)m[x+E]=r[G+E];x+=A}};return y}(n.DefaultBufferWriter);const l={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...d.materialParametersDefaults};a.PatternMaterial=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../../../../chunks/Pattern.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){k=function(D){function z(){return D.apply(this,arguments)||this}b._inheritsLoose(z,D);var r=z.prototype;r.initializeProgram=function(C){var A=z.shader.get();const x=this.configuration;A=A.build({output:x.output,attributeColor:x.vertexColors,slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:x.style,patternSpacing:x.patternSpacing,lineWidth:x.lineWidth,draped:x.draped,OITEnabled:0===x.transparencyPassType,
multipassTerrainEnabled:x.multipassTerrainEnabled,cullAboveGround:x.cullAboveGround});return new d(C.rctx,A.generateSource("vertex"),A.generateSource("fragment"),y)};r.bindPass=function(C,A,x){h.View.bindProjectionMatrix(this.program,x.camera.projectionMatrix);this.program.setUniform4fv("matColor",A.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/x.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/x.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",
1/x.camera.perScreenPixelRatio);4===this.configuration.output&&q.OutputHighlight.bindOutputHighlight(C,this.program,x);(1===this.configuration.output||x.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",x.camera.nearFar);x.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",x.inverseViewport),v.bindMultipassTerrainUniforms(this.program,C,x))};r.bindDraw=function(C){h.View.bindView(this.program,C);h.View.bindCamPosition(this.program,C.origin,C.camera.viewInverseTransposeMatrix);
n.Slice.bindUniformsWithOrigin(this.program,this.configuration,C)};r.setPipelineState=function(C,A){const x=this.configuration,m=3===C,B=2===C;return e.makePipelineState({blending:0===x.output||7===x.output?x.transparent&&m?u.blendingDefault:u.OITBlending(C):null,culling:(E=>0!==E&&{face:1===E?1028:1029,mode:2305})(x.cullFace),depthTest:{func:u.OITDepthTest(C)},depthWrite:m?x.writeDepth&&e.defaultDepthWriteParams:u.OITDepthWrite(C),colorWrite:e.defaultColorWriteParams,stencilWrite:x.sceneHasOcludees?
t.stencilWriteMaskOn:null,stencilTest:x.sceneHasOcludees?A?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null,polygonOffset:m||B?x.polygonOffset&&w:u.getOITPolygonOffset(x.enableOffset)})};r.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};r.getPipelineState=function(C){return C?this._occludeePipelineState:this.pipeline};return z}(k.ShaderTechnique);
k.shader=new f.ReloadableShaderModule(l.PatternShader,()=>new Promise(function(D,z){a(["./Pattern.glsl"],D,z)}));const w={factor:1,units:1};f=function(D){function z(){var r=D.apply(this,arguments)||this;r.output=0;r.cullFace=0;r.slicePlaneEnabled=!1;r.vertexColors=!1;r.transparent=!0;r.polygonOffset=!1;r.writeDepth=!0;r.sceneHasOcludees=!1;r.enableOffset=!0;r.transparencyPassType=3;r.multipassTerrainEnabled=!1;r.cullAboveGround=!0;return r}b._inheritsLoose(z,D);return z}(c.ShaderTechniqueConfiguration);
p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter({count:3})],f.prototype,"cullFace",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"vertexColors",void 0);p.__decorate([c.parameter()],f.prototype,"transparent",void 0);p.__decorate([c.parameter()],f.prototype,"polygonOffset",void 0);p.__decorate([c.parameter()],f.prototype,"writeDepth",void 0);p.__decorate([c.parameter()],f.prototype,"sceneHasOcludees",
void 0);p.__decorate([c.parameter({count:6})],f.prototype,"style",void 0);p.__decorate([c.parameter()],f.prototype,"patternSpacing",void 0);p.__decorate([c.parameter()],f.prototype,"lineWidth",void 0);p.__decorate([c.parameter()],f.prototype,"enableOffset",void 0);p.__decorate([c.parameter()],f.prototype,"draped",void 0);p.__decorate([c.parameter({count:4})],f.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],f.prototype,"multipassTerrainEnabled",void 0);p.__decorate([c.parameter()],
f.prototype,"cullAboveGround",void 0);const y={position:0,color:3,uvMapSpace:4,boundingRect:5};g.PatternTechnique=k;g.PatternTechniqueConfiguration=f;g.patternVertexAttributeLocations=y;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){function u(l){const w=new p.ShaderBuilder;l.draped||w.extensions.add("GL_OES_standard_derivatives");const y=1===l.output;w.include(b.Transform,{linearDepth:y});w.include(q.VertexColor,l);w.vertex.uniforms.add("proj","mat4");w.vertex.uniforms.add("view","mat4");y&&(w.include(n.OutputDepth,l),w.vertex.uniforms.add("cameraNearFar","vec2"),w.varyings.add("linearDepth","float"));l.draped?w.vertex.uniforms.add("worldToScreenRatio","float"):(w.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),w.vertex.uniforms.add("camPos","vec3"),w.attributes.add("boundingRect","mat3"));w.attributes.add("position","vec3");w.attributes.add("uvMapSpace","vec4");w.varyings.add("vpos","vec3");w.varyings.add("vuv","vec2");l.multipassTerrainEnabled&&w.varyings.add("depth","float");const D=3===l.style||4===l.style||5===l.style;D&&w.vertex.code.add(g.glsl`
      const mat2 rotate45 = mat2(${g.glsl.float(.70710678118)}, ${g.glsl.float(-.70710678118)},
                                 ${g.glsl.float(.70710678118)}, ${g.glsl.float(.70710678118)});
    `);l.draped||(w.vertex.code.add(g.glsl`
      vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
        float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
        return center + halfVector * clamp(projectedLength, -1.0, 1.0);
      }
    `),w.vertex.code.add(g.glsl`
      vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
        float d = dot(planeNormal, planePoint);
        float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);

        return rayOrigin + t * rayDir;
      }
    `),w.vertex.code.add(g.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${g.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `));w.vertex.code.add(g.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${D?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${D?" * rotate45":""};

      ${l.draped?g.glsl`
            float ratio = worldToScreenRatio;
          `:g.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;

            // Logarithmically discretize ratio to avoid jittering
            float step = 0.1;
            ratio = log(ratio);
            ratio = ceil(ratio / step) * step;
            ratio = exp(ratio);
          `}

      vec2 uvOffset = mod(uvCellOrigin * ratio, ${g.glsl.float(l.patternSpacing)});
      return uvOffset + (uv * ratio);
    }
  `);w.vertex.code.add(g.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${l.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${y?g.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:g.glsl`transformPosition(proj, view, vpos);`}
    }
  `);w.include(k.Slice,l);w.fragment.include(f.ColorConversion);w.fragment.uniforms.add("matColor","vec4");l.draped&&w.fragment.uniforms.add("texelSize","float");4===l.output&&w.include(d.OutputHighlight);l.multipassTerrainEnabled&&(w.fragment.include(c.ReadLinearDepth),w.include(h.multipassTerrainTest,l));4!==l.output&&(w.fragment.code.add(g.glsl`
      const float lineWidth = ${g.glsl.float(l.lineWidth)};
      const float spacing = ${g.glsl.float(l.patternSpacing)};
      const float spacingINV = ${g.glsl.float(1/l.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),l.draped||w.fragment.code.add(g.glsl`
        const int maxSamples = 5;

        float sample(float p) {
          vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
          float fwidth = dxdy.x + dxdy.y;

          ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
          vec2 invSamples = 1.0 / vec2(samples);

          float accumulator = 0.0;

          for (int j = 0; j < maxSamples; j++) {
            if(j >= samples.y) {
              break;
            }

            for (int i = 0; i < maxSamples; i++) {
              if(i >= samples.x) {
                break;
              }

              vec2 step = vec2(i,j) * invSamples - 0.5;
              accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
            }
          }

          accumulator /= float(samples.x * samples.y);
          return accumulator;
        }
      `));w.fragment.code.add(g.glsl`
    void main() {
      discardBySlice(vpos);
      ${l.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${l.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==l.output?g.glsl`color.a *= ${v(l)};`:""}

      if (color.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
        discard;
      }

      ${7===l.output?g.glsl`gl_FragColor = vec4(color.a);`:""}

      ${0===l.output?g.glsl`gl_FragColor = color; ${l.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===l.output?g.glsl`outputHighlight();`:""}
      ${1===l.output?g.glsl`outputDepth(linearDepth);`:""};
    }
  `);return w}function v(l){function w(y){return l.draped?g.glsl`coverage(vuv.${y}, texelSize)`:g.glsl`sample(vuv.${y})`}switch(l.style){case 3:case 0:return w("y");case 4:case 1:return w("x");case 5:case 2:return g.glsl`
        1.0 - (1.0 - ${w("x")}) * (1.0 - ${w("y")})
      `;default:return"0.0"}}var t=Object.freeze({__proto__:null,build:u});a.PatternShader=t;a.build=u})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial".split(" "),function(a,g,b,p,f,k,c,d,e){function h(v,t,l){if(b.isSome(v)){if("none"===v.style||
"solid"===v.style)return"none"===v.style&&(t.color=p.fromValues(0,0,0,0),t.transparent=!0),new d.ColorMaterial(t);t.style=n(v.style);t.draped=l.isDraped;return new e.PatternMaterial(t)}return new d.ColorMaterial(t)}function n(v){switch(v){case "horizontal":return 0;case "vertical":return 1;case "cross":return 2;case "forward-diagonal":return 3;case "backward-diagonal":return 4;case "diagonal-cross":return 5}}function q(v){return v.material instanceof e.PatternMaterial&&!v.material.params.draped}function u(v,
t){if(q(v)){var l=v.geometry.vertexAttributes;v=l.get("position").data;const w=l.get("uvMapSpace").data;l=l.get("boundingRect").data;c.createMapSpaceUVCoords(f.BufferViewVec4f.fromTypedArray(w),f.BufferViewVec3f64.fromTypedArray(v),t,f.BufferViewMat3f64.fromTypedArray(l))}}a.createMaterial=function(v,t,l){return h(v&&v.pattern||null,t,l)};a.createMaterialFromPattern=h;a.parsePatternStyle=n;a.requiresUVUpdates=q;a.updateMapSpaceUVCoords=u;a.uvElevationAligner=function(v,t,l,w){t=k.perVertexElevationAligner(v,
t,l,w);v=v.stageObject.geometryRecords;for(l=0;l<v.length;l++)u(v[l],w);return t};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ../shaders/ColorMaterialTechnique".split(" "),function(a,g,b,p,f,k,c,d){let e=function(q){function u(t){t=q.call(this,
t,n)||this;t.supportsEdges=!0;t.techniqueConfig=new d.ColorMaterialTechniqueConfiguration;return t}g._inheritsLoose(u,q);var v=u.prototype;v.getTechniqueConfig=function(t,l){this.techniqueConfig.output=t;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;
this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.transparencyPassType=l?l.transparencyPassType:3;this.techniqueConfig.enableOffset=l?l.camera.relativeElevation<k.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=l?l.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=l?l.cullAboveGround:!0;return this.techniqueConfig};v.getPassParameters=function(){return this.params};v.intersect=
function(t,l,w,y,D,z,r){p.intersectTriangleGeometry(t,l,y,D,z,void 0,r)};v.getGLMaterial=function(t){return 0===t.output||7===t.output||4===t.output||1===t.output&&this.params.writeLinearDepth?new h(t):void 0};v.createBufferWriter=function(){return new c.DefaultBufferWriter(c.PositionColorLayout)};return u}(f.Material),h=function(q){function u(t){t=q.call(this,t)||this;t.updateParameters();return t}g._inheritsLoose(u,q);var v=u.prototype;v.updateParameters=function(t){this.technique=this.techniqueRep.acquireAndReleaseExisting(d.ColorMaterialTechnique,
this.material.getTechniqueConfig(this.output,t),this.technique)};v.beginSlot=function(t){return 4===this.output?3===t:t===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};v._updateOccludeeState=function(t){t.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:t.hasOccludees})};v.ensureParameters=function(t){0!==this.output&&7!==this.output||this._updateOccludeeState(t);this.updateParameters(t)};v.bind=function(t,
l){t.bindProgram(this.technique.program);this.technique.bindPass(t,this.material.getPassParameters(),l)};v.getPipelineState=function(t,l){return this.technique.getPipelineState(l)};return u}(b);const n={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...f.materialParametersDefaults};a.ColorMaterial=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){k=function(D){function z(){return D.apply(this,arguments)||this}b._inheritsLoose(z,D);var r=z.prototype;r.initializeProgram=function(C){var A=z.shader.get();const x=this.configuration;A=A.build({output:x.output,OITEnabled:0===x.transparencyPassType,attributeColor:x.vertexColors,slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:x.multipassTerrainEnabled,cullAboveGround:x.cullAboveGround});
return new e(C.rctx,A.generateSource("vertex"),A.generateSource("fragment"),d.Default3D)};r.bindPass=function(C,A,x){n.View.bindProjectionMatrix(this.program,x.camera.projectionMatrix);this.program.setUniform4fv("eColor",A.color);4===this.configuration.output&&u.OutputHighlight.bindOutputHighlight(C,this.program,x);(1===this.configuration.output||x.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",x.camera.nearFar);x.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
x.inverseViewport),t.bindMultipassTerrainUniforms(this.program,C,x))};r.bindDraw=function(C){n.View.bindView(this.program,C);q.Slice.bindUniformsWithOrigin(this.program,this.configuration,C)};r.setPipelineState=function(C,A){const x=this.configuration,m=3===C,B=2===C;return h.makePipelineState({blending:0!==x.output&&7!==x.output||!x.transparent?null:m?v.blendingDefault:v.OITBlending(C),culling:(E=>0!==E&&{face:1===E?1028:1029,mode:2305})(x.cullFace),depthTest:{func:v.OITDepthTest(C)},depthWrite:m||
B?x.writeDepth&&h.defaultDepthWriteParams:null,colorWrite:h.defaultColorWriteParams,stencilWrite:x.sceneHasOcludees?l.stencilWriteMaskOn:null,stencilTest:x.sceneHasOcludees?A?l.stencilToolMaskBaseParams:l.stencilBaseAllZerosParams:null,polygonOffset:m||B?x.polygonOffset&&y:v.getOITPolygonOffset(x.enableOffset)})};r.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,
!1)};r.getPipelineState=function(C){return C?this._occludeePipelineState:this.pipeline};return z}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(w.ColorMaterialShader,()=>new Promise(function(D,z){a(["./ColorMaterial.glsl"],D,z)}));const y={factor:1,units:1};f=function(D){function z(){var r=D.apply(this,arguments)||this;r.output=0;r.cullFace=0;r.slicePlaneEnabled=!1;r.vertexColors=!1;r.transparent=!1;r.polygonOffset=!1;r.enableOffset=!0;r.writeDepth=!0;r.sceneHasOcludees=!1;r.transparencyPassType=
3;r.multipassTerrainEnabled=!1;r.cullAboveGround=!0;return r}b._inheritsLoose(z,D);return z}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter({count:3})],f.prototype,"cullFace",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"vertexColors",void 0);p.__decorate([c.parameter()],f.prototype,"transparent",void 0);p.__decorate([c.parameter()],f.prototype,"polygonOffset",
void 0);p.__decorate([c.parameter()],f.prototype,"enableOffset",void 0);p.__decorate([c.parameter()],f.prototype,"writeDepth",void 0);p.__decorate([c.parameter()],f.prototype,"sceneHasOcludees",void 0);p.__decorate([c.parameter({count:4})],f.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],f.prototype,"multipassTerrainEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"cullAboveGround",void 0);g.ColorMaterialTechnique=k;g.ColorMaterialTechniqueConfiguration=f;Object.defineProperty(g,
"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){function u(t){const l=new p.ShaderBuilder,w=1===t.output;l.include(b.Transform,{linearDepth:w});l.include(q.VertexColor,t);l.vertex.uniforms.add("proj","mat4").add("view","mat4");l.attributes.add("position","vec3");l.varyings.add("vpos","vec3");t.multipassTerrainEnabled&&l.varyings.add("depth","float");w&&(l.include(n.OutputDepth,t),l.vertex.uniforms.add("cameraNearFar","vec2"),l.varyings.add("linearDepth","float"));l.vertex.code.add(g.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${t.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${w?g.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:g.glsl`transformPosition(proj, view, vpos);`}
    }
  `);l.include(k.Slice,t);l.fragment.include(f.ColorConversion);t.multipassTerrainEnabled&&(l.fragment.include(c.ReadLinearDepth),l.include(h.multipassTerrainTest,t));l.fragment.uniforms.add("eColor","vec4");4===t.output&&l.include(d.OutputHighlight);l.fragment.code.add(g.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${t.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${g.glsl.float(e.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===t.output?g.glsl`gl_FragColor = vec4(color.a);`:""}

    ${0===t.output?g.glsl`gl_FragColor = highlightSlice(color, vpos); ${t.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===t.output?g.glsl`outputHighlight();`:""};
    ${1===t.output?g.glsl`outputDepth(linearDepth);`:""};
  }
  `);return l}var v=Object.freeze({__proto__:null,build:u});a.ColorMaterialShader=v;a.build=u})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ../../../../chunks/vec2f64 ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/HUDMaterial ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){function D(A,x,m){A&&A.forEach(B=>{const E=x(B);b.isSome(E)&&m(E,B.graphic)})}const z=[0,0,1];t=function(A){function x(B,E,F,G){B=A.call(this,B,E,F,G)||this;B._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};B.ensureDrapedStatus(!1);return B}g._inheritsLoose(x,A);var m=x.prototype;m.doLoad=async function(){if(!this._drivenProperties.size){const B=h.validateSymbolLayerSize(this.symbolLayer.size);if(B)throw new p("graphics3dtextsymbollayer:invalid-size",
B);}this._createTextRenderParameters()};m._createTextRenderParameters=function(){this._textRenderParameters=w.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};m.destroy=function(){A.prototype.destroy.call(this)};m.createGraphics3DGraphic=function(B){B=B.graphic;const E=l.placePointOnGeometry(B.geometry);if(b.isNone(E))return this.logger.warn(`unsupported geometry type for text symbol: ${B.geometry.type}`),null;const F=this.symbolLayer.text;if(!F)return null;
const G=k.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(B,E,F,G)};m.createLabel=function(B,E,F,G){B=B.graphic;const I=l.placePointOnGeometry(B.geometry);if(b.isNone(I))return this.logger.warn(`unsupported geometry type for label: ${B.geometry.type}`),null;const K=E.text;return!K||/^\s+$/.test(K)?null:this._createAs3DShape(B,I,K,E,E,F,G)};m.setGraphicElevationContext=function(B,E,F=0){B=A.prototype.setGraphicElevationContext.call(this,
B,E);B.addOffsetRenderUnits(F);return B};m.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};m.layerElevationInfoChanged=function(B,E){D(B,E,(F,G)=>{this.updateGraphicElevationContext(G,F)});return n.SymbolUpdateType.UPDATE};m.slicePlaneEnabledChanged=function(B,E){D(B,E,F=>{for(const G of F.stageObject.geometryRecords)G.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};m.physicalBasedRenderingChanged=
function(){return!0};m.pixelRatioChanged=function(){return!1};m.updateGraphicElevationContext=function(B,E){this.setGraphicElevationContext(B,E.elevationContext,E.metadata.elevationOffset);E.needsElevationUpdates=n.needsElevationUpdates2D(E.elevationContext.mode)||"absolute-height"===E.elevationContext.mode};m._defaultElevationInfoNoZ=function(){return r};m._createAs3DShape=function(B,E,F,G,I=C,K,J){const L=this.setGraphicElevationContext(B,new u.ElevationContext,I.elevationOffset);var P="polyline"===
b.get(B.geometry,"type"),Q=B.uid;B=this._context.stage.renderView.renderingContext;var X=h.namedAnchorToHUDMaterialAnchorPos[I.anchor in h.namedAnchorToHUDMaterialAnchorPos?I.anchor:"center"];B=b.isNone(J)?new y(B,F,this._textRenderParameters):null;X={occlusionTest:!0,screenOffset:I.screenOffset,anchorPos:X,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:I.centerOffsetUnits,debugDrawBorder:I.debugDrawBorder,drawInSecondSlot:!0};b.isSome(B)&&(X.textureId=B.id,X.texCoordScale=B.texcoordScale);b.isSome(J)&&
(X.textureId=J.id);if(b.isSome(G)&&b.isSome(G.verticalOffset)){const {screenLength:H,minWorldLength:R,maxWorldLength:T}=G.verticalOffset;X.verticalOffset={screenLength:f.pt2px(H),minWorldLength:R||0,maxWorldLength:null!=T?T:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:H,screenSizePerspectiveSettingsLabels:R}=this._context.sharedResources;X.screenSizePerspective=R.overridePadding(this._textRenderParameters.haloSize);X.screenSizePerspectiveAlignment=
H}P&&(X.shaderPolygonOffset=1E-4);X.slicePlaneEnabled=this._context.slicePlaneEnabled;b.isSome(K)?(J=JSON.stringify(X),G=K.get(J),b.isNone(G)&&(G=new e.HUDMaterial(X),K.add(J,G))):G=new e.HUDMaterial(X);G=[G];J=I.translation;P=b.isSome(B)?[B.displayWidth,B.displayHeight]:[0,0];J=[d.createPointGeometry(z,J,null,P,I.centerOffset,[0,0],null)];Q=l.createStageObjectForHUD(this._context,E,J,G,null,null,L,this._context.layer.uid,Q);if(null===Q)return null;P=q.perObjectElevationAligner;K=new v(this,Q.object,
J,b.isNone(K)?G:null,b.isSome(B)?[B]:null,P,L);K.alignedSampledElevation=Q.sampledElevation;K.needsElevationUpdates=n.needsElevationUpdates2D(L.mode)||"absolute-height"===L.mode;const {displayWidth:aa,displayHeight:S}=b.isSome(B)?B:I;K.getScreenSize=(H=c.create())=>{H[0]=aa;H[1]=S;return H};K.metadata={labelText:F,elevationOffset:I.elevationOffset};l.extendPointGraphicElevationContext(K,E,this._context.elevationProvider);return K};return x}(t.Graphics3DSymbolLayer);const r={mode:"relative-to-ground",
offset:0},C={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=t;a.default=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Evented ../../../../core/mathUtils ./ContentObject ../../../webgl/capabilities/isWebGL2Context ../../../webgl/Texture ./TextRenderer".split(" "),
function(a,g,b,p,f,k,c,d){const e={canvas:null};return function(h){function n(u,v,t){var l=h.call(this)||this;l.type=4;l._glTexture=null;l.events=new b;l._requiresPowerOfTwo=!k(u.gl);l._renderer=new d.TextRenderer(v,t);return l}a._inheritsLoose(n,h);var q=n.prototype;q.createDescriptor=function(u){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:u.parameters.maxMaxAnisotropy}};q.load=function(u){if(g.isSome(this._glTexture))return this._glTexture;
const v=d.getTextHelperCanvas(e,this.textureWidth,this.textureHeight),t=v.getContext("2d");t.save();this._renderer.render(t,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new c(u,this.createDescriptor(u),v);t.restore();return this._glTexture};q.unload=function(){g.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};a._createClass(n,[{key:"width",get:function(){return this._renderer.renderedWidth}},{key:"height",get:function(){return this._renderer.renderedHeight}},
{key:"textureWidth",get:function(){const u=this.width;return this._requiresPowerOfTwo?p.nextHighestPowerOfTwo(u):u}},{key:"textureHeight",get:function(){const u=this.height;return this._requiresPowerOfTwo?p.nextHighestPowerOfTwo(u):u}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"texcoordScale",get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/
this.textureHeight]}},{key:"requiresFrameUpdates",get:function(){return!1}}]);return n}(f.ContentObject)})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../chunks/common ../../../../core/unitUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../core/libs/earcut/earcut ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3D ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ./Graphics3DDrapedGraphicLayer ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/internal/waterMaterialUtils ../../webgl-engine/materials/WaterMaterial".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x){const m=["polyline","polygon","extent"];D=function(J){function L(Q,X,aa,S){return J.call(this,Q,X,aa,S)||this}g._inheritsLoose(L,J);var P=L.prototype;P.doLoad=async function(){};P.destroy=function(){J.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};P.createGraphics3DGraphic=function(Q){Q=Q.graphic;if(!this._validateGeometry(Q.geometry,m,this.symbolLayer.type))return null;const X=this.setGraphicElevationContext(Q,
new w.ElevationContext);this.ensureDrapedStatus("on-the-ground"===X.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(Q):this._createAs3DShape(Q,X,Q.uid)};P.ensureMaterial=function(){if(!b.isSome(this._material)){var Q={...A.defaultWaterMaterialParameters},X=this.symbolLayer.color;b.isSome(X)&&(Q.color=p.toUnitRGBA(X));X=this._getCombinedOpacity(X,{hasIntrinsicColor:!0});Q.color=[Q.color[0],Q.color[1],Q.color[2],X];Q.transparent=1>X||this.needsDrivenTransparentPass;Q.waveDirection=
b.isSome(this.symbolLayer.waveDirection)?L.headingVectorFromAngle(this.symbolLayer.waveDirection):e.fromValues(0,0);X=A.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];Q.waveStrength=X.waveStrength;Q.waveTextureRepeat=X.textureRepeat;Q.waveVelocity=X.waveVelocity;Q.flowStrength=X.perturbationStrength;Q.slicePlaneEnabled=this._context.slicePlaneEnabled;Q.isDraped=this.draped;this._material=new x.WaterMaterial(Q);this._context.stage.add(this._material)}};P.layerOpacityChanged=
function(){if(b.isNone(this._material))return!0;const Q=this._material.params.color,X=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[Q[0],Q[1],Q[2],X],transparent:1>X||this.needsDrivenTransparentPass});return!0};P.layerElevationInfoChanged=function(Q,X,aa){const S=this._elevationContext.mode;aa=t.elevationModeChangeUpdateType(L.elevationModeChangeTypes,aa,S);if(aa!==t.SymbolUpdateType.UPDATE)return aa;const H=t.needsElevationUpdates2D(S);
return this.updateGraphics3DGraphicElevationInfo(Q,X,()=>H)};P.slicePlaneEnabledChanged=function(){b.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};P.physicalBasedRenderingChanged=function(){return!0};P.pixelRatioChanged=function(){return!0};P._createAs3DShape=function(Q,X,aa){Q=z.geometryAsPolygon(Q.geometry);if(b.isNone(Q))return null;I.renderData=z.geometryToRenderInfo(Q,this._context.elevationProvider,this._context.renderCoordsHelper,
X);const S=I.renderData.position.length/3;I.uvCoords=new Float64Array(2*S);I.outNum=0;I.outGeometries=[];I.outTransforms=[];I.outMaterials=[];this._create3DShapeGeometries(I);this._logGeometryCreationWarnings(I.renderData,Q.rings,"rings","WaterSymbol3DLayer");if(0===I.outNum)return null;this._createUVCoordsFromVertices(I.uvCoords,I.renderData.mapPosition,S,this._context.elevationProvider.spatialReference);aa=new v.Object3D({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,
castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:aa}});aa=new y(this,aa,I.outGeometries,null,null,l.perVertexElevationAligner,X);aa.alignedSampledElevation=I.renderData.sampledElevation;aa.needsElevationUpdates=t.needsElevationUpdates2D(X.mode);return aa};P._createUVCoordsFromVertices=function(Q,X,aa,S){S=k.getMetersPerUnitForSR(S);c.empty(E);for(var H=0;H<aa;H++)n.set(F,X[3*H],X[3*H+1]),c.expandPointInPlace(E,F);q.scale(E,E,S);H=E[1]%L.unitSizeOfTexture;B[0]=E[0]-E[0]%L.unitSizeOfTexture;
B[1]=E[1]-H;for(H=0;H<aa;H++)Q[2*H]=(X[3*H]*S-B[0])/L.unitSizeOfTexture,Q[2*H+1]=(X[3*H+1]*S-B[1])/L.unitSizeOfTexture};P._create3DShapeGeometries=function(Q){var X=Q.renderData.polygons;const aa=Q.uvCoords;for(const {count:S,index:H,position:R,mapPosition:T,holeIndices:W}of X){if(b.isSome(this._context.clippingExtent)&&(u.empty(G),u.expandWithBuffer(G,T),!u.intersectsClippingArea(G,this._context.clippingExtent)))continue;X=h.earcut(T,W,3);if(0===X.length)continue;X=new Uint32Array(X);const Y=new Float64Array(aa.buffer,
2*H*aa.BYTES_PER_ELEMENT,2*S);X=z.createWaterGeometry({indices:X,attributeData:{position:R,uv0:Y,mapPosition:T}});Q.outGeometries.push(X);Q.outMaterials.push(b.unwrap(this._material));Q.outTransforms.push(d.IDENTITY);Q.outNum++}};P._createAsOverlay=function(Q){const X=z.geometryAsPolygon(Q.geometry);if(b.isNone(X))return null;b.unwrap(this._material).renderPriority=this._renderPriority;K.renderData=z.geometryToRenderInfoDraped(X,this._context.overlaySR);const aa=K.renderData.position.length/3;K.uvCoords=
new Float64Array(2*aa);K.outNum=0;K.outGeometries=[];K.outBoundingBox=u.empty();K.layerUid=this._context.layer.uid;K.graphicsUid=Q.uid;this._createAsOverlayWater(K);this._logGeometryCreationWarnings(K.renderData,X.rings,"rings","WaterSymbol3DLayer");if(0===K.outNum)return null;this._createUVCoordsFromVertices(K.uvCoords,K.renderData.position,aa,this._context.overlaySR);return 0<K.outNum?new r(this,K.outGeometries,K.outBoundingBox):null};P._createAsOverlayWater=function(Q){const X=Q.uvCoords;var aa=
Q.renderData.polygons;for(const {position:H,holeIndices:R,index:T,count:W}of aa)if(u.empty(G),u.expandWithBuffer(G,H),u.intersectsClippingArea(G,this._context.clippingExtent)&&(u.expandWithAABB(Q.outBoundingBox,G),aa=h.earcut(H,R,3),0!==aa.length)){aa=new Uint32Array(aa);var S=new Float64Array(X.buffer,2*T*X.BYTES_PER_ELEMENT,2*W);aa=z.createWaterGeometry({indices:aa,attributeData:{position:H,uv0:S}});aa=new C.RenderGeometry(aa,b.unwrap(this._material),Q.layerUid,Q.graphicsUid);S=G;q.set(aa.boundingSphere,
.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1])));Q.outGeometries.push(aa);Q.outNum++}};L.headingVectorFromAngle=function(Q){const X=e.create();Q=f.toRadian(Q);X[0]=Math.sin(Q);X[1]=Math.cos(Q);return X};g._createClass(L,[{key:"test",get:function(){return{create3DShape:Q=>this._createAs3DShape(Q.graphic,Q.elevationContext,Q.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}]);return L}(D.Graphics3DSymbolLayer);D.unitSizeOfTexture=100;D.elevationModeChangeTypes=
{definedChanged:t.SymbolUpdateType.RECREATE,staysOnTheGround:t.SymbolUpdateType.NONE,onTheGroundChanged:t.SymbolUpdateType.RECREATE};const B=e.create(),E=c.create(),F=e.create(),G=u.create(),I={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},K={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=D;a.default=D;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports","../../../../../chunks/vec2f64","../../lib/Material"],function(a,g,b){g={waveStrength:.06,waveTextureRepeat:32,waveDirection:g.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...b.materialParametersDefaults};a.defaultWaterMaterialParameters=g;
a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,
perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,
waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./internal/MaterialUtil ../lib/Material ../lib/OrderIndependentTransparency ./WaterTechnique ./WaterGLMaterial ./internal/DefaultBufferWriter ../lib/AnimationTimer ./internal/waterMaterialUtils".split(" "),function(a,
g,b,p,f,k,c,d,e,h){p=function(n){function q(v){v=n.call(this,v,h.defaultWaterMaterialParameters)||this;v.animation=new e.AnimationTimer;v.techniqueConfig=new k.WaterTechniqueConfiguration;return v}g._inheritsLoose(q,n);var u=q.prototype;u.getTechniqueConfig=function(v,t){this.techniqueConfig.output=v;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=
this.params.transparent;this.techniqueConfig.useSSR=this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3;this.techniqueConfig.enableOffset=t?t.camera.relativeElevation<f.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=t?t.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=t?t.cullAboveGround:!0;return this.techniqueConfig};u.update=function(v){this.animation.enabled=35E3>Math.sqrt(this.params.waveTextureRepeat/
this.params.waveStrength)*Math.min(v.camera.relativeElevation,v.camera.distance);this.animation.advance(v.dt);return this.animation.enabled};u.intersect=function(v,t,l,w,y,D,z){b.intersectTriangleGeometry(v,t,w,y,D,void 0,z)};u.getGLMaterial=function(v){if(0===v.output&&this.params.isDraped)return v.output=5,new c.WaterGLMaterial(v);switch(v.output){case 0:case 2:case 4:case 7:return new c.WaterGLMaterial(v)}};u.createBufferWriter=function(){return new d.DefaultBufferWriter(d.PositionUVLayout)};return q}(p.Material);
a.WaterMaterial=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../layers/support/timeUtils"],function(a,g,b,p){let f=function(){function k(d=!0){this.enabled=d;this._time=0}var c=k.prototype;c.advance=function(d){this.enabled&&(this._time+=d)};c.stopAtTime=function(d){this._forcedTime=d};g._createClass(k,[{key:"time",get:function(){return b.isSome(this._forcedTime)?
this._forcedTime:p.Milliseconds(this._time)}}]);return k}();a.AnimationTimer=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Loadable","./symbolComplexity"],function(a,g,b,p){return function(f){function k(d,e){var h=f.call(this)||this;h.symbol=d;h.convert=e;h.graphics3DSymbol=null;h.referenced=0;return h}a._inheritsLoose(k,f);var c=k.prototype;
c.getSymbolLayerSize=function(d){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(d):null};c.doLoad=async function(d){d=await this.symbol.fetchSymbol({signal:d});d.id=this.symbol.id;this.graphics3DSymbol=this.convert(d);await this.graphics3DSymbol.load()};c.createGraphics3DGraphic=function(d){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(d,this):null};c.globalPropertyChanged=function(d,e){return g.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.globalPropertyChanged(d,e):!1};c.applyRendererDiff=function(d,e){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(d,e):!1};c.prepareSymbolPatch=function(d){g.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(d)};c.updateGeometry=function(d,e){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(d,e):!1};c.onRemoveGraphic=function(){};c.getFastUpdateStatus=function(){return g.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};c.destroy=function(){g.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};a._createClass(k,[{key:"extentPadding",get:function(){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return g.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:p.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===
this.graphics3DSymbol}}]);return k}(b.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/materials/HUDMaterial ./graphicSymbolUtils".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){function q(m){m=n.getGraphics3DSymbol(m.graphics3DGraphic.graphics3DSymbol);
return b.isSome(m)?m.symbol.symbolLayers.getItemAt(0):null}function u(m,B){var E=B.graphics3DGraphic.graphic.geometry;if(b.isNone(E))return null;if(b.isSome(B.disablePlacement))return B.labelClass.labelPlacement?(z.warnOncePerTick(v(m.placement,B.disablePlacement.logEntityDescription)),t(B)):m;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(B.labelClass.labelPlacement)return z.warnOncePerTick(v(m.placement,`'${E}' geometries`)),t(B)}return m}function v(m,B){return`the requested label placement '${m}' is currently unsupported for ${B} in SceneView`}
function t(m){const B=m.graphics3DGraphic.graphic.geometry;if(b.isNone(B))return null;switch(B.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return m=q(m),b.isSome(m)&&"extrude"===m.type?r["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return r["above-center"];case "mesh":return r["above-center"]}}function l(m,B=A){({graphics3DGraphic:m}=m);m=m._graphics[0];
(m=b.isSome(m)?m.stageObject.geometryRecords[0].material:null)&&m instanceof h.HUDMaterial?(m=m.params.anchorPos,B[0]=2*(m[0]-.5),B[1]=2*(m[1]-.5)):(B[0]=0,B[1]=0);return B}function w(m,B,E){E=E.graphics3DGraphic._graphics[0];E=b.isSome(E)?E.getBoundingBoxObjectSpace(x):x;E=f.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);m.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*B.normalizedOffset[0];const F=m.translation[2],G=E[2]/2*B.normalizedOffset[1];m.translation[2]=0;m.elevationOffset=F+G;E=k.length(E);
m.centerOffset[2]=E/2*B.normalizedOffset[2]}function y(m){const B=m.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:F}=m;var G=n.getGraphics3DSymbol(F.graphics3DSymbol);G=b.isSome(G)?G.symbol:null;m=r[B]||t(m);if("point-3d"===G.type&&G.supportsCallout()&&G.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:D(G.verticalOffset),anchor:null,normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&("point-3d"!==G.type||!G.supportsCallout()||
!G.verticalOffset||F.isDraped)){a:switch(m.placement){case "above-center":G=!0;break a;default:G=!1}return G?{placement:"above-center",verticalOffset:D(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,m.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(z.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+B+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}
function D(m){const {screenLength:B,minWorldLength:E,maxWorldLength:F}=m;return{screenLength:B,minWorldLength:E,maxWorldLength:F}}const z=p.getLogger("esri.views.3d.layers.graphics.labelPlacement"),r={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,
-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};g={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],
"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const m in g){const B=r[m];g[m].forEach(E=>
{r[E]=B})}Object.freeze&&(Object.freeze(r),Object.keys(r).forEach(function(m){Object.freeze(r[m]);Object.freeze(r[m].normalizedOffset)}));const C=[0,0],A=[0,0],x=e.create();a.get=function(m){var B=y(m);if(b.isNone(B))return null;if(B.anchor)var E=B;else{E=m.labelClass.labelPlacement;var F=r[E],G=F||t(m);E&&!F&&z.warnOncePerTick(`the requested label placement '${E}' is not currently supported in SceneView`);E=u(G,m)}if(b.isNone(E))return null;F=!!B.hasLabelVerticalOffset;B={anchor:E.anchor,verticalOffset:B.verticalOffset,
screenOffset:c.create(),centerOffset:d.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:f.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=m.graphics3DGraphic.graphic.geometry;if(b.isNone(F))m=null;else{switch(F.type){case "point":F=q(m);if(!b.isNone(F))switch(m.graphics3DGraphic.getCenterObjectSpace(B.translation),F.type){case "icon":case "text":({graphics3DGraphic:F}=m);G=F._graphics[0];G=b.isSome(G)?G.getScreenSize():null;!F.isDraped&&b.isSome(G)?(m=l(m),C[0]=G[0]/2*(E.normalizedOffset[0]-
m[0]),C[1]=G[1]/2*(E.normalizedOffset[1]-m[1]),B.screenOffset[0]=C[0],B.hasLabelVerticalOffset?(B.centerOffset[1]=C[1],B.centerOffsetUnits="screen"):B.screenOffset[1]=C[1]):B.hasLabelVerticalOffset||"center"===B.anchor||(r[m.labelClass.labelPlacement]&&z.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),B.anchor="center");break;case "object":w(B,E,m)}break;case "polygon":F=q(m);if(!b.isNone(F))switch(F.type){case "extrude":F=m.graphics3DGraphic._graphics[0],
b.isSome(F)&&F.getBoundingBoxObjectSpace(x),e.center(x,B.translation),B.translation[2]=e.height(x)/2,w(B,E,m)}break;case "mesh":w(B,E,m)}m=B}return m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let g=function(){function b(f){this._stage=f;this._materials=new Map}var p=b.prototype;p.get=function(f){return this._materials.get(f)};p.add=function(f,k){this._materials.set(f,k);this._stage.add(k)};p.dispose=
function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return b}();a.MaterialCollection=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../core/mathUtils ../../../../core/uid ../../../support/Scheduler ../../../../core/MapUtils ../../../webgl/Texture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){var r;a.TextTextureAtlas=r=function(C){function A(m){m=C.call(this,m)||this;m.type=4;m.id=w.generateUID();m.events=new t;m.glTexture=null;m.needsClear=!1;m.elementsToAddOrUpdate=new Map;m.elementsToRemove=new Map;m.elementsToRender=new Map;m.elements=new Map;m.stageObjects=new Map;m.updating=!1;return m}g._inheritsLoose(A,C);var x=A.prototype;x.initialize=function(){this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(this);const m=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(m);this.update2DCanvasSize();this.resetAtlasCursor()};x.unload=function(){f.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};x.createDescriptor=function(m){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:m.parameters.maxMaxAnisotropy}};x.load=
function(m){if(f.isSome(this.glTexture))return this.glTexture;this.glTexture=new z(m,this.createDescriptor(m),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(y.Task.TEXT_TEXTURE_ATLAS,B=>this.run(B,!0),()=>this.updating);this.setDirty();return this.glTexture};x.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=f.removeMaybe(this.frameWorker);this.glTexture&&(this.stage.remove(this),this.glTexture=
null);this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};x.create2DCanvas=function(){const m=document.createElement("canvas");m.setAttribute("id","canvas2d");m.setAttribute("style","display:none");m.setAttribute("width",(512).toString());m.setAttribute("height",(512).toString());return m};x.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};x.createAtlasRegion=function(m=
512){this.atlas={size:{width:m,height:m},cursor:{x:0,y:0},lineHeight:0}};x.computeAtlasResolution=function(m,B){m=Math.max(m,B);m=l.nextHighestPowerOfTwo(m+256);return m=Math.min(m,4096)};x.resizeAtlas=function(m,B){B=B||m;const E=this.atlas;E.size.width=m;E.size.height=B;f.isSome(this.glTexture)&&this.glTexture.resize(m,B);this.update2DCanvasSize()};x.resetAtlasCursor=function(){const m=this.atlas;m.cursor.x=2;m.cursor.y=4;m.lineHeight=0;this.needsClear=!0};x.getAtlasUsage=function(){const m=this.atlas;
return(m.cursor.x+m.cursor.y*m.size.width)/(m.size.width*m.size.height)};x.getExpectedAtlasUsage=function(){const m=this.elementsToRemove.size,B=this.elementsToAddOrUpdate.size,E=this.elements.size;return this.getAtlasUsage()/E*(E+B-m)};x.addAtlasElement=function(m,B,E,F){const G=this.atlas,{renderedWidth:I,renderedHeight:K,displayWidth:J,displayHeight:L}=m.textRenderer;m.placement.offset.x=G.cursor.x;m.placement.offset.y=G.cursor.y;m.placement.size.width=I;m.placement.size.height=K;m.placement.size.displayWidth=
J;m.placement.size.displayHeight=L;m.placement.uvMinMax=[m.placement.offset.x/G.size.width,1-(m.placement.offset.y+K)/G.size.height,(m.placement.offset.x+I)/G.size.width,1-m.placement.offset.y/G.size.height];G.cursor.x+=E;G.lineHeight=Math.max(G.lineHeight,F);this.elements.set(B,m)};x.removeAtlasElement=function(m){if(m&&this.elements.has(m.textId)){const B=m.placement.offset,E=m.placement.size;this.ctx.clearRect(B.x,B.y,E.width,E.height);this.elements.delete(m.textId)}};x.ensureStageObjects=function(m){var B=
this.stageObjects.get(m);if(B)return B;B=new Set;this.stageObjects.set(m,B);return B};x.addStageObject=function(m,B){this.ensureStageObjects(m).add(B)};x.removeStageObject=function(m,B){(m=this.stageObjects.get(m))&&m.delete(B)&&(B.geometries[0].vertexAttributes.get("size").data=[0,0],B.geometryVertexAttrsUpdated(0))};x._processAddition=function(m,B){const E=this.atlas;var F=m.textId;const G=m.textRenderer.renderedWidth+2,I=m.textRenderer.renderedHeight+2+2;if(E.cursor.x+G<E.size.width&&E.cursor.y+
I<E.size.height)this.addAtlasElement(m,F,G,I),this.elementsToRender.set(F,m),this.elementsToAddOrUpdate.delete(F);else if(E.cursor.y+I+E.lineHeight<E.size.height)E.cursor.x=2,E.cursor.y+=E.lineHeight,E.lineHeight=0,this.addAtlasElement(m,F,G,I),this.elementsToRender.set(F,m),this.elementsToAddOrUpdate.delete(F);else{m=this.getExpectedAtlasUsage();(F=.85<m&&4096>E.size.width)&&this.resizeAtlas(2*E.size.width,2*E.size.height);if(!B||!F&&.95<m&&4096===E.size.width)return this.processRemovals(),0;this.repack();
return 1}return 0};x.processRemovals=function(){this.elementsToRemove.forEach((m,B)=>{const E=this.stageObjects.get(B);E&&0!==E.size||this.removeAtlasElement(m);E&&0===E.size&&this.stageObjects.delete(B)});this.elementsToRemove.clear()};x.repack=function(){this.processRemovals();this.elements.forEach((m,B)=>{m.rendered=!1;this.elementsToAddOrUpdate.set(B,m)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};x.processRenderingRequest=function(m){this.ctx.clearRect(m.placement.offset.x,
m.placement.offset.y,m.placement.size.width,m.placement.size.height);m.textRenderer.render(this.ctx,m.placement.offset.x,m.placement.offset.y);const B=this.stageObjects.get(m.textId);B&&B.forEach(E=>{E.geometries[0].vertexAttributes.get("uv0").data=new Float32Array(m.placement.uvMinMax);E.geometries[0].vertexAttributes.get("size").data=[m.placement.size.displayWidth,m.placement.size.displayHeight];E.geometryVertexAttrsUpdated(0)});m.rendered=!0};x.run=function(m,B){if(this.glTexture){var E=!1;D.someMap(this.elementsToAddOrUpdate,
(G,I)=>(G=this.elements.get(I))&&G.rendered?((G=this.stageObjects.get(I))&&G.forEach(K=>{const J=K.geometries[0].vertexAttributes,L=this.elements.get(I);J.get("uv0").data=new Float32Array(L.placement.uvMinMax);J.get("size").data=new Float32Array([L.placement.size.displayWidth,L.placement.size.displayHeight]);K.geometryVertexAttrsUpdated(0)}),this.elementsToAddOrUpdate.delete(I),!1):1===this._processAddition(this.elementsToAddOrUpdate.get(I),B)?E=!0:!1);if(E)this.run(y.noBudget,!1);else{var F=!1;0<
this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);D.someMap(this.elementsToRender,(G,I)=>{this.processRenderingRequest(G);this.elementsToRender.delete(I);F=!0;m.madeProgress();return m.done});F&&f.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&r.test.orderedRepackingEnabled&&this.repackOrdered()}}};x.addTextTexture=function(m,B){const E=m.key;this.elementsToAddOrUpdate.has(E)||
this.elementsToAddOrUpdate.set(E,{textId:E,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:m,rendered:!1});this.addStageObject(E,B);this.elementsToRemove.delete(E);this.setDirty()};x.removeTextTexture=function(m,B){m=m.key;this.elementsToRemove.set(m,this.elements.get(m));this.removeStageObject(m,B)};x.setDirty=function(){this.updating=!0};x.repackOrdered=function(){if(0!==this.elements.size){var m=[];this.elements.forEach((E,F)=>m.push({element:E,
key:F}));var B=!0;for(let E=0;E<m.length-1;E++)if(0<m[E].key.localeCompare(m[E+1].key)){B=!1;break}if(!B||this.elementsToRemove.size){m.sort((E,F)=>E.key.localeCompare(F.key));this.elements.clear();for(const {element:E,key:F}of m)this.elements.set(F,E);this.repack();this.setDirty()}}};g._createClass(A,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"test",get:function(){const {elements:m,
stageObjects:B,elementsToRemove:E,atlas:F}=this,G=this;return{elements:m,stageObjects:B,elementsToRemove:E,atlas:F,resizeAtlas:(I,K)=>G.resizeAtlas(I,K),run:(I,K)=>G.run(I,K)}}}]);return A}(v);a.TextTextureAtlas.test={orderedRepackingEnabled:!1};b.__decorate([d.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([d.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=r=b.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);a.default=a.TextTextureAtlas;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/handleUtils ../../../../core/promiseUtils ../../../../core/Handles ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,g,b,p,f,k,c,d,e){let h=function(){function q(){this.gltfCache=new Map;this.wosrCache=
new Map;this.evictHandles=new k}var u=q.prototype;u.loadGLTF=function(v,t,l){return this.fromCache(this.gltfCache,l?`gltfPBR:${v}`:`gltf:${v}`,w=>d.load(new c.DefaultLoadingContext(w.streamDataRequester),v,w,l),t)};u.loadWOSR=function(v,t){return this.fromCache(this.wosrCache,`wosr:${v}:${t.disableTextures}`,l=>e.load(v,l),t)};u.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};u.fromCache=function(v,t,l,w){return new Promise((y,D)=>{if(f.isAborted(w))D(f.createAbortError());
else{var z=f.onAbort(w,()=>{this.remove(v,t);D(f.createAbortError())}),r=v.get(t);if(r)this.evictHandles.remove(t),r.refCount++,r.item.then(y,D);else{r=f.createAbortController();var C={refCount:1,abortController:r,item:l({...w,signal:r.signal}).then(A=>{C.abortController=null;A.remove=()=>this.remove(v,t);return A})};v.set(t,C);C.item.then(A=>{b.isSome(z)&&z.remove();y(A)},A=>{b.isSome(z)&&z.remove();D(A)})}}})};u.remove=function(v,t){const l=v.get(t);l&&(l.refCount--,0===l.refCount&&this.evictHandles.add(p.timeoutHandle(()=>
{v.delete(t);b.isSome(l.abortController)&&l.abortController.abort()},n),t))};g._createClass(q,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return q}(),n=1E4;a.ObjectResourceCache=h;a.test={overrideEvictDelay(q){n=q;return{remove(){n=1E4}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){const x=k.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(E){function F(I){I=E.call(this,I)||this;I.tiles=new l;I.tileSize=512;I._idToTile=new Map;I._handles=new w;I._clients=new Set;I._dirty=!1;I._newTiles=new v;return I}g._inheritsLoose(F,E);var G=F.prototype;G.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(y.init(this,["tileSize",
"cameraOnSurface.location","tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(z.Task.FEATURE_TILE_TREE,I=>this._update(I),()=>this.updating))};G.destroy=function(){this._frameWorker=f.removeMaybe(this._frameWorker);this._handles=f.destroyMaybe(this._handles)};G.addClient=function(){const I=m++;this._clients.add(I);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(I)}};G._removeClient=
function(I){this._clients.delete(I);this._hasClients||this._clear()};G._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(z.noBudget))};G._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};G._update=function(I){this._dirty=!1;this._pendingTiles||(this._startUpdate(),f.isSome(this._frameWorker)&&(this._frameWorker.task=z.Task.FEATURE_TILE_TREE_ACTIVE));
this._subdivideTilesForView(I);!this._pendingTiles&&f.isSome(this._frameWorker)&&(this._frameWorker.task=z.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};G._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new C.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:10})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,
this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())};G._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};G._getRootTiles=function(){return this.rootTileIds.map(I=>new r.FeatureTileDescriptor3D(I[0],I[1],I[2],this.tilingScheme))};G._purgeHorizonTiles=function(I){I.sort((K,J)=>{K=K.measures.screenRect;J=J.measures.screenRect;return K[1]+K[3]-(J[1]+J[3])});D.empty(B);for(let K=0;K<I.length;K++)if(D.expand(B,
I.data[K].measures.screenRect),10<D.height(B))return I.data.slice(K,I.length);return[]};G._subdivideTilesForView=function(I){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!I.done;){const K=this._pendingTiles.pop();I.madeProgress();if(!this.filterExtentRect||D.intersects(this.filterExtentRect,K.extent))this._tileMeasurements.updateTile(K),0!==K.measures.visibility&&(K.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(K.lij[0]+1),this._pendingTiles.push(...K.getChildren())):this._newTiles.push(K))}0===
this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};G._updateTiles=function(I){for(var K of this.tiles.items)K.used=!1;I=I.filter(J=>{const L=this._idToTile.get(J.id);L?(L.copyMeasurementsFrom(J),L.used=!0):this._idToTile.set(J.id,J);return!L});K=this.tiles.items.filter(J=>J.used?!1:(this._idToTile.delete(J.id),!0));this.tiles.removeMany(K);this.tiles.addMany(I);this.sortTiles()};G.sortTiles=
function(){this.viewState.fixedContentCamera||this.tiles.sort((I,K)=>I.measures.visibility!==K.measures.visibility?2===I.measures.visibility?-1:1:I.measures.distance-K.measures.distance);this.tiles.forEach((I,K)=>I.loadPriority=K)};g._createClass(F,[{key:"tilingScheme",get:function(){const I=this.tilingSchemeOwner.tilingScheme;return I?I.clone():null}},{key:"filterExtent",set:function(I){if(I&&!I.spatialReference.equals(this.viewState.spatialReference))x.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var K=this._get("filterExtent");K===I||K&&I&&K.equals(I)||(I=I?I.clone():null,this._set("filterExtent",I),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(!this.filterExtent||!this.tilingScheme)return null;const I=D.create();A.toBoundingRect(this.filterExtent,I,this.tilingScheme.spatialReference);return I}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(I){I!==this._get("suspended")&&
(this._set("suspended",I),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}}]);return F}(t);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);
b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);b.__decorate([d.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([d.property()],a.FeatureTileTree3D.prototype,
"tileSize",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([d.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"rootTileIds",null);b.__decorate([d.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([d.property({readOnly:!0})],
a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([h.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let m=0;const B=D.create();a.default=a.FeatureTileTree3D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,g){let b=function(){function p(k,c,d,e=null){this.lij=[0,0,0];this.extent=g.create();this.loadPriority=
this.resolution=0;this.measures={visibility:2,screenRect:g.create(),distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(k,c,d,e)}var f=p.prototype;f.acquire=function(k,c,d,e){this.tilingScheme=e;this.id=p.id(k,c,d);this.lij[0]=k;this.lij[1]=c;this.lij[2]=d;e.getExtent(k,c,d,this.extent);this.resolution=e.resolutionAtLevel(k)};f.release=function(){this.tilingScheme=null};f.getChildren=function(k){const c=this.lij[0]+1,d=2*this.lij[1],e=2*this.lij[2];if(!k)return[new p(c,d,e,this.tilingScheme),
new p(c,d+1,e,this.tilingScheme),new p(c,d,e+1,this.tilingScheme),new p(c,d+1,e+1,this.tilingScheme)];k[0].acquire(c,d,e,this.tilingScheme);k[1].acquire(c,d+1,e,this.tilingScheme);k[2].acquire(c,d,e+1,this.tilingScheme);k[3].acquire(c,d+1,e+1,this.tilingScheme);return k};f.copyMeasurementsFrom=function(k){this.measures.visibility=k.measures.visibility;this.measures.shouldSplit=k.measures.shouldSplit;this.measures.distance=k.measures.distance;g.set(k.measures.screenRect,this.measures.screenRect)};
p.id=function(k,c,d){return`${k}/${c}/${d}`};return p}();a.FeatureTileDescriptor3D=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingRect ../../support/geometryUtils ../../webgl-engine/lib/Camera ./FeatureTileVisibility3D".split(" "),function(a,g,b,p,f,k,c,d){let e=function(){function y(z){this.camera=
new c;this.focusOnMap=[0,0];this.screenRect=f.create();this.tileSize=z.tileSize;this.maxVerticalScreenSize=z.maxVerticalScreenSize;this.renderCoordsHelper=z.renderCoordsHelper;this.tilingScheme=z.tilingScheme;this.visibility=new d(z.renderCoordsHelper)}var D=y.prototype;D.begin=function(z,r,C){this.camera.copyFrom(z);this.surfaceElevation=C;this.focusOnMap[0]=r.x;this.focusOnMap[1]=r.y;f.fromValues(0,0,z.fullWidth,z.fullHeight,this.screenRect);this.visibility.begin(this.camera,C)};D.end=function(){this.visibility.end()};
D.updateTile=function(z){z.measures.visibility=this.visibility.calculate(z);z.measures.distance=f.distance(z.extent,this.focusOnMap);0!==z.measures.visibility&&this.updateScreenMeasure(z)};D.updateScreenMeasure=function(z){const r=z.measures.screenRect;f.empty(r);let C=0;const A=z.lij[0]+2,x=z.lij[1]<<2,m=z.lij[2]<<2;var B=this.tileSizeWithBias(z);B*=B;var E=!1;for(let F=0;4>F;F++){for(let G=0;4>G&&!(E=this.computeScreenArea(z,A,x+F,m+G,r),C+=E.area,E=C>B&&f.height(r)>this.maxVerticalScreenSize);G++);
if(E)break}z.measures.shouldSplit=C>B};D.tileSizeWithBias=function(z){return 1===z.measures.visibility?5*this.tileSize:this.tileSize};D.computeScreenArea=function(z,r,C,A,x){const m=q.points;this.projectToScreen(r,C,A,1===z.measures.visibility,m);f.empty(h);for(z=0;4>z;z++)f.expandPointInPlace(h,m[z]);f.expand(x,h);f.intersection(h,this.screenRect,n);q.screenOverlap=f.area(n)/f.area(h);q.area=k.triangle.areaPoints2d(m[0],m[1],m[2])+k.triangle.areaPoints2d(m[0],m[2],m[3]);return q};D.projectToScreen=
function(z,r,C,A,x){this.tilingScheme.ensureMaxLod(z);this.tilingScheme.getExtent(z,r,C,u);this.toRenderCoords(u,0,3,t[0]);this.toRenderCoords(u,2,3,t[1]);this.toRenderCoords(u,2,1,t[2]);this.toRenderCoords(u,0,1,t[3]);A&&(this.projectToPlane(t,this.camera.frustum[4]),this.projectToPlane(t,this.camera.frustum[3]),this.projectToPlane(t,this.camera.frustum[2]));for(z=0;4>z;z++)this.camera.projectToRenderScreen(t[z],w),this.camera.renderToScreen(w,x[z])};D.projectToPlane=function(z,r){for(var C=0;4>
C;C++)l[C]=k.plane.signedDistance(r,z[C]);C=Math.max(l[0],l[1],l[2],l[3]);if(0<C)for(r=p.scale(v,k.plane.normal(r),-C),C=0;4>C;C++)p.add(z[C],z[C],r)};D.toRenderCoords=function(z,r,C,A){v[0]=z[r];v[1]=z[C];v[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(v,this.tilingScheme.spatialReference,A);return A};return y}();const h=f.create(),n=f.create(),q={points:[g.createScreenPointArray(),g.createScreenPointArray(),g.createScreenPointArray(),g.createScreenPointArray()],area:0,screenOverlap:0},
u=f.create(),v=b.create(),t=[b.create(),b.create(),b.create(),b.create()],l=[0,0,0,0],w=g.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("../../../../core/ObjectPool ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../support/geometryUtils ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,g,b,p,f,k,c,d,e){let h=function(){function t(w){this.renderCoordsHelper=w;this.surfaceElevation=0;this.cache=new Map;this.frustum=new d.Frustum(w);this.extendedFrustum=new d.Frustum(w);this.intersector=new e.FrustumExtentIntersection({renderCoordsHelper:w});this.renderCoordsHelper=w}var l=t.prototype;l.begin=function(w,y){this.surfaceElevation=y;this.aboveGround=this.renderCoordsHelper.getAltitude(w.eye)>y;this.frustum.update(w);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(w)};
l.end=function(){this.cache.clear()};l.calculate=function(w){if(this.allTilesInvisible)return 0;const y=1===this.renderCoordsHelper.viewingMode&&2<=w.lij[0]&&6>w.lij[0],D=this.getOrCalculateSingleTileVisibility(w,!y);return 0!==D&&y?this.calculateAggregatedChildrenVisibility(w):D};l.shortenFrustumFarPlane=function(w){var y=d.Frustum.nearFarLineIndices;const D=w.mutablePoints;for(const z of y){const [r,C]=z;y=D[r];p.subtract(n,D[C],y);p.scale(n,n,.95);p.add(D[C],y,n)}w.updatePoints(D)};l.calculateAggregatedChildrenVisibility=
function(w){let y=0;var D=this.cache.get(w.id);if(null!=D)return D;D=v.acquire();w.getChildren(D);for(const z of D){const r=this.calculate(z);if(0!==r&&(y=r,2===r))break}v.release(D);this.cache.set(w.id,y);return y};l.getOrCalculateSingleTileVisibility=function(w,y){var D=this.cache.get(w.id);if(null!=D)return D;D=this.calculateSingleTileVisibility(w);y&&this.cache.set(w.id,D);return D};l.calculateSingleTileVisibility=function(w){if(!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&12>w.lij[0]){if(0===
this.calculateSingleTileVisibilitySided(w,!1))return this.calculateSingleTileVisibilitySided(w,!0)}else return this.calculateSingleTileVisibilitySided(w,this.aboveGround)};l.calculateSingleTileVisibilitySided=function(w,y){this.intersector.update(w.extent,w.tilingScheme.spatialReference,this.surfaceElevation,y);w=f.getReferenceEllipsoid(w.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,w)?this.intersector.isVisibleInFrustum(this.frustum,w,!0)?
2:1:0};l.updateExtendedFrustum=function(w){this.extendedFrustum.update(w);this.shortenFrustumFarPlane(this.extendedFrustum);var y=this.renderCoordsHelper.worldUpAtPosition(w.eye,n);this.aboveGround||p.negate(y,y);y=g.acosClamped(-p.dot(y,w.viewForward));this.allTilesInvisible=y>(Math.PI+w.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=y>w.fovY/2)){w=this.extendedFrustumParameters();y=this.extendedFrustum.mutablePoints;for(let D=0;4>D;D++){const z=w.pointIndices[D],r=y[z],C=this.renderCoordsHelper.getAltitude(r);
if(w.needsAltitudeAdjustment(C)){this.renderCoordsHelper.worldUpAtPosition(r,n);switch(z){case 4:case 7:case 0:case 3:k.plane.projectVector(this.extendedFrustum.planes[0],n,n);break;case 5:case 6:case 1:case 2:k.plane.projectVector(this.extendedFrustum.planes[1],n,n)}p.scale(n,n,w.direction);this.renderCoordsHelper.intersectInfiniteManifold(k.ray.wrap(r,n),w.zWithMargin,r)}}this.extendedFrustum.updatePoints(y);k.plane.fromPoints(y[0],y[1],y[2],q);k.plane.fromPoints(y[1],y[2],y[3],u);0>p.dot(k.plane.normal(q),
k.plane.normal(u))&&(w=this.extendedFrustum.mutablePoints,this.aboveGround?[w[0],w[1]]=[w[1],w[0]]:[w[3],w[2]]=[w[2],w[3]],this.extendedFrustum.updatePoints(w))}};l.extendedFrustumParameters=function(){return this.aboveGround?this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()};l.extendedFrustumParametersAboveSurface=function(){const w=this.surfaceElevation-1;return{zWithMargin:w,pointIndices:d.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(y){return y>
w}}};l.extendedFrustumParametersBelowSurface=function(){const w=this.surfaceElevation+1;return{zWithMargin:w,pointIndices:d.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(y){return y<w}}};return t}();const n=b.create(),q=k.plane.create(),u=k.plane.create(),v=new a(Array,t=>{4!==t.length&&(t[0]=new c.FeatureTileDescriptor3D,t[1]=new c.FeatureTileDescriptor3D,t[2]=new c.FeatureTileDescriptor3D,t[3]=new c.FeatureTileDescriptor3D)},t=>{t[0].release();t[1].release();t[2].release();t[3].release()});
return h})},"esri/views/3d/state/Frustum":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../chunks/frustum".split(" "),function(a,g,b,p,f,k){function c(e,h,n){e.origin=h;e.endpoint=n;f.directionFromTo(e.direction,h,n)}let d=function(){function e(n){this.renderCoordsHelper=n;this.frustum=k.create();this._points=k.createPoints();this.lines=Array(12);this.origin=b.create();this.direction=b.create();this._altitude=
null;for(n=0;12>n;n++)this.lines[n]={origin:null,direction:b.create(),endpoint:null}}var h=e.prototype;h.update=function(n){k.fromMatrix(n.viewMatrix,n.projectionMatrix,this.frustum,this._points);p.copy(this.origin,n.eye);p.copy(this.direction,n.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};h.updatePoints=function(n){for(let q=0;q<this._points.length;q++)p.copy(this._points[q],n[q]);k.computePlanes(this.frustum,this._points);this.updateLines()};h.intersectsSphere=
function(n){return k.intersectsSphere(this.frustum,n)};h.intersectsRay=function(n){return k.intersectsRay(this.frustum,n)};h.intersectsLineSegment=function(n,q){return k.intersectsLineSegment(this.frustum,n,q)};h.intersectsPoint=function(n){return k.intersectsPoint(this.frustum,n)};h.updateLines=function(){const n=this._points;for(let q=0;4>q;q++){const u=q,v=q+4;c(this.lines[q],n[u],n[v]);c(this.lines[q+4],n[u],3===q?n[0]:n[u+1]);c(this.lines[q+8],n[v],3===q?n[4]:n[v+1])}};g._createClass(e,[{key:"planes",
get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},{key:"altitude",get:function(){return this._altitude}}]);return e}();d.planePointIndices=k.planePointIndices;d.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];a.Frustum=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../geometry/projectionEllipsoid ../../../chunks/mat4 ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../chunks/mat4f64 ../../../geometry/support/aaBoundingBox ./geometryUtils ./intersectionUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){const t=.5*Math.PI,l=t/Math.PI*180;let w=function(){function x(B){this.renderCoordsHelper=B.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:p.create(),direction:p.create()};for(B=0;4>B;B++)this.extent[B]={origin:p.create(),direction:p.create(),cap:{next:null,direction:p.create()}},this.planes[B]=u.plane.create();this.planes[4]=u.plane.create();this.planes[5]=u.plane.create();this.planesWithoutFar=this.planes.slice(0,
5)}var m=x.prototype;m.update=function(B,E,F,G=!0){const I=this.extent;this.toRenderBoundingExtent(B,E,F);f.add(this.center.origin,I[0].origin,I[2].origin);f.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);G||f.scale(this.center.direction,this.center.direction,-1);for(F=0;4>F;F++){const K=I[F];this.renderCoordsHelper.worldUpAtPosition(K.origin,K.direction);const J=I[3===F?0:F+1];K.cap.next=J.origin;k.directionFromTo(K.cap.direction,
K.origin,J.origin);u.plane.fromVectorsAndPoint(K.direction,K.cap.direction,K.origin,this.planes[F]);G||f.scale(K.direction,K.direction,-1)}u.plane.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this.planes[4]);G?u.plane.negate(this.planes[4],this.planes[5]):(u.plane.copy(this.planes[4],this.planes[5]),u.plane.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(B[0]-B[2]),Math.abs(B[1]-B[3]));this.maxSpanSpatialReference=E;this.minGlobalAltitude=.9*c.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};
m.isVisibleInFrustum=function(B,E,F=!1){if(null==B)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?l:t*E))return!0;if(B.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(B)}if(0===this.maxSpan)return E=this.extent[0],!F&&B.intersectsRay(u.ray.wrap(E.origin,E.direction))?!0:!1;for(E=0;E<this.extent.length;E++){var G=this.extent[E];if(!F&&B.intersectsRay(u.ray.wrap(G.origin,G.direction))||B.intersectsLineSegment(u.lineSegment.fromPoints(G.origin,
G.cap.next,A),G.cap.direction))return!0}F=F?this.planes:this.planesWithoutFar;for(E=0;E<B.lines.length;E++)if(G=B.lines[E],v.frustumLineSegment(F,G.origin,G.endpoint,G.direction))return!0;return!1};m.toRenderBoundingExtentGlobal=function(B,E,F){e.center(B,D);D[2]=F;h.computeLinearTransformation(E,D,z,this.renderCoordsHelper.spatialReference);d.invert(r,z);q.empty(C);for(const {x0:G,x1:I,y0:K,y1:J}of y)for(let L=0;5>L;L++){const P=L/4;D[0]=b.lerp(B[G],B[I],P);D[1]=b.lerp(B[K],B[J],P);D[2]=F;h.projectVectorToVector(D,
E,D,this.renderCoordsHelper.spatialReference);f.transformMat4(D,D,r);q.expandWithVec3(C,D)}f.set(this.extent[0].origin,C[0],C[1],C[2]);f.set(this.extent[1].origin,C[3],C[1],C[2]);f.set(this.extent[2].origin,C[3],C[4],C[2]);f.set(this.extent[3].origin,C[0],C[4],C[2]);for(B=0;4>B;++B)f.transformMat4(this.extent[B].origin,this.extent[B].origin,z)};m.toRenderBoundingExtentLocal=function(B,E){f.set(this.extent[0].origin,B[0],B[1],E);f.set(this.extent[1].origin,B[2],B[1],E);f.set(this.extent[2].origin,
B[2],B[3],E);f.set(this.extent[3].origin,B[0],B[3],E)};m.toRenderBoundingExtent=function(B,E,F){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(B,E,F);break;case 2:this.toRenderBoundingExtentLocal(B,F);break;default:g.neverReached(this.renderCoordsHelper.viewingMode)}};m.isVisibleInFrustumGlobal=function(B){if(0>f.dot(this.center.direction,B.direction))return!0;for(let E=0;4>E;E++)if(0>f.dot(this.extent[E].direction,B.direction))return!0;return!1};return x}();
const y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],D=p.create(),z=n.create(),r=n.create(),C=q.create(),A=u.lineSegment.create();a.FrustumExtentIntersection=w;a.default=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,g,b,p){const f=b.create();a.projectToBoundingBox=function(k,c,d){if(null==k||
g.isNone(d))return!1;let e;f[0]=null!=k.xmin?k.xmin:0;f[1]=null!=k.ymin?k.ymin:0;f[2]=null!=k.zmin?k.zmin:0;e=p.projectBuffer(f,k.spatialReference,0,c,d,0,1);f[0]=null!=k.xmax?k.xmax:0;f[1]=null!=k.ymax?k.ymax:0;f[2]=null!=k.zmax?k.zmax:0;e=e&&p.projectBuffer(f,k.spatialReference,0,c,d,3,1);null==k.xmin&&(c[0]=-Infinity);null==k.ymin&&(c[1]=-Infinity);null==k.zmin&&(c[2]=-Infinity);null==k.xmax&&(c[3]=Infinity);null==k.ymax&&(c[4]=Infinity);null==k.zmax&&(c[5]=Infinity);return e};a.toBoundingRect=
function(k,c,d){if(null==k)return!1;let e;f[0]=null!=k.xmin?k.xmin:0;f[1]=null!=k.ymin?k.ymin:0;f[2]=null!=k.zmin?k.zmin:0;e=p.projectBuffer(f,k.spatialReference,0,f,d,0,1);c[0]=f[0];c[1]=f[1];f[0]=null!=k.xmax?k.xmax:0;f[1]=null!=k.ymax?k.ymax:0;f[2]=null!=k.zmax?k.zmax:0;e=e&&p.projectBuffer(f,k.spatialReference,0,f,d,0,1);c[2]=f[0];c[3]=f[1];null==k.xmin&&(c[0]=-Infinity);null==k.ymin&&(c[1]=-Infinity);null==k.xmax&&(c[2]=Infinity);null==k.ymax&&(c[3]=Infinity);return e};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/support/PropertiesPool":function(){define(["exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(a,g,b){let p=function(){function f(c,d){this.owner=d;this.properties={};this.afterDispatchHandle=null;for(const e in c)d=new g.ReentrantObjectPool(c[e],null,null,2,2),this.properties[e]={pool:d,acquired:[]};this.afterDispatchHandle=b.afterDispatch(()=>this.release())}var k=f.prototype;k.destroy=function(){this.afterDispatchHandle&&
(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const c in this.properties){const d=this.properties[c];for(const e of d.acquired)b.isValueInUse(e)||d.pool.release(e);d.pool.destroy();d.pool=null;d.acquired=null}this.owner=this.properties=null};k.get=function(c){const d=this.owner._get(c);c=this.properties[c];let e=c.pool.acquire();for(c.acquired.push(e);e===d;)c.acquired.push(e),e=c.pool.acquire();return e};k.release=function(){for(const c in this.properties){const d=this.properties[c];
let e=0;for(const h of d.acquired)b.isValueInUse(h)?d.acquired[e++]=h:d.pool.release(h);d.acquired.length=e}};return f}();a.PropertiesPool=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/accessorSupport/watch ../../../core/Accessor ../../../core/Evented ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ../webgl-engine/lib/Camera ./controllers/CameraController ./controllers/AnimationController ../support/PropertiesPool".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){b=function(E){function F(){var I=E.call(this)||this;I._propertiesPool=new A.PropertiesPool({camera:z},a._assertThisInitialized(I));I._lastSeenCameraProjectionValues=new z;I.events=new t;I.mode=1;I._cameraChanged=!1;I.updateQueue=[];I.processingUpdates=!1;return I}a._inheritsLoose(F,E);var G=F.prototype;G.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new A.PropertiesPool({camera:z},this)};G.init=
function(I,K){this._set("mode",I);this._set("spatialReference",K);1===this.mode?(I=w.getReferenceEllipsoid(K).radius,I=new z(l.fromValues(4*I,0,0),l.fromValues(I,0,0),l.fromValues(0,0,1))):I=new z(l.fromValues(0,0,100),l.fromValues(0,0,0),l.fromValues(0,1,0));this.camera=I;this._set("constraints",new D["default"]({mode:this.mode}))};G.switchCameraController=function(I){this.cameraController=I;return I.state!==r.State.Rejected};G.stopActiveCameraController=function(){return this.cameraController&&
!this.cameraController.stopController()?!1:!0};G.updateCamera=function(I){this.updateQueue.push(I);this.processUpdateQueue()};G.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var I=this.updateQueue.shift();x.copyFrom(this._get("camera"));I(x);this.camera=x;this.processingUpdates=!1;this.processUpdateQueue()}};G.cameraProjectionChanged=function(I,K){return I.fov!==K.fov||I.fullViewport[0]!==K.fullViewport[0]||I.fullViewport[1]!==K.fullViewport[1]||
I.fullViewport[2]!==K.fullViewport[2]||I.fullViewport[3]!==K.fullViewport[3]||I.padding[0]!==K.padding[0]||I.padding[1]!==K.padding[1]||I.padding[2]!==K.padding[2]||I.padding[3]!==K.padding[3]?!0:!1};a._createClass(F,[{key:"animation",get:function(){return this.cameraController instanceof C.AnimationController&&p.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(I){I!==x&&x.copyFrom(I);x.markViewDirty();
x.computeUp(this.mode);m.camera=x;this.events.emit("before-camera-change",m);I=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,x)&&(this._lastSeenCameraProjectionValues.copyFrom(x),B.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",B));if(!I||!I.equals(x))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(x)),this._cameraChanged=!I||!I.almostEquals(x)){const K=u.afterDispatch(()=>{this._cameraChanged=!1;K.remove()})
}}},{key:"contentCamera",get:function(){return p.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(I){this._contentCamera=p.isSome(I)?I.clone():null}},{key:"fixedContentCamera",get:function(){return!!p.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return!this.isLocal}},{key:"isLocal",get:function(){return 2===this.mode}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&
!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(I){this.stopActiveCameraController()?(I&&(I.watch("state",K=>{if(K===r.State.Finished||K===r.State.Stopped)this._set("cameraController",null),this.updateCamera(J=>I.onControllerEnd(J))},!0),I.onControllerStart(this.camera)),this._set("cameraController",I)):I&&(I.state=r.State.Rejected)}}]);return F}(v);g.__decorate([c.property({readOnly:!0,type:y})],b.prototype,"animation",null);g.__decorate([c.property({type:z})],
b.prototype,"camera",null);g.__decorate([c.property({})],b.prototype,"_contentCamera",void 0);g.__decorate([c.property({type:z})],b.prototype,"contentCamera",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"constraints",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"events",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"isGlobal",null);g.__decorate([c.property({readOnly:!0})],b.prototype,
"isLocal",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"mode",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"spatialReference",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"navigating",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"stationary",null);g.__decorate([c.property()],b.prototype,"_cameraChanged",void 0);g.__decorate([c.property()],b.prototype,"cameraController",null);g=b=g.__decorate([e.subclass("esri.views.3d.state.ViewState")],
b);const x=new z,m={camera:null},B={camera:null};return g})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../core/screenUtils ../../../Camera ../../../core/Handles ../../../Viewpoint ../../../core/watchUtils ../../../chunks/vec4f64 ../../../chunks/vec4 ../camera/intersectionUtils ../camera/constraintUtils ../webgl-engine/lib/Camera ../support/cameraUtils ./Frustum ../support/PropertiesPool ./ConstraintsManager ./controllers/SurfaceCollisionCorrectionController ../support/viewpointUtils ./GoToOperation".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P){const Q=f.getLogger("esri.views.3d.state.ViewStateManager");b=function(W){function Y(N){N=W.call(this,N)||this;N.propertiesPool=new I.PropertiesPool({frustum:G.Frustum},a._assertThisInitialized(N));N.handles=new z;N.cameraSetByUser=!1;N.gotoOperation=null;N.ready=!1;N.updateDevicePixelRatio=null;return N}a._inheritsLoose(Y,W);var U=Y.prototype;U.paddingToArray=function(N,ca,O){N?x.set(O,N.top||0,N.right||0,N.bottom||0,N.left||
0):x.set(O,0,0,0,0);for(N=0;4>N;N++)O[N]=Math.round(O[N]*ca)};U.initialize=function(){this.handles.add([this.view.state.watch("camera",N=>this.cameraChangedSync(N),!0),C.on(this.view,"state.events","before-camera-change",N=>this.updateElevation(N.camera))]);C.once(this.view.state,"camera",N=>this.updateElevation(N),!0);this.handles.add(u.addFrameTask({prepare:()=>this.prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));
this.handles.add(C.on(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))};U.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};U.init=function(){this.constraintsManager=new K["default"]({view:this.view});this.prepareFrame();var N=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const ca of N)this.set(ca.name,ca.value);
this.cameraSetByUser||((N=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(N)?this.setInitialView(N):2===this.view.state.mode&&this.handles.add(C.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this.setInitialView(this.view.groundExtent)}),"pending-initial-view"))};U.deinit=function(){this.cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),
this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};U.goTo=async function(N,ca){ca={animate:!0,...ca};p.isSome(this.gotoOperation)&&this.gotoOperation.abort(ca.animate);return this.gotoOperation=new P.GoToOperation(N,ca,this.view)};U.debugSetCameraOnContent=function(){this.setStateCamera(m.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};U.step=function(N){const ca=this.view.state,
O=ca&&this.view.state.cameraController;O&&(ca.updateCamera(V=>{O.stepController(N,V)}),O.steppingFinished&&O.finishController())};U.cancelGoToOperation=function(){p.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};U.getInitialProperties=function(){const N=new Set,ca=[];for(const {propertyName:O,overrides:V}of aa){const ba=N.has(O),fa=this._isOverridden(O);!ba&&fa&&ca.push({name:O,value:this._get(O)});this._clearOverride(O);(ba||fa)&&V.forEach(ia=>N.add(ia))}return ca};
U.setInitialView=function(N){if(N&&!this.cameraSetByUser)if(N instanceof D)this.setStateCamera(F.externalToInternal(this.view,N),{applyConstraints:!1});else if(N instanceof r)if(N.targetGeometry instanceof w){var ca=F.fromExtent(this.view,N.targetGeometry,0,.5,0);p.isSome(ca)&&this.setStateCamera(F.externalToInternal(this.view,ca),{applyConstraints:!0})}else ca={applyConstraints:!N.camera},N=this.viewpointToCamera(N),this.setStateCamera(N,ca);else ca=F.fromExtent(this.view,N,0,.5,0),p.isSome(ca)&&
this.setStateCamera(F.externalToInternal(this.view,ca),{applyConstraints:!0})};U.updatePropertyBeforeReady=function(N,ca){if(this.ready)return!1;this._override(N,ca);ca&&-1!==X.indexOf(N)&&this._override("hasInitialView",!0);return!0};U.isCompatible=function(N){return p.isNone(N)?!1:N instanceof r?N.camera?this.isCompatible(N.camera):this.isCompatible(N.targetGeometry):N instanceof D?this.isCompatible(N.position):N.spatialReference&&t.canProject(N.spatialReference,this.view.spatialReference)};U.getPreservingHeadingTilt=
function(N=S){this.cameraSetByUser?(N.heading=this.camera.heading,N.tilt=this.camera.tilt):(N.heading=0,N.tilt=.5);return N};U.centerPointAtDistanceToCamera=function(N,ca,O=R){const {heading:V,tilt:ba}=this.getPreservingHeadingTilt();N=F.getObserverForPointAtDistance(this.view,V,ba,N,ca,1);if(p.isNone(N))return null;O.copyFrom(this.view.state.camera);O.eye=N.eye;O.center=N.center;O.up=N.up;return O};U.centerToCamera=function(N){const ca=this.view.pointsOfInterest.centerOnContent;ca.update();return this.centerPointAtDistanceToCamera(N,
ca.distance)};U.extentToCamera=function(N){const {heading:ca,tilt:O}=this.getPreservingHeadingTilt();N=F.fromExtent(this.view,N,ca,O,1,H);return p.isSome(N)?F.externalToInternal(this.view,N):null};U.scaleToCamera=function(N){if(null==N)return null;const ca=this.view.pointsOfInterest.centerOnContent;ca.update();const O=ca.renderLocation;N=F.scaleToDistance(this.view,N,ca.location.latitude);return this.centerPointAtDistanceToCamera(O,N)};U.zoomToCamera=function(N){return this.scaleToCamera(F.zoomToScale(this.view,
N))};U.viewpointToCamera=function(N){return F.externalToInternal(this.view,L.toCamera(this.view,N))};U.setStateCamera=function(N,ca){if(p.isNone(N)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;ca.doNotCancelGoToOperation||this.cancelGoToOperation();this.view.state.updateCamera(O=>{ca.positionAndOrientationOnly?(O.eye=N.eye,O.center=N.center,O.up=N.up):O.copyFrom(N);ca.applyConstraints&&B.applyAll(this.view,O)});ca.applyConstraints||(this.view.state.cameraController=
new J.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:N}));return!0};U.prepareFrame=function(){const {container:N,canvas:ca}=this.view;if(N&&ca){p.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var O=this.view.pixelRatio,V=Math.round(N.clientWidth*O),ba=Math.round(N.clientHeight*O);if(0!==V&&0!==ba){if(ca.width!==V||ca.height!==ba)ca.width=V,ca.height=ba;if(this.view.state){const fa=this.view.state.camera;if(fa.fullWidth!==V||fa.fullHeight!==ba||fa.pixelRatio!==
O)R.copyFrom(fa),R.pixelRatio!==O&&(this.paddingToArray(this.padding,O,T),R.padding=T),R.fullWidth=V,R.fullHeight=ba,R.pixelRatio=O,this.view.state.camera=R}}}};U.updateElevation=function(N){var ca=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const O=this.view.renderCoordsHelper.getAltitude(N.eye);ca=ca?m.surfaceElevationBelowRenderLocation(this.view,N.eye):0;N.relativeElevation=O-ca};U.cameraChangedSync=function(N){N&&this.view._stage&&(this.view._stage.camera=N)};a._createClass(Y,
[{key:"camera",get:function(){const N=this._get("camera");if(!this.ready)return N;const ca=F.internalToExternal(this.view,this.view.state.camera);return ca&&N&&ca.equals(N)?N:ca},set:function(N){this.updatePropertyBeforeReady("camera",N)||this.setStateCamera(F.externalToInternal(this.view,N),{applyConstraints:!1})||Q.error("#camera\x3d","Invalid camera",N)}},{key:"contentCamera",get:function(){const N=this._get("contentCamera");if(!this.ready)return N;const ca=F.internalToExternal(this.view,this.view.state.contentCamera);
return ca&&N&&ca.equals(N)?N:ca},set:function(N){this.updatePropertyBeforeReady("contentCamera",N)||(N=F.externalToInternal(this.view,N),p.isNone(N)?this.view.state.contentCamera=null:(this.updateElevation(N),this.view.state.contentCamera=N))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(N){this.updatePropertyBeforeReady("center",N)||(N?this.isCompatible(N)?this.setStateCamera(this.centerToCamera(N),{applyConstraints:!0})?
this.view.pointsOfInterest.centerOnContent.update():Q.error("#center\x3d","Invalid center",N):Q.error("#center\x3d","Center has an incompatible spatial reference (center: "+(N.spatialReference?N.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",N):Q.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var N=this.view;N=F.toExtent(N,N.state.camera,N.pointsOfInterest.centerOnContent.renderLocation);
return p.isSome(N)?N:this._get("extent")},set:function(N){this.updatePropertyBeforeReady("extent",N)||(N?this.isCompatible(N)?this.setStateCamera(this.extentToCamera(N),{applyConstraints:!0})||Q.error("#extent\x3d","Invalid extent",N):Q.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(N.spatialReference?N.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",N):Q.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const N=
this.propertiesPool.get("frustum");N.renderCoordsHelper=this.view.renderCoordsHelper;N.update(this.view.state.camera);return N}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const N=this.view.pointsOfInterest.centerOnContent;return F.distanceToScale(this.view,N.distance,N.location.latitude)}return this._get("scale")},set:function(N){this.updatePropertyBeforeReady("scale",N)||this.setStateCamera(this.scaleToCamera(N),
{applyConstraints:!0})||Q.error("#scale\x3d","Invalid scale",N)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var N=this.view.state.camera,ca=N.padding;const O=N.pixelRatio;N=this._get("padding");const V=Math.round(ca[0]/O),ba=Math.round(ca[1]/O),fa=Math.round(ca[2]/O);ca=Math.round(ca[3]/O);return null!=N&&N.top===V&&N.right===ba&&N.bottom===fa&&N.left===ca?N:{top:V,right:ba,bottom:fa,left:ca}},set:function(N){this.updatePropertyBeforeReady("padding",N)||(this.paddingToArray(N,
this.view.state.camera.pixelRatio,T),this.view.state.updateCamera(ca=>ca.padding=T))}},{key:"screenCenter",get:function(){const N=this.padding;return y.createScreenPoint((this.view.width-(N.left+N.right))/2+N.left,(this.view.height-(N.top+N.bottom))/2+N.top)}},{key:"viewpoint",get:function(){return this.ready?L.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(N){if(!this.updatePropertyBeforeReady("viewpoint",N))if(N)if(this.isCompatible(N))this.setStateCamera(this.viewpointToCamera(N),
{applyConstraints:!N.camera})||Q.error("#viewpoint\x3d","Invalid viewpoint",N);else{var ca=p.isSome(N.camera)?N.camera.position:N.targetGeometry;ca=p.isSome(ca)&&ca.spatialReference;Q.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(ca?ca.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",N)}else Q.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?F.scaleToZoom(this.view,this.scale):this._get("zoom")},
set:function(N){this.updatePropertyBeforeReady("zoom",N)||this.setStateCamera(this.zoomToCamera(N),{applyConstraints:!0})||Q.error("#zoom\x3d","Invalid zoom",N)}}]);return Y}(v);g.__decorate([c.property({type:D,dependsOn:["view.state.camera","ready"]})],b.prototype,"camera",null);g.__decorate([c.property({type:D,dependsOn:["view.state.contentCamera","ready"]})],b.prototype,"contentCamera",null);g.__decorate([c.property({type:l})],b.prototype,"center",null);g.__decorate([c.property({type:w})],b.prototype,
"extent",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"frustum",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"hasInitialView",null);g.__decorate([c.property({readOnly:!0,type:Boolean})],b.prototype,"ready",void 0);g.__decorate([c.property({type:Number})],b.prototype,"scale",null);g.__decorate([c.property()],b.prototype,"padding",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"screenCenter",null);g.__decorate([c.property({constructOnly:!0})],b.prototype,"view",
void 0);g.__decorate([c.property({type:r})],b.prototype,"viewpoint",null);g.__decorate([c.property({type:Number})],b.prototype,"zoom",null);g.__decorate([c.property({constructOnly:!0})],b.prototype,"updateDevicePixelRatio",void 0);g=b=g.__decorate([e.subclass("esri.views.3d.state.ViewStateManager")],b);const X="camera viewpoint extent scale center zoom".split(" "),aa=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center",
"scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],S={heading:0,tilt:0},H=new D,R=new E,T=A.create();return g})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../../../core/Handles ../../../core/watchUtils ../camera/intersectionUtils ../camera/constraintUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r){a.ConstraintsManager=function(C){function A(m){var B=C.call(this,m)||this;B._handles=new l;B.nearFarHeuristic=z.createNearFarHeuristic(m.view.state.mode,m.view.basemapTerrain,m.view.renderCoordsHelper.spatialReference);return B}g._inheritsLoose(A,C);var x=A.prototype;x.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",m=>this._updateCameraNearFar(m.camera)),this.view.watch("dataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(w.init(this.view,"dataExtent",m=>this._updateLocalSurfaceDistance(m)));this._updateNearFar();2!==this.view.state.mode&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new r["default"]({view:this.view}))};x.destroy=function(){this._handles=f.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};x._clipDistanceNearFarChanged=function(){const m=this.view.constraints&&this.view.constraints.clipDistance;m&&"auto"!==m.mode&&this.view.state.updateCamera(B=>{this._updateCameraNearFarManual(B,m);return!0})};x._updateNearFar=function(){this.view.state.updateCamera(m=>{this._updateCameraNearFar(m);return!0})};x._updateCameraNearFar=function(m){const B=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(B?B.mode:"auto")?this._updateCameraNearFarManual(m,
B):this._updateCameraNearFarAuto(m,B)};x._updateCameraNearFarAuto=function(m,B){this.nearFarHeuristic.compute(m.eye,m.center,this.view.dataExtent,y.surfaceElevationBelowRenderLocation(this.view,m.eye),m);B&&B.autoUpdate(m.near,m.far)};x._updateCameraNearFarManual=function(m,B){B&&(m.near=B.near,m.far=B.far)};x._updateCollision=function(){var m,B,E;const F=null==(m=this.view.map)?void 0:null==(B=m.ground)?void 0:null==(E=B.navigationConstraint)?void 0:E.type;m=F?"stay-above"===F:!0;B=this.view.state.constraints.collision;
m!==B.enabled&&((B.enabled=m)&&this._reapplyConstraints(8),(m=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==m.mode||this._updateTiltAuto())};x._updateAltitude=function(){const m=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=m&&2!==this.view.state.mode?{min:m.min,max:m.max}:null;this._reapplyConstraints()};x._updateTiltMax=function(){const m=this.view.constraints&&this.view.constraints.tilt;m&&"auto"!==m.mode&&(this._updateTiltManual(m),this._reapplyConstraints())};
x._updateTilt=function(){const m=this.view.constraints&&this.view.constraints.tilt;"manual"===(m?m.mode:"auto")?this._updateTiltManual(m):this._updateTiltAuto();this._reapplyConstraints()};x._updateTiltManual=function(m){const B=this.view.state.constraints;B.tilt=B.createConstantMaxTilt(t.deg2rad(m.max))};x._updateTiltAuto=function(){const m=this.view.state.constraints;m.tilt=m.createDefaultTilt();this._updateTiltAutoMax()};x._updateTiltAutoMax=function(){const m=this.view.constraints&&this.view.constraints.tilt;
if(m&&"auto"===m.mode){var B=this.view.state.constraints;B.tilt&&(B=B.tilt(this.view.state.camera.distance).max,m.autoUpdate(t.rad2deg(B)))}};x._updateLocalSurfaceDistance=function(m){var B=Math.max(m.width,m.height);0>=B||(m.hasZ&&(B=Math.max(B,m.zmax-m.zmin)),m=this.view.state,B=3*B/Math.atan(m.camera.fov/2),B!==m.constraints.distance&&(m.constraints.distance=B))};x._reapplyConstraints=function(m=15){this.view.state.updateCamera(B=>D.applyAll(this.view,B,{selection:m,interactionType:0,interactionFactor:null,
interactionStartCamera:null,interactionDirection:null,tiltMode:0}))};return A}(v);b.__decorate([d.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([h.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);a.default=a.ConstraintsManager;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../core/unitUtils".split(" "),
function(a,g,b,p,f,k){function c(q,u,v,t){v=2/v;q/u>v?(t.far=q,t.near=t.far/u):(t.near=v,t.far=t.near*u);return t}let d=function(){function q(u,v){this.elevationProvider=u;this._referenceEllipsoid=f.getReferenceEllipsoid(v);this.unitInMeters=k.getMetersPerUnitForSR(v,this._referenceEllipsoid.metersPerDegree)}q.prototype.compute=function(u,v,t,l,w){w||(w={near:0,far:0});var y=u[2]*this.unitInMeters,D=y;l=y-l;var z=this.elevationProvider?this.elevationProvider.elevationBounds:null;z&&(y=0<=l?D-this.unitInMeters*
z.min:this.unitInMeters*z.max-D);D=Math.max(t.xmax-t.xmin,t.ymax-t.ymin,4*Math.max(t.xmax-t.xmin,t.ymax-t.ymin));p.subtract(n,v,u);h[0]=0<n[0]?t.xmax:t.xmin;h[1]=0<n[1]?t.ymax:t.ymin;h[2]=0<n[2]?D/2:-D/2;p.subtract(h,h,u);p.normalize(n,n);u=1.1*p.dot(h,n)*this.unitInMeters;v=Math.sqrt(y*(y+2*this._referenceEllipsoid.radius));t=Math.max(t.xmax-t.xmin,t.ymax-t.ymin);z=1E-4*t*this.unitInMeters;y=g.clamp((y-z)/(.001*t*this.unitInMeters-z),0,1);y=g.lerp(v,u,y*y*y);y*=Math.max(Math.log(Math.abs(l)),1);
y=Math.min(y,Math.max(34064E4,D));y/=this.unitInMeters;return c(y,2E4,this.unitInMeters,w)};return q}(),e=function(){function q(u){this._referenceEllipsoid=f.getReferenceEllipsoid(u)}q.prototype.compute=function(u,v,t,l,w){w||(w={near:0,far:0});u=p.length(u)-this._referenceEllipsoid.radius;u=Math.max(Math.abs(u-l),Math.abs(u));l=Math.sqrt(u*(u+2*(this._referenceEllipsoid.radius+Math.min(0,l))));u=g.clamp(2E4-(Math.log(u)-7.983)/9.011*19E3,1E3,2E4);return c(1.2*l,u,1,w)};return q}();const h=b.create(),
n=b.create();a.createNearFarHeuristic=function(q,u,v){return 1===q?new e(v):new d(u,v)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../support/mathUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../support/stack ../../../chunks/lineSegment ../../../chunks/ray ../../../chunks/sphere ../../../chunks/boundedPlane ../../../chunks/clipRay ../../../chunks/frustum ../../../chunks/triangle ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E){a.SurfaceCollisionConstraint=function(F){function G(K){K=F.call(this,K)||this;K.handles=new l;return K}g._inheritsLoose(G,F);var I=G.prototype;I.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",K=>this.handleElevationChangeEvent(K)))};I.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};I.handleElevationChangeEvent=function(K){this.view.state.cameraController||B.eyeWithinExtent(this.view,
this.view.state.camera,K.extent,K.spatialReference)&&this.applyToCurrentCamera()};I.applyToCurrentCamera=function(){this.view.state.updateCamera(K=>{E.applySurfaceCollisionConstraint(this.view,K,1)})};return G}(u);b.__decorate([c.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);a.default=a.SurfaceCollisionConstraint;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../support/mathUtils ../../../../core/Handles ../../../../geometry/projectionEllipsoid ../../support/stack ../../../../chunks/lineSegment ../../../../chunks/ray ../../../../chunks/sphere ../../../../chunks/boundedPlane ../../../../chunks/clipRay ../../../../chunks/frustum ../../../../chunks/triangle ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E){a.SurfaceCollisionCorrectionController=function(F){function G(K){K=F.call(this,K)||this;K.handles=new t;return K}g._inheritsLoose(G,F);var I=G.prototype;I.onControllerStart=function(){this.state=E.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",K=>this.handleElevationChangeEvent(K)));this.applyCorrection()};I.onControllerEnd=function(){this.handles.removeAll()};I.stepController=function(){};I.handleElevationChangeEvent=
function(K){m.eyeWithinExtent(this.view,this.desiredCamera,K.extent,K.spatialReference)&&this.applyCorrection()};I.applyCorrection=function(){this.view.state.updateCamera(K=>{K.copyViewFrom(this.desiredCamera);B.applySurfaceCollisionConstraint(this.view,K,1)||this.constraintEnabled||(this.state=E.State.Stopped)})};g._createClass(G,[{key:"desiredCamera",set:function(K){this._set("desiredCamera",K.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return G}(E.CameraController);b.__decorate([c.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([e.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../core/has ../../../core/maybe ../../../core/Error ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../Graphic ../../../core/asyncUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../Camera ../../../Viewpoint ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../geometry/support/aaBoundingBox ./ElevationProvider ./geometryUtils ../camera/intersectionUtils ./cameraUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(ka){return 360-l.cyclicalDeg.normalize(ka)}function I(ka){return l.cyclicalDeg.normalize(360-ka)}function K(ka){b.isSome(ka)&&ka.resolver&&ka.resolver.reject();return null}function J(ka,ha,na,da=null){if(!ha)return K(da);var oa=ka.spatialReference||k.WGS84;if(b.isSome(ha.camera)){ka=ha.get("camera.position.spatialReference");if(!d.canProject(ka,oa))return K(da);ha=ha.camera.clone();ka.equals(oa)||(ha.position=d.project(ha.position,
oa));ka=ha;b.isSome(da)&&da.resolver&&da.resolver.resolve(ka);return ka}if(b.isNone(ha.targetGeometry))return K(da);var qa=ha.get("targetGeometry.spatialReference");if(qa&&!d.canProject(qa,oa))return K(da);oa=F.internalToExternal(ka,ka.state.camera);qa=1;null!=ha.rotation&&(oa.heading=G(ha.rotation),qa=0);null!=na&&(oa.tilt=na);if("point"===ha.targetGeometry.type){const ua=ha.targetGeometry;na=ha.targetGeometry.clone();ha=null!=ha.scale?F.scaleToDistance(ka,ha.scale,ua.latitude):ka.state.camera.distance;
return F.fromCenterDistance(ka,na,ha,oa,qa,da)}return F.fromExtent(ka,ha.targetGeometry.extent,oa.heading,oa.tilt,qa,da)}function L(ka,ha){return null==ha.scale&&null!=ha.zoom?F.zoomToScale(ka,ha.zoom):ha.scale}function P(ka,ha){let na=!1;null!=ha.heading?(ka.heading=ha.heading,na=!0):null!=ha.rotation&&(ka.heading=G(ha.rotation),na=!0);null!=ha.tilt&&(ka.tilt=ha.tilt,na=!0);null!=ha.fov&&(ka.fov=ha.fov);return na}function Q(ka,ha,na,da){const oa=ka.spatialReference||k.WGS84;ha=b.isSome(ha)?ha:F.externalToInternal(ka,
na);if(b.isNone(ha))return da;da.targetGeometry=z.projectVectorToPoint(ha.center,ka.renderSpatialReference,oa);da.scale=F.computeScale(ka,ha);da.rotation=I(na.heading);da.camera=na;return da}function X(ka,ha,na){if(ha){if(!d.canProject(ha.spatialReference,ka.spatialReference))throw new p("viewpointutils:incompatible-spatialreference",`Spatial reference (${ha.spatialReference?ha.spatialReference.wkid:"unknown"}) is incompatible with the view (${ka.spatialReference.wkid})`,{geometry:ha});var da=[];
if(!ha.hasZ&&ka.basemapTerrain){switch(ha.type){case "point":var oa=ha;break;case "multipoint":case "polyline":case "mesh":oa=ha.extent.center;break;case "extent":oa=ha.center;break;case "polygon":oa=ha.centroid}oa&&d.canProject(oa,ka.basemapTerrain.spatialReference)?ca[2]=b.unwrapOr(m.getElevationAtPoint(ka.elevationProvider,oa),0):ca[2]=0}(0,la[ha.type])(ha,ua=>{da.push(ua[0],ua[1],ua[2])},ca);var qa=da.length/3;if(0!==qa&&(oa=Array(da.length),z.projectBuffer(da,ha.spatialReference,0,oa,ka.spatialReference,
0,qa)))for(ha.hasZ&&(na.hasZ=!0),ka=0;ka<oa.length;ka+=3)ha.hasZ?(ca[0]=oa[ka+0],ca[1]=oa[ka+1],ca[2]=oa[ka+2]):(ca[0]=oa[ka+0],ca[1]=oa[ka+1]),x.expandWithVec3(na.boundingBox,ca)}}async function aa(ka,ha,na,da){const oa=await u.result(ka.whenViewForGraphic(ha));if(!1!==oa.ok&&!b.isNone(oa.value)&&"whenGraphicBounds"in oa.value)if(na=await u.result(oa.value.whenGraphicBounds(ha,{minDemResolution:na})),!1===na.ok)X(ka,ha.geometry,da);else{var {screenSpaceObjects:qa,boundingBox:ua}=na.value;x.expandWithAABB(da.boundingBox,
ua);qa&&qa.forEach(Ca=>{da.screenSpaceObjects.push(Ca)});isFinite(ua[2])&&(da.hasZ=!0)}else X(ka,ha.geometry,da)}async function S(ka,ha,na,da){if(Array.isArray(ha)&&2===ha.length){const oa=ha[0],qa=ha[1];if("number"===typeof oa&&"number"===typeof qa){Z.x=oa;Z.y=qa;Z.z=void 0;Z.spatialReference=ka.spatialReference.isGeographic?ka.spatialReference:k.WGS84;X(ka,Z,da);return}}ha&&"function"===typeof ha.map?await f.eachAlways(ha.map(oa=>S(ka,oa,na,da))):ha instanceof c?X(ka,ha,da):ha instanceof q&&await aa(ka,
ha,na,da)}async function H(ka,ha,na,da,oa){if(b.isSome(ha.camera))return R(ka,ha.camera,oa);oa.scale=ha.scale;oa.rotation=ha.rotation;oa.targetGeometry=b.isSome(ha.targetGeometry)?ha.targetGeometry.clone():null;oa.camera=null;null!=na.heading?oa.rotation=I(na.heading):null!=na.rotation&&(oa.rotation=na.rotation);ha=L(ka,na);null!=ha&&(oa.scale=ha);da=new F.AsyncContext(da);J(ka,oa,na.tilt,da);oa.camera=await da.resolver.promise;return oa}function R(ka,ha,na){const da=ka.spatialReference,oa=ha.position.spatialReference;
if(!d.canProject(oa,da))return null;ha=ha.clone();ha.fov=ka.camera.fov;oa.equals(da)||(ha.position=d.project(ha.position,da));return Q(ka,null,ha,na)}async function T(ka,ha,na,da,oa,qa){if(b.isNone(na))throw new p("createfromcenter","invalid point");qa.targetGeometry=na.clone();const ua=E.cameraOnContentAlongViewDirection(ka);if(ha.position)return na=qa.targetGeometry,oa=ka.renderSpatialReference,z.projectPointToVector(ha.position,ma,oa),z.projectPointToVector(na,ea,oa),qa.targetGeometry=new e(na),
da.position=new e(ha.position),t.subtract(ia,ea,ma),F.directionToHeadingTilt(ka,ma,ia,ua.up,da),qa.scale=F.distanceToScale(ka,t.distance(ma,ea),qa.targetGeometry.latitude),qa.rotation=I(da.heading),qa.camera=da,qa;if(ha.zoomFactor){var Ca=ua.distance/ha.zoomFactor;const Ja=t.scale(ca,ua.viewForward,-Ca);t.add(ua.eye,ua.center,Ja);ua.markViewDirty();qa.scale=F.distanceToScale(ka,Ca,na.latitude)}F.internalToExternal(ka,ua,da);Ca=P(da,ha)?0:1;ha.zoomFactor||(qa.scale=L(ka,ha),null==qa.scale&&(z.projectPointToVector(na,
ca,ka.renderSpatialReference),B.frustum.intersectsPoint(ua.frustum,ca)?qa.scale=F.distanceToScale(ka,t.distance(ua.eye,ca),na.latitude):qa.scale=F.computeScale(ka,ua)),ha=new F.AsyncContext(oa),F.fromCenterScale(ka,qa.targetGeometry,qa.scale,da,Ca,ha),qa.camera=await ha.resolver.promise);return qa}async function W(ka,ha,na,da,oa){var qa=E.cameraOnContentAlongViewDirection(ka);qa=z.projectVectorToPoint(qa.center,ka.renderSpatialReference,ka.spatialReference);return T(ka,ha,qa,na,da,oa)}async function Y(ka,
ha,na,da,oa,qa){qa.targetGeometry=na.clone();const ua=E.cameraOnContentAlongViewDirection(ka);F.internalToExternal(ka,ua,da);ha=P(da,ha)?0:1;oa=new F.AsyncContext(oa);F.fromExtent(ka,na,da.heading,da.tilt,ha,oa);qa.camera=await oa.resolver.promise;return qa}async function U(ka,ha,na,da,oa,qa,ua,Ca){Ca.targetGeometry=na.clone();const Ja=E.cameraOnContentAlongViewDirection(ka);var Ha=0;na.hasZ?Ha=na.z:ka.basemapTerrain&&(Ha=b.unwrap(m.getElevationAtPoint(ka.elevationProvider,na)));t.set(ca,na.x,na.y,
Ha);z.computeLinearTransformation(ka.spatialReference,ca,O,ka.renderSpatialReference);A.fromMat4(V,O);A.transpose(V,V);x.empty(ba);na=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Na=0;Na<na.length;Na++){const Oa=na[Na];let Va=da[Oa[2]];isFinite(Va)||(Va=Ha);t.set(ca,da[Oa[0]],da[Oa[1]],Va);z.projectVectorToVector(ca,ka.spatialReference,ca,ka.renderSpatialReference);x.expandWithVec3(ba,t.transformMat3(ca,ca,V))}da=x.width(ba);Ha=x.height(ba);na=x.depth(ba);Na=1/Math.tan(Ja.fovY/
2);oa=Math.max(.5*Math.sqrt(da*da+na*na)*Math.max(Na,1/Math.tan(Ja.fovX/2))+.5*Ha,.5*Ha*Na+.5*Math.max(da,na))/oa;F.internalToExternal(ka,Ja,qa);ha=P(qa,ha)?0:1;Ca.scale=F.distanceToScale(ka,oa,Ca.targetGeometry.latitude);ua=new F.AsyncContext(ua);F.fromCenterScale(ka,Ca.targetGeometry,Ca.scale,qa,ha,ua);Ca.camera=await ua.resolver.promise;return Ca}function N(ka){ka&&b.isSome(ka.camera)&&(ka.rotation=I(ka.camera.heading));return ka}const ca=v.create(),O=C.create(),V=r.create(),ba=x.create(),fa=D.create(),
ia=v.create(),ma=v.create(),ea=v.create(),M={heading:0,tilt:0},Z=new e,la={point(ka,ha,na){na[0]=ka.x;na[1]=ka.y;ka.hasZ&&(na[2]=ka.z);ha(na)},polygon(ka,ha,na){const da=ka.hasZ;for(let oa=0;oa<ka.rings.length;oa++){const qa=ka.rings[oa];for(let ua=0;ua<qa.length;ua++)na[0]=qa[ua][0],na[1]=qa[ua][1],da&&(na[2]=qa[ua][2]),ha(na)}},polyline(ka,ha,na){const da=ka.hasZ;for(let oa=0;oa<ka.paths.length;oa++){const qa=ka.paths[oa];for(let ua=0;ua<qa.length;ua++)na[0]=qa[ua][0],na[1]=qa[ua][1],da&&(na[2]=
qa[ua][2]),ha(na)}},multipoint(ka,ha,na){const da=ka.points;ka=ka.hasZ;for(let oa=0;oa<da.length;oa++)na[0]=da[oa][0],na[1]=da[oa][1],ka&&(na[2]=da[oa][2]),ha(na)},extent(ka,ha,na){ka.hasZ?(ha(t.set(na,ka.xmin,ka.ymin,ka.zmin)),ha(t.set(na,ka.xmax,ka.ymin,ka.zmin)),ha(t.set(na,ka.xmin,ka.ymax,ka.zmin)),ha(t.set(na,ka.xmax,ka.ymax,ka.zmin)),ha(t.set(na,ka.xmin,ka.ymin,ka.zmax)),ha(t.set(na,ka.xmax,ka.ymin,ka.zmax)),ha(t.set(na,ka.xmin,ka.ymax,ka.zmax)),ha(t.set(na,ka.xmax,ka.ymax,ka.zmax))):(ha(t.set(na,
ka.xmin,ka.ymin,na[2])),ha(t.set(na,ka.xmax,ka.ymin,na[2])),ha(t.set(na,ka.xmin,ka.ymax,na[2])),ha(t.set(na,ka.xmax,ka.ymax,na[2])))},mesh(ka,ha,na){if(ka=ka.vertexAttributes&&ka.vertexAttributes.position)for(let da=0;da<ka.length;da+=3)ha(t.set(na,ka[da+0],ka[da+1],ka[da+2]))}};a.create=async function(ka,ha,na){if(ha&&ka.spatialReference){var da={target:null};if("declaredClass"in ha||Array.isArray(ha))da.target=ha;else{for(var oa in ha)da[oa]=ha[oa];ha.center&&!da.target&&(da.target=ha.center)}ha=
da}else ha=null;if(!ha)throw new p("viewpointutils-create:no-target","Missing target for creating viewpoint");da=new w({fov:ka.camera.fov});oa=new y({camera:da});if(ha.target instanceof y)return ka=await H(ka,ha.target,ha,na,oa),N(ka);if(ha.target instanceof w)return N(R(ka,ha.target,oa));var qa=null!=ha.scale||null!=ha.zoom;if(ha.target instanceof h){var ua=ha.target.xmin===ha.target.xmax||ha.target.ymin===ha.target.ymax;return qa||ua?N(await T(ka,ha,ha.target.center,da,na,oa)):N(await Y(ka,ha,ha.target,
da,na,oa))}ua={boundingBox:x.empty(),hasZ:!1,screenSpaceObjects:[]};var Ca=qa?F.scaleToResolution(ka,L(ka,ha)):void 0;await S(ka,ha.target,Ca,ua);if(isFinite(ua.boundingBox[0])){x.center(ua.boundingBox,ca);Z.x=ca[0];Z.y=ca[1];Z.z=ca[2];Z.spatialReference=ka.spatialReference;isFinite(Z.z)&&ua.hasZ?Ca=x.isPoint(ua.boundingBox):(Z.z=void 0,Ca=D.isPoint(x.toRect(ua.boundingBox,fa)));if(qa||Ca)return N(await T(ka,ha,Z,da,na,oa));qa=ua.screenSpaceObjects;if(qa.length){Ca=Number.NEGATIVE_INFINITY;for(let Ja=
0;Ja<qa.length;Ja++){const Ha=qa[Ja].screenSpaceBoundingRect;Ca=Math.max(Ca,Math.abs(Ha[0]),Math.abs(Ha[1]),Math.abs(Ha[2]),Math.abs(Ha[3]))}qa=.66-Ca/Math.min(ka.width,ka.height)*2}else qa=.66;return N(await U(ka,ha,Z,ua.boundingBox,qa,da,na,oa))}return ha.position?(na=E.cameraOnContentAlongViewDirection(ka),t.copy(ia,na.viewForward),F.directionToHeadingTilt(ka,na.eye,ia,na.up,M),da.position=new e(ha.position),da.heading=null!=ha.heading?ha.heading:M.heading,da.tilt=null!=ha.tilt?ha.tilt:M.tilt,
ka=Q(ka,null,da,oa),N(ka)):N(await W(ka,ha,da,na,oa))};a.fromCamera=function(ka,ha,na=null){b.isNone(na)&&(na=new y);return Q(ka,null,ha.clone(),na)};a.headingToRotation=I;a.rotationToHeading=G;a.toCamera=J;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../core/maybe ../../../core/Error ../../../core/promiseUtils ../../../Camera ../../../Viewpoint ../../../core/watchUtils ../camera/constraintUtils/surfaceCollision ../../animation/easing ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ../support/cameraUtils ./controllers/SurfaceCollisionCorrectionController ../support/viewpointUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){let l=function(){function w(D,z,r){this.target=D;this.options=z;this.view=r;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((C,A)=>{this.resolveCallback=C;this.rejectCallback=A;C=p.createAbortController();if(g.isSome(this.options.signal))p.onAbort(this.options.signal,()=>{this.abort()});this.abortController=C;this.waitForReady()})}var y=w.prototype;y.then=function(D,z){return this.promise.then(D,z)};y.catch=function(D){return this.promise.catch(D)};
y.resolve=function(D){this.state="finished";return this.resolveCallback(D)};y.reject=function(D){this.state="finished";return this.rejectCallback(D)};y.abort=function(D=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(p.createAbortError());break;case "wait-for-animation-finish":!D&&g.isSome(this.animationController)&&this.view.stateManager.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(p.createAbortError())}};y.waitForReady=function(){this.state="wait-for-ready";this.view.stateManager.view.ready?this.createViewPoint():c.whenOnce(this.view.stateManager.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},D=>{this.reject(D)})};y.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,t.create(this.view.stateManager.view,this.target,this.abortController.signal).then(D=>
{"finished"!==this.state&&(D=this.getCameraFromViewpoint(D),g.isNone(D)||(this.options.animate?g.isNone(this.animationController)||this.startAnimation(D,this.animationController):(this.view.stateManager.setStateCamera(D.camera,{applyConstraints:!D.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},D=>{this.reject(D)}))};y.internalAnimateOptions=function(D){const z={};D&&(null!=D.speedFactor&&(z.speedFactor=D.speedFactor),null!=D.duration&&(z.duration=D.duration/
1E3),null!=D.maxDuration&&(z.maxDuration=D.maxDuration/1E3),null!=D.easing&&(z.easing="string"===typeof D.easing?e.named[D.easing]:D.easing));return z};y.getCameraFromViewpoint=function(D){const z=!!(this.target instanceof k&&this.target.camera||this.target instanceof f);var r=D.camera;if(g.isNone(r))return null;if(!this.view.stateManager.isCompatible(r))return D=(D=r.position)&&D.spatialReference,this.reject(new b("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${D?
D.wkid:"none"}, view: ${this.view.stateManager.view.spatialReference.wkid})`,{camera:r})),null;r=u.externalToInternal(this.view.stateManager.view,r);return g.isNone(r)?(this.reject(new b("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:D,camera:r,isFullySpecified:z}};y.startAnimation=function(D,z){this.state="wait-for-animation-finish";const r=z.viewAnimation;if(g.isNone(r))this.reject(new b("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));
else{r.update(D.viewpoint,"running");if(!z.active||g.isNone(z.viewAnimation)||z.viewAnimation.target!==D.viewpoint||this.view.stateManager.view.state.cameraController!==z)return this.abort();if(D.isFullySpecified){var C=new v.SurfaceCollisionCorrectionController({view:this.view.stateManager.view,desiredCamera:D.camera});d.applySurfaceCollisionConstraint(this.view.stateManager.view,D.camera,1)}else h.applyAll(this.view.stateManager.view,D.camera);z.begin(D.camera,this.internalAnimateOptions(this.options));
var A=x=>{if(!g.isNone(this.view.stateManager.view.state))switch(z.state){case n.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case n.State.Ready:case n.State.Rejected:case n.State.Running:case n.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(x)}}};r.when(()=>{const x=this.view.stateManager.view.state.cameraController;
C&&(x&&x.active?x instanceof q.PointToPointAnimationController&&g.isSome(x.viewAnimation)&&x.viewAnimation.target===D.viewpoint&&(this.view.stateManager.view.state.cameraController=C):g.isSome(z.viewAnimation)&&z.viewAnimation.target===D.viewpoint&&"finished"===z.state&&(this.view.stateManager.view.state.cameraController=C))},x=>A(x));z.asyncResult={resolve:()=>A(),reject:x=>A(x)}}};y.getAnimationController=function(){let D;var z=null;z=this.view.stateManager.view.state.cameraController;z instanceof
q.PointToPointAnimationController&&(z.updateStateFromViewAnimation(),z.active&&(D=z,z=D.viewAnimation));return null!=D||(D=new q.PointToPointAnimationController({view:this.view.stateManager.view,mode:"animation"}),z=D.viewAnimation,this.view.stateManager.view.state.switchCameraController(D))?D:(g.isSome(z)&&z.stop(),this.reject(new b("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return w}();a.GoToOperation=l;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/stack ../../../../chunks/ray ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/Intersector".split(" "),function(a,g,b,p,f,k,c,d,e,h){function n(y,D,z){for(const r of y)D&&!D(r)||z.push(r);return z}function q(y){v||(v=new h.Intersector(y));v.viewingMode=y;return v}
let u=function(){function y(z,r,C){this.viewingMode=z;this.layerProvider=r;this.view=C;this.externalIntersectionHandlers=new b;this.tolerance=h.Intersector.DEFAULT_TOLERANCE;this.tmpRay=d.create();this.validateHUDIntersector=new h.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var D=y.prototype;D.intersectScreen=function(z,r){return this.intersectRay(this.getPickRay(z,this.tmpRay),q(this.viewingMode),r)};D.intersectScreenFreePointFallback=function(z,r){return this.intersectRayFreePointFallback(this.getPickRay(z,
this.tmpRay),r)};D.intersectRayFreePointFallback=function(z,r){return this.intersectRay(z,q(this.viewingMode),r)||this.intersectRayFreePointLocal(z,r)};D.intersectRay=function(z,r,C,A){r.options.selectionMode=!1;r.options.store=0;this.computeIntersection(z,r,A);return r.results.min?r.results.min.getIntersectionPoint(C):!1};D.getCenterRayWithSubpixelOffset=function(z,r,C=.5,A=.5){z.getRenderCenter(w,C,A);w[0]+=.0466;w[1]-=.0123;return d.fromRenderAtEye(z,w,r)};D.intersectIntersectorScreen=function(z,
r,C){this.computeIntersection(this.getPickRay(z,this.tmpRay),r,C)};D.intersectToolIntersectorScreen=function(z,r,C){z=this.getPickRay(z,this.tmpRay);this.intersectToolIntersectorRay(z,r,C)};D.intersectToolIntersectorRay=function(z,r,C){r.options.selectionMode=!0;this.computeIntersection(z,r,C);const A=r.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||A.hasIntersectionPoint&&"TerrainRenderer"!==A.intersector||(r.options.selectionMode=!1,this.computeIntersection(z,r,C))};D.setTolerance=
function(z=h.Intersector.DEFAULT_TOLERANCE){this.tolerance=z};D.addIntersectionHandler=function(z){this.externalIntersectionHandlers.push(z);this.externalIntersectionHandlers.sort((r,C)=>"Terrain"===r.type?1:"Terrain"===C.type?-1:0)};D.removeIntersectionHandler=function(z){this.externalIntersectionHandlers.removeUnordered(z);this.externalIntersectionHandlers.sort((r,C)=>"Terrain"===r.type?1:"Terrain"===C.type?-1:0)};D.getPickRay=function(z,r=d.create()){return d.fromScreen(this.view.state.camera,
z,r)};D.intersectRayFreePointLocal=function(z,r){if(2!==this.viewingMode||g.isNone(z))return!1;var C=this.view.dataExtent,A=Math.max(C.xmax-C.xmin,C.ymax-C.ymin,8*Math.max(C.xmax-C.xmin,C.ymax-C.ymin));if(0===A)return k.add(r,z.origin,k.normalize(c.sv3d.get(),z.direction)),!0;var x=this.view.state.camera;const m=Math.max(0,C.xmin-x.eye[0],x.eye[0]-C.xmax);C=Math.max(0,C.ymin-x.eye[1],x.eye[1]-C.ymax);x=A/Math.max(1,Math.max(0,Math.log(A/(Math.abs(x.relativeElevation)+Number.MIN_VALUE)))**2);x=Math.max(x,
Math.min(Math.sqrt(m*m+C*C),A));A=k.scale(c.sv3d.get(),z.direction,x/k.length(z.direction));k.add(r,z.origin,A);return!0};D.intersectElevationFromScreen=function(z,r,C=0,A=null){return this.intersectElevation(this.getPickRay(z,this.tmpRay),r,C,A)};D.intersectElevation=function(z,r,C=0,A=null){if(g.isNone(z))return null;var x=g.isSome(r)?r.mode:"absolute-height",m=g.isSome(r)?g.unwrapOr(r.offset,0):0,B="on-the-ground"!==x?m+C:0;r=B/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===x)return this.view.renderCoordsHelper.intersectManifold(z,
B,l)?(C=this.view.computeMapPointFromVec3d(l),C.z-=m,C):null;m=this.view.state.camera;const E=p.castRenderScreenPointArray3(c.sv3d.get());m.projectToRenderScreen(z.origin,E);B=this.prepareFilters(null,t);const F=this.view.slicePlane,G=g.isSome(F)?e.sliceFilterPredicate(F):null,I=new h.Intersector(this.viewingMode);I.options.store=0;I.options.verticalOffset=r;r=z.origin;z=k.add(c.sv3d.get(),r,z.direction);I.reset(r,z);I.point=E;I.camera=m;I.filterPredicate=null;const K=g.isSome(A)?"type"in A&&"graphics"===
A.type?J=>J.metadata.layerUid!==A.uid:J=>J.metadata.graphicUid!==A.uid:null;switch(x){case "relative-to-scene":I.intersect(B.layers,E,m,this.tolerance,null,J=>(g.isNone(K)||K(J))&&J.metadata&&J.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(J=>{"I3S"!==J.type&&"Terrain"!==J.type||J.intersect(I,J.slicePlane?G:null,I.rayBeginPoint,I.rayEndPoint,E)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(J=>{J.isGround&&J.intersect(I,J.slicePlane?
G:null,I.rayBeginPoint,I.rayEndPoint,E)})}return I.results.min.getIntersectionPoint(l)?(x=this.view.computeMapPointFromVec3d(l),x.z=C,x):null};D.computeIntersection=function(z,r,C){if(!g.isNone(z)){var A=this.view.state.camera,x=p.castRenderScreenPointArray3(c.sv3d.get());A.projectToRenderScreen(z.origin,x);var m=this.prepareFilters(C,t);r.options.selectOpaqueTerrainOnly=!C||!("include"in C||"exclude"in C);var B=z.origin,E=k.add(c.sv3d.get(),z.origin,z.direction);r.reset(B,E);r.intersect(m.layers,
x,A,this.tolerance);z=this.view.slicePlane;var F=g.isSome(z)?e.sliceFilterPredicate(z):null;r.intersect(m.sliceableLayers,x,A,this.tolerance,F);var G=C&&(C.requiresGroundFeedback||C.enableDraped);this.externalIntersectionHandlers.forAll(I=>{r.options.isFiltered=!m.filterLayerUid(I.intersectionHandlerId);(I.isGround&&G||!r.options.isFiltered)&&I.intersect(r,I.slicePlane?F:null,B,E,x)});z=c.sv3d.get();if(C&&C.enableDraped&&r.results.ground.getIntersectionPoint(z)){C=this.view.basemapTerrain.overlayManager.renderer;
const I=this.view.renderCoordsHelper.spatialReference,K=c.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(z,K,this.view.spatialReference);K[2]=g.unwrapOr(this.view.elevationProvider.getElevation(z[0],z[1],z[2],I,"ground"),0);C.intersect(r,K,m.filterRenderGeometry)}r.sortResults();z=r.results.hud;if(z.hasIntersectionPoint){const I=p.castRenderScreenPointArray3(c.sv3d.get()),K=c.sv3d.get(),J=c.sv3d.get();this.unprojectHUDResultRay(z.center,I,K,J);C=k.distance(z.center,K)/k.distance(K,J)*.99;
this.validateHUDIntersector.reset(K,J);this.validateHUDIntersector.intersect(m.layers,I,A,this.tolerance);this.validateHUDIntersector.intersect(m.sliceableLayers,I,A,this.tolerance,F);this.externalIntersectionHandlers.forAll(L=>{m.filterLayerUid(L.intersectionHandlerId)&&L.intersect(this.validateHUDIntersector,L.slicePlane?F:null,K,J,I)});A=this.validateHUDIntersector.results.min;if(null==A.dist||C<=A.dist)r.results.min.copyFrom(z),r.results.all.splice(0,0,z)}}};D.prepareFilters=function(z,r){const C=
[],A=[];this.layerProvider.forEachLayer(x=>{x.isPickable&&(x.isSliceable?A:C).push(x)});r.include=z&&z.include;r.exclude=z&&z.exclude;r.layers.length=0;r.sliceableLayers.length=0;n(C,r.filterLayer,r.layers);n(A,r.filterLayer,r.sliceableLayers);return r};D.unprojectHUDResultRay=function(z,r,C,A){const x=this.view.state.camera;x.projectToRenderScreen(z,r);z=p.castRenderScreenPointArray3(c.sv3d.get());z[0]=r[0];z[1]=r[1];z[2]=0;x.unprojectFromRenderScreen(z,C);z[2]=1;x.unprojectFromRenderScreen(z,A)};
return y}(),v;const t={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer(y){return t.filterLayerUid(y.apiLayerUid)},filterLayerUid(y){const {include:D,exclude:z}=t;return g.isNone(y)?null==D&&null==z:(null==D||D.has(y))&&(null==z||!z.has(y))},filterRenderGeometry(y){return t.filterLayerUid(y.layerUid)}},l=f.create(),w=p.createRenderScreenPointArray();a.SceneIntersectionHelper=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../core/Evented ../layers/graphics/ElevationQuery".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){function y(D,z,r,C,A,x,m){for(const B of z)z=B.getElevation(r,C,A,x,m),f.isSome(z)&&(D=f.isSome(D)?Math.max(z,D):z);return D}a.CombinedElevationProvider=function(D){function z(C){C=D.call(this,C)||this;C.im=[];C.ground=[];C.scene=[];C.handles=new Map;return C}g._inheritsLoose(z,D);var r=z.prototype;r.destroy=function(){this._elevationQuery=f.destroyMaybe(this._elevationQuery)};r.getElevation=function(C,A,x,m,B){let E;E=y(null,this.im,C,A,x,m,B);f.isNone(E)&&
(E=y(E,this.ground,C,A,x,m,B));"scene"===B&&(E=y(E,this.scene,C,A,x,m,B));return E};r.queryElevation=function(C,A,x,m,B,E=null,F=0){const G=v.createResolver();this.elevationQuery.queryElevation(C,A,E,F).then(I=>{"scene"===B&&(I=y(I,this.scene,C,A,x,m,B));G.resolve(I)}).catch(I=>{v.isAbortError(I)?G.reject(I):G.resolve(this.getElevation(C,A,x,m,B))});return G.promise};r.register=function(C,A){this.handles.set(A,A.on("elevation-change",x=>this.emit("elevation-change",x)));this[C].push(A)};r.unregister=
function(C){this.handles.has(C)&&(this.handles.get(C).remove(),this.handles.delete(C));for(const A of[this.im,this.ground,this.scene]){const x=A.indexOf(C);-1<x&&A.splice(x,1)}};g._createClass(z,[{key:"elevationQuery",get:function(){f.isNone(this._elevationQuery)&&(this._elevationQuery=new w.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return z}(l.EventedMixin(t));
b.__decorate([d.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=b.__decorate([h.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../geometry/Multipoint ../../../../geometry ../../../support/Scheduler".split(" "),
function(a,g,b,p,f,k,c,d){c=function(){function h(q,u){this.spatialReference=q;this.view=u}var n=h.prototype;n.getElevation=function(q,u,v){return this.view.elevationProvider.getElevation(q,u,0,this.spatialReference,v)};n.queryElevation=async function(q,u,v,t,l){return this.view.elevationProvider.queryElevation(q,u,0,this.spatialReference,l,v,t)};return h}();let e=function(){function h(q,u,v,t){this.spatialReference=u;this._getElevationQueryProvider=v;this._queries=[];this._queryOptions={...t,ignoreInvisibleLayers:!0};
this._frameTask=q.registerTask(d.Task.ELEVATION_QUERY,()=>this._update(),()=>0<this._queries.length)}var n=h.prototype;n.destroy=function(){this._frameTask.remove()};n.queryElevation=function(q,u,v,t=0){return new Promise((l,w)=>{const y={x:q,y:u,minDemResolution:t,result:{resolve:l,reject:w},signal:v};this._queries.push(y);f.onAbort(v,()=>{p.remove(this._queries,y);w(f.createAbortError())})})};n._update=function(){const q=this._queries;this._queries=[];const u=this._getElevationQueryProvider();if(u){var v=
q.map(y=>[y.x,y.y]),t=q.reduce((y,D)=>Math.min(y,D.minDemResolution),Infinity);v=new k({points:v,spatialReference:this.spatialReference});var l=1<q.length&&q.some(y=>!!y.signal)?f.createAbortController():null,w=b.isSome(l)?l.signal:q[0].signal;if(b.isSome(l)){let y=0;q.forEach(D=>f.onAbort(D.signal,()=>{y++;D.result.reject(f.createAbortError());y===q.length&&l.abort()}))}u.queryElevation(v,{...this._queryOptions,minDemResolution:t,signal:w}).then(y=>{q.forEach((D,z)=>{b.isSome(D.signal)&&D.signal.aborted?
D.result.reject(f.createAbortError()):D.result.resolve(y.geometry.points[z][2])})}).catch(y=>{q.forEach(D=>D.result.reject(y))})}else q.forEach(y=>y.result.reject())};g._createClass(h,[{key:"test",get:function(){const q=this;return{update:()=>0<q._queries.length&&q._update()}}}]);return h}();a.ElevationQuery=e;a.ViewElevationProvider=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function g(){const p=
!!a("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,
physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:p?.8:1,polylineLodFactor:p?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:p},
tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:p?600:750,additionalCacheMemory:p?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:p?1.2:2,polylineLodFactor:p?1.2:2},sceneService:{"3dObject":{lodFactor:1,
lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:p?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:p?
null:4096,maximumPixelRatio:p?1:null}}}let b=function(){function p(){}p.isValidProfile=function(f){return f in p.profiles};p.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};p.apply=function(f,k){f=p.profiles[f];k.graphics3D.maxTotalNumberOfFeatures=f.graphics3D.maxTotalNumberOfFeatures;k.graphics3D.maxTotalNumberOfPrimitives=f.graphics3D.maxTotalNumberOfPrimitives;k.graphics3D.polygonLodFactor=f.graphics3D.polygonLodFactor;k.graphics3D.polylineLodFactor=f.graphics3D.polylineLodFactor;
{const c=k.sceneService["3dObject"],d=f.sceneService["3dObject"];c.lodFactor=d.lodFactor;c.lodCrossfadeinDuration=d.lodCrossfadeinDuration;c.lodCrossfadeoutDuration=d.lodCrossfadeoutDuration;c.lodCrossfadeUncoveredDuration=d.lodCrossfadeUncoveredDuration}k.sceneService.point.lodFactor=f.sceneService.point.lodFactor;k.sceneService.integratedMesh.lodFactor=f.sceneService.integratedMesh.lodFactor;k.sceneService.pointCloud.lodFactor=f.sceneService.pointCloud.lodFactor;k.sceneService.uncompressedTextureDownsamplingEnabled=
f.sceneService.uncompressedTextureDownsamplingEnabled;k.tiledSurface.lodBias=f.tiledSurface.lodBias;k.tiledSurface.angledSplitBias=f.tiledSurface.angledSplitBias;k.tiledSurface.reduceTileLevelDifferences=f.tiledSurface.reduceTileLevelDifferences;k.tiledSurface.textureFadeDuration=f.tiledSurface.textureFadeDuration;k.antialiasingEnabled=f.antialiasingEnabled;k.physicallyBasedRenderingEnabled=f.physicalBasedRenderingEnabled;k.highQualityTransparency=f.highQualityTransparency;k.memoryLimit=f.memoryLimit;
k.additionalCacheMemory=f.additionalCacheMemory;k.frameRate=f.frameRate;k.maximumRenderResolution=f.maximumRenderResolution;k.maximumPixelRatio=f.maximumPixelRatio};return p}();b.debug={reset(){const p=g();for(const f in p)b.profiles[f]=p[f]}};(b||(b={})).profiles=g();return b})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../Color ../../../chunks/vec4f32".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=function(l){function w(){var y=l.apply(this,arguments)||this;y.color=new v([0,255,255]);y.haloColor=null;y.haloOpacity=1;y.fillOpacity=.25;y.shadowOpacity=.4;y.shadowColor=new v([0,0,0]);y.shadowDifference=.2;return y}a._inheritsLoose(w,l);w.toEngineOptions=function(y){const D=v.toUnitRGBA(y.color),z=p.isSome(y.haloColor)?v.toUnitRGBA(y.haloColor):D,r=v.toUnitRGBA(y.shadowColor);return{color:t.fromValues(D[0],D[1],D[2],D[3]),haloColor:t.fromValues(z[0],z[1],
z[2],z[3]),haloOpacity:y.haloOpacity,haloOpacityOccluded:.25*y.haloOpacity,fillOpacity:y.fillOpacity,fillOpacityOccluded:.25*y.fillOpacity,shadowOpacity:y.shadowOpacity,shadowColor:t.fromValues(r[0],r[1],r[2],r[3]),occludedShadowOpacity:y.shadowOpacity*(1-y.shadowDifference)}};return w}(u);g.__decorate([c.property({type:v})],b.prototype,"color",void 0);g.__decorate([c.property({type:v})],b.prototype,"haloColor",void 0);g.__decorate([c.property()],b.prototype,"haloOpacity",void 0);g.__decorate([c.property()],
b.prototype,"fillOpacity",void 0);g.__decorate([c.property()],b.prototype,"shadowOpacity",void 0);g.__decorate([c.property({type:v})],b.prototype,"shadowColor",void 0);g.__decorate([c.property()],b.prototype,"shadowDifference",void 0);return b=g.__decorate([e.subclass("esri.views.3d.support.HighlightOptions")],b)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function g(){return new Float32Array(4)}function b(D){const z=new Float32Array(4);z[0]=D[0];z[1]=D[1];z[2]=D[2];z[3]=D[3];
return z}function p(D,z,r,C){const A=new Float32Array(4);A[0]=D;A[1]=z;A[2]=r;A[3]=C;return A}function f(D,z){return new Float32Array(D,z,4)}function k(){return g()}function c(){return p(1,1,1,1)}function d(){return p(1,0,0,0)}function e(){return p(0,1,0,0)}function h(){return p(0,0,1,0)}function n(){return p(0,0,0,1)}const q=g(),u=c(),v=d(),t=e(),l=h(),w=n();var y=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,zeros:k,ones:c,unitX:d,unitY:e,unitZ:h,unitW:n,ZEROS:q,ONES:u,
UNIT_X:v,UNIT_Y:t,UNIT_Z:l,UNIT_W:w});a.ONES=u;a.UNIT_W=w;a.UNIT_X=v;a.UNIT_Y=t;a.UNIT_Z=l;a.ZEROS=q;a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.ones=c;a.unitW=n;a.unitX=d;a.unitY=e;a.unitZ=h;a.vec4f32=y;a.zeros=k})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../core/Error ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry ../../../core/asyncUtils ../../../geometry/projectionEllipsoid ../../../core/unitUtils ../../../tasks/support/ProjectParameters ../../../portal/support/geometryServiceUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h){f=function(){function n(u,v,t=null){this.spatialReference=v;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference,c.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServicePromise=k.result(this.loadGeometryService(u,t))}var q=n.prototype;q.loadGeometryService=async function(u,v){if(v)return v;try{return await h.create(u&&u.get("portalItem"))}catch{throw new g("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");
}};q.awaitGeometryService=async function(){const u=await this._geometryServicePromise;if(!0===u.ok)return u.value;throw u.error;};q.toGeographic=async function(u){var v=await this.awaitGeometryService();let t=!0;Array.isArray(u[0])&&"number"!==typeof u[0]||(u=[u],t=!1);u=u.map(l=>l instanceof p?l:new p(l,this.spatialReference));u=new e({geometries:u,outSpatialReference:b.WGS84});v=(await v.project(u)).map(l=>"point"===l.type?[l.x,l.y]:void 0);return t?v:v[0]};return n}();a.MapCoordsHelper=f;a.default=
f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/tasks/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/jsonUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){b=function(v){function t(l){l=v.call(this,l)||this;l.geometries=null;l.outSpatialReference=null;l.transformation=null;l.transformForward=null;return l}a._inheritsLoose(t,v);t.prototype.toJSON=function(){const l=this.geometries.map(function(D){return D.toJSON()}),w=this.geometries[0],y={};y.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());y.inSR=w.spatialReference.wkid||JSON.stringify(w.spatialReference.toJSON());y.geometries=
JSON.stringify({geometryType:u.getJsonType(w),geometries:l});this.transformation&&(y.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(y.transformForward=this.transformForward);return y};return t}(q.JSONSupport);g.__decorate([k.property()],b.prototype,"geometries",void 0);g.__decorate([k.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);g.__decorate([k.property()],b.prototype,"transformation",void 0);g.__decorate([k.property()],
b.prototype,"transformForward",void 0);return b=g.__decorate([d.subclass("esri.tasks.support.ProjectParameters")],b)})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../config ../../core/Error ../Portal ../../tasks/support/ProjectParameters".split(" "),function(a,g,b,p,f,k){async function c(d=null,e){if(b.geometryServiceUrl)return new (await new Promise(function(h,n){a(["../../tasks/GeometryService"],function(q){h(Object.freeze({__proto__:null,"default":q}))},n)})).default({url:b.geometryServiceUrl});
if(!d)throw new p("internal:geometry-service-url-not-configured");d="portal"in d?d.portal||f.getDefault():d;await d.load({signal:e});if(d.helperServices&&d.helperServices.geometry&&d.helperServices.geometry.url)return new (await new Promise(function(h,n){a(["../../tasks/GeometryService"],function(q){h(Object.freeze({__proto__:null,"default":q}))},n)})).default({url:d.helperServices.geometry.url});throw new p("internal:geometry-service-url-not-configured");}g.create=c;g.projectGeometry=async function(d,
e,h=null,n){h=await c(h,n);const q=new k;q.geometries=[d];q.outSpatialReference=e;if((d=await h.project(q,{signal:n}))&&Array.isArray(d)&&1===d.length)return d[0];throw new p("internal:geometry-service-projection-failed");};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){let u=function(y){function D(){var z=y.apply(this,arguments)||this;z.minTotalNumberOfFeatures=2E3;z.maxTotalNumberOfFeatures=5E4;z.maxTotalNumberOfPrimitives=17E5;z.polygonLodFactor=1;z.polylineLodFactor=1;return z}a._inheritsLoose(D,y);return D}(q);g.__decorate([k.property()],u.prototype,"minTotalNumberOfFeatures",void 0);g.__decorate([k.property()],u.prototype,"maxTotalNumberOfFeatures",void 0);g.__decorate([k.property()],u.prototype,"maxTotalNumberOfPrimitives",
void 0);g.__decorate([k.property()],u.prototype,"polygonLodFactor",void 0);g.__decorate([k.property()],u.prototype,"polylineLodFactor",void 0);u=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],u);let v=function(y){function D(){var z=y.apply(this,arguments)||this;z.lodFactor=1;return z}a._inheritsLoose(D,y);return D}(q);g.__decorate([k.property()],v.prototype,"lodFactor",void 0);v=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],
v);let t=function(y){function D(){var z=y.apply(this,arguments)||this;z.lodCrossfadeinDuration=0;z.lodCrossfadeoutDuration=0;z.lodCrossfadeUncoveredDuration=0;return z}a._inheritsLoose(D,y);return D}(v);t=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],t);let l=function(y){function D(){var z=y.apply(this,arguments)||this;z["3dObject"]=new t;z.point=new v;z.integratedMesh=new v;z.pointCloud=new v;z.uncompressedTextureDownsamplingEnabled=!1;return z}a._inheritsLoose(D,
y);return D}(q);g.__decorate([k.property({type:t})],l.prototype,"3dObject",void 0);g.__decorate([k.property({type:v})],l.prototype,"point",void 0);g.__decorate([k.property({type:v})],l.prototype,"integratedMesh",void 0);g.__decorate([k.property({type:v})],l.prototype,"pointCloud",void 0);g.__decorate([k.property()],l.prototype,"uncompressedTextureDownsamplingEnabled",void 0);l=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],l);let w=function(y){function D(){var z=
y.apply(this,arguments)||this;z.lodBias=0;z.angledSplitBias=1;z.reduceTileLevelDifferences=!0;z.textureFadeDuration=500;return z}a._inheritsLoose(D,y);return D}(q);g.__decorate([k.property()],w.prototype,"lodBias",void 0);g.__decorate([k.property()],w.prototype,"angledSplitBias",void 0);g.__decorate([k.property()],w.prototype,"reduceTileLevelDifferences",void 0);g.__decorate([k.property()],w.prototype,"textureFadeDuration",void 0);w=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
w);b=function(y){function D(){var z=y.apply(this,arguments)||this;z.graphics3D=new u;z.sceneService=new l;z.tiledSurface=new w;z.antialiasingEnabled=!0;z.physicallyBasedRenderingEnabled=!1;z.highQualityTransparency=!0;return z}a._inheritsLoose(D,y);return D}(q);g.__decorate([k.property({type:u})],b.prototype,"graphics3D",void 0);g.__decorate([k.property({type:l})],b.prototype,"sceneService",void 0);g.__decorate([k.property({type:w})],b.prototype,"tiledSurface",void 0);g.__decorate([k.property()],
b.prototype,"antialiasingEnabled",void 0);g.__decorate([k.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);g.__decorate([k.property()],b.prototype,"highQualityTransparency",void 0);g.__decorate([k.property()],b.prototype,"memoryLimit",void 0);g.__decorate([k.property()],b.prototype,"additionalCacheMemory",void 0);g.__decorate([k.property()],b.prototype,"frameRate",void 0);g.__decorate([k.property()],b.prototype,"maximumRenderResolution",void 0);g.__decorate([k.property()],b.prototype,
"maximumPixelRatio",void 0);return b=g.__decorate([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/SpatialReference ../../../chunks/vec3 ../../../core/unitUtils ../../../chunks/mat4 ../../../geometry/projection ../../../layers/graphics/dehydratedFeatures ./stack ./geometryUtils ./geometryUtils/coordinateSystem".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){let u=function(){function v(l,w,y,D){this.viewingMode=l;this.spatialReference=w;this.unitInMeters=y;this.coordinateSystem=D;this._coordinateSystem=q.create(D)}var t=v.prototype;t.getAltitude=function(l){return q.altitudeAt(this.coordinateSystem,l)};t.setAltitude=function(l,w){q.setAltitudeAt(this.coordinateSystem,w,l,w)};t.setAltitudeOfTransformation=function(l,w){q.setAltitudeOfTransformation(this.coordinateSystem,w,l,w)};t.worldUpAtPosition=function(l,w){return q.normalAt(this.coordinateSystem,
l,w)};t.worldBasisAtPosition=function(l,w,y){return q.axisAt(this.coordinateSystem,l,w,y)};t.basisMatrixAtPosition=function(l,w){const y=this.worldBasisAtPosition(l,0,h.sv3d.get()),D=this.worldBasisAtPosition(l,1,h.sv3d.get());l=this.worldBasisAtPosition(l,2,h.sv3d.get());c.set(w,y[0],y[1],y[2],0,D[0],D[1],D[2],0,l[0],l[1],l[2],0,0,0,0,1);return w};t.intersectManifoldClosestSilhouette=function(l,w,y){q.elevate(this.coordinateSystem,w,this._coordinateSystem);q.intersectRayClosestSilhouette(this._coordinateSystem,
l,y);return y};t.intersectManifold=function(l,w,y){q.elevate(this.coordinateSystem,w,this._coordinateSystem);w=h.sv3d.get();return q.intersectRay(this._coordinateSystem,l,w)?(f.copy(y,w),!0):!1};t.intersectInfiniteManifold=function(l,w,y){if(1===this.viewingMode)return this.intersectManifold(l,w,y);q.elevate(this.coordinateSystem,w,this._coordinateSystem);w=this._coordinateSystem.value;const D=h.sv3d.get();return n.plane.intersectRay(w.plane,l,D)?(f.copy(y,D),!0):!1};t.toRenderCoords=function(l,w,
y){return e.isDehydratedPoint(l)?d.projectPointToVector(l,w,this.spatialReference):d.projectVectorToVector(l,w,y,this.spatialReference)};t.fromRenderCoords=function(l,w,y=null){return e.isDehydratedPoint(w)?(b.isSome(y)&&(w.spatialReference=y),d.projectVectorToDehydratedPoint(l,this.spatialReference,w)):w instanceof p?d.projectVectorToPoint(l,this.spatialReference,w):d.projectVectorToVector(l,this.spatialReference,w,y)?w:null};v.createGlobal=function(l){return new v(1,l,1,q.createGlobal(l))};v.createLocal=
function(l){return new v(2,l,k.getMetersPerUnitForSR(l),q.createLocal())};v.createMode=function(l,w){switch(l){case 2:return v.createLocal(w);case 1:return v.createGlobal(w)}};g._createClass(v,[{key:"extent",set:function(l){l&&q.setExtent(this.coordinateSystem,l,this.coordinateSystem)}}]);return v}();a.RenderCoordsHelper=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../core/Handles ../../support/Scheduler ./index ./MemoryController ./StreamDataLoader".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){a.ResourceControllerMain=function(C){function A(){var x=C.apply(this,arguments)||this;x.updating=!1;return x}g._inheritsLoose(A,C);return A}(t);b.__decorate([d.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=b.__decorate([h.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var r;(function(C){let A=function(x){function m(){var E=x.apply(this,arguments)||this;E._scheduler=
null;E._memoryController=null;E._streamDataLoader=null;E._cameraChangeTime=0;E._handles=new l;E._frameTask=null;return E}g._inheritsLoose(m,x);var B=m.prototype;B.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=w.newScheduler(this.now);this._memoryController=D.newMemoryController(this.view);this._streamDataLoader=new z["default"];this._streamDataLoader.setup(y.maxDownloadSlots,y.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",(E,F)=>
this._cameraChangedHandler(E,F),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=v.addFrameTask({update:E=>this.frame(E)})};B.destroy=function(){this._handles=f.destroyMaybe(this._handles);this._frameTask=f.removeMaybe(this._frameTask);this._streamDataLoader=f.destroyMaybe(this._streamDataLoader);this._memoryController=f.destroyMaybe(this._memoryController);this._scheduler=
f.destroyMaybe(this._scheduler)};B.createStreamDataRequester=function(E){const F=this._streamDataLoader;return{request(G,I,K){return F.request(G,I,E,K)},get busy(){return!F.hasDownloadSlots(E)}}};B.frame=function(E){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(E.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(E)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};
B._cameraChangedHandler=function(E,F){E&&F&&E.almostEquals(F)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};B._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};g._createClass(m,[{key:"updating",get:function(){var E,F;return!!(null!=(E=this._memoryController)&&E.updating||null!=(F=this._streamDataLoader)&&F.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},
{key:"state",get:function(){const E=this.view;return E.animation?0:E.interacting||300>=this._scheduler.now-this._cameraChangeTime?1:2}},{key:"test",get:function(){return{getQueueStats:E=>this._streamDataLoader.test.loadQueue.getStatsForType(E),state:this.state}}}]);return m}(a.ResourceControllerMain);b.__decorate([d.property({constructOnly:!0})],A.prototype,"view",void 0);b.__decorate([d.property({constructOnly:!0})],A.prototype,"now",void 0);b.__decorate([d.property()],A.prototype,"_scheduler",void 0);
b.__decorate([d.property()],A.prototype,"_memoryController",void 0);b.__decorate([d.property()],A.prototype,"_streamDataLoader",void 0);b.__decorate([d.property({readOnly:!0})],A.prototype,"updating",null);A=b.__decorate([h.subclass("esri.views.3d.support.ResourceController")],A);C.ResourceController=A})(r||(r={}));a.newResourceController=function(C,A=()=>performance.now()){return new r.ResourceController({view:C,now:A})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],
function(a){a.downloadSlotsPerClient=[10,10,10,10,5];a.maxDownloadSlots=30;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/Logger ../../../core/Evented ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(a,g,b,p,f,k,c){const d=p.getLogger("esri.views.3d.support.MemoryController");let e=function(){function h(q){this._view=
q;this.events=new f;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new k.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var n=h.prototype;n.destroy=function(){this.events=null;this._cacheStorage.destroy()};n.getMemCache=function(q,u){return new k.MemCache(q,this._cacheStorage,u)};n.disableMemCache=function(){this._additionalCacheMemory=
-4096};n.resetStableQuality=function(){this._stableQuality=0};n.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var q=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(q){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&
this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,q=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,q=this._updateQuality(this._quality+.05)):1>this._quality&&
(this._canFastRecover=!0));this.updating!==q&&(this._updating=q,this.events.emit("updating-changed",this.updating))}};n._updateQuality=function(q){q=Math.min(Math.max(q,this.minQuality),1);if(q===this._quality)return!1;this._quality=q;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};n._layersUpdating=function(){return this._view.allLayerViews.some(q=>!!q.updating)};n._updateMemory=function(){let q=0,u=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(q+=this._view.basemapTerrain.getUsedMemory());var v=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;b.isSome(v)&&(q+=v.usedMemory);this._view.allLayerViews&&this._view.allLayerViews.forEach(l=>{if(c.isMemoryManagedLayerView(l)){const w=l.ignoresMemoryFactor()?this._quality:1;q+=l.getUsedMemory()*w;u+=l.getUnloadedMemory()*w}});var t=null==this._warnMemoryUsage||Math.round(10*q)!==Math.round(10*this._warnMemoryUsage);v=1048576*this._maxMemory;if(q>v&&t){this._warnMemoryUsage=
q;t=w=>(w/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const l=Math.round(100*this._quality);d.warn(`Memory Limit exceeded! Limit: ${t(v)} Current: ${t(q)} Projected: ${t(q+u)} Quality: ${l}%`)}this._memoryUsed=q/v;this._memoryPredicted=(q+u)/v;this._cacheStorage.maxSize=Math.max(0,v-q+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};g._createClass(h,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(q){null!=q&&0<q&&(this._stableQuality=
0,this._canFastRecover=!1,this._maxMemory<q&&this._updateQuality(1),this._maxMemory=q)}},{key:"additionalCacheMemory",set:function(q){null!=q&&0<=q&&(this._additionalCacheMemory=q)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){const q=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const u=q._numQualityChanges;q._numQualityChanges=
0;return u}}}}]);return h}();a.newMemoryController=function(h){return new e(h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(g){return"function"===typeof g.getUsedMemory};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/arrayUtils ../../../core/promiseUtils ../../../core/Accessor ../../../request ../../support/Scheduler ../webgl-engine/lib/Util ./AsyncWorkerQueue ./StreamDataLoaderTask".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){function x(B){if(2>B.byteLength)return"unknown";B=new Uint8Array(B,0,B.byteLength);return 137===B[0]&&80===B[1]?"image/png":71===B[0]&&73===B[1]?"image/gif":66===B[0]&&77===B[1]?"image/bmp":255===B[0]&&216===B[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(B){function E(){var G=B.apply(this,arguments)||this;G.tasks=new Map;G.onLoadQueue=[];G.doneQueue=[];G.updating=!1;return G}g._inheritsLoose(E,B);var F=E.prototype;F.setup=function(G,
I,K){this.loadQueue=new C.AsyncWorkerQueue((J,L)=>this.startLoading(J,L),(J,L)=>this.doneLoadingCallback(J,L),G,I);K&&(this.taskHandle=K.registerTask(z.Task.STREAM_DATA_LOADER,J=>this.update(J),()=>0<this.doneQueue.length||0<this.onLoadQueue.length))};F.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(G=>{G.abortController&&G.abortController.abort()});this.loadQueue.destroy();this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};F.hasDownloadSlots=
function(G){return this.loadQueue.hasQuota(G)};F.request=function(G,I,K,J={}){const L=w.createResolver();L.__signal=k.isSome(J)?J.signal:null;const P=this.createOrUpdateTask(G,I,K,J,L);w.onAbort(J,()=>this.cancelRequest(P,L));return L.promise};F.createTask=function(G,I,K,J,L,P){G=new A(G,I,K,J,L);this.updateTask(G,P);this.tasks.set(L,G);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(G);return G};F.cancelRequest=function(G,I){l.removeUnordered(G.resolvers,I);I.reject(w.createAbortError());
0===G.resolvers.length&&(2===G.status&&(G.status=4,this.loadQueue.cancel(G),G.abortController.abort(),G.request=null,G.abortController=null),G.status=4,this.tasks.delete(G.key),0===this.tasks.size&&this._set("updating",!1))};F.taskKey=function(G,I,K){return`${G}:${I}:${K}`};F.updateTask=function(G,I){G.resolvers.push(I)};F.createOrUpdateTask=function(G,I,K,J,L){var P=k.isSome(J)&&J.uid||G;P=this.taskKey(P,I,K);const Q=this.tasks.get(P);return Q?(this.updateTask(Q,L),Q):this.createTask(G,J,I,K,P,L)};
F.doneLoadingCallback=function(G,I){this.loadQueue&&(r.assert(2===G.status),G.status=3,this.taskHandle?this.doneQueue.push({task:G,err:I}):this.doneLoading(G,I))};F.update=function(G){for(;!G.done&&0<this.onLoadQueue.length;){var I=this.onLoadQueue.shift();w.throwIfAborted(I.task.abortController);I.task.abortController=null;I.callback(I.task);G.madeProgress()}for(;!G.done&&0<this.doneQueue.length;)I=this.doneQueue.shift(),3!==I.task.status&&(I.err=I.err||w.createAbortError()),this.doneLoading(I.task,
I.err),G.madeProgress()};F.doneLoading=function(G,I){let K=G.result instanceof HTMLImageElement?0:G.resolvers.length;for(const J of G.resolvers)if(I)w.isAbortError(I)?J.reject(I):J.reject(new q("stream-data-loader:request-error",`Failed to request resource at '${G.url}'. ${I}`,{url:G.url,error:I}));else{--K;const L=0>=K?G.result:f.clone(G.result);J.resolve(L)}this.tasks.delete(G.key);0===this.tasks.size&&this._set("updating",!1)};F.startLoading=function(G,I){if(4===G.status)return!1;G.startTime=performance.now();
G.status=2;let K,J;switch(G.docType){case "binary":J="array-buffer";K=0;break;case "image":J="image";break;case "image+type":J="array-buffer";break;default:J="json"}G.abortController=w.createAbortController();const L=G.abortController.signal;G.request=D(G.url,{...G.options,responseType:J,timeout:K,signal:L});let P=()=>{};const Q=aa=>{G.duration=performance.now()-G.startTime;G.size=aa instanceof ArrayBuffer?aa.byteLength:G.size||0;G.result=aa;this.taskHandle?this.onLoadQueue.push({callback:I,task:G}):
(G.abortController=null,I(G))},X=aa=>{2===G.status&&I(G,aa);P()};if("image+type"!==G.docType)return G.request.then(aa=>Q(aa.data),X),!0;G.request.then(aa=>{aa=aa.data;const S=x(aa);J="image";G.size=aa.byteLength;if("unknown"===S)G.request=D(G.url,{responseType:J,timeout:K,signal:L}),G.request.then(R=>Q(R.data),X);else{aa=new Blob([aa],{type:S});var H=window.URL.createObjectURL(aa);P=()=>window.URL.revokeObjectURL(H);G.request=D(H,{responseType:J,timeout:K,signal:L});G.request.then(R=>Q(new m(R.data,
S,P)),X)}},X);return!0};g._createClass(E,[{key:"test",get:function(){return{loadQueue:this.loadQueue}}}]);return E}(y);b.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([n.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);let m=function(){function B(E,F,G){this.image=E;this.type=F;this.release=G}g._createClass(B,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return B}();b=a.StreamDataLoader;
a.ImageWithType=m;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,g,b){let p=function(c){this.typeWorkerQuota=c;this.tasks=[];this.numWorkers=0;this.statistics=new f},f=function(){this.speed=this.duration=this.size=this.requests=0},k=function(){function c(e,h,n,q){this._workerFunc=e;this._callbackFunc=h;this._maxTotalNumWorkers=n;
this._totalNumWorkers=0;this._clients=q.map(u=>new p(u))}var d=c.prototype;d.hasQuota=function(e){return(e=this._clients[e])?this._totalNumWorkers<this._maxTotalNumWorkers||e.numWorkers+e.tasks.length<e.typeWorkerQuota:!1};d.push=function(e){const h=this._clients[e.client];h&&(this._totalNumWorkers<this._maxTotalNumWorkers?(h.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(n,q)=>this._taskCallback(n,q))):h.tasks.push(e))};d.cancel=function(e){this._taskFinished(e);e._cancelled=!0};d.destroy=
function(){this._clients.length=0};d._taskFinished=function(e){const h=this._clients[e.client];this._totalNumWorkers--;h.numWorkers--;h.statistics.requests++;h.statistics.size+=e.size||0;h.statistics.duration+=e.duration||0;h.statistics.speed=0<h.statistics.duration?h.statistics.size/h.statistics.duration:0;b.assert(0<=h.numWorkers);this._next()};d._next=function(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))break};
d._processQueue=function(e){for(;0<e.tasks.length;)if(this._workerFunc(e.tasks.shift(),(h,n)=>this._taskCallback(h,n)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1};d._taskCallback=function(e,h){e._cancelled||(this._callbackFunc(e,h),this._taskFinished(e))};d.getStatsForType=function(e){return(e=this._clients[e])?{quota:e.typeWorkerQuota,workers:e.numWorkers,queueSize:e.tasks.length,requestStats:e.statistics}:null};g._createClass(c,[{key:"test",get:function(){const e=this;return{set workerFunc(h){e._workerFunc=
h}}}}]);return c}();a.AsyncWorkerQueue=k;a.BaseTask=function(c){this.client=c;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./AsyncWorkerQueue"],function(a,g){return function(b){function p(f,k,c,d,e){d=b.call(this,d)||this;d.url=f;d.options=k;d.docType=c;d.key=e;d.result=null;d.status=1;d.request=null;d.abortController=null;d.resolvers=[];
d.startTime=0;return d}a._inheritsLoose(p,b);return p}(g.BaseTask)})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/maybe ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../support/StreamDataLoader ../../2d/engine/vectorTiles/VectorTile ./RasterTile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical ./TileTexture".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){function q(A){return"imagery-tile"===A.type||"wcs"===
A.type}function u(A){return A&&"esri.views.3d.layers.ImageryTileLayerView3D"===A.declaredClass}function v(A){return A&&"esri.views.3d.layers.TileLayerView3D"===A.declaredClass}function t(A){return A&&"esri.views.3d.layers.VectorTileLayerView3D"===A.declaredClass}function l(A){return A&&"esri.views.3d.layers.WMTSLayerView3D"===A.declaredClass}function w(A){return A&&"esri.views.3d.layers.ElevationLayerView3D"===A.declaredClass}function y(A,x,m,B){return D[2===B||"planar"===B?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(A,
m,x)}const D={planar:e.terrainUtilsPlanar,spherical:h.terrainUtilsSpherical},z=80/180*Math.PI,r=110/180*Math.PI,C={force512VTL:!1};a.checkIfTileInfoSupportedForView=y;a.computeSkirtScale=function(A,x,m){var B=D[A.manifold];if(B.isInsideExtent(A,x))A=g.unwrapOr(A.getElevation(x[0],x[1],x[1],A.spatialReference),0);else{if(!B.isInsideExtent(A,x,1.2))return 0;B=B.tiltToExtentEdge(A,x);if(B>z&&B<r)return 0;A=A.elevationBounds;A=.5*(A.min+A.max)}x=x[2]-A;return Math.abs(x)<m?0:0>x?-1:1};a.getLayerWithExtentRange=
function(A){return u(A)?{fullExtent:A.fullExtent,minScale:A.layer.minScale,maxScale:A.layer.maxScale,tilemapCache:null}:A.layer};a.getTiledLayerInfo=function(A,x,m){let B,E;if("wmts"===A.type){if(A=A.activeLayer){const F=A.tileMatrixSet;if(F)B=F.tileInfo,E=F.fullExtent;else if(A=A.tileMatrixSets)if(A=A.find(G=>null==y(G.tileInfo,G.fullExtent,x,m)))return{tileInfo:A.tileInfo,fullExtent:A.fullExtent}}}else E=q(A)?A.getCompatibleFullExtent(x):A.fullExtent,B="vector-tile"!==A.type||C.force512VTL?q(A)?
A.getCompatibleTileInfo(x,E):A.tileInfo:A.compatibleTileInfo256;return B&&E&&null==y(B,E,x,m)?{tileInfo:B,fullExtent:E}:{tileInfo:null,fullExtent:null}};a.isElevationLayerView=w;a.isImageryTileLayerView=u;a.isImageryTileRenderInfo=function(A){return A&&A.sourceLayerInfo&&A.sourceLayerInfo.data instanceof d};a.isProjectableRasterLayer=q;a.isRasterTileRenderInfo=function(A){A=A&&A.sourceLayerInfo&&A.sourceLayerInfo.data;return A instanceof HTMLImageElement||A instanceof k.ImageWithType||A instanceof
HTMLCanvasElement||A instanceof ImageData};a.isSurfaceLayerView=function(A){return A&&(v(A)||u(A)||w(A)||t(A)||l(A))};a.isTextureTileRenderInfo=function(A){return A&&A.sourceLayerInfo&&A.sourceLayerInfo.data instanceof n};a.isTileLayerView=v;a.isVectorTileLayer=function(A){return A&&A instanceof f};a.isVectorTileLayerView=t;a.isVectorTileRenderInfo=function(A){return A&&A.sourceLayerInfo&&A.sourceLayerInfo.data instanceof c.VectorTile};a.isWMTSLayerView=l;a.releaseTileData=function(A){g.isSome(A)&&
"release"in A&&A.release();return null};a.test=C;a.useFetchTileForLayer=function(A){return A.fetchTile&&!(A.fetchTile===p.prototype.fetchTile||A.fetchTile===b.prototype.fetchTile)};a.weakAssert=function(A,x){A||console.warn("Terrain: "+x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/ElevationLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../request ./Layer ../core/MultiOriginJSONSupport ../geometry/HeightModelInfo ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/PortalLayer ./mixins/ArcGISCachedService ./support/LercDecoder".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){const E=k.getLogger("esri.layers.ElevationLayer");p=function(F){function G(...K){K=F.call(this,...K)||this;K.copyright=null;K.heightModelInfo=null;K.path=null;K.opacity=1;K.operationalLayerType="ArcGISTiledElevationServiceLayer";K.sourceJSON=null;K.type="elevation";K.url=null;K.version=null;K._lercDecoder=B.acquireDecoder();return K}g._inheritsLoose(G,F);var I=G.prototype;I.normalizeCtorArgs=function(K,J){return"string"===typeof K?{url:K,
...J}:K};I.destroy=function(){B.releaseDecoder(this._lercDecoder);this._lercDecoder=null};I.readVersion=function(K,J){(K=J.currentVersion)||(K=9.3);return K};I.load=function(K){const J=f.isSome(K)?K.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:L=>{for(let P=0;P<L.typeKeywords.length;P++)if("elevation 3d layer"===L.typeKeywords[P].toLowerCase())return!0;throw new q("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",
{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},K).then(()=>this._fetchImageService(J),()=>this._fetchImageService(J)));return Promise.resolve(this)};I.fetchTile=function(K,J,L,P){P=P||{signal:null};const Q=f.isSome(P.signal)?P.signal:P.signal=l.createAbortController().signal,X={responseType:"array-buffer",signal:Q},aa={noDataValue:P.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(K,J,L,P)).then(()=>w(this.getTileUrl(K,J,L),X)).then(S=>
this._lercDecoder.decode(S.data,aa,Q)).then(S=>({values:S.pixelData,width:S.width,height:S.height,maxZError:S.fileInfo.maxZError,noDataValue:S.noDataValue,minValue:S.minValue,maxValue:S.maxValue}))};I.getTileUrl=function(K,J,L){const P=u.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null});return`${this.parsedUrl.path}/tile/${K}/${J}/${L}${P?"?"+P:""}`};I.queryElevation=async function(K,J){const {ElevationQuery:L}=await new Promise(function(P,Q){a(["./support/ElevationQuery"],
P,Q)});l.throwIfAborted(J);return(new L).query(this,K,J)};I.createElevationSampler=async function(K,J){const {ElevationQuery:L}=await new Promise(function(P,Q){a(["./support/ElevationQuery"],P,Q)});l.throwIfAborted(J);return(new L).createSampler(this,K,J)};I._fetchTileAvailability=function(K,J,L,P){return this.tilemapCache?this.tilemapCache.fetchAvailability(K,J,L,P):Promise.resolve("unknown")};I._fetchImageService=async function(K){if(this.sourceJSON)return this.sourceJSON;K=await w(this.parsedUrl.path,
{query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:K});K.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=K.data;this.read(K.data,{origin:"service",url:this.parsedUrl})};g._createClass(G,[{key:"minScale",get:function(){},set:function(K){this.constructed&&E.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)}},{key:"maxScale",get:function(){},set:function(K){this.constructed&&E.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)}}]);
return G}(m.ArcGISCachedService(A.ArcGISService(C.OperationalLayer(x.PortalLayer(D.MultiOriginJSONMixin(y))))));b.__decorate([d.property({json:{read:{source:"copyrightText"}}})],p.prototype,"copyright",void 0);b.__decorate([d.property({readOnly:!0,type:z})],p.prototype,"heightModelInfo",void 0);b.__decorate([d.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0);b.__decorate([d.property({type:["show","hide"]})],p.prototype,"listMode",void 0);
b.__decorate([d.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],p.prototype,"minScale",null);b.__decorate([d.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],p.prototype,"maxScale",null);b.__decorate([d.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],p.prototype,"opacity",void 0);b.__decorate([d.property({type:["ArcGISTiledElevationServiceLayer"]})],
p.prototype,"operationalLayerType",void 0);b.__decorate([d.property()],p.prototype,"sourceJSON",void 0);b.__decorate([d.property({json:{read:!1},value:"elevation",readOnly:!0})],p.prototype,"type",void 0);b.__decorate([d.property(r.url)],p.prototype,"url",void 0);b.__decorate([d.property()],p.prototype,"version",void 0);b.__decorate([h.reader("version",["currentVersion"])],p.prototype,"readVersion",null);return p=b.__decorate([n.subclass("esri.layers.ElevationLayer")],p)})},"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){a.ArcGISCachedService=y=>{y=function(D){function z(){var C=D.apply(this,arguments)||this;C.copyright=null;C.minScale=0;C.maxScale=0;C.spatialReference=null;C.tileInfo=null;C.tilemapCache=null;return C}g._inheritsLoose(z,D);var r=z.prototype;r.readMinScale=function(C,A){return null!=A.minLOD&&null!=A.maxLOD?C:0};r.readMaxScale=function(C,A){return null!=A.minLOD&&null!=A.maxLOD?C:0};r.readTilemapCache=function(C,A){return A.capabilities&&-1<A.capabilities.indexOf("Tilemap")?
new w.TilemapCache({layer:this}):null};g._createClass(z,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return z}(y);b.__decorate([c.property({json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0);b.__decorate([c.property()],y.prototype,"minScale",void 0);b.__decorate([e.reader("service","minScale")],y.prototype,"readMinScale",null);b.__decorate([c.property()],y.prototype,"maxScale",void 0);b.__decorate([e.reader("service","maxScale")],y.prototype,"readMaxScale",
null);b.__decorate([c.property({type:v})],y.prototype,"spatialReference",void 0);b.__decorate([c.property({readOnly:!0})],y.prototype,"supportsBlankTile",null);b.__decorate([c.property(l.serviceTileInfoProperty)],y.prototype,"tileInfo",void 0);b.__decorate([c.property()],y.prototype,"tilemapCache",void 0);b.__decorate([e.reader("service","tilemapCache",["capabilities"])],y.prototype,"readTilemapCache",null);b.__decorate([c.property()],y.prototype,"version",void 0);return y=b.__decorate([h.subclass("esri.layers.mixins.ArcGISCachedService")],
y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(a,g){function b(f,k,c,d){if(!f)return null;const {minScale:e,maxScale:h,minLOD:n,maxLOD:q}=k;if(null!=n&&null!=q)return d&&d.ignoreMinMaxLOD?g.fromJSON(f):g.fromJSON({...f,lods:f.lods.filter(({level:u})=>null!=u&&u>=n&&u<=q)});if(0!==e&&0!==h){const u=e?Math.round(1E4*e)/1E4:Infinity,v=h?Math.round(1E4*h)/1E4:-Infinity;return g.fromJSON({...f,lods:f.lods.filter(t=>
{t=Math.round(1E4*t.scale)/1E4;return t<=u&&t>=v})})}return g.fromJSON(f)}const p={type:g,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:b}}}}};a.readServiceTileInfo=b;a.serviceTileInfoProperty=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C){var A;const x=f.getLogger("esri.layers.support.TilemapCache");a.TilemapCache=A=function(m){function B(F){F=m.call(this,F)||this;F._handles=new D;F._pendingTilemapRequests={};F._availableLevels={};F.levels=5;F.cacheByteSize=2097152;F.request=y;F._prefetchingEnabled=!0;return F}g._inheritsLoose(B,m);var E=B.prototype;E.initialize=function(){this._tilemapCache=new z(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),r.init(this,"layer.tileInfo.lods",F=>this._initializeAvailableLevels(F),!0)]);this._initializeTilemapDefinition()};E.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};E.castLevels=function(F){return 2>=F?(x.error("Minimum levels for Tilemap is 3, but got ",F),3):F};E.fetchTilemap=function(F,G,I,K){if(!this._availableLevels[F])return Promise.reject(new h("tilemap-cache:level-unavailable",`Level ${F} is unavailable in the service`));
const J=this._tmpTilemapDefinition;if(F=this._tilemapFromCache(F,G,I,J))return Promise.resolve(F);const L=K&&K.signal;K={...K,signal:null};return new Promise((P,Q)=>{t.onAbort(L,()=>Q(t.createAbortError()));const X=C.tilemapDefinitionId(J);let aa=this._pendingTilemapRequests[X];if(!aa){aa=C.Tilemap.fromDefinition(J,K).then(H=>{this._tilemapCache.put(X,H,H.byteSize);return H});const S=()=>delete this._pendingTilemapRequests[X];this._pendingTilemapRequests[X]=aa;aa.then(S,S)}aa.then(P,Q)})};E.getAvailability=
function(F,G,I){return this._availableLevels[F]?(F=this._tilemapFromCache(F,G,I,this._tmpTilemapDefinition))?F.getAvailability(G,I):"unknown":"unavailable"};E.getAvailabilityUpsample=function(F,G,I,K){K.level=F;K.row=G;K.col=I;F=this.layer.tileInfo;for(F.updateTileInfo(K);;)if(G=this.getAvailability(K.level,K.row,K.col),"unavailable"===G){if(!F.upsampleTile(K))return"unavailable"}else return G};E.fetchAvailability=function(F,G,I,K){return this._availableLevels[F]?this.fetchTilemap(F,G,I,K).catch(J=>
J).then(J=>{if(J instanceof C.Tilemap)return J=J.getAvailability(G,I),"unavailable"===J?Promise.reject(new h("tile-map:tile-unavailable","Tile is not available",{level:F,row:G,col:I})):J;if(t.isAbortError(J))throw J;return"unknown"}):Promise.reject(new h("tilemap-cache:level-unavailable",`Level ${F} is unavailable in the service`))};E.fetchAvailabilityUpsample=function(F,G,I,K,J){K.level=F;K.row=G;K.col=I;const L=this.layer.tileInfo;L.updateTileInfo(K);const P=this.fetchAvailability(F,G,I,J).catch(Q=>
{if(t.isAbortError(Q))throw Q;if(L.upsampleTile(K))return this.fetchAvailabilityUpsample(K.level,K.row,K.col,K);throw Q;});this._fetchAvailabilityUpsamplePrefetch(K.id,F,G,I,J,P);return P};E._fetchAvailabilityUpsamplePrefetch=async function(F,G,I,K,J,L){if(this._prefetchingEnabled){var P=`prefetch-${F}`;if(!this._handles.has(P)){var Q=t.createAbortController();L.then(()=>Q.abort(),()=>Q.abort());var X=!1;this._handles.add({remove(){X||(X=!0,Q.abort())}},P);await l.waitTicks(10,Q.signal).catch(()=>
{});X||(X=!0,this._handles.remove(P));if(!t.isAborted(Q))for(F={id:F,level:G,row:I,col:K},J={...J,signal:Q.signal},G=this.layer.tileInfo,I=0;A._prefetches.length<A._maxPrefetch&&G.upsampleTile(F);++I){const aa=this.fetchAvailability(F.level,F.row,F.col,J);A._prefetches.push(aa);K=()=>{A._prefetches.removeUnordered(aa)};aa.then(K,K)}}}};E._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var F=this.layer.parsedUrl,G=F.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:F.path,
query:G?n.objectToQuery(G):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};E._tilemapFromCache=function(F,G,I,K){K.level=F;K.row=G-G%this.size;K.col=I-I%this.size;F=C.tilemapDefinitionId(K);return this._tilemapCache.get(F)};E._initializeAvailableLevels=function(F){this._availableLevels={};F&&F.forEach(G=>this._availableLevels[G.level]=!0)};g._createClass(B,[{key:"size",get:function(){return 1<<this.levels}},
{key:"test",get:function(){const F=this;return{get prefetchingEnabled(){return F._prefetchingEnabled},set prefetchingEnabled(G){F._prefetchingEnabled=G},hasTilemap(G,I,K){return!!F._tilemapFromCache(G,I,K,F._tmpTilemapDefinition)}}}}]);return B}(w);a.TilemapCache._maxPrefetch=4;a.TilemapCache._prefetches=new v({initialSize:A._maxPrefetch});b.__decorate([k.property({constructOnly:!0,type:Number})],a.TilemapCache.prototype,"levels",void 0);b.__decorate([c.cast("levels")],a.TilemapCache.prototype,"castLevels",
null);b.__decorate([k.property({readOnly:!0,type:Number})],a.TilemapCache.prototype,"size",null);b.__decorate([k.property({constructOnly:!0,type:Number})],a.TilemapCache.prototype,"cacheByteSize",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilemapCache.prototype,"layer",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilemapCache.prototype,"request",void 0);a.TilemapCache=A=b.__decorate([e.subclass("esri.layers.support.TilemapCache")],a.TilemapCache);Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(a,g,b,p,f){function k(d){if("vector-tile"===d.service.type)var e=`${d.service.url}/tilemap/${d.level}/${d.row}/${d.col}/${d.width}/${d.height}`;else e=d.service.tileServers,e=`${e&&e.length?e[d.row%e.length]:d.service.url}/tilemap/${d.level}/${d.row}/${d.col}/${d.width}/${d.height}`;(d=d.service.query)&&(e=`${e}?${d}`);return e}let c=function(){function d(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var e=d.prototype;e.getAvailability=function(h,n){if("unknown"!==this._allAvailability)return this._allAvailability;h=(h-this.location.top)*this.location.width+(n-this.location.left);n=h>>3;const q=this._tileAvailabilityBitSet;return 0>n||n>q.length?"unknown":q[n]&1<<h%8?"available":"unavailable"};e._updateFromData=function(h){let n=!0,q=!0;const u=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let v=0;for(let t=0;t<h.length;t++){const l=t%8;h[t]?(q=!1,u[v]|=1<<l):n=!1;7===l&&++v}q?this._allAvailability="unavailable":n?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=u,this.byteSize+=u.length)};d.fromDefinition=function(h,n){const q=h.service.request||f,{row:u,col:v,width:t,height:l}=h,w={query:{f:"json"}};n=n?{...w,...n}:w;return q(k(h),n).then(y=>y.data).catch(y=>{if(y&&y.details&&422===y.details.httpStatus)return{location:{top:u,left:v,width:t,
height:l},valid:!0,data:p.constant(t*l,0)};throw y;}).then(y=>{if(y.location&&(y.location.top!==u||y.location.left!==v||y.location.width!==t||y.location.height!==l))throw new b("tilemap:location-mismatch","Tilemap response for different location than requested",{response:y,definition:{top:u,left:v,width:t,height:l}});return d.fromJSON(y)})};d.fromJSON=function(h){d.validateJSON(h);const n=new d;n.location=Object.freeze(g.clone(h.location));n._updateFromData(h.data);return Object.freeze(n)};d.validateJSON=
function(h){if(!h||!h.location)throw new b("tilemap:missing-location","Location missing from tilemap response");if(!1===h.valid)throw new b("tilemap:invalid","Tilemap response was marked as invalid");if(!h.data)throw new b("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(h.data))throw new b("tilemap:data-mismatch","Data must be an array of numbers");if(h.data.length!==h.location.width*h.location.height)throw new b("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return d}();a.Tilemap=c;a.default=c;a.tilemapDefinitionId=function(d){return`${d.level}/${d.row}/${d.col}/${d.width}/${d.height}`};a.tilemapDefinitionUrl=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/workers/WorkerHandle"],function(a,g,b){let p=function(k){function c(e){var h=k.call(this,"LercWorker","_decode",e,{strategy:"dedicated"})||this;h.scheduler=e;return h}g._inheritsLoose(c,
k);var d=c.prototype;d.decode=function(e,h,n){return e&&0!==e.byteLength?this.invoke({buffer:e,options:h},n):Promise.resolve(null)};d.getTransferList=function(e){return[e.buffer]};return c}(b.WorkerHandle);const f=new Map;a.acquireDecoder=function(k){let c=f.get(k);c||(c={instance:new p(k),ref:0},f.set(k,c));++c.ref;return c.instance};a.releaseDecoder=function(k){if(null!=k){k=k.scheduler;var c=f.get(k);c&&0>=--c.ref&&(c.instance.destroy(),f.delete(k))}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../maybe ../Logger ../handleUtils ../arrayUtils ../promiseUtils ./workers".split(" "),function(a,g,b,p,f,k,c,d){const e=p.getLogger("esri.core.workers.WorkerHandle");p=function(){function h(q,u,v,t={}){this._mainMethod=u;this._listeners=[];this._promise=d.open(q,{...t,scheduler:v}).then(l=>{if(void 0===this._thread){this._thread=l;this._promise=null;t.hasInitialize&&this.broadcast({},"initialize");for(const w of this._listeners)this._connectListener(w)}else l.close()});
this._promise.catch(l=>e.error(`Failed to initialize ${q} worker: ${l}`))}var n=h.prototype;n.on=function(q,u){const v={removed:!1,eventName:q,callback:u,threadHandle:null};this._listeners.push(v);this._connectListener(v);return f.makeHandle(()=>{v.removed=!0;k.remove(this._listeners,v);this._thread&&b.isSome(v.threadHandle)&&v.threadHandle.remove()})};n.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};n.invoke=function(q,u){return this.invokeMethod(this._mainMethod,
q,u)};n.invokeMethod=function(q,u,v){if(this._thread){const t=this.getTransferList(u,q);return this._thread.invoke(q,u,{transferList:t,signal:v})}return this._promise?this._promise.then(()=>{c.throwIfAborted(v);return this.invokeMethod(q,u,v)}):Promise.reject(null)};n.broadcast=function(q,u){return this._thread?Promise.all(this._thread.broadcast(u,q)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(q,u)):Promise.reject()};n._connectListener=function(q){this._thread&&this._thread.on(q.eventName,
q.callback).then(u=>{q.removed||(q.threadHandle=u)})};g._createClass(h,[{key:"promise",get:function(){return this._promise}}]);return h}();a.WorkerHandle=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/TileLayer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../geometry/SpatialReference ../geometry ../request ./Layer ../core/MultiOriginJSONSupport ./support/arcgisLayerUrl ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ../core/HandleOwner ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./support/Sublayer ./mixins/SublayersOwner".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P){const Q="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");
b=function(X){function aa(...H){H=X.call(this,...H)||this;H.listMode="show";H.isReference=null;H.operationalLayerType="ArcGISTiledMapServiceLayer";H.resampling=!0;H.sourceJSON=null;H.spatialReference=null;H.path=null;H.sublayers=null;H.type="tile";H.url=null;return H}a._inheritsLoose(aa,X);var S=aa.prototype;S.normalizeCtorArgs=function(H,R){return"string"===typeof H?{url:H,...R}:H};S.load=function(H){const R=p.isSome(H)?H.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},
H).then(()=>this._fetchService(R),()=>this._fetchService(R)));return Promise.resolve(this)};S.readSpatialReference=function(H,R){return(H=H||R.tileInfo&&R.tileInfo.spatialReference)&&l.fromJSON(H)};S.writeSublayers=function(H,R,T,W){if(this.loaded&&H){H=H.slice().reverse().flatten(({sublayers:N})=>N&&N.toArray().reverse()).toArray();var Y=[],U={writeSublayerStructure:!1,...W};H.forEach(N=>{N=N.write({},U);Y.push(N)});Y.some(N=>1<Object.keys(N).length)&&(R.layers=Y)}};S.castTileServers=function(H){return Array.isArray(H)?
H.map(R=>u.urlToObject(R).path):null};S.fetchTile=function(H,R,T,W={}){const {signal:Y,timestamp:U}=W;H=this.getTileUrl(H,R,T);R={responseType:"image",signal:Y};null!=U&&(R.query={_ts:W.timestamp});return y(H,R).then(N=>N.data)};S.getTileUrl=function(H,R,T){const W=u.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters}),Y=this.tileServers;return`${Y&&Y.length?Y[R%Y.length]:this.parsedUrl.path}/tile/${H}/${R}/${T}${W?"?"+W:""}`};
S._fetchService=function(H){return(new Promise((R,T)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");R({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new q("tile-layer:undefined-url","layer's url is not defined");var W=r.parse(this.parsedUrl.path);if(p.isSome(W)&&"ImageServer"===W.serverType)throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
y(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},responseType:"json",signal:H}).then(R,T)}})).then(R=>{R.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=R.data;this.read(R.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!r.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,H).then(T=>{this.read({currentVersion:T})}).catch(()=>{})})};S._fetchServerVersion=function(H,R){if(!r.isArcGISUrl(H))return Promise.reject();
H=H.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return y(H,{query:{f:"json",...this.customParameters},responseType:"json",signal:R}).then(T=>{if(T.data&&T.data.currentVersion)return T.data.currentVersion;throw new q("tile-layer:version-not-available");})};S._getMapName=function(H){return(H=H.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&H[2]};S._getDefaultAttribution=function(H){if(H){H=
H.toLowerCase();for(let T=0,W=Q.length;T<W;T++){var R=Q[T];if(-1<R.toLowerCase().indexOf(H))return u.makeAbsolute("//static.arcgis.com/attribution/"+R)}}};S._getDefaultTileServers=function(H){const R=-1!==H.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),T=-1!==H.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return R||T?[H,H.replace(R?/server\.arcgisonline/i:/services\.arcgisonline/i,R?"services.arcgisonline":"server.arcgisonline")]:[]};a._createClass(aa,[{key:"attributionDataUrl",
get:function(){var H;const R=null==(H=this.parsedUrl)?void 0:H.path.toLowerCase();return R&&this._getDefaultAttribution(this._getMapName(R))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}}]);return aa}(m.BlendLayer(P.SublayersOwner(G.ScaleRangeLayer(F.RefreshableLayer(A.OperationalLayer(E.PortalLayer(K.ArcGISCachedService(J.ArcGISMapService(x.ArcGISService(z.MultiOriginJSONMixin(I.HandleOwnerMixin(B.CustomParametersMixin(D)))))))))))));g.__decorate([k.property({readOnly:!0})],
b.prototype,"attributionDataUrl",null);g.__decorate([k.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);g.__decorate([k.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],b.prototype,"isReference",void 0);g.__decorate([k.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],b.prototype,"operationalLayerType",void 0);g.__decorate([k.property({type:Boolean})],b.prototype,"resampling",void 0);g.__decorate([k.property()],
b.prototype,"sourceJSON",void 0);g.__decorate([k.property({type:l})],b.prototype,"spatialReference",void 0);g.__decorate([e.reader("spatialReference",["spatialReference","tileInfo"])],b.prototype,"readSpatialReference",null);g.__decorate([k.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);g.__decorate([k.property({readOnly:!0})],b.prototype,"sublayers",void 0);g.__decorate([n.writer("sublayers",{layers:{type:[L]}})],b.prototype,"writeSublayers",
null);g.__decorate([k.property({json:{read:!1,write:!1}})],b.prototype,"popupEnabled",void 0);g.__decorate([k.property()],b.prototype,"tileServers",null);g.__decorate([c.cast("tileServers")],b.prototype,"castTileServers",null);g.__decorate([k.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);g.__decorate([k.property(C.url)],b.prototype,"url",void 0);return b=g.__decorate([h.subclass("esri.layers.TileLayer")],b)})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../../core/Version ../support/commonProperties".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){a.ArcGISMapService=z=>{z=function(r){function C(){var x=r.apply(this,arguments)||this;x.capabilities=void 0;x.copyright=null;x.fullExtent=null;x.legendEnabled=!0;x.spatialReference=null;x.version=null;return x}g._inheritsLoose(C,r);var A=C.prototype;A.readCapabilities=function(x,m){var B=m.capabilities&&m.capabilities.split(",").map(P=>P.toLowerCase().trim());if(!B)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var E=this.type;x=-1!==B.indexOf("query");const F=-1!==B.indexOf("map"),G=!!m.exportTilesAllowed;B=-1!==B.indexOf("tilemap");const I="tile"!==E&&!!m.supportsDynamicLayers,K="tile"!==E&&(!m.tileInfo||I),J="tile"!==E&&(!m.tileInfo||I);E="tile"!==E;const L=m.cimVersion?y.Version.parse(m.cimVersion).since(1,4):!1;return{operations:{supportsQuery:x,supportsExportMap:F,supportsExportTiles:G,supportsTileMap:B},exportMap:F?{supportsArcadeExpressionForLabeling:L,supportsSublayersChanges:E,
supportsDynamicLayers:I,supportsSublayerVisibility:K,supportsSublayerDefinitionExpression:J}:null,exportTiles:G?{maxExportTilesCount:+m.maxExportTilesCount}:null}};A.readVersion=function(x,m){(x=m.currentVersion)||(x=m.hasOwnProperty("capabilities")||m.hasOwnProperty("tables")?10:m.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return x};A.fetchSublayerInfo=async function(x,m){await this.fetchAllLayersAndTables(m);return this._allLayersAndTablesMap.get(x)};A.fetchAllLayersAndTables=async function(x){await this.load(x);
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=w(n.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(B=>{this._allLayersAndTablesMap=new Map;for(const E of B.data.layers)this._allLayersAndTablesMap.set(E.id,E);return{result:B.data}},B=>({error:B})));const m=await this._allLayersAndTablesPromise;v.throwIfAborted(x);if("result"in m)return m.result;throw m.error;};return C}(z);b.__decorate([c.property({readOnly:!0})],z.prototype,
"capabilities",void 0);b.__decorate([e.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],z.prototype,"readCapabilities",null);b.__decorate([c.property({json:{read:{source:"copyrightText"}}})],z.prototype,"copyright",void 0);b.__decorate([c.property({type:l})],z.prototype,"fullExtent",void 0);b.__decorate([c.property(D.id)],z.prototype,"id",void 0);b.__decorate([c.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},
read:{source:"showLegend"},write:{target:"showLegend"}}})],z.prototype,"legendEnabled",void 0);b.__decorate([c.property(D.popupEnabled)],z.prototype,"popupEnabled",void 0);b.__decorate([c.property({type:t})],z.prototype,"spatialReference",void 0);b.__decorate([c.property()],z.prototype,"version",void 0);b.__decorate([e.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],z.prototype,"readVersion",null);return z=b.__decorate([h.subclass("esri.layers.mixins.ArcGISMapService")],
z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../geometry/Extent ../../geometry ../../core/Collection ./fieldUtils ../../core/Identifiable ../../PopupTemplate ../../request ../../core/Loadable ../../symbols ../../renderers/Renderer ../../renderers/ClassBreaksRenderer ../../renderers/UniqueValueRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/SimpleRenderer ../../renderers/support/types ../../renderers/support/jsonUtils ../../core/MultiOriginJSONSupport ./Field ./FieldsIndex ./LabelClass ./FeatureType ./source/MapLayerSource ./source/DataLayerSource ../../support/popupUtils ../../tasks/support/Query ../../core/HandleOwner".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O){function V(ka){return ka&&"esriSMS"===ka.type}function ba(ka,ha,na){var da;return{ignoreOrigin:!0,enabled:na?"map-image"===(null==(da=na.layer)?void 0:da.type)&&(na.writeSublayerStructure||this.originIdOf(ha)>=y.nameToId(na.origin)):!1}}function fa(ka,ha,na){var da;return{enabled:na?"tile"===(null==(da=na.layer)?void 0:da.type)&&this._isOverridden(ha):!1}}function ia(ka,ha,na){return{ignoreOrigin:!0,
enabled:na&&na.writeSublayerStructure||!1}}function ma(ka,ha,na){return{ignoreOrigin:!0,enabled:na?na.writeSublayerStructure||this.originIdOf(ha)>=y.nameToId(na.origin):!1}}var ea;const M=k.getLogger("esri.layers.support.Sublayer");let Z=0;const la=new Set;la.add("layer");la.add("parent");la.add("loaded");la.add("loadStatus");la.add("loadError");la.add("loadWarnings");p=ea=function(ka){function ha(da){da=ka.call(this,da)||this;da.capabilities=void 0;da.fields=null;da.fullExtent=null;da.globalIdField=
null;da.legendEnabled=!0;da.objectIdField=null;da.popupEnabled=!0;da.popupTemplate=null;da.sourceJSON=null;da.title=null;da.typeIdField=null;da.types=null;return da}g._inheritsLoose(ha,ka);var na=ha.prototype;na.load=async function(da){this.addResolvingPromise((async()=>{var oa;if(!this.layer&&!this.url)throw new t("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let qa=null;if(!this.layer||2<this.originIdOf("url")||"data-layer"===(null==(oa=this.source)?
void 0:oa.type))qa=(await B(this.url,{responseType:"json",query:{f:"json"},...da})).data;else{var ua;oa=this.id;"map-layer"===(null==(ua=this.source)?void 0:ua.type)&&(oa=this.source.mapLayerId);qa=await this.layer.fetchSublayerInfo(oa,da)}qa&&(this.sourceJSON=qa,this.read({layerDefinition:qa},{origin:"service"}))})());return this};na.readCapabilities=function(da,oa){oa=oa.layerDefinition||oa;da=(da=oa.capabilities||da)?da.toLowerCase().split(",").map(qa=>qa.trim()):[];return{exportMap:{supportsModification:!!oa.canModifyLayer},
operations:{supportsQuery:-1!==da.indexOf("query")}}};na.readGlobalIdFieldFromService=function(da,oa){oa=oa.layerDefinition||oa;if(oa.globalIdField)return oa.globalIdField;if(oa.fields)for(const qa of oa.fields)if("esriFieldTypeGlobalID"===qa.type)return qa.name};na.writeLabelingInfo=function(da,oa,qa,ua){da&&da.length&&(oa.layerDefinition={drawingInfo:{labelingInfo:da.map(Ca=>Ca.write({},ua))}})};na.readMinScale=function(da,oa){return oa.minScale||oa.layerDefinition&&oa.layerDefinition.minScale||
0};na.readMaxScale=function(da,oa){return oa.maxScale||oa.layerDefinition&&oa.layerDefinition.maxScale||0};na.readObjectIdFieldFromService=function(da,oa){oa=oa.layerDefinition||oa;if(oa.objectIdField)return oa.objectIdField;if(oa.fields)for(const qa of oa.fields)if("esriFieldTypeOID"===qa.type)return qa.name};na.readOpacity=function(da,oa){da=oa.layerDefinition;return 1-.01*(null!=da.transparency?da.transparency:da.drawingInfo.transparency)};na.writeOpacity=function(da,oa,qa,ua){oa.layerDefinition=
{drawingInfo:{transparency:100-100*da}}};na.writeParent=function(da,oa){oa.parentLayerId=this.parent&&this.parent!==this.layer?c.ensureInteger(this.parent.id):-1};na.castSublayers=function(da){return c.ensureType(C.ofType(ea),da)};na.writeSublayers=function(da,oa,qa){this.get("sublayers.length")&&(oa[qa]=this.sublayers.map(ua=>ua.id).toArray().reverse())};na.readTypeIdField=function(da,oa){oa=oa.layerDefinition||oa;if(da=oa.typeIdField)if(oa=A.getField(oa.fields,da))return oa.name;return null};na.writeVisible=
function(da,oa,qa,ua){oa[qa]=this.getAtOrigin("defaultVisibility","service")||da};na.clone=function(){const {store:da}=d.getProperties(this),oa=new ea;d.getProperties(oa).store=da.clone(la);this.commitProperty("url");oa._lastParsedUrl=this._lastParsedUrl;return oa};na.createPopupTemplate=function(da){return N.createPopupTemplate(this,da)};na.createQuery=function(){return new ca({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};na.createFeatureLayer=async function(){var da,oa;if(this.hasOwnProperty("sublayers"))return null;
const qa=null==(da=this.layer)?void 0:da.parsedUrl;da=new (await new Promise(function(ua,Ca){a(["../FeatureLayer"],function(Ja){ua(Object.freeze({__proto__:null,"default":Ja}))},Ca)})).default({url:qa.path});qa&&this.source&&("map-layer"===this.source.type?da.layerId=this.source.mapLayerId:da.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(da.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(da.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&
(da.labelingInfo=f.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(da.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(da.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(da.visible=this.visible);0<this.originIdOf("minScale")&&(da.minScale=this.minScale);0<this.originIdOf("maxScale")&&(da.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(da.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(da.popupTemplate=f.clone(this.popupTemplate));
2<this.originIdOf("renderer")&&(da.renderer=f.clone(this.renderer));"data-layer"===(null==(oa=this.source)?void 0:oa.type)&&(da.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(da.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(da.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(da.customParameters=this.layer.customParameters);return da};na.getFeatureType=function(da){const {typeIdField:oa,
types:qa}=this;if(!oa||!da)return null;const ua=da.attributes?da.attributes[oa]:void 0;if(null==ua)return null;let Ca=null;qa.some(Ja=>{const {id:Ha}=Ja;if(null==Ha)return!1;Ha.toString()===ua.toString()&&(Ca=Ja);return!!Ca});return Ca};na.getFieldDomain=function(da,oa){return(oa=this.getFeatureType(oa&&oa.feature))&&(oa=oa.domains&&oa.domains[da])&&"inherited"!==oa.type?oa:this._getLayerDomain(da)};na.queryFeatures=function(da=this.createQuery(),oa){return this.load().then(()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new t("Sublayer.queryFeatures",
"this layer doesn't support queries.");return Promise.all([new Promise(function(qa,ua){a(["../../rest/query/operations/query"],qa,ua)}),new Promise(function(qa,ua){a(["../../tasks/support/FeatureSet"],function(Ca){qa(Object.freeze({__proto__:null,"default":Ca}))},ua)})])}).then(([{executeQuery:qa},{default:ua}])=>qa(this.url,ca.from(da),this.layer?this.layer.spatialReference:null,{...oa,query:{...this.layer.customParameters}}).then(Ca=>ua.fromJSON(Ca.data))).then(qa=>{qa&&qa.features&&qa.features.forEach(ua=>
{ua.sourceLayer=this});return qa})};na.toExportImageJSON=function(){var da;const oa={id:this.id,source:(null==(da=this.source)?void 0:da.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(oa.definitionExpression=this.definitionExpression);const qa=["renderer","labelingInfo","opacity","labelsVisible"].reduce((ua,Ca)=>{ua[Ca]=this.originIdOf(Ca);return ua},{});Object.keys(qa).some(ua=>2<qa[ua])&&(da=oa.drawingInfo={},2<qa.renderer&&(da.renderer=this.renderer?this.renderer.toJSON():
null),2<qa.labelsVisible&&(da.showLabels=this.labelsVisible),this.labelsVisible&&2<qa.labelingInfo&&(da.labelingInfo=this.labelingInfo?this.labelingInfo.map(ua=>ua.write({},{origin:"service",layer:this.layer})):null,da.showLabels=!0),2<qa.opacity&&(da.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(da.renderer));return oa};na._assignDefaultSymbolColors=function(da){this._forEachSimpleMarkerSymbols(da,oa=>{oa.color||"esriSMSX"!==oa.style&&"esriSMSCross"!==oa.style||(oa.color=oa.outline&&
oa.outline.color?oa.outline.color:[0,0,0,0])})};na._forEachSimpleMarkerSymbols=function(da,oa){if(da){const qa="uniqueValueInfos"in da?da.uniqueValueInfos:"classBreakInfos"in da?da.classBreakInfos:[];for(const ua of qa)V(ua.symbol)&&oa(ua.symbol);"symbol"in da&&V(da.symbol)&&oa(da.symbol);"defaultSymbol"in da&&V(da.defaultSymbol)&&oa(da.defaultSymbol)}};na._setAndNotifyLayer=function(da,oa){const qa=this.layer,ua=this._get(da);let Ca,Ja;switch(da){case "definitionExpression":Ca="supportsSublayerDefinitionExpression";
case "minScale":case "maxScale":case "visible":Ca="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":Ca="supportsDynamicLayers",Ja="supportsModification"}const Ha=d.getProperties(this).getDefaultOrigin();if("service"!==Ha){if(Ca&&!1===this.get(`layer.capabilities.exportMap.${Ca}`)){this._logLockedError(da,`capability not available 'layer.capabilities.exportMap.${Ca}'`);return}if(Ja&&!1===this.get(`capabilities.exportMap.${Ja}`)){this._logLockedError(da,
`capability not available 'capabilities.exportMap.${Ja}'`);return}}"source"===da&&"not-loaded"!==this.loadStatus?this._logLockedError(da,"'source' can't be changed after calling sublayer.load()"):(this._set(da,oa),"service"!==Ha&&ua!==oa&&qa&&qa.emit&&qa.emit("sublayer-update",{propertyName:da,target:this}))};na._handleSublayersChange=function(da,oa){oa&&(oa.forEach(qa=>{qa.parent=null;qa.layer=null}),this.handles.removeAll());da&&(da.forEach(qa=>{qa.parent=this;qa.layer=this.layer}),this.handles.add([da.on("after-add",
({item:qa})=>{qa.parent=this;qa.layer=this.layer}),da.on("after-remove",({item:qa})=>{qa.parent=null;qa.layer=null}),da.on("before-changes",qa=>{const ua=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==ua||ua||(M.error(new t("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),qa.preventDefault())})]))};na._logLockedError=function(da,oa){M.error(new t("sublayer:locked",`Property '${da}' can't be changed on Sublayer from the layer '${this.layer.id}'`,
{reason:oa,sublayer:this,layer:this.layer}))};na._getLayerDomain=function(da){return(da=this.fieldsIndex.get(da))?da.domain:null};g._createClass(ha,[{key:"definitionExpression",set:function(da){this._setAndNotifyLayer("definitionExpression",da)}},{key:"fieldsIndex",get:function(){return new R(this.fields||[])}},{key:"id",get:function(){const da=this._get("id");return null==da?Z++:da},set:function(da){this._get("id")!==da&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id",
"capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",da))}},{key:"labelingInfo",set:function(da){this._setAndNotifyLayer("labelingInfo",da)}},{key:"labelsVisible",set:function(da){this._setAndNotifyLayer("labelsVisible",da)}},{key:"layer",set:function(da){this._set("layer",da);this.sublayers&&this.sublayers.forEach(oa=>oa.layer=da)}},{key:"listMode",set:function(da){this._set("listMode",da)}},{key:"minScale",set:function(da){this._setAndNotifyLayer("minScale",
da)}},{key:"maxScale",set:function(da){this._setAndNotifyLayer("maxScale",da)}},{key:"opacity",set:function(da){this._setAndNotifyLayer("opacity",da)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(da){if(da)for(const oa of da.getSymbols())if(F.isSymbol3D(oa)){M.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",da)}},{key:"source",get:function(){return this._get("source")||new Y.MapLayerSource({mapLayerId:this.id})},
set:function(da){this._setAndNotifyLayer("source",da)}},{key:"sublayers",set:function(da){this._handleSublayersChange(da,this._get("sublayers"));this._set("sublayers",da)}},{key:"url",get:function(){var da,oa;const qa=null!=(da=null==(oa=this.layer)?void 0:oa.parsedUrl)?da:this._lastParsedUrl;da=this.source;if(!qa)return null;this._lastParsedUrl=qa;if("map-layer"===(null==da?void 0:da.type))return`${qa.path}/${da.mapLayerId}`;da={layer:JSON.stringify({source:this.source})};return`${qa.path}/dynamicLayer?${l.objectToQuery(da)}`},
set:function(da){da?this._override("url",da):this._clearOverride("url")}},{key:"visible",set:function(da){this._setAndNotifyLayer("visible",da)}}]);return ha}(O.HandleOwnerMixin(S.MultiOriginJSONMixin(x.IdentifiableMixin(E))));p.test={isMapImageLayerOverridePolicy:ka=>ka===ia||ka===ba,isTileImageLayerOverridePolicy:ka=>ka===fa};b.__decorate([e.property({readOnly:!0})],p.prototype,"capabilities",void 0);b.__decorate([q.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],
p.prototype,"readCapabilities",null);b.__decorate([e.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:ba}}})],p.prototype,"definitionExpression",null);b.__decorate([e.property({type:[H],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],p.prototype,"fields",void 0);b.__decorate([e.property({readOnly:!0})],p.prototype,"fieldsIndex",null);b.__decorate([e.property({type:z,
json:{read:{source:"layerDefinition.extent"}}})],p.prototype,"fullExtent",void 0);b.__decorate([e.property({type:String})],p.prototype,"globalIdField",void 0);b.__decorate([q.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],p.prototype,"readGlobalIdFieldFromService",null);b.__decorate([e.property({type:c.Integer,json:{write:{ignoreOrigin:!0}}})],p.prototype,"id",null);b.__decorate([e.property({value:null,type:[T],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ia}}})],p.prototype,"labelingInfo",null);b.__decorate([v.writer("labelingInfo")],p.prototype,"writeLabelingInfo",null);b.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ia}}})],p.prototype,"labelsVisible",null);b.__decorate([e.property({value:null})],p.prototype,"layer",null);b.__decorate([e.property({type:Boolean,
value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ma}}})],p.prototype,"legendEnabled",void 0);b.__decorate([e.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],p.prototype,"listMode",null);b.__decorate([e.property({type:Number,value:0,json:{write:{overridePolicy:ia}}})],p.prototype,"minScale",null);b.__decorate([q.reader("minScale",["minScale","layerDefinition.minScale"])],
p.prototype,"readMinScale",null);b.__decorate([e.property({type:Number,value:0,json:{write:{overridePolicy:ia}}})],p.prototype,"maxScale",null);b.__decorate([q.reader("maxScale",["maxScale","layerDefinition.maxScale"])],p.prototype,"readMaxScale",null);b.__decorate([e.property({type:String})],p.prototype,"objectIdField",void 0);b.__decorate([q.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],p.prototype,"readObjectIdFieldFromService",null);b.__decorate([e.property({type:Number,
value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ia}}})],p.prototype,"opacity",null);b.__decorate([q.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],p.prototype,"readOpacity",null);b.__decorate([v.writer("opacity")],p.prototype,"writeOpacity",null);b.__decorate([e.property({json:{type:c.Integer,write:{target:"parentLayerId",allowNull:!0,overridePolicy:ia}}})],p.prototype,"parent",void 0);b.__decorate([v.writer("parent")],
p.prototype,"writeParent",null);b.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(ka,ha){return!ha.disablePopup}},write:{target:"disablePopup",overridePolicy:ma,writer(ka,ha,na){ha[na]=!ka}}}})],p.prototype,"popupEnabled",void 0);b.__decorate([e.property({type:m,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ma}}})],p.prototype,"popupTemplate",void 0);b.__decorate([e.property({readOnly:!0})],p.prototype,"defaultPopupTemplate",null);
b.__decorate([e.property({types:X.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ia},origins:{"web-scene":{types:X.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ia}}}}})],p.prototype,"renderer",null);b.__decorate([e.property({types:{key:"type",base:null,typeMap:{"data-layer":U.DataLayerSource,"map-layer":Y.MapLayerSource}},cast(ka){if(ka){if("mapLayerId"in ka)return c.ensureClass(Y.MapLayerSource,ka);if("dataSource"in
ka)return c.ensureClass(U.DataLayerSource,ka)}return ka},json:{name:"layerDefinition.source",write:{overridePolicy:ia}}})],p.prototype,"source",null);b.__decorate([e.property()],p.prototype,"sourceJSON",void 0);b.__decorate([e.property({value:null,json:{type:[c.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ia}}})],p.prototype,"sublayers",null);b.__decorate([h.cast("sublayers")],p.prototype,"castSublayers",null);b.__decorate([v.writer("sublayers")],p.prototype,"writeSublayers",null);
b.__decorate([e.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:ma}}})],p.prototype,"title",void 0);b.__decorate([e.property({type:String})],p.prototype,"typeIdField",void 0);b.__decorate([q.reader("typeIdField",["layerDefinition.typeIdField"])],p.prototype,"readTypeIdField",null);b.__decorate([e.property({type:[W],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],p.prototype,"types",void 0);b.__decorate([e.property({type:String,
json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:fa}}})],p.prototype,"url",null);b.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ia}}})],p.prototype,"visible",null);b.__decorate([v.writer("visible")],p.prototype,"writeVisible",null);return p=ea=b.__decorate([u.subclass("esri.layers.support.Sublayer")],p)})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/Collection ../../core/CollectionFlattener ../support/Sublayer ../support/sublayerUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){function z(x,m){const B=[],E={};if(!x)return B;x.forEach(F=>{const G=new y;G.read(F,m);E[G.id]=G;null!=F.parentLayerId&&-1!==F.parentLayerId?(F=E[F.parentLayerId],F.sublayers||(F.sublayers=[]),F.sublayers.unshift(G)):B.unshift(G)});return B}function r(x,m){x&&x.forEach(B=>{m(B);B.sublayers&&B.sublayers.length&&r(B.sublayers,m)})}const C=f.getLogger("esri.layers.TileLayer"),A=l.ofType(y);a.SublayersOwner=x=>{x=function(m){function B(...F){var G=m.call(this,
...F)||this;G.allSublayers=new w({root:g._assertThisInitialized(G),rootCollectionNames:["sublayers"],getChildrenFunction(I){return I.sublayers}});G.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};G.watch("sublayers",(I,K)=>G._handleSublayersChange(I,K),!0);return G}g._inheritsLoose(B,m);var E=B.prototype;E.readSublayers=function(F,G){if(G&&F){var {sublayersSourceJSON:I}=this,K=v.nameToId(G.origin);if(!(2>K||(I[K]={context:G,visibleLayers:F.visibleLayers||I[K].visibleLayers,layers:F.layers||I[K].layers},
2<K))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:J,origin:L}=this.createSublayersForOrigin("web-document");F=c.getProperties(this);F.setDefaultOrigin(L);this._set("sublayers",new A(J));F.setDefaultOrigin("user")}}};E.findSublayerById=function(F){return this.allSublayers.find(G=>G.id===F)};E.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};E.createSublayersForOrigin=function(F){const G="web-document"===
F?v.nameToId("web-map"):v.nameToId(F);let I=2;F=this.sublayersSourceJSON[2].layers;let K=this.sublayersSourceJSON[2].context,J=null;var L=[3,4,5].filter(H=>H<=G);for(var P of L)L=this.sublayersSourceJSON[P],D.isSublayerOverhaul(L.layers)&&(I=P,F=L.layers,K=L.context,L.visibleLayers&&(J={visibleLayers:L.visibleLayers,context:L.context}));P=[3,4,5].filter(H=>H>I&&H<=G);let Q=null;for(var X of P){const {layers:H,visibleLayers:R,context:T}=this.sublayersSourceJSON[X];H&&(Q={layers:H,context:T});R&&(J=
{visibleLayers:R,context:T})}X=z(F,K);const aa=new Map,S=new Set;if(Q)for(const H of Q.layers)aa.set(H.id,H);if(J)for(const H of J.visibleLayers)S.add(H);r(X,H=>{Q&&H.read(aa.get(H.id),Q.context);J&&H.read({defaultVisibility:S.has(H.id)},J.context)});return{origin:v.idToName(I),sublayers:new A({items:X})}};E.read=function(F,G){m.prototype.read.call(this,F,G);this.readSublayers(F,G)};E._handleSublayersChange=function(F,G){G&&(G.forEach(I=>{I.parent=null;I.layer=null}),this.handles.remove("sublayers-owner"));
F&&(F.forEach(I=>{I.parent=this;I.layer=this}),this.handles.add([F.on("after-add",({item:I})=>{I.parent=this;I.layer=this}),F.on("after-remove",({item:I})=>{I.parent=null;I.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(F.on("before-changes",I=>{C.error(new n("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));I.preventDefault()}),"sublayers-owner"))};return B}(x);b.__decorate([d.property({readOnly:!0})],
x.prototype,"allSublayers",void 0);b.__decorate([d.property({readOnly:!0,type:l.ofType(y)})],x.prototype,"serviceSublayers",void 0);b.__decorate([d.property({value:null,type:A,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],x.prototype,"sublayers",void 0);b.__decorate([d.property({readOnly:!0})],x.prototype,"sublayersSourceJSON",void 0);return x=b.__decorate([h.subclass("esri.layers.mixins.SublayersOwner")],x)};a.forEachSublayer=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],
function(a){function g(b,p){if(!b||!b.length)return!0;p=p.slice().reverse().flatten(({sublayers:c})=>c&&c.toArray().reverse()).map(c=>c.id).toArray();if(b.length>p.length)return!1;let f=0;const k=p.length;for(const {id:c}of b){for(;f<k&&p[f]!==c;)f++;if(f>=k)return!1}return!0}a.isExportDynamic=function(b,p,f){return b.some(k=>{const c=k.source;return!(!c||"map-layer"===c.type&&c.mapLayerId===k.id&&(!c.gdbVersion||c.gdbVersion===f.gdbVersion))||2<k.originIdOf("renderer")||2<k.originIdOf("labelingInfo")||
2<k.originIdOf("opacity")||2<k.originIdOf("labelsVisible")})?!0:!g(b,p)};a.isSublayerOverhaul=function(b){return!!b&&b.some(p=>null!=p.minScale||p.layerDefinition&&null!=p.layerDefinition.minScale)};a.shouldWriteSublayerStructure=function(b,p,f){return p.flatten(({sublayers:k})=>k).length!==b.length||b.some(k=>k.originIdOf("minScale")>f||k.originIdOf("maxScale")>f||k.originIdOf("renderer")>f||k.originIdOf("labelingInfo")>f||k.originIdOf("opacity")>f||k.originIdOf("labelsVisible")>f||k.originIdOf("source")>
f)?!0:!g(b,p)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/VectorTileLayer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry/Extent ../request ./Layer ../core/MultiOriginJSONSupport ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./mixins/ArcGISCachedService ./support/imageUtils ./support/SpriteSource ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository ../views/webgl/capabilities".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S){p=function(H){function R(...W){W=H.call(this,...W)||this;W._spriteSourceMap=new Map;W.currentStyleInfo=null;W.style=null;W.isReference=null;W.operationalLayerType="VectorTileLayer";W.type="vector-tile";W.url=null;return W}a._inheritsLoose(R,H);var T=R.prototype;T.normalizeCtorArgs=function(W,Y){return"string"===typeof W?{url:W,...Y}:W};T.destroy=function(){this._spriteSourceMap.clear()};T.prefetchResources=async function(W){await this.loadSpriteSource(b.devicePixelRatio||
1,W)};T.load=function(W){const Y=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},W).then(async()=>{if(this.portalItem&&this.portalItem.id){var U=`${this.portalItem.itemUrl}/resources/styles/root.json`;(await z(U,{...W,query:{f:"json"}})).data&&this.read({url:U},P.createForItem(this.portalItem))}}).then(()=>this._loadStyle(W),()=>this._loadStyle(W));this.addResolvingPromise(Y);return Promise.resolve(this)};T.writeStyleUrl=function(W,Y){W&&v.isProtocolRelative(W)&&(W=`https:${W}`);
Y.styleUrl=W};T.readVersion=function(W,Y){return Y.version?parseFloat(Y.version):parseFloat(Y.currentVersion)};T.loadSpriteSource=async function(W=1,Y){if(!this._spriteSourceMap.has(W)){var U=S();U=new J(this.styleRepository.sprite,W,U.maxTextureSize,this.currentStyleInfo.spriteFormat);await U.load(Y);this._spriteSourceMap.set(W,U)}return Promise.resolve(this._spriteSourceMap.get(W))};T.loadStyle=async function(W,Y){const U=W||this.style||this.url;if(this._loadingPromise&&"string"===typeof U&&this.url===
U&&!w.isAborted(this._abortController))return this._loadingPromise;(W=this._abortController)&&W.abort();const N=w.createAbortController();this._loadingPromise=new Promise((ca,O)=>{const V={signal:N.signal};this._spriteSourceMap.clear();this._getSourceAndStyle(U,V).then(ca,O);w.onAbort(Y,()=>{N.abort()})});this._abortController=N;return this._loadingPromise};T.getStyleLayerId=function(W){return this.styleRepository.getStyleLayerId(W)};T.getStyleLayerIndex=function(W){return this.styleRepository.getStyleLayerIndex(W)};
T.getPaintProperties=function(W){return f.clone(this.styleRepository.getPaintProperties(W))};T.setPaintProperties=function(W,Y){const U=this.styleRepository.isPainterDataDriven(W);this.styleRepository.setPaintProperties(W,Y);const N=this.styleRepository.isPainterDataDriven(W);this.emit("paint-change",{layerName:W,paint:Y,isDataDriven:U||N})};T.getStyleLayer=function(W){return f.clone(this.styleRepository.getStyleLayer(W))};T.setStyleLayer=function(W,Y){this.styleRepository.setStyleLayer(W,Y);this.emit("style-layer-change",
{layer:W,index:Y})};T.deleteStyleLayer=function(W){this.styleRepository.deleteStyleLayer(W);this.emit("delete-style-layer",{layerName:W})};T.getLayoutProperties=function(W){return f.clone(this.styleRepository.getLayoutProperties(W))};T.setLayoutProperties=function(W,Y){this.styleRepository.setLayoutProperties(W,Y);this.emit("layout-change",{layer:W,layout:Y})};T.setStyleLayerVisibility=function(W,Y){this.styleRepository.setStyleLayerVisibility(W,Y);this.emit("style-layer-visibility-change",{layer:W,
visibility:Y})};T.getStyleLayerVisibility=function(W){return this.styleRepository.getStyleLayerVisibility(W)};T.getTileUrl=function(W,Y,U){let N=this.tileServers[Y%this.tileServers.length];return N=N.replace(/\{z\}/gi,W.toString()).replace(/\{y\}/gi,Y.toString()).replace(/\{x\}/gi,U.toString())};T.write=function(W,Y){return Y&&Y.origin&&!this.styleUrl?(Y.messages&&Y.messages.push(new u("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,
{layer:this})),null):H.prototype.write.call(this,W,Y)};T._getSourceAndStyle=async function(W,Y){if(!W)throw Error("invalid style!");Y=await L.loadMetadata(W,Y);"webp"!==Y.spriteFormat||await K.checkWebPSupport("lossy")||(Y.spriteFormat="png");this._set("currentStyleInfo",{...Y});"string"===typeof W?(this.url=W,this.style=null):(this.url=null,this.style=W);this._set("sourceNameToSource",Y.sourceNameToSource);this._set("primarySourceName",Y.primarySourceName);this._set("styleRepository",new aa(Y.style,
Y));this.read(Y.layerDefinition,{origin:"service"});this.emit("load-style",{})};T._getDefaultAttribution=function(W){var Y=W.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);W="OpenStreetMap_v2 OpenStreetMap_Daylight_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84 World_Contours_v2".split(" ");
if(Y){var U=Y[2]&&Y[2].toLowerCase();if(U){Y=Y[1]||"";for(const N of W)if(-1<N.toLowerCase().indexOf(U))return v.normalize(`//static.arcgis.com/attribution/Vector${Y}/${N}`)}}};T._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};T._loadStyle=async function(W){return this._loadingPromise?this._loadingPromise:this.loadStyle(null,W)};a._createClass(R,[{key:"attributionDataUrl",get:function(){var W=
this.currentStyleInfo;return(W=W&&W.serviceUrl&&v.urlToObject(W.serviceUrl))?this._getDefaultAttribution(W.path):null}},{key:"capabilities",get:function(){const W=this._getPrimarySource();return W?W.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}},{key:"fullExtent",get:function(){const W=this._getPrimarySource();return W?W.fullExtent:null}},{key:"parsedUrl",get:function(){return this.serviceUrl?v.urlToObject(this.serviceUrl):null}},{key:"serviceUrl",get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null}},{key:"spatialReference",get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null}},{key:"styleUrl",get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null}},{key:"tileIndexType",get:function(){const W=this._getPrimarySource();return W?W.type:""}},{key:"tileIndexUrl",get:function(){const W=this._getPrimarySource();return W?W.tileMapURL:""}},{key:"tileInfo",get:function(){var W;const Y=[];for(var U in this.sourceNameToSource)Y.push(this.sourceNameToSource[U]);
U=(null==(W=this._getPrimarySource())?void 0:W.tileInfo)||new F;if(1<Y.length)for(W=0;W<Y.length;W++)X.areSchemasOverlapping(U,Y[W].tileInfo)&&(U=X.unionTileInfos(U,Y[W].tileInfo));return U}},{key:"tilemapCache",get:function(){const W=this._getPrimarySource();return W?W.capabilities.operations.supportsTileMap?W.tilemapCache:null:null}},{key:"tileServers",get:function(){const W=this._getPrimarySource();return W?W.tileServers:[]}},{key:"compatibleTileInfo256",get:function(){return Q.create256x256CompatibleTileInfo(this.tileInfo)}},
{key:"compatibleTileInfo512",get:function(){return Q.create512x512CompatibleTileInfo(this.tileInfo)}}]);return R}(m.BlendLayer(E.ScaleRangeLayer(I.ArcGISCachedService(x.ArcGISService(A.OperationalLayer(B.PortalLayer(C.MultiOriginJSONMixin(r))))))));g.__decorate([d.property({readOnly:!0})],p.prototype,"attributionDataUrl",null);g.__decorate([d.property({type:["show","hide"]})],p.prototype,"listMode",void 0);g.__decorate([d.property({readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"],
json:{read:!1}})],p.prototype,"capabilities",null);g.__decorate([d.property({readOnly:!0})],p.prototype,"currentStyleInfo",void 0);g.__decorate([d.property({json:{read:!1},readOnly:!0,type:D})],p.prototype,"fullExtent",null);g.__decorate([d.property()],p.prototype,"style",void 0);g.__decorate([d.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],p.prototype,"isReference",void 0);g.__decorate([d.property({type:["VectorTileLayer"]})],p.prototype,"operationalLayerType",
void 0);g.__decorate([d.property({readOnly:!0})],p.prototype,"parsedUrl",null);g.__decorate([d.property({readOnly:!0})],p.prototype,"serviceUrl",null);g.__decorate([d.property({type:y,readOnly:!0})],p.prototype,"spatialReference",null);g.__decorate([d.property({readOnly:!0})],p.prototype,"styleRepository",void 0);g.__decorate([d.property({readOnly:!0})],p.prototype,"sourceNameToSource",void 0);g.__decorate([d.property({readOnly:!0})],p.prototype,"primarySourceName",void 0);g.__decorate([d.property({type:String,
readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],p.prototype,"styleUrl",null);g.__decorate([q.writer(["portal-item","web-document"],"styleUrl")],p.prototype,"writeStyleUrl",null);g.__decorate([d.property({json:{read:!1},readOnly:!0})],p.prototype,"tileIndexType",null);g.__decorate([d.property({json:{read:!1},readOnly:!0})],p.prototype,"tileIndexUrl",null);g.__decorate([d.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,
type:F})],p.prototype,"tileInfo",null);g.__decorate([d.property({json:{read:!1},readOnly:!0,type:G.TilemapCache})],p.prototype,"tilemapCache",null);g.__decorate([d.property({json:{read:!1},readOnly:!0})],p.prototype,"tileServers",null);g.__decorate([d.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],p.prototype,"type",void 0);g.__decorate([d.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],p.prototype,"url",void 0);
g.__decorate([d.property({readOnly:!0})],p.prototype,"version",void 0);g.__decorate([h.reader("version",["version","currentVersion"])],p.prototype,"readVersion",null);g.__decorate([d.property({readOnly:!0})],p.prototype,"compatibleTileInfo256",null);g.__decorate([d.property({readOnly:!0})],p.prototype,"compatibleTileInfo512",null);return p=g.__decorate([n.subclass("esri.layers.VectorTileLayer")],p)})},"esri/layers/support/imageUtils":function(){define(["exports"],function(a){a.checkWebPSupport=function(g){const b=
{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA\x3d\x3d",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA\x3d\x3d",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return new Promise(p=>{const f=new Image;f.onload=()=>{f.onload=f.onerror=null;p(0<f.width&&0<f.height)};f.onerror=
()=>{f.onload=f.onerror=null;p(!1)};f.src="data:image/webp;base64,"+b[g]})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/SpriteSource":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/Error","../../core/urlUtils","../../request"],function(a,g,b,p,f){const k=g.getLogger("esri.layers.support.SpriteSource");return function(){function c(e,h,n,q){this.baseURL=e;this.devicePixelRatio=h;this.maxTextureSize=n;this._spriteImageFormat=q;
this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}var d=c.prototype;d.getSpriteInfo=function(e){return this._spritesData[e]};d.load=async function(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"};d._loadSprites=function(e){this._isRetina=1.15<this.devicePixelRatio?!0:!1;const h=p.urlToObject(this.baseURL),n=h.query?"?"+p.objectToQuery(h.query):
"",q=this._isRetina?"@2x":"",u=`${h.path}${q}.${this._spriteImageFormat}${n}`;return Promise.all([f(`${h.path}${q}.json${n}`,e),f(u,{responseType:"image",...e})]).then(([v,t])=>{var l=Object.keys(v.data);if(!l||0===l.length||1===l.length&&"_ssl"===l[0]||!t||!t.data)return this._spritesData=this.image=null,this.width=this.height=0,Promise.resolve(null);this._spritesData=v.data;v=t.data;t=Math.max(this.maxTextureSize,4096);if(v.width>t||v.height>t)throw v=`Sprite resource for style ${h.path} is bigger than the maximum allowed of ${t} pixels}`,
k.error(v),new b("SpriteSource",v);this.width=v.width;this.height=v.height;t=document.createElement("canvas");l=t.getContext("2d");t.width=v.width;t.height=v.height;l.drawImage(v,0,0,v.width,v.height);v=l.getImageData(0,0,v.width,v.height);v=new Uint8Array(v.data);for(l=0;l<v.length;l+=4)t=v[l+3]/255,v[l]*=t,v[l+1]*=t,v[l+2]*=t;this.image=v})};a._createClass(c,[{key:"spriteNames",get:function(){const e=[];for(const h in this._spritesData)e.push(h);e.sort();return e}}]);return c}()})},"esri/layers/support/vectorTileLayerLoader":function(){define("exports ../../config ../../core/urlUtils ../../core/promiseUtils ../../request ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(a,g,b,p,f,k){function c(u){u&&(u=b.getOrigin(u),q&&-1===q.indexOf(u)&&q.push(u))}function d(...u){let v=void 0;for(let t=0;t<u.length;++t)b.isProtocolRelative(u[t])?v&&(v=v.split("://")[0]+":"+u[t].trim()):v=b.isAbsolute(u[t])?u[t]:b.join(v,u[t]);return b.removeTrailingSlash(v)}async function e(u,v,t,l,w){p.throwIfAborted(w);if("string"===typeof t){l=b.normalize(t);c(l);var y=b.urlToObject(l);y=await f(y.path,{query:{f:"json"},responseType:"json",...w});t=l}else y={data:t},t=t.jsonUrl||null;
const D=y.data;y.ssl&&(t&&(t=t.replace(/^http:/i,"https:")),l&&(l=l.replace(/^http:/i,"https:")));return D.sources?(u.styleUrl=t||null,h(u,D,l,w)):D.sources?Promise.reject("You must specify the URL or the JSON for a service or for a style."):u.sourceUrl?n(u,D,l,!1,v,w):(u.sourceUrl=t||null,n(u,D,l,!0,v,w))}async function h(u,v,t,l){t=t?b.removeFile(t):b.appBaseUrl;u.styleBase=t;u.style=v;u.styleUrl&&c(u.styleUrl);v["sprite-format"]&&"webp"===v["sprite-format"].toLowerCase()&&(u.spriteFormat="webp");
const w=[];if(v.sources&&v.sources.esri){const y=v.sources.esri;y.url?await e(u,"esri",d(t,y.url),void 0,l):w.push(e(u,"esri",y,t,l))}for(const y of Object.keys(v.sources))"esri"!==y&&"vector"===v.sources[y].type&&(v.sources[y].url?w.push(e(u,y,d(t,v.sources[y].url),void 0,l)):v.sources[y].tiles&&w.push(e(u,y,v.sources[y],t,l)));await Promise.all(w)}async function n(u,v,t,l,w,y){t=t?b.removeTrailingSlash(t)+"/":b.appBaseUrl;if(v.hasOwnProperty("tileInfo"))var D=v;else{var z={xmin:-2.0037507067161843E7,
ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},r=78271.51696400007,C=2.958287637957775E8,A=[],x=v.hasOwnProperty("minzoom")?parseFloat(v.minzoom):0,m=v.hasOwnProperty("maxzoom")?parseFloat(v.maxzoom):22;for(let B=0;B<=m;B++)B>=x&&A.push({level:B,scale:C,resolution:r}),r/=2,C/=2;for(D of v.tiles)c(d(t,D));D={capabilities:"TilesOnly",initialExtent:z,fullExtent:z,minScale:0,maxScale:0,tiles:v.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",
origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:A,spatialReference:{wkid:102100}}}}z=new k(w,t,D);if(!l&&u.primarySourceName in u.sourceNameToSource){r=u.sourceNameToSource[u.primarySourceName];if(!r.isCompatibleWith(z))return Promise.resolve();null!=z.fullExtent&&(null!=r.fullExtent?r.fullExtent.union(z.fullExtent):r.fullExtent=z.fullExtent.clone());r.tileInfo.lods.length<z.tileInfo.lods.length&&(r.tileInfo=z.tileInfo)}l?(u.sourceBase=t,u.source=v,u.validatedSource=D,u.primarySourceName=w,
u.sourceUrl&&c(u.sourceUrl)):c(t);u.sourceNameToSource[w]=z;if(!u.style)return null==v.defaultStyles?Promise.reject():"string"===typeof v.defaultStyles?e(u,"",d(t,v.defaultStyles,"root.json"),void 0,y):e(u,"",v.defaultStyles,d(t,"root.json"),y)}const q=g.defaults&&g.defaults.io.corsEnabledServers;a.loadMetadata=async function(u,v){const t={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},
[l,w]="string"===typeof u?[u,null]:[null,u.jsonUrl],y=l?b.urlToObject(l):null;await e(t,"esri",u,w,v);u={layerDefinition:t.validatedSource,url:l,parsedUrl:y,serviceUrl:t.sourceUrl,style:t.style,styleUrl:t.styleUrl,spriteUrl:t.style.sprite&&d(t.styleBase,t.style.sprite),spriteFormat:t.spriteFormat,glyphsUrl:t.style.glyphs&&d(t.styleBase,t.style.glyphs),sourceNameToSource:t.sourceNameToSource,primarySourceName:t.primarySourceName};c(u.spriteUrl);c(u.glyphsUrl);return u};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),function(a,g,b,p,f,k){return function(){function c(e,h,n){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=e;if(this.sourceUrl=
h)this.parsedUrl=g.urlToObject(this.sourceUrl);const q=this.parsedUrl.path,u=this.parsedUrl.query?"?"+g.objectToQuery(this.parsedUrl.query):"";e=a.clone(n);const v=e.tiles;h&&v.forEach((w,y)=>{g.isAbsolute(w)||(v[y]=g.join(q,w)+u)});this.tileServers=v;n.tileMap&&(this.tileMapURL=g.join(h,n.tileMap));var t=n.capabilities&&n.capabilities.split(",").map(w=>w.toLowerCase().trim());h=!!n.exportTilesAllowed;t=!!t&&-1!==t.indexOf("tilemap");const l=h&&n.hasOwnProperty("maxExportTilesCount")?n.maxExportTilesCount:
0;this.capabilities={operations:{supportsExportTiles:h,supportsTileMap:t},exportTiles:h?{maxExportTilesCount:+l}:null};this.tileInfo=p.readServiceTileInfo(e.tileInfo,e,null,{ignoreMinMaxLOD:!0});t&&(this.type="vector-tile",this.tilemapCache=new f.TilemapCache({layer:this}),this.tileIndex=new k(this.tilemapCache));this.fullExtent=b.fromJSON(n.fullExtent)}var d=c.prototype;d.getRefKey=function(e,h){return this.tileIndex?this.tileIndex.dataKey(e,h):Promise.resolve(e)};d.getSourceTileUrl=function(e,h,
n){let q=this.tileServers[h%this.tileServers.length];return q=q.replace(/\{z\}/gi,e.toString()).replace(/\{y\}/gi,h.toString()).replace(/\{x\}/gi,n.toString())};d.isCompatibleWith=function(e){var h=this.tileInfo;e=e.tileInfo;if(!h.spatialReference.equals(e.spatialReference)||!h.origin.equals(e.origin)||Math.round(h.dpi)!==Math.round(e.dpi))return!1;h=h.lods;e=e.lods;const n=Math.min(h.length,e.length);for(let q=0;q<n;q++){const u=h[q],v=e[q];if(u.level!==v.level||Math.round(u.scale)!==Math.round(v.scale))return!1}return!0};
return c}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(a,g,b){return function(){function p(k){if(k instanceof g.TilemapCache)this._tilemapCache=k;else if(k&&"index"in k)this._tilemap=k.index;else throw Error("Invalid tilemap!");}var f=p.prototype;f.dataKey=function(k,c){if(this._tilemapCache){const {level:d,row:e,col:h}=k,n=new b(k);return this._tilemapCache.fetchAvailabilityUpsample(d,
e,h,n,c).then(()=>{n.world=k.world;return n}).catch(q=>{if(a.isAbortError(q))throw q;return null})}return this._getIndexedDataKey(k)};f.forEach=function(k,c,d,e,h){this._callback=h;this._maxLevel=c+k;this._forEach(this._tilemap,c,d,e)};f._forEach=function(k,c,d,e){0!==k&&(this._callback(c,d,e),c!==this._maxLevel&&"object"===typeof k&&(this._forEach(k[0],c+1,2*d,2*e),this._forEach(k[1],c+1,2*d,2*e+1),this._forEach(k[2],c+1,2*d+1,2*e),this._forEach(k[3],c+1,2*d+1,2*e+1)))};f._getIndexedDataKey=function(k){const c=
[k];if(0>k.level||0>k.row||0>k.col||0<k.row>>k.level||0<k.col>>k.level)return Promise.resolve(null);for(;0!==k.level;)k=new b(k.level-1,k.row>>1,k.col>>1,k.world),c.push(k);k=this._tilemap;let d=c.pop(),e,h;if(1===k)return Promise.resolve(d);for(;c.length;)if(e=c.pop(),h=(e.col&1)+((e.row&1)<<1),k){if(0===k[h]){d=null;break}if(1===k[h]){d=e;break}d=e;k=k[h]}return Promise.resolve(d)};return p}()})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],
function(a,g){let b=function(){function p(k,c,d,e){this.set(k,c,d,e)}p.getId=function(k,c,d,e){return"object"===typeof k?`${k.level}/${k.row}/${k.col}/${k.world}`:`${k}/${c}/${d}/${e}`};var f=p.prototype;f.acquire=function(k,c,d,e){this.set(k,c,d,e)};f.contains=function(k){const c=k.level-this.level;return this.row===k.row>>c&&this.col===k.col>>c&&this.world===k.world};f.equals=function(k){return this.level===k.level&&this.row===k.row&&this.col===k.col&&this.world===k.world};f.clone=function(){return new p(this)};
f.release=function(){this.world=this.col=this.row=this.level=0};f.set=function(k,c,d,e){if(null==k)this.world=this.col=this.row=this.level=0;else if("object"===typeof k)this.level=k.level||0,this.row=k.row||0,this.col=k.col||0,this.world=k.world||0;else if("string"===typeof k){const [h,n,q,u]=k.split("/");this.level=parseFloat(h);this.row=parseFloat(n);this.col=parseFloat(q);this.world=parseFloat(u)}else this.level=+k,this.row=+c,this.col=+d,this.world=+e||0;return this};f.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};
f.getParentKey=function(){return 0>=this.level?null:new p(this.level-1,this.row>>1,this.col>>1,this.world)};f.getChildKeys=function(){const k=this.level+1,c=this.row<<1,d=this.col<<1,e=this.world;return[new p(k,c,d,e),new p(k,c,d+1,e),new p(k,c+1,d,e),new p(k,c+1,d+1,e)]};f.compareRowMajor=function(k){return this.row<k.row?-1:this.row>k.row?1:this.col<k.col?-1:this.col>k.col?1:0};a._createClass(p,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(k){this.set(k)}}]);
return p}();b.pool=new g(b,null,null,25,50);return b})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(a,g,b){a.createForItem=function(p){return{origin:"portal-item",url:g.urlToObject(p.itemUrl),portal:p.portal||b.getDefault(),portalItem:p,readResourcePaths:[]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["../../../../layers/support/LOD","../../../../layers/support/TileInfo"],
function(a,g){return function(){function b(f,k){this.lockedSchemaPixelSize=f;this.isGCS=k}var p=b.prototype;p.getLevelRowColumn=function(f){return this.isGCS?[f[0],f[1]>>1,f[2]>>1]:256===this.lockedSchemaPixelSize&&0<f[0]?[f[0]-1,f[1]>>1,f[2]>>1]:f};p.adjustLevel=function(f){return this.isGCS?f:256===this.lockedSchemaPixelSize?0<f?f-1:0:f};p.getShift=function(f,k){let c=0,d=0;if(256===this.lockedSchemaPixelSize||this.isGCS)f[2]%2&&(c=k),f[1]%2&&(d=k);return[c,d]};p.getScale=function(f){if(this.isGCS){if(512===
this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===f)return 1;return 2};b.create256x256CompatibleTileInfo=function(f){if(!f)return null;if(256===f.size[0]&&256===f.size[1])return f;const k=f.spatialReference.isGeographic,c=[],d=f.lods.length;for(let e=0;e<d;e++){const h=f.lods[e];c.push(new a({level:h.level,scale:h.scale,resolution:k?h.resolution:2*h.resolution}))}return new g({size:[256,256],dpi:f.dpi,format:f.format,compressionQuality:f.compressionQuality,origin:f.origin,
spatialReference:f.spatialReference,lods:c})};b.create512x512CompatibleTileInfo=function(f){if(!f||256===f.size[0]||256===f.size[1])return null;const k=[],c=f.lods.length;for(let d=0;d<c;d++){const e=f.lods[d];k.push(new a({level:e.level,scale:e.scale,resolution:.5*e.resolution}))}return new g({size:[512,512],dpi:f.dpi,format:f.format,compressionQuality:f.compressionQuality,origin:f.origin,spatialReference:f.spatialReference,lods:k})};return b}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["exports",
"../../../../layers/support/TileInfo"],function(a,g){a.areSchemasOverlapping=function(b,p){if(b===p)return!0;if(!b&&null!=p||null!=b&&!p||!b.spatialReference.equals(p.spatialReference)||b.dpi!==p.dpi)return!1;var f=b.origin;const k=p.origin;if(1E-6<=Math.abs(f.x-k.x)||1E-6<=Math.abs(f.y-k.y))return!1;b.lods[0].scale>p.lods[0].scale?(f=b,b=p):f=p;for(p=f.lods[0].scale;p>=b.lods[b.lods.length-1].scale-1E-6;p/=2)if(1E-6>Math.abs(p-b.lods[0].scale))return!0;return!1};a.unionTileInfos=function(b,p){if(b===
p)return b;if(!b&&null!=p)return p;if(null!=b&&!p)return b;const f=b.size[0],k=b.format,c=b.dpi,d={x:b.origin.x,y:b.origin.y},e=b.spatialReference.toJSON();var h=b.lods[0].scale>p.lods[0].scale?b.lods[0]:p.lods[0];b=(b.lods[b.lods.length-1].scale<=p.lods[p.lods.length-1].scale?b.lods[b.lods.length-1]:p.lods[p.lods.length-1]).scale;p=[];let n=h.scale;h=h.resolution;let q=0;for(;n>b;)p.push({level:q,resolution:h,scale:n}),q++,n/=2,h/=2;return new g({size:[f,f],dpi:c,format:k||"pbf",origin:d,lods:p,
spatialReference:e})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleLayer"],function(a){return function(){function g(p,f){this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;p.layers||(p.layers=[]);this.version=parseFloat(p.version);this.sprite=f?f.spriteUrl:p.sprite;this.glyphs=f?f.glyphsUrl:p.glyphs;if(this.layers=p.layers.map((k,c,d)=>this._create(k,c,d)))for(f=0;f<
this.layers.length;f++)p=this.layers[f],this._layerByName[p.id.toLowerCase()]=p,this._uidToLayer.set(p.uid,p),0===p.type&&this.backgroundBucketIds.push(p.id);this._identifyRefLayers()}var b=g.prototype;b.isPainterDataDriven=function(p){return(p=this._layerByName[p.toLowerCase()])?p.isPainterDataDriven():!1};b.getStyleLayerId=function(p){return p>=this.layers.length?null:this.layers[p].id};b.getStyleLayerByUID=function(p){p=this._uidToLayer.get(p);return null!=p?p:null};b.getStyleLayerIndex=function(p){return(p=
this._layerByName[p.toLowerCase()])?this.layers.indexOf(p):-1};b.setStyleLayer=function(p,f){if(p&&p.id){f&&f>=this.layers.length&&(f=this.layers.length-1);var k=!0,c;if(c=this._layerByName[p.id.toLowerCase()]){const d=this.layers.indexOf(c);f||(f=d);f===d?(k=!1,c=g._recreateLayer(p,c),this.layers[f]=c):(this.layers.splice(d,1),c=this._create(p,f,this.layers),this.layers.splice(f,0,c))}else c=this._create(p,f,this.layers),!f||f>=this.layers.length?this.layers.push(c):this.layers.splice(f,0,c);this._layerByName[p.id.toLowerCase()]=
c;this._uidToLayer.set(c.uid,c);k&&this._recomputeZValues();this._identifyRefLayers()}};b.getStyleLayer=function(p){return(p=this._layerByName[p.toLowerCase()])?{type:p.typeName,id:p.id,source:p.source,"source-layer":p.sourceLayer,minzoom:p.minzoom,maxzoom:p.maxzoom,filter:p.filter,layout:p.layout,paint:p.paint}:null};b.deleteStyleLayer=function(p){const f=this._layerByName[p.toLowerCase()];f&&(delete this._layerByName[p.toLowerCase()],this._uidToLayer.delete(f.uid),p=this.layers.indexOf(f),this.layers.splice(p,
1),this._recomputeZValues(),this._identifyRefLayers())};b.getLayerById=function(p){return this._layerByName[p.toLowerCase()]};b.getLayoutProperties=function(p){return(p=this._layerByName[p.toLowerCase()])?p.layout:null};b.getPaintProperties=function(p){return(p=this._layerByName[p.toLowerCase()])?p.paint:null};b.setPaintProperties=function(p,f){p=this._layerByName[p.toLowerCase()];if(!p)return"";f=g._recreateLayer({type:p.typeName,id:p.id,source:p.source,"source-layer":p.sourceLayer,minzoom:p.minzoom,
maxzoom:p.maxzoom,filter:p.filter,layout:p.layout,paint:f},p);const k=this.layers.indexOf(p);this.layers[k]=f;this._layerByName[p.id.toLowerCase()]=f;this._uidToLayer.set(p.uid,f);return p.id};b.setLayoutProperties=function(p,f){p=this._layerByName[p.toLowerCase()];if(!p)return"";f=g._recreateLayer({type:p.typeName,id:p.id,source:p.source,"source-layer":p.sourceLayer,minzoom:p.minzoom,maxzoom:p.maxzoom,filter:p.filter,layout:f,paint:p.paint},p);const k=this.layers.indexOf(p);this.layers[k]=f;this._layerByName[p.id.toLowerCase()]=
f;this._uidToLayer.set(p.uid,f);return p.id};b.setStyleLayerVisibility=function(p,f){if(p=this._layerByName[p.toLowerCase()]){var k=p.layout||{};k.visibility=f;f=g._recreateLayer({type:p.typeName,id:p.id,source:p.source,"source-layer":p.sourceLayer,minzoom:p.minzoom,maxzoom:p.maxzoom,filter:p.filter,layout:k,paint:p.paint},p);k=this.layers.indexOf(p);this.layers[k]=f;this._layerByName[p.id.toLowerCase()]=f;this._uidToLayer.set(p.uid,f)}};b.getStyleLayerVisibility=function(p){var f;p=this._layerByName[p.toLowerCase()];
if(!p)return"none";p=p.layout;return null!=(f=null==p?void 0:p.visibility)?f:"visible"};b._recomputeZValues=function(){const p=this.layers,f=1/(p.length+1);for(let k=0;k<p.length;k++)p[k].z=1-(1+k)*f};b._identifyRefLayers=function(){const p=[],f=[];let k=0;for(const e of this.layers){if(1===e.type){var c=e,d=e.source+"|"+e.sourceLayer;d+="|"+JSON.stringify(e.layout&&e.layout.visibility);d+="|"+JSON.stringify(e.minzoom);d+="|"+JSON.stringify(e.maxzoom);d+="|"+JSON.stringify(e.filter);if(c.hasDataDrivenFill||
c.hasDataDrivenOutline)d+="|"+JSON.stringify(k);p.push({key:d,layer:e})}2===e.type&&(c=e,d=e.source+"|"+e.sourceLayer,d+="|"+JSON.stringify(e.layout&&e.layout.visibility),d+="|"+JSON.stringify(e.minzoom),d+="|"+JSON.stringify(e.maxzoom),d+="|"+JSON.stringify(e.filter),d+="|"+JSON.stringify(e.layout&&e.layout["line-cap"]),d+="|"+JSON.stringify(e.layout&&e.layout["line-join"]),c.hasDataDrivenLine&&(d+="|"+JSON.stringify(k)),f.push({key:d,layer:e}));++k}this._assignRefLayers(p);this._assignRefLayers(f)};
b._assignRefLayers=function(p){p.sort((d,e)=>d.key<e.key?-1:d.key>e.key?1:0);let f,k;const c=p.length;for(let d=0;d<c;d++){const e=p[d];if(e.key===f)e.layer.refLayerId=k;else if(f=e.key,k=e.layer.id,1===e.layer.type&&!e.layer.getPaintProperty("fill-outline-color"))for(let h=d+1;h<c;h++){const n=p[h];if(n.key===f){if(n.layer.getPaintProperty("fill-outline-color")){p[d]=n;p[h]=e;k=n.layer.id;break}}else break}}};b._create=function(p,f,k){f=1-1/(k.length+1)*(1+f);k=this._runningId++;switch(p.type){case "background":return new a.BackgroundStyleLayer(0,
p,f,k);case "fill":return new a.FillStyleLayer(1,p,f,k);case "line":return new a.LineStyleLayer(2,p,f,k);case "symbol":return new a.SymbolStyleLayer(3,p,f,k);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,p,f,k)}throw Error("Unknown vector tile layer");};g._recreateLayer=function(p,f){switch(p.type){case "background":return new a.BackgroundStyleLayer(0,p,f.z,f.uid);case "fill":return new a.FillStyleLayer(1,p,f.z,f.uid);case "line":return new a.LineStyleLayer(2,
p,f.z,f.uid);case "symbol":return new a.SymbolStyleLayer(3,p,f.z,f.uid);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,p,f.z,f.uid)}};return g}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){let q=function(){function z(C,A,x,m){this.type=C;this.typeName=A.type;this.id=A.id;this.source=A.source;this.sourceLayer=A["source-layer"];this.minzoom=A.minzoom;this.maxzoom=A.maxzoom;this.filter=A.filter;this.layout=A.layout;this.paint=A.paint;this.z=x;this.uid=m;switch(C){case 0:this._layoutDefinition=e.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=e.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=e.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=e.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=e.StyleDefinition.lineLayoutDefinition;this._paintDefinition=e.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=e.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=e.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=e.StyleDefinition.circleLayoutDefinition,this._paintDefinition=e.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}var r=z.prototype;r.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=d.createFilter(this.filter)};r.getLayoutProperty=function(C){return this._layoutProperties[C]};r.getPaintProperty=function(C){return this._paintProperties[C]};r.getLayoutValue=function(C,A,x){let m;const B=this._layoutProperties[C];B&&(m=B.getValue(A,x));void 0===m&&(m=this._layoutDefinition[C]["default"]);return m};r.getPaintValue=
function(C,A,x){let m;const B=this._paintProperties[C];B&&(m=B.getValue(A,x));void 0===m&&(m=this._paintDefinition[C]["default"]);return m};r.isPainterDataDriven=function(){const C=this._paintProperties;if(C)for(const A in C)if(C[A].isDataDriven)return!0;return!1};r._parseLayout=function(C){const A={};for(const x in C){const m=this._layoutDefinition[x];m&&(A[x]=new h(m,C[x]))}return A};r._parsePaint=function(C){const A={};for(const x in C){const m=this._paintDefinition[x];m&&(A[x]=new h(m,C[x]))}return A};
r.computeAttributesKey=function(C,A){let x=0,m=0;for(const B of A)A="icon-size"===B||"text-size"===B?this.getLayoutProperty(B):this.getPaintProperty(B),m|=(null!=A&&A.interpolator?2:null!=A&&A.isDataDriven?1:0)<<x,x+=2;return m<<3|C};return z}(),u=function(z){function r(C,A,x,m){C=z.call(this,C,A,x,m)||this;C.backgroundMaterial=new b.VTLBackgroundMaterial(C.computeAttributesKey(0,b.VTLBackgroundMaterial.ATTRIBUTES));return C}g._inheritsLoose(r,z);return r}(q),v=function(z){function r(C,A,x,m){C=z.call(this,
C,A,x,m)||this;A=C.getPaintProperty("fill-color");x=C.getPaintProperty("fill-opacity");m=C.getPaintProperty("fill-pattern");C.hasDataDrivenColor=null==A?void 0:A.isDataDriven;C.hasDataDrivenOpacity=null==x?void 0:x.isDataDriven;C.hasDataDrivenFill=C.hasDataDrivenColor||C.hasDataDrivenOpacity||(null==m?void 0:m.isDataDriven);x=C.getPaintProperty("fill-outline-color");C.outlineUsesFillColor=!x;C.hasDataDrivenOutlineColor=null==x?void 0:x.isDataDriven;C.hasDataDrivenOutline=x?x.isDataDriven:A?A.isDataDriven:
!1;C.hasDataDrivenOutline=(x?C.hasDataDrivenOutlineColor:C.hasDataDrivenColor)||C.hasDataDrivenOpacity;C.fillMaterial=new f.VTLFillMaterial(C.computeAttributesKey(1,f.VTLFillMaterial.ATTRIBUTES));C.outlineMaterial=new f.VTLOutlineMaterial(C.computeAttributesKey(2,C.outlineUsesFillColor?f.VTLOutlineMaterial.ATTRIBUTES_FILL:f.VTLOutlineMaterial.ATTRIBUTES_OUTLINE),C.outlineUsesFillColor);return C}g._inheritsLoose(r,z);return r}(q),t=function(z){function r(C,A,x,m){var B,E,F,G,I,K,J;C=z.call(this,C,
A,x,m)||this;C.lineMaterial=new k.VTLLineMaterial(C.computeAttributesKey(3,k.VTLLineMaterial.ATTRIBUTES));C.hasDataDrivenLine=(null==(B=C.getPaintProperty("line-blur"))?void 0:B.isDataDriven)||(null==(E=C.getPaintProperty("line-color"))?void 0:E.isDataDriven)||(null==(F=C.getPaintProperty("line-gap-width"))?void 0:F.isDataDriven)||(null==(G=C.getPaintProperty("line-offset"))?void 0:G.isDataDriven)||(null==(I=C.getPaintProperty("line-opacity"))?void 0:I.isDataDriven)||(null==(K=C.getPaintProperty("line-pattern"))?
void 0:K.isDataDriven)||(null==(J=C.getPaintProperty("line-width"))?void 0:J.isDataDriven);A=A.paint["line-width"];A||(A=e.StyleDefinition.linePaintDefinition["line-width"].default);B=C.getPaintProperty("line-width");C.isThinLine=!(null!=B&&B.isDataDriven)&&"number"===typeof A&&A<n.THIN_LINE_THRESHOLD;return C}g._inheritsLoose(r,z);return r}(q),l=function(z){function r(C,A,x,m){var B,E,F,G,I,K,J,L,P,Q,X,aa;C=z.call(this,C,A,x,m)||this;C.iconMaterial=new c.VTLIconMaterial(C.computeAttributesKey(4,
c.VTLIconMaterial.ATTRIBUTES));C.textMaterial=new c.VTLTextMaterial(C.computeAttributesKey(6,c.VTLTextMaterial.ATTRIBUTES));C.hasDataDrivenIcon=(null==(B=C.getPaintProperty("icon-color"))?void 0:B.isDataDriven)||(null==(E=C.getPaintProperty("icon-halo-blur"))?void 0:E.isDataDriven)||(null==(F=C.getPaintProperty("icon-halo-color"))?void 0:F.isDataDriven)||(null==(G=C.getPaintProperty("icon-halo-width"))?void 0:G.isDataDriven)||(null==(I=C.getPaintProperty("icon-opacity"))?void 0:I.isDataDriven)||(null==
(K=C.getLayoutProperty("icon-size"))?void 0:K.isDataDriven);C.hasDataDrivenText=(null==(J=C.getPaintProperty("text-color"))?void 0:J.isDataDriven)||(null==(L=C.getPaintProperty("text-halo-blur"))?void 0:L.isDataDriven)||(null==(P=C.getPaintProperty("text-halo-color"))?void 0:P.isDataDriven)||(null==(Q=C.getPaintProperty("text-halo-width"))?void 0:Q.isDataDriven)||(null==(X=C.getPaintProperty("text-opacity"))?void 0:X.isDataDriven)||(null==(aa=C.getLayoutProperty("text-size"))?void 0:aa.isDataDriven);
return C}g._inheritsLoose(r,z);return r}(q),w=function(z){function r(C,A,x,m){C=z.call(this,C,A,x,m)||this;C.circleMaterial=new p.VTLCircleMaterial(C.computeAttributesKey(5,p.VTLCircleMaterial.ATTRIBUTES));return C}g._inheritsLoose(r,z);return r}(q),y=function(){function z(r,C,A){var x,m,B,E,F;this.allowOverlap=r.getLayoutValue("icon-allow-overlap",C);this.ignorePlacement=r.getLayoutValue("icon-ignore-placement",C);this.keepUpright=r.getLayoutValue("icon-keep-upright",C);this.optional=r.getLayoutValue("icon-optional",
C);this.rotationAlignment=r.getLayoutValue("icon-rotation-alignment",C);2===this.rotationAlignment&&(this.rotationAlignment=A?0:1);A=r.getLayoutProperty("icon-anchor");null!=(x=A)&&x.isDataDriven?this._anchorProp=A:this.anchor=r.getLayoutValue("icon-anchor",C);A=r.getLayoutProperty("icon-offset");null!=(m=A)&&m.isDataDriven?this._offsetProp=A:this.offset=r.getLayoutValue("icon-offset",C);A=r.getLayoutProperty("icon-padding");null!=(B=A)&&B.isDataDriven?this._paddingProp=A:this.padding=r.getLayoutValue("icon-padding",
C);A=r.getLayoutProperty("icon-rotate");null!=(E=A)&&E.isDataDriven?this._rotateProp=A:this.rotate=r.getLayoutValue("icon-rotate",C);A=r.getLayoutProperty("icon-size");null!=(F=A)&&F.isDataDriven?this._sizeProp=A:this.size=r.getLayoutValue("icon-size",C)}z.prototype.update=function(r,C){this._anchorProp&&(this.anchor=this._anchorProp.getValue(r,C));this._offsetProp&&(this.offset=this._offsetProp.getValue(r,C));this._paddingProp&&(this.padding=this._paddingProp.getValue(r,C));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(r,C));this._sizeProp&&(this.size=this._sizeProp.getValue(r,C))};return z}(),D=function(){function z(r,C,A){var x,m,B,E,F,G,I,K,J,L,P;this.allowOverlap=r.getLayoutValue("text-allow-overlap",C);this.ignorePlacement=r.getLayoutValue("text-ignore-placement",C);this.keepUpright=r.getLayoutValue("text-keep-upright",C);this.optional=r.getLayoutValue("text-optional",C);this.rotationAlignment=r.getLayoutValue("text-rotation-alignment",C);2===this.rotationAlignment&&(this.rotationAlignment=
A?0:1);A=r.getLayoutProperty("text-anchor");null!=(x=A)&&x.isDataDriven?this._anchorProp=A:this.anchor=r.getLayoutValue("text-anchor",C);A=r.getLayoutProperty("text-justify");null!=(m=A)&&m.isDataDriven?this._justifyProp=A:this.justify=r.getLayoutValue("text-justify",C);A=r.getLayoutProperty("text-letter-spacing");null!=(B=A)&&B.isDataDriven?this._letterSpacingProp=A:this.letterSpacing=r.getLayoutValue("text-letter-spacing",C);A=r.getLayoutProperty("text-line-height");null!=(E=A)&&E.isDataDriven?
this._lineHeightProp=A:this.lineHeight=r.getLayoutValue("text-line-height",C);A=r.getLayoutProperty("text-max-angle");null!=(F=A)&&F.isDataDriven?this._maxAngleProp=A:this.maxAngle=r.getLayoutValue("text-max-angle",C);A=r.getLayoutProperty("text-max-width");null!=(G=A)&&G.isDataDriven?this._maxWidthProp=A:this.maxWidth=r.getLayoutValue("text-max-width",C);A=r.getLayoutProperty("text-offset");null!=(I=A)&&I.isDataDriven?this._offsetProp=A:this.offset=r.getLayoutValue("text-offset",C);A=r.getLayoutProperty("text-padding");
null!=(K=A)&&K.isDataDriven?this._paddingProp=A:this.padding=r.getLayoutValue("text-padding",C);A=r.getLayoutProperty("text-rotate");null!=(J=A)&&J.isDataDriven?this._rotateProp=A:this.rotate=r.getLayoutValue("text-rotate",C);A=r.getLayoutProperty("text-size");null!=(L=A)&&L.isDataDriven?this._sizeProp=A:this.size=r.getLayoutValue("text-size",C);A=r.getLayoutProperty("text-writing-mode");null!=(P=A)&&P.isDataDriven?this._writingModeProp=A:this.writingMode=r.getLayoutValue("text-writing-mode",C)}z.prototype.update=
function(r,C){this._anchorProp&&(this.anchor=this._anchorProp.getValue(r,C));this._justifyProp&&(this.justify=this._justifyProp.getValue(r,C));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(r,C));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(r,C));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(r,C));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(r,C));this._offsetProp&&(this.offset=this._offsetProp.getValue(r,C));
this._paddingProp&&(this.padding=this._paddingProp.getValue(r,C));this._rotateProp&&(this.rotate=this._rotateProp.getValue(r,C));this._sizeProp&&(this.size=this._sizeProp.getValue(r,C));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(r,C))};return z}();a.BackgroundStyleLayer=u;a.CircleStyleLayer=w;a.FillStyleLayer=v;a.IconLayout=y;a.LineStyleLayer=t;a.StyleLayer=q;a.SymbolStyleLayer=l;a.TextLayout=D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(a,g,b){b=function(p){function f(c){return p.call(this,c)||this}g._inheritsLoose(f,p);var k=f.prototype;k.geometryInfo=function(){return f.GEOMETRY_LAYOUT};k.opacityInfo=function(){return null};k.attributes=function(){return f.ATTRIBUTES};k.attributesInfo=function(){return f.ATTRIBUTES_INFO};return f}(b.VTLMaterial);b.ATTRIBUTES=[];b.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}];
b.ATTRIBUTES_INFO={};a.VTLBackgroundMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec4f32","../MemoryBuffer"],function(a,g,b,p){let f=function(){function c(e){this._color=b.create();this._key=e}var d=c.prototype;d.defines=function(){return[]};d.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};
d.getAttributeLocations=function(){this._locations||this._buildAttributesInfo();return this._locations};d.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};d.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};d.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};d.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};
d.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain};d.setDataUniforms=function(e,h,n,q){const u=this.getUniforms();for(const v in u){const t=u[v];switch(t.type){case "float":e.setUniform1f(t.name,t.getValue(n,h,q));break;case "vec2":e.setUniform2fv(t.name,t.getValue(n,h,q));break;case "vec4":{const l=t.getValue(n,h,q),w=l[3];this._color[0]=w*l[0];this._color[1]=w*l[1];this._color[2]=w*l[2];this._color[3]=w;e.setUniform4fv(t.name,this._color)}}}};d.encodeAttributes=
function(e,h,n){const q=this.attributesInfo(),u=this.getEncodingInfos(),v=[];for(const w of Object.keys(u)){var t,l=u[w];const {type:y,precisionFactor:D,isLayout:z}=q[w],r=z?n.getLayoutProperty(w):n.getPaintProperty(w),C=null==(t=r.interpolator)?void 0:t.getInterpolationRange(h);let A=0;for(const x of l){x.dataIndex>=v.length&&v.push(0);l=r.getValue(C?C[A]:h,e);switch(y){case 0:v[x.dataIndex]|=this._encodeByte(l*(D||1),8*x.offset);break;case 1:v[x.dataIndex]|=this._encodeByte(l*(D||1)+128,8*x.offset);
break;case 2:v[x.dataIndex]=this._encodeColor(l);break;default:throw Error("Unsupported encoding type");}++A}}return v};d.getAtributeState=function(e){const h=3+2*e;e=0|this._bit(h);return e|=this._bit(h+1)<<1};d._buildAttributesInfo=function(){const e=[],h={};var n={},q=-1,u=this.attributesInfo(),v=this.attributes();let t=-1;for(const y of v){++t;v=this.getAtributeState(t);if(0===v)continue;var l=u[y];const D=[];h[y]=D;l=l.type;for(let z=0;z<v;++z){const {dataType:r,bytesPerElement:C,count:A,normalized:x}=
c._encodingInfo[l],m=r<<2|A;let B=n[m];B&&4!==B.offset||(++q,n[m]=B={dataIndex:q,offset:0},e.push({location:-1,name:"a_data_"+q,count:4/C,type:r,normalized:x}));D.push({dataIndex:B.dataIndex,offset:B.offset});B.offset+=C*A}}this._buildVertexBufferLayout(e);n={};q=0;u=this._layoutInfo.geometry;for(var w of u)n[w.name]=q++;if(w=this._layoutInfo.opacity)for(const y of w)n[y.name]=q++;this._buildShaderInfo(e,h);this._propertyEncodingInfo=h;this._locations=n};d._buildVertexBufferLayout=function(e){const h=
{};var n=this.geometryInfo();let q=n[0].stride;if(0===e.length)h.geometry=n;else{const u=[];let v=q;q+=4*e.length;for(const t of n)n={...t},n.stride=q,u.push(n);for(const t of e)u.push({name:t.name,count:t.count,type:t.type,offset:v,stride:q,normalized:t.normalized||!1,divisor:0}),v+=k(t.type)*t.count;h.geometry=u}this.opacityInfo()&&(h.opacity=this.opacityInfo());this._layoutInfo=h;this._stride=q};d._buildShaderInfo=function(e,h){let n="\n",q="\n";const u=[];for(var v of e)n+=`attribute ${this._getType(v.count)} ${v.name};\n`;
var t=this.attributes();e=this.attributesInfo();v=-1;for(const y of t){++v;const {name:D,type:z,precisionFactor:r,isLayout:C}=e[y];t=r&&1!==r?` * ${1/r}`:"";const {bytesPerElement:A,count:x}=c._encodingInfo[z];var l=m=>`a_data_${m.dataIndex}${2===z?"":`[${m.offset/A}]`}`;switch(this.getAtributeState(v)){case 0:t=this._getType(x);var w=`u_${D}`;u.push({name:w,type:t,getValue:(m,B)=>C?m.getLayoutValue(y,B):m.getPaintValue(y,B)});n+=`uniform ${t} ${w};\n`;q+=`${t} ${D} = ${w};\n`;break;case 1:w=l(h[y][0]);
q+=`${this._getType(x)} ${D} = ${w}${t};\n`;break;case 2:{w=`u_t_${D}`;u.push({name:w,type:"float",getValue:(B,E,F)=>(C?B.getLayoutProperty(y):B.getPaintProperty(y)).interpolator.interpolationUniformValue(F,E)});n+=`uniform float ${w};\n`;const m=l(h[y][0]);l=l(h[y][1]);q+=`${this._getType(x)} ${D} = mix(${m}${t}, ${l}${t}, ${w});\n`}}}this._shaderHeader=n;this._shaderMain=q;this._uniforms=u};d._bit=function(e){return(this._key&1<<e)>>e};d._getType=function(e){switch(e){case 1:return"float";case 2:return"vec2";
case 4:return"vec4"}throw Error("Invalid count");};d._encodeColor=function(e){const h=255*e[3];return p.i8888to32(e[0]*h,e[1]*h,e[2]*h,h)};d._encodeByte=function(e,h){return(e&255)<<h};g._createClass(c,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return c}();f._encodingInfo=[{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:4,normalized:!0}];const k=
c=>{switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1}};a.VTLMaterial=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function g(p){this._array=[];0>=p&&console.error("strideInBytes must be positive!");this._stride=p}var b=g.prototype;b.reset=function(){this.array.length=
0};b.toBuffer=function(){return(new Uint32Array(this._array)).buffer};g.i1616to32=function(p,f){return 65535&p|f<<16};g.i8888to32=function(p,f,k,c){return p&255|(f&255)<<8|(k&255)<<16|c<<24};g.i8816to32=function(p,f,k){return p&255|(f&255)<<8|k<<16};a._createClass(g,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}}]);
return g}()})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(a,g,b){b=function(p){function f(c){return p.call(this,c)||this}g._inheritsLoose(f,p);var k=f.prototype;k.geometryInfo=function(){return f.GEOMETRY_LAYOUT};k.opacityInfo=function(){return null};k.attributes=function(){return f.ATTRIBUTES};k.attributesInfo=function(){return f.ATTRIBUTES_INFO};return f}(b.VTLMaterial);b.ATTRIBUTES=
"circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");b.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];b.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:0},"circle-color":{name:"color",type:2},"circle-opacity":{name:"opacity",type:0,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:0,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:2},"circle-stroke-opacity":{name:"stroke_opacity",
type:0,precisionFactor:100},"circle-blur":{name:"blur",type:0,precisionFactor:32}};a.VTLCircleMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(a,g,b){let p=function(f){function k(d){return f.call(this,d)||this}g._inheritsLoose(k,f);var c=k.prototype;c.geometryInfo=function(){return k.GEOMETRY_LAYOUT};c.opacityInfo=function(){return null};
c.attributes=function(){return k.ATTRIBUTES};c.attributesInfo=function(){return k.ATTRIBUTES_INFO};return k}(b.VTLMaterial);p.ATTRIBUTES=["fill-color","fill-opacity"];p.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];p.ATTRIBUTES_INFO={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};b=function(f){function k(d,e){d=f.call(this,d)||this;d.usefillColor=e;return d}g._inheritsLoose(k,f);var c=k.prototype;c.geometryInfo=
function(){return k.GEOMETRY_LAYOUT};c.opacityInfo=function(){return null};c.attributes=function(){return this.usefillColor?k.ATTRIBUTES_FILL:k.ATTRIBUTES_OUTLINE};c.attributesInfo=function(){return this.usefillColor?k.ATTRIBUTES_INFO_FILL:k.ATTRIBUTES_INFO_OUTLINE};return k}(b.VTLMaterial);b.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];b.ATTRIBUTES_FILL=["fill-color","fill-opacity"];b.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",
count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}];b.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};b.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};a.VTLFillMaterial=p;a.VTLOutlineMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(a,g,b){b=function(p){function f(c){return p.call(this,c)||this}g._inheritsLoose(f,p);var k=f.prototype;k.geometryInfo=function(){return f.GEOMETRY_LAYOUT};k.opacityInfo=function(){return null};k.attributes=function(){return f.ATTRIBUTES};k.attributesInfo=function(){return f.ATTRIBUTES_INFO};return f}(b.VTLMaterial);b.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width".split(" ");b.GEOMETRY_LAYOUT=
[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}];b.ATTRIBUTES_INFO={"line-width":{name:"width",type:0,precisionFactor:2},"line-gap-width":{name:"gap_width",type:0,precisionFactor:2},"line-offset":{name:"offset",type:1,precisionFactor:2},"line-color":{name:"color",type:2},"line-opacity":{name:"opacity",
type:0,precisionFactor:100},"line-blur":{name:"blur",type:0,precisionFactor:4}};a.VTLLineMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(a,g,b){const p=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",
count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],f=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];let k=function(c){function d(h){return c.call(this,h)||this}g._inheritsLoose(d,c);var e=d.prototype;e.geometryInfo=function(){return p};e.opacityInfo=function(){return f};e.attributes=function(){return d.ATTRIBUTES};e.attributesInfo=function(){return d.ATTRIBUTES_INFO};
return d}(b.VTLMaterial);k.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");k.ATTRIBUTES_INFO={"icon-color":{name:"color",type:2},"icon-opacity":{name:"opacity",type:0,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:2},"icon-halo-width":{name:"halo_width",type:0,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"icon-size":{name:"size",type:0,precisionFactor:32,isLayout:!0}};b=function(c){function d(h){return c.call(this,
h)||this}g._inheritsLoose(d,c);var e=d.prototype;e.geometryInfo=function(){return p};e.opacityInfo=function(){return f};e.attributes=function(){return d.ATTRIBUTES};e.attributesInfo=function(){return d.ATTRIBUTES_INFO};return d}(b.VTLMaterial);b.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");b.ATTRIBUTES_INFO={"text-color":{name:"color",type:2},"text-opacity":{name:"opacity",type:0,precisionFactor:100},"text-halo-color":{name:"halo_color",
type:2},"text-halo-width":{name:"halo_width",type:0,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"text-size":{name:"size",type:0,isLayout:!0}};a.VTLIconMaterial=k;a.VTLTextMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/types","../expression/expression"],function(a,g){return function(){function b(p){this._expression=p}b.prototype.filter=function(p,f){if(!this._expression)return!0;
try{return this._expression.evaluate(p,f)}catch(k){return console.log(k.message),!0}};b.createFilter=function(p){if(!p)return null;this.isLegacyFilter(p)&&(p=this.convertLegacyFilter(p));try{const f=g.createExpression(p,null,a.BooleanType);return new b(f)}catch(f){return console.log(f.message),null}};b.isLegacyFilter=function(p){if(!Array.isArray(p)||0===p.length)return!0;switch(p[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===p.length&&"string"===
typeof p[1]&&!Array.isArray(p[2]);case "in":return 3<=p.length&&"string"===typeof p[1]&&!Array.isArray(p[2]);case "!in":return!0;case "any":case "all":for(let f=1;f<p.length;f++)if(!this.isLegacyFilter(p[1]))return!1;return!0;case "none":return!0;case "has":return 2===p.length&&("$id"===p[1]||"$type"===p[1]);case "!has":return!0;default:return!1}};b.convertLegacyFilter=function(p){if(!Array.isArray(p)||0===p.length)return!0;const f=p[0];if(1===p.length)return"any"!==f;switch(f){case "\x3d\x3d":return b.convertComparison("\x3d\x3d",
p[1],p[2]);case "!\x3d":return b.negate(b.convertComparison("\x3d\x3d",p[1],p[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return b.convertComparison(f,p[1],p[2]);case "in":return b.convertIn(p[1],p.slice(2));case "!in":return b.negate(b.convertIn(p[1],p.slice(2)));case "any":case "all":case "none":return b.convertCombining(f,p.slice(1));case "has":return b.convertHas(p[1]);case "!has":return b.negate(b.convertHas(p[1]));default:throw Error("Unexpected legacy filter.");}};b.convertComparison=
function(p,f,k){switch(f){case "$type":return[p,["geometry-type"],k];case "$id":return[p,["id"],k];default:return[p,["get",f],k]}};b.convertIn=function(p,f){switch(p){case "$type":return["in",["geometry-type"],["literal",f]];case "$id":return["in",["id"],["literal",f]];default:return["in",["get",p],["literal",f]]}};b.convertHas=function(p){switch(p){case "$type":return!0;case "$id":return["has-id"];default:return["has",p]}};b.convertCombining=function(p,f){return[p].concat(f.map(this.convertLegacyFilter))};
b.negate=function(p){return["!",p]};return b}()})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(a,g){function b(t,l){return{kind:"array",itemType:t,n:l}}function p(t){if("array"===t.kind){const l=p(t.itemType);return"number"===typeof t.n?`array<${l}, ${t.n}>`:"value"===t.itemType.kind?"array":`array<${l}>`}return t.kind}function f(t){if(null===t)return c;if("string"===typeof t)return e;if("boolean"===typeof t)return h;if("number"===
typeof t)return d;if(t instanceof g)return n;if(Array.isArray(t)){let l;for(const w of t){const y=f(w);if(!l)l=y;else if(l!==y){l=u;break}}return b(l||u,t.length)}return"object"===typeof t?q:u}function k(t,l){if("array"===l.kind)return"array"===t.kind&&(0===t.n&&"value"===t.itemType.kind||k(t.itemType,l.itemType))&&("number"!==typeof l.n||l.n===t.n);if("value"===l.kind)for(const w of v)if(k(t,w))return!0;return l.kind===t.kind}const c={kind:"null"},d={kind:"number"},e={kind:"string"},h={kind:"boolean"},
n={kind:"color"},q={kind:"object"},u={kind:"value"},v=[c,d,e,h,n,q,b(u)];a.BooleanType=h;a.ColorType=n;a.NullType=c;a.NumberType=d;a.ObjectType=q;a.StringType=e;a.ValueType=u;a.arrayType=b;a.getType=f;a.matchType=k;a.typeToString=p;a.valueToString=function(t){if(null===t)return"";const l=typeof t;return"string"===l?t:"number"===l||"boolean"===l?String(t):t instanceof g?t.toString():JSON.stringify(t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/colorUtils ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(a,g,b,p,f,k,c){function d(ha,na,da){var oa=typeof ha;if("string"===oa||"boolean"===oa||"number"===oa||null===ha){if(da)switch(da.kind){case "string":"string"!==oa&&(ha=M.toString(ha));break;case "number":"number"!==oa&&(ha=M.toNumber(ha));break;case "color":ha=M.toColor(ha)}ha=["literal",ha]}if(!Array.isArray(ha)||0===ha.length)throw Error("Expression must be a non empty array");oa=ha[0];if("string"!==typeof oa)throw Error("First element of expression must be a string");const qa=ka[oa];if(void 0===
qa)throw Error(`Invalid expression operator "${oa}"`);if(!qa)throw Error(`Unimplemented expression operator "${oa}"`);return qa.parse(ha,na,da)}let e=function(){function ha(da){this.parent=da;this.vars={}}var na=ha.prototype;na.add=function(da,oa){this.vars[da]=oa};na.get=function(da){return this.vars[da]?this.vars[da]:this.parent?this.parent.get(da):null};return ha}(),h=function(){function ha(){this.type=c.ValueType}ha.parse=function(na){if(1<na.length)throw Error('"id" does not expect arguments');
return new ha};ha.prototype.evaluate=function(na,da){return na.id||null};return ha}(),n=function(){function ha(){this.type=c.StringType}ha.parse=function(na){if(1<na.length)throw Error('"geometry-type" does not expect arguments');return new ha};ha.prototype.evaluate=function(na,da){switch(na.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}};return ha}(),q=function(){function ha(){this.type=c.ObjectType}ha.parse=function(na){if(1<na.length)throw Error('"properties" does not expect arguments');
return new ha};ha.prototype.evaluate=function(na,da){return na.values};return ha}(),u=function(){function ha(){this.type=c.NumberType}ha.parse=function(na){if(1<na.length)throw Error('"zoom" does not expect arguments');return new ha};ha.prototype.evaluate=function(na,da){return da};return ha}(),v=function(){function ha(na,da,oa){this.lhs=na;this.rhs=da;this.compare=oa;this.type=c.BooleanType}ha.parse=function(na,da,oa){if(3!==na.length&&4!==na.length)throw Error(`"${na[0]}" expects 2 or 3 arguments`);
if(4===na.length)throw Error(`"${na[0]}" collator not supported`);return new ha(d(na[1],da),d(na[2],da),oa)};ha.prototype.evaluate=function(na,da){return this.compare(this.lhs.evaluate(na,da),this.rhs.evaluate(na,da))};return ha}(),t=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return v.parse(da,oa,(qa,ua)=>qa===ua)};return na}(v),l=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=
function(da,oa){return v.parse(da,oa,(qa,ua)=>qa!==ua)};return na}(v),w=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return v.parse(da,oa,(qa,ua)=>qa<ua)};return na}(v),y=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return v.parse(da,oa,(qa,ua)=>qa<=ua)};return na}(v),D=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=
function(da,oa){return v.parse(da,oa,(qa,ua)=>qa>ua)};return na}(v),z=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return v.parse(da,oa,(qa,ua)=>qa>=ua)};return na}(v),r=function(){function ha(na){this.arg=na;this.type=c.BooleanType}ha.parse=function(na,da){if(2!==na.length)throw Error('"!" expects 1 argument');return new ha(d(na[1],da))};ha.prototype.evaluate=function(na,da){return!this.arg.evaluate(na,da)};return ha}(),C=function(){function ha(na){this.args=
na;this.type=c.BooleanType}ha.parse=function(na,da){const oa=[];for(let qa=1;qa<na.length;qa++)oa.push(d(na[qa],da));return new ha(oa)};ha.prototype.evaluate=function(na,da){for(const oa of this.args)if(!oa.evaluate(na,da))return!1;return!0};return ha}(),A=function(){function ha(na){this.args=na;this.type=c.BooleanType}ha.parse=function(na,da){const oa=[];for(let qa=1;qa<na.length;qa++)oa.push(d(na[qa],da));return new ha(oa)};ha.prototype.evaluate=function(na,da){for(const oa of this.args)if(oa.evaluate(na,
da))return!0;return!1};return ha}(),x=function(){function ha(na){this.args=na;this.type=c.BooleanType}ha.parse=function(na,da){const oa=[];for(let qa=1;qa<na.length;qa++)oa.push(d(na[qa],da));return new ha(oa)};ha.prototype.evaluate=function(na,da){for(const oa of this.args)if(oa.evaluate(na,da))return!1;return!0};return ha}(),m=function(){function ha(na,da,oa){this.type=na;this.args=da;this.fallback=oa}ha.parse=function(na,da,oa){if(4>na.length)throw Error('"case" expects at least 3 arguments');
if(1===na.length%2)throw Error('"case" expects an odd number of arguments');let qa;const ua=[];for(let Ca=1;Ca<na.length-1;Ca+=2){const Ja=d(na[Ca],da),Ha=d(na[Ca+1],da,oa);qa||(qa=Ha.type);ua.push({condition:Ja,output:Ha})}na=d(na[na.length-1],da,oa);qa||(qa=na.type);return new ha(qa,ua,na)};ha.prototype.evaluate=function(na,da){for(const oa of this.args)if(oa.condition.evaluate(na,da))return oa.output.evaluate(na,da);return this.fallback.evaluate(na,da)};return ha}(),B=function(){function ha(na,
da){this.type=na;this.args=da}ha.parse=function(na,da){if(2>na.length)throw Error('"coalesce" expects at least 1 argument');let oa;const qa=[];for(let ua=1;ua<na.length;ua++){const Ca=d(na[ua],da);oa||(oa=Ca.type);qa.push(Ca)}return new ha(oa,qa)};ha.prototype.evaluate=function(na,da){for(const oa of this.args){const qa=oa.evaluate(na,da);if(null!==qa)return qa}return null};return ha}(),E=function(){function ha(na,da,oa,qa,ua){this.type=na;this.input=da;this.labels=oa;this.outputs=qa;this.fallback=
ua}ha.parse=function(na,da){if(3>na.length)throw Error('"match" expects at least 3 arguments');if(0===na.length%2)throw Error('"case" expects an even number of arguments');let oa;const qa=d(na[1],da),ua=[],Ca={};let Ja;for(let Na=2;Na<na.length-1;Na+=2){var Ha=na[Na];Array.isArray(Ha)||(Ha=[Ha]);for(const Oa of Ha){Ha=typeof Oa;if("string"!==Ha&&"number"!==Ha)throw Error('"match" requires string or number literal as labels');if(!Ja)Ja=Ha;else if(Ha!==Ja)throw Error('"match" requires labels to have the same type');
Ca[Oa]=ua.length}Ha=d(na[Na+1],da);oa||(oa=Ha.type);ua.push(Ha)}return new ha(oa,qa,Ca,ua,d(na[na.length-1],da))};ha.prototype.evaluate=function(na,da){const oa=this.input.evaluate(na,da);return(this.outputs[this.labels[oa]]||this.fallback).evaluate(na,da)};return ha}(),F=function(){function ha(da,oa,qa,ua,Ca){this.operator=da;this.type=oa;this.interpolation=qa;this.input=ua;this.stops=Ca}ha.parse=function(da,oa,qa){const ua=da[0];if(5>da.length)throw Error(`"${ua}" expects at least 4 arguments`);
const Ca=da[1];if(!Array.isArray(Ca)||0===Ca.length)throw Error(`"${Ca}" is not a valid interpolation`);switch(Ca[0]){case "linear":if(1!==Ca.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==Ca.length||"number"!==typeof Ca[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==Ca.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var Ja=
1;5>Ja;Ja++){var Ha=Ca[Ja];if("number"!==typeof Ha||0>Ha||1<Ha)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${da[0]}" unknown interpolation type "${Ca[0]}"`);}if(1!==da.length%2)throw Error(`"${ua}" expects an even number of arguments`);Ja=d(da[2],oa,c.NumberType);let Na;"interpolate-hcl"===ua||"interpolate-lab"===ua?Na=c.ColorType:qa&&"value"!==qa.kind&&(Na=qa);qa=[];for(Ha=3;Ha<da.length;Ha+=2){const Oa=da[Ha];
if("number"!==typeof Oa)throw Error(`"${ua}" requires stop inputs as literal numbers`);if(qa.length&&qa[qa.length-1][0]>=Oa)throw Error(`"${ua}" requires strictly ascending stop inputs`);const Va=d(da[Ha+1],oa,Na);Na||(Na=Va.type);qa.push([Oa,Va])}if(Na&&Na!==c.ColorType&&Na!==c.NumberType&&("array"!==Na.kind||Na.itemType!==c.NumberType))throw Error(`"${ua}" cannot interpolate type ${c.typeToString(Na)}`);return new ha(ua,Na,Ca,Ja,qa)};var na=ha.prototype;na.evaluate=function(da,oa){var qa=this.stops;
if(1===qa.length)return qa[0][1].evaluate(da,oa);var ua=this.input.evaluate(da,oa);if(ua<=qa[0][0])return qa[0][1].evaluate(da,oa);if(ua>=qa[qa.length-1][0])return qa[qa.length-1][1].evaluate(da,oa);let Ca=0;for(;++Ca<qa.length&&!(ua<qa[Ca][0]););const Ja=ha.interpolationRatio(this.interpolation,ua,qa[Ca-1][0],qa[Ca][0]);ua=qa[Ca-1][1].evaluate(da,oa);const Ha=qa[Ca][1].evaluate(da,oa);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(ua)&&Array.isArray(Ha))return ua.map((Na,
Oa)=>k.interpolate(Na,Ha[Oa],Ja));if("color"===this.type.kind&&ua instanceof b&&Ha instanceof b)return ua=new b(ua),da=new b(Ha),new b([k.interpolate(ua.r,da.r,Ja),k.interpolate(ua.g,da.g,Ja),k.interpolate(ua.b,da.b,Ja),k.interpolate(ua.a,da.a,Ja)]);if("number"===this.type.kind&&"number"===typeof ua&&"number"===typeof Ha)return k.interpolate(ua,Ha,Ja);throw Error(`"${this.operator}" cannot interpolate type ${c.typeToString(this.type)}`);}if("interpolate-hcl"===this.operator)return da=p.toLCH(ua),
oa=p.toLCH(Ha),qa=oa.h-da.h,da=p.toRGB({h:da.h+Ja*(180<qa||-180>qa?qa-360*Math.round(qa/360):qa),c:k.interpolate(da.c,oa.c,Ja),l:k.interpolate(da.l,oa.l,Ja)}),new b({a:k.interpolate(ua.a,Ha.a,Ja),...da});if("interpolate-lab"===this.operator)return da=p.toLAB(ua),oa=p.toLAB(Ha),da=p.toRGB({l:k.interpolate(da.l,oa.l,Ja),a:k.interpolate(da.a,oa.a,Ja),b:k.interpolate(da.b,oa.b,Ja)}),new b({a:k.interpolate(ua.a,Ha.a,Ja),...da});throw Error(`Unexpected operator "${this.operator}"`);};na.interpolationUniformValue=
function(da,oa){const qa=this.stops;if(1===qa.length||da>=qa[qa.length-1][0])return 0;let ua=0;for(;++ua<qa.length&&!(da<qa[ua][0]););return ha.interpolationRatio(this.interpolation,oa,qa[ua-1][0],qa[ua][0])};na.getInterpolationRange=function(da){const oa=this.stops;if(1===oa.length)return da=oa[0][0],[da,da];var qa=oa[oa.length-1][0];if(da>=qa)return[qa,qa];for(qa=0;++qa<oa.length&&!(da<oa[qa][0]););return[oa[qa-1][0],oa[qa][0]]};ha.interpolationRatio=function(da,oa,qa,ua){let Ca=0;"linear"===da[0]?
Ca=ha.exponentialInterpolationRatio(oa,1,qa,ua):"exponential"===da[0]?Ca=ha.exponentialInterpolationRatio(oa,da[1],qa,ua):"cubic-bezier"===da[0]&&(Ca=f.unitBezier(da[1],da[2],da[3],da[4])(ha.exponentialInterpolationRatio(oa,1,qa,ua),1E-5));0>Ca?Ca=0:1<Ca&&(Ca=1);return Ca};ha.exponentialInterpolationRatio=function(da,oa,qa,ua){ua-=qa;if(0===ua)return 0;da-=qa;return 1===oa?da/ua:(oa**da-1)/(oa**ua-1)};return ha}(),G=function(){function ha(na,da,oa){this.type=na;this.input=da;this.stops=oa}ha.parse=
function(na,da){if(5>na.length)throw Error('"step" expects at least 4 arguments');if(1!==na.length%2)throw Error('"step" expects an even number of arguments');const oa=d(na[1],da,c.NumberType);let qa;const ua=[];ua.push([-Infinity,d(na[2],da)]);for(let Ca=3;Ca<na.length;Ca+=2){const Ja=na[Ca];if("number"!==typeof Ja)throw Error('"step" requires stop inputs as literal numbers');if(ua.length&&ua[ua.length-1][0]>=Ja)throw Error('"step" requires strictly ascending stop inputs');const Ha=d(na[Ca+1],da);
qa||(qa=Ha.type);ua.push([Ja,Ha])}return new ha(qa,oa,ua)};ha.prototype.evaluate=function(na,da){const oa=this.stops;if(1===oa.length)return oa[0][1].evaluate(na,da);const qa=this.input.evaluate(na,da);let ua=0;for(;++ua<oa.length&&!(qa<oa[ua][0]););return this.stops[ua-1][1].evaluate(na,da)};return ha}(),I=function(){function ha(na,da){this.type=na;this.output=da}ha.parse=function(na,da,oa){if(4>na.length)throw Error('"let" expects at least 3 arguments');if(1===na.length%2)throw Error('"let" expects an odd number of arguments');
const qa=new e(da);for(let ua=1;ua<na.length-1;ua+=2){const Ca=na[ua];if("string"!==typeof Ca)throw Error(`"let" requires a string to define variable names - found ${Ca}`);qa.add(Ca,d(na[ua+1],da))}na=d(na[na.length-1],qa,oa);return new ha(na.type,na)};ha.prototype.evaluate=function(na,da){return this.output.evaluate(na,da)};return ha}(),K=function(){function ha(na,da){this.type=na;this.output=da}ha.parse=function(na,da,oa){if(2!==na.length||"string"!==typeof na[1])throw Error('"var" requires just one literal string argument');
da=da.get(na[1]);if(!da)throw Error(`${na[1]} must be defined before being used in a "var" expression`);return new ha(oa||c.ValueType,da)};ha.prototype.evaluate=function(na,da){return this.output.evaluate(na,da)};return ha}(),J=function(){function ha(na,da,oa){this.type=na;this.index=da;this.array=oa}ha.parse=function(na,da){if(3!==na.length)throw Error('"at" expects 2 arguments');const oa=d(na[1],da,c.NumberType);na=d(na[2],da);return new ha(na.type.itemType,oa,na)};ha.prototype.evaluate=function(na,
da){const oa=this.index.evaluate(na,da);na=this.array.evaluate(na,da);if(0>oa||oa>=na.length)throw Error('"at" index out of bounds');if(oa!==Math.floor(oa))throw Error('"at" index must be an integer');return na[oa]};return ha}(),L=function(){function ha(na,da){this.key=na;this.obj=da;this.type=c.ValueType}ha.parse=function(na,da){let oa;switch(na.length){case 2:return oa=d(na[1],da),new ha(oa);case 3:return oa=d(na[1],da),na=d(na[2],da),new ha(oa,na);default:throw Error('"get" expects 1 or 2 arguments');
}};ha.prototype.evaluate=function(na,da){const oa=this.key.evaluate(na,da);return this.obj?this.obj.evaluate(na,da)[oa]:na.values[oa]};return ha}(),P=function(){function ha(na,da){this.key=na;this.obj=da;this.type=c.BooleanType}ha.parse=function(na,da){let oa;switch(na.length){case 2:return oa=d(na[1],da),new ha(oa);case 3:return oa=d(na[1],da),na=d(na[2],da),new ha(oa,na);default:throw Error('"has" expects 1 or 2 arguments');}};ha.prototype.evaluate=function(na,da){const oa=this.key.evaluate(na,
da);return this.obj?(na=this.obj.evaluate(na,da),oa in na):void 0!==na.values[oa]};return ha}(),Q=function(){function ha(na,da){this.key=na;this.vals=da;this.type=c.BooleanType}ha.parse=function(na,da){if(3!==na.length)throw Error('"in" expects 2 arguments');return new ha(d(na[1],da),d(na[2],da))};ha.prototype.evaluate=function(na,da){const oa=this.key.evaluate(na,da);return-1!==this.vals.evaluate(na,da).indexOf(oa)};return ha}(),X=function(){function ha(na,da,oa){this.item=na;this.array=da;this.from=
oa;this.type=c.NumberType}ha.parse=function(na,da){if(3>na.length||4<na.length)throw Error('"index-of" expects 3 or 4 arguments');const oa=d(na[1],da),qa=d(na[2],da);return 4===na.length?(na=d(na[3],da,c.NumberType),new ha(oa,qa,na)):new ha(oa,qa)};ha.prototype.evaluate=function(na,da){const oa=this.item.evaluate(na,da),qa=this.array.evaluate(na,da);if(this.from){na=this.from.evaluate(na,da);if(na!==Math.floor(na))throw Error('"index-of" index must be an integer');return qa.indexOf(oa,na)}return qa.indexOf(oa)};
return ha}(),aa=function(){function ha(na){this.arg=na;this.type=c.NumberType}ha.parse=function(na,da){if(2!==na.length)throw Error('"length" expects 2 arguments');na=d(na[1],da);return new ha(na)};ha.prototype.evaluate=function(na,da){na=this.arg.evaluate(na,da);if("string"===typeof na||Array.isArray(na))return na.length;throw Error('"length" expects string or array');};return ha}(),S=function(){function ha(na,da,oa,qa){this.type=na;this.array=da;this.from=oa;this.to=qa}ha.parse=function(na,da){if(3>
na.length||4<na.length)throw Error('"slice" expects 2 or 3 arguments');const oa=d(na[1],da),qa=d(na[2],da,c.NumberType);if(qa.type!==c.NumberType)throw Error('"slice" index must return a number');if(4===na.length){na=d(na[3],da,c.NumberType);if(na.type!==c.NumberType)throw Error('"slice" index must return a number');return new ha(oa.type,oa,qa,na)}return new ha(oa.type,oa,qa)};ha.prototype.evaluate=function(na,da){const oa=this.array.evaluate(na,da);if(!Array.isArray(oa)&&"string"!==typeof oa)throw Error('"slice" input must be an array or a string');
const qa=this.from.evaluate(na,da);if(0>qa||qa>=oa.length)throw Error('"slice" index out of bounds');if(qa!==Math.floor(qa))throw Error('"slice" index must be an integer');if(this.to){na=this.to.evaluate(na,da);if(0>na||na>=oa.length)throw Error('"slice" index out of bounds');if(na!==Math.floor(na))throw Error('"slice" index must be an integer');return oa.slice(qa,na)}return oa.slice(qa)};return ha}(),H=function(){function ha(){this.type=c.BooleanType}ha.parse=function(na){if(1!==na.length)throw Error('"has-id" expects no arguments');
return new ha};ha.prototype.evaluate=function(na,da){return void 0!==na.id};return ha}(),R=function(){function ha(na,da){this.args=na;this.calculate=da;this.type=c.NumberType}ha.parse=function(na,da,oa){na=na.slice(1).map(qa=>d(qa,da));return new ha(na,oa)};ha.prototype.evaluate=function(na,da){let oa;this.args&&(oa=this.args.map(qa=>qa.evaluate(na,da)));return this.calculate(oa)};return ha}(),T=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,
oa){switch(da.length){case 2:return R.parse(da,oa,qa=>-qa[0]);case 3:return R.parse(da,oa,qa=>qa[0]-qa[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return na}(R),W=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return R.parse(da,oa,qa=>{let ua=1;for(const Ca of qa)ua*=Ca;return ua})};return na}(R),Y=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){if(3===
da.length)return R.parse(da,oa,qa=>qa[0]/qa[1]);throw Error('"/" expects 2 arguments');};return na}(R),U=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){if(3===da.length)return R.parse(da,oa,qa=>qa[0]%qa[1]);throw Error('"%" expects 2 arguments');};return na}(R),N=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){if(3===da.length)return R.parse(da,oa,qa=>qa[0]**qa[1]);
throw Error('"^" expects 1 or 2 arguments');};return na}(R),ca=function(ha){function na(){return ha.apply(this,arguments)||this}g._inheritsLoose(na,ha);na.parse=function(da,oa){return R.parse(da,oa,qa=>{let ua=0;for(const Ca of qa)ua+=Ca;return ua})};return na}(R),O=function(){function ha(na,da){this.args=na;this.calculate=da;this.type=c.NumberType}ha.parse=function(na,da){const oa=na.slice(1).map(qa=>d(qa,da));return new ha(oa,ha.ops[na[0]])};ha.prototype.evaluate=function(na,da){let oa;this.args&&
(oa=this.args.map(qa=>qa.evaluate(na,da)));return this.calculate(oa)};return ha}();O.ops={abs:ha=>Math.abs(ha[0]),acos:ha=>Math.acos(ha[0]),asin:ha=>Math.asin(ha[0]),atan:ha=>Math.atan(ha[0]),ceil:ha=>Math.ceil(ha[0]),cos:ha=>Math.cos(ha[0]),e:()=>Math.E,floor:ha=>Math.floor(ha[0]),ln:ha=>Math.log(ha[0]),ln2:()=>Math.LN2,log10:ha=>Math.log(ha[0])/Math.LN10,log2:ha=>Math.log(ha[0])/Math.LN2,max:ha=>Math.max(...ha),min:ha=>Math.min(...ha),pi:()=>Math.PI,round:ha=>Math.round(ha[0]),sin:ha=>Math.sin(ha[0]),
sqrt:ha=>Math.sqrt(ha[0]),tan:ha=>Math.tan(ha[0])};let V=function(){function ha(na){this.args=na;this.type=c.StringType}ha.parse=function(na,da){return new ha(na.slice(1).map(oa=>d(oa,da)))};ha.prototype.evaluate=function(na,da){return this.args.map(oa=>oa.evaluate(na,da)).join("")};return ha}(),ba=function(){function ha(na,da){this.arg=na;this.calculate=da;this.type=c.StringType}ha.parse=function(na,da){if(2!==na.length)throw Error(`${na[0]} expects 1 argument`);da=d(na[1],da);return new ha(da,ha.ops[na[0]])};
ha.prototype.evaluate=function(na,da){return this.calculate(this.arg.evaluate(na,da))};return ha}();ba.ops={downcase:ha=>ha.toLowerCase(),upcase:ha=>ha.toUpperCase()};let fa=function(){function ha(da){this.args=da;this.type=c.ColorType}ha.parse=function(da,oa){if(4!==da.length)throw Error('"rgb" expects 3 arguments');da=da.slice(1).map(qa=>d(qa,oa));return new ha(da)};var na=ha.prototype;na.evaluate=function(da,oa){const qa=this._validate(this.args[0].evaluate(da,oa)),ua=this._validate(this.args[1].evaluate(da,
oa));da=this._validate(this.args[2].evaluate(da,oa));return new b({r:qa,g:ua,b:da})};na._validate=function(da){if("number"!==typeof da||0>da||255<da)throw Error(`${da}: invalid color component`);return Math.round(da)};return ha}(),ia=function(){function ha(da){this.args=da;this.type=c.ColorType}ha.parse=function(da,oa){if(5!==da.length)throw Error('"rgba" expects 4 arguments');da=da.slice(1).map(qa=>d(qa,oa));return new ha(da)};var na=ha.prototype;na.evaluate=function(da,oa){const qa=this._validate(this.args[0].evaluate(da,
oa)),ua=this._validate(this.args[1].evaluate(da,oa)),Ca=this._validate(this.args[2].evaluate(da,oa));da=this._validateAlpha(this.args[3].evaluate(da,oa));return new b({r:qa,g:ua,b:Ca,a:da})};na._validate=function(da){if("number"!==typeof da||0>da||255<da)throw Error(`${da}: invalid color component`);return Math.round(da)};na._validateAlpha=function(da){if("number"!==typeof da||0>da||1<da)throw Error(`${da}: invalid alpha color component`);return da};return ha}(),ma=function(){function ha(na){this.color=
na;this.type=c.arrayType(c.NumberType,4)}ha.parse=function(na,da){if(2!==na.length)throw Error('"to-rgba" expects 1 argument');na=d(na[1],da);return new ha(na)};ha.prototype.evaluate=function(na,da){return(new b(this.color.evaluate(na,da))).toRgba()};return ha}(),ea=function(){function ha(na,da){this.type=na;this.args=da}ha.parse=function(na,da){var oa=na[0];if(2>na.length)throw Error(`${oa} expects at least one argument`);let qa=1,ua;if("array"===oa){if(2<na.length){switch(na[1]){case "string":ua=
c.StringType;break;case "number":ua=c.NumberType;break;case "boolean":ua=c.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}qa++}else ua=c.ValueType;if(3<na.length){var Ca=na[2];if(null!==Ca&&("number"!==typeof Ca||0>Ca||Ca!==Math.floor(Ca)))throw Error('"array" length argument must be a positive integer literal');qa++}ua=c.arrayType(ua,Ca)}else switch(oa){case "string":ua=c.StringType;break;case "number":ua=c.NumberType;break;case "boolean":ua=c.BooleanType;
break;case "object":ua=c.ObjectType}for(oa=[];qa<na.length;qa++)Ca=d(na[qa],da),oa.push(Ca);return new ha(ua,oa)};ha.prototype.evaluate=function(na,da){let oa;for(const qa of this.args){const ua=qa.evaluate(na,da);oa=c.getType(ua);if(c.matchType(oa,this.type))return ua}throw Error(`Expected ${c.typeToString(this.type)} but got ${c.typeToString(oa)}`);};return ha}(),M=function(){function ha(na,da){this.type=na;this.args=da}ha.parse=function(na,da){var oa=na[0];const qa=ha.types[oa];if(qa===c.BooleanType||
qa===c.StringType){if(2!==na.length)throw Error(`${oa} expects one argument`);}else if(2>na.length)throw Error(`${oa} expects at least one argument`);oa=[];for(let ua=1;ua<na.length;ua++){const Ca=d(na[ua],da);oa.push(Ca)}return new ha(qa,oa)};ha.prototype.evaluate=function(na,da){if(this.type===c.BooleanType)return!!this.args[0].evaluate(na,da);if(this.type===c.StringType)return c.valueToString(this.args[0].evaluate(na,da));if(this.type===c.NumberType){for(const qa of this.args){var oa=Number(qa.evaluate(na,
da));if(!isNaN(oa))return oa}return null}if(this.type===c.ColorType){for(oa of this.args)try{const qa=ha.toColor(oa.evaluate(na,da));if(qa instanceof b)return qa}catch{}return null}};ha.toBoolean=function(na){return!!na};ha.toString=function(na){return c.valueToString(na)};ha.toNumber=function(na){const da=Number(na);if(isNaN(da))throw Error(`"${na}" is not a number`);return da};ha.toColor=function(na){if(na instanceof b)return na;if("string"===typeof na){const da=b.fromString(na);if(da)return da;
throw Error(`"${na}" is not a color`);}if(Array.isArray(na))return b.fromArray(na);throw Error(`"${na}" is not a color`);};return ha}();M.types={"to-boolean":c.BooleanType,"to-color":c.ColorType,"to-number":c.NumberType,"to-string":c.StringType};let Z=function(){function ha(na){this.val=na;this.type=c.getType(na)}ha.parse=function(na){if(2!==na.length)throw Error('"literal" expects 1 argument');return new ha(na[1])};ha.prototype.evaluate=function(na,da){return this.val};return ha}(),la=function(){function ha(na){this.arg=
na;this.type=c.StringType}ha.parse=function(na,da){if(2!==na.length)throw Error('"typeof" expects 1 argument');return new ha(d(na[1],da))};ha.prototype.evaluate=function(na,da){return c.typeToString(c.getType(this.arg.evaluate(na,da)))};return ha}();const ka={array:ea,"boolean":ea,collator:null,format:null,image:null,literal:Z,number:ea,"number-format":null,object:ea,string:ea,"to-boolean":M,"to-color":M,"to-number":M,"to-string":M,"typeof":la,accumulated:null,"feature-state":null,"geometry-type":n,
id:h,"line-progress":null,properties:q,at:J,get:L,has:P,"in":Q,"index-of":X,length:aa,slice:S,"!":r,"!\x3d":l,"\x3c":w,"\x3c\x3d":y,"\x3d\x3d":t,"\x3e":D,"\x3e\x3d":z,all:C,any:A,"case":m,coalesce:B,match:E,within:null,interpolate:F,"interpolate-hcl":F,"interpolate-lab":F,step:G,let:I,"var":K,concat:V,downcase:ba,"is-supported-script":null,"resolved-locale":null,upcase:ba,rgb:fa,rgba:ia,"to-rgba":ma,"-":T,"*":W,"/":Y,"%":U,"^":N,"+":ca,abs:O,acos:O,asin:O,atan:O,ceil:O,cos:O,e:O,floor:O,ln:O,ln2:O,
log10:O,log2:O,max:O,min:O,pi:O,round:O,sin:O,sqrt:O,tan:O,zoom:u,"heatmap-density":null,"has-id":H,none:x};a.ALL=C;a.ANY=A;a.Add=ca;a.Assert=ea;a.At=J;a.Calculate=O;a.Case=m;a.Coalesce=B;a.Coerce=M;a.Concat=V;a.Div=Y;a.EQ=t;a.GE=z;a.GT=D;a.GeomType=n;a.Get=L;a.Has=P;a.HasID=H;a.ID=h;a.In=Q;a.IndexOf=X;a.Interpolate=F;a.LE=y;a.LT=w;a.Length=aa;a.Let=I;a.Literal=Z;a.Match=E;a.Mod=U;a.Mul=W;a.NE=l;a.NONE=x;a.NOT=r;a.Pow=N;a.Properties=q;a.Rgb=fa;a.Rgba=ia;a.Slice=S;a.Step=G;a.String=ba;a.Sub=T;a.ToRgba=
ma;a.TypeOf=la;a.Var=K;a.Zoom=u;a.createExpression=d;a.ops=ka;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function g(h,n){const q=[];let u,v;if(h[0].length!==n.length)throw"dimensions do not match";const t=h.length,l=h[0].length;let w=0;for(u=0;u<t;u++){for(v=w=0;v<l;v++)w+=h[u][v]*n[v];q.push(w)}return q}function b(h){h=[h.r/255,h.g/255,h.b/255].map(n=>.04045>=n?n/12.92:((n+.055)/1.055)**2.4);h=g(d,h);return{x:100*h[0],y:100*
h[1],z:100*h[2]}}function p(h){h=g(e,[h.x/100,h.y/100,h.z/100]).map(n=>Math.min(1,Math.max(.0031308>=n?12.92*n:1.055*n**(1/2.4)-.055,0)));return{r:Math.round(255*h[0]),g:Math.round(255*h[1]),b:Math.round(255*h[2])}}function f(h){h=[h.x/95.047,h.y/100,h.z/108.883].map(n=>n>(6/29)**3?n**(1/3):1/3*(29/6)**2*n+4/29);return{l:116*h[1]-16,a:500*(h[0]-h[1]),b:200*(h[1]-h[2])}}function k(h){const n=h.l;h=[(n+16)/116+h.a/500,(n+16)/116,(n+16)/116-h.b/200].map(q=>q>6/29?q**3:3*(6/29)**2*(q-4/29));return{x:95.047*
h[0],y:100*h[1],z:108.883*h[2]}}function c(h){if("r"in h&&"g"in h&&"b"in h)return h;if("l"in h&&"c"in h&&"h"in h){var n=h.c;var q=h.h;n={l:h.l,a:n*Math.cos(q),b:n*Math.sin(q)};return p(k(n))}if("l"in h&&"a"in h&&"b"in h)return p(k(h));if("x"in h&&"y"in h&&"z"in h)return p(h);if("h"in h&&"s"in h&&"v"in h){{q=(h.h+360)%360/60;n=h.v/100*255;h=h.s/100*n;const u=h*(1-Math.abs(q%2-1));switch(Math.floor(q)){case 0:q={r:h,g:u,b:0};break;case 1:q={r:u,g:h,b:0};break;case 2:q={r:0,g:h,b:u};break;case 3:q={r:0,
g:u,b:h};break;case 4:q={r:u,g:0,b:h};break;case 5:case 6:q={r:h,g:0,b:u};break;default:q={r:0,g:0,b:0}}q.r=Math.round(q.r+n-h);q.g=Math.round(q.g+n-h);q.b=Math.round(q.b+n-h);n=q}return n}return h}const d=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],e=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(h,n){h=f(b(h));h.l*=1-n;return p(k(h))};a.toHSV=function(h){if("h"in h&&"s"in h&&"v"in h)return h;var n=c(h);{h=n.r;const q=n.g,u=n.b;n=Math.max(h,
q,u);const v=n-Math.min(h,q,u);h=0===v?0:n===h?(q-u)/v%6:n===q?(u-h)/v+2:(h-q)/v+4;0>h&&(h+=6);h={h:60*h,s:100*(0===v?0:v/n),v:100/255*n}}return h};a.toLAB=function(h){return"l"in h&&"a"in h&&"b"in h?h:f(b(c(h)))};a.toLCH=function(h){if(!("l"in h&&"c"in h&&"h"in h)){{var n=f(b(c(h)));h=n.l;var q=n.a;const u=n.b;n=Math.sqrt(q*q+u*u);q=Math.atan2(u,q);q=0<q?q:q+2*Math.PI;h={l:h,c:n,h:q}}}return h};a.toRGB=c;a.toXYZ=function(h){return"x"in h&&"y"in h&&"z"in h?h:b(c(h))};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(a){function g(f,k,c,d){function e(l,w){var y;let D,z;D=l;for(y=0;8>y;y++){z=((q*D+n)*D+h)*D-l;if(Math.abs(z)<w)return D;var r=(3*q*D+2*n)*D+h;if(1E-6>Math.abs(r))break;D-=z/r}r=0;y=1;D=l;if(D<r)return r;if(D>y)return y;for(;r<y;){z=((q*D+n)*D+h)*D;if(Math.abs(z-l)<w)break;l>z?r=D:y=D;D=.5*(y-r)+r}return D}const h=3*f,n=3*(c-f)-h,q=1-h-n,u=3*k,v=3*(d-k)-u,t=1-u-v;return function(l,w=1E-6){l=e(l,w);return((t*l+v)*l+u)*
l}}const b=/^cubic-bezier\((.*)\)/,p={};p.ease=g(.25,.1,.25,1);p.linear=g(0,0,1,1);p.easeIn=p["ease-in"]=g(.42,0,1,1);p.easeOut=p["ease-out"]=g(0,0,.58,1);p.easeInOut=p["ease-in-out"]=g(.42,0,.58,1);a.easingFunctions=p;a.parse=function(f){let k=p[f]||null;!k&&(f=b.exec(f))&&(f=f[1].split(",").map(c=>parseFloat(c.trim())),4!==f.length||f.some(c=>isNaN(c))||(k=g.apply(g,f)));return k};a.unitBezier=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],
function(a){function g(d,e){d%=e;return 0<=d?d:d+e}const b=Number.POSITIVE_INFINITY,p=Math.PI,f=128/p,k=256/360,c=1/Math.LN2;a.C_256_TO_RAD=p/128;a.C_2PI=2*p;a.C_DEG_TO_256=k;a.C_DEG_TO_RAD=p/180;a.C_INFINITY=b;a.C_PI=p;a.C_PI_BY_2=p/2;a.C_RAD_TO_256=f;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/1.414213562;a.between=function(d,e,h){return d>=e&&d<=h||d>=h&&d<=e};a.degToByte=function(d){return g(d*k,256)};a.interpolate=function(d,e,h){return d*(1-h)+e*h};a.log2=function(d){return Math.log(d)*c};a.positiveMod=
g;a.radToByte=function(d){return g(d*f,256)};a.sqr=function(d){return d*d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(a){let g=function(){};g.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};g.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};g.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},
"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};g.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",
minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",
default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},
"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",
default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}};g.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};g.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",
minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};g.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};g.linePaintDefinition={"line-blur":{type:"number",
minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}};
g.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",
minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};g.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};g.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};a.StyleDefinition=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color",
"../GeometryUtils","../expression/types","../expression/expression"],function(a,g,b,p){return function(){function f(c,d){this.isDataDriven=!1;this.interpolator=null;switch(c.type){case "number":var e=!0;break;case "color":e=!0;break;case "array":e="number"===c.value;break;default:e=!1}null==d&&(d=c.default);if(Array.isArray(d)&&0<d.length&&p.ops[d[0]]){e={number:b.NumberType,color:b.ColorType,string:b.StringType,boolean:b.BooleanType,enum:b.StringType};try{var h="array"===c.type?b.arrayType(e[c.value]||
b.ValueType,c.length):e[c.type];const n=p.createExpression(d,null,h);this.getValue=this._buildExpression(n,c);this.isDataDriven=!0;n instanceof p.Interpolate&&n.input instanceof p.Zoom&&(this.interpolator=n)}catch(n){console.log(n.message),this.getValue=this._buildSimple(c.default)}}else{e&&"interval"===d.type&&(e=!1);if(h=d&&d.stops&&0<d.stops.length)for(const n of d.stops)n[1]=this._validate(n[1],c);if(this.isDataDriven=d?!!d.property:!1)if(void 0!==d.default&&(d.default=this._validate(d.default,
c)),h)switch(d.type){case "identity":this.getValue=this._buildIdentity(d,c);break;case "categorical":this.getValue=this._buildCategorical(d,c);break;default:this.getValue=e?this._buildInterpolate(d,c):this._buildInterval(d,c)}else this.getValue=this._buildIdentity(d,c);else h?this.getValue=e?this._buildZoomInterpolate(d):this._buildZoomInterval(d):(d=this._validate(d,c),this.getValue=this._buildSimple(d))}}var k=f.prototype;k._validate=function(c,d){if("number"===d.type){if(c<d.minimum)return d.minimum;
if(c>d.maximum)return d.maximum}else"color"===d.type?c=f._parseColor(c):"enum"===d.type?"string"===typeof c&&(c=d.values.indexOf(c)):"array"===d.type&&"enum"===d.value?c=c.map(e=>"string"===typeof c?d.values.indexOf(e):e):"string"===d.type&&(c=b.valueToString(c));return c};k._buildSimple=function(c){return()=>c};k._buildExpression=function(c,d){return(e,h)=>{try{const n=c.evaluate(h,e);return void 0===n?d.default:this._validate(n,d)}catch(n){return console.log(n.message),d.default}}};k._buildIdentity=
function(c,d){return(e,h)=>{let n;h&&(n=h.values[c.property]);return void 0!==n?this._validate(n,d):void 0!==c.default?c.default:d.default}};k._buildCategorical=function(c,d){return(e,h)=>{let n;h&&(n=h.values[c.property]);n=this._categorical(n,c.stops);return void 0!==n?n:void 0!==c.default?c.default:d.default}};k._buildInterval=function(c,d){return(e,h)=>{let n;h&&(n=h.values[c.property]);return"number"===typeof n?this._interval(n,c.stops):void 0!==c.default?c.default:d.default}};k._buildInterpolate=
function(c,d){return(e,h)=>{let n;h&&(n=h.values[c.property]);return"number"===typeof n?this._interpolate(n,c.stops,c.base||1):void 0!==c.default?c.default:d.default}};k._buildZoomInterpolate=function(c){return d=>this._interpolate(d,c.stops,c.base||1)};k._buildZoomInterval=function(c){return d=>this._interval(d,c.stops)};k._categorical=function(c,d){const e=d.length;for(let h=0;h<e;h++)if(d[h][0]===c)return d[h][1]};k._interval=function(c,d){const e=d.length;let h=0;for(let n=0;n<e;n++)if(d[n][0]<=
c)h=n;else break;return d[h][1]};k._interpolate=function(c,d,e){const h=d.length;for(let u=0;u<h;u++){const v=d[u];if(v[0]<=c)var n=v;else{var q=v;break}}if(n&&q){d=q[0]-n[0];c-=n[0];e=1===e?c/d:(e**c-1)/(e**d-1);if(Array.isArray(n[1])){n=n[1];q=q[1];c=[];for(d=0;d<n.length;d++)c.push(g.interpolate(n[d],q[d],e));return c}return g.interpolate(n[1],q[1],e)}if(n)return n[1];if(q)return q[1]};f._isEmpty=function(c){for(const d in c)if(c.hasOwnProperty(d))return!1;return!0};f._parseColor=function(c){if(Array.isArray(c))return c;
"string"===typeof c&&(c=new a(c));if(c instanceof a){if(!this._isEmpty(c))return a.toUnitRGBA(c)}else return c};return f}()})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(a){a.ANGLE_FACTOR_256=256/360;a.ATTRIBUTE_DATA_ANIMATION=1;a.ATTRIBUTE_DATA_DD0=3;a.ATTRIBUTE_DATA_DD1=3;a.ATTRIBUTE_DATA_FILTER_FLAGS=0;a.ATTRIBUTE_DATA_VV=2;a.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;a.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.BUFFER_DATA_MINIMUM_SIZE=
128;a.BUFFER_DATA_POOL_SIZE=4;a.COLLISION_BOX_PADDING=16;a.COLLISION_BUCKET_SIZE=128;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;a.COLLISION_MAX_ZOOM_DELTA=1;a.COLLISION_PLACEMENT_PADDING=8;a.COLLISION_TILE_BOX_SIZE=4;a.DEBUG_LABELS=!1;a.DISPLAY_RECORD_INT_PER_ELEMENT=7;a.DOT_DENSITY_MAX_FIELDS=8;a.EFFECT_FLAG_0=4;a.ENABLE_EARLY_LABEL_DISCARD=!1;a.EXTRUDE_SCALE=64;a.FILTER_FLAG_0=2;a.GLYPH_SIZE=24;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HIGHLIGHT_FLAG=1;a.HITTEST_SEARCH_SIZE=
6;a.MAGIC_LABEL_LINE_HEIGHT=29;a.MAX_FILTERS=2;a.MAX_GPU_UPLOADS_PER_FRAME=2;a.NAN_MAGIC_NUMBER=1E-30;a.PATCH_PIXEL_BUFFER_ALLOC_SIZE=500;a.PICTURE_FILL_COLOR=4294967295;a.RASTER_TILE_SIZE=256;a.SPRITE_PADDING=2;a.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;a.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;a.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;a.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;a.TEXTURE_BINDING_BITMAP=0;a.TEXTURE_BINDING_GLYPH_ATLAS=0;a.TEXTURE_BINDING_HIGHLIGHT_0=5;a.TEXTURE_BINDING_HIGHLIGHT_1=6;a.TEXTURE_BINDING_RENDERER_0=
5;a.TEXTURE_BINDING_RENDERER_1=6;a.TEXTURE_BINDING_SPRITE_ATLAS=0;a.TEXT_PLACEMENT_PADDING=8;a.THIN_LINE_THRESHOLD=2.5;a.TILE_SIZE=512;a.VTL_HIGH_RES_CUTOFF=1.15;a.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;a.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;a.WEBGL_MAX_INNER_STOPS=6;a.WEBGL_MAX_STOPS=8;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./decluttering/config ./RenderBucket ../webgl/TiledDisplayObject".split(" "),
function(a,g,b,p,f,k,c,d){d=function(h){function n(u,v,t,l,w=null){t=h.call(this,u,t,l,[4096,4096])||this;t._memCache=w;t._referenced=0;t._hasSymbolBuckets=!1;t._memoryUsedByLayerData=0;t.layerData=new Map;t.layerCount=0;t.status="loading";t.allSymbolsFadingOut=!1;t.lastOpacityUpdate=0;t.symbols=new Map;t.isCoverage=!1;t.neededForCoverage=!1;t.decluttered=!1;t.invalidating=!1;t.parentTile=null;t.childrenTiles=new Set;t._processed=!1;t._referenced=1;t.styleRepository=v;t.id=u.id;t.transforms.tileUnitsToPixels=
f.create();return t}g._inheritsLoose(n,h);var q=n.prototype;q.setData=function(u){this.changeDataImpl(u);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};q.deleteLayerData=function(u){let v=!1;for(const t of u)this.layerData.has(t)&&(u=this.layerData.get(t),this._memoryUsedByLayerData-=u.memoryUsed,3===u.type&&this.symbols.has(t)&&(this.symbols.delete(t),v=!0),u.destroy(),this.layerData.delete(t),this.layerCount--);b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);v&&this.emit("symbols-changed");this.requestRender()};q.processed=function(){return this._processed};q.hasData=function(){return 0<this.layerCount};q.dispose=function(){"unloaded"!==this.status&&(e.delete(this),n._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};q.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};q.retain=function(){++this._referenced};
q.getMemoryUsage=function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)};q.changeDataImpl=function(u){let v=!1;if(u){u=this._createRenderBuckets(u);for(const [t,l]of u)this.layerData.has(t)&&(u=this.layerData.get(t),this._memoryUsedByLayerData-=l.memoryUsed,u.destroy(),this.layerData.delete(t),this.layerCount--),3===l.type&&(this.symbols.set(t,l.symbols),v=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(t,l),this.layerCount++;b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,t]of this.layerData)3===t.type&&(this._hasSymbolBuckets=!0);v&&this.emit("symbols-changed")};q.attachWithContext=function(u){this.stage={context:u,trashDisplayObject(v){v.processDetach()},untrashDisplayObject(){return!1}}};q.setTransform=function(u,v){h.prototype.setTransform.call(this,u,v);var t=v/(u.resolution*u.pixelRatio);v=this.size[0]/this.coordRange[0]*t;t*=this.size[1]/this.coordRange[1];const l=[0,0];u.toScreen(l,this.coords);
const w=this.transforms.tileUnitsToPixels;p.identity(w);p.translate(w,w,l);p.rotate(w,w,Math.PI*u.rotation/180);p.scale(w,w,[v,t,1])};n._destroyRenderBuckets=function(u){if(u){var v=new Set;u.forEach(t=>{v.has(t)||(t.destroy(),v.add(t))});u.clear()}};q._createRenderBuckets=function(u){const v=new Map,t=new Map;for(const l of u){u=this._deserializeBucket(l,t);for(const w of u.layerUIDs)v.set(w,u)}return v};q._deserializeBucket=function(u,v){let t=v.get(u);if(t)return t;switch((new Uint32Array(u))[0]){case 1:t=
new c.FillRenderBucket(u,this.styleRepository);break;case 2:t=new c.LineRenderBucket(u,this.styleRepository);break;case 3:t=new c.SymbolRenderBucket(u,this.styleRepository,this);break;case 4:t=new c.CircleRenderBucket(u,this.styleRepository)}v.set(u,t);return t};g._createClass(n,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<k.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&
(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<k.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}}]);return n}(d.TiledDisplayObject);const e=new Map;a.VectorTile=d;a.printAllocations=function(){e.forEach((h,n)=>{console.log(`\n${n.key}:`);h[0].forEach(q=>console.log(q));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");h[1].forEach(q=>
console.log(q))})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function g(){const c=new Float32Array(9);c[0]=1;c[4]=1;c[8]=1;return c}function b(c){const d=new Float32Array(9);d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[3];d[4]=c[4];d[5]=c[5];d[6]=c[6];d[7]=c[7];d[8]=c[8];return d}function p(c,d,e,h,n,q,u,v,t){const l=new Float32Array(9);l[0]=c;l[1]=d;l[2]=e;l[3]=h;l[4]=n;l[5]=q;l[6]=u;l[7]=v;l[8]=t;return l}function f(c,d){return new Float32Array(c,
d,9)}var k=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f});a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat3f32=k})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./decluttering/util".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){p=function(){function v(l,w){this.layerUIDs=[];this.isDestroyed=!1;this.data=l;this.memoryUsed=l.byteLength;let y=1;l=new Uint32Array(l);this.layerUIDs=[];const D=l[y++];for(let z=0;z<D;z++)this.layerUIDs[z]=l[y++];this.bufferDataOffset=y;w&&(this.layer=w.getStyleLayerByUID(this.layerUIDs[0]))}var t=v.prototype;t.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};t.prepareForRendering=function(l){b.isNone(this.data)||(this.doPrepareForRendering(l,
this.data,this.bufferDataOffset),this.data=null)};g._createClass(v,[{key:"isPreparedForRendering",get:function(){return b.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return v}();k=function(v){function t(w,y){y=v.call(this,w,y)||this;y.type=2;y.lineIndexStart=0;y.lineIndexCount=0;w=new Uint32Array(w);let D=y.bufferDataOffset;y.lineIndexStart=w[D++];y.lineIndexCount=w[D++];y.bufferDataOffset=D;return y}g._inheritsLoose(t,v);var l=t.prototype;l.hasData=function(){return 0<
this.lineIndexCount};l.triangleCount=function(){return this.lineIndexCount/3};l.doDestroy=function(){b.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();b.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();b.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};l.doPrepareForRendering=function(w,y,D){y=new Uint32Array(y);var z=new Int32Array(y.buffer);const r=y[D++];
this.lineVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;z=y[D++];this.lineIndexBuffer=f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,z));D+=z;D=this.layer.lineMaterial;this.lineVertexArrayObject=new c(w,D.getAttributeLocations(),D.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return t}(p);d=function(v){function t(w,y){y=v.call(this,w,y)||this;y.type=1;y.fillIndexStart=0;y.fillIndexCount=0;y.outlineIndexStart=0;y.outlineIndexCount=0;w=new Uint32Array(w);
let D=y.bufferDataOffset;y.fillIndexStart=w[D++];y.fillIndexCount=w[D++];y.outlineIndexStart=w[D++];y.outlineIndexCount=w[D++];y.bufferDataOffset=D;return y}g._inheritsLoose(t,v);var l=t.prototype;l.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};l.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};l.doDestroy=function(){b.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();b.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();
b.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;b.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();b.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();b.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};l.doPrepareForRendering=function(w,y,D){y=
new Uint32Array(y);var z=new Int32Array(y.buffer),r=y[D++];this.fillVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;r=y[D++];this.fillIndexBuffer=f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,r));D+=r;r=y[D++];this.outlineVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;z=y[D++];this.outlineIndexBuffer=f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,z));D+=z;y=this.layer;D=y.fillMaterial;y=y.outlineMaterial;this.fillVertexArrayObject=new c(w,
D.getAttributeLocations(),D.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new c(w,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return t}(p);e=function(v){function t(w,y,D){y=v.call(this,w,y)||this;y.type=3;y.iconPerPageElementsMap=new Map;y.glyphPerPageElementsMap=new Map;y.symbolInstances=[];y.isIconSDF=!1;y.opacityChanged=!1;y.lastOpacityUpdate=0;y.symbols=[];const z=new Uint32Array(w),
r=new Int32Array(w);w=new Float32Array(w);let C=y.bufferDataOffset;y.isIconSDF=!!z[C++];var A=z[C++];for(var x=0;x<A;x++){var m=z[C++],B=z[C++],E=z[C++];y.iconPerPageElementsMap.set(m,[B,E])}A=z[C++];for(x=0;x<A;x++)m=z[C++],B=z[C++],E=z[C++],y.glyphPerPageElementsMap.set(m,[B,E]);A=z[C++];x=z[C++];y.iconOpacity=new Int32Array(A);y.textOpacity=new Int32Array(x);C=u.deserializeSymbols(z,r,w,C,y.symbols,D);y.bufferDataOffset=C;return y}g._inheritsLoose(t,v);var l=t.prototype;l.hasData=function(){return 0<
this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};l.triangleCount=function(){let w=0;for(const [,y]of this.iconPerPageElementsMap)w+=y[1];for(const [,y]of this.glyphPerPageElementsMap)w+=y[1];return w/3};l.doDestroy=function(){b.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();b.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();b.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();b.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();
this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;b.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();b.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();b.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();b.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};l.updateOpacityInfo=
function(){if(this.opacityChanged){this.opacityChanged=!1;var w=b.unwrap(this.iconOpacity),y=b.unwrap(this.iconOpacityBuffer);0<w.length&&w.byteLength===y.size&&y.setSubData(w);w=b.unwrap(this.textOpacity);y=b.unwrap(this.textOpacityBuffer);0<w.length&&w.byteLength===y.size&&y.setSubData(w)}};l.doPrepareForRendering=function(w,y,D){y=new Uint32Array(y);var z=new Int32Array(y.buffer),r=y[D++];this.iconVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;r=y[D++];this.iconIndexBuffer=
f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,r));D+=r;r=y[D++];this.textVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;z=y[D++];this.textIndexBuffer=f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,z));D+=z;this.iconOpacityBuffer=f.createVertex(w,35044,b.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=f.createVertex(w,35044,b.unwrap(this.textOpacity).buffer);y=this.layer;D=y.iconMaterial;y=y.textMaterial;this.iconVertexArrayObject=new c(w,D.getAttributeLocations(),
D.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new c(w,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return t}(p);h=function(v){function t(w,y){y=v.call(this,w,y)||this;y.type=4;y.circleIndexStart=0;y.circleIndexCount=0;w=new Uint32Array(w);let D=y.bufferDataOffset;y.circleIndexStart=w[D++];y.circleIndexCount=w[D++];y.bufferDataOffset=
D;return y}g._inheritsLoose(t,v);var l=t.prototype;l.hasData=function(){return 0<this.circleIndexCount};l.triangleCount=function(){return this.circleIndexCount/3};l.doDestroy=function(){b.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();b.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();b.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};
l.doPrepareForRendering=function(w,y,D){y=new Uint32Array(y);var z=new Int32Array(y.buffer);const r=y[D++];this.circleVertexBuffer=f.createVertex(w,35044,new Int32Array(z.buffer,4*D,r));D+=r;z=y[D++];this.circleIndexBuffer=f.createIndex(w,35044,new Uint32Array(y.buffer,4*D,z));D+=z;D=this.layer.circleMaterial;this.circleVertexArrayObject=new c(w,D.getAttributeLocations(),D.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return t}(p);a.CircleRenderBucket=h;a.FillRenderBucket=
d;a.LineRenderBucket=k;a.RenderBucketBase=p;a.SymbolRenderBucket=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./core"],function(a,g,b,p){let f=function(e){this.tile=e;this.parent=null;this.children=new Set},k=function(){function e(){this.nodes=new Map;this.roots=new Set}var h=e.prototype;h.create=function(n){const q=new f(n);let u;
const v=[];this.nodes.forEach(t=>{this._canConnectDirectly(q,t)&&v.push(t);!u&&this._canConnectDirectly(t,q)&&(u=t)});if(u){for(const t of v)u.children.delete(t),q.children.add(t),t.parent=q;u.children.add(q);q.parent=u}else{this.roots.add(q);for(const t of v)q.children.add(t),t.parent=q,this.roots.delete(t)}this.nodes.set(n.key.id,q);return q};h.destroy=function(n){b.isSome(n.parent)?(n.parent.children.delete(n),n.children.forEach(q=>{b.isSome(n.parent)&&n.parent.children.add(q)})):this.roots.delete(n);
n.children.forEach(q=>{(q.parent=n.parent)||this.roots.add(q)});this.nodes.delete(n.tile.key.id)};h.clear=function(){this.roots.clear();this.nodes.clear()};h._canConnectDirectly=function(n,q){let {level:u,row:v,col:t}=q.tile.key;for({world:q}=q.tile.key;0<u;){u--;v>>=1;t>>=1;if(n.tile.key.level===u&&n.tile.key.row===v&&n.tile.key.col===t&&n.tile.key.world===q)return!0;if(this.nodes.has(`${u}/${v}/${t}/${q}`))break}return!1};return e}(),c=function(){function e(){this._tileGraph=new k;this._tileArray=
null}var h=e.prototype;h.has=function(n){return"string"===typeof n?this._tileGraph.nodes.has(n):this._tileGraph.nodes.has(n.key.id)};h.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(n=>{this._tileArray.push(n.tile)}));return this._tileArray};h.getRoots=function(){const n=[];this._tileGraph.roots.forEach(q=>{n.push(q.tile)});return n};h.getParent=function(n){n=this._tileGraph.nodes.get("string"===typeof n?n:n.key.id);return b.isSome(n.parent)&&n.parent.tile};h.getChildren=
function(n){const q=[];this._tileGraph.nodes.get("string"===typeof n?n:n.key.id).children.forEach(u=>{q.push(u.tile)});return q};h.get=function(n){return this._tileGraph.nodes.get(n).tile};h.removeKey=function(n){n=this._tileGraph.nodes.get(n);this._tileGraph.destroy(n);this._tileArray=null};h.forEach=function(n){this._tileGraph.nodes.forEach((q,u)=>n(q.tile,u))};h.add=function(n){this._tileGraph.create(n);this._tileArray=null};h.remove=function(n){n=this._tileGraph.nodes.get(n.key.id);this._tileGraph.destroy(n);
this._tileArray=null};h.clear=function(){this._tileGraph.clear();this._tileArray=[]};return e}(),d=function(){function e(n,q,u){this._rows=Math.ceil(q/u);this._columns=Math.ceil(n/u);this._cellSize=u;this.cells=Array(this._rows);for(n=0;n<this._rows;n++)for(this.cells[n]=Array(this._columns),q=0;q<this._columns;q++)this.cells[n][q]=[]}var h=e.prototype;h.getCell=function(n,q){q=Math.min(Math.max(Math.floor(q/this._cellSize),0),this._rows-1);n=Math.min(Math.max(Math.floor(n/this._cellSize),0),this._columns-
1);return this.cells[q]&&this.cells[q][n]||null};h.getCellSpan=function(n,q,u,v){return[Math.min(Math.max(Math.floor(n/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(q/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(u/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(v/this._cellSize),0),this.rows-1)]};g._createClass(e,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);
return e}();a.GridIndex=d;a.TileForest=c;a.TileGraph=k;a.TileNode=f;a.deserializeSymbols=function(e,h,n,q,u,v){const t=h[q++];for(let y=0;y<t;y++){const D=new p.VTLSymbol(v);D.xTile=h[q++];D.yTile=h[q++];D.hash=h[q++];D.priority=h[q++];var l=h[q++];for(var w=0;w<l;w++){const z=h[q++],r=h[q++],C=h[q++],A=h[q++],x=!!h[q++],m=h[q++],B=n[q++],E=n[q++],F=h[q++],G=h[q++];D.colliders.push({xTile:z,yTile:r,dxPixels:C,dyPixels:A,hard:x,partIndex:m,width:F,height:G,minLod:B,maxLod:E})}l=e[q++];for(w=0;w<l;w++)D.textVertexRanges.push([e[q++],
e[q++]]);l=e[q++];for(w=0;w<l;w++)D.iconVertexRanges.push([e[q++],e[q++]]);u.push(D)}return q};a.tileCoordChange=function(e,h,n,q,u,v){n-=u;if(0<=n)return(h>>n)+(q-(v<<n))*(e>>n);n=-n;return h-(v-(q<<n))*(e>>n)<<n};a.writeOpacityToBuffers=function(e,h,n){for(const [y,D]of e.symbols){{var q=e,u=h,v=n,t=D;const z=q.layerData.get(y);if(3===z.type){for(const r of t){t=r.unique;var l=void 0;if(r.selectedForRendering){var w=t.parts[0];l=w.startOpacity;w=w.targetOpacity;q.allSymbolsFadingOut=q.allSymbolsFadingOut&&
0===w;l=v?Math.floor(127*l)|w<<7:w?255:0;l|=l<<24|l<<16|l<<8}else l=0;for(const [C,A]of r.iconVertexRanges)for(w=C;w<C+A;w+=4)z.iconOpacity[w/4]=l;r.selectedForRendering?(l=t.parts[1],t=l.startOpacity,l=l.targetOpacity,q.allSymbolsFadingOut=q.allSymbolsFadingOut&&0===l,t=v?Math.floor(127*t)|l<<7:l?255:0,l=t<<24|t<<16|t<<8|t):l=0;for(const [C,A]of r.textVertexRanges)for(t=C;t<C+A;t+=4)z.textOpacity[t/4]=l}z.lastOpacityUpdate=u;z.opacityChanged=!0}}}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(g){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=g};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../tiling/TileKey ../../../../chunks/mat3f32 ../DisplayObject".split(" "),
function(a,g,b,p,f,k,c){b=function(d){function e(n,q,u,v=u){var t=d.call(this)||this;t.triangleCountReportedInDebug=0;t.transforms={dvs:k.create(),tileMat3:k.create()};t.triangleCount=0;t.key=new f(n);t.bounds=q;t.size=u;t.coordRange=v;return t}g._inheritsLoose(e,d);var h=e.prototype;h.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};h.setTransform=function(n,q){q/=n.resolution*n.pixelRatio;const u=this.transforms.tileMat3,[v,t]=n.toScreenNoRotation([0,0],this.coords);
p.set(u,this.size[0]/this.coordRange[0]*q,0,0,0,this.size[1]/this.coordRange[1]*q,0,v,t,1);p.multiply(this.transforms.dvs,n.displayViewMat3,u)};g._createClass(e,[{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(n){this._coords=[n[0],n[3]];this._bounds=n}}]);return e}(c.DisplayObject);a.TiledDisplayObject=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/has","../../../core/promiseUtils","../../../core/Evented"],function(a,g,b,p,f){const k=1/b("mapview-transitions-duration");b=function(c){function d(){var h=c.apply(this,arguments)||this;h._fadeOutResolver=null;h._fadeInResolver=null;h._clips=null;h.computedVisible=!0;h.computedOpacity=1;h.fadeTransitionEnabled=!1;h.inFadeTransition=!1;h._isReady=!1;h._opacity=1;h._stage=null;h._visible=!0;return h}g._inheritsLoose(d,c);var e=d.prototype;e.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;
this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=p.createResolver();this.requestRender();return this._fadeInResolver.promise};e.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=p.createResolver();this.requestRender();return this._fadeOutResolver.promise};
e.beforeRender=function(h){this.updateTransitionProperties(h.deltaTime,h.state.scale)};e.afterRender=function(h){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};e.remove=function(){var h;null==(h=this.parent)?void 0:h.removeChild(this)};e.setTransform=function(h){};e.processRender=function(h){this.stage&&this.computedVisible&&this.doRender(h)};
e.requestRender=function(){this.stage&&this.stage.requestRender()};e.processDetach=function(){this.onDetach();this.emit("detach")};e.updateTransitionProperties=function(h,n){if(this.fadeTransitionEnabled){n=this._fadeOutResolver||!this.visible?0:this.opacity;const q=this.computedOpacity;q===n?this.computedVisible=this.visible:(h*=k,this.computedOpacity=q>n?Math.max(n,q-h):Math.min(n,q+h),this.computedVisible=0<this.computedOpacity,h=n===this.computedOpacity,this.inFadeTransition=!h,h||this.requestRender())}else this.computedOpacity=
this.opacity,this.computedVisible=this.visible};e.onAttach=function(){};e.onDetach=function(){};e.doRender=function(h){};e.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};g._createClass(d,[{key:"clips",get:function(){return this._clips},set:function(h){this._clips=h;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(h){this._opacity!==h&&(this._opacity=Math.min(1,
Math.max(h,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(h){if(this._stage!==h){var n=this._stage;(this._stage=h)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):n.trashDisplayObject(this)}}},{key:"visible",get:function(){return this._visible},set:function(h){this._visible!==h&&(this._visible=h,this.requestRender())}}]);return d}(f);a.DisplayObject=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/RasterTile":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../core/maybe","../../webgl/rasterUtils"],function(a,g,b){const p={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};return function(){function f(c,d,e=null,h=null){this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=this._transformGrid=
null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=c;this.source=d;this.width=e||d.width;this.height=h||d.height}var k=f.prototype;k.bind=function(c){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(c,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(c),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=b.createTransformTexture(c,this.transformGrid)));return!0};
k.getUniforms=function(){const c=b.getBasicGridUniforms(this.scale,this.offset),{symbolizerParameters:d,transformGrid:e,width:h,height:n,opacity:q}=this,u=b.getCommonUniforms(e,[h,n],[this.source.width,this.source.height],q),v=d.colormap?b.getColormapUniforms(d.colormap,d.colormapOffset):null,t="stretch"===this.symbolizerParameters.type?b.getStretchUniforms(this.symbolizerParameters):null,l="hillshade"===this.symbolizerParameters.type?b.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:c,
common:u,colormap:v,stretch:t,hillshade:l}};k.getTextures=function(){if(!this._rasterTexture)return null;const c=[],d=[];this._transformGridTexture&&(d.push(this._transformGridTexture),c.push("u_transformGrid"));this._rasterTexture&&(d.push(this._rasterTexture),c.push("u_image"));this._colormapTexture&&(d.push(this._colormapTexture),c.push("u_colormap"));return{names:c,textures:d}};k.getMemoryUsage=function(){if(g.isNone(this._memoryUsed)){const c=this.getTextures();if(null==c)return 0;this._memoryUsed=
c.textures.map(d=>d.descriptor.width*d.descriptor.height*4).reduce((d,e)=>d+e)}return this._memoryUsed};k.release=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);this.rawPixelData=this.transformGrid=this.source=null;return!0};k._updateRasterTexture=function(c,d){const e=this.source?
this.source.extractBands(d):null;if(e&&e.pixels&&0<e.pixels.length){d=g.isNone(d)&&g.isNone(this.bandIds)||g.isSome(d)&&g.isSome(this.bandIds)&&d.join("")===this.bandIds.join("");if(this._rasterTexture){if(d)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=b.createRasterTexture(c,e,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};k._updateColormapTexture=function(c){const d=this._colormap,e=this.symbolizerParameters.colormap;
if(!e)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!d)this._colormapTexture=b.createColormapTexture(c,e),this._colormap=e;else if(e.length!==d.length||e.some((h,n)=>h!==d[n]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=b.createColormapTexture(c,e),this._colormap=e};a._createClass(f,[{key:"source",get:function(){return this._source},set:function(c){this._source=c;this._rasterTexture&&
(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||p},set:function(c){this._symbolizerParameters=c}},{key:"bandIds",get:function(){return this._bandIds},set:function(c){g.isSome(c)&&0<c.length?this._bandIds&&c.every((d,e)=>this._bandIds[e]?d===this._bandIds[e]:!1)||(this._bandIds=c,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation},set:function(c){this._interpolation=
c;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===c?9729:9728)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(c){this._transformGrid=c;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}}]);return f}()})},"esri/views/webgl/rasterUtils":function(){define("exports ./Program ./BufferObject ./Texture ./VertexArrayObject ./Renderbuffer ./FramebufferObject ./ProgramCache ./RenderingContext ./ShaderCompiler".split(" "),
function(a,g,b,p,f,k,c,d,e,h){a.createColormapTexture=function(n,q){return new p(n,{width:q.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},q)};a.createFrameBuffer=function(n,q,u,v){v=new p(n,{width:q,height:u,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:v?5121:5126,wrapMode:33071,flipped:!1});return new c(n,{colorTarget:0,depthStencilTarget:3,width:q,height:u},v)};a.createRasterTexture=function(n,
q,u="nearest",v=!1){var t,l=!(v&&"u8"===q.pixelType);v=l?5126:5121;l=null==q.pixels||0===q.pixels.length?null:l?q.getAsRGBAFloat():q.getAsRGBA();const w=null==(t=n.capabilities.textureFloat)?void 0:t.textureFloatLinear;q={width:q.width,height:q.height,target:3553,pixelFormat:6408,internalFormat:n.isWebGL2Context()?34836:6408,samplingMode:!w||"bilinear"!==u&&"cubic"!==u?9728:9729,dataType:v,wrapMode:33071,flipped:!1};return new p(n,q,l)};a.createTransformTexture=function(n,q){var u=4*q.size[0],v=q.size[1];
const t={width:u,height:v,target:3553,pixelFormat:6408,internalFormat:n.isWebGL2Context()?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1};u=new Float32Array(u*v*4);v=0;for(let l=0;l<q.coefficients.length;l++)u[v++]=q.coefficients[l],2===l%3&&(u[v++]=1);return new p(n,t,u)};a.getBasicGridUniforms=function(n,q){return{u_scale:n,u_offset:q}};a.getColormapUniforms=function(n,q){return{u_colormapOffset:q||0,u_colormapMaxIndex:n?n.length/4-1:null}};a.getCommonUniforms=function(n,q,
u,v=1,t=!0,l=!1){return{u_flipY:t,u_isFloatTexture:l,u_applyTransform:n?!0:!1,u_opacity:v,u_transformSpacing:n?n.spacing:null,u_transformGridSize:n?n.size:null,u_targetImageSize:q,u_srcImageSize:u}};a.getShadedReliefUniforms=function(n){return{u_hillshadeType:n.hillshadeType,u_sinZcosAs:n.sinZcosAs,u_sinZsinAs:n.sinZsinAs,u_cosZs:n.cosZs,u_weights:n.weights,u_factor:n.factor,u_minValue:n.minValue,u_maxValue:n.maxValue}};a.getStretchUniforms=function(n){return{u_bandCount:n.bandCount,u_minOutput:n.outMin,
u_maxOutput:n.outMax,u_minCutOff:n.minCutOff,u_maxCutOff:n.maxCutOff,u_factor:n.factor,u_useGamma:n.useGamma,u_gamma:n.gamma,u_gammaCorrection:n.gammaCorrection}};a.getUniformLocationInfos=function(n,q){n=n.gl;q=q.glName;const u=n.getProgramParameter(q,n.ACTIVE_UNIFORMS),v=new Map;let t;for(let l=0;l<u;l++)(t=n.getActiveUniform(q,l))&&v.set(t.name,{location:n.getUniformLocation(q,t.name),info:t});return v};a.setTextures=function(n,q,u,v){u.length===v.length&&(v.some(t=>null==t)||u.some(t=>null==t)||
u.forEach((t,l)=>{q.setUniform1i(t,l);n.bindTexture(v[l],l)}))};a.setUniforms=function(n,q,u){Object.keys(u).forEach(v=>{var t=q.get(v)||q.get(v+"[0]");if(t){var l=u[v];if(null!==t&&null!=l)switch({info:t}=t,t.type){case 5126:1<t.size?n.setUniform1fv(v,l):n.setUniform1f(v,l);break;case 35664:n.setUniform2fv(v,l);break;case 35665:n.setUniform3fv(v,l);break;case 35666:n.setUniform4fv(v,l);break;case 35675:n.setUniformMatrix3fv(v,l);break;case 35676:n.setUniformMatrix4fv(v,l);break;case 5124:1<t.size?
n.setUniform1iv(v,l):n.setUniform1i(v,l);break;case 35670:n.setUniform1i(v,l?1:0);break;case 35667:case 35671:n.setUniform2iv(v,l);break;case 35668:case 35672:n.setUniform3iv(v,l);break;case 35669:case 35673:n.setUniform4iv(v,l)}}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3f64 ./vec3 ../geometry/support/aaBoundingRect ../views/3d/terrain/TilingScheme ../views/3d/terrain/TerrainConst".split(" "),function(a,
g,b,p,f,k,c){function d(l,w,y=0){l=l.extent;return 0===y?f.containsPoint(l,w):f.containsPointWithMargin(l,w,y*Math.min(l[2]-l[0],l[3]-l[1]))}function e(l,w,y,D){p.copy(q,y);q[D]=w[D];D=p.subtract(q,q,w);var z=p.subtract(u,l,w);z=p.dot(z,D);const r=p.dot(D,D);w=0>=z?w:r<=z?y:p.add(q,w,p.scale(D,D,z/r));l=p.subtract(q,l,w);return Math.PI/2-Math.atan(l[2]/Math.sqrt(l[0]*l[0]+l[1]*l[1]))}function h(l,w){var y=l.elevationBounds;l=l.extent;y=.5*(y.min+y.max);v[0]=l[0];v[1]=l[1];v[2]=y;t[0]=l[2];t[1]=l[3];
t[2]=y;l=y=Infinity;w[0]<v[0]?y=e(w,v,t,0):w[0]>t[0]&&(y=e(w,t,v,0));w[1]<v[1]?l=e(w,v,t,1):w[1]>t[1]&&(l=e(w,t,v,1));return Math.min(y,l)}function n(l,w,y){if(l.spatialReference.isGeographic)return new g("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var D=k.checkUnsupported(l);if(D)return D;{var z=l.lods;D=z[0].resolution*2**z[0].level;var r=[D*l.size[0],D*l.size[1]];const C=[l.origin.x,l.origin.y];y=f.fromExtent(y);const A=f.create();k.computeRowColExtent(y,
r,C,A);r=(A[2]-A[0])*(A[3]-A[1]);r>c.MAX_ROOT_TILES?(z=z[0].scale*2**z[0].level,D=Math.max((y[3]-y[1])/l.size[1],(y[2]-y[0])/l.size[0])*z/D,y=Math.floor(Math.log(D)/Math.log(10)),D=Math.ceil(D/10**y)*10**y,D=new g("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(z).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+D.toLocaleString()+".",{level0Scale:z,suggestedLevel0Scale:D,requiredNumRootTiles:r,allowedNumRootTiles:c.MAX_ROOT_TILES})):
D=null}return D?D:w&&!l.spatialReference.equals(w)?new g("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}const q=b.create(),u=b.create(),v=b.create(),t=b.create();b=Object.freeze({__proto__:null,isInsideExtent:d,tiltOnEdge:e,tiltToExtentEdge:h,checkIfTileInfoSupportedForViewSR:n});a.checkIfTileInfoSupportedForViewSR=n;a.isInsideExtent=d;a.terrainUtilsPlanar=b;a.tiltOnEdge=e;a.tiltToExtentEdge=h})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports",
"../core/Error","../geometry/support/spatialReferenceUtils","../geometry/projection","../views/3d/terrain/TilingScheme"],function(a,g,b,p,f){function k(){return!0}function c(){return 0}function d(h,n){const q=h.lods.length-1,u=h.spatialReference,v=p.canProjectToWGS84ComparableLonLat(u)||b.isMars(u)||b.isMoon(u);if(u.isWebMercator){if(!f.makeWebMercatorAuxiliarySphere(q).compatibleWith(h))return new g("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(v){if(!f.makeGCSWithTileSize(h.spatialReference,
h.size[0],q).compatibleWith(h))return h.spatialReference.isWGS84?new g("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new g("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new g("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(n&&!h.spatialReference.equals(n))return new g("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}var e=Object.freeze({__proto__:null,isInsideExtent:k,tiltToExtentEdge:c,checkIfTileInfoSupportedForViewSR:d});a.checkIfTileInfoSupportedForViewSR=d;a.isInsideExtent=k;a.terrainUtilsSpherical=e;a.tiltToExtentEdge=c})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function g(p){this._texture=p;this._refCount=1}var b=g.prototype;b.retain=function(){++this._refCount};
b.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};b.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(g,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return g}()})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/maybe","../layers/support/MemoryManagedLayerView","../terrain/terrainUtils","./LayerPerformanceInfo"],function(a,g,b,p){return function(f){this.usedMemory=
this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var k=f.resourceController.memoryController;this.totalMemory=1048576*k.maxMemory;this.usedMemory=Math.round(k.usedMemory*this.totalMemory);this.quality=k.memoryFactor;this.load=f.resourceController.scheduler.load;this.terrainMemory=f.basemapTerrain?f.basemapTerrain.getUsedMemory():0;k=f._stage&&f._stage.renderView&&f._stage.renderView.edgeView;this.edgesMemory=a.isSome(k)?k.usedMemory:0;
f.allLayerViews.items.forEach(c=>{(g.isMemoryManagedLayerView(c)||b.isSurfaceLayerView(c))&&this.layerPerformanceInfos.push(new p(c,f))});this.layerPerformanceInfos.sort((c,d)=>d.memory-c.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,g){return function(b,p){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=
b.layer;this.memory=g.isSurfaceLayerView(b)?p.basemapTerrain.getUsedMemoryForLayerView(b):b.getUsedMemory();a.isPerformanceInfoLayerView(b)&&(b=b.performanceInfo,this.displayedNumberOfFeatures=b.displayedNumberOfFeatures,this.maximumNumberOfFeatures=b.maximumNumberOfFeatures,this.totalNumberOfFeatures=b.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(g){return"performanceInfo"in g};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../webgl-engine/lib/screenSizePerspectiveUtils ./TextureCollection".split(" "),function(a,g,b,p,f,k){let c=function(){function e(n){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=n.viewState;this.view=n.view;this.pointsOfInterest=
n.pointsOfInterest;this.objectResourceCache=n.objectResourceCache;this.streamDataRequester=n.resourceController.createStreamDataRequester(4);this.textures=new k.TextureCollection(this.streamDataRequester,n.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},n.resourceController.scheduler);const q=p.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=f.getSettings(n.viewingMode,q);this.screenSizePerspectiveSettingsLabels=f.getLabelSettings(n.viewingMode,
q)}var h=e.prototype;h.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};h.addGraphicsOwner=function(n){if(!n)return{remove(){}};this.graphicsOwners.push(n);const q="layer"in n?n.watch("layer.screenSizePerspectiveEnabled",()=>this.updateScreenSizePerspectiveEnabled()):null;this.updateScreenSizePerspectiveEnabled();return{remove:()=>{q&&(q.remove(),g.removeUnordered(this.graphicsOwners,n),this.updateScreenSizePerspectiveEnabled())}}};h.updateScreenSizePerspectiveEnabled=
function(){var n=this.graphicsOwners.some(q=>!0===q.get("layer.screenSizePerspectiveEnabled"));n&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new b,n=()=>this.updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",n,!0),this.viewState.events.on("camera-projection-changed",n)]),this.updateScreenSizePerspectiveSettings()):!n&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),
this.screenSizePerspectiveHandles=null)};h.updateScreenSizePerspectiveSettings=function(){d.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;d.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(d);this.screenSizePerspectiveSettingsLabels.update(d);this.view._stage.renderView.setNeedsRender()};return e}();const d={distance:0,fovY:0};a.SharedSymbolResources=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/urlUtils ../../../core/promiseUtils ../../support/Scheduler ../webgl-engine/lib/WebGLDriverTest ../webgl-engine/lib/Texture".split(" "),
function(a,g,b,p,f,k,c,d){let e=function(){function h(q,u,v,t){this._streamDataRequester=q;this._stage=u;this._textureOptions=v;this._textureRequests=new Map;this._frameTask=b.isSome(t)?t.registerTask(k.Task.TEXTURE_UNLOAD,l=>this._frameTask.processQueue(l),()=>!1):k.ImmediateTask}var n=h.prototype;n.destroy=function(){this._frameTask.remove();this._textureRequests.forEach(q=>this.releaseTextureRequest(q));this._textureRequests.clear()};n.fromUrl=async function(q,u,v){f.throwIfAborted(v);const t=
b.isSome(v)&&v.signal,l=this.makeUid(q,u);let w=this._textureRequests.get(l);if(!w){v=f.createAbortController();const y=this._streamDataRequester.request(q,"image",{uid:l,signal:v.signal});w={referenceCount:0,texture:null,textureAsync:null,abortController:v};this._textureRequests.set(l,w);w.textureAsync=y.then(D=>{D=this.createTexture(q,D,u);w.texture=D;w.abortController=null;this.addToStage(D);return{uid:l,texture:D}},D=>{w.abortController=null;throw D;})}w.referenceCount++;return(new Promise((y,
D)=>{f.onAbort(t,()=>{D(f.createAbortError())});w.textureAsync.then(y,D)})).catch(y=>{this.release(l);throw y;})};n.fromData=function(q,u){q=this.makeUid(q);let v=this._textureRequests.get(q);v||(v={referenceCount:0,texture:u(),textureAsync:null,abortController:null},this.addToStage(v.texture),this._textureRequests.set(q,v));v.referenceCount++;return{uid:q,texture:v.texture}};n.release=function(q){if(this._textureRequests){var u=this._textureRequests.get(q);u?(1>u.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+
q),u.referenceCount--,1>u.referenceCount&&this._frameTask.schedule(()=>this.releaseNow(q))):console.warn(`TextureCollection: texture doesn't exist: '${q}'`)}};n.releaseNow=function(q){if(this._textureRequests){var u=this._textureRequests.get(q);!u||0<u.referenceCount||(this.releaseTextureRequest(u),this._textureRequests.delete(q))}};n.releaseTextureRequest=function(q){q.texture?this.removeFromStage(q.texture):q.abortController&&(q.abortController.abort(),q.abortController=null)};n.createTexture=function(q,
u,v){const t={...this._textureOptions,powerOfTwoResizeMode:2};if(p.isSVG(q)){if(v||0===u.width&&0===u.height)q=u.width?u.height/u.width:1,v=v||64,1<q?(u.width=Math.round(v/q),u.height=v):(u.width=v,u.height=Math.round(v*q));this._stage.renderView&&c.testWebGLDriver(this._stage.renderView.renderingContext).svgAlwaysPremultipliesAlpha&&(t.preMultiplyAlpha=!1)}t.width=u.width;t.height=u.height;return new d.Texture(u,t)};n.addToStage=function(q){this._stage.add(q)};n.removeFromStage=function(q){this._stage.remove(q)};
n.makeUid=function(q,u){return null!=u?`${q}.${u}px`:q};g._createClass(h,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return h}();a.TextureCollection=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../core/watchUtils ../../../support/Scheduler ../../../../chunks/ray ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/Intersector ../debugFlags ../PropertiesPool ../debugUtils ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K){a.PointsOfInterest=function(X){function aa(H){H=X.call(this,H)||this;H._handles=new w;H._tmpRay=z.create();H._centerRayDirty=!0;H._surfaceAltitudeAtCenter=0;H._surfaceAltitudeAtCenterDirty=!0;H._contentAltitudeAtCenter=0;H._contentAltitudeAtCenterDirty=!0;H._propertiesPool=new x.PropertiesPool({renderPointOfView:J},g._assertThisInitialized(H));H.renderPointOfView=t.create();H._pois=[];H._debugCenters=new Map;return H}g._inheritsLoose(aa,
X);var S=aa.prototype;S.initialize=function(){var H;const {state:R,basemapTerrain:T,renderCoordsHelper:W,map:Y}=this.view;this._surfaceIntersector=new C.Intersector(R.mode);this._surfaceIntersector.options.backfacesTerrain=R.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._contentIntersector=new C.Intersector(R.mode);var U=()=>this._estimateSurfaceAltitudeAtCenter();const N=this.view.resourceController.scheduler,ca=f.unwrap(null==(H=this.view.basemapTerrain)?void 0:H.elevationQueryCache);
H={state:R,scheduler:N,surface:T,renderCoordsHelper:W};this._set("centerOnSurfaceInfrequent",new E["default"]({...H,task:D.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:U}));this._set("centerOnSurfaceFrequent",new E["default"]({...H,task:D.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:U}));this._set("centerOnContent",new E["default"]({...H,task:D.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",
new B["default"]({...H,cache:ca,task:D.Task.POINT_OF_INTEREST_INFREQUENT,map:Y}));this._set("contentCameraOnSurface",new B["default"]({...H,cache:ca,task:D.Task.POINT_OF_INTEREST_INFREQUENT,map:Y,cameraName:"contentCamera"}));this._set("surfaceGeometryUpdates",new K["default"]({...H,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new F.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:W}));
this._set("surfaceOrigin",new I.StableSurfaceCenter({cache:ca,view:this.view}));this._set("focus",new G["default"]({state:R,surface:T,renderCoordsHelper:W,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(O,V)=>this._estimateSurfaceIntersectionAtRenderPoint(O,V)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);U=this.view.graphics;this._debugCenters.set(this.centerOnContent,
new m.GraphicsHandle(U,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new m.GraphicsHandle(U,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new m.GraphicsHandle(U,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new m.GraphicsHandle(U,"blue","CameraOfInterestOnSurface"));this._debugCenters.set(this.focus,new m.GraphicsHandle(U,"green","Focus"));this._handles.add([R.watch("camera",O=>this._cameraChanged(O),!0),T.watch("extent",
()=>this._updateCenterPointsOfInterest()),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),y.init(A,"SHOW_POI",O=>this._setDebug(O))]);this._cameraChanged(this.view.state.camera);for(const O of this._pois)O.update()};S.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const H of this._pois)H.destroy();this.surfaceOrigin.destroy()};
S._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const H=this.centerRay;if(f.isNone(H))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(H,this._contentIntersector,L,Q)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(L):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};S._estimateSurfaceAltitudeAtCenter=
function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const H=this.centerRay;if(f.isNone(H))return this._surfaceAltitudeAtCenter;const R=H.origin,T=l.add(L,H.origin,H.direction);this._surfaceIntersector.resetWithRay(H);this._surfaceIntersector.intersect(null,null,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,R,T);this._surfaceIntersector.results.min.getIntersectionPoint(L)&&
(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(L));return this._surfaceAltitudeAtCenter};S._estimateSurfaceIntersectionAtRenderPoint=function(H,R){H=z.fromRenderAtEye(this.view.state.camera,H,P);if(f.isNone(H))return null;const T=H.origin,W=l.add(L,H.origin,H.direction);this._surfaceIntersector.resetWithRay(H);this._surfaceIntersector.intersect(null,null,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,T,W);return this._surfaceIntersector.results.min.getIntersectionPoint(R)?
R:null};S._cameraChanged=function(H){this._updateCenterPointsOfInterest();H=H.eye;l.exactEquals(this.renderPointOfView,H)||this._set("renderPointOfView",l.copy(this._propertiesPool.get("renderPointOfView"),H))};S._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const H of this._pois)H.updateRenderLocation()};S._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};
S._setDebug=function(H){if(H)for(const R of this._pois)this._handles.add(y.init(R,"renderLocation",T=>this._debugCenters.get(R).showPoint(T,R.renderCoordsHelper.spatialReference)),"debug");else this._debugCenters.forEach(R=>R.remove()),this._handles.remove("debug")};g._createClass(aa,[{key:"updating",get:function(){var H;return!!(null!=(H=this.surfaceGeometryUpdates)&&H.updating||this._pois.some(R=>R.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,
this._tmpRay),this._centerRayDirty=!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.update();for(const H of this._pois)H.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return aa}(v);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,
"centerOnSurfaceInfrequent",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCameraOnSurface",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",
void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);b.__decorate([d.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([h.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const J=
Array,L=t.create(),P=z.create(),Q={exclude:new Set([r.TERRAIN_ID])};a.default=a.PointsOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../core/maybe ../../../geometry/Point ../../../geometry ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../symbols/PointSymbol3D ../../../symbols ../../../Graphic".split(" "),function(a,g,b,p,f,k,c,d,e){p=function(){function h(q,u,v=""){this.graphics=q;this._symbol=
new c({symbolLayers:[new f({material:{color:u},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new k({text:v,halo:{color:"white",size:1/.75},material:{color:u},size:12})]})}var n=h.prototype;n.showPoint=function(q,u){g.isNone(u)||(this.remove(),q=new b({x:q[0],y:q[1],z:q[2],spatialReference:u}),this._graphic=new e({geometry:q,symbol:this._symbol}),this.graphics.add(this._graphic))};n.remove=function(){g.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=
null)};return h}();a.GraphicsHandle=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../geometry/Point ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/watchUtils ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=Array;a.CameraOnSurface=function(A){function x(B){B=A.call(this,B)||this;B._dirty=!1;B._propertiesPool=new D.PropertiesPool({location:v,renderLocation:r},g._assertThisInitialized(B));B._estimatedSurfaceAltitude=0;B._pendingElevationQueryController=null;B.cameraName="camera";B.renderLocation=t.create();B.tmpPoint=new v;return B}g._inheritsLoose(x,A);var m=x.prototype;m.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
()=>this._update(),()=>this._needsUpdate()));this._update();if(this.map){const B=()=>this._setDirty();this.handles.add(w.on(this.map,"ground.layers","change",B,B,B))}};m.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};m.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};m.update=function(){this._update();this._updateRenderLocation()};m._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
m._needsUpdate=function(){return!this._pendingElevationQueryController&&this._dirty};m._cancelPendingRequest=function(){const B=this._pendingElevationQueryController;B&&(this._pendingElevationQueryController=null,B.abort(),this.notifyChange("updating"))};m._update=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var B=u.createAbortController();
this.map.ground.queryElevation(this.tmpPoint,{signal:B.signal,cache:this.cache}).then(E=>this._updateSurfaceAltitude(E.geometry.z)).catch(E=>{u.isAbortError(E)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===B&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));B=null});this._pendingElevationQueryController=B}else this._updateSurfaceAltitude(0)};m._updateSurfaceAltitude=function(B){this._estimatedSurfaceAltitude!==B&&(this._estimatedSurfaceAltitude=
B,this._updateRenderLocation())};m._updateRenderLocation=function(){l.copy(C,this._camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,C);l.exactEquals(this._get("renderLocation"),C)||this._set("renderLocation",l.copy(this._propertiesPool.get("renderLocation"),C))};g._createClass(x,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const B=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,
B,this.state.spatialReference);return B}},{key:"scale",get:function(){const B=this._camera,E=l.distance(B.eye,this.renderLocation);return y.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:B}},E,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}}]);return x}(z.PointOfInterest);b.__decorate([c.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([c.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"cache",void 0);b.__decorate([c.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([c.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);b.__decorate([c.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);b.__decorate([c.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([c.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([c.property({readOnly:!0})],
a.CameraOnSurface.prototype,"scale",null);b.__decorate([c.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const C=t.create();a.default=a.CameraOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){a.PointOfInterest=function(t){function l(w){w=t.call(this,w)||this;w.handles=new v;return w}g._inheritsLoose(l,t);l.prototype.destroy=function(){this.handles.destroy()};return l}(u);b.__decorate([c.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([c.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([c.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);
a.PointOfInterest=b.__decorate([e.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);a.default=a.PointOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../geometry/Point ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=Array;a.CenterOnSurface=function(x){function m(E){E=x.call(this,E)||this;E._propertiesPool=new D.PropertiesPool({location:u,renderLocation:r},g._assertThisInitialized(E));E._currentSurfaceAltitude=0;E._latestSurfaceAltitude=0;E.distance=0;E.renderLocation=t.create();E.updating=!1;return E}g._inheritsLoose(m,x);var B=m.prototype;B.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,()=>this._measureSurfaceAltitude(),
()=>this.updating);this._measureSurfaceAltitude()};B.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._propertiesPool.destroy();this._propertiesPool=null};B.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};B.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};B._measureSurfaceAltitude=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();
this._set("updating",!1)};B._updateRenderLocation=function(){const E=C;var F=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,E),G=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!F&&G&&(F=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,E))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=A;F&&this.latestSurfaceAltitudeChangesDistanceSignificantly(E,G)&&(l.copy(E,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?(F=l.distance(this.state.camera.eye,
E),F!==this._get("distance")&&this._set("distance",F)):(F=this.state.camera,l.scale(E,F.viewForward,this._get("distance")),l.add(E,E,F.eye));l.exactEquals(this._get("renderLocation"),E)||this._set("renderLocation",l.copy(this._propertiesPool.get("renderLocation"),E))};B.calculateSurfaceIntersection=function(E,F){var G=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,E,F))return!1;if(this.state.isGlobal){const I=w.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;
E=I+E;const K=l.squaredLength(G.eye),J=K<E*E,L=l.distance(G.eye,F);J&&L>I/4&&(l.scale(F,G.viewForward,E-Math.sqrt(K)),l.add(F,F,G.eye))}else if(G=this.surface.ready&&this.surface.extent)F[0]=v.clamp(F[0],G[0],G[2]),F[1]=v.clamp(F[1],G[1],G[3]);return!0};B.latestSurfaceAltitudeChangesDistanceSignificantly=function(E,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==E)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){const G=this.state.camera.eye;E=
l.distance(G,E);F=l.distance(G,F);if(y.TESTS_DISABLE_UPDATE_THRESHOLDS||.05<Math.abs(F-E)/E)return!0}return!1};g._createClass(m,[{key:"location",get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}}]);return m}(z.PointOfInterest);b.__decorate([c.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",
void 0);b.__decorate([c.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([c.property({readOnly:!0})],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([c.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);b.__decorate([c.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([c.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([c.property({readOnly:!0})],
a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([e.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const C=t.create(),A=t.create();a.default=a.CenterOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],function(a,g,b){let p=function(){function k(d){this.handles=new b;this.events=new g;this.contentLayerViews=
d.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",e=>this.layerViewsChanged(e)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var c=k.prototype;c.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};c.layerViewsChanged=function(d){d.added.forEach(e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",()=>this.contentChanged()),
e.uid)});d.removed.forEach(e=>this.handles.remove(e.uid))};c.contentChanged=function(){this.events.emit("request-update",f)};return k}();const f={};a.ContentGeometryUpdates=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../geometry/Point ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=Array;a.Focus=function(m){function B(F){F=m.call(this,F)||this;F._propertiesPool=new D.PropertiesPool({location:u,renderLocation:r},g._assertThisInitialized(F));return F}g._inheritsLoose(B,m);var E=B.prototype;E.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};E.calculateScreenHorizontalEdgeOnSurface=function(F){const G=this.state.camera;var I=G.getRenderCenter(t.createRenderScreenPointArray3());I[1]=G.aboveGround?
G.padding[2]:G.fullHeight-G.padding[0];if(this.estimateSurfaceIntersectionAtRenderPoint(I,F))return F;const K=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(G.unprojectFromRenderScreen(I,A)&&(w.subtract(A,A,G.eye),I=w.normalize(A,A),this.renderCoordsHelper.intersectManifold(y.ray.wrap(G.eye,I),K,F)))return F;w.copy(F,G.eye);this.renderCoordsHelper.setAltitude(K,F);return F};E.update=function(){};E.updateRenderLocation=function(){};g._createClass(B,[{key:"location",get:function(){const F=
this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"renderLocation",get:function(){var F=this.centerOnSurface.renderLocation,G=this.renderCoordsHelper;const I=this.calculateScreenHorizontalEdgeOnSurface(x);var K=this.state.camera;G.worldUpAtPosition(F,C);K=Math.max(0,(Math.acos(w.dot(C,K.viewForward))-.5*Math.PI)*(K.aboveGround?1:-1));G=this._propertiesPool.get("renderLocation");Number.isNaN(K)?w.copy(G,
F):(K=1-v.clamp(K/(.5*Math.PI),0,1),w.lerp(G,F,I,K*K*K));return(F=this._get("renderLocation"))&&w.equals(F,G)?F:G}}]);return B}(z.PointOfInterest);b.__decorate([c.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([c.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);b.__decorate([c.property({readOnly:!0})],a.Focus.prototype,"location",null);b.__decorate([c.property({readOnly:!0})],a.Focus.prototype,"renderLocation",
null);b.__decorate([c.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],a.Focus.prototype,"updating",void 0);a.Focus=b.__decorate([e.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const C=l.create(),A=l.create(),x=l.create();a.default=a.Focus;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/Point ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){a.StableSurfaceCenter=function(z){function r(A){A=z.call(this,A)||this;A.location=null;A._updateController=null;A._handles=new w;return A}g._inheritsLoose(r,z);var C=r.prototype;C.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),y.on(this,"surface.layers","change",()=>this._update())]),this._update())};C.destroy=function(){this._handles.destroy()};
C._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var A=D.center(this.surfaceView.extent);A=new t({x:A[0],y:A[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=u.createAbortController(),this.surface.queryElevation(A,{noDataValue:0,signal:this._updateController.signal,
cache:this.cache}).then(x=>{this._updateController=null;this._set("location",x.geometry)}).catch(x=>{u.isAbortError(x)||x&&"elevation-query:invalid-layer"===x.name||console.error("StableSurfaceCenter failed to update: ",x)})):this._set("location",A)}else this._set("location",null)};g._createClass(r,[{key:"renderLocation",get:function(){if(!this.location)return null;const A=l.create();this.view.renderCoordsHelper.toRenderCoords(this.location,A);return A}}]);return r}(v);b.__decorate([c.property({constructOnly:!0})],
a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([c.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);b.__decorate([c.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);b.__decorate([c.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);b.__decorate([c.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([c.property({readOnly:!0})],
a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){a.SurfaceGeometryUpdates=function(A){function x(){var B=A.apply(this,arguments)||this;B.handles=new l;B._tileGeometryUpdateExtent=w.empty();B._tileGeometryUpdateSpatialReference=null;B.events=new v;B.updating=!1;return B}g._inheritsLoose(x,A);var m=x.prototype;m.initialize=function(){this.handles.add([this.surface.on("elevation-change",B=>this._tileGeometryChanged(B)),this.scheduler.registerTask(y.Task.SURFACE_GEOMETRY_UPDATES,()=>this.update(),()=>this.updating)])};
m.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};m.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",D),w.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};m._tileGeometryChanged=function(B){this._tileGeometryUpdateSpatialReference=B.spatialReference;w.expand(this._tileGeometryUpdateExtent,B.tile.extent);this._set("updating",!0)};m._furthestCenterOnSurface=
function(){let B=this.centerOnSurfaces[0];for(let E=1;E<this.centerOnSurfaces.length;E++){const F=this.centerOnSurfaces[E];F.distance>B.distance&&(B=F)}return B};m._centerIntersectsExtent=function(B,E){const F=this.state.camera.eye,G=C,I=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(F,z,E);this.renderCoordsHelper.fromRenderCoords(I.renderLocation,r,E);z[0]<r[0]?(G[0]=z[0],G[2]=r[0]):(G[0]=r[0],G[2]=z[0]);z[1]<r[1]?(G[1]=z[1],G[3]=r[1]):(G[1]=r[1],G[3]=z[1]);return w.intersects(G,
B)};return x}(u);b.__decorate([c.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,
"surface",void 0);b.__decorate([c.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([e.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const D={},z=t.create(),r=t.create(),C=w.empty();a.default=a.SurfaceGeometryUpdates;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/aliasOf ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/ObjectPool ../../../core/arrayUtils ../../../core/PooledArray ../../../core/promiseUtils ../../../core/Accessor ../../../core/Evented ../../../core/mathUtils ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/CollectionFlattener ../../../geometry/projectionEllipsoid ../../../core/watchUtils ../../../chunks/mat4 ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../chunks/mat4f64 ../../../chunks/vec4f64 ../../../layers/support/LercDecoder ../../../layers/support/layerUtils ./TerrainConst ../support/geometryUtils ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../../2d/engine/vectorTiles/VectorTile ./terrainUtils ../../../layers/support/ElevationQueryTileCache ../layers/ElevationLayerView3D ./ElevationBounds ./ElevationData ./OverlayManager ./tileUtils ./TilePerLayerInfo ./Tile ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./UpsampleInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha){function na(Oa,Va){return Oa[0]===Va[0]&&Oa[1]===Va[1]&&Oa[2]===Va[2]}function da(Oa){return Oa.isLeaf?!1:Oa.children[0].shouldLoad||Oa.children[1].shouldLoad||Oa.children[2].shouldLoad||Oa.children[3].shouldLoad||da(Oa.children[0])||da(Oa.children[1])||da(Oa.children[2])||da(Oa.children[3])}const oa=k.getLogger("esri.views.3d.terrain.TerrainSurface");p=function(Oa){function Va(wa){var Ea=
Oa.call(this,wa)||this;Ea._elevationBounds=new ca.ElevationBounds;Ea._rootExtent=I.create();Ea._iteratorPool=new t(ba.IteratorPreorder,Pa=>Pa.remove=()=>Ea._iteratorPool.release(Pa));Ea._postorderIterator=new ba.IteratorPostorder;Ea.pendingUpdates=!1;Ea._asyncWorkItems=0;Ea._allTilesDirty=!0;Ea._allTilesSorted=!0;Ea._visible=!1;Ea._usedMemory=-1;Ea._performanceInfo=new ka;Ea._viewChanged=!1;Ea._inFrameTask=!1;Ea._viewChangeUpdateDirty=!1;Ea._overlayOpacity=1;Ea._eyePosRenderSR=A.create();Ea._eyePosSurfaceSR=
A.create();Ea._splitLimits=new ia.SplitLimits;Ea._snapLevel=Infinity;Ea._frustum=S.frustum.create();Ea._viewProjectionMatrix=L.create();Ea._layerViews=[[],[]];Ea._layerIndexByUid=[new Map,new Map];Ea._basemapLayerViewHandles=new Map;Ea._handles=new m;Ea._allTiles=new w;Ea._upsampleInfoPool=new t(ha.UpsampleInfo);Ea._getElevationData={spatialReference:null,rootTiles:null};Ea.maxTextureScale=1.2;Ea.rootTiles=null;Ea.backgroundImage=aa.DEFAULT_TILE_BACKGROUND;Ea.backgroundColor=null;Ea._layerViewsDirty=
!1;return Ea}g._inheritsLoose(Va,Oa);var Ka=Va.prototype;Ka.initialize=function(){this._stage=this.view._stage;this._lercDecoder=Q.acquireDecoder(this.view.resourceController.scheduler);this._tilePool="planar"===this.manifold?new t(ma.PlanarPatch):new t(ea.SphericalPatch);var wa=this.view.resourceController.memoryController;this._upsampleMapCache=wa.getMemCache("esri.views.3d.terrain.upsample",Ea=>Ea.unloadMapData());this._elevationQueryCache=new U.ElevationQueryTileCache(wa.getMemCache("elevation-query"));
this._set("overlayManager",new V.OverlayManager({surface:this}));this._handles.add([this.watch("overlayManager.hasHighlights",Ea=>this._renderer.setNeedsHighlight(Ea)),this.watch("overlayManager.rendersOccluded",Ea=>this._renderer.setRenderOccludedOverlay(Ea))],"overlayManager");this._renderer=new la({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:E.getReferenceEllipsoid(this.view.spatialReference).radius});this._renderer.install(this.view._stage);this._handles.add([F.init(this,
"baseOpacity",Ea=>{this._handleLayerViewChanges();this._updateBaseOpacity(Ea)},!0),F.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",Ea=>{this._renderer.pointsOfInterest=Ea;this._handles.remove("poi");Ea&&this._handles.add(Ea.focus.watch("renderLocation",()=>this._allTilesSorted=!1),"poi")}),F.init(R,"TERRAIN_TILE_TREE_SHOW_TILES",Ea=>{Ea&&!this._treeDebugger?(new Promise(function(Pa,ja){a(["../layers/support/TerrainTileTree3DDebugger"],
Pa,ja)})).then(({TerrainTileTree3DDebugger:Pa})=>{!this._treeDebugger&&R.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Pa({view:this.view}))}):Ea||!this._treeDebugger||R.TERRAIN_TILE_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)})]);this.extentHelper=M.create(this.manifold,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference});this._handles.add(F.init(this.extentHelper,"stencilEnabledExtents",Ea=>this._renderer.setStencilEnabledLayerExtents(Ea)),
"extentHelper");wa=this.view.defaultsFromMap?new B({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:Ea=>Ea.layers}):this.view.map.allLayers;wa=new Z({layers:wa,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",wa);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingSchemeAndExtent(),!0),this.tilingSchemeLogic.watch("extent",()=>
this._updateTilingSchemeAndExtent(),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._frameTask=this.view.resourceController.scheduler.registerTask(J.Task.TERRAIN_SURFACE,Ea=>this._update(Ea),()=>this.updating&&this.ready&&!this.suspended);this.view.resourceController.memoryController.events.on("quality-changed",()=>
this._viewChangeUpdate());this._handles.add([this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this._viewChangeUpdate()),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),F.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",Ea=>this._renderer.textureFadingEnabled=0<Ea),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),this.view.watch("clippingArea",
()=>this._clippingChanged())]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};Ka.destroy=function(){this._frameTask.remove();this._handles.destroy();Q.releaseDecoder(this._lercDecoder);this._lercDecoder=null;this._removeAllTiles();this._upsampleMapCache=f.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=f.destroyMaybe(this._elevationQueryCache);
this._set("tilingSchemeLogic",f.destroyMaybe(this.tilingSchemeLogic));this.extentHelper=f.destroyMaybe(this.extentHelper);this._basemapLayerViewHandles.forEach((wa,Ea)=>this._unregisterTiledLayerView(Ea));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",f.destroyMaybe(this.overlayManager));this._tilePool=f.destroyMaybe(this._tilePool);ia["default"].prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer.uninstall(this._stage);
this._renderer=f.destroyMaybe(this._renderer);this._iteratorPool=f.destroyMaybe(this._iteratorPool);this._set("view",null);this._stage=null;this._upsampleInfoPool=f.destroyMaybe(this._upsampleInfoPool);W.printAllocations();fa.printAllocations()};Ka.intersect=function(wa,Ea,Pa,ja){this._renderer.intersect(wa,Ea,Pa,ja)};Ka.getElevation=function(wa,Ea,Pa,ja){const Ya=this._getElevationData.rootTiles;if(!Ya||!Ya.length||0===Ya[0].layerInfo[0].length)return null;const ab=qa;ab[0]=wa;ab[1]=Ea;ab[2]=Pa;
if(!K.projectVectorToVector(ab,ja,ab,this._getElevationData.spatialReference))return oa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var cb of Ya)if(cb.containsPoint(ab)){for(;cb&&!cb.rendered&&!cb.isLeaf;)wa=0,ab[0]>.5*(cb.extent[0]+cb.extent[2])&&(wa+=1),ab[1]<.5*(cb.extent[1]+cb.extent[3])&&(wa+=2),cb=cb.children[wa];if(cb=(cb=cb.renderData)&&cb.geometryState?cb.geometryState.samplerData:null)return O.ElevationData.sample(ab[0],
ab[1],cb);break}return null};Ka.getScale=function(wa){if(this.tilingScheme){if(!K.projectPointToVector(wa,qa,this.spatialReference))return oa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(wa=this.rootTiles)for(let Ea of wa)if(Ea.containsPoint(qa)){for(;null!=Ea.children[0];)wa=0,qa[0]>Ea.children[0].extent[2]&&(wa+=1),qa[1]<Ea.children[0].extent[1]&&(wa+=2),Ea=Ea.children[wa];return this._getLodBiasCorrectedScale(Ea.level)}}return 1E100};
Ka.queryVisibleScaleRange=function(wa,Ea,Pa,ja){Ea=Ea?this.tilingScheme.levelAtScale(Ea):0;Pa=Pa?this.tilingScheme.levelAtScale(Pa):Infinity;const Ya=this.lodBias;this._renderer.queryVisibleLevelRange(wa,Ea+Ya,Pa+Ya,ja)};Ka._updateBaseOpacity=function(wa){const Ea=this._renderer.opaque;this._renderer.opaque=1<=wa;this._renderer.isTransparent=this._allTransparentSurfaceLayers();if(wa=Ea!==this._renderer.opaque){var Pa;null==(Pa=this._stage)?void 0:Pa.renderView.setRenderParameters({opaqueTerrain:this.opaque})}this._updateTileTextures(wa)};
Ka._updateTilingSchemeAndExtent=function(){var wa=this.tilingSchemeLogic.extent;const Ea=wa&&!I.equals(wa,this._dataExtent);Ea&&(f.isSome(this._dataExtent)?I.set(this._dataExtent,wa):this._dataExtent=I.create(wa));wa=this.tilingSchemeLogic.tilingScheme;const Pa=wa!==this.tilingScheme;Pa&&(Y.weakAssert(!!wa,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",wa),this._updateClippingExtent(),wa&&(this._updateTiledLayers(),this._renderer.setTileSize(wa.pixelSize),
this.overlayManager.setSpatialReference(wa.spatialReference,"spherical"===this.manifold)));(Ea||Pa)&&this._updateRootTiles()};Ka._acquireTile=function(wa,Ea,Pa,ja){const Ya=this._tilePool.acquire();Ca[0]=wa;Ca[1]=Ea;Ca[2]=Pa;Ya.init(Ca,ja,this);return Ya};Ka._updateRootTiles=function(){var wa=this._clippingExtent||this._dataExtent;const Ea=this.tilingScheme;if(!f.isNone(wa)&&Ea){var Pa=ua,ja=Ea.rootTilesInExtent(wa,Pa,5*aa.MAX_ROOT_TILES),Ya=ab=>{ab=this._acquireTile(0,ab[1],ab[2],null);2===ab.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.lodSnapping)&&ab.setPendingUpdate(2);this._loadTile(ab);return ab};if(this.rootTiles){if(ja.length>aa.MAX_ROOT_TILES){oa.warn(aa.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}wa=this.rootTiles.map(cb=>cb.lij);const ab=l.difference(wa,ja,na);if(0<ab.removed.length||0<ab.added.length){const cb=this.rootTiles.filter(lb=>-1<ab.removed.findIndex(na.bind(null,lb.lij))?(this._purgeTile(lb),!1):!0);ab.added.forEach(lb=>cb.push(Ya(lb)));this._setRootTiles(cb)}}else ja.length>aa.MAX_ROOT_TILES&&
(oa.warn(aa.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),ja=Ea.rootTilesInExtent(wa,Pa,aa.MAX_ROOT_TILES)),this._setRootTiles(ja.map(ab=>Ya(ab)));I.equals(Pa,this._rootExtent)||(this._rootExtent=I.create(Pa),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};Ka._setRootTiles=function(wa){this._set("rootTiles",wa);this._allTiles.clear();if(wa){const Ea=this._iteratorPool.acquire();for(Ea.reset(wa);!Ea.done;)this._allTiles.push(Ea.next());
Ea.remove()}this._getElevationData.rootTiles=wa;this._renderer.setRootTiles(this.rootTiles);this._updateTileVisibility(wa)};Ka._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Ka._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),
this._updateTileVisibility(this.rootTiles)))};Ka._updateClippingStatus=function(wa){wa.updateClippingStatus(this._clippingExtent)&&wa.resetPendingUpdate(32)&&this._updateTileGeometry(wa)};Ka._updateTileVisibility=function(wa){if(wa){var Ea=this._iteratorPool.acquire();Ea.reset(wa);if(ba.hasLoadableSiblings(wa)){wa=this._elevationBounds.min;var Pa=this._elevationBounds.max}else wa=Infinity,Pa=-Infinity;for(;!Ea.done;){const ja=Ea.next();this._updateClippingStatus(ja);ja.updateVisibility();ja.setPendingUpdate(16);
ja.loadable?(ja.updateScreenDepth(this._viewProjectionMatrix),ja.renderData&&(wa=Math.min(ja.elevationBounds[0],wa),Pa=Math.max(ja.elevationBounds[1],Pa))):Ea.skipSubtree()}Ea.remove();this._allTilesDirty=this._viewChanged=!0;isFinite(wa)&&isFinite(Pa)&&(this._elevationBounds.min!==wa||this._elevationBounds.max!==Pa)&&(this._elevationBounds.min=wa,this._elevationBounds.max=Pa,this.emit("elevation-bounds-change",null))}};Ka._updateViewDependentParameters=function(){const wa=this.view.state.camera,
Ea=this.view.state.contentCamera,Pa=Math.tan(.5*Ea.fovX),ja=Math.tan(.5*Ea.fovY),Ya=this.tilingScheme.pixelSize,ab=2**-this.lodBias*wa.pixelRatio;this._splitLimits.aboveGround=wa.aboveGround;this._splitLimits.fovX=Pa;this._splitLimits.fovY=ja;this._splitLimits.relativeWidthLimit=Ya/wa.width*this.maxTextureScale*ab;this._splitLimits.relativeHeightLimit=Ya/wa.height*this.maxTextureScale*ab;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;
this.view.state.fixedContentCamera?(f.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=S.frustum.create()),S.frustum.copy(Ea.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null;S.frustum.copy(wa.frustum,this._frustum);G.multiply(this._viewProjectionMatrix,Ea.projectionMatrix,Ea.viewMatrix);x.copy(this._eyePosRenderSR,Ea.eye);K.projectVectorToVector(wa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Ka._updateSkirts=function(){const wa=
this.view.state.camera;this.skirtScale=Y.computeSkirtScale(this,this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?0:1.11*wa.near)};Ka._updateRenderData=function(wa){wa.rendered&&!wa.shouldLoad&&(da(wa)?this._loadChildren(wa):wa.isLeaf&&wa.parent&&wa.parent.shouldLoad&&this._loadParent(wa))};Ka._updateTileGeometry=function(wa){wa.updateVisibility();this._renderer.updateTileGeometry(wa);this._elevationUpdate(wa);this._usedMemory=-1};Ka._elevationUpdate=function(wa){Ha.spatialReference=
this.spatialReference;Ha.tile=wa;Ha.extent=wa.extent;this.emit("elevation-change",Ha);I.containsPoint(wa.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};Ka._update=function(wa){this._handleLayerViewChanges(wa);this._frameTask.processQueue(wa);this._inFrameTask=!0;this.pendingUpdates=!1;this._updateTileStatus(wa);this._sortTiles(wa);this._mergeAndSplit(wa);wa.run(()=>this._updateElevation(wa));wa.run(()=>this._updateTextures(wa));this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();wa.done&&
(this.pendingUpdates=!0)};Ka._updateTileStatus=function(wa){if(this._viewChanged&&this.rootTiles&&!wa.done){this._viewChanged=!1;var Ea=this._iteratorPool.acquire();for(Ea.reset(this.rootTiles);!Ea.done;){var Pa=Ea.next();if(Pa.loadable){var ja=Pa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===ja){Pa.resetPendingUpdate(8);Pa.isLeaf&&(Pa.setPendingUpdate(2),Ea.skipSubtree());continue}Pa.resetPendingUpdate(2)&&Pa.updateAgentSuspension();4===ja&&Pa.updateAgents(0)}Ea.skipSubtree();
if(!Pa.isLeaf){Pa.setPendingUpdate(8);Pa.resetPendingUpdate(2);ja=this._iteratorPool.acquire();ja.resetOne(Pa);for(Pa=ja.next();!ja.done;Pa=ja.next())this._updateClippingStatus(Pa),Pa.updateVisibility(),Pa.loadable&&Pa.updateScreenDepth(this._viewProjectionMatrix);ja.remove()}}Ea.remove();this.pendingUpdates=!0;wa.madeProgress()}};Ka._sortTiles=function(wa){wa.done||this._allTilesSorted||(ba.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&
this._treeDebugger.update(),wa.madeProgress())};Ka._mergeAndSplit=function(wa){if(!this.suspended&&this._allTilesDirty&&!wa.done){this._allTilesDirty=!1;this.pendingUpdates=!0;for(var Ea=0;!wa.done;){let Pa=!1;Ea=0;const ja=!this._allTiles.some(Ya=>{Ea+=Ya.usedMemory;Ya.resetPendingUpdate(8)?(this._mergeTile(Ya),Pa=!0,wa.madeProgress()):Ya.resetPendingUpdate(2)&&(this._splitTile(Ya),Pa=!0,wa.madeProgress());Ya.resetPendingUpdate(16)&&(this._updateRenderData(Ya),wa.madeProgress());return wa.done});
Pa&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(ja){if(this._usedMemory=Ea,!Pa)break}else this._allTilesDirty=!0}0===Ea&&(this._allTilesDirty=!0);this._sortTiles(wa)}};Ka._updateElevation=function(wa){this._allTiles.some(Ea=>{Ea.resetPendingUpdate(32)&&(this._updateTileGeometry(Ea),wa.madeProgress());return wa.done});return wa.hasProgressed};Ka._updateTextures=function(wa){this._allTiles.some(Ea=>{Ea.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(Ea),this._usedMemory=-1,wa.madeProgress());
return wa.done});return wa.hasProgressed};Ka._updateClippingExtent=function(){if(!this.spatialReference)return!1;const wa=I.create();let Ea=null;T.toBoundingRect(this.view.clippingArea,wa,this.spatialReference)&&(Ea=wa);if(I.equals(Ea,this._clippingExtent))return!1;this._clippingExtent=Ea;this._renderer.clippingExtent=Ea;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};Ka._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};
Ka._getLodBiasCorrectedScale=function(wa){const Ea=this.tilingScheme.levels;wa=r.clamp(wa-this.lodBias,0,Ea.length-1);const Pa=wa-Math.floor(wa);return Ea[Math.floor(wa)].scale*(1-Pa)+Ea[Math.ceil(wa)].scale*Pa};Ka._removeAllTiles=function(){this.rootTiles&&(this.rootTiles.forEach(wa=>this._purgeTile(wa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Ka._purgeChildTiles=function(wa){if(wa.isLeaf)return!1;let Ea=this._purgeTile(wa.children[0]);Ea=this._purgeTile(wa.children[1])||
Ea;Ea=this._purgeTile(wa.children[2])||Ea;Ea=this._purgeTile(wa.children[3])||Ea;wa.unsetChildren();return Ea};Ka._purgeTile=function(wa){const Ea=this._purgeChildTiles(wa)||wa.rendered;this._allTiles.removeUnordered(wa);wa.unload(this._renderer);this._tilePool.release(wa);return Ea};Ka._splitTile=function(wa){Y.weakAssert(wa.isLeaf,"tile that is already split should not be split again!");const Ea=wa.level+1,Pa=2*wa.lij[1],ja=2*wa.lij[2];wa.setChildren(this._createTile(Ea,Pa,ja,wa),this._createTile(Ea,
Pa,ja+1,wa),this._createTile(Ea,Pa+1,ja,wa),this._createTile(Ea,Pa+1,ja+1,wa));wa.setPendingUpdate(16);wa.updateAgentSuspension();this._allTiles.pushArray(wa.children);this._allTilesDirty=!0;this._emitTileScaleChange(wa,Ea);++this._performanceInfo.numSplit};Ka._emitTileScaleChange=function(wa,Ea=wa.level){Na.spatialReference=this.spatialReference;Na.extent=wa.extent;Na.scale=this._getLodBiasCorrectedScale(Ea);this.emit("scale-change",Na)};Ka._createTile=function(wa,Ea,Pa,ja){Y.weakAssert(!!ja,"_createTile sanity check");
wa=this._acquireTile(wa,Ea,Pa,ja);wa.updateClippingStatus(this._clippingExtent);wa.loadable&&(wa.updateScreenDepth(this._viewProjectionMatrix),2===wa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&wa.setPendingUpdate(2));return wa};Ka._mergeTile=function(wa){Y.weakAssert(!wa.hasPendingUpdate(2),"_mergeTile sanity check");this._purgeChildTiles(wa)&&(Y.weakAssert(!wa.renderData,"_mergeTile sanity check"),this._loadTile(wa));this._allTilesDirty=!0;++this._performanceInfo.numMerged;
this._emitTileScaleChange(wa)};Ka._loadChildren=function(wa){Y.weakAssert(wa.rendered,"parent should be rendered");wa.unload(this._renderer);this._loadTile(wa.children[0]);this._loadTile(wa.children[1]);this._loadTile(wa.children[2]);this._loadTile(wa.children[3])};Ka._loadParent=function(wa){wa=wa.parent;this._unloadChildren(wa);this._loadTile(wa)};Ka._unloadChildren=function(wa){wa.isLeaf||(this._unloadChildren(wa.children[0]),wa.children[0].unload(this._renderer),this._unloadChildren(wa.children[1]),
wa.children[1].unload(this._renderer),this._unloadChildren(wa.children[2]),wa.children[2].unload(this._renderer),this._unloadChildren(wa.children[3]),wa.children[3].unload(this._renderer))};Ka._loadTile=function(wa){wa.load(this._renderer);wa.setPendingUpdate(16);this.pendingUpdates=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(wa);this._elevationUpdate(wa)};Ka._elevationDataArrived=function(wa,Ea,Pa){Pa=new O.ElevationData(wa.lij,wa.extent,Pa);wa.dataArrived(Ea,
0,Pa);Pa=[wa];wa=wa.level;const ja=this._iteratorPool.acquire();for(ja.reset(Pa);!ja.done;){const Ya=ja.next();Ya.findElevationBoundsForLayer(Ea,wa);Ya.computeElevationBounds()}ja.remove();this._updateTileVisibility(Pa)};Ka._handleLayerViewChanges=function(wa=J.noBudget){if(this._layerViewsDirty){var Ea=this._layerViewsDirty=!1,Pa=new Set,ja=-1;for(const ab of this.view.allLayerViews.items)if(Pa.add(ab.uid),Y.isSurfaceLayerView(ab))if(this._basemapLayerViewHandles.has(ab.uid)){var Ya=this.layerClassFromLayerView(ab);
Ya=this._layerIndexByUid[Ya].get(ab.uid);Ya<ja&&(Ea=!0);ja=Ya}else this._registerTiledLayerView(ab),ab.layer.loaded&&(Ea=!0);this._basemapLayerViewHandles.forEach((ab,cb)=>{Pa.has(cb)||(this._unregisterTiledLayerView(cb),Ea=!0)});Ea&&this._updateTiledLayers();this._renderer.isTransparent=this._allTransparentSurfaceLayers();wa.madeProgress()}};Ka._allTransparentSurfaceLayers=function(){let wa=0===this.view.map.ground.opacity;for(const Ea of this.view.allLayerViews.items)if(Y.isSurfaceLayerView(Ea)&&
!Y.isElevationLayerView(Ea)&&!X.isBaseLayer(Ea.layer)&&0!==Ea.fullOpacity){wa=!1;break}return wa};Ka.layerClassFromLayerView=function(wa){return Y.isElevationLayerView(wa)?0:1};Ka._registerTiledLayerView=function(wa){const Ea=[],Pa=this.layerClassFromLayerView(wa);Ea.push(wa.watch("suspended",()=>this._updateTiledLayers()));Ea.push(wa.watch("fullOpacity",()=>this._updateTileTextures(!1)));Ea.push(wa.layer.watch("scaleRangeId",()=>this._restartAllAgents(Pa)));wa.on("data-changed",()=>{const ja=this._layerIndexByUid[Pa].get(wa.uid);
null!=ja&&this._invalidateLayerData(ja,Pa)});this._basemapLayerViewHandles.set(wa.uid,Ea)};Ka._unregisterTiledLayerView=function(wa){const Ea=this._basemapLayerViewHandles.get(wa);if(Ea){for(let Pa=0;Pa<Ea.length;Pa++)Ea[Pa].remove();this._basemapLayerViewHandles.delete(wa)}};Ka._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var wa=this.view.allLayerViews,Ea=[[],[]],Pa=null,ja=I.empty();wa.forEach(ab=>{var cb=ab.layer;if(cb&&!ab.suspended&&Y.isSurfaceLayerView(ab)){var lb=
ab.fullExtent;lb?this.tilingScheme.compatibleWith(ab.tileInfo)?(I.expand(ja,lb),cb=this.layerClassFromLayerView(ab),1===cb&&(lb=ab.displayLevelRange,Infinity!==lb.maxLevel&&(null===Pa||lb.maxLevel>Pa)&&(Pa=lb.maxLevel)),Ea[cb].push(ab)):oa.warn("Terrain: tiling scheme of layer "+cb.id+" is incompatible with other tiled layers, will not be drawn"):oa.warn("Terrain: Map or elevation layer does not have fullExtent: "+cb.id)}});for(const ab of aa.LayerClasses){var Ya=this._layerViews[ab];wa=Ea[ab];wa.reverse();
const cb=wa.length;let lb=Ya.length!==cb;const Xa=Array(cb),ta=Array(Ya.length);this._layerIndexByUid[ab].clear();for(let Ba=0;Ba<cb;Ba++){this._layerIndexByUid[ab].set(wa[Ba].uid,Ba);const va=Ya.indexOf(wa[Ba]);Xa[Ba]=va;Ba!==va&&(lb=!0);-1<va&&(ta[va]=Ba)}if(lb){Ya=this._postorderIterator;for(Ya.reset(this.rootTiles);!Ya.done;)Ya.next().modifyLayers(ta,Xa,ab);this._layerViews[ab]=wa;this._restartAllAgents(ab);this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Pa)&&this._viewChangeUpdate()}};
Ka._restartAllAgents=function(wa){const Ea=this._postorderIterator;for(Ea.reset(this.rootTiles);!Ea.done;){const Pa=Ea.next();Pa.restartAgents(wa);0===wa&&Pa.computeElevationBounds()}};Ka._hasFixedExtent=function(){return!!this._clippingExtent};Ka.layerViewByIndex=function(wa,Ea){return this._layerViews[Ea][wa]};Ka.numLayers=function(wa){return this._layerViews[wa].length};Ka._updateTileTextures=function(wa){this._allTiles.forAll(Ea=>{Ea.updateAgents(1);wa?this.renderer.updateTileTexture(Ea):Ea.updateRenderData(1)});
this._renderer.isTransparent=this._allTransparentSurfaceLayers()};Ka._invalidateLayerData=function(wa,Ea){this._allTiles.forAll(Pa=>Pa.removeLayerAgent(wa,Ea));this._allTiles.forAll(Pa=>Pa.invalidateLayerData(wa,Ea))};Ka.setTileTreeDirty=function(){this._allTilesDirty=!0};Ka.requestRender=function(wa=1){this.renderer.setNeedsRender(wa)};Ka.requestTileData=function(wa,Ea,Pa,ja){const Ya=this.layerViewByIndex(Ea,Pa);Ea=Ya.layer;if(!Ea.tilemapCache||Y.isVectorTileLayerView(Ya))return this._requestTileData(wa,
Pa,Ya,ja);++this._asyncWorkItems;return Ea.tilemapCache.fetchAvailability(wa.lij[0],wa.lij[1],wa.lij[2],{...ja,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(ab=>{--this._asyncWorkItems;y.isAbortError(ab)||this._dataMissing(wa,Pa,Ya,{notInTilemap:!0});throw ab;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(wa,Pa,Ya,ja),ja.signal))};Ka._requestTileData=function(wa,Ea,Pa,ja){return 0===Ea?this._requestElevationTileData(wa,Pa,ja):this._requestMapTileData(wa,Pa,ja)};Ka._requestElevationTileData=
function(wa,Ea,Pa){if(Y.isElevationLayerView(Ea)){var ja=cb=>{--this._asyncWorkItems;if(!y.isAborted(Pa)){var lb=this._layerIndexByUid[0].get(Ea.uid);null==lb?oa.warn("TerrainSurface: received data from unknown layer %d %s",0,wa.lij.toString()):(this._usedMemory=-1,this.pendingUpdates=!0,this._elevationDataArrived(wa,lb,cb))}},Ya=cb=>{--this._asyncWorkItems;y.isAbortError(cb)||(this._dataMissing(wa,0,Ea,cb),this.pendingUpdates=!0)};++this._asyncWorkItems;if(Y.useFetchTileForLayer(Ea.layer))return Ea.layer.fetchTile(wa.lij[0],
wa.lij[1],wa.lij[2],{noDataValue:aa.ELEVATION_NODATA_VALUE,signal:Pa.signal}).then(cb=>{y.isAborted(Pa)?(oa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Ya(y.createAbortError())):this._frameTask.schedule(()=>ja(cb),Pa.signal)},Ya);var ab=Ea.getTileUrl(wa.lij[0],wa.lij[1],wa.lij[2]);return this._elevationDataRequester.request(ab,"binary",Pa).then(cb=>this._lercDecoder.decode(cb,{noDataValue:aa.ELEVATION_NODATA_VALUE},
Pa.signal)).then(cb=>{ja({values:cb.pixelData,width:cb.width,height:cb.height,noDataValue:cb.noDataValue,minValue:cb.minValue,maxValue:cb.maxValue})},Ya)}Y.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};Ka._requestMapTileData=function(wa,Ea,Pa){if(Ea instanceof N)return Promise.reject();++this._asyncWorkItems;const ja=cb=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.pendingUpdates=!0;y.isAborted(Pa)?Y.releaseTileData(cb):this._mapTileDataArrived(wa,
Ea,cb)},Pa.signal).catch(lb=>Ya(lb,cb)),Ya=(cb,lb=null)=>this._frameTask.schedule(()=>{--this._asyncWorkItems;Y.releaseTileData(lb);y.isAborted(Pa)||(this._dataMissing(wa,1,Ea,cb),this.pendingUpdates=!0)});if(Y.isVectorTileLayerView(Ea)){var ab=Ea.schemaHelper.getLevelRowColumn(wa.lij);return Ea.tileHandler.getVectorTile(ab[0],ab[1],ab[2],Pa).then(ja,Ya)}if(Y.isImageryTileLayerView(Ea))return Ea.fetchTile(wa.lij[0],wa.lij[1],wa.lij[2],Pa).then(ja,Ya);if(Y.useFetchTileForLayer(Ea.layer)&&Y.isTileLayerView(Ea))return Ea.layer.fetchTile(wa.lij[0],
wa.lij[1],wa.lij[2],Pa).then(cb=>{y.isAborted(Pa)?(oa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Ya(y.createAbortError())):ja(cb)},Ya);ab=Ea.getTileUrl(wa.lij[0],wa.lij[1],wa.lij[2]);null!=Ea.refreshInterval&&Ea.refreshTimestamp&&(ab+=`${-1<ab.indexOf("?")?"\x26":"?"}_ts=${Ea.refreshTimestamp}`);return this._mapDataRequester.request(ab,Ea.hasMixedImageFormats?"image+type":"image",Pa).then(ja,Ya)};Ka._mapTileDataArrived=
function(wa,Ea,Pa){Ea=this._layerIndexByUid[1].get(Ea.uid);null!=Ea?wa.dataArrived(Ea,1,Pa):(Y.releaseTileData(Pa),oa.warn("TerrainSurface: received data from unknown layer"))};Ka._dataMissing=function(wa,Ea,Pa,ja){Pa=this._layerIndexByUid[Ea].get(Pa.uid);null!=Pa?wa.dataMissing(Pa,Ea,ja):oa.warn("TerrainSurface: received data from unknown layer")};Ka.updateTileOverlayParams=function(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(wa=>{wa.renderData&&this.overlayManager.setTileParameters(wa)}),
this._renderer.setNeedsRender())};Ka.updateOverlayOpacity=function(){if(this.overlayManager){var wa=this.overlayManager.computeOpacity(this._eyePosSurfaceSR[2]);wa!==this._overlayOpacity&&(this._overlayOpacity=wa,this._renderer.overlayOpacity=wa,this._renderer.setNeedsRender())}};Ka.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(wa=>this._usedMemory+=wa.usedMemory));return this._usedMemory};Ka.getUsedMemoryForLayerView=function(wa){let Ea=
0;const Pa=this.layerClassFromLayerView(wa),ja=this._layerIndexByUid[Pa].get(wa.uid);this._allTiles.forAll(Ya=>Ea+=Ya.getUsedMemoryForLayer(Pa,ja));return Ea};Ka.getTile=function(wa){if(f.isNone(wa))return null;const Ea=wa.split("/").map(ab=>+ab);if(0===Ea[0])return this.rootTiles.find(ab=>ab.lij[1]===Ea[1]&&ab.lij[2]===Ea[2]);wa=2**Ea[0];const Pa=Math.floor(Ea[1]/wa),ja=Math.floor(Ea[2]/wa);let Ya;this.rootTiles.some(ab=>ab.lij[1]===Pa&&ab.lij[2]===ja?(Ya=ab,!0):!1);if(Ya){for(wa=1<<Ea[0]-1;Ya.lij[0]<
Ea[0];){let ab=Ea[1]&wa?2:0;0<(Ea[2]&wa)&&ab++;if(!Ya.children[ab])return null;Ya=Ya.children[ab];wa>>=1}Y.weakAssert(Ya.lij[0]===Ea[0]&&Ya.lij[1]===Ea[1]&&Ya.lij[2]===Ea[2],"not the right tile?");return Ya}return null};g._createClass(Va,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){var wa,Ea,Pa=null==(wa=this.view.pointsOfInterest)?void 0:null==(Ea=wa.contentCameraOnSurface)?void 0:Ea.scale;Pa&&(wa=this.view.state.contentCamera,
wa=H.directionToHeadingTilt(this.view,wa.eye,wa.viewForward,wa.up).tilt,90<wa&&(wa=180-wa),wa=2*(wa/90)**2,Pa=H.scaleToZoom(this.view,Pa)-wa,.25<Math.abs(this._snapLevel-Pa)&&(Math.round(Pa)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Pa));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",
get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"extent",get:function(){return f.unwrapOr(this._clippingExtent,this._rootExtent)}},{key:"updating",get:function(){return!!((this.pendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||
this.overlayManager.updating||this._frameTask.updating)}},{key:"ready",get:function(){return!!this.rootTiles}},{key:"renderOrder",set:function(wa){this._renderer.renderOrder=wa;this._set("renderOrder",wa)}},{key:"skirtScale",get:function(){return this._renderer.skirtScale},set:function(wa){this._renderer.skirtScale=wa}},{key:"spatialReference",get:function(){const wa=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=wa}},{key:"_background",
get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(wa){var Ea;this._renderer.slicePlane=wa;this._set("slicePlaneEnabled",wa);null==(Ea=this._stage)?void 0:Ea.renderView.setRenderParameters({opaqueTerrain:this.opaque})}},{key:"velvetOverground",set:function(wa){wa!==this.velvetOverground&&(this._renderer.velvetOverground=wa);this._set("velvetOverground",wa)}},{key:"visible",set:function(wa){wa!==this._visible&&(this._visible=
wa,this._renderer.setVisibility(wa),this.suspended=!wa)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(wa){this._set("suspended",wa);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*aa.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const wa=this._performanceInfo;
wa.numNodes=this._allTiles.length;wa.numLeaves=wa.numVisible=wa.numRendered=wa.numLoadedPerLevel.length=wa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ea=>{Ea.isLeaf&&wa.numLeaves++;const Pa=Ea.level;Ea.renderData&&(wa.numLoadedPerLevel[Pa]=(wa.numLoadedPerLevel[Pa]||0)+1);Ea.visible&&(wa.numVisible++,Ea.rendered&&(wa.numRenderedPerLevel[Pa]=(wa.numRenderedPerLevel[Pa]||0)+1,wa.numRendered++))});return wa}},{key:"test",get:function(){const wa=this;return{renderer:wa._renderer,lercDecoder:wa._lercDecoder,
forceReload:()=>{wa._mergeTile(wa.rootTiles[0]);wa._viewChangeUpdate()},getTiles:()=>wa._allTiles.toArray(),getRenderedTiles(){Ja.clear();wa._allTiles.forAll(Ea=>{Ea.visible&&Ea.rendered&&Ja.push(Ea)});ba.sortTiles(wa.renderOrder,Ja);return Ja.toArray()}}}}]);return Va}(z.EventedMixin(D));b.__decorate([d.property()],p.prototype,"_renderer",void 0);b.__decorate([d.property()],p.prototype,"pendingUpdates",void 0);b.__decorate([d.property()],p.prototype,"_asyncWorkItems",void 0);b.__decorate([d.property()],
p.prototype,"_allTilesDirty",void 0);b.__decorate([d.property()],p.prototype,"_allTilesSorted",void 0);b.__decorate([d.property()],p.prototype,"_viewChanged",void 0);b.__decorate([d.property()],p.prototype,"_frameTask",void 0);b.__decorate([d.property({readOnly:!0})],p.prototype,"snapLevel",null);b.__decorate([d.property({readOnly:!0})],p.prototype,"lodSnapping",null);b.__decorate([d.property({constructOnly:!0})],p.prototype,"view",void 0);b.__decorate([e.aliasOf("_renderer.cullBackFaces")],p.prototype,
"cullBackFaces",void 0);b.__decorate([d.property({readOnly:!0,dependsOn:[]})],p.prototype,"extent",null);b.__decorate([d.property({readOnly:!0})],p.prototype,"updating",null);b.__decorate([d.property({aliasOf:"view.map.ground.opacity"})],p.prototype,"baseOpacity",void 0);b.__decorate([d.property({readOnly:!0})],p.prototype,"overlayManager",void 0);b.__decorate([d.property({constructOnly:!0})],p.prototype,"manifold",void 0);b.__decorate([d.property()],p.prototype,"maxTextureScale",void 0);b.__decorate([d.property({readOnly:!0})],
p.prototype,"ready",null);b.__decorate([d.property({value:1})],p.prototype,"renderOrder",null);b.__decorate([d.property({readOnly:!0})],p.prototype,"rootTiles",void 0);b.__decorate([d.property({readOnly:!0})],p.prototype,"spatialReference",null);b.__decorate([d.property()],p.prototype,"backgroundImage",void 0);b.__decorate([d.property({type:C,aliasOf:"view.map.ground.surfaceColor"})],p.prototype,"backgroundColor",void 0);b.__decorate([d.property()],p.prototype,"_background",null);b.__decorate([d.property({value:!1})],
p.prototype,"slicePlaneEnabled",null);b.__decorate([d.property({readOnly:!0})],p.prototype,"tilingScheme",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],p.prototype,"tilingSchemeLocked",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],p.prototype,"tilingSchemeDone",void 0);b.__decorate([d.property({readOnly:!0})],p.prototype,"tilingSchemeLogic",void 0);b.__decorate([d.property({value:!0})],p.prototype,"velvetOverground",
null);b.__decorate([e.aliasOf("_renderer.wireframe")],p.prototype,"wireframe",void 0);b.__decorate([d.property({value:!1})],p.prototype,"suspended",null);b.__decorate([d.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],p.prototype,"textureFadeDuration",void 0);b.__decorate([d.property()],p.prototype,"_layerViewsDirty",void 0);b.__decorate([e.aliasOf("_renderer.renderPatchBorders")],p.prototype,"renderPatchBorders",void 0);b.__decorate([e.aliasOf("_renderer.renderingDisabled")],
p.prototype,"renderingDisabled",void 0);b=p=b.__decorate([n.subclass("esri.views.3d.terrain.TerrainSurface")],p);const qa=P.create(),ua=I.create(),Ca=[0,0,0],Ja=new w,Ha={spatialReference:null,tile:null,extent:null,context:"ground"},Na={spatialReference:null,extent:null,scale:0};return b})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){let g=function(){function b(f){this.store=f}var p=b.prototype;p.destroy=function(){this.store.destroy()};p.get=function(f){return this.store.get(f)};
p.put=function(f,k){this.store.put(f,k,k.values.byteLength+256)};return b}();a.ElevationQueryTileCache=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=function(l){function w(){return l.apply(this,arguments)||this}a._inheritsLoose(w,l);w.prototype.initialize=function(){var y=this.get("view.map.allLayers");y=y&&y.includes(this.layer);var D=this.get("view.map.ground.layers");D=D&&D.includes(this.layer);y&&!D&&(y=new e("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(Promise.reject(y)));this._addTilingSchemeMatchPromise()};
return w}(v.TiledLayerView3D(u.LayerView3D(t)));g.__decorate([k.property({readOnly:!0,aliasOf:"layer.fullExtent"})],b.prototype,"fullExtent",void 0);g.__decorate([k.property()],b.prototype,"layer",void 0);g.__decorate([k.property({readOnly:!0,aliasOf:"layer.tileInfo"})],b.prototype,"tileInfo",void 0);return b=g.__decorate([d.subclass("esri.views.3d.layers.ElevationLayerView3D")],b)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){a.LayerView3D=t=>{t=function(l){function w(){var D=l.apply(this,arguments)||this;D.slicePlaneEnabled=!1;D.supportsHeightUnitConversion=!1;return D}g._inheritsLoose(w,l);var y=w.prototype;y.postscript=function(D){l.prototype.postscript.call(this,D);v.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};y._validateHeightModelInfo=async function(){var D=u.whenFalseOnce(this.view.defaultsFromMap,"isHeightModelInfoSearching");
this.handles.add(D);await D;if(D=v.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw D;};return w}(t);b.__decorate([c.property()],t.prototype,"view",void 0);b.__decorate([c.property()],t.prototype,"slicePlaneEnabled",void 0);return t=b.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../terrain/terrainUtils ./support/layerViewUpdatingProperties".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.TiledLayerView3D=w=>{w=function(y){function D(){return y.apply(this,arguments)||this}g._inheritsLoose(D,y);var z=D.prototype;z.getTileUrl=function(r,C,A){return this.layer.getTileUrl(r,C,A)};z._addTilingSchemeMatchPromise=function(){var r=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);r?this.addResolvingPromise(Promise.reject(r)):(r=v.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const C=this._getTileInfoCompatibilityError(this.tileInfo,
this.view.basemapTerrain.tilingScheme);if(C)throw C;}),this.addResolvingPromise(r))};z._getTileInfoSupportError=function(r,C){if(r=t.checkIfTileInfoSupportedForView(r,C,this.view.spatialReference,this.view.basemapTerrain.manifold)){C={layer:this.layer,error:r};switch(r.name){case "tilingscheme:local-gcs-not-supported":r=new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",C);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":r=
new h("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",C);break;default:r=new h("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",C)}return r}return null};z._getTileInfoCompatibilityError=function(r,C){return C.compatibleWith(r)?null:new h("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};z.levelRangeFromScaleRange=
function(r,C){const A={minLevel:0,maxLevel:Infinity};var x=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!x)return A;const m=x.levels[0];x=B=>{B=Math.log(m.scale/B)/Math.LN2;return 1E-9>.5-Math.abs(.5-B%1)?Math.round(B):Math.ceil(B)};null!=r&&0<r&&(A.minLevel=Math.max(0,x(r)));null!=C&&0<C&&(A.maxLevel=Math.max(0,x(C)));return A};z.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};g._createClass(D,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const r=this.tileInfo.lods;return this.levelRangeFromScaleRange(r[0].scale,r[r.length-1].scale)}},{key:"displayLevelRange",get:function(){var r=this.tileInfo.lods;r=this.levelRangeFromScaleRange(this.layer.minScale||r[0].scale,this.layer.maxScale||r[r.length-1].scale);this.layer.maxScale&&r.maxLevel++;return r}}]);return D}(w);b.__decorate([c.property({readOnly:!0})],
w.prototype,"imageFormatIsOpaque",null);b.__decorate([c.property({readOnly:!0})],w.prototype,"updating",void 0);b.__decorate([c.property(l.updatingProgress)],w.prototype,"updatingProgress",void 0);b.__decorate([c.property(l.updatingProgressValue)],w.prototype,"updatingProgressValue",void 0);b.__decorate([c.property({readOnly:!0})],w.prototype,"fullExtent",void 0);b.__decorate([c.property({readOnly:!0})],w.prototype,"isOpaque",null);b.__decorate([c.property({readOnly:!0})],w.prototype,"dataLevelRange",
null);b.__decorate([c.property({readOnly:!0})],w.prototype,"displayLevelRange",null);b.__decorate([c.property()],w.prototype,"layer",void 0);b.__decorate([c.property({readOnly:!0})],w.prototype,"tileInfo",void 0);return w=b.__decorate([e.subclass("esri.views.3d.layers.TiledLayerView3D")],w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?
this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let g=function(){function b(p=0,f=0){this.min=p;this.max=f;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(p){this.min=p.min;this.max=p.max;this.level=p.level;this.hasNoDataValues=p.hasNoDataValues};return b}();a.ElevationBounds=g;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(a,g,b,p){let f=function(){function k(d,e,h){this.samplerData=null;this.level=d[0];this.i=d[1];this.j=d[2];this.extent=e;d=h.noDataValue;const n=h.values;let q=Infinity,u=-Infinity,v=!0,t=!1;for(let l=0;l<n.length;l++){const w=n[l];w!==d?(q=w<q?w:q,u=w>u?w:u,v=!1):t=!0}v&&(u=q=0);this.samplerData={pixelData:h.values,width:h.width,height:h.height,noDataValue:d,
safeWidth:.99999999*(h.width-1),dx:(h.width-1)/(e[2]-e[0]),dy:(h.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]};this.bounds=[q,-3E38<u?u:0];this.hasNoDataValues=t}var c=k.prototype;c.release=function(){this.bounds=this.samplerData=null};c.computeMinMaxValue=function(d,e,h,n){n.min=Infinity;n.max=-Infinity;n.hasNoDataValues=!1;d-=this.level;if(0>=d)return n;var q=2**d;if(Math.floor(e/q)!==this.i||Math.floor(h/q)!==this.j)return n;var u=Infinity,v=-Infinity,t=this.samplerData.width,l=this.samplerData.pixelData,
w=.5*p.ELEVATION_NODATA_VALUE;d=(t-1)/q;h=(h-this.j*q)*d;let y=(e-this.i*q)*d;if(1>d){const r=Math.floor(h),C=Math.floor(y);var D=r+C*t;e=l[D];q=l[D+1];var z=l[D+t];D=l[D+t+1];if(e+q+z+D<w)return u=h-r,w=y-C,v=b.bilerp(e,q,z,D,u,w),t=b.bilerp(e,q,z,D,u+d,w),l=b.bilerp(e,q,z,D,u,w+d),d=b.bilerp(e,q,z,D,u+d,w+d),n.min=Math.min(v,t,l,d),n.max=Math.max(v,t,l,d),n;h=r;y=C;d=1}else h=Math.floor(h),y=Math.floor(y),d=Math.ceil(d);for(e=h;e<=h+d;e++)for(q=y;q<=y+d;q++)z=l[e+q*t],z<w?(u=Math.min(u,z),v=Math.max(v,
z)):n.hasNoDataValues=!0;n.min=u;n.max=v;return n};k.sample=function(d,e,h){for(const t of h){if(!t)continue;var n=t.safeWidth,q=t.width,u=t.pixelData;h=g.clamp(t.dy*(t.y1-e),0,n);n=g.clamp(t.dx*(d-t.x0),0,n);const l=Math.floor(h),w=Math.floor(n);var v=l*q+w;const y=v+q,D=u[v];q=u[y];v=u[v+1];u=u[y+1];if(D+q+v+u<.5*p.ELEVATION_NODATA_VALUE)return h-=l,n-=w,d=D+(v-D)*n,d+(q+(u-q)*n-d)*h}return null};return k}();a.ElevationData=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../../../core/unitUtils ../../../layers/support/timeUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ../support/geometryUtils ../webgl-engine/lib/Intersector ../state/utils/viewUtils ../support/debugFlags ../webgl-engine/lib/localOrigin ./OverlayRenderer ../support/debugUtils ../support/animationUtils ../webgl-engine/parts/requireUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H){function R(fa,ia){const ma=P.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(fa[2]-fa[0],fa[3]-fa[1],ia[2]-ia[0],ia[3]-ia[1]);for(let ea=0;4>ea;ea++)if(Math.abs(ia[ea]-fa[ea])>ma)return!0;return!1}const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let W;a.OverlayManager=function(fa){function ia(ea){ea=fa.call(this,ea)||
this;ea._handles=new r;ea._overlaySR=null;ea._renderSR=null;ea._overlaySREqualsRenderSR=!0;ea._drapeSources=new Map;ea._drapeTargets=new Set;ea._drapeSourceTypes=[0,0];ea._drapeTargetTypes=[0,0];ea._renderedAltitude=0;ea._placementDirty=!1;ea._drawTexturesDirty=!1;ea._drawTexturesAnimateDirty=!1;ea._layerViewsDirty=!0;ea._hasUnusedRenderTargets=!1;ea._isSpherical=!1;ea._longitudeCyclical=null;ea._latestOriginId=0;ea._maxResolution=p("esri-mobile")?2048:4096;ea._animationTimeLast=0;return ea}g._inheritsLoose(ia,
fa);var ma=ia.prototype;ma.initialize=function(){const ea=this.view._stage.renderView,M=this.view.state.isGlobal&&f.isSome(this._overlaySR)?A.getMetersPerUnitForSR(this._overlaySR):1,Z=this.view.resourceController.scheduler;this.renderer=new X.OverlayRenderer({renderView:ea,globalUnitScale:M,scheduler:Z});this._drapeTargetTypes[0]++;this.renderer.onHasHighlightsChanged=()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")};this.renderer.onRendersOccludedChanged=()=>{this._setDrawTexturesDirty();
this.notifyChange("rendersOccluded")};this.renderer.onContentChanged=()=>{this._setDrawTexturesDirty()};this.groundIntersector=new J.Intersector(this.view.state.mode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setOverlayPlacementDirty()),this.surface.on("elevation-change",
()=>this.setOverlayPlacementDirty()),this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),this.view.on("resize",()=>this.setOverlayPlacementDirty()),v.addFrameTask({preRender:la=>{this.renderer.commitChanges();this._updateLayerViews();this.renderer.hasOverlays&&(this._dispatchRendererUpdate(la),this._drawOverlayTextures(this.renderer.overlays));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),Z.registerTask(E.Task.OVERLAY_MANAGER,()=>this._updateOverlays(),
()=>this._needsUpdate),this.view._stage.renderView.events.on("force-camera-for-screenshot",la=>{this._updateOverlays(la);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)})]);this._updateLayerViews()};ma.destroy=function(){this._drapeSources.forEach((ea,M)=>this.unregisterDrapeSource(M));this._drapeTargets.forEach(ea=>this._unregisterDrapeTarget(ea));this._drapeTargetTypes[0]--;this._disposeOverlays();this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=
null);f.isSome(W)&&(W.remove(),W=null)};ma.setSpatialReference=function(ea,M){this._overlaySR=ea;this._longitudeCyclical=null;const Z=this.view.renderSpatialReference;if(f.isSome(ea)&&f.isSome(Z)){this._renderSR=Z;this._overlaySREqualsRenderSR=ea.equals(this._renderSR);if(this._isSpherical=M)this._longitudeCyclical=ea.isWebMercator?new z.Cyclical(-2.0037508342787E7,2.0037508342787E7):new z.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical;this.renderer&&(this.renderer.globalUnitScale=
M&&f.isSome(this._overlaySR)?A.getMetersPerUnitForSR(this._overlaySR):1)}else this._disposeOverlays()};ma.getGpuMemoryUsage=function(){return this.renderer.gpuMemoryUsage};ma._updateLayerViews=function(){if(this._layerViewsDirty){var ea=new Set;for(const M of this.view.allLayerViews.items)ea.add(M.uid),"drapeSourceType"in M&&!this._drapeSources.has(M)&&this._registerDrapeSource(M,0),"drapeTargetType"in M&&!this._drapeTargets.has(M)&&this._registerDrapeTarget(M);this._drapeSources.forEach((M,Z)=>{0!==
M||ea.has(Z.uid)||this.unregisterDrapeSource(Z)});this._drapeTargets.forEach(M=>{ea.has(M.uid)||this._unregisterDrapeTarget(M)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};ma.registerDrapeSource=function(ea){this._registerDrapeSource(ea,1)};ma._registerDrapeSource=function(ea,M){this._drapeSourceTypes[ea.drapeSourceType]++;this._drapeSources.set(ea,M);this.renderer.forEachOverlay((Z,la)=>this._updateDrapeSource(ea,la,Z));this._setOverlayContentDirty();
this.notifyChange("_needsUpdate")};ma._updateDrapeSource=function(ea,M,Z){f.isSome(ea.setDrapingExtent)&&f.isSome(this._overlaySR)&&ea.setDrapingExtent(M,Z.extent,this._overlaySR,Z.resolution,Z.renderLocalOrigin,Z.pixelRatio)};ma.unregisterDrapeSource=function(ea){this._drapeSources.has(ea)&&(this._drapeSourceTypes[ea.drapeSourceType]--,this._drapeSources.delete(ea),this._setOverlayContentDirty(),this.notifyChange("_needsUpdate"))};ma._registerDrapeTarget=function(ea){this._drapeTargets.add(ea);this._updateDrapeTarget(ea);
this._drapeTargetTypes[ea.drapeTargetType]++};ma._updateDrapeTarget=function(ea){this.renderer.forEachOverlay((M,Z)=>{var la=M.renderTargets;const ka=this.needsColorWithoutRasterImage()?la.colorWithoutRasterImage:this.hasDrapedFeatures()?la.color:null,ha=la.highlight;la=la.water;ea.setDrapingTextures(Z,M.extent,ka&&ka.valid?ka.fbo.getTexture():null,ha.valid?ha.fbo.getTexture():null,la.valid?la.fbo.getTexture():null)})};ma._unregisterDrapeTarget=function(ea){this._drapeTargets.delete(ea);this._drapeTargetTypes[ea.drapeTargetType]--};
ma._setOverlayContentDirty=function(){this.setOverlayPlacementDirty();this._setDrawTexturesDirty()};ma.setOverlayPlacementDirty=function(){this._placementDirty=!0};ma._updateOverlays=function(ea=this.view.state.camera){if(this._overlaySR){this._updateLayerViews();var M=w.nextHighestPowerOfTwo(Math.max(ea.fullWidth,ea.fullHeight)+256);var Z=Math.min(M,this._maxResolution);this._computeOverlayExtents(ea,M,ca);M=m.width(ca.inner)/m.width(ca.outer);this.renderer.ensureOverlays();ea=this._updateOverlay(0,
ca.inner,Z,1);Z=this._updateOverlay(1,ca.outer,Z,M);if(ea||Z)this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty();this._placementDirty=!1;this.surface.updateOverlayOpacity()}};ma._updateOverlay=function(ea,M,Z,la){if(f.isNone(this.renderer.overlays))return!1;const ka=this.renderer.overlays[ea];if(!R(M,ka.extent)&&Z===ka.resolution&&ka.pixelRatio===la)return!1;m.set(ka.extent,M);ka.resolution=Z;ka.pixelRatio=la;M=m.center(ka.extent);ka.renderLocalOrigin=Q.fromValues(M[0],M[1],0,`OV_${this._latestOriginId++}`);
this._drapeSources.forEach((ha,na)=>this._updateDrapeSource(na,ea,ka));return!0};ma.computeOpacity=function(ea){return this.renderer.hasOverlays?3.5*ea<this._renderedAltitude?Math.sqrt(w.clamp((ea-this._renderedAltitude/10)/(this._renderedAltitude/3.5-this._renderedAltitude/10),0,1)):1:1};ma.setTileParameters=function(ea){const M=ea.renderData.overlay;if(f.isSome(this.renderer.overlays)){const Z=this.renderer.overlays[0],la=this.renderer.overlays[1];ea=m.intersection(ea.extent,ea.surface.extent,O);
this._rectInsideRect(ea,Z.extent)?(this._setTileOverlayData(ea,0,M),this._clearTileOverlayData(1,M)):this._rectanglesOverlap(ea,Z.extent)?(this._setTileOverlayData(ea,0,M),this._setTileOverlayData(ea,1,M)):this._rectanglesOverlap(ea,la.extent)?(this._clearTileOverlayData(0,M),this._setTileOverlayData(ea,1,M)):(this._clearTileOverlayData(0,M),this._clearTileOverlayData(1,M))}else this._clearTileOverlayData(0,M),this._clearTileOverlayData(1,M)};ma.overlayPixelSizeInMapUnits=function(ea){if(f.isNone(this.renderer.overlays))return 0;
const M=this.renderer.overlays[0],Z=this.renderer.overlays[1];ea=this._pointIsInExtent(ea,M.extent)?M:Z;return(ea.extent[2]-ea.extent[0])/ea.resolution};ma._setTileOverlayData=function(ea,M,Z){if(!f.isNone(this.renderer.overlays)){var la=this.renderer.overlays[M].extent;Z.setScale(M,(ea[2]-ea[0])/(la[2]-la[0]),(ea[3]-ea[1])/(la[3]-la[1]));var ka=ea[0];if(this._longitudeCyclical){ka=this._longitudeCyclical.minimalMonotonic(la[0],ka);const ha=this._longitudeCyclical.minimalMonotonic(la[0],ea[2]);ka>
ha&&(ka=ha-(ea[2]-ea[0]))}Z.setOffset(M,(ka-la[0])/(la[2]-la[0]),(ea[1]-la[1])/(la[3]-la[1]))}};ma._clearTileOverlayData=function(ea,M){M.setScale(ea,-1,-1);M.setOffset(ea,-1,-1)};ma._disposeOverlays=function(){this.renderer.disposeOverlays()};ma.reloadShaders=async function(){H.removeLoadedShaderModules();await this.renderer.reloadShaders();this._updateOverlays()};ma.stopAnimationsAtTime=function(ea){this.renderer.stopAnimationsAtTime(ea);this._drawTexturesAnimateDirty=!0};ma._dispatchRendererUpdate=
function(ea){const M=x.Milliseconds(ea.time-this._animationTimeLast);M<S.DESIRED_DRAPED_ANIMATION_MS||(this._animationTimeLast=ea.time,this.renderer.updateLogic({dt:M,camera:this.view._stage.camera})&&(this._drawTexturesAnimateDirty=!0))};ma._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};ma._intersectGroundFromView=function(ea,M,Z,la){Z=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ea,ba,M,Z);if(f.isNone(Z))return!1;
M=Z.origin;Z=D.add(N,Z.origin,Z.direction);this.groundIntersector.reset(M,Z);this.groundIntersector.intersect([],null,ea);this.view.basemapTerrain.intersect(this.groundIntersector,null,M,Z);return this.groundIntersector.results.min.getIntersectionPoint(la)};ma._findHorizonBasedPointOfInterest=function(ea,M){var Z=.5;Z=this.view.renderCoordsHelper.getAltitude(ea.eye);const la=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ka=w.clamp(la.estimatedSurfaceAltitude,ea.aboveGround?-Infinity:Z+1E-5,
ea.aboveGround?Z-1E-5:Infinity);Z=ea.aboveGround;if("global"===this.view.viewingMode){var ha=N;K.sphere.closestPointOnSilhouette(K.sphere.fromRadius(C.getReferenceEllipsoid(this.view.spatialReference).radius+ka),K.ray.wrap(ea.eye,ea.viewForward),ha);D.subtract(ha,ha,ea.eye);ka=z.cyclicalPI.normalize(K.vector.angleAroundAxis(ea.viewForward,ha,ea.viewRight))/ea.fovY+.5;ha=0>=ka||1<=ka?.5:.55;Z=Z?ha*ka:ka+ha*(1-ka)}else ka=F.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ea.viewForward[2])),1,0),ka=I.transformMat4(ka,
ka,ea.projectionMatrix)[1],ka=w.clamp(.5+.5*ka,0,1),Z=1===ka||0===ka?.5:Z?.55*ka:1-.55*(1-ka);return this._intersectGroundFromView(ea,.5,Z,M)?D.sqrDist(M,ea.eye)<la.distance*la.distance:!1};ma._computeOverlayExtents=function(ea,M,Z){var la=this.surface.extent,ka=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ha=y.create();this._findHorizonBasedPointOfInterest(ea,ha)||D.copy(ha,ka);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(ea.eye);var na=D.distance(ea.eye,
ha);ka=L.viewAngle(this.view.renderCoordsHelper,ka,ea.eye);ka=Math.PI/2-Math.abs(ka-Math.PI/2);P.OVERLAY_SHOW_CENTER?(f.isNone(W)&&(W=new aa.GraphicsHandle(this.view.graphics,"red")),W.showPoint(ha,this._renderSR)):f.isSome(W)&&W.remove();this._overlaySREqualsRenderSR||B.projectVectorToVector(ha,this._renderSR,ha,this._overlaySR);na=M*ea.perRenderPixelRatio*na/2;var da=!1;let oa=Infinity;this._isSpherical&&f.isSome(this._overlaySR)&&(this._overlaySR.isWebMercator?(na/=Math.cos(l.y2lat(ha[1])),oa=
this.surface.extent[3]):(da=!0,na/=C.getReferenceEllipsoid(this._overlaySR).metersPerDegree,oa=90),na>=oa&&(na=oa,ha[1]=0,this._overlaySR.isWebMercator&&(ha[0]=0)));let qa=1;da&&(qa=1/Math.max(.2,Math.cos(Math.abs(w.deg2rad(ha[1])))),180<na*qa&&(qa=180/na));da=Math.log(2)/12;na=Math.exp(Math.round(Math.log(na)/da)*da);da=na*qa;const ua=.5*M/(32*da);M=.5*M/(32*na);ha[0]=Math.round(ha[0]*ua)/ua;ha[1]=Math.round(ha[1]*M)/M;M=Z.inner;M[0]=ha[0]-da;M[1]=ha[1]-na;M[2]=ha[0]+da;M[3]=ha[1]+na;this._isSpherical&&
this._shiftExtentToFitBounds(M,Infinity,oa);Z=Z.outer;m.set(Z,M);6*da>la[2]-la[0]?m.set(Z,la):ka<=.25*Math.PI?(Z[0]-=da,Z[1]-=na,Z[2]+=da,Z[3]+=na):(B.projectVectorToVector(ea.eye,this._renderSR,N,this._overlaySR),G.subtract(U,ha,N),ea=-Math.atan2(U[1],U[0])+.125*Math.PI,0>ea&&(ea+=2*Math.PI),I.scale(U,T[Math.floor(ea/(.25*Math.PI))],2*na),U[0]*=qa,U[2]*=qa,I.add(Z,Z,U));this._isSpherical&&(Z[0]=this._longitudeCyclical.clamp(Z[0]),Z[2]=this._longitudeCyclical.clamp(Z[2]),Z[1]=Math.max(Z[1],-oa),Z[3]=
Math.min(Z[3],oa));!this._isSpherical&&la&&(ea=m.intersection(M,la,O),la=m.intersection(Z,la,V),m.contains(ea,la)&&(Z[2]=Z[0],Z[3]=Z[1]))};ma._drawOverlayTextures=function(ea){if(!f.isNone(ea)&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var M=this._drawOverlay(ea,0);ea=this._drawOverlay(ea,1);0!==M&&0!==ea||this.surface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(Z=>this._updateDrapeTarget(Z));this._drawTexturesAnimateDirty=!1;this._drawTexturesDirty?
(this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.pendingUpdates=!0):this.surface.requestRender(0)}};ma._setupGeometryViewsCyclical=function(ea,M,Z){this._setupGeometryViewsDirect(ea,M,Z);const la=.001*this._longitudeCyclical.range;if(M[0]-la<=this._longitudeCyclical.min){const ka=ea.views[ea.numViews++];I.set(ka.viewport,0,0,Z,Z);m.offset(M,this._longitudeCyclical.range,0,ka.extent)}M[2]+la>=this._longitudeCyclical.max&&(ea=ea.views[ea.numViews++],I.set(ea.viewport,0,0,Z,Z),m.offset(M,
-this._longitudeCyclical.range,0,ea.extent))};ma._setupGeometryViewsDirect=function(ea,M,Z){ea.numViews=1;ea=ea.views[0];m.set(ea.extent,M);I.set(ea.viewport,0,0,Z,Z)};ma._drawOverlay=function(ea,M){const Z=ea[M];ea=Z.computeRenderTargetValidityBitfield();const {extent:la,resolution:ka,pixelRatio:ha}=Z;this._longitudeCyclical?this._setupGeometryViewsCyclical(Y,la,ka):this._setupGeometryViewsDirect(Y,la,ka);Y.width=ka;Y.height=ka;Y.pixelRatio=ha*this.view.state.camera.pixelRatio;Y.index=M;Z.drawRenderTargets(this.renderer,
Y,this.needsColorWithoutRasterImage());M=Z.computeRenderTargetValidityBitfield();return ea^M?0:1};ma.needsColorWithoutRasterImage=function(){return 0<this._drapeSourceTypes[0]&&0<this._drapeSourceTypes[1]&&0<this._drapeTargetTypes[1]};ma.hasDrapedFeatures=function(){return 0<this._drapeSourceTypes[1]};ma._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ea=performance.now();this.renderer.forEachOverlay(M=>this._hasUnusedRenderTargets=M.collectUnusedMemory(ea)||
this._hasUnusedRenderTargets)}};ma._rectanglesOverlap=function(ea,M){return this._longitudeCyclical?(this._longitudeCyclical.contains(M[0],M[2],ea[0])||this._longitudeCyclical.contains(M[0],M[2],ea[2])||this._longitudeCyclical.contains(ea[0],ea[2],M[0]))&&!(ea[1]>M[3]||ea[3]<M[1]):m.intersects(ea,M)};ma._rectInsideRect=function(ea,M){return this._longitudeCyclical?this._longitudeCyclical.contains(M[0],M[2],ea[0])&&this._longitudeCyclical.contains(M[0],M[2],ea[2])&&ea[1]>M[1]&&ea[3]<M[3]:m.contains(M,
ea)};ma._pointIsInExtent=function(ea,M){if(this._longitudeCyclical)return this._longitudeCyclical.contains(M[0],M[2],ea.x)&&ea.y>=M[1]&&ea.y<=M[3];const Z=ea.x;ea=ea.y;return Z>M[0]&&Z<M[2]&&ea>M[1]&&ea<M[3]};ma._shiftExtentToFitBounds=function(ea,M,Z){let la=0,ka=0;ea[0]<-M?la=ea[0]+M:ea[2]>M&&(la=M-ea[2]);ea[1]<-Z?ka=ea[1]+Z:ea[3]>Z&&(ka=Z-ea[3]);m.offset(ea,la,ka)};g._createClass(ia,[{key:"_needsUpdate",get:function(){return(this._placementDirty||this._layerViewsDirty)&&(0<this._drapeSources.size||
0<this.view.graphics.length||P.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this.suspended&&this.surface.ready}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this._needsUpdate||this.renderer.updating}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"test",get:function(){return{renderer:this.renderer,
update:()=>this._updateOverlays()}}}]);return ia}(t);b.__decorate([d.property()],a.OverlayManager.prototype,"_overlaySR",void 0);b.__decorate([d.property({readOnly:!0})],a.OverlayManager.prototype,"_needsUpdate",null);b.__decorate([d.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([d.property()],a.OverlayManager.prototype,"_layerViewsDirty",void 0);b.__decorate([d.property()],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([d.property({constructOnly:!0})],
a.OverlayManager.prototype,"surface",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);b.__decorate([d.property({readOnly:!0})],a.OverlayManager.prototype,"updating",null);b.__decorate([d.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);b.__decorate([d.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=b.__decorate([h.subclass("esri.views.3d.terrain.OverlayManager")],
a.OverlayManager);const Y={width:0,height:0,pixelRatio:0,views:[{viewport:m.create(),extent:m.create()},{viewport:m.create(),extent:m.create()},{viewport:m.create(),extent:m.create()}],numViews:0,index:0},U=F.create(),N=y.create(),ca={inner:m.create(),outer:m.create()},O=m.create(),V=m.create(),ba=K.ray.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../layers/support/timeUtils"],function(a,g){const b=g.Milliseconds(40);
g=g.Milliseconds(50);a.DESIRED_ANIMATION_FPS=25;a.DESIRED_ANIMATION_MS=b;a.DESIRED_DRAPED_ANIMATION_FPS=20;a.DESIRED_DRAPED_ANIMATION_MS=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports","../../../../core/global"],function(a,g){a.removeLoadedShaderModules=function(){var b;const p=null==(b=g.require)?void 0:b.modules;if(p){b=Object.keys(p);for(const f of b)-1!==f.search(".glsl")&&delete p[f]}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,g,b,p){function f(e,h){h(e);if(!e.isLeaf)for(const n of e.children)f(n,h)}function k(e,h,n){e=e.screenDepth;h=h.screenDepth;return e<h?-n:e>h?n:0}let c=function(){function e(){this._queue=new p;this._last=null;this.remove=()=>{}}var h=e.prototype;h.resetOne=function(n){this._queue.clear();this._queue.push(n);
this._last=null};h.reset=function(n=null){this._queue.clear();b.isSome(n)&&this._queue.pushArray(n);this._last=null};h.skipSubtree=function(){this._last=null};h.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};g._createClass(e,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return e}(),d=function(){function e(){this.q=new p}var h=e.prototype;h.reset=function(n){this.q.clear();
if(n)for(this.q.pushArray(n),n=0;n<this.q.length;++n){const q=this.q.data[n];q.isLeaf||this.q.pushArray(q.children)}};h.next=function(){return this.q.pop()};g._createClass(e,[{key:"done",get:function(){return 0===this.q.length}}]);return e}();a.IteratorPostorder=d;a.IteratorPreorder=c;a.compareTiles=k;a.computeUpsampleInfo=function(e,h,n){let q=1,u=0,v=0;for(;e!==h;)if(q*=.5,u*=.5,v*=.5,e.lij[2]&1&&(u+=.5),0===(e.lij[1]&1)&&(v+=.5),e=e.parent,null==e)throw Error("tile was not a descendant of upsampleTile");
n.init(h,u,v,q)};a.fallsWithinLayer=function(e,h,n){if(b.isNone(h))return!1;const q=h.fullExtent,u=e.extent;if(n){if(u[0]<q.xmin||u[1]<q.ymin||u[2]>q.xmax||u[3]>q.ymax)return!1}else if(q.xmin>u[2]||q.ymin>u[3]||q.xmax<u[0]||q.ymax<u[1])return!1;e=e.surface.tilingScheme.levels[e.lij[0]].scale;return 0<h.minScale&&e>1.00000001*h.minScale||0<h.maxScale&&e<.99999999*h.maxScale?!1:!0};a.hasLoadableSiblings=function(e){for(let h=0;h<e.length;h++){const n=e[h],q=n.parent;if(q)for(let u=0;4>u;u++){const v=
q.children[u];if(v&&v!==n&&v.loadable)return!0}}return!1};a.sortTiles=function(e,h){h.sort((n,q)=>k(n,q,e))};a.sortTilesByPOI=function(e,h){const n=new Map;e.forAll(q=>n.set(q,q.distanceToSquared(h)));e.sort((q,u)=>n.get(q)-n.get(u))};a.tile2str=function(e){return e?e.lij.toString():"null"};a.tilesAreRelated=function(e,h){if(!e||!h||e[0]===h[0])return!1;const n=e[0]<h[0],q=n?e:h;e=n?h:e;h=1<<e[0]-q[0];return Math.floor(e[1]/h)===q[1]&&Math.floor(e[2]/h)===q[2]};a.traverseTilesPreorder=function(e,
h){if(Array.isArray(e))for(let n=0;n<e.length;n++)f(e[n],h);else f(e,h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,g,b,p,f,k,c){let d=function(){function n(){this.waitingAgents=new f;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;
this.pendingUpdates=0}n.acquire=function(u){const v=e.acquire();v._init(u);return v};var q=n.prototype;q.release=function(){this.dispose();h.delete(this);e.release(this)};q.dispose=function(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=k.releaseTileData(this._data)};n.prune=function(){e.prune(0)};q._init=function(u){this.waitingAgents.clear();this._data=k.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=
!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=u;this.elevationBounds=null};q.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};q.abortRequest=function(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null};q._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};q.setUpsampleInfo=
function(u,v){if(u===v||null==v)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===v)return;this._upsampleInfo.tile.unrefMapData()}v.refMapData();c.computeUpsampleInfo(u,v,this._upsampleInfo)}};g._createClass(n,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(u){k.releaseTileData(this._data);this._data=u}}]);return n}();const e=new p(d,null,()=>
{}),h=new Map;a.TilePerLayerInfo=d;a.printAllocations=function(){0<h.size&&(console.log(`${h.size} live TilePerLayerInfo allocations:`),h.forEach(n=>console.log(n,"\n")))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/promiseUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ./TerrainConst ../../../chunks/sphere ../../webgl/Util ../support/StreamDataLoader ../../2d/engine/vectorTiles/VectorTile ./RasterTile ./TileTexture ./terrainUtils ./ElevationBounds ./tileUtils ./TileAgent ./ElevationTileAgent ./MapTileAgent ./TilePerLayerInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(S){S.dispose();S instanceof B?X.release(S):S instanceof E&&Q.release(S)}const I=C.weakAssert,K=c.create(),J=c.create(),L=c.create(),P=q.create();q=function(){function S(R){this._numSubdivisionAtLevel=R;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=h.create();this._elevationBounds=n.create();this.layerInfo=[[],[]];this.extentInRadians=h.create();this.centerAtSeaLevel=
c.create();this._center=[c.create(),l.create(),c.create()];this.up=c.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}S.prune=function(){Q.prune(0);X.prune(0);F.TilePerLayerInfo.prune()};var H=S.prototype;H.init=function(R,T,W){this.lij[0]=R[0];this.lij[1]=R[1];this.lij[2]=R[2];this.ellipsoid=e.getReferenceEllipsoid(W.tilingScheme.spatialReference);
W.tilingScheme.getExtent(R[0],R[1],R[2],this.extent);W.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;W.upsampleMapCache.pop(x.tile2str(this));this._edgeLen2=this._edgeLen=0;this._center[1][3]=0;this.vlevel=R?R[0]:0;T&&T._elevationBounds?u.copy(this._elevationBounds,T.elevationBounds):u.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=
0;this._previouslyRendered=this._visible=!1;this._parent=T;this.unsetChildren();this._surface=W;this.updateVisibility();for(const Y of t.LayerClasses){R=W.numLayers(Y);T=this.layerInfo[Y];for(const U of T)U.release();T.length=R;for(let U=0;U<R;U++)T[U]=F.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),0===Y&&this.findElevationBoundsForLayer(U,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(W.tilingScheme.pixelSize,t.MAX_PATCH_TESSELATION)};H.release=function(){I(!this.renderData,
"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(x.tile2str(this));for(const R of t.LayerClasses){for(const T of this.layerInfo[R])T.release();this.layerInfo[R].length=0}this._surface=this._parent=null;this._usedMemory=-1};H.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(x.tile2str(this))};H.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const R=this.cachedMemory;0<R&&(this._surface.upsampleMapCache.put(x.tile2str(this),
this,R),this.setMemoryDirty())}};H.setMemoryDirty=function(){this._usedMemory=-1};H._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;const R=this.cpuImageMemorySize;for(const T of this.layerInfo[1]){const W=T.data;W instanceof r?this._mapTileMemory+=w.getGpuMemoryUsage(W.texture):W instanceof HTMLImageElement||W instanceof y.ImageWithType?this._mapTileMemory+=R:W instanceof z&&(this._mapTileMemory+=W.getMemoryUsage())}for(const T of this.layerInfo[0])this._usedMemory+=T.data?R:
0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=w.getGpuMemoryUsage(this.renderData.textureDescriptor));this.isCached&&this._surface.upsampleMapCache.updateSize(x.tile2str(this),this,this.cachedMemory)};H.getUsedMemoryForLayer=function(R,T){T=this.layerInfo[R][T];if(!T||!T.data)return 0;if(1===R&&!this.isCached){R=T.data;if(R instanceof r)return w.getGpuMemoryUsage(R.texture);if(R instanceof HTMLImageElement||R instanceof y.ImageWithType)return this.cpuImageMemorySize;
if(R instanceof D.VectorTile||R instanceof z)return R.getMemoryUsage()}else if(0===R)return this.cpuImageMemorySize;return 0};H.updateScreenDepth=function(R){d.copy(P,this._center[1]);P[3]=1;v.transformMat4(P,P,R);this._screenDepth=0>P[2]?0:P[2]/P[3]};H.shouldSplit=function(R,T,W){if(b.isSome(R.frustum)&&!this._isVisible(R.frustum))return 0;const Y=this.level;d.subtract(K,this._center[1],T);var U=d.squaredLength(K);let N=1;d.subtract(J,this._center[0],T);var ca=d.squaredLength(J);ca<U&&(U=ca,N=0);
d.subtract(J,this._center[2],T);ca=d.squaredLength(J);ca<U&&(U=ca,N=2);if(this._edgeLen2>U&&Y<R.maxLod)return 2;U=Math.sqrt(U);const O=this._edgeLen/(R.fovX*U*2);ca=()=>{const fa=Y+Math.ceil(-k.log2(R.relativeWidthLimit/O));return fa!==this.vlevel?(this.vlevel=fa,4):1};if(1===W&&1===this._surface.snapLevel-Y)return Y>=R.maxLod?ca():2;const V=d.dot(this.up,K);W=this._elevationBounds[1]-this._elevationBounds[0];const ba=W/this.edgeLen;return R.aboveGround&&0<V&&.001>ba&&0<V/U-Math.sin(this._curvatureHeight/
(this.edgeLen*Math.SQRT1_2)*Math.PI)-ba?0:O<R.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:Y>=R.maxLod?ca():6<Y&&(d.subtract(J,this._center[N],T),d.scale(L,this.up,V),d.subtract(L,L,J),ca=d.squaredLength(L),ca>this.radius*this.radius&&(d.scale(L,L,this.radius/Math.sqrt(ca)),d.add(L,L,this._center[N]),d.subtract(L,T,L),Math.min(1,(Math.abs(d.dot(L,this.up))+.5*W+this._curvatureHeight)/d.length(L))*(this._edgeLen/(R.fovY*U*2))<.1/R.angledSplitBias*R.relativeHeightLimit))?
0:2};H.setChildren=function(R,T,W,Y){I(!!(R&&T&&W&&Y),"Null child passed");this._children[0]=R;this._children[1]=T;this._children[2]=W;this._children[3]=Y};H.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};H.load=function(R){this.refMapData();for(const T of t.LayerClasses)this._createOrUpdateAgents(0,T);R.loadTile(this)};H.unload=function(R){R.unloadTile(this);for(const T of t.LayerClasses){R=this.layerInfo[T];for(const W of R)W.loadingAgent&&
W.loadingAgent!==m.TILE_AGENT_DONE&&(G(W.loadingAgent),W.loadingAgent=null),W.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};H.unloadMapData=function(){const R=this.layerInfo[1];for(const T of R)T.loadingAgent&&T.loadingAgent!==m.TILE_AGENT_DONE&&(G(T.loadingAgent),T.loadingAgent=null),T.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};H.updateClippingStatus=function(R){if(h.equals(R,this._clippingArea))return!1;
var T=this._intersectsClippingArea;const W=this._isWithinClippingArea;b.isSome(R)?(this._intersectsClippingArea=this.intersectsExtent(R),this._isWithinClippingArea=this.isWithinExtent(R)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=R;this.updateVisibility();R=W&&this._isWithinClippingArea;T=!W&&!T&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||R||T||this.setPendingUpdate(32);return!0};H.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};
H.getLayerInfo=function(R,T){return this.layerInfo[T][R]};H.hasLayerData=function(R,T){R=this.layerInfo[T][R];return!(!R||!R.data||R.dataInvalidated)};H.isSuspended=function(R){return this.hasPendingUpdate(2)?!0:0===R?!1:!this.loadable};H.hasPendingUpdate=function(R){return(this._pendingUpdates&R)===R};H.setPendingUpdate=function(R){this._pendingUpdates|=R;2===R||8===R?this._surface.setTileTreeDirty():this._surface.pendingUpdates=!0};H.resetPendingUpdate=function(R){return this.hasPendingUpdate(R)?
(this._pendingUpdates&=~R,!0):!1};H.requestLayerData=function(R,T,W){const Y=this.layerInfo[T][R];if(Y.waitingAgents.has(W))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),W.tile.lij.toString(),T,R),!0;Y.waitingAgents.push(W);if(Y.data&&!Y.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),W.tile.lij.toString(),T,R),W.dataArrived(this),!0;if(Y.requestPromise)return!0;
b.abortMaybe(Y.requestAbort);Y.requestAbort=f.createAbortController();const U=this._surface.requestTileData(this,R,T,Y.requestAbort);if(!U)return Y.requestAbort=null,!1;R=()=>{Y.requestPromise===U&&(Y.requestPromise=null,Y.requestAbort=null)};Y.requestPromise=U;U.then(R,R);return!0};H.hasLij=function(R){return this.lij[0]===R[0]&&this.lij[1]===R[1]&&this.lij[2]===R[2]};H.findByLij=function(R){return this.hasLij(R)?this:this.isLeaf?null:(R=this._children[0].findByLij(R)||this._children[1].findByLij(R)||
this._children[2].findByLij(R)||this._children[3].findByLij(R))?R:null};H.distanceToSquared=function(R){return d.squaredLength(d.subtract(L,this._center[1],R))};H.containsPoint=function(R){const T=this.extent;return R[0]>=T[0]&&R[1]>=T[1]&&R[0]<=T[2]&&R[1]<=T[3]};H.unrequestLayerData=function(R,T,W){R=this.layerInfo[T][R];T=R.waitingAgents;W=null!=T.removeUnordered(W);I(W,"agent has not requested this piece of map data");1>T.length&&(R.abortRequest(),this._updateMemoryUsed())};H.dataArrived=function(R,
T,W){R=this.layerInfo[T][R];R.data=W;R.dataInvalidated=!1;R.waitingAgents.forAll(Y=>Y.dataArrived(this));R.waitingAgents.clear();this._updateMemoryUsed()};H.dataMissing=function(R,T,W){W.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${T}/${R} error ${W}`);R=this.layerInfo[T][R];R.dataMissing=!0;R.waitingAgents.forAll(Y=>Y.dataMissing());R.waitingAgents.clear();this._updateMemoryUsed()};H.updateRenderData=function(R){switch(R){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};
H.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};H.updateGeometry=function(){this.setPendingUpdate(32);for(const R of this.layerInfo[0])R.pendingUpdates|=32};H.invalidateLayerData=function(R,T){this.layerInfo[T][R].invalidateSourceData();this.restartAgents(T)};H.computeElevationBounds=function(){u.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const R=this.layerInfo[0];let T=!0;for(const W of R)b.isSome(W.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],
W.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],W.elevationBounds.max),W.elevationBounds.hasNoDataValues||(T=!1));T&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};H._updateCenter=function(){d.scale(L,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));d.add(this._center[1],this.centerAtSeaLevel,L);d.scale(L,this.up,
this._elevationBounds[0]);d.add(this._center[0],this.centerAtSeaLevel,L);d.scale(L,this.up,this._elevationBounds[1]);d.add(this._center[2],this.centerAtSeaLevel,L)};H.findElevationBoundsForLayer=function(R,T){const W=this.layerInfo[0][R];if(b.isNone(W.elevationBounds)||W.elevationBounds.level<T)if(T=this._surface.layerViewByIndex(R,0),T=C.getLayerWithExtentRange(T),x.fallsWithinLayer(this,T,!1)){T=aa;let Y=!1;if(W.data)R=W.data,T.min=R.bounds[0],T.max=R.bounds[1],T.hasNoDataValues=R.hasNoDataValues,
T.level=this.lij[0],Y=!0;else{let U=0,N,ca;for(let O=this._parent;O&&(!ca||U<t.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(U=this.vlevel-O.level,N=ca||N,ca=O.layerInfo[0][R].data,!ca&&N&&U>=t.ELEVATION_DESIRED_RESOLUTION_LEVEL);O=O._parent);if(ca=ca||N)ca.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],T),Infinity!==T.min&&(T.level=ca.level,Y=!0)}Y&&(b.isNone(W.elevationBounds)&&(W.elevationBounds=new A.ElevationBounds),W.elevationBounds.copyFrom(T))}};H.modifyLayers=function(R,T,W){W=this.layerInfo[W];
for(var Y of W)Y.loadingAgent&&Y.loadingAgent!==m.TILE_AGENT_DONE&&(G(Y.loadingAgent),Y.loadingAgent=null),Y.waitingAgents.clear();for(Y=0;Y<W.length;++Y)void 0===R[Y]&&W[Y].release();R=Array(...W);Y=T.length;W.length=Y;for(let U=0;U<Y;U++){const N=T[U];W[U]=-1<N?R[N]:F.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()};H.restartAgents=function(R){this.renderData&&(this._createOrUpdateAgents(0,R),this.updateRenderData(R))};H.updateAgents=function(R){if(this.renderData){const T=
this.layerInfo[R];for(const W of T)W.loadingAgent===m.TILE_AGENT_DONE&&(W.loadingAgent=null);this._createOrUpdateAgents(0,R)}};H.updateAgentSuspension=function(){for(const R of t.LayerClasses){const T=this.isSuspended(R);for(const W of this.layerInfo[R])W.loadingAgent&&W.loadingAgent!==m.TILE_AGENT_DONE&&(W.loadingAgent.setSuspension(T),W.loadingAgent===m.TILE_AGENT_DONE&&this.updateRenderData(R))}};H.removeLayerAgent=function(R,T){R=this.layerInfo[T][R];R.loadingAgent&&R.loadingAgent!==m.TILE_AGENT_DONE&&
R.loadingAgent.dispose();R.loadingAgent=null};H.agentDone=function(R,T){const W=this.layerInfo[T][R];W.loadingAgent=m.TILE_AGENT_DONE;W.data||W.upsampleInfo||this._createOrUpdateAgents(R+1,T)};H._createOrUpdateAgents=function(R,T){const W=this.isSuspended(T),Y=this.layerInfo[T];for(;R<Y.length;++R){const O=Y[R];var U=!1;const V=this._surface.layerViewByIndex(R,T);var N=C.getLayerWithExtentRange(V);if(O.loadingAgent)x.fallsWithinLayer(this,N,!1)?(O.loadingAgent!==m.TILE_AGENT_DONE&&O.loadingAgent.setSuspension(W),
O.loadingAgent!==m.TILE_AGENT_DONE&&(U=O.loadingAgent.update())):O.dispose();else if(x.fallsWithinLayer(this,N,!1)){{U=R;N=T;var ca=W;const ba=0===N?X.acquire():Q.acquire();ba.init(this,U,N,ca);U=ba}O.loadingAgent=U;(U=O.loadingAgent.startLoading())?O.loadingAgent===m.TILE_AGENT_DONE&&this.setPendingUpdate(32):(G(O.loadingAgent),O.loadingAgent=m.TILE_AGENT_DONE)}O.loadingAgent===m.TILE_AGENT_DONE&&this.updateRenderData(T);if(U&&V.isOpaque)break}};H.isWithinExtent=function(R){const T=this.extent;return T[0]>=
R[0]&&R[2]>=T[2]&&T[1]>=R[1]&&R[3]>=T[3]};H.intersectsExtent=function(R){const T=this.extent;return T[2]>=R[0]&&R[2]>=T[0]&&T[3]>=R[1]&&R[3]>=T[1]};g._createClass(S,[{key:"usedMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();let R=this._mapTileMemory;for(const {data:T}of this.layerInfo[1])T instanceof
D.VectorTile&&(R+=T.getMemoryUsage());return R}},{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"numSubdivisionsAtLevel",get:function(){return this._numSubdivisionAtLevel}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},
{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[1][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){if(this._dirty){this._dirty=
!1;const R=this._isVisible(this.surface.frustum);R!==this._visible&&(this._visible=R,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender());this.updateAgentSuspension()}return this._visible}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const R=!!this.renderData;R!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=R,this._surface.renderer.setNeedsRender());
return R}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const R=this.level-this._surface.snapLevel;if(0===R)return!0;if(1===R)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const R=this._surface.tilingScheme.pixelSize;return R*R*4}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const R of t.LayerClasses){const T=this.layerInfo[R];for(const W of T)if(W.loadingAgent&&W.loadingAgent!==m.TILE_AGENT_DONE&&
W.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return S}();const Q=new p(E),X=new p(B),aa=new A.ElevationBounds;a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.default=q;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),function(a,g,b,p,f,k){let c=function(){function h(){}var n=h.prototype;n.init=function(q,u,v,t){this.tile=q;this._layerIdx=u;this._layerClass=v;this._suspended=t;this._tileLayerInfo=q.getLayerInfo(u,v);this._tileRequested=null;q=this._findAncestorWithData();this._setUpsampleTile(q)};n.startLoading=
function(){return this._requestNext()};n.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};n.setSuspension=function(q){q!==this._suspended&&((this._suspended=q)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};n.update=function(){const q=this._findAncestorWithData();
this._setUpsampleTile(q);return this._requestNext()};n.dataArrived=function(q){this._setUpsampleTile(q);this._tileRequested=null;q===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};n.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};n._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};n._requestNext=function(){if(this._suspended)return!0;const q=this._findNextDownload();if(this._tileRequested){if(q===
this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}q?q.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=q):this._agentDone();return!!this._tileRequested};n._findNextDownload=function(){const q=this._layerIdx,u=this._layerClass;var v=this.tile.surface.layerViewByIndex(q,u);const t=f.getLayerWithExtentRange(v),{minLevel:l,maxLevel:w}=v.dataLevelRange;v=this._desiredMinLevelDelta;const y=this._loadingLevelDelta+
v,D=this._scaleRangeEnabled?k.fallsWithinLayer:()=>!0;let z,r=this.tile,C=0;var A=this._tileLayerInfo.upsampleInfo;A=A?A.tile.level:-1;const x=b.get(t,"tilemapCache");for(;r&&D(r,t,!1)&&r.level>=l;){const m=r.level,B=r.layerInfo[u][q];if(B.data&&C>=v){m>A&&this._setUpsampleTile(r);B.dataInvalidated&&(z=r);break}if((b.isNone(x)||"unavailable"!==x.getAvailability(r.lij[0],r.lij[1],r.lij[2]))&&m<=w&&!B.data&&!B.dataMissing){if(!z||0===m%p.LOADING_LEVEL_MODULO||this.tile.level-z.level<v)z=r;if(C>=y)break}r=
r.parent;C++}z&&this.tile.level-z.level<v&&this._tileLayerInfo.upsampleInfo&&(z=null);return z};n._findAncestorWithData=function(){const q=this.tile.vlevel,u=this._desiredMinLevelDelta;let v;for(let t=this.tile;t;t=t.parent)if(t.hasLayerData(this._layerIdx,this._layerClass)){if(q-t.level>=u)return t;v=t}return v};n._setUpsampleTile=function(q){this._tileLayerInfo.setUpsampleInfo(this.tile,q);this.tile.updateRenderData(this._layerClass)};g._createClass(h,[{key:"updating",get:function(){return!!this._tileRequested}},
{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return h}();var d=function(h){function n(){return h.apply(this,arguments)||this}g._inheritsLoose(n,h);n.prototype.dispose=function(){};g._createClass(n,[{key:"_desiredMinLevelDelta",get:function(){throw e;}},{key:"_loadingLevelDelta",get:function(){throw e;}}]);return n}(c);const e=Error("Abstract method called on TileAgent");d=new d;a.TILE_AGENT_DONE=d;a.TileAgent=c;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,g,b){return function(p){function f(){var k=p.apply(this,arguments)||this;k._scaleRangeEnabled=!1;return k}a._inheritsLoose(f,p);a._createClass(f,[{key:"_desiredMinLevelDelta",get:function(){return g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])}},{key:"_loadingLevelDelta",get:function(){return 0}}]);
return f}(b.TileAgent)})},"esri/views/3d/terrain/MapTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TileAgent"],function(a,g){return function(b){function p(){var f=b.call(this)||this;f._scaleRangeEnabled=!0;return f}a._inheritsLoose(p,b);a._createClass(p,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_loadingLevelDelta",get:function(){return 8}}]);return p}(g.TileAgent)})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../../../chunks/frustum ./PatchGeometryFactory ./Tile".split(" "),
function(a,g,b,p,f,k,c){c=function(d){function e(n,q,u){var v=d.call(this,e.NumSubdivisionsAtLevel)||this;void 0!==n&&v.init(n,q,u);return v}g._inheritsLoose(e,d);var h=e.prototype;h.init=function(n,q,u){d.prototype.init.call(this,n,q,u);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=b.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=b.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
h.updateRadiusAndCenter=function(){this._updateCenter();const n=(this.extent[2]-this.extent[0])*Math.SQRT1_2,q=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._center[1][3]=Math.sqrt(n*n+q*q)};h._isVisible=function(n){return this.intersectsClippingArea&&f.intersectsAABB(n,p.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};h.createGeometry=function(n,q){k.createPlanarGlobePatch(n,this.extent,q,this.renderData);this.setMemoryDirty()};
return e}(c["default"]);c.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];a.PlanarPatch=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/maybe ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/vec4f64 ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ./TerrainConst ../support/buffer/InterleavedLayout ../webgl-engine/materials/internal/MaterialUtil ./ElevationData ../support/buffer/BufferPool".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){function v(F,G,I,K){const J=0<(I&2),L=G+(K?1024:0)+(J?2048:0);var P=r.get(L);if(!P){{P=G-1;const S=G-1,H=G*G;var Q=2*P+2*S;let R=P*S*6,T=6*Q,W=6*(2*P+S-1);K&&(R*=2,T*=2,W*=2);Q=65536<H+Q?new Uint32Array(R+T):new Uint16Array(R+T);let Y=0,U=0,N=R,ca,O;let V=0;for(let ba=0;ba<=S;ba++){J&&(V=0===ba?W:ba===S?-W:0);N+=V;for(let fa=0;fa<=P;fa++){var X=w(fa,ba,P,S);if(-1<X){var aa=0===ba&&fa!==P?1:fa===P&&ba!==S?P+1:ba===S&&0!==fa?-1:0===fa&&0!==ba?-(P+1):0;0!==aa&&(ca=
Y,O=H+X,X=H+(0===fa&&1===ba?0:X+1),aa=Y+aa,K?(Q[N+0]=ca,Q[N+1]=O,Q[N+2]=O,Q[N+3]=X,Q[N+4]=X,Q[N+5]=ca,Q[N+6]=X,Q[N+7]=aa,Q[N+8]=aa,Q[N+9]=ca,Q[N+10]=ca,Q[N+11]=X,N+=12):(Q[N+0]=ca,Q[N+1]=O,Q[N+2]=X,Q[N+3]=X,Q[N+4]=aa,Q[N+5]=ca,N+=6))}++Y;fa<P&&ba<S&&(ca=ba*(P+1)+fa,O=ca+1,X=O+(P+1),aa=X-1,K?(Q[U+0]=ca,Q[U+1]=O,Q[U+2]=O,Q[U+3]=X,Q[U+4]=X,Q[U+5]=ca,Q[U+6]=X,Q[U+7]=aa,Q[U+8]=aa,Q[U+9]=ca,Q[U+10]=ca,Q[U+11]=X,U+=12):(Q[U+0]=ca,Q[U+1]=O,Q[U+2]=X,Q[U+3]=X,Q[U+4]=aa,Q[U+5]=ca,U+=6))}N-=V}P=new z(Q,R,T)}r.set(L,
P)}F.indices=P.values;F.numSurfaceIndices=P.numSurfaceIndices;F.numSkirtIndices=P.numSkirtIndices;F.numWithoutSkirtIndices=F.numSurfaceIndices+(I?6*(G-1)*(K?2:1):0)}function t(F,G,I,K){F<K[0]&&(K[0]=F);F>K[3]&&(K[3]=F);G<K[1]&&(K[1]=G);G>K[4]&&(K[4]=G);I<K[2]&&(K[2]=I);I>K[5]&&(K[5]=I)}function l(F,G){const I=G>F?1:0;return 2+4*I+(1-2*I)*(F+G)}function w(F,G,I,K){return 0===G?F:F===I?I+G:G===K?I+K+(I-F):0===F&&0<G?2*I+K+(K-G):-1}const y=h.newLayout().vec3f("position").vec2f("uv0"),D=new u.BufferPool(F=>
y.createBuffer(F),F=>F.count);let z=function(F,G,I){this.values=F;this.numSurfaceIndices=G;this.numSkirtIndices=I};const r=new Map,C=Array(e.MAX_PATCH_TESSELATION+1),A=Array(e.MAX_PATCH_TESSELATION+1),x=Array(e.MAX_PATCH_TESSELATION+1),m=Array(e.MAX_PATCH_TESSELATION+1),B=p.create(),E=p.create();a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=d.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=0;
this.uvOffsetAndScale=k.create()};a.clearCaches=function(){D.clear();r.clear()};a.createPlanarGlobePatch=function(F,G,I,K){const J=G[0],L=G[1],P=G[2]-J,Q=G[3]-L,X=F.clippingArea,aa=g.isSome(X)?Math.max(0,(X[0]-G[0])/P):0,S=g.isSome(X)?Math.max(0,(X[1]-G[1])/Q):0,H=g.isSome(X)?Math.min(1,(X[2]-G[0])/P):1;G=g.isSome(X)?Math.min(1,(X[3]-G[1])/Q):1;const R=H>aa?1/(H-aa):1,T=G>S?1/(G-S):1,W=-aa*R,Y=-S*T,U=.1*P,N=F.numVertsPerRow-1,ca=F.numVertsPerRow-1,O=F.numVertsPerRow*F.numVertsPerRow,V=D.acquire(O+
(2*N+2*ca)),ba=V.position.typedBuffer,fa=V.uv0.typedBuffer,ia=K.geometryInfo.boundingBox;d.empty(ia);let ma=0;for(let ka=0;ka<=ca;ka++){var ea=ka/ca;let ha=Y+ea*T;ea=L+ea*Q;g.isSome(X)&&(ea<X[1]?(ea=X[1],ha=0):ea>X[3]&&(ea=X[3],ha=1));for(let na=0;na<=N;na++){var M=na/N;let da=W+M*R;M=J+M*P;g.isSome(X)&&(M<X[0]?(M=X[0],da=0):M>X[2]&&(M=X[2],da=1));var Z=F.samplerData?q.ElevationData.sample(M,ea,F.samplerData)||0:0;M-=I[0];const oa=ea-I[1];Z-=I[2];t(M,oa,Z,ia);var la=e.GEOMETRY_VERTEX_STRIDE*ma;ba[la+
0]=M;ba[la+1]=oa;ba[la+2]=Z;fa[la+0]=da;fa[la+1]=ha;la=w(na,ka,N,N);-1<la&&(la=e.GEOMETRY_VERTEX_STRIDE*(O+la),ba[la+0]=M,ba[la+1]=oa,ba[la+2]=Z,fa[la+0]=l(da,ha),fa[la+1]=U);++ma}}K.geometryInfo.numVertsPerRow=F.numVertsPerRow;K.geometryInfo.vertexAttributes=V;K.geometryInfo.skirtLength=U;c.set(K.geometryInfo.uvOffsetAndScale,aa,S,H-aa,G-S);v(K.geometryInfo,F.numVertsPerRow,0,F.wireframe)};a.createSphericalGlobePatch=function(F,G,I,K,J,L,P,Q){var X=J[0];const aa=J[1];var S=J[2];J=J[3];const H=.1*
P.radius*(J-aa),R=F.numVertsPerRow-1,T=F.numVertsPerRow-1,W=F.numVertsPerRow*F.numVertsPerRow,Y=D.acquire(W+(2*R+2*T)),U=Y.position.typedBuffer,N=Y.uv0.typedBuffer,ca=K.geometryInfo.boundingBox;d.empty(ca);var O=G[2]-G[0];const V=G[3]-G[1];var ba=S-X;S=I[0];const fa=I[1];I=I[2];for(var ia=0;ia<=R;ia++){var ma=ia/R,ea=X+ma*ba;C[ia]=Math.sin(ea);A[ia]=Math.cos(ea);x[ia]=ma;m[ia]=G[0]+ma*O}X=L&&!!(Q&1);O=L&&!!(Q&2);ba=0;for(ia=0;ia<=T;ia++){ma=ia/T;var M=b.lerp(aa,J,ma);ea=Math.cos(M);const na=Math.sin(M);
L?(M=P.halfSemiMajorAxis*Math.log((1+na)/(1-na)),ma=(M-G[1])/V):M=180*M/Math.PI;for(let da=0;da<=R;da++){const oa=x[da];var Z=C[da],la=A[da],ka=P.radius;F.samplerData&&(ka+=q.ElevationData.sample(m[da],M,F.samplerData)||0);la=la*ea*ka-S;Z=Z*ea*ka-fa;ka=na*ka-I;t(la,Z,ka,ca);var ha=e.GEOMETRY_VERTEX_STRIDE*ba;U[ha+0]=la;U[ha+1]=Z;U[ha+2]=ka;N[ha+0]=oa;N[ha+1]=ma;ha=w(da,ia,R,T);if(-1<ha){ha=e.GEOMETRY_VERTEX_STRIDE*(W+ha);const qa=X&&0===ia?-1:O&&ia===T?1:0;la=0===qa?la:-S;Z=0===qa?Z:-fa;ka=0===qa?
ka:P.radius*qa-I;U[ha+0]=la;U[ha+1]=Z;U[ha+2]=ka;N[ha+0]=0===qa?l(oa,ma):oa;N[ha+1]=0===qa?H:ma;0!==qa&&t(la,Z,ka,ca)}++ba}}K.geometryInfo.numVertsPerRow=F.numVertsPerRow;K.geometryInfo.vertexAttributes=Y;K.geometryInfo.skirtLength=H;c.set(K.geometryInfo.uvOffsetAndScale,0,0,1,1);v(K.geometryInfo,F.numVertsPerRow,L?Q:0,F.wireframe)};a.intersectSkirts=function(F,G,I,K,J,L,P,Q,X){const aa=L.position;L=L.uv0;const S=F[0],H=F[1];F=F[2];const R=G[0]-S,T=G[1]-H;G=G[2]-F;I*=3;for(K*=3;I<K;I+=3){var W=J[I],
Y=J[I+1],U=J[I+2],N=aa.get(W,0),ca=aa.get(W,1),O=aa.get(W,2),V=aa.get(Y,0),ba=aa.get(Y,1),fa=aa.get(Y,2),ia=aa.get(U,0),ma=aa.get(U,1),ea=aa.get(U,2);2<=L.get(W,0)&&(f.set(B,N,ca,O),P(B),N+=B[0],ca+=B[1],O+=B[2]);2<=L.get(Y,0)&&(f.set(B,V,ba,fa),P(B),V+=B[0],ba+=B[1],fa+=B[2]);2<=L.get(U,0)&&(f.set(B,ia,ma,ea),P(B),ia+=B[0],ma+=B[1],ea+=B[2]);g.isSome(Q)&&([N,ca,O]=Q.applyToVertex(N,ca,O),[V,ba,fa]=Q.applyToVertex(V,ba,fa),[ia,ma,ea]=Q.applyToVertex(ia,ma,ea));W=V-N;ba-=ca;fa-=O;ia-=N;ma-=ca;ea-=
O;U=T*ea-ma*G;V=G*ia-ea*R;const M=R*ma-ia*T;Y=W*U+ba*V+fa*M;if(!(Math.abs(Y)<=Number.EPSILON)){N=S-N;ca=H-ca;O=F-O;U=N*U+ca*V+O*M;if(0<Y){if(0>U||U>Y)continue}else if(0<U||U<Y)continue;V=ca*fa-ba*O;O=O*W-fa*N;ca=N*ba-W*ca;N=R*V+T*O+G*ca;if(0<Y){if(0>N||U+N>Y)continue}else if(0<N||U+N<Y)continue;O=(ia*V+ma*O+ea*ca)/Y;0<=O&&(W=n.computeNormal(W,ba,fa,ia,ma,ea,E),X(O,W))}}};a.releaseGeometry=function(F){D.release(F.vertexAttributes);F.vertexAttributes=null;F.indices=null};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/support/buffer/BufferPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray"],function(a,g,b){let p=function(){function f(c,d){this._factoryCallback=c;this._lengthCallback=d;this._pool=new Map}var k=f.prototype;k.acquire=function(c){if(!f.test.disabled){var d=this._pool.get(c);if(d&&0!==d.length)return d.pop()}try{return this._factoryCallback(c)}catch(e){d=window.performance&&window.performance.memory;let h="";
d&&(h=`\n  totalJSHeapSize: ${d.totalJSHeapSize}, usedJSHeapSize: ${d.usedJSHeapSize}, jsHeapSizeLimit: ${d.jsHeapSizeLimit}`);console.log("Array allocation of size "+c+" failed: "+e+h);throw e;}};k.release=function(c){if(!f.test.disabled){var d=this._lengthCallback(c),e=this._pool.get(d);e||(e=new b({shrink:!0}),this._pool.set(d,e));e.push(c)}};k.clear=function(){this._pool.clear()};g._createClass(f,[{key:"test",get:function(){return{size:this._pool.size}}}]);return f}();p.test={disabled:!1};a.BufferPool=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/projection ../../../chunks/plane ../../../chunks/frustum ./PatchGeometryFactory ./Tile".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){n=function(v){function t(w,y,D){var z=v.call(this,q)||this;z.obb=Array(8);z.isWebMercator=
!1;for(let r=0;8>r;r++)z.obb[r]=p.create();void 0!==w&&z.init(w,y,D);return z}g._inheritsLoose(t,v);var l=t.prototype;l.init=function(w,y,D){v.prototype.init.call(this,w,y,D);this.isWebMercator=D.tilingScheme.spatialReference.isWebMercator;y=this.ellipsoid.radius;D=this.extentInRadians[0];const z=this.extentInRadians[1],r=this.extentInRadians[2],C=this.extentInRadians[3];w=w[0];const A=b.lerp(z,C,.5),x=b.lerp(D,r,.5);this._edgeLen=(r-D)*Math.cos(0===w?0:Math.min(Math.abs(z),Math.abs(C)))*y;this._edgeLen2=
this._edgeLen*this._edgeLen;this._curvatureHeight=y-Math.sqrt(y*y-this._edgeLen2/4);c.lonLatToSphericalPCPF(this.centerAtSeaLevel,x,A,this.ellipsoid.radius,0);y=p.fromArray(this.centerAtSeaLevel);f.normalize(y,y);this.up=y;this._updateOBB();this.updateRadiusAndCenter()};l.updateRadiusAndCenter=function(){if(0===this.lij[0])f.set(this._center[1],0,0,0),f.set(this._center[0],0,0,0),f.set(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=k.getReferenceEllipsoid(this.surface.tilingScheme.spatialReference)),
this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const w=Math.max(f.squaredDistance(this._center[1],this.obb[0]),f.squaredDistance(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(w)}};l._isVisible=function(w){if(!this.intersectsClippingArea)return!1;if(10>this.lij[0])return e.intersectsSphere(w,this._center[1]);const y=this.obb;for(let D=0;6>D;D++){let z=w[D];4===D&&(z=d.copy(z,u),u[3]-=this.surface.view.state.camera.near);let r;for(r=0;8>r&&!d.isPointOutside(z,
y[r]);r++);if(8===r)return!1}return!0};l.computeElevationBounds=function(){v.prototype.computeElevationBounds.call(this);this._updateOBB()};l.createGeometry=function(w,y){const D=this._isPole(this.lij[1],this.lij[0]);h.createSphericalGlobePatch(w,this.extent,y,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,D);this.setMemoryDirty()};l._updateOBB=function(){var w=this.extentInRadians;const y=this.obb;for(let D=0;2>D;D++){const z=this.elevationBounds[D];let r=4*D;c.lonLatToSphericalPCPF(y[r++],
w[0],w[1],this.ellipsoid.radius,z);c.lonLatToSphericalPCPF(y[r++],w[0],w[3],this.ellipsoid.radius,z);c.lonLatToSphericalPCPF(y[r++],w[2],w[3],this.ellipsoid.radius,z);c.lonLatToSphericalPCPF(y[r++],w[2],w[1],this.ellipsoid.radius,z)}this.isWebMercator&&(w=this._isPole(this.lij[1],this.lij[0]),2===w?(f.set(y[1],0,0,this.ellipsoid.radius),f.set(y[2],0,0,this.ellipsoid.radius),f.set(y[5],0,0,this.ellipsoid.radius),f.set(y[6],0,0,this.ellipsoid.radius)):1===w&&(f.set(y[0],0,0,-this.ellipsoid.radius),
f.set(y[3],0,0,-this.ellipsoid.radius),f.set(y[4],0,0,-this.ellipsoid.radius),f.set(y[7],0,0,-this.ellipsoid.radius)))};l._isPole=function(w,y){let D=0;w===(1<<y)-1&&(D+=1);0===w&&(D+=2);return D};return t}(n["default"]);const q=[128,64,32,16,16,8,8,4],u=d.create();a.SphericalPatch=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../core/Handles ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){function r(x,m){x&&!x.spatialReference.equals(m)&&(x=v.canProject(x.spatialReference,m)?v.project(x,m):null);return x}a.SurfaceExtentHelper=function(x){function m(E){E=x.call(this,E)||this;E._handles=new t;return E}g._inheritsLoose(m,x);var B=m.prototype;B.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};B.destroy=function(){this._handles.destroy();this._handles=null};B._computeStencilEnabledExtents=
function(){const E=[];this.layerViews.forEach(F=>{F=F.layer;"IntegratedMeshLayer"===F.operationalLayerType&&null!=this.spatialReference&&(F=r(F.fullExtent,this.spatialReference),null!=F&&E.push(w.fromExtent(F)))});return E};g._createClass(m,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}},{key:"spatialReference",
set:function(E){this.tilingScheme||this._set("spatialReference",E)}},{key:"tilingScheme",set:function(E){this._set("tilingScheme",E);this._set("spatialReference",E.spatialReference)}}]);return m}(u);b.__decorate([c.property({readOnly:!0,dependsOn:[]})],a.SurfaceExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],a.SurfaceExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference"]})],
a.SurfaceExtentHelper.prototype,"stencilEnabledExtents",null);b.__decorate([c.property()],a.SurfaceExtentHelper.prototype,"spatialReference",null);b.__decorate([c.property()],a.SurfaceExtentHelper.prototype,"tilingScheme",null);b.__decorate([c.property()],a.SurfaceExtentHelper.prototype,"defaultTiledLayersExtent",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceExtentHelper.prototype,"layers",void 0);b.__decorate([c.property({constructOnly:!0})],a.SurfaceExtentHelper.prototype,"layerViews",
void 0);a.SurfaceExtentHelper=b.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],a.SurfaceExtentHelper);let C=function(x){function m(){return x.apply(this,arguments)||this}g._inheritsLoose(m,x);var B=m.prototype;B._computeLayerViewsExtent=function(){return this._getGlobalExtent()};B._computeTiledLayersExtent=function(){return this._getGlobalExtent()};B._getGlobalExtent=function(){return this.spatialReference.isWebMercator?D.WEBMERCATOR_WORLD_EXTENT:D.GEOGRAPHIC_WORLD_EXTENT};
return m}(a.SurfaceExtentHelper);b.__decorate([c.property({dependsOn:["spatialReference"]})],C.prototype,"layerViewsExtent",void 0);C=b.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],C);let A=function(x){function m(){return x.apply(this,arguments)||this}g._inheritsLoose(m,x);var B=m.prototype;B.initialize=function(){this._handles.add([this.layers.on("change",E=>this._handleLayersChanged(E)),this.layerViews.on("change",()=>this.notifyChange("layerViewsExtent"))])};B._handleLayersChanged=
function(E){for(const F of E.removed)this._handles.remove(F.uid);for(const F of E.added)this._handles.add(l.init(F,"loaded",()=>this.notifyChange("tiledLayersExtent")),F.uid)};B._computeLayerViewsExtent=function(){const E=w.empty(),F=this.spatialReference;this.layerViews.forEach(K=>{const J=K.layer;!K.isResolved()||"graphics"===J.type&&J.internal||(K=r("fullExtentInLocalViewSpatialReference"in K&&K.fullExtentInLocalViewSpatialReference||K.layer.fullExtent,F))&&w.expand(E,K)});const G=w.allFinite(E)?
E:null,I=this._get("layerViewsExtent");return w.equals(G,I)?I:G};B._computeTiledLayersExtent=function(){const E=this.tilingScheme;if(!E)return null;const F=this.spatialReference,G=w.empty();this.layers.forEach(function(J){if(J.loaded&&y.isTiledLayer(J)){const {tileInfo:L,fullExtent:P}=z.getTiledLayerInfo(J,F,2);L&&z.isProjectableRasterLayer(J)&&P?w.expand(G,P):L&&E.compatibleWith(L)&&P&&P.spatialReference.equals(F)&&w.expand(G,P)}});this.defaultTiledLayersExtent&&w.expand(G,this.defaultTiledLayersExtent);
const I=w.allFinite(G)?G:null,K=this._get("tiledLayersExtent");return w.equals(I,K)?K:I};return m}(a.SurfaceExtentHelper);A=b.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],A);a.create=function(x,m){return"spherical"===x?new C(m):new A(m)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/spatialReferenceUtils ../../../core/Handles ../../../geometry/projection ../../../layers/support/layerUtils ./TilingScheme ./terrainUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){b=function(D){function z(C){C=D.call(this,C)||this;C._changeHandles=new v;return C}a._inheritsLoose(z,D);var r=z.prototype;r.initialize=function(){this._changeHandles.add(this.layers.on("change",()=>this._update()));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};r.destroy=function(){this._changeHandles.destroy();this._waitTask=this._changeHandles=
null};r._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var C;this.layers.some(x=>!l.isTiledLayer(x)||x.isRejected()?!1:!x.isFulfilled()||y.getTiledLayerInfo(x,this.viewSpatialReference,this.manifold).tileInfo?(C=x,"vector-tile"!==x.type&&!y.isProjectableRasterLayer(x)):!1);if(C)if(C.isResolved()){var {tileInfo:A}=y.getTiledLayerInfo(C,this.viewSpatialReference,this.manifold);A=new w(A);this._set("tilingSchemeDone",!0);this._lockTilingScheme(A)}else this._updateWhen(C);
else this._set("tilingSchemeDone",!0)}};r._updateWhen=function(C){const A=C.when().catch(x=>x).then(()=>{A!==this._waitTask||this.destroyed||this._update()});this._waitTask=A};r._lockTilingScheme=function(C){if("spherical"===this.manifold){const A=C.levels.length-1;C.spatialReference.isWebMercator?C=w.makeWebMercatorAuxiliarySphere(A):t.canProjectToWGS84ComparableLonLat(C.spatialReference)&&(C=w.makeGCSWithTileSize(C.spatialReference,C.pixelSize,A))}this.tilingSchemeLocked=!0;this.tilingScheme=C;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};r._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};r._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var C=this.extentHelper.spatialReference;const A=t.canProjectToWGS84ComparableLonLat(C)||u.isMars(C)||u.isMoon(C);C.isWebMercator?
this.tilingScheme=w.WebMercatorAuxiliarySphere:A&&(this.tilingScheme=w.makeGCSWithTileSize(C,256));this.extent=this.extentHelper.layerViewsExtent}else if(C=this.extentHelper.layerViewsExtent)this.tilingScheme=w.fromExtent(C,this.extentHelper.spatialReference),this.extent=C};return z}(q);g.__decorate([k.property()],b.prototype,"tilingScheme",void 0);g.__decorate([k.property()],b.prototype,"extent",void 0);g.__decorate([k.property({value:!1})],b.prototype,"tilingSchemeLocked",void 0);g.__decorate([k.property({readOnly:!0,
value:!1})],b.prototype,"tilingSchemeDone",void 0);g.__decorate([k.property({constructOnly:!0})],b.prototype,"viewSpatialReference",void 0);g.__decorate([k.property({constructOnly:!0})],b.prototype,"layers",void 0);g.__decorate([k.property({constructOnly:!0})],b.prototype,"extentHelper",void 0);g.__decorate([k.property({constructOnly:!0})],b.prototype,"manifold",void 0);return b=g.__decorate([d.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],b)})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/ObjectPool ../../../core/PooledArray ../../../core/Accessor ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec4f64 ../../../chunks/vec4 ../support/buffer/BufferView ../../../geometry/support/aaBoundingBox ../../../support/requestImageUtils ./TerrainConst ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./OverlayRenderer ./PatchGeometryFactory ./tileUtils ./PatchRenderData ./TileRenderer ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/statistics/tracer".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R){function T(ia,ma,ea){C.set(ea,ia[0]*ma[2]+ma[0],ia[1]*ma[3]+ma[1],ia[2]*ma[2],ia[3]*ma[3])}const W=x.create(),Y=r.create();let U=function(){this.extent=r.create();this.maxLevel=this.minLevel=0;this.callback=null};b=function(ia){function ma(M){M=ia.call(this,M)||this;M.type="Terrain";M.isGround=!0;M.tileSize=256;M.rctx=null;M._isTransparent=!1;M.renderDataPool=new u(aa.PatchRenderData);M.patchGroups=new v({allocator:Z=>
Z||{root:null,origin:null,patches:new v},deallocator:Z=>{Z.root=null;Z.origin=null;Z.patches.clear();return Z}});M.patchGroupsDirty=!0;M.patchGroupsMap=new Map;M.tileIterator=new X.IteratorPreorder;M.highestVisibleLODTile=null;M.visible=!0;M._opaque=!0;M._skirtScale=1;M._velvetOverground=!0;M.castShadows=!0;M._ssrEnabled=!1;M.emptyTex=null;M.tileRenderer=null;M.tileBackgroundInitialized=!1;M.tileBackgroundUpdating=!1;M.stencilEnabledLayerExtents=[];M.numTrianglesRendered=0;M.numTilesRendered=0;M.numTilesCulled=
0;M.numOriginsRendered=0;M.clippingExtent=null;M.overlayOpacity=1;M.needsHighlight=!1;M.renderOccludedFlags=1;M.visibleScaleRangeQueries=new v({initialSize:10});M.visibleScaleRangeQueriesInvPtr=0;M.visibleScaleRangeQueryQueue=new v({initialSize:30});M.visibleScaleRangeQueryPool=new u(U);return M}a._inheritsLoose(ma,ia);var ea=ma.prototype;ea.destroy=function(){Q.clearCaches()};ea.install=function(M){M.addRenderPlugin([2,7,9],this)};ea.uninstall=function(M){M.removeRenderPlugin(this)};ea.setDebugScreenSizePerspective=
function(M){this.shaderTechniqueConfig.screenSizePerspective!==M&&(this.shaderTechniqueConfig.screenSizePerspective=M,this.setNeedsRender())};ea.setRootTiles=function(M){this.rootTiles=M;this.setNeedsRender()};ea.setNeedsHighlight=function(M){this.needsHighlight=M;this.setNeedsRender()};ea.setRenderOccludedOverlay=function(M){this.renderOccludedFlags=M?P.overlayRenderOccludedFlag:1;this.setNeedsRender()};ea.setStencilEnabledLayerExtents=function(M){this.stencilEnabledLayerExtents=M;this.setNeedsRender()};
ea.setTileSize=function(M){this.tileSize=M;this.tileRenderer&&(this.tileRenderer.tileSize=M);this.setNeedsRender()};ea.loadTile=function(M){M.renderData||(M.renderData=this.renderDataPool.acquire(),M.renderData.init(M),M.renderData.localOrigin=this._getLocalOriginOfTile(M));this.updateTileGeometry(M);this.updateTileTexture(M)};ea.queryVisibleLevelRange=function(M,Z,la,ka){const ha=this.visibleScaleRangeQueryPool.acquire();C.copy(ha.extent,M);ha.minLevel=Z?Z:-Number.MAX_VALUE;ha.maxLevel=null!=la?
la:Number.MAX_VALUE;ha.callback=ka;this.visibleScaleRangeQueryQueue.push(ha);this.setNeedsRender()};ea.updateTileTexture=function(M){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(M),this.setNeedsRender(),M.resetPendingUpdate(64))};ea.updateTileGeometry=function(M){for(const Z of M.layerInfo[0])Z.pendingUpdates&=-33;M.resetPendingUpdate(32);M.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};ea.unloadTile=function(M){M.renderData&&
(this.releaseTileGeometry(M.renderData),M.renderData.clear(),M.renderData=null,M.setMemoryDirty(),this.setNeedsRender())};ea._getLocalOriginOfTile=function(M){const Z=Math.max(0,7*Math.floor((M.lij[0]-3)/7));if("spherical"===this.manifold&&0===Z)return w.ZEROS;for(;M.parent&&M.lij[0]>Z;)M=M.parent;return M.centerAtSeaLevel};ea.setVisibility=function(M){this.visible=M;this.setNeedsRender()};ea.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};ea.setNeedsRender=function(M=1){this.patchGroupsDirty=!0;this.context.requestRender(M)};ea.setTileBackground=function(M){this.tileBackground=M;this._updateTileBackground()};ea.initializeRenderContext=function(M){this.context=M;this.rctx=M.renderContext.rctx;this.shaderTechniques=M.shaderTechniqueRep;this.shaderTechniqueConfig=new H.TerrainTechniqueConfiguration;this.tileRenderer=new S.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&
this._updateTileBackground();this.emptyTex=F.createEmptyTexture(this.rctx)};ea.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};ea.intersect=function(M,Z,la,ka){if(this.rootTiles&&(!M.options.selectOpaqueTerrainOnly||!M.options.selectionMode||this._opaque)){var ha=O,na=V;y.subtract(ha,ka,la);y.set(na,1/ha[0],1/ha[1],1/ha[2]);var da=M.results.min,oa=M.results.max,qa=M.results.ground,
ua=0===M.options.store,Ca=!!M.results.ground.target,Ja,Ha=this.clippingExtent,Na=this.tileIterator;Na.reset(this.rootTiles);for(var Oa=G.getVerticalOffsetTerrain(M.verticalOffset);!Na.done;){const wa=Na.next();if(null===wa.renderData||Ca&&this._useStencilForTile(wa))continue;if(M.options.invisibleTerrain){if(!wa.visible&&Ha&&!wa.intersectsExtent(Ha))continue}else if(!wa.visible)continue;var Va=wa.renderData.geometryInfo;x.set(W,Va.boundingBox);const Ea=wa.renderData.localOrigin;p.isSome(Oa)&&(Oa.localOrigin=
Ea,Oa.applyToAabb(W));const Pa=-this._skirtScale*Va.skirtLength;if(0!==Pa){var Ka=wa.up;x.expandWithOffset(W,Pa*Ka[0],Pa*Ka[1],Pa*Ka[2])}Ka=W;y.subtract(ba,la,Ea);if(!K.intersectAabbInvDirBefore(Ka,ba,na,M.tolerance,ua&&null!=da.dist?da.dist:Infinity))continue;const ja=(Xa,ta,Ba,va)=>{Xa.set(void 0,X.tile2str(ta),Ba,va,z.IDENTITY,void 0);Xa.intersector="TerrainRenderer";Xa.target={type:"external",metadata:{tile:ta}}};Ka=(Xa,ta)=>{0<=Xa&&(M.options.backfacesTerrain||0>y.dot(ta,ha))&&(M.options.invisibleTerrain||
!M.options.selectionMode||null==Z||Z(la,ka,Xa))&&((null==qa.dist||Xa<qa.dist)&&ja(qa,wa,Xa,ta),M.options.isFiltered||(2===M.options.store&&(p.isNone(Ja)?(Ja=new G.IntersectorResult(M.ray),ja(Ja,wa,Xa,ta),M.results.all.push(Ja)):Xa<Ja.dist&&ja(Ja,wa,Xa,ta)),(null==da.dist||Xa<da.dist)&&ja(da,wa,Xa,ta),0!==M.options.store&&(null==oa.dist||Xa>oa.dist)&&ja(oa,wa,Xa,ta)))};const Ya=fa;y.subtract(Ya,ka,Ea);const ab=Va.indices,cb=Va.vertexAttributes,lb={data:cb.getField("position",A.BufferViewVec3f).typedBuffer,
size:3,stride:cb.stride/4};Va=Va.numWithoutSkirtIndices/3;K.intersectTriangles(ba,Ya,0,Va,ab,lb,null,Oa,Ka);0!==Pa&&Q.intersectSkirts(ba,Ya,Va,ab.length/3,ab,cb,"spherical"===this.manifold?Xa=>y.scale(Xa,Xa,Pa/y.length(y.add(Xa,Xa,Ea))):Xa=>y.set(Xa,0,0,Pa),Oa,Ka)}}};ea.render=function(M){if(9===M.slot){if(0===(M.renderOccludedMask&P.overlayRenderOccludedFlag))return!1}else if(M.slot!==(this.opaque?2:7))return!1;R.trace("# BEGIN RENDER TERRAIN");var Z=M.pass;const la=1===M.scenelightingData.globalFactor,
ka=this._updatePatchGroups();switch(Z){case 0:Z=M.shadowMap&&M.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==Z&&(this.shaderTechniqueConfig.receiveShadows=Z);Z=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==Z&&(this.shaderTechniqueConfig.overlayMode=Z);this._renderMaterialPass(M,0,ka,9===M.slot?3:1);break;case 4:case 6:this.castShadows&&la&&this._renderAuxiliaryPass(M,3,ka,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||
this._renderAuxiliaryPass(M,1,ka,0);break;case 3:this._renderAuxiliaryPass(M,2,ka,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(M,4,ka,2),M.rctx.clearSafe(256))}R.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};ea._renderMaterialPass=function(M,Z,la,ka){const ha=M.rctx,na=M.camera;this._ssrEnabled=M.ssrParams.ssrEnabled;this._setTerrainTechnique(Z,3===ka);const da=this.shaderTechnique.program;M.rctx.bindProgram(da);ha.bindProgram(da);
1===ka&&M.ssrParams&&(M.ssrParams.lastFrameColorTextureUnit=9,M.ssrParams.linearDepthTextureUnit=8,L.ScreenSpaceReflections.bindUniforms(da,ha,M.ssrParams));M.shadowMap&&M.shadowMap.bind(da,7);M.ssaoHelper&&M.ssaoHelper.setUniforms(da,6);da.setUniform1i("tex",0);da.setUniform1i("texNext",1);this._bindOverlayData(da,ka);da.setUniformMatrix4fv("viewNormal",na.viewInverseTransposeMatrix);E.View.bindProjectionMatrix(da,na.projectionMatrix);M.scenelightingData.setUniforms(da,!0);Z=na.viewMatrix;y.set(ca,
Z[12],Z[13],Z[14]);y.normalize(ca,ca);da.setUniform3fv("viewDirection",ca);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(M,da,la,ka):M.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(M,da,la,ka),M.offscreenRenderingHelper.tmpColor,M.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};ea._renderAuxiliaryPass=function(M,Z,la,ka){this._setTerrainTechnique(Z,
3===ka);Z=this.shaderTechnique.program;M.rctx.bindProgram(Z);if(5===M.pass){const ha=M.offscreenRenderingHelper;M.rctx.bindTexture(ha.depthTexture,6);Z.setUniform1i("depthTex",6);Z.setUniform4f("highlightViewportPixelSz",0,0,1/ha.width,1/ha.height)}else Z.setUniformMatrix4fv("viewNormal",M.camera.viewInverseTransposeMatrix),2!==M.pass&&4!==M.pass&&6!==M.pass||Z.setUniform2fv("nearFar",M.camera.nearFar);this._renderPatchGroupsAuxiliary(M,Z,la,ka)};ea._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=
!0;var M=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!p.isSome(this.tileRenderer.backgroundColor);this.rootTiles&&X.traverseTilesPreorder(this.rootTiles,Z=>{this.tileRenderer.updateTileTexture(Z);this.setNeedsRender()});this.setNeedsRender()};if("string"===typeof this.tileBackground){const Z=this.tileBackground;m.requestImage(Z).then(la=>
{Z===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(la,this.tileBackground===B.DEFAULT_TILE_BACKGROUND),M())})}else{const Z=this.tileBackground?l.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(Z,!1);M()}}};ea._updatePatchGroups=function(){const M=this.patchGroups;if(!this.patchGroupsDirty)return M;this.highestVisibleLODTile=null;this._renderCollectOrigins(M);if(0!==this.renderOrder){for(let Z=0;Z<M.length;Z++)X.sortTiles(this.renderOrder,M.data[Z].patches);
M.sort((Z,la)=>{var ka=this.renderOrder;Z=0===Z.patches.length?-ka:0===la.patches.length?ka:X.compareTiles(Z.patches.data[0],la.patches.data[0],ka);return Z})}this.patchGroupsDirty=!1;return M};ea._renderCollectOrigins=function(M){var Z=this.rootTiles;const la="spherical"===this.manifold;M.clear();for(const ka of Z)Z=M.pushNew(),Z.root=ka,Z.origin=la?w.ZEROS:ka.centerAtSeaLevel,Z.patches.clear(),this._renderCollectOriginsForRoot(M,Z);M.filterInPlace(ka=>0<ka.patches.length)};ea._renderCollectOriginsForRoot=
function(M,Z){const la=this.tileIterator;la.resetOne(Z.root);const ka=this.patchGroupsMap;ka.clear();for(ka.set(Z.origin,Z);!la.done;){Z=la.next();var ha=Z.renderData;if(ha&&!Z.visible)this.numTilesCulled++,la.skipSubtree();else{if(0===Z.lij[0]%7){const na=M.pushNew();na.root=Z;na.origin=Z.centerAtSeaLevel;ka.set(Z.centerAtSeaLevel,na);na.patches.clear()}if(!Z.rendered)this.numTilesCulled++;else if(ha){(ha=ka.get(ha.localOrigin))&&ha.patches.push(Z);if(!this.highestVisibleLODTile||Z.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=
Z;la.skipSubtree()}}}};ea._scaleQueriesForTile=function(M){const Z=M.extent;M=M.lij[0];let la=0;for(;la<this.visibleScaleRangeQueriesInvPtr;){const ka=this.visibleScaleRangeQueries.data[la],ha=ka.extent;M>=ka.minLevel&&M<=ka.maxLevel&&ha[0]<=Z[2]&&ha[2]>=Z[0]&&ha[1]<=Z[3]&&ha[3]>=Z[1]?(this.visibleScaleRangeQueries.swapElements(la,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):la++}};ea._useStencilForTile=function(M){for(const Z of this.stencilEnabledLayerExtents)if(M.intersectsExtent(Z))return!0;
return!1};ea._renderPatchGroupsAuxiliary=function(M,Z,la,ka){this.shaderTechnique.bindPipelineState(M.rctx);const ha=0<this.stencilEnabledLayerExtents.length;Z.setUniformMatrix4fv("proj",M.camera.projectionMatrix);Z.setUniform1f("skirtScale",this._skirtScale);0!==ka&&this._bindOverlayData(Z,ka);for(let na=0;na<la.length;na++){const da=la.data[na];this._bindPatchGroupData(Z,da,M.camera.eye,M.camera.viewMatrix);for(let oa=0;oa<da.patches.length;oa++)this._renderPatch(M.rctx,Z,da.patches.data[oa],4,
ha,ka)}M.rctx.bindVAO(null)};ea._renderPatchGroups=function(M,Z,la,ka){const ha=M.rctx,na=M.camera,da=na.viewMatrix;this.shaderTechnique.bindPipelineState(ha);if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var oa=I.getSettings("spherical"===this.manifold?1:2,this.ellipsoidRadius);oa.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:na.fovY});K.bindScreenSizePerspective(oa,Z,"screenSizePerspective")}oa=0<this.stencilEnabledLayerExtents.length;
const qa=3===ka;qa&&(ha.bindTexture(this.emptyTex,0),Z.setUniform1f("blend",1),Z.setUniform4fv("texOffsetAndScale",r.ZEROS));var ua=p.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:r.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&Z.setUniform4fv("backgroundColor",ua);Z.setUniform1f("skirtScale",qa?0:this._skirtScale);ua=this.wireframe?1:4;for(let Ha=0;Ha<la.length;Ha++){var Ca=la.data[Ha];const Na=Ca.patches;if(0!==Na.length)for(this._bindPatchGroupData(Z,Ca,na.eye,
da),J.Slice.bindUniforms(Z,this.shaderTechnique.configuration,M.sliceHelper&&M.sliceHelper.plane,Ca.origin),M.shadowMap&&M.shadowMap.bindView(Z,Ca.origin),this.numOriginsRendered++,Ca=0;Ca<Na.length;Ca++){const Oa=Na.data[Ca];var Ja=Oa.renderData.textureReference;if(!p.isNone(Ja)){R.trace("# RENDER TILE "+X.tile2str(Oa)+", screenDepth:"+Oa.screenDepth);if(!qa){this._scaleQueriesForTile(Oa);T(Oa.renderData.geometryInfo.uvOffsetAndScale,Ja.offsetAndScale,Y);Z.setUniform4fv("texOffsetAndScale",Y);ha.bindTexture(Ja.texture.texture,
0);Ja=Oa.renderData.textureFadeFactor;const Va=1>Ja?Oa.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&p.isSome(Va)?(T(Oa.renderData.geometryInfo.uvOffsetAndScale,Va.offsetAndScale,Y),Z.setUniform1f("textureFadeFactor",Ja),Z.setUniform4fv("nextTexOffsetAndScale",Y),ha.bindTexture(Va.texture.texture,1)):(Z.setUniform1f("textureFadeFactor",1),ha.bindTexture(this.emptyTex,1));Oa.renderData.textureIsFading&&this.setNeedsRender();Z.setUniform1f("opacity",Oa.renderData.opacity);
Z.setUniform1i("compositeBackground",Oa.renderData.compositeBackgroundInShader?1:0);Z.setUniform1f("textureOpacity",Oa.renderData.layerOpacity);Z.setUniform1f("baseOpacity",Oa.renderData.baseOpacity)}Ja=this._renderPatch(ha,Z,Oa,ua,oa,ka);Oa.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=Ja/3}}}ha.bindVAO(null)};ea._renderPatch=function(M,Z,la,ka,ha,na){0!==na&&this._bindOverlayPatchData(Z,la.renderData.overlay);ha&&(this._useStencilForTile(la)?this.stencilShaderTechnique.bindPipelineState(M):
this.shaderTechnique.bindPipelineState(M));ha=0===this._skirtScale?la.renderData.geometryInfo.numWithoutSkirtIndices:la.renderData.vao.indexBuffer.size;M.bindVAO(la.renderData.vao);Z.assertCompatibleVertexAttributeLocations(la.renderData.vao);M.drawElements(ka,ha,la.renderData.vao.indexBuffer.indexType,0);return ha};ea._bindPatchGroupData=function(M,Z,la,ka){M.setUniform3fv("origin",Z.origin);D.translate(N,ka,Z.origin);M.setUniformMatrix4fv("view",N);M.setUniform3f("camPos",la[0]-Z.origin[0],la[1]-
Z.origin[1],la[2]-Z.origin[2])};ea._bindOverlayData=function(M,Z){M.setUniform1i("ovInnerColorTex",2);M.setUniform1i("ovOuterColorTex",3);M.setUniform1i("ovInnerWaterTex",4);M.setUniform1i("ovOuterWaterTex",5);M.setUniform1f("overlayOpacity",this.overlayOpacity);const la=this.overlayRenderer.overlays;M=ka=>{if(p.isSome(la)){var ha=la[ka];const na=(1===Z?ha.renderTargets.color:2===Z?ha.renderTargets.highlight:ha.renderTargets.occluded).fbo.getTexture();this.rctx.bindTexture(na,2+ka);(ha=1===Z?ha.renderTargets.water:
null)?(ha=ha.fbo.getTexture(),this.rctx.bindTexture(ha,4+ka)):this.rctx.bindTexture(this.emptyTex,4+ka)}else this.rctx.bindTexture(this.emptyTex,2+ka),this.rctx.bindTexture(this.emptyTex,4+ka)};M(0);M(1)};ea._bindOverlayPatchData=function(M,Z){M.setUniform4fv("overlayTexOffset",Z.offsets);M.setUniform4fv("overlayTexScale",Z.scales)};ea._setTerrainTechnique=function(M,Z){this.shaderTechniqueConfig.output=M;0===M&&(this.shaderTechniqueConfig.atmosphere="spherical"===this.manifold&&this._velvetOverground,
this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=Z;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(H.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(H.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};ea.releaseTileGeometry=
function(M){M.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(M)};ea._prepareScaleRangeQueries=function(){const M=this.visibleScaleRangeQueries,Z=this.visibleScaleRangeQueryQueue;for(;M.length<M.data.length&&0<Z.length;){const la=Z.pop();M.push(la)}this.visibleScaleRangeQueriesInvPtr=M.length};ea._processScaleRangeQueries=function(){const M=this.visibleScaleRangeQueries,Z=this.visibleScaleRangeQueryPool;for(let la=0;la<M.length;la++){const ka=M.data[la];Z.release(ka);ka.callback(la>=
this.visibleScaleRangeQueriesInvPtr);ka.callback=null}M.clear()};a._createClass(ma,[{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(M){this._set("renderingDisabled",!!M);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},
set:function(M){this._opaque!==M&&(this._opaque=M,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(M){this._isTransparent!==M&&(this._isTransparent=M,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(M){M!==this._skirtScale&&(this._skirtScale=M,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},
set:function(M){this.shaderTechniqueConfig.tileBorders!==M&&(this.shaderTechniqueConfig.tileBorders=M,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(M){this.shaderTechniqueConfig.backfaceCullingEnabled!==M&&(this.shaderTechniqueConfig.backfaceCullingEnabled=M,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(M){this._set("renderOrder",
M);this.setNeedsRender()}},{key:"velvetOverground",set:function(M){this._velvetOverground!==M&&(this._velvetOverground=M,this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return G.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(M){this.shaderTechniqueConfig.slicePlaneEnabled!==M&&(this.shaderTechniqueConfig.slicePlaneEnabled=M,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(M){this.shaderTechniqueConfig.textureFadingEnabled!==
M&&(this.shaderTechniqueConfig.textureFadingEnabled=M,this.setNeedsRender())}},{key:"wireframe",set:function(M){this._get("wireframe")!==M&&(this._set("wireframe",M),this.rootTiles&&(X.traverseTilesPreorder(this.rootTiles,Z=>{Z.renderData&&Z.renderData.updateGeometry(this.rctx,M)}),this.setNeedsRender()))}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return ma}(t);g.__decorate([c.property()],b.prototype,"tileBackgroundInitialized",void 0);g.__decorate([c.property()],b.prototype,
"tileBackgroundUpdating",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"manifold",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"overlayRenderer",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"ellipsoidRadius",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"updating",null);g.__decorate([c.property({value:!1})],b.prototype,"renderingDisabled",null);g.__decorate([c.property()],b.prototype,"renderPatchBorders",null);g.__decorate([c.property()],
b.prototype,"cullBackFaces",null);g.__decorate([c.property({value:1})],b.prototype,"renderOrder",null);g.__decorate([c.property()],b.prototype,"wireframe",null);g=b=g.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],b);const N=z.create(),ca=w.create(),O=w.create(),V=w.create(),ba=w.create(),fa=w.create();return g})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/arrayUtils ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../../webgl/BufferObject ../../webgl/VertexArrayObject ./PatchGeometryFactory ./tileUtils ./TextureFader ./TileOverlayData".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){let l=function(){function w(){this.geometryInfo=new q.PatchGeometry;this._textureRef=new v["default"](()=>this.tile.surface.textureFadeDuration);this.overlay=new t}var y=w.prototype;y.init=function(D){this.tile=D;this.clear();D=this.geometryInfo;D.indices=null;D.vertexAttributes=null;k.empty(D.boundingBox);D.numSurfaceIndices=0;D.numSkirtIndices=0;D.numWithoutSkirtIndices=0;D.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,
wireframe:!1};this.opacity=1;this.localOrigin=null;this.overlay.clear()};y.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};y.updateGeometry=function(D,z){if(!this._updateGeometryState(z))return!1;this._releaseGeometry();this._createGeometry(D);return!0};y.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};y.ensureTexture=function(D,z){b.isSome(this._texture)&&
this._texture.descriptor.width!==D&&this.releaseTexture();this._texture||(this._texture=z(),this.tile.setMemoryDirty());return this._texture};y.releaseTexture=function(){b.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};y._updateGeometryState=function(D){const z=this._getElevationInfo();var r=this.tile.level,C=8>r?this.tile.numSubdivisionsAtLevel[r]+1:2;z.samplerData&&(C=this.tile.maxTesselation,C=f.clamp((C>>Math.max(r-z.maxTileLevel,c.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-r)))+1,2,C+1));r=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)r=null;const A=this.geometryState;let x=!1;A.numVertsPerRow!==C&&(A.numVertsPerRow=C,x=!0);z.changed&&(A.samplerData=z.samplerData,x=!0);p.equals(A.clippingArea,r)||(A.clippingArea=r,x=!0);A.wireframe!==D&&(A.wireframe=D,x=!0);return x};y._createGeometry=function(D){this.tile.createGeometry(this.geometryState,this.localOrigin);const z=this.geometryInfo.vertexAttributes,r=
this.geometryInfo.indices,C=D.gl;this._vao=new n(D,d.Default3D,{geometry:e.glLayout(z.layout)},{geometry:h.createVertex(D,C.STATIC_DRAW,z.buffer)},h.createIndex(D,C.STATIC_DRAW,r))};y._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;q.releaseGeometry(this.geometryInfo);return!0};y.setTextureReference=function(D,z,r,C,A=0){D!==this._texture&&this.releaseTexture();this._textureRef.push(D,z,r,C,A)};y._getElevationInfo=function(){const D=this.geometryState.samplerData,
z=this.tile.layerInfo[0],r=z.length;let C=Array(r),A=0;var x=0;let m=!1;for(let F=0;F<r;F++){var B=z[F];if(B.upsampleInfo){B=B.upsampleInfo.tile;var E=B.layerInfo[0][F].data;E=E&&E.samplerData;D&&D[A]===E||(m=!0);C[A++]=E;x=Math.max(x,B.lij[0])}else B.data&&(E=this.tile.surface.layerViewByIndex(F,0),u.fallsWithinLayer(this.tile,E.layer,!1)&&(x=B.data,D&&D[A]===x.samplerData||(m=!0),C[A++]=x.samplerData,x=this.tile.lij[0]))}D&&D.length!==A&&(m=!0);0<A?C.length=A:C=null;return{changed:m,samplerData:C,
maxTileLevel:x}};g._createClass(w,[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength}},
{key:"textureDescriptor",get:function(){return b.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return w}();a.PatchRenderData=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec4f64"],function(a,g,b,p){let f=function(){function c(e){this._getFadeDuration=e;this._delayedTime=
this._fadeStart=0}var d=c.prototype;d.clear=function(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);this._delayed=b.destroyMaybe(this._delayed)};d.push=function(e,h,n,q,u=0){this._delayed=b.destroyMaybe(this._delayed);e=b.isSome(e)?new k(e,h,n,q):null;this._push(e,u)};d._push=function(e,h){this._isFading||this.clear();if(b.isNone(this._current))this._current=e;else{var n=performance.now();0!==h?(this._delayed=e,this._delayedTime=
n+h):b.isNone(this._next)?(this._next=e,this._fadeStart=n):b.isNone(e)||(b.destroyMaybe(this._waiting),this._waiting=e)}};g._createClass(c,[{key:"current",get:function(){if(b.isNone(this._current))return null;if(!this._isFading){var e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}e=0;b.isSome(this._delayed)&&(e=performance.now(),e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null));b.isSome(this._next)&&
(e=e||performance.now(),e-this._fadeStart>=this._fadeDuration&&(b.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=e));return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(b.isNone(this._next))return 1;const e=performance.now()-this._fadeStart,h=this._fadeDuration;return e>h?0:1-e/h}},{key:"isFading",get:function(){return b.isSome(this._next)||b.isSome(this._delayed)}},{key:"_fadeDuration",
get:function(){return b.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFading",get:function(){return 0<this._getFadeDuration()}}]);return c}(),k=function(){function c(d,e,h,n){this.texture=d;d.retain();this.offsetAndScale=p.fromValues(e,h,n,n)}c.prototype.destroy=function(){this.texture.release()};return c}();a.TextureReference=k;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],
function(a){return function(){function g(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var b=g.prototype;b.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};b.setScale=function(p,f,k){this._scales[2*p]=f;this._scales[2*p+1]=k};b.setOffset=function(p,f,k){this._offsets[2*p]=f;this._offsets[2*p+1]=k};a._createClass(g,[{key:"scales",get:function(){return this._scales}},{key:"offsets",
get:function(){return this._offsets}}]);return g}()})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/mathUtils ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../layers/support/layerUtils ../../webgl/Program ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Renderbuffer ../../webgl/FramebufferObject ../../webgl/ProgramCache ../../webgl/RenderingContext ../../webgl/ShaderCompiler ../support/StreamDataLoader ../../webgl/rasterUtils ./TileTexture ./terrainUtils ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./RasterColorizerTechnique ./support/FBOPool".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(J,L,P){P.layerIndex=L;const Q=J.layerInfo[1][L];return Q.data?(c.set(P.offset,0,0),P.tile=J,P.scale=1,P.sourceLod=J.lij,P.sourceLayerInfo=Q,P):(J=Q.upsampleInfo)?(L=J.tile.layerInfo[1][L],P.tile=J.tile,c.copy(P.offset,J.offset),P.scale=J.scale,P.sourceLod=J.tile.lij,P.sourceLayerInfo=L,P):null}e=function(){function J(P,Q,X){this._rctx=P;this.tileSize=Q;this._backgroundIsGrid=!1;this._blackTex=this._backgroundColor=this._backgroundTexture=
null;this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._rctx.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy);this._vaoQuad=t.createQuadVAO(this._rctx,v.Pos2Tex);P=new B.BlendLayersTechniqueConfiguration;P.mode=2;this._blendLayersTechnique=X.acquire(B.BlendLayersTechnique,P);P.mode=1;this._applyOpacityTechnique=X.acquire(B.BlendLayersTechnique,P);this._techniqueRep=X;this._blackTex=new A(t.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=
new F.FBOPool(this._rctx)}var L=J.prototype;L.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad=b.disposeMaybe(this._vaoQuad);this._backgroundTexture=b.releaseMaybe(this._backgroundTexture);this._blackTex=b.releaseMaybe(this._blackTex);this._blendLayersTechnique=b.disposeMaybe(this._blendLayersTechnique);this._applyOpacityTechnique=b.disposeMaybe(this._applyOpacityTechnique);this._vectorTileHelper=b.disposeMaybe(this._vectorTileHelper)};L.updateTileTexture=
function(P){var Q=P.layerInfo[1];for(var X of Q)X.pendingUpdates&=-65;if(P.renderData){var aa=P.surface,S=aa.baseOpacity,H=0;X=0;for(var R=this.tileSize,T=!1,W=aa.view.pixelRatio,Y=Q.length,U=0;U<Q.length&&!T;U++){const N=aa.layerViewByIndex(U,1),ca=N.fullOpacity;I[U]=ca;d.isBaseLayer(N.layer)&&Y>=Q.length&&(Y=U);if(0===ca)continue;++X;const O=G(P,U,K);O&&(x.isVectorTileLayerView(N)?R=Math.max(R,this.tileSize*W):1===S&&1===ca&&(N.isOpaque||this._dataToTexture(O)&&b.isSome(O.sourceLayerInfo.data)&&
O.sourceLayerInfo.data.descriptor.isOpaque)&&(T=!0),++H)}this._cleanupFBOPool(W,Q.length);S=R;R=p.nextHighestPowerOfTwo(S);Q=R*R;aa=S*S;Q===aa?R=S:(S=R/2,R=Q-aa<aa-S*S?R:S);Q=R/this.tileSize;--U;if(0===H){H=0;if(P.surface.view.layerViewManager.updating||0<X)H=5E3;this._backgroundTexture&&b.isNone(P.renderData.textureReference)&&(H=0);this._useBackgroundTexture(P,H)}else 1===H&&(T||this._backgroundIsGrid||b.isSome(this._backgroundColor))&&this._useLayerTexture(P,U,Y,I[U])||this._composeMapLayers(P,
U,Y,T,I,R,Q)}};L.setBackground=function(P,Q){b.releaseMaybe(this._backgroundTexture);this._backgroundIsGrid=Q;P instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(P),this._backgroundColor=null):(this._backgroundTexture=new A(t.createColorTexture(this._rctx,P)),this._backgroundColor=k.fromValues(P[0]||0,P[1]||0,P[2]||0,P[3]||0))};L._buildTexture=function(P){if(b.isNone(P))return null;const Q={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,
flipped:!0,hasMipmap:!0},X=this._rctx;let aa;if("number"===typeof P)Q.width=Q.height=P,aa=new A(new n(X,Q));else if(P instanceof r.ImageWithType)Q.isOpaque=P.isOpaque,aa=new A(new n(X,Q,P.image)),P.release();else try{aa=new A(new n(X,Q,P))}catch(S){aa=new A(t.createEmptyTexture(X)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}X.bindTexture(aa.texture,0);aa.generateMipmap();return aa};L._drawQuad=function(P){this._rctx.bindVAO(this._vaoQuad);P.assertCompatibleVertexAttributeLocations(this._vaoQuad);
this._rctx.drawArrays(5,0,q.vertexCount(this._vaoQuad,"geometry"))};L._drawRasterData=function(P,Q,X,aa,S=1){if(!b.isNone(Q)){var H=this._rctx,R=P.program;H.setPipelineState(P.pipeline);H.bindProgram(R);H.bindTexture(Q,0);R.setUniform1i("tex",0);R.setUniform1f("scale",X);R.setUniform2f("offset",aa[0],aa[1]);R.setUniform1f("opacity",S);this._drawQuad(R)}};L._drawImageryTileData=function(P,Q=1){const X=P.sourceLayerInfo.data;if(!b.isNone(X)&&X.source){P.tile.surface.layerViewByIndex(P.layerIndex,1).ensureSymbolizerParameters(X);
var aa=this._getRasterColorizerTechnique(X.symbolizerParameters.type,!!X.symbolizerParameters.colormap),S=this._rctx,H=aa.program;S.setPipelineState(aa.pipeline);S.bindProgram(H);if(X.bind(S)){X.opacity=Q;X.scale=P.scale;X.offset=P.offset;var {names:R,textures:T}=X.getTextures();C.setTextures(S,H,R,T);P=X.getUniforms();aa.bindPass(S,P);this._drawQuad(H);S.bindVAO()}}};L._getRasterColorizerTechnique=function(P,Q){P=["stretch","lut","hillshade"].indexOf(P);this._rasterColorizerConfig||(this._rasterColorizerConfig=
new E.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=P;this._rasterColorizerConfig.applyColormap=Q;return this._rasterColorizerTechnique=this._techniqueRep.acquireAndReleaseExisting(E.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};L._drawVectorData=function(P,Q,X,aa,S,H,R){const T=Q.sourceLayerInfo.data;if(b.isNone(T))return R;
const W=this._rctx,Y=Q.tile.surface.layerViewByIndex(Q.layerIndex,1);let U;W.setPipelineState(P.pipeline);const N=1>aa;N?(U=this._fboPool.acquire(S),W.bindFramebuffer(U),W.setClearColor(1,1,1,0),W.clearSafe(16640)):R&&W.clearSafe(256);this._vectorTileHelper.render(W,Q.sourceLod,T,Y.painter,Y.layer.styleRepository,Y.schemaHelper,Math.round(1/Q.scale),Q.offset,this.tileSize,X);return N?(W.bindFramebuffer(H),this._drawRasterData(P,U.colorTexture,1,[0,0],aa),this._fboPool.release(U),R):!0};L._useBackgroundTexture=
function(P,Q){P.renderData.opacity=P.surface.baseOpacity;P.renderData.compositeBackgroundInShader=!1;P.renderData.layerOpacity=1;P.renderData.baseOpacity=1;P.renderData.setTextureReference(this._backgroundTexture,0,0,1,Q)};L._useLayerTexture=function(P,Q,X,aa){X=Q<X;P.renderData.opacity=X?1:P.surface.baseOpacity;P.renderData.compositeBackgroundInShader=!0;P.renderData.layerOpacity=aa;P.renderData.baseOpacity=X?P.surface.baseOpacity:1;Q=G(P,Q,K);return this._dataToTexture(Q)?(aa=Q.offset,P.renderData.setTextureReference(Q.sourceLayerInfo.data,
aa[0],aa[1],Q.scale),!0):!1};L._composeMapLayers=function(P,Q,X,aa,S,H,R){const T=P.renderData.ensureTexture(H,()=>this._buildTexture(H));if(!b.isNone(T)){var W=this._rctx,Y=this._fboPool.acquire(H);W.bindFramebuffer(Y);W.setViewport(0,0,H,H);W.setClearColor(0,0,0,0);W.setClearDepth(1);W.clearSafe(16640);var U=!1;!aa&&b.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,f.ZEROS);aa=P.surface.baseOpacity;for(var N=!1;0<=Q;Q--){const ca=
G(P,Q,K);ca&&(Q<X&&1>aa&&!N&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,f.ZEROS,aa),N=!0),0!==S[Q]&&(x.isVectorTileRenderInfo(ca)?U=this._drawVectorData(this._blendLayersTechnique,ca,R,S[Q],H,Y,U):x.isImageryTileRenderInfo(ca)?this._drawImageryTileData(ca,S[Q]):this._dataToTexture(ca)&&b.isSome(ca.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,ca.sourceLayerInfo.data.texture,ca.scale,ca.offset,S[Q])))}W.bindTexture(T.texture,0);X=T.descriptor;
W.gl.copyTexImage2D(W.gl.TEXTURE_2D,0,X.pixelFormat,0,0,X.width,X.height,0);T.generateMipmap();W.bindFramebuffer(null);this._fboPool.release(Y);P.renderData.opacity=N?1:aa;P.renderData.compositeBackgroundInShader=!1;P.renderData.layerOpacity=1;P.renderData.baseOpacity=1;P.renderData.setTextureReference(T,0,0,1)}};L._dataToTexture=function(P){x.isRasterTileRenderInfo(P)&&this._rasterDataToTexture(P);return x.isTextureTileRenderInfo(P)};L._rasterDataToTexture=function(P){const Q=P.sourceLayerInfo;Q.data=
this._buildTexture(Q.data);P.tile.setMemoryDirty()};L._cleanupFBOPool=function(P,Q){if(P!==this._lastPixelRatio||Q!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=P,this._lastNumLayers=Q};g._createClass(J,[{key:"backgroundIsGrid",get:function(){return this._backgroundIsGrid}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return J}();const I=[],K={tile:null,sourceLayerInfo:null,
sourceLod:null,offset:[0,0],scale:1,layerIndex:0};a.TileRenderer=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry/Point","../../../../geometry","../../../../Viewpoint","../../ViewState"],function(a,g,b,p,f){b=function(){function k(){this._renderParams={context:null,drawPhase:1,state:new f({viewpoint:new p({targetGeometry:new g(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,
pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var c=k.prototype;c.dispose=function(){this._renderParams=null};c.render=function(d,e,h,n,q,u,v,t,l,w){const y=u.adjustLevel(e[0]),D=this._renderParams;
D.context=d;D.painter=n;D.glyphMosaic=n.glyphMosaic;D.spriteMosaic=n.spriteMosaic;D.pixelRatio=w;D.displayLevel=y;D.requiredLevel=y;w=u.getScale(e[0]);const [z,r]=u.getShift(e,v*w);e=.125*v*w/l;u=h.transforms.dvs;u[0]=e;u[4]=-e;u[6]=-1-z-t[0]*v*2;u[7]=1+r+(1-t[1])*v*2-2;D.state.size[0]=l;D.state.size[1]=l;h.stage||h.attachWithContext(d);h.triangleCount=0;n.drawTile(D,h,q)};return k}();a.VectorTileRendererHelper3D=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/Point ../../geometry/Extent ../../geometry ../../chunks/common ../../Viewpoint ../../chunks/vec2f64 ../../chunks/mat3 ../../chunks/vec2 ../../chunks/mat2d ../../chunks/mat2df64 ./viewpointUtils ../../chunks/mat2df32 ../../chunks/mat3f32 ../../chunks/vec2f32 ../../core/libs/gl-matrix-2/types/vec2".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E){var F;const G=[0,0];b=F=function(I){function K(...L){L=I.call(this,...L)||this;L._viewpoint2D={center:y.create(),rotation:0,scale:0,spatialReference:null};L.center=[0,0];L.extent=new v;L.id=0;L.inverseTransform=C.create();L.resolution=0;L.rotation=0;L.scale=0;L.transform=C.create();L.transformNoRotation=C.create();L.displayMat3=m.create();L.displayViewMat3=m.create();L.viewMat3=m.create();L.viewMat2d=x.create();L.worldScreenWidth=0;L.size=
[0,0];return L}a._inheritsLoose(K,I);var J=K.prototype;J.copy=function(L){const P=this.size,Q=this.viewpoint;Q&&P?(this.viewpoint=A.copy(Q,L.viewpoint),this._set("size",z.copy(P,L.size))):(this.viewpoint=L.viewpoint.clone(),this._set("size",[L.size[0],L.size[1]]));this._set("pixelRatio",L.pixelRatio);return this};J.clone=function(){return new F({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};J.toMap=function(L,P,Q){if(E.isVec2(P))return z.transformMat2d(L,P,this.inverseTransform);
G[0]=P;G[1]=Q;return z.transformMat2d(L,G,this.inverseTransform)};J.toScreen=function(L,P,Q){if(E.isVec2(P))return z.transformMat2d(L,P,this.transform);G[0]=P;G[1]=Q;return z.transformMat2d(L,G,this.transform)};J.toScreenNoRotation=function(L,P,Q){if(E.isVec2(P))return z.transformMat2d(L,P,this.transformNoRotation);G[0]=P;G[1]=Q;return z.transformMat2d(L,G,this.transformNoRotation)};J.getScreenTransform=function(L,P){const {center:Q}=this._viewpoint2D,X=this._get("pixelRatio")||1,aa=this._get("size");
A.getMatrix(L,Q,aa,P,0,X);return L};J._update=function(){const {center:L,spatialReference:P,scale:Q,rotation:X}=this._viewpoint2D,aa=this._get("pixelRatio")||1,S=this._get("size"),H=new w({targetGeometry:new u(L[0],L[1],P),scale:Q,rotation:X});this._set("viewpoint",H);if(S&&P&&Q){this.resolution=A.getResolution(H);this.rotation=X;this.scale=Q;this.spatialReference=P;z.copy(this.center,L);D.set(this.displayMat3,0!==S[0]?2/S[0]:0,0,0,0,0!==S[1]?-2/S[1]:0,0,-1,1,1);var R=D.identity(this.viewMat3),T=
B.fromValues(S[0]/2,S[1]/2),W=B.fromValues(-S[0]/2,-S[1]/2),Y=l.toRadian(X);D.translate(R,R,T);D.rotate(R,R,Y);D.translate(R,R,W);D.multiply(this.displayViewMat3,this.displayMat3,R);R=r.identity(this.viewMat2d);r.translate(R,R,T);r.rotate(R,R,Y);r.translate(R,R,W);A.getExtent(this.extent,H,S);A.getTransform(this.transform,H,S,aa);r.invert(this.inverseTransform,this.transform);A.getTransformNoRotation(this.transformNoRotation,H,S,aa);this.worldScreenWidth=A.getWorldScreenWidth(this.spatialReference,
this.resolution);this._set("id",this.id+1);return this}};a._createClass(K,[{key:"pixelRatio",set:function(L){this._set("pixelRatio",L);this._update()}},{key:"size",set:function(L){this._set("size",L);this._update()}},{key:"viewpoint",set:function(L){if(L){const P=this._viewpoint2D,Q=L.targetGeometry;P.center[0]=Q.x;P.center[1]=Q.y;P.rotation=L.rotation;P.scale=L.scale;P.spatialReference=Q.spatialReference}this._update()}}]);return K}(q.JSONSupport);g.__decorate([k.property({readOnly:!0})],b.prototype,
"id",void 0);g.__decorate([k.property({value:1,json:{write:!0}})],b.prototype,"pixelRatio",null);g.__decorate([k.property({json:{write:!0}})],b.prototype,"size",null);g.__decorate([k.property({type:w,json:{write:!0}})],b.prototype,"viewpoint",null);return b=F=g.__decorate([d.subclass("esri.views.2d.ViewState")],b)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,g){function b(x,m){x[0]=m[0];x[1]=m[1];x[2]=m[2];x[3]=m[3];x[4]=m[4];x[5]=m[5];return x}function p(x){x[0]=1;x[1]=
0;x[2]=0;x[3]=1;x[4]=0;x[5]=0;return x}function f(x,m,B,E,F,G,I){x[0]=m;x[1]=B;x[2]=E;x[3]=F;x[4]=G;x[5]=I;return x}function k(x,m){const B=m[0],E=m[1],F=m[2],G=m[3],I=m[4];m=m[5];let K=B*G-E*F;if(!K)return null;K=1/K;x[0]=G*K;x[1]=-E*K;x[2]=-F*K;x[3]=B*K;x[4]=(F*m-G*I)*K;x[5]=(E*I-B*m)*K;return x}function c(x){return x[0]*x[3]-x[1]*x[2]}function d(x,m,B){const E=m[0],F=m[1],G=m[2],I=m[3],K=m[4];m=m[5];const J=B[0],L=B[1],P=B[2],Q=B[3],X=B[4];B=B[5];x[0]=E*J+G*L;x[1]=F*J+I*L;x[2]=E*P+G*Q;x[3]=F*P+
I*Q;x[4]=E*X+G*B+K;x[5]=F*X+I*B+m;return x}function e(x,m,B){const E=m[0],F=m[1],G=m[2],I=m[3],K=m[4];m=m[5];const J=Math.sin(B);B=Math.cos(B);x[0]=E*B+G*J;x[1]=F*B+I*J;x[2]=E*-J+G*B;x[3]=F*-J+I*B;x[4]=K;x[5]=m;return x}function h(x,m,B){const E=m[1],F=m[2],G=m[3],I=m[4],K=m[5],J=B[0];B=B[1];x[0]=m[0]*J;x[1]=E*J;x[2]=F*B;x[3]=G*B;x[4]=I;x[5]=K;return x}function n(x,m,B){const E=m[0],F=m[1],G=m[2],I=m[3],K=m[4];m=m[5];const J=B[0];B=B[1];x[0]=E;x[1]=F;x[2]=G;x[3]=I;x[4]=E*J+G*B+K;x[5]=F*J+I*B+m;return x}
function q(x,m){const B=Math.sin(m);m=Math.cos(m);x[0]=m;x[1]=B;x[2]=-B;x[3]=m;x[4]=0;x[5]=0;return x}function u(x,m){x[0]=m[0];x[1]=0;x[2]=0;x[3]=m[1];x[4]=0;x[5]=0;return x}function v(x,m){x[0]=1;x[1]=0;x[2]=0;x[3]=1;x[4]=m[0];x[5]=m[1];return x}function t(x){return"mat2d("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+")"}function l(x){return Math.sqrt(x[0]**2+x[1]**2+x[2]**2+x[3]**2+x[4]**2+x[5]**2+1)}function w(x,m,B){x[0]=m[0]+B[0];x[1]=m[1]+B[1];x[2]=m[2]+B[2];x[3]=m[3]+B[3];x[4]=
m[4]+B[4];x[5]=m[5]+B[5];return x}function y(x,m,B){x[0]=m[0]-B[0];x[1]=m[1]-B[1];x[2]=m[2]-B[2];x[3]=m[3]-B[3];x[4]=m[4]-B[4];x[5]=m[5]-B[5];return x}function D(x,m,B){x[0]=m[0]*B;x[1]=m[1]*B;x[2]=m[2]*B;x[3]=m[3]*B;x[4]=m[4]*B;x[5]=m[5]*B;return x}function z(x,m,B,E){x[0]=m[0]+B[0]*E;x[1]=m[1]+B[1]*E;x[2]=m[2]+B[2]*E;x[3]=m[3]+B[3]*E;x[4]=m[4]+B[4]*E;x[5]=m[5]+B[5]*E;return x}function r(x,m){return x[0]===m[0]&&x[1]===m[1]&&x[2]===m[2]&&x[3]===m[3]&&x[4]===m[4]&&x[5]===m[5]}function C(x,m){const B=
x[0],E=x[1],F=x[2],G=x[3],I=x[4];x=x[5];const K=m[0],J=m[1],L=m[2],P=m[3],Q=m[4];m=m[5];return Math.abs(B-K)<=g.EPSILON*Math.max(1,Math.abs(B),Math.abs(K))&&Math.abs(E-J)<=g.EPSILON*Math.max(1,Math.abs(E),Math.abs(J))&&Math.abs(F-L)<=g.EPSILON*Math.max(1,Math.abs(F),Math.abs(L))&&Math.abs(G-P)<=g.EPSILON*Math.max(1,Math.abs(G),Math.abs(P))&&Math.abs(I-Q)<=g.EPSILON*Math.max(1,Math.abs(I),Math.abs(Q))&&Math.abs(x-m)<=g.EPSILON*Math.max(1,Math.abs(x),Math.abs(m))}var A=Object.freeze({__proto__:null,
copy:b,identity:p,set:f,invert:k,determinant:c,multiply:d,rotate:e,scale:h,translate:n,fromRotation:q,fromScaling:u,fromTranslation:v,str:t,frob:l,add:w,subtract:y,multiplyScalar:D,multiplyScalarAndAdd:z,exactEquals:r,equals:C,mul:d,sub:y});a.add=w;a.copy=b;a.determinant=c;a.equals=C;a.exactEquals=r;a.frob=l;a.fromRotation=q;a.fromScaling=u;a.fromTranslation=v;a.identity=p;a.invert=k;a.mat2d=A;a.mul=d;a.multiply=d;a.multiplyScalar=D;a.multiplyScalarAndAdd=z;a.rotate=e;a.scale=h;a.set=f;a.str=t;a.sub=
y;a.subtract=y;a.translate=n})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function g(){return[1,0,0,1,0,0]}function b(c){return[c[0],c[1],c[2],c[3],c[4],c[5]]}function p(c,d,e,h,n,q){return[c,d,e,h,n,q]}function f(c,d){return new Float64Array(c,d,6)}var k=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f});a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat2df64=k})},"esri/views/2d/viewpointUtils":function(){define("exports ../../core/maybe ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/Geometry ../../geometry/support/Ellipsoid ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/Extent ../../core/Collection ../../chunks/common ../../core/unitUtils ../../Viewpoint ../../chunks/vec2f64 ../../chunks/vec2 ../../chunks/mat2d ../../chunks/mat2df64".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){function y(ba,fa,ia,ma){return ma&&ia&&!ma.equals(ia)&&c.canProject(ma,ia)&&ma.isWebMercator?(ma.isWebMercator?(ia=fa[1],89.99999<ia?ia=89.99999:-89.99999>ia&&(ia=-89.99999),ia=Math.sin(n.toRadian(ia)),ba=t.set(ba,n.toRadian(fa[0])*k.earth.radius,.5*k.earth.radius*Math.log((1+ia)/(1-ia)))):(ia=n.toDegree(fa[0]/k.earth.radius),ba=t.set(ba,ia-360*Math.floor((ia+180)/360),n.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*fa[1]/k.earth.radius))))),ba):t.copy(ba,
fa)}function D(ba){return ba.wkid?ba:ba.spatialReference||p.WGS84}function z(ba,fa){return fa.type?t.set(ba,fa.x,fa.y):t.copy(ba,fa)}function r(ba,fa){return Math.max(ba.width/fa[0],ba.height/fa[1])*G(ba.spatialReference)}async function C(ba,fa,ia,ma){if(!ba||Array.isArray(ba)&&!ba.length)return null;h.isCollection(ba)&&(ba=ba.toArray());if(Array.isArray(ba)&&ba.length&&"object"===typeof ba[0]){var ea=ba.every(na=>"attributes"in na);var M=ba.some(na=>!na.geometry),Z=ba;if(ea&&M&&fa&&fa.allLayerViews){ea=
new Map;for(var la of ba)ba=la.layer,M=ea.get(ba)||[],Z=la.attributes[ba.objectIdField],null!=Z&&M.push(Z),ea.set(ba,M);const na=[];ea.forEach((da,oa)=>{const qa=fa.allLayerViews.find(ua=>ua.layer.id===oa.id);if("queryFeatures"in qa){const ua=oa.createQuery();ua.objectIds=da;ua.returnGeometry=!0;na.push(qa.queryFeatures(ua))}});la=await Promise.all(na);ba=[];for(var ka of la)if(ka&&ka.features&&ka.features.length)for(var ha of ka.features)g.isSome(ha.geometry)&&ba.push(ha.geometry);Z=ba}for(const na of Z)ma=
await C(na,fa,ia,ma);return ma}if(Array.isArray(ba)&&2===ba.length&&"number"===typeof ba[0]&&"number"===typeof ba[1])ea=new d(ba);else if(ba instanceof f)ea=ba;else if("geometry"in ba)if(ba.geometry)ea=ba.geometry;else if(ba.layer){const na=ba.layer;ka=fa.allLayerViews.find(da=>da.layer.id===na.id);"queryFeatures"in ka&&(ha=na.createQuery(),ha.objectIds=[ba.attributes[na.objectIdField]],ha.returnGeometry=!0,ka=await ka.queryFeatures(ha),ea=g.get(ka,"features",0,"geometry"))}if(g.isNone(ea))return null;
ka="point"===ea.type?new e({xmin:ea.x,ymin:ea.y,xmax:ea.x,ymax:ea.y,spatialReference:ea.spatialReference}):ea.extent;if(!ka)return null;ha=c.canProject(ka,ia);if(!ka.spatialReference.equals(ia)&&ha)ka=c.project(ka,ia);else if(!ha)return null;return ma=ma?ma.union(ka):ka.clone()}function A(ba){if(ba&&(!Array.isArray(ba)||"number"!==typeof ba[0])&&("object"===typeof ba||Array.isArray(ba)&&"object"===typeof ba[0])){if("layer"in ba&&ba.layer&&ba.layer.minScale&&ba.layer.maxScale){var fa=ba.layer;return{min:fa.minScale,
max:fa.maxScale}}if(Array.isArray(ba)&&ba.length&&ba.every(ia=>"layer"in ia)){let ia=fa=0;for(const ma of ba)(ba=ma.layer)&&ba.minScale&&ba.maxScale&&(fa=ba.minScale<fa?ba.minScale:fa,ia=ba.maxScale>ia?ba.maxScale:ia);return fa&&ia?{min:fa,max:ia}:null}}}async function x(ba,fa){if(!ba||!fa)return new u({targetGeometry:new d,scale:0,rotation:0});let ia=fa.spatialReference;const {constraints:ma,padding:ea,viewpoint:M,size:Z}=fa,la=[ea?Z[0]-ea.left-ea.right:Z[0],ea?Z[1]-ea.top-ea.bottom:Z[1]];let ka=
null;ba instanceof u?ka=ba:ba.viewpoint?ka=ba.viewpoint:ba.target&&"esri.Viewpoint"===ba.target.declaredClass&&(ka=ba.target);let ha=null;if(ka&&ka.targetGeometry)ha=ka.targetGeometry;else if(ba instanceof e)ha=ba;else if(ba||ba&&("center"in ba||"extent"in ba||"target"in ba))ha=await C(ba.center,fa,ia)||await C(ba.extent,fa,ia)||await C(ba.target,fa,ia)||await C(ba,fa,ia);!ha&&M&&M.targetGeometry?ha=M.targetGeometry:!ha&&fa.extent&&(ha=fa.extent);var na=D(ha);ia||(ia=D(fa.spatialReference||fa.extent||
ha));if(!c.canProject(ha,ia)&&na&&!na.equals(ia))return null;var da=z(v.create(),ha.center?ha.center:ha);na=new d(y(da,da,na,ia),ia);da=null;da=ka&&g.isSome(ka.targetGeometry)&&"point"===ka.targetGeometry.type?ka.scale:ba.hasOwnProperty("scale")&&ba.scale?ba.scale:ba.hasOwnProperty("zoom")&&-1!==ba.zoom&&ma&&ma.effectiveLODs?ma.zoomToScale(ba.zoom):Array.isArray(ha)||"point"===ha.type||"extent"===ha.type&&0===ha.width&&0===ha.height?fa.extent&&c.canProject(fa.extent,ia)?r(c.project(fa.extent,ia),
la):fa.extent?r(fa.extent,la):M.scale:c.canProject(ha.extent,ia)?r(c.project(ha.extent,ia),la):r(ha.extent,la);if(fa=A(ba))fa.min&&fa.min>da?da=fa.min:fa.max&&fa.max<da&&(da=fa.max);fa=0;ka?fa=ka.rotation:ba.hasOwnProperty("rotation")?fa=ba.rotation:M&&(fa=M.rotation);ba=new u({targetGeometry:na,scale:da,rotation:fa});ma&&(ba=ma.fit(ba),ma.constrainByGeometry(ba),ma.rotationEnabled||(ba.rotation=fa));return ba}function m(ba,fa){const ia=ba.targetGeometry,ma=fa.targetGeometry;ia.x=ma.x;ia.y=ma.y;ia.spatialReference=
ma.spatialReference;ba.scale=fa.scale;ba.rotation=fa.rotation;return ba}function B(ba,fa,ia){return ia?t.set(ba,.5*(fa[0]-ia.right+ia.left),.5*(fa[1]-ia.bottom+ia.top)):t.scale(ba,fa,.5)}function E(ba,fa,ia,ma){X(ba,fa,ia,ma);return l.invert(ba,ba)}function F(ba){var fa=ba.scale;ba=ba.targetGeometry;ba=g.isSome(ba)&&b.isValid(ba.spatialReference)?1/(39.37*q.getMetersPerUnitForSR(ba.spatialReference)*96):1;return fa*ba}function G(ba){return b.isValid(ba)?39.37*q.getMetersPerUnitForSR(ba)*96:1}function I(ba){return ba.isWrappable?
(ba=b.getInfo(ba),ba.valid[1]-ba.valid[0]):0}const K=180/Math.PI,J=function(){const ba=v.create();return function(fa,ia,ma){const ea=ia.targetGeometry;z(ba,ea);ia=.5*F(ia);fa.xmin=ba[0]-ia*ma[0];fa.ymin=ba[1]-ia*ma[1];fa.xmax=ba[0]+ia*ma[0];fa.ymax=ba[1]+ia*ma[1];fa.spatialReference=ea.spatialReference;return fa}}(),L=function(){const ba=v.create();return function(fa,ia,ma){return t.sub(fa,t.scale(fa,ia,.5),B(ba,ia,ma))}}(),P=function(){const ba=w.create(),fa=v.create();return function(ia,ma,ea,M){const Z=
F(ma);ma=n.toRadian(ma.rotation)||0;t.set(fa,Z,Z);l.fromScaling(ba,fa);l.rotate(ba,ba,ma);l.translate(ba,ba,L(fa,ea,M));l.translate(ba,ba,[0,M.top-M.bottom]);return t.set(ia,ba[4],ba[5])}}(),Q=function(){const ba=v.create(),fa=v.create(),ia=v.create();return function(ma,ea,M,Z,la,ka){t.negate(ba,ea);t.scale(fa,M,.5*ka);t.set(ia,1/Z*ka,-1/Z*ka);l.identity(ma);l.translate(ma,ma,fa);la&&l.rotate(ma,ma,la);l.scale(ma,ma,ia);l.translate(ma,ma,ba);return ma}}(),X=function(){const ba=v.create();return function(fa,
ia,ma,ea){const M=F(ia),Z=n.toRadian(ia.rotation)||0;z(ba,ia.targetGeometry);return Q(fa,ba,ma,M,Z,ea)}}(),aa=function(){const ba=v.create();return function(fa,ia,ma,ea){const M=F(ia);z(ba,ia.targetGeometry);return Q(fa,ba,ma,M,0,ea)}}(),S=function(){const ba=v.create(),fa=v.create(),ia=[0,0,0];return function(ma,ea,M){t.subtract(ba,ma,ea);t.normalize(ba,ba);t.subtract(fa,ma,M);t.normalize(fa,fa);t.cross(ia,ba,fa);ma=Math.acos(t.dot(ba,fa)/(t.length(ba)*t.length(fa)))*K;0>ia[2]&&(ma=-ma);isNaN(ma)&&
(ma=0);return ma}}(),H=function(){const ba=v.create();return function(fa,ia,ma,ea){const M=fa.targetGeometry;m(fa,ia);P(ba,ia,ma,ea);M.x+=ba[0];M.y+=ba[1];return fa}}(),R=function(){const ba=v.create();return function(fa,ia,ma,ea){const M=fa.targetGeometry;m(fa,ia);P(ba,ia,ma,ea);M.x-=ba[0];M.y-=ba[1];return fa}}(),T=function(){const ba=v.create();return function(fa,ia,ma){m(fa,ia);ia=fa.targetGeometry;const ea=D(ma),M=D(ia);z(ba,ma);y(ba,ba,ea,M);ia.x=ba[0];ia.y=ba[1];return fa}}(),W=function(){const ba=
v.create();return function(fa,ia,ma,ea,M){M||(M="center");t.sub(ba,ma,ea);t.scale(ba,ba,.5);ma=ba[0];ea=ba[1];switch(M){case "center":t.set(ba,0,0);break;case "left":t.set(ba,-ma,0);break;case "top":t.set(ba,0,ea);break;case "right":t.set(ba,ma,0);break;case "bottom":t.set(ba,0,-ea);break;case "top-left":t.set(ba,-ma,ea);break;case "bottom-left":t.set(ba,-ma,-ea);break;case "top-right":t.set(ba,ma,ea);break;case "bottom-right":t.set(ba,ma,-ea)}V(fa,ia,ba);return fa}}(),Y=function(){const ba=v.create();
return function(fa,ia,ma,ea,M){m(fa,ia);isNaN(ma)||0===ma||(ca(ba,ea,ia,M),fa.scale=ia.scale*ma,O(ba,ba,fa,M),V(fa,fa,t.set(ba,ba[0]-ea[0],ea[1]-ba[1])));return fa}}(),U=function(){const ba=v.create();return function(fa,ia,ma,ea,M,Z){m(fa,ia);isNaN(ma)||0===ma||(ca(ba,M,ia,Z),fa.scale=ia.scale*ma,fa.rotation+=ea,O(ba,ba,fa,Z),V(fa,fa,t.set(ba,ba[0]-M[0],M[1]-ba[1])));return fa}}(),N=function(){const ba=v.create(),fa=v.create();return function(ia,ma,ea,M,Z,la,ka){L(fa,la,ka);t.add(ba,Z,fa);return M?
U(ia,ma,ea,M,ba,la):Y(ia,ma,ea,ba,la)}}(),ca=function(){const ba=w.create();return function(fa,ia,ma,ea){return t.transformMat2d(fa,ia,E(ba,ma,ea,1))}}(),O=function(){const ba=w.create();return function(fa,ia,ma,ea){return t.transformMat2d(fa,ia,X(ba,ma,ea,1))}}(),V=function(){const ba=v.create(),fa=w.create();return function(ia,ma,ea){m(ia,ma);const M=F(ma),Z=ia.targetGeometry;l.fromRotation(fa,n.toRadian(ma.rotation)||0);l.scale(fa,fa,v.fromValues(M,M));t.transformMat2d(ba,ea,fa);Z.x+=ba[0];Z.y+=
ba[1];return ia}}();a.addPadding=H;a.angleBetween=S;a.centerAt=T;a.copy=m;a.create=x;a.createAsync=function(ba,fa){return x(ba,fa)};a.extentToScale=r;a.getAnchor=B;a.getExtent=J;a.getMatrix=Q;a.getOuterSize=function(ba,fa,ia){var ma=n.toRadian(fa.rotation)||0;fa=Math.abs(Math.cos(ma));ma=Math.abs(Math.sin(ma));return t.set(ba,Math.round(ia[1]*ma+ia[0]*fa),Math.round(ia[1]*fa+ia[0]*ma))};a.getPaddingMapTranslation=P;a.getPaddingScreenTranslation=L;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=
X;a.getTransformNoRotation=aa;a.getWorldScreenWidth=function(ba,fa){return Math.round(I(ba)/fa)};a.getWorldWidth=I;a.padAndScaleAndRotateBy=N;a.pixelSize=function(ba){return F(ba)};a.removePadding=R;a.resize=W;a.rotateBy=function(ba,fa,ia){m(ba,fa);ba.rotation+=ia;return ba};a.rotateTo=function(ba,fa,ia){m(ba,fa);ba.rotation=ia;return ba};a.scaleAndRotateBy=U;a.scaleBy=Y;a.scaleTo=function(ba,fa,ia){m(ba,fa);ba.scale=ia;return ba};a.setExtent=function(ba,fa,ia,ma,ea){T(ba,fa,ia.center);ba.scale=r(ia,
ma);ea&&ea.constraints&&ea.constraints.constrain(ba);return ba};a.toMap=ca;a.toScreen=O;a.translateBy=V;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function g(){const e=new Float32Array(6);e[0]=1;e[3]=1;return e}function b(e){const h=new Float32Array(6);h[0]=e[0];h[1]=e[1];h[2]=e[2];h[3]=e[3];h[4]=e[4];h[5]=e[5];return h}function p(e,h,n,q,u,v){const t=new Float32Array(6);t[0]=e;t[1]=h;t[2]=n;t[3]=q;t[4]=u;t[5]=v;return t}function f(e,
h){return new Float32Array(e,h,6)}function k(e,h,n,q){const u=h[q];h=h[q+1];e[q]=n[0]*u+n[2]*h+n[4];e[q+1]=n[1]*u+n[3]*h+n[5]}function c(e,h,n,q=0,u=0,v=2){for(u=u||h.length/v;q<u;q++)k(e,h,n,q*v)}var d=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f,transform:k,transformMany:c});a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.mat2df32=d;a.transform=k;a.transformMany=c})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function g(p){return p instanceof
Float32Array&&2<=p.length}function b(p){return Array.isArray(p)&&2<=p.length}a.isVec2=function(p){return g(p)||b(p)};a.isVec2f32=g;a.isVec2f64=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/BlendLayers.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build();return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.initializePipeline=function(){const t=2===this.configuration.mode?h.simpleBlendingParams(1,771):1===this.configuration.mode?h.simpleBlendingParams(0,770):null;return h.makePipelineState({blending:t,colorWrite:h.defaultColorWriteParams})};
return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.BlendLayersShader,()=>new Promise(function(q,u){a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.mode=0;return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:3})],f.prototype,"mode",void 0);g.BlendLayersTechnique=k;g.BlendLayersTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},
"esri/chunks/BlendLayers.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,g,b){function p(){const k=new b.ShaderBuilder;k.attributes.add("position","vec2");k.attributes.add("uv0","vec2");k.vertex.uniforms.add("scale","float");k.vertex.uniforms.add("offset","vec2");k.varyings.add("uv","vec2");k.vertex.code.add(g.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = uv0 * scale + offset;
    }
  `);k.fragment.uniforms.add("tex","sampler2D");k.fragment.uniforms.add("opacity","float");k.fragment.code.add(g.glsl`
    void main() {
      vec4 color = texture2D(tex, uv);

      // Note: output in pre-multiplied alpha for correct alpha compositing
      gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
    }
  `);return k}var f=Object.freeze({__proto__:null,build:p});a.BlendLayersShader=f;a.build=p})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../webgl/rasterUtils ../../../chunks/RasterColorizer.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){c=function(v){function t(){return v.apply(this,arguments)||this}b._inheritsLoose(t,v);var l=t.prototype;l.initializeProgram=function(w){var y=t.shader.get();const D=this.configuration;y=y.build({output:D.colorizerType,applyColormap:D.applyColormap});this._context=w.rctx;return new h(w.rctx,y.generateSource("vertex"),y.generateSource("fragment"),e.Default3D)};l.initializePipeline=function(){const w=2===this.configuration.mode?n.simpleBlendingParams(1,771):1===this.configuration.mode?
n.simpleBlendingParams(0,770):null;return n.makePipelineState({blending:w,colorWrite:n.defaultColorWriteParams})};l.bindPass=function(w,y){q.setUniforms(this.program,this.uniformLocationInfos,y.basic);q.setUniforms(this.program,this.uniformLocationInfos,y.common);f.isSome(y.colormap)&&q.setUniforms(this.program,this.uniformLocationInfos,y.colormap);0===this.configuration.colorizerType&&f.isSome(y.stretch)?q.setUniforms(this.program,this.uniformLocationInfos,y.stretch):2===this.configuration.colorizerType&&
f.isSome(y.hillshade)&&q.setUniforms(this.program,this.uniformLocationInfos,y.hillshade)};b._createClass(t,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=q.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return t}(c.ShaderTechnique);c.shader=new k.ReloadableShaderModule(u.RasterColorizerShader,()=>new Promise(function(v,t){a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],v,t)}));k=function(v){function t(){var l=
v.apply(this,arguments)||this;l.mode=2;l.colorizerType=0;l.applyColormap=!0;return l}b._inheritsLoose(t,v);return t}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:3})],k.prototype,"mode",void 0);p.__decorate([d.parameter({count:3})],k.prototype,"colorizerType",void 0);p.__decorate([d.parameter()],k.prototype,"applyColormap",void 0);g.RasterColorizerTechnique=c;g.RasterColorizerTechniqueConfiguration=k;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl".split(" "),
function(a,g,b,p,f,k,c){function d(h){const n=new b.ShaderBuilder;n.include(f.BasicGrid);n.include(c.Common);n.include(k.Colormap);0===h.output?(h=h.applyColormap,n.fragment.uniforms.add("u_bandCount","int"),n.fragment.uniforms.add("u_minCutOff","float",3),n.fragment.uniforms.add("u_maxCutOff","float",3),n.fragment.uniforms.add("u_factor","float",3),n.fragment.uniforms.add("u_minOutput","float"),n.fragment.uniforms.add("u_maxOutput","float"),n.fragment.uniforms.add("u_useGamma","bool"),n.fragment.uniforms.add("u_gamma",
"float",3),n.fragment.uniforms.add("u_gammaCorrection","float",3),n.fragment.code.add(g.glsl`
      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
        // clamp values
        if (val >= maxCutOff) {
          return maxOutput;
        } else if (val <= minCutOff) {
          return minOutput;
        }

        // stretch a single value based on whether to use gamma
        float stretchedVal;
        if (useGamma) {
          float tempf = 1.0;
          float outRange = maxOutput - minOutput;
          float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
          if (gamma > 1.0) {
            tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
          }
          stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
        } else {
          stretchedVal = minOutput + (val - minCutOff) * factor;
        }
        return stretchedVal;
      }
    `),h=h?g.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:g.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`,n.fragment.code.add(g.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${h}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }
      }
    `)):1===h.output?n.fragment.code.add(g.glsl`
      void main() {
        // get pixel location
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        // apply colormap we use float texture here
        gl_FragColor = colormap(currentPixel, true);
      }
    `):2===h.output&&(h=h.applyColormap,n.fragment.uniforms.add("u_hillshadeType","int"),n.fragment.uniforms.add("u_sinZcosAs","float",6),n.fragment.uniforms.add("u_sinZsinAs","float",6),n.fragment.uniforms.add("u_cosZs","float",6),n.fragment.uniforms.add("u_weights","float",6),n.fragment.uniforms.add("u_factor","vec2"),n.fragment.uniforms.add("u_applyColormap","bool"),n.fragment.uniforms.add("u_minValue","float"),n.fragment.uniforms.add("u_maxValue","float"),n.fragment.uniforms.add("u_srcImageSize",
"vec2"),n.fragment.include(p.ColorConversion),n.fragment.code.add(g.glsl`
  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
    val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
    vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
    vec3 hsv = rgb2hsv(rgb.xyz);
    hsv.z = hillshade;
    return vec4(hsv2rgb(hsv) * alpha, alpha);
  }
`),n.fragment.code.add(g.glsl`
    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
      if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
        return 0.0;
      }  else {
        return e;
      }
    }
  `),h=h?g.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:g.glsl`
       hillshade *= alpha;
       gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);
       `,n.fragment.code.add(g.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${h}
    }
  `));return n}var e=Object.freeze({__proto__:null,build:d});a.RasterColorizerShader=e;a.build=d})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.BasicGrid=function(b){b.attributes.add("position","vec2");b.attributes.add("uv0","vec2");b.vertex.uniforms.add("u_scale","float");b.vertex.uniforms.add("u_offset","vec2");b.varyings.add("v_texcoord","vec2");b.vertex.code.add(g.glsl`
    void main(void) {
      v_texcoord = uv0 * u_scale + u_offset;
      gl_Position = vec4(position, 0.0, 1.0);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.Colormap=function(b){b.fragment.uniforms.add("u_colormap","sampler2D");b.fragment.uniforms.add("u_colormapOffset","float");b.fragment.uniforms.add("u_colormapMaxIndex","float");b.fragment.code.add(g.glsl`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      // colormap is only applicable to integer data but could be already normalized to 0-1 float
      float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
        vec4 color = texture2D(u_colormap, clrPosition);
        result = vec4(color.rgb, 1.0) * color.a * u_opacity;
      }
      return result;
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","../../shaderModules/interfaces","./Projection.glsl"],function(a,g,b){a.Common=function(p){p.include(b.Projection);p.fragment.uniforms.add("u_image","sampler2D");p.fragment.uniforms.add("u_isFloatTexture","bool");p.fragment.uniforms.add("u_flipY","bool");p.fragment.uniforms.add("u_applyTransform","bool");p.fragment.uniforms.add("u_opacity","float");
p.fragment.code.add(g.glsl`
    vec2 getPixelLocation(vec2 coords) {
      vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
      if (!u_applyTransform) {
        return targetLocation;
      }
      return projectPixelLocation(targetLocation);
    }

    bool isOutside(vec2 coords){
      if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
        return true;
      } else {
        return false;
      }
    }

    vec4 getPixel(vec2 pixelLocation) {
      return texture2D(u_image, pixelLocation);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.Projection=function(b){b.fragment.uniforms.add("u_transformGrid","sampler2D");b.fragment.uniforms.add("u_transformSpacing","vec2");b.fragment.uniforms.add("u_transformGridSize","vec2");b.fragment.uniforms.add("u_targetImageSize","vec2");b.fragment.code.add(g.glsl`
    vec2 projectPixelLocation(vec2 coords) {
      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // pixel's corresponding cell index in transform grid
      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
      vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;

      // correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
      vec2 srcLocation;
      // pixel's corresponding transform cell location, center cell coordinates
      vec2 transform_location = index_transform + oneTransformPixel * 0.5;

      // use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
        vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
        srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
      } else {
        vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
        vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
        srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
      }
      return srcLocation;;
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(a,g,b){let p=function(){function f(c){this.renderingContext=c;this._pools=new Map}var k=f.prototype;k.acquire=function(c){return this.getPool(c).acquire()};k.release=function(c){this.getPool(c.width).release(c)};k.clear=function(){this._pools.forEach(c=>c.destroy());this._pools.clear()};k.getPool=function(c){var d=
this._pools.get(c);d||(d=b.bind(b,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:c,height:c}),d=new g(d),this._pools.set(c,d));return d};return f}();a.FBOPool=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../lib/StencilUtils ../../../../chunks/Terrain.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){k=function(u){function v(){return u.apply(this,arguments)||this}b._inheritsLoose(v,u);var t=v.prototype;t.initializeProgram=function(l){var w=v.shader.get();const y=this.configuration;w=w.build({overlayMode:y.overlayMode,output:y.output,viewingMode:l.viewingMode,slicePlaneEnabled:y.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:y.textureFadingEnabled&&!y.renderOccluded,hasBackgroundColor:y.hasBackgroundColor,useGrid:y.useGrid,
receiveShadows:y.receiveShadows&&!y.renderOccluded,receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:y.atmosphere,tileBorders:y.tileBorders,screenSizePerspective:y.screenSizePerspective,pbrMode:0,ssrEnabled:y.ssrEnabled,highStepCount:!1});return new e(l.rctx,w.generateSource("vertex"),w.generateSource("fragment"),d.Default3D)};t.initializePipeline=function(){const l=this.configuration,w=l.backfaceCullingEnabled&&!l.renderOccluded;return h.makePipelineState({blending:l.renderOccluded?
h.simpleBlendingParams(1,771):null,culling:w&&h.backFaceCullingParams,depthTest:!l.renderOccluded&&{func:513},depthWrite:!l.renderOccluded&&h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilTest:l.stencilEnabled?n.renderWhenBitIsNotSet(1):null})};return v}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(q.TerrainShader,()=>new Promise(function(u,v){a(["../core/shaderLibrary/terrain/Terrain.glsl"],u,v)}));f=function(u){function v(){var t=u.apply(this,arguments)||this;t.output=
0;t.overlayMode=0;t.atmosphere=!1;t.receiveShadows=!1;t.slicePlaneEnabled=!1;t.backfaceCullingEnabled=!1;t.stencilEnabled=!1;t.textureFadingEnabled=!1;t.hasBackgroundColor=!1;t.useGrid=!1;t.renderOccluded=!1;t.ssrEnabled=!1;t.tileBorders=!1;t.screenSizePerspective=!1;return t}b._inheritsLoose(v,u);return v}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter({count:3})],f.prototype,"overlayMode",void 0);p.__decorate([c.parameter()],
f.prototype,"atmosphere",void 0);p.__decorate([c.parameter()],f.prototype,"receiveShadows",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"backfaceCullingEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"stencilEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"textureFadingEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"hasBackgroundColor",void 0);p.__decorate([c.parameter()],f.prototype,"useGrid",
void 0);p.__decorate([c.parameter()],f.prototype,"renderOccluded",void 0);p.__decorate([c.parameter()],f.prototype,"ssrEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"tileBorders",void 0);p.__decorate([c.parameter()],f.prototype,"screenSizePerspective",void 0);g.TerrainTechnique=k;g.TerrainTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(w){const y=new p.ShaderBuilder;y.include(h.HeaderComment,{name:"Terrain Shader",output:w.output});y.include(u.Skirts);y.attributes.add("position","vec3");y.attributes.add("uv0","vec2");y.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===w.output){y.include(b.Transform,{linearDepth:!1});y.include(d.NormalUtils,w);y.include(v.TerrainTexture,w);const D=0!==w.overlayMode,z=2===w.overlayMode;D&&y.include(q.Overlay,
{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:w.ssrEnabled,highStepCount:w.highStepCount});z&&y.include(n.VertexTangent,w);y.varyings.add("vnormal","vec3");y.varyings.add("vpos","vec3");y.vertex.uniforms.add("viewNormal","mat4");w.receiveShadows&&y.varyings.add("linearDepth","float");w.tileBorders&&y.varyings.add("vuv","vec2");w.atmosphere&&(y.vertex.uniforms.add("lightingMainDirection","vec3"),y.varyings.add("wnormal","vec3"),y.varyings.add("wlight","vec3"));w.screenSizePerspective&&(y.vertex.uniforms.add("screenSizePerspective",
"vec4"),y.varyings.add("screenSizeDistanceToCamera","float"),y.varyings.add("screenSizeCosAngle","float"));y.vertex.code.add(g.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${w.atmosphere?g.glsl`
        wnormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        wlight = (view  * vec4(-lightingMainDirection, 1.0)).xyz;`:""}
        ${w.tileBorders?g.glsl`vuv = uv;`:""}
        ${w.screenSizePerspective?g.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${w.receiveShadows?g.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${D?g.glsl`setOverlayVTC(uv);`:""}
        ${z?g.glsl`forwardVertexTangent(vnormal);`:g.glsl``}
      }
    `);y.extensions.add("GL_OES_standard_derivatives");y.extensions.add("GL_EXT_shader_texture_lod");y.include(f.Slice,w);y.include(e.EvaluateSceneLighting,w);y.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float");w.screenSizePerspective&&y.fragment.uniforms.add("screenSizePerspective","vec4");z&&(y.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),y.fragment.uniforms.add("ovOuterWaterTex","sampler2D"),
y.fragment.uniforms.add("view","mat4"));y.fragment.code.add(g.glsl`
      const vec3 ambient = vec3(0.2, 0.2, 0.2);
      const vec3 diffuse = vec3(0.8, 0.8, 0.8);
      const float diffuseHardness = 2.5;
      const float sliceOpacity = 0.2;

      float lum(vec3 c) {
        float max = max(max(c.r, c.g), c.b);
        float min = min(min(c.r, c.g), c.b);
        return (min + max) * 0.5;
      }
      `);w.atmosphere&&y.fragment.code.add(g.glsl`
      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {
        vec3 surfaceColor   = vec3(0.0);
        vec3 fuzzySpecColor = vec3(1.0);
        vec3 subColor       = vec3(0.0);
        float rollOff       = 1.0;

        vec3 Ln = normalize(lightPos);
        vec3 Nn = normalize(normal);
        vec3 Hn = normalize(view + Ln);

        float ldn = dot(Ln, Nn);
        float diffComp = max(0.0, ldn);
        // clamp necessary here because values might cause flickering: #21549
        float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);
        float ndv = dot(view, Ln);

        vec3 diffContrib = surfaceColor * diffComp;
        float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));

        vec3 subContrib = subLamb * subColor;
        vec3 vecColor = vec3(vdn);

        vec3 diffuseContrib = (subContrib + diffContrib);
        vec3 specularContrib = (vecColor * fuzzySpecColor);

        return (diffContrib + specularContrib) * rollOff;
      }
      `);y.fragment.code.add(g.glsl`
      void main() {
        ${w.receiveShadows?g.glsl`float shadow = readShadowMap(vpos, linearDepth);`:g.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), -lightingMainDirection);
        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));
        vec3 d = (1.0 - shadow/1.8) * diffuse * k;

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor() * opacity;
        ${D?g.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        vec3 atm = vec3(0.0);
        ${w.atmosphere?g.glsl`
            float ndotl = max(0.0, min(1.0, vndl));
            atm = atmosphere(wlight, wnormal, -viewDirection);
            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps
            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}
        vec3 albedo = atm + tileColor.rgb;
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${z?g.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${w.screenSizePerspective?g.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${w.tileBorders?g.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(1===w.output||3===w.output)y.include(b.Transform,{linearDepth:!0}),y.include(c.OutputDepth,{output:w.output}),y.include(d.NormalUtils,w),y.varyings.add("linearDepth","float"),y.vertex.uniforms.add("nearFar","vec2"),y.vertex.code.add(g.glsl`
        void main(void) {
          vec3 normal = getLocalUp(position, origin);
          vec2 uv = uv0;
          vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);

          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
        }
    `),y.fragment.code.add(g.glsl`
        void main() {
          outputDepth(linearDepth);
        }
    `);2===w.output&&(y.include(b.Transform,{linearDepth:!1}),y.include(d.NormalUtils,w),y.varyings.add("vnormal","vec3"),y.varyings.add("vpos","vec3"),y.vertex.uniforms.add("viewNormal","mat4"),y.vertex.code.add(g.glsl`
        void main(void) {
          vec3 normal = getLocalUp(position, origin);
          vec2 uv = uv0;
          vpos = applySkirts(uv, position, normal, skirtScale);

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),y.fragment.code.add(g.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
        }
    `));4===w.output&&(y.include(b.Transform,{linearDepth:!1}),y.include(d.NormalUtils,w),y.include(q.Overlay,{pbrMode:0}),y.vertex.code.add(g.glsl`
          void main() {
            vec3 vnormal = getLocalUp(position, origin);
            vec2 uv = uv0;
            vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
            setOverlayVTC(uv);

            gl_Position = transformPosition(proj, view, vpos);
          }
      `),y.include(k.OutputHighlight),y.fragment.code.add(g.glsl`
        void main() {
          vec4 overlayColor = getCombinedOverlayColor();

          if (overlayColor.a == 0.0) {
            gl_FragColor = vec4(0.0);
            return;
          }

          outputHighlight();
        }
      `));return y}var l=Object.freeze({__proto__:null,build:t});a.TerrainShader=l;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.VertexTangent=function(b,p){b.varyings.add("tbnTangent","vec3");b.varyings.add("tbnBiTangent","vec3");1===p.viewingMode?b.vertex.code.add(g.glsl`
      void forwardVertexTangent(vec3 n) {
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
        tbnBiTangent = normalize(cross(n, tbnTangent));
      }
    `):b.vertex.code.add(g.glsl`
      void forwardVertexTangent(vec3 n) {
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(n, tbnTangent));
      }
    `);b.fragment.code.add(g.glsl`
      mat3 getTBNMatrix(vec3 n) {
        return mat3(tbnTangent, tbnBiTangent, n);
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../../shaderModules/interfaces","../shading/Water.glsl","../shading/EvaluateMainLighting.glsl"],function(a,g,b,p){a.Overlay=function(f,k){3!==k.pbrMode&&4!==k.pbrMode||f.include(b.Water,k);f.vertex.uniforms.add("overlayTexOffset","vec4");f.vertex.uniforms.add("overlayTexScale","vec4");f.varyings.add("vtcOverlay","vec4");f.vertex.code.add(g.glsl`
    void setOverlayVTC(in vec2 uv) {
      vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
    }
  `);f.fragment.uniforms.add("ovInnerColorTex","sampler2D");f.fragment.uniforms.add("ovOuterColorTex","sampler2D");f.fragment.uniforms.add("overlayOpacity","float");f.fragment.code.add(g.glsl`
    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {
      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:
      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control
      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657
      vec4 color0 = texture2D(ov0Tex, texCoords.xy);
      vec4 color1 = texture2D(ov1Tex, texCoords.zw);

      float valid0 = float((texCoords.x >= 0.0) && (texCoords.x <= 1.0) && (texCoords.y >= 0.0) && (texCoords.y <= 1.0));
      float valid1 = float((texCoords.z >= 0.0) && (texCoords.z <= 1.0) && (texCoords.w >= 0.0) && (texCoords.w <= 1.0));

      // Pick color0 if valid, otherwise color1 if valid, otherwise vec4(0)
      return mix(color1 * valid1, color0, valid0);
    }
  `);f.fragment.code.add(g.glsl`
    vec4 getCombinedOverlayColor() {
      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
    }
  `);if(3===k.pbrMode||4===k.pbrMode)f.include(p.EvaluateMainLighting),f.fragment.code.add(g.glsl`
    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
       float shadow, vec3 localUp, mat3 tbn, vec3 position) {

      // reproject normal from 0...1 => -1...1
      // and project it to worldspace.
      vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
      vec3 v = vposEyeDir;
      vec3 l = normalize(-lightingMainDirection);
      vec3 final = getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);

      // the terrain renderer assumes a premultiplied color output without gamma.
      return vec4(final, colorInput.w);
    }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.Skirts=function(b){b.vertex.code.add(g.glsl`
    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
      float skirtLength = 0.0;

      if (uv.x >= 2.0) {
        skirtLength = uv.y * skirtScale;
        // decode original uv-coordinates (see "encodeSkirtPos")
        vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
        uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
      }

      return vpos - vnormal * skirtLength;
    }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.TerrainTexture=function(b,p){b.varyings.add("vtc","vec2");b.vertex.uniforms.add("texOffsetAndScale","vec4");b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("compositeBackground","bool");b.fragment.uniforms.add("textureOpacity","float");b.fragment.uniforms.add("baseOpacity",
"float");p.textureFadingEnabled&&(b.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),b.varyings.add("nvtc","vec2"),b.fragment.uniforms.add("texNext","sampler2D"),b.fragment.uniforms.add("textureFadeFactor","float"));b.vertex.code.add(g.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${p.textureFadingEnabled?g.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:g.glsl``}
  }
  `);p.useGrid?(b.fragment.code.add(g.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * 129.0;
      if(pos < 0.5 || pos > 128.5) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }
    `),b.fragment.code.add(g.glsl`
    vec4 getTileColor() {
      vec4 color = ${p.textureFadingEnabled?g.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:g.glsl`texture2D(tex, vtc);`};
      if(!compositeBackground) {
        return color;
      }

      float line = lineFactor(vtc) * 0.1 + 0.9;
      vec4 gridColor = vec4(1.0, 0.972, 0.918, 1.0) * line * baseOpacity;
      float alpha = textureOpacity * color.a;
      return mix(gridColor, color, alpha);
    }`)):p.hasBackgroundColor?(b.fragment.uniforms.add("backgroundColor","vec4"),b.fragment.code.add(g.glsl`
    vec4 getTileColor() {
      vec4 color = ${p.textureFadingEnabled?g.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:g.glsl`texture2D(tex, vtc);`};
      float alpha = textureOpacity * color.a;
      return compositeBackground ? mix(backgroundColor * baseOpacity, color, alpha) : color;
    }`)):b.fragment.code.add(g.glsl`
    vec4 getTileColor() {
      return ${p.textureFadingEnabled?g.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:g.glsl`texture2D(tex, vtc);`}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/tracer":function(){define(["exports","../../../../chunks/_commonjsHelpers","../../../webgl/capabilities/isWebGL2Context"],function(a,g,b){var p=g.createCommonjsModule(function(c){(function(d){d=d();void 0!==d&&(c.exports=d)})(function(){function d(y){if(null==l){l={};w={};for(var D in y)"number"==typeof y[D]&&(l[y[D]]=D,w[D]=y[D])}}function e(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called";}function h(y){e();
var D=l[y];return void 0!==D?"gl."+D:"/*UNKNOWN WebGL ENUM*/ 0x"+y.toString(16)}function n(y,D,z,r){y=t[y];if(void 0!==y&&(y=y[D],void 0!==y&&y[z])){if("object"===typeof y[z]&&void 0!==y[z].enumBitwiseOr){D=y[z].enumBitwiseOr;z=0;y=[];for(var C=0;C<D.length;++C){var A=w[D[C]];0!==(r&A)&&(z|=A,y.push(h(A)))}return z===r?y.join(" | "):h(r)}return h(r)}return null===r?"null":void 0===r?"undefined":r.toString()}function q(y,D,z){y.__defineGetter__(z,function(){return D[z]});y.__defineSetter__(z,function(r){D[z]=
r})}function u(y,D,z,r){function C(E,F){return function(){z&&z(F,arguments);var G=E[F].apply(E,arguments),I=r.getError();0!=I&&(A[I]=!0,D(I,F,arguments));return G}}r=r||y;d(y);D=D||function(E,F,G){for(var I="",K=G.length,J=0;J<K;++J)I+=(0==J?"":", ")+n(F,K,J,G[J]);E="WebGL error "+h(E)+" in "+F+"("+I+")";window.console&&window.console.error?window.console.error(E):window.console&&window.console.log&&window.console.log(E)};var A={},x={},m;for(m in y)if("function"==typeof y[m])if("getExtension"!=m)x[m]=
C(y,m);else{var B=C(y,m);x[m]=function(){var E=B.apply(y,arguments);return u(E,D,z,r)}}else q(x,y,m);x.getError=function(){for(var E in A)if(A.hasOwnProperty(E)&&A[E])return A[E]=!1,E;return y.NO_ERROR};return x}function v(y){var D=y.getParameter(y.MAX_VERTEX_ATTRIBS),z=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,z);for(var r=0;r<D;++r)y.disableVertexAttribArray(r),y.vertexAttribPointer(r,4,y.FLOAT,!1,0,0),y.vertexAttrib1f(r,0);y.deleteBuffer(z);D=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(r=
0;r<D;++r)y.activeTexture(y.TEXTURE0+r),y.bindTexture(y.TEXTURE_CUBE_MAP,null),y.bindTexture(y.TEXTURE_2D,null);y.activeTexture(y.TEXTURE0);y.useProgram(null);y.bindBuffer(y.ARRAY_BUFFER,null);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null);y.bindFramebuffer(y.FRAMEBUFFER,null);y.bindRenderbuffer(y.RENDERBUFFER,null);y.disable(y.BLEND);y.disable(y.CULL_FACE);y.disable(y.DEPTH_TEST);y.disable(y.DITHER);y.disable(y.SCISSOR_TEST);y.blendColor(0,0,0,0);y.blendEquation(y.FUNC_ADD);y.blendFunc(y.ONE,y.ZERO);
y.clearColor(0,0,0,0);y.clearDepth(1);y.clearStencil(-1);y.colorMask(!0,!0,!0,!0);y.cullFace(y.BACK);y.depthFunc(y.LESS);y.depthMask(!0);y.depthRange(0,1);y.frontFace(y.CCW);y.hint(y.GENERATE_MIPMAP_HINT,y.DONT_CARE);y.lineWidth(1);y.pixelStorei(y.PACK_ALIGNMENT,4);y.pixelStorei(y.UNPACK_ALIGNMENT,4);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1);y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);y.UNPACK_COLORSPACE_CONVERSION_WEBGL&&y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.BROWSER_DEFAULT_WEBGL);
y.polygonOffset(0,0);y.sampleCoverage(1,!1);y.scissor(0,0,y.canvas.width,y.canvas.height);y.stencilFunc(y.ALWAYS,0,4294967295);y.stencilMask(4294967295);y.stencilOp(y.KEEP,y.KEEP,y.KEEP);y.viewport(0,0,y.canvas.width,y.canvas.height);for(y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);y.getError(););}var t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},
getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,
6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT",
"DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},
l=null,w=null;return{init:d,mightBeEnum:function(y){e();return void 0!==l[y]},glEnumToString:h,glFunctionArgToString:n,glFunctionArgsToString:function(y,D){for(var z="",r=D.length,C=0;C<r;++C)z+=(0==C?"":", ")+n(y,r,C,D[C]);return z},makeDebugContext:u,makeLostContextSimulatingCanvas:function(y){function D(aa){return"function"==typeof aa?aa:function(S){aa.handleEvent(S)}}function z(){for(var aa=Object.keys(X),S=0;S<aa.length;++S)delete X[aa]}function r(){++L;I||J==L&&y.loseContext()}function C(aa,
S){var H=aa[S];return function(){r();if(!I)return H.apply(aa,arguments)}}function A(aa){return{statusMessage:aa,preventDefault:function(){P=!0}}}function x(aa){for(var S in aa)"function"==typeof aa[S]?F[S]=C(aa,S):q(F,aa,S);F.getError=function(){r();if(!I)for(var T;T=m.getError();)X[T]=!0;for(T in X)if(X[T])return delete X[T],T;return F.NO_ERROR};var H="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(S=0;S<H.length;++S){var R=H[S];F[R]=function(T){return function(){r();
if(I)return null;var W=T.apply(aa,arguments);W.__webglDebugContextLostId__=G;K.push(W);return W}}(aa[R])}H="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(S=0;S<H.length;++S)R=H[S],F[R]=function(T){return function(){r();
return I?null:T.apply(aa,arguments)}}(F[R]);H="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(S=0;S<H.length;++S)R=H[S],F[R]=function(T){return function(){r();return I?!1:T.apply(aa,arguments)}}(F[R]);F.checkFramebufferStatus=function(T){return function(){r();return I?F.FRAMEBUFFER_UNSUPPORTED:T.apply(aa,arguments)}}(F.checkFramebufferStatus);F.getAttribLocation=function(T){return function(){r();return I?-1:T.apply(aa,arguments)}}(F.getAttribLocation);
F.getVertexAttribOffset=function(T){return function(){r();return I?0:T.apply(aa,arguments)}}(F.getVertexAttribOffset);F.isContextLost=function(){return I};return F}var m,B=[],E=[];var F={};var G=1,I=!1,K=[],J=0,L=0,P=!1,Q=0,X={};y.getContext=function(aa){return function(){var S=aa.apply(y,arguments);if(S instanceof WebGLRenderingContext){if(S!=m){if(m)throw"got different context";m=S;F=x(m)}return F}return S}}(y.getContext);(function(aa){var S=aa.addEventListener;aa.addEventListener=function(H,R,
T){switch(H){case "webglcontextlost":B.push(D(R));break;case "webglcontextrestored":E.push(D(R));break;default:S.apply(aa,arguments)}}})(y);y.loseContext=function(){if(!I){I=!0;J=0;for(++G;m.getError(););z();X[m.CONTEXT_LOST_WEBGL]=!0;var aa=A("context lost"),S=B.slice();setTimeout(function(){for(var H=0;H<S.length;++H)S[H](aa);0<=Q&&setTimeout(function(){y.restoreContext()},Q)},0)}};y.restoreContext=function(){I&&E.length&&setTimeout(function(){if(!P)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var aa=0;aa<K.length;++aa){var S=K[aa];S instanceof WebGLBuffer?m.deleteBuffer(S):S instanceof WebGLFramebuffer?m.deleteFramebuffer(S):S instanceof WebGLProgram?m.deleteProgram(S):S instanceof WebGLRenderbuffer?m.deleteRenderbuffer(S):S instanceof WebGLShader?m.deleteShader(S):S instanceof WebGLTexture&&m.deleteTexture(S)}v(m);I=!1;L=0;P=!1;aa=E.slice();S=A("context restored");for(var H=0;H<aa.length;++H)aa[H](S)},0)};y.loseContextInNCalls=function(aa){if(I)throw"You can not ask a lost contet to be lost";
J=L+aa};y.getNumCalls=function(){return L};y.setRestoreTimeout=function(aa){Q=aa};return y},resetToInitialState:v}})});let f=null;const k=[];a.enabled=!1;a.begin=function(){a.enabled&&(f=[])};a.end=function(){if(a.enabled){const c=f;f=null;c&&(k.forEach(d=>d(c)),k.length=0);return c}return null};a.instrumentContext=function(c){return a.enabled?b(c)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),c):p.makeDebugContext(c,void 0,(d,e)=>{a.enabled&&f&&f.push("gl."+d+"("+p.glFunctionArgsToString(d,
e)+")")}):c};a.request=function(c){k.push(c)};a.setEnabled=function(c){a.enabled=c};a.trace=function(c){a.enabled&&null!=f&&f.push(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports",
"../../../chunks/vec2f64"],function(a,g){let b=function(){function p(){this.offset=g.create();this.scale=0;this.tile=null}var f=p.prototype;f.init=function(k,c,d,e){this.tile=k;this.offset[0]=c;this.offset[1]=d;this.scale=e};f.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return p}();a.UpsampleInfo=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/Accessor ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../support/Scheduler ./lighting/Lightsources ./lib/GeometryRecord ./lib/AutoDisposable ./lib/WebGLLayer ./lib/ChangeSet ./parts/Model ./parts/RenderView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B){var E;a.Stage=E=function(F){function G(K){K=F.call(this,K)||this;K._handles=new y;K._model=new m.Model;K._layers=new v;K._mainLightDirection=l.fromValues(0,1,0);K._changeSet=new x.ChangeSet;K._layerSyncSet=new Set;return K}g._inheritsLoose(G,F);var I=G.prototype;I.initialize=function(){this._set("renderView",new B.RenderView(this));this.setLighting({lights:[new z.MainLight(l.fromValues(.7,.7,.7)),new z.AmbientLight(l.fromValues(.3,.3,.3))],
groundLightingFactor:.5,globalFactor:.5});this._handles.add(this.scheduler.registerTask(D.Task.STAGE,()=>this._processDirty(),()=>this._model.dirtySet.dirty))};I.destroy=function(){r.GeometryRecord.pool.prune(0);this._handles.destroy();this.dispose()};I.setLighting=function(K){w.set(this._mainLightDirection,0,0,0);for(const J of K.lights)if(J instanceof z.MainLight){w.negate(this._mainLightDirection,J.direction);break}this._lighting=K;this.renderView.setNeedsRender()};I.add=function(K){this._model.add(K);
A.isWebGLLayer(K)&&(K.attachStage(this),this._addLayer(K));this.renderView.setNeedsRender()};I.remove=function(K){f.isNone(K)||(this.renderView.setNeedsRender(),this._model.remove(K),A.isWebGLLayer(K)&&(this._removeLayer(K),K.detachStage()))};I.addMany=function(K){f.isSome(K)&&(this._model.addMany(K),this.renderView.setNeedsRender())};I.removeMany=function(K){f.isSome(K)&&(this._model.removeMany(K),this.renderView.setNeedsRender())};I.forEachOfType=function(K,J){this._model.forEachOfType(K,J)};I.handleEvent=
function(K,J){this.destroyed||(this._model.dirtySet[K](J),this.renderView.setNeedsRender())};I._processDirty=function(){const K=this._model.dirtySet;E.DebugSettings.logDirtySet&&console.log("Dirty set: "+K.formatDebugInfo());K.commit(this._changeSet);E.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(J=>J.id)),console.log("RGs remove: "+this._changeSet.removes.map(J=>J.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.setNeedsRender()};
I.processDirtyLayer=function(K){this._layerSyncSet.add(K);this.renderView.setNeedsRender()};I.commitDirtyLayers=function(){if(0!==this._layerSyncSet.size){var K=this._model.dirtySet;for(const J of this._layerSyncSet)K.commitLayer(J,this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.setNeedsRender()}};I.getObject=function(K){return this._model.getObject(K)};I._addLayer=function(K){this._layers.some(J=>J===K)||this._layers.push(K)};I._removeLayer=function(K){this._processDirty();
null!=this._layers.removeUnordered(K)&&(this._model.dirtySet.getResidentRenderGeometries(K.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};I.addRenderPlugin=function(K,J){"intersect"in J&&this.sceneIntersectionHelper.addIntersectionHandler(J);this.renderView.renderPlugins.add(K,J)};I.removeRenderPlugin=function(K){"intersect"in K&&this.sceneIntersectionHelper.removeIntersectionHandler(K);this.renderView.renderPlugins.remove(K)};g._createClass(G,[{key:"updating",get:function(){return this._model.dirtySet.dirty||
this.renderView.updating}},{key:"mainLightDirection",get:function(){return this._mainLightDirection}},{key:"lighting",get:function(){return this._lighting}},{key:"camera",get:function(){return this.renderView.camera},set:function(K){this.renderView.camera=K}},{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const K=this;return{getCount(J){return K._model.test.content.filter(L=>
L.type===J).length},stopAnimations(J){return K._model.test.content.filter(L=>3===L.type).forEach(L=>f.applySome(L.animation,P=>P.stopAtTime(J)))},model:K._model}}}]);return G}(C.AutoDisposableMixin(t));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"scheduler",void 0);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",
void 0);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"viewingMode",void 0);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);b.__decorate([d.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([d.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([C.autoDispose(),d.property()],a.Stage.prototype,"renderView",void 0);
a.Stage=E=b.__decorate([h.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../support/mathUtils ../lib/Util ../lib/localOrigin ../lib/WebGLLayer ../lib/RenderGeometry ../lib/ModelDirtySet".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){const z=t.assert,r=t.logWithBase;a.Model=function(C){function A(){var m=C.call(this)||this;m.dirtySet=new D({model:g._assertThisInitialized(m)});m._id2origin=new Map;m._content=new Map;return m}g._inheritsLoose(A,C);var x=A.prototype;x.getObject=function(m){return this._content.get(m)};x.add=function(m){const B=m.id;z(!this._content.has(B),"Model/Stage already contains object to be added");this._content.set(B,m);w.isWebGLLayer(m)&&this.dirtySet.layerAdded(m)};
x.remove=function(m){z(this._content.has(m.id),"Model/Stage doesn't contain object to be removed");this._content.delete(m.id);m.unload();w.isWebGLLayer(m)&&this.dirtySet.layerRemoved(m)};x.addMany=function(m){for(const B of m)z(!this._content.has(B.id),"Model/Stage already contains object to be added"),this._content.set(B.id,B)};x.removeMany=function(m){for(const B of m)z(this._content.has(B.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(B.id),B.unload()};x.forEachOfType=
function(m,B){this._content.forEach(E=>{E.type===m&&B(E)})};x._getOrigin=function(m){var B=0,E=10*m[3]/1E4;1<E&&(B=Math.ceil(r(E,2)));E=1E4*2**B;const F=Math.round(m[0]/E),G=Math.round(m[1]/E);m=Math.round(m[2]/E);B=B+"_"+F+"_"+G+"_"+m;let I=this._id2origin.get(B);null==I&&(I=l.fromValues(F*E,G*E,m*E,B),this._id2origin.set(B,I));return I};x.getRenderGeometry=function(m,B){const E=B.geometry,F=m.getCombinedStaticTransformation(B),G=v.maxScale(F),I=B.origin;m=new y.RenderGeometry(E,B.material,null,
null,E.boundingInfo,F,B.shaderTransformation,G,m.castShadow);m.id=B.id;m.origin=I||this._getOrigin(m.boundingSphere);m.instanceParameters=B.instanceParameters;return m};x.updateRenderGeometryTransformation=function(m,B,E){m=m.getCombinedStaticTransformation(B,E.transformation);E.updateTransformation(m);m=this._getOrigin(E.boundingSphere);return E.origin!==m};x.getStats=function(){const m={},B=Array.from(this._content.values());for(let E=0;5>E;++E)m[E]=B.filter(F=>F.type===E).length;return{contentTypes:m,
dirtySet:this.dirtySet.formatDebugInfo()}};g._createClass(A,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);return A}(u);b.__decorate([c.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([e.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/uid ../../../../core/MapUtils ./Util ./GeometryRecord".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){b=function(y){function D(r){r=y.call(this,r)||this;r._residentGeomRecords=new Map;r._dirtyGeomRecords=new Map;r.dirty=!1;return r}a._inheritsLoose(D,y);var z=D.prototype;z.commit=function(r){this.dirty=!1;this._dirtyGeomRecords.forEach((C,A)=>this.commitLayer(A,r))};z.commitLayer=function(r,C){const A=this._dirtyGeomRecords.get(r);A&&(A.forEach((x,m)=>{const B=this._ensureGeomRecord(r,m);x.forEach((E,F)=>{var G=E[0],I=E[1],K=E[2];E=!1;if(I&2){var J=B.get(F);
if(J){J=J[1];if(K&4){const L=this.model.getObject(m);this.model.updateRenderGeometryTransformation(L,G,J)&&(E=!0)}E||C.updates.push({renderGeometry:J,updateType:K})}else l.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(I&4||E)(K=B.get(F))?(C.removes.push(K[1]),B.delete(F),K[0].disposed&&w.GeometryRecord.pool.release(K[0])):4===I&&l.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(I&1||E)I=this.model.getObject(m),I=this.model.getRenderGeometry(I,
G),G=[G,I],C.adds.push(I),B.set(F,G)});0===B.size&&this._residentGeomRecords.get(r).delete(m)}),0===this._residentGeomRecords.get(r).size&&this._residentGeomRecords.delete(r),this._dirtyGeomRecords.delete(r))};z.getResidentRenderGeometries=function(r,C){(r=this._residentGeomRecords.get(r))&&r.forEach(A=>A.forEach(x=>C.push(x[1])))};z._objectStateChanged=function(r,C){for(const A of C.geometryRecords)this._updateOrCreateDirtyRecord(C,A,null,2,0,0,2,5,r)};z.visibilityChanged=function(r){this._objectStateChanged(1,
r)};z.highlightChanged=function(r){this._objectStateChanged(8,r)};z.occlusionChanged=function(r){this._objectStateChanged(16,r)};z.vertexAttrsUpdated=function(r){this._updateOrCreateDirtyRecord(r.object,r.record,null,2,0,0,2,5,2)};z.layerAdded=function(r){r.getObjects().forAll(C=>this._layerObjectAdded(r,C))};z.layerRemoved=function(r){r.getObjects().forAll(C=>this._layerObjectRemoved(r,C))};z.layerObjectAdded=function(r){this._layerObjectAdded(r.layer,r.object)};z._layerObjectAdded=function(r,C){r=
r.id;const A=C.geometryRecords;for(let x=0;x<A.length;x++)this._objectGeometryAdded(C,A[x],r)};z.layerObjectRemoved=function(r){this._layerObjectRemoved(r.layer,r.object)};z.layerObjectsAdded=function(r){for(const C of r.objects)this._layerObjectAdded(r.layer,C)};z.layerObjectsRemoved=function(r){for(const C of r.objects)this._layerObjectRemoved(r.layer,C)};z._layerObjectRemoved=function(r,C){r=r.id;const A=C.geometryRecords;for(let x=0;x<A.length;x++)this._objectGeometryRemoved(C,A[x],r)};z.shaderTransformationChanged=
function(r){(r=this._residentGeomRecords.get(r.id))&&r.forEach((C,A)=>{(A=this.model.getObject(A))&&A.hasVolativeTransformation()&&C.forEach(x=>{x[1].shaderTransformationChanged()})})};z.objectTransformation=function(r){const C=this._getParentLayerId(r);this._ensureGeomRecord(C,r.id).forEach(A=>{this._updateOrCreateDirtyRecord(r,A[0],C,2,0,0,2,5,4)})};z.objectGeometryAdded=function(r){this._objectGeometryAdded(r.object,r.record)};z._objectGeometryAdded=function(r,C,A=null){this._updateOrCreateDirtyRecord(r,
C,A,1,4,0,0,0)};z.objectGeometryRemoved=function(r){this._objectGeometryRemoved(r.object,r.record)};z._objectGeometryRemoved=function(r,C,A=null){this._updateOrCreateDirtyRecord(r,C,A,4,1,2,0,0)};z._updateOrCreateDirtyRecord=function(r,C,A,x,m,B,E,F,G){A=p.unwrapOr(A,this._getParentLayerId(r));const I=C.id;r=this._ensureDirtyRecord(A,r.id);(A=r.get(I))?(C=A[1],C&m?(r.delete(I),A[0].disposed&&w.GeometryRecord.pool.release(A[0])):C&B?(A[1]=x,A[2]=G):C&E?A[2]|=G:C&F||l.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):
r.set(I,[C,x,G]);this.dirty=this._hasDirtyGeometryRecords};z._ensureGeomRecord=function(r,C){let A=this._residentGeomRecords.get(r);A||(A=new Map,this._residentGeomRecords.set(r,A));r=A.get(C);r||(r=new Map,A.set(C,r));return r};z._ensureDirtyRecord=function(r,C){let A=this._dirtyGeomRecords.get(r);A||(A=new Map,this._dirtyGeomRecords.set(r,A));r=A.get(C);r||(r=new Map,A.set(C,r));return r};z._getParentLayerId=function(r){return p.isSome(r.parentLayer)?r.parentLayer.id:v.NullUID};z.formatDebugInfo=
function(){const r=["ADD","UPD",void 0,"REM"];let C="";this._dirtyGeomRecords.forEach((A,x)=>{A.forEach((m,B)=>{0<C.length&&(C+="\n");C+=x+"."+B;const E=[];m.forEach(F=>{const G=F[1];E[G]||(E[G]=[]);E[G].push(F[0].geometry.id)});for(m=0;m<E.length;m++)if(E[m])for(C+=" "+r[m-1]+": ",B=0;B<E[m].length;B++)C+=E[m][B]+", "})});return C};a._createClass(D,[{key:"_hasDirtyGeometryRecords",get:function(){return t.someMap(this._dirtyGeomRecords,r=>t.someMap(r,C=>C&&0<C.size))}},{key:"test",get:function(){const r=
this;return{get residentLayerCount(){return r._residentGeomRecords.size},get residentObjectCount(){return Array.from(r._residentGeomRecords.values()).reduce((C,A)=>C+A.size,0)}}}}]);return D}(u);g.__decorate([c.property({constructOnly:!0})],b.prototype,"model",void 0);g.__decorate([c.property()],b.prototype,"dirty",void 0);return b=g.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/scheduling ../../../../core/Accessor ../../../../core/Evented ../../../../layers/support/timeUtils ../../../../core/watchUtils ../../../webgl/context-util ../lib/AutoDisposable ../../../webgl/RenderingContext ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/GLMaterialRep ../materials/lineStippleUtils ../lib/WebGLDriverTest ../../support/animationUtils ./requireUtils ../statistics/tracer ../collections/Component/ComponentObjectCollection ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/MagnifierHelper ../lib/Renderer ../lib/TextureRepository ../materials/internal/WaterTextureRepository ./ScreenshotManager".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa){const S=k.getLogger("esri.views.3d.webgl-engine.parts.View");let H=null;a.RenderView=function(R){function T(Y){var U=R.call(this,{})||this;U.events=new l;U._stippleTextureRepository=new m.StippleTextureRepository;U.waterTextureRepository=new X.WaterTextureRepository;U._magnifierHelper=new L.MagnifierHelper;U._commonUniformStore=new C.CommonUniformStore;U._componentObjectCollection=null;U._needsUpdate=!0;U._needsRender=
!0;U._idleSuspend=!0;U._logicUpdateLast=0;U._container=Y.container;U._initializeContext(Y.options);y.init(U.waterTextureRepository,"loadingState",()=>U.setNeedsRender());U._magnifierHelper.events.on("request-render",()=>U.setNeedsRender());U._shaderTechniqueRepository=new A.ShaderTechniqueRepository({rctx:U._rctx,viewingMode:Y.options.viewingMode,commonUniformStore:U._commonUniformStore,stippleTextureRepository:U._stippleTextureRepository,waterTextureRepository:U.waterTextureRepository});U._textureRepository=
new Q.TextureRepository(Y,U._shaderTechniqueRepository,U._rctx);U._textureRepository.events.on("changed",ca=>U.setNeedsRender(ca));U._materialRepository=new x(U._textureRepository,U._shaderTechniqueRepository,()=>U.setNeedsRender());U._compositingHelper=new K(U._rctx,U._shaderTechniqueRepository);const N=U._container.getBoundingClientRect();U._renderer=new P(U._materialRepository,U._textureRepository,U._shaderTechniqueRepository,U._rctx,U._compositingHelper,U._magnifierHelper,(ca=1)=>U.setNeedsRender(ca),
[N.width,N.height],Y);U._screenshotManager=new aa.ScreenshotManager(U._rctx,(ca,O,V)=>U._render(ca,O,V),()=>U.setNeedsRender(),Y.options.screenshot.renderOverlay,ca=>U.events.emit("force-camera-for-screenshot",ca));U._registerFrameTask(Y);return U}g._inheritsLoose(T,R);var W=T.prototype;W.normalizeCtorArgs=function(){return{}};W.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();
this._shaderTechniqueRepository=null;B.clearTestWebGLDriver(this._rctx);R.prototype.dispose.call(this);this._rctx=null};W.setNeedsRender=function(Y=1){1===Y?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};W.evaluateUpdating=function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this.waterTextureRepository.updating||this._magnifierHelper.updating};W.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};
W.setRenderParameters=function(Y){void 0!==Y.idleSuspend&&this._idleSuspend!==!!Y.idleSuspend&&(this._idleSuspend=!!Y.idleSuspend,this.setNeedsRender());this._renderer.setRenderParameters(Y)};W.has=function(Y){switch(Y){case 0:return!!this._rctx.capabilities.compressedTextureETC;case 1:return!!this._rctx.capabilities.compressedTextureS3TC;case 2:return!!this._rctx.capabilities.shaderTextureLOD;case 3:return this._renderer.hasShadowsEnabled;default:return!1}};W.modify=function(Y){this._renderer.modify(Y);
Y.clear()};W.takeScreenshot=function(Y){return this._screenshotManager.takeScreenshot(Y)};W.getMinimalDepthForArea=function(Y,U,N,ca=80,O=1){Y=N.constrainWindowSize(Y,U,ca*N.pixelRatio,O);H=new Uint8Array(4*Y[2]*Y[3]);this._renderer.readDepthPixels(Y[0],Y[1],Y[2],Y[3],H);U=Number.MAX_VALUE;for(ca=0;ca<Y[2]*Y[3];ca++)O=J.texure2depth(4*ca,H,N.nearFar),U>O&&O!==N.nearFar[0]&&O!==N.nearFar[1]&&(U=O);return U===Number.MAX_VALUE?void 0:U};W.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};
W.hotReloadShaders=async function(){F.removeLoadedShaderModules();await this._shaderTechniqueRepository.hotReload();this.setNeedsRender()};W._registerFrameTask=function(Y){const U={viewCamera:this._renderer.camera,frameHasDecorations:!1};let N=!1;this._frameTask=v.addFrameTask({preRender:ca=>{N=this.evaluateUpdating();G.begin();Y.commitDirtyLayers();var O=w.Milliseconds(ca.time-this._logicUpdateLast);O>E.DESIRED_ANIMATION_MS&&(O={camera:this._renderer.camera,dt:O},this._logicUpdateLast=ca.time,this._renderer.updateLogic(O)&&
this.setNeedsRender(0))},render:()=>{!this.needsUpdate&&!this._needsRender&&this._idleSuspend&&this._renderer.isCameraFinal||!this.canRender||(this._needsUpdate=this._needsRender=!1,this._render(null,this._renderer.camera,!1))},postRender:()=>{N===this.updating&&N===this.evaluateUpdating()||this.notifyChange("updating");G.end()},update:()=>{U.viewCamera=this._renderer.camera;U.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(U)}})};
W._initializeContext=function(Y){this._canvas=Y.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const U=G.instrumentContext(D.createContextOrErrorHTML(this._canvas,{alpha:Y.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==Y.stencil?!0:Y.stencil,powerPreference:"high-performance"},Y.renderContext));this._rctx=new r(U,{disabledExtensions:Y.deactivatedWebGLExtensions||{},debugWebGLExtensions:Y.debugWebGLExtensions||
{}});B.testWebGLDriver(this._rctx);null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,8));this._loadShaderOnlyExtensions(this._rctx);!Y.alpha&&this._rctx.contextAttributes.alpha&&S.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=p("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};W._render=
function(Y,U,N){this._renderer.render(Y,U,N)};W._loadShaderOnlyExtensions=function(Y){Y=Y.capabilities;Y.enable("standardDerivatives");Y.enable("shaderTextureLOD");Y.enable("textureFloat")};g._createClass(T,[{key:"performanceInfo",get:function(){const Y=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==Y.getUsedTextureMemory?Y.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==Y.getUsedRenderbufferMemory?Y.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==
Y.getUsedVBOMemory?Y.getUsedVBOMemory():void 0}}},{key:"canRender",get:function(){return this._renderer.canRender}},{key:"needsUpdate",get:function(){return this._needsUpdate}},{key:"updating",get:function(){return this.evaluateUpdating()}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(Y){this._magnifierHelper.magnifier=
Y}},{key:"renderingContext",get:function(){return this._rctx}},{key:"camera",get:function(){return this._renderer.camera},set:function(Y){this._renderer.camera=Y}},{key:"canvas",get:function(){return this._canvas}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"componentObjectCollection",get:function(){f.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new I.ComponentObjectCollection(this._renderer.renderPassManager));
return this._componentObjectCollection},set:function(Y){this._componentObjectCollection=Y}}]);return T}(z.AutoDisposableMixin(t));b.__decorate([d.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating","_magnifierHelper.updating"]})],a.RenderView.prototype,"updating",null);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_rctx",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_container",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_canvas",
void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",void 0);b.__decorate([z.autoDispose(),d.property()],a.RenderView.prototype,"waterTextureRepository",void 0);b.__decorate([z.autoDispose(),d.property()],a.RenderView.prototype,"_magnifierHelper",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_textureRepository",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_commonUniformStore",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,
"_compositingHelper",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_renderer",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_screenshotManager",void 0);b.__decorate([z.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([z.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);a.RenderView=b.__decorate([h.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/Logger ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/vec4 ../../../../../chunks/vec4f32 ../../../../../chunks/mat3f32 ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../lib/Util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ./ComponentData ./interface ../../core/util/BucketedObjectStore ./ComponentObject ../../lib/ComponentUtils ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentTechnique ./Material/ComponentMaterial ../../core/util/TwoVectorPosition ../../lib/TextureBackedBuffer/BufferManager".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K){const J=p.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");p=function(){function aa(H){this._renderManager=H;this._objects=new z.BucketedObjectStore;this._renderSubmit=new B.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new K.BufferManager(H.rctx)}var S=aa.prototype;S.dispose=function(){u.assert(0===this._objects.count,"ObjectCollection should be empty upon disposal");
this._componentBufferManager.destroy()};S.createObject=function(H){const R=new r;R.toMapSpace=H.toMapSpace.slice();R.transform=H.transform;R.obb=w.clone(H.obb);R.components=new y(this._componentBufferManager,H.geometry.componentOffsets);R.renderable=this._createRenderable(H,R.components);R.intersectionGeometry=new A(H.geometry.positionData,R.components);this._objects.add(H.visible?D.VISIBLE_BIT:0,R);return R};S.destroyObject=function(H){this._objects.remove(H);H.dispose();this._notifyDirty()};S.setObjectVisibility=
function(H,R){R!==H.visible&&(this._objects.updateKey(H,R?H.bucketKey|D.VISIBLE_BIT:H.bucketKey&~D.VISIBLE_BIT),this._notifyDirty())};S.preSubmit=function(H){const R=H.camera.eye;this._objects.forEach((T,W)=>{W&D.VISIBLE_BIT&&T.forEach(Y=>{const U=k.squaredDistance(R,Y.obb.center);Y.renderable.meta.cameraDepthSquared=U})})};S.getMaterial=function(H){return H.renderable.material};S.updateMaterial=function(H,R){H=H.renderable.material;R(H);H.dirty&&this._notifyDirty()};S.setAllComponentVisibilities=
function(H,R){H.components.visibility.reset(R);H.components.visibilityDirty();this._notifyDirty()};S.forEachVisibleComponent=function(H,R){return H.components.visibility.forEachComponent(R)};S.getComponentCount=function(H){const R=H.components.visibility.componentCount();return{visible:R,invisible:H.components.count-R}};S.setComponentData=function(H,R){const T=H.renderable.material;if(D.isVaryingComponentParameters(R)){H=H.components;var W=H.materialDataBuffer;const Y=H.materialDataIndices,U={castShadows:!0,
pickable:!0,externalColor:e.create(),externalColorMixMode:1};W=W.textureBuffer;const N=new Uint8Array(4),ca=new Uint32Array(N.buffer);let O=0,V=0,ba=0,fa=!1,ia=0;for(let ma=0;ma<H.count;ma++)R(ma,U),O+=+(1>U.externalColor[3]),V+=+(3===U.externalColorMixMode&&1===U.externalColor[3]),ba+=+U.castShadows,l.encodeSymbolColor(U.externalColor,U.externalColorMixMode,N),N[2]=N[2]&254|+U.castShadows,W.setData(Y[ma],0,N[0],N[1],N[2],N[3]),fa=fa||0<ma&&ia!==ca[0],ia=ca[0],U.pickable!==C.getVisibility(H.pickability,
ma)&&(H.pickability=C.updateVisibilityWithCount(H.pickability,H.count,ma,U.pickable));fa?(T.componentParameters=new G.ComponentParametersVarying,T.componentParameters.castShadows=ba===H.count?0:0===ba?2:1,T.componentParameters.transparent=O===H.count?0:0===O?2:1,T.componentParameters.opaqueOverride=V===H.count?0:0===V?2:1,T.componentParameters.texture=W,W.updateTexture()):(T.componentParameters=new G.ComponentParametersUniform,T.componentParameters.castShadows=U.castShadows?0:2,T.componentParameters.externalColor=
U.externalColor,T.componentParameters.externalColorMixMode=U.externalColorMixMode)}else T.componentParameters=new G.ComponentParametersUniform,T.componentParameters.castShadows=R.castShadows?0:2,T.componentParameters.externalColor=R.externalColor,T.componentParameters.externalColorMixMode=R.externalColorMixMode;this._notifyDirty()};S.getComponentAabb=function(H,R,T){return H.intersectionGeometry.getComponentAabb(R,T)};S.getComponentObb=function(H){return H.obb};S.getObjectTransform=function(H){return H.transform};
S.getComponentPositions=function(H,R,T){return H.intersectionGeometry.getComponentPositions(R,T)};S.intersect=function(H,R,T,W,Y,U){b.isSome(Y)&&(Y.localOrigin=H.transform.position);const N=c.invert(P,H.transform.rotationScale);k.sub(Q,R,H.transform.position);k.sub(X,T,H.transform.position);k.transformMat3(Q,Q,N);k.transformMat3(X,X,N);R=c.transpose(P,N);return H.intersectionGeometry.intersect(Q,X,W,R,Y,U)};S.addEdges=function(H,R,T,W){const {indices:Y,positions:U}=H.intersectionGeometry;return R.addComponentObject(H,
H.transform,H.obb.center,U,Y,H.components.offsets,T,W)};S.addComponentHighlight=function(H,R){H=H.components;b.isNone(H.highlightCounts)&&(H.highlightCounts=new Uint32Array(H.count+1));0===H.highlightCounts[R]++&&(H.highlightsDirty(),this._notifyDirty());H.highlightCounts[H.count]++};S.removeComponentHighlight=function(H,R){H=H.components;if(b.isNone(H.highlightCounts))J.warn("Removing non-existing highlight.");else{var T=H.highlightCounts[R],W=H.highlightCounts[H.count];0===T?J.warn("Removing non-existing highlight."):
1<T?(H.highlightCounts[R]=T-1,H.highlightCounts[H.count]=W-1):(H.highlightCounts[R]=0,H.highlightsDirty(),this._notifyDirty(),1===W?H.highlightCounts=null:H.highlightCounts[H.count]=W-1)}};S.clearHighlights=function(H){H=H.components;b.isSome(H.highlightCounts)&&(H.highlightCounts=null,H.highlightsDirty(),this._notifyDirty())};S.getObjectGPUMemoryUsage=function(H){return H.renderable.meta.gpuMemoryEstimate};S._createRenderable=function(H,R){const T=this._renderManager.rctx,W=H.geometry,Y=W.vertices.layoutParameters,
U=v.createVertex(T,35044,W.vertices.data),N=b.applySome(W.indices,ia=>v.createIndex(T,35044,ia));var ca=n.glLayout(E.createVertexBufferLayout(Y)),O=new Uint16Array(W.vertices.count);for(var V=0;V<R.count;V++){var ba=R.offsets[V],fa=R.offsets[V+1];const ia=R.materialDataIndices[V];if(b.isSome(W.indices))for(;ba<fa;ba++)O[W.indices[ba]]=ia;else for(;ba<fa;ba++)O[ba]=ia}R=v.createVertex(T,35044,O.buffer);V=new I.TwoVectorPosition(H.transform.position);fa=h.clone(H.transform.rotationScale);c.invert(fa,
fa);c.transpose(fa,fa);O=new F.ComponentDrawParameters;k.copy(O.worldFromModel_TL,V.low);k.copy(O.worldFromModel_TH,V.high);c.copy(O.worldFromModel_RS,H.transform.rotationScale);c.copy(O.transformNormal_GlobalFromModel,fa);d.copy(O.toMapSpace,H.toMapSpace);H=new G.ComponentMaterial;ca=new t(T,H.attributeLocations,{data:ca,componentIndices:L},{data:U,componentIndices:R},b.unwrap(N));V=new x;V.material=H;V.drawParameters=O;V.geometry=new m.RenderGeometry(ca,W.primitiveType,Y,b.isSome(N));V.meta.cameraDepthSquared=
.5;V.meta.gpuMemoryEstimate=U.byteSize+R.byteSize+(b.isSome(N)?N.byteSize:0);return V};S._notifyDirty=function(){this._renderManager.notifyDirty()};g._createClass(aa,[{key:"visibleObjects",get:function(){return this._objects.getBucket(D.VISIBLE_BIT)}},{key:"performanceInfo",get:function(){const H=this._objects.getPerformanceInfo(D.VISIBLE_BIT);return{shown:H.added,hidden:H.removed}}}]);return aa}();const L=n.glLayout(q.newLayout().u16("componentIndex")),P=h.create(),Q=f.create(),X=f.create();a.ComponentObjectCollection=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat3f64 ../../../chunks/quatf64 ../../../chunks/vec4f64 ../../../chunks/mat3 ../../../chunks/vec4 ../../../chunks/quat ../../../geometry/support/aaBoundingBox ../../../chunks/vec3f32 ./geometryUtils ../../../chunks/quatf32 ./dito".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(m=[0,0,0],B=[-1,-1,-1],E=
[0,0,0,1]){return{center:g.clone(m),halfSize:n.clone(B),quaternion:u.clone(E)}}function l(m,B){const E=q.plane.signedDistance(B,m.center);m=w(m,q.plane.normal(B));return E>m?1:E<-m?-1:0}function w(m,B){e.conjugate(y,m.quaternion);b.transformQuat(D,B,y);m=m.halfSize;return Math.abs(D[0]*m[0])+Math.abs(D[1]*m[1])+Math.abs(D[2]*m[2])}const y=f.create(),D=g.create(),z=g.create(),r=k.create(),C=p.create(),A=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],x=(()=>{const m=new Int8Array(162);let B=0;const E=F=>{for(let G=
0;G<F.length;G++)m[B+G]=F[G];B+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,5,1,3,7,6]);E([0,2,3,7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return m})();
a.ObbArray=function(m){this.buffer=new ArrayBuffer(56*m);this.obbs=Array(m);for(let B=0;B<m;B++)this.obbs[B]={center:g.createView(this.buffer,56*B),halfSize:n.createView(this.buffer,56*B+24),quaternion:u.createView(this.buffer,56*B+36)}};a.clone=function(m){return t(m.center,m.halfSize,m.quaternion)};a.compute=function(m,B){B=B||t();v.computeOBB(m,B);return B};a.corners=function(m,B){for(let E=0;8>E;++E){const F=B[E];F[0]=E&1?-m.halfSize[0]:m.halfSize[0];F[1]=E&2?-m.halfSize[1]:m.halfSize[1];F[2]=
E&4?-m.halfSize[2]:m.halfSize[2];b.transformQuat(F,F,m.quaternion);b.add(F,F,m.center)}};a.create=t;a.intersectLine=function(m,B,E,F=0){e.conjugate(y,m.quaternion);b.subtract(D,B,m.center);B=b.transformQuat(D,D,y);E=b.transformQuat(z,E,y);let G=-Infinity,I=Infinity;for(let K=0;3>K;K++)if(1E-6<Math.abs(E[K])){const J=(F+m.halfSize[K]-B[K])/E[K],L=(-F-m.halfSize[K]-B[K])/E[K];G=Math.max(G,Math.min(J,L));I=Math.min(I,Math.max(J,L))}else if(B[K]>m.halfSize[K]+F||B[K]<-m.halfSize[K]-F)return!1;return G<=
I};a.intersectPlane=l;a.isVisible=function(m,B){return 0>=l(m,B[0])&&0>=l(m,B[1])&&0>=l(m,B[2])&&0>=l(m,B[3])&&0>=l(m,B[4])&&0>=l(m,B[5])};a.maximumDistancePlane=function(m,B){const E=q.plane.signedDistance(B,m.center);m=w(m,q.plane.normal(B));return E+m};a.minimumDistancePlane=function(m,B){const E=q.plane.signedDistance(B,m.center);m=w(m,q.plane.normal(B));return E-m};a.projectedArea=function(m,B,E,F,G){e.conjugate(y,m.quaternion);b.sub(D,B,m.center);b.transformQuat(D,D,y);var I=D[0]<-m.halfSize[0]?
-1:D[0]>m.halfSize[0]?1:0,K=D[1]<-m.halfSize[1]?-1:D[1]>m.halfSize[1]?1:0,J=D[2]<-m.halfSize[2]?-1:D[2]>m.halfSize[2]?1:0;B=Math.abs(I)+Math.abs(K)+Math.abs(J);if(0===B)return Infinity;B=1===B?4:6;I=6*(I+3*K+9*J+13);c.fromQuat(C,m.quaternion);c.scale(C,C,m.halfSize);for(K=0;K<B;K++)J=x[I+K],b.set(D,((J&1)<<1)-1,(J&2)-1,((J&4)>>1)-1),b.transformMat3(D,D,C),b.add(r,m.center,D),r[3]=1,d.transformMat4(r,r,E),J=1/Math.max(1E-6,r[3]),A[2*K]=r[0]*J,A[2*K+1]=r[1]*J;m=2*B-2;E=A[0]*(A[3]-A[m+1])+A[m]*(A[1]-
A[m-1]);for(B=2;B<m;B+=2)E+=A[B]*(A[B+3]-A[B-1]);return Math.abs(E)*F*G*.125};a.projectedRadius=w;a.set=function(m,B){b.copy(B.center,m.center);b.copy(B.halfSize,m.halfSize);e.copy(B.quaternion,m.quaternion)};a.toAaBoundingBox=function(m,B){B||(B=h.create());var E=c.fromQuat(C,m.quaternion);const F=m.halfSize[0]*Math.abs(E[0])+m.halfSize[1]*Math.abs(E[3])+m.halfSize[2]*Math.abs(E[6]),G=m.halfSize[0]*Math.abs(E[1])+m.halfSize[1]*Math.abs(E[4])+m.halfSize[2]*Math.abs(E[7]);E=m.halfSize[0]*Math.abs(E[2])+
m.halfSize[1]*Math.abs(E[5])+m.halfSize[2]*Math.abs(E[8]);B[0]=m.center[0]-F;B[1]=m.center[1]-G;B[2]=m.center[2]-E;B[3]=m.center[0]+F;B[4]=m.center[1]+G;B[5]=m.center[2]+E;return B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function g(){const c=new Float32Array(4);c[3]=1;return c}function b(c){const d=new Float32Array(4);d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[3];return d}function p(c,d,e,h){const n=new Float32Array(4);n[0]=c;
n[1]=d;n[2]=e;n[3]=h;return n}function f(c,d){return new Float32Array(c,d,4)}var k=Object.freeze({__proto__:null,create:g,clone:b,fromValues:p,createView:f});a.clone=b;a.create=g;a.createView=f;a.fromValues=p;a.quatf32=k})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function g(N,ca,O,V,ba,fa){if(!(1E-6>ca[0]*ca[0]+ca[1]*ca[1]+ca[2]*ca[2]))for(q(E,O,ca),q(F,V,ca),q(G,ba,ca),b(N,ca,B),K[1]=B[0],I[1]=B[1],J[1]=I[1]-K[1],O=[O,V,ba],V=[E,F,G],ba=0;3>ba;++ba){b(N,O[ba],B);K[0]=
B[0];I[0]=B[1];b(N,V[ba],B);K[2]=B[0];I[2]=B[1];J[0]=I[0]-K[0];J[2]=I[2]-K[2];const ia=c(J);ia<fa.quality&&(n(fa.b0,O[ba]),n(fa.b1,ca),n(fa.b2,V[ba]),fa.quality=ia)}}function b(N,ca,O){const {data:V,size:ba}=N;O[0]=Number.POSITIVE_INFINITY;O[1]=Number.NEGATIVE_INFINITY;for(N=0;N<V.length;N+=ba){const fa=V[N]*ca[0]+V[N+1]*ca[1]+V[N+2]*ca[2];O[0]=Math.min(O[0],fa);O[1]=Math.max(O[1],fa)}}function p(N,ca,O){n(O.center,N);h(O.halfSize,ca,.5);O.quaternion[0]=0;O.quaternion[1]=0;O.quaternion[2]=0;O.quaternion[3]=
1}function f(N,ca,O,V,ba,fa){b(N,ca,B);ba[0]=B[0];fa[0]=B[1];b(N,O,B);ba[1]=B[0];fa[1]=B[1];b(N,V,B);ba[2]=B[0];fa[2]=B[1]}function k(N,ca,O,V,ba,fa,ia){T[0]=N[0];T[1]=N[1];T[2]=N[2];T[3]=ca[0];T[4]=ca[1];T[5]=ca[2];T[6]=O[0];T[7]=O[1];T[8]=O[2];var ma=ia.quaternion,ea=T,M=ea[0]+ea[4]+ea[8];if(0<M)M=Math.sqrt(M+1),ma[3]=.5*M,M=.5/M,ma[0]=(ea[5]-ea[7])*M,ma[1]=(ea[6]-ea[2])*M,ma[2]=(ea[1]-ea[3])*M;else{M=0;ea[4]>ea[0]&&(M=1);ea[8]>ea[3*M+M]&&(M=2);const Z=(M+1)%3,la=(M+2)%3;let ka=Math.sqrt(ea[3*M+
M]-ea[3*Z+Z]-ea[3*la+la]+1);ma[M]=.5*ka;ka=.5/ka;ma[3]=(ea[3*Z+la]-ea[3*la+Z])*ka;ma[Z]=(ea[3*Z+M]+ea[3*M+Z])*ka;ma[la]=(ea[3*la+M]+ea[3*M+la])*ka}d(W,V,ba);h(W,W,.5);h(ia.center,N,W[0]);h(R,ca,W[1]);d(ia.center,ia.center,R);h(R,O,W[2]);d(ia.center,ia.center,R);h(ia.halfSize,fa,.5)}function c(N){return N[0]*N[1]+N[0]*N[2]+N[1]*N[2]}function d(N,ca,O){N[0]=ca[0]+O[0];N[1]=ca[1]+O[1];N[2]=ca[2]+O[2]}function e(N,ca,O){N[0]=ca[0]-O[0];N[1]=ca[1]-O[1];N[2]=ca[2]-O[2]}function h(N,ca,O){N[0]=ca[0]*O;N[1]=
ca[1]*O;N[2]=ca[2]*O}function n(N,ca,O=0){N[0]=ca[O+0];N[1]=ca[O+1];N[2]=ca[O+2]}function q(N,ca,O){const V=ca[0],ba=ca[1];ca=ca[2];const fa=O[0],ia=O[1];O=O[2];N[0]=ba*O-ca*ia;N[1]=ca*fa-V*O;N[2]=V*ia-ba*fa}function u(N,ca){var O=ca[0]*ca[0]+ca[1]*ca[1]+ca[2]*ca[2];0<O&&(O=1/Math.sqrt(O),N[0]=ca[0]*O,N[1]=ca[1]*O,N[2]=ca[2]*O)}function v(N,ca){const O=ca[0]-N[0],V=ca[1]-N[1];N=ca[2]-N[2];return O*O+V*V+N*N}const t=[0,0,0],l=[0,0,0],w=[0,0,0],y=[0,0,0],D=[0,0,0],z=[0,0,0],r=[0,0,0],C=[0,0,0],A=[0,
0,0],x=[0,0,0],m=[0,0,0],B=[0,0],E=[0,0,0],F=[0,0,0],G=[0,0,0],I=[0,0,0],K=[0,0,0],J=[0,0,0],L=[0,0,0],P=[0,0,0],Q=[0,0,0],X=[0,0,0],aa=[0,0,0],S=[0,0,0],H=[0,0,0],R=[0,0,0],T=[1,0,0,0,1,0,0,0,1],W=[0,0,0];let Y=function(N){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ca=0;this.minProj=new Float64Array(this.buffer,ca,7);ca+=56;this.maxProj=new Float64Array(this.buffer,ca,7);ca+=56;for(var O=0;7>O;++O)this.minVert[O]=new Float64Array(this.buffer,ca,3),ca+=24;for(O=
0;7>O;++O)this.maxVert[O]=new Float64Array(this.buffer,ca,3),ca+=24;for(ca=0;7>ca;++ca)this.minProj[ca]=Number.POSITIVE_INFINITY,this.maxProj[ca]=Number.NEGATIVE_INFINITY;ca=Array(7);O=Array(7);const {data:V,size:ba}=N;for(N=0;N<V.length;N+=ba){var fa=V[N];fa<this.minProj[0]&&(this.minProj[0]=fa,ca[0]=N);fa>this.maxProj[0]&&(this.maxProj[0]=fa,O[0]=N);fa=V[N+1];fa<this.minProj[1]&&(this.minProj[1]=fa,ca[1]=N);fa>this.maxProj[1]&&(this.maxProj[1]=fa,O[1]=N);fa=V[N+2];fa<this.minProj[2]&&(this.minProj[2]=
fa,ca[2]=N);fa>this.maxProj[2]&&(this.maxProj[2]=fa,O[2]=N);fa=V[N]+V[N+1]+V[N+2];fa<this.minProj[3]&&(this.minProj[3]=fa,ca[3]=N);fa>this.maxProj[3]&&(this.maxProj[3]=fa,O[3]=N);fa=V[N]+V[N+1]-V[N+2];fa<this.minProj[4]&&(this.minProj[4]=fa,ca[4]=N);fa>this.maxProj[4]&&(this.maxProj[4]=fa,O[4]=N);fa=V[N]-V[N+1]+V[N+2];fa<this.minProj[5]&&(this.minProj[5]=fa,ca[5]=N);fa>this.maxProj[5]&&(this.maxProj[5]=fa,O[5]=N);fa=V[N]-V[N+1]-V[N+2];fa<this.minProj[6]&&(this.minProj[6]=fa,ca[6]=N);fa>this.maxProj[6]&&
(this.maxProj[6]=fa,O[6]=N)}for(N=0;7>N;++N)fa=ca[N],n(this.minVert[N],V,fa),fa=O[N],n(this.maxVert[N],V,fa)},U=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(N,ca){const {data:O,size:V}=N;var ba=O.length/V;if(!(0>=ba)){var fa=new Y(N);d(t,fa.minProj,fa.maxProj);h(t,t,.5);e(l,fa.maxProj,fa.minProj);var ia=c(l),ma=new U;ma.quality=ia;14>ba&&(N={data:new Float64Array(fa.buffer,112,42),size:3});var ea=[0,0,0],M=[0,0,0],Z=[0,0,0];ba=[0,0,0];var la=[0,
0,0],ka=[0,0,0],ha=[0,0,0];var na=N;var da=v(fa.maxVert[0],fa.minVert[0]),oa=0;for(var qa=1;7>qa;++qa){const ua=v(fa.maxVert[qa],fa.minVert[qa]);ua>da&&(da=ua,oa=qa)}n(ea,fa.minVert[oa]);n(M,fa.maxVert[oa]);if(1E-6>v(ea,M))na=1;else{e(ba,ea,M);u(ba,ba);{const {data:ua,size:Ca}=na;fa=Number.NEGATIVE_INFINITY;da=0;for(oa=0;oa<ua.length;oa+=Ca)m[0]=ua[oa]-ea[0],m[1]=ua[oa+1]-ea[1],m[2]=ua[oa+2]-ea[2],qa=ba[0]*m[0]+ba[1]*m[1]+ba[2]*m[2],qa=m[0]*m[0]+m[1]*m[1]+m[2]*m[2]-qa*qa/(ba[0]*ba[0]+ba[1]*ba[1]+
ba[2]*ba[2]),qa>fa&&(fa=qa,da=oa);n(Z,ua,da)}1E-6>fa?na=2:(e(la,M,Z),u(la,la),e(ka,Z,ea),u(ka,ka),q(ha,la,ba),u(ha,ha),g(na,ha,ba,la,ka,ma),na=0)}switch(na){case 1:p(t,l,ca);return;case 2:ia=N;n(P,ba);Math.abs(ba[0])>Math.abs(ba[1])&&Math.abs(ba[0])>Math.abs(ba[2])?P[0]=0:Math.abs(ba[1])>Math.abs(ba[2])?P[1]=0:P[2]=0;1E-6>P[0]*P[0]+P[1]*P[1]+P[2]*P[2]&&(P[0]=P[1]=P[2]=1);q(Q,ba,P);u(Q,Q);q(X,ba,Q);u(X,X);f(ia,ba,Q,X,aa,S);e(H,S,aa);k(ba,Q,X,aa,S,H,ca);return}na=N;{fa=B;const {data:ua,size:Ca}=na;
n(y,ua);n(w,y);fa[0]=L[0]*ha[0]+L[1]*ha[1]+L[2]*ha[2];fa[1]=fa[0];for(da=Ca;da<ua.length;da+=Ca)oa=ua[da]*ha[0]+ua[da+1]*ha[1]+ua[da+2]*ha[2],oa<fa[0]&&(fa[0]=oa,n(y,ua,da)),oa>fa[1]&&(fa[1]=oa,n(w,ua,da))}ha=ea[0]*ha[0]+ea[1]*ha[1]+ea[2]*ha[2];B[1]-1E-6<=ha&&(w[0]=void 0);B[0]+1E-6>=ha&&(y[0]=void 0);void 0!==w[0]&&(e(D,w,ea),u(D,D),e(z,w,M),u(z,z),e(r,w,Z),u(r,r),q(C,z,ba),u(C,C),q(A,r,la),u(A,A),q(x,D,ka),u(x,x),g(na,C,ba,z,D,ma),g(na,A,la,r,z,ma),g(na,x,ka,D,r,ma));void 0!==y[0]&&(e(D,y,ea),u(D,
D),e(z,y,M),u(z,z),e(r,y,Z),u(r,r),q(C,z,ba),u(C,C),q(A,r,la),u(A,A),q(x,D,ka),u(x,x),g(na,C,ba,z,D,ma),g(na,A,la,r,z,ma),g(na,x,ka,D,r,ma));f(N,ma.b0,ma.b1,ma.b2,aa,S);N=[0,0,0];e(N,S,aa);ma.quality=c(N);ma.quality<ia?k(ma.b0,ma.b1,ma.b2,aa,S,N,ca):p(t,l,ca)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/maybe",
"../../lib/AutoDisposable","./IndexRange/ComponentRangeRunLengthEncoded"],function(a,g,b,p,f){function k(c,d,e){const h=[],n=[];let q=e.length,u=e.length;d.forEachComponent(v=>{0<c[v]?(q!==v-1&&(h.length&&h.push(e[q+1]-h[h.length-1]),h.push(e[v])),q=v):(u!==v-1&&(n.length&&n.push(e[u+1]-n[n.length-1]),n.push(e[v])),u=v);return!0});h.length&&h.push(e[q+1]-h[h.length-1]);n.length&&n.push(e[u+1]-n[n.length-1]);return{highlightRanges:h,defaultRanges:n}}return function(c){function d(h,n){var q=c.call(this)||
this;q.pickability=null;q.highlightCounts=null;q.cachedGeometryRanges=null;q.cachedHighlightRanges=null;q.cachedDefaultRanges=null;q.offsets=g.slice(n);n=q.count;q.visibility=new f.ComponentRangeRunLengthEncoded(n);q.materialDataBuffer=h.getBuffer(n);q.materialDataIndices=new Uint16Array(n);for(h=0;h<n;h++)q.materialDataIndices[h]=q.materialDataBuffer.acquireIndex();return q}a._inheritsLoose(d,c);var e=d.prototype;e.dispose=function(){c.prototype.dispose.call(this);for(let h=0;h<this.count;h++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[h])};
e.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};e.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};e.updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:h,defaultRanges:n}=k(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=h;this.cachedDefaultRanges=n}};a._createClass(d,[{key:"count",
get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this.updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this.updateCachedHighlightRanges();
return this.cachedDefaultRanges}}]);return d}(p.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let g=function(){function b(f){this._totalCount=f;this._indexRanges=[0,f]}var p=b.prototype;p.componentCount=function(){const f=this._indexRanges;let k=0;for(let c=0;c<f.length;c+=2)k+=f[c+1];return k};p.reset=function(f){if("all"===f||f.length===this._totalCount)this._indexRanges=[0,this._totalCount];
else{{const d=[];if(0!==f.length){var k=f[0],c=1;for(let e=1;e<f.length;e++){const h=f[e];k+c===h?c+=1:(d.push(k),d.push(c),k=h,c=1)}d.push(k);d.push(c)}f=d}this._indexRanges=f}};p.forEachComponent=function(f){const k=this._indexRanges;for(let d=0;d<k.length;d+=2){var c=k[d];const e=c+k[d+1];for(;c<e;c++)if(!f(c))return!1}return!0};p.forEachComponentRange=function(f){const k=this._indexRanges;for(let c=0;c<k.length;c+=2){const d=k[c];if(!f(d,d+k[c+1]))return!1}return!0};p.computeOffsetRanges=function(f){const k=
Array(this._indexRanges.length),c=this._indexRanges;for(let e=0;e<c.length;e+=2){var d=c[e];const h=f[d];d=f[d+c[e+1]];k[e]=h;k[e+1]=d-h}return k};return b}();a.ComponentRangeRunLengthEncoded=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],function(a){a.VISIBLE_BIT=1;a.isVaryingComponentParameters=function(g){return"function"===typeof g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../lib/AutoDisposable"],function(a,g,b){b=function(k){function c(){var d=k.apply(this,arguments)||this;d._bucket=null;d._bucketIndex=0;return d}g._inheritsLoose(c,k);g._createClass(c,[{key:"bucketKey",get:function(){return this._bucket.key}}]);return c}(b.AutoDisposable);let p=function(){function k(){this._buckets=new Map}var c=k.prototype;c.add=function(d,e){d=this._getBucket(d);e._bucket=d;e._bucketIndex=d.count;d.data.push(e);++d.statistics.added};
c.remove=function(d){++d._bucket.statistics.removed;const e=d._bucket.data,h=e[e.length-1];e[d._bucketIndex]=h;h._bucketIndex=d._bucketIndex;e.pop();d._bucket=null;d._bucketIndex=0};c.updateKey=function(d,e){this.remove(d);this.add(e,d)};c.getBucket=function(d){return this._getBucket(d).data};c.getPerformanceInfo=function(d){return this._getBucket(d).statistics};c.forEach=function(d){this._buckets.forEach(e=>d(e.data,e.key))};c._getBucket=function(d){var e=this._buckets.get(d);if(e)return e;e=new f(d);
this._buckets.set(d,e);return e};g._createClass(k,[{key:"count",get:function(){let d=0;this._buckets.forEach(e=>d+=e.count);return d}}]);return k}(),f=function(){function k(c){this.key=c;this.data=[];this.statistics={added:0,removed:0}}g._createClass(k,[{key:"count",get:function(){return this.data.length}}]);return k}();a.BucketStorable=b;a.BucketedObjectStore=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable","./interface","../../core/util/BucketedObjectStore"],function(a,g,b,p,f){f=function(k){function c(){return k.apply(this,arguments)||this}a._inheritsLoose(c,k);a._createClass(c,[{key:"visible",get:function(){return!!(this.bucketKey&p.VISIBLE_BIT)}}]);return c}(f.BucketStorable);g.__decorate([b.autoDispose()],f.prototype,"renderable",void 0);g.__decorate([b.autoDispose()],f.prototype,"components",void 0);return f})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],
function(a){function g(b=!0){return{isVisibleBit:!b,data:new Uint32Array(0)}}a.defaultVisibilities=g;a.getVisibility=function(b,p){if(null==b)return!0;const {isVisibleBit:f,data:k}=b,c=8*k.BYTES_PER_ELEMENT;return p<k.length*c?(b=p/c|0,p=0!==(k[b]&1<<p-b*c)===f):!b.isVisibleBit};a.updateVisibilityWithCount=function(b,p,f,k){if(f>=p)return b;null==b&&(b=g());let c=b.data;const d=8*c.BYTES_PER_ELEMENT,e=f/d|0,h=f-d*e,n=c;k=k===b.isVisibleBit;f<n.length*d||!k||(f=Math.max(e+1,Math.ceil(1.5*n.length)),
f=Math.min(f,((p-1)/d|0)+1),c=new Uint32Array(f),c.set(n));e<c.length&&(c[e]=c[e]&~(1<<h)|(k?1:0)<<h);b.data=c;return b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/buffer/BufferView ../../../../../geometry/support/aaBoundingBox ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil ../../lib/ComponentUtils".split(" "),
function(a,g,b,p,f,k,c,d,e){let h=function(){function u(t,l){this._indices=g.isSome(t.indices)?t.indices:c.generateDefaultIndexArray(t.positions.length/3);this._positions=new f.BufferViewVec3f(t.positions);this._components=l}var v=u.prototype;v.getComponentAabb=function(t,l){if(g.isSome(this._perComponentAabbs)){for(let w=0;6>w;w++)l[w]=this._perComponentAabbs[6*t+w];return l}this._computePerComponentAabbs();return this.getComponentAabb(t,l)};v.getComponentPositions=function(t,l){l.indices=this._indices;
l.data=this._positions.typedBuffer;l.stride=this._positions.typedBufferStride;l.startIndex=this._components.offsets[t];l.endIndex=this._components.offsets[t+1]};v.intersect=function(t,l,w,y,D,z){const r={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},C=this._indices,A=this._components.offsets,x=d.computeInvDir(t,l,n);this._components.visibility.forEachComponent(m=>{if(!e.getVisibility(this._components.pickability,m))return!0;const B=this.getComponentAabb(m,q);g.isSome(D)&&
D.applyToAabb(B);if(!d.intersectAabbInvDir(B,t,x,w))return!0;d.intersectTriangles(t,l,A[m]/3,A[m+1]/3,C,r,void 0,D,(E,F,G)=>z(m,E,p.transformMat3(F,F,y),G));return!0})};v._computePerComponentAabbs=function(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);for(let l=0;l<t;l++)this._computeAABB(l)};v._computeAABB=function(t){const l=this._indices,w=this._positions;var y=this._components.offsets,D=y[t];const z=y[t+1],r=[0,0,0];y=[Infinity,Infinity,Infinity];const C=[-Infinity,
-Infinity,-Infinity];for(;D<z;D++)w.getVec(l[D],r),p.min(y,y,r),p.max(C,C,r);t*=6;this._perComponentAabbs[t++]=y[0];this._perComponentAabbs[t++]=y[1];this._perComponentAabbs[t++]=y[2];this._perComponentAabbs[t++]=C[0];this._perComponentAabbs[t++]=C[1];this._perComponentAabbs[t]=C[2]};a._createClass(u,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return u}();const n=b.create(),q=k.create();return h})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,g,b){let p=function(f){function k(){var c=f.apply(this,arguments)||this;c.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return c}a._inheritsLoose(k,f);return k}(b.AutoDisposable);g.__decorate([b.autoDispose()],p.prototype,"geometry",void 0);return p})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6",
"../../lib/AutoDisposable"],function(a,g,b,p){let f=function(k){function c(d,e,h,n){var q=k.call(this)||this;q.primitiveType=e;q.parameters=h;q.indexed=n;q.vao=d;return q}g._inheritsLoose(c,k);return c}(p.AutoDisposable);b.__decorate([p.autoDispose()],f.prototype,"vao",void 0);a.RenderGeometry=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,g){let b=function(){function p(k){this._objects=
k}var f=p.prototype;f.submit=function(k,c){this._objects.preSubmit(c);c=this._objects.visibleObjects;for(let d=0;d<c.length;d++){const e=c[d];e.renderable.material.submit(k,e)}};f.queryShadowCasterDepthRange=function(k){return this._objects.visibleObjects.length?g.computeDepthRange(k,this._objects.visibleObjects):null};return p}();a.RenderSubmitSystem=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3f64 ../../../../../chunks/quatf64 ../../../../../chunks/mat3 ../../../../../chunks/quat ../../../../../chunks/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){function q(I,K,J){return p.set(I,K.data[J+0],K.data[J+1],K.data[J+2])}function u(I,K){I.push(K[0]);I.push(K[1]);I.push(K[2])}function v(I,K,J,L){d.conjugate(x,I.quaternion);p.sub(m,K,I.center);p.transformQuat(m,m,x);const P=8*((m[0]<-I.halfSize[0]?-1:m[0]>I.halfSize[0]?1:0)+3*(m[1]<-I.halfSize[1]?-1:m[1]>I.halfSize[1]?1:0)+9*(m[2]<-I.halfSize[2]?-1:m[2]>I.halfSize[2]?1:0)+13);K=C[P];if(0===K)return K;c.fromQuat(A,I.quaternion);c.scale(A,A,I.halfSize);const Q=(X,aa)=>
{aa=C[P+aa+1];p.set(X,((aa&1)<<1)-1,(aa&2)-1,((aa&4)>>1)-1);p.transformMat3(X,X,A);return p.add(X,I.center,X)};J.length=0;u(J,Q(B,0));u(J,Q(E,1));u(J,Q(m,2));u(J,Q(F,3));L(J);if(1===K)return K;J.length=0;u(J,B);u(J,F);u(J,Q(m,4));u(J,Q(G,5));L(J);if(2===K)return K;J.length=0;u(J,B);u(J,G);u(J,Q(m,6));u(J,E);L(J);return K}function t(I,K){let J=0;for(let L=0;4>L;L++){const P=h.intersectPlane(I,K[L]);if(0<P)return-1;0===P&&(J|=1<<L)}return J}const l=new g({allocator:I=>I||{near:Infinity,far:-Infinity,
mask:0,object:null},deallocator:I=>{I.object=null;return I}}),w=n.empty(),y=b.create(),D=b.create(),z=new g({deallocator:null}),r=new g({deallocator:null}),C=(()=>{const I=new Int8Array(216);let K=0;const J=L=>{for(let P=0;P<L.length;P++)I[K+P]=L[P];K+=8};J([3,0,6,2,3,1,5,4]);J([2,0,2,3,1,5,4,0]);J([3,1,0,2,3,7,5,4]);J([2,0,1,3,2,6,4,0]);J([1,0,1,3,2,0,0,0]);J([2,1,5,7,3,2,0,0]);J([3,2,0,1,3,7,6,4]);J([2,2,0,1,3,7,6,0]);J([3,3,0,1,5,7,6,2]);J([2,0,1,5,4,6,2,0]);J([1,0,1,5,4,0,0,0]);J([2,1,3,7,5,4,
0,0]);J([1,0,2,6,4,0,0,0]);J([0,0,0,0,0,0,0,0]);J([1,1,3,7,5,0,0,0]);J([2,2,3,7,6,4,0,0]);J([1,2,3,7,6,0,0,0]);J([2,3,1,5,7,6,2,0]);J([3,4,0,1,5,7,6,2]);J([2,5,7,6,4,0,1,0]);J([3,5,0,1,3,7,6,4]);J([2,4,5,7,6,2,0,0]);J([1,4,5,7,6,0,0,0]);J([2,5,1,3,7,6,4,0]);J([3,6,0,2,3,7,5,4]);J([2,6,2,3,7,5,4,0]);J([3,7,6,2,3,1,5,4]);return I})(),A=f.create(),x=k.create(),m=b.create(),B=b.create(),E=b.create(),F=b.create(),G=b.create();a.computeDepthRange=function(I,K){const J=n.empty(),{eye:L,frustum:P,viewForward:Q}=
I;for(I=0;I<K.length;I++){var X=K[I].obb;const aa=p.dot(p.sub(m,X.center,L),Q),S=h.projectedRadius(X,Q);if(n.within(J,aa-S)&&n.within(J,aa+S))continue;X=t(X,P);if(-1===X)continue;if(0===X){w.far=aa+S;w.near=aa-S;n.union(J,w);continue}const H=l.pushNew();H.near=aa-S;H.far=aa+S;H.mask=X;H.object=K[I]}for(K=0;K<l.length;K++){const aa=l.data[K];n.within(J,aa.near)&&n.within(J,aa.far)||(w.far=aa.far,w.near=Infinity,0===v(aa.object.obb,L,z,S=>{var H=r;for(var R=0;4>R&&0<S.length;R++)if(0!==(aa.mask&1<<
R)){{var T=P[R],W=S,Y=H;Y.length=0;const U=W.length-3;q(y,W,U);const N=e.signedDistance(T,y);0>=N&&(Y.push(y[0]),Y.push(y[1]),Y.push(y[2]));let ca=0,O=N;for(ca;ca<U;ca+=3){q(D,W,ca);const V=e.signedDistance(T,D);0>O*V&&(p.lerp(y,D,y,V/(V-O)),u(Y,y));0>=V&&u(Y,D);O=V;p.copy(y,D)}0>O*N&&(q(D,W,U),p.lerp(y,D,y,N/(N-O)),u(Y,y))}T=S;S=H;H=T}for(H=0;H<S.length;H+=3)p.set(y,S.data[H+0],S.data[H+1],S.data[H+2]),R=p.dot(p.sub(y,y,L),Q),w.near=Math.min(w.near,R)})&&(w.near=0),n.union(J,w))}l.length=0;return J};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function g(p,f){return{near:p,far:f}}function b(p,f,k){p.near=f;p.far=k;return p}a.create=g;a.empty=function(p){return p?b(p,Infinity,-Infinity):g(Infinity,-Infinity)};a.set=b;a.union=function(p,f,k=p){k.near=Math.min(p.near,f.near);k.far=Math.max(p.far,f.far);return k};a.within=function(p,f){return p.near<=f&&f<=p.far};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout"],function(a,g){a.createVertexBufferLayout=function(b){const p=g.newLayout().vec3f("position");b.normals&&p.vec2i16("normalCompressed",{glNormalized:!0});1===b.textureCoordinates?p.vec2f("uv0"):2===b.textureCoordinates&&(p.vec2f("uv0"),p.vec4u16("uvRegion",{glNormalized:!0}));b.colors&&p.vec4u8("color",{glNormalized:!0});return p.alignTo(4)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../../../webgl/Program ../../../../../webgl/renderState ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../lib/OrderIndependentTransparency ../../../lib/StencilUtils ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../../chunks/ComponentShader.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r){const C={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9,TERRAIN_LINEAR_DEPTH:10,GEOMETRY_LINEAR_DEPTH:11};e=function(x){function m(){return x.apply(this,arguments)||this}b._inheritsLoose(m,x);var B=m.prototype;B.bindPass=function(E,F){const G=this.program;z.VertexPosition.bindViewProjTransform(G,
F.viewTransform);u.Slice.bindUniforms(this.program,this.configuration,F.slicePlane);0===F.identifier&&void 0!==F.ssrParams&&(F.ssrParams.lastFrameColorTextureUnit=C.LAST_FRAME_COLOR,F.ssrParams.linearDepthTextureUnit=C.PREPASS_LINEAR_DEPTH,w.ScreenSpaceReflections.bindUniforms(this.program,E,F.ssrParams));0===F.identifier&&(G.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",F.transformNormal_ViewFromGlobal),2===F.subPass&&G.setUniform2fv("cameraNearFar",F.cameraNearFar),0!==F.subPass&&1!==F.subPass||
!F.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",F.cameraNearFar),G.setUniform2fv("inverseViewport",F.inverseViewport),F.multipassTerrainParams.terrainLinearDepthTexture&&(G.setUniform1i("terrainDepthTexture",C.TERRAIN_LINEAR_DEPTH),E.bindTexture(F.multipassTerrainParams.terrainLinearDepthTexture,C.TERRAIN_LINEAR_DEPTH))),0===F.subPass&&(F.ambientOcclusionEnabled&&F.ambientOcclusion.bind(G,C.SSAO),F.shadowsEnabled&&F.shadowMap.bind(G,C.SHADOW_MAP),F.lighting.setUniforms(this.program,
F.integratedMesh)));1===F.identifier&&this.program.setUniform2fv("cameraNearFar",F.cameraNearFar);2===F.identifier&&v.OutputHighlight.bindOutputHighlight(E,this.program,F)};B.bindDraw=function(E,F){z.VertexPosition.bindModelTransform(this.program,E);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",E.transformNormal_GlobalFromModel);if(F.isIntegratedMesh){const G=F.overlayTexScale;F=F.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[E.toMapSpace[0]*G[0]+F[0],E.toMapSpace[1]*
G[1]+F[1],E.toMapSpace[0]*G[2]+F[2],E.toMapSpace[1]*G[3]+F[3]]);this.program.setUniform4fv("overlayTexScale",[E.toMapSpace[2]*G[0],E.toMapSpace[3]*G[1],E.toMapSpace[2]*G[2],E.toMapSpace[3]*G[3]])}};B.bindMaterial=function(E,F,G){const I=this.program;I.setUniform4fv("uBaseColor",F.baseColor);I.setUniform1f("uObjectOpacity",F.objectOpacity);I.setUniform1f("textureAlphaCutoff",F.alphaCutoff);1===F.componentParameters.type?F.componentParameters.texture.bind(I,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",
unit:C.COMPONENT_COLOR}):(I.setUniform4fv("uExternalColor",F.componentParameters.externalColor),I.setUniform1i("uExternalColorMixMode",F.componentParameters.externalColorMixMode));f.isSome(F.baseColorTexture)&&F.baseColorTexture.bind(E,I,"uBaseColorTexture",C.DIFFUSE,"uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)D.PhysicallyBasedRenderingParameters.bindUniforms(this.program,F,this.configuration.isSchematic),f.isSome(F.metallicRoughnessTexture)&&F.metallicRoughnessTexture.bind(E,
I,"texMetallicRoughness",C.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),f.isSome(F.emissionTexture)&&F.emissionTexture.bind(E,I,"texEmission",C.EMISSION,"texEmissionSize"),f.isSome(F.occlusionTexture)&&F.occlusionTexture.bind(E,I,"texOcclusion",C.OCCLUSION,"texOcclusionSize"),f.isSome(F.normalTexture)&&F.normalTexture.bind(E,I,"normalTexture",C.NORMAL,"normalTextureSize");F.isIntegratedMesh&&(0===G.identifier&&0===G.subPass?(E.bindTexture(f.unwrap(F.overlayColorInner),C.OVERLAY0_COLOR),E.bindTexture(f.unwrap(F.overlayColorOuter),
C.OVERLAY1_COLOR),E.bindTexture(f.unwrap(F.overlayNormalInner),C.OVERLAY0_NORMAL),E.bindTexture(f.unwrap(F.overlayNormalOuter),C.OVERLAY1_NORMAL),I.setUniform1i("ovInnerNormalTex",C.OVERLAY0_NORMAL),I.setUniform1i("ovOuterNormalTex",C.OVERLAY1_NORMAL)):2===G.identifier&&(E.bindTexture(f.unwrap(F.overlayHighlightInner),C.OVERLAY0_COLOR),E.bindTexture(f.unwrap(F.overlayHighlightOuter),C.OVERLAY1_COLOR)),I.setUniform1i("ovInnerColorTex",C.OVERLAY0_COLOR),I.setUniform1i("ovOuterColorTex",C.OVERLAY1_COLOR),
I.setUniform1f("overlayOpacity",1))};B.initializeProgram=function(E){const F=m.shader.get();var G=this.configuration;G=F.build({multipassTerrainEnabled:G.multipassTerrainEnabled,cullAboveGround:G.cullAboveGround,OITEnabled:0===G.transparencyPassType,output:G.output,normalType:0===G.integratedMeshMode?G.hasNormals?1:3:2,attributeColor:G.hasVertexColors,attributeTextureCoordinates:G.vertexTextureCoordinates,componentData:G.componentData,alphaDiscardMode:G.alphaDiscardMode,baseColorTexture:G.baseColorTexture,
doubleSidedMode:G.doubleSidedMode,receiveAmbientOcclusion:G.receiveAmbientOcclusion,receiveShadows:G.receiveShadows,slicePlaneEnabled:G.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:E.viewingMode,vertexDiscardMode:G.vertexDiscardMode,pbrMode:3===G.integratedMeshMode?4:G.usePBR?G.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:G.hasMetalnessAndRoughnessTexture,hasEmissionTexture:G.hasEmissionTexture,hasOcclusionTexture:G.hasOcclusionTexture,hasNormalTexture:G.hasNormalTexture,
vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:y.doublePrecisionRequiresObfuscation(E.rctx),overlayEnabled:2===G.integratedMeshMode||3===G.integratedMeshMode,ssrEnabled:G.ssrEnabled,highStepCount:!1,ellipsoidMode:G.ellipsoidMode});return new n(E.rctx,G.generateSource("vertex"),G.generateSource("fragment"),F.attributeLocations)};B.setPipelineState=function(E){const F=this.configuration,G=0!==F.integratedMeshMode,I=3===E,K=2===E;return q.makePipelineState({blending:0!==
F.output&&7!==F.output||!F.blendingEnabled?null:I?t.blendingDefault:t.OITBlending(E),culling:A[F.cullFace],depthTest:{func:t.OITDepthTest(E)},depthWrite:I||K?q.defaultDepthWriteParams:null,colorWrite:q.defaultColorWriteParams,stencilWrite:G||F.sceneHasOcludees?l.stencilWriteMaskOn:null,stencilTest:G?l.replaceBitWhenDepthTestPasses(1):F.sceneHasOcludees?l.stencilBaseAllZerosParams:null,polygonOffset:I||K?F.polygonOffsetEnabled?{factor:2,units:2}:null:t.OITPolygonOffset})};B.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};
return m}(e.ShaderTechnique);e.shader=new d.ReloadableShaderModule(r.ComponentShader,()=>new Promise(function(x,m){a(["./shader/ComponentShader.glsl"],x,m)}));const A=[null,{face:1028,mode:2305},{face:1029,mode:2305}];d=function(x){function m(){var B=x.apply(this,arguments)||this;B.transformNormal_GlobalFromModel=k.create();B.toMapSpace=c.create();return B}b._inheritsLoose(m,x);return m}(z.VertexPosition.ModelTransform);r=function(x){function m(){var B=x.apply(this,arguments)||this;B.output=0;B.hasVertexColors=
!1;B.hasNormals=!1;B.vertexTextureCoordinates=0;B.componentData=0;B.slicePlaneEnabled=!1;B.cullFace=2;B.baseColorTexture=!1;B.receiveAmbientOcclusion=!0;B.receiveShadows=!0;B.vertexDiscardMode=0;B.doubleSidedMode=2;B.blendingEnabled=!0;B.alphaDiscardMode=1;B.integratedMeshMode=0;B.ssrEnabled=!1;B.polygonOffsetEnabled=!1;B.usePBR=!1;B.isSchematic=!1;B.hasMetalnessAndRoughnessTexture=!1;B.hasEmissionTexture=!1;B.hasOcclusionTexture=!1;B.hasNormalTexture=!1;B.sceneHasOcludees=!1;B.transparencyPassType=
3;B.ellipsoidMode=1;B.multipassTerrainEnabled=!1;B.cullAboveGround=!0;return B}b._inheritsLoose(m,x);return m}(h.ShaderTechniqueConfiguration);p.__decorate([h.parameter({count:8})],r.prototype,"output",void 0);p.__decorate([h.parameter()],r.prototype,"hasVertexColors",void 0);p.__decorate([h.parameter()],r.prototype,"hasNormals",void 0);p.__decorate([h.parameter({count:3})],r.prototype,"vertexTextureCoordinates",void 0);p.__decorate([h.parameter({count:2})],r.prototype,"componentData",void 0);p.__decorate([h.parameter()],
r.prototype,"slicePlaneEnabled",void 0);p.__decorate([h.parameter({count:3})],r.prototype,"cullFace",void 0);p.__decorate([h.parameter()],r.prototype,"baseColorTexture",void 0);p.__decorate([h.parameter()],r.prototype,"receiveAmbientOcclusion",void 0);p.__decorate([h.parameter()],r.prototype,"receiveShadows",void 0);p.__decorate([h.parameter({count:3})],r.prototype,"vertexDiscardMode",void 0);p.__decorate([h.parameter({count:3})],r.prototype,"doubleSidedMode",void 0);p.__decorate([h.parameter()],
r.prototype,"blendingEnabled",void 0);p.__decorate([h.parameter({count:4})],r.prototype,"alphaDiscardMode",void 0);p.__decorate([h.parameter({count:4})],r.prototype,"integratedMeshMode",void 0);p.__decorate([h.parameter()],r.prototype,"ssrEnabled",void 0);p.__decorate([h.parameter()],r.prototype,"polygonOffsetEnabled",void 0);p.__decorate([h.parameter()],r.prototype,"usePBR",void 0);p.__decorate([h.parameter()],r.prototype,"isSchematic",void 0);p.__decorate([h.parameter()],r.prototype,"hasMetalnessAndRoughnessTexture",
void 0);p.__decorate([h.parameter()],r.prototype,"hasEmissionTexture",void 0);p.__decorate([h.parameter()],r.prototype,"hasOcclusionTexture",void 0);p.__decorate([h.parameter()],r.prototype,"hasNormalTexture",void 0);p.__decorate([h.parameter()],r.prototype,"sceneHasOcludees",void 0);p.__decorate([h.parameter({count:4})],r.prototype,"transparencyPassType",void 0);p.__decorate([h.parameter({count:4})],r.prototype,"ellipsoidMode",void 0);p.__decorate([h.parameter()],r.prototype,"multipassTerrainEnabled",
void 0);p.__decorate([h.parameter()],r.prototype,"cullAboveGround",void 0);g.ComponentDrawParameters=d;g.ComponentTechnique=e;g.ComponentTechniqueConfiguration=r;g.TextureUnits=C;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){function B(G){const I=new p.ShaderBuilder;I.include(l.VertexPosition,G);I.include(w.VertexNormal,G);I.include(t.VertexColor,G);I.include(u.TextureCoordinateAttribute,G);I.include(q.ForwardLinearDepth,G);I.include(r.ComponentData,G);I.include(d.DiscardOrAdjustAlpha,G);I.include(f.Slice,G);I.include(m.ReadBaseColorTexture,G);I.include(C.VertexDiscardByOpacity,G);I.fragment.uniforms.add("view","mat4");if(1===G.pbrMode||2===G.pbrMode)I.include(v.PhysicallyBasedRenderingParameters,
G),I.include(y.ComputeNormalTexture,G);3===G.output&&1===G.componentData?I.vertex.code.add(b.glsl`
      #define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
    `):I.vertex.code.add(b.glsl`
      #define discardShadows(castShadows) {}
    `);const K=G.overlayEnabled&&0===G.output&&4===G.pbrMode;G.overlayEnabled&&(I.include(z.Overlay,G),1===G.viewingMode?I.vertex.code.add(b.glsl`
      const float invEllipsoidRadius = ${b.glsl.float(1/(1===G.ellipsoidMode?g.earth.radius:2===G.ellipsoidMode?g.mars.radius:g.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):I.vertex.code.add(b.glsl`
      vec2 projectOverlay(vec3 pos) { return pos.xy; }
      `));K&&(I.varyings.add("tbnTangent","vec3"),I.varyings.add("tbnBiTangent","vec3"),I.varyings.add("groundNormal","vec3"),I.varyings.add("positionView","vec3"));I.vertex.code.add(b.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${b.glsl.float(d.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${K?b.glsl`
        positionView = position_view();
        ${1===G.viewingMode?b.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${G.overlayEnabled?b.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);7===G.output&&(I.fragment.include(k.ReadLinearDepth),G.multipassTerrainEnabled&&I.include(e.multipassTerrainTest,G),I.include(A.ComputeMaterialColor,G),I.fragment.code.add(b.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${G.multipassTerrainEnabled?b.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${G.overlayEnabled?b.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));0===G.output&&(I.fragment.include(k.ReadLinearDepth),G.multipassTerrainEnabled&&I.include(e.multipassTerrainTest,G),I.include(A.ComputeMaterialColor,G),I.include(x.ComputeShadingNormal,G),I.include(D.EvaluateSceneLighting,G),K&&(I.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),I.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),G.receiveShadows?(I.include(n.ReadShadowMap,G),I.fragment.code.add(b.glsl`
        float evaluateShadow() {
          return readShadowMap(vPositionWorldCameraRelative, linearDepth);
        }
      `)):I.fragment.code.add(b.glsl`
        float evaluateShadow() { return 0.0; }
      `),I.fragment.code.add(b.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${G.multipassTerrainEnabled?b.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${G.overlayEnabled?b.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===G.pbrMode||2===G.pbrMode?(I.fragment.code.add(b.glsl`
        ${1===G.pbrMode?b.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),G.hasNormalTexture?I.fragment.code.add(b.glsl`
        mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
        vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);
        `):I.fragment.code.add(b.glsl`
        vec3 shadingNormal = normalVertex;
        `),I.fragment.code.add(b.glsl`${1===G.viewingMode?b.glsl`vec3 normalGround = normalize(positionWorld());`:b.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),I.fragment.code.add(b.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(G.receiveShadows?I.fragment.code.add(b.glsl`
      float shadow = evaluateShadow();
        `):1===G.viewingMode?I.fragment.code.add(b.glsl`
      float additionalAmbientScale = _oldHeuristicLighting(positionWorld());
      float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);
        `):I.fragment.code.add(b.glsl`
      float shadow = 0.0;
      `),I.fragment.code.add(b.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${K?b.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),I.fragment.code.add(b.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${G.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===G.output||3===G.output)I.include(h.OutputDepth,G),I.fragment.code.add(b.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        outputDepth(linearDepth);
      }
    `);2===G.output&&(I.include(x.ComputeShadingNormal,G),I.fragment.code.add(b.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===G.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));4===G.output&&(I.include(c.OutputHighlight),I.fragment.code.add(b.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${G.overlayEnabled?b.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return I}const E={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};var F=Object.freeze({__proto__:null,attributeLocations:E,build:B});a.ComponentShader=F;a.attributeLocations=E;a.build=B})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces","./DecodeSymbolColor.glsl"],function(a,g,b){a.ComponentData=function(p,f){1===f.componentData&&(p.vertex.uniforms.add("uComponentColorTex",
"sampler2D"),p.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),p.attributes.add("componentIndex","float"),p.varyings.add("vExternalColorMixMode","mediump float"),p.varyings.add("vExternalColor","vec4"),p.include(b.DecodeSymbolColor),p.vertex.code.add(g.glsl`
      vec4 _readComponentColor() {
        float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
        vec2 indexCoord = vec2(
          mod(normalizedIndex, 1.0),
          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
        );
        return texture2D(uComponentColorTex, indexCoord);
       }

      vec4 forwardExternalColor(out bool castShadows) {
        vec4 componentColor = _readComponentColor() * 255.0;

        float shadowFlag = mod(componentColor.b * 255.0, 2.0);
        componentColor.b -= shadowFlag;
        castShadows = shadowFlag >= 1.0;

        int decodedColorMixMode;
        vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
        vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

        return vExternalColor;
      }
    `),p.fragment.code.add(g.glsl`
      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
        externalColor = vExternalColor;
        externalColorMixMode = int(vExternalColorMixMode);
      }
    `));0===f.componentData&&(p.vertex.uniforms.add("uExternalColor","vec4"),p.fragment.uniforms.add("uExternalColorMixMode","int"),p.varyings.add("vExternalColor","vec4"),p.vertex.code.add(g.glsl`
      vec4 forwardExternalColor(out bool castShadows) {
        vExternalColor = uExternalColor;
        castShadows = true;
        return uExternalColor;
      }
    `),p.fragment.code.add(g.glsl`
      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
        externalColor = vExternalColor;
        externalColorMixMode = uExternalColorMixMode;
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,g){a.VertexDiscardByOpacity=function(b,p){b=b.vertex;b.code.add(g.glsl`
  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)
  `);switch(p.vertexDiscardMode){case 0:b.code.add(g.glsl`
        #define vertexDiscardByOpacity(_opacity_) {}
      `);break;case 2:b.code.add(g.glsl`
        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
      `);break;case 1:b.code.add(g.glsl`
        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
      `)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl"],function(a,g,b,p){a.ComputeMaterialColor=function(f,k){f.include(b.VertexColor,k);f.fragment.include(p.MixExternalColor);f=f.fragment;f.uniforms.add("uBaseColor","vec4");f.uniforms.add("uObjectOpacity","float");k.attributeColor?
f.code.add(g.glsl`
      vec3 _baseColor() {
        // combine the old material parameters into a single one
        return uBaseColor.rgb * vColor.rgb;
      }

      float _baseOpacity() {
        return uBaseColor.a * vColor.a;
      }
    `):f.code.add(g.glsl`
      vec3 _baseColor() {
        // combine the old material parameters into a single one
        return uBaseColor.rgb;
      }

      float _baseOpacity() {
        return uBaseColor.a;
      }
    `);f.code.add(g.glsl`
    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
      vec3 baseColor = _baseColor();
      float baseOpacity = _baseOpacity();

      vec3 color = mixExternalColor(
        baseColor,
        textureColor.rgb,
        externalColor.rgb,
        externalColorMixMode
      );
      float opacity = uObjectOpacity * mixExternalOpacity(
        baseOpacity,
        textureColor.a,
        externalColor.a,
        externalColorMixMode
      );

      return vec4(color, opacity);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexPosition.glsl","../attributes/VertexNormal.glsl"],function(a,g,b,p){a.ComputeShadingNormal=function(f,k){const c=f.fragment;0===k.doubleSidedMode?c.code.add(g.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        return normal;
      }
    `):1===k.doubleSidedMode?(f.include(b.VertexPosition,k),c.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),c.code.add(g.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
        return dot(normal, viewDir) > 0.0 ? -normal : normal;
      }
    `)):2===k.doubleSidedMode&&c.code.add(g.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        return gl_FrontFacing ? normal : -normal;
      }
    `);0===k.normalType||1===k.normalType?(f.include(p.VertexNormal,k),c.code.add(g.glsl`
      vec3 shadingNormalWorld() {
        return _adjustDoublesided(normalize(vNormalWorld));
      }

      vec3 shadingNormal_view() {
        vec3 normal = normalize(vNormalView);
        return gl_FrontFacing ? normal : -normal;
      }
    `)):3===k.normalType?(f.extensions.add("GL_OES_standard_derivatives"),f.include(b.VertexPosition,k),c.code.add(g.glsl`
      vec3 shadingNormalWorld() {
        return normalize(cross(
          dFdx(vPositionWorldCameraRelative),
          dFdy(vPositionWorldCameraRelative)
        ));
      }

      vec3 shadingNormal_view() {
        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
      }
    `)):2===k.normalType&&(1===k.viewingMode?(f.include(b.VertexPosition,k),c.code.add(g.glsl`
        vec3 shadingNormalWorld() {
          return normalize(positionWorld());
        }
      `)):2===k.viewingMode&&c.code.add(g.glsl`
        vec3 shadingNormalWorld() {
          return vec3(0.0, 0.0, 1.0);
        }
      `),f.extensions.add("GL_OES_standard_derivatives"),c.code.add(g.glsl`
      vec3 shadingNormal_view() {
        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/TextureAtlasLookup.glsl","../attributes/VertexTextureCoordinates.glsl"],function(a,g,b,p){a.ReadBaseColorTexture=function(f,k){const c=f.fragment;k.baseColorTexture?(f.include(p.VertexTextureCoordinates,k),c.uniforms.add("uBaseColorTexture","sampler2D"),c.uniforms.add("uBaseColorTextureSize",
"vec2"),2===k.attributeTextureCoordinates?(f.include(b.TextureAtlasLookup),c.code.add(g.glsl`
        vec4 readBaseColorTexture() {
          return textureAtlasLookup(
            uBaseColorTexture,
            uBaseColorTextureSize,
            vuv0,
            vuvRegion
          );
        }
      `)):c.code.add(g.glsl`
        vec4 readBaseColorTexture() {
          return texture2D(uBaseColorTexture, vuv0);
        }
      `)):c.code.add(g.glsl`
      vec4 readBaseColorTexture() { return vec4(1.0); }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec4f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec3f32 ../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../../../../chunks/ComponentShader.glsl ./ComponentTechnique ../../../core/material/MaterialBase".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){function v(y){switch(y){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}let t=function(y){function D(){var r=y.call(this)||this;r.baseColor=d.fromValues(1,1,1,1);r.usePBR=!1;r.hasParametersFromSource=!1;r.mrrFactors=e.fromValues(1,1,.5);r.emissiveFactor=e.fromValues(0,0,0);r.baseColorTexture=null;r.metallicRoughnessTexture=null;r.emissionTexture=null;r.occlusionTexture=null;r.normalTexture=null;r.overlayTexOffset=k.fromValues(-1,
-1,-1,-1);r.overlayTexScale=k.fromValues(0,0,0,0);r.overlayColorInner=null;r.overlayColorOuter=null;r.overlayHighlightInner=null;r.overlayHighlightOuter=null;r.overlayNormalInner=null;r.overlayNormalOuter=null;r.objectOpacity=1;r.commonMaterialParameters=new l;r.componentParameters=new w;r.alphaCutoff=h.defaultMaskAlphaCutoff;r.alphaDiscardMode=1;r.isIntegratedMesh=!1;r.polygonOffsetEnabled=!1;r.ellipsoidMode=1;r.sceneHasOcludees=!1;r._techniqueConfig=new q.ComponentTechniqueConfiguration;return r}
g._inheritsLoose(D,y);var z=D.prototype;z.dispose=function(r){this._technique&&(r.release(this._technique),this._technique=void 0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};z.getTechnique=function(r,C,A){const x=this._techniqueConfig;x.hasVertexColors=A.colors;x.hasNormals=A.normals;x.vertexTextureCoordinates=A.textureCoordinates;x.usePBR=this.usePBR;x.hasMetalnessAndRoughnessTexture=p.isSome(this.metallicRoughnessTexture);
x.hasEmissionTexture=p.isSome(this.emissionTexture);x.hasOcclusionTexture=p.isSome(this.occlusionTexture);x.hasNormalTexture=p.isSome(this.normalTexture);x.transparencyPassType=0===C.identifier&&null!=C.transparencyPassType?C.transparencyPassType:3;x.multipassTerrainEnabled=0===C.identifier&&null!=C.multipassTerrainParams?C.multipassTerrainParams.multipassTerrainEnabled:!1;x.cullAboveGround=0===C.identifier&&null!=C.multipassTerrainParams?C.multipassTerrainParams.cullAboveGround:!1;x.ellipsoidMode=
this.ellipsoidMode;this.dirty&&(x.componentData=this.componentParameters.type,x.cullFace=this.commonMaterialParameters.cullFace,x.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,x.baseColorTexture=p.isSome(this.baseColorTexture),x.isSchematic=this.hasParametersFromSource&&!p.isSome(this.baseColorTexture),A=this._computeWhichMaterialPass(),x.blendingEnabled=1===A||2===A,x.alphaDiscardMode=this.alphaDiscardMode,x.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?
this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,x.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());x.slicePlaneEnabled=C.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===C.identifier?(x.output=3,x.vertexDiscardMode=0):2===C.identifier?(x.output=4,x.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?x.vertexDiscardMode=C.transparent?2:1:x.vertexDiscardMode=0,x.output=v(C.subPass),1===C.subPass&&(x.sceneHasOcludees=C.sceneHasOcludees),0===C.subPass?
(x.receiveAmbientOcclusion=C.ambientOcclusionEnabled,x.sceneHasOcludees=C.sceneHasOcludees,x.receiveShadows=C.shadowsEnabled,x.ssrEnabled=C.ssrParams.ssrEnabled):(x.receiveAmbientOcclusion=!1,x.receiveShadows=!1));return this._technique=r.repository.acquireAndReleaseExisting(q.ComponentTechnique,x,this._technique)};z.submit=function(r,C){const A=C.renderable.geometry;var x=C.components;const m=C.renderable.drawParameters;C=C.renderable.meta.cameraDepthSquared;const B=x.geometryRanges,E=x.highlightRanges;
x=x.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:r.materialOpaque.submitDraw(this,A,B,m,C);break;case 1:r.materialTransparent.submitDraw(this,A,B,m,C);break;case 2:r.materialOpaque.submitDraw(this,A,B,m,C);r.materialTransparent.submitDraw(this,A,B,m,C);break;case 3:r.materialIntegratedMesh.submitDraw(this,A,B,m,C),(this.overlayHighlightInner||this.overlayHighlightOuter)&&r.highlightIntegratedMesh.submitDraw(this,A,B,m,C)}p.isSome(r.shadowMap)&&2!==this.componentParameters.castShadows&&
r.shadowMap.submitDraw(this,A,B,m,C);p.isSome(r.highlight)&&p.isSome(E)&&r.highlight.submitDraw(this,A,E,m,C);p.isSome(r.highlightShadowMap)&&2!==this.componentParameters.castShadows&&p.isSome(E)&&r.highlightShadowMap.submitDraw(this,A,E,m,C);p.isSome(r.defaultShadowMap)&&2!==this.componentParameters.castShadows&&p.isSome(x)&&r.defaultShadowMap.submitDraw(this,A,x,m,C)};z._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?
0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};g._createClass(D,[{key:"attributeLocations",get:function(){return n.attributeLocations}}]);return D}(u.MaterialBase);b.__decorate([u.parameter({vectorOps:c.vec4})],t.prototype,"baseColor",void 0);b.__decorate([u.parameter()],t.prototype,"usePBR",void 0);b.__decorate([u.parameter()],t.prototype,"hasParametersFromSource",void 0);b.__decorate([u.parameter({vectorOps:f.vec3})],
t.prototype,"mrrFactors",void 0);b.__decorate([u.parameter({vectorOps:f.vec3})],t.prototype,"emissiveFactor",void 0);b.__decorate([u.parameter({dispose:!0})],t.prototype,"baseColorTexture",void 0);b.__decorate([u.parameter({dispose:!0})],t.prototype,"metallicRoughnessTexture",void 0);b.__decorate([u.parameter({dispose:!0})],t.prototype,"emissionTexture",void 0);b.__decorate([u.parameter({dispose:!0})],t.prototype,"occlusionTexture",void 0);b.__decorate([u.parameter({dispose:!0})],t.prototype,"normalTexture",
void 0);b.__decorate([u.parameter({vectorOps:{equals:c.exactEquals,copy:c.copy}})],t.prototype,"overlayTexOffset",void 0);b.__decorate([u.parameter({vectorOps:{equals:c.exactEquals,copy:c.copy}})],t.prototype,"overlayTexScale",void 0);b.__decorate([u.parameter()],t.prototype,"overlayColorInner",void 0);b.__decorate([u.parameter()],t.prototype,"overlayColorOuter",void 0);b.__decorate([u.parameter()],t.prototype,"overlayHighlightInner",void 0);b.__decorate([u.parameter()],t.prototype,"overlayHighlightOuter",
void 0);b.__decorate([u.parameter()],t.prototype,"overlayNormalInner",void 0);b.__decorate([u.parameter()],t.prototype,"overlayNormalOuter",void 0);b.__decorate([u.parameter()],t.prototype,"objectOpacity",void 0);b.__decorate([u.parameterBlock()],t.prototype,"commonMaterialParameters",void 0);b.__decorate([u.parameterBlock()],t.prototype,"componentParameters",void 0);b.__decorate([u.parameter()],t.prototype,"alphaCutoff",void 0);b.__decorate([u.parameter()],t.prototype,"alphaDiscardMode",void 0);
b.__decorate([u.parameter()],t.prototype,"isIntegratedMesh",void 0);b.__decorate([u.parameter()],t.prototype,"polygonOffsetEnabled",void 0);b.__decorate([u.parameter()],t.prototype,"ellipsoidMode",void 0);b.__decorate([u.parameter()],t.prototype,"sceneHasOcludees",void 0);let l=function(y){function D(){var z=y.apply(this,arguments)||this;z.doubleSided=!1;z.cullFace=2;z.slicePlaneEnabled=!0;return z}g._inheritsLoose(D,y);return D}(u.MaterialParameterBlock);b.__decorate([u.parameter()],l.prototype,
"doubleSided",void 0);b.__decorate([u.parameter()],l.prototype,"cullFace",void 0);b.__decorate([u.parameter()],l.prototype,"slicePlaneEnabled",void 0);let w=function(y){function D(){var z=y.apply(this,arguments)||this;z.externalColor=d.fromValues(1,1,1,1);z.externalColorMixMode=1;z.castShadows=0;return z}g._inheritsLoose(D,y);g._createClass(D,[{key:"transparent",get:function(){return 1>this.externalColor[3]?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?
0:2}},{key:"visible",get:function(){return 0<this.externalColor[3]?0:2}},{key:"type",get:function(){return 0}}]);return D}(u.MaterialParameterBlock);b.__decorate([u.parameter({vectorOps:c.vec4})],w.prototype,"externalColor",void 0);b.__decorate([u.parameter()],w.prototype,"externalColorMixMode",void 0);b.__decorate([u.parameter()],w.prototype,"castShadows",void 0);f=function(y){function D(){var z=y.apply(this,arguments)||this;z.texture=null;z.transparent=2;z.opaqueOverride=2;z.castShadows=2;return z}
g._inheritsLoose(D,y);g._createClass(D,[{key:"type",get:function(){return 1}}]);return D}(u.MaterialParameterBlock);b.__decorate([u.parameter()],f.prototype,"texture",void 0);b.__decorate([u.parameter()],f.prototype,"transparent",void 0);b.__decorate([u.parameter()],f.prototype,"opaqueOverride",void 0);b.__decorate([u.parameter()],f.prototype,"castShadows",void 0);a.CommonMaterialParameters=l;a.ComponentMaterial=t;a.ComponentParametersUniform=w;a.ComponentParametersVarying=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function f(){this._dirty=!0}var k=f.prototype;k._setDirty=function(){this._dirty=!0};k._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const c of this._parameterBlocks)this[c]._setClean()};k._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const c of this._parameterBlocks)if(this[c].dirty)return!0;
return!1};g._createClass(f,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return f}(),p=function(){function f(){this._dirty=!0}var k=f.prototype;k._setDirty=function(){this._dirty=!0};k._setClean=function(){this._dirty=!1};g._createClass(f,[{key:"dirty",get:function(){return this._dirty}}]);return f}();a.MaterialBase=b;a.MaterialParameterBlock=p;a.parameter=function(f={}){return(k,c)=>{var d;const e=null!=(d=k._parameterCount)?d:0;k._parameterCount=e+1;if(f.vectorOps){const h=
f.vectorOps;Object.defineProperty(k,c,{get(){return this[e]},set(n){const q=this[e];if(null==q)this[e]=n;else{if(h.equals(q,n))return;h.copy(q,n)}this._setDirty()}})}else Object.defineProperty(k,c,{get(){return this[e]},set(h){this[e]!==h&&(f.dispose&&this[e]&&this[e].dispose(),this[e]=h,this._setDirty())}})}};a.parameterBlock=function(){return(f,k)=>{var c;const d=null!=(c=f._parameterCount)?c:0;f._parameterCount=d+1;f._parameterBlocks=f._parameterBlocks||[];f._parameterBlocks.push(d);Object.defineProperty(f,
k,{get(){return this[d]},set(e){this[d]!==e&&(this[d]=e,this._setDirty())}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../../../chunks/vec3f32"],function(a,g,b,p,f){let k=function(){function d(h){this._low=f.create();this._high=f.create();h&&this.set(h)}var e=d.prototype;e.set=function(h){const n=
this._low,q=this._high;p.copy(n,h);p.sub(q,h,n)};e.setElements=function(h,n,q){p.set(c,h,n,q);this.set(c)};e.get=function(h){return p.add(h,this._low,this._high)};e.getLowScaled=function(h){return p.scale(h,this._low,1)};g._createClass(d,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return d}();const c=b.create();a.TwoVectorPosition=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports",
"./ManagedTextureBackedBuffer"],function(a,g){let b=function(){function p(k,c=1){this.rctx=k;this.fieldCount=c;this.buffers=[]}var f=p.prototype;f.garbageCollect=function(){this.buffers=this.buffers.filter(k=>0===k.activeCount?(k.dispose(),!1):!0)};f.destroy=function(){this.buffers.forEach(k=>k.dispose());this.buffers=[]};f.getBuffer=function(k){for(const c of this.buffers)if(c.availableCount>=k)return c;if(k>g.MAX_INDEX_COUNT)return null;k=new g.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);
this.buffers.push(k);return k};f.updateTextures=function(){for(const k of this.buffers)k.textureBuffer.updateTexture()};return p}();a.BufferManager=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,g,b,p){let f=function(){function k(d,e=1){this.textureBuffer=new p.TextureBackedBuffer(d,
e);this.indexManager=new b.SimpleIndexManager(65536)}var c=k.prototype;c.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};c.acquireIndex=function(){const d=this.indexManager.acquire();this.textureBuffer.resizeToFit(d);return d};c.releaseIndex=function(d){this.indexManager.release(d)};g._createClass(k,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return k}();a.MAX_INDEX_COUNT=
65536;a.ManagedTextureBackedBuffer=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,g){let b=function(){function p(k){this.maxCount=k;this._nextIndex=0;this.recycledIndices=[]}var f=p.prototype;f.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};f.release=
function(k){this.recycledIndices.push(k)};g._createClass(p,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);return p}();a.SimpleIndexManager=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],
function(a,g,b){let p=function(){function f(c,d=1){this.rctx=c;this.fieldCount=d;this.textureWidth=4096;this.dirty=!0;this.texture=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new g.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var k=f.prototype;k.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};k.setData=function(c,d,e,h,n,q){c=c*this.fieldCount+d;this.dirty=!0;
this.data.set(c,0,e);this.data.set(c,1,h);this.data.set(c,2,n);this.data.set(c,3,q)};k.setDataElement=function(c,d,e,h){c=c*this.fieldCount+d;this.dirty=!0;this.data.set(c,e,h)};k.resizeToFit=function(c){c*=this.fieldCount;c>=this.data.count&&(c=new g.BufferViewVec4u8(new ArrayBuffer(Math.ceil((c+1)/this.textureWidth)*this.textureWidth*4)),c.typedBuffer.set(this.data.typedBuffer),this.data=c)};k.updateTexture=function(){if(this.dirty){var c=this.texture.descriptor.width;this.data.count>c*this.texture.descriptor.height&&
this.texture.resize(c,this.data.count/c);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};k.bind=function(c,d){this.rctx.bindTexture(this.texture,d.unit);c.setUniform1i(d.texName,d.unit);c.setUniform2f(d.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return f}();a.TextureBackedBuffer=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define(["../../../../core/maybe","../../../webgl/Util","./glUtil3D",
"../shaders/CompositingTechnique"],function(a,g,b,p){let f=function(){function c(e,h){this._rctx=e;this._techniqueRepository=h;this._techniques=new Set}var d=c.prototype;d.dispose=function(){this._techniques.forEach(e=>this._techniqueRepository.release(e));this._techniques.clear();a.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)};d.composite=function(e,h=0,n=1){this.compositeInternal(e,h,n,0)};d.compositeTransparent=function(e,h,n,q=1){const u=this._rctx;k.alphaMode=1;k.function=3;k.hasOpacityFactor=
1!==q;q=this._techniqueRepository.acquire(p.CompositingTechnique,k);u.bindProgram(q.program);q.bindPipelineState(u);q.program.setUniform1i("colorTexture",1);u.bindTexture(e,1);q.program.setUniform1i("alphaTexture",2);u.bindTexture(h,2);q.program.setUniform1i("frontFaceTexture",3);u.bindTexture(n,3);e=this.ensureVAO();u.bindVAO(e);u.drawArrays(5,0,g.vertexCount(e,"geometry"));this._techniqueRepository.release(q)};d.compositeSpecial=function(e,h){this.compositeInternal(e,0,1,h)};d.compositeInternal=
function(e,h,n,q){const u=this._rctx;k.alphaMode=h;k.function=q;k.hasOpacityFactor=1!==n;h=this._techniqueRepository.acquire(p.CompositingTechnique,k);u.bindProgram(h.program);h.bindPipelineState(u);h.program.setUniform1i("tex",1);k.hasOpacityFactor&&h.program.setUniform1f("opacity",n);u.bindTexture(e,1);e=this.ensureVAO();u.bindVAO(e);u.drawArrays(5,0,g.vertexCount(e,"geometry"));this._techniqueRepository.release(h)};d.ensureVAO=function(){a.isNone(this._vao)&&(this._vao=b.createQuadVAO(this._rctx));
return this._vao};return c}();const k=new p.CompositingTechniqueConfiguration;return f})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/Compositing.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build(this.configuration);return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.initializePipeline=function(){if(2===this.configuration.function)return h.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return h.makePipelineState({colorWrite:h.defaultColorWriteParams});
case 1:return h.makePipelineState({blending:h.separateBlendingParams(770,1,771,771),colorWrite:h.defaultColorWriteParams});default:return h.makePipelineState({blending:h.simpleBlendingParams(1,771),colorWrite:h.defaultColorWriteParams})}};return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.CompositingShader,()=>new Promise(function(q,u){a(["./Compositing.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.function=0;v.alphaMode=0;v.hasOpacityFactor=!1;
return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:4})],f.prototype,"function",void 0);p.__decorate([c.parameter({count:3})],f.prototype,"alphaMode",void 0);p.__decorate([c.parameter()],f.prototype,"hasOpacityFactor",void 0);g.CompositingTechnique=k;g.CompositingTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass"],function(a,g,b,p){function f(c){const d=new b.ShaderBuilder;d.include(p.ScreenSpacePass);d.fragment.uniforms.add("tex","sampler2D");0===c.function&&(c.hasOpacityFactor?(d.fragment.uniforms.add("opacity","float"),d.fragment.code.add(g.glsl`
      void main() {
        gl_FragColor = texture2D(tex, uv) * opacity;
      }`)):d.fragment.code.add(g.glsl`
      void main() {
        gl_FragColor = texture2D(tex, uv);
      }`));2===c.function&&d.fragment.code.add(g.glsl`
    void main() {
      gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
    }`);3===c.function&&(d.fragment.uniforms.add("colorTexture","sampler2D"),d.fragment.uniforms.add("alphaTexture","sampler2D"),d.fragment.uniforms.add("frontFaceTexture","sampler2D"),d.fragment.code.add(g.glsl`
    void main() {
      vec4 srcColor = texture2D(colorTexture, uv);
      float srcAlpha = texture2D(alphaTexture, uv).r;
      vec4 frontFace = texture2D(frontFaceTexture, uv);
      if(srcColor.a <= 1e-5){
        discard;
      }
      gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
    }`));return d}var k=Object.freeze({__proto__:null,build:f});a.CompositingShader=k;a.build=f})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../support/geometryUtils ./Util ./depthRange".split(" "),function(a,g,b,p,f,
k,c,d,e,h,n,q,u){function v(I,K){if(K.isVisible){var J=u.empty(),L=K.getObjects();K=K.getSpatialQueryAccelerator();b.isSome(K)?t(J,I,K):l(J,I,L);return J}}function t(I,K,J){var L=K.eye;const P=K.viewForward,Q=K.frustum,X=S=>S.isVisible;var aa=J.objectCount;500>aa?(u.set(B,K.near,Math.min(I.near,K.far)),J.forEachInDepthRange(L,P,"front-to-back",B,(S,H)=>{w(I,K,S);B.far=I.near;H.setRange(B)},Q,X),u.set(B,Math.max(I.far,K.near),K.far),J.forEachInDepthRange(L,P,"back-to-front",B,(S,H)=>{w(I,K,S);B.near=
I.far;H.setRange(B)},Q,X)):(aa=Math.max(Math.min(aa,500),Math.ceil(.1*aa)),L=J.findClosest(P,"front-to-back",Q,X,aa),J=J.findClosest(P,"back-to-front",Q,X,aa),L&&J&&(D(I,K,L.getBounds()),D(I,K,J.getBounds())))}function l(I,K,J){E.clear();J.forAll(L=>{L.isVisible&&0!==L.getNumGeometryRecords()&&E.add(L)});E.empty||(E.sort(K),u.set(B,K.near,Math.min(I.near,K.far)),E.forEachInDepthRange(B,"front-to-back",(L,P)=>{P<I.near&&w(I,K,L)}),u.set(B,Math.max(I.far,K.near),K.far),E.forEachInDepthRange(B,"back-to-front",
(L,P,Q)=>{I.far=Math.max(I.far,Q)}))}function w(I,K,J){if(J.isVisible&&n.frustum.intersectsSphere(K.frustum,J.getBounds())){var L=J.transformation,P=m;J.geometryRecords.forEach(Q=>{c.multiply(P,L,Q.getShaderTransformation());const X=k.maxScale(P);y(I,K,Q.geometry.boundingInfo,P,X)})}}function y(I,K,J,L,P){if(!b.isNone(J)){var Q=K.eye,X=K.viewForward;f.transformMat4(x,J.center,L);Q=X[0]*(x[0]-Q[0])+X[1]*(x[1]-Q[1])+X[2]*(x[2]-Q[2]);x[3]=J.radius*P;if(!(Q-x[3]>I.near&&Q+x[3]<I.far)&&n.frustum.intersectsSphere(K.frustum,
x))if(100<J.radius&&J.getChildren())for(J=J.getChildren(),Q=0;8>Q;++Q)J[Q]&&y(I,K,J[Q],L,P);else G.unionDepthRangeWithAABB(I,K.viewProjectionMatrix,L,J.bbMin,J.bbMax)}}function D(I,K,J){var L=K.eye;K=K.viewForward;L=(J[0]-L[0])*K[0]+(J[1]-L[1])*K[1]+(J[2]-L[2])*K[2];I.near=Math.min(I.near,L-J[3]);I.far=Math.max(I.far,L+J[3])}let z=function(){function I(){this._items=new p({allocator:J=>J||{obj:null,distance:0,near:0,far:0},deallocator:J=>{J.obj=null;J.distance=0;J.near=0;J.far=0;return J}})}var K=
I.prototype;K.clear=function(){this._items.clear()};K.add=function(J){this._items.pushNew().obj=J};K.sort=function(J){const L=J.eye,P=J.viewForward;this._items.forAll(Q=>{const X=Q.obj.getBounds(),aa=(X[0]-L[0])*P[0]+(X[1]-L[1])*P[1]+(X[2]-L[2])*P[2];Q.distance=aa;Q.near=aa-X[3];Q.far=aa+X[3]});this._items.sort((Q,X)=>Q.distance-X.distance)};K.forEachInDepthRange=function(J,L,P){if("front-to-back"===L)for(L=0;L<this._items.length;++L){var Q=this._items.data[L];Q.far<J.near||Q.near>J.far||P(Q.obj,
Q.near,Q.far)}else for(L=this._items.length-1;0<=L;--L)Q=this._items.data[L],Q.far<J.near||Q.near>J.far||P(Q.obj,Q.near,Q.far)};g._createClass(I,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return I}(),r=function(){function I(){this.view=d.create();this.viewProj=d.create();this.frustum=n.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange=
{near:0,far:0}}var K=I.prototype;K.compute=function(J,L){this.reset();c.copy(this.view,J.viewMatrix);c.multiply(this.viewProj,J.projectionMatrix,this.view);n.frustum.copy(J.frustum,this.frustum);J=this.view;const P=J[2],Q=J[6],X=J[10],aa=J[14];J=this.range;let S=0;L.forEach(T=>{if(T.instanceParameters.visible&&T.castShadow){if(T.hasShaderTransformation){T.computeBoundingSphere(T.getShaderTransformation(),1,x);var W=x}else W=T.boundingSphere;var Y=P*W[0]+Q*W[1]+X*W[2]+aa,U=Y-W[3];W=Y+W[3];this.geometries[S]=
T;this.near[S]=-W;this.far[S]=-U;++S}});if(0===this.geometries.length)return J;for(L=0;L<this.geometries.length;++L)this.near[L]>J.far&&(J.far=this.near[L]),2<this.near[L]&&this.far[L]<J.near&&(J.near=this.far[L]);L=this.looseRange;L.near=Math.max(.5*J.near,2);L.far=2*J.far;var H=0;let R=0;for(let T=0;T<this.geometries.length;++T)this.near[T]<J.near&&(this.near[T]>=L.near?J.near=this.near[T]:this.nearCandidates[H++]=T),this.far[T]>J.far&&(this.far[T]<=L.far?J.far=this.far[T]:this.farCandidates[R++]=
T);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return J;this.nearCandidates.sort((T,W)=>this.near[T]<this.near[W]?-1:this.near[T]>this.near[W]?1:0);this.farCandidates.sort((T,W)=>this.far[T]<this.far[W]?1:this.far[T]>this.far[W]?-1:0);for(L=0;L<this.nearCandidates.length;++L)H=this.nearCandidates[L],this.near[H]<J.near&&(H=this.geometries[H],this.includeNearBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));for(L=0;L<this.farCandidates.length;++L)H=this.farCandidates[L],
this.far[H]>J.far&&(H=this.geometries[H],this.includeFarBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));return J};K.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};K.includeNearBoundingInfoRec=function(J,L){if(!b.isNone(J)){var P=J.getCenter();f.transformMat4(x,P,L);P=k.maxScale(L);var Q=x[0],X=x[1],aa=x[2];P*=J.getBSRadius();var S=
this.frustum;if(!(S[0][0]*Q+S[0][1]*X+S[0][2]*aa+S[0][3]>P||S[1][0]*Q+S[1][1]*X+S[1][2]*aa+S[1][3]>P||S[2][0]*Q+S[2][1]*X+S[2][2]*aa+S[2][3]>P||S[3][0]*Q+S[3][1]*X+S[3][2]*aa+S[3][3]>P||(Q=this.view[2]*Q+this.view[6]*X+this.view[10]*aa+this.view[14],X=Q+P,2>-(Q-P)||-X>=this.range.near)))if(-X>this.looseRange.near)this.range.near=-X;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(J=0;8>J;++J)void 0!==P[J]&&this.includeNearBoundingInfoRec(P[J],L);return}G.unionDepthRangeWithAABB(this.range,this.viewProj,
L,J.getBBMin(),J.getBBMax())}}};K.includeFarBoundingInfoRec=function(J,L){if(!b.isNone(J)){var P=J.getBSRadius(),Q=J.getCenter();f.transformMat4(x,Q,L);var X=k.maxScale(L);Q=x[0];var aa=x[1],S=x[2];P*=X;X=this.frustum;if(!(X[0][0]*Q+X[0][1]*aa+X[0][2]*S+X[0][3]>P||X[1][0]*Q+X[1][1]*aa+X[1][2]*S+X[1][3]>P||X[2][0]*Q+X[2][1]*aa+X[2][2]*S+X[2][3]>P||X[3][0]*Q+X[3][1]*aa+X[3][2]*S+X[3][3]>P||(Q=this.view[2]*Q+this.view[6]*aa+this.view[10]*S+this.view[14]-P,-Q<=this.range.far)))if(-Q<this.looseRange.far)this.range.far=
-Q;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(J=0;8>J;++J)void 0!==P[J]&&this.includeFarBoundingInfoRec(P[J],L);return}G.unionDepthRangeWithAABB(this.range,this.viewProj,L,J.getBBMin(),J.getBBMax())}}};return I}(),C=function(){function I(){this.modelViewProj=d.create();this.clipPosition=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}var K=I.prototype;K.unionDepthRangeWithAABB=function(J,L,P,Q,X){var aa=this.modelViewProj;c.multiply(aa,L,P);L=!1;for(P=
0;8>P;++P){const S=this.clipPosition[P],H=0===P||3===P||4===P||7===P?Q[0]:X[0],R=0===P||1===P||4===P||5===P?Q[1]:X[1],T=4>P?Q[2]:X[2];S[0]=aa[0]*H+aa[4]*R+aa[8]*T+aa[12];S[1]=aa[1]*H+aa[5]*R+aa[9]*T+aa[13];S[2]=aa[2]*H+aa[6]*R+aa[10]*T+aa[14];S[3]=aa[3]*H+aa[7]*R+aa[11]*T+aa[15]}for(Q=0;12>Q;++Q){X=this.clipTriangle(this.clipPosition[A[Q][0]],this.clipPosition[A[Q][1]],this.clipPosition[A[Q][2]]);aa=!0;for(P=0;P<X.length;++P)if(2<=X[P][3]){aa=!1;break}if(!aa)for(L=!0,aa=0;aa<X.length;++aa)P=X[aa][3],
P<J.near&&(J.near=P),P>J.far&&(J.far=P)}return L};K.inside=function(J,L){if(0===L)return J[0]>=-J[3];if(1===L)return J[1]>=-J[3];if(2===L)return J[0]<=J[3];if(3===L)return J[1]<=J[3];q.assert(!1)};K.intersect=function(J,L,P){let Q=0;0===P?Q=(-J[3]-J[0])/(L[0]-J[0]+L[3]-J[3]):1===P?Q=(-J[3]-J[1])/(L[1]-J[1]+L[3]-J[3]):2===P?Q=(J[3]-J[0])/(L[0]-J[0]-L[3]+J[3]):3===P&&(Q=(J[3]-J[1])/(L[1]-J[1]-L[3]+J[3]));return h.lerp(e.create(),J,L,Q)};K.clipTriangle=function(J,L,P){J=[J,L,P];for(L=0;4>L;++L){P=J;
J=[];for(let Q=0;Q<P.length;++Q){const X=P[Q],aa=P[(Q+1)%P.length];this.inside(aa,L)?(this.inside(X,L)||J.push(this.intersect(X,aa,L)),J.push(aa)):this.inside(X,L)&&J.push(this.intersect(X,aa,L))}}return J};return I}();const A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],x=n.sphere.create(),m=d.create(),B=u.empty(),E=new z,F=new r,G=new C;a.DepthRangeFromRenderGeometries=r;a.depthRangeFromLayer=v;a.depthRangeFromScene=function(I,K,J){if(1E4>K.size)return F.compute(I,
K);const L=u.empty();J.forAll(P=>{P.isVisible&&u.union(L,v(I,P))});return L};a.texure2depth=function(I,K,J){return q.unpackFloatRGBA(K,I)*(J[1]-J[0])+J[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../core/Evented ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/Handles ../../../../support/requestImageUtils ../../../webgl/Program ../../../webgl/renderState ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./WebGLDriverTest ../shaders/Magnifier.glsl ../../../magnifier/resources".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q){a.MagnifierHelper=function(X){function aa(){var H=X.apply(this,arguments)||this;H._handles=new D;H._magnifier=null;H._imageSources=null;H._imageLoadTask=null;H._resources=null;H.events=new l;H.tmpScreenPoint=y.createScreenPointArray();H.tmpRenderPoint=y.createRenderScreenPointArray();return H}g._inheritsLoose(aa,X);var S=aa.prototype;S.dispose=function(){this._magnifier=null;this._handles.destroy();f.isSome(this._imageLoadTask)&&
(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this.disposeResources()};S.render=function(H,R){const T=this._validMagnifier;if(!f.isNone(T)){var W=R.camera.pixelRatio,Y=Math.ceil(W*T.size);this.updateResources(H,Y);if(!f.isNone(this._resources)){var U=this._resources.textures,N=Math.ceil(1/this.factor*Y);U.input.resize(N,N);var ca=R.camera.fullWidth,O=R.camera.fullHeight;y.screenPointObjectToArray(T.position,this.tmpScreenPoint);R=R.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);
var V=.5*N,ba=.5*N;R[0]=w.clamp(R[0],V,ca-V-1);R[1]=w.clamp(R[1],ba,O-ba-1);V=Math.floor(R[0]-V);ba=Math.floor(R[1]-ba);H.bindTexture(U.input,0);H.gl.copyTexImage2D(U.input.descriptor.target,0,U.input.descriptor.pixelFormat,V,ba,N,N,0);N=-1+(R[0]+T.offset.x*W)/ca*2;W=-1+(R[1]-T.offset.y*W)/O*2;ca=Y/ca*2;Y=Y/O*2;H.bindVAO(this._resources.vao);H.bindTexture(U.overlay,1);H.bindTexture(U.mask,2);U=this._resources.program;H.bindProgram(U);U.setUniform1i("textureInput",0);U.setUniform1i("textureOverlay",
1);U.setUniform1i("textureMask",2);U.setUniform4f("drawPosition",N,W,ca,Y);U.setUniform1i("maskEnabled",T.maskEnabled?1:0);U.setUniform1i("overlayEnabled",T.overlayEnabled?1:0);H.setPipelineState(this._resources.pipelineState);H.drawArrays(5,0,4)}}};S.updateResourceLoading=function(){const H=this._validMagnifier;if(!f.isNone(H)){var R=H.maskUrl,T=H.overlayUrl;!f.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===R&&this._imageLoadTask.overlayUrl===T||(this._imageLoadTask.task.abort(),this._imageSources=
this._imageLoadTask=null);f.isSome(this._imageSources)||f.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:R,overlayUrl:T,task:v.createTask(async W=>{const Y=f.isNone(R)||f.isNone(T)?Q.loadMagnifierResources(W):null,U=f.isSome(R)?z.requestImage(R,{signal:W}):Y.then(N=>N.mask);W=f.isSome(T)?z.requestImage(T,{signal:W}):Y.then(N=>N.overlay);this._imageSources={mask:await U,overlay:await W};this.disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>
this.notifyChange("updating"),()=>this.notifyChange("updating")))}};S.updateResources=function(H,R){this.enabled?f.isSome(this._resources)?this._resources.textures.size!==R&&(H=this.createTextureResources(H,R),f.isNone(H)?this.disposeResources():(this.disposeTextureResources(this._resources.textures),this._resources.textures=H)):(R=this.createTextureResources(H,R),f.isNone(R)||(this._resources={textures:R,program:this.createProgram(H),vao:this.createVAO(H),pipelineState:C.makePipelineState({blending:C.simpleBlendingParams(1,
771),depthTest:null,depthWrite:null,colorWrite:C.defaultColorWriteParams})})):this.disposeResources()};S.disposeResources=function(){f.isNone(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};S.disposeTextureResources=function(H){H.mask.dispose();H.overlay.dispose();H.input.dispose()};S.createTextureResources=function(H,R){if(f.isNone(this._imageSources))return null;this._imageSources.overlay.width=
R;this._imageSources.overlay.height=R;this._imageSources.mask.width=R;this._imageSources.mask.height=R;const T=new x(H,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0,preMultiplyAlpha:n.isSVG(this._imageSources.overlay.src)&&L.testWebGLDriver(H).svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),W=new x(H,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);
return{input:new x(H,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1}),mask:W,overlay:T,size:R}};S.createProgram=function(H){const R=P.build();return new r(H,R.generateSource("vertex"),R.generateSource("fragment"),this.attributeLocations)};S.createVAO=function(H){return E.createQuadVAO(H,B.Pos2,this.attributeLocations,0,1)};g._createClass(aa,[{key:"updating",get:function(){return f.isNone(this._imageSources)&&f.isSome(this._imageLoadTask)&&
!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(H){H!==this._magnifier&&(this._handles.removeAll(),this._magnifier=H,H=()=>{this.updateResourceLoading();this.events.emit("request-render")},f.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",H)),H())}},{key:"enabled",get:function(){return f.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return f.isSome(this._magnifier)&&this._magnifier.visible&&
f.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return f.isSome(this._magnifier)?this._magnifier.factor||1:1}},{key:"attributeLocations",get:function(){return{position:0}}}]);return aa}(t);b.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);b.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([d.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=
b.__decorate([h.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(a,g,b){a.build=function(){const p=new b.ShaderBuilder;p.attributes.add("position","vec2");p.vertex.uniforms.add("proj","mat4");p.vertex.uniforms.add("drawPosition","vec4");p.varyings.add("vUV",
"vec2");p.vertex.code.add(g.glsl`
    void main(void) {
      vUV = position;
      gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
    }
  `);p.fragment.uniforms.add("textureInput","sampler2D");p.fragment.uniforms.add("textureMask","sampler2D");p.fragment.uniforms.add("textureOverlay","sampler2D");p.fragment.uniforms.add("maskEnabled","bool");p.fragment.uniforms.add("overlayEnabled","bool");p.fragment.code.add(g.glsl`
    const float barrelFactor = 1.1;

    vec2 barrel(vec2 uv) {
      vec2 uvn = uv * 2.0 - 1.0;

      if (uvn.x == 0.0 && uvn.y == 0.0) {
        return vec2(0.5, 0.5);
      }

      float theta = atan(uvn.y, uvn.x);
      float r = pow(length(uvn), barrelFactor);
      return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
    }

    void main() {
      float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
      vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
      vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);

      gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
    }
  `);return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,g,b,p){g.loadMagnifierResources=async function(f){var k=new Promise(function(d,e){a(["./mask-svg"],function(h){d(Object.freeze({__proto__:null,"default":h}))},e)}),c=new Promise(function(d,e){a(["./overlay-svg"],function(h){d(Object.freeze({__proto__:null,"default":h}))},e)});k=p.requestImage((await k).default,
{signal:f});c=p.requestImage((await c).default,{signal:f});c={mask:await k,overlay:await c};b.throwIfAborted(f);return c};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../core/watchUtils ../../../../chunks/mat4 ../../../../core/MapUtils ../../../../core/TimeProfiler ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ./BoundingInfo ./glUtil3D ./Camera ../../support/debugFlags ./Material ./RenderContext ./rendererUtils ../../../webgl/Measurement ../statistics/RendererPerformanceInfo ../materials/renderers/MergedRenderer ../lighting/SceneLighting ./depthRange ./depthRangeUtils ../core/renderPasses/RenderPassManager ./HighlightHelper ./OffscreenRendering ./RenderPluginManager ./ShadowHighlightHelper ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P){g=function(){function W(U,N,ca,O,V,ba,fa,ia,ma){this._materialRep=U;this._shaderTechniqueRepository=ca;this._rctx=O;this._compositingHelper=V;this._magnifierHelper=ba;this.requestRender=fa;this._stage=ma;this._materialRenderers=new Map;this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._camera=new v(p.fromValues(0,100,-100));this._content=new Map;this._isRendering=!1;this._bindParameters={slot:null,camera:null,
inverseViewport:n.create(),shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureUnit:0,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,ssrEnabled:!1,lighting:new C.SceneLighting};this._fallbackDepthStencilTexture=
null;this.performanceInfo=new z.RendererPerformanceInfo;this._antialiasing=1;this._oitEnabled=!1;this._opaqueTerrain=this._multipassTerrain=!0;this._handles=new f;this.renderHiddenTransparentEdges=()=>{};this._smaaPass=new J(this._rctx);this._oitEnabled=this._hasOITSupport;this.camera.viewport[2]=ia[0];this.camera.viewport[3]=ia[1];this.requestRender();this._offscreenRendering=new E.OffscreenRendering(this._rctx,this._compositingHelper);this._sliceHelper=new K;this._shadowMap=new I(this._rctx,ca.viewingMode,
2);this._ssaoHelper=new L(ca,this._rctx,()=>this.requestRender());this._highlightHelper=new B(ca,this._rctx);this._shadowHighlightHelper=new G(ca,this._rctx,0,1);this._renderContext=new w(this._rctx,this._offscreenRendering,this._bindParameters.lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._renderPlugins=new F.RenderPluginManager({renderContext:this._renderContext,shaderTechniqueRep:ca,textureRep:N,materialRep:this._materialRep,requestRender:this.requestRender});this.renderPassManager=
new m.RenderPassManager(this._rctx,this._shaderTechniqueRepository);this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager);this._renderContext.ssrParams={camera:null,linearDepthTexture:null,linearDepthTextureUnit:0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,ssrEnabled:!1};this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!0,terrainLinearDepthTexture:null};this._renderContext.multipassGeometryParams=
{multipassGeometryEnabled:!1,geometryLinearDepthTexture:null};this._handles.add(k.init(t,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",ea=>{this.renderHiddenTransparentEdges=ea?()=>this.renderEdges(1):()=>{};this.requestRender()}))}var Y=W.prototype;Y.dispose=function(){this._handles.destroy();this._smaaPass.disable();this._materialRenderers.forEach(U=>U.dispose());this._materialRenderers.clear();this._edgeView=b.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=
b.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlightHelper.dispose();this._shadowHighlightHelper.dispose();q.BoundingInfo.prune();this._content.clear()};Y.ensureEdgeView=function(){b.isNone(this._edgeView)&&(this._edgeView=new P.EdgeView({rctx:this._rctx,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this.requestRender(),scheduler:this._stage.scheduler}),
this._handles.add(this._edgeView.watch("updating",()=>this.requestRender(),!0)),this.requestRender());return this._edgeView};Y.setLighting=function(U){this._bindParameters.lighting.set(U)};Y.setRenderParameters=function(U){const {renderPassManager:N,_shadowMap:ca,_ssaoHelper:O}=this;void 0!==U.screenSpaceReflectionsEnabled&&N.screenSpaceReflectionsEnabled!==U.screenSpaceReflectionsEnabled&&(N.screenSpaceReflectionsEnabled=U.screenSpaceReflectionsEnabled,this.requestRender());void 0===U.shadowMap||
ca.enabled===U.shadowMap&&N.shadowCastingEnabled===U.shadowMap||(ca.enabled=U.shadowMap,N.shadowCastingEnabled=U.shadowMap,this.requestRender());void 0!==U.shadowMapMaxCascades&&ca.maxCascades!==U.shadowMapMaxCascades&&(ca.maxCascades=U.shadowMapMaxCascades,this.requestRender());void 0!==U.ssao&&O.enabled!==U.ssao&&(O.enabled=U.ssao,this.requestRender());void 0!==U.ssaoAttenuation&&O.attenuation!==U.ssaoAttenuation&&(O.attenuation=U.ssaoAttenuation,this.requestRender());void 0!==U.ssaoRadius&&O.radius!==
U.ssaoRadius&&(O.radius=U.ssaoRadius,this.requestRender());void 0!==U.ssaoSamples&&O.samples!==U.ssaoSamples&&(O.samples=U.ssaoSamples,this.requestRender());U.background&&this._offscreenRendering.background!==U.background&&(this._offscreenRendering.background=U.background,this.requestRender());var V=U.antialiasingEnabled?1:0;void 0!==U.antialiasingEnabled&&this._antialiasing!==V&&(this._antialiasing=V,this.requestRender());void 0!==U.highQualityTransparency&&this._multipassTerrain!==U.highQualityTransparency&&
(this._oitEnabled=(this._multipassTerrain=U.highQualityTransparency)&&this._hasOITSupport,this.requestRender());void 0!==U.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(U.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(U.defaultHighlightOptions),this.requestRender());void 0!==U.slicePlane&&this._sliceHelper.plane!==U.slicePlane&&(this._sliceHelper.plane=b.unwrap(U.slicePlane),this.requestRender());V=10<=this._rctx.parameters.maxTextureImageUnits&&U.waterReflectionEnabled;
void 0!==U.waterReflectionEnabled&&this._waterReflectionEnabled!==V&&(this._waterReflectionEnabled=V,this.requestRender());void 0!==U.opaqueTerrain&&this._opaqueTerrain!==U.opaqueTerrain&&(this._opaqueTerrain=U.opaqueTerrain,this.requestRender())};Y.getFramebufferTexture=function(U){switch(U){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();
case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture;default:return null}};Y.modify=function(U){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:N,removes:ca,updates:O}=U;if(0!==N.length||0!==ca.length||0!==O.length){ca.forAll(({id:ba})=>this._content.delete(ba));N.forAll(ba=>this._content.set(ba.id,ba));var V=!1;y.splitRenderGeometryChangeSetByMaterial(U).forEach((ba,
fa)=>{let ia=this._materialRenderers.get(fa);if(!ia)if(0<ba.adds.length)ia=new r(this._rctx,this._materialRep,fa),this._materialRenderers.set(fa,ia);else return;ia.modify(ba);ia.isEmpty&&(V=!0)});V&&this._materialRenderers.forEach((ba,fa)=>{ba.isEmpty&&(this._materialRenderers.delete(fa),ba.dispose())});this._hasHighlights=d.someMap(this._materialRenderers,ba=>ba.hasHighlights);this._hasOccludees=d.someMap(this._materialRenderers,ba=>ba.hasOccludees);this._hasWater=d.someMap(this._materialRenderers,
ba=>ba.hasWater);this.requestRender()}};Y.updateLogic=function(U){let N=!1;this._materialRenderers.forEach(ca=>{ca.updateLogic&&(N=ca.updateLogic(U)||N)});return N};Y.render=function(U,N,ca){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this.setLighting(this._stage.lighting);this._renderContext.hasOccludees=this._hasOccludees;this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=3;const O=this._offscreenRendering;O.needLastFrameColorTexture=this._waterReflectionEnabled;
O.advanceCurrentRenderTarget();const V=this._sliceHelper.plane;ca&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(U);N.setGLViewport(this._rctx);this._renderPlugins.prepareRender(N);this.performanceInfo.advance(0);this._shadowHighlightHelper.setup(N,this._stage.mainLightDirection);this.renderShadowMap(U,N,this._stage.mainLightDirection);this.performanceInfo.advance(1);O.initializeFrame(N);this.ensureBindParameters(N);this.renderLinearDepth();this.performanceInfo.advance(2);this.renderNormal();
this.performanceInfo.advance(3);this.ensureBindParametersSSR();this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(N,O.linearDepthTexture,O.normalTexture);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this.performanceInfo.advance(4);this.performanceInfo.stats.reset();this._renderContext.pass=0;O.bindFramebuffer();this.renderSlot(0);this.renderOpaqueGeometry();this.performanceInfo.advance(5);N=this._multipassTerrain&&!this._opaqueTerrain;this.renderTerrainLinearDepth(N);this.setMultipassFlags(N);
this.setTerrainCulling(N);this.renderEdges(2);this.performanceInfo.advance(6);this.renderHiddenTransparentEdges();this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry();this.performanceInfo.advance(7);this.renderGeometryLinearDepth(N);var ba=!1,fa=!1;ba=this.renderHUDVisibility();N||this.renderInternalSlot(20);this.performanceInfo.advance(9);this.renderEdges(1,N);this.performanceInfo.advance(8);(fa=this.renderTransparentTerrain())&&
ba&&(O.compositeTransparentTerrainOntoHUDVisibility(),N&&this.renderLineCallouts(0),this.renderHUD(0,O.framebuffer),this.performanceInfo.advance(16));this.performanceInfo.advance(10);this.setTerrainCulling(!1);fa&&(O.compositeTransparentTerrainOntoMain(),N&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8)));
N&&this.renderLineCallouts(1);this.setMultipassFlags(!1);O.renderToTargets(()=>{this.renderInternalSlot(8);this.renderSlot(15);this.renderSlot(16)},O.currentColorTarget,O.mainDepth);this.performanceInfo.advance(11);this._renderPlugins.needsLaserlineWithContrastControl&&O.renderTmpAndCompositeToMain(()=>{this.renderSlot(17)},2);this.performanceInfo.advance(12);this.renderOccluded();this.performanceInfo.advance(13);N=(ca=!ca&&this._magnifierHelper.enabled)&&b.isNone(U)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,
this._offscreenRendering.tmpDepth):U;this._rctx.bindFramebuffer(N);this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0);this.performanceInfo.advance(14);this.renderHUD(1,N);this.performanceInfo.advance(17);this.renderHighlights(N,O.linearDepthTexture);this.performanceInfo.advance(15);ca&&this._magnifierHelper.render(this._rctx,this._bindParameters);N!==U&&(this._rctx.bindFramebuffer(U),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,
0));this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=V;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};Y.readDepthPixels=function(U,N,ca,O,V){const ba=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this.needsLinearDepth()||(this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(17664,255),
this.renderGeometryAndTransparentTerrainPass(2),this._rctx.gl.flush(),this._rctx.gl.finish());ba.readPixels(U,N,ca,O,6408,5121,V)};Y.setMultipassFlags=function(U){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=U;this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=U};Y.setTerrainCulling=function(U){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=
U};Y.renderSlot=function(U){this._renderContext.slot=U;return this._renderPlugins.render()};Y.renderEdges=function(U,N=!1){const ca=this._edgeView;b.isSome(ca)&&ca.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>ca.render(this._bindParameters,U),1,N)};Y.renderShadowMap=function(U,N,ca){const O=this._shadowMap;if(O.enabled){t.ENABLE_PROFILE_DEPTH_RANGE&&e.begin("depthRange");var V=this.computeDepthRange(N);t.ENABLE_PROFILE_DEPTH_RANGE&&e.end("depthRange");O.prepare(N,ca,V);
ca=O.getCascades();if(this.needsShadowHighlight()){V=this._shadowHighlightHelper;for(var ba=0;ba<ca.length;++ba){var fa=ca[ba];fa.camera.setGLViewport(this._rctx);this.ensureCameraBindParameters(fa.camera);this.renderGeometryAndTransparentTerrainPass(7);O.takeCascadeSnapshotTo(fa,V.highlightShadowMapSlot)}O.clear();for(ba=0;ba<ca.length;++ba)fa=ca[ba],fa.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(fa.camera),this.renderGeometryAndTransparentTerrainPass(6),O.takeCascadeSnapshotTo(fa,
V.defaultSnapshotSlot),this.renderGeometryAndTransparentTerrainPass(7)}else for(V=0;V<ca.length;++V)ba=ca[V],ba.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(ba.camera),this.renderGeometryAndTransparentTerrainPass(4);O.finish(U);N.setGLViewport(this._rctx)}O.bindToAllPrograms(this._shaderTechniqueRepository)};Y.needsLinearDepth=function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight()};
Y.renderLinearDepth=function(){this.needsLinearDepth()?this._offscreenRendering.renderToTargets(()=>this.renderGeometryAndTransparentTerrainPass(2),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};Y.renderTerrainLinearDepth=function(U){U?(U=this._renderContext.pass,this._renderContext.pass=2,this._offscreenRendering.renderToTargets(()=>this.renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,
this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=U):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};Y.renderGeometryLinearDepth=function(U){U?(U=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this.renderGeometryPass(2),this._offscreenRendering.geometryLinearDepth,
this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=U):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};Y.needsNormal=function(){return this._ssaoHelper.enabled};Y.renderNormal=function(){this.needsNormal()?this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(3)},
this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};Y.computeDepthRange=function(U){const N=x.depthRangeFromScene(U,this._content,this._stage.layers);A.union(N,this.renderPlugins.queryDepthRange(U));N.near=Math.max(U.near,N.near);N.far=Math.min(U.far,N.far);return N};Y.renderGeometryAndTransparentTerrainPass=function(U){this._renderContext.pass=U;this.renderGeometryPass(U);this.renderTransparentTerrain()};
Y.renderGeometryPass=function(U){this._renderContext.pass=U;this.renderOpaqueGeometry();this.renderTransparentGeometry()};Y.renderOpaqueGeometry=function(){this.renderSlot(1);this.renderSlot(2);this.renderInternalSlot(3);this.renderSlot(4);this._bindParameters.ssaoEnabled&&this._renderContext.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this.renderSlot(14)};Y.renderTransparentGeometry=function(){this.renderInternalSlot(5);this.renderSlot(6);this._bindParameters.ssaoEnabled&&this._renderContext.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)};
Y.renderTransparentTerrain=function(){return this.renderSlot(7)};Y.renderHUDVisibility=function(){let U=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null;U=this.renderInternalSlot(12)});return U};Y.renderLineCallouts=function(U){this._bindParameters.renderTransparentlyOccludedHUD=
U;0===U?this._offscreenRendering.renderToTargets(()=>this.renderInternalSlot(20),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderInternalSlot(20)};Y.renderHUD=function(U,N){this._oitEnabled?(this.renderOrderIndependentTransparency(()=>this.renderHUDElements(U),!0),this._rctx.bindFramebuffer(N),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===U?this._offscreenRendering.renderToTargets(()=>this.renderHUDElements(0),
this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(U)};Y.renderHUDElements=function(U){this._bindParameters.renderTransparentlyOccludedHUD=U;this.renderInternalSlot(21);this.renderInternalSlot(18);this.renderInternalSlot(19)};Y.needsHighlight=function(){return this._hasHighlights||this._renderPlugins.needsHighlight};Y.needsShadowHighlight=function(){return this._shadowMap.enabled&&this._shadowHighlightHelper.wouldRender&&this.needsHighlight()};
Y.renderHighlights=function(U,N){if(this.needsHighlight()){var ca=this._highlightHelper,O=ca.profilingCallback&&D.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;var V=this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(5);this._rctx.clearSafe(256);this.renderHUDElements(2)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this.needsShadowHighlight()&&
this._shadowHighlightHelper.render(this._renderContext.camera,N,this._shadowMap,this._stage.mainLightDirection,V,U);ca.render(this._renderContext.camera,V,U);b.isSome(O)&&ca.profilingCallback&&O.stop(ba=>{ca.profilingCallback&&ca.profilingCallback(ba)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};Y.renderOrderIndependentTransparency=function(U,N){const ca=V=>{this._renderContext.transparencyPassType=V;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;
this._offscreenRendering.renderOITPass(()=>U(),V,N)},O=this._renderContext.pass;this._renderContext.pass=1;ca(1);this._renderContext.pass=0;ca(0);ca(2);this._offscreenRendering.compositeTransparentOntoOpaque(N);this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=O};Y.renderOccluded=function(){let U=0;this._materialRenderers.forEach((ba,fa)=>{fa&&fa.isVisible()&&8===fa.renderOccluded&&(U|=fa.renderOccluded,
X.push(fa))});const N=this._offscreenRendering,ca=(ba,fa,ia=()=>V(fa),ma=!0,ea=!0)=>{0!==(U&fa)&&(N.renderToTargets(ia,N.tmpColor,N.mainDepth,[0,0,0,0],ma,ea),N.compositeOccludedOntoMain(ba))};0!==X.length&&(this.renderInternalSlot(10,X),ca(.5,8,()=>this.renderInternalSlot(11,X),!1,!1),X.length=0);this._materialRenderers.forEach((ba,fa)=>{fa&&fa.isVisible()&&(4===fa.renderOccluded||2===fa.renderOccluded||16===fa.renderOccluded)&&(U|=fa.renderOccluded,Q.push(fa))});const O=this._renderPlugins.renderOccludedFlags;
if(U|=O){var V=ba=>{this._renderContext.renderOccludedMask=ba;1<O&&this.renderSlot(9);this.renderInternalSlot(3,Q);this.renderInternalSlot(5,Q);this.renderInternalSlot(8,Q);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=0;ca(.5,4,()=>V(4),!0,2);ca(.5,2,()=>V(2),!0,2);ca(1,16,()=>V(16),!0,2);Q.length=0}};Y.renderAntiAliasing=function(U,N){if(1===U){if(this._smaaPass.loadResources(()=>this.requestRender()),this._smaaPass.enable())return this._smaaPass.render({colorTexture:N}),
!0}else this._smaaPass.disable();return!1};Y.ensureCameraBindParameters=function(U){this._renderContext.camera=U;this._bindParameters.camera=this._renderContext.camera;this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2];this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]};Y.ensureBindParameters=function(U){this.ensureCameraBindParameters(U);U=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap;
this._bindParameters.shadowMappingEnabled=!!this._renderContext.shadowMap&&this._renderContext.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!this._renderContext.ssaoHelper&&this._renderContext.ssaoHelper.enabled;this._bindParameters.slicePlane=this._renderContext.sliceHelper&&this._renderContext.sliceHelper.plane;this._bindParameters.hasOccludees=this._renderContext.hasOccludees;this._bindParameters.linearDepthTextureUnit=3;this._bindParameters.lastFrameColorTextureUnit=4;this._renderContext.multipassTerrainParams.camera=
this._renderContext.camera;this._bindParameters.hudVisibilityTexture=U?U.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=U&&U.depthTexture||this.getFallbackDepthTexture()};Y.ensureBindParametersSSR=function(){this._waterReflectionEnabled?(c.translate(aa,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),c.translate(H,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),
c.invert(H,H),c.invert(S,this._renderContext.camera.projectionMatrix),c.multiply(R,H,S),c.multiply(R,aa,R),c.multiply(R,this._renderContext.lastFrameCamera.projectionMatrix,R),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=R,this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture,this._renderContext.ssrParams.lastFrameColorTexture=
this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this._waterReflectionEnabled};Y.renderInternalSlot=function(U,N){const ca=0===this._renderContext.pass?this.performanceInfo.stats:null;let O=!1;this._bindParameters.slot=U;b.isSome(N)?N.forEach(V=>{l.materialPredicate(V,this._renderContext)&&
(V=this._materialRenderers.get(V),b.isSome(V)&&(O=V.render(U,this._renderContext,this._bindParameters)||O))}):this._materialRenderers.forEach((V,ba)=>{l.materialPredicate(ba,this._renderContext)&&(O=V.render(U,this._renderContext,this._bindParameters,ca)||O)});return O};Y.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=u.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};Y.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?
this._offscreenRendering.getGpuMemoryUsage():0,highlights:(this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0)+(this._shadowHighlightHelper?this._shadowHighlightHelper.getGpuMemoryUsage():0),shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};a._createClass(W,[{key:"updating",get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||b.isSome(this._edgeView)&&this._edgeView.updating||!this.isCameraFinal}},
{key:"camera",get:function(){return this._camera},set:function(U){this._camera.copyFrom(U);this.requestRender()}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMat?!0:c.equals(this._bindParameters.reprojectionMat,T)}},{key:"hasShadowsEnabled",get:function(){var U;return!(null==(U=this._shadowMap)||!U.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},
{key:"canRender",get:function(){return 0<this._camera.fullWidth&&0<this._camera.fullHeight}},{key:"_hasOITSupport",get:function(){return this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat}},{key:"test",get:function(){return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,
materialRenderers:this._materialRenderers,oitEnabled:this._oitEnabled,shadowHighlights:this._shadowHighlightHelper}}}]);return W}();const Q=[],X=[],aa=h.create(),S=h.create(),H=h.create(),R=h.create(),T=h.create();return g})},"esri/core/TimeProfiler":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(a){let g=function(){function b(f,k=.9){this._alpha=.9;this._max=this._min=this._smooth=this._sum=this._count=this._startTime=0;this._name=f;this._alpha=k;this.reset()}var p=b.prototype;
p.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};p.begin=function(){this._startTime=performance.now()};p.end=function(){const f=performance.now()-this._startTime;this._count+=1;this._sum+=f;this._smooth=this._alpha*f+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,f);this._max=Math.max(this._max,f)};p.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};a._createClass(b,[{key:"name",
get:function(){return this._name}},{key:"count",get:function(){return this._count}},{key:"average",get:function(){return 0<this._count?this._sum/this._count:0}},{key:"smooth",get:function(){return this._smooth}},{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}}]);return b}();(function(b){function p(d){d in k||(k[d]=new b(d));return k[d]}function f(d){console.log(p(d).toJSON())}const k={},c={};b.get=p;b.begin=function(d){p(d).begin()};b.end=function(d,e=!0){p(d).end();
const h=performance.now();!e||d in c&&!(h>=c[d]+1E3)||(f(d),c[d]=h)};b.log=f;b.logAll=function(){for(const d in k)f(d)}})(g||(g={}));return g})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4 ../../../../../chunks/mat3f64 ../../../../../chunks/mat3 ../../../../../chunks/vec2 ../../../../../chunks/vec4 ../../../support/geometryUtils ../../lib/depthRange ../util/TwoVectorPosition ./AllRenderPasses ./RenderPass".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){let l=function(){function z(C,A){this.rctx=C;this.shaderTechniqueRepository=A;this.canRender=!0;this._materialPassParams=new v.MaterialPassesParameters;this._shadowPassParams=new v.ShadowMapPassParameters;this._highlightPassParams=new v.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository));this.passes={materialOpaque:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository)),
materialTransparent:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository)),highlightShadowMap:this._registerPass(new t.RenderPass(C,this.shaderTechniqueRepository)),defaultShadowMap:this._registerPass(new t.RenderPass(C,
this.shaderTechniqueRepository))}}var r=z.prototype;r.register=function(C){this._systems.add(C)};r.prepareRender=function(C){0!==this._systems.size&&(this._passes.forEach(A=>A.prepareSubmit()),this._systems.forEach(A=>{A.submit(this.passes,{camera:C})}),this._passes.forEach(A=>A.finishSubmit()),this.shaderTechniqueRepository.frameUpdate())};r.render=function(C){if(0===this._systems.size)return!1;if(4===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);
this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 5:this.passes.highlight.dispatch(this._highlightPassParams);break;case 4:this._shadowMapPass.dispatch(this._shadowPassParams);break;case 7:b.isSome(this.passes.highlightShadowMap)&&this.passes.highlightShadowMap.dispatch(this._shadowPassParams);
break;case 6:b.isSome(this.passes.defaultShadowMap)&&this.passes.defaultShadowMap.dispatch(this._shadowPassParams)}if(6===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this._configureMaterialColorPass(C);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=
2;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);this._materialPassParams.ssrParams=C.ssrParams;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);
break;case 3:this._materialPassParams.subPass=3;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 5:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};r.notifyDirty=function(){this.context.requestRender()};r.slots=function(){return[4,6,1]};r.initializeRenderContext=function(C){this.context=C};r.uninitializeRenderContext=function(){};r.queryDepthRange=function(C){const A={near:Infinity,far:-Infinity};this._systems.forEach(x=>{x=x.queryShadowCasterDepthRange(C);
b.isSome(x)&&q.union(A,x,A)});return A};r._configureMaterialColorPass=function(C){this._materialPassParams.shadowMap={bind:(A,x)=>{C.shadowMap.bind(A,x);x=this._materialPassParams.viewTransform;f.add(w,x.worldFromView_TL,x.worldFromView_TH);C.shadowMap.bindView(A,w)}};this._materialPassParams.ambientOcclusion={bind:(A,x)=>{C.ssaoHelper.setUniforms(A,x)}};this._materialPassParams.ambientOcclusionEnabled=!!C.ssaoHelper&&C.ssaoHelper.enabled;this._materialPassParams.sceneHasOcludees=C.hasOccludees};
r._configure=function(C){this._updateParameters(C,4===C.pass||7===C.pass||6===C.pass?this._shadowPassParams:5===C.pass?this._highlightPassParams:this._materialPassParams)};r._updateParameters=function(C,A){const x=C.camera,m=x.viewInverseTransposeMatrix;f.set(w,m[3],m[7],m[11]);D.set(w);f.copy(A.viewTransform.worldFromView_TH,D.high);f.copy(A.viewTransform.worldFromView_TL,D.low);d.fromMat4(A.viewTransform.viewFromCameraRelative_RS,x.viewMatrix);k.copy(A.viewTransform.projFromView,x.projectionMatrix);
0===A.identifier?(this._materialPassParams.transparent=6===C.slot,this._materialPassParams.integratedMesh=1===C.slot,this._materialPassParams.lighting=C.scenelightingData,d.transpose(y,A.viewTransform.viewFromCameraRelative_RS),d.invert(A.transformNormal_ViewFromGlobal,y),e.set(A.cameraNearFar,x.near,x.far)):1===A.identifier?e.set(A.cameraNearFar,x.near,x.far):2===A.identifier&&(A.highlightDepthTexture=C.highlightDepthTexture,h.copy(A.viewport,x.fullViewport));if(0===A.identifier||2===A.identifier)A.inverseViewport[0]=
1/x.fullViewport[2],A.inverseViewport[1]=1/x.fullViewport[3];n.boundedPlane.copyWithoutVerify(C.sliceHelper.plane,A.slicePlane);f.subtract(A.slicePlane.origin,A.slicePlane.origin,w);A.slicePlaneEnabled=C.sliceHelper.isEnabled;this._materialPassParams.transparencyPassType=C.transparencyPassType;this._materialPassParams.multipassTerrainParams=C.multipassTerrainParams};r._registerPass=function(C){this._passes.push(C);return C};g._createClass(z,[{key:"shadowCastingEnabled",get:function(){return b.isSome(this.passes.shadowMap)},
set:function(C){C?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)}},{key:"screenSpaceReflectionsEnabled",get:function(){return b.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(C){this._materialPassParams.ssrParams.ssrEnabled=C?!0:!1}},{key:"needsHighlight",get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count}}]);return z}();
const w=p.create(),y=c.create(),D=new u.TwoVectorPosition;a.RenderPassManager=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),function(a,g,b,p,f,k){a.HighlightPassParameters=function(){this.identifier=2;this.viewTransform=new k.VertexPosition.ViewProjectionTransform;
this.slicePlane=f.boundedPlane.create();this.inverseViewport=b.create();this.viewport=p.create()};a.MaterialPassesParameters=function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new k.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=g.create();this.cameraNearFar=b.create();this.inverseViewport=b.create();this.slicePlane=f.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=
!1;this.transparencyPassType=3};a.ShadowMapPassParameters=function(){this.identifier=1;this.viewTransform=new k.VertexPosition.ViewProjectionTransform;this.cameraNearFar=b.create();this.slicePlane=f.boundedPlane.create()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray"],function(a,g,b){let p=function(){function k(d,e,h=0){this._rctx=
d;this._techniqueRepository=e;this._sorting=h;this._draws=new b({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var c=k.prototype;c.submitDraw=function(d,e,h,n,q){const u=this._draws.pushNew();u.geometry=e;u.geometryRanges=h;u.material=d;u.bindDrawParams=n;u.depthSquaredHint=q;u.indexType=e.indexed?e.vao.indexBuffer.indexType:
0};c.dispatch=function(d){const e=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let h=null;const n={repository:this._techniqueRepository},q=this._draws.length;for(let v=0;v<q;v++){const t=this._draws.data[v],l=t.geometry;var u=t.material.getTechnique(n,d,l.parameters);this._passBoundTechniques.has(u)||(u.bindPass(e,d),this._passBoundTechniques.add(u));e.bindVAO(l.vao);if(u!==h||3!==u.configuration.transparencyPassType)e.bindProgram(u.program),
e.setPipelineState(u.pipeline),h=u;this._previouslyBoundMaterials.get(u)!==t.material&&(u.bindMaterial(e,t.material,d),this._previouslyBoundMaterials.set(u,t.material));this._previouslyBoundDraw.get(u)!==t.bindDrawParams&&(u.bindDraw(t.bindDrawParams,t.material,d),this._previouslyBoundMaterials.set(u,t.material));if(0!==t.indexType){u=f.get(t.indexType);for(let w=0;w<t.geometryRanges.length;w+=2)e.drawElements(l.primitiveType,t.geometryRanges[w+1],t.indexType,t.geometryRanges[w]*u)}else for(u=0;u<
t.geometryRanges.length;u+=2)e.drawArrays(l.primitiveType,t.geometryRanges[u],t.geometryRanges[u+1])}};c.prepareSubmit=function(){this._draws.clear()};c.finishSubmit=function(){const d=0===this._sorting?1:-1;this._draws.sort((e,h)=>{const n=d*(e.depthSquaredHint-h.depthSquaredHint);return 0!==n?n:e.geometry.vao.size-h.geometry.vao.size})};g._createClass(k,[{key:"count",get:function(){return this._draws.length}}]);return k}();const f=new Map;f.set(5121,1);f.set(5123,2);f.set(5125,4);a.RenderPass=p;
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f32 ./DefaultVertexAttributeLocations ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ../../support/debugFlags ../../../webgl/FramebufferObject ../shaders/HighlightTechnique".split(" "),function(a,
g,b,p,f,k,c,d,e,h,n,q,u){return function(){function v(l,w){this._rctx=w;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.quadVAO=h.createQuadVAO(this._rctx);w={colorTarget:0,depthStencilTarget:0,width:0,height:0};const y={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new q(this._rctx,w,y);this.blur1Fbo=new q(this._rctx,w,y);this.viewportToRestore=
g.create();this.defaultOptions={color:p.fromValues(1,0,1,1),haloColor:p.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:p.fromValues(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075};w=new u.HighlightCompositionTechniqueConfiguration;w.highlightStage=0;w.gridOptimization=!1;this.blurTechnique=l.acquireAndReleaseExisting(u.HighlightCompositionTechnique,w,this.blurTechnique);w.highlightStage=0;w.gridOptimization=!0;this.blurGridTechnique=
l.acquireAndReleaseExisting(u.HighlightCompositionTechnique,w,this.blurGridTechnique);w.highlightStage=1;w.gridOptimization=!1;this.applyTechnique=l.acquireAndReleaseExisting(u.HighlightCompositionTechnique,w,this.applyTechnique);w.highlightStage=1;w.gridOptimization=!0;this.applyGridTechnique=l.acquireAndReleaseExisting(u.HighlightCompositionTechnique,w,this.applyGridTechnique);w.highlightStage=2;w.gridOptimization=!1;this.downsampleTechnique=l.acquireAndReleaseExisting(u.HighlightCompositionTechnique,
w,this.downsampleTechnique)}var t=v.prototype;t.dispose=function(){if(null!=!this.quadVAO){if(this._grid.coverageMipmap)for(let l=1;l<this._grid.coverageMipmap.length;l++)this._grid.coverageMipmap[l].dispose();this._grid.vao&&this._grid.vao.dispose(!0);this.quadVAO.dispose(!0);this.blur1Fbo.dispose();this.blur0Fbo.dispose();this.blur1Fbo=this.blur0Fbo=this.quadVAO=null}};t.setDefaultOptions=function(l){this.defaultOptions=l};t.render=function(l,w,y){var D=l.pixelRatio;const z=n.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,
r=this._rctx;b.copy(this.viewportToRestore,l.fullViewport);var C=Math.ceil(l.fullWidth/D);D=Math.ceil(l.fullHeight/D);this.blur0Fbo.resize(C,D);this.blur1Fbo.resize(C,D);r.bindVAO(this.quadVAO);let A=l=null;z?(this._gridUpdateResources(w,32),this._gridComputeMipmap(),l=this._grid.vao,A=this.blurGridTechnique,r.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),A.program.setUniform1i("coverageTex",1)):(l=this.quadVAO,A=this.blurTechnique);A.bindPipelineState(r);r.bindProgram(A.program);
r.bindVAO(l);r.bindFramebuffer(this.blur0Fbo);r.setViewport(0,0,C,D);r.setClearColor(0,0,0,0);r.clear(16384);A.program.setUniform1i("tex",0);r.bindTexture(w.colorTexture,0);A.program.setUniform2f("blurSize",1/C,0);r.drawArrays(A.primitiveType,0,c.vertexCount(l,"geometry"));r.bindFramebuffer(this.blur1Fbo);r.clear(16384);r.bindTexture(this.blur0Fbo.colorTexture,0);A.program.setUniform2f("blurSize",0,1/D);r.drawArrays(A.primitiveType,0,c.vertexCount(l,"geometry"));C=z?this.applyGridTechnique:this.applyTechnique;
r.bindFramebuffer(y);C.bindPipelineState(r);r.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);r.bindProgram(C.program);r.bindTexture(this.blur1Fbo.colorTexture,0);r.bindTexture(w.colorTexture,1);z&&r.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);C.bindApplyPass(this.defaultOptions);r.drawArrays(C.primitiveType,0,c.vertexCount(l,"geometry"));r.bindVAO(null)};t._gridUpdateResources=function(l,w){const y=
this._rctx,D=this._grid;var z=!1;null===D.coverageMipmap&&(D.coverageMipmap=[l],z=!0);if(D.viewportWidth!==l.width||D.viewportHeight!==l.height)z=!0,D.viewportWidth=l.width,D.viewportHeight=l.height;D.coverageMipmap[0]=l;D.cellPixelSize!==w&&(D.cellPixelSize=w,z=!0);if(z){for(w=1;w<D.coverageMipmap.length;w++)D.coverageMipmap[w].dispose();D.mipmapLevels=Math.ceil(Math.log(D.cellPixelSize)*Math.LOG2E);D.coverageMipmap.length=D.mipmapLevels+1;for(w=0;w<D.mipmapLevels;w++)z=D.coverageMipmap[w],D.coverageMipmap[w+
1]=new q(y,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(z.width/2),height:Math.ceil(z.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(z.width/2),height:Math.ceil(z.height/2)})}z=Math.ceil(l.height/D.cellPixelSize);var r=Math.ceil(l.width/D.cellPixelSize);if(!D.vao||D.verticalCellCount!==z||D.horizontalCellCount!==r){D.verticalCellCount=z;D.horizontalCellCount=r;l=z+1;w=r+1;z=1/z;r=1/r;const C=new Float32Array(24*l*w);let A=0;for(let x=
0;x<l;x++)for(let m=0;m<w;m++)C[A+0]=(m-.5)*r*2-1,C[A+1]=(x-.5)*z*2-1,C[A+2]=m*r,C[A+3]=x*z,C[A+4]=(m+.5)*r*2-1,C[A+5]=(x-.5)*z*2-1,C[A+6]=m*r,C[A+7]=x*z,C[A+8]=(m-.5)*r*2-1,C[A+9]=(x+.5)*z*2-1,C[A+10]=m*r,C[A+11]=x*z,C[A+12]=(m-.5)*r*2-1,C[A+13]=(x+.5)*z*2-1,C[A+14]=m*r,C[A+15]=x*z,C[A+16]=(m+.5)*r*2-1,C[A+17]=(x-.5)*z*2-1,C[A+18]=m*r,C[A+19]=x*z,C[A+20]=(m+.5)*r*2-1,C[A+21]=(x+.5)*z*2-1,C[A+22]=m*r,C[A+23]=x*z,A+=24;D.vao&&D.vao.dispose(!0);D.vao=new d(y,f.Default3D,{geometry:e.Pos2Tex},{geometry:k.createVertex(y,
35044,C)})}};t._gridComputeMipmap=function(){const l=this._rctx,w=this._grid,y=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(l);l.bindVAO(this.quadVAO);for(let D=0;D<w.mipmapLevels;D++){l.bindFramebuffer(w.coverageMipmap[D+1]);l.bindTexture(w.coverageMipmap[D].colorTexture,0);const z=w.coverageMipmap[D+1].width,r=w.coverageMipmap[D+1].height;l.bindProgram(y);y.setUniform1i("tex",0);y.setUniform2f("invFramebufferDim",1/z,1/r);l.setViewport(0,0,z,r);l.drawArrays(5,0,c.vertexCount(this.quadVAO,
"geometry"))}};t.getGpuMemoryUsage=function(){let l=c.getGpuMemoryUsage(this.blur0Fbo)+c.getGpuMemoryUsage(this.blur1Fbo);if(this._grid.coverageMipmap)for(const w of this._grid.coverageMipmap)l+=c.getGpuMemoryUsage(w);return l};a._createClass(v,[{key:"profilingCallback",get:function(){return n.HIGHLIGHTS_PROFILE_TO_CONSOLE?l=>console.log(l):null}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return v}()})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/HighlightComposition.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){const l=u.shader.get().build(this.configuration);return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.bindApplyPass=function(t){this.program.setUniform1i("tex",0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",2);this.program.setUniform4fv("color",
t.color);this.program.setUniform4fv("haloColor",t.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)};v.initializePipeline=function(){return 1===this.configuration.highlightStage?h.makePipelineState({blending:h.separateBlendingParams(770,1,771,771),colorWrite:h.defaultColorWriteParams}):h.makePipelineState({colorWrite:h.defaultColorWriteParams})};
b._createClass(u,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?4:5}}]);return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.HighlightCompositionShader,()=>new Promise(function(q,u){a(["./HighlightComposition.glsl"],q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.highlightStage=0;v.gridOptimization=!1;return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:3})],f.prototype,"highlightStage",
void 0);p.__decorate([c.parameter()],f.prototype,"gridOptimization",void 0);g.HighlightCompositionTechnique=k;g.HighlightCompositionTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,g,b){function p(k){const c=new b.ShaderBuilder,d=c.vertex.code,e=c.fragment.code;c.attributes.add("position",
"vec2");2===k.highlightStage&&(d.add(g.glsl`
    void main() {
      gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
    }`),c.fragment.uniforms.add("tex","sampler2D"),c.fragment.uniforms.add("invFramebufferDim","vec2"),e.add(g.glsl`
      void main() {
        vec2 coord = gl_FragCoord.xy * invFramebufferDim;
        vec4 value = texture2D(tex, coord);
        float mx = floor(max(value.g, value.b));
        gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
      }`));0===k.highlightStage&&(c.attributes.add("uv0","vec2"),k.gridOptimization?(c.vertex.uniforms.add("coverageTex","sampler2D"),c.fragment.uniforms.add("blurSize","vec2"),c.varyings.add("blurCoordinate","vec3")):(c.vertex.uniforms.add("blurSize","vec2"),c.varyings.add("blurCoordinates[5]","vec2")),d.add(g.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${k.gridOptimization?g.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:g.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),c.fragment.uniforms.add("tex","sampler2D"),e.add(g.glsl`
    void main() {
      ${k.gridOptimization?g.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:g.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));1===k.highlightStage&&(c.varyings.add("uv","vec2"),k.gridOptimization&&(c.attributes.add("uv0","vec2"),c.vertex.uniforms.add("coverageTex","sampler2D")),d.add(g.glsl`
      void main() {
        ${k.gridOptimization?g.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),c.fragment.uniforms.add("tex","sampler2D"),c.fragment.uniforms.add("origin","sampler2D"),c.fragment.uniforms.add("color","vec4"),c.fragment.uniforms.add("haloColor","vec4"),c.fragment.uniforms.add("outlineSize","float"),c.fragment.uniforms.add("blurSize","float"),c.fragment.uniforms.add("opacities","vec4"),e.add(g.glsl`
      void main() {
        // Read the highlight intensity from the blurred highlight image
        vec4 blurredHighlightValue = texture2D(tex, uv);
        float highlightIntensity = blurredHighlightValue.a;

        // Discard all pixels which are not affected by highlight
        if (highlightIntensity == 0.0) {
          discard;
        }

        vec4 origin_color = texture2D(origin, uv);

        float outlineIntensity;
        float fillIntensity;

        // if occluded
        if (blurredHighlightValue.g > blurredHighlightValue.b) {
          outlineIntensity = haloColor.w * opacities[1];
          fillIntensity = color.w * opacities[3];
        }
        // if unoccluded
        else {
          outlineIntensity = haloColor.w * opacities[0];
          fillIntensity = color.w * opacities[2];
        }

        float inner = 1.0 - outlineSize / 9.0;
        float outer = 1.0 - (outlineSize + blurSize) / 9.0;

        float outlineFactor = smoothstep(outer, inner, highlightIntensity);
        //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);
        float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
        float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;

        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
        // I.e., color should not be premultiplied with alpha
        gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
      }`));return c}var f=Object.freeze({__proto__:null,build:p});a.HighlightCompositionShader=f;a.build=p})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./RenderTargetHelper"],function(a,g,b){let p=function(){function c(e,h){this._rctx=e;this._compositingHelper=h;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};e=this._rctx;
const n=e.isWebGL2Context(),q=this.renderTargetHelper=new b.RenderTargetHelper(e);this.mainColorTarget0=q.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=q.registerColorTarget({name:"mainColorTarget1"});this.frontFaceTarget=q.registerColorTarget({name:"frontFaceTarget"});e=u=>q.registerColorTarget({name:u,dataType:5126,internalFormat:n?34836:6408,samplingMode:9728});this.colorFloatTarget=e("colorFloatTarget");this.alphaFloatTarget=e("alphaFloatTarget");this.mainDepth=q.registerDepthTarget({name:"mainDepth"});
this.linearDepth=q.registerColorTarget({name:"linearDepth",samplingMode:9728});this.terrainLinearDepth=q.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=q.registerColorTarget({name:"geometryLinearDepth"});this.normal=q.registerColorTarget({name:"normal"});this.highlight=q.registerColorTarget({name:"highlight",internalFormat:n?32854:6408,dataType:32819});this.hudVisibility=q.registerColorTarget({name:"hudVisibility",internalFormat:n?32854:6408,dataType:32819});this.tmpColor=
q.registerColorTarget({name:"tmpColor"});this.tmpDepth=q.registerDepthTarget({name:"tmpDepth"});this.hudColor=q.registerColorTarget({name:"hudColor"})}var d=c.prototype;d.dispose=function(){this.renderTargetHelper.dispose()};d.getFramebuffer=function(e,h){return this.renderTargetHelper.getFramebuffer(this.dimensions,e,h)};d.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};d.initializeFrame=function(e){const h=this._rctx;
this.dimensions.width=e.fullWidth;this.dimensions.height=e.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);h.setClearStencil(0);e=this._background.color;h.setClearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]);h.clearSafe(17664)};d.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};d.renderTmpAndCompositeToMain=function(e,h,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,f);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),
h)};d.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,k)};d.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),2)},this.hudVisibility,this.tmpDepth)};d.renderOITPass=function(e,h,n){let q,u;switch(h){case 0:q=this.colorFloatTarget;u=[0,0,0,0];break;case 1:q=this.alphaFloatTarget;u=[1,1,1,1];break;case 2:q=this.frontFaceTarget,u=[0,0,0,0]}n?this.renderToTargets(e,
q,this.tmpDepth,u,!0,!0):this.renderToTargets(e,q,this.mainDepth,u,!1)};d.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};d.compositeOccludedOntoMain=function(e){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)};d.compositeTransparentOntoOpaque=function(e){e?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(16384,
255)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))};d.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};d.renderDepthDetached=function(e){this.bindTarget(this.currentColorTarget);e();this.bindTarget(this.currentColorTarget,this.mainDepth)};d.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)};d.renderToTargets=
function(e,h,n,q,u,v){const t=this._rctx;h=this.bindTarget(h,n);n=0;q&&(t.setClearColor(q[0],q[1],q[2],Math.max(1E-13,q[3])),n|=16384);u&&(n|=256);v&&(n|=1024);n&&t.clearSafe(n,!0===v?255:!1===v?0:v);e();t.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return h};d.bindTarget=function(e,h){e=this.renderTargetHelper.getFramebuffer(this.dimensions,e,h);this._rctx.bindFramebuffer(e);return e};d.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)};
d.getGpuMemoryUsage=function(){let e=0;this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage());return e};g._createClass(c,[{key:"width",get:function(){return this.dimensions.width}},{key:"height",get:function(){return this.dimensions.height}},{key:"background",get:function(){return this._background},set:function(e){this._background=e}},{key:"currentColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}},{key:"previousColorTarget",
get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}},{key:"currentRenderTarget",get:function(){return this._currentRenderTarget}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},
{key:"linearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},
{key:"normalTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this.getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this.getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this.getColorTexture(this.hudColor)}},{key:"mainColorTexture",
get:function(){return this.getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(e){!e&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=e}}]);return c}();const f=[0,0,0,0],k=[0,1,0,1];a.OffscreenRendering=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define(["exports",
"../../../webgl/Texture","../../../webgl/Util","../../../webgl/Renderbuffer","../../../webgl/FramebufferObject"],function(a,g,b,p,f){const k={dataType:5121,internalFormat:6408},c={};let d=function(){function e(n){this.rctx=n;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this._nextId=1;this.depthTextureSupported=n.capabilities.depthTexture}var h=e.prototype;h.dispose=function(){this._depthBuffers.forEach(n=>
n.dispose());this._depthBuffers.clear();this._depthTextures.forEach(n=>n.dispose());this._depthTextures.clear();this._colorTextures.forEach(n=>n.dispose());this._colorTextures.clear();this._framebuffers.forEach(n=>n.dispose());this._framebuffers.clear()};h.disposeTargetResource=function(n){n=n.id;this._activeTargets.has(n)&&(this._activeTargets.delete(n),this._depthTextures.has(n)&&(this._depthTextures.get(n).dispose(),this._depthTextures.delete(n)),this._depthBuffers.has(n)&&(this._depthBuffers.get(n).dispose(),
this._depthBuffers.delete(n)),this._colorTextures.has(n)&&(this._colorTextures.get(n).dispose(),this._colorTextures.delete(n)))};h.getDepthTexture=function(n,q){if(this.depthTextureSupported){var u=this._depthTextures.get(n.id);!u||u.descriptor.width===q.width&&u.descriptor.height===q.height||(u.dispose(),u=void 0);u||(u=new g(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:q.width,height:q.height}),this._depthTextures.set(n.id,u),this._activeTargets.add(n.id));
return u}};h.getAllocatedDepthTexture=function(n){return this._depthTextures.get(n.id)};h.getDepthBuffer=function(n,q){if(!this.depthTextureSupported){var u=this._depthBuffers.get(n.id);u?u.descriptor.width===q.width&&u.descriptor.height===q.height||u.resize(q.width,q.height):(u=new p(this.rctx,{internalFormat:34041,...q}),this._depthBuffers.set(n.id,u),this._activeTargets.add(n.id));return u}};h.getColorTexture=function(n,q){let u=this._colorTextures.get(n.id);!u||u.descriptor.width===q.width&&u.descriptor.height===
q.height||(u.dispose(),u=void 0);u||(u=new g(this.rctx,{target:3553,pixelFormat:6408,internalFormat:n.internalFormat,dataType:n.dataType,samplingMode:null!=n.samplingMode?n.samplingMode:9729,wrapMode:33071,width:q.width,height:q.height}),this._colorTextures.set(n.id,u),this._activeTargets.add(n.id));return u};h.getAllocatedColorTexture=function(n){return this._colorTextures.get(n.id)};h.registerDepthTarget=function(n={}){return{id:this._nextId++,...c,...n}};h.registerColorTarget=function(n={}){return{id:this._nextId++,
...k,...n}};h.getFramebuffer=function(n,q,u){const v=this.getKey(q,u);let t=this._framebuffers.get(v);q=this.getColorTexture(q,n);if(this.depthTextureSupported){var l=u?this.getDepthTexture(u,n):void 0;if(!t)return t=u?new f(this.rctx,{colorTarget:0,depthStencilTarget:4},q,l):new f(this.rctx,{colorTarget:0,depthStencilTarget:0},q),this._framebuffers.set(v,t),t;if(t.width!==n.width||t.height!==n.height||t.colorTexture!==q||t.depthStencilTexture!==l)t.detachColorTexture(),t.detachDepthStencilTexture(),
t.resize(n.width,n.height),t.attachColorTexture(q),t.attachDepthStencilTexture(l);return t}l=u?this.getDepthBuffer(u,n):void 0;if(!t)return t=new f(this.rctx,{colorTarget:0,depthStencilTarget:u?3:0},q,l),this._framebuffers.set(v,t),t;if(t.width!==n.width||t.height!==n.height||t.colorTexture!==q)t.detachColorTexture(),t.detachDepthStencilBuffer(),t.resize(n.width,n.height),t.attachColorTexture(q),t.attachDepthStencilBuffer(l);return t};h.getKey=function(n,q){return`${n.id}_${q?q.id:"X"}_${n.name}${q?
"_"+q.name:""}`};h.getGpuMemoryUsage=function(){let n=0;const q=new Set,u=v=>{q.has(v)||(q.add(v),n+=b.getGpuMemoryUsage(v))};this._depthTextures.forEach(u);this._colorTextures.forEach(u);this._depthBuffers.forEach(u);this._framebuffers.forEach(u);return n};return e}();a.RenderTargetHelper=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Util","./depthRange"],function(a,
g,b,p){let f=function(){function c(e){this.context=e;this.renderPlugins=[];this.slots=[];for(e=0;23>e;++e)this.slots[e]=[]}var d=c.prototype;d.add=function(e,h){this.renderPlugins.push(h);for(let n=0;n<e.length;++n)this.slots[e[n]].push(h);h.initializeRenderContext(this.context);this.context.requestRender()};d.remove=function(e){var h=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(n=>n!==e);b.assert(this.renderPlugins.length<h,"Removing non-added render plugin");for(h=0;h<
this.slots.length;++h)this.slots[h]=this.slots[h].filter(n=>n!==e);e.uninitializeRenderContext();this.context.requestRender()};d.prepareRender=function(e){for(const h of this.renderPlugins)h.prepareRender&&h.prepareRender(e)};d.render=function(){const e=this.slots[this.context.renderContext.slot];let h=!1;for(const n of e)n.canRender&&n.render(this.context.renderContext)&&(h=!0);return h};d.queryDepthRange=function(e){const h=k;h.near=Infinity;h.far=-Infinity;for(const n of this.renderPlugins)if(n.queryDepthRange){const q=
n.queryDepthRange(e);q&&p.union(h,q,h)}return h};g._createClass(c,[{key:"needsHighlight",get:function(){return this.renderPlugins.some(e=>e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(e=>e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[17];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){let e=0;this.renderPlugins.forEach(h=>{h.renderOccludedFlags&&(e|=h.renderOccludedFlags)});return e}}]);
return c}();const k={near:0,far:0};a.RenderPluginManager=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowHighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4f32 ./Util ../../../webgl/Util ./glUtil3D ../shaders/ShadowHighlightTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){let t=function(){function x(B,E,F,G){this._rctx=E;this.highlightShadowMapSlot=F;this.defaultSnapshotSlot=G;this._maxOpacity=this._dayNightTerminatorFactor=this._opacityElevationFactor=1;this._defaultOptions={shadowColor:h.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1};E=new v.ShadowHighlightTechniqueConfiguration;this._shadowHighlightTechnique=B.acquireAndReleaseExisting(v.ShadowHighlightTechnique,E,this._shadowHighlightTechnique);this._viewingMode=
B.viewingMode;this._quadVAO=u.createQuadVAO(this._rctx)}var m=x.prototype;m.render=function(B,E,F,G,I,K){n.assert(this._quadVAO);if(F.enabled&&this.wouldRender){var J=this._rctx,L=this._quadVAO,P=this._shadowHighlightTechnique,Q=C,X=r,aa=A,S=z,H=D,R=y,T=this.defaultSnapshotSlot,W=this.highlightShadowMapSlot,Y=this._defaultOptions,U=Y.shadowColor,N=Y.shadowOpacity;Y=Y.occludedShadowOpacity;var ca=this._opacityElevationFactor*this._dayNightTerminatorFactor,O=e.set(l,1/E.descriptor.width,1/E.descriptor.height);
p.transformMat4(R,G,B.viewInverseTransposeMatrix);p.normalize(R,R);p.copy(H,B.center);e.copy(S,B.nearFar);n.inverseProjectionInfo(B.projectionMatrix,B.fullWidth,B.fullHeight,Q,X);f.translate(aa,B.viewMatrix,B.center);f.invert(aa,aa);J.bindFramebuffer(K);J.bindProgram(P.program);P.bindPipelineState(J);P.bindPass(J,{color:U,opacity:N,occludedOpacity:Y,terminationFactor:ca,defaultSnapshotSlot:T,highlightSnapshotSlot:W,shadowMappingEnabled:F.enabled,shadowMap:F,origin:H,zScale:X,inverseView:aa,projInfo:Q,
nearFar:S,depthMap:E,lightDirView:R,highlightMap:I.colorTexture,texelSize:O});J.bindVAO(L);J.drawArrays(P.primitiveType,0,q.vertexCount(L,"geometry"))}};m.getGpuMemoryUsage=function(){return this._quadVAO?this._quadVAO.size:0};m.setDefaultOptions=function(B){this._defaultOptions=B;this._updateMaxOpacity()};m.setup=function(B,E){this._opacityElevationFactor=1-g.smoothstep(4E4,5E4,B.relativeElevation);this._dayNightTerminatorFactor=this._evaluateDayNightTerminatorFactor(B.center,E)};m.dispose=function(){this._quadVAO&&
(this._quadVAO.dispose(),this._quadVAO=null)};m._updateMaxOpacity=function(){const B=this._defaultOptions;this._maxOpacity=Math.max(B.shadowOpacity,B.occludedShadowOpacity)*B.shadowColor[3]};m._evaluateDayNightTerminatorFactor=function(B,E){B=1===this._viewingMode?p.normalize(w,B):p.set(w,0,0,1);E=p.dot(B,E);return g.smoothstep(0,1,g.glClamp(30*E,0,1))};a._createClass(x,[{key:"wouldRender",get:function(){return.001953125<=this._maxOpacity*this._opacityElevationFactor*this._dayNightTerminatorFactor}}]);
return x}();const l=c.create(),w=b.create(),y=b.create(),D=b.create(),z=c.create(),r=c.create(),C=d.create(),A=k.create();return t})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../../chunks/ShadowHighlight.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){k=function(z){function r(){return z.apply(this,arguments)||this}b._inheritsLoose(r,z);var C=r.prototype;C.initializeProgram=function(A){const x=r.shader.get().build(this.configuration);return new e(A.rctx,x.generateSource("vertex"),x.generateSource("fragment"),d.Default3D)};C.initializePipeline=function(A){return h.makePipelineState({blending:h.separateBlendingParams(770,1,771,771),colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null})};
C.bindPass=function(A,x,m){A.bindTexture(x.depthMap,2);A.bindTexture(x.highlightMap,3);this.program.setUniform4fv("color",x.color);this.program.setUniform1f("opacity",x.opacity);this.program.setUniform1f("occludedOpacity",x.occludedOpacity);this.program.setUniform1f("terminationFactor",x.terminationFactor);this.program.setUniform2fv("nearFar",x.nearFar);this.program.setUniformMatrix4fv("inverseView",x.inverseView);this.program.setUniform4fv("projInfo",x.projInfo);this.program.setUniform2fv("zScale",
x.zScale);this.program.setUniform1i("depthMap",2);this.program.setUniform3fv("lightingMainDirectionView",x.lightDirView);this.program.setUniform1i("highlightMap",3);this.program.setUniform2fv("texelSize",x.texelSize);x.shadowMap.setUniforms(this.program);x.shadowMap.bindView(this.program,x.origin);x.shadowMap.bindSnapshot(x.highlightSnapshotSlot,6);this.program.setUniform1i("highlightDepthTex",6);x.shadowMap.bindSnapshot(x.defaultSnapshotSlot,7);this.program.setUniform1i("defaultDepthTex",7)};b._createClass(r,
[{key:"primitiveType",get:function(){return 5}}]);return r}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(D.ShadowHighlightShader,()=>new Promise(function(z,r){a(["./ShadowHighlight.glsl"],z,r)}));f=function(z){function r(){var C=z.apply(this,arguments)||this;C.highlightedThreshold=.99999;C.selfShadowThreshold=.025;return C}b._inheritsLoose(r,z);return r}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter()],f.prototype,"highlightedThreshold",void 0);p.__decorate([c.parameter()],
f.prototype,"selfShadowThreshold",void 0);g.ShadowHighlightTechnique=k;g.ShadowHighlightTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e){function h(q){const u=new b.ShaderBuilder;u.include(c.ReadShadowMap);u.fragment.include(p.RgbaFloatEncoding);u.fragment.include(f.ReadLinearDepth);u.include(e.CameraSpace);u.include(d.ScreenSpacePass);u.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("color","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor",
"float").add("inverseView","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2");u.fragment.constants.add("unoccludedHighlightFlag","vec4",k.unoccludedHighlightFlag).add("highlightedThreshold","float",q.highlightedThreshold).add("selfShadowThreshold","float",q.selfShadowThreshold);u.fragment.code.add(g.glsl`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
      float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
      float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
      float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
      float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }
  `);u.fragment.code.add(g.glsl`
    void main(void) {
      vec4 highlightInfo = texture2D(highlightMap, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;

      if (visiblyHighlighted > highlightedThreshold) {
        discard;
      }

      float depth = rgba2float(texture2D(depthMap, uv));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseView * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= uShadowMapNum) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      vec2 uvShadow = cascadeCoordinates(i, lvpos);

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
      bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;

      float differenceOpacity = opacity;
      float bothOpacity = occludedOpacity;

      float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
      gl_FragColor = vec4(color.rgb, color.a * fragOpacity * terminationFactor);
    }
  `);return u}var n=Object.freeze({__proto__:null,build:h});a.ShadowHighlightShader=n;a.build=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.CameraSpace=function(b){b.fragment.uniforms.add("projInfo","vec4");b.fragment.uniforms.add("zScale","vec2");b.fragment.code.add(g.glsl`
    vec3 reconstructPosition(vec2 fragCoord, float depth) {
      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4 ./Util ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ./Camera ./DefaultTextureUnits ../../../webgl/FramebufferObject".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){function D(ma,ea){h.set(ba,ma[ea],ma[ea+3]);return ba}let z=function(){this.camera=new l;this.lightMat=c.create()},r=function(){function ma(M,Z,la=0){this.rctx=M;this.viewingMode=Z;this._enabled=!1;this.snapshots=[];this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.emptyTexture=t.createColorTexture(this.rctx,[1,1,1,1]);this.maxTextureSize=
this.rctx.parameters.maxTextureSize;for(M=0;4>M;++M)this.cascades.push(new z);this.snapshotCount=la}var ea=ma.prototype;ea.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null;this.discardDepthTexture();this.discardAllSnapshots()};ea.getDepthTexture=function(){return this.depthTexture};ea.getSnapshot=function(M){return this.snapshots[M]};ea.getCascades=function(){for(let M=0;M<this.numCascades;++M)X[M]=this.cascades[M];X.length=this.numCascades;return X};ea.prepare=function(M,Z,la){q.assert(this.enabled);
this.textureSize=this.computeTextureSize(M.fullWidth,M.fullHeight);this.assertDepthTexture();const {near:ka,far:ha}=this.clampNearFar(la);this.computeCascadeDistances(ha,ka);this.setupMatrices(M,Z);la=M.viewMatrix;M=M.projectionMatrix;for(let na=0;na<this.numCascades;++na)this.constructCascade(na,M,la,Z);this.lastOrigin=null;this.clear()};ea.finish=function(M){q.assert(this.enabled);this.rctx.bindFramebuffer(M)};ea.bind=function(M,Z=w.DefaultTextureUnits.SHADOW_MAP){const la=this.rctx;la.bindTexture(this.enabled?
this.depthTexture:this.emptyTexture,Z);la.bindProgram(M);M.setUniform1i("uShadowMapTex",Z);this.setUniforms(M)};ea.bindToAllPrograms=function(M){M=M.getProgramsUsingUniform("uShadowMapDistance");for(let Z=0;Z<M.length;Z++)this.bind(M[Z],w.DefaultTextureUnits.SHADOW_MAP)};ea.bindView=function(M,Z){if(this.enabled){var la=this.lastOrigin;if(!la||la[0]!==Z[0]||la[1]!==Z[1]||la[2]!==Z[2])for(this.lastOrigin=this.lastOrigin||b.create(),p.copy(this.lastOrigin,Z),la=0;la<this.numCascades;++la){f.translate(aa,
this.cascades[la].lightMat,Z);for(let ka=0;16>ka;++ka)S[16*la+ka]=aa[ka]}M.setUniformMatrix4fv("uShadowMapMatrix",S)}};ea.setUniforms=function(M){this.rctx.bindProgram(M);M.setUniform1f("uDepthHalfPixelSz",this.enabled?.5/this.textureSize:-1);M.setUniform1i("uShadowMapNum",this.numCascades);M.setUniform4f("uShadowMapDistance",this.cascadeDistances[0],1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:
Infinity)};ea.bindSnapshot=function(M,Z){this.rctx.bindTexture(this.enabled?this.snapshots[M]:this.emptyTexture,Z)};ea.takeCascadeSnapshotTo=function(M,Z){q.assert(this.enabled);const la=this.rctx;this.assertSnapshot(Z);this.bindFbo();la.bindTexture(this.snapshots[Z],w.DefaultTextureUnits.SHADOW_MAP);la.gl.copyTexSubImage2D(3553,0,M.camera.viewport[0],M.camera.viewport[1],M.camera.viewport[0],M.camera.viewport[1],M.camera.viewport[2],M.camera.viewport[3]);la.bindTexture(null,w.DefaultTextureUnits.SHADOW_MAP)};
ea.clear=function(){const M=this.rctx;this.bindFbo();M.setClearColor(1,1,1,1);M.clearSafe(16640)};ea.computeTextureSize=function(M,Z){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(M*M+Z*Z)*Math.LOG2E+.35))};ea.assertDepthTexture=function(){if(null==this.depthTexture||this.depthTexture.descriptor.width!==this.textureSize)this.discardDepthTexture(),this.depthTexture=new u(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,
height:this.textureSize}),this.fbo=new y(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this.depthTexture)};ea.assertSnapshot=function(M){const Z=this.snapshots[M];if(null===Z||Z.descriptor.width!==this.textureSize)this.discardSnapshot(M),this.snapshots[M]=new u(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize})};ea.discardDepthTexture=function(){this.fbo&&
(this.fbo.dispose(),this.fbo=null);this.depthTexture&&(this.depthTexture.dispose(),this.depthTexture=null)};ea.discardSnapshot=function(M){this.snapshots[M]&&(this.snapshots[M].dispose(),this.snapshots[M]=null)};ea.discardAllSnapshots=function(){for(let M=0;M<this.snapshotCount;++M)this.discardSnapshot(M)};ea.bindFbo=function(){const M=this.rctx;M.bindFramebuffer(this.fbo);M.bindTexture(null,w.DefaultTextureUnits.SHADOW_MAP)};ea.constructCascade=function(M,Z,la,ka){const ha=this.cascades[M];var na=
-this.cascadeDistances[M],da=-this.cascadeDistances[M+1];na=(Z[10]*na+Z[14])/Math.abs(Z[11]*na+Z[15]);Z=(Z[10]*da+Z[14])/Math.abs(Z[11]*da+Z[15]);q.assert(na<Z);for(da=0;8>da;++da){n.set(m,0===da%4||3===da%4?-1:1,0===da%4||1===da%4?-1:1,4>da?na:Z,1);n.transformMat4(B[da],m,x);for(let oa=0;3>oa;++oa)B[da][oa]/=B[da][3]}p.negate(Q,B[0]);f.translate(C,P,Q);ha.camera.viewMatrix=C;for(na=0;8>na;++na)p.transformMat4(B[na],B[na],ha.camera.viewMatrix);p.copy(E,B[0]);p.copy(F,B[0]);for(na=1;8>na;++na)for(Z=
0;3>Z;++Z)E[Z]=Math.min(E[Z],B[na][Z]),F[Z]=Math.max(F[Z],B[na][Z]);E[2]-=200;F[2]+=200;ha.camera.near=-F[2];ha.camera.far=-E[2];this.warp?this.constructTrapezoidalProjection(la,ka,ha):this.constructOrthogonalProjection(ha);f.multiply(ha.lightMat,ha.camera.projectionMatrix,ha.camera.viewMatrix);la=this.textureSize/2;ha.camera.viewport[0]=0===M%2?0:la;ha.camera.viewport[1]=0===Math.floor(M/2)?0:la;ha.camera.viewport[2]=la;ha.camera.viewport[3]=la};ea.constructOrthogonalProjection=function(M){f.ortho(M.camera.projectionMatrix,
E[0],F[0],E[1],F[1],M.camera.near,M.camera.far)};ea.constructTrapezoidalProjection=function(M,Z,la){var ka=1/B[0][3],ha=1/B[4][3];q.assert(ka<ha);ka+=Math.sqrt(ka*ha);var na=Math.sin(g.acosClamped(M[2]*Z[0]+M[6]*Z[1]+M[10]*Z[2]));M=B;var da=ka/na;Z=G;var oa=I,qa=K;ha=J;ka=L;h.set(H,0,0);for(var ua=0;4>ua;++ua)h.add(H,H,M[ua]);h.scale(H,H,.25);h.set(R,0,0);for(ua=4;8>ua;++ua)h.add(R,R,M[ua]);h.scale(R,R,.25);h.lerp(T[0],M[4],M[5],.5);h.lerp(T[1],M[5],M[6],.5);h.lerp(T[2],M[6],M[7],.5);h.lerp(T[3],
M[7],M[4],.5);ua=0;var Ca=h.squaredDistance(T[0],H);for(var Ja=1;4>Ja;++Ja){var Ha=h.squaredDistance(T[Ja],H);Ha<Ca&&(Ca=Ha,ua=Ja)}h.subtract(W,T[ua],M[ua+4]);ua=W[0];W[0]=-W[1];W[1]=ua;h.subtract(Y,R,H);0>h.dot(Y,W)&&h.negate(W,W);h.lerp(W,W,Y,na);h.normalize(W,W);na=ua=h.dot(h.subtract(U,M[0],H),W);for(Ca=1;8>Ca;++Ca)Ja=h.dot(h.subtract(U,M[Ca],H),W),Ja<na?na=Ja:Ja>ua&&(ua=Ja);h.copy(Z,H);h.scale(U,W,na-da);h.add(Z,Z,U);Ja=-1;Ha=1;da=Ca=0;for(let Na=0;8>Na;++Na){h.subtract(N,M[Na],Z);h.normalize(N,
N);const Oa=W[0]*N[1]-W[1]*N[0];0<Oa?Oa>Ja&&(Ja=Oa,Ca=Na):Oa<Ha&&(Ha=Oa,da=Na)}q.verify(0<Ja,"leftArea");q.verify(0>Ha,"rightArea");h.scale(ca,W,na);h.add(ca,ca,H);h.scale(O,W,ua);h.add(O,O,H);V[0]=-W[1];V[1]=W[0];oa=q.rayRay2D(Z,M[da],O,h.add(U,O,V),1,oa);qa=q.rayRay2D(Z,M[Ca],O,U,1,qa);ha=q.rayRay2D(Z,M[Ca],ca,h.add(U,ca,V),1,ha);M=q.rayRay2D(Z,M[da],ca,U,1,ka);q.verify(oa,"rayRay");q.verify(qa,"rayRay");q.verify(ha,"rayRay");q.verify(M,"rayRay");qa=G;M=I;Z=J;ha=L;ka=la.camera.projectionMatrix;
h.subtract(fa,Z,ha);h.scale(fa,fa,.5);ia[0]=fa[0];ia[1]=fa[1];ia[2]=0;ia[3]=fa[1];ia[4]=-fa[0];ia[5]=0;ia[6]=fa[0]*fa[0]+fa[1]*fa[1];ia[7]=fa[0]*fa[1]-fa[1]*fa[0];ia[8]=1;ia[6]=-h.dot(D(ia,0),qa);ia[7]=-h.dot(D(ia,1),qa);qa=h.dot(D(ia,0),Z)+ia[6];oa=h.dot(D(ia,1),Z)+ia[7];da=h.dot(D(ia,0),ha)+ia[6];ha=h.dot(D(ia,1),ha)+ia[7];qa=-(qa+da)/(oa+ha);ia[0]+=ia[1]*qa;ia[3]+=ia[4]*qa;ia[6]+=ia[7]*qa;qa=1/(h.dot(D(ia,0),Z)+ia[6]);oa=1/(h.dot(D(ia,1),Z)+ia[7]);ia[0]*=qa;ia[3]*=qa;ia[6]*=qa;ia[1]*=oa;ia[4]*=
oa;ia[7]*=oa;ia[2]=ia[1];ia[5]=ia[4];ia[8]=ia[7];ia[7]+=1;qa=h.dot(D(ia,1),M)+ia[7];oa=h.dot(D(ia,2),M)+ia[8];da=h.dot(D(ia,1),Z)+ia[7];ha=h.dot(D(ia,2),Z)+ia[8];qa=-.5*(qa/oa+da/ha);ia[1]+=ia[2]*qa;ia[4]+=ia[5]*qa;ia[7]+=ia[8]*qa;qa=h.dot(D(ia,1),M)+ia[7];oa=h.dot(D(ia,2),M)+ia[8];da=-oa/qa;ia[1]*=da;ia[4]*=da;ia[7]*=da;ka[0]=ia[0];ka[1]=ia[1];ka[2]=0;ka[3]=ia[2];ka[4]=ia[3];ka[5]=ia[4];ka[6]=0;ka[7]=ia[5];ka[8]=0;ka[9]=0;ka[10]=1;ka[11]=0;ka[12]=ia[6];ka[13]=ia[7];ka[14]=0;ka[15]=ia[8];la.camera.projectionMatrix[10]=
2/(E[2]-F[2]);la.camera.projectionMatrix[14]=-(E[2]+F[2])/(E[2]-F[2])};ea.setupMatrices=function(M,Z){f.multiply(A,M.projectionMatrix,M.viewMatrix);f.invert(x,A);M=1===this.viewingMode?M.eye:p.set(Q,0,0,1);f.lookAt(P,[0,0,0],[-Z[0],-Z[1],-Z[2]],M)};ea.clampNearFar=function(M){let {near:Z,far:la}=M;2>Z&&(Z=2);2>la&&(la=2);Z>=la&&(Z=2,la=4);return{near:Z,far:la}};ea.computeCascadeDistances=function(M,Z){this.numCascades=Math.min(1+Math.floor(q.logWithBase(M/Z,4)),this.maxNumCascades);const la=(M-Z)/
this.numCascades;M=(M/Z)**(1/this.numCascades);let ka=Z;for(let ha=0;ha<this.numCascades+1;++ha)this.cascadeDistances[ha]=g.lerp(ka,Z,this.splitSchemeLambda),ka*=M,Z+=la};ea.getGpuMemoryUsage=function(){return this.snapshots.reduce((M,Z)=>M+v.getGpuMemoryUsage(Z),v.getGpuMemoryUsage(this.fbo))};a._createClass(ma,[{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(M){this.maxNumCascades=g.clamp(Math.floor(M),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(M){this._enabled=
M;M||(this.discardDepthTexture(),this.discardAllSnapshots())}},{key:"snapshotCount",get:function(){return this.snapshots.length},set:function(M){var Z=this.snapshots.length;if(M>Z){var la=M-Z;this.snapshots.length=M;for(M=0;M<la;++M)this.snapshots[Z+M]=null}else if(M<this.snapshotCount){Z-=M;for(la=0;la<Z;++la)this.discardSnapshot(M+la);this.snapshots.length=M}}},{key:"test",get:function(){const M=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,set splitSchemeLambda(Z){M.splitSchemeLambda=
Z},get splitSchemeLambda(){return M.splitSchemeLambda},set warp(Z){M.warp=Z},get warp(){return M.warp}}}}]);return ma}();const C=c.create(),A=c.create(),x=c.create(),m=e.create(),B=[];for(let ma=0;8>ma;++ma)B.push(e.create());const E=b.create(),F=b.create(),G=d.create(),I=d.create(),K=d.create(),J=d.create(),L=d.create(),P=c.create(),Q=b.create(),X=[],aa=c.create(),S=new Float32Array(64),H=d.create(),R=d.create(),T=[d.create(),d.create(),d.create(),d.create()],W=d.create(),Y=d.create(),U=d.create(),
N=d.create(),ca=d.create(),O=d.create(),V=d.create(),ba=d.create(),fa=d.create(),ia=k.create();return r})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../support/geometryUtils"],function(a,g){const b=g.boundedPlane.create();return function(){function p(){this._worldPlane=b}a._createClass(p,[{key:"isEnabled",get:function(){return this.plane!==b}},{key:"plane",get:function(){return this._worldPlane},set:function(f){this._worldPlane=
f?f:b}}]);return p}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../support/requestImageUtils ../../../webgl/Program ../../../webgl/renderState ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/FramebufferObject".split(" "),function(a,g,b,p,f,k,c,d,e){return function(){function h(q){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=q}var n=h.prototype;n.loadResources=function(q){if(!this.data||!this.textureArea||!this.textureSearch){const u=this.resourceLoadingPromise||this.loadDataModule().then(()=>this.loadTextures());q&&u.then(q);this.resourceLoadingPromise||(this.resourceLoadingPromise=u,u.then(()=>this.resourceLoadingPromise=null));return!1}return!0};n.loadDataModule=function(){return this.data?Promise.resolve():
(new Promise(function(q,u){a(["./SmaaRenderPassData"],q,u)})).then(q=>{this.data=q})};n.loadTextures=function(){return Promise.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(([q,u])=>{this.textureArea=q;this.textureSearch=u})};n.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;const q=this.rctx;this.programEdgeDetect=new p(q,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,
this.vertexAttributeLocations);this.programBlendWeights=new p(q,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new p(q,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=f.makePipelineState({colorWrite:f.defaultColorWriteParams});const u=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new d(q,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:k.createVertex(q,
35044,u)});this.tmpFramebufferEdges=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};n.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),
this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};n.render=function(q){this.enable();const u=this.rctx,v=u.getBoundFramebufferObject();var t=q.colorTexture.descriptor.width,l=q.colorTexture.descriptor.height;
u.bindVAO(this.vao);u.setPipelineState(this.pipelineState);u.setViewport(0,0,t,l);this.tmpFramebufferEdges.resize(t,l);u.bindFramebuffer(this.tmpFramebufferEdges);u.setClearColor(0,0,0,1);u.clear(16384);u.bindProgram(this.programEdgeDetect);u.bindTexture(q.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/t,1/l,t,l);u.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(t,l);u.bindFramebuffer(this.tmpFramebufferBlend);u.setClearColor(0,
0,1,1);u.clear(16384);u.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/t,1/l,t,l);u.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);u.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);u.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);u.drawArrays(4,0,3);u.bindFramebuffer(v);u.setClearColor(0,1,0,1);u.clear(16384);u.bindProgram(this.programBlur);
this.programBlur.setUniform4f("uResolution",1/t,1/l,t,l);u.bindTexture(q.colorTexture,0);this.programBlur.setUniform1i("tColor",0);u.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);u.drawArrays(4,0,3)};n.loadTextureFromBase64=function(q,u,v){const t=new c(this.rctx,{pixelFormat:v,dataType:5121,wrapMode:33071,samplingMode:u},null);return b.requestImage(q).then(l=>{t.resize(l.width,l.height);t.setData(l);return t})};g._createClass(h,[{key:"isLoadingResources",
get:function(){return null!=this.resourceLoadingPromise}}]);return h}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../chunks/vec3 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../support/requestImageUtils ./Util ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ./DefaultTextureUnits ../../../webgl/FramebufferObject ./SSAOTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=p.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");p=function(){function z(C,A,x){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=c.create();this.quadVAO=null;this._rctx=A;this._techniqueRep=C;this._requestRender=x;this._ssaoTechniqueConfig=new l.SSAOTechniqueConfiguration;this._emptyTexture=u.createColorTexture(A,[1,1,1,1])}var r=z.prototype;r.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null;b.isSome(this.quadVAO)&&(this.quadVAO=b.disposeMaybe(this.quadVAO))};r.computeSSAO=function(C,A,x){if(this._noiseTexture){h.assert(this.enabled);var m=this._rctx,B=C.fullViewport,E=B[2],F=B[3];B=E/this._BLUR_F;var G=F/this._BLUR_F;this._ssaoFBO.resize(E,F);this._blur0FBO.resize(B,G);this._blur1FBO.resize(B,G);B=1*E;G=1*F;m.bindFramebuffer(this._ssaoFBO);d.copy(this._viewportToRestore,C.fullViewport);m.setViewport(0,0,E,F);var I=this._ssaoTechnique.program,K=this._blurTechnique.program;
m.bindProgram(I);m.setPipelineState(this._ssaoTechnique.pipeline);I.setUniform2f("rnmScale",E/this._noiseTexture.descriptor.width,F/this._noiseTexture.descriptor.height);I.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);E=this._data.minDiscrepancy;I.setUniform1f("numSpiralTurns",this._samples<E.length?E[this._samples]:5779);E=D;F=y;h.inverseProjectionInfo(C.projectionMatrix,C.fullWidth,C.fullHeight,
E,F);I.setUniform4fv("projInfo",E);I.setUniform2fv("zScale",F);I.setUniform2f("nearFar",C.near,C.far);E=1/C.computeRenderPixelSizeAtDist(1);I.setUniform1f("projScale",1*E);I.setUniform2f("screenDimensions",B,G);var J=2*this._radius;F=f.distance(C.eye,C.center);J=20*C.computeRenderPixelSizeAtDist(F);J=Math.max(.1,J);I.setUniform1f("radius",J);I.setUniform1f("intensity",4*this._attenuation/J**6);I.setUniform1i("rnm",0);I.setUniform1i("normalMap",1);I.setUniform1i("depthMap",2);m.bindTexture(this._noiseTexture,
0);m.bindTexture(x,1);m.bindTexture(A,2);b.isSome(this.quadVAO)||(this.quadVAO=u.createQuadVAO(this._rctx));A=this.quadVAO;m.bindVAO(A);m.drawArrays(5,0,q.vertexCount(A,"geometry"));m.bindTexture(this._ssaoFBO.colorTexture,0);m.setViewport(0,0,B/this._BLUR_F,G/this._BLUR_F);m.bindFramebuffer(this._blur0FBO);m.bindProgram(K);K.setUniform2f("screenDimensions",B,G);K.setUniform1i("tex",0);K.setUniform1i("normalMap",1);K.setUniform1i("depthMap",2);K.setUniform2f("blurSize",0,1*this._BLUR_F/G);K.setUniform1i("radius",
4);K.setUniform1f("g_BlurFalloff",.08);K.setUniform2f("nearFar",C.near,C.far);5E4<F&&(E=Math.max(0,E-(F-5E4)));K.setUniform1f("projScale",E);K.setUniform2f("zScale",1,0);m.drawArrays(5,0,q.vertexCount(A,"geometry"));K.setUniform2f("blurSize",1*this._BLUR_F/B,0);m.bindFramebuffer(this._blur1FBO);m.bindTexture(this._blur0FBO.colorTexture,0);m.drawArrays(5,0,q.vertexCount(A,"geometry"));m.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};
r.setUniforms=function(C,A){const x=this.enabled&&this._noiseTexture,m=this._rctx;m.bindTexture(x?this._blur1FBO.colorTexture:this._emptyTexture,A);m.setActiveTexture(0);C.setUniform1i("ssaoTex",A);x?C.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):C.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};r.bindToAllPrograms=function(C){C=C.getProgramsUsingUniform("viewportPixelSz");for(const A of C)this.setUniforms(A,v.DefaultTextureUnits.SSAO)};
r.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(l.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(l.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};r.enable=function(){this.enabled||
(this.isSupported?(this._enabled=!0,this.loadResources(()=>{this._enabled&&this.initialize()})):w.warn("SSAO is not supported for this browser or hardware"))};r.loadResources=function(C){this._data?C():(new Promise(function(A,x){a(["./SSAOHelperData"],A,x)})).then(A=>{this._data=A;C()})};r.initialize=function(){const C={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},A={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new t(this._rctx,A,C);this._blur0FBO=
new t(this._rctx,A,C);this._blur1FBO=new t(this._rctx,A,C);e.requestImage(this._data.noiseTexture).then(x=>{this._enabled&&(this._noiseTexture=new n(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:x.width,height:x.height},x),this._requestRender())});this.selectPrograms()};r.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&
(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};r.getGpuMemoryUsage=function(){return q.getGpuMemoryUsage(this._blur0FBO)+q.getGpuMemoryUsage(this._blur1FBO)+q.getGpuMemoryUsage(this._ssaoFBO)};g._createClass(z,[{key:"isSupported",get:function(){var C=this._rctx;const A=-1!==C.parameters.versionString.indexOf("WebGL 0.93");C=-1!==C.parameters.versionString.indexOf("WebGL 0.94");return!(A||C)}},{key:"enabled",get:function(){return this._enabled},
set:function(C){C?this.enable():this.disable()}},{key:"attenuation",get:function(){return this._attenuation},set:function(C){this._attenuation=C}},{key:"radius",get:function(){return this._radius},set:function(C){this._radius=C}},{key:"filterRadius",get:function(){return 4}},{key:"samples",get:function(){return this._samples},set:function(C){this._samples=C;this._enabled&&this.selectPrograms()}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return z}();const y=k.create(),
D=c.create();return p})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/SSAO.glsl".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){k=function(q){function u(){return q.apply(this,
arguments)||this}b._inheritsLoose(u,q);var v=u.prototype;v.initializeProgram=function(t){var l=u.shader.get();const w=this.configuration;l=l.build({output:w.output,samples:w.samples,radius:w.radius});return new e(t.rctx,l.generateSource("vertex"),l.generateSource("fragment"),d.Default3D)};v.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return u}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(n.SSAOShader,()=>new Promise(function(q,u){a(["../shaders/SSAO.glsl"],
q,u)}));f=function(q){function u(){var v=q.apply(this,arguments)||this;v.output=0;v.samples=64;v.radius=4;return v}b._inheritsLoose(u,q);return u}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:2})],f.prototype,"output",void 0);p.__decorate([c.parameter()],f.prototype,"samples",void 0);p.__decorate([c.parameter()],f.prototype,"radius",void 0);g.SSAOTechnique=k;g.SSAOTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl".split(" "),
function(a,g,b,p,f,k){function c(e){const h=new b.ShaderBuilder;h.include(f.ScreenSpacePass);1===e.output&&(h.fragment.include(p.ReadLinearDepth),h.fragment.code.add(g.glsl`
      #ifndef RADIUS
        #define RADIUS `+e.radius+"\n      #endif\n    "),h.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),h.fragment.code.add(g.glsl`
      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);

        w_total += w;

        return w*c;
      }

      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);
        for (int r = -RADIUS; r <= RADIUS; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf*blurSize;
          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);
        }

        gl_FragColor = vec4(b/w_total);
      }
    `));0===e.output&&(h.fragment.include(p.ReadLinearDepth),h.include(k.CameraSpace),h.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),h.fragment.code.add(g.glsl`
      #ifndef SAMPLES
        #define SAMPLES `+e.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),h.fragment.code.add(g.glsl`
      float fallOffFunction(float vv, float vn, float bias) {
        float radius2 = radius * radius;

        // A: From the HPG12 paper
        // Note large epsilon to avoid overdarkening within cracks
        // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;

        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]
        float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);

        // C: Medium contrast (which looks better at high radii), no division.  Note that the
        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is
        // more computationally efficient and happens to be aesthetically pleasing.
        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);

        // D: Low contrast, no division operation
        // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);
      }
    `),h.fragment.code.add(g.glsl`
      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
        vec3 v = Q - C;
        float vv = dot(v, v);
        float vn = dot(normalize(v), n_C);
        return fallOffFunction(vv, vn, 0.1);
      }
    `),h.fragment.code.add(g.glsl`
      void main(void) {
        //Hash function used in the HPG12 AlchemyAO paper
        //Not supported in WebGL -> using texture lookup as in old SSAO shader instead
        //ivec2 ssC = ivec2(gl_FragCoord.xy);
        //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));

        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;

        vec4 occluderFragment;
        vec3 ray;

        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);

        for(int i = 0; i < SAMPLES; ++i) {
          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it
          //float ssR;
          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);
          // get the depth of the occluder fragment
          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);

          vec2 unitOffset = reflect(pSphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset*radius*ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result

        float A = max(1.0-sum*intensity/float(SAMPLES),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther
        // (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);
        //gl_FragColor = vec4(-currentPixelDepth/1000.0);
        //gl_FragColor = vec4(tapPixelPos.x/100.0);
        gl_FragColor = vec4(A);
      }
    `));return h}var d=Object.freeze({__proto__:null,build:c});a.SSAOShader=d;a.build=c})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/typedArrayUtil ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/Accessor ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4 ../../../../support/WatchUpdatingTracking ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/mat3 ../../../../../chunks/sphere ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject ../Object3D ../GridLocalOriginFactory ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../chunks/vec33 ../../core/util/TwoVectorPosition ../TextureBackedBuffer/BufferManager ../localOriginHelper ../LocalOriginManager ./bufferLayouts ./edgeBufferWriters ./EdgeRenderer ./EdgeWorkerHandle ./strokes ./util".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W){function Y(N){let ca=null,O=null;for(let V=0;V<N.geometries.length;V++){const ba=N.geometryRecords[V];if(ba.material.supportsEdges){if(!ca)ca=ba.transformation;else if(!t.equals(ca,ba.transformation))return!1;if(!O&&ba.origin)O=ba;else if(O&&ba.origin&&O.origin.id!==ba.origin.id)return!1}}return!0}a.EdgeView=function(N){function ca(V){V=N.call(this,V)||this;V.updatingHandles=new C.WatchUpdatingTracking;
V.perObjectData=new Map;V.renderers=new Map;V.localOrigins=new X.LocalOriginManager(new I);V.numberOfRenderedEdges=0;V.gpuMemoryUsage=0;V.workerAbort=l.createAbortController();V.tmpModelPosition=D.create();V.tmpCameraPosition=D.create();return V}g._inheritsLoose(ca,N);var O=ca.prototype;O.initialize=function(){this.worker=new R(this.scheduler);this.componentColorManager=new P.BufferManager(this.rctx,2);const V=aa.VertexLayout.createBuffer(4);for(let ba=0;4>ba;ba++)V.sideness.set(ba,0,0===ba||3===
ba?0:1),V.sideness.set(ba,1,0===ba||1===ba?0:1);this.verticesBufferObject=E.createVertex(this.rctx,35044,V.buffer)};O.destroy=function(){this.destroyed||(this.perObjectData.forEach((V,ba)=>{this.perObjectData.delete(ba);V.renderables.forEach(fa=>{this.removeRenderable(fa)})}),this.strokesTexture=k.disposeMaybe(this.strokesTexture),this.componentColorManager=k.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=k.disposeMaybe(this.verticesBufferObject),
this.perObjectData.clear(),this.renderers.clear(),this.updatingHandles.destroy())};O.shouldRender=function(){return 0<this.renderers.size};O.addComponentObject=async function(V,ba,fa,ia,ma,ea,M,Z){if(!this.hasObject(V)){var la;fa=new U(new Promise(ka=>la=ka),fa);this.perObjectData.set(V,fa);await this.updatingHandles.addPromise(this.addComponentGeometry(ba,fa,ia,ma,ea,M,Z));this.setNeedsRender();la()}};O.addOrUpdateObject3D=async function(V,ba,fa,ia){const ma=[];let ea;const M=new U(new Promise(la=>
ea=la)),Z=this.perObjectData.get(V);this.perObjectData.set(V,M);if(fa.mergeGeometries&&1<V.geometries.length&&Y(V))ma.push(this.addObjectMergedGeometries(V,M,ba,fa,ia));else for(let la=0;la<V.geometries.length;la++){const ka=V.geometryRecords[la];ka.material.supportsEdges&&ma.push(this.addGeometry(V,M,V.geometries[la],ka,ba[0],fa,ia))}await this.updatingHandles.addPromise(Promise.all(ma));Z&&Z.waitLoaded(()=>{Z.renderables.forEach(la=>this.removeRenderable(la));this.setNeedsRender()},this.updatingHandles);
this.setNeedsRender();ea()};O.hasObject=function(V){return this.perObjectData.has(V)};O.updateAllComponentOpacities=async function(V,ba){const fa=ba instanceof Array?ia=>ba[ia]:()=>ba;(await this.updatingHandles.addPromise(this.getObjectEntry(V))).renderables.forEach(ia=>{const ma=ia.components.meta.length;for(let ea=0;ea<ma;ea++){const M=fa(ea),Z=ia.components.meta[ea],la=Z.index;Z.material.opacity=M;ia.components.buffer.textureBuffer.setDataElement(la,1,3,255*M)}this.updateTransparency(ia)});this.setNeedsRender()};
O.updateAllComponentMaterials=async function(V,ba,fa,ia){const ma=V instanceof G.Object3D,ea=!!fa.slicePlaneEnabled,M=W.determineRendererType(ba),Z=H.EdgeRenderer.getKey(M,ea,ma);(await this.updatingHandles.addPromise(this.getObjectEntry(V))).renderables.forEach(la=>{if(Z!==la.rendererKey){var ka=this.renderers.get(la.rendererKey);const ha=this.acquireRenderer(M,ea,ma);ka.removeRenderable(la);ka.refCount.decrement();la.rendererKey=Z;ha.addRenderable(la)}for(ka=0;ka<ba.length;ka++)la.components.meta[ka].material=
ba[ka];ia&&this.updateComponentBuffer(la.components);this.updateTransparency(la)});this.setNeedsRender()};O.updateObjectVisibility=async function(V,ba){(await this.updatingHandles.addPromise(this.getObjectEntry(V))).renderables.forEach(fa=>fa.visible=ba);this.setNeedsRender()};O.removeObject=function(V){const ba=this.perObjectData.get(V);ba&&(this.perObjectData.delete(V),ba.waitLoaded(()=>{ba.renderables.forEach(fa=>this.removeRenderable(fa));this.setNeedsRender()},this.updatingHandles))};O.getObjectEntry=
async function(V){V=this.perObjectData.get(V);if(!V)throw"no object";await V.loaded;return V};O.removeAll=function(){this.perObjectData.forEach((V,ba)=>this.removeObject(ba))};O.render=function(V,ba){if(!k.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(V.camera.viewMatrix);var fa=V.camera.viewInverseTransposeMatrix,ia=D.create(),ma=new L.TwoVectorPosition,ea=new K.VertexPosition.ViewProjectionTransform,M=A.create();z.set(ia,fa[3],fa[7],fa[11]);ma.set(ia);z.copy(ea.worldFromView_TH,
ma.high);z.copy(ea.worldFromView_TL,ma.low);m.fromMat4(ea.viewFromCameraRelative_RS,V.camera.viewMatrix);r.copy(ea.projFromView,V.camera.projectionMatrix);fa=A.create();m.transpose(fa,ea.viewFromCameraRelative_RS);m.invert(M,fa);this.renderers.forEach(ha=>{0===ha.refCount.value&&(this.renderers.delete(ha.key),ha.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var Z=0,la=0;this.renderers.forEach(ha=>ha.forEachRenderable(na=>{Z+=na.statistics.averageEdgeLength;
la++},ba));if(0!==la){fa=40*Z/la;ia=W.estimateLengthAtDistance(V.camera.fullViewport[3],V.camera.fovY,1,3.5*V.camera.pixelRatio);var ka={distanceFalloffFactor:fa,minimumEdgeLength:ia,transparency:ba,viewProjectionTransform:ea,transformNormal_ViewFromGlobal:M};this.updateObjectCameraDistances(V);this.numberOfRenderedEdges=0;this.renderers.forEach(ha=>{this.renderRegularEdges(ha,V,ka);this.renderSilhouetteEdges(ha,V,ka)})}}};O.updateTransparency=function(V){const ba=W.determineEdgeTransparency(V.components.meta),
fa=W.determineObjectTransparency(V.components.meta);if(ba!==V.edgeTransparency||fa!==V.objectTransparency)V.edgeTransparency=ba,V.objectTransparency=fa,this.renderers.get(V.rendererKey).setRenderablesDirty()};O.computeModelTransformWithLocalOrigin=function(V,ba,fa){V.getCombinedStaticTransformation(ba,fa);ba.origin?this.localOrigins.register(ba.origin):(V=z.set(this.tmpModelPosition,fa[12],fa[13],fa[14]),ba.origin=this.localOrigins.acquire(V));Q.applyToModelMatrix(ba.origin.vec3,fa);return fa};O.updateComponentBuffer=
function(V){const {meta:ba,buffer:fa}=V;for(V=0;V<ba.length;V++){var ia=ba[V].material;const ma=ba[V].index,ea=y.clamp(Math.round(ia.size*H.LINE_WIDTH_FRACTION_FACTOR),0,255),M=y.clamp(ia.extensionLength,-H.EXTENSION_LENGTH_OFFSET,255-H.EXTENSION_LENGTH_OFFSET)+H.EXTENSION_LENGTH_OFFSET,Z="solid"===ia.type?0:1,la=255*ia.opacity;ia=ia.color;fa.textureBuffer.setData(ma,0,255*ia[0],255*ia[1],255*ia[2],255*ia[3]);fa.textureBuffer.setData(ma,1,ea,M,Z,la)}};O.createComponentBuffers=function(V){if(k.isNone(this.componentColorManager))return null;
const ba=[],fa=this.componentColorManager.getBuffer(V.length);for(let ia=0;ia<V.length;ia++){const ma=V[ia],ea=fa.acquireIndex();ba.push({index:ea,material:ma})}V={meta:ba,buffer:fa};this.updateComponentBuffer(V);return V};O.extractEdges=function(V,ba,fa,ia,ma,ea=ma.length){return this.worker.process({data:ba,indices:ma,indicesLength:ea,writerSettings:V,skipDeduplicate:fa},this.workerAbort.signal,ia)};O.createEdgeResources=function(V){const ba={};if(k.isNone(this.verticesBufferObject))return ba;if(0<
V.regular.lodInfo.lengths.length){var fa=new F(this.rctx,aa.EdgeShaderAttributeLocations,{vertices:aa.glVertexLayout,instances:S.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,V.regular.instancesData.buffer)});ba.regular={vao:fa,lod:V.regular.lodInfo}}0<V.silhouette.lodInfo.lengths.length&&(fa=new F(this.rctx,aa.EdgeShaderAttributeLocations,{vertices:aa.glVertexLayout,instances:S.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,
instances:E.createVertex(this.rctx,35044,V.silhouette.instancesData.buffer)}),ba.silhouette={vao:fa,lod:V.silhouette.lodInfo});return ba};O.addGeometry=async function(V,ba,fa,ia,ma,ea,M){const Z=fa.vertexAttributes.get("position"),la=fa.indices.get("position");V=this.computeModelTransformWithLocalOrigin(V,ia,x.create());return this.addPositionData(ba,{position:Z,indices:la,modelTransform:V,origin:ia.origin},fa.edgeIndicesLength,ma,ea,M)};O.addPositionData=async function(V,ba,fa,ia,ma,ea=!1){var M=
this.createComponentBuffers([ia]);if(!(k.isNone(M)||0>=fa)){ia=this.acquireRenderer(ia.type,!!ma.slicePlaneEnabled);var {modelTransform:Z,origin:la}=ba;ma=ba.indices;ba=ba.position;var ka=ba.data.length/ba.size,ha=aa.EdgeInputBufferLayout.createBuffer(ka);for(let oa=0;oa<ka;oa++)ha.position.set(oa,0,ba.data[oa*ba.size]),ha.position.set(oa,1,ba.data[oa*ba.size+1]),ha.position.set(oa,2,ba.data[oa*ba.size+2]);W.fillComponenBufferIndices(M.meta,[0,ha.componentIndex.count],ha.componentIndex);ea=await this.updatingHandles.addPromise(this.extractEdges(ia.writerSettings,
ha,!1,ea,ma,fa));var {regular:na,silhouette:da}=this.createEdgeResources(ea);fa=(na?na.vao.size:0)+(da?da.vao.size:0);M={regular:na,silhouette:da,transform:{modelMatrix:Z,origin:la},statistics:{gpuMemoryUsage:fa,averageEdgeLength:ea.averageEdgeLength},components:M,visible:!0,edgeTransparency:W.determineEdgeTransparency(M.meta),objectTransparency:W.determineObjectTransparency(M.meta),distanceToCamera:0,rendererKey:ia.key};V.renderables.push(M);ia.addRenderable(M);this.gpuMemoryUsage+=fa}};O.addComponentGeometry=
async function(V,ba,fa,ia,ma,ea,M){const Z=this.createComponentBuffers(ea);if(!k.isNone(Z)){ea=W.determineRendererType(ea);M=this.acquireRenderer(ea,M.slicePlaneEnabled||!1,!1);ea=aa.EdgeInputBufferLayout.createBuffer(fa.count);J.copy(ea.position,fa);W.fillComponenBufferIndices(Z.meta,ma,ea.componentIndex,ia);ia=await this.updatingHandles.addPromise(this.extractEdges(M.writerSettings,ea,!0,!1,ia));var {regular:la,silhouette:ka}=this.createEdgeResources(ia);fa=(la?la.vao.size:0)+(ka?ka.vao.size:0);
V={regular:la,silhouette:ka,transform:V,statistics:{gpuMemoryUsage:fa,averageEdgeLength:ia.averageEdgeLength},components:Z,visible:!0,edgeTransparency:W.determineEdgeTransparency(Z.meta),objectTransparency:W.determineObjectTransparency(Z.meta),distanceToCamera:0,rendererKey:M.key};ba.renderables.push(V);M.addRenderable(V);this.gpuMemoryUsage+=fa}};O.addObjectMergedGeometries=async function(V,ba,fa,ia,ma){var ea=new Map,M=0,Z=null,la=null;for(var ka=0;ka<V.geometries.length;ka++){var ha=V.geometries[ka],
na=V.geometryRecords[ka];na.material.supportsEdges&&(!la&&na.origin&&(la=na),na=ha.indices.get("position"),M+=ha.edgeIndicesLength,null==Z||Z===Uint16Array)&&(Z=f.isUint16Array(na)?Uint16Array:Uint32Array)}M=M?new Z(M):null;Z=[];ka=0;for(ha=0;ha<V.geometries.length;ha++){na=V.geometries[ha];if(!V.geometryRecords[ha].material.supportsEdges)continue;var da=na.vertexAttributes.get("position");const oa=na.indices.get("position");let qa=ea.get(da.data);if(null==qa){qa=Z.length/3;for(let ua=0;ua<da.data.length;ua+=
da.size)Z.push(da.data[ua+0]),Z.push(da.data[ua+1]),Z.push(da.data[ua+2]);ea.set(da.data,qa)}if(oa)for(da=0;da<na.edgeIndicesLength;da++)M[ka++]=qa+oa[da]}la=la||V.geometryRecords[0];ea=this.computeModelTransformWithLocalOrigin(V,la,x.create());la=la.origin;for(ka=0;ka<V.geometryRecords.length;ka++)V.geometryRecords[ka].origin=la;await this.updatingHandles.addPromise(this.addPositionData(ba,{position:{data:Z,size:3},indices:M,modelTransform:ea,origin:la},M.length,fa[0],ia,ma))};O.acquireRenderer=
function(V,ba,fa=!0){const ia=H.EdgeRenderer.getKey(V,ba,fa);let ma=this.renderers.get(ia);k.isNone(this.strokesTexture)&&(this.strokesTexture=T.generateStrokesTexture(this.rctx));ma||(ma=new H.EdgeRenderer(this.rctx,this.techniqueRepository,{type:V,slicePlaneEnabled:ba,strokesTexture:this.strokesTexture,legacy:fa}),this.renderers.set(ia,ma));ma.refCount.increment();return ma};O.removeRenderable=function(V){const ba=this.renderers.get(V.rendererKey);if(ba){ba.removeRenderable(V);ba.refCount.decrement();
V.regular&&(V.regular.vao.vertexBuffers.instances.dispose(),V.regular.vao.dispose(!1),V.regular.vao=null);V.silhouette&&(V.silhouette.vao.vertexBuffers.instances.dispose(),V.silhouette.vao.dispose(!1),V.silhouette.vao=null);"origin"in V.transform&&this.localOrigins.release(V.transform.origin);this.gpuMemoryUsage-=V.statistics.gpuMemoryUsage;for(const fa of V.components.meta)V.components.buffer.releaseIndex(fa.index)}};O.updateObjectCameraDistances=function(V){V=V.camera.viewInverseTransposeMatrix;
z.set(this.tmpCameraPosition,V[3],V[7],V[11]);this.perObjectData.forEach((ba,fa)=>{fa=k.isSome(ba.center)?ba.center:B.getCenter(fa.getBounds());const ia=z.distance(fa,this.tmpCameraPosition);ba.renderables.forEach(ma=>ma.distanceToCamera=ia)})};O.renderRegularEdges=function(V,ba,fa){V.bindRegularEdges(ba,fa);V.forEachRenderable(ia=>{if(ia.visible&&ia.regular){var ma=W.computeEdgeCount(ia.regular.lod.lengths,ia.distanceToCamera,fa);"origin"in ia.transform&&(ba.localViewMatrixForEdges=this.localOrigins.getViewMatrix(ia.transform.origin));
V.renderRegularEdges(ia,ba,ma);this.numberOfRenderedEdges+=ma}},fa.transparency)};O.renderSilhouetteEdges=function(V,ba,fa){V.bindSilhouetteEdges(ba,fa);V.forEachRenderable(ia=>{if(ia.visible&&ia.silhouette){var ma=W.computeEdgeCount(ia.silhouette.lod.lengths,ia.distanceToCamera,fa);"origin"in ia.transform&&(ba.localViewMatrixForEdges=this.localOrigins.getViewMatrix(ia.transform.origin));V.renderSilhouetteEdges(ia,ba,ma);this.numberOfRenderedEdges+=ma}},fa.transparency)};g._createClass(ca,[{key:"updating",
get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges}}]);return ca}(w);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([e.property({constructOnly:!0})],
a.EdgeView.prototype,"scheduler",void 0);b.__decorate([e.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);b.__decorate([e.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([n.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);let U=function(){function N(ca,O=null){this.center=O;this.renderables=[];this.loaded=ca;this.loaded.then(()=>this.loaded=!0)}N.prototype.waitLoaded=function(ca,O){!0===this.loaded?ca():O.addPromise(this.loaded.then(()=>
ca()))};return N}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(g,b){const p=-g[0],f=-g[1];g=-g[2];const k=b[3],c=b[7],d=b[11],e=b[15];b[0]+=k*p;b[1]+=k*f;b[2]+=k*g;b[4]+=c*p;b[5]+=c*f;b[6]+=c*g;b[8]+=d*p;b[9]+=d*f;b[10]+=d*g;b[12]+=e*p;b[13]+=e*f;b[14]+=e*g};a.applyToViewMatrix=function(g,b){const p=g[0],f=g[1];g=g[2];b[12]+=p*b[0]+f*b[4]+g*b[8];b[13]+=p*b[1]+f*b[5]+
g*b[9];b[14]+=p*b[2]+f*b[6]+g*b[10];b[14]+=p*b[3]+f*b[7]+g*b[11]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,g,b,p){let f=function(){function k(d){this.factory=d;this.originData=new Map}var c=k.prototype;c.acquire=function(d){return this.register(this.factory.getOrigin(d))};c.register=function(d){const e=this.originData.get(d.id);
if(e)return e.refCount++,e.origin;this.originData.set(d.id,{refCount:1,viewMatrix:b.create(),origin:d});return d};c.release=function(d){const e=this.originData.get(d.id);e&&(e.refCount--,0===e.refCount&&this.originData.delete(d.id))};c.updateViewMatrices=function(d){this.originData.forEach(e=>{g.copy(e.viewMatrix,d);p.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};c.getViewMatrix=function(d){return this.originData.get(d.id).viewMatrix};return k}();a.LocalOriginManager=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(a,g,b){const p=b.newLayout().vec3f("position").u16("componentIndex").u16("u16padding"),f=b.newLayout().vec2u8("sideness");g=g.glLayout(f);b=b.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",
{glPadding:!0}).u16("u16padding",{glPadding:!0});const k=b.clone().vec3f("normal"),c=b.clone().vec3f("normalA").vec3f("normalB");a.CommonInstancesLayout=b;a.EdgeInputBufferLayout=p;a.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};a.RegularEdgeInstancesLayout=k;a.SilhouetteEdgeInstancesLayout=c;a.VertexLayout=f;a.glVertexLayout=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(a,g,b,p,f,k){function c(y){const D=n;D[0]=y.position0[0];D[1]=y.position0[1];D[2]=y.position0[2];D[3]=y.position1[0];D[4]=y.position1[1];D[5]=y.position1[2];u[0]=5381;for(y=0;y<q.length;y++)u[0]=31*u[0]+q[y];return u[0]}function d(y){const D=n;D[0]=e(y.position0[0]);D[1]=e(y.position0[1]);D[2]=e(y.position0[2]);D[3]=e(y.position1[0]);D[4]=e(y.position1[1]);D[5]=e(y.position1[2]);u[0]=5381;for(y=0;y<q.length;y++)u[0]=31*u[0]+q[y];return u[0]}function e(y){return Math.round(1E4*y)/1E4}let h=
function(){function y(){}var D=y.prototype;D.updateSettings=function(z){this.settings=z;this.edgeHashFunction=z.reducedPrecision?d:c};D.write=function(z,r,C){var A=this.edgeHashFunction(C);w.seed=A;A=w.getIntRange(0,255);const x=w.getIntRange(0,this.settings.variants-1);var m=w.getFloat();m=-(1-Math.min(m/.7,1))+Math.max(0,m-.7)/(1-.7);m=255*(Math.abs(m)**1.2*(0>m?-1:1)*.5+.5);z.position0.setVec(r,C.position0);z.position1.setVec(r,C.position1);z.componentIndex.set(r,C.componentIndex);z.variantOffset.set(r,
A);z.variantStroke.set(r,x);z.variantExtension.set(r,m)};D.trim=function(z,r){return z.slice(0,r)};return y}();const n=new Float32Array(6),q=new Uint32Array(n.buffer),u=new Uint32Array(1);let v=function(){function y(){this.commonWriter=new h}var D=y.prototype;D.updateSettings=function(z){this.commonWriter.updateSettings(z)};D.allocate=function(z){return k.RegularEdgeInstancesLayout.createBuffer(z)};D.write=function(z,r,C){this.commonWriter.write(z,r,C);p.add(l,C.faceNormal0,C.faceNormal1);p.normalize(l,
l);z.normal.setVec(r,l)};D.trim=function(z,r){return this.commonWriter.trim(z,r)};return y}();v.Layout=k.RegularEdgeInstancesLayout;v.glLayout=f.glLayout(k.RegularEdgeInstancesLayout,{divisor:1});let t=function(){function y(){this.commonWriter=new h}var D=y.prototype;D.updateSettings=function(z){this.commonWriter.updateSettings(z)};D.allocate=function(z){return k.SilhouetteEdgeInstancesLayout.createBuffer(z)};D.write=function(z,r,C){this.commonWriter.write(z,r,C);z.normalA.setVec(r,C.faceNormal0);
z.normalB.setVec(r,C.faceNormal1)};D.trim=function(z,r){return this.commonWriter.trim(z,r)};return y}();t.Layout=k.SilhouetteEdgeInstancesLayout;t.glLayout=f.glLayout(k.SilhouetteEdgeInstancesLayout,{divisor:1});const l=b.create(),w=new g;a.CommonBufferWriter=h;a.RegularEdgeBufferWriter=v;a.SilhouetteEdgeBufferWriter=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../support/debugFlags ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../collections/Component/Material/ComponentTechnique ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){const y={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let D=function(){function m(){this._value=0}var B=m.prototype;B.increment=function(){this._value++};B.decrement=function(){this._value--};g._createClass(m,[{key:"value",get:function(){return this._value}}]);return m}();const z={solid:0,sketch:1,uber:2};let r=function(){function m(E,F,G){this.rctx=E;this.shaderTechniqueRepository=F;this.config=new w.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new D;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new p,[2]:new p},[2]:{[1]:new p,[2]:new p}};this.renderablesDirty=!1;this.settings={...y,...G};this.key=m.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES};this.config.legacy=this.settings.legacy;this.config.mode=z[this.settings.type];this.config.silhouette=
!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=u.doublePrecisionRequiresObfuscation(E)}var B=m.prototype;B.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};B.addRenderable=function(E){this.renderables.add(E);this.renderablesDirty=!0};B.removeRenderable=function(E){this.renderables.delete(E);this.renderablesDirty=
!0};B.setRenderablesDirty=function(){this.renderablesDirty=!0};B.forEachRenderable=function(E,F){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[F][1].forAll(E);this.sortedRenderables[F][2].forAll(E)};B.setMultipassParameters=function(E){this.config.multipassTerrainEnabled=E.multipassTerrainEnabled?E.multipassTerrainEnabled:!1;this.config.cullAboveGround=E.cullAboveGround?E.cullAboveGround:!1};B.bindRegularEdges=function(E,F){this.setMultipassParameters(E);this.config.silhouette=
!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(w.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:E,edgeRenderParameters:F});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};B.bindSilhouetteEdges=function(E,F){this.setMultipassParameters(E);this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(w.EdgeShaderTechnique,this.config,this.technique);
this.technique.bindPass(this.rctx,{bindParameters:E,edgeRenderParameters:F});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};B.renderRegularEdges=function(E,F,G){this.render(this.technique.program,E,E.regular.vao,F,G)};B.renderSilhouetteEdges=function(E,F,G){this.render(this.technique.program,E,E.silhouette.vao,F,G)};B.render=function(E,F,G,I,K){this.setUniforms(E,F,I);this.rctx.bindVAO(G);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,
4,K)};B.setUniforms=function(E,F,G){F.components.buffer.textureBuffer.bind(E,C);G.multipassTerrainEnabled&&(E.setUniform2fv("cameraNearFar",G.camera.nearFar),E.setUniform2fv("inverseViewport",G.inverseViewport),q.bindMultipassTerrainUniforms(E,this.rctx,G));if("origin"in F.transform)E.setUniformMatrix4fv("uView",G.localViewMatrixForEdges),E.setUniformMatrix4fv("uModel",F.transform.modelMatrix),n.Slice.bindUniforms(E,this.settings,G.slicePlane,F.transform.origin.vec3);else{const I=new l.TwoVectorPosition(F.transform.position),
K=d.transpose(A,d.invert(A,F.transform.rotationScale)),J=new t.ComponentDrawParameters;c.copy(J.worldFromModel_TL,I.low);c.copy(J.worldFromModel_TH,I.high);d.copy(J.worldFromModel_RS,F.transform.rotationScale);d.copy(J.transformNormal_GlobalFromModel,K);v.VertexPosition.bindModelTransform(E,J);E.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",J.transformNormal_GlobalFromModel);F=G.camera.viewInverseTransposeMatrix;F=c.set(x,F[3],F[7],F[11]);n.Slice.bindUniforms(E,this.settings,G.slicePlane,
F)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(E);E.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(G.camera.fovY/2)/(G.camera.fullViewport[3]/2))};B.setSketchUniforms=function(E){const F=this.settings.strokesTexture,G=F.texture;b.isNone(G)||(this.rctx.bindTexture(G,0),E.setUniform1i("uStrokesTexture",0),E.setUniform2f("uStrokesTextureScale",1/G.descriptor.width,1/G.descriptor.height),E.setUniform1f("uStrokesLog2Resolution",f.log2(F.resolution)),E.setUniform1f("uStrokesNormalizationScale",
F.normalizationScale),E.setUniform1f("uStrokesAmplitude",F.amplitude),E.setUniform1f("uStrokeVariants",F.variants))};B.sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(F=>{0!==F.objectTransparency&&0!==F.edgeTransparency&&this.sortedRenderables[F.objectTransparency][F.edgeTransparency].push(F)});const E=(F,G)=>"origin"in F.transform&&
"origin"in G.transform?F.transform.origin.id<G.transform.origin.id?-1:F.transform.origin.id>G.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(E);this.sortedRenderables[1][2].sort(E);this.sortedRenderables[2][1].sort(E);this.sortedRenderables[2][2].sort(E)};m.getKey=function(E,F,G){return`edges-t:${E}:${F}:${G}`};return m}();const C={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2},A=e.create(),x=k.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=r;a.LINE_WIDTH_FRACTION_FACTOR=
8;a.componentDataBindParameters=C;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../../webgl/Program ../../../../webgl/renderState ../../../../webgl/BufferObject ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/Renderbuffer ../../../../webgl/FramebufferObject ../../../../webgl/ProgramCache ../../../../webgl/RenderingContext ../../../../webgl/ShaderCompiler ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../chunks/EdgeShaderProgram.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){g.EdgeShaderTechnique=function(z){function r(){return z.apply(this,arguments)||this}b._inheritsLoose(r,z);var C=r.prototype;C.bindPass=function(A,x){A=this.program;const {edgeRenderParameters:m,bindParameters:B}=x;y.VertexPosition.bindViewProjTransform(A,m.viewProjectionTransform);A.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",m.transformNormal_ViewFromGlobal);A.setUniformMatrix4fv("uProj",B.camera.projectionMatrix);A.setUniform2f("uDepthBias",
.5,-4E-4);A.setUniform2f("uPixelToNDC",2/B.camera.fullViewport[2],2/B.camera.fullViewport[3]);A.setUniform2f("uNDCToPixel",B.camera.fullViewport[2]/2,B.camera.fullViewport[3]/2);A.setUniform1f("uDistanceFalloffFactor",m.distanceFalloffFactor);A.setUniform2f("uViewportDimInv",1/B.camera.fullViewport[2],1/B.camera.fullViewport[3]);A.setUniform1f("uPixelRatio",B.camera.pixelRatio||1)};C.initializeProgram=function(A){const x=r.shader.get();var m=this.configuration;m=x.build({slicePlaneEnabled:m.slicePlaneEnabled,
sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,silhouette:m.silhouette,legacy:m.legacy,antialiasing:m.antialiasing,mode:m.mode,doublePrecisionRequiresObfuscation:m.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:m.multipassTerrainEnabled,cullAboveGround:m.cullAboveGround});return new d(A.rctx,m.generateSource("vertex"),m.generateSource("fragment"),x.attributeLocations)};C.initializePipeline=function(A){return(A=A.rctx.capabilities.blendMinMax)?e.makePipelineState({blending:e.separateBlendingParams(1,
1,0,1,32774,A.MAX),depthTest:{func:515},colorWrite:e.defaultColorWriteParams}):e.makePipelineState({depthTest:{func:515},depthWrite:e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams})};return r}(k.ShaderTechnique);g.EdgeShaderTechnique.shader=new f.ReloadableShaderModule(D.EdgeShaderProgram,()=>new Promise(function(z,r){a(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],z,r)}));(function(z){let r=function(C){function A(){var x=C.apply(this,arguments)||this;x.slicePlaneEnabled=
!1;x.silhouette=!1;x.legacy=!1;x.antialiasing=!1;x.mode=0;x.doublePrecisionRequiresObfuscation=!1;x.multipassTerrainEnabled=!1;x.cullAboveGround=!0;return x}b._inheritsLoose(A,C);return A}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter()],r.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],r.prototype,"silhouette",void 0);p.__decorate([c.parameter()],r.prototype,"legacy",void 0);p.__decorate([c.parameter()],r.prototype,"antialiasing",void 0);p.__decorate([c.parameter({count:3})],
r.prototype,"mode",void 0);p.__decorate([c.parameter()],r.prototype,"doublePrecisionRequiresObfuscation",void 0);p.__decorate([c.parameter()],r.prototype,"multipassTerrainEnabled",void 0);p.__decorate([c.parameter()],r.prototype,"cullAboveGround",void 0);z.Configuration=r})(g.EdgeShaderTechnique||(g.EdgeShaderTechnique={}));Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){function t(y){const D=new b.ShaderBuilder,z=D.vertex,r=D.fragment;y.legacy&&z.uniforms.add("uModel","mat4");y.antialiasing&&(z.code.add(g.glsl`
      #define ANTIALIASING 1
    `),r.code.add(g.glsl`
      #define ANTIALIASING 1
    `));D.include(c.AdjustProjectedPosition,y);D.include(u.LineAmplitude,y);D.include(n.EdgeUtil,y);D.include(q.UnpackAttributes,y);D.include(v.LineOffset,y);D.include(p.Slice,y);D.include(e.DiscardNonSilhouetteEdges,y);D.include(d.DiscardByCoverage,y);D.include(h.DiscardShortEdges,y);D.varyings.add("vColor","vec4");D.varyings.add("vRadius","float");D.varyings.add("vPosition","vec3");D.varyings.add("vWorldPosition","vec3");D.varyings.add("vViewPos","vec3");D.varyings.add("vLineLengthPixels","float");
D.varyings.add("vSizeFalloffFactor","float");z.uniforms.add("uPixelToNDC","vec2");z.uniforms.add("uNDCToPixel","vec2");z.uniforms.add("uPixelRatio","float");D.attributes.add("position0","vec3");D.attributes.add("position1","vec3");D.attributes.add("variantOffset","float");D.attributes.add("variantStroke","float");D.attributes.add("variantExtension","float");z.code.add(g.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

    #ifdef ANTIALIASING
      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
    #else /* ANTIALIASING */

      // Even if there is no AA, we still want to do proper <1px rendering,
      // so we effectively clamp the pixel sizes to minimum of 1px and compute
      // coverage in the fragment shader
      float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
      float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
    #endif /* ANTIALIASING */

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard edges below a certain length threshold
      discardShortEdges(unpackedAttributes, lineLengthPixels);

      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0 = worldFromModelPosition(position0);
      vec3 worldPosV1 = worldFromModelPosition(position1);
      vec3 viewPosV0 = viewFromModelPosition(position0);
      vec3 viewPosV1 = viewFromModelPosition(position1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);y.multipassTerrainEnabled&&(D.fragment.include(f.ReadLinearDepth),D.include(k.multipassTerrainTest,y));D.fragment.code.add(g.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${y.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return D}const l={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};var w=Object.freeze({__proto__:null,attributeLocations:l,build:t});a.EdgeShaderProgram=w;a.attributeLocations=l;a.build=t})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/attributes/VertexPosition.glsl",
"../../../core/shaderLibrary/util/IsNaN.glsl"],function(a,g,b,p){a.AdjustProjectedPosition=function(f,k){f.vertex.include(p.IsNaN);f.include(b.VertexPosition,k);f=f.vertex;f.uniforms.add("uDepthBias","vec2");f.uniforms.add("uViewportDimInv","vec2");k.legacy?(f.uniforms.add("uView","mat4"),f.uniforms.add("uProj","mat4")):f.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");k.legacy?f.code.add(g.glsl`
      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
        float offsetXY = uDepthBias.x;
        float offsetZ  = uDepthBias.y;

        // screen space pixel offset
        // we multiply by two to account for the fact that NDC go from -1 to 1
        // we multiply by projPos.w to compensate for the perspective division that happens later
        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing
        // towards the camera
        vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);

        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
      }
    `):f.code.add(g.glsl`
      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
        float offsetXY = uDepthBias.x;
        float offsetZ  = uDepthBias.y;

        // screen space pixel offset
        // we multiply by two to account for the fact that NDC go from -1 to 1
        // we multiply by projPos.w to compensate for the perspective division that happens later
        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing
        // towards the camera
        vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);

        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
      }
    `);f.code.add(g.glsl`
    // A z-offset, using a depth based heuristic.
    float _calculateProjectedBiasZ(vec4 projPos) {
      float offsetZ = uDepthBias.y;
      return sqrt(projPos.z) * offsetZ;
    }

    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
      vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);

      // we currently have to do this check because some geometries come with 0 length edge normals.
      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890
      if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
        projPos.xy += offsetXY;
      }

      projPos.z += _calculateProjectedBiasZ(projPos);

      return projPos;
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,g){a.IsNaN=function(b){const p=g.glsl`
    bool isNaN( float val )
    {
      return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
      // important: some nVidias failed to cope with version below.
      // Probably wrong optimization.
      /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/
    }
  `;b.code.add(p)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,g){a.DiscardByCoverage=function(b,p){b=b.fragment;b.constants.add("coverageTestThreshold","float",.01);p.antialiasing?b.code.add(g.glsl`
      #define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }
    `):b.code.add(g.glsl`
      #define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,g){a.DiscardNonSilhouetteEdges=function(b,p){b=b.vertex;p.silhouette?(b.code.add(g.glsl`
      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
        float faceAVisible = dot(viewDir, normalA);
        float faceBVisible = dot(viewDir, normalB);
        return faceAVisible * faceBVisible < 0.0;
      }
    `),p.legacy?b.code.add(g.glsl`
        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
          vec3 viewNormalA = _modelToViewNormal(normalA);
          vec3 viewNormalB = _modelToViewNormal(normalB);
          vec3 viewDir = -viewPos;

          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
            return false;
          }

          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return true;
        }
      `):b.code.add(g.glsl`
        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
          vec3 worldNormalA = _modelToWorldNormal(normalA);
          vec3 worldNormalB = _modelToWorldNormal(normalB);
          vec3 viewDir = -worldPos;

          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
            return false;
          }

          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return true;
        }
      `)):b.code.add(g.glsl`
      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
        return false;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,g){a.DiscardShortEdges=function(b,p){b=b.vertex;switch(p.mode){case 1:b.code.add(g.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}
      `);break;case 2:b.code.add(g.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}
      `);break;case 0:b.code.add(g.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}
      `)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/util/DoublePrecision.glsl"],function(a,g,b){function p(f,k){const c=f.vertex;c.uniforms.add("uDistanceFalloffFactor","float");c.code.add(g.glsl`
    float distanceBasedPerspectiveFactor(float distance) {
      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
    }
  `);c.uniforms.add("uComponentDataTex","sampler2D");c.uniforms.add("uComponentDataTexInvDim","vec2");f.attributes.add("componentIndex","float");c.constants.add("componentColorFieldOffset","float",0);c.constants.add("componentOtherFieldOffset","float",1);c.constants.add("componentFieldCount","float",2);c.constants.add("lineWidthFractionFactor","float",8);c.constants.add("extensionLengthOffset","float",128);c.constants.add("componentTexWidth","float",4096);c.code.add(g.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      float rowIndex = floor(fieldIndex / componentTexWidth);
      float colIndex = mod(fieldIndex, componentTexWidth);

      vec2 linearIndex = vec2(
        (colIndex + 0.5) / componentTexWidth,
        (rowIndex + 0.5) * uComponentDataTexInvDim.y
      );

      return linearIndex;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);

      vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
      vec4 otherValue = texture2D(uComponentDataTex, otherIndex);

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
      );
    }
  `);k.legacy?c.code.add(g.glsl`
      vec3 _modelToWorldNormal(vec3 normal) {
        return (uModel * vec4(normal, 0.0)).xyz;
      }

      vec3 _modelToViewNormal(vec3 normal) {
        return (uView * uModel * vec4(normal, 0.0)).xyz;
      }
    `):(c.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),c.code.add(g.glsl`
      vec3 _modelToWorldNormal(vec3 normal) {
        return uTransformNormal_GlobalFromModel * normal;
      }
    `));k.silhouette?(f.attributes.add("normalA","vec3"),f.attributes.add("normalB","vec3"),c.code.add(g.glsl`
      vec3 worldNormal() {
        return _modelToWorldNormal(normalize(normalA + normalB));
      }
    `)):(f.attributes.add("normal","vec3"),c.code.add(g.glsl`
      vec3 worldNormal() {
        return _modelToWorldNormal(normal);
      }
    `));k.legacy?c.code.add(g.glsl`
      vec3 worldFromModelPosition(vec3 position) {
        return (uModel * vec4(position, 1.0)).xyz;
      }

      vec3 viewFromModelPosition(vec3 position) {
        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
      }

      vec4 projFromViewPosition(vec3 position) {
        return uProj * vec4(position, 1.0);
      }
    `):(f.vertex.include(b.DoublePrecision,k),c.code.add(g.glsl`
      vec3 worldFromModelPosition(vec3 position) {
        vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;

        vec3 transform_CameraRelativeFromModel = dpAdd(
          uTransform_WorldFromModel_TL,
          uTransform_WorldFromModel_TH,
          -uTransform_WorldFromView_TL,
          -uTransform_WorldFromView_TH
        );

        return transform_CameraRelativeFromModel + rotatedModelPosition;
      }

      vec3 viewFromModelPosition(vec3 position) {
        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
      }

      vec4 projFromViewPosition(vec3 position) {
        return uTransform_ProjFromView * vec4(position, 1.0);
      }
    `));c.code.add(g.glsl`
    float calculateExtensionLength(float extensionLength, float lineLength) {
      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
    }
  `)}(function(f){f.usesSketchLogic=function(k){return 1===k.mode||2===k.mode};f.usesSolidLogic=function(k){return 0===k.mode||2===k.mode}})(p||(p={}));a.EdgeUtil=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,g,b){a.UnpackAttributes=function(p,f){const k=p.vertex;p.include(b.EdgeUtil,f);p.attributes.add("sideness",
"vec2");2===f.mode?k.code.add(g.glsl`
      struct UnpackedAttributes {
        vec2 sideness;
        vec2 sidenessNorm;
        float lineWidthPixels;
        float extensionLengthPixels;
        float type;
      };
    `):k.code.add(g.glsl`
      struct UnpackedAttributes {
        vec2 sideness;
        vec2 sidenessNorm;
        float lineWidthPixels;
        float extensionLengthPixels;
      };
  `);switch(f.mode){case 2:k.code.add(g.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float fType = component.type;
          float extensionLengthPixels = component.extensionLength;
          float lineWidth = component.lineWidth;

          if (fType <= 0.0) {
            extensionLengthPixels *= variantExtension * 2.0 - 1.0;
          }

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
        }
      `);break;case 1:k.code.add(g.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float extensionLengthPixels = component.extensionLength;
          extensionLengthPixels *= variantExtension * 2.0 - 1.0;
          float lineWidth = component.lineWidth;

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
        }
      `);break;case 0:k.code.add(g.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float extensionLengthPixels = component.extensionLength;
          float lineWidth = component.lineWidth;

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
        }
      `)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,g,b,p){a.LineAmplitude=function(f,k){const c=f.vertex;f.include(p.UnpackAttributes,k);b.EdgeUtil.usesSketchLogic(k)&&c.uniforms.add("uStrokesAmplitude","float");switch(k.mode){case 0:c.code.add(g.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          return 0.0;
        }
      `);break;case 1:c.code.add(g.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          return uStrokesAmplitude;
        }
      `);break;case 2:c.code.add(g.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          float type = unpackedAttributes.type;

          if (type <= 0.0) {
            return uStrokesAmplitude;
          }
          else {
            return 0.0;
          }
        }
      `)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,g,b,p,f){a.LineOffset=function(k,c){const d=k.vertex;k.include(f.UnpackAttributes,c);const e=k.fragment;p.EdgeUtil.usesSketchLogic(c)&&(d.uniforms.add("uStrokesTextureScale","vec2"),
d.uniforms.add("uStrokesLog2Resolution","float"),d.uniforms.add("uStrokeVariants","float"),k.varyings.add("vStrokeUV","vec2"),e.uniforms.add("uStrokesTexture","sampler2D"),e.uniforms.add("uStrokesNormalizationScale","float"),d.code.add(g.glsl`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);

        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
        vStrokeUV.x += variantOffset;
      }
    `),k.fragment.include(b.RgbaFloatEncoding),e.code.add(g.glsl`
      float calculateLineOffsetSketch() {
        float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
        return (offsetNorm - 0.5) * uStrokesNormalizationScale;
      }

      float calculateLinePressureSketch() {
        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
      }
    `));switch(c.mode){case 0:d.code.add(g.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}
      `);e.code.add(g.glsl`
        float calculateLineOffset() {
          return 0.0;
        }

        float calculateLinePressure() {
          return 1.0;
        }
      `);break;case 1:d.code.add(g.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
        {
          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
        }
      `);e.code.add(g.glsl`
        float calculateLineOffset() {
          return calculateLineOffsetSketch();
        }

        float calculateLinePressure() {
          return calculateLinePressureSketch();
        }
      `);break;case 2:k.varyings.add("vType","float"),d.code.add(g.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
        {
          vType = unpackedAttributes.type;

          if (unpackedAttributes.type <= 0.0) {
            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
          }
        }
      `),e.code.add(g.glsl`
        float calculateLineOffset() {
          if (vType <= 0.0) {
            return calculateLineOffsetSketch();
          }
          else {
            return 0.0;
          }
        }

        float calculateLinePressure() {
          if (vType <= 0.0) {
            return calculateLinePressureSketch();
          }
          else {
            return 1.0;
          }
        }
      `)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,g,b,p,f){return function(k){function c(e){return k.call(this,"EdgeProcessingWorker","wrappedWork",e)||this}a._inheritsLoose(c,k);var d=c.prototype;d.process=
async function(e,h,n){if(n)return f.work(e);e=this._packInput(e);h=await this.invoke(e,h);return this._unpackOutput(h)};d.getTransferList=function(e){return[e.dataBuffer]};d._packInput=function(e){return{dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate,indicesBuffer:e.indices.buffer,indicesType:g.isUint32Array(e.indices)?"Uint32Array":"Uint16Array",indicesLength:e.indicesLength}};d._unpackOutput=function(e){return{regular:{instancesData:p.unpackInterleavedBuffer(e.regular.instancesData),
lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:p.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}};return c}(b.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","./BufferView","./InterleavedLayout"],function(a,g,b){function p(c){const d=[];c.fields.forEach((e,h)=>{var n=e.constructor;d.push([h,{...e,constructor:`${n.ElementType}_${n.ElementCount}`}])});
return{stride:c.stride,fields:d,fieldNames:c.fieldNames}}function f(c){const d=b.newLayout();d.stride=c.stride;d.fieldNames=c.fieldNames;c.fields.forEach(e=>d.fields.set(e[0],{...e[1],constructor:k.get(e[1].constructor)}));return d}g=[g.BufferViewFloat,g.BufferViewVec2f,g.BufferViewVec3f,g.BufferViewVec4f,g.BufferViewMat3f,g.BufferViewMat4f,g.BufferViewFloat64,g.BufferViewVec2f64,g.BufferViewVec3f64,g.BufferViewVec4f64,g.BufferViewMat3f64,g.BufferViewMat4f64,g.BufferViewUint8,g.BufferViewVec2u8,g.BufferViewVec3u8,
g.BufferViewVec4u8,g.BufferViewUint16,g.BufferViewVec2u16,g.BufferViewVec3u16,g.BufferViewVec4u16,g.BufferViewUint32,g.BufferViewVec2u32,g.BufferViewVec3u32,g.BufferViewVec4u32,g.BufferViewInt8,g.BufferViewVec2i8,g.BufferViewVec3i8,g.BufferViewVec4i8,g.BufferViewInt16,g.BufferViewVec2i16,g.BufferViewVec3i16,g.BufferViewVec4i16,g.BufferViewInt32,g.BufferViewVec2i32,g.BufferViewVec3i32,g.BufferViewVec4i32];const k=new Map;g.forEach(c=>k.set(`${c.ElementType}_${c.ElementCount}`,c));a.packInterleavedBuffer=
function(c,d){d.push(c.buffer);return{buffer:c.buffer,layout:p(c.layout)}};a.packLayout=p;a.unpackInterleavedBuffer=function(c){return f(c.layout).createView(c.buffer)};a.unpackLayout=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ./bufferLayouts ./edgeBufferWriters ../../../support/buffer/workerHelper ../../../support/meshProcessing ./edgePreprocessing".split(" "),
function(a,g,b,p,f,k,c){function d(n){var q=n.data,u=n.indices;var v=n.indicesLength;if(n.skipDeduplicate){const t=k.computeNeighbors(u,v,q.count);v={faces:u,facesLength:v,neighbors:t,vertices:q}}else q=g.deduplicate(q.buffer,q.stride/4,{originalIndices:u,originalIndicesLength:v}),v=k.computeNeighbors(q.indices,v,q.uniqueCount),v={faces:q.indices,facesLength:q.indices.length,neighbors:v,vertices:b.EdgeInputBufferLayout.createView(q.buffer)};e.updateSettings(n.writerSettings);h.updateSettings(n.writerSettings);
return c.extractEdges(v,e,h)}const e=new p.RegularEdgeBufferWriter,h=new p.SilhouetteEdgeBufferWriter;a.work=d;a.wrappedWork=async function(n){var q={data:b.EdgeInputBufferLayout.createView(n.dataBuffer),indices:"Uint32Array"===n.indicesType?new Uint32Array(n.indicesBuffer):"Uint16Array"===n.indicesType?new Uint16Array(n.indicesBuffer):void 0,indicesLength:n.indicesLength,writerSettings:n.writerSettings,skipDeduplicate:n.skipDeduplicate};n=d(q);q=[q.data.buffer];q.push(n.regular.lodInfo.lengths.buffer);
q.push(n.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:f.packInterleavedBuffer(n.regular.instancesData,q),lodInfo:{lengths:n.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:f.packInterleavedBuffer(n.silhouette.instancesData,q),lodInfo:{lengths:n.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:n.averageEdgeLength},transferList:q}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=
function(g,b,p){b/=3;const f=new Uint32Array(p+1),k=new Uint32Array(p+1);var c=(l,w)=>{l<w?f[l+1]++:k[w+1]++};for(var d=0;d<b;d++){var e=g[3*d],h=g[3*d+1],n=g[3*d+2];c(e,h);c(h,n);c(n,e)}d=c=0;for(e=0;e<p;e++)h=f[e+1],n=k[e+1],f[e+1]=c,k[e+1]=d,c+=h,d+=n;const q=new Uint32Array(6*b),u=f[p];c=(l,w,y)=>{l<w?(l=f[l+1]++,q[2*l]=w,q[2*l+1]=y):(w=k[w+1]++,q[2*u+2*w]=l,q[2*u+2*w+1]=y)};for(d=0;d<b;d++)e=g[3*d],h=g[3*d+1],n=g[3*d+2],c(e,h,d),c(h,n,d),c(n,e,d);c=(l,w)=>{const y=2*l;l=w-l;for(w=1;w<l;w++){const D=
q[y+2*w],z=q[y+2*w+1];let r=w-1;for(r;0<=r&&q[y+2*r]>D;r--)q[y+2*r+2]=q[y+2*r],q[y+2*r+3]=q[y+2*r+1];q[y+2*r+2]=D;q[y+2*r+3]=z}};for(d=0;d<p;d++)c(f[d],f[d+1]),c(u+k[d],u+k[d+1]);const v=new Int32Array(3*b),t=(l,w)=>l===g[3*w]?0:l===g[3*w+1]?1:l===g[3*w+2]?2:-1;b=(l,w)=>{l=t(l,w);v[3*w+l]=-1};c=(l,w,y,D)=>{l=t(l,w);v[3*w+l]=D;y=t(y,D);v[3*D+y]=w};for(d=0;d<p;d++){e=f[d];h=f[d+1];n=k[d];const l=k[d+1];for(;e<h&&n<l;){const w=q[2*e],y=q[2*u+2*n];w===y?(c(d,q[2*e+1],y,q[2*u+2*n+1]),e++,n++):w<y?(b(d,
q[2*e+1]),e++):(b(y,q[2*u+2*n+1]),n++)}for(;e<h;)b(d,q[2*e+1]),e++;for(;n<l;)b(q[2*u+2*n],q[2*u+2*n+1]),n++}return v};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/typedArrayUtil ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils".split(" "),function(a,g,b,p,f,k,c){function d(v,t){const l=
p.acosClamped(v.cosAngle),w=n.fwd,y=n.ortho;c.directionFromTo(w,v.position1,v.position0);v=0<k.dot(k.cross(y,v.faceNormal0,v.faceNormal1),w)?-1:1;return l*v>t}function e(v){const t=v.faces.length/3,l=v.faces;v=v.neighbors;var w=0;for(var y=0;y<t;y++){var D=v[3*y+1],z=v[3*y+2],r=l[3*y],C=l[3*y+1],A=l[3*y+2];w+=-1===v[3*y]||r<C?1:0;w+=-1===D||C<A?1:0;w+=-1===z||A<r?1:0}w=new Int32Array(4*w);y=0;for(D=0;D<t;D++){z=v[3*D];r=v[3*D+1];C=v[3*D+2];A=l[3*D];const x=l[3*D+1],m=l[3*D+2];if(-1===z||A<x)w[y++]=
A,w[y++]=x,w[y++]=D,w[y++]=z;if(-1===r||x<m)w[y++]=x,w[y++]=m,w[y++]=D,w[y++]=r;if(-1===C||m<A)w[y++]=m,w[y++]=A,w[y++]=D,w[y++]=C}return w}function h(v){const t=v.faces.length/3,l=v.vertices.position;v=v.faces;const w=q.v0,y=q.v1,D=q.v2,z=new Float32Array(3*t);for(let r=0;r<t;r++){const C=v[3*r+1],A=v[3*r+2];l.getVec(v[3*r],w);l.getVec(C,y);l.getVec(A,D);k.subtract(y,y,w);k.subtract(D,D,w);k.cross(w,y,D);k.normalize(w,w);z[3*r]=w[0];z[3*r+1]=w[1];z[3*r+2]=w[2]}return z}const n={edge:{position0:f.create(),
position1:f.create(),faceNormal0:f.create(),faceNormal1:f.create(),componentIndex:0,cosAngle:0},ortho:f.create(),fwd:f.create()},q={v0:f.create(),v1:f.create(),v2:f.create()},u={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(v,t,l,w=u){const y=v.vertices.position;var D=v.vertices.componentIndex,z=p.deg2rad(w.anglePlanar);w=p.deg2rad(w.angleSignificantEdge);const r=Math.cos(w),C=Math.cos(z),A=n.edge,x=A.position0,m=A.position1,B=A.faceNormal0,E=A.faceNormal1,F=h(v),G=e(v),I=G.length/
4;v=t.allocate(I);w=0;const K=l.allocate(I);let J=0,L=0,P=0;const Q=b.range(0,I),X=new Float32Array(I);g.forEach(X,(R,T,W)=>{y.getVec(G[4*T],x);y.getVec(G[4*T+1],m);W[T]=k.distance(x,m)});Q.sort((R,T)=>X[T]-X[R]);const aa=[],S=[];for(let R=0;R<I;R++){var H=Q[R];const T=X[H],W=G[4*H],Y=G[4*H+1],U=G[4*H+2];H=G[4*H+3];const N=-1===H;y.getVec(W,x);y.getVec(Y,m);if(N)k.set(B,F[3*U],F[3*U+1],F[3*U+2]),k.copy(E,B),A.componentIndex=D.get(W),A.cosAngle=k.dot(B,E);else{k.set(B,F[3*U],F[3*U+1],F[3*U+2]);k.set(E,
F[3*H],F[3*H+1],F[3*H+2]);A.componentIndex=D.get(W);A.cosAngle=k.dot(B,E);if(A.cosAngle>C)continue;-.9999>A.cosAngle&&k.copy(E,B)}L+=T;P++;N||A.cosAngle<r?(t.write(v,w++,A),aa.push(T)):d(A,z)&&(l.write(K,J++,A),S.push(T))}D=new Float32Array(aa.reverse());z=new Float32Array(S.reverse());return{regular:{instancesData:t.trim(v,w),lodInfo:{lengths:D}},silhouette:{instancesData:l.trim(K,J),lodInfo:{lengths:z}},averageEdgeLength:L/P}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports",
"../../../../../core/maybe","../../../../../core/mathUtils","../Util","../../../../webgl/Texture"],function(a,g,b,p,f){function k(e,h){if(!e)return null;var n=e.length/2;const q=.1*n;n=Array(n);let u=0;h=1===h;for(let v=0;v<e.length;v+=2){const t=(e[v]+e[v+1])/2;h?n[u++]=Math.min(q,1-.5*(1-t)):n[u++]=Math.min(q,.5*t)}return n}let c=function(){function e(h,n,q,u,v){this.resolution=h;this.normalizationScale=n;this.amplitude=q;this.variants=u;this.texture=v}e.prototype.dispose=function(){this.texture=
g.disposeMaybe(this.texture)};return e}();const d={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,
-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,
.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,
-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,
-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,
.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,
.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,
.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,
-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,
1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,
.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,
-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,
.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,
.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,
.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,
.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,
3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,
4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,
1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,
.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,
.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,
.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,
.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,
2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,
-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,
.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,
2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,
.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,
.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,
.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,
-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,
.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,
.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,
-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,
.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,
.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,
.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,
.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,
6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,
1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,
-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,
2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,
.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,
.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,
.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=c;a.generateStrokesTexture=
function(e){const h=d.resolution;var n=h/2;const q=new Uint8Array(4*h*h),u=4*h*n;n=d.amplitude;const v=2*n,t=4*h,l=b.log2(h)+1,w=d.strokes.length;let y=(l-1)*w*t;for(const {distance:D,pressure:z}of d.strokes){let r=D,C=z,A=y;for(let x=0;x<l;x++){0!==x&&(r=k(r,0),C=k(C,1));for(let m=0;m<d.resolution;m++){const B=C?C[m%C.length]:1;p.packFloatRGBA((r?r[m%r.length]/v:0)+.5,q,A);p.packFloatRGBA(B,q,A+u);A+=4}A-=t*(w+1)}y+=t}e=new f(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:h,
height:h,wrapMode:10497},q);return new c(h,v,n,w,e)};a.rasterizeStrokes=function(){var e=d.resolution;const h=b.log2(e)+1;var n=d.strokes.length;const q=d.amplitude,u=Math.ceil(2*q+.5);var v;for(v=0;1<=e;)v+=e,e/=2;v+=6*(h+1);n*=u;e=new Uint8ClampedArray(4*v*n);const t=4*v;e.fill(255);let l=24;for(const {distance:w,pressure:y}of d.strokes){let D=w,z=y,r=l;for(let C=0;C<h;C++){0!==C&&(D=k(D,0),z=k(z,1));for(let A=0;A<D.length;A++){const x=D?D[A]:0,m=z?b.clamp(z[A],0,1):1;let B=r;for(let E=-q;E<u-q;E++){const F=
255-255*b.clamp(1-(Math.abs(E-x+.5)-.5*m),0,1);e[B+0]=F;e[B+1]=F;e[B+2]=F;e[B+3]=255;B+=t}r+=4}r+=24}l+=u*t}return new ImageData(e,v,n)};a.strokesDefinition=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/maybe","../../../../../core/arrayUtils"],function(a,g,b){function p(f){return 0<f.size*f.color[3]*f.opacity}a.computeEdgeCount=function(f,k,c){const d=f.length;k*=c.minimumEdgeLength;c=b.binaryIndexOf(f,
k,!0);f=-1===c?k<f[0]?0:f.length:c;return d-f};a.determineEdgeTransparency=function(f){let k=0;for(const {material:c}of f)if(p(c)){if(1>c.color[3]*c.opacity)return 1;k=2}return k};a.determineObjectTransparency=function(f){let k=0;for(const {material:c}of f)if(p(c)){switch(c.objectTransparency){case 1:case 0:return 1;case 2:if(1>c.opacity)return 1}k=2}return k};a.determineRendererType=function(f){let k=null;for(const c of f)if(f=c.type,p(c))if(g.isNone(k))k=f;else if(k!==f)return"uber";return g.isSome(k)?
k:"solid"};a.estimateLengthAtDistance=function(f,k,c,d){return d/f*c*2*Math.tan(.5*k)};a.fillComponenBufferIndices=function(f,k,c,d){for(let h=0;h<f.length;h++){const n=f[h].index;var e=k[h];const q=k[h+1];if(d)for(;e<q;e++)c.set(d[e],n);else for(;e<q;e++)c.set(e,n)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/Evented ../../../support/Scheduler ./Util ../../../webgl/Texture ./TextureTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h){const n=p.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");p=function(){function u(t,l,w){this._stage=t;this.rctx=w;this._idToRefCountedTexture=new Map;this._textureTechniqueConfig=new h.TextureTechniqueConfiguration;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);this.events=new k;this._textureTechnique=l.acquireAndReleaseExisting(h.TextureTechnique,this._textureTechniqueConfig,
this._textureTechnique);for(l=0;l<this._fallbackTextureData.length;++l)this._fallbackTextureData[l]=255,this._fallbackTextureTransparentData[l]=0!==(l+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy};this._frameTask=b.isSome(t.scheduler)?t.scheduler.registerTask(c.Task.TEXTURE_UNLOAD,y=>this._frameTask.processQueue(y),()=>!1):c.ImmediateTask}var v=u.prototype;v.dispose=function(){this._frameTask.remove();
b.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);b.isSome(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._stage.forEachOfType(4,t=>t.unload())};v.acquire=function(t,l=!1,w){t=this._getOrCreateRef(t,l,w);t.ref();return t};v.update=function(){let t=!1;this._frameUpdates.forEach(l=>{const w=l.texture.frameUpdate(this.rctx,this._textureTechnique,l.previousToken);0<=w&&w!==l.previousToken&&
(l.previousToken=w,t=!0)});t&&this.events.emit("changed",0)};v._getOrCreateRef=function(t,l,w){const y=this._idToRefCountedTexture.get(t);return y?y:this._createNewRef(t,l,w)};v._createNewRef=function(t,l,w){const y=this._stage.getObject(t);d.assert(void 0!==y);const D=y.events.on("unloaded",()=>{D.remove();this._onTextureUnloaded(t)}),z=new q;this._idToRefCountedTexture.set(t,z);const r=y.load(this.rctx,this._textureTechnique);this._loadingCount++;const C=x=>{this._loadingCount--;this._updateGLTexture(z,
x);w&&w(z);y.requiresFrameUpdates&&this._frameUpdates.set(t,{texture:y,previousToken:-1});return z},A=x=>{this._loadingCount--;f.isAbortError(x)||n.error(x)};f.isPromiseLike(r)?(this._updateGLTexture(z,l?this.fallbackTextureTransparent:this.fallbackTexture),r.then(C,A)):C(r);return z};v._updateGLTexture=function(t,l){t.glTexture=l;this.events.emit("changed",1)};v.release=function(t){const l=this._idToRefCountedTexture.get(t);if(l&&(l.unref(),l.isUnreferenced)){const w=this._stage.getObject(t);this._frameTask.schedule(()=>
{l.isUnreferenced&&w.unload()})}};v.getTexture=function(t){return this._stage.getObject(t)};v._onTextureUnloaded=function(t){this._idToRefCountedTexture.delete(t);this._frameUpdates.delete(t)};g._createClass(u,[{key:"loadingCount",get:function(){return this._loadingCount}},{key:"fallbackTexture",get:function(){b.isNone(this._fallbackTexture)&&(this._fallbackTexture=new e(this.rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture}},{key:"fallbackTextureTransparent",
get:function(){b.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=new e(this.rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent}}]);return u}();let q=function(){function u(){this._refCount=0;this.glTexture=null}var v=u.prototype;v.ref=function(){++this._refCount};v.unref=function(){0===this._refCount?n.error("Cannot dereference texture that has no references!"):--this._refCount};g._createClass(u,[{key:"isUnreferenced",
get:function(){return 0===this._refCount}}]);return u}();a.RefCountedTexture=q;a.TextureRepository=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/Accessor ../../../../../assets ../../../../../support/requestImageUtils ../../../../webgl/Texture".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){const w=f.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(y){function D(){var r=y.apply(this,arguments)||this;r.data=[];r.loadingState=0;return r}g._inheritsLoose(D,y);var z=D.prototype;z.dispose=function(){this.loadingState=0;this.data.forEach(r=>{r.dispose();r=null});this.data=null};z.getTextureProps=function(r,C,A=!1){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,
hasMipmap:A,maxAnisotropy:8,width:r,height:C}};z.loadTextures=function(r){const C=[v.getAssetUrl("esri/images/materials/water/normals.jpg"),v.getAssetUrl("esri/images/materials/water/perturbation.jpg")];this.loadingState=1;Promise.all(C.map(A=>t.requestImage(A))).then(A=>{A.forEach((x,m)=>{this.data[m]=new l(r,this.getTextureProps(x.width,x.height,!0),x)});this.loadingState=2}).catch(A=>{w.error("Failed to load textures for water material.",A);this.loadingState=0})};z.bindRepo=function(r){for(let C=
0;C<this.data.length;C++)r.bindTexture(this.data[C],C)};g._createClass(D,[{key:"updating",get:function(){return 1===this.loadingState}},{key:"ready",get:function(){return 2===this.loadingState}}]);return D}(u);b.__decorate([c.property()],a.WaterTextureRepository.prototype,"loadingState",void 0);b.__decorate([c.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=b.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],
a.WaterTextureRepository);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../../../support/screenshotUtils ../lib/AutoDisposable ../../../webgl/FramebufferObject".split(" "),function(a,g,b,p,f,k,c,d){c=function(e){function h(q,u,v,t=null,l,w=!0){var y=e.call(this)||this;y._rctx=q;y._renderScene=
u;y._requestRenderScene=v;y._renderOverlay=t;y.forceCameraHook=l;y.supersample=w;y._screenshotQueue=[];return y}g._inheritsLoose(h,e);var n=h.prototype;n.dispose=function(){this._rctx=null};n.takeScreenshot=function(q){this._requestRenderScene();const u=p.createResolver();this._screenshotQueue.push({settings:q,resolver:u});return u.promise};n.update=function(q){if(0!==this._screenshotQueue.length){for(const v of this._screenshotQueue){if(this.isDisposed){v.resolver.reject();continue}var u={...v.settings,
pixelRatio:v.settings.pixelRatio*q.viewCamera.pixelRatio};const t=this._ensureScreenshotEncodeCanvas(),l=this._renderScreenshot(q,u);u=k.encodeResult(l,u,t,{flipY:!0,premultipliedAlpha:!0});v.resolver(u)}this._screenshotQueue=[]}};n._renderScreenshotOverlay=function(q,u,v){if(!b.isNone(this._renderOverlay)){q.width=u.width;q.height=u.height;var t=q.getContext("2d"),l=v.pixelRatio;t.save();t.translate(0,u.height);t.scale(1,-1);v.region&&t.translate(-v.region.x,-v.region.y);t.scale(l,l);this._renderOverlay(q,
u);t.restore()}};n._readbackScreenshot=function(q){return q.resample?this._readbackScreenshotResampled(q):this._readbackScreenshotImmediate(q)};n._readbackScreenshotResampled=function(q){const {framebufferWidth:u,framebufferHeight:v,region:t,resample:l}=q,w=this._ensureScreenshotEncodeCanvas(),y=k.createEmptyImageData(u,v,w);this._rctx.gl.readPixels(0,0,u,v,6408,5121,new Uint8Array(y.data.buffer));this._renderScreenshotOverlay(w,y,{...q,region:null});q=k.createEmptyImageData(t.width,t.height,w);return k.resampleHermite(y,
q,!0,l.region.x,v-(l.region.y+l.region.height),l.region.width,l.region.height)};n._readbackScreenshotImmediate=function(q){const {framebufferHeight:u,region:v}=q,t=this._ensureScreenshotEncodeCanvas(),l=k.createEmptyImageData(v.width,v.height,t);this._rctx.gl.readPixels(v.x,u-(v.y+v.height),v.width,v.height,6408,5121,new Uint8Array(l.data.buffer));this._renderScreenshotOverlay(t,l,q);return l};n._renderScreenshot=function(q,u){var v=null;const t=q.viewCamera,{framebufferWidth:l,framebufferHeight:w}=
u;var y=!1;q=u.disableDecorations&&q.frameHasDecorations;var D=u.ignorePadding&&t.pixelRatio!==u.pixelRatio;if(q=l!==t.fullWidth||w!==t.fullHeight||q||D){D=t.clone();if(u.ignorePadding){v=f.clone(D.padding);for(y=0;4>y;y++)v[y]=Math.round(v[y]/D.pixelRatio*u.pixelRatio);D.padding=v}D.fullWidth=l;D.fullHeight=w;D.pixelRatio=u.pixelRatio;v=t.fovX-D.fovX;y=t.fovY-D.fovY;0>v&&v<y?D.fovX=t.fovX:0>y&&y<v&&(D.fovY=t.fovY);this.forceCameraHook(D);y=!0;v=new d(this._rctx,{width:D.fullWidth,height:D.fullHeight,
colorTarget:0,depthStencilTarget:3});this._renderScene(v,D,u.disableDecorations)}u=this._readbackScreenshot(u);if(q&&!this._rctx.contextAttributes.alpha)for(q=3;q<u.data.length;q+=4)u.data[q]=255;v&&v.dispose();this._rctx.bindFramebuffer(null);y&&this.forceCameraHook(t);return u};n._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return h}(c.AutoDisposable);a.ScreenshotManager=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(a){a.hitTestSelectSameDistance=async function(g,b){if("2d"===g.type)return g.hitTest(b);g=await g.hitTest(b);const p=g.results[0];b=g.results.findIndex(f=>f.distance!==p.distance);-1!==b&&(g.results=g.results.slice(0,b));return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../DefaultUI".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(t){t=u.call(this,t)||this;t.components=["attribution","zoom","navigation-toggle","compass"];return t}a._inheritsLoose(v,u);return v}(q);g.__decorate([k.property()],b.prototype,"components",void 0);return b=g.__decorate([d.subclass("esri.views.ui.3d.DefaultUI3D")],b)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/watchUtils ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){p.getLogger("esri.views.ui.DefaultUI");b=function(D){function z(C){C=D.call(this,C)||this;C._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};C.components=[];return C}a._inheritsLoose(z,D);var r=z.prototype;r.initialize=function(){this._handles.add([q.init(this,"components",this._componentsWatcher.bind(this)),q.init(this,"view",this._updateViewAwareWidgets.bind(this))])};r._add=function(C,
A,x,m){if("string"===typeof C&&this._defaultPositionLookup[C]){if(this._find(C))return;C=this._createComponent(C)}D.prototype._add.call(this,C,A,x,m)};r._removeComponents=function(C){C.forEach(A=>{if(A=this._find(A))this.remove(A),A.destroy()})};r._updateViewAwareWidgets=function(C){this.components.forEach(A=>{(A=(A=this._find(A))&&A.widget)&&void 0!==A.view&&(A.view=C)})};r._componentsWatcher=function(C,A){this._removeComponents(A);this._addComponents(C);this._adjustPadding(C)};r._adjustPadding=
function(C){-1!==C.indexOf("attribution")||this._isOverridden("padding")||({top:C}=this.padding,this.padding=C)};r._addComponents=function(C){this.initialized&&C.forEach(A=>this.add(this._createComponent(A),this._defaultPositionLookup[A]))};r._createComponent=function(C){const A=this._createWidget(C);if(A)return new u({id:C,node:A})};r._createWidget=function(C){if("attribution"===C)return this._createAttribution();if("compass"===C)return this._createCompass();if("navigation-toggle"===C)return this._createNavigationToggle();
if("zoom"===C)return this._createZoom()};r._createAttribution=function(){return new t({view:this.view})};r._createCompass=function(){return new l({view:this.view})};r._createNavigationToggle=function(){return new w({view:this.view})};r._createZoom=function(){return new y({view:this.view})};return z}(v);g.__decorate([k.property()],b.prototype,"components",void 0);return b=g.__decorate([d.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/domUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){b=function(v){function t(){var w=v.apply(this,arguments)||this;w.widget=null;return w}a._inheritsLoose(t,v);var l=t.prototype;l.destroy=function(){this.widget&&this.widget.destroy();this.node=null};l.castNode=function(w){if(!w)return this._set("widget",null),null;if("string"===typeof w||w&&"nodeType"in w)return this._set("widget",null),u.byId(w);w&&"function"===typeof w.render&&!w.domNode&&(w.domNode=document.createElement("div"));this._set("widget",w);return w.domNode};
a._createClass(t,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(w){const y=this._get("node");w!==y&&(w&&w.classList.add("esri-component"),y&&y.classList.remove("esri-component"),this._set("node",w))}}]);return t}(q);g.__decorate([f.property({dependsOn:[]})],b.prototype,"id",null);g.__decorate([f.property()],b.prototype,"node",null);g.__decorate([k.cast("node")],b.prototype,"castNode",null);g.__decorate([f.property({readOnly:!0})],b.prototype,
"widget",void 0);return b=g.__decorate([d.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/domUtils ../../widgets/support/widgetUtils ./Component".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){function y(C){return"object"!==typeof C||C instanceof w||"declaredClass"in C||!("component"in C||"index"in C||"position"in C)?null:C}function D(C,{top:A,bottom:x,left:m,right:B}){C.style.top=A;C.style.bottom=x;C.style.left=m;C.style.right=B}const z={left:0,top:0,bottom:0,right:0},r={bottom:30,top:15,right:15,left:15};b=function(C){function A(m){m=C.call(this,m)||this;m._cornerNameToContainerLookup={};m._positionNameToContainerLookup={};m._components=[];
m._componentToKey=new Map;m._handles=new u;m.view=null;m._initContainers();return m}a._inheritsLoose(A,C);var x=A.prototype;x.initialize=function(){this._handles.add([v.init(this,"view.padding, container",this._applyViewPadding.bind(this)),v.init(this,"padding",this._applyUIPadding.bind(this))])};x.destroy=function(){this.container=null;for(const m of this._components)m.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};x.castPadding=function(m){return"number"===
typeof m?{bottom:m,top:m,right:m,left:m}:{...r,...m}};x.add=function(m,B){let E,F;if(Array.isArray(m))m.forEach(I=>this.add(I,B));else{var G=y(m);G&&({index:E,position:B,component:m,key:F}=G);B&&"object"===typeof B&&({index:E,key:F,position:B}=B);!m||B&&!this._isValidPosition(B)||this._add(m,B,E,F)}};x.remove=function(m,B){if(m){if(Array.isArray(m))return m.map(G=>this.remove(G,B));var E=this._find(m);if(E){var F=this._componentToKey;if(!F.has(m)||F.get(m)===B)return F=this._components.indexOf(E),
E.node.parentNode&&E.node.parentNode.removeChild(E.node),this._componentToKey.delete(m),this._components.splice(F,1)[0]}}};x.empty=function(m){if(Array.isArray(m))return m.map(B=>this.empty(B)).reduce((B,E)=>B.concat(E));m=m||"manual";return"manual"===m?Array.prototype.slice.call(this._manualContainer.children).filter(B=>!B.classList.contains("esri-ui-corner")).map(B=>this.remove(B)):this._isValidPosition(m)?Array.prototype.slice.call(this._cornerNameToContainerLookup[m].children).map(this.remove,
this):null};x.move=function(m,B){Array.isArray(m)&&m.forEach(G=>this.move(G,B));if(m){var E=y(m)||y(B);if(E){var F=E.index;B=E.position;m=E.component||m}(!B||this._isValidPosition(B))&&(m=this.remove(m))&&this.add(m,{position:B,index:F})}};x.find=function(m){return m?(m=this._findById(m))&&(m.widget||m.node):null};x.getPosition=function(m){for(const B in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[B].contains(m))return B;return null};x._add=function(m,B,E,F){m instanceof
w||(m=new w({node:m}));this._place({component:m,position:B,index:E});this._components.push(m);F&&this._componentToKey.set(m,F)};x._find=function(m){return m?m instanceof w?this._findByComponent(m):"string"===typeof m?this._findById(m):this._findByNode(m.domNode||m):null};x._getViewPadding=function(){return this.get("view.padding")||z};x._attachContainers=function(m){m.appendChild(this._innerContainer);m.appendChild(this._manualContainer)};x._initContainers=function(){var m=document.createElement("div");
m.classList.add("esri-ui-inner-container");m.classList.add("esri-ui-corner-container");const B=document.createElement("div");B.classList.add("esri-ui-inner-container");B.classList.add("esri-ui-manual-container");const E=document.createElement("div");E.classList.add("esri-ui-top-left");E.classList.add("esri-ui-corner");m.appendChild(E);const F=document.createElement("div");F.classList.add("esri-ui-top-right");F.classList.add("esri-ui-corner");m.appendChild(F);const G=document.createElement("div");
G.classList.add("esri-ui-bottom-left");G.classList.add("esri-ui-corner");m.appendChild(G);const I=document.createElement("div");I.classList.add("esri-ui-bottom-right");I.classList.add("esri-ui-corner");m.appendChild(I);this._innerContainer=m;this._manualContainer=B;m=l.isRTL();this._cornerNameToContainerLookup={"top-left":E,"top-right":F,"bottom-left":G,"bottom-right":I,"top-leading":m?F:E,"top-trailing":m?E:F,"bottom-leading":m?I:G,"bottom-trailing":m?G:I};this._positionNameToContainerLookup={manual:B,
...this._cornerNameToContainerLookup}};x._isValidPosition=function(m){return!!this._positionNameToContainerLookup[m]};x._place=function(m){const B=m.component,E=m.index;m=this._positionNameToContainerLookup[m.position||"manual"];var F=-1<E,G=B.widget;G&&!G._started&&"function"===typeof G.postMixInProperties&&"function"===typeof G.buildRendering&&"function"===typeof G.postCreate&&"function"===typeof G.startup&&B.widget.startup();F?(F=Array.prototype.slice.call(m.children),0===E?m.firstChild?t.insertBefore(B.node,
m.firstChild):m.appendChild(B.node):E>=F.length?m.appendChild(B.node):t.insertBefore(B.node,F[E])):m.appendChild(B.node)};x._applyViewPadding=function(){const m=this.container;m&&D(m,this._toPxPosition(this._getViewPadding()))};x._applyUIPadding=function(){const m=this._innerContainer;m&&D(m,this._toPxPosition(this.padding))};x._toPxPosition=function(m){return{top:this._toPxUnit(m.top),left:this._toPxUnit(m.left),right:this._toPxUnit(m.right),bottom:this._toPxUnit(m.bottom)}};x._toPxUnit=function(m){return 0===
m?"0":m+"px"};x._findByComponent=function(m){let B=null,E;this._components.some(F=>{(E=F===m)&&(B=F);return E});return B};x._findById=function(m){let B=null,E;this._components.some(F=>{(E=F.id===m)&&(B=F);return E});return B};x._findByNode=function(m){let B=null,E;this._components.some(F=>{(E=F.node===m)&&(B=F);return E});return B};a._createClass(A,[{key:"container",set:function(m){const B=this._get("container");m!==B&&(m&&(m.classList.add("esri-ui"),this._attachContainers(m)),B&&(B.classList.remove("esri-ui"),
D(B,{top:"",bottom:"",left:"",right:""}),t.empty(B)),this._set("container",m))}},{key:"height",get:function(){const m=this.get("view.height")||0;if(0===m)return m;const B=this._getViewPadding();return Math.max(m-(B.top+B.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(m){m?this._override("padding",m):this._clearOverride("padding")}},{key:"width",get:function(){const m=this.get("view.width")||0;if(0===m)return m;const B=this._getViewPadding();return Math.max(m-
(B.left+B.right),0)}}]);return A}(q.EventedAccessor);g.__decorate([f.property()],b.prototype,"container",null);g.__decorate([f.property()],b.prototype,"height",null);g.__decorate([f.property({value:r})],b.prototype,"padding",null);g.__decorate([k.cast("padding")],b.prototype,"castPadding",null);g.__decorate([f.property()],b.prototype,"view",void 0);g.__decorate([f.property()],b.prototype,"width",null);return b=g.__decorate([d.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/watchUtils ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../chunks/index ./Widget ./Attribution/AttributionViewModel".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){b=function(z){function r(A,x){A=z.call(this,A,x)||this;A._isOpen=!1;A._attributionTextOverflowed=!1;A._prevSourceNodeHeight=0;A.iconClass="esri-icon-description";A.itemDelimiter=" | ";A.label=void 0;A.messages=null;A.view=null;A.viewModel=new D;return A}a._inheritsLoose(r,z);var C=r.prototype;C.initialize=function(){this.own(u.on(this,"viewModel.items","change",()=>this.scheduleRender()))};C.render=function(){return w.jsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};C.renderPoweredBy=function(){return w.jsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",w.jsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};C.renderSourcesNode=function(){const A=this._isOpen,x=this._isInteractive(),m=x?0:-1,{attributionText:B}=
this,E=x?"button":void 0;return w.jsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:A,["esri-interactive"]:x}),innerHTML:B,role:E,tabIndex:m})};C._afterSourcesNodeCreate=function(A){this._prevSourceNodeHeight=A.clientWidth};C._afterSourcesNodeUpdate=function(A){let x=!1;const {clientHeight:m,clientWidth:B,scrollWidth:E}=A;A=E>=B;const F=this._attributionTextOverflowed!==
A;this._attributionTextOverflowed=A;F&&(x=!0);this._isOpen&&(A=m<this._prevSourceNodeHeight,this._prevSourceNodeHeight=m,A&&(this._isOpen=!1,x=!0));x&&this.scheduleRender()};C._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};C._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a._createClass(r,[{key:"attributionText",get:function(){return this.viewModel.items.reduce((A,x)=>{-1===A.indexOf(x.text)&&A.push(x.text);return A},[]).join(this.itemDelimiter)}}]);
return r}(y);g.__decorate([k.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],b.prototype,"attributionText",null);g.__decorate([k.property()],b.prototype,"iconClass",void 0);g.__decorate([k.property()],b.prototype,"itemDelimiter",void 0);g.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);g.__decorate([k.property(),l.messageBundle("esri/widgets/Attribution/t9n/Attribution")],b.prototype,"messages",void 0);g.__decorate([c.aliasOf("viewModel.view")],
b.prototype,"view",void 0);g.__decorate([k.property({type:D})],b.prototype,"viewModel",void 0);g.__decorate([t.accessibleHandler()],b.prototype,"_toggleState",null);return b=g.__decorate([e.subclass("esri.widgets.Attribution")],b)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/support/contains ../../geometry ../../core/Collection ../../core/asyncUtils ../../core/watchUtils ../../core/HandleOwner".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){function z(x,m){return x&&"copyright"in x&&(!m||"function"===typeof x.originOf&&"user"===x.originOf("copyright"))}function r(x,m){return x.length!==m.length||x.some((B,E)=>B.text!==m[E].text)}function C(x,m,B){B&&m&&(x.find(E=>E.layerView===m&&E.text===B)||x.push({text:B,layerView:m}))}const A=[];b=function(x){function m(E){var F=x.call(this,E)||this;F.clear=()=>{F._fetchedAttributionData.clear();F._pendingAttributions.clear();F.handles.remove("suspension");
F.notifyChange("state")};F._pendingAttributions=new Set;F._fetchedAttributionData=new Map;F.items=new l;F.view=null;F._allLayerViewsChange=G=>{F.handles.remove("suspension");const I=F.get("view.allLayerViews");I&&F.handles.add(I.map(K=>K.watch(["suspended","attributionVisible"],F._updateAttributionItems)),"suspension");G&&G.removed&&G.removed.forEach(K=>{F._pendingAttributions.delete(K);F._fetchedAttributionData.delete(K)});F._updateAttributionItems()};F._updateAttributionItems=()=>{const G=F.get("view.allLayerViews");
A.length=0;G?(G.forEach(I=>{if(!I.suspended&&I.get("layer.attributionVisible")){var K=I.layer;if(z(K,"user"))C(A,I,K.copyright);else if(K.hasAttributionData)if(F._fetchedAttributionData.has(I)){var J=F._fetchedAttributionData.get(I);J?C(A,I,F._getDynamicAttribution(J,F.view,K)):z(K)&&C(A,I,K.copyright)}else F._fetchAttributionData(I);else(J=K.get("portalItem.accessInformation"))?C(A,I,J):C(A,I,K.copyright)}}),r(F.items,A)&&(F.items.removeAll(),F.items.addMany(A)),A.length=0,F.notifyChange("state")):
F.clear()};F.handles.add([y.on(a._assertThisInitialized(F),"view.allLayerViews","change",F._allLayerViewsChange,F._allLayerViewsChange,F.clear),y.whenTrue(a._assertThisInitialized(F),"view.stationary",()=>F._updateAttributionItems())]);return F}a._inheritsLoose(m,x);var B=m.prototype;B.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};B._fetchAttributionData=async function(E){if(!this._pendingAttributions.has(E)){this._pendingAttributions.add(E);
var F=await w.result(E.layer.fetchAttributionData());this._pendingAttributions.has(E)&&(F=F.ok?this._createContributionIndex(F.value,"bing-maps"===E.layer.type):null,this._pendingAttributions.delete(E),this._fetchedAttributionData.set(E,F));this._updateAttributionItems()}};B._createContributionIndex=function(E,F){E=E.contributors;const G={};if(!E)return G;for(let L=0;L<E.length;L++){const P=E[L];var I=P.coverageAreas;if(!I)return;for(const Q of I){var K=Q.bbox,J=Q.zoomMin-(F&&Q.zoomMin?1:0);I=Q.zoomMax-
(F&&Q.zoomMax?1:0);for(K={extent:u.geographicToWebMercator({xmin:K[1],ymin:K[0],xmax:K[3],ymax:K[2],spatialReference:q.WGS84}),attribution:P.attribution||"",score:null!=Q.score?Q.score:100,id:L};J<=I;J++)G[J]=G[J]||[],G[J].push(K)}}G.maxKey=Math.max.apply(null,Object.keys(G));return G};B._getDynamicAttribution=function(E,F,G){const {extent:I,scale:K}=F;G=G.tileInfo.scaleToZoom(K);G=Math.min(E.maxKey,Math.round(G));if(!I||null==G||-1>=G)return"";E=E[G];const J=u.project(I.center.clone().normalize(),
F.spatialReference),L={};return E?E.filter(P=>{const Q=!L[P.id]&&J&&v.extentContainsPoint(P.extent,J);Q&&(L[P.id]=!0);return Q}).sort((P,Q)=>Q.score-P.score||P.objectId-Q.objectId).map(P=>P.attribution).join(", "):""};a._createClass(m,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return m}(D.HandleOwner);g.__decorate([k.property({readOnly:!0,type:l})],b.prototype,"items",void 0);g.__decorate([k.property({readOnly:!0})],
b.prototype,"state",null);g.__decorate([k.property()],b.prototype,"view",void 0);return b=g.__decorate([d.subclass("esri.widgets.Attribution.AttributionViewModel")],b)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../chunks/index ./Widget ./Compass/CompassViewModel".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){b=function(D){function z(C,A){C=D.call(this,C,A)||this;C.goToOverride=null;C.iconClass="esri-icon-locate-circled";C.label=void 0;C.messages=null;C.view=null;C.viewModel=new y;return C}a._inheritsLoose(z,D);var r=z.prototype;r.reset=function(){return this.viewModel.reset()};r.render=function(){const {orientation:C,state:A}=this.viewModel;var x="disabled"===A,m="compass"===("rotation"===A?"rotation":"compass");const B=x?-1:0;x={["esri-disabled"]:x,["esri-interactive"]:!x};
m={["esri-icon-compass"]:m,["esri-icon-dial"]:!m};const {messages:E}=this;return l.jsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",x),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:B,"aria-label":E.reset,title:E.reset},l.jsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",m),styles:this._toRotationTransform(C)}),l.jsx("span",{class:"esri-icon-font-fallback-text"},E.reset))};r._reset=function(){this.viewModel.reset()};r._toRotationTransform=
function(C){return{transform:`rotateZ(${C.z}deg)`}};return z}(w);g.__decorate([c.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);g.__decorate([k.property()],b.prototype,"iconClass",void 0);g.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);g.__decorate([k.property(),t.messageBundle("esri/widgets/Compass/t9n/Compass")],b.prototype,"messages",void 0);g.__decorate([c.aliasOf("viewModel.view")],b.prototype,"view",void 0);
g.__decorate([k.property({type:y})],b.prototype,"viewModel",void 0);g.__decorate([v.accessibleHandler()],b.prototype,"_reset",null);return b=g.__decorate([e.subclass("esri.widgets.Compass")],b)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/Handles ../../core/watchUtils ../support/GoTo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=function(l){function w(D){D=l.call(this,D)||this;D._handles=new u;D.orientation={x:0,y:0,z:0};D.view=null;D._updateForCamera=D._updateForCamera.bind(a._assertThisInitialized(D));D._updateForRotation=D._updateForRotation.bind(a._assertThisInitialized(D));D._updateRotationWatcher=D._updateRotationWatcher.bind(a._assertThisInitialized(D));return D}a._inheritsLoose(w,l);var y=w.prototype;y.initialize=function(){this._handles.add(v.init(this,"view",this._updateRotationWatcher))};
y.destroy=function(){this._handles.destroy();this.view=this._handles=null};y.reset=function(){if(this.get("view.ready")){var D={};"2d"===this.view.type?D.rotation=0:D.heading=0;this.callGoTo({target:D})}};y._updateForRotation=function(D){void 0!==D&&null!==D&&(this.orientation={z:D})};y._updateForCamera=function(D){D&&(this.orientation={x:0,y:0,z:-D.heading})};y._updateRotationWatcher=function(D){this._handles.removeAll();D&&("2d"===D.type?this._handles.add(v.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(v.init(this,"view.camera",this._updateForCamera)))};a._createClass(w,[{key:"canShowNorth",get:function(){const D=this.get("view.spatialReference");return!(!D||!D.isWebMercator&&!D.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return w}(t.GoToMixin(q));g.__decorate([k.property({readOnly:!0})],b.prototype,"canShowNorth",null);g.__decorate([k.property()],b.prototype,"orientation",void 0);g.__decorate([k.property({readOnly:!0})],
b.prototype,"state",null);g.__decorate([k.property()],b.prototype,"view",void 0);return b=g.__decorate([d.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../chunks/index ./Widget ./NavigationToggle/NavigationToggleViewModel".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){b=function(D){function z(C,A){C=D.call(this,C,A)||this;C.iconClass="esri-icon-pan2";C.label=void 0;C.messages=null;C.view=null;C.viewModel=new y;return C}a._inheritsLoose(z,D);var r=z.prototype;r.toggle=function(){return this.viewModel.toggle()};r.render=function(){const C="disabled"===this.get("viewModel.state");var A="pan"===this.get("viewModel.navigationMode");const x={["esri-navigation-toggle__button--active"]:A};A={["esri-navigation-toggle__button--active"]:!A};
const m=C?-1:0,B=this.messages.toggle;return l.jsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:C,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:m,"aria-label":B,title:B},l.jsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",x)},l.jsx("span",{class:"esri-icon-pan"})),l.jsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",A)},l.jsx("span",{class:"esri-icon-rotate"})))};r._toggle=function(){this.toggle()};a._createClass(z,[{key:"layout",set:function(C){"horizontal"!==C&&(C="vertical");this._set("layout",C)}}]);return z}(w);g.__decorate([k.property()],b.prototype,"iconClass",void 0);g.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);g.__decorate([k.property({value:"vertical"})],b.prototype,"layout",null);g.__decorate([k.property(),
t.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],b.prototype,"messages",void 0);g.__decorate([c.aliasOf("viewModel.view")],b.prototype,"view",void 0);g.__decorate([k.property({type:y})],b.prototype,"viewModel",void 0);g.__decorate([v.accessibleHandler()],b.prototype,"_toggle",null);return b=g.__decorate([e.subclass("esri.widgets.NavigationToggle")],b)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/Handles ../../core/watchUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){b=function(t){function l(y){y=t.call(this,y)||this;y._handles=new u;y.navigationMode="pan";y.view=null;return y}a._inheritsLoose(l,t);var w=l.prototype;w.initialize=function(){this._handles.add(v.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};w.destroy=function(){this._handles.destroy();this.view=this._handles=null};w.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
w._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(l,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return l}(q);g.__decorate([k.property({readOnly:!0})],b.prototype,"state",null);g.__decorate([k.property()],b.prototype,"navigationMode",void 0);g.__decorate([k.property()],b.prototype,"view",void 0);return b=g.__decorate([d.subclass("esri.widgets.NavigationToggleViewModel")],
b)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/messageBundle ../chunks/index ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){b=function(D){function z(C,A){C=D.call(this,C,A)||this;C.iconClass="esri-icon-zoom-in-magnifying-glass";C.label=void 0;C.messages=null;C.view=null;C.viewModel=new y;return C}a._inheritsLoose(z,D);var r=z.prototype;r.initialize=function(){this._zoomInButton=new w({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new w({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};r.destroy=function(){this._zoomInButton.destroy();
this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=null};r.render=function(){const C=this.viewModel,A={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===C.state&&C.canZoomIn;this._zoomOutButton.enabled="ready"===C.state&&C.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return t.jsx("div",{class:this.classes("esri-zoom esri-widget",A)},this._zoomInButton.render(),this._zoomOutButton.render())};
r.zoomIn=function(){return this.viewModel.zoomIn()};r.zoomOut=function(){return this.viewModel.zoomOut()};a._createClass(z,[{key:"layout",set:function(C){"horizontal"!==C&&(C="vertical");this._set("layout",C)}}]);return z}(l);g.__decorate([k.property()],b.prototype,"iconClass",void 0);g.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);g.__decorate([k.property({value:"vertical"})],b.prototype,"layout",null);g.__decorate([k.property(),v.messageBundle("esri/widgets/Zoom/t9n/Zoom")],
b.prototype,"messages",void 0);g.__decorate([c.aliasOf("viewModel.view")],b.prototype,"view",void 0);g.__decorate([k.property({type:y})],b.prototype,"viewModel",void 0);return b=g.__decorate([e.subclass("esri.widgets.Zoom")],b)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../support/widgetUtils ../support/decorators/accessibleHandler ../../chunks/index ../Widget".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=function(l){function w(){var D=l.apply(this,arguments)||this;D.enabled=!0;D.iconClass="";D.title="";return D}a._inheritsLoose(w,l);var y=w.prototype;y.render=function(){const D=this.enabled?0:-1,z={[this.iconClass]:!!this.iconClass};return v.jsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:D,
title:this.title},v.jsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",z)}),v.jsx("span",{class:"esri-icon-font-fallback-text"},this.title))};y._triggerAction=function(){this.action.call(this)};return w}(t);g.__decorate([k.property()],b.prototype,"action",void 0);g.__decorate([k.property()],b.prototype,"enabled",void 0);g.__decorate([k.property()],b.prototype,"iconClass",void 0);g.__decorate([k.property()],b.prototype,"title",void 0);g.__decorate([u.accessibleHandler()],
b.prototype,"_triggerAction",null);return b=g.__decorate([d.subclass("esri.widgets.IconButton")],b)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/Accessor ./ZoomConditions2D ./ZoomConditions3D".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=function(l){function w(D){D=l.call(this,D)||this;D.canZoomIn=!1;D.canZoomOut=!1;return D}a._inheritsLoose(w,l);var y=w.prototype;y.destroy=function(){this.view=null};y.zoomIn=function(){if(this.canZoomIn){var D=this.view;"2d"===D.type?D.mapViewNavigation.zoomIn():q.ignoreAbortErrors(D.goTo({zoomFactor:2}))}};y.zoomOut=function(){if(this.canZoomOut){var D=this.view;"2d"===D.type?D.mapViewNavigation.zoomOut():q.ignoreAbortErrors(D.goTo({zoomFactor:.5}))}};a._createClass(w,
[{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(D){D?"2d"===D.type?this._zoomConditions=new v({view:D}):"3d"===D.type&&(this._zoomConditions=new t({view:D})):this._zoomConditions=null;this._set("view",D)}}]);return w}(u);g.__decorate([k.property()],b.prototype,"_zoomConditions",void 0);g.__decorate([k.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],b.prototype,"canZoomIn",void 0);g.__decorate([k.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],b.prototype,"canZoomOut",void 0);g.__decorate([k.property({readOnly:!0})],b.prototype,"state",null);g.__decorate([k.property()],b.prototype,"view",null);return b=g.__decorate([d.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(){return u.apply(this,arguments)||this}a._inheritsLoose(v,u);a._createClass(v,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),l=this.get("view.constraints.effectiveMaxScale");return 0===l||t>l}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),l=this.get("view.constraints.effectiveMinScale");
return 0===l||t<l}}]);return v}(q);g.__decorate([k.property({readOnly:!0})],b.prototype,"canZoomIn",null);g.__decorate([k.property({readOnly:!0})],b.prototype,"canZoomOut",null);g.__decorate([k.property()],b.prototype,"view",void 0);return b=g.__decorate([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(){return u.apply(this,arguments)||this}a._inheritsLoose(v,u);a._createClass(v,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return v}(q);g.__decorate([k.property({readOnly:!0})],b.prototype,"canZoomIn",null);g.__decorate([k.property({readOnly:!0})],b.prototype,"canZoomOut",null);g.__decorate([k.property()],b.prototype,"view",void 0);return b=g.__decorate([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],
b)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/utils ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ./support/fieldUtils ../PopupTemplate ../request ./Layer ../renderers/Renderer ../renderers/ClassBreaksRenderer ../renderers/UniqueValueRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/SimpleRenderer ../renderers/support/types ../renderers/support/jsonUtils ../core/MultiOriginJSONSupport ../core/watchUtils ./support/commonProperties ./mixins/OperationalLayer ./support/FieldsIndex ./mixins/ArcGISService ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/FeatureReduction ./support/LabelClass ./support/FeatureReductionSelection ./support/fieldProperties ./support/labelingInfo ./support/LayerFloorInfo ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query ./support/capabilities ./support/I3SLayerDefinitions ./mixins/SceneService ./support/FetchAssociatedFeatureLayer ./support/RangeInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O,V,ba,fa,ia,ma){const ea=["3DObject","Point"],M=k.getLogger("esri.layers.SceneLayer");p=W.defineFieldProperties();r=function(ka){function ha(...da){da=ka.call(this,...da)||this;da.featureReduction=null;da.rangeInfos=null;da.operationalLayerType="ArcGISSceneServiceLayer";da.type="scene";da.fields=null;da.floorInfo=null;da.outFields=null;da.nodePages=null;da.materialDefinitions=null;da.textureSetDefinitions=
null;da.geometryDefinitions=null;da.serviceUpdateTimeStamp=null;da.definitionExpression=null;da.path=null;da.labelsVisible=!0;da.labelingInfo=null;da.legendEnabled=!0;da.cachedDrawingInfo={color:!1};da.editingEnabled=!0;da.popupEnabled=!0;da.popupTemplate=null;da.objectIdField=null;da.globalIdField=null;da._fieldUsageInfo={};da.screenSizePerspectiveEnabled=!0;return da}g._inheritsLoose(ha,ka);var na=ha.prototype;na.normalizeCtorArgs=function(da,oa){return"string"===typeof da?{url:da,...oa}:da};na.getField=
function(da){return this.fieldsIndex.get(da)};na.getFieldDomain=function(da){return(da=this.getField(da))&&da.domain?da.domain:null};na.readNodePages=function(da,oa,qa){"Point"===oa.layerType&&(da=oa.pointNodePages);return null==da||"object"!==typeof da?null:ba.I3SNodePageDefinition.fromJSON(da,qa)};na.readCachedDrawingInfo=function(da){if(null==da||"object"!==typeof da)da={};null==da.color&&(da.color=!1);return da};na.readObjectIdField=function(da,oa){!da&&oa.fields&&oa.fields.some(qa=>{"esriFieldTypeOID"===
qa.type&&(da=qa.name);return!!da});return da||void 0};na.readGlobalIdField=function(da,oa){!da&&oa.fields&&oa.fields.some(qa=>{"esriFieldTypeGlobalID"===qa.type&&(da=qa.name);return!!da});return da||void 0};na.readProfile=function(da,oa){da=oa.store.profile;if(null!=da&&Z[da])return Z[da];M.error("Unknown or missing profile",{profile:da,layer:this});return"mesh-pyramids"};na.load=function(da){const oa=f.isSome(da)?da.signal:null;da=this.loadFromPortal({supportedTypes:["Scene Service"]},da).catch(w.throwIfAbortError).then(()=>
this._fetchService(oa)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,oa),this._setAssociatedFeatureLayer(oa)])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>N.loadStyleRenderer(this,{origin:"service"},oa)).then(()=>y.fixRendererFields(this.renderer,this.fields));this.addResolvingPromise(da);return Promise.resolve(this)};na.createQuery=function(){const da=new O;"mesh"!==this.geometryType&&
(da.returnGeometry=!0,da.returnZ=!0);da.where=this.definitionExpression||"1\x3d1";da.sqlFormat="standard";return da};na.queryExtent=function(da,oa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryExtent(da||this.createQuery(),oa))};na.queryFeatureCount=function(da,oa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryFeatureCount(da||this.createQuery(),oa))};na.queryFeatures=function(da,oa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryFeatures(da||this.createQuery(),
oa)).then(qa=>{if(qa&&qa.features)for(const ua of qa.features)ua.layer=this,ua.sourceLayer=this;return qa})};na.queryObjectIds=function(da,oa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryObjectIds(da||this.createQuery(),oa))};na.getFieldUsageInfo=function(da){const oa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[da]||oa:(M.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),oa)};na.createPopupTemplate=
function(da){return ca.createPopupTemplate(this,da)};na._getAssociatedLayerForQuery=function(){const da=this.associatedLayer;return f.isSome(da)&&da.loaded?Promise.resolve(da):this._loadAssociatedLayerForQuery()};na._loadAssociatedLayerForQuery=async function(){await this.load();if(f.isNone(this.associatedLayer))throw new u("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(da){throw new u("scenelayer:query-not-available",
"SceneLayer associated feature layer could not be loaded",{layer:this,error:da});}return this.associatedLayer};na.hasCachedStatistics=function(da){return null!=this.statisticsInfo&&this.statisticsInfo.some(oa=>oa.name===da)};na.queryCachedStatistics=async function(da,oa){await this.load(oa);if(!this.statisticsInfo)throw new u("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const qa=this.fieldsIndex.get(da);if(!qa)throw new u("scenelayer:field-unexisting",`Field '${da}' does not exist on the layer`);
for(const ua of this.statisticsInfo)if(ua.name===qa.name)return da=v.join(this.parsedUrl.path,ua.href),z(da,{query:{f:"json"},responseType:"json",signal:oa?oa.signal:null}).then(Ca=>Ca.data);throw new u("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");};na.saveAs=async function(da,oa){return this._debouncedSaveOperations(1,{...oa,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},da)};na.save=async function(){return this._debouncedSaveOperations(0,
{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})};na.applyEdits=async function(da,oa){const qa=await new Promise(function(ua,Ca){a(["./graphics/editingSupport"],ua,Ca)});await this.load();if(f.isNone(this.associatedLayer))throw new u(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return qa.applyEdits(this,this.associatedLayer.source,da,oa)};na.on=function(da,oa){return ka.prototype.on.call(this,da,oa)};na.validateLayer=function(da){if(da.layerType&&
-1===ea.indexOf(da.layerType))throw new u("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:da.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new u("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new u("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});{da=this.normalReferenceFrame;var oa=this.spatialReference;let qa=!1,ua=!1;if(null==da)ua=qa=!0;else switch(oa=oa&&oa.isGeographic,da){case "east-north-up":case "earth-centered":qa=!0;ua=oa;break;case "vertex-reference-frame":qa=!0;ua=!oa;break;default:qa=!1}if(!qa)throw new u("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!ua)throw new u("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
}};na._getTypeKeywords=function(){const da=[];if("points"===this.profile)da.push("Point");else if("mesh-pyramids"===this.profile)da.push("3DObject");else throw new u("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return da};na._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const da of this.fields){const oa=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(ua=>ua.name===da.name)),qa=!!(f.isSome(this.associatedLayer)&&
this.associatedLayer.fields&&this.associatedLayer.fields.some(ua=>ua&&da.name===ua.name));this._fieldUsageInfo[da.name]={supportsLabelingInfo:oa,supportsRenderer:oa,supportsPopupTemplate:oa||qa,supportsLayerQuery:qa}}};na._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};na._applyAssociatedLayerFieldsOverrides=function(){if(!f.isNone(this.associatedLayer)&&this.associatedLayer.fields){var da=null;for(const oa of this.associatedLayer.fields){const qa=
this.getField(oa.name);qa?(!qa.domain&&oa.domain&&(qa.domain=oa.domain.clone()),qa.editable=oa.editable,qa.nullable=oa.nullable,qa.length=oa.length):(da||(da=this.fields?this.fields.slice():[]),da.push(oa.clone()))}da&&this._set("fields",da)}};na._applyAssociatedLayerPopupOverrides=function(){if(!f.isNone(this.associatedLayer)){var da=["popupTemplate","popupEnabled"],oa=d.getProperties(this);for(let qa=0;qa<da.length;qa++){const ua=da[qa];this._buddyIsMoreImportant(ua)&&(oa.setDefaultOrigin(this.associatedLayer.originOf(ua)),
oa.set(ua,this.associatedLayer[ua]),oa.setDefaultOrigin("user"))}}};na._setAssociatedFeatureLayer=async function(da){if(-1!==["mesh-pyramids","points"].indexOf(this.profile)){da=new ia.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,da);try{this.associatedLayer=await da.fetch()}catch(oa){w.isAbortError(oa)||this._logWarningOnPopupEnabled()}}};na._logWarningOnPopupEnabled=function(){J.whenValidOnce(this,["popupTemplate","popupEnabled"],()=>this.popupEnabled&&null!=this.popupTemplate).then(()=>
()=>{const da=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?M.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${da}`):M.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${da}`)})};na._buddyIsMoreImportant=function(da){if(f.isNone(this.associatedLayer))return!1;const oa=this.originIdOf(da);da=this.associatedLayer.originIdOf(da);return null!=da&&2>=da?null==oa||2>oa:null!=da&&
3>=da?null==oa||3>oa:!1};na._validateElevationInfo=function(){const da=this.elevationInfo;da&&("mesh-pyramids"===this.profile&&"absolute-height"!==da.mode&&M.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),da.featureExpressionInfo&&"0"!==da.featureExpressionInfo.expression&&M.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};g._createClass(ha,[{key:"fieldsIndex",get:function(){return new Q(this.fields)}},{key:"elevationInfo",
set:function(da){this._set("elevationInfo",da);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return la[this.profile]||"mesh"}},{key:"renderer",set:function(da){y.fixRendererFields(da,this.fields);this._set("renderer",da)}},{key:"capabilities",get:function(){var da=f.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:V.zeroCapabilities;const {query:oa,editing:{supportsGlobalId:qa,supportsRollbackOnFailure:ua,supportsUploadWithItemId:Ca},
data:{supportsZ:Ja,supportsM:Ha,isVersioned:Na},operations:{supportsEditing:Oa,supportsUpdate:Va}}=da;da=da.operations.supportsChangeTracking;return{query:oa,editing:{supportsGlobalId:qa,supportsRollbackOnFailure:ua,supportsGeometryUpdate:!1,supportsUploadWithItemId:Ca},data:{supportsZ:Ja,supportsM:Ha,isVersioned:Na},operations:{supportsEditing:Oa&&da,supportsAdd:!1,supportsDelete:!1,supportsUpdate:Va&&da}}}},{key:"defaultPopupTemplate",get:function(){return f.isSome(this.associatedLayer)||this.attributeStorageInfo?
this.createPopupTemplate():null}},{key:"displayField",get:function(){return f.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return ha}(fa.SceneService(X.ArcGISService(P.OperationalLayer(aa.PortalLayer(S.ScaleRangeLayer(K.MultiOriginJSONMixin(r)))))));b.__decorate([e.property({types:{key:"type",base:H["default"],typeMap:{selection:T}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],
r.prototype,"featureReduction",void 0);b.__decorate([e.property({type:[ma["default"]],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],r.prototype,"rangeInfos",void 0);b.__decorate([e.property({json:{read:!1}})],r.prototype,"associatedLayer",void 0);b.__decorate([e.property({type:["show","hide"]})],r.prototype,"listMode",void 0);b.__decorate([e.property({type:["ArcGISSceneServiceLayer"]})],r.prototype,"operationalLayerType",
void 0);b.__decorate([e.property({json:{read:!1},readOnly:!0})],r.prototype,"type",void 0);b.__decorate([e.property({...p.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],r.prototype,"fields",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"fieldsIndex",null);b.__decorate([e.property({type:U,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],r.prototype,"floorInfo",void 0);b.__decorate([e.property(p.outFields)],r.prototype,"outFields",
void 0);b.__decorate([e.property({type:ba.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],r.prototype,"nodePages",void 0);b.__decorate([n.reader("service","nodePages",["nodePages","pointNodePages"])],r.prototype,"readNodePages",null);b.__decorate([e.property({type:[ba.I3SMaterialDefinition],readOnly:!0})],r.prototype,"materialDefinitions",void 0);b.__decorate([e.property({type:[ba.I3STextureSetDefinition],readOnly:!0})],r.prototype,"textureSetDefinitions",void 0);b.__decorate([e.property({type:[ba.I3SGeometryDefinition],
readOnly:!0})],r.prototype,"geometryDefinitions",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"attributeStorageInfo",void 0);b.__decorate([e.property({readOnly:!0})],r.prototype,"statisticsInfo",void 0);b.__decorate([e.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:!0}})],r.prototype,"definitionExpression",void 0);b.__decorate([e.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],r.prototype,"path",void 0);b.__decorate([e.property(L.elevationInfo)],r.prototype,"elevationInfo",null);b.__decorate([e.property({type:String})],r.prototype,"geometryType",null);b.__decorate([e.property(L.labelsVisible)],r.prototype,"labelsVisible",void 0);b.__decorate([e.property({type:[R],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:Y.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Y.reader},
write:!0}})],r.prototype,"labelingInfo",void 0);b.__decorate([e.property(L.legendEnabled)],r.prototype,"legendEnabled",void 0);b.__decorate([e.property(L.opacityDrawingInfo)],r.prototype,"opacity",void 0);b.__decorate([e.property({types:G.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],r.prototype,"renderer",null);b.__decorate([e.property({json:{read:!1}})],r.prototype,"cachedDrawingInfo",void 0);
b.__decorate([n.reader("service","cachedDrawingInfo")],r.prototype,"readCachedDrawingInfo",null);b.__decorate([e.property({readOnly:!0,json:{read:!1}})],r.prototype,"capabilities",null);b.__decorate([e.property({type:Boolean,json:{read:!1}})],r.prototype,"editingEnabled",void 0);b.__decorate([e.property(L.popupEnabled)],r.prototype,"popupEnabled",void 0);b.__decorate([e.property({type:D,json:{name:"popupInfo",write:!0}})],r.prototype,"popupTemplate",void 0);b.__decorate([e.property({readOnly:!0,json:{read:!1}})],
r.prototype,"defaultPopupTemplate",null);b.__decorate([e.property({type:String,json:{read:!1}})],r.prototype,"objectIdField",void 0);b.__decorate([n.reader("service","objectIdField",["objectIdField","fields"])],r.prototype,"readObjectIdField",null);b.__decorate([e.property({type:String,json:{read:!1}})],r.prototype,"globalIdField",void 0);b.__decorate([n.reader("service","globalIdField",["globalIdField","fields"])],r.prototype,"readGlobalIdField",null);b.__decorate([e.property({readOnly:!0,type:String,
json:{read:!1}})],r.prototype,"displayField",null);b.__decorate([e.property({type:String,json:{read:!1}})],r.prototype,"profile",void 0);b.__decorate([n.reader("service","profile",["store.profile"])],r.prototype,"readProfile",null);b.__decorate([e.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],r.prototype,"normalReferenceFrame",void 0);b.__decorate([e.property(L.screenSizePerspectiveEnabled)],r.prototype,"screenSizePerspectiveEnabled",
void 0);r=b.__decorate([q.subclass("esri.layers.SceneLayer")],r);const Z={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},la={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return r})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={attachment:{supportsContentType:!1,
supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,
supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,
supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){a.I3SNodePageDefinition=function(v){function t(){var l=v.apply(this,arguments)||this;l.nodesPerPage=null;l.rootIndex=0;l.lodSelectionMetricType=null;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([c.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([c.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=b.__decorate([e.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(v){function t(){var l=v.apply(this,arguments)||this;l.factor=1;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=b.__decorate([e.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(v){function t(){var l=v.apply(this,arguments)||this;l.baseColorFactor=[1,1,1,1];l.baseColorTexture=null;l.metallicRoughnessTexture=null;l.metallicFactor=1;l.roughnessFactor=1;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
b.__decorate([e.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(v){function t(){var l=v.apply(this,arguments)||this;l.alphaMode="opaque";l.alphaCutoff=.25;l.doubleSided=!1;l.cullFace="none";l.normalTexture=null;l.occlusionTexture=null;l.emissiveTexture=null;l.emissiveFactor=null;l.pbrMetallicRoughness=null;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([d.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([c.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([c.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);b.__decorate([d.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([c.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([c.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([c.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([e.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(v){function t(){return v.apply(this,arguments)||this}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:String,json:{read:{source:["name","index"],reader:(v,t)=>null!=v?v:`${t.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);b.__decorate([d.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([e.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(v){function t(){var l=v.apply(this,arguments)||this;l.atlas=!1;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([c.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([e.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(v){function t(){return v.apply(this,arguments)||this}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([d.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([c.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=b.__decorate([e.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(v){function t(){return v.apply(this,arguments)||this}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([d.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([c.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([e.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(v){function t(){var l=v.apply(this,arguments)||this;l.offset=0;return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([c.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([c.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=b.__decorate([e.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(v){function t(){return v.apply(this,arguments)||this}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([d.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([c.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
b.__decorate([e.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../../portal/Portal ../../portal/PortalItem ../../core/accessorSupport/originUtils ../support/arcgisLayerUrl ../../geometry/HeightModelInfo ../../webdoc/support/saveUtils ../support/commonProperties ../support/I3SIndexInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G){const I=c.getLogger("esri.layers.mixins.SceneService"),K={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};g.SCENE_SERVICE_ITEM_TYPE="Scene Service";g.SceneService=J=>{J=function(L){function P(){var X=L.apply(this,arguments)||this;X.spatialReference=null;X.fullExtent=null;X.heightModelInfo=null;X.minScale=0;X.maxScale=0;X.version={major:Number.NaN,minor:Number.NaN,
versionString:""};X.copyright=null;X.sublayerTitleMode="item-title";X.title=null;X.layerId=null;X.indexInfo=null;X._debouncedSaveOperations=y.debounce(async(aa,S,H)=>{switch(aa){case 0:return X._save(S);case 1:return X._saveAs(H,S)}});return X}b._inheritsLoose(P,L);var Q=P.prototype;Q.readSpatialReference=function(X,aa){return this._readSpatialReference(aa)};Q._readSpatialReference=function(X){if(null!=X.spatialReference)return D.fromJSON(X.spatialReference);X=X.store;X=(X=X.indexCRS||X.geographicCRS)&&
parseInt(X.substring(X.lastIndexOf("/")+1,X.length),10);return null!=X?new D(X):null};Q.readFullExtent=function(X,aa,S){if(null!=X&&"object"===typeof X)return z.fromJSON(X,S);X=aa.store;aa=this._readSpatialReference(aa);return null==aa||null==X||null==X.extent||!Array.isArray(X.extent)||X.extent.some(H=>-1E38>H)?null:new z({xmin:X.extent[0],ymin:X.extent[1],xmax:X.extent[2],ymax:X.extent[3],spatialReference:aa})};Q.readVersion=function(X,aa){X=aa.store;aa=null!=X.version?X.version.toString():"";X=
{major:Number.NaN,minor:Number.NaN,versionString:aa};aa=aa.split(".");2<=aa.length&&(X.major=parseInt(aa[0],10),X.minor=parseInt(aa[1],10));return X};Q.readTitlePortalItem=function(X){return"item-title"!==this.sublayerTitleMode?void 0:X};Q.readTitleService=function(X,aa){X=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return m.titleFromUrlAndName(this.url,aa.name);aa=aa.name;if(!aa&&this.url){const S=m.parse(this.url);k.isSome(S)&&(aa=S.title)}"item-title-and-service-name"===
this.sublayerTitleMode&&X&&(aa=X+" - "+aa);return m.cleanTitle(aa)};Q.writeUrl=function(X,aa,S,H){m.writeUrlWithLayerId(this,X,"layers",aa,H)};Q._fetchIndexAndUpdateExtent=async function(X,aa){this.indexInfo=G.fetchIndexInfo(this.parsedUrl.path,this.rootNode,X,I,aa);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)};Q._updateExtent=function(X){if("page"===(null==X?void 0:X.type)){var aa,S,H=X.rootIndex%X.pageSize;X=null==(aa=X.rootPage)?void 0:null==(S=aa.nodes)?
void 0:S[H];if(null==X||null==X.obb||null==X.obb.center||null==X.obb.halfSize)throw new v("sceneservice:invalid-node-page","Invalid node page.");-1E38>X.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(aa=X.obb.halfSize,S=X.obb.center[2],aa=Math.sqrt(aa[0]*aa[0]+aa[1]*aa[1]+aa[2]*aa[2]),this.fullExtent.zmin=S-aa,this.fullExtent.zmax=S+aa)}else"node"===(null==X?void 0:X.type)&&(S=null==(H=X.rootNode)?void 0:H.mbs,!Array.isArray(S)||4!==S.length||-1E38>S[0]||(aa=S[2],S=S[3],this.fullExtent.zmin=
aa-S,this.fullExtent.zmax=aa+S))};Q._fetchService=async function(X){if(null==this.url)throw new v("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const aa=await this._fetchFirstLayerId(X);null!=aa&&(this.layerId=aa)}return this._fetchServiceLayer(X)};Q._fetchFirstLayerId=async function(X){X=await r(this.url,{query:{f:"json"},responseType:"json",signal:X});if(X.data&&Array.isArray(X.data.layers)&&
0<X.data.layers.length)return X.data.layers[0].id};Q._fetchServiceLayer=async function(X){X=await r(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:X});X.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));X=X.data;this.read(X,{origin:"service",url:this.parsedUrl});this.validateLayer(X)};Q._ensureLoadBeforeSave=async function(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()};Q.validateLayer=function(X){};Q._updateTypeKeywords=
function(X,aa,S){X.typeKeywords||(X.typeKeywords=[]);aa=aa.getTypeKeywords();for(const H of aa)X.typeKeywords.push(H);X.typeKeywords&&(X.typeKeywords=X.typeKeywords.filter((H,R,T)=>T.indexOf(H)===R),1===S&&(X.typeKeywords=X.typeKeywords.filter(H=>"Hosted Service"!==H)))};Q._saveAs=async function(X,aa){aa={...K,...aa};X=A.from(X);X||(I.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new v("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));
X.id&&(X=X.clone(),X.id=null);const S=X.portal||C.getDefault();await this._ensureLoadBeforeSave();X.type="Scene Service";X.portal=S;const H={origin:"portal-item",url:null,messages:[],portal:S,portalItem:X,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},R={layers:[this.write(null,H)]};await Promise.all(H.resources.pendingOperations);await this._validateAgainstJSONSchema(R,H,aa);X.url=this.url;X.title||(X.title=this.title);this._updateTypeKeywords(X,
aa,1);await S._signIn();await S.user.addItem({item:X,folder:aa&&aa.folder,data:R});await E.saveResources(this.resourceReferences,H,null);this.portalItem=X;x.updateOrigins(H);return H.portalItem=X};Q._save=async function(X){X={...K,...X};this.portalItem||(I.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new v("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService")));"Scene Service"!==this.portalItem.type&&(I.error("_save(): Non-matching portal item type. Got "+
this.portalItem.type+", expected Scene Service"),await Promise.reject(new v("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));await this._ensureLoadBeforeSave();const aa={origin:"portal-item",url:this.portalItem.itemUrl&&t.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||C.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},S={layers:[this.write(null,
aa)]};await Promise.all(aa.resources.pendingOperations);await this._validateAgainstJSONSchema(S,aa,X);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,X,0);await this.portalItem.update({data:S});await E.saveResources(this.resourceReferences,aa,null);x.updateOrigins(aa);return this.portalItem};Q._validateAgainstJSONSchema=async function(X,aa,S){aa=aa.messages.filter(H=>"error"===H.type).map(H=>new v(H.name,H.message,H.details));
S&&S.validationOptions.ignoreUnsupported&&(aa=aa.filter(H=>"layer:unsupported"!==H.name&&"symbol:unsupported"!==H.name&&"symbol-layer:unsupported"!==H.name&&"property:unsupported"!==H.name&&"url:unsupported"!==H.name&&"scenemodification:unsupported"!==H.name));if(S.validationOptions.enabled&&(X=(await new Promise(function(H,R){a(["../support/schemaValidator"],H,R)})).validate(X,S.portalItemLayerType),0<X.length)){const H=`Layer item did not validate:\n${X.join("\n")}`;I.error(`_validateAgainstJSONSchema(): ${H}`);
if("throw"===S.validationOptions.failPolicy)throw S=X.map(R=>new v("sceneservice:schema-validation",R)).concat(aa),new v("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:S});}if(0<aa.length)throw new v("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:aa});};b._createClass(P,[{key:"url",set:function(X){X=m.sanitizeUrlWithLayerId({layer:this,
url:X,nonStandardUrlAllowed:!1,logger:I});this._set("url",X.url);null!=X.layerId&&this._set("layerId",X.layerId)}},{key:"parsedUrl",get:function(){var X=this._get("url");if(!X)return null;X=t.urlToObject(X);null!=this.layerId&&(X.path=`${X.path}/layers/${this.layerId}`);return X}}]);return P}(J);p.__decorate([e.property(F.id)],J.prototype,"id",void 0);p.__decorate([e.property({type:D})],J.prototype,"spatialReference",void 0);p.__decorate([n.reader("spatialReference",["spatialReference","store.indexCRS",
"store.geographicCRS"])],J.prototype,"readSpatialReference",null);p.__decorate([e.property({type:z})],J.prototype,"fullExtent",void 0);p.__decorate([n.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],J.prototype,"readFullExtent",null);p.__decorate([e.property({readOnly:!0,type:B})],J.prototype,"heightModelInfo",void 0);p.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},
write:!1}}}})],J.prototype,"minScale",void 0);p.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],J.prototype,"maxScale",void 0);p.__decorate([e.property({readOnly:!0})],J.prototype,"version",void 0);p.__decorate([n.reader("version",["store.version"])],J.prototype,"readVersion",null);p.__decorate([e.property({type:String,json:{read:{source:"copyrightText"}}})],J.prototype,"copyright",void 0);p.__decorate([e.property({type:String,
json:{read:!1}})],J.prototype,"sublayerTitleMode",void 0);p.__decorate([e.property({type:String})],J.prototype,"title",void 0);p.__decorate([n.reader("portal-item","title")],J.prototype,"readTitlePortalItem",null);p.__decorate([n.reader("service","title",["name"])],J.prototype,"readTitleService",null);p.__decorate([e.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],J.prototype,"layerId",void 0);p.__decorate([e.property(F.url)],
J.prototype,"url",null);p.__decorate([u.writer("url")],J.prototype,"writeUrl",null);p.__decorate([e.property()],J.prototype,"parsedUrl",null);p.__decorate([e.property({readOnly:!0})],J.prototype,"store",void 0);p.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],J.prototype,"rootNode",void 0);return J=p.__decorate([q.subclass("esri.layers.mixins.SceneService")],J)};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/core/accessorSupport/originUtils":function(){define(["exports",
"../multiOriginJSONSupportUtils"],function(a,g){a.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(p=>{const f=p.target;p.newOrigin&&p.oldOrigin!==p.newOrigin&&g.isMultiOriginJSONMixin(f)&&f.updateOrigin(p.propName,p.newOrigin)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(g){return g&&"getAtOrigin"in g&&"originOf"in g};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/Error ../../core/uuid ../../core/promiseUtils ../../core/asyncUtils ../../portal/support/resourceUtils".split(" "),function(a,g,b,p,f,k){async function c(e,h){h=await f.result(e.resource.portalItem.addResource(e.resource,e.content,h));if(!0===h.ok)e.finish&&e.finish(e.resource);else throw e.error&&e.error(h.error),h.error;}async function d(e,h){h=await f.result(e.resource.update(e.content,h));if(!0===h.ok)e.finish(e.resource);
else throw e.error(h.error),h.error;}a.saveResources=async function(e,h,n){if(h&&h.resources){var q=h.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0;e.portalItem=h.portalItem;var u=new Set(h.resources.toKeep.map(l=>l.resource.path)),v=new Set,t=[];u.forEach(l=>{q.delete(l);e.paths.push(l)});for(const l of h.resources.toUpdate)if(q.delete(l.resource.path),u.has(l.resource.path)||v.has(l.resource.path)){const {resource:w,content:y,finish:D,error:z}=l,r=k.getSiblingOfSameTypeI(w,
b.generateUUID());e.paths.push(r.path);t.push(c({resource:r,content:y,finish:D,error:z},n))}else e.paths.push(l.resource.path),t.push(d(l,n)),v.add(l.resource.path);for(const l of h.resources.toAdd)t.push(c(l,n)),e.paths.push(l.resource.path);q.forEach(l=>{l=h.portalItem.resourceFromPath(l);t.push(l.portalItem.removeResource(l).catch(()=>{}))});if(0!==t.length&&(u=await p.eachAlways(t),p.throwIfAborted(n),n=u.filter(l=>"error"in l).map(l=>l.error),0<n.length))throw new g("save:resources","Failed to save one or more resources",
{errors:n});}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../core/maybe","../../core/Error","../../core/urlUtils","../../request"],function(a,g,b,p,f){function k(e){const h=e.lastIndexOf("/");return-1===h?[".",e]:[e.slice(0,h),e.slice(h+1)]}function c(e){{const v=p.getPathExtension(e);e=g.isNone(v)?[e,""]:[e.slice(0,e.length-v.length-1),`.${v}`]}const [h,n]=e,[q,u]=k(h);return[q,u,n]}async function d(e){return e instanceof
Blob?e:(await f(e.url,{responseType:"blob"})).data}a.addOrUpdateResource=async function(e,h,n,q){if(!e.hasPath())throw new b(`portal-item-resource-${h}:invalid-path`,"Resource does not have a valid path");await e.portalItem.load(q);h=p.join(e.portalItem.userItemUrl,"add"===h?"addResources":"updateResources");const [u,v]=k(e.path);n=await d(n);const t=new FormData;u&&"."!==u&&t.append("resourcesPrefix",u);t.append("fileName",v);t.append("file",n,v);t.append("f","json");g.isSome(q)&&q.access&&t.append("access",
q.access);await e.portalItem.portal._request(h,{method:"post",body:t,signal:g.get(q,"signal")});return e};a.contentToBlob=d;a.fetchResources=async function(e,h={},n){await e.load(n);var q=p.join(e.itemUrl,"resources");const {start:u=1,num:v=10,sortOrder:t="asc",sortField:l="created"}=h;h={query:{start:u,num:v,sortOrder:t,sortField:l},signal:g.get(n,"signal")};q=await e.portal._request(q,h);return{total:q.total,nextStart:q.nextStart,resources:q.resources.map(({created:w,size:y,resource:D})=>({created:new Date(w),
size:y,resource:e.resourceFromPath(D)}))}};a.getSiblingOfSameType=function(e,h){if(!e.hasPath())return null;const [n,,q]=c(e.path);return e.portalItem.resourceFromPath(p.join(n,h+q))};a.getSiblingOfSameTypeI=function(e,h){if(!e.hasPath())return null;const [n,,q]=c(e.path);return e.portalItem.resourceFromPath(p.join(n,h+q))};a.removeAllResources=async function(e,h){await e.load(h);const n=p.join(e.userItemUrl,"removeResources");return e.portal._request(n,{method:"post",query:{deleteAll:!0},signal:g.get(h,
"signal")})};a.removeResource=async function(e,h,n){if(!h.hasPath())throw new b("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(n);const q=p.join(e.userItemUrl,"removeResources");await e.portal._request(q,{method:"post",query:{resource:h.path},signal:g.get(n,"signal")});h.portalItem=null};a.splitPrefixFileNameAndExtension=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../core/maybe",
"../../core/Error","../../request"],function(a,g,b,p){a.fetchIndexInfo=async function(f,k,c,d,e){var h=null;if(g.isSome(c)){h=`${f}/nodepages/`;const n=h+Math.floor(c.rootIndex/c.nodesPerPage);try{return{type:"page",rootPage:(await p(n,{query:{f:"json"},responseType:"json",signal:e})).data,rootIndex:c.rootIndex,pageSize:c.nodesPerPage,lodMetric:c.lodSelectionMetricType,urlPrefix:h}}catch(q){g.isSome(d)&&d.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",n,
q),h=q}}if(!k)return null;k=k&&k.split("/").pop();f=`${f}/nodes/`;k=f+k;try{return{type:"node",rootNode:(await p(k,{query:{f:"json"},responseType:"json",signal:e})).data,urlPrefix:f}}catch(n){throw new b("sceneservice:root-node-missing","Root node missing.",{pageError:h,nodeError:n,url:k});}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../kernel ../../request ../../portal/Portal ../../portal/PortalItem ../FeatureLayer".split(" "),
function(a,g,b,p,f,k,c,d){let e=function(){function h(q,u,v){this.parsedUrl=q;this.portalItem=u;this.signal=v;this.rootDocument=null;if(q=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:q[1],layerId:parseInt(q[2],10)}}var n=h.prototype;n.fetch=async function(){var q;if(!this.urlParts)return null;const u=null!=(q=this.portalItem)?q:await this.portalItemFromServiceItemId();if(g.isNone(u))return this.loadFromUrl();q=await this.findAndLoadRelatedPortalItem(u);
return g.isNone(q)?null:this.loadFeatureLayerFromPortalItem(q)};n.fetchPortalItem=async function(){var q;if(!this.urlParts)return null;const u=null!=(q=this.portalItem)?q:await this.portalItemFromServiceItemId();return g.isNone(u)?null:this.findAndLoadRelatedPortalItem(u)};n.fetchRootDocument=async function(){if(g.isSome(this.rootDocument))return this.rootDocument;if(g.isNone(this.urlParts))return this.rootDocument={},{};const q={query:{f:"json"},responseType:"json",signal:this.signal},u=`${this.urlParts.root}/SceneServer`;
try{this.rootDocument=(await f(u,q)).data}catch{this.rootDocument={}}return this.rootDocument};n.fetchServiceOwningPortalUrl=async function(){var q;const u=null==(q=p.id)?void 0:q.findServerInfo(this.parsedUrl.path);if(null!=u&&u.owningSystemUrl)return u.owningSystemUrl;q=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const v=(await f(q,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(v)return v}catch(v){b.throwIfAbortError(v)}return null};n.findAndLoadRelatedPortalItem=
async function(q){try{return(await q.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(u=>"Feature Service"===u.type)||null}catch(u){return b.throwIfAbortError(u),null}};n.loadFeatureLayerFromPortalItem=async function(q){await q.load({signal:this.signal});const u=await this.findMatchingAssociatedSublayerUrl(q.url);return(new d({url:u,portalItem:q})).load({signal:this.signal})};n.loadFromUrl=async function(){const q=await this.findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);
return(new d({url:q})).load({signal:this.signal})};n.findMatchingAssociatedSublayerUrl=async function(q){q=q.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var u={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const v=this.urlParts.layerId;var t=this.fetchRootDocument();u=f(q,u);const [l,w]=await Promise.all([u,t]);t=w&&w.layers;u=l.data&&l.data.layers;if(!Array.isArray(u))throw Error("expected layers array");if(!Array.isArray(t)){if(v<u.length)return`${q}/${u[v].id}`}else for(let y=
0;y<Math.min(t.length,u.length);y++)if(t[y].id===v)return`${q}/${u[y].id}`;throw Error("could not find matching associated sublayer");};n.portalItemFromServiceItemId=async function(){var q=(await this.fetchRootDocument()).serviceItemId;if(!q)return null;q=new c({id:q});const u=await this.fetchServiceOwningPortalUrl();g.isSome(u)&&(q.portal=new k({url:u}));try{return q.load({signal:this.signal})}catch(v){return b.throwIfAbortError(v),null}};return h}();a.FetchAssociatedFeatureLayer=e;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q,u){a.RangeInfo=function(v){function t(){var l=
v.apply(this,arguments)||this;l.name=null;l.field=null;l.currentRangeExtent=null;l.fullRangeExtent=null;l.type="rangeInfo";return l}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([c.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([c.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);
b.__decorate([c.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([c.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=b.__decorate([e.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);a.default=a.RangeInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./FeatureLayerViewBase3D".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(){return u.apply(this,arguments)||this}a._inheritsLoose(v,u);return v}(q);g.__decorate([k.property()],b.prototype,"layer",void 0);return b=g.__decorate([d.subclass("esri.views.3d.layers.FeatureLayerView3D")],b)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/compilerUtils ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../../layers/RefreshableLayerView ../../../layers/graphics/hydratedFeatures ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/LayerView ../../layers/FeatureLayerView ../../../layers/graphics/controllers/FeatureTileController3D ../support/EventedSet ./FeatureLikeLayerView3D ./support/FeatureTileFetcher3DLayerViewContext".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m){b=function(E){function F(I){I=E.call(this,I)||this;I._controllerTotal=0;I._graphicsCoreTotal=0;I.suspendResumeExtentMode="data";return I}a._inheritsLoose(F,E);var G=F.prototype;G.initialize=function(){this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged())};G.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};G.fetchPopupFeatures=async function(I,K){return(I=
this.validateFetchPopupFeatures(K))?Promise.reject(I):this.fetchClientPopupFeatures(K)};G.setVisibility=function(I,K){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(I,K)};G.createQuery=function(){return E.prototype.createQuery.call(this)};G.queryFeatures=function(I,K){const J=()=>E.prototype.queryFeatures.call(this,I,K);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(I),J):J()};G.beforeSetController=function(I){I.maximumNumberOfFeatures=this.maximumNumberOfFeatures};
G.createController=function(){this.fetcherContext=new m.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const I=new C({layerView:this,context:this.fetcherContext,graphics:new A.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(I,"serviceDataExtent",K=>{this.graphics3d&&(this.graphics3d.dataExtent=K)},2);this.handles.add(t.init(this,"suspended",K=>{K?I.suspend():I.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",
()=>this.updateDisplayFeatureLimit(I),2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",()=>this.updateDisplayFeatureLimit()));return I};G.doRefresh=async function(){!this.suspended&&this.controller&&this.controller.refetch()};G.getUsedMemory=function(){const I=this.graphics3d&&this.graphics3d.graphicsCore;return(I?I.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};G.getUnloadedMemory=function(){const I=this.graphics3d&&this.graphics3d.graphicsCore;
return(I?I.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*I.usedMemoryPerGraphic:0)};G.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};G.updateDisplayFeatureLimit=function(I=this.controller){if(I&&this.graphics3d&&this.graphics3d.graphicsCore){var K=this.graphics3d.graphicsCore.displayFeatureLimit,J=this.view.resourceController.memoryController.memoryFactor;I.displayFeatureLimit=1===J?K:{...K,maximumNumberOfFeatures:Math.ceil(K.maximumNumberOfFeatures*
J),maximumTotalNumberOfFeatures:Math.ceil(K.maximumTotalNumberOfFeatures*J),minimumTotalNumberOfFeatures:Math.ceil(K.minimumTotalNumberOfFeatures*J)}}};G._queryFeaturesMesh=async function(I,K){await this._validateQueryFeaturesMesh(I);K=await K();if(I&&I.outStatistics)return K;I=this.layer.objectIdField;const J=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,L=[];for(const P of K.features)if(P.geometry){const Q=J.get(P.attributes[I]);Q&&(P.geometry=w.hydrateGeometry(Q.graphic.geometry),L.push(P))}else L.push(P);
K.features=L;return K};G._validateQueryFeaturesMesh=async function(I){if(I){var K=L=>{throw new n("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${L}'`);},J=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const L of J)null!=I[L]&&K(L);"returnM"in I&&I.returnM&&K("returnM");"returnCentroid"in I&&I.returnCentroid&&K("returnCentroid");f.isSome(I.outSpatialReference)&&!I.outSpatialReference.equals(this.view.spatialReference)&&
K("outSpatialReference")}};a._createClass(F,[{key:"updatingProgressValue",get:function(){let I=1;if(this.controller&&this.controller.updating){var K=this.controller.updatingRemaining,J=this.controller.updatingTotal;0<J&&(this._controllerTotal=Math.max(J,this._controllerTotal),I=(J-K)/J)}K=1;if(this.graphics3d&&this.graphics3d.graphicsCore){J=this.graphics3d.graphicsCore.updatingRemaining;const L=this.graphics3d.graphicsCore.updatingTotal;0<L&&(this._graphicsCoreTotal=Math.max(L,this._graphicsCoreTotal),
K=(L-J)/L)}1===I&&1===K&&(this._graphicsCoreTotal=this._controllerTotal=0);return.5*(I+K)}},{key:"maximumNumberOfFeatures",get:function(){var I,K;return null!=(I=null==(K=this.controller)?void 0:K.maximumNumberOfFeatures)?I:this._get("maximumNumberOfFeatures")},set:function(I){this._set("maximumNumberOfFeatures",I);this.controller&&(this.controller.maximumNumberOfFeatures=I)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1}},{key:"asyncGraphicsUpdates",get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":{const I=B[this.layer.geometryType];return null==I||this.controller.serviceDataCount>I}case "tiles":break;default:p.neverReached(this.controller.mode)}return!0}},{key:"hasZ",get:function(){const I=this.layer,K=I.capabilities&&I.capabilities.data;return K&&K.supportsZ?"returnZ"in I&&null!=I.returnZ?I.returnZ:K.supportsZ:!1}},{key:"hasM",get:function(){const I=this.layer,K=I.capabilities&&
I.capabilities.data;return K&&K.supportsM?"returnM"in I&&null!=I.returnM?I.returnM:!1:!1}},{key:"performanceInfo",get:function(){var I=this.controller&&this.controller.displayFeatureLimit;I=f.isSome(I)&&I.averageSymbolComplexity;I=f.isSome(I)?`f:${I.primitivesPerFeature},v:${I.primitivesPerCoordinate}`:"n/a";I={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:I,nodes:this.controller?
this.controller.tileDescriptors.length:0};if(this.controller&&I.displayedNumberOfFeatures){const K=this.controller.debug;I.storedFeatures=K.storedFeatures;I.totalVertices=K.totalVertices}return I}}]);return F}(l.RefreshableLayerView(x.FeatureLikeLayerView3D(r.FeatureLayerView(y.LayerView3D(z)))));g.__decorate([d.property()],b.prototype,"layer",void 0);g.__decorate([d.property()],b.prototype,"controller",void 0);g.__decorate([d.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal",
"graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],b.prototype,"updatingProgressValue",null);g.__decorate([d.property()],b.prototype,"maximumNumberOfFeatures",null);g.__decorate([d.property()],b.prototype,"maximumNumberOfFeaturesExceeded",null);g.__decorate([d.property(D.updatingProgress)],b.prototype,"updatingProgress",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"asyncGraphicsUpdates",null);g.__decorate([d.property({readOnly:!0})],b.prototype,
"hasZ",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"hasM",null);g.__decorate([d.property()],b.prototype,"suspendResumeExtentMode",void 0);b=g.__decorate([h.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],b);const B={point:5E3,polygon:500,polyline:1E3};return b})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../layers/support/fieldUtils ../../core/watchUtils ../../layers/support/commonProperties ../../tasks/support/Query ./support/FeatureFilter ./support/FeatureEffect ./support/popupUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){const x=k.getLogger("esri.views.layers.FeatureLayerView");p=m=>{m=function(B){function E(...G){G=B.call(this,...G)||this;G._updatingRequiredFieldsPromise=null;G.effect=null;G.filter=null;G.timeExtent=null;G.layer=null;G.requiredFields=[];G.view=null;return G}g._inheritsLoose(E,B);var F=E.prototype;F.initialize=function(){y.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);y.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange())};F.highlight=function(G){throw Error("missing implementation");};F.createQuery=function(){var G={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};G=f.isSome(this.filter)?this.filter.createQuery(G):new z(G);f.isSome(this.timeExtent)&&(G.timeExtent=f.isSome(G.timeExtent)?G.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return G};F.queryFeatures=
function(G,I){throw Error("missing implementation");};F.queryObjectIds=function(G,I){throw Error("missing implementation");};F.queryFeatureCount=function(G,I){throw Error("missing implementation");};F.queryExtent=function(G,I){throw Error("missing implementation");};F._loadArcadeModules=function(G){if(G.get("expressionInfos.length"))return l.loadArcade()};F._handleRequiredFieldsChange=function(){const G=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",G);G.then(()=>{this._updatingRequiredFieldsPromise===
G&&this._set("_updatingRequiredFieldsPromise",null)})};F._updateRequiredFields=async function(){if(this.layer&&this.view){var G="3d"===this.view.type,{layer:I,layer:{fields:K,objectIdField:J,renderer:L,displayField:P}}=this,Q=I.featureReduction,X=new Set;Q=await t.eachAlways([L?L.collectRequiredFields(X,K):null,w.collectLabelingFields(X,I),G?w.collectElevationFields(X,I):null,f.isSome(this.filter)?w.collectFilterFields(X,I,this.filter):null,this.effect?w.collectFilterFields(X,I,this.effect.filter):
null,Q?w.collectFeatureReductionFields(X,I,Q):null]);I.timeInfo&&this.timeExtent&&w.collectFields(X,I.fields,[I.timeInfo.startField,I.timeInfo.endField]);"feature"===I.type&&I.floorInfo&&w.collectFields(X,I.fields,[I.floorInfo.floorField]);for(const aa of Q)aa.error&&x.error(aa.error);w.collectField(X,K,J);G&&P&&w.collectField(X,K,P);G=Array.from(X).sort();this._set("requiredFields",G)}};F.validateFetchPopupFeatures=function(G){const {layer:I,layer:{popupEnabled:K}}=this;if(!K)return new n("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:I});if(!A.getFetchPopupTemplate(this.layer,G))return new n("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:I})};F.fetchClientPopupFeatures=async function(G){const I=f.isSome(G)?G.clientGraphics:null;if(!I||0===I.length)return Promise.resolve([]);const K=[],J=[],{layer:L}=this;var P=A.getFetchPopupTemplate(L,G);if(!f.isSome(P))return Promise.resolve([]);var Q=await this._loadArcadeModules(P);P=Q&&Q.arcadeUtils.hasGeometryOperations(P);
G=await this.createPopupQuery(G);Q=w.unpackFieldNames(L.fields,G.outFields);for(const X of I)P||!w.featureHasFields(Q,X)?J.push(X):K.push(X);if("stream"===L.type||0===J.length)return Promise.resolve(K);G.objectIds=J.map(X=>X.attributes[L.objectIdField]);return L.queryFeatures(G).then(X=>K.concat(X.features)).catch(()=>J)};F.createPopupQuery=async function(G){var I=this.layer;const K=I.createQuery();G=A.getFetchPopupTemplate(I,G);var J=f.isSome(G)&&await this._loadArcadeModules(G);J=f.isSome(G)&&J&&
J.arcadeUtils.hasGeometryOperations(G);I=!("point"!==I.geometryType&&!J);K.returnGeometry=I;K.returnZ=I;K.returnM=I;K.outFields=await A.getRequiredFields(this.layer,G);K.outSpatialReference=this.view.spatialReference;return K};F.canResume=function(){return!B.prototype.canResume.call(this)||f.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};g._createClass(E,[{key:"availableFields",get:function(){const {layer:G,layer:{fields:I},requiredFields:K}=this;return"outFields"in G&&G.outFields?w.fixFields(I,
[...w.unpackFieldNames(I,G.outFields),...K]):w.fixFields(I,K)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(G){x.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return E}(m);b.__decorate([d.property()],m.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([d.property({readOnly:!0})],m.prototype,"availableFields",null);b.__decorate([d.property({type:C})],
m.prototype,"effect",void 0);b.__decorate([d.property({type:r})],m.prototype,"filter",void 0);b.__decorate([d.property(D.combinedViewLayerTimeExtentProperty)],m.prototype,"timeExtent",void 0);b.__decorate([d.property()],m.prototype,"layer",void 0);b.__decorate([d.property({type:Number})],m.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0,type:Boolean})],m.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property({readOnly:!0})],m.prototype,"requiredFields",
void 0);b.__decorate([d.property()],m.prototype,"suspended",void 0);b.__decorate([d.property()],m.prototype,"view",void 0);return m=b.__decorate([h.subclass("esri.views.layers.FeatureLayerView")],m)};a.FeatureLayerView=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../geometry/support/jsonUtils ../../../geometry ../../../TimeExtent ../../../tasks/support/Query".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){var D;b=new d.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});d=new d.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});v=D=function(z){function r(A){A=z.call(this,A)||this;A.where=null;A.geometry=null;A.spatialRelationship="intersects";A.hiddenIds=new Set;A.distance=void 0;A.objectIds=null;A.units=null;A.timeExtent=null;A.enabled=!1;return A}a._inheritsLoose(r,z);var C=r.prototype;C.writeWhere=function(A,x){x.where=A||"1\x3d1"};C.enable=function(){this._set("enabled",!0)};
C.createQuery=function(A={}){const {where:x,geometry:m,spatialRelationship:B,timeExtent:E,objectIds:F,units:G,distance:I}=this;return new y({geometry:p.clone(m),objectIds:p.clone(F),spatialRelationship:B,timeExtent:p.clone(E),where:x,units:G,distance:I,...A})};C.clone=function(){const {where:A,geometry:x,spatialRelationship:m,hiddenIds:B,timeExtent:E,objectIds:F,units:G,distance:I}=this,K=new Set;B.forEach(J=>K.add(J));return new D({geometry:p.clone(x),hiddenIds:K,objectIds:p.clone(F),spatialRelationship:m,
timeExtent:p.clone(E),where:A,units:G,distance:I})};return r}(v.JSONSupport);g.__decorate([c.property({type:String})],v.prototype,"where",void 0);g.__decorate([h.writer("where")],v.prototype,"writeWhere",null);g.__decorate([c.property({types:l.geometryTypes,json:{read:t.fromJSON,write:!0}})],v.prototype,"geometry",void 0);g.__decorate([c.property({type:String,json:{read:{source:"spatialRel",reader:b.read},write:{target:"spatialRel",writer:b.write}}})],v.prototype,"spatialRelationship",void 0);g.__decorate([c.property({json:{write:(z,
r,C)=>r[C]=Array.from(z),read:z=>new Set(z)}})],v.prototype,"hiddenIds",void 0);g.__decorate([c.property({type:Number,json:{write:{overridePolicy(z){return{enabled:0<z}}}}})],v.prototype,"distance",void 0);g.__decorate([c.property({type:[Number],json:{write:!0}})],v.prototype,"objectIds",void 0);g.__decorate([c.property({type:String,json:{read:d.read,write:{writer:d.write,overridePolicy(z){return{enabled:z&&0<this.distance}}}}})],v.prototype,"units",void 0);g.__decorate([c.property({type:w,json:{write:!0}})],
v.prototype,"timeExtent",void 0);g.__decorate([c.property({readOnly:!0})],v.prototype,"enabled",void 0);return v=D=g.__decorate([e.subclass("esri.views.layers.support.FeatureFilter")],v)})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ./FeatureFilter".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;b=v=function(t){function l(){var w=t.apply(this,arguments)||this;w.filter=null;w.includedEffect=null;w.excludedEffect=null;w.excludedLabelsVisible=!1;return w}a._inheritsLoose(l,t);l.prototype.clone=function(){return new v({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return l}(q.JSONSupport);g.__decorate([k.property({type:u,json:{write:!0}})],
b.prototype,"filter",void 0);g.__decorate([k.property({json:{write:!0}})],b.prototype,"includedEffect",void 0);g.__decorate([k.property({json:{write:!0}})],b.prototype,"excludedEffect",void 0);g.__decorate([k.property({type:Boolean,json:{write:!0}})],b.prototype,"excludedLabelsVisible",void 0);return b=v=g.__decorate([d.subclass("esri.views.layers.support.FeatureEffect")],b)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],
function(a,g,b){a.getFetchPopupTemplate=function(p,f){return p.popupTemplate?p.popupTemplate:g.isSome(f)&&f.defaultPopupTemplateEnabled&&g.isSome(p.defaultPopupTemplate)?p.defaultPopupTemplate:null};a.getRequiredFields=async function(p,f=p.popupTemplate){if(!g.isSome(f))return[];const k=await f.getRequiredFields(p.fields);({lastEditInfoEnabled:f}=f);const {objectIdField:c,typeIdField:d,globalIdField:e,relationships:h}=p;if(k.includes("*"))return["*"];f=f?await b.getFeatureEditFields(p):[];const n=
b.fixFields(p.fields,[...k,...f]);d&&n.push(d);n&&c&&b.hasField(p.fields,c)&&-1===n.indexOf(c)&&n.push(c);n&&e&&b.hasField(p.fields,e)&&-1===n.indexOf(e)&&n.push(e);h&&h.forEach(q=>{({keyField:q}=q);n&&q&&b.hasField(p.fields,q)&&-1===n.indexOf(q)&&n.push(q)});return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../core/Collection ../../../core/Promise ../../../core/asyncUtils ../../../core/Handles ../../../core/watchUtils ../../support/arcgisLayerUrl ../../../tasks/support/StatisticDefinition ../../../views/support/WatchUpdatingTracking ../../../views/3d/support/debugFlags ../../../portal/support/geometryServiceUtils ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){function G(J,L){if(!L)return!1;for(const P of L)if(!J.has(P))return!0;return!1}var I;const K=k.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");b=I=function(J){function L(Q){Q=J.call(this,Q)||this;Q.type="feature-tile-3d";Q.watchUpdatingTracking=new x.WatchUpdatingTracking;Q.serviceDataExtent=null;Q.serviceDataCount=I.constants.NO_SERVICE_DATA_COUNT;Q.vertexLimitExceeded=!1;Q.displayFeatureLimit=null;Q.suspended=
!1;Q.tileFetcher=null;Q.handles=new z;Q.fetchDataInfoPromise=null;Q.fetchDataInfoAbortController=null;Q.lifeCycleAbortController=t.createAbortController();return Q}a._inheritsLoose(L,J);var P=L.prototype;P.approximateExtentSizeAtScale=function(Q,X){const aa=this.layerView.view,S=X.levels[0];return(S.tileSize[0]/(S.scale/Q)+S.tileSize[1]/(S.scale/Q))/2*Math.ceil((aa.width/X.pixelSize+aa.height/X.pixelSize)/2)};P.initialize=function(){this.watchUpdatingTracking.add(this,"vertexLimitInfo",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,
this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(this,"mode",()=>this.modeChanged(),2);this.addResolvingPromise(Promise.resolve().then(()=>this.verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo())).then(()=>this.initializeTileFetcher()))};P.verifyCapabilities=function(){const Q=this.layerView.layer;if(!Q.get("capabilities.operations.supportsQuery"))throw new n("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:Q});};P.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher=f.destroyMaybe(this.tileFetcher);this.handles=f.destroyMaybe(this.handles);this.tilesHandle=f.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};P.suspend=function(){this.suspended||(this.suspended=!0,f.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};
P.resume=function(){this.suspended&&(this.suspended=!1,f.isSome(this.tileFetcher)&&this.tileFetcher.resume())};P.restart=function(){const Q=()=>{f.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(Q,Q))};P.refetch=function(){const Q=()=>{f.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(Q,Q))};P.initializeTileFetcher=function(){const Q=this.layerView.view;
if(Q){var X=r.whenOnce(Q.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(X);X.then(()=>{const {layerView:aa,tileDescriptors:S}=this,H=aa.layer,R=new E.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:S,features:this.graphics});this.tileFetcher=R;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();var T=this.layerView.view.resourceController;T&&(this.handles.add(T.memoryController.events.on("quality-changed",
W=>{R.memoryFactor=W})),this.tileFetcher.memoryFactor=T.memoryController.memoryFactor);(T="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null)&&this.handles.add(r.init(this.layerView.view,"qualitySettings.graphics3D."+T,W=>{R.lodFactor=W||1}));this.watchUpdatingTracking.add(H,"createQueryVersion",()=>this.dataFilterChanged());this.watchUpdatingTracking.add(aa,"availableFields",(W,Y)=>this.availableFieldsChanged(Y,W));this.watchUpdatingTracking.add(aa,
"requiredFields",(W,Y)=>this.requiredFieldsChanged(Y,W));this.handles.add([H.on("apply-edits",W=>this.applyEdits(W)),this.watch("extent",W=>R.filterExtent=W,!0),this.watch("tileDescriptors",W=>R.tileDescriptors=W,!0),r.init(this,"maximumNumberOfFeatures",W=>{R.maximumNumberOfFeatures=W;R.useTileCount=this.serviceDataCount>W},!0),r.init(this,"serviceDataCount",W=>R.useTileCount=W>this.maximumNumberOfFeatures,!0),r.init(m,"FEATURE_TILE_FETCH_SHOW_TILES",W=>{W&&R&&!R.debugger?(R.debugger=new F.FeatureTileFetcher3DDebugger(R,
Q.featureTiles.tilingScheme.toTileInfo(),Q),R.debugger.update()):!W&&this.tileFetcher&&R.debugger&&(R.debugger.destroy(),R.debugger=null)})]);this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(this,"maxTotalSnapshotVertices",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};P.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());
break;default:K.warn("Unhandled feature layer mode "+this.mode);case "snapshot":f.isSome(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}};P.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};P.applyEdits=function(Q){f.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(Q).then(X=>{X&&(X.deletedFeatures.length||X.updatedFeatures.length||X.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this.updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(X=>
{if(!t.isAbortError(X))throw X;})};P.availableFieldsChanged=function(Q,X){f.isSome(this.tileFetcher)&&G(this.tileFetcher.availableFields,X)&&this.refetch()};P.requiredFieldsChanged=function(Q,X){f.isSome(this.tileFetcher)&&G(this.tileFetcher.availableFields,X)&&this.restart()};P.createVertexLimitExceededQuery=function(Q){const X=this.layerView.layer,aa=X.createQuery();aa.outStatistics=[new A({statisticType:"exceedslimit",maxVertexCount:Q,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];
X.capabilities.query.supportsCacheHint&&(aa.cacheHint=!0);return aa};P.createDataInfoQuery=function(){const Q=this.layerView.layer,X=Q.createQuery();X.outSpatialReference=this.layerView.view.spatialReference;Q.capabilities.query.supportsCacheHint&&(X.cacheHint=!0);return X};P.fullExtentIsAccurate=function(){const Q=this.layerView.layer;if(Q.definitionExpression)return!1;switch(Q.type){case "feature":return C.isHostedAgolService(Q.url);case "csv":case "geojson":case "ogc-feature":return!0}};P.updateServiceDataExtent=
async function(Q){try{await this.tryUpdateServiceDataExtent(Q)}catch(X){t.isAbortError(X)||this._set("serviceDataExtent",p.clone(this.layerView.fullExtentInLocalViewSpatialReference))}};P.tryUpdateServiceDataExtent=async function(Q){var X=this.layerView;const aa=X.layer,S=aa.capabilities.query.supportsExtent,H=p.clone(X.fullExtentInLocalViewSpatialReference),R=aa.fullExtent,T=this.fullExtentIsAccurate(),W=this.serviceDataCount;S&&W<=I.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!H||!T)&&"queryExtent"in
aa?(X=this.createDataInfoQuery(),Q=await aa.queryExtent(X,{timeout:I.constants.QUERY_EXTENT_TIMEOUT,signal:Q}),this._set("serviceDataExtent",Q.extent)):H?this._set("serviceDataExtent",H):R?(Q=await B.projectGeometry(R,X.view.spatialReference,"portalItem"in aa?aa.portalItem:null,Q),this._set("serviceDataExtent",Q)):this._set("serviceDataExtent",null)};P.updateServiceDataCount=async function(Q){const X=this.layerView.layer;if("queryFeatureCount"in X)if(Q=await D.result(X.queryFeatureCount(this.createDataInfoQuery(),
{timeout:I.constants.QUERY_STATISTICS_TIMEOUT,signal:Q})),!0===Q.ok)this._set("serviceDataCount",Q.value);else{if(t.isAbortError(Q.error))throw Q.error;({NO_SERVICE_DATA_COUNT:Q}=I.constants);this._set("serviceDataCount",Q)}else({NO_SERVICE_DATA_COUNT:Q}=I.constants),this._set("serviceDataCount",Q)};P.updateVertexLimitExceeded=async function(Q,X){var aa=this.vertexLimitInfo;if(f.isNone(aa))this._set("vertexLimitExceeded",!1);else{var S=1<this.minimumNumberOfVerticesForGeometry;if(0>=aa.primitivesPerFeature||
S){var {primitivesPerFeature:H,primitivesPerCoordinate:R,maximumTotalNumberOfPrimitives:T}=aa;0!==H&&f.isSome(Q)&&await Q;aa=this.serviceDataCount;var W=aa!==I.constants.NO_SERVICE_DATA_COUNT;Q=W?Math.ceil((T-aa*H)/(R||1)):Math.ceil(T/(R||1));S&&(Q=Math.min(Q,5E6));if(W&&this.minimumNumberOfVerticesForGeometry*aa>Q)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(X=await D.result(this.layerView.layer.queryFeatures(this.createVertexLimitExceededQuery(Q),{timeout:I.constants.QUERY_STATISTICS_TIMEOUT,
signal:X})),!1===X.ok){if(t.isAbortError(X.error))throw X.error;this._set("vertexLimitExceeded",!1)}else(X=X.value.features[0])&&X.attributes?this._set("vertexLimitExceeded",!!X.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>Q)}else this._set("vertexLimitExceeded",!1)}};P.fetchServiceDataInfo=async function(){this.cancelFetchServiceDataInfo();let Q=t.createAbortController();const X=Q.signal;var aa=this.updateServiceDataCount(X);
aa=t.eachAlways([aa,this.updateVertexLimitExceeded(aa,X)]);const S=aa.then(()=>this.updateServiceDataExtent(X)).catch(H=>{t.isAbortError(H)||K.error("#fetchServiceDataInfo()",H)}).then(()=>{S===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);Q=null});Q&&(this.fetchDataInfoPromise=S);this.fetchDataInfoAbortController=Q;return aa.then(()=>{},()=>{})};P.cancelFetchServiceDataInfo=function(){const Q=this.fetchDataInfoAbortController;Q&&(this.fetchDataInfoPromise=
this.fetchDataInfoAbortController=null,Q.abort())};a._createClass(L,[{key:"extent",set:function(Q){if(Q&&!Q.spatialReference.equals(this.layerView.view.spatialReference))K.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var X=this._get("extent");X===Q||X&&Q&&X.equals(Q)||(Q=Q?Q.clone():null,this._set("extent",Q))}}},{key:"updating",get:function(){return!!(f.isSome(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&
this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&f.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&f.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&f.isSome(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:
0}},{key:"memoryForUnusedFeatures",get:function(){return f.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!f.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return f.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(Q){Q!==this.maximumNumberOfFeatures&&(null==Q?this._clearOverride("maximumNumberOfFeatures"):
this._override("maximumNumberOfFeatures",Q))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){if(this.serviceDataCount===I.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";const {layer:Q,view:X}=this.layerView;var aa=X&&X.featureTiles;aa=aa&&aa.tilingScheme;return Q&&Q.minScale&&this.serviceDataExtent&&aa&&(aa=this.approximateExtentSizeAtScale(Q.minScale,aa),(this.serviceDataExtent.width/
aa+this.serviceDataExtent.height/aa)/2>I.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const Q=this._get("maxTotalSnapshotVertices")||0,X="snapshot"===this.mode&&f.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(Q,X)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new w([{id:"dummy-tile-full-extent",
lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new w}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(f.isNone(this.displayFeatureLimit)||f.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:Q,maximumTotalNumberOfPrimitives:X}=this.displayFeatureLimit,{primitivesPerCoordinate:aa,primitivesPerFeature:S}=Q,
H=this._get("vertexLimitInfo");return f.isNone(H)||H.maximumTotalNumberOfPrimitives!==X||H.primitivesPerCoordinate!==aa||H.primitivesPerFeature!==S?{primitivesPerCoordinate:aa,primitivesPerFeature:S,maximumTotalNumberOfPrimitives:X}:H}},{key:"supportsExceedsLimitQuery",get:function(){const Q=this.layerView.layer;return Q.capabilities&&Q.capabilities.operations&&Q.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;
case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:f.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:f.isSome(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:f.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return L}(y.EsriPromiseMixin(l));g.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);g.__decorate([d.property({constructOnly:!0})],
b.prototype,"graphics",void 0);g.__decorate([d.property({constructOnly:!0})],b.prototype,"layerView",void 0);g.__decorate([d.property({constructOnly:!0})],b.prototype,"context",void 0);g.__decorate([d.property()],b.prototype,"extent",null);g.__decorate([d.property()],b.prototype,"updating",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"watchUpdatingTracking",void 0);g.__decorate([d.property()],b.prototype,"updatingTotal",null);g.__decorate([d.property()],b.prototype,"updatingRemaining",
null);g.__decorate([d.property()],b.prototype,"expectedFeatureDiff",null);g.__decorate([d.property()],b.prototype,"memoryForUnusedFeatures",null);g.__decorate([d.property()],b.prototype,"maximumNumberOfFeaturesExceeded",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"serviceDataExtent",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"serviceDataCount",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"vertexLimitExceeded",void 0);g.__decorate([d.property()],b.prototype,
"displayFeatureLimit",void 0);g.__decorate([d.property({type:Number})],b.prototype,"maximumNumberOfFeatures",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"mode",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"maxTotalSnapshotVertices",null);g.__decorate([d.property({readOnly:!0,dependsOn:["mode"]})],b.prototype,"tileDescriptors",null);g.__decorate([d.property()],b.prototype,"tileFetcher",void 0);g.__decorate([d.property()],b.prototype,"fetchDataInfoPromise",void 0);g.__decorate([d.property({readOnly:!0})],
b.prototype,"vertexLimitInfo",null);b=I=g.__decorate([h.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],b);(function(J){(function(L){L.NO_SERVICE_DATA_COUNT=Infinity;L.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;L.reset=function(){L.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;L.QUERY_STATISTICS_TIMEOUT=12E3;L.QUERY_EXTENT_TIMEOUT=1E4}})(J.constants||(J.constants={}))})(b||(b={}));b.constants.reset();return b})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ../../../../core/MapUtils ../../../../layers/graphics/dehydratedFeatures ../../terrain/tileUtils ./featureReference ./FeatureTile".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E){function F(X){return"dummy-tile-full-extent"===X.id}function G(X){let aa=0;for(const S of X)S.features&&0<S.features.length&&S.alive&&(aa=Math.max(aa,S.descriptor.lij[0]));return aa}function I(X){X.setFeatures([],0,null);X.featuresMissing=!1;return 4}function K(X){return f.isNone(X)?new Set:new Set(X.map(aa=>aa.name))}function J(X,aa){if(f.isNone(X)||f.isNone(aa))return K(aa);const S=new Set;for(const {name:H}of aa)X.has(H)&&S.add(H);
return S}const L=k.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(X){function aa(H){H=X.call(this,H)||this;H._useTileCount=!1;H.updating=!1;H.updatingTotal=0;H.updatingRemaining=0;H.expectedFeatureDiff=0;H.maximumNumberOfFeaturesExceeded=!1;H.maximumNumberOfFeaturesExceededThrottle=1E3;H._fullRatio=1;H._farRatio=1;H.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};H.handles=new w;H._frameTask=z.ImmediateTask;H._dirty=!1;H.featureTiles=new Map;
H.displayingFeatureReferences=new Map;H.numDisplayingFeatureReferences=0;H.suspended=!0;H.pendingEdits=null;return H}g._inheritsLoose(aa,X);var S=aa.prototype;S.initialize=function(){this.handles.add(y.on(this,"tileDescriptors","change",()=>this.setDirty(),()=>this.setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?B.MultiFeatureReference:B.SingleFeatureReference;const H=this.context.scheduler;f.isSome(H)&&(this._frameTask=
H.registerTask(z.Task.FEATURE_TILE_FETCHER,R=>this._process(R),()=>this.updating));this.setDirty()};S.destroy=function(){this._frameTask.remove();this.handles=f.destroyMaybe(this.handles);this.featureTiles.forEach(H=>{this.cancelFetchTile(H);this.removeTile(H)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};S.restart=function(){this.featureTiles.forEach(H=>{this.cancelFetchTile(H);this.clearTile(H);
this.resetFetchTile(H)});f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};S.refetch=function(){this.featureTiles.forEach(H=>{this.cancelFetchTile(H);this.resetFetchTile(H)});f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};S.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};S.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};S.pause=function(){this.paused&&(this.featureTiles.forEach(H=>
this.cancelFetchTile(H)),this.updated())};S.unpause=function(){this.paused||(this.setDirty(),this.updated())};S.applyEdits=function(H){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:v.createAbortController()},this.pause());const R=this.pendingEdits;R.count++;const T=R.edits.then(()=>H.result.catch(W=>{if(v.isAbortError(W))throw W;return null}).then(W=>W?(this.applyEditsDeleteFeatures(W.deletedFeatures),this.applyEditsAddUpdateFeatures(W.addedFeatures,W.updatedFeatures,
R.controller.signal).then(()=>W)):W).then(W=>{0===--R.count&&(this.pendingEdits===R&&(this.pendingEdits=null),f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.unpause(),this.updated());return W}));R.edits=T;this.updated();return T};S.applyEditsDeleteFeatures=function(H){if(0!==H.length){var R=new Set;H.forEach(T=>R.add(T.objectId));this.featureTiles.forEach(T=>{if(T.features){var W=T.features.filter(Y=>!R.has(x.getObjectId(Y,this.objectIdField)));W.length!==T.features.length&&
(T.setFeatures(W,0,T.availableFields),this.invalidateCounts())}})}};S.applyEditsAddUpdateFeatures=async function(H,R,T){const W=[],Y=new Set;H.forEach(N=>W.push(N.objectId));R.forEach(N=>{W.push(N.objectId);Y.add(N.objectId)});if(0!==W.length){var U=[];this.featureTiles.forEach(N=>{(N=this.applyEditsAddUpdateTile(N,W,Y,T))&&U.push(N)});await v.eachAlways(U)}};S.applyEditsAddUpdateTile=async function(H,R,T,W){if(H.features){var Y=this.createQuery(H);Y.resultType=void 0;Y.cacheHint=!1;Y.objectIds=R;
R=await this.queryFeatures(Y,W);W=null;0<T.size&&(Y=H.features.filter(U=>!T.has(x.getObjectId(U,this.objectIdField))),Y.length!==H.features.length&&(W=Y));if(0<R.features.length){W||(W=H.features.slice());for(const U of R.features)W.push(U)}W&&(H.hasPreciseFeatureCount&&(H.numFeatures=Math.max(H.numFeatures,W.length)),H.setFeatures(W,0,J(H.availableFields,R.fields)),this.invalidateCounts())}};S.queryFeatures=function(H,R){return this.context.query.queryFeaturesDehydrated(H,{signal:R,timeout:6E5})};
S.setDirty=function(){this._dirty=!0;this.updated()};S._process=function(H){this._frameTask.processQueue(H);if(this._dirty&&this.constructed){this._dirty=!1;var R=this.getListOfTiles();this.markTilesNotAlive(R);if(H.run(()=>this.addTiles(R,H))&&H.run(()=>this.filterExtentTiles(R,H))&&H.run(()=>this.removeTiles(R,H))&&!H.done){var T=this.sortTiles(R);H.run(()=>this.displayTiles(T,H))&&H.run(()=>this.fetchTiles(T,H))&&H.run(()=>this.updateMemoryEstimates(T,H))||this.setDirty();this.updated();this.updating||
this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}};S.markTilesNotAlive=function(H){for(const R of H)R.alive=!1};S.addTiles=function(H,R){if(this.suspended)return!1;this.tileDescriptors.forEach(T=>{const W=this.featureTiles.get(T.id);W?W.alive=!0:R.done||(H.push(this.addTile(T)),R.madeProgress())});return R.hasProgressed};S.filterExtentTiles=function(H,R){for(const T of H){if(R.done)break;T.alive&&(T.filtered=!T.intersects(this.filterExtent),T.filtered&&(this.clearTile(T),R.madeProgress()))}return R.hasProgressed};
S.removeTiles=function(H,R){for(let T=H.length-1;0<=T&&!R.done;T--){const W=H[T];W.alive||(this.removeTile(W),T!==H.length-1&&(H[T]=H[H.length-1]),H.pop(),R.madeProgress())}return R.hasProgressed};S.sortTiles=function(H){H.sort((R,T)=>R.descriptor.loadPriority-T.descriptor.loadPriority);return H};S.displayTiles=function(H,R){const T=this.updateRatio(H),W=Y=>{const U=1>this._fullRatio?T(Y)*this._farRatio:1;Y.reduceFeatures(U,this.memoryFactor,this.objectIdField)&&this.setDirty();return this.showTile(Y)};
for(const Y of H)if(!R.run(()=>W(Y))){this.setDirty();break}return R.hasProgressed};S.fetchTiles=function(H,R){if(this.paused)return!1;var T=!1;for(const Y of H)if(Y.needsFetching){var W=f.isSome(this.context.memoryCache)?this.context.memoryCache.pop(Y.id):null;if(f.isSome(W))Y.cache=W,this.setDirty(),this.scheduleUpdated(),R.madeProgress();else if(this.needsNumFeatures(Y)&&(T=v.createAbortController(),W=this.fetchTileCount(Y,T.signal),this._handleRequest(Y,W,T,()=>Y.numFeatures=E.FAILED_FEATURE_COUNT),
T=!0,R.madeProgress()),R.done)return!0}if(T)return R.hasProgressed;for(const Y of H)if(Y.needsFetching&&(H=v.createAbortController(),T=this.fetchTile(Y,H.signal),this._handleRequest(Y,T,H,U=>{Y.setFeatures([],0,null);this.invalidateCounts();Y.featuresMissing=!1;this.context.logFetchError(L,U)}),R.madeProgress(),R.done))return!0;return R.hasProgressed};S.updateMemoryEstimates=function(H,R){H.some(T=>R.run(()=>T.updateMemoryEstimates())?!1:(this.setDirty(),!0));return R.hasProgressed};S.reclip=function(H,
R){if(this.constructed){var T=[];this.featureTiles.forEach(W=>{f.isNone(W.displayingFeatures)||0===W.displayingFeatures.length||(W.intersectionIncludingBorrowed(R,P),W.intersectionIncludingBorrowed(H,Q),D.equals(P,Q)||T.push(W))});this.refreshDisplayingFeatures(T);this.updated()}};S.refreshDisplayingFeatures=function(H){const R=new Set,T=this.changes.updates;for(const W of H)if(!f.isNone(W.displayingFeatures))for(const Y of W.displayingFeatures)H=x.getObjectId(Y,this.objectIdField),R.has(H)||(R.add(H),
{feature:H}=this.displayingFeatureReferences.get(H),T.removes.push(H),T.adds.push(H));this.applyChanges()};S.updated=function(){let H=0;this.paused||this.featureTiles.forEach(T=>T.isFetching?++H:0);var R=this._dirty||0<H||!!this.pendingEdits;this._set("updating",R);if(R){let T=R=0,W=0,Y=0,U=0,N=0;const ca=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(V=>{++W;if(V.isFetching&&V.hasPreciseFeatureCount){const ba=this.maximumFeaturesForTile(V)*(1-
V.emptyFeatureRatio),fa=f.isSome(V.displayingFeatures)?V.displayingFeatures.length*ca:0;N+=ba-fa}V.needsFetching?++U:0<V.numFeatures&&(++Y,T+=V.numFeatures)});U+=H;let O=0;T?(R=T,O=Math.min(U*T/Y,T)):(R=W,O=U);N=Math.min(this.maximumNumberOfFeatures-this.features.length,N);this._set("updatingTotal",R);this._set("updatingRemaining",O);this._set("expectedFeatureDiff",N)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};
S.updateMaximumNumberOfFeaturesExceeded=function(){const H=A.someMap(this.featureTiles,R=>R.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",H)};S.updateRatio=function(H){const R=G(H),T=U=>1/(1<<Math.max(0,R-U.descriptor.lij[0]));let W=0,Y=0;for(const U of H)H=U.numFeatures,W+=H,Y+=H*T(U);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/W);this._farRatio=this.maximumNumberOfFeatures/Y;this.scheduleUpdated();return T};S.maximumFeaturesUpdated=function(H,R){H!==
R&&(R>H&&this.featureTiles.forEach(T=>{if(T.featuresMissing){var W=this.maximumFeaturesForTile(T);T.features&&(T.features.length>=W||5===T.fetchStatus)||(this.cancelFetchTile(T),this.resetFetchTile(T))}}),this.setDirty())};S.addTile=function(H){H=new E.FeatureTile(H);this.featureTiles.set(H.id,H);this.resetFetchTile(H);this.referenceDisplayingFeaturesFromRelatedTiles(H);return H};S.referenceDisplayingFeaturesFromRelatedTiles=function(H){const R=H.descriptor.resolution;this.featureTiles.forEach(T=>
{if(!(f.isNone(T.displayingFeatures)||H===T||H.descriptor.lij&&T.descriptor.lij&&!m.tilesAreRelated(H.descriptor.lij,T.descriptor.lij))){f.isNone(H.displayingFeatures)&&(H.displayingFeatures=[]);H.descriptor.extent&&T.descriptor.extent&&(f.isNone(H.extentIncludingBorrowedFeatures)&&(H.extentIncludingBorrowedFeatures=D.clone(H.descriptor.extent)),D.expand(H.extentIncludingBorrowedFeatures,T.descriptor.extent,H.extentIncludingBorrowedFeatures));for(const W of T.displayingFeatures)H.displayingFeatures.push(W),
T=this.displayingFeatureReferences.get(x.getObjectId(W,this.objectIdField)),T.ref(T.feature,R),this.numDisplayingFeatureReferences++}});H.featureLimit=f.isSome(H.displayingFeatures)?H.displayingFeatures.length:0};S.removeTile=function(H){this.clearTile(H);this.featureTiles.delete(H.id)};S.resetFetchTile=function(H){H.filtered=!H.intersects(this.filterExtent);H.filtered?H.needsFetching&&(H.fetchStatus=4):H.fetchStatus=0};S.cancelFetchTile=function(H){const R=H.requestController;f.isSome(R)&&(H.requestController=
null,H.resetFetching(),R.abort())};S.fetchTileCount=async function(H,R){H.numFeatures=await this.fetchCount(H,R);this.updateRatio(this.getListOfTiles());return 3===H.fetchStatus?1:0};S.fetchTile=async function(H,R){var T=this.maximumFeaturesForTile(H);if(0>=T)return I(H);const W=this.getMaxRecordCount(H);var Y=Math.ceil(T/W);if(F(H)||!this.context.capabilities.supportsMaxRecordCountFactor||H.numFeatures<=T&&Y>C.MAX_MAX_RECORD_COUNT_FACTOR)return this.fetchPagedTile(H,R);Y=this.createQuery(H);Y.maxRecordCountFactor=
Math.ceil(T/W);H.isRefetching&&H.features&&0<H.features.length&&(Y.maxRecordCountFactor=Math.max(Math.ceil(H.features.length/(1-H.emptyFeatureRatio)/W)+1,Y.maxRecordCountFactor));const {features:U,exceededTransferLimit:N,fields:ca}=await this.queryFeatures(Y,R);T=N?Y.maxRecordCountFactor>=C.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5;await this._frameTask.schedule(()=>{H.featuresMissing=U.length<H.numFeatures||N;const O=this._removeEmptyFeatures(U);H.setFeatures(U,O,K(ca))},R);this.invalidateCounts();return T};
S.fetchCount=async function(H,R){return this.context.query.queryFeatureCount(this.createFeatureCountQuery(H),{signal:R})};S.fetchPagedTile=async function(H,R){let T=0,W=0,Y,U=0,N=this.maximumFeaturesForTile(H)-U;const ca=this.getMaxRecordCount(H);let O=null;for(;;){const V=this.createQuery(H),ba=this.setPagingParameters(V,T,N,ca),{features:fa,exceededTransferLimit:ia,fields:ma}=await this.queryFeatures(V,R);await this._frameTask.schedule(()=>{ba&&(T+=f.unwrap(V.num));U+=fa.length;W+=this._removeEmptyFeatures(fa);
H.featuresMissing=T<H.numFeatures||ia;Y=Y?Y.concat(fa):fa;O=J(O,ma);H.setFeatures(Y,W,O)},R);this.invalidateCounts();this.setDirty();N=this.maximumFeaturesForTile(H)-U;if(!ba||!ia||0>=N)return ia?4:5}};S.createFeatureCountQuery=function(H){H=this.createQuery(H);this.context.capabilities.supportsCacheHint&&(H.resultType=void 0,H.cacheHint=!0);return H};S.createQuery=function(H){const R=this.context.createQuery(),T=H.descriptor.extent;T&&(R.geometry=D.toExtent(T,this.context.tilingScheme.spatialReference));
this.setResolutionParams(R,H);this.useTileQuery(H)?R.resultType="tile":this.context.capabilities.supportsCacheHint&&(R.cacheHint=!0);return R};S.setPagingParameters=function(H,R,T,W){if(!this.context.capabilities.supportsPagination)return!1;H.start=R;0<T&&this.context.capabilities.supportsMaxRecordCountFactor?(H.maxRecordCountFactor=Math.ceil(T/W),H.num=Math.min(H.maxRecordCountFactor*W,T)):H.num=Math.min(W);return!0};S.getEffectiveTileResolution=function(H){if(null==H.descriptor.resolution)return null;
const R=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(H.descriptor.resolution,R)/this.lodFactor};S.setResolutionParams=function(H,R){this.supportsResolution&&(R=this.getEffectiveTileResolution(R),null!=R&&(this.context.capabilities.supportsQuantization?H.quantizationParameters=new r({mode:"view",originPosition:"upper-left",tolerance:R,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(H.maxAllowableOffset=R)))};S._removeEmptyFeatures=
function(H){const R=H.length;for(let T=0;T<H.length;)x.hasVertices(H[T].geometry)?++T:(H[T]=H[H.length-1],--H.length);return R-H.length};S.needsNumFeatures=function(H){return this.useTileCount&&H.needsFeatureCount&&!F(H)};S.getMaxRecordCount=function(H){const {tileMaxRecordCount:R,maxRecordCount:T}=this.context;return this.useTileQuery(H)&&f.isSome(R)&&0<R&&this.context.capabilities.supportsResultType?R:f.isSome(T)&&0<T?T:2E3};S.useTileQuery=function(H){return F(H)&&this.context.capabilities.supportsCacheHint?
!1:this.context.capabilities.supportsResultType};S._handleRequest=function(H,R,T,W){H.fetchStatus=H.needsRefetching?3:2;H.requestController=T;let Y=!1;R.then(U=>{H.requestController=null;H.fetchStatus=U}).catch(U=>{H.requestController===T&&(H.requestController=null,H.fetchStatus=4);v.isAbortError(U)?Y=!0:W(U)}).then(()=>{Y||this.setDirty();this.scheduleUpdated()})};S.scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(t.schedule(()=>{this.handles.remove("scheduleUpdated");
this.updated()}),"scheduleUpdated")};S.showTile=function(H){if(f.isSome(H.displayingFeatures)&&!H.needsDisplayUpdate)return!1;var R=H.features;if(0===H.featureLimit||!R)return R=f.isSome(H.displayingFeatures)&&0<H.displayingFeatures.length,this.hideTileFeatures(H),H.displayingFeatures=[],R;const T=H.descriptor.resolution,W=this.changes.updates,Y=this.changes.adds,U=Math.min(H.featureLimit,R.length);H.featureLimit=U;for(let ca=0;ca<U;++ca){var N=R[ca];const O=x.getObjectId(N,this.objectIdField),V=
this.displayingFeatureReferences.get(O);V?(N=V.ref(N,T),N.oldVersion!==N.newVersion&&(W.removes.push(N.oldVersion),W.adds.push(N.newVersion))):(this.displayingFeatureReferences.set(O,new this.FeatureReferenceClass(N,T)),Y.push(N));this.numDisplayingFeatureReferences++}this.hideTileFeatures(H);this.applyChanges();H.displayingFeatures=R.slice(0,U);return!0};S.hideTile=function(H){this.cancelFetchTile(H);this.hideTileFeatures(H)};S.hideTileFeatures=function(H){if(!f.isNone(H.displayingFeatures)){var R=
this.changes.updates,T=this.changes.removes;for(const Y of H.displayingFeatures){const U=x.getObjectId(Y,this.objectIdField);var W=this.displayingFeatureReferences.get(U);W&&((W=W.unref(H.descriptor.resolution),this.numDisplayingFeatureReferences--,W)?W.oldVersion!==W.newVersion&&(null==W.newVersion?(this.displayingFeatureReferences.delete(U),T.push(W.oldVersion)):(R.adds.push(W.newVersion),R.removes.push(W.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();H.displayingFeatures=
null}};S.applyChanges=function(){var H=this.changes.updates;0<H.removes.length&&(this.features.removeMany(H.removes),H.removes.length=0);0<H.adds.length&&(this.features.addMany(H.adds),H.adds.length=0);H=this.changes.adds;const R=this.changes.removes,T=Math.min(H.length,R.length);let W=0;for(;W<T;){const Y=Math.min(W+200,T);this.features.addMany(H.slice(W,Y));this.features.removeMany(R.slice(W,Y));W=Y}H.length>T&&this.features.addMany(0===W?H:H.slice(W));R.length>T&&this.features.removeMany(0===W?
R:R.slice(W));H.length=0;R.length=0};S.clearTile=function(H){this.hideTile(H);H.features&&f.isSome(this.context.memoryCache)&&this.context.memoryCache.put(H.id,H.cache,16+H.estimatedSize);H.setFeatures(null,0,null);this.invalidateCounts()};S.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};S.getListOfTiles=function(){return Array.from(this.featureTiles.values())};S.maximumFeaturesForTile=function(H){const R=
H.hasPreciseFeatureCount?H.numFeatures:Infinity;return Math.min(Math.ceil((H.hasPreciseFeatureCount?R:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-H.emptyFeatureRatio)),R)};g._createClass(aa,[{key:"maximumNumberOfFeatures",set:function(H){H=H||Infinity;const R=this._get("maximumNumberOfFeatures");H===R||1>H||(this._set("maximumNumberOfFeatures",H),this.maximumFeaturesUpdated(R,H))}},{key:"memoryFactor",set:function(H){this.memoryFactor!==H&&(this._set("memoryFactor",H),this.setDirty())}},
{key:"lodFactor",set:function(H){this.lodFactor!==H&&(this._set("lodFactor",H),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&f.isSome(this.context.query.queryFeatureCount)},set:function(H){this._useTileCount=H;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let H=0;this.featureTiles.forEach(R=>H+=R.estimatedUnusedSize);return H}},{key:"totalVertices",get:function(){let H=0;this.featureTiles.forEach(R=>H+=
R.numVertices);return H}},{key:"totalFeatures",get:function(){let H=0;this.featureTiles.forEach(R=>H+=R.numFeatures);return H}},{key:"filterExtent",set:function(H){if(H&&this.context.tilingScheme&&!H.spatialReference.equals(this.context.tilingScheme.spatialReference))L.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var R=this._get("filterExtent");R===H||R&&H&&R.equals(H)||(H=H?H.clone():null,this._set("filterExtent",H),this.reclip(H,R))}}},
{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let H=null;this.featureTiles.forEach(R=>{f.isNone(R.displayingFeatures)||0===R.displayingFeatures.length||(f.isNone(H)?H=new Set(R.availableFields):H.forEach(T=>{R.availableFields.has(T)||f.unwrap(H).delete(T)}))});return f.isSome(H)?H:new Set}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",
get:function(){return this.getListOfTiles().reduce((H,R)=>H+(R.features?R.features.length:0),0)}},{key:"test",get:function(){return{process:H=>this._process(H),getFeatureTileById:H=>this.featureTiles.get(H),forEachFeatureTile:H=>this.featureTiles.forEach(H)}}}]);return aa}(l);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([d.property({value:Infinity})],
a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",
void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,
"maximumNumberOfFeaturesExceededThrottle",void 0);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);b.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=b.__decorate([h.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],
a.FeatureTileFetcher3D);const P=D.create(),Q=D.create();b=a.FeatureTileFetcher3D;a.contextCapabilitiesFromLayer=function(X){const aa=X.capabilities.query;a:switch(X.geometryType){case "polyline":X=!0;break a;case "polygon":X=X.capabilities&&X.capabilities.query&&X.capabilities.query.supportsQuantization;break a;default:X=!1}return{supportsMultipleResolutions:X,supportsPagination:!(!aa||!aa.supportsPagination),supportsResultType:!(!aa||!aa.supportsResultType),supportsCacheHint:!(!aa||!aa.supportsCacheHint),
supportsQuantization:!(!aa||!aa.supportsQuantization),supportsQuantizationEditMode:!(!aa||!aa.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!aa||!aa.supportsMaxRecordCountFactor),supportsFormatPBF:!(!aa||!aa.supportsFormatPBF)}};a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatureComparison","../../../../layers/graphics/dehydratedFeatures"],
function(a,g,b,p){p=function(){function c(e,h){this.highestResolutionVersion=null;this.versions=[];this.ref(e,h)}var d=c.prototype;d.ref=function(e,h){const n=this.feature;k.oldVersion=n;this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});for(var q of this.versions)if(q.resolution===h){q.refCount++;if((h=this.highestResolutionVersion===q&&!b.equals(e,q.feature))||this.highestResolutionVersion!==q)q.feature=e;k.newVersion=h?e:n;return k}q={feature:e,resolution:h,refCount:1};
this.versions.push(q);!this.highestResolutionVersion||h<this.highestResolutionVersion.resolution?(k.newVersion=e,this.highestResolutionVersion=q):k.newVersion=n;return k};d.unref=function(e){for(let h=0;h<this.versions.length;h++){const n=this.versions[h];if(n.resolution===e)return n.refCount--,k.oldVersion=this.feature,0===n.refCount&&(this.versions[h]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===n&&(this.recalculateHighestResolutionVersion(),k.oldVersion=
n.feature)),k.newVersion=this.feature,k}return null};d.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var e=this.versions[0];for(let h=1;h<this.versions.length;h++){const n=this.versions[h];n.resolution<e.resolution&&(e=n)}this.highestResolutionVersion=e}};g._createClass(c,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return c}();let f=function(){function c(e){this._feature=e;this.refCount=1}var d=c.prototype;d.ref=function(e){++this.refCount;k.oldVersion=this._feature;this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});b.equals(this._feature,e)||(this._feature=e);k.newVersion=this._feature;return k};d.unref=function(){k.oldVersion=this._feature;if(0<this.refCount&&
(this.refCount--,!this.isReferenced))return k.newVersion=null,k;k.newVersion=this._feature;return k};g._createClass(c,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);return c}();const k={oldVersion:null,newVersion:null};a.MultiFeatureReference=p;a.SingleFeatureReference=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/arrayUtils ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,g,b,p,f,k){const c=new Set;let d=function(){function h(q){this.descriptor=q;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=c;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var n=h.prototype;n.setFeatures=function(q,u,v){this._availableFields=b.unwrapOr(v,
c);this._features=q;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;q&&0<q.length?(this._emptyFeatureRatio=u/(q.length+u),this._numVertices=q.reduce((t,l)=>t+k.numVertices(l.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};n.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var q=0;q<this._features.length;++q){const u=k.estimateSize(this._features[q]);this._estimatedSize+=u;q>=this.featureLimit&&
(this._estimatedUnusedSize+=u)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(q=this.featureLimit;q<this._features.length;++q)this._estimatedUnusedSize+=k.estimateSize(this._features[q]);return!0}return!1};n.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};n.intersects=function(q){if(!q||!this.descriptor.extent)return!0;f.fromExtent(q,e);return f.intersects(this.descriptor.extent,e)};n.intersectionIncludingBorrowed=
function(q,u){const v=b.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!q&&!v)return f.set(u,f.POSITIVE_INFINITY),u;q?(f.fromExtent(q,u),f.intersection(u,v,u)):f.set(u,v);return u};n._shuffle=function(q){this._features.sort((u,v)=>k.getObjectId(u,q)-k.getObjectId(v,q));p.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};n.reduceFeatures=function(q,u,v){if(0>=q)return!1;if(!this._features)return this.featureLimit=
0,!1;let t=!1;this.featureLimit=Math.ceil(this.numFeatures*q);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,t=!0));!this._shuffled&&1>q&&this._shuffle(v);q=Math.max(this.featureLimit,Math.ceil(u*this.numFeatures));this._features.length>q&&(this._features.length=q,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4));return t};g._createClass(h,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},
set:function(q){this._displayingFeatures=q;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(q){this._featureLimit!==q&&(this._featureLimit=q,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},
{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(q){this._numFeatures=q}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",
get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return 2===this.fetchStatus||3===this.fetchStatus}},{key:"isRefetching",get:function(){return 3===this.fetchStatus}},{key:"needsFetching",get:function(){return 0===this.fetchStatus||1===this.fetchStatus}},{key:"needsRefetching",get:function(){return 1===this.fetchStatus}},{key:"isFetched",get:function(){return 4===this.fetchStatus||
5===this.fetchStatus}},{key:"needsDisplayUpdate",get:function(){var q;if(q=!!this._features){a:{q=this._features;var u=this.displayingFeatures,v=this.featureLimit;if(b.isNone(u)||b.isNone(q)||v!==u.length||v>q.length)q=!1;else{for(let t=0;t<v;++t)if(q[t]!==u[t]){q=!1;break a}q=!0}}q=!q}return q}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},
set:function(q){this.requestController=null;this._availableFields=q.availableFields;this._features=q.features;this._numFeatures=q.numFeatures;this._emptyFeatureRatio=q.emptyFeatureRatio;this.fetchStatus=q.fetchStatus;this.featuresMissing=q.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return h}();const e=f.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/TextSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../Graphic ../../terrain/TilingScheme".split(" "),
function(a,g,b,p,f,k,c,d,e){const h=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let n=function(){function q(v,t,l){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=v;this.view=l;this.tilingScheme=new e(t);this.loadedSymbols=h.map(w=>new c(new p({material:{color:[w[0],
w[1],w[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new c(new p({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new c(new p({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new c(new p({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var u=q.prototype;u.destroy=function(){this.enabled=!1};u.update=function(){this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:v=>
v.isFetching,symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:v=>!v.isFetching,symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:v=>!v.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(v=>{this.view.graphics.removeMany(v)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(v=>{this.view.graphics.removeMany(v)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(v=>
{this.view.graphics.removeMany(v)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};u.showDataExtent=function(v){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);v&&(v=b.fromExtent(v),this.dataExtentGraphic=new d({geometry:v,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};u.synchronizeMaps=function(v,t){const l=[];v.forEach((w,
y)=>{const D=this.tileFetcher.test.getFeatureTileById(y);D&&t.filter(D)||(this.view.graphics.removeMany(w),l.push(y))});l.forEach(w=>v.delete(w));this.tileFetcher.test.forEachFeatureTile(w=>{if(t.filter(w)&&!v.has(w.id)){const [z,r,C]=w.descriptor.lij;this.tilingScheme.ensureMaxLod(z);var y=this.tilingScheme.getExtentGeometry(z,r,C),D=new d({geometry:y,symbol:t.symbols[z%t.symbols.length]});y=new d({geometry:y.center,symbol:new k({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",
border:{color:"black"}},symbolLayers:[new f({text:`${z}/${r}/${C}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});D=[D,y];v.set(w.id,D);this.view.graphics.addMany(D)}})};g._createClass(q,[{key:"enabled",get:function(){return this._enabled},set:function(v){this._enabled=v;this.update()}}]);return q}();a.FeatureTileFetcher3DDebugger=n;a.default=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/Evented","../../../core/SetUtils"],function(a,g,b,p){b=function(f){function k(){var d=f.apply(this,arguments)||this;d._set=new Set;return d}g._inheritsLoose(k,f);var c=k.prototype;c.clear=function(){if(0<this._set.size){const d=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:d})}};c.addMany=function(d){if(0!==d.length){for(const e of d)this._set.add(e);this.emit("after-changes",{type:1});this.emit("change",{added:d,removed:[]})}};
c.remove=function(d){this._set.delete(d)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[d]}))};c.removeMany=function(d){const e=[];for(const h of d)this._set.delete(h)&&e.push(h);0<e.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e}))};c.toArray=function(){return[...this._set]};c.find=function(d){let e;p.someSet(this._set,h=>d(h)?(e=h,!0):!1);return e};c.forEach=function(d){this._set.forEach(e=>d(e))};g._createClass(k,[{key:"length",
get:function(){return this._set.size}}]);return k}(b);a.EventedSet=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/SetUtils":function(){define(["exports","./maybe"],function(a,g){a.someSet=function(b,p){for(const f of b.entries())if(p(f[0]))return!0;return!1};a.union=function(b,p){const f=new Set;g.isSome(b)&&b.forEach(k=>f.add(k));g.isSome(p)&&p.forEach(k=>f.add(k));return f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../../support/Scheduler ../../../tasks/support/Query ../../../layers/graphics/hydratedFeatures ../../../renderers/support/renderingInfoUtils ../../../layers/graphics/controllers/FeatureTileController3D ./support/projectExtentUtils ./graphics/QueryEngine ./graphics/Graphics3DFeatureLikeLayerView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){a.FeatureLikeLayerView3D=x=>{x=function(m){function B(){var F=m.apply(this,arguments)||this;F.controller=null;F.asyncGraphicsUpdates=!1;F.suspendResumeExtentMode="computed";F.slicePlaneEnabled=!1;F.drapeSourceType=1;F.fullExtentInLocalViewSpatialReference=null;F.suspendResumeExtent=null;F._controllerCreated=!1;F.clippingExtent=null;F.supportsHeightUnitConversion=!0;F.pendingController=null;F.queryEngine=null;return F}g._inheritsLoose(B,m);var E=
B.prototype;E.initialize=function(){const F=this.layer;"isTable"in F&&F.isTable?this.addResolvingPromise(Promise.reject(new n("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:F}))):(this._set("graphics3d",new A({owner:this,layer:F,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,
updateClippingExtent:G=>this.updateClippingExtent(G)})),this.updatingHandles.add(this,"asyncGraphicsUpdates",G=>{this.graphics3d.graphicsCore.preferredUpdatePolicy=G?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",G=>{this.graphics3d.suspendResumeExtentMode=G}),this.addResolvingPromise(this.graphics3d.setup().then(()=>this.validateGeometryType()).then(()=>this.queryEngine=new C["default"]({layerView:this,task:l.Task.FEATURE_QUERY_ENGINE})).then(()=>r.toViewIfLocal(this)).then(G=>this.fullExtentInLocalViewSpatialReference=
G).then(()=>this.initializeController())),this.notifyChange("updating"))};E.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null);this.loadedGraphics=null};E.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};E.notifyGraphicGeometryChanged=
function(F){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(F)};E.notifyGraphicVisibilityChanged=function(F){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(F)};E.getRenderingInfo=function(F,G,I){F=D.getRenderingInfo(F,{renderer:G,arcade:I});f.isSome(F)&&F.color&&(G=F.color,G[0]/=255,G[1]/=255,G[2]/=255);return F};E.getRenderingInfoAsync=async function(F,G,I,K){return D.getRenderingInfoAsync(F,{renderer:G,arcade:I,...K})};E.getGraphicFromGraphicUid=function(F){let G=null;this.loadedGraphics&&
this.loadedGraphics.forEach(I=>{I.uid===F&&(G=y.hydrateGraphic(I,this.layer))});return G};E.whenGraphicBounds=function(F,G){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(F,G):null};E.computeAttachmentOrigin=function(F,G){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(F,G):null};E.getSymbolLayerSize=function(F,G){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(F,G):null};E.queryFeatures=function(F,G){return this.queryEngine.executeQuery(this._ensureQuery(F),
f.get(G,"signal"))};E.queryObjectIds=function(F,G){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),f.get(G,"signal"))};E.queryFeatureCount=function(F,G){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),f.get(G,"signal"))};E.queryExtent=function(F,G){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),f.get(G,"signal"))};E._ensureQuery=function(F){return f.isNone(F)?this.createQuery():w.from(F)};E.highlight=function(F){return this.graphics3d.highlight(F,
this.layer.objectIdField)};E.maskOccludee=function(F){return this.graphics3d.maskOccludee(F)};E.canResume=function(){return m.prototype.canResume.call(this)&&(!this.graphics3d||!this.graphics3d.suspended)};E.getSuspendInfo=function(){const F=m.prototype.getSuspendInfo.call(this);return this.graphics3d?{...F,...this.graphics3d.suspendInfo}:F};E.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&
this.view.basemapTerrain.ready&&!this.graphics3d.updating)};E.initializeController=async function(){const F=this.createController();this.pendingController=F;await F.when();this.setControllerWhenInitialized(F)};E.setControllerWhenInitialized=async function(F){try{await this.when()}catch(G){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this.destroyPendingController():(await t.whenTrueOnce(this.view,"basemapTerrain.ready"),this.beforeSetController(F),this.pendingController=
null,this.controller=F,this.loadedGraphics=F.graphics,this.notifyChange("updating"))};E.updateClippingExtent=function(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}};E.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return Promise.reject(new n("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",
{geometryType:this.layer.geometryType}))}};E._getResourceInfo=function(){const F=this.controller&&this.controller instanceof z?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:F?F.maximumNumberOfFeatures:-1,totalNumberOfFeatures:F?F.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};
g._createClass(B,[{key:"legendEnabled",get:function(){var F,G;return this.canResume()&&!(null!=(F=this.graphics3d)&&null!=(G=F.frustumVisibility)&&G.suspended)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:
null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return B}(x);b.__decorate([d.property()],x.prototype,"loadedGraphics",void 0);b.__decorate([d.property()],x.prototype,"suspended",void 0);b.__decorate([d.property({readOnly:!0})],x.prototype,"legendEnabled",null);b.__decorate([d.property()],x.prototype,"updating",void 0);b.__decorate([d.property()],x.prototype,"controller",void 0);b.__decorate([d.property()],x.prototype,"graphics3d",void 0);b.__decorate([d.property({readOnly:!0})],
x.prototype,"asyncGraphicsUpdates",void 0);b.__decorate([d.property({readOnly:!0})],x.prototype,"suspendResumeExtentMode",void 0);b.__decorate([d.property({type:Boolean})],x.prototype,"slicePlaneEnabled",void 0);b.__decorate([d.property({readOnly:!0})],x.prototype,"suspendInfo",void 0);return x=b.__decorate([h.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports",
"../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,g,b){a.toViewIfLocal=function(p){const f=p.view.spatialReference,k=p.layer.fullExtent,c=k&&k.spatialReference;return c?c.equals(f)?Promise.resolve(k.clone()):g.canProject(c,f)?Promise.resolve(g.project(k,f)):p.view.state.isLocal?b.projectGeometry(k,f,p.layer.portalItem).then(d=>!p.destroyed&&d?d:void 0).catch(()=>null):Promise.resolve(null):Promise.resolve(null)};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../geometry/support/typeUtils ../../../../geometry ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=z["default"];a.QueryEngine=function(C){function A(m){m=C.call(this,m)||this;m._dataQueryEngineInstance=null;return m}g._inheritsLoose(A,C);var x=A.prototype;x.destroy=function(){this.clear()};x.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};x.executeQueryForIdSet=async function(m,B){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(m),
B)};x.executeQueryForCount=async function(m,B){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(m),B)};x.executeQueryForExtent=async function(m,B){const {count:E,extent:F}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(m),B);m=t.fromJSON(F);return{count:E,extent:m}};x.executeQueryForIds=async function(m,B){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(m),B)};x.executeQueryForLatestObservations=async function(m,B){m=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(m),
B);m=y.fromJSON(m);m.features.forEach(E=>{E.layer=this.layer;E.sourceLayer=this.layer});return m};x.executeQuery=async function(m,B){m=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(m),B);m=y.fromJSON(m);m.features.forEach(E=>{E.layer=this.layer;E.sourceLayer=this.layer});return m};x._ensureQueryJSON=function(m){if(f.isNone(m))return this.defaultQueryJSON;"outSpatialReference"in m&&!m.outSpatialReference&&(m.outSpatialReference=this.spatialReference);return m.toJSON()};x.ensureDataQueryEngine=
function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const m="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,B=this.layer.objectIdField,E=l.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),F=this.layer.fields.map(Q=>Q.toJSON()),G=this.layerView.view.resourceController.scheduler,I=this.task,K=this.spatialReference.toJSON(),J=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:L,hasM:P}=this.layerView;return this._dataQueryEngineInstance=
new r({hasZ:L,hasM:P,geometryType:E,fields:F,timeInfo:m,spatialReference:K,objectIdField:B,featureStore:J,scheduler:G,task:I})};g._createClass(A,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new D({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);
return A}(v);b.__decorate([d.property({constructOnly:!0})],a.QueryEngine.prototype,"layerView",void 0);b.__decorate([d.property({constructOnly:!0})],a.QueryEngine.prototype,"task",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.QueryEngine.prototype,"spatialReference",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layerView.layer"})],a.QueryEngine.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0})],a.QueryEngine.prototype,"queryGeometryType",
null);b.__decorate([d.property({readOnly:!0})],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([h.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);a.default=a.QueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/lang ../../../core/maybe ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../core/unitUtils ../../../geometry/support/normalizeUtils ../../../core/MemCache ../../../geometry/support/aaBoundingRect ../../support/PromiseQueue ../../support/FieldsIndex ./QueryEngineCapabilities ../../../geometry/support/aaBoundingBox ./projectionSupport ./attributeSupport ./utils ./spatialQuerySupport ./timeSupport ./QueryEngineResult".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C){function A(I){return I.every(K=>"exceedslimit"!==K.statisticType)}const x=new Set,m=new n.MemCacheStorage(2E6);let B=0,E=function(){function I(J){this.capabilities={query:t.queryCapabilities};this.geometryType=J.geometryType;this.hasM=J.hasM;this.hasZ=J.hasZ;this.objectIdField=J.objectIdField;this.spatialReference=J.spatialReference;this.definitionExpression=J.definitionExpression;this.featureStore=J.featureStore;this.aggregateAdapter=J.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=J.timeInfo;J.cacheSpatialQueries&&(this._geometryQueryCache=new n.MemCache(B++ +"$$",m));this.fieldsIndex=new v(J.fields);J.scheduler&&J.task&&(this._frameQueue=new u,this._frameTask=J.scheduler.registerTask(J.task,L=>this._update(L),()=>0<this._frameQueue.length))}var K=I.prototype;K.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=
null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};K.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};K.executeQuery=async function(J={},L){let P=b.clone(J),Q;try{P=await this._schedule(()=>D.normalizeQuery(P,this.definitionExpression,this.spatialReference),L),P=await this._reschedule(()=>this._checkQuerySupport(P),
L),Q=await this._reschedule(()=>this._executeGeometryQuery(P,L),L),Q=await this._reschedule(()=>Q.executeAggregateIdsQuery(P),L),Q=await this._reschedule(()=>Q.executeObjectIdsQuery(P),L),Q=await this._reschedule(()=>Q.executeTimeQuery(P),L),Q=await this._reschedule(()=>Q.executeAttributesQuery(P),L)}catch(X){if(X!==D.QUERY_ENGINE_EMPTY_RESULT)throw X;Q=new C([],null,this)}return Q.createQueryResponse(P)};K.executeQueryForCount=async function(J={},L){let P=b.clone(J),Q;P.returnGeometry=!1;P.returnCentroid=
!1;P.outSR=null;try{P=await this._schedule(()=>D.normalizeQuery(P,this.definitionExpression,this.spatialReference),L),P=await this._reschedule(()=>this._checkQuerySupport(P),L),Q=await this._reschedule(()=>this._executeGeometryQuery(P,L),L),Q=await this._reschedule(()=>Q.executeAggregateIdsQuery(P),L),Q=await this._reschedule(()=>Q.executeObjectIdsQuery(P),L),Q=await this._reschedule(()=>Q.executeTimeQuery(P),L),Q=await this._reschedule(()=>Q.executeAttributesQuery(P),L)}catch(X){if(X!==D.QUERY_ENGINE_EMPTY_RESULT)throw X;
return 0}return Q.createQueryResponseForCount(P)};K.executeQueryForExtent=async function(J={},L){let P=b.clone(J),Q;J=P.outSR;try{P=await this._schedule(()=>D.normalizeQuery(P,this.definitionExpression,this.spatialReference),L);P=await this._reschedule(()=>this._checkQuerySupport(P),L);P.returnGeometry=!0;P.returnCentroid=!1;P.outSR=null;Q=await this._reschedule(()=>this._executeGeometryQuery(P,L),L);Q=await this._reschedule(()=>Q.executeAggregateIdsQuery(P),L);Q=await this._reschedule(()=>Q.executeObjectIdsQuery(P),
L);Q=await this._reschedule(()=>Q.executeTimeQuery(P),L);Q=await this._reschedule(()=>Q.executeAttributesQuery(P),L);const X=Q.size;if(!X)return{count:X,extent:null};l.set(G,l.NEGATIVE_INFINITY);this.featureStore.forEachBounds(Q.items,H=>l.expandWithAABB(G,H),F);const aa={xmin:G[0],ymin:G[1],xmax:G[3],ymax:G[4],spatialReference:D.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(G[2])&&isFinite(G[5])&&(aa.zmin=G[2],aa.zmax=G[5]);const S=w.project(aa,Q.spatialReference,J);S.spatialReference=
D.cleanFromGeometryEngine(J||this.spatialReference);if(0===S.xmax-S.xmin){const H=e.getMetersPerUnitForSR(S.spatialReference);S.xmin-=H;S.xmax+=H}if(0===S.ymax-S.ymin){const H=e.getMetersPerUnitForSR(S.spatialReference);S.ymin-=H;S.ymax+=H}if(this.hasZ&&null!=S.zmin&&null!=S.zmax&&0===S.zmax-S.zmin){const H=e.getMetersPerUnitForSR(S.spatialReference);S.zmin-=H;S.zmax+=H}return{count:X,extent:S}}catch(X){if(X===D.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw X;}};K.executeQueryForIds=
async function(J={},L){return this.executeQueryForIdSet(J,L).then(P=>Array.from(P))};K.executeQueryForIdSet=async function(J={},L){let P=b.clone(J),Q;P.returnGeometry=!1;P.returnCentroid=!1;P.outSR=null;try{P=await this._schedule(()=>D.normalizeQuery(P,this.definitionExpression,this.spatialReference),L);P=await this._reschedule(()=>this._checkQuerySupport(P),L);Q=await this._reschedule(()=>this._executeGeometryQuery(P,L),L);Q=await this._reschedule(()=>Q.executeAggregateIdsQuery(P),L);Q=await this._reschedule(()=>
Q.executeObjectIdsQuery(P),L);Q=await this._reschedule(()=>Q.executeTimeQuery(P),L);Q=await this._reschedule(()=>Q.executeAttributesQuery(P),L);const X=Q.items,aa=new Set;await this._reschedule(()=>{for(const S of X)aa.add(Q.featureAdapter.getObjectId(S))},L);return aa}catch(X){if(X===D.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw X;}};K.executeQueryForSnapping=async function(J,L){const {point:P,distance:Q,types:X}=J;if(0===X)return{candidates:[]};const aa=await this._reschedule(()=>this._checkQuerySupport(J.query),
L),S=!k.equals(P.spatialReference,this.spatialReference);S&&await w.checkProjectionSupport(P.spatialReference,this.spatialReference);var H="number"===typeof Q?Q:Q.x,R="number"===typeof Q?Q:Q.y;H={xmin:P.x-H,xmax:P.x+H,ymin:P.y-R,ymax:P.y+R,spatialReference:P.spatialReference};H=S?w.project(H,this.spatialReference):H;if(!H)return{candidates:[]};R=(await h.normalizeCentralMeridian(d.fromJSON(P),null,{signal:L}))[0];const T=(await h.normalizeCentralMeridian(d.fromJSON(H),null,{signal:L}))[0];if(p.isNone(R)||
p.isNone(T))return{candidates:[]};let W=new C(this._searchFeatures(this._getQueryBBoxes(T.toJSON())),null,this);W=await this._reschedule(()=>W.executeObjectIdsQuery(aa),L);W=await this._reschedule(()=>W.executeTimeQuery(aa),L);W=await this._reschedule(()=>W.executeAttributesQuery(aa),L);L=R.toJSON();L=S?w.project(L,this.spatialReference):L;return W.createSnappingResponse({...J,point:L,distance:S?Math.max(H.xmax-H.xmin,H.ymax-H.ymin)/2:Q},P.spatialReference)};K.executeQueryForLatestObservations=async function(J=
{},L){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new f("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:J,timeInfo:this.timeInfo});let P=b.clone(J),Q;try{P=await this._schedule(()=>D.normalizeQuery(P,this.definitionExpression,this.spatialReference),L),P=await this._reschedule(()=>this._checkQuerySupport(P),L),Q=await this._reschedule(()=>this._executeGeometryQuery(P,L),L),Q=await this._reschedule(()=>Q.executeAggregateIdsQuery(P),L),Q=await this._reschedule(()=>
Q.executeObjectIdsQuery(P),L),Q=await this._reschedule(()=>Q.executeTimeQuery(P),L),Q=await this._reschedule(()=>Q.executeAttributesQuery(P),L),Q=await this._reschedule(()=>Q.filterLatest(),L)}catch(X){if(X!==D.QUERY_ENGINE_EMPTY_RESULT)throw X;Q=new C([],null,this)}return Q.createQueryResponse(P)};K._schedule=async function(J,L){return this._frameQueue?this._frameQueue.push(J,L):J()};K._reschedule=async function(J,L){return this._frameQueue?this._frameQueue.unshift(J,L):J()};K._update=function(J){for(this._budget=
J;!J.done&&this._frameQueue&&this._frameQueue.process();)J.madeProgress();this._budget=null};K._getAll=function(){if(!this._allItems){const J=[];this.featureStore.forEach(L=>J.push(L));this._allItems=new C(J,null,this)}return this._allItems};K._executeGeometryQuery=async function(J,L){const {geometry:P,outSR:Q,spatialRel:X,returnGeometry:aa,returnCentroid:S}=J,H=aa||S,R=k.isValid(Q)&&!k.equals(this.spatialReference,Q),T=this._geometryQueryCache?R&&H?JSON.stringify({geometry:P,spatialRelationship:X,
outSpatialReference:Q}):JSON.stringify({geometry:P,spatialRelationship:X}):null;if(T){var W=this._geometryQueryCache.get(T);if(!p.isUndefined(W))return W}W=async ca=>{if(R&&H)return ca=await ca.project(Q),T&&this._geometryQueryCache.put(T,ca,ca.size||1),ca;T&&this._geometryQueryCache.put(T,ca,ca.size||1);return ca};if(!P)return W(this._getAll());const Y=this.featureAdapter;if("esriSpatialRelDisjoint"===X){J=this._searchFeatures(this._getQueryBBoxes(P));if(!J.length)return W(this._getAll());let ca,
O;const V=new Set;for(var U of J)V.add(Y.getObjectId(U));await this._reschedule(()=>{let ba=0;ca=Array(V.size);this.featureStore.forEach(fa=>ca[ba++]=fa);O=V},L);J=await this._reschedule(async()=>{const ba=await z.getSpatialQueryOperator(X,P,this.geometryType,this.hasZ,this.hasM);return new C(await this._runSpatialFilter(ca,fa=>!O.has(Y.getObjectId(fa))||ba(Y.getGeometry(fa)),L),P,this)},L);return W(J)}U=this._searchFeatures(this._getQueryBBoxes(P));if(!U.length)return W=new C([],P,this),T&&this._geometryQueryCache.put(T,
W,W.size||1),W;if(this._canExecuteSoloPass(P,J))return W(new C(U,P,this));const N=await z.getSpatialQueryOperator(X,P,this.geometryType,this.hasZ,this.hasM);J=await this._runSpatialFilter(U,ca=>N(Y.getGeometry(ca)),L);return W(new C(J,P,this))};K._runSpatialFilter=async function(J,L,P){if(!L)return J;if(!this._budget)return J.filter(S=>L(S));let Q=0;const X=[],aa=async()=>{for(;Q<J.length;){const S=J[Q];L(S)&&X.push(S);this._budget.done&&await this._reschedule(()=>aa(),P);++Q}};return this._reschedule(()=>
aa(),P).then(()=>X)};K._canExecuteSoloPass=function(J,L){const {geometryType:P}=this;({spatialRel:L}=L);return z.canQueryWithRBush(J)&&("esriSpatialRelEnvelopeIntersects"===L||"esriGeometryPoint"===P&&("esriSpatialRelIntersects"===L||"esriSpatialRelContains"===L||"esriSpatialRelWithin"===L))};K._getQueryBBoxes=function(J){if(z.canQueryWithRBush(J)){if(d.isExtent(J))return[q.fromValues(J.xmin,J.ymin,J.xmax,J.ymax)];if(d.isPolygon(J))return J.rings.map(L=>q.fromValues(Math.min(L[0][0],L[2][0]),Math.min(L[0][1],
L[2][1]),Math.max(L[0][0],L[2][0]),Math.max(L[0][1],L[2][1])))}return[c.getBoundsXY(q.create(),J)]};K._searchFeatures=function(J){for(const Q of J)this.featureStore.forEachInBounds(Q,X=>{x.add(X)});const L=Array(x.size);let P=0;x.forEach(Q=>L[P++]=Q);x.clear();return L};K._checkQuerySupport=async function(J){if(0>J.distance||null!=J.geometryPrecision||J.multipatchOption||J.pixelSize||J.relationParam||J.text)throw new f("feature-store:unsupported-query","Unsupported query options",{query:J});return Promise.all([this._checkAttributesQuerySupport(J),
this._checkStatisticsQuerySupport(J),z.checkSpatialQuerySupport(J,this.geometryType,this.spatialReference),w.checkProjectionSupport(this.spatialReference,J.outSR)]).then(()=>J)};K._checkAttributesQuerySupport=function(J){const {outFields:L,orderByFields:P,returnDistinctValues:Q,outStatistics:X}=J,aa=X?X.map(S=>S.outStatisticFieldName&&S.outStatisticFieldName.toLowerCase()):[];if(P&&0<P.length){const S=P.map(H=>{const R=H.toLowerCase();return-1<R.indexOf(" asc")?R.split(" asc")[0]:-1<R.indexOf(" desc")?
R.split(" desc")[0]:H}).filter(H=>-1===aa.indexOf(H));y.validateFields(this.fieldsIndex,S,"orderByFields contains missing fields")}if(L&&0<L.length)y.validateFields(this.fieldsIndex,L,"outFields contains missing fields");else if(Q)throw new f("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:J});y.validateWhere(this.fieldsIndex,J.where)};K._checkStatisticsQuerySupport=async function(J){const {outStatistics:L,groupByFieldsForStatistics:P,having:Q}=J;
var X=P&&P.length,aa=L&&L.length;if(Q){if(!X||!aa)throw new f("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:J});y.validateHaving(this.fieldsIndex,Q,L)}if(aa&&A(L)){aa=L.map(S=>S.onStatisticField);y.validateFields(this.fieldsIndex,aa,"onStatisticFields contains missing fields");X&&y.validateFields(this.fieldsIndex,P,"groupByFieldsForStatistics contains missing fields");for(const S of L){const {onStatisticField:H,statisticType:R}=
S;if(("percentile_disc"===R||"percentile_cont"===R)&&"statisticParameters"in S){if({statisticParameters:X}=S,!X)throw new f("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:S,query:J});}else if("count"!==R&&H&&y.hasInvalidFieldType(H,this.fieldsIndex))throw new f("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:S,query:J});}}};g._createClass(I,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},
{key:"fullExtent",get:function(){const J=this.featureStore.fullBounds;return J?{xmin:J[0],ymin:J[1],xmax:J[2],ymax:J[3],spatialReference:D.cleanFromGeometryEngine(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=r.getTimeExtent(this.timeInfo,this.featureStore):null}}]);return I}();const F=l.create(),G=l.create();a.Feature=function(I,K=null,J,L,P){this.attributes=I;this.geometry=J;this.centroid=L;this.filterFlags=
P;this.groupId=-1;this.displayId=K};a.default=E;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(a){a.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,
supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../geometry/support/spatialReferenceUtils",
"../../../geometry/support/webMercatorUtils","../../../geometry/projection","../../../geometry/geometryAdapters/json"],function(a,g,b,p,f){function k(u,v){if(!v)return null;if("x"in v){var t={x:0,y:0};[t.x,t.y]=u(v.x,v.y,e);null!=v.z&&(t.z=v.z);null!=v.m&&(t.m=v.m);return t}if("xmin"in v)return t={xmin:0,ymin:0,xmax:0,ymax:0},[t.xmin,t.ymin]=u(v.xmin,v.ymin,e),[t.xmax,t.ymax]=u(v.xmax,v.ymax,e),v.hasZ&&(t.zmin=v.zmin,t.zmax=v.zmax,t.hasZ=!0),v.hasM&&(t.mmin=v.mmin,t.mmax=v.mmax,t.hasM=!0),t;if("rings"in
v)return{rings:c(v.rings,u),hasM:v.hasM,hasZ:v.hasZ};if("paths"in v)return{paths:c(v.paths,u),hasM:v.hasM,hasZ:v.hasZ};if("points"in v)return{points:d(v.points,u),hasM:v.hasM,hasZ:v.hasZ}}function c(u,v){const t=[];for(const l of u)t.push(d(l,v));return t}function d(u,v){const t=[];for(const l of u)u=v(l[0],l[1],[0,0]),t.push(u),2<l.length&&u.push(l[2]),3<l.length&&u.push(l[3]);return t}const e=[0,0],h=k.bind(null,b.lngLatToXY),n=k.bind(null,b.xyToLngLat),q=new (function(){function u(){this._jobs=
[];this._timer=null;this._process=this._process.bind(this)}var v=u.prototype;v.push=async function(t,l,w){t&&t.length&&l&&w&&g.equals(l,w);const y={geometries:t,inSpatialReference:l,outSpatialReference:w,resolve:null};this._jobs.push(y);return new Promise(D=>{y.resolve=D;null===this._timer&&(this._timer=setTimeout(this._process,10))})};v._process=function(){this._timer=null;const t=this._jobs.shift();if(t){var {geometries:l,inSpatialReference:w,outSpatialReference:y,resolve:D}=t;b.canProject(w,y)?
g.isWebMercator(y)?D(l.map(h)):D(l.map(n)):D(p.projectMany(f.jsonAdapter,l,w,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return u}());a.checkProjectionSupport=async function(u,v){v&&(u=Array.isArray(u)?u.map(t=>{var l;return null==(l=t.geometry)?void 0:l.spatialReference}):[u],await p.initializeProjection(u.map(t=>({source:t,dest:v}))))};a.project=function(u,v,t){if(!u)return u;t||(t=v,v=u.spatialReference);return g.isValid(v)&&g.isValid(t)&&!g.equals(v,t)?b.canProject(v,
t)?g.isWebMercator(t)?h(u):n(u):p.projectMany(f.jsonAdapter,[u],v,t,null)[0]:u};a.projectMany=async function(u,v,t){return q.push(u,v,t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let g=function(c,d,e){this.x=c;this.y=d;this.spatialReference=e;this.m=this.z=void 0},b=function(c,d,e,h){this.rings=c;this.spatialReference=d;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);h&&(this.hasM=h)},p=function(c,d,e,h){this.paths=
c;this.spatialReference=d;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);h&&(this.hasM=h)},f=function(c,d,e,h){this.points=c;this.spatialReference=d;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);h&&(this.hasM=h)},k=function(c,d,e,h,n){this.xmin=c;this.ymin=d;this.xmax=e;this.ymax=h;this.spatialReference=n;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(c,d){return null==d?null:c.convertJSONToGeometry(d)},exportPoint:function(c,d,e){e=new g(c.getPointX(d),c.getPointY(d),
e);const h=c.hasZ(d),n=c.hasM(d);h&&(e.z=c.getPointZ(d));n&&(e.m=c.getPointM(d));return e},exportPolygon:function(c,d,e){return new b(c.exportPaths(d),e,c.hasZ(d),c.hasM(d))},exportPolyline:function(c,d,e){return new p(c.exportPaths(d),e,c.hasZ(d),c.hasM(d))},exportMultipoint:function(c,d,e){return new f(c.exportPoints(d),e,c.hasZ(d),c.hasM(d))},exportExtent:function(c,d,e){var h=c.hasZ(d);const n=c.hasM(d);e=new k(c.getXMin(d),c.getYMin(d),c.getXMax(d),c.getYMax(d),e);h&&(h=c.getZExtent(d),e.zmin=
h.vmin,e.zmax=h.vmax);n&&(c=c.getMExtent(d),e.mmin=c.vmin,e.mmax=c.vmax);return e}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,g,b){function p(e,h){return e?c.get(e,h):null}function f(e,h,n,q=!0){const u=[];for(const v of h)if("*"!==v&&!e.has(v))if(q){h=k(v);try{const t=p(h,e);if(!t)throw new g("feature-store:unsupported-query","invalid SQL expression",
{where:h});if(!t.isStandardized)throw new g("feature-store:unsupported-query","expression is not standard",{clause:t});f(e,t.fieldNames,"expression contains missing fields")}catch(t){if((h=t&&t.details)&&(h.clause||h.where))throw t;h&&h.missingFields?u.push(...h.missingFields):u.push(v)}}else u.push(v);if(u.length)throw new g("feature-store:unsupported-query",n,{missingFields:u});}function k(e){return e.split(" as ")[0]}const c=new b.WhereClauseCache(50,500),d=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));
a.getAliasFromFieldName=function(e){return e.split(" as ")[1]};a.getExpressionFromFieldName=k;a.getWhereClause=p;a.hasInvalidFieldType=function(e,h){return(e=h.get(e))?!d.has(e.type):!1};a.validateFields=f;a.validateHaving=function(e,h,n){if(!h)return!0;const q=c.get(h,e);if(!q)throw new g("feature-store:unsupported-query","invalid SQL expression",{having:h});if(!q.isAggregate)throw new g("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:h});f(e,q.fieldNames,
"having contains missing fields");if(!q.getExpressions().every(u=>{const {aggregateType:v,field:t}=u,l=e.has(t)&&e.get(t).name;return n.some(w=>{const {onStatisticField:y,statisticType:D}=w;return(e.has(y)&&e.get(y).name)===l&&D.toLowerCase().trim()===v})}))throw new g("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:h});return!0};a.validateWhere=function(e,h){if(!h)return!0;const n=c.get(h,e);if(!n)throw new g("feature-store:unsupported-query",
"invalid SQL expression",{where:h});if(!n.isStandardized)throw new g("feature-store:unsupported-query","where clause is not standard",{where:h});f(e,n.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,g,b){let p=function(){function f(k,c){this._cache=new g(k);this._invalidCache=new g(c)}f.prototype.get=function(k,c){const d=`${c.uid}:${k}`,
e=this._cache.get(d);if(e)return e;if(void 0!==this._invalidCache.get(d))return null;try{const h=b.WhereClause.create(k,c);this._cache.put(d,h);return h}catch{return this._invalidCache.put(d,null),null}};return f}();a.WhereClauseCache=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,g,b,p,f,k){function c(I,K){I+=
"";return I.length>=K?I:Array(K-I.length+1).join("0")+I}function d(I,K,J="0",L="0",P="0",Q="0",X="",aa="0",S="0"){return"+"===X||"-"===X?(I=`${c(parseInt(I,10),4)}-${c(parseInt(K,10),2)}-${c(parseInt(J,10),2)}`,K="",10>parseFloat(Q)&&(K="0"),L=`${c(parseInt(L,10),2)}:${c(parseInt(P,10),2)}:${K+parseFloat(Q).toString()}`,X=`${X}${c(parseInt(aa,10),2)}:${c(parseInt(S,10),2)}`,new Date(I+"T"+L+X)):new Date(parseInt(I,10),parseInt(K,10)-1,parseInt(J,10),parseInt(L,10),parseInt(P,10),parseFloat(Q))}function e(I){let K=
A.exec(I);if(null!==K){const [,J,L,P,Q,X,aa]=K;return d(J,L,P,Q,X,aa)}K=x.exec(I);if(null!==K){const [,J,L,P,Q,X,aa,S,H,R]=K;return d(J,L,P,Q,X,aa,S,H,R)}K=m.exec(I);if(null!==K){const [,J,L,P,Q,X,aa,S,H]=K;return d(J,L,P,Q,X,"0",aa,S,H)}K=B.exec(I);if(null!==K){const [,J,L,P,Q,X]=K;return d(J,L,P,Q,X)}K=C.exec(I);if(null!==K){const [,J,L,P]=K;return d(J,L,P)}throw Error("SQL Invalid Timestamp");}function h(I){I=C.exec(I);if(null===I)throw Error("SQL Invalid Date");const [,K,J,L]=I;return new Date(parseInt(K,
10),parseInt(J,10)-1,parseInt(L,10))}function n(I){return Array.isArray(I)?I:[I]}function q(I){return null!==I?!0!==I:null}function u(I,K){return null!=I&&null!=K?!0===I&&!0===K:!1===I||!1===K?!1:null}function v(I,K){return null!=I&&null!=K?!0===I||!0===K:!0===I||!0===K?!0:null}function t(I,K){if(null==I)return null;let J=!1;for(const L of K)if(null==L)J=null;else if(I===L){J=!0;break}return J}function l(I,K,J){if(null==I)return null;let L="",P=0;for(let Q=0;Q<K.length;Q++){const X=K.charAt(Q);switch(P){case 0:X===
J?P=1:L=0<="-[]/{}()*+?.\\^$|".indexOf(X)?L+("\\"+X):"%"===X?L+".*":"_"===X?L+".":L+X;break;case 1:L=0<="-[]/{}()*+?.\\^$|".indexOf(X)?L+("\\"+X):L+X,P=0}}return(new RegExp("^"+L+"$")).test(I)}function w(I){return I instanceof Date?I.valueOf():I}function y(I,K,J){if(null==K||null==J)return null;K=w(K);J=w(J);switch(I){case "\x3c\x3e":return K!==J;case "\x3d":return K===J;case "\x3e":return K>J;case "\x3c":return K<J;case "\x3e\x3d":return K>=J;case "\x3c\x3d":return K<=J}}function D(I){const K=[],
J={};for(const L of I)I=L.toLowerCase(),void 0===J[I]&&(K.push(L),J[I]=1);return K}function z(I,K,J){if(K instanceof f.SqlInterval)if(J instanceof Date)switch(I){case "+":return new Date(K.valueInMilliseconds()+J.getTime());case "-":return K.valueInMilliseconds()-J.getTime();case "*":return K.valueInMilliseconds()*J.getTime();case "/":return K.valueInMilliseconds()/J.getTime()}else if(J instanceof f.SqlInterval)switch(I){case "+":return f.SqlInterval.createFromMilliseconds(K.valueInMilliseconds()+
J.valueInMilliseconds());case "-":return f.SqlInterval.createFromMilliseconds(K.valueInMilliseconds()-J.valueInMilliseconds());case "*":return K.valueInMilliseconds()*J.valueInMilliseconds();case "/":return K.valueInMilliseconds()/J.valueInMilliseconds()}else K=K.valueInMilliseconds();else if(J instanceof f.SqlInterval)if(K instanceof Date)switch(I){case "+":return new Date(J.valueInMilliseconds()+K.getTime());case "-":return new Date(K.getTime()-J.valueInMilliseconds());case "*":return K.getTime()*
J.valueInMilliseconds();case "/":return K.getTime()/J.valueInMilliseconds()}else J=J.valueInMilliseconds();else if(K instanceof Date&&"number"===typeof J)switch(J*=864E5,K=K.getTime(),I){case "+":return new Date(K+J);case "-":return new Date(K-J);case "*":return new Date(K*J);case "/":return new Date(K/J)}else if(J instanceof Date&&"number"===typeof K)switch(K*=864E5,J=J.getTime(),I){case "+":return new Date(K+J);case "-":return new Date(K-J);case "*":return new Date(K*J);case "/":return new Date(K/
J)}switch(I){case "+":return K+J;case "-":return K-J;case "*":return K*J;case "/":return K/J}}function r(I,K,J,L){I=L.getAttribute(I,K);return null!=I&&1===J[K]?new Date(I):I}const C=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,B=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;
let E=function(){function I(){}I.makeBool=function(K){return!0===K};I.featureValue=function(K,J,L,P){return r(K,J,L,P)};I.equalsNull=function(K){return null===K};I.applyLike=function(K,J,L){return l(K,J,L)};I.ensureArray=function(K){return n(K)};I.applyIn=function(K,J){return t(K,J)};I.currentDate=function(){const K=new Date;K.setHours(0,0,0,0);return K};I.makeSqlInterval=function(K,J,L){return f.SqlInterval.createFromValueAndQualifer(K,J,L)};I.convertInterval=function(K){return K instanceof f.SqlInterval?
K.valueInMilliseconds():K};I.currentTimestamp=function(){return new Date};I.compare=function(K,J,L){return y(K,J,L)};I.calculate=function(K,J,L){return z(K,J,L)};I.makeComparable=function(K){return w(K)};I.evaluateFunction=function(K,J){return f.evaluateFunction(K,J)};I.lookup=function(K,J){K=J[K];return void 0===K?null:K};I.between=function(K,J){return null==K||null==J[0]||null==J[1]?null:K>=J[0]&&K<=J[1]};I.notbetween=function(K,J){return null==K||null==J[0]||null==J[1]?null:K<J[0]||K>J[1]};I.ternaryNot=
function(K){return q(K)};I.ternaryAnd=function(K,J){return u(K,J)};I.ternaryOr=function(K,J){return v(K,J)};return I}(),F=function(){function I(J,L){this.fieldsIndex=L;this.datefields={};this.parameters={};this.parseTree=k.WhereGrammar.parse(J);const {isStandardized:P,isAggregate:Q,referencedFieldNames:X}=this.extractExpressionInfo(L);this.referencedFieldNames=X;this.isStandardized=P;this.isAggregate=Q}I.create=function(J,L){return new I(J,L)};var K=I.prototype;K.testSet=function(J,L=G){const P={};
for(const Q of this.fieldNames)P[Q]=J.map(X=>L.getAttribute(X,Q));return!!this.evaluateNode(this.parseTree,{attributes:P},G)};K.calculateValue=function(J,L=G){J=this.evaluateNode(this.parseTree,J,L);return J instanceof f.SqlInterval?J.valueInMilliseconds()/864E5:J};K.calculateValueCompiled=function(J,L=G){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(J,this.parameters,L,this.datefields);if(b("csp-restrictions"))return this.calculateValue(J,L);this.compileMe();return this.parseTree._compiledVersion(J,
this.parameters,L,this.datefields)};K.testFeature=function(J,L=G){return!!this.evaluateNode(this.parseTree,J,L)};K.testFeatureCompiled=function(J,L=G){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(J,this.parameters,L,this.datefields);if(b("csp-restrictions"))return this.testFeature(J,L);this.compileMe();return!!this.parseTree._compiledVersion(J,this.parameters,L,this.datefields)};K.getFunctions=function(){const J=[];this.visitAll(this.parseTree,L=>{"function"===
L.type&&J.push(L.name.toLowerCase())});return D(J)};K.getExpressions=function(){const J=new Map;this.visitAll(this.parseTree,L=>{if("function"===L.type){const P=L.name.toLowerCase();L=L.args.value[0];if("column_ref"===L.type){L=L.column;const Q=`${P}-${L}`;J.has(Q)||J.set(Q,{aggregateType:P,field:L})}}});return[...J.values()]};K.getVariables=function(){const J=[];this.visitAll(this.parseTree,L=>{"param"===L.type&&J.push(L.value.toLowerCase())});return D(J)};K.compileMe=function(){const J="return this.convertInterval("+
this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",J)).bind(E)};K.extractExpressionInfo=function(J){const L=[];let P=!0,Q=!0;this.visitAll(this.parseTree,X=>{switch(X.type){case "column_ref":{const aa=J.get(X.column),S=aa&&aa.name;!aa||"date"!==aa.type&&"esriFieldTypeDate"!==aa.type||(this.datefields[aa.name]=1);void 0!==S?(L.push(S),X.column=S):L.push(X.column);break}case "function":{const {name:aa,args:S}=
X;X=S.value.length;P&&(P=f.isStandardized(aa,X));Q&&(Q=p.isAggregate(aa,X))}}});return{referencedFieldNames:D(L),isStandardized:P,isAggregate:Q}};K.visitAll=function(J,L){if(null!=J)switch(L(J),J.type){case "when_clause":this.visitAll(J.operand,L);this.visitAll(J.value,L);break;case "case_expression":for(const P of J.clauses)this.visitAll(P,L);"simple"===J.format&&this.visitAll(J.operand,L);null!==J.else&&this.visitAll(J.else,L);break;case "expr_list":for(const P of J.value)this.visitAll(P,L);break;
case "unary_expr":this.visitAll(J.expr,L);break;case "binary_expr":this.visitAll(J.left,L);this.visitAll(J.right,L);break;case "function":this.visitAll(J.args,L)}};K.evaluateNodeToJavaScript=function(J){switch(J.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(J.value)+", "+JSON.stringify(J.qualifier)+","+JSON.stringify(J.op)+")";case "case_expression":var L="";if("simple"===J.format){var P="this.makeComparable("+this.evaluateNodeToJavaScript(J.operand)+")";L="( ";
for(let Q=0;Q<J.clauses.length;Q++)L+=" ("+P+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(J.clauses[Q].operand)+")) ? ("+this.evaluateNodeToJavaScript(J.clauses[Q].value)+") : "}else for(L="( ",P=0;P<J.clauses.length;P++)L+=" this.makeBool("+this.evaluateNodeToJavaScript(J.clauses[P].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(J.clauses[P].value)+") : ";L=null!==J.else?L+this.evaluateNodeToJavaScript(J.else):L+"null";return L+=" )";case "param":return"this.lookup("+
JSON.stringify(J.value.toLowerCase())+",lookups)";case "expr_list":L="[";for(P of J.value)"["!==L&&(L+=","),L+=this.evaluateNodeToJavaScript(P);return L+="]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(J.expr)+")";case "binary_expr":switch(J.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+
" )";case "IS":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(J.left)+")";case "ISNOT":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(J.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(J.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(J.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(J.left)+
",this.ensureArray("+this.evaluateNodeToJavaScript(J.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+","+JSON.stringify(J.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+
this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+","+JSON.stringify(J.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(J.operator)+","+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(J.operator)+","+this.evaluateNodeToJavaScript(J.left)+","+this.evaluateNodeToJavaScript(J.right)+
")"}throw Error("Not Supported Operator "+J.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(J.value);case "date":return"(new Date("+h(J.value).getTime().toString()+"))";case "timestamp":return"(new Date("+e(J.value).getTime().toString()+"))";case "current_time":return"date"===J.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(J.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+
JSON.stringify(J.name)+","+this.evaluateNodeToJavaScript(J.args)+")"}throw Error("Unsupported sql syntax "+J.type);};K.evaluateNode=function(J,L,P){switch(J.type){case "interval":return L=this.evaluateNode(J.value,L,P),f.SqlInterval.createFromValueAndQualifer(L,J.qualifier,J.op);case "case_expression":if("simple"===J.format){var Q=w(this.evaluateNode(J.operand,L,P));for(var X=0;X<J.clauses.length;X++)if(Q===w(this.evaluateNode(J.clauses[X].operand,L,P)))return this.evaluateNode(J.clauses[X].value,
L,P)}else for(Q=0;Q<J.clauses.length;Q++)if(!0===this.evaluateNode(J.clauses[Q].operand,L,P))return this.evaluateNode(J.clauses[Q].value,L,P);return null!==J.else?this.evaluateNode(J.else,L,P):null;case "param":return this.parameters[J.value.toLowerCase()];case "expr_list":Q=[];for(X of J.value)Q.push(this.evaluateNode(X,L,P));return Q;case "unary_expr":return q(this.evaluateNode(J.expr,L,P));case "binary_expr":switch(J.operator){case "AND":return u(this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,
L,P));case "OR":return v(this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,L,P));case "IS":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(J.left,L,P);case "ISNOT":if("null"!==J.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(J.left,L,P);case "IN":return Q=n(this.evaluateNode(J.right,L,P)),t(this.evaluateNode(J.left,L,P),Q);case "NOT IN":return Q=n(this.evaluateNode(J.right,L,P)),q(t(this.evaluateNode(J.left,L,P),
Q));case "BETWEEN":return Q=this.evaluateNode(J.left,L,P),J=this.evaluateNode(J.right,L,P),null==Q||null==J[0]||null==J[1]?null:Q>=w(J[0])&&Q<=w(J[1]);case "NOTBETWEEN":return Q=this.evaluateNode(J.left,L,P),J=this.evaluateNode(J.right,L,P),null==Q||null==J[0]||null==J[1]?null:Q<w(J[0])||Q>w(J[1]);case "LIKE":return l(this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,L,P),J.escape);case "NOT LIKE":return q(l(this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,L,P),J.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return y(J.operator,
this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,L,P));case "-":case "+":case "*":case "/":return z(J.operator,this.evaluateNode(J.left,L,P),this.evaluateNode(J.right,L,P))}case "null":case "bool":case "string":case "number":return J.value;case "date":return h(J.value);case "timestamp":return e(J.value);case "current_time":return L=new Date,"date"===J.mode&&L.setHours(0,0,0,0),L;case "column_ref":return r(L,J.column,this.datefields,P);case "function":return L=this.evaluateNode(J.args,L,P),
this.isAggregate?p.aggregateFunction(J.name,L):f.evaluateFunction(J.name,L)}throw Error("Unsupported sql syntax "+J.type);};g._createClass(I,[{key:"fieldNames",get:function(){return this.referencedFieldNames}}]);return I}();const G={getAttribute(I,K){return(I&&"object"===typeof I.attributes?I.attributes:I)[K]}};a.WhereClause=F;a.defaultAttributeAdapter=G;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function g(f){let k=
0;for(let c=0;c<f.length;c++)k+=f[c];return k/f.length}function b(f){const k=g(f),c=f.length;let d=0;for(const e of f)d+=(e-k)**2;return 1<c?d/(c-1):0}const p={min:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.min.apply(Math,f[0])},max:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.max.apply(Math,f[0])},avg:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:g(f[0])},sum:{minParams:1,maxParams:1,evaluate:f=>{if(null==f[0])f=null;else{{f=f[0];let k=0;for(let c=0;c<f.length;c++)k+=
f[c];f=k}}return f}},stddev:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sqrt(b(f[0]))},count:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].length},var:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:b(f[0])}};a.aggregateFunction=function(f,k){const c=p[f.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(k.length<c.minParams||k.length>c.maxParams)throw Error(`Invalid Parameter count for call to ${f.toUpperCase()}`);return c.evaluate(k)};a.isAggregate=
function(f,k){f=p[f.toLowerCase()];return null!=f&&k>=f.minParams&&k<=f.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(a,g){let b=function(){function f(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}f.fixDefaults=function(k){if(null!==k.precision||null!==k.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};f.createFromMilliseconds=
function(k){const c=new f;c.second=k/1E3;return c};f.createFromValueAndQualifer=function(k,c,d){let e=null;const h=new f;h.op="-"===d?"-":"+";if("interval-period"===c.type){f.fixDefaults(c);if("year"===c.period||"month"===c.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(k))h[c.period]=parseFloat(k);else throw Error("Illegal Interval");}else{f.fixDefaults(c.start);f.fixDefaults(c.end);if("year"===c.start.period||"month"===c.start.period)throw Error("Year-Month Intervals not supported");
if("year"===c.end.period||"month"===c.end.period)throw Error("Year-Month Intervals not supported");switch(c.start.period){case "day":switch(c.end.period){case "hour":e=/^[0-9]{1,} [0-9]{1,}$/;if(e.test(k))h[c.start.period]=parseFloat(k.split(" ")[0]),h[c.end.period]=parseFloat(k.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(e.test(k))h[c.start.period]=parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),h.hour=parseFloat(k[0]),
h.minute=parseFloat(k[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(k))h[c.start.period]=parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),h.hour=parseFloat(k[0]),h.minute=parseFloat(k[1]),h.second=parseFloat(k[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(c.end.period){case "minute":e=/^[0-9]{1,}:[0-9]{1,}$/;if(e.test(k))h.hour=parseFloat(k.split(":")[0]),
h.minute=parseFloat(k.split(":")[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(k))k=k.split(":"),h.hour=parseFloat(k[0]),h.minute=parseFloat(k[1]),h.second=parseFloat(k[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(c.end.period){case "second":e=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(k))k=k.split(":"),h.minute=parseFloat(k[0]),h.second=parseFloat(k[1]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return h};f.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return f}();const p={extract:{minParams:2,maxParams:2,evaluate:([f,k])=>{if(null==k)return null;if(k instanceof Date)switch(f.toUpperCase()){case "SECOND":return k.getSeconds();case "MINUTE":return k.getMinutes();
case "HOUR":return k.getHours();case "DAY":return k.getDate();case "MONTH":return k.getMonth()+1;case "YEAR":return k.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:f=>{if(2===f.length){const [k,c]=f;return null==k||null==c?null:k.toString().substring(c-1)}if(3===f.length){const [k,c,d]=f;return null==k||null==c||null==d?null:0>=d?"":k.toString().substring(c-1,c+d-1)}}},position:{minParams:2,maxParams:2,evaluate:([f,k])=>null==f||
null==k?null:k.indexOf(f)+1},trim:{minParams:2,maxParams:3,evaluate:f=>{var k=3===f.length,c=k?f[1]:" ";k=k?f[2]:f[1];if(null==c||null==k)return null;c=`(${g.escapeRegExpString(c)})`;switch(f[0]){case "BOTH":return k.replace(new RegExp(`^${c}*|${c}*$`,"g"),"");case "LEADING":return k.replace(new RegExp(`^${c}*`,"g"),"");case "TRAILING":return k.replace(new RegExp(`${c}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.abs(f[0])},
ceiling:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.ceil(f[0])},floor:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.floor(f[0])},log:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])},log10:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sin(f[0])},cos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cos(f[0])},tan:{minParams:1,maxParams:1,evaluate:f=>
null==f[0]?null:Math.tan(f[0])},asin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.asin(f[0])},acos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.acos(f[0])},atan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.atan(f[0])},sign:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:0<f[0]?1:0>f[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==f[1]?null:f[0]**f[1]},mod:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==f[1]?null:f[0]%f[1]},round:{minParams:1,
maxParams:2,evaluate:f=>{const k=f[0];f=2===f.length?10**f[1]:1;return null==k?null:Math.round(k*f)/f}},truncate:{minParams:1,maxParams:2,evaluate:f=>null==f[0]?null:1===f.length?parseInt(f[0].toFixed(0),10):parseFloat(f[0].toFixed(f[1]))},char_length:{minParams:1,maxParams:1,evaluate:f=>"string"===typeof f[0]||f[0]instanceof String?f[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:f=>{let k="";for(let c=0;c<f.length;c++){if(null==f[c])return null;k+=f[c].toString()}return k}},lower:{minParams:1,
maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toUpperCase()}};a.SqlInterval=b;a.evaluateFunction=function(f,k){const c=p[f.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(k.length<c.minParams||k.length>c.maxParams)throw Error(`Invalid Parameter count for call to ${f.toUpperCase()}`);return c.evaluate(k)};a.isStandardized=function(f,k){f=p[f.toLowerCase()];return null!=f&&k>=f.minParams&&
k<=f.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,g){var b=g.createCommonjsModule(function(f){(function(k,c){f.exports&&(f.exports=c())})(g.commonjsGlobal,function(){function k(c,d,e,h){this.message=c;this.expected=d;this.found=e;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,k)}(function(c,d){function e(){this.constructor=
c}e.prototype=d.prototype;c.prototype=new e})(k,Error);k.buildMessage=function(c,d){function e(u){return u.charCodeAt(0).toString(16).toUpperCase()}function h(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+e(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+e(v)})}function n(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,
"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+e(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+e(v)})}var q={literal:function(u){return'"'+h(u.text)+'"'},"class":function(u){var v="",t;for(t=0;t<u.parts.length;t++)v+=u.parts[t]instanceof Array?n(u.parts[t][0])+"-"+n(u.parts[t][1]):n(u.parts[t]);return"["+(u.inverted?"^":"")+v+"]"},any:function(u){return"any character"},end:function(u){return"end of input"},
other:function(u){return u.description}};return"Expected "+function(u){var v=Array(u.length),t;for(t=0;t<u.length;t++){var l=t;var w=u[t];w=q[w.type](w);v[l]=w}v.sort();if(0<v.length){for(u=t=1;t<v.length;t++)v[t-1]!==v[t]&&(v[u]=v[t],u++);v.length=u}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}(c)+" but "+(d?'"'+h(d)+'"':"end of input")+" found."};return{SyntaxError:k,parse:function(c,d){function e(sa,ya){return{type:"literal",
text:sa,ignoreCase:ya}}function h(sa,ya,xa){return{type:"class",parts:sa,inverted:ya,ignoreCase:xa}}function n(sa){var ya=wc[sa],xa;if(!ya){for(xa=sa-1;!wc[xa];)xa--;ya=wc[xa];for(ya={line:ya.line,column:ya.column};xa<sa;)10===c.charCodeAt(xa)?(ya.line++,ya.column=1):ya.column++,xa++;wc[sa]=ya}return ya}function q(sa,ya){var xa=n(sa),Ia=n(ya);return{start:{offset:sa,line:xa.line,column:xa.column},end:{offset:ya,line:Ia.line,column:Ia.column}}}function u(sa){pa<Hb||(pa>Hb&&(Hb=pa,Nc=[]),Nc.push(sa))}
function v(){var sa=pa;var ya=Ka();if(ya!==ja)if(ya=l(),ya!==ja){var xa=Ka();xa!==ja?sa=ya:(pa=sa,sa=ja)}else pa=sa,sa=ja;else pa=sa,sa=ja;return sa}function t(){var sa=pa;var ya=l();if(ya!==ja){var xa=[];var Ia=pa;var Za=Ka();if(Za!==ja){var gb=Na();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=l();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=Na(),gb!==ja?(kb=Ka(),kb!==ja?(nb=l(),nb!==ja?Ia=Za=[Za,gb,
kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);if(xa!==ja){sa={type:"expr_list"};ya=[ya];for(Ia=0;Ia<xa.length;Ia++)ya.push(xa[Ia][3]);sa.value=ya}else pa=sa,sa=ja}else pa=sa,sa=ja;return sa}function l(){var sa=pa;var ya=w();if(ya!==ja){var xa=[];var Ia=pa;var Za=Ka();if(Za!==ja){var gb=ma();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=w();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=
ma(),gb!==ja?(kb=Ka(),kb!==ja?(nb=w(),nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);xa!==ja?sa=ya=Pa(ya,xa):(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function w(){var sa=pa;var ya=y();if(ya!==ja){var xa=[];var Ia=pa;var Za=Ka();if(Za!==ja){var gb=ia();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=y();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=ia(),gb!==ja?(kb=
Ka(),kb!==ja?(nb=y(),nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);xa!==ja?sa=ya=Pa(ya,xa):(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function y(){var sa=pa;var ya=fa();if(ya===ja){ya=pa;if(33===c.charCodeAt(pa)){var xa=cb;pa++}else xa=ja,0===Ua&&u(lb);if(xa!==ja){var Ia=pa;Ua++;if(61===c.charCodeAt(pa)){var Za=Xa;pa++}else Za=ja,0===Ua&&u(ta);Ua--;Za===ja?Ia=void 0:(pa=Ia,Ia=ja);Ia!==ja?ya=xa=[xa,Ia]:(pa=ya,ya=ja)}else pa=ya,ya=ja}ya!==ja?(xa=Ka(),xa!==ja?(Ia=
y(),Ia!==ja?sa=ya={type:"unary_expr",operator:"NOT",expr:Ia}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja);if(sa===ja)if(sa=pa,ya=C(),ya!==ja)if(xa=Ka(),xa!==ja){xa=[];Ia=pa;Za=Ka();if(Za!==ja){var gb=D();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=C();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;if(Ia!==ja)for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=D(),gb!==ja?(kb=Ka(),kb!==ja?(nb=C(),nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):
(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);else xa=ja;xa!==ja&&(xa={type:"arithmetic",tail:xa});xa===ja&&(xa=pa,Ia=r(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=Oa(),Za!==ja?(Za=Ka(),Za!==ja?(Za=t(),Za!==ja?(gb=Ka(),gb!==ja?(gb=Va(),gb!==ja?xa=Ia={op:Ia,right:Za}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=r(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=Oa(),Za!==ja?(Za=Ka(),Za!==ja?(Za=Va(),Za!==ja?xa=Ia={op:Ia,right:{type:"expr_list",value:[]}}:(pa=xa,xa=ja)):
(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=r(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=K(),Za!==ja?xa=Ia={op:Ia,right:Za}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja))),xa===ja&&(xa=pa,Za=fa(),Za!==ja?(Ia=Ka(),Ia!==ja?(Ia=ea(),Ia!==ja?(gb=Ka(),gb!==ja?(gb=C(),gb!==ja?(kb=Ka(),kb!==ja?(kb=ia(),kb!==ja?(Za=Ka(),Za!==ja?(Za=C(),Za!==ja?xa=Za={op:"NOT"+Ia,right:{type:"expr_list",value:[gb,Za]}}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=
ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Za=ea(),Za!==ja?(Ia=Ka(),Ia!==ja?(Ia=C(),Ia!==ja?(gb=Ka(),gb!==ja?(gb=ia(),gb!==ja?(kb=Ka(),kb!==ja?(kb=C(),kb!==ja?xa=Za={op:Za,right:{type:"expr_list",value:[Ia,kb]}}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)),xa===ja&&(xa=pa,Ia=V(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=fa(),Za!==ja?(Za=Ka(),Za!==ja?(Za=C(),Za!==ja?xa=Ia={op:Ia+"NOT",right:Za}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,
xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=V(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=C(),Za!==ja?xa=Ia={op:Ia,right:Za}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)),xa===ja&&(xa=pa,Ia=z(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=aa(),Za!==ja?(gb=Ka(),gb!==ja?(gb=pa,c.substr(pa,6).toLowerCase()===Ld?(kb=c.substr(pa,6),pa+=6):(kb=ja,0===Ua&&u(Md)),kb!==ja?(kb=pa,Ua++,nb=G(),Ua--,nb===ja?kb=void 0:(pa=kb,kb=ja),kb!==ja?gb="ESCAPE":(pa=gb,gb=ja)):(pa=gb,gb=ja),gb!==ja?(gb=Ka(),gb!==ja?(gb=S(),gb!==ja?xa=Ia={op:Ia,
right:Za,escape:gb.value}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=z(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=aa(),Za!==ja?xa=Ia={op:Ia,right:Za,escape:""}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja))))));xa===ja&&(xa=null);xa!==ja?(sa=ya,ya=xa,""==ya||void 0==ya||null==ya?ya=sa:(xa=null,ya=xa="arithmetic"==ya.type?Pa(sa,ya.tail):Ea(ya.op,sa,ya.right,ya.escape)),sa=ya):(pa=sa,sa=ja)}else pa=sa,sa=ja;else pa=sa,sa=ja;return sa}
function D(){if(c.substr(pa,2)===Ba){var sa=Ba;pa+=2}else sa=ja,0===Ua&&u(va);sa===ja&&(62===c.charCodeAt(pa)?(sa=za,pa++):(sa=ja,0===Ua&&u(Da)),sa===ja&&(c.substr(pa,2)===Ga?(sa=Ga,pa+=2):(sa=ja,0===Ua&&u(Sa)),sa===ja&&(c.substr(pa,2)===Ta?(sa=Ta,pa+=2):(sa=ja,0===Ua&&u(Ra)),sa===ja&&(60===c.charCodeAt(pa)?(sa=ra,pa++):(sa=ja,0===Ua&&u(Aa)),sa===ja&&(61===c.charCodeAt(pa)?(sa=Xa,pa++):(sa=ja,0===Ua&&u(ta)),sa===ja&&(c.substr(pa,2)===Ma?(sa=Ma,pa+=2):(sa=ja,0===Ua&&u(Qa))))))));return sa}function z(){var sa=
sa=pa;var ya=fa();if(ya!==ja){var xa=Ka();if(xa!==ja){var Ia=ba();Ia!==ja?sa=ya=[ya,xa,Ia]:(pa=sa,sa=ja)}else pa=sa,sa=ja}else pa=sa,sa=ja;sa!==ja&&(sa=sa[0]+" "+sa[2]);sa===ja&&(sa=ba());return sa}function r(){var sa=sa=pa;var ya=fa();if(ya!==ja){var xa=Ka();if(xa!==ja){var Ia=O();Ia!==ja?sa=ya=[ya,xa,Ia]:(pa=sa,sa=ja)}else pa=sa,sa=ja}else pa=sa,sa=ja;sa!==ja&&(sa=sa[0]+" "+sa[2]);sa===ja&&(sa=O());return sa}function C(){var sa=pa;var ya=x();if(ya!==ja){var xa=[];var Ia=pa;var Za=Ka();if(Za!==ja){var gb=
A();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=x();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=A(),gb!==ja?(kb=Ka(),kb!==ja?(nb=x(),nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);xa!==ja?sa=ya=Pa(ya,xa):(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function A(){if(43===c.charCodeAt(pa)){var sa=Wa;pa++}else sa=ja,0===Ua&&u(bb);sa===ja&&(45===c.charCodeAt(pa)?(sa=ib,
pa++):(sa=ja,0===Ua&&u(db)));return sa}function x(){var sa=pa;var ya=B();if(ya!==ja){var xa=[];var Ia=pa;var Za=Ka();if(Za!==ja){var gb=m();if(gb!==ja){var kb=Ka();if(kb!==ja){var nb=B();nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja}else pa=Ia,Ia=ja;for(;Ia!==ja;)xa.push(Ia),Ia=pa,Za=Ka(),Za!==ja?(gb=m(),gb!==ja?(kb=Ka(),kb!==ja?(nb=B(),nb!==ja?Ia=Za=[Za,gb,kb,nb]:(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja)):(pa=Ia,Ia=ja);xa!==ja?sa=ya=Pa(ya,xa):(pa=sa,sa=ja)}else pa=
sa,sa=ja;return sa}function m(){if(42===c.charCodeAt(pa)){var sa=Fa;pa++}else sa=ja,0===Ua&&u(La);sa===ja&&(47===c.charCodeAt(pa)?(sa=$a,pa++):(sa=ja,0===Ua&&u(eb)));return sa}function B(){var sa=S();if(sa===ja){var ya=pa;var xa=pa;var Ia=W();if(Ia!==ja){var Za=Y();if(Za!==ja){var gb=U();gb!==ja?xa=Ia=parseFloat(Ia+Za+gb):(pa=xa,xa=ja)}else pa=xa,xa=ja}else pa=xa,xa=ja;xa===ja&&(xa=pa,Ia=W(),Ia!==ja?(Za=Y(),Za!==ja?xa=Ia=parseFloat(Ia+Za):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=W(),Ia!==ja?
(Za=U(),Za!==ja?xa=Ia=parseFloat(Ia+Za):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=W(),Ia!==ja&&(Ia=parseFloat(Ia)),xa=Ia)));var kb=xa;if(kb!==ja){var nb=pa;Ua++;var Nd=F();Ua--;Nd===ja?nb=void 0:(pa=nb,nb=ja);nb!==ja?ya=kb={type:"number",value:kb}:(pa=ya,ya=ja)}else pa=ya,ya=ja;sa=ya;if(sa===ja){var fc=pa;var Vb=pa;if(c.substr(pa,4).toLowerCase()===Od){var xc=c.substr(pa,4);pa+=4}else xc=ja,0===Ua&&u(Pd);if(xc!==ja){var gc=pa;Ua++;var Qd=G();Ua--;Qd===ja?gc=void 0:(pa=gc,gc=ja);gc!==ja?Vb=xc=
[xc,gc]:(pa=Vb,Vb=ja)}else pa=Vb,Vb=ja;var Qb=Vb;Qb!==ja&&(Qb={type:"bool",value:!0});fc=Qb;if(fc===ja){fc=pa;var Wb=pa;if(c.substr(pa,5).toLowerCase()===Rd){var yc=c.substr(pa,5);pa+=5}else yc=ja,0===Ua&&u(Sd);if(yc!==ja){var hc=pa;Ua++;var Td=G();Ua--;Td===ja?hc=void 0:(pa=hc,hc=ja);hc!==ja?Wb=yc=[yc,hc]:(pa=Wb,Wb=ja)}else pa=Wb,Wb=ja;Qb=Wb;Qb!==ja&&(Qb={type:"bool",value:!1});fc=Qb}sa=fc;if(sa===ja){var Xb=pa;if(c.substr(pa,4).toLowerCase()===Ud){var zc=c.substr(pa,4);pa+=4}else zc=ja,0===Ua&&
u(Vd);if(zc!==ja){var ic=pa;Ua++;var Wd=G();Ua--;Wd===ja?ic=void 0:(pa=ic,ic=ja);ic!==ja?Xb=zc=[zc,ic]:(pa=Xb,Xb=ja)}else pa=Xb,Xb=ja;var Oc=Xb;Oc!==ja&&(Oc={type:"null",value:null});sa=Oc;if(sa===ja){var Ob=pa;var Yb=pa;if(c.substr(pa,4).toLowerCase()===Xd){var Pc=c.substr(pa,4);pa+=4}else Pc=ja,0===Ua&&u(Yd);if(Pc!==ja){var Ac=pa;Ua++;var Zd=G();Ua--;Zd===ja?Ac=void 0:(pa=Ac,Ac=ja);Ac!==ja?Yb=Pc="DATE":(pa=Yb,Yb=ja)}else pa=Yb,Yb=ja;var pd=Yb;if(pd!==ja){var $d=Ka();if($d!==ja){var qd=aa();qd!==
ja?Ob=pd={type:"date",value:qd.value}:(pa=Ob,Ob=ja)}else pa=Ob,Ob=ja}else pa=Ob,Ob=ja;sa=Ob;if(sa===ja){var Pb=pa;var Zb=pa;if(c.substr(pa,9).toLowerCase()===ae){var Qc=c.substr(pa,9);pa+=9}else Qc=ja,0===Ua&&u(be);if(Qc!==ja){var Bc=pa;Ua++;var ce=G();Ua--;ce===ja?Bc=void 0:(pa=Bc,Bc=ja);Bc!==ja?Zb=Qc="TIMESTAMP":(pa=Zb,Zb=ja)}else pa=Zb,Zb=ja;var rd=Zb;if(rd!==ja){var de=Ka();if(de!==ja){var sd=aa();sd!==ja?Pb=rd={type:"timestamp",value:sd.value}:(pa=Pb,Pb=ja)}else pa=Pb,Pb=ja}else pa=Pb,Pb=ja;
sa=Pb;if(sa===ja){var qb=pa;var jc=la();if(jc!==ja){var Rc=Ka();if(Rc!==ja){if(45===c.charCodeAt(pa)){var Jb=ib;pa++}else Jb=ja,0===Ua&&u(db);Jb===ja&&(43===c.charCodeAt(pa)?(Jb=Wa,pa++):(Jb=ja,0===Ua&&u(bb)));if(Jb!==ja){var Sc=Ka();if(Sc!==ja){var kc=aa();if(kc!==ja){var ee=Ka();if(ee!==ja){var td=L();td!==ja?qb=jc={type:"interval",value:kc,qualifier:td,op:Jb}:(pa=qb,qb=ja)}else pa=qb,qb=ja}else pa=qb,qb=ja}else pa=qb,qb=ja}else pa=qb,qb=ja}else pa=qb,qb=ja}else pa=qb,qb=ja;qb===ja&&(qb=pa,jc=la(),
jc!==ja?(Rc=Ka(),Rc!==ja?(Jb=aa(),Jb!==ja?(Sc=Ka(),Sc!==ja?(kc=L(),kc!==ja?qb=jc={type:"interval",value:Jb,qualifier:kc,op:""}:(pa=qb,qb=ja)):(pa=qb,qb=ja)):(pa=qb,qb=ja)):(pa=qb,qb=ja)):(pa=qb,qb=ja));sa=qb}}}}}}var pb=sa;if(pb===ja){var ub=pa;var $b=pa;if(c.substr(pa,7).toLowerCase()===fe){var Tc=c.substr(pa,7);pa+=7}else Tc=ja,0===Ua&&u(ge);if(Tc!==ja){var Cc=pa;Ua++;var he=G();Ua--;he===ja?Cc=void 0:(pa=Cc,Cc=ja);Cc!==ja?$b=Tc="EXTRACT":(pa=$b,$b=ja)}else pa=$b,$b=ja;var ud=$b;if(ud!==ja){var ie=
Ka();if(ie!==ja){var je=Oa();if(je!==ja){var ke=Ka();if(ke!==ja){var Db=ka();Db===ja&&(Db=ha(),Db===ja&&(Db=na(),Db===ja&&(Db=da(),Db===ja&&(Db=oa(),Db===ja&&(Db=qa())))));var vd=Db;if(vd!==ja){var le=Ka();if(le!==ja){var me=M();if(me!==ja){var ne=Ka();if(ne!==ja){var wd=l();if(wd!==ja){var oe=Ka();if(oe!==ja){var pe=Va();pe!==ja?ub=ud={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:vd},wd]}}:(pa=ub,ub=ja)}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=
ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja}else pa=ub,ub=ja;pb=ub;if(pb===ja){var tb=pa;var ac=pa;if(c.substr(pa,9).toLowerCase()===qe){var Uc=c.substr(pa,9);pa+=9}else Uc=ja,0===Ua&&u(re);if(Uc!==ja){var Dc=pa;Ua++;var se=G();Ua--;se===ja?Dc=void 0:(pa=Dc,Dc=ja);Dc!==ja?ac=Uc="SUBSTRING":(pa=ac,ac=ja)}else pa=ac,ac=ja;var xd=ac;if(xd!==ja){var te=Ka();if(te!==ja){var ue=Oa();if(ue!==ja){var ve=Ka();if(ve!==ja){var Vc=l();if(Vc!==ja){var we=Ka();
if(we!==ja){var xe=M();if(xe!==ja){var ye=Ka();if(ye!==ja){var Wc=l();if(Wc!==ja){var ze=Ka();if(ze!==ja){var zb=pa;var bc=pa;if(c.substr(pa,3).toLowerCase()===Ae){var Xc=c.substr(pa,3);pa+=3}else Xc=ja,0===Ua&&u(Be);if(Xc!==ja){var Ec=pa;Ua++;var Ce=G();Ua--;Ce===ja?Ec=void 0:(pa=Ec,Ec=ja);Ec!==ja?bc=Xc="FOR":(pa=bc,bc=ja)}else pa=bc,bc=ja;var lc=bc;if(lc!==ja){var yd=Ka();if(yd!==ja){var zd=l();if(zd!==ja){var Ad=Ka();Ad!==ja?zb=lc=[lc,yd,zd,Ad]:(pa=zb,zb=ja)}else pa=zb,zb=ja}else pa=zb,zb=ja}else pa=
zb,zb=ja;zb===ja&&(zb=null);zb!==ja?(lc=Va(),lc!==ja?tb=xd={type:"function",name:"substring",args:{type:"expr_list",value:zb?[Vc,Wc,zb[2]]:[Vc,Wc]}}:(pa=tb,tb=ja)):(pa=tb,tb=ja)}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja}else pa=tb,tb=ja;pb=tb;if(pb===ja){var mb=pa;var mc=Z();if(mc!==ja){var Yc=Ka();if(Yc!==ja){var Zc=Oa();if(Zc!==ja){var $c=Ka();if($c!==ja){var Eb=J();Eb===ja&&(Eb=null);
if(Eb!==ja){var ad=Ka();if(ad!==ja){var nc=l();if(nc!==ja){var bd=Ka();if(bd!==ja){var cd=M();if(cd!==ja){var De=Ka();if(De!==ja){var Bd=l();if(Bd!==ja){var Ee=Ka();if(Ee!==ja){var Fe=Va();Fe!==ja?mb=mc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Eb?"BOTH":Eb},nc,Bd]}}:(pa=mb,mb=ja)}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=mb,mb=ja}else pa=
mb,mb=ja}else pa=mb,mb=ja;mb===ja&&(mb=pa,mc=Z(),mc!==ja?(Yc=Ka(),Yc!==ja?(Zc=Oa(),Zc!==ja?($c=Ka(),$c!==ja?(Eb=J(),Eb===ja&&(Eb=null),Eb!==ja?(ad=Ka(),ad!==ja?(nc=l(),nc!==ja?(bd=Ka(),bd!==ja?(cd=Va(),cd!==ja?mb=mc={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Eb?"BOTH":Eb},nc]}}:(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja)):(pa=mb,mb=ja));pb=mb;if(pb===ja){var vb=pa;var cc=pa;if(c.substr(pa,
8).toLowerCase()===Ge){var dd=c.substr(pa,8);pa+=8}else dd=ja,0===Ua&&u(He);if(dd!==ja){var Fc=pa;Ua++;var Ie=G();Ua--;Ie===ja?Fc=void 0:(pa=Fc,Fc=ja);Fc!==ja?cc=dd="POSITION":(pa=cc,cc=ja)}else pa=cc,cc=ja;var Cd=cc;if(Cd!==ja){var Je=Ka();if(Je!==ja){var Ke=Oa();if(Ke!==ja){var Le=Ka();if(Le!==ja){var Dd=l();if(Dd!==ja){var Me=Ka();if(Me!==ja){var Ne=O();if(Ne!==ja){var Oe=Ka();if(Oe!==ja){var Ed=l();if(Ed!==ja){var Pe=Ka();if(Pe!==ja){var Qe=Va();Qe!==ja?vb=Cd={type:"function",name:"position",
args:{type:"expr_list",value:[Dd,Ed]}}:(pa=vb,vb=ja)}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja}else pa=vb,vb=ja;pb=vb;if(pb===ja){var yb=pa;var oc;var Fb=pa;Fb=oc=E();if(Fb===ja)if(Fb=pa,96===c.charCodeAt(pa)?(oc=Fd,pa++):(oc=ja,0===Ua&&u(Gd)),oc!==ja){var Gc=[];if(Hd.test(c.charAt(pa))){var Kb=c.charAt(pa);pa++}else Kb=ja,0===Ua&&u(Id);if(Kb!==ja)for(;Kb!==ja;)Gc.push(Kb),Hd.test(c.charAt(pa))?
(Kb=c.charAt(pa),pa++):(Kb=ja,0===Ua&&u(Id));else Gc=ja;Gc!==ja?(96===c.charCodeAt(pa)?(Kb=Fd,pa++):(Kb=ja,0===Ua&&u(Gd)),Kb!==ja?Fb=oc=Gc.join(""):(pa=Fb,Fb=ja)):(pa=Fb,Fb=ja)}else pa=Fb,Fb=ja;var ed=Fb;if(ed!==ja){var Re=Ka();if(Re!==ja){var Se=Oa();if(Se!==ja){var Te=Ka();if(Te!==ja){var pc=t();pc===ja&&(pc=null);if(pc!==ja){var Ue=Ka();if(Ue!==ja){var Ve=Va();Ve!==ja?yb=ed={type:"function",name:ed,args:pc?pc:{type:"expr_list",value:[]}}:(pa=yb,yb=ja)}else pa=yb,yb=ja}else pa=yb,yb=ja}else pa=
yb,yb=ja}else pa=yb,yb=ja}else pa=yb,yb=ja}else pa=yb,yb=ja;pb=yb;if(pb===ja){var Bb;var ob=pa;var qc=ua();if(qc!==ja){var fd=Ka();if(fd!==ja){var rc=l();if(rc!==ja){var gd=Ka();if(gd!==ja){var Rb=[];for(Bb=R();Bb!==ja;)Rb.push(Bb),Bb=R();if(Rb!==ja)if(Bb=Ka(),Bb!==ja){var Hc=Ca();Hc!==ja?ob=qc={type:"case_expression",format:"simple",operand:rc,clauses:Rb,else:null}:(pa=ob,ob=ja)}else pa=ob,ob=ja;else pa=ob,ob=ja}else pa=ob,ob=ja}else pa=ob,ob=ja}else pa=ob,ob=ja}else pa=ob,ob=ja;if(ob===ja)if(ob=
pa,qc=ua(),qc!==ja)if(fd=Ka(),fd!==ja)if(rc=l(),rc!==ja)if(gd=Ka(),gd!==ja){Rb=[];for(Bb=R();Bb!==ja;)Rb.push(Bb),Bb=R();if(Rb!==ja)if(Bb=Ka(),Bb!==ja)if(Hc=T(),Hc!==ja){var We=Ka();if(We!==ja){var Xe=Ca();Xe!==ja?ob=qc={type:"case_expression",format:"simple",operand:rc,clauses:Rb,else:Hc.value}:(pa=ob,ob=ja)}else pa=ob,ob=ja}else pa=ob,ob=ja;else pa=ob,ob=ja;else pa=ob,ob=ja}else pa=ob,ob=ja;else pa=ob,ob=ja;else pa=ob,ob=ja;else pa=ob,ob=ja;var hd=ob;if(hd===ja){var Cb;var rb=pa;var sc=ua();if(sc!==
ja){var id=Ka();if(id!==ja){var Sb=[];for(Cb=H();Cb!==ja;)Sb.push(Cb),Cb=H();if(Sb!==ja)if(Cb=Ka(),Cb!==ja){var Ic=Ca();Ic!==ja?rb=sc={type:"case_expression",format:"searched",clauses:Sb,else:null}:(pa=rb,rb=ja)}else pa=rb,rb=ja;else pa=rb,rb=ja}else pa=rb,rb=ja}else pa=rb,rb=ja;if(rb===ja)if(rb=pa,sc=ua(),sc!==ja)if(id=Ka(),id!==ja){Sb=[];for(Cb=H();Cb!==ja;)Sb.push(Cb),Cb=H();if(Sb!==ja)if(Cb=Ka(),Cb!==ja)if(Ic=T(),Ic!==ja){var Ye=Ka();if(Ye!==ja){var Ze=Ca();Ze!==ja?rb=sc={type:"case_expression",
format:"searched",clauses:Sb,else:Ic.value}:(pa=rb,rb=ja)}else pa=rb,rb=ja}else pa=rb,rb=ja;else pa=rb,rb=ja;else pa=rb,rb=ja}else pa=rb,rb=ja;else pa=rb,rb=ja;hd=rb}pb=hd;if(pb===ja){var Jc;var dc=pa;var Jd=F();if(Jd!==ja){var jd=[];for(Jc=I();Jc!==ja;)jd.push(Jc),Jc=I();jd!==ja?dc=Jd+=jd.join(""):(pa=dc,dc=ja)}else pa=dc,dc=ja;var Kc=dc;if(Kc!==ja){var kd=Kc;Kc=/^CURRENT_DATE$/i.test(kd)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(kd)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",
table:"",column:kd}}pb=Kc;if(pb===ja&&(pb=K(),pb===ja)){pb=pa;var Kd=Oa();if(Kd!==ja){var $e=Ka();if($e!==ja){var ld=l();if(ld!==ja){var af=Ka();if(af!==ja){var bf=Va();bf!==ja?(ld.paren=!0,pb=Kd=ld):(pa=pb,pb=ja)}else pa=pb,pb=ja}else pa=pb,pb=ja}else pa=pb,pb=ja}else pa=pb,pb=ja}}}}}}}}return pb}function E(){var sa;var ya=pa;var xa=F();if(xa!==ja){var Ia=[];for(sa=G();sa!==ja;)Ia.push(sa),sa=G();Ia!==ja?ya=xa+=Ia.join(""):(pa=ya,ya=ja)}else pa=ya,ya=ja;return ya}function F(){if(fb.test(c.charAt(pa))){var sa=
c.charAt(pa);pa++}else sa=ja,0===Ua&&u(hb);return sa}function G(){if(jb.test(c.charAt(pa))){var sa=c.charAt(pa);pa++}else sa=ja,0===Ua&&u(sb);return sa}function I(){if(Ab.test(c.charAt(pa))){var sa=c.charAt(pa);pa++}else sa=ja,0===Ua&&u(Ib);return sa}function K(){var sa=pa;if(64===c.charCodeAt(pa)){var ya=Gb;pa++}else ya=ja,0===Ua&&u(Tb);if(ya!==ja){var xa=E();xa!==ja?sa=ya=[ya,xa]:(pa=sa,sa=ja)}else pa=sa,sa=ja;sa!==ja&&(sa={type:"param",value:sa[1]});return sa}function J(){var sa=pa;if(c.substr(pa,
7).toLowerCase()===cf){var ya=c.substr(pa,7);pa+=7}else ya=ja,0===Ua&&u(df);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="LEADING":(pa=sa,sa=ja)}else pa=sa,sa=ja;sa===ja&&(sa=pa,c.substr(pa,8).toLowerCase()===ef?(ya=c.substr(pa,8),pa+=8):(ya=ja,0===Ua&&u(ff)),ya!==ja?(ya=pa,Ua++,xa=G(),Ua--,xa===ja?ya=void 0:(pa=ya,ya=ja),ya!==ja?sa="TRAILING":(pa=sa,sa=ja)):(pa=sa,sa=ja),sa===ja&&(sa=pa,c.substr(pa,4).toLowerCase()===gf?(ya=c.substr(pa,4),pa+=4):(ya=ja,0===Ua&&
u(hf)),ya!==ja?(ya=pa,Ua++,xa=G(),Ua--,xa===ja?ya=void 0:(pa=ya,ya=ja),ya!==ja?sa="BOTH":(pa=sa,sa=ja)):(pa=sa,sa=ja)));return sa}function L(){var sa=pa;var ya=pa;var xa=P();if(xa!==ja){var Ia=Ka();if(Ia!==ja)if(Ia=Oa(),Ia!==ja)if(Ia=Ka(),Ia!==ja)if(Ia=X(),Ia!==ja){var Za=Ka();Za!==ja?(Za=Va(),Za!==ja?ya=xa={type:"interval-period",period:xa.value,precision:Ia,secondary:null}:(pa=ya,ya=ja)):(pa=ya,ya=ja)}else pa=ya,ya=ja;else pa=ya,ya=ja;else pa=ya,ya=ja;else pa=ya,ya=ja}else pa=ya,ya=ja;ya===ja&&
(ya=pa,xa=P(),xa!==ja&&(xa=Lb(xa)),ya=xa);if(ya!==ja)if(xa=Ka(),xa!==ja)if(xa=pa,c.substr(pa,2).toLowerCase()===jf?(Ia=c.substr(pa,2),pa+=2):(Ia=ja,0===Ua&&u(kf)),Ia!==ja?(Ia=pa,Ua++,Za=G(),Ua--,Za===ja?Ia=void 0:(pa=Ia,Ia=ja),Ia!==ja?xa="TO":(pa=xa,xa=ja)):(pa=xa,xa=ja),xa!==ja)if(xa=Ka(),xa!==ja){xa=pa;Ia=P();Ia!==ja&&(Ia={type:"interval-period",period:Ia.value,precision:null,secondary:null});xa=Ia;if(xa===ja){xa=pa;Ia=qa();if(Ia!==ja)if(Ia=Ka(),Ia!==ja)if(Ia=Oa(),Ia!==ja)if(Ia=Ka(),Ia!==ja)if(Ia=
X(),Ia!==ja)if(Za=Ka(),Za!==ja)if(Za=Na(),Za!==ja)if(Za=Ka(),Za!==ja)if(Za=Q(),Za!==ja){var gb=Ka();gb!==ja?(gb=Va(),gb!==ja?xa=Ia=Mb(Ia,Za):(pa=xa,xa=ja)):(pa=xa,xa=ja)}else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;else pa=xa,xa=ja;xa===ja&&(xa=pa,Ia=qa(),Ia!==ja?(Ia=Ka(),Ia!==ja?(Ia=Oa(),Ia!==ja?(Ia=Ka(),Ia!==ja?(Ia=X(),Ia!==ja?(Za=Ka(),Za!==ja?(Za=Va(),Za!==ja?xa=Ia={type:"interval-period",period:"second",
precision:Ia,secondary:null}:(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja)):(pa=xa,xa=ja),xa===ja&&(xa=pa,Ia=qa(),Ia!==ja&&(Ia={type:"interval-period",period:"second",precision:null,secondary:null}),xa=Ia))}xa!==ja?sa=ya={type:"interval-qualifier",start:ya,end:xa}:(pa=sa,sa=ja)}else pa=sa,sa=ja;else pa=sa,sa=ja;else pa=sa,sa=ja;else pa=sa,sa=ja;sa===ja&&(sa=pa,xa=P(),xa!==ja?(ya=Ka(),ya!==ja?(ya=Oa(),ya!==ja?(ya=Ka(),ya!==ja?(ya=Q(),ya!==ja?(Ia=Ka(),Ia!==
ja?(Ia=Va(),Ia!==ja?sa=xa={type:"interval-period",period:xa.value,precision:ya,secondary:null}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja),sa===ja&&(sa=pa,xa=P(),xa!==ja&&(xa=Lb(xa)),sa=xa,sa===ja&&(sa=pa,xa=qa(),xa!==ja?(ya=Ka(),ya!==ja?(ya=Oa(),ya!==ja?(ya=Ka(),ya!==ja?(ya=X(),ya!==ja?(Ia=Ka(),Ia!==ja?(Ia=Na(),Ia!==ja?(xa=Ka(),xa!==ja?(xa=Q(),xa!==ja?(Ia=Ka(),Ia!==ja?(Ia=Va(),Ia!==ja?sa=xa=Mb(ya,xa):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,
sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja),sa===ja&&(sa=pa,xa=qa(),xa!==ja?(ya=Ka(),ya!==ja?(ya=Oa(),ya!==ja?(ya=Ka(),ya!==ja?(ya=Q(),ya!==ja?(Ia=Ka(),Ia!==ja?(Ia=Va(),Ia!==ja?sa=xa={type:"interval-period",period:"second",precision:ya,secondary:null}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja),sa===ja&&(sa=pa,xa=qa(),xa!==ja&&(xa={type:"interval-period",period:"second",
precision:null,secondary:null}),sa=xa)))));return sa}function P(){var sa=pa;sa=na();sa!==ja&&(sa={type:"string",value:"day"});sa===ja&&(sa=pa,sa=da(),sa!==ja&&(sa={type:"string",value:"hour"}),sa===ja&&(sa=pa,sa=oa(),sa!==ja&&(sa={type:"string",value:"minute"}),sa===ja&&(sa=pa,sa=ha(),sa!==ja&&(sa={type:"string",value:"month"}),sa===ja&&(sa=pa,sa=ka(),sa!==ja&&(sa={type:"string",value:"year"})))));return sa}function Q(){var sa=N();sa!==ja&&(sa=parseFloat(sa));return sa}function X(){var sa=N();sa!==
ja&&(sa=parseFloat(sa));return sa}function aa(){var sa=S();sa===ja&&(sa=K());return sa}function S(){var sa=pa;if(39===c.charCodeAt(pa)){var ya=tc;pa++}else ya=ja,0===Ua&&u(uc);ya===ja&&(c.substr(pa,2)===ec?(ya=ec,pa+=2):(ya=ja,0===Ua&&u(vc)));if(ya!==ja){ya=[];var xa=pa;c.substr(pa,2)===Nb?(xa=Nb,pa+=2):(xa=ja,0===Ua&&u(Lc));xa!==ja&&(xa="'");xa===ja&&(xb.test(c.charAt(pa))?(xa=c.charAt(pa),pa++):(xa=ja,0===Ua&&u(Mc)));for(;xa!==ja;)ya.push(xa),xa=pa,c.substr(pa,2)===Nb?(xa=Nb,pa+=2):(xa=ja,0===Ua&&
u(Lc)),xa!==ja&&(xa="'"),xa===ja&&(xb.test(c.charAt(pa))?(xa=c.charAt(pa),pa++):(xa=ja,0===Ua&&u(Mc)));ya!==ja?(39===c.charCodeAt(pa)?(xa=tc,pa++):(xa=ja,0===Ua&&u(uc)),xa!==ja?sa=ya={type:"string",value:ya.join("")}:(pa=sa,sa=ja)):(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function H(){var sa=pa;var ya=Ja();if(ya!==ja)if(ya=Ka(),ya!==ja)if(ya=l(),ya!==ja){var xa=Ka();xa!==ja?(xa=Ha(),xa!==ja?(xa=Ka(),xa!==ja?(xa=l(),xa!==ja?sa=ya={type:"when_clause",operand:ya,value:xa}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):
(pa=sa,sa=ja)):(pa=sa,sa=ja)}else pa=sa,sa=ja;else pa=sa,sa=ja;else pa=sa,sa=ja;return sa}function R(){var sa=pa;var ya=Ja();if(ya!==ja)if(ya=Ka(),ya!==ja)if(ya=l(),ya!==ja){var xa=Ka();xa!==ja?(xa=Ha(),xa!==ja?(xa=Ka(),xa!==ja?(xa=l(),xa!==ja?sa=ya={type:"when_clause",operand:ya,value:xa}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja)}else pa=sa,sa=ja;else pa=sa,sa=ja;else pa=sa,sa=ja;return sa}function T(){var sa=pa;var ya=pa;if(c.substr(pa,4).toLowerCase()===lf){var xa=c.substr(pa,
4);pa+=4}else xa=ja,0===Ua&&u(mf);if(xa!==ja){xa=pa;Ua++;var Ia=G();Ua--;Ia===ja?xa=void 0:(pa=xa,xa=ja);xa!==ja?ya="ELSE":(pa=ya,ya=ja)}else pa=ya,ya=ja;ya!==ja?(ya=Ka(),ya!==ja?(ya=l(),ya!==ja?sa={type:"else_clause",value:ya}:(pa=sa,sa=ja)):(pa=sa,sa=ja)):(pa=sa,sa=ja);return sa}function W(){var sa=N();if(sa===ja){sa=pa;if(45===c.charCodeAt(pa)){var ya=ib;pa++}else ya=ja,0===Ua&&u(db);ya===ja&&(43===c.charCodeAt(pa)?(ya=Wa,pa++):(ya=ja,0===Ua&&u(bb)));if(ya!==ja){var xa=N();xa!==ja?sa=ya=ya[0]+
xa:(pa=sa,sa=ja)}else pa=sa,sa=ja}return sa}function Y(){var sa=pa;if(46===c.charCodeAt(pa)){var ya=wb;pa++}else ya=ja,0===Ua&&u(Ub);ya!==ja?(ya=N(),ya===ja&&(ya=null),ya!==ja?sa="."+(null!=ya?ya:""):(pa=sa,sa=ja)):(pa=sa,sa=ja);return sa}function U(){var sa;var ya=sa=pa;if(nf.test(c.charAt(pa))){var xa=c.charAt(pa);pa++}else xa=ja,0===Ua&&u(of);xa!==ja?(pf.test(c.charAt(pa))?(xa=c.charAt(pa),pa++):(xa=ja,0===Ua&&u(qf)),xa===ja&&(xa=null),xa!==ja?ya="e"+(null===xa?"":xa):(pa=ya,ya=ja)):(pa=ya,ya=
ja);ya!==ja?(xa=N(),xa!==ja?sa=ya+xa:(pa=sa,sa=ja)):(pa=sa,sa=ja);return sa}function N(){var sa=[];var ya=ca();if(ya!==ja)for(;ya!==ja;)sa.push(ya),ya=ca();else sa=ja;sa!==ja&&(sa=sa.join(""));return sa}function ca(){if(md.test(c.charAt(pa))){var sa=c.charAt(pa);pa++}else sa=ja,0===Ua&&u(nd);return sa}function O(){var sa=pa;if(c.substr(pa,2).toLowerCase()===rf){var ya=c.substr(pa,2);pa+=2}else ya=ja,0===Ua&&u(sf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="IN":
(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function V(){var sa=pa;if(c.substr(pa,2).toLowerCase()===tf){var ya=c.substr(pa,2);pa+=2}else ya=ja,0===Ua&&u(uf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="IS":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ba(){var sa=pa;if(c.substr(pa,4).toLowerCase()===vf){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(wf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="LIKE":(pa=sa,sa=ja)}else pa=
sa,sa=ja;return sa}function fa(){var sa=pa;if(c.substr(pa,3).toLowerCase()===xf){var ya=c.substr(pa,3);pa+=3}else ya=ja,0===Ua&&u(yf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="NOT":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ia(){var sa=pa;if(c.substr(pa,3).toLowerCase()===zf){var ya=c.substr(pa,3);pa+=3}else ya=ja,0===Ua&&u(Af);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="AND":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}
function ma(){var sa=pa;if(c.substr(pa,2).toLowerCase()===Bf){var ya=c.substr(pa,2);pa+=2}else ya=ja,0===Ua&&u(Cf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="OR":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ea(){var sa=pa;if(c.substr(pa,7).toLowerCase()===Df){var ya=c.substr(pa,7);pa+=7}else ya=ja,0===Ua&&u(Ef);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="BETWEEN":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function M(){var sa=
pa;if(c.substr(pa,4).toLowerCase()===Ff){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(Gf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="FROM":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function Z(){var sa=pa;if(c.substr(pa,4).toLowerCase()===Hf){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(If);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="TRIM":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function la(){var sa=pa;if(c.substr(pa,
8).toLowerCase()===Jf){var ya=c.substr(pa,8);pa+=8}else ya=ja,0===Ua&&u(Kf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="INTERVAL":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ka(){var sa=pa;if(c.substr(pa,4).toLowerCase()===Lf){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(Mf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="YEAR":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ha(){var sa=pa;if(c.substr(pa,5).toLowerCase()===
Nf){var ya=c.substr(pa,5);pa+=5}else ya=ja,0===Ua&&u(Of);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="MONTH":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function na(){var sa=pa;if(c.substr(pa,3).toLowerCase()===Pf){var ya=c.substr(pa,3);pa+=3}else ya=ja,0===Ua&&u(Qf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="DAY":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function da(){var sa=pa;if(c.substr(pa,4).toLowerCase()===Rf){var ya=
c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(Sf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="HOUR":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function oa(){var sa=pa;if(c.substr(pa,6).toLowerCase()===Tf){var ya=c.substr(pa,6);pa+=6}else ya=ja,0===Ua&&u(Uf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="MINUTE":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function qa(){var sa=pa;if(c.substr(pa,6).toLowerCase()===Vf){var ya=c.substr(pa,
6);pa+=6}else ya=ja,0===Ua&&u(Wf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="SECOND":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function ua(){var sa=pa;if(c.substr(pa,4).toLowerCase()===Xf){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(Yf);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="CASE":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function Ca(){var sa=pa;if(c.substr(pa,3).toLowerCase()===Zf){var ya=c.substr(pa,3);pa+=3}else ya=
ja,0===Ua&&u($f);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="END":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function Ja(){var sa=pa;if(c.substr(pa,4).toLowerCase()===ag){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(bg);if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="WHEN":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function Ha(){var sa=pa;if(c.substr(pa,4).toLowerCase()===cg){var ya=c.substr(pa,4);pa+=4}else ya=ja,0===Ua&&u(dg);
if(ya!==ja){ya=pa;Ua++;var xa=G();Ua--;xa===ja?ya=void 0:(pa=ya,ya=ja);ya!==ja?sa="THEN":(pa=sa,sa=ja)}else pa=sa,sa=ja;return sa}function Na(){if(44===c.charCodeAt(pa)){var sa=eg;pa++}else sa=ja,0===Ua&&u(fg);return sa}function Oa(){if(40===c.charCodeAt(pa)){var sa=gg;pa++}else sa=ja,0===Ua&&u(hg);return sa}function Va(){if(41===c.charCodeAt(pa)){var sa=ig;pa++}else sa=ja,0===Ua&&u(jg);return sa}function Ka(){var sa;var ya=[];for(sa=wa();sa!==ja;)ya.push(sa),sa=wa();return ya}function wa(){if(kg.test(c.charAt(pa))){var sa=
c.charAt(pa);pa++}else sa=ja,0===Ua&&u(lg);return sa}function Ea(sa,ya,xa,Ia){sa={type:"binary_expr",operator:sa,left:ya,right:xa};void 0!==Ia&&(sa.escape=Ia);return sa}function Pa(sa,ya){for(var xa=0;xa<ya.length;xa++)sa=Ea(ya[xa][1],sa,ya[xa][3]);return sa}d=void 0!==d?d:{};var ja={},Ya={start:v},ab=v,cb="!",lb=e("!",!1),Xa="\x3d",ta=e("\x3d",!1),Ba="\x3e\x3d",va=e("\x3e\x3d",!1),za="\x3e",Da=e("\x3e",!1),Ga="\x3c\x3d",Sa=e("\x3c\x3d",!1),Ta="\x3c\x3e",Ra=e("\x3c\x3e",!1),ra="\x3c",Aa=e("\x3c",
!1),Ma="!\x3d",Qa=e("!\x3d",!1),Wa="+",bb=e("+",!1),ib="-",db=e("-",!1),Fa="*",La=e("*",!1),$a="/",eb=e("/",!1),fb=/^[A-Za-z_\x80-\uFFFF]/,hb=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),jb=/^[A-Za-z0-9_]/,sb=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ab=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ib=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Gb="@",Tb=e("@",!1),Lb=function(sa){return{type:"interval-period",period:sa.value,precision:null,secondary:null}},Mb=function(sa,ya){return{type:"interval-period",
period:"second",precision:sa,secondary:ya}},tc="'",uc=e("'",!1),ec="N'",vc=e("N'",!1),Nb="''",Lc=e("''",!1),xb=/^[^']/,Mc=h(["'"],!0,!1),wb=".",Ub=e(".",!1),md=/^[0-9]/,nd=h([["0","9"]],!1,!1),nf=/^[eE]/,of=h(["e","E"],!1,!1),pf=/^[+\-]/,qf=h(["+","-"],!1,!1),Ud="null",Vd=e("NULL",!0),Od="true",Pd=e("TRUE",!0),Rd="false",Sd=e("FALSE",!0),rf="in",sf=e("IN",!0),tf="is",uf=e("IS",!0),vf="like",wf=e("LIKE",!0),Ld="escape",Md=e("ESCAPE",!0),xf="not",yf=e("NOT",!0),zf="and",Af=e("AND",!0),Bf="or",Cf=e("OR",
!0),Df="between",Ef=e("BETWEEN",!0),Ff="from",Gf=e("FROM",!0),Ae="for",Be=e("FOR",!0),qe="substring",re=e("SUBSTRING",!0),fe="extract",ge=e("EXTRACT",!0),Hf="trim",If=e("TRIM",!0),Ge="position",He=e("POSITION",!0),ae="timestamp",be=e("TIMESTAMP",!0),Xd="date",Yd=e("DATE",!0),cf="leading",df=e("LEADING",!0),ef="trailing",ff=e("TRAILING",!0),gf="both",hf=e("BOTH",!0),jf="to",kf=e("TO",!0),Jf="interval",Kf=e("INTERVAL",!0),Lf="year",Mf=e("YEAR",!0),Nf="month",Of=e("MONTH",!0),Pf="day",Qf=e("DAY",!0),
Rf="hour",Sf=e("HOUR",!0),Tf="minute",Uf=e("MINUTE",!0),Vf="second",Wf=e("SECOND",!0),Xf="case",Yf=e("CASE",!0),Zf="end",$f=e("END",!0),ag="when",bg=e("WHEN",!0),cg="then",dg=e("THEN",!0),lf="else",mf=e("ELSE",!0),eg=",",fg=e(",",!1),gg="(",hg=e("(",!1),ig=")",jg=e(")",!1),kg=/^[ \t\n\r]/,lg=h([" ","\t","\n","\r"],!1,!1),Fd="`",Gd=e("`",!1),Hd=/^[^`]/,Id=h(["`"],!0,!1),pa=0,wc=[{line:1,column:1}],Hb=0,Nc=[],Ua=0;if("startRule"in d){if(!(d.startRule in Ya))throw Error("Can't start parsing from rule \""+
d.startRule+'".');ab=Ya[d.startRule]}var od=ab();if(od!==ja&&pa===c.length)return od;od!==ja&&pa<c.length&&u({type:"end"});throw function(sa,ya,xa){return new k(k.buildMessage(sa,ya),sa,ya,xa)}(Nc,Hb<c.length?c.charAt(Hb):null,Hb<c.length?q(Hb,Hb+1):q(Hb,Hb));}}})});let p=function(){function f(){}f.parse=function(k){return b.parse(k)};return f}();a.WhereGrammar=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/maybe ../../../core/jsonMap ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../core/unitUtils ../../../geometry/support/normalizeUtils ../OptimizedGeometry ../featureConversionUtils ../centroid ./projectionSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){function v(m,B,E,F=m.hasZ,G=m.hasM){const I=m.hasZ&&F,K=m.hasM&&G;return E?(m=n.quantizeOptimizedGeometry(C,B,m.hasZ,m.hasM,"esriGeometryPoint",E,F,G),n.convertToPoint(m,I,K)):n.convertToPoint(B,I,K)}async function t(m,B,E){if(!m)return null;var {where:F}=m;m.where=F=F&&F.trim();if(!F||/^1 *= *1$/.test(F)||B&&B===F)m.where=null;if(!m.geometry)return m;B=await l(m);m.distance=0;m.units=null;"esriSpatialRelEnvelopeIntersects"===m.spatialRel&&({spatialReference:F}=
m.geometry,B=k.getGeometryExtent(B),B.spatialReference=F);m.geometry=B;await u.checkProjectionSupport(B.spatialReference,E);B=(await e.normalizeCentralMeridian(c.fromJSON(B)))[0];if(b.isNone(B))throw D;B=B.toJSON();B=await u.project(B,B.spatialReference,E);if(!B)throw D;B.spatialReference=E;m.geometry=B;return m}async function l(m){const {geometry:B,distance:E,units:F}=m;if(null==E||"vertexAttributes"in B)return B;var G=B.spatialReference;m=F?y.fromJSON(F):d.getUnitString(G);G=G&&(f.isGeographic(G)||
f.isWebMercator(G))?B:await u.checkProjectionSupport(G,f.WGS84).then(()=>u.project(B,f.WGS84));return(await w())(G.spatialReference,G,E,m)}async function w(){return(await new Promise(function(m,B){a(["../../../geometry/geometryEngineJSON"],m,B)})).geodesicBuffer}const y=new p.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),D=Object.freeze({}),
z=new h,r=new h,C=new h,A={esriGeometryPoint:n.convertToPoint,esriGeometryPolyline:n.convertToPolyline,esriGeometryPolygon:n.convertToPolygon,esriGeometryMultipoint:n.convertToMultipoint},x=(m,B)=>"_geVersion"!==m?B:void 0;g.QUERY_ENGINE_EMPTY_RESULT=D;g.cleanFromGeometryEngine=function(m){return m&&"_geVersion"in m?JSON.parse(JSON.stringify(m,x)):m};g.getCentroid=function(m,B,E){if("esriGeometryPolygon"!==m.geometryType||!B||!B.centroid&&!B.geometry)return null;B.centroid||(B.centroid=q.getCentroidOptimizedGeometry(new h,
B.geometry,m.hasZ,m.hasM));return v(m,B.centroid,E)};g.getGeometry=function(m,B,E,F,G,I,K=B,J=E){const L=B&&K,P=E&&J;F=F?"coords"in F?F:F.geometry:null;if(!F)return null;if(G)return B=n.generalizeOptimizedGeometry(r,F,B,E,m,G,K,J),I&&(B=n.quantizeOptimizedGeometry(C,B,L,P,m,I)),A[m](B,L,P);if(I)return I=n.quantizeOptimizedGeometry(C,F,B,E,m,I,K,J),A[m](I,L,P);n.removeZMValues(z,F,B,E,K,J);return A[m](z,L,P)};g.normalizeFilter=async function(m,B,E){return t(m,B,E)};g.normalizeQuery=async function(m,
B,E){const {outFields:F,orderByFields:G,groupByFieldsForStatistics:I,outStatistics:K}=m;if(F)for(var J=0;J<F.length;J++)F[J]=F[J].trim();if(G)for(J=0;J<G.length;J++)G[J]=G[J].trim();if(I)for(J=0;J<I.length;J++)I[J]=I[J].trim();if(K)for(J=0;J<K.length;J++)K[J].onStatisticField&&(K[J].onStatisticField=K[J].onStatisticField.trim());m.geometry&&!m.outSR&&(m.outSR=m.geometry.spatialReference);return t(m,B,E)};g.normalizeQueryLike=t;g.transformCentroid=v;Object.defineProperty(g,"__esModule",{value:!0})})},
"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function g(p,f,k,c,d,e,h=1){e=d?e?4:3:e?3:2;let n=k,q=k+e,u=0,v=0,t=k=0,l=0;for(let w=0,y=c-1;w<y;w++,n+=e,q+=e){c=f[n];const D=f[n+1],z=f[n+2],r=f[q],C=f[q+1],A=f[q+2];let x=c*C-r*D;t+=x;u+=(c+r)*x;v+=(D+C)*x;d&&(x=c*A-r*z,k+=(z+A)*x,l+=x);c<p[0]&&(p[0]=c);c>p[1]&&(p[1]=c);D<p[2]&&(p[2]=D);D>p[3]&&(p[3]=D);d&&(z<p[4]&&(p[4]=z),z>p[5]&&(p[5]=z))}0<t*h&&(t*=-1);0<l*h&&(l*=-1);if(!t)return null;p=[u,v,.5*t];d&&(p[3]=k,p[4]=.5*
l);return p}function b(p,f,k,c,d){d=c?d?4:3:d?3:2;let e=f,h=f+d,n=0,q=0,u=0,v=0;for(let y=0,D=k-1;y<D;y++,e+=d,h+=d){var t=p[e];const z=p[e+1],r=p[e+2],C=p[h],A=p[h+1],x=p[h+2];if(c){{var l=C-t;var w=A-z;const m=x-r;l=Math.sqrt(l*l+w*w+m*m)}}else l=C-t,w=A-z,l=Math.sqrt(l*l+w*w);l&&(n+=l,c?(t=[t+.5*(C-t),z+.5*(A-z),r+.5*(x-r)],q+=l*t[0],u+=l*t[1],v+=l*t[2]):(t=[t+.5*(C-t),z+.5*(A-z)],q+=l*t[0],u+=l*t[1]))}return 0<n?c?[q/n,u/n,v/n]:[q/n,u/n]:0<k?c?[p[f],p[f+1],p[f+2]]:[p[f],p[f+1]]:null}a.getCentroidOptimizedGeometry=
function(p,f,k,c,d){if(!f||!f.lengths.length)return null;const e="upperLeft"===(null==d?void 0:d.originPosition)?-1:1;p.lengths.length&&(p.lengths.length=0);p.coords.length&&(p.coords.length=0);d=p.coords;const h=[],n=k?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:q,coords:u}=f,v=k?
c?4:3:c?3:2;let t=0;for(var l of q){const w=g(n,u,t,l,k,c,e);w&&h.push(w);t+=l*v}h.sort((w,y)=>{let D=e*w[2]-e*y[2];0===D&&k&&(D=w[4]-y[4]);return D});h.length&&(l=6*h[0][2],d[0]=h[0][0]/l,d[1]=h[0][1]/l,k&&(l=6*h[0][4],d[2]=0!==l?h[0][3]/l:0),d[0]<n[0]||d[0]>n[1]||d[1]<n[2]||d[1]>n[3]||k&&(d[2]<n[4]||d[2]>n[5]))&&(d.length=0);if(!d.length)if(f=f.lengths[0]?b(u,0,q[0],k,c):null)d[0]=f[0],d[1]=f[1],k&&2<f.length&&(d[2]=f[2]);else return null;return p};a.lineCentroid=b;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../OptimizedGeometry ../featureConversionUtils ../contains ./projectionSupport ./utils".split(" "),function(a,g,b,p,f,k,c,d,e,h,n,q){function u(){return new Promise(function(y,D){a(["../../../geometry/geometryEngineJSON"],y,D)})}
const v={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var t={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,
esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},l={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},w={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};g.canQueryWithRBush=function(y){if(c.isExtent(y))return!0;if(c.isPolygon(y)){for(const D of y.rings)if(5!==D.length||D[0][0]!==D[1][0]||
D[0][0]!==D[4][0]||D[2][0]!==D[3][0]||D[0][1]!==D[3][1]||D[0][1]!==D[4][1]||D[1][1]!==D[2][1])return!1;return!0}return!1};g.checkSpatialQuerySupport=async function(y,D,z){const {spatialRel:r,geometry:C}=y;if(C){if(!0!==t[r])throw new b("feature-store:unsupported-query","Unsupported query spatial relationship",{query:y});if(p.isValid(C.spatialReference)&&p.isValid(z)){if(!0!==l[c.getJsonType(C)])throw new b("feature-store:unsupported-query","Unsupported query geometry type",{query:y});if(!0!==w[D])throw new b("feature-store:unsupported-query",
"Unsupported layer geometry type",{query:y});if(y.outSR)return n.checkProjectionSupport(y.geometry&&y.geometry.spatialReference,y.outSR)}}};g.getSpatialQueryOperator=function(y,D,z,r,C){if(c.isPolygon(D)&&"esriGeometryPoint"===z&&("esriSpatialRelIntersects"===y||"esriSpatialRelContains"===y)){const A=e.convertFromPolygon(new d,D,!1,!1);return Promise.resolve(x=>h.polygonContainsPoint(A,!1,!1,x))}if(c.isPolygon(D)&&"esriGeometryMultipoint"===z){const A=e.convertFromPolygon(new d,D,!1,!1);if("esriSpatialRelContains"===
y)return Promise.resolve(x=>h.polygonContainsMultipoint(A,!1,!1,x,r,C))}if(c.isExtent(D)&&"esriGeometryPoint"===z&&("esriSpatialRelIntersects"===y||"esriSpatialRelContains"===y))return Promise.resolve(A=>f.extentContainsPoint(D,q.getGeometry(z,r,C,A)));if(c.isExtent(D)&&"esriGeometryMultipoint"===z&&"esriSpatialRelContains"===y)return Promise.resolve(A=>f.extentContainsMultipoint(D,q.getGeometry(z,r,C,A)));if(c.isExtent(D)&&"esriSpatialRelIntersects"===y){const A=k.getExtentIntersector(z);return Promise.resolve(x=>
A(D,q.getGeometry(z,r,C,x)))}return u().then(A=>{const x=A[v[y]].bind(null,D.spatialReference,D);return m=>x(q.getGeometry(z,r,C,m))})};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function g(b,p,f,k,c){if(!b)return!1;p=p?f?4:3:f?3:2;const {coords:d,lengths:e}=b;f=!1;b=0;for(const n of e){var h=b;for(let q=b,u=b+n*p;q<u;q+=p){h=q+p;h===u&&(h=b);const v=d[q],t=d[q+1],l=d[h];h=d[h+1];(t<c&&h>=c||h<c&&t>=c)&&v+(c-t)/(h-
t)*(l-v)<k&&(f=!f)}b+=n*p}return f}a.polygonContainsCoords=g;a.polygonContainsMultipoint=function(b,p,f,k,c,d){c=c?d?4:3:d?3:2;const {coords:e,lengths:h}=k;if(!h)return!1;for(let n=0,q=0;n<h.length;n++,q+=c)if(!g(b,p,f,e[q],e[q+1]))return!1;return!0};a.polygonContainsPoint=function(b,p,f,k){return g(b,p,f,k.coords[0],k.coords[1])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function g(f,k,c,d,e){if(null!=d&&
null!=e)return h=>{const n=f.getAttribute(h,k);h=f.getAttribute(h,c);return(null==n||n<=e)&&(null==h||h>=d)};if(null!=d)return h=>{h=f.getAttribute(h,c);return null==h||h>=d};if(null!=e)return h=>{h=f.getAttribute(h,k);return null==h||h<=e}}function b(f,k,c,d){if(null!=c&&null!=d&&c===d)return e=>f.getAttribute(e,k)===c;if(null!=c&&null!=d)return e=>{e=f.getAttribute(e,k);return e>=c&&e<=d};if(null!=c)return e=>f.getAttribute(e,k)>=c;if(null!=d)return e=>f.getAttribute(e,k)<=d}function p(){return()=>
!1}a.getTimeExtent=function(f,k){if(!f)return null;const c=k.featureAdapter,{startTimeField:d,endTimeField:e}=f;let h=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(d&&e)k.forEach(q=>{const u=c.getAttribute(q,d);q=c.getAttribute(q,e);null==u||isNaN(u)||(h=Math.min(h,u));null==q||isNaN(q)||(n=Math.max(n,q))});else{const q=d||e;k.forEach(u=>{u=c.getAttribute(u,q);null==u||isNaN(u)||(h=Math.min(h,u),n=Math.max(n,u))})}return{start:h,end:n}};a.getTimeOperator=function(f,k,c){if(!k||!f)return null;
const {startTimeField:d,endTimeField:e}=f;if(!d&&!e)return null;const {start:h,end:n}=k;return null===h&&null===n?null:void 0===h&&void 0===n?p():d&&e?g(c,d,e,h,n):b(c,d||e,h,n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../../../geometry/support/quantizationUtils ./projectionSupport ./attributeSupport ./AttributesBuilder ./utils ./timeSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h){function n(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function q(t,l,w,y){if(w&&"esriFieldTypeDate"===w.type){const D=(new Date(t)).getTime(),z=(new Date(l)).getTime();if(!isNaN(D)&&!isNaN(z))return y?z-D:D-z}return"number"===typeof t&&"number"===typeof l?y?l-t:t-l:"string"===typeof t&&"string"===typeof l?(t=t.toUpperCase(),l=l.toUpperCase(),!w||"esriFieldTypeGUID"!==
w.type&&"esriFieldTypeGlobalID"!==w.type?y=(y?t>l:t<l)?-1:(y?t<l:t>l)?1:0:(w=n(t),l=n(l),y=(y?w>l:w<l)?-1:(y?w<l:w>l)?1:0),y):y?1:-1}function u(t,l,w,y,D,z){D-=w;z-=y;t=Math.min(1,Math.max(0,((t-w)*D+(l-y)*z)/(D*D+z*z)));return{x:w+D*t,y:y+z*t}}function v(t,l){return t?l?4:3:l?3:2}return function(){function t(w,y,D){this.items=w;this.queryGeometry=y;this.definitionExpression=D.definitionExpression;this.geometryType=D.geometryType;this.hasM=D.hasM;this.hasZ=D.hasZ;this.objectIdField=D.objectIdField;
this.spatialReference=D.spatialReference;this.fieldsIndex=D.fieldsIndex;this.timeInfo=D.timeInfo;this.featureAdapter=D.featureAdapter;this.aggregateAdapter=D.aggregateAdapter}var l=t.prototype;l.createQueryResponseForCount=function(w){const y=new d(w,this.featureAdapter,this.fieldsIndex);if(!w.outStatistics)return y.countDistinctValues(this.items);const {groupByFieldsForStatistics:D,having:z}=w;if(null==D||!D.length)return 1;const r=new Map,C=new Map,A=new Set;w=w.outStatistics;for(const m of w){({statisticType:w}=
m);w="exceedslimit"!==w?m.onStatisticField:void 0;if(!C.has(w)){var x=[];for(const B of D){const E=this._getAttributeValues(y,B,r);x.push(E)}C.set(w,this._calculateUniqueValues(x))}w=C.get(w);for(const B in w){const {data:E,items:F}=w[B];x=E.join(",");z&&!y.validateItems(F,z)||A.add(x)}}return A.size};l.createQueryResponse=function(w){let y;y=w.outStatistics?w.outStatistics.some(D=>"exceedslimit"===D.statisticType)?this._createExceedsLimitQueryResponse(w):this._createStatisticsQueryResponse(w):this._createFeatureQueryResponse(w);
w.returnQueryGeometry&&(b.isValid(w.outSR)&&!b.equals(this.queryGeometry.spatialReference,w.outSR)?y.queryGeometry=e.cleanFromGeometryEngine({spatialReference:w.outSR,...k.project(this.queryGeometry,this.queryGeometry.spatialReference,w.outSR)}):y.queryGeometry=e.cleanFromGeometryEngine({spatialReference:w.outSR,...this.queryGeometry}));return y};l.createSnappingResponse=function(w,y){const D=this.featureAdapter,z=v(this.hasZ,this.hasM),{x:r,y:C}=w.point,A="number"===typeof w.distance?w.distance:
w.distance.x,x="number"===typeof w.distance?w.distance:w.distance.y,m={candidates:[]},B="esriGeometryPolygon"===this.geometryType;y=this.getPointCreator(w.point,this.spatialReference,y);for(const P of this.items){var E=D.getGeometry(P);if(!E)continue;const {coords:Q,lengths:X}=E;if(w.types&1){E=0;for(var F=0;F<X.length;F++){var G=X[F];for(var I=0;I<G;I++,E+=z){var K=Q[E],J=Q[E+1];if(I!==G-1){const aa=Q[E+z],S=Q[E+z+1],{x:H,y:R}=u(r,C,K,J,aa,S);var L=(r-H)/A;const T=(C-R)/x;L=L*L+T*T;1>=L&&m.candidates.push({type:"edge",
objectId:D.getObjectId(P),distance:Math.sqrt(L),target:y(H,R),start:y(K,J),end:y(aa,S)})}}}}if(w.types&2)for(E=B?Q.length-z:Q.length,F=0;F<E;F+=z)G=Q[F],I=Q[F+1],K=(r-G)/A,J=(C-I)/x,K=K*K+J*J,1>=K&&m.candidates.push({type:"vertex",objectId:D.getObjectId(P),distance:Math.sqrt(K),target:y(G,I)})}m.candidates.sort((P,Q)=>P.distance-Q.distance);return m};l.getPointCreator=function(w,y,D){const z=g.isSome(D)&&!b.equals(y,D)?r=>k.project(r,y,D):r=>r;return null!=w.z&&null!=w.m?(r,C)=>z({x:r,y:C,z:w.z,m:w.m}):
null!=w.z?(r,C)=>z({x:r,y:C,z:w.z}):null!=w.m?(r,C)=>z({x:r,y:C,m:w.m}):(r,C)=>z({x:r,y:C})};l.executeAttributesQuery=function(w){var y=c.getWhereClause(w.where,this.fieldsIndex);if(!y)return Promise.resolve(this);if(y.isStandardized){let D=0;const z=[];for(const r of this.items)y.testFeature(r,this.featureAdapter)&&(z[D++]=r);y=new t(z,this.queryGeometry,this);y.definitionExpression=w.where;return Promise.resolve(y)}return Promise.reject(new TypeError("Where clause is not standardized"))};l.executeAggregateIdsQuery=
function(w){if(!w.aggregateIds||!w.aggregateIds.length||g.isNone(this.aggregateAdapter))return Promise.resolve(this);const y=new Set;for(const z of w.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(z).forEach(r=>y.add(r));const D=this.featureAdapter.getObjectId;return Promise.resolve(new t(this.items.filter(z=>y.has(D(z))),this.queryGeometry,this))};l.executeObjectIdsQuery=function(w){if(!w.objectIds||!w.objectIds.length)return Promise.resolve(this);const y=new Set(w.objectIds),D=this.featureAdapter.getObjectId;
return Promise.resolve(new t(this.items.filter(z=>y.has(D(z))),this.queryGeometry,this))};l.executeTimeQuery=function(w){w=h.getTimeOperator(this.timeInfo,w.timeExtent,this.featureAdapter);if(!g.isSome(w))return Promise.resolve(this);w=this.items.filter(w);return Promise.resolve(new t(w,this.queryGeometry,this))};l.filterLatest=function(){const {trackIdField:w,startTimeField:y,endTimeField:D}=this.timeInfo;var z=D||y;const r=new Map,C=this.featureAdapter.getAttribute;for(const A of this.items){const x=
C(A,w),m=C(A,z),B=r.get(x);(!B||m>C(B,z))&&r.set(x,A)}z=Array.from(r.values());return Promise.resolve(new t(z,this.queryGeometry,this))};l.project=async function(w){if(!w||b.equals(this.spatialReference,w))return this;const y=this.featureAdapter,D=(await k.projectMany(this.items.map(z=>e.getGeometry(this.geometryType,this.hasZ,this.hasM,y.getGeometry(z))),this.spatialReference,w)).map((z,r)=>y.cloneWithGeometry(this.items[r],p.convertFromGeometry(z,this.hasZ,this.hasM)));return new t(D,this.queryGeometry,
{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:w,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})};l._sortFeatures=function(w,y,D){if(1<w.length&&y&&y.length)for(const z of y.reverse()){y=z.split(" ");const r=y[0],C=this.fieldsIndex.get(r),A=y[1]&&"desc"===y[1].toLowerCase();w.sort((x,m)=>{x=D(x,r,C);m=D(m,r,C);return q(x,m,C,A)})}};l._createFeatureQueryResponse=
function(w){const y=this.items,{geometryType:D,hasM:z,hasZ:r,objectIdField:C,spatialReference:A}=this,{outFields:x,outSR:m,quantizationParameters:B,resultRecordCount:E,resultOffset:F,returnZ:G,returnM:I}=w,K=null!=E?y.length>(F||0)+E:!1,J=x&&(-1<x.indexOf("*")?[...this.fieldsIndex.fields]:x.map(L=>this.fieldsIndex.get(L)));return{exceededTransferLimit:K,features:this._createFeatures(w,y),fields:J,geometryType:D,hasM:z&&I,hasZ:r&&G,objectIdFieldName:C,spatialReference:e.cleanFromGeometryEngine(m?m:
A),transform:B&&f.toQuantizationTransform(B)||null}};l._createFeatures=function(w,y){const D=new d(w,this.featureAdapter,this.fieldsIndex),{hasM:z,hasZ:r}=this,{orderByFields:C,quantizationParameters:A,returnGeometry:x,returnCentroid:m,maxAllowableOffset:B,resultOffset:E,resultRecordCount:F,returnZ:G=!1,returnM:I=!1}=w,K=r&&G,J=z&&I;w=[];var L=0;y=[...y];this._sortFeatures(y,C,(X,aa,S)=>D.getFieldValue(X,aa,S));if(x||m){var P=f.toQuantizationTransform(A);if(x&&!m)for(var Q of y)w[L++]={attributes:D.getAttributes(Q),
geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),B,P,K,J)};else if(!x&&m)for(const X of y)w[L++]={attributes:D.getAttributes(X),centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(X,this),P)};else for(const X of y)w[L++]={attributes:D.getAttributes(X),centroid:e.transformCentroid(this,this.featureAdapter.getCentroid(X,this),P),geometry:e.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(X),B,P,K,J)}}else for(P of y)(Q=
D.getAttributes(P))&&(w[L++]={attributes:Q});L=E||0;null!=F&&(w=w.slice(L,Math.min(w.length,L+F)));return w};l._createExceedsLimitQueryResponse=function(w){var y=!1;let D=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY;y=Number.POSITIVE_INFINITY;for(const r of w.outStatistics)if("exceedslimit"===r.statisticType){D=null!=r.maxPointCount?r.maxPointCount:Number.POSITIVE_INFINITY;z=null!=r.maxRecordCount?r.maxRecordCount:Number.POSITIVE_INFINITY;y=null!=r.maxVertexCount?r.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)y=this.items.length>D;else if(this.items.length>z)y=!0;else{w=this.hasZ?this.hasM?4:3:this.hasM?3:2;const r=this.featureAdapter;y=this.items.reduce((C,A)=>{A=r.getGeometry(A);return C+(A&&A.coords.length||0)},0)/w>y}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(y)}}]}};l._createStatisticsQueryResponse=function(w){var y=
{attributes:{}};const D=[],z=new Map,r=new Map,C=new Map,A=new Map,x=new d(w,this.featureAdapter,this.fieldsIndex);var m=w.outStatistics;const {groupByFieldsForStatistics:B,having:E,orderByFields:F}=w;w=B&&B.length;const G=!!w,I=G&&B[0],K=G&&!this.fieldsIndex.get(I);for(const X of m){const {outStatisticFieldName:aa,statisticType:S}=X;m=X;var J="exceedslimit"!==S?X.onStatisticField:void 0;const H="percentile_disc"===S||"percentile_cont"===S,R=G&&1===w&&(J===I||K)&&"count"===S;if(G){if(!C.has(J)){var L=
[];for(const T of B){var P=this._getAttributeValues(x,T,z);L.push(P)}C.set(J,this._calculateUniqueValues(L,x.returnDistinctValues))}L=C.get(J);for(const T in L){const {count:W,data:Y,items:U,itemPositions:N}=L[T];P=Y.join(",");if(!E||x.validateItems(U,E)){const ca=A.get(P)||{attributes:{}};var Q=null;if(R)Q=W;else{const O=this._getAttributeValues(x,J,z);Q=N.map(V=>O[V]);Q=H&&"statisticParameters"in m?this._getPercentileValue(m,Q):this._getStatisticValue(m,Q)}ca.attributes[aa]=Q;B.forEach((O,V)=>ca.attributes[this.fieldsIndex.get(O)?
O:`EXPR_${V+1}`]=Y[V]);A.set(P,ca)}}}else J=this._getAttributeValues(x,J,z),y.attributes[aa]=H&&"statisticParameters"in m?this._getPercentileValue(m,J):this._getStatisticValue(m,J,r);D.push({name:aa,alias:aa,type:"esriFieldTypeDouble"})}y=G?Array.from(A.values()):[y];this._sortFeatures(y,F,(X,aa)=>X.attributes[aa]);return{fields:D,features:y}};l._getStatisticValue=function(w,y,D){const {onStatisticField:z,statisticType:r}=w;w=D&&D.has(z)?D.get(z):this._calculateStatistics(y);D&&D.set(z,w);return w["var"===
r?"variance":r]};l._getPercentileValue=function(w,y){const {onStatisticField:D,statisticParameters:z,statisticType:r}=w,{value:C,orderBy:A}=z,x="desc"===A,m=this.fieldsIndex.get(D);w=[...y].filter(B=>null!=B).sort((B,E)=>q(B,E,m,x));return this._calculatePercentile(w,C,"percentile_disc"===r)};l._getAttributeValues=function(w,y,D){if(D.has(y))return D.get(y);const z=this.fieldsIndex.get(y),r=this.items.map(C=>w.getFieldValue(C,y,z));D.set(y,r);return r};l._calculateStatistics=function(w){let y=Number.POSITIVE_INFINITY,
D=Number.NEGATIVE_INFINITY,z=null,r=null,C=null,A=null;const x=[];let m=0;for(const B of w)"string"===typeof B?m++:null==B||isNaN(B)||(z+=B,y=Math.min(y,B),D=Math.max(D,B),x.push(B),m++);if(m){r=z/m;w=0;for(const B of x)w+=(B-r)**2;A=1<m?w/(m-1):0;C=Math.sqrt(A)}else D=y=null;return{avg:r,count:m,max:D,min:y,stddev:C,sum:z,variance:A}};l._calculateUniqueValues=function(w,y){const D={},z=this.items,r=z.length;for(let C=0;C<r;C++){const A=z[C],x=[];for(const B of w)x.push(B[C]);const m=x.join(",");
y?null==D[m]&&(D[m]={count:1,data:x,items:[A],itemPositions:[C]}):null==D[m]?D[m]={count:1,data:x,items:[A],itemPositions:[C]}:(D[m].count++,D[m].items.push(A),D[m].itemPositions.push(C))}return D};l._calculatePercentile=function(w,y,D){if(0===w.length)return null;if(0>=y)return w[0];if(1<=y)return w[w.length-1];var z=(w.length-1)*y,r=Math.floor(z);y=r+1;z%=1;r=w[r];const C=w[y];return y>=w.length||D||"string"===typeof r||"string"===typeof C?r:r*(1-z)+C*z};a._createClass(t,[{key:"size",get:function(){return this.items.length}}]);
return t}()})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport"],function(a,g){return function(){function b(f,k,c){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=f.returnDistinctValues;this.fieldsIndex=c;this.featureAdapter=k;if((k=f.outFields)&&-1===k.indexOf("*")){this.outFields=k;f=0;for(const e of k){var d=g.getExpressionFromFieldName(e);d=(k=this.fieldsIndex.get(d))?null:g.getWhereClause(d,c);k=
k?k.name:g.getAliasFromFieldName(e)||`FIELD_EXP_${f++}`;this._fieldDataCache.set(e,{alias:k,clause:d})}}}var p=b.prototype;p.countDistinctValues=function(f){if(!this.returnDistinctValues)return f.length;f.forEach(k=>this.getAttributes(k));return this._returnDistinctMap.size};p.getAttributes=function(f){f=this._processAttributesForOutFields(f);return this._processAttributesForDistinctValues(f)};p.getFieldValue=function(f,k,c){const d=c?c.name:k;let e=null;this._fieldDataCache.has(d)?e=this._fieldDataCache.get(d).clause:
c||(e=g.getWhereClause(k,this.fieldsIndex),this._fieldDataCache.set(d,{alias:d,clause:e}));return c?this.featureAdapter.getAttribute(f,d):e.calculateValue(f,this.featureAdapter)};p.validateItem=function(f,k){this._fieldDataCache.has(k)||this._fieldDataCache.set(k,{alias:k,clause:g.getWhereClause(k,this.fieldsIndex)});return this._fieldDataCache.get(k).clause.testFeature(f,this.featureAdapter)};p.validateItems=function(f,k){this._fieldDataCache.has(k)||this._fieldDataCache.set(k,{alias:k,clause:g.getWhereClause(k,
this.fieldsIndex)});return this._fieldDataCache.get(k).clause.testSet(f,this.featureAdapter)};p._processAttributesForOutFields=function(f){const k=this.outFields;if(!k||!k.length)return this.featureAdapter.getAttributes(f);const c={};for(const d of k){const {alias:e,clause:h}=this._fieldDataCache.get(d);c[e]=h?h.calculateValue(f,this.featureAdapter):this.featureAdapter.getAttribute(f,e)}return c};p._processAttributesForDistinctValues=function(f){if(a.isNone(f)||!this.returnDistinctValues)return f;
var k=this.outFields,c=[];if(k)for(const e of k){var {alias:d}=this._fieldDataCache.get(e);c.push(f[d])}else for(d in f)c.push(f[d]);k=`${(k||["*"]).join(",")}=${c.join(",")}`;c=this._returnDistinctMap.get(k)||0;this._returnDistinctMap.set(k,++c);return 1<c?null:f};return b}()})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/support/webMercatorUtils ../../../../Graphic ../../../../core/Handles ../../../../core/accessorSupport/diffUtils ../../../../core/watchUtils ../../../../tasks/support/Query ../../../support/WatchUpdatingTracking ./graphicUtils ./constants ./Graphics3DCore ./Graphics3DScaleVisibility ../support/attributeUtils ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I){b=function(J){function L(Q){Q=J.call(this,Q)||this;Q._handles=new w;Q.watchUpdatingTracking=new r.WatchUpdatingTracking;Q.suspendResumeExtentMode="computed";Q.dataExtent=null;Q.suspendResumeExtent=null;return Q}a._inheritsLoose(L,J);var P=L.prototype;P.normalizeCtorArgs=function(Q){const X=Q.frustumVisibilityEnabled?new G:null,aa=Q.scaleVisibilityEnabled?new m:null,S=(Q.filterVisibilityEnabled||Q.timeExtentVisibilityEnabled)&&"multipatch"!==
Q.layer.geometryType?new F.Graphics3DFilterVisibility:null,H=Q.elevationAlignmentEnabled?new E:null,R=new x.Graphics3DCore({owner:Q.owner,layer:Q.layer,preferredUpdatePolicy:Q.preferredUpdatePolicy,elevationFeatureExpressionEnabled:Q.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:Q.owner.hasZ,hasM:Q.owner.hasM}),{updateClippingExtent:T,suspendResumeExtentMode:W,dataExtent:Y}=Q;return{graphicsCore:R,frustumVisibility:X,scaleVisibility:aa,filterVisibility:S,elevationAlignment:H,updateClippingExtent:T,
suspendResumeExtentMode:W,dataExtent:Y}};P.initialize=function(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",()=>this.filterVisibility.filterChanged()),this.watchUpdatingTracking.add(this.owner,"timeExtent",()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",
(Q,X)=>{y.diff(Q,X)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",()=>this.graphicsCore.updateVisibilityInfo());this.watchUpdatingTracking.add(this.layer,"labelingInfo",(Q,X)=>{y.diff(Q,X)&&this.graphicsCore.updateLabelingInfo()})};P.setup=async function(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const Q=this.owner,X=this.owner.view.basemapTerrain,aa=(S,H,R)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(S,
H,R);this.scaleVisibility&&this.scaleVisibility.setup(Q,this.layer,aa,this.graphicsCore,X);this.filterVisibility&&("filter"in Q||"timeExtent"in Q)&&this.filterVisibility.setup(Q,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(Q,aa,this.graphicsCore,Q.view.elevationProvider);this._set("objectStates",new I.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility));this._set("deconfliction",
Q.view.deconflictor.addGraphicsOwner(this.graphicsCore));await u.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.watchUpdatingTracking.add(this.layer,"renderer",S=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(S)));this.watchUpdatingTracking.add(Q,"fullOpacity",()=>this.graphicsCore.opacityChange());
this.setupSuspendResumeExtent();this.updateClippingExtent&&(this.watchUpdatingTracking.add(Q.view,"clippingArea",()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await u.logOnError(this.graphicsCore.updateLabelingInfo())};P.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);var Q="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");
for(const X of Q)if(Q=this[X])Q.destroy(),this._set(X,null);this._set("layer",null);this._set("owner",null)};P.maskOccludee=function(Q){const {set:X,handle:aa}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(X,Q.uid);return aa};P.highlight=function(Q,X){if(Q instanceof z){const {set:aa,handle:S}=this.objectStates.acquireSet(0,X);this.owner.queryObjectIds(Q).then(H=>this.objectStates.setObjectIds(aa,H));return S}if("number"===typeof Q||"string"===typeof Q||Q instanceof l)return this.highlight([Q],
X);"toArray"in Q&&(Q=Q.toArray());if(Array.isArray(Q)&&0<Q.length){if(Q[0]instanceof l)if(null!=B.attributeLookup(this.layer.fieldsIndex,Q[0].attributes,X))Q=Q.map(aa=>B.attributeLookup(this.layer.fieldsIndex,aa.attributes,X));else{Q=Q.map(H=>H.uid);const {set:aa,handle:S}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(aa,Q);return S}if("number"===typeof Q[0]||"string"===typeof Q[0]){const {set:aa,handle:S}=this.objectStates.acquireSet(0,X);this.objectStates.setObjectIds(aa,Q);return S}}return K};
P._updateClippingExtent=function(){const Q=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(Q,this.owner.view.spatialReference)&&(this.updateClippingExtent(Q)||this.graphicsCore.recreateAllGraphics())};P.setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(D.init(this,"suspendResumeExtentMode",()=>{this._handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this._handles.add([D.init(this.graphicsCore,
"computedExtent",Q=>this.updateSuspendResumeExtent(Q)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this._handles.add([D.init(this,"dataExtent",Q=>this.updateSuspendResumeExtent(Q)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:p.neverReached(this.suspendResumeExtentMode)}}))};P.updateSuspendResumeExtent=
function(Q){Q?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(Q,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};P.extentToSuspendResumeRect=function(Q,X){const aa=this.owner.view.spatialReference;if(!Q.spatialReference.equals(aa)){if(!t.canProject(Q,aa))return;Q=t.project(Q,aa)}return C.enlargeExtent(Q,X,A.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};P.suspendResumeExtentChanged=function(Q){this.frustumVisibility&&this.frustumVisibility.setExtent(Q);
this.scaleVisibility&&this.scaleVisibility.setExtent(Q)};a._createClass(L,[{key:"suspended",get:function(){var Q;return null==(Q=this.scaleVisibility)?void 0:Q.suspended}},{key:"suspendInfo",get:function(){var Q,X;const aa={};null!=(Q=this.scaleVisibility)&&Q.suspended&&(aa.outsideScaleRange=!0);null!=(X=this.frustumVisibility)&&X.suspended&&(aa.outsideOfView=!0);return aa}},{key:"updating",get:function(){var Q,X,aa;return!!(null!=(Q=this.graphicsCore)&&Q.updating||null!=(X=this.frustumVisibility)&&
X.updating||null!=(aa=this.watchUpdatingTracking)&&aa.updating)}}]);return L}(v);g.__decorate([c.property({aliasOf:"graphicsCore.layer"})],b.prototype,"layer",void 0);g.__decorate([c.property({aliasOf:"graphicsCore.owner"})],b.prototype,"owner",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"updateClippingExtent",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"graphicsCore",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"scaleVisibility",void 0);
g.__decorate([c.property({constructOnly:!0})],b.prototype,"filterVisibility",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"elevationAlignment",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"frustumVisibility",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"deconfliction",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"labeling",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"objectStates",void 0);g.__decorate([c.property({readOnly:!0})],
b.prototype,"watchUpdatingTracking",void 0);g.__decorate([c.property()],b.prototype,"suspendResumeExtentMode",void 0);g.__decorate([c.property()],b.prototype,"dataExtent",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"suspended",null);g.__decorate([c.property({readOnly:!0})],b.prototype,"suspendInfo",null);g.__decorate([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],b.prototype,"updating",null);b=g.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
b);const K={remove(){},pause(){},resume(){}};return b})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/Accessor ../../../../geometry/Point ../../../../geometry/Extent ../../../../geometry ../../../../support/arcadeOnDemand ../../../../core/mathUtils ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol ../../../../symbols ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../layers/Layer ../../../../renderers/Renderer ../../../../symbols/support/symbolConversion ../../../../renderers/ClassBreaksRenderer ../../../../core/accessorSupport/diffUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/SimpleRenderer ../../../../renderers/support/jsonUtils ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../support/Scheduler ../../../../core/MapUtils ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ./graphicUtils ./featureExpressionInfoUtils ./symbolComplexity ./Graphics3DGraphicCreationContext ./Graphics3DGraphic ../../webgl-engine/lib/WebGLLayer ../../webgl-engine/lib/GridLocalOriginFactory ./Graphics3DWebStyleSymbol ../../support/extentUtils ../../support/PropertiesPool ./ElevationQuery ../../../../renderers/support/rendererConversion ../../../../symbols/support/defaults3D ./Graphics3DFeatureStore ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./GraphicStateTracking ./SpatialIndex2D ../support/StageLayerElevationProvider".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha,na,da,oa,qa,ua,Ca,Ja,Ha,Na,Oa){var Va;const Ka=F.create(),wa=O.create(),Ea=k.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Va=function(cb){function lb(ta){ta=cb.call(this,ta)||this;ta.propertiesPool=new na.PropertiesPool({computedExtent:z},g._assertThisInitialized(ta));ta.computedExtent=null;ta.currentRenderer=null;ta.rendererHasGeometryOperations=
!1;ta.graphicStateTracking=null;ta.symbolCreationContext=new Ca.Graphics3DSymbolCreationContext;ta.graphics3DGraphics=new Map;ta.stageLayer=null;ta.stage=null;ta.graphicsDrapedUids=new Set;ta.graphicsBySymbol=new Map;ta.symbolConversionCache=new Map;ta.symbols=new Map;ta.graphicsWithoutSymbol=new Map;ta.graphicsWaitingForSymbol=new Set;ta._handles=new I;ta._frameTask=N.ImmediateTask;ta.suspendSymbolCleanup=!1;ta._spatialReference=null;ta.arcadeOnDemand=null;ta.rendererChangeAbortController=null;ta.elevationInfoChangeAbortController=
null;ta.setupAbortController=null;ta.elevationAlignment=null;ta.scaleVisibility=null;ta.filterVisibility=null;ta._spatialIndex=null;ta.extentPadding=0;ta._updatingPendingLoadedGraphicsChange=null;ta.featureStore=null;ta.deconflictor=null;ta.labeler=null;ta.objectStates=null;ta.viewElevationProvider=null;ta.stageLayerElevationProvider=null;ta.sharedSymbolResourcesOwnerHandle=null;ta.whenGraphics3DGraphicRequests={};ta.pendingUpdates=new Map;ta.numberOfGraphics=0;ta.numberOfGraphicsProvidingElevation=
0;ta.pendingAdds=0;ta.pendingRemoves=0;ta.pendingUpdatesPool=new t({allocator:Ba=>Ba||new Pa,deallocator:Ba=>{Ba.clear();return Ba}});ta.symbolWarningLogged=!1;ta.geometryWarningLogged=!1;ta.objectIdInvisibleSet=new Set;ta._whenSymbolRemoved=new t;ta.preferredUpdatePolicy=0;ta.forcedUpdatePolicy=null;ta._asyncUpdates=!1;ta.elevationFeatureExpressionEnabled=!0;ta.owner=null;ta.layer=null;ta.graphicSymbolSupported=!0;ta.getRenderingInfoWithoutRenderer=!1;ta.hasZ=null;ta.hasM=null;ta._usedMemory=0;ta._visible=
void 0;ta._startCreateGraphics=!1;ta.maxPendingUpdates=0;return ta}g._inheritsLoose(lb,cb);var Xa=lb.prototype;Xa.getConvertedSymbol=function(ta){if("web-style"===ta.type)return ta.clone();var Ba=this.symbolConversionCache.get(ta.id);if(void 0!==Ba)return Ba;Ba=L.to3D(ta,!0,!1,this.hasLabelingContext(ta));const va=Ba.symbol||null;va||Ba.error&&Ea.error(Ba.error.message);this.symbolConversionCache.set(ta.id,va);return va};Xa.getSymbolComplexitiesUsedOrRenderer=function(ta){if(f.isNone(ta))return[];
var Ba=ta.getSymbols(),va="backgroundFillSymbol"in ta&&ta.backgroundFillSymbol;if(!(va||Ba&&Ba.length))return[];ta=[];va=this.getSymbolComplexityUsedOrRenderer(va);f.isSome(va)&&ta.push(va);for(const za of Ba)Ba=this.getSymbolComplexityUsedOrRenderer(za),f.isSome(Ba)&&ta.push(Ba);return ta};Xa.getSymbolComplexityUsedOrRenderer=function(ta){if(f.isNone(ta))return null;const Ba=this.symbols.get(ta.id);return f.isSome(Ba)?Ba.complexity:(ta=this.getConvertedSymbol(ta))?ma.defaultSymbolComplexity(ta):
null};Xa.getSymbolComplexitiesUsed=function(){const ta=[];this.symbols.forEach(Ba=>{f.isSome(Ba)&&ta.push(Ba.complexity)});return ta};Xa.initialize=function(){this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new ua["default"]({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:()=>this.spatialIndex,forAllGraphics:ta=>this.graphics3DGraphics.forEach(ta)}))};Xa.setup=async function(ta){this.setupAbortController=
l.createAbortController();const Ba=this.setupAbortController.signal;this._set("elevationAlignment",ta.elevationAlignment);this._set("scaleVisibility",ta.scaleVisibility);this._set("filterVisibility",ta.filterVisibility);this._set("deconflictor",ta.deconflictor);this._set("labeler",ta.labeler);this._set("objectStates",ta.objectStates);const va=this.owner.view;this.viewElevationProvider=new da.ViewElevationProvider(this._spatialReference,va);this.initializeStage(va,this.layer.uid);this.symbolCreationContext.sharedResources=
va.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=va.sharedSymbolResources.addGraphicsOwner(this.owner);f.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=va.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=va.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;
this.symbolCreationContext.localOriginFactory=new la;this.symbolCreationContext.elevationProvider=va.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=za=>this.notifyGraphicGeometryChanged(za);this.symbolCreationContext.notifyGraphicVisibilityChanged=za=>this.notifyGraphicVisibilityChanged(za);ta=ia.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await ia.createContext(ta,this._spatialReference,
Ea);l.throwIfAborted(Ba);this.symbolCreationContext.screenSizePerspectiveEnabled=va.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;ta="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this._handles.add([this.watch("suspendedOrOutsideOfView",
()=>this._frameTask.reschedule(()=>this.updateLayerVisibility())),this.owner.watch(ta,()=>{const za=va.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;za!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=za,this.recreateAllGraphics())}),W.init(this,"preferredUpdatePolicy",()=>this.updateUpdatePolicy(),!0),this.owner.watch("slicePlaneEnabled",za=>this.slicePlaneEnabledChange(!!za)),this.owner.view.watch("pixelRatio",
()=>this.pixelRatioChange()),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",za=>this.physicalBasedRenderingChange(za)),W.when(va.basemapTerrain,"tilingScheme",za=>{za.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=va.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([W.on(this.owner,"loadedGraphics","change",Da=>this.graphicsCollectionChanged(Da),()=>this.recreateAllGraphics()),
W.on(this.owner,"loadedGraphics","after-changes",()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange(),()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange())],"loaded-graphics")})]);this._frameTask=va.resourceController.scheduler.registerTask(N.Task.GRAPHICS_CORE,za=>this._update(za),()=>this.needsUpdate);this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");
try{await this.rendererChange(this.layer.renderer)}catch{}l.throwIfAborted(Ba);this.setupAbortController=null};Xa.abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};Xa.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),
this._updatingPendingLoadedGraphicsChange=null);this.clear();f.isSome(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=f.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=N.ImmediateTask;this._spatialReference=null;this._set("owner",null);for(const ta in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[ta].reject(new n("graphic:layer-destroyed",
"Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle=f.removeMaybe(this.sharedSymbolResourcesOwnerHandle);this.propertiesPool=f.destroyMaybe(this.propertiesPool);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex=f.destroyMaybe(this._spatialIndex);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};Xa.clear=function(){var ta;this.objectStates&&this.objectStates.allGraphicsDeleted();
f.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(Ba=>Ba.destroy());null==(ta=this._spatialIndex)?void 0:ta.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(Ba=>{f.isSome(Ba)&&Ba.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();
this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this.notifyChange("updating");this.notifyChange("needsUpdate");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};Xa.initializeStage=function(ta,Ba){this.stage=ta._stage;this.stageLayer=new Z.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView},Ba);this.stage.add(this.stageLayer);ta=this.stageLayer.events;ta.on("objectTransformation",va=>this.notifyGraphicGeometryChanged(va.metadata.graphicUid));
ta.on("visibilityChanged",va=>this.notifyGraphicVisibilityChanged(va.metadata.graphicUid));ta.on("objectGeometryAdded",va=>this.notifyGraphicGeometryChanged(va.object.metadata.graphicUid));ta.on("objectGeometryRemoved",va=>this.notifyGraphicGeometryChanged(va.object.metadata.graphicUid));ta.on("vertexAttrsUpdated",va=>this.notifyGraphicGeometryChanged(va.object.metadata.graphicUid))};Xa.notifyGraphicGeometryChanged=function(ta){f.isNone(this.graphicStateTracking)||(ta=this.graphics3DGraphics.get(ta))&&
this.graphicStateTracking.updateGraphicGeometry(ta)};Xa.notifyGraphicVisibilityChanged=function(ta){f.isNone(this.graphicStateTracking)||(ta=this.graphics3DGraphics.get(ta))&&this.graphicStateTracking.updateGraphicVisibility(ta)};Xa.updateLayerVisibility=function(){var ta=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;ta=!this.suspendedOrOutsideOfView&&!ta;ta!==this._visible&&((this._visible=ta)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=
!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};Xa.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Xa.getGraphics3DGraphicById=function(ta){return this.graphics3DGraphics.get(ta)};Xa.getGraphics3DGraphicByObjectId=function(ta){var Ba;return null!=(Ba=this.owner.layer)&&Ba.objectIdField?this._findGraphics3DGraphicByObjectId(ta):null};Xa._getGraphicObjectID=function(ta,Ba=this.owner.layer&&this.owner.layer.objectIdField){return V.getObjectId(ta,
Ba)};Xa.updateLabelingInfo=async function(ta){const Ba=this.deconflictor&&this.deconflictor.labelingInfoChange(ta);ta=this.labeler&&this.labeler.labelingInfoChange(ta);await l.eachAlways([Ba,ta])};Xa.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Xa._update=function(ta){this._frameTask.processQueue(ta);this._applyPendingUpdates(ta);this.notifyChange("needsUpdate");this.needsUpdate||this.notifyChange("updating");
this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};Xa.setObjectIdVisibility=function(ta,Ba){Ba?this.objectIdInvisibleSet.delete(ta):this.objectIdInvisibleSet.add(ta);ta=this._findGraphics3DGraphicByObjectId(ta);f.isSome(ta)&&this._updateUserVisibility(ta)};Xa._findGraphics3DGraphicByObjectId=function(ta){return ca.findInMap(this.graphics3DGraphics,Ba=>this._getGraphicObjectID(Ba.graphic)===ta)};Xa._updateUserVisibility=function(ta){if(f.isNone(ta))return!1;var Ba=ta.graphic;
const va=this._getGraphicObjectID(Ba);Ba=Ba.visible&&!this.owner.suspended&&(f.isNone(va)||!this.objectIdInvisibleSet.has(va));return ta.setVisibilityFlag(0,Ba,0)};Xa.whenGraphics3DGraphic=function(ta){var Ba=this.graphics3DGraphics.get(ta.uid);if(Ba)return Promise.resolve(Ba);if(Ba=this.whenGraphics3DGraphicRequests[ta.uid])return Ba.promise;Ba=l.createDeferred();this.whenGraphics3DGraphicRequests[ta.uid]=Ba;return Ba.promise};Xa.boundsForGraphics3DGraphic=async function(ta,Ba){const va=this._spatialReference,
za=this.owner.view.renderSpatialReference,Da=this.owner.view.basemapTerrain.spatialReference;var Ga=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:f.isSome(Ba)&&Ba.useViewElevation,minDemResolution:f.isSome(Ba)&&Ba.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;ta=await ta.getProjectedBoundingBox((Sa,Ta,Ra)=>U.projectBuffer(Sa,za,Ta,Sa,va,Ta,Ra),(Sa,Ta,Ra)=>U.projectBuffer(Sa,Da,Ta,Sa,va,Ta,Ra),Ga,f.get(Ba,"signal"));if(!ta)return null;
Ba=ta.boundingBox;ta.requiresDrapedElevation&&(Ga=this.symbolCreationContext.elevationProvider)&&(O.center(Ba,Ka),Ga=f.unwrapOr(Ga.getElevation(Ka[0],Ka[1],0,va,"ground"),0),Ba[2]=Math.min(Ba[2],Ga),Ba[5]=Math.max(Ba[5],Ga));return{boundingBox:Ba,screenSpaceObjects:ta.screenSpaceObjects}};Xa.whenGraphicBounds=function(ta,Ba){return W.whenOnce(this.owner,"loadedGraphics").then(()=>{const va=this.owner.layer&&this.owner.layer.objectIdField,za=this.owner.loadedGraphics.find(Da=>Da===ta?!0:va&&Da.attributes&&
ta.attributes&&Da.attributes[va]===ta.attributes[va]);if(za)return this.whenGraphics3DGraphic(za);throw new n("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(va=>this.boundsForGraphics3DGraphic(va,Ba))};Xa.computeAttachmentOrigin=function(ta,Ba){ta=this.graphics3DGraphics.get(ta.uid);if(!ta)return null;var va=ta.computeAttachmentOrigin();if(0===va.render.num&&0===va.draped.num)return null;G.set(ja,0,0,0);ta=0;if(0<va.render.num){if(!U.projectVectorToVector(va.render.origin,
this.symbolCreationContext.renderCoordsHelper.spatialReference,Ya,Ba))return null;G.add(ja,ja,Ya);ta++}if(0<va.draped.num){const [za,Da]=va.draped.origin;va=f.unwrapOr(this.viewElevationProvider.getElevation(za,Da,"ground"),0);G.set(Ya,za,Da,va);if(!U.projectVectorToVector(Ya,this.viewElevationProvider.spatialReference,Ya,Ba))return null;G.add(ja,ja,Ya);ta++}1<ta&&G.scale(ja,ja,1/ta);return new D({x:ja[0],y:ja[1],z:ja[2],spatialReference:Ba})};Xa.getSymbolLayerSize=function(ta,Ba){var va=this.symbols.get(ta.id);
if(f.isNone(va))throw new n("internal:symbol-not-part-of-view","Symbol is not part of this view");ta=ta.symbolLayers.indexOf(Ba);if(-1===ta)throw new n("internal:missing-symbol-layer","Symbol layer is not in symbol");va=va.getSymbolLayerSize(ta);if(null==va)throw new n("internal:missing-size","Symbol layer has no valid size");return va};Xa.graphicsCollectionChanged=function(ta){this._startCreateGraphics&&(this.add(ta.added),this.remove(ta.removed))};Xa.graphicUpdateHandler=function(ta){var Ba=ta.graphic.uid;
const va=this.graphics3DGraphics.get(Ba);Ba=this.graphicsWithoutSymbol.get(Ba);if(va||Ba){switch(ta.property){case "visible":this.graphicUpdateVisibleHandler(va);break;case "geometry":this.graphicUpdateGeometryHandler(va,ta);break;case "symbol":this.graphicUpdateSymbolHandler(va,ta)}0===this.preferredUpdatePolicy&&this.stageLayer.commit()}};Xa.graphicUpdateGeometryHandler=function(ta,Ba){const va=Ba.graphic.geometry;if(f.isNone(va))this.recreateGraphic(Ba.graphic);else if(f.isNone(ta)){if(ta=Ba.graphic.symbol&&
Ba.graphic.symbol.id)if(ta=this.symbols.get(ta),f.isSome(ta)&&0===ta.loadStatus)return;this.recreateGraphic(Ba.graphic)}else{var za=ta.graphics3DSymbol;!f.isNone(Ba.newValue)&&za.updateGeometry(ta,Ba.newValue)||this.recreateGraphic(ta.graphic);this.expandComputedExtent(va)}};Xa.graphicUpdateSymbolHandler=function(ta,Ba){var va=Ba.graphic;const za=f.isSome(ta)?ta.graphics3DSymbol:f.isSome(Ba.oldValue)&&this.symbols.get(Ba.oldValue.id);if(f.isNone(za)||f.isNone(Ba.newValue))this.recreateGraphic(va);
else{var Da=za.symbol;Ba=this.getConvertedSymbol(Ba.newValue);if(Ba.type!==Da.type||"web-style"===Ba.type||"web-style"===Da.type)this.recreateGraphic(va);else{var Ga=this.graphicsBySymbol.get(Da.id);if(Ga&&1!==Ga.size)this.recreateGraphic(va);else if(Ga=Q.diff(Da,Ba),f.isNone(Ga))this.updateSymbolMapping(Da.id,Ba);else if(Ga={diff:Ga,graphics3DGraphicPatches:[],symbolStatePatches:[]},za.prepareSymbolPatch(Ga),Q.isEmpty(Ga.diff)){var Sa=this._getRenderingInfo(va);if(f.isNone(Sa))this.recreateGraphic(va);
else{va=za.extentPadding;for(const Ta of Ga.symbolStatePatches)Ta();va!==za.extentPadding&&this.recomputeExtentPadding();if(f.isSome(ta))for(const Ta of Ga.graphics3DGraphicPatches)Ta(ta,Sa);this.updateSymbolMapping(Da.id,Ba)}}else this.recreateGraphic(va)}}};Xa.graphicUpdateVisibleHandler=function(ta){this._updateUserVisibility(ta)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Xa.recreateGraphics=function(ta){this.suspendSymbolCleanup=!0;this.remove(ta);
this.add(ta);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};Xa.recreateGraphic=function(ta){this.recreateGraphics([ta])};Xa._beginGraphicUpdate=function(ta){this.graphicsWaitingForSymbol.add(ta.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")};Xa._endGraphicUpdate=function(ta){ta&&(this.graphicsWaitingForSymbol.delete(ta.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Xa.recomputeExtentPadding=
function(){let ta=0;this.symbols.forEach(Ba=>{f.isSome(Ba)&&(ta=Math.max(ta,Ba.extentPadding))});this._set("extentPadding",ta)};Xa.expandComputedExtent=function(ta){var Ba=ta.spatialReference;V.computeAABB(ta,wa);ta=this._spatialReference;var va=Va.tmpVec;!Ba.equals(ta)&&U.projectXYZToVector(wa[0],wa[1],0,Ba,va,ta)&&(wa[0]=va[0],wa[1]=va[1],U.projectXYZToVector(wa[3],wa[4],0,Ba,va,ta),wa[3]=va[0],wa[4]=va[1]);if(A.isFinite(wa[0])&&A.isFinite(wa[3])&&A.isFinite(wa[1])&&A.isFinite(wa[4])){Ba=this.computedExtent;
va=null;var za=A.isFinite(wa[2])&&A.isFinite(wa[5]),Da=za&&(!Ba||null==Ba.zmin||wa[2]<Ba.zmin);za=za&&(!Ba||null==Ba.zmax||wa[5]>Ba.zmax);if(Ba){if(wa[0]<Ba.xmin||wa[1]<Ba.ymin||wa[3]>Ba.xmax||wa[4]>Ba.ymax||Da||za)va=this.propertiesPool.get("computedExtent"),va.xmin=Math.min(wa[0],Ba.xmin),va.ymin=Math.min(wa[1],Ba.ymin),va.xmax=Math.max(wa[3],Ba.xmax),va.ymax=Math.max(wa[4],Ba.ymax),va.spatialReference=ta}else va=this.propertiesPool.get("computedExtent"),va.xmin=wa[0],va.ymin=wa[1],va.xmax=wa[3],
va.ymax=wa[4],va.spatialReference=ta;va&&(Da&&(va.zmin=wa[2]),za&&(va.zmax=wa[5]),this._set("computedExtent",va))}};Xa.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};Xa.elevationInfoChange=async function(){this.abortElevationInfoChange();const ta=l.createAbortController();this.elevationInfoChangeAbortController=ta;const Ba=ia.extractExpressionInfo(this.layer.elevationInfo,
this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await ia.createContext(Ba,this._spatialReference,Ea);l.throwIfAborted(ta);this.elevationInfoChangeAbortController=null;this.labeler&&this.labeler.elevationInfoChange();this.forEachGraphics3DSymbol((va,za,Da)=>{va.globalPropertyChanged("elevationInfo",za)?za.forEach(Ga=>{const Sa=Ga.graphic;Ga=Ga.labelGraphics;for(const Ta of Ga)Ta.graphics3DSymbolLayer.updateGraphicElevationContext(Sa,Ta)}):this._recreateSymbol(Da)});
this.updateStageLayerElevationProvider();this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};Xa.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||
this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new Oa.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};Xa.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&
this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};Xa.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Xa.recreateAllGraphics=function(){this._startCreateGraphics&&
(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};Xa._recreateSymbol=function(ta){var Ba=this.graphicsBySymbol.get(ta);
const va=[];Ba&&(Ba.forEach((za,Da)=>{var Ga;const Sa=za.usedMemory;this._conditionalRemove(za,Da);null==(Ga=this._spatialIndex)?void 0:Ga.remove(za);va.push(za.graphic);za.destroy();this.removeGraphics3DGraphic(Da,Sa);this.updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(ta,new Map));Ba=this.symbols.get(ta);f.isSome(Ba)&&Ba.destroy();this.symbols.delete(ta);this.add(va)};Xa._conditionalRemove=function(ta,Ba){ta.isDraped&&this.graphicsDrapedUids.delete(Ba);
this.objectStates&&this.objectStates.removeGraphic(ta);this.labeler&&this.labeler.removeGraphic(ta);this.deconflictor&&this.deconflictor.removeGraphic(ta);f.isSome(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(ta)};Xa.add=function(ta){ta&&0!==ta.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(ta):this._addImmediate(ta),this.notifyChange("updating")):Ea.error("#add()","Cannot add graphics before terrain surface has been initialized"))};
Xa._addImmediate=function(ta){this.symbolWarningLogged=this.geometryWarningLogged=!1;for(const Ba of ta)this._addGraphic(Ba,this._getRenderingInfo(Ba,Ea));this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};Xa._addDelayed=function(ta){for(const Ba of ta){ta=Ba.uid;let va=this.pendingUpdates.get(ta);va?va.add?0!==va.state&&va.abortController.abort():this.pendingAdds++:(va=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,
this.pendingUpdates.set(ta,va));va.add=Ba}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("needsUpdate");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};Xa.remove=function(ta){this.asyncUpdates?this._removeDelayed(ta):this._removeImmediate(ta);this.notifyChange("updating")};Xa._removeImmediate=function(ta){for(const Ba of ta)this._removeGraphic(Ba);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();
this.owner.view.deconflictor.setDirty()};Xa._removeDelayed=function(ta){for(const va of ta){ta=va.uid;var Ba=this.pendingUpdates.get(ta);Ba?Ba.add&&(Ba.remove?Ba.add=null:this.pendingUpdates.delete(ta),1===Ba.state&&Ba.abortController.abort(),this.pendingAdds--):(Ba=this.pendingUpdatesPool.pushNew(),Ba.remove=va,this.pendingUpdates.set(ta,Ba),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);
this.notifyChange("needsUpdate");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};Xa._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&Ea.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};Xa._applyPendingUpdates=function(ta){var Ba;this.symbolWarningLogged=this.geometryWarningLogged=!1;if(0===this.pendingUpdates.size&&null!=(Ba=
this._spatialIndex)&&Ba.updating)this._spatialIndex.update();else{for(const [va,za]of this.pendingUpdates){if(ta.done)break;za.add&&0===za.state&&this._startAddRenderingInfo(za);!za.remove||za.add&&2!==za.state||(this.pendingRemoves--,ta.madeProgress(),this._removeGraphic(za.remove),za.remove=null);if(za.add)switch(za.state){case 2:this._addGraphic(za.add,za.renderingInfo);za.add=null;this.pendingAdds--;ta.madeProgress();break;case 3:za.add=null,this.pendingAdds--}null==za.remove&&null==za.add&&this.pendingUpdates.delete(va)}0===
this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("needsUpdate"))}};Xa._startAddRenderingInfo=function(ta){f.isSome(this.layer.renderer)&&"dictionary"===this.layer.renderer.type?(ta.state=1,ta.abortController=l.createAbortController(),this._getRenderingInfoAsync(ta.add,{signal:ta.abortController.signal}).then(Ba=>{f.isNone(Ba)||f.isNone(Ba.symbol)?(Ea&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),
ta.renderingInfo=null):ta.renderingInfo=Ba;ta.state=2},Ba=>{ta.abortController=null;l.isAbortError(Ba)?ta.state=0:ta.state=3})):(ta.renderingInfo=this._getRenderingInfo(ta.add,Ea),ta.state=2)};Xa._addGraphic=function(ta,Ba){this.graphicsWithoutSymbol.set(ta.uid,ta);if(!f.isNone(Ba)&&!f.isNone(Ba.symbol)&&V.hasGeometry(ta)){var va=this.getOrCreateGraphics3DSymbol(Ba.symbol,Ba.renderer);if(!f.isNone(va)){this.expandComputedExtent(ta.geometry);this._beginGraphicUpdate(ta);var za=new ea(ta,Ba,this.layer),
Da=!1,Ga=Sa=>{Sa===va.symbol.id&&(Da=!0)};this._whenSymbolRemoved.push(Ga);va.load(()=>{if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Ga);if(!(Da||va.destroyed||this.graphicSymbolSupported&&ta.symbol&&ta.symbol.id!==va.symbol.id)){if(this.graphicsWaitingForSymbol.has(ta.uid)){const Sa=this.createGraphics3DGraphic(va,za);this._spatialIndex&&f.isSome(Sa)&&this._spatialIndex.add(Sa)}this._endGraphicUpdate(ta)}--va.referenced;this.featureStore.events.emit("changed");this.labeler&&this.owner.view.labeler.setDirty()}},
Sa=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(Ga),Da||(l.isAbortError(Sa)?this.add([ta]):va.destroyed||this._endGraphicUpdate(ta)))})}}};Xa._removeGraphic=function(ta){ta=ta.uid;const Ba=this.graphics3DGraphics.get(ta);if(Ba){var va;Ba.graphics3DSymbol.onRemoveGraphic(Ba);const za=Ba.usedMemory,Da=Ba.isElevationSource;this._conditionalRemove(Ba,ta);null==(va=this._spatialIndex)?void 0:va.remove(Ba);this.graphicsBySymbol.get(Ba.graphics3DSymbol.symbol.id).delete(ta);this.graphicsWithoutSymbol.delete(ta);
this.removeGraphics3DGraphic(ta,za,Da);Ba.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(ta),this.graphicsWaitingForSymbol.delete(ta),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Xa.hasLabelingContext=function(ta){if(ta instanceof x||ta instanceof m){const Ba=this.symbolCreationContext.layer;return Ba.labelingInfo?Ba.labelingInfo.some(va=>va.symbol===ta):!1}return!1};Xa.hasValidSymbolCreationContext=function(ta){return ta instanceof
x&&!this.hasLabelingContext(ta)?(Ea.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Xa._getRenderingInfo=function(ta,Ba){const va=ta.geometry;if(f.isNone(va))return Ba&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!U.canProjectWithoutEngine(va.spatialReference,this._spatialReference))return Ba&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&f.isSome(ta.symbol))return Ba&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ta=this.rendererHasGeometryOperations?ba.hydrateGraphic(ta,this.layer):ta;ta=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
f.isSome(this.currentRenderer))?this.owner.getRenderingInfo(ta,this.currentRenderer,f.unwrap(this.arcadeOnDemand)):{symbol:ta.symbol||qa.getDefaultSymbol3D(ta.geometry)};return f.isNone(ta)||f.isNone(ta.symbol)?(Ba&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):ta};Xa._getRenderingInfoAsync=function(ta,Ba){if(f.isNone(ta.geometry))return Ea&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),
null;if(!this.graphicSymbolSupported&&f.isSome(ta.symbol))return Ea&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ta=this.rendererHasGeometryOperations?ba.hydrateGraphic(ta,this.layer):ta;return this.owner.getRenderingInfoAsync(ta,f.unwrap(this.currentRenderer),f.unwrap(this.arcadeOnDemand),Ba)};Xa.createGraphics3DSymbol=function(ta,Ba){if(!this.hasValidSymbolCreationContext(ta))return null;
ta=this.getConvertedSymbol(ta);if(!ta)return null;let va;f.isSome(Ba)&&"backgroundFillSymbol"in Ba&&Ba.backgroundFillSymbol&&(Ba=L.to3D(Ba.backgroundFillSymbol,!1,!0),Ba.symbol&&"web-style"!==Ba.symbol.type&&(va=Ba.symbol.symbolLayers));const za=Ja.make(ta,this.symbolCreationContext,va);za.load(()=>{const Da=za.extentPadding;Da>this.extentPadding&&this._set("extentPadding",Da);this.notifyChange("averageSymbolComplexity")},()=>{});return za};Xa.getOrCreateGraphics3DSymbol=function(ta,Ba){let va=this.symbols.get(ta.id);
void 0===va&&(va=ta instanceof B?new ka(ta,za=>this.createGraphics3DSymbol(za,Ba)):this.createGraphics3DSymbol(ta,Ba),this.symbols.set(ta.id,va));f.isSome(va)&&++va.referenced;return va};Xa.trackGraphicState=function(ta){f.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new Ha.GraphicStateTracking(this));return this.graphicStateTracking.add(ta)};Xa.addGraphics3DGraphic=function(ta){this._usedMemory+=ta.usedMemory;this.graphics3DGraphics.set(ta.graphic.uid,ta);this.numberOfGraphics++;
ta.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};Xa.removeGraphics3DGraphic=function(ta,Ba,va=!1){this._usedMemory-=Ba;this.graphics3DGraphics.delete(ta);this.numberOfGraphics--;va&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};Xa.createGraphics3DGraphic=function(ta,Ba){const va=Ba.graphic;this.graphicsWithoutSymbol.delete(va.uid);if(!this.symbols.has(ta.symbol.id))return this.add([va]),
null;if(this.graphics3DGraphics.has(va.uid))return null;Ba=ta.createGraphics3DGraphic(Ba);if(f.isNone(Ba))return null;this.addGraphics3DGraphic(Ba);ta=ta.symbol.id;this.graphicsBySymbol.has(ta)||this.graphicsBySymbol.set(ta,new Map);this.graphicsBySymbol.get(ta).set(va.uid,Ba);Ba.isDraped&&this.graphicsDrapedUids.add(va.uid);Ba.centroid=null;f.isSome(va.geometry)&&"point"!==va.geometry.type&&Ba instanceof M&&(Ba.centroid=fa.computeCentroid(va.geometry,this._spatialReference));this._updateUserVisibility(Ba);
f.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(Ba);this.filterVisibility&&this.filterVisibility.updateVisibility(Ba);this.deconflictor&&this.deconflictor.addGraphic(Ba);this.labeler&&this.labeler.addGraphic(Ba);this.objectStates&&this.objectStates.addGraphic(Ba);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,Ba);Ba.initialize(this.stage,this.stageLayer,this.owner);f.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(Ba);
if(ta=this.whenGraphics3DGraphicRequests[va.uid])delete this.whenGraphics3DGraphicRequests[va.uid],ta.resolve(Ba);return Ba};Xa.abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};Xa.rendererChange=async function(ta){this.abortRendererChange();if(ta!==this.currentRenderer)if(this.validateRenderer(ta),f.isNone(ta)&&this.currentRendererChange(null,!1),oa.isSupportedRenderer3D(ta))if(f.isSome(ta)&&ta.arcadeRequired){var Ba=
l.createAbortController();this.rendererChangeAbortController=Ba;const {arcadeUtils:va}=await this.ensureArcade();l.throwIfAborted(Ba);va.hasGeometryOperations(ta)&&(await va.enableGeometryOperations(),l.throwIfAborted(Ba));this.asyncUpdates?await this._frameTask.schedule(()=>this.currentRendererChange(ta,!0),Ba.signal):this.currentRendererChange(ta,!0);this.rendererChangeAbortController=null}else this.asyncUpdates?(this.rendererChangeAbortController=Ba=l.createAbortController(),await this._frameTask.schedule(()=>
this.currentRendererChange(ta,!1),Ba.signal),this.rendererChangeAbortController=null):this.currentRendererChange(ta,!1);else this.currentRendererChange(ta,!1)};Xa.ensureArcade=async function(){f.isNone(this.arcadeOnDemand)&&(this.arcadeOnDemand=await C.loadArcade());return this.arcadeOnDemand};Xa.currentRendererChange=function(ta,Ba){this.currentRenderer=ta;this.rendererHasGeometryOperations=Ba;this.symbolCreationContext.arcade=f.unwrap(this.arcadeOnDemand);Ba=this.symbolCreationContext.renderer;
if(ta!==Ba)if(this.updateUpdatePolicy(),this.symbolConversionCache.clear(),f.isNone(ta))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var va=Q.diff(Ba,ta);this.updateUnchangedSymbolMappings(va,ta,Ba);this.symbolCreationContext.renderer=ta;f.isNone(va)||("complete"===va.type?this.recreateAllGraphics():"partial"===va.type&&(this.applyRendererDiff(va,ta,Ba)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("averageSymbolComplexity"))}};Xa.diffHasSymbolChange=
function(ta){for(const Ba in ta.diff)switch(Ba){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete ta.diff[Ba];break;default:return!0}return!1};Xa.applySymbolSetDiff=function(ta,Ba,va){ta=ta||[];Ba=Ba||[];const za=[];for(const Da of Ba){const Ga=this.graphicsBySymbol.get(Da.id);Ga&&Ga.forEach((Sa,Ta)=>{var Ra=Sa.graphic,ra=this.layer instanceof K?this.layer:null;const Aa=f.unwrap(this.arcadeOnDemand);if(Da!==va.defaultSymbol||
va.getSymbol(ba.hydrateGraphic(Ra,ra),{arcade:Aa})!==va.defaultSymbol)ra=Sa.usedMemory,ta.length||va.defaultSymbol?za.push(Ra):this.graphicsWithoutSymbol.set(Ta,Ra),Ra=this.graphics3DGraphics.get(Ta),this._conditionalRemove(Ra,Ta),Sa.destroy(),Ga.delete(Ta),this.removeGraphics3DGraphic(Ta,ra),this.updateLayerVisibility()});this._whenSymbolRemoved.forAll(Sa=>Sa(Da.id))}if(ta.length||za.length)this.graphicsWithoutSymbol.forEach(Da=>za.push(Da)),this.graphicsWithoutSymbol.clear(),this.add(za);this._cleanupSymbols();
this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Xa.applyUniqueValueRendererDiff=function(ta,Ba,va){const za=ta.diff.defaultSymbol,Da=ta.diff.uniqueValueInfos;if(za||Da){const Ga=Da?Da.added.map(Ta=>Ta.symbol):[],Sa=Da?Da.removed.map(Ta=>Ta.symbol):[];if(Da)for(let Ta=0;Ta<Da.changed.length;Ta++)Ga.push(Da.changed[Ta].newValue.symbol),Sa.push(Da.changed[Ta].oldValue.symbol);za?(va.defaultSymbol&&Sa.push(va.defaultSymbol),Ba.defaultSymbol&&Ga.push(Ba.defaultSymbol)):
va.defaultSymbol&&Ga.length&&Sa.push(Ba.defaultSymbol);this.applySymbolSetDiff(Ga,Sa,Ba);delete ta.diff.defaultSymbol;delete ta.diff.uniqueValueInfos;return!0}return!1};Xa.calculateUnchangedSymbolMapping=function(ta,Ba,va){const za=Ga=>f.isSome(Ga)?Ga.id:null;if(Ba instanceof X&&va instanceof X&&(f.isNone(ta)||"partial"===ta.type)){var Da=ta&&ta.diff;ta=Da&&Da.defaultSymbol;Da=(Da=Da&&Da.uniqueValueInfos)?Da.unchanged.map(Ga=>({oldId:za(Ga.oldValue.symbol),newId:za(Ga.newValue.symbol)})):va.uniqueValueInfos.map((Ga,
Sa)=>({oldId:za(Ga.symbol),newId:za(Ba.uniqueValueInfos[Sa].symbol)}));!ta&&va.defaultSymbol&&Da.push({oldId:za(va.defaultSymbol),newId:za(Ba.defaultSymbol)});return Da}return[]};Xa.updateSymbolMapping=function(ta,Ba){const va=Ba?"string"===typeof Ba?Ba:Ba.id:null;Ba="string"===typeof Ba?null:Ba;if(ta&&ta!==va){var za=this.graphicsBySymbol.get(ta);this.graphicsBySymbol.delete(ta);void 0!==za&&this.graphicsBySymbol.set(va,za);za=this.symbols.get(ta);void 0!==za&&(this.symbols.delete(ta),this.symbols.set(va,
za),f.isSome(za)&&(f.isSome(Ba)?za.symbol=Ba:za.symbol.id=va))}};Xa.updateUnchangedSymbolMappings=function(ta,Ba,va){ta=this.calculateUnchangedSymbolMapping(ta,Ba,va);for(const {oldId:za,newId:Da}of ta)this.updateSymbolMapping(za,Da)};Xa.applyRendererDiff=function(ta,Ba,va){if(this.diffHasSymbolChange(ta))return!1;if(Ba instanceof X&&va instanceof X&&this.applyUniqueValueRendererDiff(ta,Ba,va)&&0===Object.keys(ta.diff).length)return!0;for(const [za]of this.graphicsBySymbol)if(va=this.symbols.get(za),
f.isSome(va)&&!va.applyRendererDiff(ta,Ba))return!1;return!0};Xa.opacityChange=function(){this.forEachGraphics3DSymbol((ta,Ba)=>ta.globalPropertyChanged("opacity",Ba));this.updateStageLayerVisibility()};Xa.updateUpdatePolicy=function(){const ta=f.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;f.isSome(this.forcedUpdatePolicy)?this._asyncUpdates=1===this.forcedUpdatePolicy:this._asyncUpdates=1===this.preferredUpdatePolicy||ta;(this.symbolCreationContext.isAsync=this._asyncUpdates)||
this._update(N.noBudget)};Xa.slicePlaneEnabledChange=function(ta){ta!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=ta,this.stageLayer.isSliceable=ta,this.forEachGraphics3DSymbol((Ba,va)=>Ba.globalPropertyChanged("slicePlaneEnabled",va)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};Xa.physicalBasedRenderingChange=function(ta){ta!==this.symbolCreationContext.physicalBasedRenderingEnabled&&
(this.symbolCreationContext.physicalBasedRenderingEnabled=ta,this.forEachGraphics3DSymbol((Ba,va,za)=>{Ba.globalPropertyChanged("physicalBasedRenderingEnabled",va)||this._recreateSymbol(za)}))};Xa.pixelRatioChange=function(){this.forEachGraphics3DSymbol((ta,Ba,va)=>{ta.globalPropertyChanged("pixelRatio",Ba)||this._recreateSymbol(va)})};Xa._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=
w.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Xa.setClippingExtent=function(ta,Ba){const va=this.symbolCreationContext.clippingExtent,za=Y.create();ha.toBoundingRect(ta,za,Ba)?this.symbolCreationContext.clippingExtent=O.fromRect(O.create(),za):this.symbolCreationContext.clippingExtent=null;return!O.equals(this.symbolCreationContext.clippingExtent,va)};Xa.modifyGraphics3DGraphicVisibilities=function(ta){let Ba=!1;this.graphics3DGraphics.forEach(va=>{ta(va)&&(Ba=!0)});Ba&&(this.labeler&&
this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Xa.forEachGraphics3DSymbol=function(ta){for(const [Ba,va]of this.symbols){if(f.isNone(va))break;const za=this.graphicsBySymbol.get(Ba);ta(va,za||ab,Ba)}};Xa.updateAllGraphicsVisibility=function(){this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(ta=>{const Ba=this._updateUserVisibility(ta);ta=f.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(ta);return Ba||
ta})};Xa.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(ta=>ta.setVisibilityFlag(0,!1,0))};Xa.validateRenderer=function(ta){(ta=oa.validateTo3D(ta))&&Ea.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,ta.message)};Xa.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Xa._cleanupSymbols=function(){if(!(0<
this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var ta=!1;this.symbols.forEach((Ba,va)=>{if(!(f.isNone(Ba)||0<Ba.referenced)){var za=this.graphicsBySymbol.get(va);za&&0!==za.size||(this.graphicsBySymbol.delete(va),this.symbols.delete(va),Ba&&Ba.destroy(),ta=!0)}});ta&&(this.recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};Xa.snapshotInternals=function(){return{graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(ta=>
({symbolId:ta,graphics:[...this.graphicsBySymbol.get(ta).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}};g._createClass(lb,[{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new Na.SpatialIndex2D({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));
this._spatialIndex.update();return this._spatialIndex}},{key:"asyncUpdates",get:function(){return this._asyncUpdates}},{key:"updating",get:function(){var ta,Ba;return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate||null!=(ta=this.elevationAlignment)&&ta.updating||f.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(Ba=this.filterVisibility)&&Ba.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||
this._frameTask.updating)}},{key:"needsUpdate",get:function(){var ta;return 0<this.pendingUpdates.size||!(null==(ta=this._spatialIndex)||!ta.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var ta;return this.owner.suspended||(null==(ta=this.owner.suspendInfo)?void 0:ta.outsideOfView)}},{key:"updatingRemaining",get:function(){var ta;return this.updating?this.pendingUpdates.size+.1*((null==(ta=this._spatialIndex)?void 0:ta.updatingRemaining)||0):0}},{key:"updatingTotal",get:function(){return this.updating?
this.maxPendingUpdates:0}},{key:"displayFeatureLimit",get:function(){var ta=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const Ba=ta?ta.graphics3D.minTotalNumberOfFeatures:0,va=ta?ta.graphics3D.maxTotalNumberOfFeatures:0;ta=ta?ta.graphics3D.maxTotalNumberOfPrimitives:0;const za=this.averageSymbolComplexity;var Da=Math.max(1,f.isSome(za)?za.primitivesPerFeature:1),Ga=f.isSome(za)&&0<za.drawCallsPerFeature?va/za.drawCallsPerFeature*.3:va;Da=Math.max(Ba,Math.min(va,Math.ceil(ta/Da),Ga));
return(Ga=this._get("displayFeatureLimit"))&&Ga.minimumTotalNumberOfFeatures===Ba&&Ga.maximumTotalNumberOfFeatures===va&&Ga.maximumTotalNumberOfPrimitives===ta&&Ga.averageSymbolComplexity===za&&Ga.maximumNumberOfFeatures===Da?Ga:{minimumTotalNumberOfFeatures:Ba,maximumTotalNumberOfFeatures:va,maximumTotalNumberOfPrimitives:ta,averageSymbolComplexity:za,maximumNumberOfFeatures:Da}}},{key:"averageSymbolComplexity",get:function(){const ta=ma.averageSymbolComplexities(this.symbolComplexities),Ba=this._get("averageSymbolComplexity");
return 0===ta.numComplexities||f.isSome(Ba)&&(ta.estimated&&(Ba.primitivesPerFeature>=ta.primitivesPerFeature||Ba.primitivesPerCoordinate>=ta.primitivesPerCoordinate||Ba.drawCallsPerFeature>=ta.drawCallsPerFeature)||Ba.primitivesPerFeature===ta.primitivesPerFeature&&Ba.primitivesPerCoordinate===ta.primitivesPerCoordinate&&Ba.drawCallsPerFeature===ta.drawCallsPerFeature)?Ba:ta}},{key:"spatialReference",get:function(){return this._spatialReference}},{key:"usedMemory",get:function(){const ta=f.isSome(this.averageSymbolComplexity)&&
this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+ta}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?30<Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics?0:this._usedMemory/this.numberOfGraphics:f.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):
0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const ta=this.owner.layer&&this.owner.layer.objectIdField;if(!ta)return null;const Ba=new Map;this.graphics3DGraphics.forEach(va=>{if(va){var za=
this._getGraphicObjectID(va.graphic,ta);f.isSome(za)&&Ba.set(za,va)}});return Ba}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let ta=0,Ba=0;return ca.someMap(this.symbols,(va,za)=>{if(f.isSome(va)){va=va.getFastUpdateStatus();if(0<va.loading)return!0;this.graphicsBySymbol.has(za)&&(Ba+=va.fast,ta+=va.slow)}return!1})?"unknown":0<=Ba&&0===ta?"fast":0<=ta&&0===Ba?
"slow":"mixed"}},{key:"test",get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:ta=>{this.forcedUpdatePolicy=ta;this.updateUpdatePolicy()}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return lb}(y);a.Graphics3DCore.tmpVec=F.create();b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,
"computedExtent",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"elevationInfoChangeAbortController",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,
"setupAbortController",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"elevationAlignment",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"scaleVisibility",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"filterVisibility",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([d.property()],
a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"featureStore",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"deconflictor",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"labeler",void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"objectStates",void 0);b.__decorate([d.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",
void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",
void 0);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"needsUpdate",null);b.__decorate([d.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([d.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([d.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingTotal",null);b.__decorate([d.property({readOnly:!0,
dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([d.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"hasM",void 0);a.Graphics3DCore=Va=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);let Pa=function(){function cb(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}cb.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=0;this.remove=this.abortController=null};return cb}();const ja=F.create(),Ya=F.create(),ab=new Map;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/rendererConversion":function(){define(["exports",
"../../core/has","../../core/maybe","../../core/Error","../../symbols/support/symbolConversion"],function(a,g,b,p,f){function k(h){return b.isNone(h)||"simple"===h.type||"unique-value"===h.type||"class-breaks"===h.type||"dictionary"===h.type}function c(h,n){if(!n)return null;n=Array.isArray(n)?n:[n];if(0<n.length){const q=n.map(v=>v.details.symbol.type||v.details.symbol.declaredClass).filter(v=>!!v);q.sort();const u=[];q.forEach((v,t)=>{0!==t&&v===q[t-1]||u.push(v)});return new p("renderer-conversion-3d:unsupported-symbols",
`Renderer contains symbols (${u.join(", ")}) which are not supported in 3D`,{renderer:h,symbolErrors:n})}return null}function d(h){const n=h.uniqueValueInfos.map(u=>f.to3D(u.symbol).error).filter(u=>!!u),q=f.to3D(h.defaultSymbol);q.error&&n.unshift(q.error);return c(h,n)}function e(h){const n=h.classBreakInfos.map(u=>f.to3D(u.symbol).error).filter(u=>!!u),q=f.to3D(h.defaultSymbol);q.error&&n.unshift(q.error);return c(h,n)}a.isSupportedRenderer3D=k;a.validateTo3D=function(h){if(b.isNone(h))return null;
if(!k(h))return new p("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${h.type||h.declaredClass}'`,{renderer:h});switch(h.type){case "simple":return c(h,f.to3D(h.symbol).error);case "unique-value":return d(h);case "class-breaks":return e(h)}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaultsJSON ./defaults".split(" "),
function(a,g,b,p,f,k,c,d,e,h){const n=c.fromSimpleMarkerSymbol(h.defaultPointSymbol2D),q=f.fromSimpleLineSymbol(h.defaultPolylineSymbol2D),u=d.fromSimpleFillSymbol(h.defaultPolygonSymbol2D),v=new k({symbolLayers:[new p({material:{color:e.defaultColor},edges:{type:"solid",size:"1px",color:e.defaultOutlineColor}})]});a.getDefaultSymbol3D=function(t){if(b.isNone(t))return null;switch(t.type){case "mesh":return v;case "point":case "multipoint":return n;case "polyline":return q;case "polygon":case "extent":return u}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../geometry/projection ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){a.Graphics3DFeatureStore=function(C){function A(m){var B=C.call(this,m)||this;B.events=new t;B.hasZ=null;B.hasM=null;B.objectIdField=null;B.spatialReference=null;B.featureAdapter={getAttribute(E,F){return"graphic"in E?E.graphic.attributes[F]:z.optimizedFeatureQueryEngineAdapter.getAttribute(E,F)},getAttributes(E){return"graphic"in E?E.graphic.attributes:z.optimizedFeatureQueryEngineAdapter.getAttributes(E)},getObjectId:E=>"graphic"in E?D.getObjectId(E.graphic,
B.objectIdField):z.optimizedFeatureQueryEngineAdapter.getObjectId(E),getGeometry:E=>"graphic"in E?E.getAsOptimizedGeometry(B.hasZ,B.hasM):z.optimizedFeatureQueryEngineAdapter.getGeometry(E),getCentroid:(E,F)=>{if("graphic"in E){let G=null;f.isSome(E.centroid)?G=E.centroid:"point"===E.graphic.geometry.type&&l.projectPoint(E.graphic.geometry,r,B.spatialReference)&&(G=r);E=Array(2+(F.hasZ?1:0)+(F.hasM?1:0));f.isNone(G)?(E[0]=0,E[1]=0,E[2]=0,E[3]=0):(E[0]=G.x,E[1]=G.y,F.hasZ&&(E[2]=G.hasZ?G.z:0),F.hasM&&
(E[F.hasZ?3:2]=G.hasM?G.m:0));return new y([],E)}return z.optimizedFeatureQueryEngineAdapter.getCentroid(E,F)},cloneWithGeometry:(E,F)=>"graphic"in E?new w(F,B.featureAdapter.getAttributes(E),null,B.featureAdapter.getObjectId(E)):z.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(E,F)};return B}g._inheritsLoose(A,C);var x=A.prototype;x.forEach=function(m){this.forAllGraphics(B=>{m(B)})};x.forEachInBounds=function(m,B){this.getSpatialIndex().forEachInBounds(m,B)};x.forEachBounds=function(m,B,E){const F=
this.getSpatialIndex();for(const G of m)m=this.featureAdapter.getObjectId(G),f.isSome(F.getBounds(m,E))&&B(E)};return A}(v);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forAllGraphics",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,
"hasM",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);b.__decorate([d.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"spatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const r={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};a.default=a.Graphics3DFeatureStore;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../OptimizedFeature","../OptimizedGeometry","../centroid"],function(a,g,b,p){const f={getObjectId(k){return k.objectId},getAttributes(k){return k.attributes},getAttribute(k,c){return k.attributes[c]},cloneWithGeometry(k,c){return new g(c,k.attributes,null,k.objectId)},getGeometry(k){return k.geometry},getCentroid(k,c){k.centroid||(k.centroid=p.getCentroidOptimizedGeometry(new b,k.geometry,c.hasZ,
c.hasM));return k.centroid}};a.default=f;a.optimizedFeatureQueryEngineAdapter=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){a.Graphics3DSymbolCreationContext=function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=
null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DSymbol","./Graphics3DPointSymbol"],function(a,g,b){a.make=function(p,f,k){let c;switch(p.type){case "point-3d":c=b;break;default:c=g}return new c(p,f,k)};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","../../../../core/asyncUtils","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(a,g,b,p,f){return function(k){function c(e,h,n){e=k.call(this,e,h,n)||this;e.calloutSymbolLayer=null;e.symbol.hasVisibleCallout()&&(e.calloutSymbolLayer=p.make(e.symbol,h));return e}a._inheritsLoose(c,k);var d=c.prototype;d.doLoad=async function(e){const h=
this.calloutSymbolLayer?b.result(this.calloutSymbolLayer.load()):null;try{await k.prototype.doLoad.call(this,e)}catch(u){var n;null==(n=this.calloutSymbolLayer)?void 0:n.abortLoad();throw u;}if(g.isAborted(e)){var q;null==(q=this.calloutSymbolLayer)?void 0:q.abortLoad();throw g.createAbortError();}h&&await h};d.destroy=function(){k.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};d.createGraphics3DGraphic=function(e,h){h=k.prototype.createGraphics3DGraphic.call(this,
e,h);this.calloutSymbolLayer&&(e=this.createCalloutGraphic(e))&&h.addAuxiliaryGraphic(e);return h};d.globalPropertyChanged=function(e,h){return k.prototype.globalPropertyChanged.call(this,e,h)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(e,h,n=>this._getCalloutGraphicLayer(n)):!0:!1};d.updateGeometry=function(e,h){const n=k.prototype.updateGeometry.call(this,e,h);return n&&this.calloutSymbolLayer&&(e=this._getCalloutGraphicLayer(e))?this.calloutSymbolLayer.updateGeometry(e,
h):n};d.createCalloutGraphic=function(e){const h=e.renderingInfo;e.renderingInfo={renderer:h.renderer,symbol:h.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(e)};d._getCalloutGraphicLayer=function(e){for(const h of e._auxiliaryGraphics)if(h.graphics3DSymbolLayer===this.calloutSymbolLayer)return h};return c}(f)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports",
"../../../../core/maybe","../../../../core/arrayUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,g,b,p){let f=function(){function k(d){this.graphicsCore=d;this.idToState=new Map;this.states=new Set;const e=d.owner.layer&&d.owner.layer.objectIdField;e?(this.getGraphicId=h=>p.getObjectId(h,e),this.getGraphics3DGraphicById=h=>this.graphicsCore.getGraphics3DGraphicByObjectId(h)):(this.getGraphicId=h=>h.uid,this.getGraphics3DGraphicById=h=>this.graphicsCore.getGraphics3DGraphicById(h))}
var c=k.prototype;c.destroy=function(){this.idToState.clear();this.states.forEach((d,e)=>this.remove(e))};c.add=function(d){const e={remove:()=>this.remove(d)};if(this.states.has(d))return e;const h=this.getGraphicId(d.graphic),n=this.getGraphics3DGraphicById(h);this.states.has(d)||this.states.add(d);this.ensureStateList(h).push(d);d.displaying=g.isSome(n)?n.isVisible():!1;d.isDraped=g.isSome(n)?n.isDraped:!1;d.tracking=!0;return e};c.remove=function(d){if(this.states.has(d)){if(this.idToState.size){const e=
this.getGraphicId(d.graphic),h=this.idToState.get(e);h&&(b.remove(h,d),0===h.length&&this.idToState.delete(e))}this.states.delete(d);d.tracking=!1;d.displaying=!1}};c.addGraphic=function(d){this.forEachState(d,e=>{e.displaying=d.isVisible();e.isDraped=d.isDraped;e.emit("changed",{})})};c.removeGraphic=function(d){this.forEachState(d,e=>{e.displaying=!1;e.isDraped=!1})};c.updateGraphicGeometry=function(d){this.forEachState(d,e=>{e.emit("changed",{})})};c.updateGraphicVisibility=function(d){this.forEachState(d,
e=>{e.displaying=d.isVisible()})};c.allGraphicsDeleted=function(){this.states.forEach(d=>{d.displaying=!1})};c.ensureStateList=function(d){var e=this.idToState.get(d);if(e)return e;e=[];this.idToState.set(d,e);return e};c.forEachState=function(d,e){0!==this.states.size&&0!==this.idToState.size&&(d=this.getGraphicId(d.graphic),d=this.idToState.get(d),null!=d&&d.forEach(e))};return k}();a.GraphicStateTracking=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../core/libs/rbush/PooledRBush".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.SpatialIndex2D=function(y){function D(r){r=y.call(this,r)||this;r._index=new l.PooledRBush(9,p("csp-restrictions")?C=>({minX:C.extent[0],minY:C.extent[1],maxX:C.extent[2],maxY:C.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);r._missing=new Set;r._boundsByFeature=new Map;r.spatialReference=null;r.hasZ=null;r.hasM=null;r.objectIdField=null;r.updating=!1;return r}g._inheritsLoose(D,y);var z=D.prototype;z.setup=function(r){this._addMany(r)};
z.destroy=function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};z.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};z.queryGraphicUIDsInExtent=function(r,C,A){C.equals(this.spatialReference)&&(w.minX=r[0],w.minY=r[1],w.maxX=r[2],w.maxY=r[3],this.update(),this._index.search(w,x=>A(x.graphic.uid)))};z.add=function(r){this._missing.add(r);this.updating=
!0};z.remove=function(r){this._missing.delete(r)?this.updating=0<this._missing.size:(this._index.remove(r),r=t.getObjectId(r.graphic,this._get("objectIdField")),null!=r&&this._boundsByFeature.delete(r))};z._addMany=function(r){if(0!==r.length){var C=this._get("objectIdField");for(const A of r){A.computeExtent(this.spatialReference);const x=t.getObjectId(A.graphic,C);null!=x&&this._boundsByFeature.set(x,A.extent)}this._index.load(r)}};z.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};z.forEachInBounds=function(r,C){w.minX=r[0];w.minY=r[1];w.maxX=r[2];w.maxY=r[3];this.update();this._index.search(w,A=>{C(A)})};z.getBounds=function(r,C){this.update();return(r=this._boundsByFeature.get(r))?v.fromRect(C,r):null};g._createClass(D,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return D}(u);b.__decorate([c.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([c.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);b.__decorate([c.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([c.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);b.__decorate([c.property()],a.SpatialIndex2D.prototype,"updating",void 0);a.SpatialIndex2D=b.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const w={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../arrayUtils ../../PooledArray ../../../chunks/quickselect".split(" "),
function(a,g,b,p,f,k){function c(m,B){d(m,0,m.children.length,B,m)}function d(m,B,E,F,G){G||(G=new A([]));G.minX=Infinity;G.minY=Infinity;G.maxX=-Infinity;G.maxY=-Infinity;for(let I=B,K;I<E;I++)K=m.children[I],e(G,m.leaf?F(K):K);return G}function e(m,B){m.minX=Math.min(m.minX,B.minX);m.minY=Math.min(m.minY,B.minY);m.maxX=Math.max(m.maxX,B.maxX);m.maxY=Math.max(m.maxY,B.maxY)}function h(m,B){return m.minX-B.minX}function n(m,B){return m.minY-B.minY}function q(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}
function u(m){return m.maxX-m.minX+(m.maxY-m.minY)}function v(m,B){return m.minX<=B.minX&&m.minY<=B.minY&&B.maxX<=m.maxX&&B.maxY<=m.maxY}function t(m,B){return B.minX<=m.maxX&&B.minY<=m.maxY&&B.maxX>=m.minX&&B.maxY>=m.minY}function l(m,B,E,F,G){for(B=[B,E];B.length;){E=b.assumeNonNull(B.pop());const I=b.assumeNonNull(B.pop());if(E-I<=F)continue;const K=I+Math.ceil((E-I)/F/2)*F;k.quickselect(m,K,I,E,G);B.push(I,K,K,E)}}let w=function(){function m(E=9,F){this.compareMinX=h;this.compareMinY=n;this.toBBox=
function(G){return G};this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this.toBBox=F:this._initFormat(F));this.clear()}var B=m.prototype;B.destroy=function(){this.clear();y.prune();D.prune();z.prune();r.prune()};B.all=function(E){this._all(this.data,E)};B.search=function(E,F){let G=this.data;const I=this.toBBox;if(t(E,G))for(y.clear();G;){for(let K=0,J=G.children.length;K<J;K++){const L=G.children[K],P=G.leaf?I(L):L;t(E,P)&&(G.leaf?
F(L):v(E,P)?this._all(L,F):y.push(L))}G=y.pop()}};B.collides=function(E){let F=this.data;const G=this.toBBox;if(!t(E,F))return!1;for(y.clear();F;){for(let I=0,K=F.children.length;I<K;I++){const J=F.children[I],L=F.leaf?G(J):J;if(t(E,L)){if(F.leaf||v(E,L))return!0;y.push(J)}}F=y.pop()}return!1};B.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let F=0,G=E.length;F<G;F++)this.insert(E[F]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this.data.children.length)if(this.data.height===
E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){const F=this.data;this.data=E;E=F}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this};B.insert=function(E){E&&this._insert(E,this.data.height-1);return this};B.clear=function(){this.data=new A([]);return this};B.remove=function(E){if(!E)return this;let F=this.data,G=null,I=0,K=!1,J;const L=this.toBBox(E);z.clear();for(r.clear();F||0<z.length;){if(!F){var P;F=b.assumeNonNull(z.pop());G=z.data[z.length-
1];I=null!=(P=r.pop())?P:0;K=!0}if(F.leaf&&(J=p.indexOf(F.children,E,F.children.length,F.indexHint),-1!==J)){F.children.splice(J,1);z.push(F);this._condense(z);break}K||F.leaf||!v(F,L)?G?(I++,F=G.children[I],K=!1):F=null:(z.push(F),r.push(I),I=0,G=F,F=F.children[0])}return this};B.toJSON=function(){return this.data};B.fromJSON=function(E){this.data=E;return this};B._all=function(E,F){for(D.clear();E;){var G;if(!0===E.leaf)for(const I of E.children)F(I);else D.pushArray(E.children);E=null!=(G=D.pop())?
G:null}};B._build=function(E,F,G,I){var K=G-F+1,J=this._maxEntries;if(K<=J)return E=new A(E.slice(F,G+1)),c(E,this.toBBox),E;I||(I=Math.ceil(Math.log(K)/Math.log(J)),J=Math.ceil(K/J**(I-1)));const L=new x([]);L.height=I;K=Math.ceil(K/J);J=K*Math.ceil(Math.sqrt(J));for(l(E,F,G,J,this.compareMinX);F<=G;F+=J){const P=Math.min(F+J-1,G);l(E,F,P,K,this.compareMinY);for(let Q=F;Q<=P;Q+=K)L.children.push(this._build(E,Q,Math.min(Q+K-1,P),I-1))}c(L,this.toBBox);return L};B._chooseSubtree=function(E,F,G,I){for(;;){I.push(F);
if(!0===F.leaf||I.length-1===G)break;let K=Infinity,J=Infinity,L=void 0;for(let P=0,Q=F.children.length;P<Q;P++){const X=F.children[P],aa=q(X),S=(Math.max(X.maxX,E.maxX)-Math.min(X.minX,E.minX))*(Math.max(X.maxY,E.maxY)-Math.min(X.minY,E.minY))-aa;S<J?(J=S,K=aa<K?aa:K,L=X):S===J&&aa<K&&(K=aa,L=X)}F=L||F.children[0]}return F};B._insert=function(E,F,G){var I=this.toBBox;G=G?E:I(E);z.clear();I=this._chooseSubtree(G,this.data,F,z);I.children.push(E);for(e(I,G);0<=F;)if(z.data[F].children.length>this._maxEntries)this._split(z,
F),F--;else break;this._adjustParentBBoxes(G,z,F)};B._split=function(E,F){const G=E.data[F];var I=G.children.length;const K=this._minEntries;this._chooseSplitAxis(G,K,I);(I=this._chooseSplitIndex(G,K,I))?(I=G.children.splice(I,G.children.length-I),I=G.leaf?new A(I):new x(I),I.height=G.height,c(G,this.toBBox),c(I,this.toBBox),F?E.data[F-1].children.push(I):this._splitRoot(G,I)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};B._splitRoot=function(E,F){this.data=
new x([E,F]);this.data.height=E.height+1;c(this.data,this.toBBox)};B._chooseSplitIndex=function(E,F,G){let I,K,J=void 0;I=K=Infinity;for(let P=F;P<=G-F;P++){var L=d(E,0,P,this.toBBox);const Q=d(E,P,G,this.toBBox),X=Math.max(0,Math.min(L.maxX,Q.maxX)-Math.max(L.minX,Q.minX))*Math.max(0,Math.min(L.maxY,Q.maxY)-Math.max(L.minY,Q.minY));L=q(L)+q(Q);X<I?(I=X,J=P,K=L<K?L:K):X===I&&L<K&&(K=L,J=P)}return J};B._chooseSplitAxis=function(E,F,G){const I=E.leaf?this.compareMinX:h,K=E.leaf?this.compareMinY:n,J=
this._allDistMargin(E,F,G,I);F=this._allDistMargin(E,F,G,K);J<F&&E.children.sort(I)};B._allDistMargin=function(E,F,G,I){E.children.sort(I);I=this.toBBox;var K=d(E,0,F,I);const J=d(E,G-F,G,I);let L=u(K)+u(J);for(let P=F;P<G-F;P++){const Q=E.children[P];e(K,E.leaf?I(Q):Q);L+=u(K)}for(G=G-F-1;G>=F;G--)K=E.children[G],e(J,E.leaf?I(K):K),L+=u(J);return L};B._adjustParentBBoxes=function(E,F,G){for(;0<=G;G--)e(F.data[G],E)};B._condense=function(E){for(let F=E.length-1;0<=F;F--){const G=E.data[F];if(0===
G.children.length)if(0<F){const I=E.data[F-1],K=I.children;K.splice(p.indexOf(K,G,K.length,I.indexHint),1)}else this.clear();else c(G,this.toBBox)}};B._initFormat=function(E){const F=["return a"," - b",";"];this.compareMinX=new Function("a","b",F.join(E[0]));this.compareMinY=new Function("a","b",F.join(E[1]));this.toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return m}();const y=new f,D=new f,z=new f,r=new f({deallocator:void 0});f=function(){this.minY=
this.minX=Infinity;this.maxY=this.maxX=-Infinity};let C=function(m){function B(){var E=m.apply(this,arguments)||this;E.height=1;E.indexHint=new p.PositionHint;return E}g._inheritsLoose(B,m);return B}(f),A=function(m){function B(E){var F=m.call(this)||this;F.children=E;F.leaf=!0;return F}g._inheritsLoose(B,m);return B}(C),x=function(m){function B(E){var F=m.call(this)||this;F.children=E;F.leaf=!1;return F}g._inheritsLoose(B,m);return B}(C);a.BBox=f;a.PooledRBush=w;a.default=w;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,g){g=g.createCommonjsModule(function(b){(function(p){p=p();void 0!==p&&(b.exports=p)})(function(){function p(c,d,e,h,n){for(;h>e;){if(600<h-e){var q=h-e+1,u=d-e+1,v=Math.log(q),t=.5*Math.exp(2*v/3);v=.5*Math.sqrt(v*t*(q-t)/q)*(0>u-q/2?-1:1);p(c,d,Math.max(e,Math.floor(d-u*t/q+v)),Math.min(h,Math.floor(d+(q-u)*t/q+v)),n)}q=c[d];u=e;t=h;f(c,e,d);for(0<n(c[h],q)&&f(c,e,h);u<t;){f(c,u,t);
u++;for(t--;0>n(c[u],q);)u++;for(;0<n(c[t],q);)t--}0===n(c[e],q)?f(c,e,t):(t++,f(c,t,h));t<=d&&(e=t+1);d<=t&&(h=t-1)}}function f(c,d,e){var h=c[d];c[d]=c[e];c[e]=h}function k(c,d){return c<d?-1:c>d?1:0}return function(c,d,e,h,n){p(c,d,e||0,h||c.length-1,n||k)}})});a.quickselect=g})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../core/unitUtils ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Intersector".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A){const x=k.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");a.StageLayerElevationProvider=function(K){function J(P){P=K.call(this,P)||this;P.elevationOffset=0;P._layerHandes=new y;return P}g._inheritsLoose(J,K);var L=J.prototype;L.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new A.Intersector(this.view.state.mode);this.intersector.options.store=
0;var P=this.computeLayerExtent(this.stageLayer);this.zmin=P[2];this.zmax=P[5];P=this.stageLayer.events;this._layerHandes.add([P.on("layerObjectAdded",Q=>this.objectChanged(Q.object)),P.on("layerObjectRemoved",Q=>this.objectChanged(Q.object)),P.on("objectGeometryAdded",Q=>this.objectChanged(Q.object)),P.on("objectGeometryRemoved",Q=>this.objectChanged(Q.object)),P.on("vertexAttrsUpdated",Q=>this.objectChanged(Q.object)),P.on("objectTransformation",Q=>this.objectChanged(Q))])};L.dispose=function(){this._layerHandes.destroy()};
L.elevationInfoChanged=function(){const P=null!=this.layer?this.layer.elevationInfo:null;if(null!=P&&"on-the-ground"!==P.mode){const Q=D.getMetersPerVerticalUnitForSR(this.layer.spatialReference),X=r.getMetersPerUnit(P.unit);this.elevationOffset=f.unwrapOr(P.offset,0)*X/Q}else this.elevationOffset=0};L.getElevation=function(P,Q,X,aa){F[0]=P;F[1]=Q;F[2]=X;if(!this.renderCoordsHelper.toRenderCoords(F,aa,F))return x.error("could not project point for elevation alignment"),null;Q=this.elevationOffset;
P=this.zmin+Q;Q=this.zmax+Q;w.copy(G,F);w.copy(I,F);this.renderCoordsHelper.setAltitude(Q,G);this.renderCoordsHelper.setAltitude(P,I);this.intersector.reset(G,I);this.intersector.intersect(this.intersectLayers,null,null,1,null,S=>S.metadata&&S.metadata.isElevationSource);return this.intersector.results.min.getIntersectionPoint(F)?this.renderCoordsHelper.getAltitude(F):null};L.objectChanged=function(P){var Q;if(null!=(Q=P.metadata)&&Q.isElevationSource&&this.spatialReference){C.empty(m);P.metadata.lastValidElevationBB.isEmpty()||
this.expandExtent(P.metadata.lastValidElevationBB.bbMin,P.metadata.lastValidElevationBB.bbMax,m);Q=P.getBBMin(!1);var X=P.getBBMax(!1);this.expandExtent(Q,X,m);C.toRect(m,B);this.zmin=Math.min(this.zmin,m[2]);this.zmax=Math.max(this.zmax,m[5]);E.extent=B;E.spatialReference=this.spatialReference;this.emit("elevation-change",E);w.copy(P.metadata.lastValidElevationBB.bbMin,Q);w.copy(P.metadata.lastValidElevationBB.bbMax,X)}};L.computeLayerExtent=function(P){C.empty(m);P.getObjects().forAll(Q=>this.expandExtent(Q.getBBMin(!1),
Q.getBBMax(!1),m));return m};L.expandExtent=function(P,Q,X){for(let aa=0;8>aa;++aa)F[0]=aa&1?P[0]:Q[0],F[1]=aa&2?P[1]:Q[1],F[2]=aa&4?P[2]:Q[2],this.renderCoordsHelper.fromRenderCoords(F,F,this.spatialReference),C.expandWithVec3(X,F);return X};return J}(t.EventedMixin(v));b.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);b.__decorate([d.property({constructOnly:!0})],
a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"view.spatialReference"})],a.StageLayerElevationProvider.prototype,"spatialReference",void 0);a.StageLayerElevationProvider=b.__decorate([h.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const m=C.empty(),B=z.empty(),E={spatialReference:null,extent:B,context:"scene"},F=l.create(),G=l.create(),I=l.create();Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ../../../support/Scheduler ../../../support/layerViewUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){b=function(w){function y(){var z=w.apply(this,arguments)||this;z._scaleRangeActive=!1;z.layerScaleRangeVisibilityQuery=!1;z.handles=new v;z.layerView=null;z.layer=null;z.queryGraphicUIDsInExtent=null;z.extent=null;z.graphicsCore=null;z.basemapTerrain=null;z.layerScaleEnabled=!0;z.suspended=!1;z.updating=!0;return z}a._inheritsLoose(y,w);var D=y.prototype;D.setup=function(z,r,C,A,x){this.layerView=z;this.layer=r;this.queryGraphicUIDsInExtent=C;this.graphicsCore=
A;this.basemapTerrain=x;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(t.Task.SCALE_VISIBILITY,()=>this.update(),()=>this.needsUpdate()))};D.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};D.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||!this.updating)};D._setDirty=function(){this.updating||this._set("updating",!0)};D.setExtent=
function(z){this.extent=z;this._setDirty()};D.scaleRangeActive=function(){return this._scaleRangeActive};D.updateScaleRangeActive=function(){var z=this.layer;let r=this.layerScaleEnabled&&(0<z.minScale||0<z.maxScale);z.labelingInfo&&!r&&(r=z.labelingInfo.some(C=>C&&(0<C.minScale||0<C.maxScale)));z=this._scaleRangeActive!==r;(this._scaleRangeActive=r)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",C=>this.scaleUpdateHandler(C)),"terrain-events"),
this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!r&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return z};D.update=function(){const z=this.layerView.view.basemapTerrain;this.extent&&z&&z.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,z.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,
r=>this.finishUpdate(r))):this.finishUpdate(!0)};D.finishUpdate=function(z){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!z);this._set("updating",!1)};D.visibleAtLayerScale=function(z){return!this.layerScaleEnabled||l.scaleBoundsPredicate(z,this.layer.minScale||0,this.layer.maxScale||0)};D.visibleAtLabelScale=function(z,r){return l.scaleBoundsPredicate(z,r.minScale||0,r.maxScale||0)};D.graphicScale=function(z){let r;p.isSome(z.centroid)?r=z.centroid:p.isSome(z.graphic.geometry)&&"point"===
z.graphic.geometry.type&&(r=z.graphic.geometry);return r?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(r):1:null};D.graphicVisible=function(z){if(!this.layerScaleEnabled)return!0;z=this.graphicScale(z);return this.visibleAtLayerScale(z)};D.updateVisibility=function(z){if(this._scaleRangeActive){const r=this.graphicVisible(z);return z.setVisibilityFlag(1,r,0)}return!1};D.updateGraphicLabelScaleVisibility=function(z){if(!this._scaleRangeActive||!z.labelGraphics||0===
z.labelGraphics.length)return!1;const r=this.graphicScale(z);if(z=this.updateLabelScaleVisibility(z,r))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return z};D.updateLabelScaleVisibility=function(z,r){if(!z.labelGraphics||0===z.labelGraphics.length)return!1;const C=z.labelGraphics[0]._labelClass;return C&&null!=C.minScale&&null!=C.maxScale&&(r=this.visibleAtLabelScale(r,C),z.setVisibilityFlag(1,r,1))?!0:!1};D.scaleUpdateHandler=function(z){this._setDirty();if(!this.layerView.suspended){var r=
z.extent,C=z.scale,A=this.visibleAtLayerScale(C),x=!1;this.queryGraphicUIDsInExtent(r,z.spatialReference,m=>{m=this.graphicsCore.getGraphics3DGraphicById(m);if(!p.isNone(m)){var B=m.centroid;p.isSome(B)&&(r[0]>B.x||r[1]>B.y||r[2]<B.x||r[3]<B.y)||(m.setVisibilityFlag(1,A,0)&&(x=!0),this.updateLabelScaleVisibility(m,C)&&(x=!0))}});x&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};D.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?
this.graphicsCore.modifyGraphics3DGraphicVisibilities(z=>z.clearVisibilityFlag(1)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};return y}(u);g.__decorate([c.property({constructOnly:!0})],b.prototype,"layerScaleEnabled",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"suspended",void 0);g.__decorate([c.property({readOnly:!0})],b.prototype,"updating",void 0);return b=g.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],
b)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(g,b,p){if(!p||null==b)return null;if(!g){a:{g=p.toLowerCase();for(var f in b)if(f.toLowerCase()===g){b=b[f];break a}b=null}return b}return(f=g.get(p))?b[f.name]:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../support/Scheduler ./ExtentSet".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){b=function(y){function D(){var r=y.apply(this,arguments)||this;r.dirtyExtents=new w.ExtentSet;r.globalDirty=!1;r.dirtyGraphicsSet=new Set;r.handles=new t;r.updateElevation=!1;r.layerView=null;r.graphicsCore=null;r.events=new v;return r}a._inheritsLoose(D,y);var z=D.prototype;z.setup=function(r,C,A,x){this.layerView=r;this.queryGraphicUIDsInExtent=C;this.graphicsCore=A;this.elevationProvider=x;r=this.layerView.view.resourceController.scheduler;this.handles.add([x.on("elevation-change",
m=>this._elevationChanged(m)),this.layerView.watch("suspended",()=>this.suspendedChange()),r.registerTask(l.Task.ELEVATION_ALIGNMENT,m=>this.update(m),()=>this.needsUpdate())])};z.destroy=function(){this.dirtyGraphicsSet.clear();this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};z.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};z.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===
this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};z.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};z.needsUpdate=function(){return 0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty};z.update=function(r){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,r.madeProgress());for(r.run(()=>this.dirtyExtents.merge(r));this.needsUpdate()&&!r.done;)this._updateDirtyGraphics(r),
this._updateDirtyExtents(r);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};z._updateDirtyGraphics=function(r){const C=this.layerView.view.renderCoordsHelper,A=this.graphicsCore.asyncUpdates;for(const x of this.dirtyGraphicsSet.keys()){const m=this.graphicsCore.getGraphics3DGraphicById(x);this.dirtyGraphicsSet.delete(x);p.isSome(m)&&(m.alignWithElevation(this.elevationProvider,C,A),r.madeProgress());if(r.done)break}};z._updateDirtyExtents=function(r){for(;!this.dirtyExtents.empty&&
!r.done;){const C=this.dirtyExtents.pop(),A=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:C,spatialReference:A});this.queryGraphicUIDsInExtent(C,A,x=>{const m=this.graphicsCore.getGraphics3DGraphicById(x);p.isSome(m)&&m.needsElevationUpdates()&&this.dirtyGraphicsSet.add(x)});r.madeProgress()}};z.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((r,C)=>this.dirtyGraphicsSet.add(C))};
z._elevationChanged=function(r){if("scene"!==r.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:C,spatialReference:A}=r;this.layerView.suspended?(this.updateElevation||(r=this.graphicsCore.computedExtent)&&C[2]>r.xmin&&C[0]<r.xmax&&C[3]>r.ymin&&C[1]<r.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:C,spatialReference:A})):(-Infinity===C[0]?this.globalDirty=!0:this.dirtyExtents.add(C),this.notifyChange("updating"))}};
a._createClass(D,[{key:"updating",get:function(){return this.needsUpdate()}}]);return D}(u);g.__decorate([c.property({readOnly:!0})],b.prototype,"updating",null);return b=g.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,
g,b,p,f){let k=function(){function c(){this.extents=new b({allocator:e=>e||p.create()});this.tempExtent=p.create();this.dirty=!1}var d=c.prototype;d.clear=function(){this.extents.clear()};d.add=function(e){this.contains(e)||(this.removeContained(e),p.set(this.extents.pushNew(),e),this.dirty=!0)};d.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};d.merge=function(e){this.mergeTight(e);return e.hasProgressed};d.mergeTight=function(e=f.noBudget){const h=this.extents,n=new Set;
let q=0;for(;q!==h.length;){h.sort((u,v)=>u[0]-v[0]);q=h.length;n.clear();for(let u=0;u<h.length;++u){if(e.done)return;const v=h.getItemAt(u);for(let t=u+1;t<h.length;++t){const l=h.getItemAt(t);if(l[0]>=v[2])break;n.add(l)}n.forEach(t=>{if(v!==t)if(t[2]<=v[0])n.delete(t);else{var l=p.area(v),w=p.area(t),y=this.tempExtent;p.expand(v,t,y);l+=w;.05>(p.area(y)-l)/l&&(p.set(v,y),n.delete(t),h.remove(t),e.madeProgress())}});n.add(v)}}this.dirty=!1};d.contains=function(e){return this.extents.some(h=>p.contains(h,
e))};d.removeContained=function(e){this.extents.filterInPlace(h=>!p.contains(e,h))};g._createClass(c,[{key:"empty",get:function(){return 0===this.extents.length}},{key:"test",get:function(){const e=this;return{containsPoint:h=>e.extents.some(n=>p.containsPoint(n,h))}}}]);return c}();a.ExtentSet=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../support/Scheduler ../../../layers/support/FeatureFilter ./QueryEngine ../support/floorFilterUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r){const C=k.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");a.Graphics3DFilterVisibility=function(A){function x(...B){B=A.call(this,...B)||this;B.filter=null;B._dirty=!1;B._querying=!1;B._handles=new l;return B}g._inheritsLoose(x,A);var m=x.prototype;m.setup=function(B,E){this._layerView=B;this._core=E;this._objectIdField=B.layer.objectIdField;this._queryEngine=new z["default"]({layerView:this._layerView,task:y.Task.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(y.Task.FILTER_VISIBILITY,F=>this._update(F),()=>this._needsUpdate()));this._handles.add(w.on(E.owner,"loadedGraphics","after-changes",F=>this._graphicsChanged(F),()=>this.dirty=!0));this.filterChanged()};m.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};m.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(B=>B.clearVisibilityFlag(2)),
this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};m._graphicsChanged=function(B){this._queryEngine&&0===(B.type&1)||(this.dirty=!0)};m.updateVisibility=function(B){this.active&&(B.hasVisibilityFlag(2,0)||B.setVisibilityFlag(2,!1,0),this.dirty=!0)};m.filterChanged=function(){const B=this.recomputeFilter();B!==this.filter&&(this.filter=B,this.dirty=!0)};m.recomputeFilter=function(){var B="filter"in this._layerView?this._layerView.filter:null;const E="timeExtent"in
this._layerView?this._layerView.timeExtent:null,F=r.getFloorFilterClause(this._layerView);if(f.isNone(E)&&f.isNone(F))return B;B=f.isSome(B)?B.clone():new D;f.isSome(E)&&(B.timeExtent=f.isSome(B.timeExtent)?B.timeExtent.intersection(E):E);f.isSome(F)&&(B.where=null==B.where||""===B.where?F:`(${B.where}) AND (${F})`);return B};m._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};m._update=function(B){this.active?(!this._dirty||this._querying||B.done||(this._querying=
!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(E=>{this._queryResult=E;this._querying=!1}).catch(E=>{v.isAbortError(E)||(C.warn("FeatureFilter query failed: "+E,{error:E}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach(F=>this._queryResult.add(this._getFeatureId(F.graphic))),this._querying=!1)}),B.madeProgress()),this._queryResult&&!B.done&&(this._core.modifyGraphics3DGraphicVisibilities(E=>{if(B.done)return!1;const F=this._queryResult.has(this._getFeatureId(E.graphic));
return E.setVisibilityFlag(2,F,0)?(B.madeProgress(),!0):!1}),B.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};m._getFeatureId=function(B){return null==B.objectId?B.attributes[this._objectIdField]:B.objectId};g._createClass(x,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"active",get:function(){return this.filter&&0<this._core.graphics3DGraphics.size}},{key:"dirty",set:function(B){this._dirty!==B&&(this._dirty=B,this.notifyChange("updating"))}}]);
return x}(t);b.__decorate([d.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"updating",null);a.Graphics3DFilterVisibility=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],a.Graphics3DFilterVisibility);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/floorFilterUtils":function(){define(["exports"],function(a){a.getFloorFilterClause=function(g){var b=g.layer;if("floorInfo"in b&&b.floorInfo){g=g.view.floors;if(!g||
!g.length)return null;g=g.filter(p=>""!==p).map(p=>`'${p}'`);g.push("''");b=b.floorInfo.floorField;return`${b} IN (${g.join(", ")}) OR ${b} IS NULL`}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ../../../../geometry/projectionEllipsoid ../../../../core/watchUtils ../../../support/Scheduler ../../support/FrustumExtentIntersection".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w){b=function(y){function D(){var r=y.apply(this,arguments)||this;r.suspended=!1;r.extent=null;r.extentIntersectionDirty=!0;r._isVisibleBelowSurface=!1;r.handles=new u;r.layerView=null;r.updating=!0;return r}a._inheritsLoose(D,y);var z=D.prototype;z.setup=function(r){this.layerView=r;this.extentIntersection=new w.FrustumExtentIntersection({renderCoordsHelper:r.view.renderCoordsHelper});r=r.view;const C=r.basemapTerrain,A=r.resourceController.scheduler;this.handles.add([r.on("resize",
()=>this.viewChange()),r.state.watch("camera",()=>this.viewChange(),!0),A.registerTask(l.Task.FRUSTUM_VISIBILITY,()=>this.update(),()=>this.updating),C.on("elevation-bounds-change",()=>this.elevationBoundsChange())]);"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([t.init(C,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),t.init(r,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])};z.destroy=function(){this.extentIntersection=this.extent=
this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};z._setDirty=function(){this.updating||this._set("updating",!0)};z.setExtent=function(r){this.extent=r;this.extentIntersectionDirty=!0;this._setDirty()};z.viewChange=function(){this._setDirty()};z.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};z.updateIsVisibleBelowSurface=function(){const r=this.layerView.view,C=r.basemapTerrain,A=r.map.ground&&r.map.ground.navigationConstraint&&"none"===
r.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===r.viewingMode||!C.opaque||A};z.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var r=this.layerView.view;if(this._isVisibleBelowSurface)var C=-.3*v.getReferenceEllipsoid(r.spatialReference).radius;else{const {min:A,max:x}=r.basemapTerrain.elevationBounds;C=A-Math.max(1,(x-A)*(1.2-1))}this.extentIntersection.update(this.extent,r.spatialReference,C)}};z.update=function(){this._set("updating",
!1);if(this.extent){this.updateExtentIntersection();var r=this.layerView.view.frustum,C=v.getReferenceEllipsoid(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(r,C))}else this._set("suspended",!1)};a._createClass(D,[{key:"isVisibleBelowSurface",set:function(r){this._isVisibleBelowSurface=r;this._setDirty();this.extentIntersectionDirty=!0}}]);return D}(q);g.__decorate([k.property({readOnly:!0})],b.prototype,"suspended",void 0);g.__decorate([k.property({readOnly:!0})],
b.prototype,"updating",void 0);return b=g.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],b)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,g,b,p){let f=function(){function k(d){this._graphicsCore=d;this._stateSets=[]}var c=k.prototype;c.destroy=function(){this._stateSets&&this._stateSets.forEach(d=>d.objectStateSet.removeAll());
this._stateSets=null};c.acquireSet=function(d,e){const h=new p.Graphics3DObjectStateSet(d,e);this._stateSets.push(h);d=b.makeHandle(()=>this.releaseSet(h));return{set:h,handle:d}};c.releaseSet=function(d){d.objectStateSet.removeAll();d=this._stateSets?this._stateSets.indexOf(d):-1;-1!==d&&this._stateSets.splice(d,1)};c._addObjectStateSet=function(d,e){d.addObjectStateSet(e.stateType,e.objectStateSet)};c._removeObjectStateSet=function(d,e){d.removeObjectState(e.objectStateSet)};c.setUid=function(d,
e){d.ids.add(e);(e=this._graphicsCore.graphics3DGraphics.get(e))&&this._addObjectStateSet(e,d)};c.setUids=function(d,e){e.forEach(h=>this.setUid(d,h))};c.setObjectIds=function(d,e){e.forEach(h=>d.ids.add(h));this.initializeSet(d)};c.addGraphic=function(d){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(d)&&this._addObjectStateSet(d,e)})};c.removeGraphic=function(d){this._stateSets.forEach(e=>{e.hasGraphic(d)&&this._removeObjectStateSet(d,e)})};c.allGraphicsDeleted=function(){this._stateSets&&
this._stateSets.forEach(d=>d.objectStateSet.removeAll())};c.initializeSet=function(d){const e=this._graphicsCore.graphics3DGraphics;d.objectIdField?e.forEach(h=>{h&&d.hasGraphic(h)&&this._addObjectStateSet(h,d)}):d.ids.forEach(h=>{(h=e.get(h))&&this._addObjectStateSet(h,d)})};g._createClass(k,[{key:"test",get:function(){return{states:this._stateSets}}}]);return k}();a.Graphics3DObjectStates=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports",
"../../webgl-engine/lib/Object3DStateSet"],function(a,g){let b=function(){function p(f,k){this.stateType=f;this.objectIdField=k;this.objectStateSet=new g.Object3DStateSet;this.ids=new Set;this.paused=!1}p.prototype.hasGraphic=function(f){return this.objectIdField?this.ids.has(f.graphic.attributes[this.objectIdField]):this.ids.has(f.graphic.uid)};return p}();a.Graphics3DObjectStateSet=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports"],
function(a){let g=function(){function b(){this.items=[]}var p=b.prototype;p.addObject=function(f,k){this.items.push({type:0,objectStateId:k,object:f})};p.addRenderGeometry=function(f,k,c){this.items.push({type:1,objectStateId:k,renderGeometry:f,owner:c})};p.addExternal=function(f,k){this.items.push({type:2,objectStateId:k,remove:f})};p.remove=function(f){for(let k=this.items.length-1;0<=k;--k){const c=this.items[k];c.objectStateId===f&&(this._removeObjectStateItem(c),this.items.splice(k,1))}};p.removeObject=
function(f){for(let k=this.items.length-1;0<=k;--k){const c=this.items[k];0===c.type&&c.object===f&&(this._removeObjectStateItem(c),this.items.splice(k,1))}};p.removeRenderGeometry=function(f){for(let k=this.items.length-1;0<=k;--k){const c=this.items[k];1===c.type&&c.renderGeometry===f&&(this._removeObjectStateItem(c),this.items.splice(k,1))}};p.removeAll=function(){this.items.forEach(f=>{this._removeObjectStateItem(f)});this.items=[]};p._removeObjectStateItem=function(f){switch(f.type){case 0:0===
f.objectStateId.channel?f.object.removeHighlight(f.objectStateId):1===f.objectStateId.channel&&f.object.removeOcclude(f.objectStateId);break;case 1:f.owner.removeRenderGeometryObjectState(f.renderGeometry,f.objectStateId);break;case 2:f.remove(f.objectStateId)}};return b}();a.Object3DStateSet=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,g,b,p,f){let k=function(){function c(e){this._capabilities=this._memoryCache=null;const h=e.layerView.layer;this.layerView=e.layerView;this.objectIdField=h.objectIdField;this.returnZ=e.returnZ;this.returnM=e.returnM;e=this.layerView.view.resourceController;this.query=f.createFeatureTileQuery3D(h,e.scheduler);e&&this.memoryCacheEnabled&&(this._memoryCache=e.memoryController.getMemCache(h.uid))}var d=c.prototype;d.destroy=function(){this._memoryCache=
b.destroyMaybe(this._memoryCache);this.query.destroy()};d.createQuery=function(){const e=this.layerView.layer.createQuery();e.outFields=this.layerView.availableFields;e.returnZ=this.returnZ;e.returnM=this.returnM;e.outSpatialReference=this.tilingScheme.spatialReference;return e};d.logFetchError=function(e,h){e.error("#fetchTile()",this.layerView.layer,h&&h.message?h.message:h)};g._createClass(c,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;
case "csv":case "geojson":case "memory":case "stream-layer":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.mode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},
{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return b.isSome(this._capabilities)?this._capabilities:this._capabilities=p.contextCapabilitiesFromLayer(this.layerView.layer)}}]);return c}();a.FeatureTileFetcher3DLayerViewContext=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/aliasOf ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../rest/query/operations/query ../../../../layers/graphics/dehydratedFeatures ../../support/PBFDecoder".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D){let z=function(A){function x(){return A.apply(this,arguments)||this}g._inheritsLoose(x,A);var m=x.prototype;m.queryFeatureCount=function(B,E){return this.layer.queryFeatureCount(B,E)};m.destroy=function(){this._decoder=f.destroyMaybe(this._decoder)};g._createClass(x,[{key:"queryFeaturesDehydrated",get:function(){var B=this.layer.capabilities;if((B=B&&B.query)&&B.supportsFormatPBF){var E,F;f.isNone(this._decoder)&&(this._decoder=new D.PBFDecoder(this.scheduler));
const G={sourceSpatialReference:null!=(E=null==(F=this.layer.spatialReference)?void 0:F.toJSON())?E:null,applyTransform:!0,maxStringAttributeLength:1024};return(I,K)=>w.runQuery(this.layer.parsedUrl,I,"pbf",K).then(J=>{t.throwIfAborted(K);return f.isSome(this._decoder)?this._decoder.invoke({buffer:J.data,options:G},K.signal):Promise.reject(t.createAbortError())})}return(G,I)=>w.executeQuery(this.layer.parsedUrl,G,this.layer.spatialReference,I).then(K=>y.fromFeatureSetJSON(K.data))}}]);return x}(l);
b.__decorate([d.property({constructOnly:!0})],z.prototype,"layer",void 0);b.__decorate([d.property({constructOnly:!0})],z.prototype,"scheduler",void 0);b.__decorate([d.property({readOnly:!0})],z.prototype,"queryFeaturesDehydrated",null);z=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],z);let r=function(A){function x(){return A.apply(this,arguments)||this}g._inheritsLoose(x,A);x.prototype.queryFeaturesDehydrated=function(m,B){return this.layer.queryFeatures(m,
B)};return x}(l);b.__decorate([d.property({constructOnly:!0})],r.prototype,"layer",void 0);r=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],r);let C=function(A){function x(){return A.apply(this,arguments)||this}g._inheritsLoose(x,A);var m=x.prototype;m.destroy=function(){};m.queryFeaturesDehydrated=function(B,E){return this.source.queryFeaturesJSON(B,E).then(y.fromFeatureSetJSON,F=>{if(F&&"query-features-json:unsupported"===F.name)return this.layer.queryFeatures(B,
E);throw F;})};m.queryFeatureCount=function(B,E){return this.layer.queryFeatureCount(B,E)};return x}(l);b.__decorate([d.property({constructOnly:!0})],C.prototype,"layer",void 0);b.__decorate([e.aliasOf("layer.source")],C.prototype,"source",void 0);C=b.__decorate([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],C);a.createFeatureTileQuery3D=function(A,x){switch(A.source.type){case "feature-layer":return new z({layer:A,scheduler:x});case "memory":case "csv":case "geojson":return new C({layer:A});
case "ogc-feature":return new r({layer:A});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/SpatialReference ../../../Graphic ../../support/Scheduler ../../../layers/support/Field ../../../core/workers/WorkerHandle".split(" "),function(a,g,b,p,f,k,c){let d=function(){function h(q){this._handle=
new e(q);this._frameTask=q.registerTask(f.Task.REMOTE_CLIENT,u=>this._frameTask.processQueue(u),()=>!1)}var n=h.prototype;n.destroy=function(){this._frameTask.remove();this._handle.destroy()};n.invoke=function(q,u){if(!q.buffer||0===q.buffer.byteLength)return Promise.resolve(null);q.options.sourceSpatialReference&&q.options.sourceSpatialReference instanceof b&&(q.options={...q.options,sourceSpatialReference:q.options.sourceSpatialReference.toJSON()});return this._handle.invoke(q,u).then(v=>this._frameTask.schedule(()=>
{v.spatialReference=b.fromJSON(v.spatialReference);if(v.fields)for(var t=0;t<v.fields.length;t++)v.fields[t]=k.fromJSON(v.fields[t]);t=v.spatialReference;for(const l of v.features)l.uid=p.generateUID(),l.geometry&&(l.geometry.spatialReference=t);return v}))};return h}(),e=function(h){function n(q){return h.call(this,"PBFDecoderWorker","_parseFeatureQuery",q)||this}g._inheritsLoose(n,h);n.prototype.getTransferList=function(q){return[q.buffer]};return n}(c.WorkerHandle);a.PBFDecoder=d;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/typedArrayUtil ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Collection ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../core/screenUtils ../../../core/asyncUtils ../../../chunks/vec3 ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../symbols/support/unitConversionUtils ../../../layers/support/PromiseQueue ../../support/Scheduler ../../../geometry/support/aaBoundingBox ../../support/layerViewUtils ../../../layers/graphics/dehydratedFeatures ../../../chunks/vec3f32 ../support/geometryUtils ../support/extentUtils ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/LayerView ../support/orientedBoundingBox ./i3s/I3SUtil ./PointCloudWorkerHandle ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O){const V=k.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ba=L.plane.create();b=function(ia){function ma(){var M=ia.apply(this,arguments)||this;M.maximumPointCount=4E6;M.slicePlaneEnabled=!1;M._renderer=null;M._rendererAdded=!1;M._renderedNodes=new Set;M._nodeScales=new Map;M._updateViewNeeded=!0;M._lodFactor=1;M._maxLoggedBoxWarnings=5;M._pageMultiplier=1;M._nodeLoadEpoch=0;M._indexQueue=
[];M._workQueue=[];M._idleQueue=new E;M._indexPagesLoading=new Map;M._loadingNodes=new Map;M._recalcWork=!0;M._layerIsVisible=!1;M._codedDomainPopulationPromise=null;M._codedDomainPopulationAbortController=null;M._totalWork=0;M._index=null;M._loadingInitNodePage=!1;M._nodeIdArray=[];return M}a._inheritsLoose(ma,ia);var ea=ma.prototype;ea.initialize=function(){var M=this.view.resourceController;const Z=M.scheduler;this._worker=new R.PointCloudWorkerHandle(Z);this.addResolvingPromise(this._worker.promise);
this._tmpPoint=K.makeDehydratedPoint(0,0,0,this.layer.spatialReference);H.checkPointCloudLayerValid(this.layer);H.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=M.createStreamDataRequester(2);this._dataRequester=M.createStreamDataRequester(3);this._initRenderer();M=this._initNodePages();const la=this.view.resourceController.memoryController;this._memCache=la.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),
2);this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2);this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2);this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2);this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2);this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded());this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view.state,
"contentCamera",()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",ka=>this._scaleUpdateHandler(ka)),la.events.on("quality-changed",()=>this._setUpdateViewNeeded())]);this.addResolvingPromise(M);this.when(()=>{this.handles.add([Z.registerTask(F.Task.POINT_CLOUD_LAYER,ka=>this._process(ka),()=>this._needsUpdate()),Z.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",ka=>{ka?this._clearNodeState():
this._setUpdateViewNeeded()},2)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};ea._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};ea.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=
null};ea._initRenderer=function(){this._renderer=new ca.PointRenderer({createGraphic:(M,Z,la)=>this._createGraphic(M,Z,la)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",M=>this._renderer.clippingBox=M,2);this.updatingHandles.add(this,"suspended",M=>this._setPointsVisible(!M),2);this.updatingHandles.add(this,"pointScale",M=>this._renderer.scaleFactor=M,2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",M=>this._renderer.useRealWorldSymbolSizes=
M,2);this.updatingHandles.add(this,"pointSize",M=>{const Z=z.pt2px(M);this._renderer.size=M;this._renderer.sizePx=Z},2);this.updatingHandles.add(this,"slicePlaneEnabled",M=>this._renderer.slicePlane=M,2);this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",M=>{this._lodFactor=M;this._setUpdateViewNeeded()},
2)};ea._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};ea._createGraphic=function(M,Z,la){const ka=f.isSome(M.pointIdFilterMap)?M.pointIdFilterMap[Z]:Z;la=this.view.computeMapPointFromVec3d(la);const ha=this._createGraphicAttributes(M,ka);return new N.PointGraphic({pointCloudMetadata:{nodeId:M.id,pointIndexInNode:Z,attributePointIndexInNode:ka,epoch:this._nodeLoadEpoch},geometry:la,attributes:ha,layer:this.layer,sourceLayer:this.layer})};ea._createGraphicAttributes=
function(M,Z){const la={};for(const ka of M.attributes)this._encodeGraphicAttribute(ka.attributeInfo,ka.values,Z,la);return la};ea._encodeGraphicAttribute=function(M,Z,la,ka){var ha=M.storageInfo&&M.storageInfo.attributeValues;const na=ha?ha.valuesPerElement:1;if(1===na)ka[M.name]=Z[la];else if("UInt8"===ha.valueType&&4>=na){ha=0;la*=na;for(let da=la;da<la+na;da++)ha=(ha<<8)+Z[da];ka[M.name]=ha}else ka[M.name]=void 0};ea._setPointsVisible=function(M){M&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],
this._renderer),this._rendererAdded=!0):!M&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};ea._rendererChanged=function(){this._renderer.useFixedSizes=Y.rendererUsesFixedSizes(this.layer.renderer);this._reload()};ea._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};ea._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};ea._scaleUpdateHandler=function(M){this.layer.minScale||
this.layer.maxScale?m.projectBoundingRect(M.extent,M.spatialReference,fa,this.layer.spatialReference)&&(this._nodeScales.forEach((Z,la)=>{this._renderedNodes.has(la)?(Z=this._index.getNode(la),x.containsPoint(fa,Z.obb.center)&&this._nodeScales.set(la,M.scale)):this._nodeScales.delete(la)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};ea.displayNodes=function(M){this._workQueue=T.nodeDiff([...this._renderedNodes],M,this._index);T.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,
this._index);T.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<M.length||this._loadingInitNodePage;this.notifyChange("suspended")};ea.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};ea._cancelNodeLoading=function(){const M=[];this._loadingNodes.forEach(({abortController:Z})=>M.push(Z));this._loadingNodes.clear();for(const Z of M)Z.abort();this._workQueue=[];this._idleQueue.cancelAll();
this._totalWork=this._computeWork();this._updateLoading()};ea._updateQueues=function(){const M=new Set;this._workQueue.forEach(ka=>ka.load.forEach(ha=>M.add(ha)));const Z=[],la=new Map;this._loadingNodes.forEach((ka,ha)=>{M.has(ha)?la.set(ha,ka):Z.push(ka)});this._loadingNodes=la;for(const {abortController:ka}of Z)ka.abort();this._workQueue=this._workQueue.filter(ka=>{for(const ha of ka.load)if(this._loadingNodes.has(ha))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();
this._updateLoading()};ea._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:M})=>M.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};ea._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(M=>this._removeFromRenderer(M));this._cancelNodeLoading()};ea._idleBegin=function(){this._setUpdateViewNeeded()};ea._idleEnd=function(){this._setUpdateViewNeeded()};ea._needsUpdate=function(){return this.suspended?
this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};ea._process=function(M){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,M=this._isRootNodeVisible(),M!==this._layerIsVisible&&(this._layerIsVisible=M,this.notifyChange("suspended")),this._updateLoading());else{for(M.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&M.run(()=>this._processIndexQueue()););for(this._processWorkQueue(M);0<this._idleQueue.length&&
M.run(()=>this._idleQueue.process()););}};ea._processIndexQueue=function(){const M=this._indexQueue.shift(),Z=this._loadNodePage(M);this._indexPagesLoading.set(M,Z);Z.promise.then(la=>{this._index.addPage(M,la,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(M)},()=>{this._indexPagesLoading.delete(M)});return!0};ea._processWorkQueue=function(M){for(;!M.done;){const Z=this._scheduleWorkEntry();if(f.isNone(Z))break;this._processWorkEntry(Z);M.madeProgress()}};
ea._scheduleWorkEntry=function(){let M=this._workQueue.length;for(;M--;){const Z=this._workQueue.shift();if(Z.remove.find(la=>!this._renderedNodes.has(la)))this._workQueue.push(Z);else return Z}return null};ea._processWorkEntry=function(M){if(0===M.load.length)for(const Z of M.remove)this._removeFromRenderer(Z);else Promise.all(M.load.map(Z=>{const la=v.createAbortController(),ka=this._memCache.pop(Z.toString());f.isSome(ka)?this._loadingNodes.set(Z,{abortController:la,promise:Promise.resolve(ka)}):
this._loadingNodes.has(Z)||this._loadingNodes.set(Z,{abortController:la,promise:this.loadNode(Z,la.signal)});return this._loadingNodes.get(Z).promise})).then(Z=>{for(let la=0;la<M.load.length;la++)if(Z[la]){const ka=this._setupRendererData(M.load[la],Z[la]);this._addToRenderer(ka)}for(const la of M.remove)this._removeFromRenderer(la)}).catch(()=>{}).then(()=>{for(const Z of M.load)this._loadingNodes.delete(Z);this._updateLoading();this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&
0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};ea.populateClassCodeCodedDomain=async function(M,Z){const la=this.layer.fieldsIndex.get("CLASS_CODE");la&&!la.domain&&-1!==M.indexOf(la.name)&&(M=await r.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:Z})),!1!==M.ok&&(M=(M=M.value)&&M.labels&&M.labels.labels)&&Array.isArray(M)&&(la.domain=new w({name:"CLASS_CODE",codedValues:M.map(ka=>new l["default"]({code:ka.value,name:ka.label}))})))};
ea.prepareFetchPopupFeatures=async function(M){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=v.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(M,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise};ea.whenGraphicAttributes=async function(M,Z){const la=this._splitGraphicsPerNode(M),ka=this.layer.attributeStorageInfo,ha=
Z.map(oa=>Y.getAttributeInfo(ka,oa)),na=async(oa,qa)=>{const ua=this._index.getNode(qa);await r.forEach(ha,async Ca=>{const Ja=Ca.useElevation?await this._loadElevationAttributeFromGeometry(ua.resourceId):await this._loadAndParseAttribute(ua,Ca);if(Ja)for(const Ha of oa)this._isValidPointGraphic(Ha)&&this._encodeGraphicAttribute(Ca,Ja,Ha.pointCloudMetadata.attributePointIndexInNode,Ha.attributes)})},da=[];la.forEach((oa,qa)=>{da.push(na(oa,qa))});await v.eachAlways(da);return M};ea._isValidPointGraphic=
function(M){return M instanceof N.PointGraphic&&M.pointCloudMetadata&&M.pointCloudMetadata.epoch===this._nodeLoadEpoch};ea._splitGraphicsPerNode=function(M){const Z=new Map;for(const la of M){if(!this._isValidPointGraphic(la))continue;M=la.pointCloudMetadata;const ka=Z.get(M.nodeId);ka?ka.push(la):Z.set(M.nodeId,[la])}return Z};ea._loadAndParseAttribute=async function(M,Z){const la=await this._loadAttribute(M.resourceId,Z,null);return f.isSome(la)?U.getAttributeValues({attributeInfo:Z,buffer:la},
null,M.vertexCount):null};ea._loadElevationAttributeFromGeometry=async function(M){M=U.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(M,null));return U.elevationFromPositions(M,M.length/3)};ea.highlight=function(M){if(!M)return{remove(){}};M=t.isCollection(M)?M.toArray():Array.isArray(M)?M:[M];return this._renderer.highlight(M.map(Z=>this._graphicToPointDefinition(Z)))};ea._graphicToPointDefinition=function(M){if(!this._isValidPointGraphic(M))return null;const {nodeId:Z,
pointIndexInNode:la}=M.pointCloudMetadata;return null!=Z&&null!=la?{nodeId:Z,pointId:la}:null};ea._computeWork=function(){let M=0;for(const Z of this._workQueue)M+=Z.load.length+Z.remove.length;M+=this._loadingNodes.size;M+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;M+=this._loadingInitNodePage?100:0;return M+=this._updateViewNeeded?100:0};ea._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};ea.canResume=function(){return ia.prototype.canResume.call(this)&&
this._layerIsVisible};ea.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};ea._initNodePages=function(){const M=this.layer.store.index;this._index=new W(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,M.nodesPerPage||M.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=
null!=M.nodesPerPage?1:M.nodePerIndexBlock;return this._loadNodePage(0).promise.then(Z=>{this._index.addPage(0,Z,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};ea._loadNodePage=function(M){const Z=v.createAbortController();return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${M*this._pageMultiplier}`,Z.signal).then(la=>la.nodes.map((ka,ha)=>({resourceId:null!=ka.resourceId?ka.resourceId:M*this._index.pageSize+ha,obb:ka.obb,firstChild:ka.firstChild,childCount:ka.childCount,
vertexCount:null!=ka.vertexCount?ka.vertexCount:ka.pointCount,lodThreshold:null!=ka.lodThreshold?ka.lodThreshold:ka.effectiveArea}))),abortController:Z}};ea._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let M=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const Z=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let la=this._computeNodesForMinimumDensity(M),ka=this._computePointCount(la),ha=Math.sqrt(ka/(.75*Z));for(;ka>Z;)M*=ha,la=this._computeNodesForMinimumDensity(M),
ka=this._computePointCount(la),ha=Math.sqrt(2);this.displayNodes(la);this._updateViewNeeded=!1;this._updateLoading();return!0};ea._computePointCount=function(M){let Z=0;for(let la=0;la<M.length;la++){const ka=this._index.getNode(M[la]);ka&&(Z+=ka.vertexCount)}return Z};ea._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};ea._isRootNodeVisible=function(){let M=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},
{predicate:(Z,la,ka)=>{M=ka;return!1},pageMiss:()=>{}});return M};ea._computeNodesForMinimumDensity=function(M){const Z=this.view.state.contentCamera,la=Z.frustum,ka=this._clippingBox,ha=Z.viewForward,na=C.dot(ha,Z.eye),da=L.plane.fromNormalAndOffset(ha,-na,ba),oa=Z.perScreenPixelRatio/2,qa=M*M,ua=this._nodeIdArray;ua.length=0;const {minScale:Ca,maxScale:Ja}=I.extractSafeScaleBounds(this.layer),Ha=0===Ca&&0===Ja?Na=>ua.push(Na):Na=>{const Oa=this._getScale(Na);I.scaleBoundsPredicate(Oa,Ca,Ja)&&ua.push(Na)};
this._traverseVisible({frustum:la,clippingBox:ka},{predicate:(Na,Oa,Va)=>{if(!Va)return!1;if(0===Oa.childCount)return Ha(Na),!1;Va=this._index.getRenderObb(Na);return this._computeAveragePixelArea(Va,Oa.lodThreshold,Oa.vertexCount,da,oa)<=qa?(Ha(Na),!1):!0},pageMiss:(Na,Oa)=>{Ha(Na);0>this._indexQueue.indexOf(Oa)&&this._indexQueue.push(Oa)}});return ua};ea._getScale=function(M){var Z=this._nodeScales.get(M);null==Z&&(Z=this._index.getNode(M).obb.center,this._tmpPoint.x=Z[0],this._tmpPoint.y=Z[1],
this._tmpPoint.z=Z[2],Z=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(M,Z));return Z};ea._computeAveragePixelArea=function(M,Z,la,ka,ha){M=Math.max(1E-7,S.minimumDistancePlane(M,ka));return Z/(M*M)/(4*ha*ha)/la};ea.loadNode=function(M,Z){try{return this.loadNodeAsync(M,Z)}catch(la){throw v.isAbortError(la)||V.error(la),la;}};ea.loadAdditionalUserAttributes=async function(M,Z,la){var ka=this.layer.outFields;if(!ka)return[];ka=D.unpackFieldNames(this.layer.fields,ka);M=new Set(M.map(da=>
f.isSome(da)?da.name:null));const ha=this.layer.attributeStorageInfo,na=[];for(const da of ka)M.has(da)||(ka=Y.getAttributeInfo(ha,da))&&na.push(Z(ka));Z=await v.eachAlwaysValues(na);v.throwIfAborted(la);return f.mapSome(Z,da=>da)};ea.loadNodeAsync=async function(M,Z){const la=this._index.getNode(M),ka=Y.getRendererInfo(this.layer),ha=Y.getFilterInfo(this.layer),na=la.resourceId,da=async oa=>{if(f.isNone(oa))return null;if(oa.useElevation)return{attributeInfo:oa,buffer:null};const qa=await this._loadAttribute(na,
oa,Z);return f.isSome(qa)?{attributeInfo:oa,buffer:qa}:null};return this._idleQueue.push(async()=>{var oa=this._loadGeometry(na,Z);const {primaryAttribute:qa,modulationAttribute:ua}=ka,Ca=da(qa),Ja=da(ua);var Ha=ha.map(Pa=>Pa.attributeInfo);const Na=Ha.map(Pa=>da(Pa));Ha=this.loadAdditionalUserAttributes([qa,ua,...Ha],da,Z);const [Oa,Va,Ka,wa,Ea]=await Promise.all([oa,Ca,Ja,Promise.all(Na),Ha]);v.throwIfAborted(Z);oa={geometryBuffer:Oa,primaryAttributeData:Va,modulationAttributeData:Ka,filterAttributesData:wa,
userAttributesData:Ea,schema:this.layer.store.defaultGeometrySchema,rendererInfo:ka,filterInfo:ha,obb:this._index.getRenderObb(M),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(oa,Z)},Z)};ea._loadGeometry=async function(M,Z){return this._requestData(`${this.baseUrl}/nodes/${M}/geometries/0`,Z)};ea._loadAttribute=async function(M,Z,la){return f.isNone(Z)||!Z.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${M}/attributes/${Z.storageInfo.key}`,
la)};ea._requestNodePage=function(M,Z){return this._indexRequester.request(M,"json",{query:{f:"json"},signal:Z})};ea._requestData=function(M,Z){return this._dataRequester.request(M,"binary",{signal:Z})};ea._removeFromRenderer=function(M){if(this._renderedNodes.has(M)){const Z=this._renderer.removeNode(M);this._renderedNodes.delete(M);this._nodeScales.delete(M);this._memCache.put(Z.id.toString(),Z,5*Z.coordinates.length+128)}};ea._addToRenderer=function(M){this._renderedNodes.has(M.id)||(this._renderedNodes.add(M.id),
this._renderer.addNode(M))};ea._setupRendererData=function(M,Z){const la=this._index.getNode(M),ka=Math.sqrt(la.lodThreshold/la.vertexCount),ha=this._index.getRenderObb(M);if(ca.PointRenderer.isInstanceOfNode(Z))return Z.splatSize=ka,Z.obb=ha,Z.origin=J.clone(Z.obb.center),Z;if(Z.obb.halfSize[0]>1.001*ha.halfSize[0]||Z.obb.halfSize[1]>1.001*ha.halfSize[1]||Z.obb.halfSize[2]>1.001*ha.halfSize[2]){if(0<this._maxLoggedBoxWarnings){const na=da=>`[${da.halfSize[0]}, ${da.halfSize[1]}, ${da.halfSize[2]}]`;
V.warn(`Node ${M} reported bounding box too small. got ${na(ha)} but points cover ${na(Z.obb)}`);0===--this._maxLoggedBoxWarnings&&V.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(M,Z.obb)}return{id:M,coordinates:Z.points,origin:J.clone(ha.center),rgb:Z.rgb,attributes:Z.attributes,pointIdFilterMap:Z.pointIdFilterMap,highlights:null,splatSize:ka,obb:ha,isLeaf:0===la.childCount}};ea.getUsedMemory=function(){let M=0;this._renderer.forEachNode(Z=>{M+=
160;M+=p.estimateSize(Z.coordinates);for(const la of Z.attributes)Z=la.values,p.isArrayBuffer(Z.buffer)&&(M+=p.estimateSize(Z))});return M};ea.getUnloadedMemory=function(){var M=this._renderedNodes.size;if(4>M)return 0;const Z=[...this._renderedNodes].reduce((ha,na)=>ha+this._index.getNode(na).vertexCount);let la=this._loadingNodes.size;for(var ka=0;ka<this._workQueue.length;ka++)la+=this._workQueue[ka].load.length,la-=this._workQueue[ka].remove.length;if(0>la)return 0;ka=la*Z/M;M=(this.getUsedMemory()-
160*M)/Z;return ka*M+160*la};ea.ignoresMemoryFactor=function(){return!1};a._createClass(ma,[{key:"pointScale",get:function(){const M=Y.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return M&&null!=M.scaleFactor?M.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const M=Y.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return M&&null!=M.useRealWorldSymbolSizes?M.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const M=Y.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);
return M&&null!=M.size?M.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var M=Y.getRendererInfo(this.layer);const Z=new Set;M.primaryAttribute&&Z.add(M.primaryAttribute.name);M.modulationAttribute&&Z.add(M.primaryAttribute.name);if(M=Y.getFilterInfo(this.layer))for(const la of M)Z.add(la.attributeInfo.name);if(this.layer.outFields)for(const la of D.unpackFieldNames(this.layer.fields,
this.layer.outFields))Z.add(la);return Array.from(Z)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const M=G.create();return P.projectToBoundingBox(this.view.clippingArea,M,this.view.renderSpatialReference)?M:null}},{key:"_elevationOffset",get:function(){const M=this.layer&&this.layer.elevationInfo;if(M&&"absolute-height"===M.mode){const Z=A.getMetersPerVerticalUnitForSR(this.layer.spatialReference),la=B.getMetersPerUnit(M.unit);return f.unwrapOr(M.offset,
0)*la/Z}return 0}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const M=this._computeWork();return 1-Math.min(this._totalWork,M)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((M,Z)=>M+this._index.getNode(Z).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,
"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ma}(O.PopupSceneLayerView(Q.LayerView3D(aa)));g.__decorate([d.property()],b.prototype,"layer",void 0);g.__decorate([d.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],b.prototype,"baseUrl",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"pointScale",null);g.__decorate([d.property({readOnly:!0})],
b.prototype,"useRealWorldSymbolSizes",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"pointSize",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"inverseDensity",null);g.__decorate([d.property()],b.prototype,"maximumPointCount",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"availableFields",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"_clippingBox",null);g.__decorate([d.property({readOnly:!0})],b.prototype,"_elevationOffset",null);g.__decorate([d.property({type:Boolean})],
b.prototype,"slicePlaneEnabled",void 0);g.__decorate([d.property()],b.prototype,"updating",void 0);g.__decorate([d.property(X.updatingProgress)],b.prototype,"updatingProgress",void 0);g.__decorate([d.property({readOnly:!0})],b.prototype,"updatingProgressValue",null);b=g.__decorate([h.subclass("esri.views.3d.layers.PointCloudLayerView3D")],b);const fa=x.create();return b})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../core/has ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/Error ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../request ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../tasks/support/Query ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../chunks/quat ../../../../geometry/support/aaBoundingBox ../support/edgeUtils ../../webgl-engine/lib/Texture ../support/symbolColorUtils ../../../../chunks/quatf32 ../../support/orientedBoundingBox ./I3SBinaryReader ./I3SProjectionUtil".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E){function F(M){return M&&parseInt(M.substring(M.lastIndexOf("/")+1,M.length),10)}function G(M,Z){var la=Z[0],ka=Z[1];Z=Z[3];const ha=M[0]-la;la-=M[2];const na=M[1]-ka;M=ka-M[3];ka=Math.max(ha,la,0);const da=Math.max(na,M,0);ka=ka*ka+da*da;return ka>Z*Z?0:0<ka?1:-Math.max(ha,la,na,M)>Z?3:2}function I(M,Z,la){const ka=[],ha=la&&la.missingFields;la=la&&la.originalFields;for(const na of M){M=na.toLowerCase();let da=!1;for(const oa of Z)if(M===
oa.name.toLowerCase()){ka.push(oa.name);da=!0;la&&la.push(na);break}!da&&ha&&ha.push(na)}return ka}function K(M,Z,la){const ka=new Map,ha=[];la=la();for(const oa of M){var na=oa.attributes[Z];for(var da=0;da<la.length;da++){M=la[da];const qa=M.featureIds.indexOf(na);if(0<=qa){na=ka.get(M.node);na||(na={node:M.node,indices:[],graphics:[]},ha.push(na),ka.set(M.node,na));na.indices.push(qa);for(na.graphics.push(oa);0<da;da--)la[da]=la[da-1];la[0]=M;break}}}return ha}async function J(M,Z,la,ka){Z.sort((da,
oa)=>da.attributes[la]-oa.attributes[la]);var ha=Z.map(da=>da.attributes[la]);const na=[];ka=I(ka,M.fields,{originalFields:na});M=await L(M,ha,ka);for(ha=0;ha<Z.length;ha++){const da=Z[ha],oa=M[ha],qa={};if(da.attributes)for(const ua in da.attributes)qa[ua]=da.attributes[ua];for(let ua=0;ua<na.length;ua++)qa[na[ua]]=oa[ka[ua]];da.attributes=qa}return Z}function L(M,Z,la){var ka=M.capabilities.query.maxRecordCount;if(null!=ka&&Z.length>ka)return ka=k.splitIntoChunks(Z,ka),Promise.all(ka.map(ha=>L(M,
ha,la))).then(k.flatten);ka=new l({objectIds:Z,outFields:la,orderByFields:[M.objectIdField]});return M.queryFeatures(ka).then(ha=>{if(ha&&ha.features&&ha.features.length===Z.length)return ha.features.map(na=>na.attributes);throw new f("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function P(M,Z,la,ka,ha){const na=[];for(const da of Z)da&&-1!==ha.indexOf(da.name)&&na.push({url:`${M}/nodes/${la.resources.attributes}/attributes/${da.key}/0`,storageInfo:da});
return c.eachAlways(na.map(da=>h(da.url,{responseType:"array-buffer"}).then(oa=>B.readBinaryAttribute(da.storageInfo,oa.data)))).then(da=>{const oa=[];for(const qa of ka){const ua={};for(let Ca=0;Ca<da.length;Ca++)null!=da[Ca].value&&(ua[na[Ca].storageInfo.name]=Q(da[Ca].value,qa));oa.push(ua)}return oa})}function Q(M,Z){if(!M)return null;Z=M[Z];return b.isInt16Array(M)?-32768===Z?null:Z:b.isInt32Array(M)?Z===Y?null:Z:Z!==Z?null:Z}function X(M){var Z=M.store.indexCRS||M.store.geographicCRS;const la=
void 0===Z?M.store.indexWKT:void 0;if(la)if(M.spatialReference){if(la!==M.spatialReference.wkt)throw new f("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new f("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});Z=Z?new d(F(Z)):M.spatialReference;return Z.equals(M.spatialReference)?
M.spatialReference:Z}function aa(M){var Z=M.store.vertexCRS||M.store.projectedCRS;const la=void 0===Z?M.store.vertexWKT:void 0;if(la)if(M.spatialReference){if(la!==M.spatialReference.wkt)throw new f("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new f("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",
{});Z=Z?new d(F(Z)):M.spatialReference;return Z.equals(M.spatialReference)?M.spatialReference:Z}function S(M,Z,la){if(!e.canProject(M,Z))throw new f("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===la&&M.isGeographic)throw new f("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function H(M,Z,la){const ka=X(M);M=aa(M);S(ka,Z,la);S(M,
Z,la)}function R(M,Z,la,ka,ha=0){if(ka===q.getSphericalPCPF(ka))if(Z.isGeographic){var na=q.getReferenceEllipsoid(Z);ka=1+Math.max(0,ha)/(na.radius+M.center[2]);n.set(la.center,M.center[0],M.center[1],M.center[2]+ha);t.projectBuffer(la.center,Z,0,la.center,q.getSphericalPCPF(Z),0,1);D.copy(la.quaternion,M.quaternion);D.conjugate(ca,M.quaternion);n.set(ia,0,0,1);n.transformQuat(ia,ia,ca);n.set(ia,M.halfSize[0]*Math.abs(ia[0]),M.halfSize[1]*Math.abs(ia[1]),M.halfSize[2]*Math.abs(ia[2]));n.scale(ia,
ia,na.inverseFlattening);n.add(la.halfSize,M.halfSize,ia);n.scale(la.halfSize,la.halfSize,ka)}else{{m.corners(M,O);n.set(la.center,M.center[0],M.center[1],M.center[2]+ha);t.computeLinearTransformation(Z,la.center,N,q.getSphericalPCPF(Z));n.set(la.center,N[12],N[13],N[14]);ka=2*Math.sqrt(1+N[0]+N[5]+N[10]);ca[0]=(N[6]-N[9])/ka;ca[1]=(N[8]-N[2])/ka;ca[2]=(N[1]-N[4])/ka;ca[3]=.25*ka;D.multiply(la.quaternion,ca,M.quaternion);D.conjugate(ca,la.quaternion);let da=ka=M=0;for(na of O)na[2]+=ha,t.projectBuffer(na,
Z,0,na,q.getSphericalPCPF(Z),0,1),n.sub(ia,na,la.center),n.transformQuat(ia,ia,ca),M=Math.max(M,Math.abs(ia[0])),ka=Math.max(ka,Math.abs(ia[1])),da=Math.max(da,Math.abs(ia[2]));n.set(la.halfSize,M,ka,da)}}else M===la?(la.center[2]+=ha,t.projectBuffer(la.center,Z,0,la.center,ka,0,1)):(n.set(la.center,M.center[0],M.center[1],M.center[2]+ha),t.projectBuffer(la.center,Z,0,la.center,ka,0,1),D.copy(la.quaternion,M.quaternion),n.copy(la.halfSize,M.halfSize))}const T=z.create(),W=y.create(),Y=-(2**31);y=
r.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let U=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const N=w.create(),ca=x.create(),O=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],V=v.create(),ba=v.create(),fa=m.create(),ia=[0,0,0],ma={data:Array(72),size:3},ea=w.create();a.SymbolInfo=U;a.addWraparound=function(M,Z){return(M|0)+(Z|0)|0};a.checkPointCloudLayerCompatibleWithView=function(M,Z){S(M.spatialReference,Z.spatialReference,Z.viewingMode)};
a.checkPointCloudLayerValid=function(M){var Z;(Z=null==M.store||null==M.store.defaultGeometrySchema)||(M=M.store.defaultGeometrySchema,Z=!!(null==M.geometryType||"points"!==M.geometryType||null!=M.topology&&"PerAttributeArray"!==M.topology||null!=M.encoding&&""!==M.encoding&&"lepcc-xyz"!==M.encoding||null==M.vertexAttributes||null==M.vertexAttributes.position));if(Z)throw new f("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=
function(M,Z){H(M,Z.spatialReference,Z.viewingMode)};a.checkSceneLayerValid=function(M){var Z;(Z=null==M.store||null==M.store.defaultGeometrySchema)||(Z=M.store.defaultGeometrySchema,Z=!!(null!=Z.geometryType&&"triangles"!==Z.geometryType||null!=Z.topology&&"PerAttributeArray"!==Z.topology||null==Z.vertexAttributes||null==Z.vertexAttributes.position));if(Z)throw new f("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:M.parsedUrl.path});};a.checkSpatialReference=
S;a.checkSpatialReferences=H;a.computeVisibilityObb=function(M,Z,la,ka,ha,na){if(!na||0===na.length||p.isNone(Z))return null;const da=E.computeGlobalTransformation(M.mbs,ha,la,Z);u.invert(ea,da);let oa;const qa=()=>{if(!oa)if(oa=O,v.empty(ba),p.isSome(M.serviceObb)){R(M.serviceObb,la,fa,Z,ha);m.corners(fa,oa);for(var Ha of oa)n.transformMat4(Ha,Ha,ea),v.expandPointInPlace(ba,Ha)}else{var Na=M.mbs;Ha=Na[3];t.projectVectorToVector(Na,la,ia,Z);n.transformMat4(ia,ia,ea);ia[2]+=ha;for(Na=0;8>Na;++Na){const Oa=
oa[Na];n.copy(Oa,[ia[0]+(Na&1?Ha:-Ha),ia[1]+(Na&2?Ha:-Ha),ia[2]+(Na&4?Ha:-Ha)]);v.expandPointInPlace(ba,Oa)}}};let ua=Infinity,Ca=-Infinity;const Ja=Ha=>{if("replace"===Ha.type&&(Ha=Ha.geometry,Ha.hasZ)){v.empty(V);var Na=Ha.spatialReference||ka;Ha=Ha.rings.reduce((Oa,Va)=>Va.reduce((Ka,wa)=>{t.projectVectorToVector(wa,Na,ia,Z);n.transformMat4(ia,ia,ea);v.expandPointInPlace(V,ia);return Math.min(ia[2],Ka)},Oa),Infinity);qa();v.intersects(ba,V)&&(ua=Math.min(ua,Ha),Ca=Math.max(Ca,Ha))}};na.forEach(Ha=>
Ja(Ha));if(Infinity===ua)return null;na=(Ha,Na,Oa)=>{n.transformMat4(ia,Oa,da);Ha[Na+0]=ia[0];Ha[Na+1]=ia[1];Ha[Na+2]=ia[2];Na+=24;Oa[2]=ua;n.transformMat4(ia,Oa,da);Ha[Na+0]=ia[0];Ha[Na+1]=ia[1];Ha[Na+2]=ia[2];Na+=24;Oa[2]=Ca;n.transformMat4(ia,Oa,da);Ha[Na+0]=ia[0];Ha[Na+1]=ia[1];Ha[Na+2]=ia[2]};for(let Ha=0;8>Ha;++Ha)na(ma.data,3*Ha,oa[Ha]);return m.compute(ma)};a.containsDraco=function(M){if(g("disable-feature:i3s-draco")||!M)return!1;for(const Z of M)for(const la of Z.geometryBuffers)if("draco"===
la.compressedAttributes.encoding)return!0;return!1};a.encodingToMimeType=function(M){switch(M){case 1:return C.Texture.BASIS_ENCODING;case 2:return C.Texture.DDS_ENCODING;case 4:return"image/png";case 8:return"image/jpeg";case 16:return"image/ktx";default:return""}};a.extractWkid=F;a.filterInPlace=function(M,Z,la){let ka=0,ha=0;for(let na=0;na<Z.length&&ka<M.length;na++)M[ka]===Z[na]&&(la(na)&&(M[ha]=M[ka],ha++),ka++);M.length=ha};a.findFieldsCaseInsensitive=I;a.findIntersectingNodes=function(M,Z,
la,ka,ha,na){ha.traverse(la,da=>{var oa=da.mbs;Z!==ka&&(oa=W,t.projectBoundingSphere(da.mbs,ka,oa,Z));oa=G(M,oa);if(0===oa)return!1;na(da,oa);return!0})};a.getCacheKeySuffix=function(M,Z){return p.isNone(Z)?"@null":Z===q.getSphericalPCPF(Z)?"@ECEF":M.equals(Z)?"":null!=Z.wkid?"@"+Z.wkid:null};a.getCachedAttributeValue=Q;a.getClipAABB=function(M,Z){if(0===Z.rotationScale[1]&&0===Z.rotationScale[2]&&0===Z.rotationScale[3]&&0===Z.rotationScale[5]&&0===Z.rotationScale[6]&&0===Z.rotationScale[7])return T[0]=
(M[0]-Z.position[0])/Z.rotationScale[0],T[1]=(M[1]-Z.position[1])/Z.rotationScale[4],T[2]=(M[2]-Z.position[2])/Z.rotationScale[8],T[3]=(M[3]-Z.position[0])/Z.rotationScale[0],T[4]=(M[4]-Z.position[1])/Z.rotationScale[4],T[5]=(M[5]-Z.position[2])/Z.rotationScale[8],T};a.getIndexCrs=X;a.getSupportedEncodings=function(M){const Z=M._stage.renderView.has(1);M=M._stage.renderView.has(0);const la=g("disable-feature:i3s-basis")?0:1;return 12|(Z?la|2:0)|(M?la:0)};a.getSymbolInfo=function(M){const Z=new U;
var la=!1;let ka=!1;for(const na of M.symbolLayers.items)if("fill"===na.type&&na.enabled){var ha=na.material;M=na.edges;p.isSome(ha)&&!la&&(la=ha.color,ha=A.parseColorMixMode(ha.colorMixMode),p.isSome(la)?Z.material={color:[la.r/255,la.g/255,la.b/255],alpha:la.a,colorMixMode:ha}:Z.material={color:[1,1,1],alpha:1,colorMixMode:1},Z.castShadows=na.castShadows,la=!0);p.isSome(M)&&!ka&&(Z.edgeMaterial=r.createMaterialFromEdges(M,{}),ka=!0)}Z.material||(Z.material={color:[1,1,1],alpha:1,colorMixMode:1});
return Z};a.getVertexCrs=aa;a.intersectBoundingBoxWithMbs=function(M,Z){var la=Z[0],ka=Z[1],ha=Z[2];Z=Z[3];const na=M[0]-la;la-=M[3];const da=M[1]-ka;ka-=M[4];const oa=M[2]-ha;M=ha-M[5];ha=Math.max(na,la,0);const qa=Math.max(da,ka,0),ua=Math.max(oa,M,0);ha=ha*ha+qa*qa+ua*ua;return ha>Z*Z?0:0<ha?1:-Math.max(na,la,da,ka,oa,M)>Z?3:2};a.intersectBoundingRectWithMbs=G;a.objectIdFilter=function(M,Z,la){let ka=0,ha=0;for(;ka<la.length;)0<=k.binaryIndexOf(M,la[ka])===Z&&(la[ha]=la[ka],ha++),ka++;la.length=
ha};a.rendererNeedsTextures=function(M){if(null==M||"simple"!==M.type&&"class-breaks"!==M.type&&"unique-value"!==M.type||("unique-value"===M.type||"class-breaks"===M.type)&&null==M.defaultSymbol)return!0;M=M.getSymbols();if(0===M.length)return!0;for(const Z of M){if("mesh-3d"!==Z.type||0===Z.symbolLayers.length)return!0;for(const la of Z.symbolLayers.items)if("fill"!==la.type||p.isNone(la.material)||p.isNone(la.material.color)||"replace"!==la.material.colorMixMode)return!0}return!1};a.selectEncoding=
function(M,Z){return M.find(la=>0!==(la.encoding&Z))};a.transformObb=R;a.transparentEdgeMaterial=y;a.whenGraphicAttributes=async function(M,Z,la,ka,ha){if(0===Z.length)return[];const na=M.attributeStorageInfo;if(p.isSome(M.associatedLayer))try{return await J(M.associatedLayer,Z,la,ka)}catch(da){if(M.associatedLayer.loaded)throw da;}if(na){Z=K(Z,la,ha);if(p.isNone(Z))throw new f("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const da=M.parsedUrl.path;M=await Promise.all(Z.map(oa=>
P(da,na,oa.node,oa.indices,ka).then(qa=>{for(let ua=0;ua<oa.graphics.length;ua++){const Ca=oa.graphics[ua],Ja=qa[ua];if(Ca.attributes)for(const Ha in Ca.attributes)Ha in Ja||(Ja[Ha]=Ca.attributes[Ha]);Ca.attributes=Ja}return oa.graphics})));return k.flatten(M)}throw new f("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define(["exports","../../../../core/lang",
"../../../../core/Logger","../../../../core/Error","./LEPCC"],function(a,g,b,p,f){function k(C,A,x){let m="",B=0;for(;B<x;){var E=C[A+B];if(128>E)m+=String.fromCharCode(E),B++;else if(192<=E&&224>E){if(B+1>=x)throw new p("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");m+=String.fromCharCode((E&31)<<6|C[A+B+1]&63);B+=2}else if(224<=E&&240>E){if(B+2>=x)throw new p("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");m+=String.fromCharCode((E&
15)<<12|(C[A+B+1]&63)<<6|C[A+B+2]&63);B+=3}else if(240<=E&&248>E){if(B+3>=x)throw new p("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");E=(E&7)<<18|(C[A+B+1]&63)<<12|(C[A+B+2]&63)<<6|C[A+B+3]&63;m=65536<=E?m+String.fromCharCode((E-65536>>10)+55296,(E&1023)+56320):m+String.fromCharCode(E);B+=4}else throw new p("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return m}function c(C,A){const x={byteOffset:0,byteCount:0,fields:Object.create(null)};
let m=0;for(let B=0;B<A.length;B++){const E=A[B],F=E.valueType||E.type;x.fields[E.property]=(0,r[F])(C,m);m+=z[F].BYTES_PER_ELEMENT}x.byteCount=m;return x}function d(C,A,x){const m=[];let B,E=0,F;for(F=0;F<C;F+=1){B=A[F];if(0<B){if(m.push(k(x,E,B-1)),0!==x[E+B-1])throw new p("string-array-error","Invalid string array: missing null termination.");}else m.push(null);E+=B}return m}function e(C,A){return new z[A.valueType](C,A.byteOffset,A.count*A.valuesPerElement)}function h(C,A){return new Uint8Array(C,
A.byteOffset,A.byteCount)}function n(C,A,x){C=null!=A.header?c(C,A.header):{byteOffset:0,byteCount:0,fields:{count:x}};x={header:C,byteOffset:C.byteCount,byteCount:0,entries:Object.create(null)};let m=C.byteCount;for(let B=0;B<A.ordering.length;B++){const E=A.ordering[B],F=g.clone(A[E]);F.count=C.fields.count;if("String"===F.valueType){if(F.byteOffset=m,F.byteCount=C.fields[E+"ByteCount"],"UTF-8"!==F.encoding)throw new p("unsupported-encoding","Unsupported String encoding.",{encoding:F.encoding});
}else if(l(F.valueType)){const G=w(F.valueType);m+=0!==m%G?G-m%G:0;F.byteOffset=m;F.byteCount=G*F.valuesPerElement*F.count}else throw new p("unsupported-value-type","Unsupported binary valueType",{valueType:F.valueType});m+=F.byteCount;x.entries[E]=F}x.byteCount=m-x.byteOffset;return x}function q(C,A,x){A!==C&&y.error(`Invalid ${x} buffer size\n expected: ${C}, actual: ${A})`);if(A<C)throw new p("buffer-too-small","Binary buffer is too small",{expectedSize:C,actualSize:A});}function u(C){return{isDraco:!1,
isLegacy:!1,color:null!=C.color,normal:null!=C.normal,uv0:null!=C.uv0,uvRegion:null!=C.uvRegion,featureIndex:null!=C.faceRange&&null!=C.featureId}}function v(C){const A={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const x of C.ordering)if(C.vertexAttributes[x])switch(x){case "normal":A.normal=!0;break;case "color":A.color=!0;break;case "uv0":A.uv0=!0;break;case "region":A.uvRegion=!0}C.featureAttributes&&C.featureAttributeOrder&&(A.featureIndex=!0);return A}function t(C){const A=
{isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const x of C)switch(x){case "normal":A.normal=!0;break;case "uv0":A.uv0=!0;break;case "color":A.color=!0;break;case "uv-region":A.uvRegion=!0;break;case "feature-index":A.featureIndex=!0}return A}function l(C){return z.hasOwnProperty(C)}function w(C){return l(C)?z[C].BYTES_PER_ELEMENT:0}const y=b.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),D={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"},
z={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},r={Float32:(C,A)=>(new DataView(C,0)).getFloat32(A,!0),Float64:(C,A)=>(new DataView(C,0)).getFloat64(A,!0),UInt8:(C,A)=>(new DataView(C,0)).getUint8(A),Int8:(C,A)=>(new DataView(C,0)).getInt8(A),UInt16:(C,A)=>(new DataView(C,0)).getUint16(A,!0),Int16:(C,A)=>(new DataView(C,0)).getInt16(A,!0),UInt32:(C,A)=>(new DataView(C,0)).getUint32(A,!0),Int32:(C,
A)=>(new DataView(C,0)).getInt32(A,!0)};a.createAttributeDataIndex=n;a.createGeometryDescriptor=function(C,A){return C&&C.compressedAttributes&&"draco"===C.compressedAttributes.encoding?t(C.compressedAttributes.attributes):C?u(C):v(A)};a.createGeometryDescriptorForDraco=t;a.createGeometryDescriptorFromDefinition=u;a.createGeometryDescriptorFromSchema=v;a.createGeometryIndexFromSchema=function(C,A){var x=c(C,A&&A.header);let m=x.byteCount;const B={isDraco:!1,header:x,byteOffset:x.byteCount,byteCount:0,
vertexAttributes:{}};x=x.fields;var E=null!=x.vertexCount?x.vertexCount:x.count;for(var F of A.ordering){if(!A.vertexAttributes[F])continue;const I={...A.vertexAttributes[F],byteOffset:m,count:E};B.vertexAttributes[D[F]?D[F]:"_"+F]=I;m+=w(I.valueType)*I.valuesPerElement*E}F=x.faceCount;if(A.faces&&F){B.faces={};for(var G of A.ordering)A.faces[G]&&(E={...A.faces[G],byteOffset:m,count:F},B.faces[G]=E,m+=w(E.valueType)*E.valuesPerElement*F)}G=x.featureCount;if(A.featureAttributes&&A.featureAttributeOrder&&
G){B.featureAttributes={};for(const I of A.featureAttributeOrder)A.featureAttributes[I]&&(x={...A.featureAttributes[I],byteOffset:m,count:G},B.featureAttributes[I]=x,F="UInt64"===x.valueType?8:w(x.valueType),m+=F*x.valuesPerElement*G)}q(m,C.byteLength,"geometry");B.byteCount=m-B.byteOffset;return B};a.createRawView=h;a.createTypedView=e;a.getBytesPerValue=w;a.isValueType=l;a.readBinaryAttribute=function(C,A,x){if("lepcc-rgb"===C.encoding)return f.decodeRGB(A);if("lepcc-intensity"===C.encoding)return f.decodeIntensity(A);
if(null!=C.encoding&&""!==C.encoding)throw new p("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");C["attributeByteCounts "]&&!C.attributeByteCounts&&(y.warn("Warning: Trailing space in 'attributeByteCounts '."),C.attributeByteCounts=C["attributeByteCounts "]);"ObjectIds"===C.ordering[0]&&C.hasOwnProperty("objectIds")&&(y.warn("Warning: Case error in objectIds"),C.ordering[0]="objectIds");x=n(A,C,x);q(x.byteOffset+x.byteCount,A.byteLength,"attribute");if(C=x.entries.attributeValues||
x.entries.objectIds){if("String"===C.valueType){x=x.entries.attributeByteCounts;const m=e(A,x);A=h(A,C);return d(x.count,m,A)}return e(A,C)}throw new p("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readHeader=c;a.readStringArray=d;a.valueType2ArrayBufferReader=r;a.valueType2TypedArrayClassMap=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,g){function b(c,d,e){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(c,e+k.identifierOffset,k.identifierLength)),version:d.getUint16(e+k.versionOffset,!0),checksum:d.getUint32(e+k.checksumOffset,!0)}}function p(c,d,e){const h=[];d=f(c,d,h);const n=[];for(let q=0;q<h.length;q++){n.length=0;d=f(c,d,n);for(let u=0;u<n.length;u++)e.push(n[u]+h[q])}return d}function f(c,d,e){var h=new DataView(c,d),n=h.getUint8(0);const q=n&31;var u=!!(n&32),v=(n&192)>>6;n=0;if(0===v)n=h.getUint32(1,!0),d+=5;else if(1===v)n=h.getUint16(1,!0),d+=3;else if(2===v)n=h.getUint8(1),
d+=2;else throw new g("lepcc-decode-error","Bad count type");if(u)throw new g("lepcc-decode-error","LUT not implemented");c=new Uint8Array(c,d,Math.ceil(n*q/8));v=u=h=0;const t=-1>>>32-q;for(let l=0;l<n;l++){for(;u<q;)h|=c[v]<<u,u+=8,v+=1;e[l]=h&t;h>>>=q;u-=q;32<u+q&&(h|=c[v-1]>>8-u)}return d+v}const k={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(c){const d=new DataView(c,0);var e=0;const {identifier:h,version:n}=b(c,d,e);e+=k.byteCount;
if("Intensity "!==h)throw new g("lepcc-decode-error","Bad identifier");if(1<n)throw new g("lepcc-decode-error","Unknown version");var q=e;var u=d.getUint32(q+0,!0);var v=d.getUint32(q+4,!0);var t=d.getUint32(q+8,!0);var l=d.getUint16(q+12,!0);var w=d.getUint8(q+14);d.getUint8(q+15);e+=16;if(v*2**32+u!==c.byteLength)throw new g("lepcc-decode-error","Bad size");u=new Uint16Array(t);if(8===w){if(t+e!==c.byteLength)throw new g("lepcc-decode-error","Bad size");c=new Uint8Array(c,e,t);for(e=0;e<t;e++)u[e]=
c[e]*l}else if(16===w){if(2*t+e!==c.byteLength)throw new g("lepcc-decode-error","Bad size");c=new Uint16Array(c,e,t);for(e=0;e<t;e++)u[e]=c[e]*l}else{w=[];if(f(c,e,w)!==c.byteLength)throw new g("lepcc-decode-error","Bad size");for(c=0;c<t;c++)u[c]=w[c]*l}return u};a.decodeRGB=function(c){var d=new DataView(c,0),e=0;const {identifier:h,version:n}=b(c,d,e);e+=k.byteCount;if("ClusterRGB"!==h)throw new g("lepcc-decode-error","Bad identifier");if(1<n)throw new g("lepcc-decode-error","Unknown version");
var q=e;var u=d.getUint32(q+0,!0);var v=d.getUint32(q+4,!0);var t=d.getUint32(q+8,!0);var l=d.getUint16(q+12,!0);var w=d.getUint8(q+14);q=d.getUint8(q+15);e+=16;if(v*2**32+u!==c.byteLength)throw new g("lepcc-decode-error","Bad size");if((2===w||1===w)&&0===q){if(3*l+t+e!==c.byteLength||256<l)throw new g("lepcc-decode-error","Bad count");d=new Uint8Array(c,e,3*l);e=new Uint8Array(c,e+3*l,t);c=new Uint8Array(3*t);for(l=0;l<t;l++)u=e[l],c[3*l]=d[3*u],c[3*l+1]=d[3*u+1],c[3*l+2]=d[3*u+2];return c}if(0===
w&&0===q){if(3*t+e!==c.byteLength||0!==l)throw new g("lepcc-decode-error","Bad count");return(new Uint8Array(c,e)).slice()}if(2>=w&&1===q){if(e+3!==c.byteLength||1!==l)throw new g("lepcc-decode-error","Bad count");c=d.getUint8(e);l=d.getUint8(e+1);e=d.getUint8(e+2);d=new Uint8Array(3*t);for(u=0;u<t;u++)d[3*u]=c,d[3*u+1]=l,d[3*u+2]=e;return d}throw new g("lepcc-decode-error","Bad method "+w+","+q);};a.decodeXYZ=function(c){var d=new DataView(c,0),e=0;const {identifier:h,version:n}=b(c,d,e);e+=k.byteCount;
if("LEPCC     "!==h)throw new g("lepcc-decode-error","Bad identifier");if(1<n)throw new g("lepcc-decode-error","Unknown version");var q=e;var u=d.getUint32(q+0,!0);var v=d.getUint32(q+4,!0);var t=d.getFloat64(q+8,!0);var l=d.getFloat64(q+16,!0);var w=d.getFloat64(q+24,!0);var y=d.getFloat64(q+32,!0);var D=d.getFloat64(q+40,!0);var z=d.getFloat64(q+48,!0);var r=d.getFloat64(q+56,!0);var C=d.getFloat64(q+64,!0);var A=d.getFloat64(q+72,!0);var x=d.getUint32(q+80,!0);d.getUint32(q+84,!0);e+=88;if(v*2**
32+u!==c.byteLength)throw new g("lepcc-decode-error","Bad size");u=new Float64Array(3*x);v=[];x=[];d=[];q=[];e=p(c,e,v);e=p(c,e,x);e=p(c,e,d);e=p(c,e,q);if(e!==c.byteLength)throw new g("lepcc-decode-error","Bad length");e=c=0;for(let m=0;m<v.length;m++){e+=v[m];let B=0;for(let E=0;E<x[m];E++){B+=d[c];const F=q[c];u[3*c]=Math.min(y,t+2*r*B);u[3*c+1]=Math.min(D,l+2*C*e);u[3*c+2]=Math.min(z,w+2*A*F);c++}}return{errorX:r,errorY:C,errorZ:A,result:u}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/vec3f64","../../../../geometry/projectionEllipsoid","../../../../geometry/projection","../../../../chunks/mat4f64"],function(a,g,b,p,f){function k(c,d,e){const h=g.create(),n=2**(4*Math.ceil(Math.log(c[3])*Math.LOG2E/4)+1);if(e.isGeographic){var q=n/b.getReferenceEllipsoid(e).radius*180/Math.PI;e=Math.max(-90,Math.min(90,Math.round(c[1]/q)*q));q/=Math.cos((Math.abs(e)-q/2)/180*Math.PI);h[0]=Math.round(c[0]/
q)*q;h[1]=e}else e=Math.round(c[1]/n),h[0]=Math.round(c[0]/n)*n,h[1]=e*n;h[2]=Math.round((c[2]+d)/n)*n;return h}a.computeGlobalTransformation=function(c,d,e,h){c=k(c,d,e);d=f.create();p.computeLinearTransformation(e,c,d,h);return d};a.getLocalOrigin=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,g,b,p){p=
function(f){function k(c){return f.call(this,"PointCloudWorker","transform",c)||this}g._inheritsLoose(k,f);k.prototype.getTransferList=function(c){const d=[c.geometryBuffer];b.isSome(c.primaryAttributeData)&&c.primaryAttributeData.buffer&&d.push(c.primaryAttributeData.buffer);b.isSome(c.modulationAttributeData)&&c.modulationAttributeData.buffer&&d.push(c.modulationAttributeData.buffer);if(b.isSome(c.filterAttributesData))for(const e of c.filterAttributesData)b.isSome(e)&&e.buffer&&d.push(e.buffer);
for(const e of c.userAttributesData)e.buffer&&d.push(e.buffer);return d};return k}(p.WorkerHandle);a.PointCloudWorkerHandle=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,g){function b(e,h,n){for(;0<e;){const q=h.indexOf(e);if(0<=q)return q;e=n.getParentId(e)}return h.indexOf(e)}function p(e,h,n){const q=[h.remove[0]],u=[];for(;1===q.length;){const t=q.pop();u.length=0;for(let l=0;l<h.load.length;l++){let w=
h.load[l];for(var v=n.getParentId(w);v!==t;)w=v,v=n.getParentId(w);v=q.indexOf(w);0>v&&(v=q.length,q.push(w),u.push([]));u[v].push(h.load[l])}}h.load=q;for(h=0;h<q.length;h++)1<u[h].length?e.push({remove:[q[h]],load:u[h]}):q[h]=u[h][0]}const f=[!1],k=[null],c=[!1],d=[null];a.nodeDiff=function(e,h,n){for(var q=0;q<h.length;q++)c[q]=!1,d[q]=null;for(q=0;q<e.length;q++)f[q]=!1,k[q]=null;for(q=0;q<h.length;q++){var u=b(h[q],e,n);0<=u&&(c[q]=!0,null!=k[u]?k[u].push(h[q]):k[u]=[h[q]])}for(q=0;q<e.length;q++)u=
b(e[q],h,n),0<=u&&(f[q]=!0,null!=d[u]?d[u].push(e[q]):d[u]=[e[q]]);n=[];for(q=0;q<e.length;q++)null!=k[q]||f[q]||n.push({load:[],remove:[e[q]]});for(q=0;q<h.length;q++)null!=d[q]||c[q]||n.push({load:[h[q]],remove:[]});for(q=0;q<h.length;q++)null!=d[q]&&(1<d[q].length||d[q][0]!==h[q])&&n.push({load:[h[q]],remove:d[q]});for(h=0;h<e.length;h++)null!=k[h]&&(1<k[h].length||k[h][0]!==e[h])&&n.push({load:k[h],remove:[e[h]]});return n};a.sortFrontToBack=function(e,h,n){return e.sort((q,u)=>{if(0===q.load.length&&
0===u.load.length)return 0;if(0===q.load.length)return-1;if(0===u.load.length)return 1;if(0===q.remove.length&&0===u.remove.length)return q=n.getRenderCenter(q.load[0]),u=n.getRenderCenter(u.load[0]),g.dot(q,h)-g.dot(u,h);if(0===q.remove.length)return-1;if(0===u.remove.length)return 1;if(1===q.load.length&&1===u.load.length)return q=n.getRenderCenter(q.load[0]),u=n.getRenderCenter(u.load[0]),g.dot(q,h)-g.dot(u,h);if(1===q.load.length)return-1;if(1===u.load.length)return 1;q=n.getRenderCenter(q.remove[0]);
u=n.getRenderCenter(u.remove[0]);return g.dot(q,h)-g.dot(u,h)})};a.splitWorkEntries=function(e,h,n){for(let q=0;q<e.length;++q){const u=e[q];u.load.length>h&&1===u.remove.length&&p(e,u,n)}};a.splitWorkEntry=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","../../support/orientedBoundingBox","./I3SUtil"],function(a,g,b){return function(){function p(k,c,d){this._pages=[];this.pageSize=0;this._renderSR=
this._nodeSR=null;this._nodeSR=k;this._renderSR=c;this.pageSize=d}var f=p.prototype;f.addPage=function(k,c,d=0){for(;this._pages.length<k;)this._pages.push(null);var e=this._nodeSR,h=this._renderSR,n=new g.ObbArray(c.length);for(var q=0;q<c.length;q++)b.transformObb(c[q].obb,e,n.obbs[q],h,d);d=n.obbs;this._pages[k]={nodes:c,renderObbs:d,parents:new Uint32Array(this.pageSize)};k=this._pages;c=this.pageSize;for(d=[0];d.length;)for(e=d.pop(),h=k[e/c|0].nodes[e%c],n=0;n<h.childCount;n++)q=h.firstChild+
n,null!=k[q/c|0]&&(k[q/c|0].parents[q%c]=e,d.push(q))};f.hasPage=function(k){return!!this._pages[k]};f.getNode=function(k){const c=this.pageSize;return this._pages[k/c|0].nodes[k%c]};f.getRenderObb=function(k){const c=this.pageSize;return this._pages[k/c|0].renderObbs[k%c]};f.getRenderCenter=function(k){return this.getRenderObb(k).center};f.setRenderObb=function(k,c){const d=this.pageSize;g.set(c,this._pages[k/d|0].renderObbs[k%d])};f.getParentId=function(k){const c=this.pageSize;return this._pages[k/
c|0].parents[k%c]};f.hasNodes=function(k,c){var d=k/this.pageSize|0;for(k=(k+c-1)/this.pageSize|0;d<=k;d++)if(null==this._pages[d])return!1;return!0};f.forEachNodeId=function(k){for(let c=0;c<this._pages.length;c++){const d=this._pages[c];if(d)for(let e=0;e<d.nodes.length;e++)k(c*this.pageSize+e)}};f.createVisibilityTraverse=function(){var k=this,c=[],d=[],e=a.create();return(h,n)=>{if(k.hasNodes(0,1))for(c.length=0,c.push(0),d.length=0,d.push(0);0<c.length;){var q=c.pop();let y=d.pop();var u=k.getNode(q),
v=k.getRenderObb(q),t=!0;if(null!=h.clippingBox){var l=1<<h.frustum.length;if(0===(y&l)){var w=g.toAaBoundingBox(v,e);a.contains(h.clippingBox,w)?y|=l:a.intersects(h.clippingBox,w)||(t=!1)}}for(l=0;l<h.frustum.length&&t;l++)if(w=1<<l,0===(y&w)){const D=g.intersectPlane(v,h.frustum[l]);0<D?t=!1:0>D&&(y|=w)}if(n.predicate(q,u,t)){v=u.firstChild;u=u.childCount;t=!1;w=v/k.pageSize|0;for(l=(v+u-1)/k.pageSize|0;w<=l;w++)if(!k.hasPage(w)){n.pageMiss(q,w);t=!0;break}if(!t)for(q=0;q<u;q++)c.push(v+q),d.push(y)}}}};
return p}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function g(p,f){for(const k of p)if(k.name===f&&null!=k.attributeValues&&"UInt8"===k.attributeValues.valueType&&3===k.attributeValues.valuesPerElement)return{name:f,storageInfo:k,useElevation:!1};return null}function b(p,f){for(const k of p)if(k.name===f)return p="embedded-elevation"===k.encoding,{name:f,storageInfo:p?null:k,useElevation:p};return"elevation"===f.toLowerCase()?{name:f,storageInfo:null,
useElevation:!0}:null}a.getAttributeInfo=b;a.getFilterInfo=function(p){const f=p.filters;return f?f.map(k=>({filterJSON:k.toJSON(),attributeInfo:b(p.attributeStorageInfo,k.field)})):[]};a.getFixedSizeAlgorithm=function(p){return(p=p&&p.pointSizeAlgorithm)&&"fixed-size"===p.type?p:null};a.getRendererInfo=function(p){const f=p.renderer;var k=f&&f.type;const c=f&&p.renderer.toJSON()||null;let d=null,e=!1;"point-cloud-unique-value"===k?d=b(p.attributeStorageInfo,f.field):"point-cloud-stretch"===k?d=b(p.attributeStorageInfo,
f.field):"point-cloud-class-breaks"===k?d=b(p.attributeStorageInfo,f.field):(d="point-cloud-rgb"===k?g(p.attributeStorageInfo,f.field):g(p.attributeStorageInfo,"RGB"),e=null!=d);k=null;f&&f.colorModulation&&(k=b(p.attributeStorageInfo,f.colorModulation.field));return{rendererJSON:c,isRGBRenderer:e,primaryAttribute:d,modulationAttribute:k}};a.getSplatSizeAlgorithm=function(p){return(p=p&&p.pointSizeAlgorithm)&&"splat"===p.type?p:null};a.rendererUsesFixedSizes=function(p){return(p=p&&p.pointSizeAlgorithm)&&
p.type?"fixed-size"===p.type:!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./LEPCC ./I3SBinaryReader".split(" "),function(a,g,b,p,f,k,c){function d(n,q){const u=new Float64Array(q);for(let v=0;v<q;v++)u[v]=n[3*v+2];return u}function e(n){return null==
n||"none"===n?null:"low-four-bit"===n?q=>q&15:"high-four-bit"===n?q=>(q&240)>>4:"absolute-value"===n?q=>Math.abs(q):"modulo-ten"===n?q=>q%10:null}function h(n){let q=0;for(const u of n?n:[])q|=1<<u;return q}a.elevationFromPositions=d;a.evaluateRenderer=function(n,q,u,v){const {rendererJSON:t,isRGBRenderer:l}=n;var w=n=null;if(q&&l)n=q;else if(q&&"pointCloudUniqueValueRenderer"===t.type){w=f.fromJSON(t);var y=w.colorUniqueValueInfos;n=new Uint8Array(3*v);var D=e(w.fieldTransformType);for(var z=0;z<
v;z++){var r=(D?D(q[z]):q[z])+"";for(var C=0;C<y.length;C++)if(0<=y[C].values.indexOf(r)){n[3*z]=y[C].color.r;n[3*z+1]=y[C].color.g;n[3*z+2]=y[C].color.b;break}}}else if(q&&"pointCloudStretchRenderer"===t.type)for(w=p.fromJSON(t),y=w.stops,n=new Uint8Array(3*v),D=e(w.fieldTransformType),z=0;z<v;z++)if(r=D?D(q[z]):q[z],C=y.length-1,r<y[0].value)n[3*z]=y[0].color.r,n[3*z+1]=y[0].color.g,n[3*z+2]=y[0].color.b;else if(r>=y[C].value)n[3*z]=y[C].color.r,n[3*z+1]=y[C].color.g,n[3*z+2]=y[C].color.b;else for(C=
1;C<y.length;C++){if(r<y[C].value){r=(r-y[C-1].value)/(y[C].value-y[C-1].value);n[3*z]=y[C].color.r*r+y[C-1].color.r*(1-r);n[3*z+1]=y[C].color.g*r+y[C-1].color.g*(1-r);n[3*z+2]=y[C].color.b*r+y[C-1].color.b*(1-r);break}}else if(q&&"pointCloudClassBreaksRenderer"===t.type)for(w=b.fromJSON(t),y=w.colorClassBreakInfos,n=new Uint8Array(3*v),D=e(w.fieldTransformType),z=0;z<v;z++)for(r=D?D(q[z]):q[z],C=0;C<y.length;C++){if(r>=y[C].minValue&&r<=y[C].maxValue){n[3*z]=y[C].color.r;n[3*z+1]=y[C].color.g;n[3*
z+2]=y[C].color.b;break}}else for(n=new Uint8Array(3*v),q=0;q<n.length;q++)n[q]=255;if(u&&w&&w.colorModulation)for(q=w.colorModulation.minValue,w=w.colorModulation.maxValue,y=0;y<v;y++)D=u[y],D=D>=w?1:D<=q?.3:.3+.7*(D-q)/(w-q),n[3*y]*=D,n[3*y+1]*=D,n[3*y+2]*=D;return n};a.filterInPlace=function(n,q,u,v,t){const l=n.length/3;let w=0;for(let A=0;A<l;A++){let x=!0;for(let m=0;m<v.length&&x;m++){var {filterJSON:y}=v[m],D=t[m].values[A];switch(y.type){case "pointCloudValueFilter":var z="exclude"===y.mode;
-1!==y.values.indexOf(D)===z&&(x=!1);break;case "pointCloudBitfieldFilter":z=h(y.requiredSetBits);y=h(y.requiredClearBits);if((D&z)!==z||0!==(D&y))x=!1;break;case "pointCloudReturnFilter":var r=D&15,C=D>>>4&15;D=1<C;z=1===r;r=r===C;C=!1;for(const B of y.includedReturns)if("last"===B&&r||"firstOfMany"===B&&z&&D||"lastOfMany"===B&&r&&D||"single"===B&&!D){C=!0;break}C||(x=!1)}}x&&(u[w]=A,n[3*w]=n[3*A],n[3*w+1]=n[3*A+1],n[3*w+2]=n[3*A+2],q[3*w]=q[3*A],q[3*w+1]=q[3*A+1],q[3*w+2]=q[3*A+2],w++)}return w};
a.getAttributeValues=function(n,q,u){return g.isSome(n)&&n.attributeInfo.useElevation?d(q,u):g.isSome(n)?c.readBinaryAttribute(n.attributeInfo.storageInfo,n.buffer,u):null};a.readGeometry=function(n,q){if(null==n.encoding||""===n.encoding){n=c.createGeometryIndexFromSchema(q,n);if(g.isNone(n.vertexAttributes.position))return;q=c.createTypedView(q,n.vertexAttributes.position);var u=n.header.fields;n=[u.offsetX,u.offsetY,u.offsetZ];u=[u.scaleX,u.scaleY,u.scaleZ];const v=q.length/3,t=new Float64Array(3*
v);for(let l=0;l<v;l++)t[3*l]=q[3*l]*u[0]+n[0],t[3*l+1]=q[3*l+1]*u[1]+n[1],t[3*l+2]=q[3*l+2]*u[2]+n[2];return t}if("lepcc-xyz"===n.encoding)return k.decodeXYZ(q).result};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;b=l=function(w){function y(D){D=w.call(this,D)||this;D.type="point-cloud-class-breaks";D.field=null;D.legendOptions=null;D.fieldTransformType=null;D.colorClassBreakInfos=null;return D}a._inheritsLoose(y,w);y.prototype.clone=function(){return new l({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:p.clone(this.colorClassBreakInfos),legendOptions:p.clone(this.legendOptions)})};return y}(u);g.__decorate([d.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
b.prototype,"type",void 0);g.__decorate([c.property({json:{write:!0},type:String})],b.prototype,"field",void 0);g.__decorate([c.property({type:v["default"],json:{write:!0}})],b.prototype,"legendOptions",void 0);g.__decorate([c.property({type:u.fieldTransformTypeKebabDict.apiValues,json:{type:u.fieldTransformTypeKebabDict.jsonValues,read:u.fieldTransformTypeKebabDict.read,write:u.fieldTransformTypeKebabDict.write}})],b.prototype,"fieldTransformType",void 0);g.__decorate([c.property({type:[t["default"]],
json:{write:!0}})],b.prototype,"colorClassBreakInfos",void 0);return b=l=g.__decorate([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],b)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){b=d.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});u=function(l){function w(D){D=l.call(this,D)||this;D.type=void 0;D.pointSizeAlgorithm=null;D.colorModulation=null;D.pointsPerInch=10;return D}a._inheritsLoose(w,l);var y=w.prototype;y.clone=function(){console.warn(".clone() is not implemented for "+
this.declaredClass);return null};y.cloneProperties=function(){return{pointSizeAlgorithm:p.clone(this.pointSizeAlgorithm),colorModulation:p.clone(this.colorModulation),pointsPerInch:p.clone(this.pointsPerInch)}};return w}(u.JSONSupport);g.__decorate([c.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],u.prototype,"type",void 0);g.__decorate([c.property({types:t.pointSizeAlgorithmTypes,json:{write:!0}})],u.prototype,"pointSizeAlgorithm",void 0);
g.__decorate([c.property({type:v["default"],json:{write:!0}})],u.prototype,"colorModulation",void 0);g.__decorate([c.property({json:{write:!0},nonNullable:!0,type:Number})],u.prototype,"pointsPerInch",void 0);u=g.__decorate([e.subclass("esri.renderers.PointCloudRenderer")],u);(u||(u={})).fieldTransformTypeKebabDict=new d.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return u})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;a.ColorModulation=v=function(t){function l(){var w=t.apply(this,arguments)||this;w.field=null;w.minValue=0;w.maxValue=255;return w}g._inheritsLoose(l,t);l.prototype.clone=function(){return new v({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return l}(u.JSONSupport);b.__decorate([c.property({type:String,json:{write:!0}})],a.ColorModulation.prototype,"field",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],
a.ColorModulation.prototype,"minValue",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,"maxValue",void 0);a.ColorModulation=v=b.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorModulation")],a.ColorModulation);a.default=a.ColorModulation;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm",
"./PointSizeSplatAlgorithm"],function(a,g,b,p){a.pointSizeAlgorithmTypes={key:"type",base:g["default"],typeMap:{"fixed-size":b["default"],splat:p["default"]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){p=new d.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});a.PointSizeAlgorithm=function(v){function t(){return v.apply(this,arguments)||this}g._inheritsLoose(t,v);return t}(u.JSONSupport);b.__decorate([c.property({type:p.apiValues,readOnly:!0,nonNullable:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],a.PointSizeAlgorithm.prototype,"type",void 0);a.PointSizeAlgorithm=b.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
a.PointSizeAlgorithm);a.default=a.PointSizeAlgorithm;a.typeKebabDictionary=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./PointSizeAlgorithm".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;a.PointSizeFixedSizeAlgorithm=v=function(t){function l(){var w=t.apply(this,arguments)||this;w.type="fixed-size";w.size=0;w.useRealWorldSymbolSizes=null;return w}g._inheritsLoose(l,t);l.prototype.clone=function(){return new v({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return l}(u["default"]);b.__decorate([d.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],a.PointSizeFixedSizeAlgorithm.prototype,"type",void 0);b.__decorate([c.property({type:Number,
nonNullable:!0,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"size",void 0);b.__decorate([c.property({type:Boolean,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"useRealWorldSymbolSizes",void 0);a.PointSizeFixedSizeAlgorithm=v=b.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],a.PointSizeFixedSizeAlgorithm);a.default=a.PointSizeFixedSizeAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./PointSizeAlgorithm".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;a.PointSizeSplatAlgorithm=v=function(t){function l(){var w=t.apply(this,arguments)||this;w.type="splat";w.scaleFactor=1;return w}g._inheritsLoose(l,t);l.prototype.clone=function(){return new v({scaleFactor:this.scaleFactor})};return l}(u["default"]);b.__decorate([d.enumeration({pointCloudSplatAlgorithm:"splat"})],a.PointSizeSplatAlgorithm.prototype,"type",void 0);b.__decorate([c.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],a.PointSizeSplatAlgorithm.prototype,
"scaleFactor",void 0);a.PointSizeSplatAlgorithm=v=b.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],a.PointSizeSplatAlgorithm);a.default=a.PointSizeSplatAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../Color".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;a.ColorClassBreakInfo=l=function(w){function y(){var D=w.apply(this,arguments)||this;D.description=null;D.label=null;D.minValue=0;D.maxValue=0;D.color=null;return D}g._inheritsLoose(y,w);y.prototype.clone=function(){return new l({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:f.clone(this.color)})};return y}(v.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,
"description",void 0);b.__decorate([d.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,"label",void 0);b.__decorate([d.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.ColorClassBreakInfo.prototype,"minValue",void 0);b.__decorate([d.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.ColorClassBreakInfo.prototype,"maxValue",void 0);b.__decorate([d.property({type:t,json:{type:[c.Integer],
write:!0}})],a.ColorClassBreakInfo.prototype,"color",void 0);a.ColorClassBreakInfo=l=b.__decorate([h.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],a.ColorClassBreakInfo);a.default=a.ColorClassBreakInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;b=l=function(w){function y(D){D=w.call(this,D)||this;D.type="point-cloud-stretch";D.field=null;D.legendOptions=null;D.fieldTransformType=null;D.stops=null;return D}a._inheritsLoose(y,w);y.prototype.clone=function(){return new l({...this.cloneProperties(),field:p.clone(this.field),fieldTransformType:p.clone(this.fieldTransformType),stops:p.clone(this.stops),legendOptions:p.clone(this.legendOptions)})};return y}(u);g.__decorate([d.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
b.prototype,"type",void 0);g.__decorate([c.property({json:{write:!0},type:String})],b.prototype,"field",void 0);g.__decorate([c.property({type:v["default"],json:{write:!0}})],b.prototype,"legendOptions",void 0);g.__decorate([c.property({type:u.fieldTransformTypeKebabDict.apiValues,json:{type:u.fieldTransformTypeKebabDict.jsonValues,read:u.fieldTransformTypeKebabDict.read,write:u.fieldTransformTypeKebabDict.write}})],b.prototype,"fieldTransformType",void 0);g.__decorate([c.property({type:[t],json:{write:!0}})],
b.prototype,"stops",void 0);return b=l=g.__decorate([e.subclass("esri.renderers.PointCloudStretchRenderer")],b)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;b=l=function(w){function y(D){D=w.call(this,D)||this;D.type="point-cloud-unique-value";D.field=null;D.fieldTransformType=null;D.colorUniqueValueInfos=null;D.legendOptions=null;return D}a._inheritsLoose(y,w);y.prototype.clone=function(){return new l({...this.cloneProperties(),field:p.clone(this.field),fieldTransformType:p.clone(this.fieldTransformType),colorUniqueValueInfos:p.clone(this.colorUniqueValueInfos),legendOptions:p.clone(this.legendOptions)})};
return y}(u);g.__decorate([d.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],b.prototype,"type",void 0);g.__decorate([c.property({json:{write:!0},type:String})],b.prototype,"field",void 0);g.__decorate([c.property({type:u.fieldTransformTypeKebabDict.apiValues,json:{type:u.fieldTransformTypeKebabDict.jsonValues,read:u.fieldTransformTypeKebabDict.read,write:u.fieldTransformTypeKebabDict.write}})],b.prototype,"fieldTransformType",void 0);g.__decorate([c.property({type:[t["default"]],
json:{write:!0}})],b.prototype,"colorUniqueValueInfos",void 0);g.__decorate([c.property({type:v["default"],json:{write:!0}})],b.prototype,"legendOptions",void 0);return b=l=g.__decorate([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],b)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../Color".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t){var l;a.ColorUniqueValueInfo=l=function(w){function y(){var D=w.apply(this,arguments)||this;D.description=null;D.label=null;D.values=null;D.color=null;return D}g._inheritsLoose(y,w);y.prototype.clone=function(){return new l({description:this.description,label:this.label,values:f.clone(this.values),color:f.clone(this.color)})};return y}(v.JSONSupport);b.__decorate([d.property({type:String,json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"description",void 0);
b.__decorate([d.property({type:String,json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"label",void 0);b.__decorate([d.property({type:[String],json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"values",void 0);b.__decorate([d.property({type:t,json:{type:[c.Integer],write:!0}})],a.ColorUniqueValueInfo.prototype,"color",void 0);a.ColorUniqueValueInfo=l=b.__decorate([h.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],a.ColorUniqueValueInfo);a.default=a.ColorUniqueValueInfo;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../Graphic".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){var v;a.PointGraphic=v=function(t){function l(y){return t.call(this,y)||this}g._inheritsLoose(l,t);var w=l.prototype;w.clone=function(){return new v(this.cloneProperties())};w.cloneProperties=function(){const {pointCloudMetadata:y}=this;return{...t.prototype.cloneProperties.call(this),pointCloudMetadata:y}};return l}(u);b.__decorate([c.property({constructOnly:!0})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=v=b.__decorate([e.subclass("esri.views.3d.layers.i3s.PointGraphic")],
a.PointGraphic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../../../chunks/mat4f32 ../../../../chunks/vec3f32 ../../support/geometryUtils ../../../webgl/BufferObject ../../../webgl/VertexArrayObject ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../support/orientedBoundingBox ./PointHighlights ../../webgl-engine/shaders/PointRendererTechnique".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C){function A(E,F,G,I,K){if(G.drawScreenSpace)return G.fixedSize*F*I;K=(K?256:64)*F*I;return G.drawFixedSize?Math.min(G.fixedSize/2,K):0<G.screenMinSize?Math.min(Math.max(G.screenMinSize*F*I,E/2),K):Math.min(E/2,K)}function x(E){return b.isSome(E.component)?E.component:-1}function m(E,F){if(b.isNone(E))return E;E=E.filter(G=>G.id!==F);return 0===E.length?null:E}const B={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],
colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};a.PointRenderer=function(){function E(G){this._params=G;this.type="Point";this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new r.PointHighlights({forEachNode:I=>this.forEachNode(I),addHighlight:(I,K,J)=>this.addHighlight(I,K,J),removeHighlight:(I,K)=>this.removeHighlight(I,K)});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=
0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=h.create(h.POSITIVE_INFINITY);this._techniqueConfig=new C.PointRendererTechniqueConfiguration;this.tempMatrix4=q.create();this.tempVec3=u.create();this.nodes=new p}var F=E.prototype;F.initializeRenderContext=function(G){this._context=G;this._techniqueRep=this._context.shaderTechniqueRep;G.requestRender()};F.uninitializeRenderContext=function(){};F.intersect=function(G,I,K,J){const L=f.create(),P=
f.create(),Q=f.create(),X=f.create(),aa=v.plane.create(),S=G.camera.perScreenPixelRatio/2,H=G.camera.near,R=this._getSizeParams();k.subtract(P,J,K);const T=1/k.length(P);k.scale(P,P,T);k.negate(Q,P);e.set(aa,P[0],P[1],P[2],-k.dot(P,K));let W=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};const Y=new W,U=new W,N=[],ca=h.create(),O=h.create(this._clipBox);h.offset(O,-K[0],-K[1],-K[2],O);this.nodes.forAll(ia=>{const ma=ia.splatSize*this._scaleFactor;var ea=
z.minimumDistancePlane(ia.obb,aa),M=z.maximumDistancePlane(ia.obb,aa);ea-=R.drawScreenSpace?0:A(ma,ea+H,R,S,ia.isLeaf);M-=R.drawScreenSpace?0:A(ma,M+H,R,S,ia.isLeaf);ea=null!=Y.dist&&null!=U.dist&&Y.dist<ea*T&&U.dist>M*T;if(!(0>M||ea)&&(M=A(ma,M+H,R,S,ia.isLeaf),z.intersectLine(ia.obb,K,P,M))){M*=M;z.toAaBoundingBox(ia.obb,ca);h.offset(ca,-K[0],-K[1],-K[2],ca);ea=!h.contains(O,ca);k.subtract(X,ia.origin,K);var Z=ia.coordinates.length/3;for(let na=0;na<Z;na++){L[0]=X[0]+ia.coordinates[3*na];L[1]=X[1]+
ia.coordinates[3*na+1];L[2]=X[2]+ia.coordinates[3*na+2];if(ea&&!h.containsPoint(O,L))continue;var la=k.dot(L,P),ka=k.squaredLength(L)-la*la;if(ka>M)continue;var ha=la+H;const da=R.drawScreenSpace?0:A(ma,ha,R,S,ia.isLeaf);if(0>la-da)continue;ha-=da;ha=A(ma,ha,R,S,ia.isLeaf);if(ka>ha*ha)continue;const oa=(la-da)*T;la=qa=>{var ua=na,Ca=qa.point;null==Ca&&(Ca=f.create());Ca[0]=ia.origin[0]+ia.coordinates[3*ua];Ca[1]=ia.origin[1]+ia.coordinates[3*ua+1];Ca[2]=ia.origin[2]+ia.coordinates[3*ua+2];qa.point=
Ca;qa.dist=oa;qa.normal=Q;qa.node=ia;qa.pointId=na;qa.layerUid=this.layerUid};(null==Y.dist||oa<Y.dist)&&(null==I||I(K,J,oa))&&la(Y);0!==G.options.store&&(null==U.dist||oa>U.dist)&&(null==I||I(K,J,oa))&&la(U);2!==G.options.store||null!=I&&!I(K,J,oa)||(ka=new W,la(ka),N.push(ka))}}});const V=ia=>{const {layerUid:ma,node:ea,pointId:M}=ia;return{type:"external",point:ia.point,metadata:{layerUid:ma,createGraphic:()=>this._params.createGraphic(ea,M,ia.point)}}},ba=(ia,ma)=>{const ea=V(ma);ia.set(ea,`${ma.layerUid}/${ma.node.id}/${ma.pointId}`,
ma.dist,ma.normal,d.IDENTITY,void 0);ia.intersector="PointRenderer"};if(null!=Y.dist){var fa=G.results.min;(null==fa.dist||Y.dist<fa.dist)&&ba(fa,Y)}null!=U.dist&&0!==G.options.store&&(fa=G.results.max,(null==fa.dist||U.dist>fa.dist)&&ba(fa,U));if(2===G.options.store){fa=v.ray.fromPoints(K,J);for(const ia of N){const ma=new w.IntersectorResult(fa);ba(ma,ia);G.results.all.push(ma)}}};F.render=function(G){if(0!==G.pass&&2!==G.pass&&5!==G.pass)return!1;const I=2===G.pass,K=G.rctx;this.nodes.forAll(H=>
{null==H.vao&&this._initNode(G,H)});const J=this._getSizeParams(),L=this.selectTechnique(G,J),P=L.program;if(null==P||0===this.nodes.length)return!0;const Q=this._clipBox,X=!h.equals(Q,h.POSITIVE_INFINITY,(H,R)=>H===R);X||(k.set(this.tempVec3,-Infinity,-Infinity,-Infinity),P.setUniform3fv("uClipMin",this.tempVec3),k.set(this.tempVec3,Infinity,Infinity,Infinity),P.setUniform3fv("uClipMax",this.tempVec3));K.bindProgram(P);L.bindPipelineState(K);P.setUniformMatrix4fv("uProjectionMatrix",G.camera.projectionMatrix);
I&&P.setUniform2f("nearFar",G.camera.near,G.camera.far);G.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/G.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/G.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=G.highlightDepthTexture,D.OutputHighlight.bindOutputHighlight(K,P,this._bindParameters));const aa=G.camera.pixelRatio;J.drawFixedSize&&P.setUniform2f("uPointScale",J.fixedSize*aa,G.camera.fullHeight);const S=this._slicePlaneEnabled?G.sliceHelper&&G.sliceHelper.plane:
null;this.nodes.forAll(H=>{if(0!==H.coordinates.length&&(!G.isHighlightPass||H.highlights)){P.setUniform2f("uScreenMinMaxSize",J.screenMinSize*aa,(H.isLeaf?256:64)*aa);J.drawFixedSize||P.setUniform2f("uPointScale",H.splatSize*this._scaleFactor*aa,G.camera.fullHeight/aa);var R=H.origin;X&&(k.set(this.tempVec3,Q[0]-R[0],Q[1]-R[1],Q[2]-R[2]),P.setUniform3fv("uClipMin",this.tempVec3),k.set(this.tempVec3,Q[3]-R[0],Q[4]-R[1],Q[5]-R[2]),P.setUniform3fv("uClipMax",this.tempVec3));c.identity(this.tempMatrix4);
c.translate(this.tempMatrix4,this.tempMatrix4,R);c.multiply(this.tempMatrix4,G.camera.viewMatrix,this.tempMatrix4);P.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);y.Slice.bindUniforms(P,L.configuration,S,R);K.bindVAO(H.vao);G.isHighlightPass?this._renderHighlightFragments(K,H):K.drawArrays(0,0,H.coordinates.length/3)}});return!0};F._renderHighlightFragments=function(G,I){var K=I.highlights;if(!b.isNone(K)){I=b.unwrap(K[0].component);var J=I+1;for(let L=1;L<K.length;L++){const P=b.unwrap(K[L].component);
P!==J&&(J-=I,0<J&&G.drawArrays(0,I,J),I=P);J=P+1}K=J-I;0<K&&G.drawArrays(0,I,K)}};F.addNode=function(G){this.nodes.push(G);this._highlights.nodeAdded(G);this._requestRender()};F.removeNode=function(G){let I=null;this.nodes.filterInPlace(K=>K.id===G?(I=K,K.vao=b.disposeMaybe(K.vao),this._highlights.nodeRemoved(K),!1):!0);this._requestRender();return I};F.forEachNode=function(G){this.nodes.forAll(G)};F.removeAll=function(){this.nodes.forAll(G=>G.vao=b.disposeMaybe(G.vao));this._highlights.removeAll();
this.nodes.clear();this._requestRender()};F.highlight=function(G){return this._highlights.add(G)};F.addHighlight=function(G,I,K){var J=G.highlights;b.isNone(J)&&(J=[]);I={component:I,id:K};J.push(I);I=x(I);for(K=J.length-1;0<K&&I<x(J[K-1]);)[J[K-1],J[K]]=[J[K],J[K-1]],--K;G.highlights=J;this._requestRender()};F.removeHighlight=function(G,I){G.highlights=m(G.highlights,I);this._requestRender()};F._initNode=function(G,I){G=G.rctx;I.vao=new l(G,n.Default3D,B,{positions:t.createVertex(G,35044,I.coordinates),
colors:t.createVertex(G,35044,I.rgb)})};F._requestRender=function(){this._context&&this._context.requestRender()};F._getSizeParams=function(){const G=this._useFixedSizes,I=G&&!this._useRealWorldSymbolSizes,K=I?this._sizePx:this._size;let J=this._minSizePx;G&&(J=0);return{drawScreenSpace:I,drawFixedSize:G,fixedSize:K,screenMinSize:J}};F.selectTechnique=function(G,I){this._techniqueConfig.drawScreenSize=I.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=
G.hasOccludees;this._techniqueConfig.output=2===G.pass?1:5===G.pass?4:0;return this._techniqueRep.acquireAndReleaseExisting(C.PointRendererTechnique,this._techniqueConfig,this._technique)};g._createClass(E,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._useFixedSizes},set:function(G){this._useFixedSizes!==G&&(this._useFixedSizes=G,this._requestRender())}},{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(G){this._scaleFactor!==
G&&(this._scaleFactor=G,this._requestRender())}},{key:"minSizePx",get:function(){return this._minSizePx},set:function(G){this._minSizePx!==G&&(this._minSizePx=G,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._useRealWorldSymbolSizes},set:function(G){this._useRealWorldSymbolSizes!==G&&(this._useRealWorldSymbolSizes=G,this._requestRender())}},{key:"size",get:function(){return this._size},set:function(G){this._size!==G&&(this._size=G,this._requestRender())}},{key:"sizePx",
get:function(){return this._sizePx},set:function(G){this._sizePx!==G&&(this._sizePx=G,this._requestRender())}},{key:"clippingBox",set:function(G){h.set(this._clipBox,G||h.POSITIVE_INFINITY)}},{key:"slicePlane",get:function(){return this._slicePlaneEnabled},set:function(G){this._slicePlaneEnabled!==G&&(this._slicePlaneEnabled=G,this._requestRender())}},{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return E}();(function(E){E.isInstanceOfNode=function(F){return F.hasOwnProperty("splatSize")}})(a.PointRenderer||
(a.PointRenderer={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/handleUtils","../../webgl-engine/lib/Object3DStateID"],function(a,g,b,p,f){let k=function(){function d(h){this.context=h;this.highlights=new Set}var e=d.prototype;e.destroy=function(){this.highlights=null};e.add=function(h){const n=new c(h);this.highlights.add(n);this.enableSet(n);
return p.makeHandle(()=>this.removeSet(n))};e.removeSet=function(h){this.disableSet(h);this.highlights.delete(h)};e.enableSet=function(h){h.enabled||(h.enabled=!0,this.context.forEachNode(n=>this.enableSetForNode(h,n)))};e.enableSetForNode=function(h,n){if(h.enabled){var q=h.ids.get(n.id);q&&q.forEach(u=>this.context.addHighlight(n,u,h.id))}};e.disableSet=function(h){h.enabled&&(h.enabled=!1,this.context.forEachNode(n=>this.disableSetForNode(h,n)))};e.disableSetForNode=function(h,n){h.enabled||this.context.removeHighlight(n,
h.id)};e.nodeAdded=function(h){this.highlights.forEach(n=>this.enableSetForNode(n,h))};e.nodeRemoved=function(h){this.highlights.forEach(n=>this.disableSetForNode(n,h))};e.removeAll=function(){this.highlights.forEach(h=>this.disableSet(h))};g._createClass(d,[{key:"hasHighlights",get:function(){return 0<this.highlights.size}}]);return d}(),c=function(){function d(e){this.id=new f.Object3DStateID(0);this.ids=new Map;this.enabled=!1;for(const h of e)b.isSome(h)&&this.add(h.nodeId,h.pointId)}d.prototype.add=
function(e,h){const n=this.ids.get(e);n?n.add(h):this.ids.set(e,new Set([h]))};return d}();a.PointHighlights=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q){k=function(u){function v(l,w){return u.call(this,l,w)||this}b._inheritsLoose(v,u);var t=v.prototype;t.initializeProgram=function(l){var w=v.shader.get();const y=this.configuration;w=w.build({output:y.output,slicePlaneEnabled:y.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:y.drawScreenSize});return new e(l.rctx,w.generateSource("vertex"),w.generateSource("fragment"),d.Default3D)};t.initializePipeline=function(){return h.makePipelineState({depthTest:{func:513},
depthWrite:h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?n.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?n.stencilBaseAllZerosParams:null})};return v}(k.ShaderTechnique);k.shader=new f.ReloadableShaderModule(q.PointRendererShader,()=>new Promise(function(u,v){a(["./PointRenderer.glsl"],u,v)}));f=function(u){function v(){var t=u.apply(this,arguments)||this;t.output=0;t.slicePlaneEnabled=!1;t.drawScreenSize=
!1;t.sceneHasOcludees=!1;return t}b._inheritsLoose(v,u);return v}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],f.prototype,"output",void 0);p.__decorate([c.parameter()],f.prototype,"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],f.prototype,"drawScreenSize",void 0);p.__decorate([c.parameter()],f.prototype,"sceneHasOcludees",void 0);g.PointRendererTechnique=k;g.PointRendererTechniqueConfiguration=f;Object.defineProperty(g,"__esModule",{value:!0})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl".split(" "),
function(a,g,b,p,f,k){function c(e){const h=new b.ShaderBuilder,n=0===e.output,q=1===e.output,u=4===e.output;h.extensions.add("GL_OES_standard_derivatives");h.include(p.Slice,e);h.attributes.add("position","vec3");h.attributes.add("color","vec3");h.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");q?(h.vertex.uniforms.add("nearFar","vec2"),h.varyings.add("depth","float")):
4!==e.output&&h.varyings.add("vColor","vec3");h.vertex.code.add(g.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${e.drawScreenSize?g.glsl`
      float clampedScreenSize = pointSize;`:g.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${q?g.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${n?g.glsl`vColor = color;`:""}
    }
  `);h.fragment.include(f.RgbaFloatEncoding,e);u&&h.include(k.OutputHighlight);h.fragment.code.add(g.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${q?g.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${u?g.glsl`outputHighlight();`:""}
      ${n?g.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return h}var d=Object.freeze({__proto__:null,build:c});a.PointRendererShader=d;a.build=c})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){a.PopupSceneLayerView=w=>{w=function(y){function D(){return y.apply(this,arguments)||this}g._inheritsLoose(D,y);var z=D.prototype;z._validateFetchPopupFeatures=function(r){const {layer:C}=this,{popupEnabled:A}=C;if(!A)return new n("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:C});if(!l.getFetchPopupTemplate(C,r))return new n("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:C})};z.prepareFetchPopupFeatures=
async function(r){};z.fetchPopupFeatures=async function(r,C){if(r=this._validateFetchPopupFeatures(C))return Promise.reject(r);r=f.isSome(C)?C.clientGraphics:null;if(!r||0===r.length)return Promise.resolve([]);const A=[],x=[];var m="scene"===this.layer.type&&f.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;C=t.unpackFieldNames(this.layer.fields,await l.getRequiredFields(m,l.getFetchPopupTemplate(this.layer,C)));await this.prepareFetchPopupFeatures(C);m=new Set;for(const B of r)t.populateMissingFields(C,
B,m)?x.push(B):A.push(B);return 0===x.length?Promise.resolve(A):this.whenGraphicAttributes(x,[...m]).catch(()=>x).then(B=>A.concat(B))};return D}(w);return w=b.__decorate([h.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../Graphic ../../support/Scheduler ../../../core/sql/WhereClause ../../../tasks/support/Query ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/support/FeatureFilter ../../layers/SceneLayerView ./i3s/I3SUtil ./i3s/I3SGeometryUtil ./I3SMeshView3D ./i3s/I3SMeshViewFilter ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./support/DefinitionExpressionSceneLayerView ./support/floorFilterUtils ./support/PopupSceneLayerView ./i3s/attributeEditing ./support/fieldProperties ./support/SceneLayerViewRequiredFields".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L){const P=f.getLogger("esri.views.3d.layers.SceneLayerView3D");b=J.defineFieldProperties();w=function(Q){function X(){var S=Q.apply(this,arguments)||this;S.lodFactor=1;S.progressiveLoadFactor=1;S._elevationContext="scene";S._isIntegratedMesh=!1;S._supportsLabeling=!0;S._interactiveEditingSessions=new Map;S._queryEngine=null;return S}a._inheritsLoose(X,Q);var aa=X.prototype;aa.initialize=function(){this.fieldsHelper=new L.SceneLayerViewRequiredFields({layerView:this});
this.updatingHandles.add(this.layer,"rangeInfos",S=>this._rangeInfosChanged(S),2);this.updatingHandles.add(this.layer,"renderer",S=>this.updatingHandles.addPromise(this._rendererChange(S)),2);for(const S of"parsedDefinitionExpression filter viewFilter.parsedWhereClause viewFilter.parsedGeometry viewFilter.sortedObjectIds floorFilterClause".split(" "))this.updatingHandles.add(this,S,()=>this._filterChange());for(const S of["filter","viewFilter.parsedGeometry"])this.updatingHandles.add(this,S,()=>this._geometryFilterChange());
this.handles.add(this.layer.on("apply-edits",S=>this.updatingHandles.addPromise(S.result)));this.handles.add(this.layer.on("edits",S=>this._handleEdits(S)))};aa.destroy=function(){this.fieldsHelper=p.destroyMaybe(this.fieldsHelper)};aa._rangeInfosChanged=function(S){null!=S&&0<S.length&&P.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};aa.createQuery=function(){const S={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};
return p.isSome(this.filter)?this.filter.createQuery(S):new l(S)};aa.queryExtent=function(S,H){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(S),null==H?void 0:H.signal)};aa.queryFeatureCount=function(S,H){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(S),null==H?void 0:H.signal)};aa.queryFeatures=function(S,H){return this._ensureQueryEngine().executeQuery(this._ensureQuery(S),null==H?void 0:H.signal).then(R=>{if(null==R||!R.features)return R;const T=
this.layer;for(const W of R.features)W.layer=T,W.sourceLayer=T;return R})};aa.queryObjectIds=function(S,H){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(S),null==H?void 0:H.signal)};aa._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};aa._createQueryEngine=function(){const S=C.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new m["default"]({layerView:this,
task:v.Task.FEATURE_QUERY_ENGINE,spatialIndex:new E["default"]({featureAdapter:new B.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:S}),forAllFeatures:(H,R)=>this._forAllFeatures((T,W,Y)=>H({id:T,index:W,meta:Y}),R,2),getFeatureExtent:S,sourceSpatialReference:r.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};aa.highlight=function(S){const H=this._highlights;if(S instanceof l){const {set:R,
handle:T}=H.acquireSet();this.queryObjectIds(S).then(W=>H.setFeatureIds(R,W));return T}return Q.prototype.highlight.call(this,S)};aa.createInteractiveEditSession=function(S){return K.createInteractiveEditSession(this.attributeEditingContext,S)};aa._createLayerGraphic=function(S){S=new u(null,null,S);S.layer=this.layer;S.sourceLayer=this.layer;return S};aa.canResume=function(){return Q.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};aa.getFilters=function(){const S=
Q.prototype.getFilters.call(this);this.floorFilterClause&&this.addSqlFilter(S,this.floorFilterClause,this.logError);this.addSqlFilter(S,this.parsedDefinitionExpression,this.logError);p.isSome(this.viewFilter)&&this.viewFilter.addFilters(S,this.view,this._controller.crsIndex,this._collection);return S};aa._ensureQuery=function(S){return this._addDefinitionExpressionToQuery(p.isNone(S)?this.createQuery():l.from(S))};aa._handleEdits=function(S){K.processAttributeEdits(this.attributeEditingContext,S)};
aa.computeNodeFiltering=function(S){var H=this.viewFilter;H=p.isNone(H)||H.isMBSGeoemtryVisible(S.mbs,this.view.spatialReference,this._controller.crsIndex);S.filterImpact=H?0:1};a._createClass(X,[{key:"filter",get:function(){return p.isSome(this.viewFilter)?this.viewFilter.filter:null},set:function(S){p.isNone(S)||!x.I3SMeshViewFilter.checkSupport(S)?this.viewFilter=null:p.isSome(this.viewFilter)?this.viewFilter.filter=S:this.viewFilter=new x.I3SMeshViewFilter({filter:S,layerFieldsIndex:this.layer.fieldsIndex,
loadAsyncModule:H=>this._loadAsyncModule(H),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(H,R)=>this.addSqlFilter(H,R,this.logError)})}},{key:"requiredFields",get:function(){var S,H;return null!=(S=null==(H=this.fieldsHelper)?void 0:H.requiredFields)?S:[]}},{key:"floorFilterClause",get:function(){const S=G.getFloorFilterClause(this);return p.isSome(S)?t.WhereClause.create(S,this.layer.fieldsIndex):null}},{key:"lodCrossfadeinDuration",get:function(){var S,H;return null!=(S=null==(H=this.view)?
void 0:H.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?S:0}},{key:"lodCrossfadeoutDuration",get:function(){var S,H;return null!=(S=null==(H=this.view)?void 0:H.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?S:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var S,H;return null!=(S=null==(H=this.view)?void 0:H.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?S:0}},{key:"attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:S=>this._forAllNodes(H=>p.isSome(H)?S(H.node,H.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:S=>this.getAttributeData(S),setAttributeData:(S,H)=>this.setAttributeData(S,H),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const S=this.viewFilter;return p.isSome(S)&&p.isSome(S.parsedGeometry)}}]);
return X}(A.I3SMeshView3D(F.DefinitionExpressionSceneLayerView(I.PopupSceneLayerView(w.LayerView3D(z)))));g.__decorate([c.property({aliasOf:"layer"})],w.prototype,"i3slayer",void 0);g.__decorate([c.property()],w.prototype,"suspended",void 0);g.__decorate([c.property(y.updatingProgress)],w.prototype,"updatingProgress",void 0);g.__decorate([c.property({type:D})],w.prototype,"filter",null);g.__decorate([c.property()],w.prototype,"viewFilter",void 0);g.__decorate([c.property(b.requiredFields)],w.prototype,
"requiredFields",null);g.__decorate([c.property(b.availableFields)],w.prototype,"availableFields",void 0);g.__decorate([c.property()],w.prototype,"fieldsHelper",void 0);g.__decorate([c.property()],w.prototype,"floorFilterClause",null);g.__decorate([c.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],w.prototype,"lodFactor",void 0);g.__decorate([c.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],w.prototype,"updatingProgressValue",void 0);return w=
g.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],w)})},"esri/views/layers/SceneLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ./LayerView".split(" "),function(a,
g,b,p,f,k,c,d,e,h,n,q){b=function(u){function v(){var l=u.apply(this,arguments)||this;l.layer=null;l.filter=null;return l}a._inheritsLoose(v,u);var t=v.prototype;t.highlight=function(l){throw Error("Not implemented");};t.queryFeatures=function(l,w){throw Error("Not implemented");};t.queryObjectIds=function(l,w){throw Error("Not implemented");};t.queryFeatureCount=function(l,w){throw Error("Not implemented");};t.createQuery=function(){throw Error("Not implemented");};t.queryExtent=function(l,w){throw Error("Not implemented");
};a._createClass(v,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(l){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return v}(q);g.__decorate([k.property()],b.prototype,"layer",void 0);g.__decorate([k.property()],b.prototype,"availableFields",null);g.__decorate([k.property()],b.prototype,"maximumNumberOfFeatures",null);g.__decorate([k.property({readOnly:!0})],b.prototype,"maximumNumberOfFeaturesExceeded",
null);g.__decorate([k.property()],b.prototype,"filter",void 0);return b})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),function(a,g,b,p,f,k){function c(h,n,q,u){h=n.getComponentAabb(q,h,d);n=n.getObjectTransform(q);for(q=0;8>q;++q)e[0]=q&1?h[0]:h[3],e[1]=q&2?h[1]:h[4],e[2]=q&4?h[2]:h[5],p.transformMat3(e,e,n.rotationScale),
p.add(e,e,n.position),u[3*q]=e[0],u[3*q+1]=e[1],u[3*q+2]=e[2];return u}const d=k.create(),e=b.create();a.boundingBoxCornerPoints=c;a.boundingBoxTop=function(h,n,q,u){h=n.getComponentAabb(q,h,d);n=n.getObjectTransform(q);u[0]=0;u[1]=0;u[2]=0;for(q=0;8>q;++q)e[0]=q&1?h[0]:h[3],e[1]=q&2?h[1]:h[4],e[2]=h[5],p.transformMat3(e,e,n.rotationScale),p.add(e,e,n.position),u[0]+=e[0],u[1]+=e[1],u[2]+=e[2];u[0]/=8;u[1]/=8;u[2]/=8;return u};a.createGetFeatureExtent=function(h,n,q){const u=new Float64Array(24);
return v=>{var t=v.meta.featureExtents;if(g.isNone(t)){t=new Float64Array(6*v.meta.featureIds.length);v.meta.featureExtents=t;for(let l=0;l<t.length;l+=6)t[l]=Number.POSITIVE_INFINITY}t=new Float64Array(t.buffer,6*v.index*Float64Array.BYTES_PER_ELEMENT,6);t[0]===Number.POSITIVE_INFINITY&&(c(v.index,q,v.meta.objectHandle,u),f.projectBuffer(u,n,0,u,h,0,8)?(k.set(t,k.NEGATIVE_INFINITY),k.expandWithBuffer(t,u,0,8)):k.set(t,k.ZERO));return t}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/typedArrayUtil ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/Collection ../../../support/arcadeOnDemand ../../../layers/support/fieldUtils ../../../core/mathUtils ../../../Color ../../../symbols/Symbol3D ../../../Graphic ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/unitUtils ../../../renderers/visualVariables/support/visualVariableUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../geometry/projection ../../../symbols/support/unitConversionUtils ../../../core/MapUtils ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../chunks/vec4 ../../../layers/support/SceneModification ../../../geometry/support/aaBoundingBox ../../../layers/support/layerUtils ../../../chunks/mat3f32 ../support/buffer/glUtil ../support/debugFlags ../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ./graphics/graphicUtils ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/Texture ../support/extentUtils ./support/layerViewUpdatingProperties ../support/orientedBoundingBox ../webgl-engine/collections/Component/SourceGeometry ./i3s/I3SProjectionUtil ./i3s/I3SUtil ../../../layers/graphics/controllers/I3SOnDemandController ./i3s/I3SGeometryUtil ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./SceneLayerWorker ./i3s/Highlights ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SIntersectionHandler ./i3s/IDBCache ./support/attributeUtils ../webgl-engine/core/material/RenderTexture ../webgl-engine/core/shaderLibrary/util/EllipsoidMode".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha,na,da,oa,qa,ua,Ca,Ja,Ha,Na){function Oa(Ga){const Sa=Ga.metallicRoughness;return Sa&&0<=Sa.baseColorTextureId||Sa&&0<=Sa.metallicRoughnessTextureId||0<=Ga.normalTextureId||0<=Ga.emissiveTextureId||0<=Ga.occlusionTextureId}function Va(Ga,Sa,Ta){if(c.isNone(Ga)||0===Ta)return null;for(let Ra=0;Ra<Ga.length;Ra++){const ra=Ga[Ra];if(c.isSome(ra)&&0!==(ra.usage&Ta))return Sa[Ra].id}return null}
function Ka(Ga){return c.isSome(Ga)&&k.isArrayBuffer(Ga.data)}function wa(Ga,Sa){Ga=1024+Ga.interleavedVertexData.byteLength+(Ga.indices?Ga.indices.byteLength:0)+Ga.positionData.data.byteLength+Ga.positionData.indices.byteLength;if(c.isSome(Sa))for(const Ta of Sa)c.isSome(Ta)&&k.isArrayBuffer(Ta.data)&&(Ga+=Ta.data.byteLength);return Ga}function Ea(Ga,Sa){return 104857600<Sa.byteSize?(Ya.warn(`Node is too big to store in IndexedDB cache: ${Ga.id} (${Sa.byteSize} bytes)`),!1):0<Sa.byteSize}function Pa(Ga){if(0===
Ga.length)return null;const Sa=new Float64Array(10*Ga.length);Ga.forAll((Ta,Ra)=>{let ra=Ta.serviceObb;c.isNone(ra)&&(ra=ta,E.copy(ra.center,Ta.mbs),ra.halfSize[0]=ra.halfSize[1]=ra.halfSize[2]=Ta.mbs[3]);Ta=10*Ra;Sa[Ta+0]=ra.center[0];Sa[Ta+1]=ra.center[1];Sa[Ta+2]=ra.center[2];Sa[Ta+3]=ra.halfSize[0];Sa[Ta+4]=ra.halfSize[1];Sa[Ta+5]=ra.halfSize[2];Sa[Ta+6]=ra.quaternion[0];Sa[Ta+7]=ra.quaternion[1];Sa[Ta+8]=ra.quaternion[2];Sa[Ta+9]=ra.quaternion[3]});return Sa}function ja(Ga,Sa){Ga.forEach(Ta=>
Ta.opacity=Sa)}const Ya=d.getLogger("esri.views.3d.layers.SceneLayerView3D"),ab=[1,1,1,1];let cb=function(Ga){function Sa(Ta,Ra,ra,Aa,Ma,Qa,Wa){var bb=Ga.call(this)||this;bb.node=Ta;bb.featureIds=Ra;bb.objectHandle=ra;bb.cachedRendererVersion=Aa;bb.attributeInfo=Ma;bb.material=Qa;bb.textures=Wa;bb.cachedEdgeMaterials=[];bb.cachedSymbology=null;return bb}b._inheritsLoose(Sa,Ga);return Sa}(oa.NodeCrossfadeMetaData);const lb=H.create(),Xa=H.create(),ta=fa.create(),Ba=[0,0,0,0],va=new A([0,0,0,0]),za=
[0,0,0,0],Da={remove(){},pause(){},resume(){}};g.I3SMeshView3D=Ga=>{Ga=function(Sa){function Ta(){var ra=Sa.apply(this,arguments)||this;ra._elevationProvider=null;ra._intersectionHandler=null;ra._nodeId2Meta=new Map;ra._nodeId2MetaReloading=new Map;ra._i3sWasmLoaded=!1;ra._hasLoadedPBRTextures=!1;ra._asyncModuleLoading=0;ra._addTasks=new Map;ra._rendererVersion=0;ra._colorVariable=null;ra._opacityVariable=null;ra._rendererFields=null;ra._symbologyFields=null;ra._symbologyOverride=null;ra._symbologyOverrideFields=
null;ra._symbolInfos=new Map;ra._idbCache=new Ca.IDBCache("esri-scenelayer-cache","geometries");ra.holeFilling="auto";ra._hasColors=!1;ra._hasTextures=!1;ra._hasData=!1;ra.slicePlaneEnabled=!1;ra._modifications=[];ra._layerUrl="";ra._cacheKeySuffix=null;ra._arcade=null;ra._tmpAttributeOnlyGraphic=new m(null,null,{});ra._crossfadeHelper=new oa.I3SCrossfadeHelper(b._assertThisInitialized(ra));return ra}b._inheritsLoose(Ta,Sa);var Ra=Ta.prototype;Ra.initialize=function(){var ra;this.preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);
this.attributeOverrides=new da.I3SAttributeOverrides(this.i3slayer,null==(ra=this.view.resourceController)?void 0:ra.memoryController);this._worker=new ka.I3SMeshWorkerHandle(this.view.resourceController.scheduler);this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);ea.checkSceneLayerValid(this.i3slayer);ea.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=
new M({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new na({collection:this._collection,forAllFeatures:Aa=>this._forAllFeatures(Aa,null,1),forAllFeaturesOfNode:(Aa,Ma)=>this._forAllFeaturesOfNode(Aa,Ma)});this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema?this._hasSymbolColors=!1:(ra=this.i3slayer.store.defaultGeometrySchema.featureAttributes,
this._hasSymbolColors=!!(ra&&ra.faceRange&&ra.id));this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.i3slayer.uid,Aa=>this._deleteComponentObject(Aa));this._intersectionHandler=new ua.I3SIntersectionHandler({layerUid:this.layerUid,
sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,forEach:Aa=>{this._nodeId2Meta.forEach(Ma=>c.isSome(Ma)&&Aa(Ma.node,Ma.objectHandle));this._nodeId2MetaReloading.forEach(Ma=>c.isSome(Ma)&&Aa(Ma.node,Ma.objectHandle))}});this._elevationProvider=new qa({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(this,"view.clippingArea",()=>this._clippingAreaChanged(),
2);this.updatingHandles.add(this,"fullOpacity",Aa=>this._opacityChange(Aa));this.updatingHandles.add(this,"slicePlaneEnabled",Aa=>this._slicePlaneEnabledChange(Aa));this.updatingHandles.add(this,"elevationOffset",(Aa,Ma)=>{this._reloadAll(Ma);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(this,"filter",()=>this._filterChange(),2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",()=>this._updatePBR());ra=()=>{this._reloadAll();this.clearMemCache()};
this.updatingHandles.add(this,"rendererTextureUsage",ra);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",ra);this.updatingHandles.add(this,"suspended",Aa=>this._suspendedChange(Aa),2);this.updatingHandles.add(this.i3slayer,"labelsVisible",()=>this._labelingChanged(),2);this.updatingHandles.add(this.i3slayer,"labelingInfo",()=>this._labelingChanged(),2);this.updatingHandles.add(this,"_modifications",()=>this._modificationsChanged(),2);this.handles.add([I.init(Y,"I3S_TREE_SHOW_TILES",
Aa=>{if(Aa&&!this._treeDebugger){const Ma=this._controller.crsIndex;(new Promise(function(Qa,Wa){a(["./support/I3STreeDebugger"],Qa,Wa)})).then(({I3STreeDebugger:Qa})=>{!this._treeDebugger&&Y.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Qa({lv:this,view:this.view,nodeSR:Ma}))})}else Aa||Y.I3S_TREE_SHOW_TILES||(this._treeDebugger=c.destroyMaybe(this._treeDebugger))}),I.init(Y,"I3S_SHOW_MODIFICATIONS",()=>this._showModifications())]);this._cacheKeySuffix=ea.getCacheKeySuffix(this.i3slayer.spatialReference,
this.view.renderSpatialReference);this._idbCache.init().catch(Aa=>Ya.warn(`Failed to initialize IndexedDB cache: ${Aa}`))};Ra.destroy=function(){this._clearAddTasks();this.attributeOverrides=c.destroyMaybe(this.attributeOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),
this._intersectionHandler=null);const ra=this._worker;ra&&(ra.destroyContext(this.i3slayer.uid).then(()=>ra.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=c.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=c.destroyMaybe(this._labeler);this._treeDebugger=c.destroyMaybe(this._treeDebugger);this._controller=c.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();
this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};Ra.memEstimateTextureAdded=function(ra){ra=ra.estimatedTexMemRequired;this.gpuMemoryEstimate+=ra;this.texMemoryEstimate+=ra;return ra};Ra.memEstimateTextureRemoved=function(ra){ra=ra.estimatedTexMemRequired;this.gpuMemoryEstimate-=ra;this.texMemoryEstimate-=ra};Ra.memEstimateGeometryAdded=function(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);
this.gpuMemoryEstimate+=ra;this.geoMemoryEstimate+=ra;return ra};Ra.memEstimateGeometryRemoved=function(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);this.gpuMemoryEstimate-=ra;this.geoMemoryEstimate-=ra};Ra.isNodeLoaded=function(ra){return this._nodeId2Meta.has(ra)};Ra.isNodeReloading=function(ra){return this._nodeId2MetaReloading.has(ra)};Ra.getUsedMemory=function(){let ra=c.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Aa=>ra+=c.isSome(Aa)?Aa.node.memory:0);this._nodeId2MetaReloading.forEach(Aa=>
ra+=c.isSome(Aa)?Aa.node.memory:0);return ra};Ra.getUnloadedMemory=function(){return(c.isSome(this._controller)?this._controller.unloadedMemoryEstimate:0)+(c.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};Ra.ignoresMemoryFactor=function(){return!1};Ra._labelingChanged=function(){if(!R.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)c.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!c.isSome(this._labeler)){var ra=new la({view:this.view,layer:this.i3slayer,
collection:this._collection});this._nodeId2Meta.forEach(Aa=>c.isSome(Aa)&&this._addMetaToLabeler(ra,Aa));this._labeler=ra}};Ra._loadAsyncModule=function(ra){++this._asyncModuleLoading;return ra.then(Aa=>{--this._asyncModuleLoading;return Aa},Aa=>{--this._asyncModuleLoading;throw Aa;})};Ra._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this._hasModifications)this._i3sWasmLoaded=ha.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();
else if(!0===this._i3sWasmLoaded){var ra=this.i3slayer.uid,Aa=this.i3slayer.spatialReference;this._worker.setModifications(ra,this._modifications,Aa);var Ma=ka.toWasmModification(this._modifications,Aa);ha.setModificationsSync({context:ra,modifications:Ma,isGeodetic:Aa.isGeographic});this._controller.modificationsChanged();var Qa=this._hasModifications?new l:null;this._nodeId2Meta.forEach((Wa,bb)=>{c.isNone(Wa)?this._nodeId2Meta.delete(bb):Wa.node.hasModifications?(this._nodeId2Meta.delete(bb),this._nodeId2MetaReloading.set(bb,
Wa)):c.isSome(Qa)&&Qa.push(Wa.node)});c.isSome(Qa)&&this._nodeId2MetaReloading.forEach(Wa=>Qa.push(Wa.node));c.isSome(Qa)&&0<Qa.length&&(this.updateNodeModificationStatus(Qa),Qa.forAll(Wa=>{if(2!==Wa.imModificationImpact){const bb=this._nodeId2Meta.get(Wa.index);this._controller.invalidateGeometryVisibility(Wa.index);this._nodeId2Meta.delete(Wa.index);c.isSome(bb)&&this._nodeId2MetaReloading.set(Wa.index,bb)}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};
Ra._showModifications=function(){c.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(Y.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var ra={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Aa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ma of this._modifications)Ma.geometry.spatialReference=this.i3slayer.spatialReference,this._modificationGraphics.push(new m({geometry:Ma.geometry,
symbol:{...Aa,color:ra[Ma.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};Ra._addMetaToLabeler=function(ra,Aa){ra.addNodeMeta(Aa,(Ma,Qa)=>this._createAttributes(Ma,Qa))};Ra._suspendedChange=function(ra){ra?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,
this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};Ra.getLoadedAttributes=function(ra){ra=this._nodeId2Meta.get(ra);if(c.isSome(ra)&&c.isSome(ra.attributeInfo))return ra.attributeInfo.loadedAttributes};Ra.getAttributeData=function(ra){ra=this._nodeId2Meta.get(ra);if(c.isSome(ra)&&c.isSome(ra.attributeInfo))return ra.attributeInfo.attributeData};Ra.setAttributeData=function(ra,Aa){ra=this._nodeId2Meta.get(ra);c.isSome(ra)&&c.isSome(ra.attributeInfo)&&
(ra.attributeInfo.attributeData=Aa,this._attributeValuesChanged(ra))};Ra.updateAttributes=async function(ra,Aa,Ma){ra=this._nodeId2Meta.get(ra);c.isSome(ra)&&(await this.attributeOverrides.apply(ra.featureIds,Aa,Ma),ra.attributeInfo=Aa,this._attributeValuesChanged(ra))};Ra._attributeValuesChanged=function(ra){ra.cachedRendererVersion=this._getInvalidRendererVersion();ra.filteredIds=null;c.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(ra,(Aa,Ma)=>this._createAttributes(Aa,Ma));this._updateEngineObject(ra)};
Ra.clearMemCache=function(){c.isSome(this._memCache)&&this._memCache.clear()};Ra.getVisibleNodes=function(){const ra=[];this._nodeId2Meta.forEach(Aa=>c.isSome(Aa)&&ra.push(Aa.node));return ra};Ra.getLoadedNodeIndices=function(ra){this._nodeId2Meta.forEach((Aa,Ma)=>ra.push(Ma));this._nodeId2MetaReloading.forEach((Aa,Ma)=>ra.push(Ma))};Ra.preLoadBasis=function(){!f("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&1)&&c.applySome(this.i3slayer.textureSetDefinitions,ra=>ra.some(Aa=>Aa.formats.some(Ma=>
"basis"===Ma.format)))&&ca.loadBasis()};Ra._createTexture=function(ra,Aa,Ma,Qa){if(c.isNone(Ma)||null==Ma.data)return null;const {data:Wa,encoding:bb}=Ma,ib=Aa.wrapTextures;Aa=Ma.usage&1?"opaque"===Aa.alphaMode?3:4:3;Ma=!0;Wa instanceof HTMLImageElement&&(Ma=C.isPowerOfTwo(Wa.width)&&C.isPowerOfTwo(Wa.height));Ma=(!this.uncompressedTextureDownsamplingEnabled||8!==bb&&4!==bb)&&Ma;Qa={mipmap:Ma,wrap:Qa||!ib?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:Qa&&Ma&&this._disableAtlasAnisotropy,encoding:ea.encodingToMimeType(bb),
noUnpackFlip:!0,components:Aa};Qa=new O.Texture(Wa,Qa);this._stage.add(Qa);ra.memory+=this.memEstimateTextureAdded(Qa);return Qa};Ra._getVertexBufferLayout=function(ra,Aa){ra={hasTexture:Oa(ra.params.material),hasNormals:Aa.normal,hasRegions:Aa.uvRegion};return W.glLayout(ia.createVertexBufferLayout(this._getGeometryParameters(ra)))};Ra._getObjectIdField=function(){return this.i3slayer.objectIdField||"OBJECTID"};Ra._findGraphicNodeAndIndex=function(ra){const Aa=Ja.attributeLookup(this.i3slayer.fieldsIndex,
ra.attributes,this._getObjectIdField());let Ma=null;P.someMap(this._nodeId2Meta,Qa=>{if(c.isNone(Qa))return!1;const Wa=Qa.featureIds.indexOf(Aa);if(-1===Wa)return!1;Ma={node:Qa.node,index:Wa};return!0});return Ma};Ra._getGraphicIndices=function(ra,Aa){ra=this._nodeId2Meta.get(ra.index);if(c.isNone(ra))return[];const Ma=[],Qa=this._getObjectIdField(),Wa=this.i3slayer.fieldsIndex;for(const bb of Aa)Aa=Ja.attributeLookup(Wa,bb.attributes,Qa),Aa=ra.featureIds.indexOf(Aa),-1!==Aa&&Ma.push(Aa);return Ma};
Ra.whenGraphicBounds=function(ra){ra=this._findGraphicNodeAndIndex(ra);if(!ra)return Promise.reject();var Aa=this._nodeId2Meta.get(ra.node.index);if(c.isNone(Aa))return Promise.reject();ra=Z.boundingBoxCornerPoints(ra.index,this._collection,Aa.objectHandle,new Float64Array(24));if(J.projectBuffer(ra,this.view.renderSpatialReference,0,ra,this.view.spatialReference,0,8))return Aa=H.empty(),H.expandWithBuffer(Aa,ra,0,8),Promise.resolve({boundingBox:Aa,screenSpaceObjects:[]})};Ra.whenGraphicAttributes=
function(ra,Aa){return ea.whenGraphicAttributes(this.i3slayer,ra,this._getObjectIdField(),Aa,()=>[...this._nodeId2Meta.values()].filter(c.isSome))};Ra.getGraphicFromIntersectorMetadata=function(ra){if(null==ra.nodeIndex||null==ra.componentIndex)return null;const Aa=this._nodeId2Meta.get(ra.nodeIndex);return c.isNone(Aa)||null==Aa.featureIds||ra.componentIndex>=Aa.featureIds.length?null:this._createGraphic(ra.componentIndex,Aa)};Ra._getCacheKey=function(ra){return`${this._layerUrl}/v${17}/${ra.id}${this._cacheKeySuffix}`};
Ra._getMemCacheKey=function(ra,Aa=this.elevationOffset){return ra+"#"+Aa};Ra.loadCachedGPUData=function(ra){return c.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(ra.index)):null};Ra.deleteCachedGPUData=function(ra){c.isSome(ra)&&this._deleteComponentObject(ra)};Ra._cacheGPUData=function(ra,Aa=this.elevationOffset){if(c.isNone(this._memCache))this._deleteComponentObject(ra);else{var Ma=this._controller.indexDepth-ra.node.level;this._memCache.put(this._getMemCacheKey(ra.node.index,
Aa),ra,ra.node.memory,Ma)}};Ra.loadMissingTextures=function(ra,Aa,Ma,Qa){const Wa=ra.filter((bb,ib)=>{if(0===(bb.usage&this.rendererTextureUsage))return!1;if(c.isNone(Aa))return!0;bb=ea.selectEncoding(bb.encodings,this.supportedTextureEncodings);ib=Aa[ib];return c.isNone(ib)||null==ib.data||bb&&ib.encoding!==bb.encoding?!0:!1});return 0===Wa.length?Promise.resolve(!1):Ma(Wa,Qa).then(bb=>{let ib=0;for(let db=0;db<ra.length;db++)ib<bb.length&&bb[ib].id===ra[db].id&&(Aa[db]=bb[ib],ib++);return!0})};
Ra.loadCachedNodeData=function(ra,Aa,Ma){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(ra),Aa).then(Qa=>{if(null==Qa)return null;if(Qa.nodeVersion!==ra.version)return this._idbCache.remove(this._getCacheKey(ra)),null;ra.geometryObb=Qa.geometryObb;return this.loadMissingTextures(Qa.requiredTextures,Qa.textureData,Ma,Aa).then(Wa=>{Wa&&this._idbCache.initialized&&c.isSome(Qa.textureData)&&(Qa.byteSize=wa(Qa.transformedGeometry,Qa.textureData),Qa.textureData.every(Ka)&&Ea(ra,Qa)&&
this._idbCache.put(this._getCacheKey(ra),Qa).catch(bb=>Ya.warn(`Failed to update node with textures in IndexedDB cache: ${ra.id}: ${bb}`)));w.throwIfAborted(Aa);return Qa})}):Promise.resolve(null)};Ra.addNode=function(ra,Aa,Ma){return"geometryData"in Aa?this._addData(ra,Aa.attributeDataInfo,()=>this._transformNode(ra,Aa,Ma).then(Qa=>this._safeReschedule(()=>{if(c.isNone(Qa))return ra.hasModifications=!1,this._addCachedNodeData(ra,null,Ma);ra.hasModifications=Qa.transformedGeometry.hasModifications;
const {obb:Wa,componentOffsets:bb,featureIds:ib,transformedGeometry:db}=Qa;var Fa=ma.computeGlobalTransformation(ra.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference);ra.geometryObb=fa.create([Wa.center.x,Wa.center.y,Wa.center.z],[Wa.extents.x,Wa.extents.y,Wa.extents.z],[Wa.orientation.x,Wa.orientation.y,Wa.orientation.z,Wa.orientation.w]);E.transformMat4(ra.geometryObb.center,ra.geometryObb.center,Fa);Aa.geometryData.componentOffsets=bb;ib&&(Aa.geometryData.featureIds=
Array.prototype.slice.call(ib));Fa={nodeVersion:ra.version,geometryData:Aa.geometryData,requiredTextures:Aa.requiredTextures,textureData:Aa.textureData,transformedGeometry:db,globalTrafo:Fa,geometryObb:ra.geometryObb,byteSize:wa(db,Aa.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&Ea(ra,Fa)){const La=c.isSome(Fa.textureData)?Fa.textureData.map($a=>Ka($a)?$a:null):null;this._idbCache.put(this._getCacheKey(ra),{...Fa,textureData:La}).catch($a=>Ya.warn(`Failed to store node in IndexedDB cache: ${ra.id}: ${$a}`))}return this._addCachedNodeData(ra,
Fa,Ma)},Ma))):Promise.reject()};Ra.computeVisibilityObb=function(ra){return ea.computeVisibilityObb(ra,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Ra._transformNode=function(ra,Aa,Ma){var Qa=Aa.geometryData.geometries;const Wa=Array(Qa.length);for(var bb=0;bb<Qa.length;++bb)Wa[bb]=this._getVertexBufferLayout(Qa[bb],Aa.geometryDescriptor);Qa=ra.mbs;bb=this.elevationOffset;var ib=this._controller.crsIndex,db=this._controller.crsVertex;
const Fa=this.view.renderSpatialReference,La=ma.getLocalOrigin(Qa,bb,ib),$a=ma.computeGlobalTransformation(Qa,bb,ib,Fa);ib=J.getProjectorName(ib,db);db=J.getProjectorName(db,Fa);return c.isNone(ib)||c.isNone(db)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:Aa.geometryBuffer,geometryData:Aa.geometryData,geometryDescriptor:Aa.geometryDescriptor,layouts:Wa,localOrigin:La,globalTrafo:$a,mbs:Qa,obb:ra.serviceObb,elevationOffset:bb,needNormals:!this._isIntegratedMesh&&
this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:ib,vertexToRenderProjector:db},Ma)};Ra._setNewNodeOpacity=function(ra){this._setNodeOpacity(ra,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Ra.addCachedGPUData=function(ra,Aa,Ma){ra.geometryObb=fa.clone(this._collection.getComponentObb(Aa.objectHandle));this._controller.isGeometryVisible(ra)?(c.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Aa),ra=ra.index,this._addNodeMeta(ra,
Aa),this.updateNodeState(ra,Ma),this._collection.setObjectVisibility(Aa.objectHandle,!0),this._updateMaterial(Aa),this._setNewNodeOpacity(Aa),this._updateEngineObject(Aa),this._highlights.objectCreated(Aa),c.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Aa)};Ra.addCachedNodeData=function(ra,Aa,Ma,Qa){return this._addData(ra,Ma,()=>this._addCachedNodeData(ra,Aa,Qa))};Ra._addCachedNodeData=async function(ra,Aa,Ma){if(this.suspended||!this._controller.isGeometryVisible(ra))this._removeNodeStageData(ra.index,
this.elevationOffset,this._nodeId2MetaReloading);else if(c.isNone(Aa))this._addNodeMeta(ra.index,null);else{var Qa=this._addTasks.get(ra.index),{geometryData:Wa,transformedGeometry:bb,globalTrafo:ib}=Aa;await this.attributeOverrides.apply(Wa.featureIds,Qa.attributeInfo,Ma);var db=c.isSome(Aa.textureData)?Aa.textureData.filter(wb=>c.isSome(wb)&&0!==(wb.usage&this.rendererTextureUsage)):[];!f("disable-feature:i3s-basis")&&db.some(wb=>c.isSome(wb)&&1===wb.encoding)&&await ca.loadBasis();ra.memory=0;
var {componentOffsets:Fa,geometries:La,featureIds:$a}=Wa,eb=this._collection,fb=La[0],{layout:hb,indices:jb,interleavedVertexData:sb,positionData:Ab,hasColors:Ib}=bb,Gb=this._materialParameters(fb,hb),Tb=Fa||new Uint32Array([0,jb?jb.length:sb.byteLength/hb[0].stride]);Tb={vertices:{data:sb,count:sb.byteLength/hb[0].stride,layoutParameters:Gb.geometryParams},positionData:{positions:Ab.data,indices:Ab.indices},indices:jb,primitiveType:4,componentOffsets:Tb};var Lb=fb.transformation?Q.clone(fb.transformation):
Q.create();K.multiply(Lb,ib,Lb);var Mb=K.getTranslation(B.create(),Lb);Lb=X.fromMat4(T.create(),Lb);var tc=this.view.renderSpatialReference,uc=this.view.basemapTerrain.spatialReference,ec=B.create(),vc=[1,1,1];J.localLinearScaleFactors(Mb,tc,vc,uc);J.projectVectorToVector(Mb,tc,ec,uc);var Nb=eb.createObject({toMapSpace:[ec[0],ec[1],vc[0],vc[1]],geometry:Tb,obb:c.unwrap(ra.geometryObb),transform:{position:Mb,rotationScale:Lb},visible:!1});Tb={hasParametersFromSource:!!fb.params.material.hasParametersFromSource,
isOpaque:"blend"!==fb.params.material.alphaMode&&1<=fb.params.material.metallicRoughness.baseColorFactor[3]};var Lc=2===Gb.geometryParams.textureCoordinates;Mb=db.map(wb=>this._createTexture(ra,Gb.material,wb,Lc));this._configureMaterial(Nb,fb.params.material,Mb,db);ra.memory+=this.memEstimateGeometryAdded(Nb);var xb=new cb(ra,$a,Nb,this._getInvalidRendererVersion(),Qa.attributeInfo,Tb,Mb);Qa.meta=xb;!this._hasTextures&&Aa.requiredTextures.some(({usage:wb})=>0!==(wb&19))&&(this._hasTextures=!0);this._hasData=
!0;this._hasColors=this._hasColors||Ib;this._hasTextures=this._hasTextures||!!ra.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Mc=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(xb).then(wb=>{c.isSome(wb)&&wb.updateObjectVisibility(xb.objectHandle,!1);return this._safeReschedule(()=>{var Ub=this._addTasks.get(ra.index);if(Ub)if(c.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,xb),this._addNodeMeta(ra.index,xb),Ub.meta=null,this.suspended)this._removeNodeStageData(ra.index,
this.elevationOffset);else{eb.setObjectVisibility(Nb,!0);c.isSome(wb)&&wb.updateObjectVisibility(xb.objectHandle,!0);xb.attributeInfo=Ub.attributeInfo;Ub=xb.cachedRendererVersion!==this._rendererVersion;var md=Mc!==this.slicePlaneEnabled;this._setObjectSymbolColors(xb);var nd=this._applyFiltersToNode(xb);(Ub||c.isSome(wb)&&(md||nd))&&this._addOrUpdateEdgeRendering(xb);this._visibleGeometryChanged(xb);this._highlights.objectCreated(xb);this._updateMaterial(xb);this._setNewNodeOpacity(xb);c.isSome(this._treeDebugger)&&
this._treeDebugger.update()}},Ma)}).catch(wb=>{c.isSome(Qa.meta)&&(this._deleteComponentObject(Qa.meta),Qa.meta=null);throw wb;})}};Ra._addNodeMeta=function(ra,Aa){this._removeNodeStageData(ra,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(ra)){Ya.error("Removing duplicated node");const Ma=this._nodeId2Meta.get(ra);c.isSome(Ma)&&this._deleteComponentObject(Ma)}c.isSome(Aa)&&(Aa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&ja(Aa.cachedEdgeMaterials,0));this._nodeId2Meta.set(ra,
Aa)};Ra._safeReschedule=function(ra,Aa){w.throwIfAborted(Aa);return this._controller.reschedule(ra,Aa)};Ra._materialParameters=function(ra,Aa){ra=ra.params.material;const Ma=Aa.some(Wa=>"uvRegion"===Wa.name);Aa=Aa.some(Wa=>"normalCompressed"===Wa.name);const Qa=Oa(ra);return{geometryParams:this._getGeometryParameters({hasTexture:Qa,hasNormals:Aa,hasRegions:Ma}),material:ra}};Ra._configureMaterial=function(ra,Aa,Ma,Qa){const Wa=this.rendererTextureUsage;this._collection.updateMaterial(ra,bb=>{var ib=
Aa.metallicRoughness.baseColorFactor,db=C.clamp(Aa.metallicRoughness.baseColorFactor[3],0,1);bb.baseColor=[ib[0],ib[1],ib[2],db];bb.hasParametersFromSource=!!Aa.hasParametersFromSource;bb.usePBR=this._usePBR();bb.mrrFactors=[Aa.metallicRoughness.metallicFactor,Aa.metallicRoughness.roughnessFactor,Aa.hasParametersFromSource?.2:.5];bb.emissiveFactor=Aa.emissiveFactor;bb.isIntegratedMesh=this._isIntegratedMesh;bb.alphaCutoff="mask"===Aa.alphaMode?Aa.alphaCutoff:U.defaultMaskAlphaCutoff;bb.alphaDiscardMode=
"opaque"===Aa.alphaMode?1:"mask"===Aa.alphaMode?2:3;ib=this._stage.renderView.textureRepository;if(db=Va(Qa,Ma,33&Wa))bb.baseColorTexture=new Ha.RenderTexture(ib,db);if(db=Va(Qa,Ma,2&Wa))bb.metallicRoughnessTexture=new Ha.RenderTexture(ib,db);if(db=Va(Qa,Ma,16&Wa))bb.emissionTexture=new Ha.RenderTexture(ib,db);if(db=Va(Qa,Ma,8&Wa))bb.occlusionTexture=new Ha.RenderTexture(ib,db);if(db=Va(Qa,Ma,4&Wa))bb.normalTexture=new Ha.RenderTexture(ib,db);bb.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;
bb.commonMaterialParameters.doubleSided=Aa.doubleSided;bb.commonMaterialParameters.cullFace=Aa.cullFace;bb.ellipsoidMode=Na.getEllipsoidMode(this.view.spatialReference);this._updateMaterialOverlay(bb)})};Ra._getGeometryParameters=function(ra){return{textureCoordinates:ra.hasTexture?ra.hasRegions?2:1:0,colors:this._hasVertexColors,normals:ra.hasNormals&&!this._isIntegratedMesh}};Ra._addData=function(ra,Aa,Ma){let Qa=this._addTasks.get(ra.index);Qa?Qa.attributeInfo=Aa:(Qa={...w.createResolver(),attributeInfo:Aa,
meta:null},this._addTasks.set(ra.index,Qa),Ma().then(Qa.resolve,Qa.reject).then(()=>this._addTasks.delete(ra.index)).catch(Wa=>{this._addTasks.delete(ra.index);throw Wa;}));return Qa.promise};Ra._clearAddTasks=function(){this._addTasks.forEach(ra=>{c.isSome(ra.meta)&&(this._deleteComponentObject(ra.meta),ra.meta=null)});this._addTasks.clear()};Ra._clippingAreaChanged=function(){const ra=H.create();V.projectToBoundingBox(this.view.clippingArea,ra,this.view.renderSpatialReference)?this._clippingArea=
ra:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};Ra._geometryFilterChange=function(){this._controller.geometryFilterChanged(this.hasGeometryFilter)};Ra._filterChange=function(){this._applyFilters(!1)};Ra._applyFilters=function(ra){this._filters=this.getFilters();ra?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Aa=>{c.isSome(Aa)&&this._applyFiltersToNode(Aa)&&(this._addOrUpdateEdgeRendering(Aa),
this._visibleGeometryChanged(Aa))})};Ra.getFilters=function(){const ra=[];this._clippingArea&&ra.push((Aa,Ma)=>this._boundingboxFilter(Aa,Ma,this._clippingArea));return ra};Ra.addSqlFilter=function(ra,Aa,Ma){if(c.isSome(Aa)){const Qa=Aa.fieldNames;ra.push((Wa,bb)=>this._sqlFilter(Wa,bb,Aa,Qa,Ma))}};Ra._sqlFilter=function(ra,Aa,Ma,Qa,Wa){const bb={},ib=this._createLayerGraphic(bb),db=this.i3slayer.objectIdField,Fa=Aa.featureIds,La=c.isSome(Aa.attributeInfo)&&Aa.attributeInfo.attributeData;Qa.every($a=>
null!=La[$a]||$a===db)&&ea.filterInPlace(ra,Fa,$a=>{bb[db]=Fa[$a];for(const eb of Qa)eb!==db&&(bb[eb]=ea.getCachedAttributeValue(La[eb],$a));try{return Ma.testFeature(ib)}catch(eb){return Wa(eb),!1}})};Ra._boundingboxNodeTest=function(ra,Aa){J.projectBoundingSphere(ra.node.mbs,this._controller.crsIndex,za,this.view.renderSpatialReference);return ea.intersectBoundingBoxWithMbs(Aa,za)};Ra._boundingboxFeatureTest=function(ra,Aa,Ma){return H.intersects(Ma,this._collection.getComponentAabb(ra.objectHandle,
Aa,lb))};Ra._boundingboxFilter=function(ra,Aa,Ma){var Qa=this._collection;const Wa=this._boundingboxNodeTest(Aa,Ma);if(3!==Wa)if(0===Wa)ra.length=0;else if(Qa=Qa.getComponentCount(Aa.objectHandle),Qa.invisible+Qa.visible===Aa.featureIds.length){var bb=this._transformAABB(Xa,Ma,Aa.objectHandle);ea.filterInPlace(ra,Aa.featureIds,ib=>this._boundingboxFeatureTest(Aa,ib,bb))}};Ra._transformAABB=function(ra,Aa,Ma){var Qa=this._collection.getObjectTransform(Ma);Ma=Qa.position;Qa=Qa.rotationScale;ra[0]=(Aa[0]-
Ma[0])/Qa[0];ra[1]=(Aa[1]-Ma[1])/Qa[4];ra[2]=(Aa[2]-Ma[2])/Qa[8];ra[3]=(Aa[3]-Ma[0])/Qa[0];ra[4]=(Aa[4]-Ma[1])/Qa[4];ra[5]=(Aa[5]-Ma[2])/Qa[8];return ra};Ra._addOrUpdateEdgeRendering=function(ra,Aa=!0){if(c.isNone(this._edgeView))return Promise.resolve(null);const Ma=ra.objectHandle,Qa=this._edgeView.hasObject(Ma),{hasEdges:Wa,perFeatureEdgeMaterials:bb}=this._getFilteredEdgeMaterials(ra),ib={slicePlaneEnabled:this.slicePlaneEnabled};if(Wa)return Qa?(this.nodeCrossfadingEnabled&&(ra=this.getNodeOpacity(ra),
ja(bb,ra)),this._edgeView.updateAllComponentMaterials(Ma,bb,ib,Aa),this._edgeView.updateObjectVisibility(Ma,!0),Promise.resolve(this._edgeView)):this._collection.addEdges(Ma,this._edgeView,bb,ib).then(()=>this._edgeView);Qa&&this._edgeView.removeObject(Ma);return Promise.resolve(null)};Ra._removeEdgeRendering=function(ra){c.isSome(this._edgeView)&&this._edgeView.hasObject(ra.objectHandle)&&this._edgeView.removeObject(ra.objectHandle)};Ra._applyFiltersToNode=function(ra){return this._applyFiltersToNodeComponents(ra)?
(c.isSome(this._labeler)&&this._labeler.applyFilterChange(ra),!0):!1};Ra._applyFiltersToNodeComponents=function(ra){const Aa=this._collection;var Ma=0===Aa.getComponentCount(ra.objectHandle).invisible;Aa.setAllComponentVisibilities(ra.objectHandle,"all");if(0===this._filters.length)return ra.filteredIds=null,!Ma;this._updateCachedFilteredIds(ra);if(ra.filteredIds===ra.featureIds)return!Ma;Ma=this._computeFilteredComponentIndices(ra);Aa.setAllComponentVisibilities(ra.objectHandle,Ma);return!0};Ra._updateCachedFilteredIds=
function(ra){if(null==ra.filteredIds||ra.appliedFilters!==this._filters)ra.filteredIds=this._computeFilteredIds(ra),ra.appliedFilters=this._filters};Ra._computeFilteredIds=function(ra){const Aa=ra.featureIds.slice();for(const Ma of this._filters)if(Ma(Aa,ra),0===Aa.length)break;return Aa.length===ra.featureIds.length?ra.featureIds:Aa};Ra._computeFilteredComponentIndices=function(ra){const Aa=[];ra.featureIds.forEach((Ma,Qa)=>{ra.filteredIds[Aa.length]===Ma&&Aa.push(Qa)});return Aa};Ra._removeAllNodeDataFromStage=
function(ra=this.elevationOffset){this._nodeId2Meta.forEach((Aa,Ma)=>this._removeNodeStageData(Ma,ra));this._nodeId2MetaReloading.forEach((Aa,Ma)=>this._removeNodeStageData(Ma,ra,this._nodeId2MetaReloading))};Ra.removeNode=function(ra){const Aa=this.elevationOffset;this._removeNodeStageData(ra,Aa);this._removeNodeStageData(ra,Aa,this._nodeId2MetaReloading)};Ra._removeNodeStageData=function(ra,Aa,Ma=this._nodeId2Meta){const Qa=Ma.get(ra);c.isNone(Qa)?Ma.delete(ra):(this._collection.setObjectVisibility(Qa.objectHandle,
!1),this._visibleGeometryChanged(Qa),this._removeEdgeRendering(Qa),c.isSome(this._labeler)&&this._labeler.removeNodeMeta(Qa),Ma.delete(ra),this._highlights.objectDeleted(Qa),Ma===this._nodeId2Meta?(this._cacheGPUData(Qa,Aa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Qa)):this._deleteComponentObject(Qa),c.isSome(this._treeDebugger)&&this._treeDebugger.update())};Ra._deleteComponentObject=function(ra){c.isSome(this._edgeView)&&this._edgeView.removeObject(ra.objectHandle);this.memEstimateGeometryRemoved(ra.objectHandle);
this._collection.destroyObject(ra.objectHandle);if(ra.textures)for(const Aa of ra.textures)this.memEstimateTextureRemoved(Aa),this._stage.remove(Aa)};Ra.updateNodeState=function(ra,Aa){ra=this._nodeId2Meta.get(ra);c.isSome(ra)&&this._collection.updateMaterial(ra.objectHandle,Ma=>Ma.polygonOffsetEnabled=0===Aa)};Ra._invalidateAllSymbols=function(){this._rendererVersion=ea.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Ra._getInvalidRendererVersion=function(){return ea.addWraparound(this._rendererVersion,
-1)};Ra._rendererChange=async function(ra){this._currentRenderer=ra;this.notifyChange("rendererTextureUsage");this._rendererVersion=ea.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();ra&&(this._rendererFields=r.fixFields(this.i3slayer.fields,await ra.getRequiredFields(this.i3slayer.fields)));this._updateSymbologyFields();!this._arcade&&ra&&"arcadeRequired"in ra&&ra.arcadeRequired&&(this._arcade=await z.loadArcade());
if(ra&&"visualVariables"in ra&&ra.visualVariables)for(const Aa of ra.visualVariables)"color"===Aa.type?this._colorVariable=Aa:"opacity"===Aa.type?this._opacityVariable=Aa:Ya.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Aa.type}`);if(ra)for(const Aa of ra.getSymbols())"mesh-3d"!==Aa.type&&Ya.error(`Symbols of type '${Aa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()};Ra._getCachedEdgeMaterials=function(ra){this._hasSymbolColors&&
ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);return ra.cachedEdgeMaterials};Ra._getSymbolColors=function(ra){this._hasSymbolColors&&ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);const Aa=ra.cachedSymbology;return(Ma,Qa)=>{Ma*=5;aa.set(Qa.externalColor,Aa[Ma+0]/255,Aa[Ma+1]/255,Aa[Ma+2]/255,Aa[Ma+3]/255);Qa.externalColorMixMode=Aa[Ma+4]&15;Qa.castShadows=0!==(Aa[Ma+4]&16);Qa.pickable=0!==(Aa[Ma+4]&32)}};Ra._getSymbolInfo=
function(ra,Aa){Aa=ra&&ra.getSymbol(Aa,{arcade:this._arcade});if(!(Aa instanceof x))return null;ra=Aa.id;if(this._symbolInfos.has(ra))return this._symbolInfos.get(ra);Aa=ea.getSymbolInfo(Aa);this._symbolInfos.set(ra,Aa);return Aa};Ra._setSymbologyOverride=function(ra,Aa){this._symbologyOverride!==ra&&(this._symbologyOverride=ra,this._symbologyOverrideFields=Aa,this._invalidateAllSymbols(),this._updateSymbologyFields())};Ra._updateSymbologyFields=function(){this._symbologyFields=c.isSome(this._symbologyOverrideFields)&&
0<this._symbologyOverrideFields.length?c.isSome(this._rendererFields)&&0<this._rendererFields.length?r.fixFields(this.i3slayer.fields,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};Ra._updateCachedRendererData=function(ra){ra.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var Aa=this._tmpAttributeOnlyGraphic,Ma={};Aa.attributes=Ma;var Qa=this._currentRenderer,Wa=c.isSome(ra.attributeInfo)&&ra.attributeInfo.attributeData,
bb=null!=ra.featureIds?this.i3slayer.objectIdField:null,ib=null!=Wa&&c.isSome(this._symbologyFields)&&0<this._symbologyFields.length,db=ib?[]:null,Fa=ib?[]:null;if(ib&&c.isSome(this._symbologyFields))for(var La of this._symbologyFields){var $a=Wa[La];$a&&(db.push(La),Fa.push($a))}ra.cachedSymbology||(ra.cachedSymbology=new Uint8Array(5*ra.featureIds.length));Wa={color:Ba,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null};La=this.fullOpacity;La=this.nodeCrossfadingEnabled?this.getNodeOpacity(ra):
La;$a=null;var eb=2,fb=ea.transparentEdgeMaterial,hb=0;for(let Ib=0;Ib<ra.featureIds.length;Ib++){null!=bb&&(Ma[bb]=ra.featureIds[Ib]);if(ib)for(var jb=0;jb<db.length;jb++)Ma[db[jb]]=ea.getCachedAttributeValue(Fa[jb],Ib);var sb=this._getSymbolInfo(Qa,Aa);let Gb=jb=null;if(Qa&&"visualVariables"in Qa){if(this._colorVariable){var Ab=G.getColor(this._colorVariable,Aa,{color:va,arcade:this._arcade});Ab&&(jb=Ba,jb[0]=Ab.r/255,jb[1]=Ab.g/255,jb[2]=Ab.b/255,this._opacityVariable||null===Ab.a||(Gb=Ab.a))}this._opacityVariable&&
(Gb=G.getOpacity(this._opacityVariable,Aa,{arcade:this._arcade}))}sb&&sb.material&&(Ab=sb.material,jb=c.isNone(jb)||c.isNone(Gb)?N.overrideColor(jb,Gb,Ab.color,Ab.alpha,ab,Ba):N.overrideColor(jb,Gb,null,null,ab,Ba));c.isNone(jb)&&(jb=Ba,jb[0]=1,jb[1]=1,jb[2]=1,jb[3]=1);Wa.pickable=!0;Wa.castShadows=sb?sb.castShadows:!0;Wa.colorMixMode=sb&&sb.material?sb.material.colorMixMode:1;Wa.edgeMaterial=sb?sb.edgeMaterial:null;c.isSome(this._symbologyOverride)&&(Wa.color=jb,this._symbologyOverride(Aa,Wa),jb=
Wa.color);if(c.isSome(Wa.edgeMaterial)){sb=0>=jb[3]?0:1<=jb[3]&&(ra.material.isOpaque||3===Wa.colorMixMode)?2:1;if(Wa.edgeMaterial!==$a||sb!==eb)fb={...Wa.edgeMaterial,opacity:La,objectTransparency:sb},$a=Wa.edgeMaterial,eb=sb;ra.cachedEdgeMaterials[Ib]=fb}else ra.cachedEdgeMaterials[Ib]=ea.transparentEdgeMaterial;ra.cachedSymbology[hb+0]=Math.round(255*jb[0]);ra.cachedSymbology[hb+1]=Math.round(255*jb[1]);ra.cachedSymbology[hb+2]=Math.round(255*jb[2]);ra.cachedSymbology[hb+3]=Math.round(255*jb[3]);
ra.cachedSymbology[hb+4]=Wa.colorMixMode|+Wa.castShadows<<4|+Wa.pickable<<5;hb+=5}}};Ra._getFilteredEdgeMaterials=function(ra){var Aa=this._getCachedEdgeMaterials(ra);this.nodeCrossfadingEnabled||ja(Aa,this.fullOpacity);if(c.isNone(ra.filteredIds))return{hasEdges:Aa.some(Wa=>Wa!==ea.transparentEdgeMaterial),perFeatureEdgeMaterials:Aa};let Ma=0,Qa=!1;Aa=Aa.map((Wa,bb)=>{if(ra.featureIds[bb]!==ra.filteredIds[Ma])return ea.transparentEdgeMaterial;Qa=Qa||Wa!==ea.transparentEdgeMaterial;Ma++;return Wa});
return{hasEdges:Qa,perFeatureEdgeMaterials:Aa}};Ra._setObjectSymbolColors=function(ra){if(this._hasSymbolColors){var Aa=ra.objectHandle;ra=this._getSymbolColors(ra);this._collection.setComponentData(Aa,ra);this._stage.renderView.setNeedsRender()}};Ra._reloadAll=function(ra=this.elevationOffset){this._removeAllNodeDataFromStage(ra);null!=this._controller&&this._controller.restartNodeLoading()};Ra._opacityChange=function(ra){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Aa=>
{c.isNone(Aa)||(this._collection.updateMaterial(Aa.objectHandle,Ma=>Ma.objectOpacity=ra),ja(Aa.cachedEdgeMaterials,ra),this._updateEdgeRendering(Aa))})};Ra._updateMaterial=function(ra){this._collection.updateMaterial(ra.objectHandle,Aa=>{Aa.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;Aa.usePBR=this._usePBR();this._updateMaterialOverlay(Aa)})};Ra._updateMaterialOverlay=function(ra){};Ra._updateEngineObject=function(ra){this._setObjectSymbolColors(ra);this._applyFiltersToNode(ra);
this._addOrUpdateEdgeRendering(ra);this._visibleGeometryChanged(ra)};Ra._slicePlaneEnabledChange=function(ra){this._intersectionHandler&&(this._intersectionHandler.slicePlane=ra);c.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=ra);this._nodeId2Meta.forEach(Aa=>{c.isNone(Aa)||(this._collection.updateMaterial(Aa.objectHandle,Ma=>{Ma.commonMaterialParameters.slicePlaneEnabled=ra}),this._updateEdgeRendering(Aa,!1))})};Ra._updatePBR=function(){this._nodeId2Meta.forEach(ra=>{c.isNone(ra)||this._collection.updateMaterial(ra.objectHandle,
Aa=>{Aa.usePBR=this._usePBR()})});this._hasLoadedPBRTextures=!0};Ra._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};Ra._updateEdgeRendering=function(ra,Aa=!0){c.isSome(this._edgeView)&&this._edgeView.hasObject(ra.objectHandle)&&this._addOrUpdateEdgeRendering(ra,Aa)};Ra._forAllNodes=function(ra){this._nodeId2Meta.forEach(ra)};Ra._forAllFeatures=function(ra,Aa,Ma=0){P.someMap(this._nodeId2Meta,Qa=>{if(c.isNone(Qa))return!1;if(c.isSome(Aa))switch(Aa(Qa)){case 0:return!0;
case 2:return!1}let Wa=1;switch(Ma){case 1:Wa=this._forAllFeaturesOfNode(Qa,ra);break;case 0:Wa=this._forVisibleFeaturesOfNode(Qa,ra);break;case 2:Wa=this._forAllFeaturesOfNodeInClippingArea(Qa,ra)}return 0===Wa})};Ra._forAllFeaturesOfNode=function(ra,Aa){let Ma=1;const Qa=ra.featureIds;for(let Wa=0;Wa<Qa.length&&(Ma=Aa(Qa[Wa],Wa,ra),0!==Ma);Wa++);return Ma};Ra._forVisibleFeaturesOfNode=function(ra,Aa){let Ma=1;const Qa=ra.featureIds;this._collection.forEachVisibleComponent(ra.objectHandle,Wa=>{Ma=
Aa(Qa[Wa],Wa,ra);return 1===Ma});return Ma};Ra._forAllFeaturesOfNodeInClippingArea=function(ra,Aa){if(null==this._clippingArea)return this._forAllFeaturesOfNode(ra,Aa);var Ma=this._boundingboxNodeTest(ra,this._clippingArea);if(0===Ma)return 1;if(3===Ma)return this._forAllFeaturesOfNode(ra,Aa);Ma=ra.featureIds;const Qa=ea.getClipAABB(this._clippingArea,this._collection.getObjectTransform(ra.objectHandle));for(let Wa=0;Wa<Ma.length;Wa++){if(!this._boundingboxFeatureTest(ra,Wa,Qa))continue;const bb=
Aa(Ma[Wa],Wa,ra);if(0===bb)return bb}return 1};Ra._createAttributes=function(ra,Aa){const Ma={};null!=Aa.featureIds&&(Ma[this._getObjectIdField()]=Aa.featureIds[ra]);Aa=c.isSome(Aa.attributeInfo)&&Aa.attributeInfo.attributeData;if(c.isSome(Aa))for(const Qa of Object.keys(Aa))Ma[Qa]=ea.getCachedAttributeValue(Aa[Qa],ra);return Ma};Ra._createGraphic=function(ra,Aa){return this._createLayerGraphic(this._createAttributes(ra,Aa))};Ra.highlight=function(ra){const Aa=this._highlights;"number"===typeof ra?
ra=[ra]:ra instanceof m?ra=[ra]:ra instanceof D&&(ra=ra.toArray());if(Array.isArray(ra)&&0<ra.length){if(ra[0]instanceof m){const Ma=this.i3slayer.fieldsIndex,Qa=this._getObjectIdField();ra=ra.map(ib=>Ja.attributeLookup(Ma,ib.attributes,Qa));const {set:Wa,handle:bb}=Aa.acquireSet();Aa.setFeatureIds(Wa,ra);return bb}if("number"===typeof ra[0]){const {set:Ma,handle:Qa}=Aa.acquireSet();Aa.setFeatureIds(Ma,ra);return Qa}}return Da};Ra._visibleGeometryChanged=function(ra){this._elevationProvider&&(this._elevationProvider.objectChanged(ra.node),
null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=y.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})))};Ra.getNodeOpacityByIndex=function(ra){ra=this._nodeId2Meta.get(ra);return this.getNodeOpacity(ra)};Ra.getNodeOpacity=function(ra){return c.isSome(ra)?this._collection.getMaterial(ra.objectHandle).objectOpacity:0};Ra.isNodeFullyFadedIn=function(ra){return this._crossfadeHelper.isNodeFullyFadedIn(ra)};
Ra.getNodeCrossfadeMetaData=function(ra){return this._nodeId2Meta.get(ra)};Ra.markNodeToRemove=function(ra){this._controller&&this._controller.markNodeToRemove(ra)};Ra.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Ra.foreachCrossfadeNode=function(ra){this._nodeId2Meta.forEach((Aa,Ma)=>ra(Ma,Aa))};Ra.fadeNode=function(ra,Aa,Ma){if(this.nodeCrossfadingEnabled){var Qa=this._nodeId2Meta.get(ra);c.isSome(Qa)&&this._crossfadeHelper.fadeNode(ra,Qa,Aa,Ma)}};Ra.setNodeOpacityByIndex=
function(ra,Aa){ra=this._nodeId2Meta.get(ra);c.isSome(ra)&&this._setNodeOpacity(ra,Aa)};Ra._setNodeOpacity=function(ra,Aa){this._collection.updateMaterial(ra.objectHandle,Ma=>Ma.objectOpacity=Aa);this._setNodeEdgeOpacity(ra,Aa)};Ra._setNodeEdgeOpacity=function(ra,Aa){c.isSome(this._edgeView)&&ra.cachedEdgeMaterials&&(ja(ra.cachedEdgeMaterials,Aa),ra=ra.objectHandle,this._edgeView.hasObject(ra)&&this._edgeView.updateAllComponentOpacities(ra,Aa))};Ra.updateNodeModificationStatus=function(ra){var Aa=
ra.length;if(this._hasModifications&&!(0>=Aa)&&!0===this._i3sWasmLoaded){Aa=this.i3slayer.uid;var Ma=Pa(ra);if(c.isSome(Ma)){ha.filterObbsForModificationsSync({context:Aa,buffer:Ma.buffer});const Qa=new Float64Array(Ma.buffer);ra.forAll((Wa,bb)=>{bb=ha.interpretObbModificationResults(Qa[bb]);Wa.imModificationImpact=bb;0!==bb&&this._controller.invalidateGeometryVisibility(Wa.index)})}}};Ra.notifyUpdate=function(){this.notifyChange("updating")};Ra.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};
Ra.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||c.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading};Ra.computeNodeFiltering=function(ra){ra.filterImpact=0};b._createClass(Ta,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",
get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return ea.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||this._hasLoadedPBRTextures?63:37:this._usePBR()||this._hasLoadedPBRTextures?44:36}},{key:"elevationOffset",
get:function(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=ra&&"absolute-height"===ra.mode){const Aa=F.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Ma=L.getMetersPerUnit(ra.unit);return c.unwrapOr(ra.offset,0)*Ma/Aa}return 0}},{key:"supportedTextureEncodings",get:function(){return ea.getSupportedEncodings(this.view)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){var ra;const Aa=null==(ra=this.view)?void 0:ra.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled;
ra=0===(this.supportedTextureEncodings&2);return Aa&&ra}},{key:"_disableAtlasAnisotropy",get:function(){var ra,Aa;return!(null!=(ra=this.view)&&null!=(Aa=ra._stage)&&Aa.renderView.has(2))}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",get:function(){var ra,Aa;return!(null!=(ra=this.view)&&null!=(Aa=ra._stage)&&Aa.renderView.has(3))}},{key:"nodeCrossfadingEnabled",
get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const ra={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB",...this._collection?this._collection.performanceInfo:{shown:0,hidden:0}};c.isSome(this._memCache)&&(ra.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(ra.IDBCache=Math.round(100*this._idbCache.getHitRate())+
"% hit"),this._controller.updateStats(ra));return ra}},{key:"test",get:function(){const ra=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Aa=[];ra._forAllFeatures(Ma=>{Aa.push(Ma);return 1},null,0);Aa.sort((Ma,Qa)=>Ma-Qa);return Aa},get numNodes(){return ra._nodeId2Meta.size}}}},{key:"_hasModifications",get:function(){return this._modifications&&0<this._modifications.length}}]);return Ta}(Ga);p.__decorate([h.property()],Ga.prototype,"_hasLoadedPBRTextures",
void 0);p.__decorate([h.property()],Ga.prototype,"_asyncModuleLoading",void 0);p.__decorate([h.property()],Ga.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);p.__decorate([h.property()],Ga.prototype,"view",void 0);p.__decorate([h.property()],Ga.prototype,"i3slayer",void 0);p.__decorate([h.property()],Ga.prototype,"_controller",void 0);p.__decorate([h.property()],Ga.prototype,"_labeler",void 0);p.__decorate([h.property()],Ga.prototype,"updating",void 0);p.__decorate([h.property()],Ga.prototype,
"suspended",void 0);p.__decorate([h.property()],Ga.prototype,"holeFilling",void 0);p.__decorate([h.property(ba.updatingProgress)],Ga.prototype,"updatingProgress",void 0);p.__decorate([h.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],Ga.prototype,"updatingProgressValue",void 0);p.__decorate([h.property({readOnly:!0})],Ga.prototype,"hasTexturesOrVertexColors",null);p.__decorate([h.property({readOnly:!0})],Ga.prototype,"rendererTextureUsage",null);p.__decorate([h.property({readOnly:!0})],
Ga.prototype,"elevationOffset",null);p.__decorate([h.property({type:Boolean})],Ga.prototype,"slicePlaneEnabled",void 0);p.__decorate([h.property()],Ga.prototype,"supportedTextureEncodings",null);p.__decorate([h.property()],Ga.prototype,"uncompressedTextureDownsamplingEnabled",null);p.__decorate([h.property({type:[S]})],Ga.prototype,"_modifications",void 0);return Ga=p.__decorate([q.subclass("esri.views.3d.layers.I3SMeshView3D")],Ga)};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/Warning ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../core/JSONSupport ../../geometry/Polygon ../../geometry ../../geometry/projection".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){var w;b=w=function(y){function D(r){r=y.call(this,r)||this;r.geometry=null;r.type="clip";return r}a._inheritsLoose(D,y);var z=D.prototype;z.writeGeometry=function(r,C,A,x){if(x.layer&&x.layer.spatialReference&&!x.layer.spatialReference.equals(this.geometry.spatialReference)){if(!l.canProjectWithoutEngine(r.spatialReference,x.layer.spatialReference)){x&&x.messages&&x.messages.push(new e("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:x.layer.spatialReference,context:x}));return}const m=new v;l.projectPolygon(r,m,x.layer.spatialReference);C[A]=m.toJSON(x)}else C[A]=r.toJSON(x);delete C[A].spatialReference};z.clone=function(){return new w({geometry:p.clone(this.geometry),type:this.type})};return D}(u.JSONSupport);g.__decorate([c.property({type:v}),q.persistable()],b.prototype,"geometry",void 0);g.__decorate([n.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);g.__decorate([c.property({type:["clip",
"mask","replace"],nonNullable:!0}),q.persistable()],b.prototype,"type",void 0);return b=w=g.__decorate([h.subclass("esri.layers.support.SceneModification")],b)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../maybe ../metadata ./property ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../PropertyOrigin ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,g,b,p,f,k,c,d,e,h,n){function q(w,y,D){const z=
p.getOwnPropertyMetadata(y,D);return{type:String,read:(r,C,A)=>{r=n.read(r,C,A);if(z.type===String)return r;if("function"===typeof z.type)return new z.type({url:r})},write:{writer(r,C,A,x){if(x&&x.resources){var m=b.isNone(r)?null:"string"===typeof r?r:r.url;m=m?n.toJSON(m,{...x,verifyItemRelativeUrls:x&&x.verifyItemRelativeUrls?{writtenUrls:x.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null;var B=z.type!==String&&(!k.isMultiOriginJSONMixin(this)||x&&x.origin&&this.originIdOf(D)>e.nameToId(x.origin));
if(x&&x.portalItem&&b.isSome(m)&&!c.isAbsolute(m))if(B){{B=x.portalItem.resourceFromPath(m);const E=t(r,m,x),F=h.getResourceContentExtension(E),G=c.getPathExtension(B.path);F!==G?u(this,D,r,m,C,A,x,w):(v(this,D,B,E,x.resources.toUpdate),C[A]=m)}}else x.resources.toKeep.push({resource:x.portalItem.resourceFromPath(m)}),C[A]=m;else x&&x.portalItem&&(b.isNone(m)||b.isSome(n.itemIdFromResourceUrl(m))||c.isBlobProtocol(m)||B)?u(this,D,r,m,C,A,x,w):C[A]=m}else C[A]="string"===typeof r?n.toJSON(r,x):r.write({},
x)}}}}function u(w,y,D,z,r,C,A,x){const m=d.generateUUID();D=t(D,z,A);const B=c.join(b.get(x,"prefix"),m);x=`${B}.${h.getResourceContentExtension(D)}`;const E=A.portalItem.resourceFromPath(x);c.isBlobProtocol(z)&&A.resources.pendingOperations.push(l(z).then(F=>{E.path=`${B}.${h.getResourceContentExtension(F)}`;r[C]=E.itemRelativeUrl}).catch(()=>{}));v(w,y,E,D,A.resources.toAdd);r[C]=E.itemRelativeUrl}function v(w,y,D,z,r){r.push({resource:D,content:z,finish:C=>{"string"===typeof w[y]?w[y]=C.url:w[y].url=
C.url}})}function t(w,y,D){return"string"===typeof w?{url:y}:new Blob([JSON.stringify(w.toJSON(D))],{type:"application/json"})}async function l(w){const y=(await new Promise(function(D,z){a(["../../../request"],function(r){D(Object.freeze({__proto__:null,"default":r}))},z)})).default;({data:w}=await y(w,{responseType:"blob"}));return w}g.persistable=function(w){const y=b.isSome(w)&&w.origins?w.origins:[void 0];return(D,z)=>{a:if(b.isSome(w)&&"resource"===w.type)var r=q(w,D,z);else{switch(b.isSome(w)&&
w.type?w.type:"other"){case "other":r={read:!0,write:!0};break a;case "url":{const {read:C,write:A}=n.persistableUrlUtils;r={read:C,write:A};break a}}r=void 0}for(const C of y){const A=f.propertyJSONMeta(D,C,z);for(const x in r)A[x]=r[x]}}};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/promiseUtils ../../../core/Accessor ../../../core/Promise ../../../core/Handles ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/PromiseQueue ../../../views/support/Scheduler ../../../geometry/support/aaBoundingBox ../../../views/support/layerViewUtils ../dehydratedFeatures ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SViewportQueries".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P){function Q(W,Y){return p.isSome(W)&&W.length===Y.length&&W.every(U=>0<=X(Y,U.name))}function X(W,Y){Y=Y.toLowerCase();for(let U=0;U<W.length;U++)if(W[U].name.toLowerCase()===Y)return U;return-1}const aa=f.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");f=function(W){function Y(N){N=W.call(this,N)||this;N.screenSizeFactor=0;N.featureTarget=5E4;N.fixedFeatureTarget=!1;N.updating=!0;N.updatingProgress=1;
N.leavesReached=!1;N.scaleVisibilityEnabled=!0;N._featureLOD=1;N._stableFeatureLOD=!1;N._isIdle=!1;N._cameraDirty=!0;N._invisibleDirty=!1;N._newLoadingNodes=new u({deallocator:null});N._loadedNodeScales=new Map;N._modificationsNodeFilteringArray=new u;N._downloadingCount=0;N._loadingNodes=new Map;N._updatingNodes=new Map;N._progressMaxNumNodes=1;N._requiredAttributes=[];N._requiredAttributesDirty=!0;N._updatesDisabled=!1;N.disableIDBCache=!1;N._disableMemCache=!1;N._restartNodeLoading=!1;N._fields=
null;N._attributeStorageInfo=null;N._handles=new w;N._idleQueue=new r;N._elevationUpdateNodes=new u({deallocator:null});N._errorCount=0;return N}a._inheritsLoose(Y,W);var U=Y.prototype;U.initialize=function(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new K(this.layerView);const N=this.layerView.i3slayer;this.layer=N;this._defaultGeometrySchema=N.store.defaultGeometrySchema;this.disableIDBCache=b("disable-feature:idb-cache");"fields"in
N&&(this._fields=N.fields,this._attributeStorageInfo=N.attributeStorageInfo);this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then(([ca])=>{if(!this.destroyed&&this.layerView&&!this.layerView.destroyed){var O=this.layerView.view;this._setClippingArea(O.clippingArea);var V=this.layerView.view.resourceController;this._handles.add([y.init(O,"pointsOfInterest.focus.renderLocation",ba=>this._pointOfInterestChanged(ba)),V.memoryController.events.on("quality-changed",
()=>this._setCameraDirty()),y.init(this.layerView,"suspended",ba=>{const fa=ba?()=>this._updateViewData():()=>this._updateIdleState(!0),ia=ba?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(ba&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=fa,this._idleStateCallbacks.idleEnd=ia):this._idleStateCallbacks=V.scheduler.registerIdleStateCallbacks(fa,ia)}),F.addTask(this.layerView.view.resourceController.scheduler,{update:(ba,fa)=>this._frame(ba,fa),
needsUpdate:()=>this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",()=>this.restartNodeLoading()),this.watch(["featureTarget","fixedFeatureTarget"],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),O.state.watch("camera",()=>this._setCameraDirty()),O.state.watch("contentCamera",()=>this._setCameraDirty()),this.layer.watch("elevationInfo",()=>this._elevationInfoChanged()),this.layer.watch(["minScale","maxScale"],()=>this._scaleBoundsChanged()),this.layerView.watch("lodFactor",
()=>this._setCameraDirty()),this.layerView.watch("availableFields?",()=>this._requiredFieldsChange()),this.layerView.watch("holeFilling",ba=>p.isSome(this._index)&&(this._index.holeFilling=ba))]);this._updateScaleHandles();this._viewportQueries=new P(this.crsIndex,O.renderCoordsHelper,O.state.camera,O.state.contentCamera,O.state.fixedContentCamera,this._clippingArea,O.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:.5>
this.lod});this._index=new I.I3SIndex(N,ca,this.indexStreamController,this._viewportQueries,aa,this.layerView.holeFilling,ba=>this.layerView.isNodeLoaded(ba),ba=>this.layerView.isNodeReloading(ba),ba=>this._shouldLoadNode(ba),ba=>this._enableFromGPUCache(ba,1),ba=>this._needsUpdate(ba),()=>!this.indexStreamController.busy,ba=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(ba):null,ba=>this.layerView.computeNodeFiltering(ba));ca=p.isSome(this.layer.modifications)&&this.layer.modifications&&
0<this.layer.modifications.length;this._index.imModificationsChanged(ca);this._startNodeLoading()}}));this._tmpPoint=m.makeDehydratedPoint(0,0,0,this.crsIndex)};U.updateNodeModificationStatus=function(N){const ca=this._index,O=this.layerView;p.isSome(ca)&&O&&O.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),N.forAll(V=>{V=ca.getNode(V);p.isSome(V)&&this._modificationsNodeFilteringArray.push(V)}),O.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=
!0)};U.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;S.prune();p.isSome(H)&&(H.remove(),H=null)};U._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const N=this._attributeStorageInfo,ca=this._fields,O=this.layer.objectIdField;return this.layerView.availableFields.map(V=>
{const ba=X(N,V);V=X(ca,V);return 0<=ba&&0<=V?{index:ba,name:ca[V].name,field:ca[V],attributeStorageInfo:N[ba]}:null}).filter(V=>null!=V&&V.name!==O)};U._requiredFieldsChange=function(){const N=this._getRequiredAttributes();Q(this._requiredAttributes,N)||(this._requiredAttributes=N,this._requiredAttributesDirty=!1,this.restartNodeLoading())};U.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};U._setClippingArea=function(N){const ca=A.create();B.projectToBoundingBox(N,
ca,this.layerView.view.renderSpatialReference)?this._clippingArea=ca:this._clippingArea=null};U._pointOfInterestChanged=function(N){p.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(N),p.isSome(this._index)&&(this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};U.updateClippingArea=function(N){this._setClippingArea(N);p.isSome(this._viewportQueries)&&p.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()};U._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};U.updateElevationChanged=function(N,ca){const O=this._index;if(!p.isNone(O)){var V=O.rootNode;if(!p.isNone(V)){var ba=this._elevationUpdateNodes;ba.clear();G.findIntersectingNodes(N,ca,V,this.crsIndex,O,fa=>ba.push(fa.index));ba.forAll(fa=>{O.invalidateBoundingVolumeCache(fa);fa===V.index&&
this.notifyChange("rootNodeVisible")});ba.length&&this.restartNodeLoading()}}};U.getParentIndex=function(N){return p.isSome(this._index)&&this._index.getParentIndex(N)};U._elevationInfoChanged=function(){p.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};U._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",N=>this._scaleUpdateHandler(N)),
"scale-bounds")};U._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};U._scaleUpdateHandler=function(N){this._updateScaleInBoundingRect(N.scale,N.extent,N.spatialReference);this._setCameraDirty()};U._updateScaleInBoundingRect=function(N,ca,O){const V=this._index;p.isNone(V)||!p.isNone(V.rootNode)&&z.projectBoundingRect(ca,O,T,this.crsIndex)&&this._loadedNodeScales.forEach((ba,fa)=>{ba=V.getNode(fa);p.isSome(ba)&&
D.containsPoint(T,ba.mbs)&&this._loadedNodeScales.set(fa,N)})};U.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};U.schedule=function(N,ca){return this._idleQueue.push(N,ca)};U.reschedule=function(N,ca){return this._idleQueue.unshift(N,ca)};U._frame=function(N,ca){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||p.isNone(this._index))return-Infinity;this._processLogError(N,
ca);return this._index.getPriority()};U._processLogError=function(N,ca){try{this._process(N,ca)}catch(O){50>this._errorCount?aa.error("Error during processing: "+O):50===this._errorCount&&aa.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};U._process=function(N,ca){this._restartNodeLoading&&this._startNodeLoading();if(null!=this._nodeLoader&&!p.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(N)&&(this._invisibleDirty=
!1);this.isIntegratedMesh&&(N.enabled=!1);N.run(()=>this._processIndex(N));this._updateFeatureLOD();N.run(()=>this._processCache(N));this.isIntegratedMesh&&(N.enabled=!0);for(N.run(()=>this._processNodes(N,ca));!N.done&&this._idleQueue.process();)N.madeProgress();N.run(()=>this._prefetchIndex());ca.numIndexLoading+=this._index.getIndexLoading();ca.numNodesLoading+=this._downloadingCount;N.run(()=>this._lodHandling.lodGlobalHandling(N));this._evaluateUpdating()}};U._processIndex=function(N){if(p.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],N,ca=>this.updateNodeModificationStatus(ca)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),N=this._index.featureEstimate.leavesReached,this._index.isLoading()||N===this._get("leavesReached")||this._set("leavesReached",N));return this._index.load()};
U._prefetchIndex=function(){return p.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};U._updateFeatureLOD=function(){if(this.isGraphics3D&&!p.isNone(this._index)&&!p.isNone(this._viewportQueries)){var N=!this._index.isLoading(),ca=this.featureTarget*this.baseLOD,O=this._index.featureEstimate;O.estimate=O.estimate||ca/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(N&&
O.estimate<ca){if(O.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(ca/O.estimate,1.001));N=this.lod;ca=this._index.checkFeatureTarget(ca,N);ca!==N&&(this._featureLOD=ca/this.baseLOD,this._stableFeatureLOD=!0)}else if(O.estimate>1.2*ca||N&&O.estimate>ca){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(O.estimate/ca-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.requestUpdate()}};U._processCache=function(N){const ca=this._index;if(p.isNone(ca))return!1;for(;0<this._newLoadingNodes.length&&!N.done;){var O=this._newLoadingNodes.pop();for(O=ca.getParent(O);p.isSome(O)&&!this.layerView.isNodeLoaded(O.index)&&this._isNodeInScaleBounds(O);O=ca.getParent(O.index))if(this._enableFromGPUCache(O,0)){N.madeProgress();break}}return N.hasProgressed};U._processNodes=function(N,ca){if(p.isNone(this._index))return!1;let O=(this._isIdle?100:2)-this._loadingNodes.size;
const V=this._index.updates;V.cancel.forEach(this._cancelNode,this);for(V.cancel=[];0<V.remove.length&&!N.done;)this.layerView.removeNode(V.remove.pop()),N.madeProgress();for(;0<V.update.length&&!N.done;){var ba=this._index.getNode(V.update.pop());p.isSome(ba)&&(this._updateLoadedNode(ba),N.madeProgress())}for(;0<V.add.length&&!N.done&&0<O;){--O;ba=this._index.getNode(V.add.back());if(p.isNone(ba)||2!==ba.cacheState&&!this._hasNodeLoadToken(ca))break;V.add.pop();this._loadNode(ba);N.madeProgress()}return N.hasProgressed};
U._cancelAllNodes=function(){this._loadingNodes.forEach(N=>N.abort());this._loadingNodes.clear();this._updatingNodes.forEach(N=>N.abort());this._updatingNodes.clear()};U._cancelNode=function(N){const ca=this._loadingNodes.get(N);ca&&(ca.abort(),this._loadingNodes.delete(N))};U._hasNodeLoadToken=function(N){return!this._isIdle&&2<=N.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<E.maxDownloadSlots&&!this.dataStreamController.busy};U._evaluateUpdating=function(){var N=!1,ca=0;this.layerView.suspended?
ca=(N=this._cameraDirty)?.5:1:(N=p.isSome(this._index)?this._index.getIndexMissing():0,ca=p.isSome(this._index)?this._index.updates.add.length:0,ca=N+3*ca+2*this._loadingNodes.size,N=!!(0<ca||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===ca&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(ca,this._progressMaxNumNodes),ca=1-ca/this._progressMaxNumNodes);N!==this.updating&&
this._set("updating",N);ca!==this.updatingProgress&&this._set("updatingProgress",ca)};U._updateViewData=function(){if(this._cameraDirty&&!p.isNone(this._index)&&!p.isNone(this._viewportQueries)){var N=this.layerView.view,{camera:ca,contentCamera:O,fixedContentCamera:V}=N.state;this.screenSizeFactor=1/(ca.perScreenPixelRatio/2);this._viewportQueries.updateCamera(ca,O,V);this._viewportQueries.setPointOfInterest(N.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};U._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};U.isGeometryVisible=function(N){return p.isSome(this._index)&&this._index.isGeometryVisible(N.index)};
U.updateVisibility=function(N){p.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(N)};U.updateBoundingVolume=function(N){p.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(N)};U.invalidateGeometryVisibility=function(N){p.isSome(this._index)&&this._index.invalidateGeometryVisibility(N)};U.invalidateVisibilityObbs=function(){p.isSome(this._index)&&this._index.invalidateVisibilityObbs()};U.modificationsChanged=function(){if(p.isSome(this._index)){const N=p.isSome(this.layer.modifications)&&
this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(N)}this._invisibleDirty=!0};U._shouldLoadNode=function(N){return this._lodHandling.shouldLoadNode(N)&&!this._shouldDropNode(N)&&this._isNodeInScaleBounds(N)?p.isSome(this._index)?this._index.isGeometryVisible(N.index):!1:!1};U._shouldDropNode=function(N){if(p.isNone(this._viewportQueries))return!1;const ca=this.lodDropFactor;return 1<=ca||!this._lodHandling.hasNoVisibleChildren(N)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(N))-
this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*ca};U._startNodeLoading=function(){this._restartNodeLoading=!1;const N=this._index;this._updatesDisabled||p.isNone(N)||p.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new J(this.layer,this.dataStreamController,aa,this._defaultGeometrySchema,this._requiredAttributes,
{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid}),N.requestUpdate(),this._lodHandling.startNodeLoading(ca=>this._isNodeInScaleBounds(ca),(ca,O)=>this._removeNodes(ca,O,1),N,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};U.isNodeLoading=function(){return null!=this._nodeLoader&&null!=
this._index};U.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};U._removeInvisibleNodes=function(N){const ca=this._index;if(p.isNone(ca)||p.isNone(this._viewportQueries))return!1;S.clear();this.layerView.getLoadedNodeIndices(S);const O=0===this._viewportQueries.maxDistance,V=O?()=>!1:ba=>this._shouldDropNode(ba);S.filterInPlace(ba=>
{const fa=ca.getNode(ba);return p.isNone(fa)||!ca.isGeometryVisible(ba)||V(fa)||!this._isNodeInScaleBounds(fa)});0<S.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(S,N,0);if(O&&1>this.lodDropFactor)return!1;if(0===S.length)return!0;S.clear();return!1};U.markNodeToRemove=function(N){S.push(N)};U.removeMarkedNodes=function(){this._removeNodes(S,C.noBudget,0)};U._removeNodes=function(N,ca,O){const V=N.length;if(0!==V&&!ca.done){for(p.isSome(this._index)&&this._index.requestUpdate();0<
N.length&&!ca.done;){const ba=N.pop(),fa=this._index;1===O&&this.layerView.nodeFadeoutEnabled&&p.isSome(fa)&&fa.isGeometryVisible(ba)?this.layerView.fadeNode(ba,1,!0):this.layerView.removeNode(ba);ca.madeProgress()}if(0<this._loadedNodeScales.size)for(ca=N.length;ca<V;ca++)this._loadedNodeScales.delete(N.data[ca])}};U._needsUpdate=function(N){if(!N.resources.hasFeatureData||this._updatingNodes.has(N.index))return!1;N=this.layerView.getLoadedAttributes(N.index);return null!=N&&N!==this._requiredAttributes};
U._updateLoadedNode=function(N){const ca=v.createAbortController();this._updatingNodes.set(N.index,ca);const O=this.layerView.getLoadedAttributes(N.index);(Q(O,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(N.index)):this._nodeLoader.loadAttributes(N,this._requiredAttributes,ca.signal)).then(V=>this.schedule(()=>this.layerView.updateAttributes(N.index,{loadedAttributes:this._requiredAttributes,attributeData:V},ca.signal),ca.signal)).catch(V=>{if(!v.isAbortError(V))return this.layerView.updateAttributes(N.index,
{loadedAttributes:this._requiredAttributes,attributeData:{}},ca.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(N.index);this._evaluateUpdating()});this._evaluateUpdating()};U._loadNode=function(N){if(this._loadingNodes.has(N.index))aa.error("already loading node "+N.index);else{var ca=v.createAbortController();this._loadingNodes.set(N.index,ca);var O=()=>{this._loadingNodes.get(N.index)===ca&&this._loadingNodes.delete(N.index);this._evaluateUpdating()};this._evaluateUpdating();this._loadAndAddNode(N,
ca.signal).then(O).catch(V=>{O();if(!v.isAbortError(V))throw V;})}};U._loadAndAddNode=function(N,ca){return 1===N.cacheState?this._loadUncached(N,ca):this._loadCached(N,ca).then(O=>{O||(N.cacheState=1,p.isSome(this._index)&&this._index.updates.add.push(N.index))}).catch(O=>{if(!v.isAbortError(O))throw N.cacheState=1,O;})};U._enableFromGPUCache=function(N,ca){if(this._disableMemCache||p.isNone(this._index))return!1;if(0===ca&&!this._index.useNodeAsHole(N.index))return!0;const O=this._loadCachedGPUData(N);
if(!O)return!1;this.layerView.addCachedGPUData(N,O,ca);this._nodeAdded();return!0};U._loadCachedGPUData=function(N){N=this.layerView.loadCachedGPUData(N);if(p.isSome(N)&&p.isSome(N.attributeInfo)&&Q(N.attributeInfo.loadedAttributes,this._requiredAttributes))return N;this.layerView.deleteCachedGPUData(N);return null};U._nodeAdded=function(){p.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};U._loadCached=function(N,ca){if(this._enableFromGPUCache(N,
1))return Promise.resolve(!0);const O=this.layerView;return!this.disableIDBCache&&O.loadCachedNodeData&&O.addCachedNodeData?this.schedule(()=>O.loadCachedNodeData(N,ca,(V,ba)=>this._nodeLoader.loadTextures(N,V,ba)),ca).then(V=>{if(p.isNone(V))return!1;const ba=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(N,ba,ca),ca).then(fa=>this.reschedule(()=>O.addCachedNodeData(N,V,{loadedAttributes:ba,attributeData:fa},ca),ca)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};
U._loadUncached=function(N,ca){this._downloadingCount++;return this._nodeLoader.loadNodeData(N,ca).catch(O=>{this._downloadingCount--;throw O;}).then(O=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(N,O,ca),ca)}).then(()=>{this._nodeAdded();N.cacheState=2}).catch(O=>{if(!v.isAbortError(O))throw aa.error("#loadNodeData()",this.layer,`Failed to load node '${N.id}'`,O),N.failed=!0,p.isSome(this._index)&&this._index.requestUpdate(),O;})};U._updateIdleState=function(N){N!==
this._isIdle&&(this._isIdle=N,this._evaluateUpdating(),N&&this._index&&p.isSome(this._index)&&this._index.resetFailedNodes())};U._getScale=function(N){if(this._loadedNodeScales.has(N.index))return this._loadedNodeScales.get(N.index);this._tmpPoint.x=N.mbs[0];this._tmpPoint.y=N.mbs[1];this._tmpPoint.z=N.mbs[2];const ca=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(N.index)&&this._loadedNodeScales.set(N.index,ca);return ca};U._isNodeInScaleBounds=function(N){if(!this.areScaleBoundsActive)return!0;
N=this._getScale(N);const {minScale:ca,maxScale:O}=x.extractSafeScaleBounds(this.layer);return x.scaleBoundsPredicate(N,ca,O)};U.updateStats=function(N){N.index=p.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(N.detail=this._featureLOD,N.target=this.featureTarget*this.baseLOD);p.isSome(this._index)&&this._index.updateStats(N)};U.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();p.isSome(this._index)&&this._index.requestUpdate()};U.geometryFilterChanged=
function(N){const ca=this._index;p.isSome(ca)&&ca.layerFilterChanged(N);this.requestUpdate()};a._createClass(Y,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",get:function(){return"points"===this.layer.profile}},{key:"indexStreamController",get:function(){const N=this.layerView.view.resourceController.createStreamDataRequester(2);return new L.I3SStreamDataController(N)}},{key:"dataStreamController",get:function(){const N=
this.layerView.view.resourceController.createStreamDataRequester(3);return new L.I3SStreamDataController(N)}},{key:"crsVertex",get:function(){return G.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return G.getIndexCrs(this.layer)}},{key:"rootNodeVisible",get:function(){if(p.isSome(this._index)){const N=this._index.rootNode;if(p.isSome(N))return this._updateViewData(),this._index.isNodeVisible(N.index)}return!0}},{key:"isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},
{key:"areScaleBoundsActive",get:function(){const {minScale:N,maxScale:ca}=x.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<N||0<ca)}},{key:"unloadedMemoryEstimate",get:function(){return p.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",get:function(){return p.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(N){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||
(this._disableMemCache=!0);this._disableMemCache=N}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const N=this.layerView.lodFactor,ca=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<N?N:1)*ca}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const N=this.layerView.view.resourceController.memoryController;return(Math.min(N.memoryFactor,.5)-N.minQuality)/(.5-N.minQuality)}},
{key:"test",get:function(){const N=this;return{index:this._index,set disableUpdates(ca){(N._updatesDisabled=ca)?N.cancelNodeLoading():N.requestUpdate()},set disableIDBCache(ca){N.disableIDBCache=ca},set ignoreServiceObb(ca){p.isSome(N._index)&&(N._index.ignoreServiceObb=ca)},shouldLoadNode:ca=>N._shouldLoadNode(ca)}}}]);return Y}(l.EsriPromiseMixin(t));g.__decorate([c.property({readOnly:!0})],f.prototype,"isMeshPyramid",null);g.__decorate([c.property({readOnly:!0})],f.prototype,"isGraphics3D",null);
g.__decorate([c.property({readOnly:!0})],f.prototype,"indexStreamController",null);g.__decorate([c.property({readOnly:!0})],f.prototype,"dataStreamController",null);g.__decorate([c.property({readOnly:!0})],f.prototype,"crsVertex",null);g.__decorate([c.property({readOnly:!0})],f.prototype,"crsIndex",null);g.__decorate([c.property()],f.prototype,"screenSizeFactor",void 0);g.__decorate([c.property()],f.prototype,"featureTarget",void 0);g.__decorate([c.property()],f.prototype,"fixedFeatureTarget",void 0);
g.__decorate([c.property()],f.prototype,"layerView",void 0);g.__decorate([c.property()],f.prototype,"layer",void 0);g.__decorate([c.property({readOnly:!0})],f.prototype,"updating",void 0);g.__decorate([c.property({readOnly:!0})],f.prototype,"updatingProgress",void 0);g.__decorate([c.property({readOnly:!0})],f.prototype,"leavesReached",void 0);g.__decorate([c.property({constructOnly:!0})],f.prototype,"scaleVisibilityEnabled",void 0);g.__decorate([c.property({readOnly:!0,dependsOn:[]})],f.prototype,
"rootNodeVisible",null);f=g.__decorate([e.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],f);const S=new u({deallocator:null});let H;const R={factorIM:.2,factor3dObject:.05,distancePenalty:10},T=D.create();return f})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../core/arrayUtils","../../../support/Scheduler"],function(a,g,b){let p=function(){function k(d){this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=d.registerTask(b.Task.I3S_CONTROLLER,
e=>this.update(e),()=>this.needsUpdate())}var c=k.prototype;c.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};c.needsUpdate=function(){for(const d of this.callbacks)if(d.needsUpdate())return!0;return!1};c.update=function(d){this.sort();const e=this.callbacks,h={numIndexLoading:0,numNodesLoading:0};for(let n=0;n<e.length&&!d.done;++n)e[n].priority=e[n].update(d,h),this.runIndex=n};c.sort=function(){const d=this.callbacks;let e=d.length;for(let h=this.runIndex;0<h;h--){const n=
d[h-1];let q=h;for(;q<d.length&&n.priority<=d[q].priority&&(q!==e||n.priority<d[q].priority);)d[q-1]=d[q],q++;d[q-1]=n;e=q-1}this.runIndex=0};c.add=function(d){this.sort();d.priority=Infinity;this.callbacks.unshift(d)};c.remove=function(d){g.removeUnordered(this.callbacks,d);this.runIndex=this.callbacks.length;this.sort()};return k}();const f=new Map;a.addTask=function(k,c){let d=f.get(k);null==d&&(d=new p(k),f.set(k,d));d.add(c);return{remove:()=>{null!=d&&(d.remove(c),0<d.callbacks.length||(f.delete(k),
d.destroy()),d=null)}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/orientedBoundingBox ./I3SNode ./I3SUtil".split(" "),function(a,g,b,p,f,k,c,d,e,h){function n(C){b.isSome(C.node)&&(C.node.renderMbs[3]=-1,b.isSome(C.node.serviceObbInRenderSR)&&
(C.node.serviceObbInRenderSR.halfSize[0]=-1));b.isSome(C.ref)&&(C.ref.renderMbs[3]=-1,b.isSome(C.ref.serviceObbInRenderSR)&&(C.ref.serviceObbInRenderSR.halfSize[0]=-1))}function q(C,A){return 0===A?0:C/A|0}function u(C,A){return 0===A?C:C%A}function v(C){if(C)for(let A=0;A<C.length;A++)for(const x of z)if(x[0]===C[A].metricType)return{lodMetric:x[1],maxError:C[A].maxError};return{lodMetric:0,maxError:0}}function t(C){return Math.sqrt(4/Math.PI*C)}let l=function(C,A,x,m,B){this.childOffset=C;this.childCount=
A;this.visibilityCache=x;this.ref=m;this.node=B;this.useAsHole=0},w=function(){function C(x,m,B,E,F,G,I,K,J,L,P,Q,X,aa){this.streamDataController=B;this.viewportQueries=E;this.logger=F;this.holeFilling=G;this._isLoaded=I;this._isReloading=K;this._isSelected=J;this._enable=L;this._needsUpdate=P;this._canRequest=Q;this._computeVisibilityObb=X;this._computeNodeFiltering=aa;this._dirty=!0;this._nodePages=[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=S=>S;this.urlPrefix=
"";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=h.addWraparound(0,2);this._visibilityCacheVersion=h.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new p({deallocator:null});this._prefetch=new p({deallocator:null});this._updates=
new D;this._imModificationUncategorized=new p({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._layerHasFilter=this.layerHasModifications=!1;this.logLayer=x;x.serviceUpdateTimeStamp&&x.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${x.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this.init(m)}var A=C.prototype;A.init=function(x){if("page"===x.type){this.urlPrefix=x.urlPrefix;this.nodesPerPage=x.pageSize;
this.rootIndex=x.rootIndex;switch(x.lodMetric){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=t}this.addPage(q(this.rootIndex,this.nodesPerPage),x.rootPage)}else"node"===x.type&&(this.urlPrefix=x.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode(new e.NodeBase(x.rootNode.id,null),-1),(x=this._validateNode(x.rootNode.id,x.rootNode))&&this.addNode(x,0))};A.loadPage=function(x){this._loading.add(x);this.streamDataController.request(this.urlPrefix+
x,"json").then(m=>{this._loading.delete(x);this.addPage(x,m)}).catch(m=>{this._loading.delete(x);f.isAbortError(m)||(this._failedPages.add(x),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${x}`,m))})};A.addPage=function(x,m){for(let F=this._nodePages.length;F<x;F++)this._nodePages[F]=null;const B=[],E=[];m=m.nodes.map((F,G)=>{const I=B.length,K=F.children?F.children.length:0;E.push(-1);for(var J=0;J<K;J++)B.push(F.children[J]);const L=`${F.index}`;J=d.clone(F.obb);const P=
c.fromArray([J.center[0],J.center[1],J.center[2],k.length(J.halfSize)]),Q=F.mesh&&F.mesh.attribute,X=F.mesh&&F.mesh.geometry,aa=F.mesh&&F.mesh.material;F=new e.Node(L,x*this.nodesPerPage+G,P,K,0,{hasSharedResource:!1,hasFeatureData:!!X,attributes:Q&&null!=Q.resource?`${Q.resource}`:null,geometry:X&&null!=X.resource?`${X.resource}`:null,texture:aa&&null!=aa.resource?`${aa.resource}`:null,geometryDefinition:X?X.definition:-1,materialDefinition:aa?aa.definition:-1},this.lastUpdate,this.lodMetric,this.lodConversion(F.lodThreshold),
X?X.featureCount:null);F.serviceObb=J;F.visibilityObb=this._computeVisibilityObb(F);F.vertexCount=X?X.vertexCount:0;return new l(I,K,h.addWraparound(this._visibilityCacheVersion,-2),null,F)});this._nodePages[x]={nodes:m,children:B,parents:E};this.nodeCount+=m.length;this.updateParentsAndLevel()};A.updateParentsAndLevel=function(){const x=[],m=(B,E,F)=>{const G=this.getPage(B);if(b.isSome(G)){const I=u(B,this.nodesPerPage);G.parents[I]=E;E=G.nodes[I].node;b.isSome(E)&&(E.level=F,x.push(B))}};for(m(this.rootIndex,
-1,0);x.length;){const B=x.pop(),E=this.getNode(B);if(b.isSome(E))for(let F=0;F<E.childCount;F++){const G=this.getChildIndex(E,F);m(G,B,E.level+1);this._maxLevel=Math.max(this._maxLevel,E.level+1)}}};A.getPage=function(x){return this._nodePages[q(x,this.nodesPerPage)]};A.getNodeInternal=function(x){const m=this.getPage(x);return b.isNone(m)?null:m.nodes[u(x,this.nodesPerPage)]};A.addNode=function(x,m){null!=x.children&&this.populateChildren(m,x.children);var B=this.getParent(m);B=b.isSome(B)?B.level+
1:0;this._maxLevel=Math.max(this._maxLevel,x.children?B+1:B);const {lodMetric:E,maxError:F}=v(x.lodSelection),G=b.unwrap(this.getNodeInternal(m));G.node=new e.Node(x.id,m,c.fromArray(x.mbs),G.childCount,B,x.resources,x.version,E,F,x.numFeatures);x.obb&&(G.node.serviceObb=d.clone(x.obb));G.node.visibilityObb=this._computeVisibilityObb(G.node);b.isSome(G.ref)&&(null==G.ref.mbs&&(G.ref.mbs=x.mbs),G.node.renderMbs=G.ref.renderMbs,G.node.serviceObbInRenderSR=G.ref.serviceObbInRenderSR,G.ref.visibilityObb=
G.node.visibilityObb);return G.node};A.makeRefNode=function(x,m){const B=this._nodePages[0],E=B.nodes.length;B.nodes.push(new l(0,0,h.addWraparound(this._visibilityCacheVersion,-2),x,null));this.nodeCount++;B.parents.push(m);x.renderMbs[3]=-1;b.isSome(x.serviceObbInRenderSR)&&(x.serviceObbInRenderSR.halfSize[0]=-1);return E};A.populateChildren=function(x,m){var B=b.unwrap(this.getNodeInternal(x));const E=b.unwrap(this.getPage(x));B.childOffset=E.children.length;B.childCount=m.length;for(B=0;B<m.length;B++){const F=
this.makeRefNode(m[B],x);E.children.push(F)}};A.getNode=function(x){x=this.getNodeInternal(x);return b.isSome(x)?x.node:null};A.getIndexById=function(x){let m;this.forAllNodes((B,E)=>{b.isSome(B.node)&&B.node.id===x?m=E:b.isSome(B.ref)&&B.ref.id===x&&(m=E)});return m};A.getNodeById=function(x){x=this.getIndexById(x);return 0<=x?this.getNode(x):null};A.getChildIndex=function(x,m){const B=this.getPage(x.index);if(b.isNone(B))return-1;x=B.nodes[u(x.index,this.nodesPerPage)];return B.children[x.childOffset+
m]};A.getParentIndex=function(x){const m=this.getPage(x);return b.isSome(m)?m.parents[u(x,this.nodesPerPage)]:-1};A.getParent=function(x){x=this.getParentIndex(x);return 0<=x?this.getNode(x):null};A.isLeaf=function(x){x=this.getNodeInternal(x);return b.isSome(x)&&0===x.childCount};A.invalidateVisibilityCache=function(){this._visibilityCacheVersion=h.addWraparound(this._visibilityCacheVersion,2)};A.invalidateNodeVisibilityCache=function(x){x=this.getNodeInternal(x);b.isSome(x)&&this.invalidateNodeVisibilityCacheInternal(x)};
A.invalidateNodeVisibilityCacheInternal=function(x){x.visibilityCache=h.addWraparound(this._visibilityCacheVersion,-2)};A.invalidateBoundingVolumeCache=function(x){x=this.getNodeInternal(x);b.isSome(x)&&(n(x),this.invalidateNodeVisibilityCacheInternal(x))};A.invalidateGeometryVisibility=function(x){x=this.getNodeInternal(x);b.isSome(x)&&b.isSome(x.node)&&(x.node.geometryObb=null,x.node.renderMbs[3]=-1,b.isSome(x.node.serviceObbInRenderSR)&&(x.node.serviceObbInRenderSR.halfSize[0]=-1))};A.invalidateVisibilityObbs=
function(){b.isNone(this.rootNode)||this.traverse(this.rootNode,x=>{x.visibilityObb=this._computeVisibilityObb(x);x.geometryObb=null;return!0})};A.isNodeVisible=function(x){x=this.getNodeInternal(x);if(b.isNone(x)||b.isSome(x.ref)&&!x.ref.mbs)return!0;if((x.visibilityCache&-2)!==this._visibilityCacheVersion){var m=x.node;const B=b.isSome(m)&&(b.isNone(x.ref)||b.isSome(m.visibilityObb))?m:b.isSome(x.ref)?x.ref:null;this._layerHasFilter&&this._computeNodeFiltering&&b.isSome(m)&&2===m.filterImpact&&
this._computeNodeFiltering(m);const E=b.isSome(m)&&1===m.filterImpact;m=!(b.isSome(m)&&2===m.imModificationImpact)&&(!B||this.viewportQueries.isNodeVisible(B))&&!E;x.visibilityCache=this._visibilityCacheVersion+(m?1:0);return m}return 1===(x.visibilityCache&1)};A.isGeometryVisible=function(x){if(!this.isNodeVisible(x))return!1;x=this.getNodeInternal(x);return b.isSome(x)&&b.isSome(x.node)&&b.isSome(x.node.geometryObb)&&(!this.layerHasModifications||4!==x.node.imModificationImpact)?this.viewportQueries.isGeometryVisible(x.node):
!0};A._traverseCoverage=function(x,m,B,E,F){x=this.getPage(x);if(!b.isNone(x)&&0!==m.childCount){var G=m.childOffset+m.childCount,I=[];for(m=m.childOffset;m<G;++m){const K=x.children[m],J=this.getNodeInternal(K);b.isSome(J)&&b.isSome(J.node)&&this.isGeometryVisible(K)&&I.push(J)}E/=I.length;for(const K of I)x=b.unwrap(K.node).index,this._isLoaded(x)||this._isReloading(x)?(F.delta=Math.max(F.delta,B),F.coverage+=E):this._traverseCoverage(x,K,B+1,E,F)}};A.useNodeAsHole=function(x){if("off"===this.holeFilling)return!1;
const m=this.getNodeInternal(x);if(b.isNone(m))return!1;if("always"===this.holeFilling)return!0;if((m.useAsHole&-2)===this._version)return 1===(m.useAsHole&1);const B={delta:0,coverage:0};this._traverseCoverage(x,m,0,1,B);x=.5>=B.delta*B.coverage;m.useAsHole=this._version+(x?1:0);return x};A.destroy=function(){this._updates.add.prune();this._updates.update.prune()};A.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=h.addWraparound(this._version,2)};A.imModificationsChanged=
function(x){this.layerHasModifications=x;this.forAllNodes(({node:m})=>{b.isSome(m)&&(m.imModificationImpact=4,m.visibilityObb=this._computeVisibilityObb(m),m.hasModifications&&this.invalidateGeometryVisibility(m.index))});this.invalidateVisibilityCache()};A.layerFilterChanged=function(x){this._layerHasFilter=x;this.forAllNodes(({node:m})=>{b.isSome(m)&&(m.filterImpact=2,this.invalidateNodeVisibilityCache(m.index),m.visibilityObb=this._computeVisibilityObb(m),this.invalidateGeometryVisibility(m.index))});
this.invalidateVisibilityCache()};A.update=function(x,m,B){if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(x,this._missing);y.clear();var E=!0,F=new r,G=new r,I=this._imModificationUncategorized;I.clear();var K=new Set;this.traverseVisible((L,P,Q)=>{if(b.isNone(P))P=this.entryPriority(L),Infinity===P&&(P=this.entryPriority(Q)),L=q(L,this.nodesPerPage),y.set(L,Math.max(P,y.get(L)||0)),this._loading.has(L)||
this._failedPages.has(L)||this._missing.push(L),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P);else{var X=P.node;this._updateNodeFeatureEstimate(X,G);if(b.isNone(X))P=this.entryPriority(L),this._loading.has(L)||this._failedNodes.has(L)||(this._missing.push(L),y.set(L,P)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P);else{Q=b.unwrap(this.getPage(L));if(0===this._missing.length&&0===this.nodesPerPage)for(let aa=0;aa<P.childCount;aa++){const S=Q.children[P.childOffset+aa],
H=this.getNodeInternal(S);!b.isSome(H)||H.node||this._loading.has(S)||this._failedNodes.has(S)||(y.set(S,this.entryPriority(S)),this._prefetch.push(S))}!X.failed&&X.resources.hasFeatureData&&(K.add(X.id),this._isLoaded(L)?(F.known+=X.memory,++F.knownNodes,this._isSelected(X)?0<P.childCount&&(E=!1):(F.unremoved+=X.memory,E=!1),this._needsUpdate(X)&&(P=this.entryPriority(L),y.set(L,P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P),this._updates.update.push(L))):(X.memory&&(F.known+=X.memory,
++F.knownNodes),this._isSelected(X)?(0<P.childCount&&(E=!1),X.memory?(F.missing+=X.memory,F.known+=X.memory,++F.knownNodes):++F.missingNodes,0<=x.indexOf(X.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this.entryPriority(L)),this._updates.cancel=this._updates.cancel.filter(aa=>aa!==X.index)):!m.done&&this._enable(X)?m.madeProgress():(P=this.entryPriority(L),y.set(L,P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P),this._updates.add.push(L),this.layerHasModifications&&
B&&b.isSome(X)&&4===X.imModificationImpact&&I.push(L))):this._isReloading(L)&&this._updates.remove.push(L)))}}});var J=this._updates.add;0<J.length&&this.layerHasModifications&&(0<I.length&&B(I),J.filterInPlace(L=>{var P=this.getNodeInternal(L);(P=b.isNone(P)||b.isNone(P.node)||2!==P.node.imModificationImpact)||this.invalidateNodeVisibilityCache(L);return P}));this._unloadedMemoryEstimate=F.missing-F.unremoved;3<F.knownNodes&&0<F.missingNodes&&(this._unloadedMemoryEstimate+=F.known/F.knownNodes*F.missingNodes);
this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(G);this._featureEstimate.leavesReached=E;this._missing.sort((L,P)=>L-P);this._missing.filterInPlace((L,P)=>1>P||this._missing.data[P-1]!==L);this._missing.sort((L,P)=>y.get(L)-y.get(P));0<this._missing.length?(this._maxUnloadedPrio=y.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort((L,P)=>y.get(L)-y.get(P));this._updates.add.filterInPlace(L=>y.get(L)>=
this._maxUnloadedPrio).sort((L,P)=>y.get(L)-y.get(P));this._updates.update.sort((L,P)=>y.get(L)-y.get(P));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;y.clear()}};A.checkFeatureTarget=function(x,m){const B=this.viewportQueries.updateScreenSpaceErrorBias(m);let E=m,F=m,G=B,I=10;for(;I--;){const K=new r;this._updateFeatureEstimate(E,K);if(this._computeFeatureEstimate(K)<=x){if(E>=m||0<K.missingNodes||0===I)break;G=E;E=.5*(E+F)}else F=E,E=.5*(E+G)}this._version=
h.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(B);return Math.min(m,E)};A._updateFeatureEstimate=function(x,m){this._version=h.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(x);this.traverseVisible((B,E)=>this._updateNodeFeatureEstimate(b.isSome(E)&&E.node,m))};A._updateNodeFeatureEstimate=function(x,m){b.isNone(x)||x.failed||b.isNone(x.numFeatures)||(this._isLoaded(x.index)?(m.known+=x.numFeatures,++m.knownNodes,this._isSelected(x)||
(m.unremoved+=x.numFeatures)):this._isSelected(x)&&(b.isSome(x.numFeatures)?(m.missing+=x.numFeatures,m.known+=x.numFeatures,++m.knownNodes):++m.missingNodes))};A._computeFeatureEstimate=function(x){let m=x.known-x.unremoved;3<x.knownNodes&&0<x.missingNodes&&(m+=x.known/x.knownNodes*x.missingNodes);return Math.max(0,m)};A.load=function(){return this._load(this._missing)};A.prefetch=function(){return this._load(this._prefetch)};A._load=function(x){if(0===x.length||!this._canRequest())return!1;for(;0<
x.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(x.pop()):this.loadPage(x.pop());return!0};A.isLoading=function(){return 0<this._indexMissing};A.getIndexLoading=function(){return this._loading.size};A.getIndexMissing=function(){return this._indexMissing};A.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};A.nodeTraversalState=function(x){if(b.isNone(x))return null;let m=this._nodeTraversalState.get(x.index);if(m&&(m.version&-2)===this._version)return m;const B=
this.viewportQueries.getLodLevel(x),E=this.viewportQueries.hasLOD(x);var F=!0;E?(F=this.getParentIndex(x.index),F=0<=F?(F=this._nodeTraversalState.get(F))&&B>F.lodLevel:0<B):F=0===x.childCount;if(m)return m.lodLevel=B,m.isChosen=F,m.version=this._version+1,m;m=new e.NodeTraversalState(E,F,B,this._version+1);this._nodeTraversalState.set(x.index,m);return m};A._loadNode=function(x){this._loading.add(x);const m=b.unwrap(this.getNodeInternal(x)).ref;if(b.isNone(m))this._failedNodes.add(x);else{var B=
m.id,E=this.urlPrefix+B,F=()=>{this._loading.delete(x);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(E,"json").then(G=>{F();G=this._validateNode(B,G);null!=G&&(G.obb&&this.invalidateNodeVisibilityCache(x),G=this.addNode(G,x),this.nodeTraversalState(G))},G=>{F();f.isAbortError(G)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+E),this._failedNodes.add(x))})}};A._validateNode=function(x,m){if(null==m||"object"!==typeof m||
m.id!==x)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${x}"`),null;if(!Array.isArray(m.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${x}.`),null;m.sharedResource&&"./shared"!==m.sharedResource.href&&"./shared/"!==m.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${x}"`);null==m.geometryData||Array.isArray(m.geometryData)&&1===m.geometryData.length&&
"./geometries/0"===m.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${x}"`);null==m.attributeData||Array.isArray(m.attributeData)&&!m.attributeData.some((G,I)=>G.href!==`./attributes/f_${I}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${x}"`);m.featureData&&1<m.featureData.length&&this.logger.warn("#validateNode()",this.logLayer,`Node ${x} has ${m.featureData.length} bundles. Only the first bundle will be loaded.`);
const B=m.hasOwnProperty("obb")&&!this.ignoreServiceObb?m.obb:null,E=m.featureData&&1===m.featureData.length&&m.featureData[0].featureRange?m.featureData[0].featureRange[1]-m.featureData[0].featureRange[0]+1:null;var F=G=>{if(null==G)return null;var I=K=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${x}: ${K}`);if("number"===typeof G.id)I(`id ${G.id} is a number instead of a string.`);else if("string"!==typeof G.id||!Array.isArray(G.mbs))return I("Missing or invalid id."),
null;if(!Array.isArray(G.mbs))return I(`Invalid bounding volume on reference ${G.id}.`),null;G.href&&G.href!=="../"+G.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${x}"`);I=G.hasOwnProperty("obb")&&!this.ignoreServiceObb?G.obb:null;G=new e.NodeBase(`${G.id}`,G.mbs);G.serviceObb=I;G.visibilityObb=this._computeVisibilityObb(G);return G};F=Array.isArray(m.children)?m.children.map(F).filter(G=>null!=G):null;return{id:x,mbs:m.mbs,obb:B,children:F,resources:{hasFeatureData:m.featureData&&
0<m.featureData.length,hasSharedResource:null!=m.sharedResource,attributes:m.attributeData?x:null,texture:m.textureData&&0<m.textureData.length?x:null,geometry:null!=m.geometryData?x:null},version:"string"===typeof m.version?m.version:null,lodSelection:Array.isArray(m.lodSelection)?m.lodSelection:null,numFeatures:E}};A.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(x=>{b.isSome(x.node)&&(x.node.failed=!1)})};A.entryPriority=function(x){var m=this.getNodeInternal(x),
B=this.getParentIndex(x);if(b.isNone(m)||0>B&&null==m.node)return 0>B?Infinity:this.entryPriority(B);let E=0;m.node&&0<=B&&(B=this._nodeTraversalState.get(B),null!=B&&(E=B.lodLevel));for(B=this.progressiveLoadPenalty;0<=x;x=this.getParentIndex(x))if(this._isLoaded(x)){B=0;break}m=b.isSome(m.ref)?this.viewportQueries.distToPOI(m.ref):b.isSome(m.node)?this.viewportQueries.distToPOI(m.node):0;return-m-E*(m+this.progressiveLoadPenalty)+B};A.traverseVisible=function(x){const m=this.getNodeInternal(this.rootIndex);
b.isNone(m)?x(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,m,x)};A._traverseVisible=function(x,m,B,E){if(B.node&&0===B.childCount)this.isGeometryVisible(x)&&E(x,B,m);else if(this.isNodeVisible(x)&&(E(x,B,m),null!=B.node&&(m=this.nodeTraversalState(B.node),!m.nodeHasLOD||m.lodLevel!==this._maxLodLevel))){m=b.unwrap(this.getPage(x));for(let F=0;F<B.childCount;F++){const G=m.children[B.childOffset+F],I=this.getNodeInternal(G);b.isSome(I)?this._traverseVisible(G,x,I,E):E(G,null,x)}}};
A.traverse=function(x,m){m(x)&&this.traverseChildren(x,m)};A.traverseChildren=function(x,m){x=x.index;const B=this.getNodeInternal(x);b.isSome(B)&&this._traverseChildren(x,B,m)};A._traverseChildren=function(x,m,B){x=this.getPage(x);if(!b.isNone(x)){var E=m.childOffset+m.childCount;for(m=m.childOffset;m<E;++m){const F=x.children[m],G=this.getNodeInternal(F);b.isSome(G)&&b.isSome(G.node)&&B(G.node)&&this._traverseChildren(F,G,B)}}};A.updateStats=function(x){0<this._updates.add.length&&(x.nodes+=" + "+
this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)x.index+=" + "+this._indexMissing||this._prefetch.length;x.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const m=this._featureEstimate.estimate-x.features;0<m?x.features+=" + "+m:0>m&&(x.features+=" - "+-m)}};A.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};A.updateElevationInfo=function(x){this.forAllNodes(n);this.viewportQueries.updateElevationInfo(x)};A.forAllNodes=
function(x){for(let m=0;m<this._nodePages.length;m++){const B=this._nodePages[m];if(B){const E=m*this.nodesPerPage;for(let F=0;F<B.nodes.length;F++)x(B.nodes[F],E+F)}}};g._createClass(C,[{key:"rootNode",get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},
{key:"test",get:function(){return{addNode:(x,m)=>this.addNode(x,m)}}}]);return C}();const y=new Map;let D=function(){function C(){this.update=new p({deallocator:null});this.add=new p({deallocator:null});this.remove=new p({deallocator:null});this.cancel=[]}C.prototype.reset=function(A,x){this.add.clear();this.update.clear();this.cancel=A;this.missing=x};return C}();const z=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];let r=function(){this.unremoved=
this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=w;a.selectErrorMetric=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64"],function(a,g,b){let p=function(k,c){this.id=k;this.mbs=c;this.renderMbs=b.fromArray([0,0,0,-1]);this.imModificationImpact=4;this.filterImpact=2},f=function(k){function c(d,e,h,n,q,u,v,t,l,w){d=k.call(this,d,h)||this;
d.index=e;d.childCount=n;d.level=q;d.resources=u;d.version=v;d.lodMetric=t;d.maxError=l;d.numFeatures=w;d.failed=!1;d.hasModifications=!1;d.cacheState=0;d.vertexCount=0;d.memory=0;return d}g._inheritsLoose(c,k);return c}(p);a.Node=f;a.NodeBase=p;a.NodeTraversalState=function(k,c,d,e){this.nodeHasLOD=k;this.isChosen=c;this.lodLevel=d;this.version=e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../core/PooledArray"],function(a,g,b){let p=function(){function k(d){this.layerView=d;this._lodGlobalDirty=!1}var c=k.prototype;c.startNodeLoading=function(d,e,h,n){this._maxLodLevel=n.maxLodLevel;this._index=h;this._isNodeInScaleBounds=d;this._removeNodes=e};c.shouldLoadNode=function(d){if(g.isNone(d))return!1;const e=this._index.nodeTraversalState(d);return this.isChosenMaxLOD(e)?!0:e.isChosen?this._childrenRequireLoading(d):!1};c.setLodGlobalDirty=function(){this._lodGlobalDirty=
!0};c.lodGlobalHandling=function(d){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));f.clear();this._lodGlobalHandling(this._index.rootNode,e,!1);e=f.length;this._removeNodes(f,d);d=f.length<e;0!==f.length&&(this._lodGlobalDirty=!0);f.clear();return d};c._lodGlobalHandling=function(d,e,h){if(g.isNone(d))return!1;const n=d.index,q=this._index,u=this.layerView;var v=q.nodeTraversalState(d);
const t=this.isChosenMaxLOD(v);v=u.isNodeLoaded(n);const l=u.nodeCrossfadingEnabled;if(l&&v&&t){var w=!h&&this.hasNoVisibleChildren(d);u.fadeNode(n,0,!w)}w=v&&(!u.isNodeFullyFadedIn||u.isNodeFullyFadedIn(n));if(v&&(u.updateNodeState(n,t?1:0),t))return w&&this._removeChildrenRecursive(d),w;var y=0<d.childCount;let D=y;if(y)for(y=0;y<d.childCount;y++){const z=q.getChildIndex(d,y),r=q.getNode(z);g.isSome(r)?q.isGeometryVisible(z)&&!this._lodGlobalHandling(r,e,h||w)&&this._isNodeInScaleBounds(r)&&(D=
!1):q.isNodeVisible(z)&&(D=!1)}(e=v&&!t&&(D||f.length<e))&&f.push(n);!l||e||!v||h||D||u.fadeNode(n,0,!1);d=!d.resources.hasFeatureData;return D||w&&!e||d};c._removeChildrenRecursive=function(d){this._index.traverseChildren(d,e=>{(this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&f.push(e.index);return!0})};c.hasNoVisibleChildren=function(d){let e=!0;this._index.traverseChildren(d,h=>e&&this._index.isNodeVisible(h.index)?this.layerView.isNodeLoaded(h.index)?e=!1:!0:!1);
return e};c._childrenRequireLoading=function(d){let e=!1,h=!0;this._index.traverseChildren(d,n=>{if(!h||!this._index.isNodeVisible(n.index))return!1;const q=this._index.nodeTraversalState(n);this.isChosenMaxLOD(q)&&this._index.isGeometryVisible(n.index)&&(e=!0);return this.layerView.isNodeLoaded(n.index)?h=!1:!0});return h&&e};c.isChosenMaxLOD=function(d){return d.isChosen&&(!d.nodeHasLOD||d.lodLevel===this._maxLodLevel)};a._createClass(k,[{key:"requiresLODGlobalHandling",get:function(){return null!=
this._index&&!0===this._lodGlobalDirty}}]);return k}();const f=new b({deallocator:null});return p})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../core/asyncUtils ./I3SBinaryReader ./I3SUtil ./I3SMaterialUtil".split(" "),function(a,g,b,p,f,k,c,d,e){return function(){function h(q,u,v,t,l,w){this.streamDataController=u;this.logger=v;this.defaultGeometrySchema=
t;this.requiredAttributes=l;this.options=w;this.logLayer=q;this.layerUrl=q.parsedUrl.path;this.geometryDefinitions=q.geometryDefinitions;if(q.materialDefinitions){const y=q.textureSetDefinitions;this.materialAndTextures=q.materialDefinitions.map(D=>e.getMaterialAndTextures(y,D))}}var n=h.prototype;n.load=function(q,u,v){return this.streamDataController.request(q,u,{signal:v})};n.loadAttribute=function(q,u,v){return this.load(`${this.layerUrl}/nodes/${q.resources.attributes}/attributes/${u.key}/0`,
"binary",v).then(t=>c.readBinaryAttribute(u,t))};n.loadAttributes=function(q,u,v){return f.eachAlways(u.map(t=>this.loadAttribute(q,t.attributeStorageInfo,v))).then(t=>{const l={};for(let w=0;w<u.length;++w)if(t[w].value)l[u[w].name]=t[w].value;else{if(f.isAbortError(t[w].error))throw t[w].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${u[w].name}' on node '${q.id}'`,t[w].error)}return l})};n.loadNodeData=async function(q,u){var v=null!=this.requiredAttributes&&
q.resources.attributes?k.result(this.loadAttributes(q,this.requiredAttributes,u)):null;var t=this.geometryDefinitions;var l={bufferDefinition:null,bufferIndex:0};if(!(null==t||0>q.resources.geometryDefinition)&&(t=0<=q.resources.geometryDefinition?t[q.resources.geometryDefinition].geometryBuffers:null,null!=t))for(var w=0;w<t.length;w++){var y=t[w];if(null!=y.compressedAttributes){if("draco"===y.compressedAttributes.encoding&&!a("disable-feature:i3s-draco")){l.bufferIndex=w;l.bufferDefinition=y;break}}else l.bufferIndex=
w,l.bufferDefinition=t[w]}const {bufferDefinition:D,bufferIndex:z}=l;w=(y=!!q.resources.geometry)?k.result(this.loadGeometry(q.resources.geometry,z,u)):null;t=q.resources.hasSharedResource?await this.loadShared(q,u):null;var r=(l=this.materialAndTextures&&0<=q.resources.materialDefinition?this.materialAndTextures[q.resources.materialDefinition]:null!=t?e.getMaterialAndTexturesFromShared(t):null)&&l.material;l=l&&l.textures;const C=`${q.id}`,A=!y&&this.options.loadFeatureData;y=A?await this.loadFeatureData(C,
u):null;if(A)a:{for(m of y.featureData)if(r=m.geometries,null!=r)for(var x of r){var m={featureIds:[m.id],featureDataPosition:m.position,geometries:[x]};break a}m=null}else m={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:r}}],featureDataPosition:[0,0,0]};if(x=b.isNone(m)){x=[];for(var B of y.featureData)null!=B.position&&x.push({featureIds:[B.id],featureDataPosition:B.position,geometries:null})}B=x;x=null!=l&&0<l.length?k.result(this.loadTextures(q,l,u)):null;u=q=null;w&&(q=
k.assertResult(await w),(u=this.defaultGeometrySchema)&&t&&t.materialDefinitions&&(w=Object.keys(t.materialDefinitions)[0],!t.materialDefinitions[w].params.vertexRegions&&u.vertexAttributes.region&&(u=g.clone(u),delete u.vertexAttributes.region)),u=c.createGeometryDescriptor(D,u));t=x?k.assertResult(await x):null;v=(v=v?k.assertResult(await v):{})?{attributeData:v,loadedAttributes:this.requiredAttributes}:null;return b.isSome(m)?{geometryData:m,attributeDataInfo:v,geometryBuffer:q,geometryDescriptor:u,
requiredTextures:l,textureData:t}:b.isSome(B)?{pointData:B,attributeDataInfo:v,geometryBuffer:q,geometryDescriptor:u,requiredTextures:l,textureData:t}:Promise.reject()};h.addAbsoluteHrefTexture=function(q,u){q=q.textureDefinitions;if(null!=q)for(const v of Object.keys(q))for(const t of q[v].images)Array.isArray(t.href)?t.hrefConcat=t.href.map(l=>p.makeAbsolute(l,u)):t.hrefConcat=p.makeAbsolute(t.href,u)};h.fixTextureEncodings=function(q){q=q.textureDefinitions;if(null!=q)for(const v in q){const t=
q[v];if(Array.isArray(t.encoding))for(var u=0;u<t.encoding.length;u++){const l=t.encoding[u];"data:"===l.substring(0,5)&&(t.encoding[u]=l.substring(5))}else u=t.encoding,"data:"===u.substring(0,5)&&(t.encoding=u.substring(5))}};n.loadShared=function(q,u){const v=`${this.layerUrl}/nodes/${q.resources.geometry}/shared`;return this.load(v,"json",u).then(t=>{h.fixTextureEncodings(t);h.addAbsoluteHrefTexture(t,v);return t})};n.loadTexture=function(q,u,v,t,l,w){return 2===l||1===l?this.load(q,"binary",
w).then(y=>({id:u,usage:v,data:y,encoding:l})):this.load(q,"image",w).then(y=>{var D=y;if(t&&4096<=y.width*y.height){D=Math.ceil(y.width/2);const z=Math.ceil(y.height/2),r=document.createElement("canvas");r.width=D;r.height=z;r.getContext("2d").drawImage(y,0,0,D,z);D=r}return{id:u,usage:v,data:D,encoding:l}})};n.loadTextures=function(q,u,v){const t=this.options.uncompressedTextureDownsamplingEnabled,l=this.options.textureUsageMask;return Promise.all(u.map(w=>{if(0===(w.usage&l))return null;const y=
d.selectEncoding(w.encodings,this.options.textureEncodings);return null==y?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${q.id}`),Promise.reject()):this.loadTexture(`${this.layerUrl}/nodes/${q.resources.texture||q.id}/textures/${y.name}`,w.id,w.usage,t,y.encoding,v)}))};n.loadFeatureData=function(q,u){return this.load(`${this.layerUrl}/nodes/${q}/features/0`,"json",u)};n.loadGeometry=function(q,u,v){return this.load(`${this.layerUrl}/nodes/${q}/geometries/${u}`,
"binary",v)};return h}()})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/maybe ../../../../core/mathUtils ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/lib/Texture".split(" "),function(a,g,b,p,f,k){function c(h){return h.sort((n,q)=>n.encoding-q.encoding)}const d={basis:1,dds:2,png:4,jpg:8,"ktx-etc2":16},e={[k.Texture.BASIS_ENCODING]:1,[k.Texture.DDS_ENCODING]:2,
"image/png":4,"image/jpg":8,"image/jpeg":8,"image/ktx":16};a.getMaterialAndTextures=function(h,n){const q=new Map,u=(r,C)=>{if(g.isNone(r))return-1;if(q.has(r.id))return r=q.get(r.id),r.usage|=C,r.id;const A=q.size;q.set(r.id,{id:A,usage:C});return A};var v=n.pbrMetallicRoughness;const t=v&&v.baseColorFactor,l=n.emissiveFactor,w=null==n.normalTexture&&null==n.emissiveTexture&&null==n.occlusionTexture&&(v?null==v.metallicRoughnessTexture&&1===v.roughnessFactor&&(1===v.metallicFactor||0===v.metallicFactor):
!0),y=w?f.PBRSchematicMRRValues[0]:v?v.metallicFactor:1,D=w?f.PBRSchematicMRRValues[1]:v?v.roughnessFactor:1;v={baseColorFactor:t?[t[0],t[1],t[2],t[3]]:[1,1,1,1],baseColorTextureId:u(v&&v.baseColorTexture,"mask"===n.alphaMode?33:1),metallicRoughnessTextureId:u(v&&v.metallicRoughnessTexture,2),metallicFactor:y,roughnessFactor:D};n={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,doubleSided:n.doubleSided,cullFace:"none"===n.cullFace?0:"back"===n.cullFace?2:"front"===n.cullFace?1:void 0,normalTextureId:u(n.normalTexture,
4),emissiveTextureId:u(n.emissiveTexture,16),occlusionTextureId:u(n.occlusionTexture,8),emissiveFactor:l?[l[0],l[1],l[2]]:[0,0,0],metallicRoughness:v,wrapTextures:!1,hasParametersFromSource:w};const z=[];q.forEach(({usage:r},C)=>{var A=g.isSome(h)&&h[C]&&h[C].formats;A=A?c(A.map(({name:x,format:m})=>({name:x,encoding:d[m]}))):[];z.push({id:C,usage:r,encodings:A})});return{material:n,textures:z}};a.getMaterialAndTexturesFromShared=function(h){var n=h&&h.materialDefinitions?Object.keys(h.materialDefinitions)[0]:
null,q=h&&h.textureDefinitions?Object.keys(h.textureDefinitions)[0]:null;n=n&&h.materialDefinitions[n];q=q&&h.textureDefinitions[q];h={alphaMode:"opaque",alphaCutoff:p.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0};if(null!=n){n=n.params;
n.diffuse&&(h.metallicRoughness.baseColorFactor=[n.diffuse[0],n.diffuse[1],n.diffuse[2],1]);null!=n.doubleSided&&(h.doubleSided=n.doubleSided,h.cullFace=n.doubleSided?0:2);if("none"===n.cullFace||"front"===n.cullFace||"back"===n.cullFace)h.cullFace="none"===n.cullFace?0:"back"===n.cullFace?2:1;n.transparency&&(h.metallicRoughness.baseColorFactor[3]=b.clamp(1-n.transparency,0,1));if(n.useVertexColorAlpha||1>h.metallicRoughness.baseColorFactor[3])h.alphaMode="blend"}n=[];if(null!=q){!q.wrap||"repeat"!==
q.wrap[0]&&"repeat"!==q.wrap[1]||(h.wrapTextures=!0);let u=1;"rgba"===q.channels&&(h.alphaMode="blend",u|=32);const v=q.images[q.images.length-1],t=l=>l&&l.split("/").pop();q=Array.isArray(q.encoding)?c(q.encoding.map((l,w)=>({name:t(v.href[w]),encoding:e[l]||0}))):[{name:t(v.href),encoding:e[q.encoding]||0}];n.push({id:0,usage:u,encodings:q});h.metallicRoughness.baseColorTextureId=0}return{material:h,textures:n}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,g,b){let p=function(){function f(c){this.requester=c;this.activeRequests=new Set}var k=f.prototype;k.request=function(c,d,e){const h=b.createAbortController(),n=b.onAbortOrThrow(e,()=>h.abort());e={...e,signal:h.signal};c=this.requester.request(c,d,e);const q={response:c,abortController:h,abortHandle:n};this.activeRequests.add(q);b.always(c,()=>{var u;q.abortController=null;null==(u=q.abortHandle)?void 0:u.remove();
q.abortHandle=null;this.activeRequests.delete(q)});return c};k.cancelAll=function(){this.activeRequests.forEach(c=>{var d,e;null==(d=c.abortController)?void 0:d.abort();c.abortController=null;null==(e=c.abortHandle)?void 0:e.remove()});this.activeRequests.clear()};g._createClass(f,[{key:"busy",get:function(){return this.requester.busy}}]);return f}();a.I3SStreamDataController=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../geometry/projection ../../../../chunks/vec4 ../../../../layers/graphics/dehydratedFeatures ../../support/geometryUtils ../graphics/elevationAlignmentUtils ../graphics/featureExpressionInfoUtils ../graphics/ElevationContext ../../support/orientedBoundingBox ./I3SUtil".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u){return function(){function v(l,w,y,D,z,r,C,A,x={}){this.indexSR=l;this._renderCoordsHelper=w;this.extent=r;this.elevationProvider=C;this.options=x;this._frustum=d.frustum.create();this._fixedCOI=!1;this._poi=g.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=g.create();this._tmp2=g.create();this._tmp3=g.create();this._tmp0=g.create();this.screenspaceErrorBias=x.screenspaceErrorBias||1;this.progressiveLoadFactor=x.progressiveLoadFactor||
1;this.updateCamera(y,D,z);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(A);this.tmpPoint=c.makeDehydratedPoint(0,0,0,l)}var t=v.prototype;t.updateElevationInfo=function(l){null==l?this._elevationContext=null:(this._elevationContext=n.ElevationContext.fromElevationInfo(l),this._elevationContext.updateFeatureExpressionInfoContext(h.createContextWithoutExpressionSupport(h.extractExpressionInfo(l,!1))))};t.updateCamera=function(l,w,y){(this._fixedCOI=y)||d.frustum.fromMatrix(l.viewMatrix,
l.projectionMatrix,this._frustum);this._screenSizeFactor=1/(w.perScreenPixelRatio/2);this._camPos=w.eye;this.minDistance=Infinity;this.maxDistance=0};t.setPointOfInterest=function(l){this._poi=l};t.updateScreenSpaceErrorBias=function(l){const w=this.screenspaceErrorBias;this.screenspaceErrorBias=l;return w};t.updateExtent=function(l){this.extent=l};t.getRenderMbs=function(l){const w=l.renderMbs;0>w[3]&&(k.copy(w,l.mbs),this._elevationContext&&1E5>w[3]&&(this.tmpPoint.x=w[0],this.tmpPoint.y=w[1],this.tmpPoint.z=
w[2],w[2]=e.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),f.projectBoundingSphere(w,this.indexSR,w,this.engineSR));return w};t.getVisibilityObb=function(l){if(a.isSome(l.visibilityObb))return l.visibilityObb;const w=l.serviceObb;if(!(a.isNone(w)||0>w.halfSize[0]))return l.serviceObbInRenderSR=this._computeRenderObb(w,l.serviceObbInRenderSR,l.mbs[3]),l.serviceObbInRenderSR};t._computeRenderObb=function(l,w,y){a.isNone(w)&&(w=
q.create());if(0>w.halfSize[0]){let D=0;this._elevationContext&&1E5>y&&(this.tmpPoint.x=l.center[0],this.tmpPoint.y=l.center[1],this.tmpPoint.z=l.center[2],D=e.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-l.center[2]);u.transformObb(l,this.indexSR,w,this.engineSR,D)}return w};t.isNodeVisible=function(l){const w=this.getRenderMbs(l);if(!this.isMBSinExtent(w))return!1;if(this._fixedCOI)return!0;l=this.getVisibilityObb(l);return a.isSome(l)?
q.isVisible(l,this._frustum):d.frustum.intersectsSphere(this._frustum,d.sphere.wrap(w))};t.isGeometryVisible=function(l){if(this._fixedCOI)return!0;const w=l.geometryObb;return a.isSome(w)?q.isVisible(w,this._frustum):this.isNodeVisible(l)};t.isMBSinExtent=function(l){return this.extent?0!==u.intersectBoundingBoxWithMbs(this.extent,l):!0};t.screenSpaceDiameterMbs=function(l,w){var y=this.getRenderMbs(l);l=Math.sqrt(b.squaredDistance(y,this._camPos));y=l-y[3];this._updateMinMaxDistance(l);return 0>
y?.5*Number.MAX_VALUE:w/y*this._screenSizeFactor};t.calcCameraDistance=function(l){return this.calcCameraDistanceToCenter(l)-this.getRenderMbs(l)[3]};t.calcCameraDistanceToCenter=function(l){l=this.getRenderMbs(l);l=b.distance(l,this._camPos);this._updateMinMaxDistance(l);return l};t.calcAngleDependentLoD=function(l){l=this.getRenderMbs(l);const w=l[3];l=(Math.abs(l[0]*(l[0]-this._camPos[0])+l[1]*(l[1]-this._camPos[1])+l[2]*(l[2]-this._camPos[2]))/b.length(l)+w)/b.distance(l,this._camPos);return Math.min(1,
l)};t.hasLOD=function(l){return 0!==l.lodMetric};t.getDistancePlanarMode=function(l,w){var y=l[0]-w[0];const D=l[1]-w[1];l=l[2]-w[2];y=y*y+D*D;w=w[3];if(y<=w*w)return Math.abs(l);w=Math.sqrt(y)-w;return Math.sqrt(l*l+w*w)};t.getDistanceGlobeMode=function(l,w){var y=b.length(w);const D=b.length(l)-y;b.scale(this._tmp0,l,b.dot(l,w)/b.squaredLength(l));var z=b.squaredDistance(w,this._tmp0),r=w[3];if(z<=r*r)return Math.abs(D);w=b.scale(this._tmp0,w,1/y);y=b.scale(this._tmp1,w,y-r*r/2/y);z=b.subtract(this._tmp2,
l,y);z=b.subtract(this._tmp2,z,b.scale(this._tmp3,w,b.dot(w,z)));y=b.add(this._tmp2,y,b.scale(this._tmp2,z,r/b.length(z)));r=b.distance(l,y);2E5<=D&&(l=b.subtract(this._tmp1,l,y),l=b.dot(l,w)/b.length(l),.08>l&&(l=1E-4),r/=l);return r};t.getDistance=function(l,w){return this.engineSR===p.getSphericalPCPF(this.engineSR)?this.getDistanceGlobeMode(l,w):this.getDistancePlanarMode(l,w)};t._updateMinMaxDistance=function(l){0<l?(this.minDistance=Math.min(this.minDistance,l),this.maxDistance=Math.max(this.maxDistance,
l)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-l))};t.getLodLevel=function(l){if(0===l.lodMetric||!l.resources.hasFeatureData)return 0;if(0===l.childCount)return this.maxLodLevel;if(!this._fixedCOI&&1>this.progressiveLoadFactor){const w=this.screenspaceErrorBias;return this.evaluateLODmetric(l,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(l,w)?2:1:0}return this.evaluateLODmetric(l,this.screenspaceErrorBias)?this.maxLodLevel:0};t.evaluateLODmetric=
function(l,w){switch(l.lodMetric){case 2:{const y=this.getRenderMbs(l),D=this.getDistance(this._camPos,y),z=2*D/this._screenSizeFactor;this._updateMinMaxDistance(D+y[3]);return l.maxError*w<=z}case 1:return w=this.screenSpaceDiameterMbs(l,l.mbs[3]*w),this.options.angleDependentLoD&&(w*=this.calcAngleDependentLoD(l)),w<l.maxError;case 3:return 10>this.screenSpaceDiameterMbs(l,l.maxError)*w;case 4:return this.calcCameraDistance(l)>l.maxError*w}return!1};t.distToPOI=function(l){l=this.getRenderMbs(l);
return b.distance(l,this._poi)-l[3]};t.distCameraToPOI=function(){return b.distance(this._camPos,this._poi)};return v}()})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../symbols/PointSymbol3D ../../../symbols ../../../Graphic ../../../chunks/vec3f64 ../../../core/Handles ../../../core/accessorSupport/diffUtils ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x){b=function(E){function F(I){I=E.call(this,I)||this;I.loadedGraphics=new x.LimitGraphicsMap(5E4);I.slicePlaneEnabled=!1;I._renderingInfo={symbol:new v};I._handles=new y;I._graphicsByNode=new Map;I._scaleVisibility=null;return I}a._inheritsLoose(F,E);var G=F.prototype;G.initialize=function(){this._graphicsCore=new r.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,
getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var I=this.view.basemapTerrain;this._scaleVisibility=new C({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(J,L,P)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(J,L,P),this._graphicsCore,I);I=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});
const K=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:I,deconflictor:K,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(J,L)=>{D.diff(J,L)&&this._graphicsCore.updateLabelingInfo()})])};G.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=
null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};G.addNodeMeta=function(I,K){let J=0;const L=I.filteredIds,P=I.featureIds.map((Q,X)=>{A.boundingBoxTop(X,this.collection,I.objectHandle,B);const aa=z.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(B,aa);X=K(X,I);let S=!1;p.isNone(L)?S=!0:J<L.length&&Q===L[J]&&(S=!0,J++);return{objectId:Q,uid:l.generateUID(),attributes:X,
visible:S,geometry:aa}});this.loadedGraphics.addMany(P);this._graphicsByNode.set(I.node.index,P)};G.setNodeMetaAttributes=function(I,K){const J=this._graphicsByNode.get(I.node.index),L=Array(J.length);for(let P=0;P<J.length;P++){const Q=J[P];Q.attributes=K(P,I);L[P]=Q.uid}this._graphicsCore.updateLabelingInfo(L)};G.applyFilterChange=function(I){var K=this._graphicsByNode.get(I.node.index);if(K)if(p.isNone(I.filteredIds))for(var J of K)J.visible||(J.visible=!0,m.graphic=J,m.property="visible",m.oldValue=
!1,m.newValue=!0,this._graphicsCore.graphicUpdateHandler(m));else{J=0;for(const L of K)K=L.visible,J<I.filteredIds.length&&L.objectId===I.filteredIds[J]?(L.visible=!0,J++):L.visible=!1,K!==L.visible&&(m.graphic=L,m.property="visible",m.oldValue=K,m.newValue=L.visible,this._graphicsCore.graphicUpdateHandler(m))}};G.removeNodeMeta=function(I){this.loadedGraphics.removeManyByObjectId(I.featureIds)};G.getRenderingInfo=function(){return this._renderingInfo};G.notifyGraphicGeometryChanged=function(){};
G.notifyGraphicVisibilityChanged=function(){};a._createClass(F,[{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return F}(u);g.__decorate([c.property()],b.prototype,"view",void 0);g.__decorate([c.property()],b.prototype,"layer",void 0);g.__decorate([c.property()],b.prototype,"collection",void 0);g.__decorate([c.property()],
b.prototype,"loadedGraphics",void 0);g.__decorate([c.property({aliasOf:"_graphicsCore.updating"})],b.prototype,"updating",void 0);g.__decorate([c.property()],b.prototype,"slicePlaneEnabled",void 0);g.__decorate([c.property()],b.prototype,"_graphicsCore",void 0);b=g.__decorate([e.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],b);const m={graphic:null,property:null,oldValue:null,newValue:null},B=w.create();return b})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,g,b,p,f){b=function(d){function e(n){var q=d.call(this)||this;q._limit=n;q._all=new f.GraphicsMap;q._active=new c(g._assertThisInitialized(q));q._pending=new Map;q._handle=q._all.on("change",u=>q._handleChanges(u));return q}g._inheritsLoose(e,d);var h=e.prototype;h.destroy=function(){this._handle.remove()};h.toArray=function(){return this._active.toArray()};h.find=function(n){return this._active.find(n)};h.forEach=function(n){this._active.forEach(n)};
h.addMany=function(n){this._all.addMany(n)};h.removeManyByObjectId=function(n){this._all.removeManyByObjectId(n)};h._handleChanges=function(n){let q=n.removed;if(0<this._pending.size){q=[];for(var u of n.removed)this._pending.delete(u.objectId)||q.push(u)}u=this._limit-this._active.length+q.length;u<n.added.length&&(this._active.removeMany(q),q=[],k.reset(1-this._limit/(this._active.length+n.added.length)),this._active.forEach(t=>{k.sample()&&(q.push(t),this._pending.set(t.objectId,t))}),u=this._limit-
this._active.length+q.length);let v=n.added;if(u<n.added.length){v=[];k.reset(u/n.added.length);for(const t of n.added)k.sample()?v.push(t):this._pending.set(t.objectId,t)}n=u-v.length;0<n&&0<this._pending.size&&(k.reset(n/this._pending.size),this._pending.forEach(t=>{k.sample()&&(v.push(t),this._pending.delete(t.objectId))}));this._active.addAndRemove(v,q)};g._createClass(e,[{key:"length",get:function(){return this._active.length}}]);return e}(b);const k=new (function(){function d(){this.percentage=
1;this.last=-1;this.index=0}var e=d.prototype;e.reset=function(h){this.percentage=h;this.last=-1};e.sample=function(){const h=Math.floor(this.index*this.percentage);++this.index;if(h===this.last)return!1;this.last=h;return!0};return d}());let c=function(){function d(h){this._parent=h;this._map=new Map}var e=d.prototype;e.forEach=function(h){this._map.forEach(n=>h(n))};e.find=function(h){let n;p.someMap(this._map,q=>h(q)?(n=q,!0):!1);return n};e.toArray=function(){return[...this._map.values()]};e.addAndRemove=
function(h,n){for(const q of h)this._map.set(q.objectId,q);for(const q of n)this._map.delete(q.objectId);(0<h.length||0<n.length)&&this._parent.emit("change",{added:h,removed:n})};e.removeMany=function(h){for(const n of h)this._map.delete(n.objectId);0<h.length&&this._parent.emit("change",{added:[],removed:h})};g._createClass(d,[{key:"length",get:function(){return this._map.size}}]);return d}();a.LimitGraphicsMap=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,g,b,p){b=function(f){function k(){var d=f.apply(this,arguments)||this;d._map=new Map;return d}g._inheritsLoose(k,f);var c=k.prototype;c.clear=function(){if(0<this._map.size){const d=this.toArray();this._map.clear();this.emit("change",{added:[],removed:d})}};c.get=function(d){return this._map.get(d)};c.addMany=function(d){if(0!==d.length){var e=new Set;for(let h=0;h<d.length;h++){const n=d[h],q=
n.objectId,u=this._map.get(q);u?(e.add(q),n!==u&&(d[h]=u),++u.refCount):(n.refCount=1,this._map.set(q,n))}d=0<e.size?d.filter(h=>!e.has(h.objectId)):d;0<d.length&&this.emit("change",{added:d,removed:[]})}};c.removeMany=function(d){const e=[];for(const h of d){d=h.objectId;const n=this._map.get(d);null!=n&&0>=--n.refCount&&(this._map.delete(d),e.push(h))}0<e.length&&this.emit("change",{added:[],removed:e})};c.removeManyByObjectId=function(d){const e=[];for(const h of d)d=this._map.get(h),null!=d&&
0>=--d.refCount&&(this._map.delete(h),e.push(d));0<e.length&&this.emit("change",{added:[],removed:e})};c.toArray=function(){return[...this._map.values()]};c.find=function(d){let e;p.someMap(this._map,h=>d(h)?(e=h,!0):!1);return e};c.forEach=function(d){this._map.forEach(e=>d(e))};g._createClass(k,[{key:"length",get:function(){return this._map.size}}]);return k}(b);a.GraphicsMap=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/PooledArray ../../../geometry/projection ../../../core/workers/WorkerHandle".split(" "),
function(a,g,b,p,f,k){function c(n,q){e.clear();for(var u of n){var v="clip"===u.type?2:"mask"===u.type?1:0;const l=u.geometry;n=w=>w;if(l.spatialReference){if(!f.canProjectWithoutEngine(l.spatialReference,q)){d.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}n=w=>{f.projectVectorToVector(w,l.spatialReference,h,q);return h}}else l.hasZ||(h[2]=0,n=w=>{h[0]=w[0];h[1]=w[1];return h});e.push(v);e.push(l.rings.length);for(var t of l.rings){e.push(t.length);
for(const w of t)v=n(w),e.push(v[0]),e.push(v[1]),e.push(v[2])}}e.push(3);u=new Float64Array(e.length);for(t=0;t<e.length;++t)u[t]=e.getItemAt(t);return u}const d=b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");b=function(n){function q(v){return n.call(this,"SceneLayerWorker","process",v,{hasInitialize:!0})||this}g._inheritsLoose(q,n);var u=q.prototype;u.getTransferList=function(v){return[v.geometryBuffer]};u.setModifications=function(v,t,l){v={context:v,modifications:c(t,l),isGeodetic:l.isGeographic};
this.broadcast(v,"setModifications")};u.setLegacySchema=function(v,t){t=JSON.stringify(t);this.broadcast({context:v,jsonSchema:t},"setLegacySchema")};u.destroyContext=function(v){return this.broadcast(v,"destroyContext")};return q}(k.WorkerHandle);const e=new p({deallocator:null}),h=[0,0,0];a.I3SMeshWorkerHandle=b;a.toWasmModification=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerWorker":function(){define(["exports","../../../core/typedArrayUtil","../../../core/maybe",
"../../../libs/i3s/I3SModule"],function(a,g,b,p){function f(v){const t=v.modifications,l=q._malloc(8*t.length),w=new Float64Array(q.HEAPU8.buffer,l,t.length);for(let y=0;y<t.length;++y)w[y]=t[y];q.setModifications(v.context,l,t.length,v.isGeodetic);q._free(l)}function k(v,t){if(!q)return null;const {context:l,localOrigin:w,globalTrafo:y,mbs:D,obb:z,elevationOffset:r,geometryBuffer:C,geometryDescriptor:A,indexToVertexProjector:x,vertexToRenderProjector:m}=v;var B=q._malloc(C.byteLength),E=q._malloc(33*
Float64Array.BYTES_PER_ELEMENT),F=new Uint8Array(q.HEAPU8.buffer,B,C.byteLength);F.set(new Uint8Array(C));var G=new Float64Array(q.HEAPU8.buffer,E,33);e(G,w);var I=G.byteOffset+3*G.BYTES_PER_ELEMENT,K=new Float64Array(G.buffer,I);e(K,y);I+=16*G.BYTES_PER_ELEMENT;K=new Float64Array(G.buffer,I);e(K,D);I+=4*G.BYTES_PER_ELEMENT;b.isSome(z)&&(K=new Float64Array(G.buffer,I),e(K,z.center),I+=3*G.BYTES_PER_ELEMENT,K=new Float64Array(G.buffer,I),e(K,z.halfSize),I+=3*G.BYTES_PER_ELEMENT,K=new Float64Array(G.buffer,
I),e(K,z.quaternion));G={isDraco:!1,isLegacy:!1,color:v.layouts.some(L=>L.some(P=>"color"===P.name)),normal:v.needNormals&&v.layouts.some(L=>L.some(P=>"normalCompressed"===P.name)),uv0:v.layouts.some(L=>L.some(P=>"uv0"===P.name)),uvRegion:v.layouts.some(L=>L.some(P=>"uvRegion"===P.name)),featureIndex:A.featureIndex};F=q.process(l,!!v.obb,B,F.byteLength,A,G,E,r,x,m,v.normalReferenceFrame);q._free(E);q._free(B);if(0<F.error.length)throw`i3s.wasm: ${F.error}`;if(F.discarded)return null;B=0<F.componentOffsets.length?
g.slice(F.componentOffsets):null;E=0<F.featureIds.length?g.slice(F.featureIds):null;G=g.slice(F.interleavedVertedData).buffer;I=1===F.indicesType?g.slice(new Uint16Array(F.indices.buffer,F.indices.byteOffset,F.indices.byteLength/2)):g.slice(new Uint32Array(F.indices.buffer,F.indices.byteOffset,F.indices.byteLength/4));K=g.slice(F.positions);const J=1===F.positionIndicesType?g.slice(new Uint16Array(F.positionIndices.buffer,F.positionIndices.byteOffset,F.positionIndices.byteLength/2)):g.slice(new Uint32Array(F.positionIndices.buffer,
F.positionIndices.byteOffset,F.positionIndices.byteLength/4));v={layout:v.layouts[0],interleavedVertexData:G,indices:I,hasColors:F.hasColors,hasModifications:F.hasModifications,positionData:{data:K,indices:J}};E&&t.push(E.buffer);B&&t.push(B.buffer);t.push(G);t.push(I.buffer);t.push(K.buffer);t.push(J.buffer);return{componentOffsets:B,featureIds:E,transformedGeometry:v,obb:F.obb}}function c(v){const {context:t,buffer:l}=v;v=q._malloc(l.byteLength);const w=l.byteLength/Float64Array.BYTES_PER_ELEMENT,
y=new Float64Array(q.HEAPU8.buffer,v,w),D=new Float64Array(l);y.set(D);q.filterOBBs(t,v,w);D.set(y);q._free(v)}function d(v){q&&q.destroy(v)}function e(v,t){for(let l=0;l<t.length;++l)v[l]=t[l]}function h(){if(q)return Promise.resolve();n||(n=p.get().then(v=>{q=v;n=null}));return n}let n,q;const u={transform:k,destroy:d};a.destroyContext=function(v){d(v)};a.dracoDecompressPointCloudData=async function(v){var t;await h();const l=[v.geometryBuffer];var {geometryBuffer:w}=v,y=w.byteLength;v=q._malloc(y);
y=new Uint8Array(q.HEAPU8.buffer,v,y);y.set(new Uint8Array(w));w=q.dracoDecompressPointCloudData(v,y.byteLength);q._free(v);if(0<w.error.length)throw`i3s.wasm: ${w.error}`;v=0<(null==(t=w.featureIds)?void 0:t.length)?g.slice(w.featureIds):null;t=g.slice(w.positions);v&&l.push(v.buffer);l.push(t.buffer);return{result:{positions:t,featureIds:v},transferList:l}};a.filterObbsForModifications=async function(v){await h();c(v);v={buffer:v.buffer};return{result:v,transferList:[v.buffer]}};a.filterObbsForModificationsSync=
c;a.initialize=h;a.interpretObbModificationResults=function(v){return 0===v?0:1===v?1:2===v?2:3};a.process=async function(v){await h();const t=[v.geometryBuffer];return{result:k(v,t),transferList:t}};a.setLegacySchema=async function(v){await h();q.setLegacySchema(v.context,v.jsonSchema)};a.setModifications=async function(v){await h();f(v)};a.setModificationsSync=f;a.test=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],
function(a,g,b){function p(k){return b.getAssetUrl(`esri/libs/i3s/${k}`)}let f;g.get=function(){f||(f=(new Promise(k=>(new Promise(function(c,d){a(["../../chunks/i3s"],c,d)})).then(function(c){return c.i3s}).then(({default:c})=>{const d=c({locateFile:p,onRuntimeInitialized:()=>k(d)});delete d.then}))).catch(k=>Promise.reject(k)));return f};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils"],function(a){let g=function(){this.ids=
new Set;this.paused=!1};return function(){function b(f){this.highlights=[];this.collection=f.collection;this.forAllFeatures=f.forAllFeatures;this.forAllFeaturesOfNode=f.forAllFeaturesOfNode}var p=b.prototype;p.destroy=function(){this.highlights.forEach(f=>this.releaseSet(f));this.highlights=null};p.acquireSet=function(){const f=new g;this.highlights.push(f);return{set:f,handle:{remove:()=>{this.releaseSet(f);a.removeUnordered(this.highlights,f)},pause:()=>{this.releaseSet(f);f.paused=!0},resume:()=>
{f.paused=!1;this.initializeSet(f)}}}};p.setFeatureIds=function(f,k){k.forEach(c=>f.ids.add(c));this.initializeSet(f)};p.initializeSet=function(f){this.forAllFeatures((k,c,d)=>{f.ids.has(k)&&this.collection.addComponentHighlight(d.objectHandle,c);return 1})};p.releaseSet=function(f){this.forAllFeatures((k,c,d)=>{f.ids.has(k)&&this.collection.removeComponentHighlight(d.objectHandle,c);return 1})};p.objectCreated=function(f){this.highlights.forEach(k=>{k.paused||this.forAllFeaturesOfNode(f,(c,d)=>{k.ids.has(c)&&
this.collection.addComponentHighlight(f.objectHandle,d);return 1})})};p.objectDeleted=function(f){this.collection.clearHighlights(f.objectHandle)};return b}()})},"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../intl/number ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../layers/support/featureQueryAll".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n){const q=p.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");p=function(){function v(l,w){this.layer=l;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=k.createAbortController();this.interactiveEditingSessions=null;this._maximumNumberOfEditOVerrides=5E4;this.memCache=w.getMemCache(`${l.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this.fetchChangedObjectIds(this.pendingFetchAbortController.signal);
this.pendingFetchChangedObjectIds.then(()=>this.pendingFetchAbortController=null)}var t=v.prototype;t.destroy=function(){this.layer=null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};t.createInteractiveEditSession=function(l){this.changedObjectIds.add(l);b.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const w=this.interactiveEditingSessions,
y=new u(l,{rollback:()=>{f.remove(w,y);0===w.length&&(this.interactiveEditingSessions=null)},commit:D=>{for(const [z,r]of D)this.updateValue(l,z,r)}});w.unshift(y);return y};t.apply=async function(l,w,y){if(!b.isNone(w)){var {loadedAttributes:D,attributeData:z}=w;if(!b.isNone(D)&&0!==D.length&&!b.isNone(z)&&(await k.whenOrAbort(this.pendingFetchChangedObjectIds,y),0!==this.changedObjectIds.size)){w={loadedAttributes:D,attributeData:z};var r=this.getOverridesFromCache(l,w,this.changedObjectIds),{objectIds:C,
fieldNames:A}=r;y=await this.queryOverridesFromAssociatedLayer(C,A,y);b.isNone(y)||this.processOverridesFromAssociatedLayer(l,y,A,w)}}};t.updateValue=function(l,w,y){this.changedObjectIds.add(l);this.cacheValue(l,w,y)};t.cacheValue=function(l,w,y){this.memCache.put(this.getCacheKey(l,w),y,this.memCacheValueSize(y))};t.getOverridesFromCache=function(l,{loadedAttributes:w,attributeData:y},D){const z=new Set,r=[];for(var C of w)r[C.index]=y[C.name];y=new Set;for(C=0;C<l.length;C++){const A=l[C];if(D.has(A))for(const x of w){const m=
this.fromCache(A,x.index);void 0!==m?r[x.index][C]=m:(z.add(A),y.add(x.name))}}return{objectIds:Array.from(z),fieldNames:Array.from(y)}};t.fromCache=function(l,w){const y=this.fromInteractiveEditingSession(l,w);if(void 0!==y)return y;l=this.getCacheKey(l,w);return this.memCache.get(l)};t.fromInteractiveEditingSession=function(l,w){if(!b.isNone(this.interactiveEditingSessions))for(const y of this.interactiveEditingSessions){if(y.objectId!==l)continue;const D=y.get(w);if(void 0!==D)return D}};t.getCacheKey=
function(l,w){return`${l}-${w}`};t.queryOverridesFromAssociatedLayer=async function(l,w,y){if(0===l.length||0===w.length)return null;l=l.sort((r,C)=>r-C);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this.logMaximumObjectsExceededWarning());const D=b.unwrap(this.layer.associatedLayer),z=D.createQuery();z.where="1\x3d1";z.returnGeometry=!1;z.outFields=[D.objectIdField,...w];z.cacheHint=!0;z.objectIds=l;w=n.getMaximumQuerySize(D);l=l.length>w?f.splitIntoChunks(l,
w).map(r=>{const C=z.clone();C.objectIds=r;return e.resultOrAbort(n.queryAllJSON(D,C,{signal:y}))}):[e.resultOrAbort(n.queryAllJSON(D,z,{signal:y}))];return(await Promise.all(l)).reduce((r,C)=>r.concat(C.ok?C.value.features:[]),[])};t.logMaximumObjectsExceededWarning=function(){let l=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${c.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const w=this.layer.portalItem;l=w&&w.loaded?l+` (${w.portal.url}/home/item.html?id=${w.id}#settings)`:l+` (${this.layer.parsedUrl.path})`;q.warn(`("${this.layer.title}"):`,`${l}.`)};t.processOverridesFromAssociatedLayer=function(l,w,y,{loadedAttributes:D,attributeData:z}){const r=b.unwrap(this.layer.associatedLayer).objectIdField,C=y.map(x=>z[x]),A=new Map(D.map(x=>[x.name,x.index]));D=y.map(x=>A.get(x));l=new Map(Array.from(l,(x,m)=>[x,m]));for(const x of w){w=x.attributes[r];for(let m=0;m<y.length;m++){const B=
D[m],E=l.get(w),F=x.attributes[y[m]];C[m][E]=F;this.cacheValue(w,B,F)}}};t.memCacheValueSize=function(l){return"string"===typeof l?h.estimateStringByteSize(l):h.estimateNumberByteSize()};t.fetchChangedObjectIds=async function(l){var w,y,D,z=this.layer;await z.load({signal:l});this.changedObjectIds.clear();if(!b.isNone(z.associatedLayer)&&null!=(w=z.associatedLayer.capabilities)&&null!=(y=w.operations)&&y.supportsChangeTracking){w=this.getFetchChangedObjectIdsServerGen();if(b.isNone(w))return null;
y=z.associatedLayer.layerId;l=await e.result(d(`${z.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${y}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:y,serverGen:w}])},timeout:1E4,signal:l}));l=l.ok&&null!=(D=l.value.data)&&D.edits?b.get(l.value.data.edits[0],"objectIds","updates"):null;if(b.isSome(l))for(D=Math.min(this._maximumNumberOfEditOVerrides,l.length),D<l.length&&(this.warnMaximumChangedObjectsExceeded=
!0),l=l.sort((r,C)=>r-C),z=0;z<D;z++)this.changedObjectIds.add(l[z])}};t.getFetchChangedObjectIdsServerGen=function(){var l=this.layer;if(b.isSome(l.serviceUpdateTimeStamp)&&b.isSome(l.serviceUpdateTimeStamp.lastUpdate))return l.serviceUpdateTimeStamp.lastUpdate;l=l.associatedLayer;return b.isSome(l)&&b.isSome(l.serverGens)&&b.isSome(l.serverGens.minServerGen)?l.serverGens.minServerGen:null};g._createClass(v,[{key:"test",get:function(){const l=this;return{changedObjectIds:Array.from(this.changedObjectIds),
pendingFetchChangedObjectIds:this.pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return l._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(w){l._maximumNumberOfEditOVerrides=w}}}}]);return v}();let u=function(){function v(l,w){this.objectId=l;this.options=w;this.updates=new Map;this.state=0}var t=v.prototype;t.get=function(l){return this.updates.get(l)};t.set=function(l,w){this.isActive&&this.updates.set(l,w)};t.rollback=function(){this.isActive&&(this.state=2,this.options.rollback())};
t.commit=function(){this.isActive&&(this.state=1,this.options.commit(this.updates),this.updates.clear())};g._createClass(v,[{key:"isActive",get:function(){return 0===this.state}}]);return v}();a.I3SAttributeOverrides=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../core/maybe","../../tasks/support/Query"],function(a,g,b){function p(c){return k(c)*f(c)}function f(c){return c.capabilities.query.maxRecordCount||2E3}function k(c){return c.capabilities.query.supportsMaxRecordCountFactor?
b.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=k;a.getMaximumQuerySize=p;a.getMaximumRecordCount=f;a.queryAllJSON=async function(c,d,e){d=d.clone();c.capabilities.query.supportsMaxRecordCountFactor&&(d.maxRecordCountFactor=k(c));const h=p(c),n=c.capabilities.query.supportsPagination;d.start=0;d.num=h;let q=null;for(;;){const u=await c.source.queryFeaturesJSON(d,e);g.isNone(q)?q=u:q.features=q.features.concat(u.features);q.exceededTransferLimit=u.exceededTransferLimit;if(!n||!u.exceededTransferLimit)break;
d.start+=h}return q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling"],function(a,g,b,p){let f=function(){function k(d){this.view=d;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var c=k.prototype;c.stopNodeFading=function(d){null!=d.lodCrossfadeProgress&&(this._numFadingNodes--,d.lodCrossfadeProgress=
null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};c._startNodeFading=function(d,e,h){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=p.addFrameTask({preRender:n=>this._updateAllNodeFading(n)}),this.view.notifyLODUpdate());null==d.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());d.lodCrossfadeSignedDuration=h;d.lodCrossfadeProgress=
e};c._updateAllNodeFading=function(d){const e=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((h,n)=>{if(b.isSome(n)&&b.isSome(n.lodCrossfadeProgress)){const q=n.lodCrossfadeSignedDuration,u=n.lodCrossfadeProgress+Math.abs(d.deltaTime/q),v=!e||1<=u||0===q,t=(0<q?this.view.fullOpacity:0)-(v?0:0<q?1:-1)*(1-u);v?(this.stopNodeFading(n),0>q&&this.view.markNodeToRemove(h)):n.lodCrossfadeProgress=u;this.view.setNodeOpacityByIndex(h,t)}});this.view.removeMarkedNodes()};c.stopAllNodeFading=
function(){this.view.foreachCrossfadeNode((d,e)=>{b.isSome(e)&&b.isSome(e.lodCrossfadeProgress)&&(this.stopNodeFading(e),e=e.lodCrossfadeSignedDuration,0>e&&this.view.markNodeToRemove(d),this.view.setNodeOpacityByIndex(d,0<e?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};c.fadeNode=function(d,e,h,n){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var q=this.view;const u=q.nodeCrossfadingEnabled,v=0===h?q.fullOpacity:0;n=u?n?0===h?q.lodCrossfadeinDuration:q.lodCrossfadeoutDuration:
q.lodCrossfadeUncoveredDuration:0;q=this.view.getNodeOpacityByIndex(d);u&&q!==v&&0<n?this._startNodeFading(e,1-Math.abs(v-q),(0===h?1:-1)*n):(this.stopNodeFading(e),this.view.setNodeOpacityByIndex(d,v),1===h&&this.view.removeNode(d))};c.isNodeFullyFadedIn=function(d){const e=this.view.getNodeCrossfadeMetaData(d);return b.isSome(e)&&null==e.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(d)===this.view.fullOpacity};g._createClass(k,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);
return k}();a.I3SCrossfadeHelper=f;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../webgl-engine/lib/Intersector".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=y.empty(),C=D.create(),A=t.create(),x=t.create(),m=t.create(),B=f.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");b=function(E){function F(I){I=E.call(this,I)||this;I.tmpEvent={spatialReference:null,extent:r,context:"scene"};return I}a._inheritsLoose(F,E);var G=F.prototype;G.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new z.Intersector(this.view.state.mode);
this.intersector.options.store=0;const I=this.layerView.i3slayer.fullExtent;this.zmin=I.zmin;this.zmax=I.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};G.getElevation=function(I,K,J,L){A[0]=I;A[1]=K;A[2]=J;if(!this.renderCoordsHelper.toRenderCoords(A,L,A))return B.error("could not project point to compute elevation"),null;K=this.layerView.elevationOffset;I=this.zmin+K;K=this.zmax+K;l.copy(x,A);l.copy(m,A);this.renderCoordsHelper.setAltitude(K,x);this.renderCoordsHelper.setAltitude(I,
m);this.intersector.reset(x,m);this.intersectionHandler.intersect(this.intersector,null,x,m);return this.intersector.results.min.getIntersectionPoint(A)?this.renderCoordsHelper.getAltitude(A):null};G.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};G.objectChanged=function(I){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(I),this.tmpEvent.spatialReference=
this.spatialReference,this.emit("elevation-change",this.tmpEvent))};G.computeObjectExtent=function(I){y.empty(r);this._expandExtent(I,r);return r};G.computeLayerExtent=function(){y.empty(r);for(const I of this.layerView.getVisibleNodes())this._expandExtent(I,r);return r};G._expandExtent=function(I,K){var J=I.visibilityObb||I.serviceObbInRenderSR;if(p.isSome(J))for(w.fromQuat(C,J.quaternion),C[12]=J.center[0],C[13]=J.center[1],C[14]=J.center[2],I=0;8>I;++I)A[0]=I&1?J.halfSize[0]:-J.halfSize[0],A[1]=
I&2?J.halfSize[1]:-J.halfSize[1],A[2]=I&4?J.halfSize[2]:-J.halfSize[2],l.transformMat4(A,A,C),this.renderCoordsHelper.fromRenderCoords(A,A,this.spatialReference),y.expand(K,A);else{var L=I.renderMbs[3];J=l.copy(x,I.renderMbs);J[0]-=L;J[1]-=L;J[2]-=L;I=l.copy(m,I.renderMbs);I[0]+=L;I[1]+=L;I[2]+=L;for(L=0;8>L;++L)A[0]=L&1?J[0]:I[0],A[1]=L&2?J[1]:I[1],A[2]=L&4?J[2]:I[2],this.renderCoordsHelper.fromRenderCoords(A,A,this.spatialReference),y.expand(K,A)}};return F}(v.EventedMixin(u));g.__decorate([c.property({constructOnly:!0})],
b.prototype,"layerView",void 0);g.__decorate([c.property({constructOnly:!0})],b.prototype,"intersectionHandler",void 0);g.__decorate([c.property()],b.prototype,"view",void 0);g.__decorate([c.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],b.prototype,"spatialReference",void 0);return b=g.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../webgl-engine/lib/intersectorUtils ../../support/orientedBoundingBox".split(" "),
function(a,g,b,p,f,k){function c(e,h,n,q=0){q=e[3]+q;const u=h[0]-e[0],v=h[1]-e[1];e=h[2]-e[2];h=n[0];const t=n[1];n=n[2];const l=h*u+t*v+n*e;return 0<=l*l-(h*h+t*t+n*n)*(u*u+v*v+e*e-q*q)}let d=function(){function e(h){this.type="I3S";this.layerUid=h.layerUid;this.sublayerUid=h.sublayerUid;this.collection=h.collection;this.forEach=h.forEach;this.slicePlane=h.slicePlaneEnabled;this.isGround=h.isGround}e.prototype.intersect=function(h,n,q,u){const v=h.results,t=2===h.options.store,l=h.ray.direction,
w=h.tolerance;let y=r=>r,D=r=>r;const z=f.getVerticalOffsetI3S(h.verticalOffset);b.isSome(z)&&(y=r=>z.applyToMbs(r),D=r=>z.applyToObb(r));this.forEach((r,C)=>{if(b.isSome(r.geometryObb)){if(!k.intersectLine(D(r.geometryObb),q,l,w))return}else if(b.isSome(r.serviceObbInRenderSR)){if(!k.intersectLine(D(r.serviceObbInRenderSR),q,l,w))return}else if(!c(y(r.renderMbs),q,l,w))return;this.collection.intersect(C,q,u,w,z,(A,x,m,B)=>{if(0<=x&&(null==n||n(q,u,x))){var E=F=>{F.intersector=this.type;F.target=
{type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:r.index,componentIndex:A}};F.dist=x;p.copy(F.normal,m);F.triangleNr=B};this.isGround&&(null==v.ground.dist||x<v.ground.dist)&&E(v.ground);if(!h.options.isFiltered&&((null==v.min.dist||x<v.min.dist)&&E(v.min),(null==v.max.dist||x>v.max.dist)&&E(v.max),t)){const F=new f.IntersectorResult(h.ray);E(F);h.results.all.push(F)}}})})};g._createClass(e,[{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);
return e}();a.I3SIntersectionHandler=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/Error","../../../../core/promiseUtils"],function(a,g,b,p,f){function k(e){return new Promise((h,n)=>{e.oncomplete=()=>h();e.onerror=()=>n(e.error);e.onabort=()=>n(e.error)})}function c(e){return new Promise((h,n)=>{"done"===e.readyState?null!=e.error?n(e.error):
h(e.result):(e.onsuccess=()=>h(e.result),e.onerror=()=>n(e.error))})}let d=function(){function e(n,q,u=14){this._version=u;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=n;this._storeName=q}var h=e.prototype;h.init=function(){return Promise.resolve().then(()=>{const n=indexedDB.open(this._dbName,this._version);n.onupgradeneeded=q=>{var u=n.result;const v=n.transaction,
t=u.objectStoreNames.contains(this._storeName)?v.objectStore(this._storeName):u.createObjectStore(this._storeName);u=u.objectStoreNames.contains("last_access")?v.objectStore("last_access"):u.createObjectStore("last_access");u.indexNames.contains("date")||u.createIndex("date","date",{unique:!1});u.indexNames.contains("byteSize")||u.createIndex("byteSize","byteSize",{unique:!1});q.oldVersion<this._version&&(t.clear(),u.clear())};return c(n)}).then(n=>{this._destroyed?n.close():this._db=n})};h.destroy=
function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};h.getHitRate=function(){return this._hit/(this._hit+this._miss)};h.put=function(n,q){return null==this._db?Promise.reject(new p("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(n,q)).catch(u=>{if(u&&"QuotaExceededError"===u.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(v=>
this._removeLeastRecentlyAccessed(q.byteSize+Math.ceil(v*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(n,q));throw u;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(u=>this._removeLeastRecentlyAccessed(u-this.maxByteSize)))})};h.get=function(n,q){if(null==this._db)return Promise.resolve(null);
let u=null;return Promise.resolve().then(()=>{const v=this._db.transaction(this._storeName,"readonly");u=f.onAbort(q,()=>{v.abort()});const t=v.objectStore(this._storeName).get(n);return c(t)}).then(v=>{null==v?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:v.byteSize},n));b.isSome(u)&&u.remove();return v}).catch(()=>{++this._miss;f.throwIfAborted(q);b.isSome(u)&&u.remove();return null})};h.remove=function(n){return null==
this._db?Promise.resolve():Promise.resolve().then(async()=>{const q=this._db.transaction([this._storeName,"last_access"],"readwrite");var u=q.objectStore(this._storeName),v=q.objectStore("last_access");u=u.delete(n);v=v.delete(n);await Promise.all([c(u),c(v),k(q)])})};h._put=function(n,q){const u=this._db.transaction([this._storeName,"last_access"],"readwrite");var v=u.objectStore(this._storeName);const t=u.objectStore("last_access");v=v.put(q,n);n=t.put({date:Date.now(),byteSize:q.byteSize},n);return Promise.all([c(v),
c(n),k(u)])};h._removeLeastRecentlyAccessed=function(n){if(!(0>=n)){var q=this._db.transaction([this._storeName,"last_access"],"readwrite"),u=q.objectStore(this._storeName),v=q.objectStore("last_access"),t=0,l=v.index("date").openCursor(null,"next");l.onsuccess=()=>{const w=l.result;null!=w&&(null!=w.value.byteSize&&(t+=w.value.byteSize),u.delete(w.primaryKey),v.delete(w.primaryKey),t<n&&w.continue())};return k(q)}};h._getCacheSize=function(){const n=this._db.transaction("last_access");let q=0;const u=
n.objectStore("last_access").index("byteSize").openKeyCursor();u.onsuccess=()=>{const v=u.result;if(v){var t=v.key;null!=t&&(q+=t);v.continue()}};return k(n).then(()=>q)};g._createClass(e,[{key:"initialized",get:function(){return null!=this._db}}]);return e}();a.IDBCache=d;a.whenRequest=c;a.whenTransaction=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe"],function(a,g){let b=function(){function p(k,
c){this._textureRep=k;this._textureId=c;this._textureRef=g.applySome(this._textureId,d=>this._textureRep.acquire(d))}var f=p.prototype;f.dispose=function(){this._textureRef=g.applySome(this._textureId,k=>{this._textureRep.release(k)})};f.bind=function(k,c,d,e,h){g.isSome(this._textureRef)&&(c.setUniform1i(d,e),k.bindTexture(this._textureRef.glTexture,e),h&&(k=this._textureRef.glTexture,c.setUniform2f(h,k.descriptor.width,k.descriptor.height)))};return p}();a.RenderTexture=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,g){a.getEllipsoidMode=function(b){return b&&g.isMars(b)?2:b&&g.isMoon(b)?3:1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/arrayUtils ../../../../core/Accessor ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../geometry ../../../../chunks/vec3 ../../../../core/unitUtils ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../core/sql/WhereClause ../../../../geometry/support/aaBoundingBox ../../../layers/support/FeatureFilter ./I3SUtil".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F){async function G(){return R?R:R=await new Promise(function(N,ca){a(["../../../../geometry/geometryEngine"],N,ca)})}function I(N,ca){if(!N)return null;if("disjoint"===ca&&"polygon"===N.type){const V=Array(N.rings.length);for(ca=0;ca<N.rings.length;++ca){var O=A.fromValues(Infinity,Infinity,-Infinity,-Infinity);A.expandWithNestedArray(O,N.rings[ca]);V[ca]={type:"polygon",rings:[N.rings[ca]],spatialReference:N.spatialReference,aabr:O}}V.sort((ia,
ma)=>ia.aabr[0]-ma.aabr[0]);const ba=new Set,fa=new t.PositionHint;for(N=0;N<V.length;++N){const ia=V[N];for(ca=N+1;ca<V.length;++ca){O=V[ca];if(O.aabr[0]>=ia.aabr[2])break;ba.add(O)}ba.forEach(ma=>{ia!==ma&&(ma.aabr[2]<=ia.aabr[0]?ba.delete(ma):R.intersects(ia,ma)&&(ia.rings=ia.rings.concat(ma.rings),A.expand(ia.aabr,ma.aabr),delete ia._geVersion,ba.delete(ma),ma=t.indexOf(V,ma,V.length,fa),V.splice(ma,1)))});ba.add(ia)}for(const ia of V)delete ia.aabr;return V}return[N]}function K(N,ca,O,V){const ba=
P(N,O);return ca.every(fa=>1!==Q(fa,ba,V))}function J(N,ca,O,V,ba,fa,ia){const ma=fa[0].spatialReference||V.spatialReference;if(x.projectBoundingSphere(ca.node.mbs,ba,W,ma)){ba=P(W,ma);var ea=L(ia,V,ma,O,ca.objectHandle);for(const M of fa){if(0===N.length)break;switch(Q(M,ba,ia)){case 1:N.length=0;return;case 0:continue}F.filterInPlace(N,ca.featureIds,Z=>S(M,Z,ea))}}else H.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function L(N,ca,O,
V,ba){ca=ca.renderSpatialReference;const fa=new Map,ia={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:O};ia.rings[0][3]=ia.rings[0][0];let ma,ea;switch(N){case "intersects":ma=(M,Z)=>R.intersects(M,Z)?0:2;ea=X;break;case "contains":ma=(M,Z)=>R.contains(M,Z)?2:1;ea=X;break;default:ma=(M,Z)=>R.disjoint(M,Z)?2:1,ea=aa}return{collection:V,object:ba,type:N,maskSR:O,renderSR:ca,aabbCache:fa,triangle:ia,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},
triangleTest:ma,geometryTest:ea}}function P(N,ca){const O={x:N[0],y:N[1],hasZ:!1,hasM:!1,type:"point",spatialReference:ca};N=ca.isWGS84||ca.isWebMercator?R.geodesicBuffer(O,N[3],1):R.buffer(O,N[3],1);N.type="polygon";return N}function Q(N,ca,O){switch(O){case "intersects":case "contains":return X(N,ca);case "disjoint":return aa(N,ca)}}function X(N,ca){return R.intersects(N,ca)?R.contains(N,ca)?0:2:1}function aa(N,ca){return R.intersects(N,ca)?R.contains(N,ca)?1:2:0}function S(N,ca,O){const {collection:V,
object:ba,renderSR:fa,maskSR:ia,geometryTest:ma,aabbCache:ea}=O;var M=ea.get(ca);if(!M){M=V.getObjectTransform(ba);V.getComponentAabb(ba,ca,U);var Z=[[U[0],U[1],0],[U[0],U[4],0],[U[3],U[4],0],[U[3],U[1],0]];for(var la=0;4>la;++la)z.transformMat3(Z[la],Z[la],M.rotationScale),z.add(Z[la],Z[la],M.position),x.projectVectorToVector(Z[la],fa,Z[la],ia);M={rings:[Z],hasZ:!1,hasM:!1,type:"polygon",spatialReference:ia};M.rings[0][4]=M.rings[0][0];ea.set(ca,M)}switch(ma(N,M)){case 1:return!1;case 0:return!0}const {triangle:ka,
triangleTest:ha,positions:na}=O;M=ka.rings[0][0];Z=ka.rings[0][1];la=ka.rings[0][2];const da=V.getObjectTransform(ba);V.getComponentPositions(ba,ca,na);const {indices:oa,data:qa,stride:ua,startIndex:Ca,endIndex:Ja}=na;for(ca=Ca;ca<Ja;ca+=3){const Ha=ua*oa[ca+0],Na=ua*oa[ca+1],Oa=ua*oa[ca+2];z.set(M,qa[Ha+0],qa[Ha+1],qa[Ha+2]);z.set(Z,qa[Na+0],qa[Na+1],qa[Na+2]);z.set(la,qa[Oa+0],qa[Oa+1],qa[Oa+2]);z.transformMat3(M,M,da.rotationScale);z.transformMat3(Z,Z,da.rotationScale);z.transformMat3(la,la,da.rotationScale);
z.add(M,M,da.position);z.add(Z,Z,da.position);z.add(la,la,da.position);x.projectVectorToVector(M,fa,M,ia);x.projectVectorToVector(Z,fa,Z,ia);x.projectVectorToVector(la,fa,la,ia);if(!(Math.abs((Z[0]-M[0])*(la[1]-M[1])-(Z[1]-M[1])*(la[0]-M[0]))<Y))switch(delete ka._geVersion,ha(N,ka)){case 1:return!1;case 0:return!0}}switch(O.type){case "intersects":return!1;default:return!0}}const H=c.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");g.I3SMeshViewFilter=function(N){function ca(V){V=N.call(this,
V)||this;V._projectionEngineLoaded=!1;return V}b._inheritsLoose(ca,N);var O=ca.prototype;O.initialize=function(){C.whenOnce(this,"filter.geometry").then(()=>this.loadAsyncModule(G().then(V=>{this.destroyed||(this._geometryEngine=V,this.applyFilters())})))};O.addFilters=function(V,ba,fa,ia){const ma=this.sortedObjectIds;k.isSome(ma)&&V.push(M=>F.objectIdFilter(ma,!0,M));this.addSqlFilter(V,this.parsedWhereClause);const ea=this.parsedGeometry;if(k.isSome(ea)){const M=this.spatialRelationship;V.push((Z,
la)=>J(Z,la,ia,ba,fa,ea,M))}};O.isMBSGeoemtryVisible=function(V,ba,fa){const ia=this.parsedGeometry;if(k.isSome(ia)){const ma=this.spatialRelationship;ba=ia[0].spatialReference||ba;return x.projectBoundingSphere(V,fa,W,ba)?K(W,ia,ba,ma):(H.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0};ca.checkSupport=function(V){if(V.timeExtent)return H.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;V=
V.spatialRelationship;return null!=V&&0<=T.indexOf(V)?!0:(H.warn(`Filters with spatialRelationship other than ${T.join(", ")} are not supported for mesh scene layers`),!1)};b._createClass(ca,[{key:"sortedObjectIds",get:function(){if(k.isNone(this.filter.objectIds))return null;const V=new Float64Array(this.filter.objectIds);V.sort();return V}},{key:"parsedWhereClause",get:function(){const V=k.isSome(this.filter)?this.filter.where:null;if(k.isNone(V)||!V)return null;try{return m.WhereClause.create(V,
this.layerFieldsIndex)}catch(ba){H.error(`Failed to parse filter where clause: ${ba}`)}return null}},{key:"parsedGeometry",get:function(){if(k.isNone(this.filter)||!this._geometryEngine)return null;var {geometry:V}=this.filter;if(k.isNone(V))return null;const {distance:ba,units:fa}=this.filter,ia=this.spatialRelationship;V="mesh"===V.type?V.extent:V;if(k.isNone(ba)||0===ba)return I(V,ia);const ma=fa||r.getUnitString(V.spatialReference);if(V.spatialReference.isWGS84)return V=this._geometryEngine.geodesicBuffer(V,
ba,ma),I(V,ia);if(y.canProject(V,w.WGS84))return V=y.project(this._geometryEngine.geodesicBuffer(y.project(V,w.WGS84),ba,ma),V.spatialReference),I(V,ia);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(x.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let ea=null;try{ea=x.project(V,w.WGS84)}catch(M){}if(ea)try{ea=x.project(this._geometryEngine.geodesicBuffer(ea,ba,ma),V.spatialReference)}catch(M){ea=null}ea||H.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${V.spatialReference.wkid}) to WGS84.`);
return I(ea,ia)}},{key:"spatialRelationship",get:function(){return k.isSome(this.filter)?this.filter.spatialRelationship:"intersects"}}]);return ca}(l);p.__decorate([e.property({type:E})],g.I3SMeshViewFilter.prototype,"filter",void 0);p.__decorate([e.property()],g.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);p.__decorate([e.property()],g.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);p.__decorate([e.property()],g.I3SMeshViewFilter.prototype,"applyFilters",void 0);p.__decorate([e.property()],
g.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);p.__decorate([e.property({readOnly:!0})],g.I3SMeshViewFilter.prototype,"sortedObjectIds",null);p.__decorate([e.property({readOnly:!0})],g.I3SMeshViewFilter.prototype,"parsedWhereClause",null);p.__decorate([e.property({readOnly:!0})],g.I3SMeshViewFilter.prototype,"parsedGeometry",null);p.__decorate([e.property({readOnly:!0})],g.I3SMeshViewFilter.prototype,"spatialRelationship",null);p.__decorate([e.property()],g.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",
void 0);p.__decorate([e.property()],g.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);g.I3SMeshViewFilter=p.__decorate([n.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],g.I3SMeshViewFilter);let R;const T=["contains","intersects","disjoint"],W=[0,0,0,0],Y=2**-32,U=B.create();Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../core/Handles ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z){const r=z["default"];a.I3SQueryEngine=function(C){function A(m){m=C.call(this,m)||this;m._dataQueryEngineInstance=null;m._handles=new w;return m}g._inheritsLoose(A,C);var x=A.prototype;x.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};x.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};x.executeQueryForCount=async function(m,B){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(m),B)};x.executeQueryForExtent=async function(m,B){const {count:E,extent:F}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(m),B);m=l.fromJSON(F);return{count:E,extent:m}};x.executeQueryForIds=async function(m,B){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(m),B)};x.executeQuery=
async function(m,B){m=this._ensureQueryJSON(m);if(m.returnGeometry)throw new n("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(m.returnCentroid)throw new n("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");B=await this.dataQueryEngine.executeQuery(m,B);B=y.fromJSON(B);B.features.forEach(E=>{E.geometry=null});return B};x._ensureQueryJSON=function(m){if(f.isNone(m))return this.defaultQueryJSON;
const B=m.toJSON();B.outSpatialReference||(m.outSpatialReference=this.spatialReference);return B};x.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const m=this.layer.objectIdField||"OBJECTID",B=this.layer.fields.map(G=>G.toJSON()),E=this.layerView.view.resourceController.scheduler,F=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new r({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:B,timeInfo:null,spatialReference:F,
objectIdField:m,featureStore:this.spatialIndex,scheduler:E,task:this.task})};g._createClass(A,[{key:"defaultQueryJSON",get:function(){return(new D({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return A}(t);b.__decorate([d.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);b.__decorate([d.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"task",void 0);b.__decorate([d.property({constructOnly:!0})],
a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.I3SQueryEngine.prototype,"spatialReference",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],a.I3SQueryEngine.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0})],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([h.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);a.default=
a.I3SQueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/centroid ../../../../geometry/support/aaBoundingBox ./I3SUtil".split(" "),function(a,g,b,p,f,k){let c=function(){function e(n){this.objectIdField=n.objectIdField;this.getFeatureExtent=n.getFeatureExtent}var h=e.prototype;h.getObjectId=function(n){return n.id};
h.getAttributes=function(n){const {meta:q,index:u}=n,v={};this.objectIdField&&(v[this.objectIdField]=n.id);n=g.isSome(q.attributeInfo)&&q.attributeInfo.attributeData;if(g.isSome(n))for(const t of Object.keys(n))v[t]=k.getCachedAttributeValue(n[t],u);return v};h.getAttribute=function(n,q){if(q===this.objectIdField)return n.id;const {meta:u,index:v}=n;n=g.isSome(u.attributeInfo)&&u.attributeInfo.attributeData;return g.isSome(n)?k.getCachedAttributeValue(n[q],v):null};h.getGeometry=function(n){if(n.geometry)return n.geometry;
const [q,u,v,t,l]=this.getFeatureExtent(n,d);return new b([5],[q,u,v,t,u,v,t,l,v,q,l,v,q,u,v])};h.getCentroid=function(n,q){if(n.geometry)return p.getCentroidOptimizedGeometry(new b,n.geometry,q.hasZ,q.hasM);const [u,v,t,l,w,y]=this.getFeatureExtent(n,d);return new b([0],[(u+l)/2,(v+w)/2,(t+y)/2])};h.cloneWithGeometry=function(n,q){const {id:u,index:v,meta:t}=n;return{id:u,index:v,meta:t,geometry:q}};return e}();const d=f.create();a.I3SQueryFeatureAdapter=c;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y){a.I3SQueryFeatureStore=function(C){function A(m){m=C.call(this,m)||this;m.events=new v;return m}g._inheritsLoose(A,C);var x=A.prototype;x.destroy=function(){};x.forEach=function(m){this.forAllFeatures(B=>{m(B);return 1})};x.forEachBounds=function(m,B,E){const F=this.getFeatureExtent;for(const G of m)B(F(G,E))};x.forEachInBounds=function(m,B){this.forAllFeatures(E=>{const F=this.getFeatureExtent(E,z);t.intersects(m,y.toRect(F,r))&&B(E);return 1},E=>{l.projectBoundingSphere(E.node.mbs,
this.sourceSpatialReference,D,this.viewSpatialReference);if(D[0]>=m[0]&&D[2]<=m[2]&&D[1]>=m[1]&&D[3]<=m[3])return 1;E=D[0]-Math.max(m[0],Math.min(D[0],m[2]));const F=D[1]-Math.max(m[1],Math.min(D[1],m[3]));return E*E+F*F<=D[3]*D[3]?1:2})};return A}(u);b.__decorate([c.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([c.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);b.__decorate([c.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([c.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([c.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const D=w.create(),z=y.create(),r=t.create();a.default=a.I3SQueryFeatureStore;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v){const t=f.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");a.DefinitionExpressionSceneLayerView=l=>{l=function(w){function y(){var z=w.apply(this,arguments)||this;z._definitionExpressionErrors=0;z._maxDefinitionExpressionErrors=20;z.logError=r=>{z._definitionExpressionErrors<z._maxDefinitionExpressionErrors&&t.error("Error while evaluating definitionExpression: "+r);z._definitionExpressionErrors++;z._definitionExpressionErrors===z._maxDefinitionExpressionErrors&&
t.error("Further errors are ignored")};return z}g._inheritsLoose(y,w);var D=y.prototype;D._evaluateClause=function(z,r){try{return z.testFeature(r)}catch(C){return this.logError(C),!1}};D._addDefinitionExpressionToQuery=function(z){if(!this.parsedDefinitionExpression)return z;const r=this.i3slayer.definitionExpression;z=z.clone();z.where=z.where?`(${r}) AND (${z.where})`:r;return z};g._createClass(y,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;
try{const z=u.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!z.isStandardized)return t.error("definitionExpression is using non standard function"),null;const r=[];v.findFieldsCaseInsensitive(z.fieldNames,this.i3slayer.fields,{missingFields:r});if(0<r.length)return t.error(`definitionExpression references unknown fields: ${r.join(", ")}`),null;this._definitionExpressionErrors=0;return z}catch(z){return t.error("Failed to parse definitionExpression: "+z),null}}},
{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}}]);return y}(l);b.__decorate([c.property()],l.prototype,"i3slayer",void 0);b.__decorate([c.property({readOnly:!0})],l.prototype,"parsedDefinitionExpression",null);b.__decorate([c.property({readOnly:!0})],l.prototype,"definitionExpressionFields",null);return l=b.__decorate([e.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],l)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,g,b,p){function f(h,n){const q=n.edits.updateFeatures;if(!q||0===q.length)return new e;const u=k(n),v=new e;n=new Map;for(let y=0;y<h.attributeStorageInfo.length;y++)n.set(h.attributeStorageInfo[y].name,y);const t=h.fieldsIndex,l=h.objectIdField,w=q.filter(y=>{y=p.attributeLookup(t,y.attributes,l);return u.has(y)});
h.forEachNode((y,D)=>{const z=new Set(D);for(const m of w){const B=p.attributeLookup(t,m.attributes,l);if(!z.has(B))continue;const E=D.indexOf(B);for(const F in m.attributes){var r=h.fieldsIndex.normalizeFieldName(F);var C=v;var A=y.index,x=C.get(A);x?C=x:(x=new d,C.set(A,x),C=x);(A=C.get(r))?r=A:(A=[],C.set(r,A),r=A);r.push({featureIndex:E,featureId:B,value:m.attributes[F]})}}});return v}function k(h){const n=new Set;if(!h.updatedFeatures)return n;for(const q of h.updatedFeatures)null!=q.objectId&&
null==q.error&&n.add(q.objectId);return n}const c={setAttribute(){},rollback(){},commit(){}},d=Map,e=Map;a.createInteractiveEditSession=function(h,n){const q=n.attributes[h.objectIdField];var u=h.sessions.get(q);if(u)return u;const v=g.clone(n.attributes),t=new Set;if(null==q)return c;const l=h.attributeOverrides.createInteractiveEditSession(q),w=new Map;let y=0;u={setAttribute(D,z){if(0===y){var r=h.fieldsIndex.get(D);if(!b.isNone(r)){var C=h.attributeStorageInfo.findIndex(m=>m.name===r.name);if(!(0>
C)){l.set(C,z);var A=h.attributeStorageInfo[C],x=!1;t.add(D);h.forEachNode((m,B)=>{var E=w.get(m);null==E?(B=B.indexOf(q),w.set(m,B)):B=E;if(-1!==B&&(E=h.getAttributeData(m.index))){const F=E[A.name];F&&(F[B]=z,h.setAttributeData(m.index,E,n),x=!0)}});x&&h.clearMemCache()}}}},rollback(){if(0===y){for(const D of t)this.setAttribute(D,v[D]);l.rollback();y=1;h.sessions.delete(q)}},commit(){0===y&&(l.commit(),y=2,h.sessions.delete(q))}};h.sessions.set(q,u);return u};a.processAttributeEdits=function(h,
n){n=f(h,n);if(0!==n.size){var q=new Map;for(let v=0;v<h.attributeStorageInfo.length;v++)q.set(h.attributeStorageInfo[v].name,v);var u=!1;n.forEach((v,t)=>{const l=h.getAttributeData(t);let w=!1;v.forEach((y,D)=>{const z=b.isSome(l)?l[D]:null;D=q.get(D);for(const {featureIndex:r,value:C,featureId:A}of y)z&&(z[r]=C,u=w=!0),h.attributeOverrides.updateValue(A,D,C)});w&&h.setAttributeData(t,l,null)});u&&h.clearMemCache()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports",
"../../../../layers/support/fieldUtils"],function(a,g){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:b,layer:{fields:p},requiredFields:f}=this;return b.outFields?g.fixFields(p,[...g.unpackFieldNames(p,b.outFields),...f]):g.fixFields(p,f)}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../layers/support/fieldUtils ../../../../core/AsyncUpdate ../../../../core/HandleOwner".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l){async function w(D){const z=new Set;try{return await D(z),Array.from(z).sort()}catch(r){return y.error(r),null}}const y=k.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");a.SceneLayerViewRequiredFields=function(D){function z(r){return D.call(this,r)||this}g._inheritsLoose(z,D);z.prototype.initialize=function(){this.layer=this.layerView.layer;this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const {fields:r,renderer:C}=this.layer;
return C?w(A=>C.collectRequiredFields(A,r)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:r}=this;return r.labelsVisible?w(C=>v.collectLabelingFields(C,r)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:r,filter:C}=this.layerView;return w(A=>v.collectFilterFields(A,r,C))})])};g._createClass(z,[{key:"requiredFields",get:function(){const {layerView:{layer:{fields:r},definitionExpressionFields:C},rendererFields:A,labelingFields:x,viewFilterFields:m}=this;return v.fixFields(r,
[...f.unwrapOr(C,[]),...f.unwrapOr(A,[]),...f.unwrapOr(x,[]),...f.unwrapOr(m,[])])}}]);return z}(t.AsyncUpdateMixin(l.HandleOwner));b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([d.property()],
a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([h.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Logger ./accessorSupport/decorators/subclass ./accessorSupport/tracking ./accessorSupport/tracking/SimpleTrackingTarget ./Accessor".split(" "),
function(a,g,b,p,f,k,c,d){function e(n,q){const u=()=>{if(!v||t)return q();v.clear();t=!0;const l=k.runTracked(v,q);t=!1;return l};let v=new c.SimpleTrackingTarget(()=>{v&&!t&&n(u)}),t=!1;n(u);return{remove:()=>{v&&(v.destroy(),v=null)}}}const h=n=>{n=function(q){function u(){var t=q.apply(this,arguments)||this;t.asyncUpdateState=new Map;return t}g._inheritsLoose(u,q);var v=u.prototype;v.autoUpdateAsync=function(t,l){return e(w=>this.updateAsync(t,w),l)};v.updateAsync=async function(t,l){if(!this.startAsyncUpdate(t)){try{const w=
await l();this._set(t,w)}catch(w){p.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,l)}};v.startAsyncUpdate=function(t){var l;const w=null!=(l=this.asyncUpdateState.get(t))?l:0;if(w&1)return this.asyncUpdateState.set(t,w|2),!0;this.asyncUpdateState.set(t,w|1);return!1};v.endAsyncUpdate=function(t){var l;const w=(null!=(l=this.asyncUpdateState.get(t))?l:0)&-2;if(w&2)return this.asyncUpdateState.set(t,
w&-3),!0;this.asyncUpdateState.set(t,w);return!1};return u}(n);return n=b.__decorate([f.subclass("esri.core.AsyncUpdate")],n)};a.AsyncUpdate=function(n){function q(){return n.apply(this,arguments)||this}g._inheritsLoose(q,n);return q}(h(d));a.AsyncUpdate=b.__decorate([f.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/support/contains ../../../Graphic ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../rest/query/operations/zscale ../../../tasks/support/Query ../../../layers/graphics/dehydratedFeatures ../support/debugFlags ../../../layers/graphics/hydratedFeatures ../../../renderers/support/renderingInfoUtils ./LayerView3D ./support/layerViewUpdatingProperties ../support/orientedBoundingBox ../../layers/support/FeatureFilter ../../layers/SceneLayerView ./i3s/I3SUtil ../../../layers/graphics/controllers/I3SOnDemandController ../support/GraphicsMap ./i3s/I3SAttributeOverrides ./support/DefinitionExpressionSceneLayerView ./graphics/QueryEngine ./graphics/Graphics3DFeatureLikeLayerView ./I3SPointsWorkerHandle ./support/PopupSceneLayerView ./i3s/attributeEditing ./support/fieldProperties ./support/SceneLayerViewRequiredFields".split(" "),
function(a,g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U){function N(ia){const ma=ia.attributeInfo;for(let ea=0;ea<ia.graphics.length;ea++){const M=ia.graphics[ea];M.attributes||(M.attributes={});if(f.isSome(ma)&&f.isSome(ma.loadedAttributes))for(const {name:Z}of ma.loadedAttributes)ma.attributeData[Z]&&(M.attributes[Z]=L.getCachedAttributeValue(ma.attributeData[Z],ea))}}const ca=k.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");p=Y.defineFieldProperties();
F=function(ia){function ma(){var M=ia.apply(this,arguments)||this;M._nodesAddedToStage=new Map;M.drapeSourceType=1;M._queryEngine=null;M._memCache=null;M._interactiveEditingSessions=new Map;M.loadedGraphics=new Q.GraphicsMap;M.holeFilling="always";M.progressiveLoadFactor=1;M.supportsHeightUnitConversion=!0;M._coordinatesOutsideExtentErrors=0;M._maxCoordinatesOutsideExtentErrors=20;return M}g._inheritsLoose(ma,ia);var ea=ma.prototype;ea.initialize=function(){var M;const Z=this.layer;this.addResolvingPromise(Z.indexInfo);
this._attributeOverrides=new X.I3SAttributeOverrides(this.layer,null==(M=this.view.resourceController)?void 0:M.memoryController);L.checkSpatialReferences(Z,this.view.spatialReference,this.view.viewingMode);this.fieldsHelper=new U.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(Z,"rangeInfos",la=>this._rangeInfosChanged(la),2);this.updatingHandles.add(Z,"renderer",(la,ka)=>this._rendererChange(la,ka));this.updatingHandles.add(this,"parsedDefinitionExpression",()=>this._filterChange());
this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged());this.handles.add(y.init(m,"I3S_TREE_SHOW_TILES",la=>{if(la&&!this._treeDebugger){const ka=this._controller.crsIndex;(new Promise(function(ha,na){a(["./support/I3STreeDebugger"],ha,na)})).then(({I3STreeDebugger:ha})=>{!this._treeDebugger&&m.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ha({lv:this,view:this.view,nodeSR:ka}))})}else la||!this._treeDebugger||m.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),
this._treeDebugger=null)}));this._set("graphics3d",new H({owner:this,layer:Z,preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:Z.fullExtent,updateClippingExtent:la=>this._updateClippingExtent(la)}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",la=>
this._invalidateElevation(la));this.supportsHeightUnitConversion&&(this._verticalScale=C.getGeometryZScaler("point",Z.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(Z.uid);this._controller=new P({layerView:this,scaleVisibilityEnabled:!1});L.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new R.I3SPointsWorkerHandle(this.view.resourceController.scheduler));this.handles.add(this.layer.on("apply-edits",
la=>this.updatingHandles.addPromise(la.result)));this.handles.add(this.layer.on("edits",la=>this._handleEdits(la)));this.when(()=>{this._queryEngine=new S["default"]({layerView:this,task:r.Task.FEATURE_QUERY_ENGINE});this.updatingHandles.add(this,"maximumNumberOfFeatures",la=>this._controller.featureTarget=la,2);this.updatingHandles.add(this,"suspended",la=>{la&&this._removeAllNodeData()})})};ea.destroy=function(){this._treeDebugger=f.destroyMaybe(this._treeDebugger);this._attributeOverrides=f.destroyMaybe(this._attributeOverrides);
this._set("graphics3d",f.destroyMaybe(this.graphics3d));this._controller=f.destroyMaybe(this._controller);this._queryEngine=f.destroyMaybe(this._queryEngine);this._worker=f.destroyMaybe(this._worker);this._memCache=f.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this.fieldsHelper=f.destroyMaybe(this.fieldsHelper)};ea.notifyGraphicGeometryChanged=function(M){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(M)};ea.notifyGraphicVisibilityChanged=function(M){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(M)};
ea.whenGraphicAttributes=async function(M,Z){return L.whenGraphicAttributes(this.layer,M,this._getObjectIdField(),Z,()=>[...this._nodesAddedToStage.values()])};ea.getGraphicFromGraphicUid=function(M){if(!this.loadedGraphics)return null;const Z=B.hydrateGraphic(this.loadedGraphics.find(ka=>ka.uid===M),this.layer),la=this._getObjectIdField();if(!Z||!Z.attributes||!Z.attributes[la])return null;Z.layer=this.layer;Z.sourceLayer=this.layer;return Z};ea.whenGraphicBounds=function(M,Z){return this.graphics3d.graphicsCore.whenGraphicBounds(M,
Z)};ea.computeAttachmentOrigin=function(M,Z){return this.graphics3d.graphicsCore.computeAttachmentOrigin(M,Z)};ea.canResume=function(){return ia.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};ea.isUpdating=function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};ea.getRenderingInfo=function(M,Z,la){M=E.getRenderingInfo(M,{renderer:Z,arcade:la});f.isSome(M)&&M.color&&(Z=M.color,Z[0]/=255,Z[1]/=255,Z[2]/=255);
return M};ea.getRenderingInfoAsync=async function(M,Z,la,ka){return E.getRenderingInfoAsync(M,{renderer:Z,arcade:la,...ka})};ea.highlight=function(M){return this.graphics3d.highlight(M,this.layer.objectIdField)};ea.createInteractiveEditSession=function(M){return W.createInteractiveEditSession(this.attributeEditingContext,M)};ea.extractBinaryPointData=async function(M,Z){M={geometryBuffer:M.geometryBuffer};f.isNone(this._worker)&&(this._worker=new R.I3SPointsWorkerHandle(this.view.resourceController.scheduler));
return this._worker.invoke(M,Z).then(la=>{if(f.isSome(la))return{positionData:la.positions,featureIds:la.featureIds};throw Error("Failed to decompress Draco point data");})};ea.checkExtent=function(M,Z){M&&!v.extentContainsCoords3D(M,Z)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&ca.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&ca.error("Maximum number of errors reached. Further errors are ignored."),
this._coordinatesOutsideExtentErrors++)};ea.addNode=async function(M,Z,la){if(!("geometryBuffer"in Z&&null!==Z.geometryBuffer||"pointData"in Z))return Promise.reject();if(this._nodesAddedToStage.has(M.index))ca.error("I3S node "+M.id+" already added");else{var ka;if(ka=this.layer.fullExtent)ka=this.layer.fullExtent.clone(),ka.xmin-=.5,ka.ymin-=.5,ka.xmax+=.5,ka.ymax+=.5,ka.hasZ&&(ka.zmin-=.5,ka.zmax+=.5),ka.hasM&&(ka.mmin-=.5,ka.mmax+=.5);var ha=this._controller.crsVertex,na=[],da={graphics:null,
featureIds:null,attributeInfo:Z.attributeDataInfo,node:M};"geometryBuffer"in Z&&null!==Z.geometryBuffer?await this._addNodeBinaryPointData(M,da,Z,ka,na,la):"pointData"in Z&&this._addNodeLegacyPointData(M,da,Z,ka,na);await this._attributeOverrides.apply(da.featureIds,Z.attributeDataInfo,la);M.numFeatures=da.graphics.length;this._updateNodeMemory(M);N(da);0<na.length&&(this.computeObb(M,na,ha),this._controller.updateVisibility(M.index));if(!this._controller.isGeometryVisible(M))return this._cacheNodeData(da),
Promise.resolve();if(this._verticalScale)for(const oa of da.graphics)this._verticalScale(oa.geometry);this._nodesAddedToStage.set(M.index,da);this.loadedGraphics.addMany(da.graphics);this._filterNode(da);this._treeDebugger&&this._treeDebugger.update();return Promise.resolve()}};ea.computeObb=function(M,Z,la){const ka=this._controller.crsIndex,ha=ka.isGeographic?this.view.renderSpatialReference:ka;z.projectBuffer(Z,la,0,Z,ha,0,Z.length/3);M.serviceObb=I.compute({data:Z,size:3});ka.isGeographic&&z.projectVectorToVector(M.serviceObb.center,
ha,M.serviceObb.center,ka)};ea.isNodeLoaded=function(M){return this._nodesAddedToStage.has(M)};ea.isNodeReloading=function(){return!1};ea.updateNodeState=function(){};ea._addNodeBinaryPointData=async function(M,Z,la,ka,ha,na){var da=await this.extractBinaryPointData(la,na);if(null==da)return Promise.reject();la=this._getObjectIdField();na=this._controller.crsVertex;const oa=this.view.spatialReference,qa=this.graphics3d.graphicsCore,{positionData:ua,featureIds:Ca}=da;da=ua.length/3;const Ja=[];for(let Ka=
0;Ka<da;Ka++){var Ha=f.isSome(M.serviceObb)?M.serviceObb.center:[0,0,0],Na=3*Ka,Oa=l.fromValues(ua[Na+0],ua[Na+1],ua[Na+2]);w.add(Oa,Oa,Ha);M.serviceObb||ha.push(Oa[0],Oa[1],Oa[2]);ka&&this.checkExtent(ka,Oa);Na=Ca[Ka];Ha={};null!=Na&&(Ha[la]=Na);Na=null==Na?t.generateUID():Na;z.projectBuffer(Oa,na,0,V,oa,0,1);Oa=x.makeDehydratedPoint(V[0],V[1],V[2],oa);var Va=this.loadedGraphics.get(Na);f.isSome(Va)?(Va.level<M.level&&(ba.property="geometry",ba.graphic=Va,ba.oldValue=f.unwrap(Va.geometry),ba.newValue=
Oa,Va.geometry=Oa,qa.graphicUpdateHandler(ba)),Ja.push(Va)):(Va=t.generateUID(),Ja.push({objectId:Na,uid:Va,geometry:Oa,attributes:Ha,visible:!0,level:M.level}))}Z.graphics=Ja;Z.featureIds=Ca};ea._addNodeLegacyPointData=function(M,Z,la,ka,ha){const na=this._getObjectIdField(),da=this._controller.crsVertex,oa=this.view.spatialReference,qa=[0,0,0],ua=[],Ca=[];for(const Na of la.pointData){la=Na.featureDataPosition;const Oa=la.length;var Ja=Na.geometries&&Na.geometries[0]||O[Oa];const Va=Na.featureIds[0];
if("points"!==Ja.params.type)continue;ka&&this.checkExtent(ka,la);const Ka={};null!=Va&&(Ka[na]=Va);const wa=null==Va?t.generateUID():Va;let Ea;"Embedded"===Ja.type&&(Ea=Ja.params.vertexAttributes.position);for(Ja=0;Ja<Ea.length;Ja+=Oa){for(var Ha=0;Ha<Oa;Ha++)qa[Ha]=la[Ha]+Ea[Ja+Ha];Ha=3===Oa;M.serviceObb||ha.push(qa[0],qa[1],Ha?qa[2]:0);z.projectBuffer(qa,da,0,V,oa,0,1);Ha=x.makeDehydratedPoint(V[0],V[1],Ha?V[2]:void 0,oa);const Pa=this.loadedGraphics.get(wa);f.isSome(Pa)?Ca.push(Pa):Ca.push({objectId:wa,
uid:t.generateUID(),geometry:Ha,attributes:Ka,visible:!0})}ua.push(Va)}Z.graphics=Ca;Z.featureIds=ua};ea._updateNodeMemory=function(M){M.memory=4096+(f.isSome(M.numFeatures)?M.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)};ea._cacheNodeData=function(M){const Z=M.graphics.reduce((la,ka)=>x.estimateSize(ka)+la,8*M.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(M.node),M,Z)};ea._getMemCacheKey=function(M){return`${M.index}`};ea._removeAllNodeData=function(){this._nodesAddedToStage.forEach(M=>
{M&&(this._updateNodeMemory(M.node),this._cacheNodeData(M))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};ea.removeNode=function(M){if(M=this._removeNodeStageData(M))this._updateNodeMemory(M.node),this._cacheNodeData(M)};ea._removeNodeStageData=function(M){const Z=this._nodesAddedToStage.get(M);if(!Z)return null;this.loadedGraphics.removeMany(Z.graphics);this._nodesAddedToStage.delete(M);this._treeDebugger&&this._treeDebugger.update();
return Z};ea.loadCachedNodeData=async function(M){return this._memCache.pop(this._getMemCacheKey(M))};ea.addCachedNodeData=async function(M,Z,la,ka){if(this._nodesAddedToStage.has(M.index))ca.error("I3S node "+M.id+" already added");else return this.loadedGraphics.addMany(Z.graphics),this._nodesAddedToStage.set(M.index,Z),this._updateNodeMemory(M),await this.updateAttributes(M.index,la,ka),this._filterNode(Z),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()};ea.getLoadedNodeIds=function(){const M=
[];this._nodesAddedToStage.forEach(Z=>M.push(Z.node.id));return M.sort()};ea.getVisibleNodes=function(){const M=[];this._nodesAddedToStage.forEach(Z=>M.push(Z.node));return M};ea.getLoadedNodeIndices=function(M){this._nodesAddedToStage.forEach((Z,la)=>M.push(la))};ea.getLoadedAttributes=function(M){if((M=this._nodesAddedToStage.get(M))&&f.isSome(M.attributeInfo))return M.attributeInfo.loadedAttributes};ea.getAttributeData=function(M){if((M=this._nodesAddedToStage.get(M))&&f.isSome(M.attributeInfo))return M.attributeInfo.attributeData};
ea.setAttributeData=function(M,Z){(M=this._nodesAddedToStage.get(M))&&!f.isNone(M.attributeInfo)&&(M.attributeInfo.attributeData=Z,this._attributeValuesChanged(M))};ea.updateAttributes=async function(M,Z,la){if(M=this._nodesAddedToStage.get(M))await this._attributeOverrides.apply(M.featureIds,Z,la),M.attributeInfo=Z,this._attributeValuesChanged(M)};ea._attributeValuesChanged=function(M){N(M);this._filterNode(M);this.graphics3d.graphicsCore.labelsEnabled&&(M=M.graphics.map(Z=>Z.uid),this.graphics3d.graphicsCore.updateLabelingInfo(M))};
ea._updateClippingExtent=function(M){this._controller&&this._controller.updateClippingArea(M);return!1};ea._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};ea._rendererChange=async function(M,Z){const {layer:{fields:la}}=this,ka=new Set;let ha;M?(await M.collectRequiredFields(ka,la),ha=Array.from(ka).sort()):ha=[];ka.clear();let na;Z?(await Z.collectRequiredFields(ka,la),na=Array.from(ka).sort()):na=[];ha.length===na.length&&ha.every((da,oa)=>ha[oa]===na[oa])||this._reloadAllNodes()};
ea._rangeInfosChanged=function(M){null!=M&&0<M.length&&ca.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};ea._filterChange=function(){this._nodesAddedToStage.forEach(M=>this._filterNode(M))};ea._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};ea._filterNode=function(M){const Z=this.parsedDefinitionExpression;for(const la of M.graphics)M=la.visible,la.visible=Z?this._evaluateClause(Z,
la):!0,M!==la.visible&&(ba.graphic=la,ba.property="visible",ba.oldValue=M,ba.newValue=la.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(ba))};ea._invalidateElevation=function(M){const Z=this._controller.crsIndex;z.projectBoundingRect(M.extent,M.spatialReference,fa,Z);this._controller.updateElevationChanged(fa,Z)};ea.createQuery=function(){const M={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return f.isSome(this.filter)?this.filter.createQuery(M):new A(M)};
ea.queryFeatures=function(M,Z){return this._queryEngine.executeQuery(this._ensureQuery(M),null==Z?void 0:Z.signal)};ea.queryObjectIds=function(M,Z){return this._queryEngine.executeQueryForIds(this._ensureQuery(M),null==Z?void 0:Z.signal)};ea.queryFeatureCount=function(M,Z){return this._queryEngine.executeQueryForCount(this._ensureQuery(M),null==Z?void 0:Z.signal)};ea.queryExtent=function(M,Z){return this._queryEngine.executeQueryForExtent(this._ensureQuery(M),null==Z?void 0:Z.signal)};ea._ensureQuery=
function(M){return this._addDefinitionExpressionToQuery(f.isNone(M)?this.createQuery():A.from(M))};ea.getUsedMemory=function(){const M=this.graphics3d&&this.graphics3d.graphicsCore;return M?M.usedMemory:0};ea.getUnloadedMemory=function(){const M=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(M?M.unprocessedMemoryEstimate:0))};ea.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};ea._handleEdits=
function(M){W.processAttributeEdits(this.attributeEditingContext,M)};g._createClass(ma,[{key:"requiredFields",get:function(){var M,Z;return null!=(M=null==(Z=this.fieldsHelper)?void 0:Z.requiredFields)?M:[]}},{key:"maximumNumberOfFeatures",get:function(){const M=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return M?M.maximumNumberOfFeatures:0},set:function(M){null!=M?(this._override("maximumNumberOfFeatures",M),this._controller.fixedFeatureTarget=
!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leavesReached}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"attributeEditingContext",get:function(){const M=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:M,forEachNode:Z=>this._nodesAddedToStage.forEach(la=>Z(la.node,la.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:Z=>this.getAttributeData(Z),setAttributeData:(Z,la,ka)=>{this.setAttributeData(Z,la);Z=this._nodesAddedToStage.get(Z);f.isSome(ka)?(ka=this.loadedGraphics.get(ka.attributes[M]),f.isSome(ka)&&this.graphics3d.graphicsCore.recreateGraphics([ka])):f.isSome(Z)&&
this.graphics3d.graphicsCore.recreateGraphics(Z.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const M={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(M);return M}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,
numFeatures:this.loadedGraphics.length}}}]);return ma}(aa.DefinitionExpressionSceneLayerView(T.PopupSceneLayerView(F.LayerView3D(J))));b.__decorate([d.property()],F.prototype,"graphics3d",void 0);b.__decorate([d.property({type:K})],F.prototype,"filter",void 0);b.__decorate([d.property()],F.prototype,"loadedGraphics",void 0);b.__decorate([d.property({aliasOf:"layer"})],F.prototype,"i3slayer",void 0);b.__decorate([d.property()],F.prototype,"_controller",void 0);b.__decorate([d.property()],F.prototype,
"updating",void 0);b.__decorate([d.property()],F.prototype,"suspended",void 0);b.__decorate([d.property()],F.prototype,"holeFilling",void 0);b.__decorate([d.property(G.updatingProgress)],F.prototype,"updatingProgress",void 0);b.__decorate([d.property({aliasOf:"_controller.updatingProgress"})],F.prototype,"updatingProgressValue",void 0);b.__decorate([d.property(p.requiredFields)],F.prototype,"requiredFields",null);b.__decorate([d.property(p.availableFields)],F.prototype,"availableFields",void 0);b.__decorate([d.property()],
F.prototype,"fieldsHelper",void 0);b.__decorate([d.property({type:Number})],F.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],F.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],F.prototype,"lodFactor",void 0);b.__decorate([d.property({readOnly:!0})],F.prototype,"hasM",null);b.__decorate([d.property({readOnly:!0})],F.prototype,"hasZ",null);b=F=b.__decorate([h.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],
F);const O={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},V=l.create(),ba={graphic:null,property:null,oldValue:null,newValue:null},fa=D.create();return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,g,b){b=function(p){function f(k){return p.call(this,"SceneLayerWorker",
"dracoDecompressPointCloudData",k,{hasInitialize:!0})||this}g._inheritsLoose(f,p);f.prototype.getTransferList=function(k){return[k.geometryBuffer]};return f}(b.WorkerHandle);a.I3SPointsWorkerHandle=b;Object.defineProperty(a,"__esModule",{value:!0})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/handleUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/events ../core/promiseUtils ../core/scheduling ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../geometry/Point ../geometry/Extent ../geometry ../core/Collection ../core/screenUtils ../Graphic ../chunks/vec3f64 ../Camera ../Ground ../geometry/projectionEllipsoid ../Viewpoint ../core/watchUtils ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/projection ./support/spatialReferenceSupport ../webscene/Environment ../core/workers/workers ../core/domUtils ./support/screenshotUtils ../geometry/support/scaleUtils ../layers/support/layerUtils ./BreakpointsOwner ./support/layerViewUtils ./DOMContainer ./3d/support/ElevationProvider ./GroundView ./PopupView ./support/screenUtils ./View ./ViewAnimation ./support/WebGLRequirements ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ../chunks/boundedPlane ./3d/support/geometryUtils ./3d/environment/SceneViewEnvironmentManager ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/Intersector ./3d/input/SceneInputManager ./3d/interactive/graphics/analysisFactoryUtils ./3d/support/debugFlags ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/support/PropertiesPool ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/terrain/terrainUtils ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/webgl-engine/Stage ./support/hitTestSelectUtils ./ui/3d/DefaultUI3D".split(" "),function(a,
g,b,p,f,k,c,d,e,h,n,q,u,v,t,l,w,y,D,z,r,C,A,x,m,B,E,F,G,I,K,J,L,P,Q,X,aa,S,H,R,T,W,Y,U,N,ca,O,V,ba,fa,ia,ma,ea,M,Z,la,ka,ha,na,da,oa,qa,ua,Ca,Ja,Ha,Na,Oa,Va,Ka,wa,Ea,Pa,ja,Ya,ab,cb,lb,Xa,ta,Ba,va,za,Da,Ga,Sa,Ta,Ra){function ra(bb,ib){bb.layerUids||(bb.layerUids=new Set);bb.layerUids.add(ib)}function Aa(bb,ib){bb.graphicUids||(bb.graphicUids=new Set);bb.graphicUids.add(ib)}const Ma=k.getLogger("esri.views.SceneView");k=function(bb){function ib(Fa){var La=bb.call(this,Fa)||this;La._clippingArea=null;
La._userClippingArea=null;La._initialDefaultSpatialReference=null;La._defaults={};La._externallySet={environment:!1};La._createGraphicsViewController=null;La._resolveWhenReady=[];La.propertiesPool=new Ka.PropertiesPool({slicePlane:ha.BoundedPlaneClass},g._assertThisInitialized(La));La._resourceController=ta.newResourceController(g._assertThisInitialized(La));La._defaultToMapOptions={include:new Set};La._defaultHitTestOptions={exclude:new Set};La.deconflictor=new Ha.GraphicsDeconflictor({view:g._assertThisInitialized(La)});
La.labeler=new Na.Labeler({view:g._assertThisInitialized(La),deconflictor:La.deconflictor.labels});La.sharedSymbolResources=null;La.basemapTerrain=null;La.elevationProvider=null;La.camera=null;La.canvas=null;La.center=null;La.constraints=new la["default"];La.environmentManager=new da["default"];La.extent=null;La.floors=new m;La.windowDevicePixelRatio=1;La.fullOpacity=1;La.graphicsView=null;La.groundView=null;La.navigating=!1;La.map=null;La.screenSizePerspectiveEnabled=!0;La.state=new wa;La.scale=
null;La.spatialReference=null;La.isHeightModelInfoRequired=!0;La.alphaCompositingEnabled=!1;La.supersampleScreenhotsEnabled=!0;La.type="3d";La.ui=new Ra;La._numUpdating=0;La._lastUpdateTime=0;La.updatingProgress=.5;La.viewpoint=null;La.zoom=null;La.highlightOptions=new ab;H.initialize();Fa&&Fa.environment||(La._defaults.environment=new ka,La.environment=La._defaults.environment);Fa=$a=>{f.isSome($a)&&4===$a.type||(La.notifyChange("dataExtent"),La.updatingChanged(),La.map&&La.map.allLayers.forEach(async eb=>
{try{await eb.when()}catch{}La.updatingChanged()}))};La.handles.add([L.on(g._assertThisInitialized(La),"map.allLayers","after-changes",Fa,Fa,Fa,!0),La.allLayerViews.on("after-changes",$a=>La._updateUpdatingMonitors($a)),La.watch("map",$a=>{$a&&$a.load&&$a.load().catch(()=>{})})]);La.inputManager=new ua({view:g._assertThisInitialized(La)});La.stateManager=new Ea({view:g._assertThisInitialized(La),updateDevicePixelRatio:()=>{const $a=window.devicePixelRatio;$a!==La.windowDevicePixelRatio&&(La.windowDevicePixelRatio=
$a,La.notifyChange("pixelRatio"))}});return La}g._inheritsLoose(ib,bb);var db=ib.prototype;db.initialize=function(){this.groundView=new V({view:this});this._updateUpdatingMonitors();const Fa=()=>this._updateDefaultToMapOptions();this.handles.add(L.on(this,"map.allLayers","after-changes",Fa,Fa,Fa));this.updatingHandles.add(this.qualitySettings,"memoryLimit",La=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=La)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",
La=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=La)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",La=>D.setFrameDuration(0<La?1E3/Math.ceil(La):0),2);this.updatingHandles.add(Ja,"SCENEVIEW_LOCKING_LOG",La=>this.defaultsFromMap.logDebugInformation=La,2);this.updatingHandles.add(this,"map.ground",Fa,3);this.updatingHandles.add(this,"map.ground.opacity",()=>this._updateDefaultHitTestOptions(),3);this.handles.add(this.watch("spatialReference",
()=>this.notifyChange("clippingArea"),!0))};db.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=null,this.stateManager.destroy(),this._set("stateManager",
null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null)};db.castEnvironment=function(Fa){return Fa?Fa instanceof ka?Fa:Fa instanceof S?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Fa):ka.fromWebsceneEnvironment(Fa):c.ensureType(ka,Fa):new ka};db.on=function(Fa,La,$a,eb){return($a=
this.viewEvents.on(Fa,La,$a,eb))?$a:bb.prototype.on.call(this,Fa,La)};db.hasEventListener=function(Fa){return bb.prototype.hasEventListener.call(this,Fa)||this.viewEvents.hasHandler(Fa)};db.toMap=function(Fa,La){if(!this.ready)return Ma.error("#toMap()","Scene view cannot be used before it is ready"),null;La=La?this.externalToInternalIntersectOptions(La):this._defaultToMapOptions;var $a=f.isSome(La.graphics)&&(f.isSome(La.graphics.include)||f.isSome(La.graphics.exclude));Fa=fa.isSupportedScreenPointEvent(Fa)?
fa.createScreenPointFromSupportedEvent(this,Fa):Fa;Fa=B.screenPointObjectToArray(Fa);La.enableDraped=La.include&&!La.include.has(oa.TERRAIN_ID)||La.exclude&&La.exclude.has(oa.TERRAIN_ID);const eb=this.sceneIntersectionHelper,fb=new qa.Intersector(this.state.mode);fb.options.selectionMode=!0;fb.options.store=$a?2:0;eb.intersectIntersectorScreen(Fa,fb,La);if($a){for(const hb of fb.results.all)if($a=hb.toGraphic(this),f.isNone($a)||this._testGraphicUidFilter(La.graphics,$a))return this._intersectResultToMapPoint(hb);
return null}return this._intersectResultToMapPoint(fb.results.min)};db.toScreen=function(Fa){if(!this.ready)return Ma.error("#toScreen()","Scene view cannot be used before it is ready"),null;const La=f.unwrapOr(null==Fa.z&&O.getElevationAtPoint(this.elevationProvider,Fa),0);X.projectPointToVector(Fa,Qa,this.renderSpatialReference,La);this.state.camera.projectToScreen(Qa,Wa);return B.createScreenPoint(Wa[0],Wa[1])};db.pixelSizeAt=function(Fa){if(!this.ready)return Ma.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if(!Fa)return 0;X.projectPointToVector(Fa,Qa,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Qa)};db.overlayPixelSizeInMapUnits=function(Fa){const La=this.basemapTerrain.overlayManager;return La?La.overlayPixelSizeInMapUnits(Fa):1};db.hitTest=function(Fa,La){if(!this.ready)return Ma.error("#hitTest()","Scene view cannot be used before it is ready"),null;Fa=fa.isSupportedScreenPointEvent(Fa)?fa.createScreenPointFromSupportedEvent(this,Fa):Fa;var $a=B.createScreenPointArray(Fa.x,
Fa.y),eb=La?this.externalToInternalIntersectOptions(La):this._defaultHitTestOptions;eb.requiresGroundFeedback=!0;eb.enableDraped=!0;La=new qa.Intersector(this.state.mode);La.options.selectionMode=!0;La.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen($a,La,eb);$a=this._intersectResultsToHits(La.results.all,eb.graphics);eb=La.results.ground;var fb=eb.toOwner(this);fb=f.isSome(fb)&&"type"in fb&&"integrated-mesh"===fb.type?fb:null;Fa={screenPoint:Fa,results:$a,ground:{mapPoint:this._intersectResultToMapPoint(eb),
distance:eb.hasIntersectionPoint?eb.distanceInRenderSpace:0,layer:fb}};Ja.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Fa.intersector=La);return Promise.resolve(Fa)};db.popupHitTest=function(Fa){return Ta.hitTestSelectSameDistance(this,Fa).then(({results:La,ground:$a})=>{let eb=null;!(0===La.length||1E-5>Math.abs(La[0].distance-$a.distance))||$a.layer&&"integrated-mesh"===$a.layer.type||(eb=$a.mapPoint);return{results:La,screenPoint:Fa,mapPoint:eb}})};db.goTo=function(Fa,La){return this.updatingHandles.addPromise(this.stateManager.goTo(Fa,
La))};db.whenLayerView=function(Fa){return bb.prototype.whenLayerView.call(this,Fa)};db.getAnalysisView=function(Fa){return bb.prototype.getAnalysisView.call(this,Fa)};db.whenAnalysisView=function(Fa){return bb.prototype.whenAnalysisView.call(this,Fa)};db.takeScreenshot=function(Fa){return this.whenReady().then(()=>{const La=T.toRenderSettings(Fa,this);La.pixelRatio/=this.pixelRatio;return this._stage.renderView.takeScreenshot(T.screenshotSuperSampleSettings(La,this.supersampleScreenhotsEnabled,this.padding))})};
db.addUpdatingPromise=function(Fa){return this.updatingHandles.addPromise(Fa)};db.importLayerView=function(Fa){return Z.layerView3DImporter.importLayerView(Fa)};db.hasLayerViewModule=function(Fa){return Z.layerView3DImporter.hasLayerViewModule(Fa)};db.createAnalysisView=async function(Fa){return Ca.analysisViewFactory(this,Fa)};db.createAnalysisController=async function(Fa){return Ca.analysisControllerFactory(this,Fa)};db.forceDOMReadyCycle=function(){this.forceReadyCycle()};db.getDefaultSpatialReference=
function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};db.validate=async function(){let Fa=ea.check();p("safari")&&9>p("safari")&&(Fa=new u("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:p("safari")}));if(f.isSome(Fa))throw Ma.warn("#validate()",
Fa.message),Fa;};db.isSpatialReferenceSupported=function(Fa,La,$a){var eb=Fa.isGeographic;const fb=Fa.isWebMercator,hb=aa.isSpatialReferenceSupported(Fa,"global"),jb="local"===this.viewingMode,sb=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(sb){if(jb&&eb)return $a?$a(`Layer ${La.id} is ignored because it is GCS and viewing mode is local`):Ma.warnOnce("Geographic coordinate systems are not supported in local viewing mode."),!1;if(!jb&&!hb)return $a?$a(`Layer ${La.id} is ignored because its spatial reference is not supported in global viewing mode`):
Ma.warnOnce("Spatial reference defined on view not supported in global viewing mode."),!1}else if(eb&&!hb)return $a?$a(`Layer ${La.id} is ignored because its spatial reference is geographic but unsupported`):Ma.warnOnce("Spatial reference is geographic but not supported."),!1;if(La)if(Y.isTiledLayer(La)){if(sb?Fa=null!=Ba.getTiledLayerInfo(La,Fa,M.viewingModeFromString(this.viewingMode)).tileInfo:(eb=Ba.getTiledLayerInfo(La,Fa,1),null==eb.tileInfo&&(eb=Ba.getTiledLayerInfo(La,Fa,2),null!=eb.tileInfo&&
fb&&!this.ready&&(this.viewingMode="local")),Fa=null!=eb.tileInfo),!Fa)return $a&&$a(`Layer ${La.id} is ignored because it is tiled but
            its tiling scheme is not supported or compatible with the viewing mode`),!1}else if((Fa.isWGS84||fb)&&!jb)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=Fa),sb||this.ready||(this.viewingMode="global",$a&&$a(`Viewing mode locked to global due to reprojectable layer ${La.id}`)),$a&&$a(`Layer ${La.id} is ignored because it supports server-side reprojection`),!1;return!0};db.whenReady=function(){return new Promise(Fa=>{this.ready?Fa(this):this._resolveWhenReady.push(Fa)})};
db.computeMapPointFromVec3d=function(Fa,La){let $a=this.spatialReference||z.WGS84;X.projectVectorToVector(Fa,this.renderSpatialReference,Fa,$a)||($a=z.WGS84,X.projectVectorToVector(Fa,this.renderSpatialReference,Fa,$a));La?(La.x=Fa[0],La.y=Fa[1],La.z=Fa[2],La.spatialReference=$a):La=new C(Fa,$a);return La};db.trackGraphicState=function(Fa){if(!Fa.graphic)return Ma.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const La=this.getViewForGraphic(Fa.graphic);
let $a=null,eb=!1;const fb=hb=>{!eb&&f.isSome(hb)&&"graphics3d"in hb&&hb.graphics3d&&hb.graphics3d.graphicsCore&&($a=hb.graphics3d.graphicsCore.trackGraphicState(Fa))};f.isSome(La)?fb(La):this.whenViewForGraphic(Fa.graphic,{waitForLayer:!0}).then(hb=>fb(hb),()=>{}).catch(()=>{});return{remove:()=>{eb=!0;f.isSome($a)&&($a.remove(),$a=null)}}};db.highlight=function(Fa){if(Array.isArray(Fa))return d.handlesGroup(Fa.map($a=>this.highlight($a)));if(m.isCollection(Fa))return d.handlesGroup(Fa.toArray().map($a=>
this.highlight($a)));const La=this.getViewForGraphic(Fa);return La&&"highlight"in La?La.highlight(Fa):d.makeHandle()};db.maskOccludee=function(Fa){if(!Fa)return Ma.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const La=this.getViewForGraphic(Fa);let $a=null,eb=!1;const fb=hb=>{!eb&&f.isSome(hb)&&"graphics3d"in hb&&N.occludeesSupported(hb)&&($a=hb.maskOccludee(Fa))};f.isSome(La)?fb(La):this.whenViewForGraphic(Fa,{waitForLayer:!0}).then(hb=>fb(hb),
()=>{}).catch(()=>{});return{remove:()=>{eb=!0;f.isSome($a)&&($a.remove(),$a=null)}}};db.getViewForGraphic=function(Fa){return Fa.layer===this.graphics?this.graphicsView:Fa.layer?this.allLayerViews.find(La=>La.layer===Fa.layer):null};db.graphicChanged=function(Fa){f.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Fa)};db.whenViewForGraphic=async function(Fa,La){if(Fa.layer===this)return await L.whenOnce(this,"graphicsView"),this.graphicsView;if(!Fa.layer||!this.map)throw new u("no-view-for-graphic");
return La&&La.waitForLayer&&!this.map.allLayers.includes(Fa.layer)?new Promise(($a,eb)=>{const fb=this.map.allLayers.on("change",hb=>{-1!==hb.added.indexOf(Fa.layer)&&(fb.remove(),this.whenLayerView(Fa.layer).then($a,eb))})}):this.whenLayerView(Fa.layer)};db.externalToInternalIntersectOptions=function(Fa){const La=this._externalToInternalRenderItems(Fa.include,0);Fa=this._externalToInternalRenderItems(Fa.exclude,1);return{include:La.layerUids,exclude:Fa.layerUids,graphics:{include:La.graphicUids,
exclude:Fa.graphicUids}}};db._intersectResultToMapPoint=function(Fa,La){return Fa.getIntersectionPoint(Qa)?(La=this.computeMapPointFromVec3d(Qa,La),"TerrainRenderer"===Fa.intersector&&this.basemapTerrain&&(La.z=f.unwrapOr(O.getElevationAtPoint(this.basemapTerrain,La),0)),La):null};db._intersectResultsToHits=function(Fa,La){const $a=[];let eb=null;for(let jb=0;jb<Fa.length;jb++){const sb=Fa[jb];var fb=sb.toOwner(this);if(f.isSome(fb)&&(fb===this.map.ground||"type"in fb&&"integrated-mesh"===fb.type))break;
fb=sb.toGraphic(this);if(f.isSome(fb)){f.isNone(eb)&&jb!==Fa.length-1&&(eb=new Set);if(f.isSome(eb)){var hb=this._getGraphicFilterUid(fb);if(eb.has(hb))continue;eb.add(hb)}this._testGraphicUidFilter(La,fb)&&(hb=this._intersectResultToMapPoint(sb),$a.push({graphic:fb,mapPoint:hb,distance:sb.distanceInRenderSpace}))}}return $a};db._getGraphicFilterUid=function(Fa){if(Fa.layer&&"objectIdField"in Fa.layer){const La=Fa.attributes[Fa.layer.objectIdField];if(La)return`o-${Fa.layer.id}-${La}`}return`u-${Fa.uid}`};
db._testGraphicUidFilter=function(Fa,La){La=this._getGraphicFilterUid(La);return f.isNone(Fa)||(f.isNone(Fa.include)||Fa.include.has(La))&&(f.isNone(Fa.exclude)||!Fa.exclude.has(La))};db._externalToInternalRenderItems=function(Fa,La,$a={layerUids:null,graphicUids:null}){if(!Fa)return $a;Fa instanceof E?(Aa($a,this._getGraphicFilterUid(Fa)),0===La&&(f.isSome(this.graphicsView)&&Fa.layer===this?ra($a,this.graphicsView.graphics3d.layer.id):Fa.layer&&ra($a,Fa.layer.uid))):"forEach"in Fa?Fa.forEach(eb=>
{Array.isArray(eb)?this._externalToInternalRenderItems(eb,La,$a):m.isCollection(eb)?eb===this.graphics&&f.isSome(this.graphicsView)?ra($a,this.graphicsView.graphics3d.layer.id):this._externalToInternalRenderItems(eb,La,$a):eb instanceof I?eb===this.map.ground&&ra($a,oa.TERRAIN_ID):this._externalToInternalRenderItems(eb,La,$a)}):ra($a,Fa.uid);return $a};db._viewingModeToManifold=function(Fa){switch(Fa){case 1:return"spherical";case 2:return"planar"}};db._initBasemapTerrain=function(Fa){this._set("basemapTerrain",
new Ga({view:this,manifold:this._viewingModeToManifold(Fa)}));this._set("elevationProvider",new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};db._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};db._initGlobe=function(Fa){this._initCoordinateSystem(Fa);
this.state.init(Fa,this.spatialReference);this._initBasemapTerrain(Fa);this._set("pointsOfInterest",new Da["default"]({view:this}));this._set("featureTiles",new Va["default"]({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));Fa=()=>{var La=this.basemapTerrain&&this.basemapTerrain.extent;
this.clippingArea||La?La&&this.basemapTerrain.spatialReference?(La=Q.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.featureTiles.filterExtent=this.clippingArea?La.intersection(this.clippingArea):La):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(Ja,"FEATURE_TILE_TREE_SHOW_TILES",La=>{La&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise(function($a,
eb){a(["./3d/layers/support/FeatureTileTree3DDebugger"],$a,eb)})).then(({FeatureTileTree3DDebugger:$a})=>{!this.featureTreeDebugger&&Ja.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new $a({view:this}))}):La||!this.featureTreeDebugger||Ja.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",Fa,3),this.updatingHandles.add(this,"basemapTerrain.extent",Fa,3)],"feature-tiles");this.stateManager.init()};
db._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};db._initCoordinateSystem=function(Fa){if(this.spatialReference){var La=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(La)||
this._set("mapCoordsHelper",new cb.MapCoordsHelper(this.map,La));const $a=1===Fa;La=$a?K.getSphericalPCPF(La):La;La!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Xa.RenderCoordsHelper.createMode(Fa,La)),$a||this.handles.add(this.watch("basemapTerrain.extent",eb=>{if(0!==eb[0]||0!==eb[1]||0!==eb[2]||0!==eb[3])this.renderCoordsHelper.extent=eb},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(qa.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",
null),this._set("renderCoordsHelper",null)};db._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};db.updatingChanged=function(){this.notifyChange("updating")};db._updateUpdatingMonitors=function(Fa=null){f.isSome(Fa)&&4===Fa.type||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(La=>{La.destroyed||(this.handles.add([La.watch(["updating","updatingProgress"],()=>
this.updatingChanged(),!0)],"updatingMonitors"),La.when(()=>this.updatingChanged(),()=>this.updatingChanged()))}),this.updatingChanged())};db._renderScreenshotOverlay=function(Fa,La){if(this.overlay&&this.overlay.hasVisibleItems){var $a=Fa.getContext("2d");$a.putImageData(La,0,0);this.overlay.renderCanvas(Fa);Fa=$a.getImageData(0,0,La.width,La.height);for($a=0;$a<Fa.data.length;$a++)La.data[$a]=Fa.data[$a]}};db._initStage=function(Fa){const La={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,
debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:Fa,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(fb,hb)=>this._renderScreenshotOverlay(fb,hb)}},$a=new Pa.SceneIntersectionHelper(Fa,{forEachLayer:fb=>this._stage.layers.forAll(fb)},this);this._set("sceneIntersectionHelper",$a);const eb=R.byId(this.surface);this._stage=new Sa.Stage({scheduler:this.resourceController.scheduler,viewingMode:Fa,container:eb,options:La,sceneIntersectionHelper:$a});this._lostWebGLContextHandle=
w.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new u("webgl-context-lost"));this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})},2),this.updatingHandles.add(this.qualitySettings,"highQualityTransparency",()=>{this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})},2),
L.init(this,"magnifier",fb=>this._stage.renderView.magnifier=fb,!0)],"stage");Fa=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:ab.toEngineOptions(this.highlightOptions)})};for(const fb of"highlightOptions highlightOptions.color highlightOptions.haloColor highlightOptions.haloOpacity highlightOptions.fillOpacity highlightOptions.shadowOpacity highlightOptions.shadowColor highlightOptions.shadowDifference".split(" "))this.handles.add(this.updatingHandles.add(this,fb,Fa),"stage");
Fa();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(qa.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};db._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};db._initSurface=function(Fa){this._exitSurface();this._initStage(Fa);this._initGlobe(Fa);
this.sharedSymbolResources=new za.SharedSymbolResources({view:this,viewingMode:Fa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Oa.ObjectResourceCache})};db._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};db._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&
!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=y.createAbortController();var Fa=()=>{this._createGraphicsViewController=null;this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Fa,Fa);this.updatingChanged()}};db._createGraphicsViewAsync=async function(Fa){const La=(await new Promise(function($a,eb){a(["./3d/layers/GraphicsView3D"],function(fb){$a(Object.freeze({__proto__:null,
"default":fb}))},eb)})).default;y.throwIfAborted(Fa);await L.whenTrueOnce(this.basemapTerrain,"ready",Fa);this._set("graphicsView",new La({view:this}))};db._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");f.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.graphics3d.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};db._startup=
function(){var Fa=M.viewingModeFromString(this.viewingMode);1===Fa&&(this._clippingArea=null);this._set("ready",!0);this._initSurface(Fa);this.handles.add(L.on(this,"graphics","after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Fa=this.get("map.initialViewProperties.environment"))&&(this.environment=Fa);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Fa=this._resolveWhenReady;
this._resolveWhenReady=[];Fa.forEach(La=>La(this))};db._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};db._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(oa.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===
Fa.type&&this._defaultToMapOptions.include.add(Fa.uid)}};db._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(oa.TERRAIN_ID);for(const Fa of this.map.allLayers.items)"integrated-mesh"===Fa.type&&1>Fa.opacity&&this._defaultToMapOptions.exclude.add(Fa.uid)}};g._createClass(ib,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},
{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Fa=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!Fa)return this._clippingArea=null;if(!(Fa instanceof A))return Ma.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!r.canProject(Fa.spatialReference,
this.spatialReference))return Ma.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Fa=r.project(Fa,this.spatialReference)}return this._clippingArea&&Fa&&this._clippingArea.equals(Fa)?this._clippingArea:this._clippingArea=Fa},set:function(Fa){this.ready&&"global"===this.viewingMode&&Fa?Ma.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=Fa,this.notifyChange("clippingArea"))}},{key:"dataExtent",
get:function(){const Fa=this.spatialReference||z.WGS84;let La,$a=this.clippingArea;$a&&($a=r.project($a,Fa));const eb=hb=>{if(hb=r.project(hb,Fa)){if($a&&(hb=hb.intersection($a),!hb))return;f.isSome(La)?La.union(hb):La=hb}},fb=this.basemapTerrain;fb&&fb.spatialReference&&eb(new A({xmin:fb.extent[0],ymin:fb.extent[1],zmin:0,xmax:fb.extent[2],ymax:fb.extent[3],zmax:0,spatialReference:fb.spatialReference}));this.map&&this.map.allLayers.forEach(hb=>{!hb.fullExtent||"graphics"===hb.type&&hb.internal||
eb(hb.fullExtent)});if(f.isNone(La))return new A({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:Fa});La.hasZ?(La.zmin=Math.min(0,La.zmin),La.zmax=Math.max(0,La.zmax)):(La.zmin=0,La.zmax=0);return La}},{key:"environment",set:function(Fa){Fa!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Fa)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(Fa){f.isSome(Fa)?this._override("pixelRatio",
Fa):this._clearOverride("pixelRatio")}},{key:"maximumPixelRatio",get:function(){let Fa=Infinity;const {maximumPixelRatio:La,maximumRenderResolution:$a}=this.qualitySettings;null!=La&&(Fa=Math.min(Fa,La));null!=$a&&(Fa=Math.min(Fa,$a/Math.max(this.width,this.height)));return Fa},set:function(Fa){f.isSome(Fa)?this._override("maximumPixelRatio",Fa):this._clearOverride("maximumPixelRatio")}},{key:"groundExtent",get:function(){const Fa=this._get("basemapTerrain");if(Fa&&Fa.spatialReference){const La=Fa.extent;
return new A({xmin:La[0],ymin:La[1],xmax:La[2],ymax:La[3],spatialReference:Fa.spatialReference})}return new A({spatialReference:this.spatialReference||z.WGS84})}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"interacting",get:function(){return this.navigating||f.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(f.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||
Ya.getDefaultProfile()},set:function(Fa){Ya.isValidProfile(Fa)&&(Ya.apply(Fa,this.qualitySettings),this._set("qualityProfile",Fa))}},{key:"slicePlane",set:function(Fa){this._stage.renderView.setRenderParameters({slicePlane:Fa});if(f.isNone(Fa))this._set("slicePlane",null);else{var La=this.propertiesPool.get("slicePlane");na.boundedPlane.copy(Fa,La);this._set("slicePlane",La)}}},{key:"resolution",get:function(){return null!=this.spatialReference?W.getResolutionForScale(this.scale,this.spatialReference):
0}},{key:"heightModelInfo",get:function(){const Fa=this.getDefaultHeightModelInfo();return null!=Fa?P.deriveUnitFromSR(Fa,this.spatialReference):null}},{key:"updating",get:function(){var Fa,La,$a;let eb=0,fb=0,hb=!1;this.allLayerViews.forEach(jb=>{jb.isFulfilled()?jb.updating&&(hb=!0,jb.suspended||(++fb,eb="updatingProgress"in jb?eb+jb.updatingProgress:eb+.5)):++fb});for(const jb of[this.graphicsView,this.basemapView,this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage,this.featureTiles,
this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger])f.isSome(jb)&&jb.updating&&(fb+=.1,eb+=.05);for(const jb of[this.deconflictor,this.labeler])f.isSome(jb)&&jb.updating&&(++fb,eb+=jb.updatingProgress);(hb=!!(hb||0<fb||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Fa=this.inputManager)&&Fa.hasPendingInputs||null!=(La=this.map)&&null!=($a=La.allLayers)&&$a.some(jb=>!jb.isFulfilled())))?(this._numUpdating=Math.max(fb,
this._numUpdating),eb+=this._numUpdating-fb):this._numUpdating=0;eb=0<this._numUpdating?eb/this._numUpdating:hb?.5:1;this._get("updatingProgress")!==eb&&(Fa=this._resourceController.scheduler.now,1>eb&&(La=Math.min((Fa-this._lastUpdateTime)/2E3,1),eb=this.updatingProgress*(1-La)+eb*La),this._set("updatingProgress",eb),this._lastUpdateTime=hb&&1>eb?Fa:0);return hb}},{key:"viewingMode",get:function(){var Fa=this.get("map.initialViewProperties.viewingMode");if(Fa)return Fa;Fa=this.spatialReference;return!Fa||
aa.isSpatialReferenceSupported(Fa,"global")?"global":"local"},set:function(Fa){this.ready?Ma.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(Fa)?this._override("viewingMode",Fa):void 0===Fa&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new va(this)}}]);return ib}(U.BreakpointsOwner(ca.DOMContainer(ba.PopupView(ia))));b.__decorate([e.property()],
k.prototype,"_resourceController",void 0);b.__decorate([e.property()],k.prototype,"_stage",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"deconflictor",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"labeler",void 0);b.__decorate([e.property({type:ma,readOnly:!0,aliasOf:"state.animation"})],k.prototype,"animation",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"basemapTerrain",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"elevationProvider",
void 0);b.__decorate([e.property({type:G,aliasOf:"stateManager.camera"})],k.prototype,"camera",void 0);b.__decorate([e.property({type:G,aliasOf:"stateManager.contentCamera"})],k.prototype,"contentCamera",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"canvas",void 0);b.__decorate([e.property({type:C,aliasOf:"stateManager.center"})],k.prototype,"center",void 0);b.__decorate([e.property({type:A,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],k.prototype,"clippingArea",
null);b.__decorate([e.property({type:la["default"]})],k.prototype,"constraints",void 0);b.__decorate([e.property({type:A,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],k.prototype,"dataExtent",null);b.__decorate([e.property({value:null,type:ka})],k.prototype,"environment",null);b.__decorate([h.cast("environment")],k.prototype,"castEnvironment",null);b.__decorate([e.property({readOnly:!0})],k.prototype,"environmentManager",void 0);b.__decorate([e.property({type:A,aliasOf:"stateManager.extent"})],
k.prototype,"extent",void 0);b.__decorate([e.property()],k.prototype,"floors",void 0);b.__decorate([e.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],k.prototype,"screenCenter",void 0);b.__decorate([e.property({type:Number})],k.prototype,"pixelRatio",null);b.__decorate([e.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],k.prototype,"maximumPixelRatio",null);b.__decorate([e.property({aliasOf:"stateManager.frustum"})],
k.prototype,"frustum",void 0);b.__decorate([e.property({type:Number,readOnly:!0})],k.prototype,"fullOpacity",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"graphicsView",void 0);b.__decorate([e.property({type:A,dependsOn:["basemapTerrain.extent"],readOnly:!0})],k.prototype,"groundExtent",null);b.__decorate([e.property()],k.prototype,"groundView",void 0);b.__decorate([e.property({type:Boolean})],k.prototype,"initialExtentRequired",null);b.__decorate([e.property({type:Boolean,readOnly:!0})],
k.prototype,"interacting",null);b.__decorate([e.property()],k.prototype,"stationary",null);b.__decorate([e.property({aliasOf:"state.navigating"})],k.prototype,"navigating",void 0);b.__decorate([e.property()],k.prototype,"map",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"mapCoordsHelper",void 0);b.__decorate([e.property({aliasOf:"stateManager.padding"})],k.prototype,"padding",void 0);b.__decorate([e.property({type:Da["default"],readOnly:!0})],k.prototype,"pointsOfInterest",void 0);
b.__decorate([e.property({type:Va["default"],readOnly:!0})],k.prototype,"featureTiles",void 0);b.__decorate([e.property()],k.prototype,"featureTreeDebugger",void 0);b.__decorate([e.property({type:Boolean})],k.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([e.property({constructOnly:!0})],k.prototype,"deactivatedWebGLExtensions",void 0);b.__decorate([e.property({constructOnly:!0})],k.prototype,"debugWebGLExtensions",void 0);b.__decorate([e.property({constructOnly:!0})],k.prototype,"renderCanvas",
void 0);b.__decorate([e.property({constructOnly:!0})],k.prototype,"state",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"inputManager",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"stateManager",void 0);b.__decorate([e.property({type:["low","medium","high"]})],k.prototype,"qualityProfile",null);b.__decorate([e.property({type:lb,get(){let bb=this._get("qualitySettings");bb||(bb=new lb,Ya.apply(this.qualityProfile,bb));return bb}})],k.prototype,"qualitySettings",void 0);
b.__decorate([e.property()],k.prototype,"slicePlane",null);b.__decorate([e.property({dependsOn:["viewingMode"]})],k.prototype,"preconditionsReady",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"renderCoordsHelper",void 0);b.__decorate([e.property({readOnly:!0})],k.prototype,"sceneIntersectionHelper",void 0);b.__decorate([e.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],k.prototype,"resolution",null);b.__decorate([e.property({type:Number,aliasOf:"stateManager.scale"})],
k.prototype,"scale",void 0);b.__decorate([e.property({dependsOn:[]})],k.prototype,"heightModelInfo",null);b.__decorate([e.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],k.prototype,"spatialReference",void 0);b.__decorate([e.property({type:Boolean,constructOnly:!0})],k.prototype,"alphaCompositingEnabled",void 0);b.__decorate([e.property({type:Boolean})],k.prototype,"supersampleScreenhotsEnabled",void 0);b.__decorate([e.property({readOnly:!0})],
k.prototype,"type",void 0);b.__decorate([e.property({type:Ra})],k.prototype,"ui",void 0);b.__decorate([e.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs".split(" ")})],
k.prototype,"updating",null);b.__decorate([e.property({type:Number,readOnly:!0,dependsOn:["updating"]})],k.prototype,"updatingProgress",void 0);b.__decorate([e.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],k.prototype,"viewingMode",null);b.__decorate([e.property({type:J,aliasOf:"stateManager.viewpoint"})],k.prototype,"viewpoint",void 0);b.__decorate([e.property({type:Number,aliasOf:"stateManager.zoom"})],k.prototype,"zoom",void 0);b.__decorate([e.property({type:ab})],
k.prototype,"highlightOptions",void 0);k=b.__decorate([q.subclass("esri.views.SceneView")],k);const Qa=F.create(),Wa=B.createScreenPointArray();return k});