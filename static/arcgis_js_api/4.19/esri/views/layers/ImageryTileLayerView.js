// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Graphic ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(q,v,h,r,y,C,D,
l,E,z,n,F,G,H,A,t,B){r=f=>{f=function(w){function p(){var a=w.apply(this,arguments)||this;a._rasterFieldPrefix="Raster.";a.layer=null;a.view=null;a.fullExtent=null;a.tileInfo=null;a.datumTransformation=null;return a}v._inheritsLoose(p,w);var k=p.prototype;k.fetchPopupFeatures=async function(a,b){const {layer:c}=this;if(!a)return Promise.reject(new n("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:c}));var {popupEnabled:d}=c;b=B.getFetchPopupTemplate(c,b);if(!d||!y.isSome(b))throw new n("imageryTileLayerView:fetchPopupFeatures",
"Missing required popupTemplate or popupEnabled",{popupEnabled:d,popupTemplate:b});d=[];({value:a}=await c.identify(a));if(a){var e,m;const x=a.join(", ");a={ObjectId:0};a["Raster.ServicePixelValue"]=this._formatAttributeValue(x,"Raster.ServicePixelValue");if((b=null==(e=c.rasterInfo)?void 0:null==(m=e.attributeTable)?void 0:m.features)&&0<b.length&&(e=b.filter(u=>String(u.attributes.value||u.attributes.Value||u.attributes.VALUE)===x),0<e.length&&(e=e[0])))for(var g in e.attributes)e.attributes.hasOwnProperty(g)&&
(m=this._rasterFieldPrefix+g,a[m]=this._formatAttributeValue(e.attributes[g],m));g=new A(this.fullExtent.clone(),null,a);g.layer=c;g.sourceLayer=g.layer;d.push(g)}return d};k.updateFullExtent=function(){var a=this.layer.tileInfo;let b;a&&a.spatialReference||(b=new n("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));a=t.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!1);a=t.projectExtent(this.layer.fullExtent,
this.view.spatialReference,a);null==a&&(b=new n("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",a);this.datumTransformation||(this.datumTransformation=t.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0));return b?Promise.reject(b):Promise.resolve()};k._formatAttributeValue=function(a,b){if("string"===typeof a&&(b=(b=this._getFieldInfo(this.layer.popupTemplate&&
this.layer.popupTemplate.fieldInfos,b))&&b.format)){let c,d;return-1<a.trim().indexOf(",")?(c=",",d=c+" ",this._formatDelimitedString(a,c,d,b)):-1<a.trim().indexOf(" ")?(c=d=" ",this._formatDelimitedString(a,c,d,b)):this._formatNumberFromString(a,b)}return a};k._getFieldInfo=function(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;a.some(e=>!e.fieldName||e.fieldName.toLowerCase()!==c&&e.fieldName.toLowerCase()!==c.replace(/ /g,"_")?!1:(d=e,!0));return d}};k._formatDelimitedString=function(a,
b,c,d){return a&&b&&c&&d?a.trim().split(b).map(e=>this._formatNumberFromString(e,d)).join(c):a};k._formatNumberFromString=function(a,b){if(!a||!b)return a;const c=Number(a);return isNaN(c)?a:b.format(c)};v._createClass(p,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return p}(f);h.__decorate([l.property()],f.prototype,"layer",void 0);h.__decorate([l.property()],f.prototype,"view",void 0);
h.__decorate([l.property()],f.prototype,"fullExtent",void 0);h.__decorate([l.property()],f.prototype,"tileInfo",void 0);h.__decorate([l.property({readOnly:!0})],f.prototype,"hasTilingEffects",null);return f=h.__decorate([z.subclass("esri.views.layers.ImageryTileLayerView")],f)};q.ImageryTileLayerView=r;q.default=r;Object.defineProperty(q,"__esModule",{value:!0})});