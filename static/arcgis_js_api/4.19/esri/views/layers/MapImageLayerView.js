// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../layers/support/commonProperties ../../layers/support/ExportImageParameters ../../renderers/support/clickToleranceUtils ./support/popupUtils".split(" "),
function(n,t,e,p,u,I,J,h,K,B,C,L,M,N,D,E,F,G,H,v){p=d=>{d=function(q){function l(){return q.apply(this,arguments)||this}t._inheritsLoose(l,q);var k=l.prototype;k.initialize=function(){this.exportImageParameters=new G.ExportImageParameters({layer:this.layer})};k.destroy=function(){this.exportImageParameters.destroy();this.exportImageParameters=null};k.fetchPopupFeatures=async function(c,r){var {layer:f}=this;if(!c)return Promise.reject(new C("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",
{layer:f}));const w=this.get("view.scale"),x=[],y=async a=>{var b=0===a.minScale||w<=a.minScale;const g=0===a.maxScale||w>=a.maxScale;a.visible&&b&&g&&(a.sublayers?a.sublayers.forEach(y):a.popupEnabled&&(b=v.getFetchPopupTemplate(a,{...r,defaultPopupTemplateEnabled:!1}),u.isSome(b)&&x.unshift({sublayer:a,popupTemplate:b})))};f=f.sublayers.toArray().reverse().map(y);await Promise.all(f);f=x.map(async({sublayer:a,popupTemplate:b})=>{await a.load().catch(()=>{});const g=a.createQuery();var m=u.isSome(r)?
r.event:null;m=H.calculateTolerance({renderer:a.renderer,event:m});const z=this.createFetchPopupFeaturesQueryGeometry(c,m);g.geometry=z;g.outFields=await v.getRequiredFields(a,b);const A=await this._loadArcadeModules(b);A&&A.arcadeUtils.hasGeometryOperations(b)||(g.maxAllowableOffset=z.width/m);return(await a.queryFeatures(g)).features});return(await D.eachAlways(f)).reduce((a,b)=>b.value?[...a,...b.value]:a,[]).filter(a=>null!=a)};k.canResume=function(){var c;return!q.prototype.canResume.call(this)||
null!=(c=this.timeExtent)&&c.isEmpty?!1:!0};k._loadArcadeModules=function(c){if(c.get("expressionInfos.length"))return E.loadArcade()};t._createClass(l,[{key:"exportImageVersion",get:function(){var c;null==(c=this.exportImageParameters)?void 0:c.commitProperty("version");this.commitProperty("timeExtent");return(this._get("exportImageVersion")||0)+1}}]);return l}(d);e.__decorate([h.property()],d.prototype,"exportImageParameters",void 0);e.__decorate([h.property({readOnly:!0})],d.prototype,"exportImageVersion",
null);e.__decorate([h.property()],d.prototype,"layer",void 0);e.__decorate([h.property()],d.prototype,"suspended",void 0);e.__decorate([h.property(F.combinedViewLayerTimeExtentProperty)],d.prototype,"timeExtent",void 0);return d=e.__decorate([B.subclass("esri.views.layers.MapImageLayerView")],d)};n.MapImageLayerView=p;n.default=p;Object.defineProperty(n,"__esModule",{value:!0})});