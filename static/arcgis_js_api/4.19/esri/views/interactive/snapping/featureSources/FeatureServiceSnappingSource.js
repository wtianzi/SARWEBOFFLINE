// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/handleUtils ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/accessorSupport/trackingUtils ../../../../core/Accessor ../../../../geometry/Point ../../../../core/watchUtils ../../../support/debugFlags ../../../../core/HandleOwner ./queryEngineUtils ../../../2d/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiles2D ../../../3d/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiles3D ./WorkerTileTreeDebugger ./featureServiceSource/FeatureServiceSnappingSourceWorkerHandle ./featureServiceSource/FeatureServiceTilesSimple".split(" "),
function(b,k,c,D,h,E,F,l,d,G,n,H,I,J,p,q,r,t,u,v,w,x,y,z,A,B){b.FeatureServiceSnappingSource=function(m){function f(a){return m.call(this,a)||this}k._inheritsLoose(f,m);var g=f.prototype;g.initialize=function(){if(h.isSome(this.view))switch(this.view.type){case "2d":this.tilesOfInterest=new x.FeatureServiceTiles2D({view:this.view,layer:this.layer});break;case "3d":this.tilesOfInterest=new y.FeatureServiceTiles3D({view:this.view})}else this.tilesOfInterest=new B.FeatureServiceTilesSimple({layer:this.layer});
this.workerHandle=new A.FeatureServiceSnappingSourceWorkerHandle({scheduler:h.isSome(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null});this.handles.add([l.destroyHandle(this.workerHandle)]);this.workerHandle.setup({layer:this.layer,spatialReference:this.spatialReference,configuration:this.configuration},null);this.updatingHandles.add(this,"updateTilesParameters",()=>this.workerHandle.updateTiles(this.updateTilesParameters,null),2);this.handles.add([p.reaction(()=>this.configuration,
a=>this.workerHandle.configure(a,null))]);if(h.isSome(this.view)){const a=this.view;this.handles.add(t.init(u,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",e=>{e&&!this.debug?(this.debug=new z.WorkerTileTreeDebugger({view:a,handle:this.workerHandle}),this.handles.add(l.destroyHandle(this.debug),"debug")):!e&&this.debug&&this.handles.remove("debug")}))}this.handles.add(this.layerSource.layer.on("apply-edits",a=>{this.workerHandle.applyEdits(a,null)}))};g.refresh=function(){this.workerHandle.refresh(null)};
g.fetchCandidates=async function(a,e){this.tilesOfInterest.pointOfInterest=a.coordinateHelper.toPoint(a.point,new r);({candidates:e}=await this.workerHandle.fetchCandidates({...a,filter:null},e));return{candidates:e.map(C=>w.convertSnappingCandidate(C,a.coordinateHelper))}};g.getDebugInfo=function(a){return this.workerHandle.getDebugInfo(a)};k._createClass(f,[{key:"updateTilesParameters",get:function(){return{tiles:this.tilesOfInterest.tiles,tileInfo:this.tilesOfInterest.tileInfo,tileSize:this.tilesOfInterest.tileSize}}},
{key:"updating",get:function(){return this.workerHandle.updating||this.updatingHandles.updating}},{key:"configuration",get:function(){return{filter:this.layer.createQuery(),customParameters:this.layer.customParameters}}},{key:"availability",get:function(){return this.workerHandle.availability}},{key:"layer",get:function(){return this.layerSource.layer}}]);return f}(v.HandleOwnerMixin(q));c.__decorate([d.property({constructOnly:!0})],b.FeatureServiceSnappingSource.prototype,"spatialReference",void 0);
c.__decorate([d.property({constructOnly:!0})],b.FeatureServiceSnappingSource.prototype,"layerSource",void 0);c.__decorate([d.property({constructOnly:!0})],b.FeatureServiceSnappingSource.prototype,"view",void 0);c.__decorate([d.property()],b.FeatureServiceSnappingSource.prototype,"tilesOfInterest",void 0);c.__decorate([d.property({readOnly:!0})],b.FeatureServiceSnappingSource.prototype,"updateTilesParameters",null);c.__decorate([d.property({readOnly:!0})],b.FeatureServiceSnappingSource.prototype,"updating",
null);c.__decorate([d.property({readOnly:!0})],b.FeatureServiceSnappingSource.prototype,"configuration",null);c.__decorate([d.property({readOnly:!0})],b.FeatureServiceSnappingSource.prototype,"availability",null);b.FeatureServiceSnappingSource=c.__decorate([n.subclass("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],b.FeatureServiceSnappingSource);Object.defineProperty(b,"__esModule",{value:!0})});