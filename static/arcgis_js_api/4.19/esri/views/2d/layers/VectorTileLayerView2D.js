// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleLayer"],function(y){return function(){function F(h,q){this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;h.layers||(h.layers=[]);this.version=parseFloat(h.version);this.sprite=q?q.spriteUrl:h.sprite;this.glyphs=q?q.glyphsUrl:h.glyphs;if(this.layers=h.layers.map((u,e,b)=>this._create(u,e,b)))for(q=0;q<this.layers.length;q++)h=this.layers[q],this._layerByName[h.id.toLowerCase()]=
h,this._uidToLayer.set(h.uid,h),0===h.type&&this.backgroundBucketIds.push(h.id);this._identifyRefLayers()}var v=F.prototype;v.isPainterDataDriven=function(h){return(h=this._layerByName[h.toLowerCase()])?h.isPainterDataDriven():!1};v.getStyleLayerId=function(h){return h>=this.layers.length?null:this.layers[h].id};v.getStyleLayerByUID=function(h){h=this._uidToLayer.get(h);return null!=h?h:null};v.getStyleLayerIndex=function(h){return(h=this._layerByName[h.toLowerCase()])?this.layers.indexOf(h):-1};
v.setStyleLayer=function(h,q){if(h&&h.id){q&&q>=this.layers.length&&(q=this.layers.length-1);var u=!0,e;if(e=this._layerByName[h.id.toLowerCase()]){const b=this.layers.indexOf(e);q||(q=b);q===b?(u=!1,e=F._recreateLayer(h,e),this.layers[q]=e):(this.layers.splice(b,1),e=this._create(h,q,this.layers),this.layers.splice(q,0,e))}else e=this._create(h,q,this.layers),!q||q>=this.layers.length?this.layers.push(e):this.layers.splice(q,0,e);this._layerByName[h.id.toLowerCase()]=e;this._uidToLayer.set(e.uid,
e);u&&this._recomputeZValues();this._identifyRefLayers()}};v.getStyleLayer=function(h){return(h=this._layerByName[h.toLowerCase()])?{type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:h.layout,paint:h.paint}:null};v.deleteStyleLayer=function(h){const q=this._layerByName[h.toLowerCase()];q&&(delete this._layerByName[h.toLowerCase()],this._uidToLayer.delete(q.uid),h=this.layers.indexOf(q),this.layers.splice(h,1),this._recomputeZValues(),
this._identifyRefLayers())};v.getLayerById=function(h){return this._layerByName[h.toLowerCase()]};v.getLayoutProperties=function(h){return(h=this._layerByName[h.toLowerCase()])?h.layout:null};v.getPaintProperties=function(h){return(h=this._layerByName[h.toLowerCase()])?h.paint:null};v.setPaintProperties=function(h,q){h=this._layerByName[h.toLowerCase()];if(!h)return"";q=F._recreateLayer({type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,
layout:h.layout,paint:q},h);const u=this.layers.indexOf(h);this.layers[u]=q;this._layerByName[h.id.toLowerCase()]=q;this._uidToLayer.set(h.uid,q);return h.id};v.setLayoutProperties=function(h,q){h=this._layerByName[h.toLowerCase()];if(!h)return"";q=F._recreateLayer({type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:q,paint:h.paint},h);const u=this.layers.indexOf(h);this.layers[u]=q;this._layerByName[h.id.toLowerCase()]=
q;this._uidToLayer.set(h.uid,q);return h.id};v.setStyleLayerVisibility=function(h,q){if(h=this._layerByName[h.toLowerCase()]){var u=h.layout||{};u.visibility=q;q=F._recreateLayer({type:h.typeName,id:h.id,source:h.source,"source-layer":h.sourceLayer,minzoom:h.minzoom,maxzoom:h.maxzoom,filter:h.filter,layout:u,paint:h.paint},h);u=this.layers.indexOf(h);this.layers[u]=q;this._layerByName[h.id.toLowerCase()]=q;this._uidToLayer.set(h.uid,q)}};v.getStyleLayerVisibility=function(h){var q;h=this._layerByName[h.toLowerCase()];
if(!h)return"none";h=h.layout;return null!=(q=null==h?void 0:h.visibility)?q:"visible"};v._recomputeZValues=function(){const h=this.layers,q=1/(h.length+1);for(let u=0;u<h.length;u++)h[u].z=1-(1+u)*q};v._identifyRefLayers=function(){const h=[],q=[];let u=0;for(const d of this.layers){if(1===d.type){var e=d,b=d.source+"|"+d.sourceLayer;b+="|"+JSON.stringify(d.layout&&d.layout.visibility);b+="|"+JSON.stringify(d.minzoom);b+="|"+JSON.stringify(d.maxzoom);b+="|"+JSON.stringify(d.filter);if(e.hasDataDrivenFill||
e.hasDataDrivenOutline)b+="|"+JSON.stringify(u);h.push({key:b,layer:d})}2===d.type&&(e=d,b=d.source+"|"+d.sourceLayer,b+="|"+JSON.stringify(d.layout&&d.layout.visibility),b+="|"+JSON.stringify(d.minzoom),b+="|"+JSON.stringify(d.maxzoom),b+="|"+JSON.stringify(d.filter),b+="|"+JSON.stringify(d.layout&&d.layout["line-cap"]),b+="|"+JSON.stringify(d.layout&&d.layout["line-join"]),e.hasDataDrivenLine&&(b+="|"+JSON.stringify(u)),q.push({key:b,layer:d}));++u}this._assignRefLayers(h);this._assignRefLayers(q)};
v._assignRefLayers=function(h){h.sort((b,d)=>b.key<d.key?-1:b.key>d.key?1:0);let q,u;const e=h.length;for(let b=0;b<e;b++){const d=h[b];if(d.key===q)d.layer.refLayerId=u;else if(q=d.key,u=d.layer.id,1===d.layer.type&&!d.layer.getPaintProperty("fill-outline-color"))for(let a=b+1;a<e;a++){const c=h[a];if(c.key===q){if(c.layer.getPaintProperty("fill-outline-color")){h[b]=c;h[a]=d;u=c.layer.id;break}}else break}}};v._create=function(h,q,u){q=1-1/(u.length+1)*(1+q);u=this._runningId++;switch(h.type){case "background":return new y.BackgroundStyleLayer(0,
h,q,u);case "fill":return new y.FillStyleLayer(1,h,q,u);case "line":return new y.LineStyleLayer(2,h,q,u);case "symbol":return new y.SymbolStyleLayer(3,h,q,u);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new y.CircleStyleLayer(4,h,q,u)}throw Error("Unknown vector tile layer");};F._recreateLayer=function(h,q){switch(h.type){case "background":return new y.BackgroundStyleLayer(0,h,q.z,q.uid);case "fill":return new y.FillStyleLayer(1,h,q.z,q.uid);case "line":return new y.LineStyleLayer(2,
h,q.z,q.uid);case "symbol":return new y.SymbolStyleLayer(3,h,q.z,q.uid);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new y.CircleStyleLayer(4,h,q.z,q.uid)}};return F}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c){let l=function(){function E(r,C,H,K){this.type=r;this.typeName=C.type;this.id=C.id;this.source=C.source;this.sourceLayer=C["source-layer"];this.minzoom=C.minzoom;this.maxzoom=C.maxzoom;this.filter=C.filter;this.layout=C.layout;this.paint=C.paint;this.z=H;this.uid=K;switch(r){case 0:this._layoutDefinition=d.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=d.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=d.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=d.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=d.StyleDefinition.lineLayoutDefinition;this._paintDefinition=d.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=d.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=d.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=d.StyleDefinition.circleLayoutDefinition,this._paintDefinition=d.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}var z=E.prototype;z.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=b.createFilter(this.filter)};z.getLayoutProperty=function(r){return this._layoutProperties[r]};z.getPaintProperty=function(r){return this._paintProperties[r]};z.getLayoutValue=function(r,C,H){let K;const M=this._layoutProperties[r];M&&(K=M.getValue(C,H));void 0===K&&(K=this._layoutDefinition[r]["default"]);return K};z.getPaintValue=
function(r,C,H){let K;const M=this._paintProperties[r];M&&(K=M.getValue(C,H));void 0===K&&(K=this._paintDefinition[r]["default"]);return K};z.isPainterDataDriven=function(){const r=this._paintProperties;if(r)for(const C in r)if(r[C].isDataDriven)return!0;return!1};z._parseLayout=function(r){const C={};for(const H in r){const K=this._layoutDefinition[H];K&&(C[H]=new a(K,r[H]))}return C};z._parsePaint=function(r){const C={};for(const H in r){const K=this._paintDefinition[H];K&&(C[H]=new a(K,r[H]))}return C};
z.computeAttributesKey=function(r,C){let H=0,K=0;for(const M of C)C="icon-size"===M||"text-size"===M?this.getLayoutProperty(M):this.getPaintProperty(M),K|=(null!=C&&C.interpolator?2:null!=C&&C.isDataDriven?1:0)<<H,H+=2;return K<<3|r};return E}(),x=function(E){function z(r,C,H,K){r=E.call(this,r,C,H,K)||this;r.backgroundMaterial=new v.VTLBackgroundMaterial(r.computeAttributesKey(0,v.VTLBackgroundMaterial.ATTRIBUTES));return r}F._inheritsLoose(z,E);return z}(l),k=function(E){function z(r,C,H,K){r=E.call(this,
r,C,H,K)||this;C=r.getPaintProperty("fill-color");H=r.getPaintProperty("fill-opacity");K=r.getPaintProperty("fill-pattern");r.hasDataDrivenColor=null==C?void 0:C.isDataDriven;r.hasDataDrivenOpacity=null==H?void 0:H.isDataDriven;r.hasDataDrivenFill=r.hasDataDrivenColor||r.hasDataDrivenOpacity||(null==K?void 0:K.isDataDriven);H=r.getPaintProperty("fill-outline-color");r.outlineUsesFillColor=!H;r.hasDataDrivenOutlineColor=null==H?void 0:H.isDataDriven;r.hasDataDrivenOutline=H?H.isDataDriven:C?C.isDataDriven:
!1;r.hasDataDrivenOutline=(H?r.hasDataDrivenOutlineColor:r.hasDataDrivenColor)||r.hasDataDrivenOpacity;r.fillMaterial=new q.VTLFillMaterial(r.computeAttributesKey(1,q.VTLFillMaterial.ATTRIBUTES));r.outlineMaterial=new q.VTLOutlineMaterial(r.computeAttributesKey(2,r.outlineUsesFillColor?q.VTLOutlineMaterial.ATTRIBUTES_FILL:q.VTLOutlineMaterial.ATTRIBUTES_OUTLINE),r.outlineUsesFillColor);return r}F._inheritsLoose(z,E);return z}(l),g=function(E){function z(r,C,H,K){var M,L,I,Q,S,R,N;r=E.call(this,r,
C,H,K)||this;r.lineMaterial=new u.VTLLineMaterial(r.computeAttributesKey(3,u.VTLLineMaterial.ATTRIBUTES));r.hasDataDrivenLine=(null==(M=r.getPaintProperty("line-blur"))?void 0:M.isDataDriven)||(null==(L=r.getPaintProperty("line-color"))?void 0:L.isDataDriven)||(null==(I=r.getPaintProperty("line-gap-width"))?void 0:I.isDataDriven)||(null==(Q=r.getPaintProperty("line-offset"))?void 0:Q.isDataDriven)||(null==(S=r.getPaintProperty("line-opacity"))?void 0:S.isDataDriven)||(null==(R=r.getPaintProperty("line-pattern"))?
void 0:R.isDataDriven)||(null==(N=r.getPaintProperty("line-width"))?void 0:N.isDataDriven);C=C.paint["line-width"];C||(C=d.StyleDefinition.linePaintDefinition["line-width"].default);M=r.getPaintProperty("line-width");r.isThinLine=!(null!=M&&M.isDataDriven)&&"number"===typeof C&&C<c.THIN_LINE_THRESHOLD;return r}F._inheritsLoose(z,E);return z}(l),t=function(E){function z(r,C,H,K){var M,L,I,Q,S,R,N,G,O,P,U,Y;r=E.call(this,r,C,H,K)||this;r.iconMaterial=new e.VTLIconMaterial(r.computeAttributesKey(4,e.VTLIconMaterial.ATTRIBUTES));
r.textMaterial=new e.VTLTextMaterial(r.computeAttributesKey(6,e.VTLTextMaterial.ATTRIBUTES));r.hasDataDrivenIcon=(null==(M=r.getPaintProperty("icon-color"))?void 0:M.isDataDriven)||(null==(L=r.getPaintProperty("icon-halo-blur"))?void 0:L.isDataDriven)||(null==(I=r.getPaintProperty("icon-halo-color"))?void 0:I.isDataDriven)||(null==(Q=r.getPaintProperty("icon-halo-width"))?void 0:Q.isDataDriven)||(null==(S=r.getPaintProperty("icon-opacity"))?void 0:S.isDataDriven)||(null==(R=r.getLayoutProperty("icon-size"))?
void 0:R.isDataDriven);r.hasDataDrivenText=(null==(N=r.getPaintProperty("text-color"))?void 0:N.isDataDriven)||(null==(G=r.getPaintProperty("text-halo-blur"))?void 0:G.isDataDriven)||(null==(O=r.getPaintProperty("text-halo-color"))?void 0:O.isDataDriven)||(null==(P=r.getPaintProperty("text-halo-width"))?void 0:P.isDataDriven)||(null==(U=r.getPaintProperty("text-opacity"))?void 0:U.isDataDriven)||(null==(Y=r.getLayoutProperty("text-size"))?void 0:Y.isDataDriven);return r}F._inheritsLoose(z,E);return z}(l),
m=function(E){function z(r,C,H,K){r=E.call(this,r,C,H,K)||this;r.circleMaterial=new h.VTLCircleMaterial(r.computeAttributesKey(5,h.VTLCircleMaterial.ATTRIBUTES));return r}F._inheritsLoose(z,E);return z}(l),n=function(){function E(z,r,C){var H,K,M,L,I;this.allowOverlap=z.getLayoutValue("icon-allow-overlap",r);this.ignorePlacement=z.getLayoutValue("icon-ignore-placement",r);this.keepUpright=z.getLayoutValue("icon-keep-upright",r);this.optional=z.getLayoutValue("icon-optional",r);this.rotationAlignment=
z.getLayoutValue("icon-rotation-alignment",r);2===this.rotationAlignment&&(this.rotationAlignment=C?0:1);C=z.getLayoutProperty("icon-anchor");null!=(H=C)&&H.isDataDriven?this._anchorProp=C:this.anchor=z.getLayoutValue("icon-anchor",r);C=z.getLayoutProperty("icon-offset");null!=(K=C)&&K.isDataDriven?this._offsetProp=C:this.offset=z.getLayoutValue("icon-offset",r);C=z.getLayoutProperty("icon-padding");null!=(M=C)&&M.isDataDriven?this._paddingProp=C:this.padding=z.getLayoutValue("icon-padding",r);C=
z.getLayoutProperty("icon-rotate");null!=(L=C)&&L.isDataDriven?this._rotateProp=C:this.rotate=z.getLayoutValue("icon-rotate",r);C=z.getLayoutProperty("icon-size");null!=(I=C)&&I.isDataDriven?this._sizeProp=C:this.size=z.getLayoutValue("icon-size",r)}E.prototype.update=function(z,r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(z,r));this._offsetProp&&(this.offset=this._offsetProp.getValue(z,r));this._paddingProp&&(this.padding=this._paddingProp.getValue(z,r));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(z,r));this._sizeProp&&(this.size=this._sizeProp.getValue(z,r))};return E}(),B=function(){function E(z,r,C){var H,K,M,L,I,Q,S,R,N,G,O;this.allowOverlap=z.getLayoutValue("text-allow-overlap",r);this.ignorePlacement=z.getLayoutValue("text-ignore-placement",r);this.keepUpright=z.getLayoutValue("text-keep-upright",r);this.optional=z.getLayoutValue("text-optional",r);this.rotationAlignment=z.getLayoutValue("text-rotation-alignment",r);2===this.rotationAlignment&&(this.rotationAlignment=
C?0:1);C=z.getLayoutProperty("text-anchor");null!=(H=C)&&H.isDataDriven?this._anchorProp=C:this.anchor=z.getLayoutValue("text-anchor",r);C=z.getLayoutProperty("text-justify");null!=(K=C)&&K.isDataDriven?this._justifyProp=C:this.justify=z.getLayoutValue("text-justify",r);C=z.getLayoutProperty("text-letter-spacing");null!=(M=C)&&M.isDataDriven?this._letterSpacingProp=C:this.letterSpacing=z.getLayoutValue("text-letter-spacing",r);C=z.getLayoutProperty("text-line-height");null!=(L=C)&&L.isDataDriven?
this._lineHeightProp=C:this.lineHeight=z.getLayoutValue("text-line-height",r);C=z.getLayoutProperty("text-max-angle");null!=(I=C)&&I.isDataDriven?this._maxAngleProp=C:this.maxAngle=z.getLayoutValue("text-max-angle",r);C=z.getLayoutProperty("text-max-width");null!=(Q=C)&&Q.isDataDriven?this._maxWidthProp=C:this.maxWidth=z.getLayoutValue("text-max-width",r);C=z.getLayoutProperty("text-offset");null!=(S=C)&&S.isDataDriven?this._offsetProp=C:this.offset=z.getLayoutValue("text-offset",r);C=z.getLayoutProperty("text-padding");
null!=(R=C)&&R.isDataDriven?this._paddingProp=C:this.padding=z.getLayoutValue("text-padding",r);C=z.getLayoutProperty("text-rotate");null!=(N=C)&&N.isDataDriven?this._rotateProp=C:this.rotate=z.getLayoutValue("text-rotate",r);C=z.getLayoutProperty("text-size");null!=(G=C)&&G.isDataDriven?this._sizeProp=C:this.size=z.getLayoutValue("text-size",r);C=z.getLayoutProperty("text-writing-mode");null!=(O=C)&&O.isDataDriven?this._writingModeProp=C:this.writingMode=z.getLayoutValue("text-writing-mode",r)}E.prototype.update=
function(z,r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(z,r));this._justifyProp&&(this.justify=this._justifyProp.getValue(z,r));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(z,r));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(z,r));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(z,r));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(z,r));this._offsetProp&&(this.offset=this._offsetProp.getValue(z,r));
this._paddingProp&&(this.padding=this._paddingProp.getValue(z,r));this._rotateProp&&(this.rotate=this._rotateProp.getValue(z,r));this._sizeProp&&(this.size=this._sizeProp.getValue(z,r));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(z,r))};return E}();y.BackgroundStyleLayer=x;y.CircleStyleLayer=m;y.FillStyleLayer=k;y.IconLayout=n;y.LineStyleLayer=g;y.StyleLayer=l;y.SymbolStyleLayer=t;y.TextLayout=B;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(y,F,v){v=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var u=q.prototype;u.geometryInfo=function(){return q.GEOMETRY_LAYOUT};u.opacityInfo=function(){return null};u.attributes=function(){return q.ATTRIBUTES};u.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(v.VTLMaterial);v.ATTRIBUTES=[];v.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}];
v.ATTRIBUTES_INFO={};y.VTLBackgroundMaterial=v;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec4f32","../MemoryBuffer"],function(y,F,v,h){let q=function(){function e(d){this._color=v.create();this._key=d}var b=e.prototype;b.defines=function(){return[]};b.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};
b.getAttributeLocations=function(){this._locations||this._buildAttributesInfo();return this._locations};b.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};b.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};b.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};b.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};
b.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain};b.setDataUniforms=function(d,a,c,l){const x=this.getUniforms();for(const k in x){const g=x[k];switch(g.type){case "float":d.setUniform1f(g.name,g.getValue(c,a,l));break;case "vec2":d.setUniform2fv(g.name,g.getValue(c,a,l));break;case "vec4":{const t=g.getValue(c,a,l),m=t[3];this._color[0]=m*t[0];this._color[1]=m*t[1];this._color[2]=m*t[2];this._color[3]=m;d.setUniform4fv(g.name,this._color)}}}};b.encodeAttributes=
function(d,a,c){const l=this.attributesInfo(),x=this.getEncodingInfos(),k=[];for(const m of Object.keys(x)){var g,t=x[m];const {type:n,precisionFactor:B,isLayout:E}=l[m],z=E?c.getLayoutProperty(m):c.getPaintProperty(m),r=null==(g=z.interpolator)?void 0:g.getInterpolationRange(a);let C=0;for(const H of t){H.dataIndex>=k.length&&k.push(0);t=z.getValue(r?r[C]:a,d);switch(n){case 0:k[H.dataIndex]|=this._encodeByte(t*(B||1),8*H.offset);break;case 1:k[H.dataIndex]|=this._encodeByte(t*(B||1)+128,8*H.offset);
break;case 2:k[H.dataIndex]=this._encodeColor(t);break;default:throw Error("Unsupported encoding type");}++C}}return k};b.getAtributeState=function(d){const a=3+2*d;d=0|this._bit(a);return d|=this._bit(a+1)<<1};b._buildAttributesInfo=function(){const d=[],a={};var c={},l=-1,x=this.attributesInfo(),k=this.attributes();let g=-1;for(const n of k){++g;k=this.getAtributeState(g);if(0===k)continue;var t=x[n];const B=[];a[n]=B;t=t.type;for(let E=0;E<k;++E){const {dataType:z,bytesPerElement:r,count:C,normalized:H}=
e._encodingInfo[t],K=z<<2|C;let M=c[K];M&&4!==M.offset||(++l,c[K]=M={dataIndex:l,offset:0},d.push({location:-1,name:"a_data_"+l,count:4/r,type:z,normalized:H}));B.push({dataIndex:M.dataIndex,offset:M.offset});M.offset+=r*C}}this._buildVertexBufferLayout(d);c={};l=0;x=this._layoutInfo.geometry;for(var m of x)c[m.name]=l++;if(m=this._layoutInfo.opacity)for(const n of m)c[n.name]=l++;this._buildShaderInfo(d,a);this._propertyEncodingInfo=a;this._locations=c};b._buildVertexBufferLayout=function(d){const a=
{};var c=this.geometryInfo();let l=c[0].stride;if(0===d.length)a.geometry=c;else{const x=[];let k=l;l+=4*d.length;for(const g of c)c={...g},c.stride=l,x.push(c);for(const g of d)x.push({name:g.name,count:g.count,type:g.type,offset:k,stride:l,normalized:g.normalized||!1,divisor:0}),k+=u(g.type)*g.count;a.geometry=x}this.opacityInfo()&&(a.opacity=this.opacityInfo());this._layoutInfo=a;this._stride=l};b._buildShaderInfo=function(d,a){let c="\n",l="\n";const x=[];for(var k of d)c+=`attribute ${this._getType(k.count)} ${k.name};\n`;
var g=this.attributes();d=this.attributesInfo();k=-1;for(const n of g){++k;const {name:B,type:E,precisionFactor:z,isLayout:r}=d[n];g=z&&1!==z?` * ${1/z}`:"";const {bytesPerElement:C,count:H}=e._encodingInfo[E];var t=K=>`a_data_${K.dataIndex}${2===E?"":`[${K.offset/C}]`}`;switch(this.getAtributeState(k)){case 0:g=this._getType(H);var m=`u_${B}`;x.push({name:m,type:g,getValue:(K,M)=>r?K.getLayoutValue(n,M):K.getPaintValue(n,M)});c+=`uniform ${g} ${m};\n`;l+=`${g} ${B} = ${m};\n`;break;case 1:m=t(a[n][0]);
l+=`${this._getType(H)} ${B} = ${m}${g};\n`;break;case 2:{m=`u_t_${B}`;x.push({name:m,type:"float",getValue:(M,L,I)=>(r?M.getLayoutProperty(n):M.getPaintProperty(n)).interpolator.interpolationUniformValue(I,L)});c+=`uniform float ${m};\n`;const K=t(a[n][0]);t=t(a[n][1]);l+=`${this._getType(H)} ${B} = mix(${K}${g}, ${t}${g}, ${m});\n`}}}this._shaderHeader=c;this._shaderMain=l;this._uniforms=x};b._bit=function(d){return(this._key&1<<d)>>d};b._getType=function(d){switch(d){case 1:return"float";case 2:return"vec2";
case 4:return"vec4"}throw Error("Invalid count");};b._encodeColor=function(d){const a=255*d[3];return h.i8888to32(d[0]*a,d[1]*a,d[2]*a,a)};b._encodeByte=function(d,a){return(d&255)<<a};F._createClass(e,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return e}();q._encodingInfo=[{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:4,normalized:!0}];const u=
e=>{switch(e){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1}};y.VTLMaterial=q;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(y){return function(){function F(h){this._array=[];0>=h&&console.error("strideInBytes must be positive!");this._stride=h}var v=F.prototype;v.reset=function(){this.array.length=
0};v.toBuffer=function(){return(new Uint32Array(this._array)).buffer};F.i1616to32=function(h,q){return 65535&h|q<<16};F.i8888to32=function(h,q,u,e){return h&255|(q&255)<<8|(u&255)<<16|e<<24};F.i8816to32=function(h,q,u){return h&255|(q&255)<<8|u<<16};y._createClass(F,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}}]);
return F}()})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(y,F,v){v=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var u=q.prototype;u.geometryInfo=function(){return q.GEOMETRY_LAYOUT};u.opacityInfo=function(){return null};u.attributes=function(){return q.ATTRIBUTES};u.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(v.VTLMaterial);v.ATTRIBUTES=
"circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");v.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];v.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:0},"circle-color":{name:"color",type:2},"circle-opacity":{name:"opacity",type:0,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:0,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:2},"circle-stroke-opacity":{name:"stroke_opacity",
type:0,precisionFactor:100},"circle-blur":{name:"blur",type:0,precisionFactor:32}};y.VTLCircleMaterial=v;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(y,F,v){let h=function(q){function u(b){return q.call(this,b)||this}F._inheritsLoose(u,q);var e=u.prototype;e.geometryInfo=function(){return u.GEOMETRY_LAYOUT};e.opacityInfo=function(){return null};
e.attributes=function(){return u.ATTRIBUTES};e.attributesInfo=function(){return u.ATTRIBUTES_INFO};return u}(v.VTLMaterial);h.ATTRIBUTES=["fill-color","fill-opacity"];h.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}];h.ATTRIBUTES_INFO={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};v=function(q){function u(b,d){b=q.call(this,b)||this;b.usefillColor=d;return b}F._inheritsLoose(u,q);var e=u.prototype;e.geometryInfo=
function(){return u.GEOMETRY_LAYOUT};e.opacityInfo=function(){return null};e.attributes=function(){return this.usefillColor?u.ATTRIBUTES_FILL:u.ATTRIBUTES_OUTLINE};e.attributesInfo=function(){return this.usefillColor?u.ATTRIBUTES_INFO_FILL:u.ATTRIBUTES_INFO_OUTLINE};return u}(v.VTLMaterial);v.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];v.ATTRIBUTES_FILL=["fill-color","fill-opacity"];v.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",
count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}];v.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};v.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};y.VTLFillMaterial=h;y.VTLOutlineMaterial=v;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(y,F,v){v=function(h){function q(e){return h.call(this,e)||this}F._inheritsLoose(q,h);var u=q.prototype;u.geometryInfo=function(){return q.GEOMETRY_LAYOUT};u.opacityInfo=function(){return null};u.attributes=function(){return q.ATTRIBUTES};u.attributesInfo=function(){return q.ATTRIBUTES_INFO};return q}(v.VTLMaterial);v.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width".split(" ");v.GEOMETRY_LAYOUT=
[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}];v.ATTRIBUTES_INFO={"line-width":{name:"width",type:0,precisionFactor:2},"line-gap-width":{name:"gap_width",type:0,precisionFactor:2},"line-offset":{name:"offset",type:1,precisionFactor:2},"line-color":{name:"color",type:2},"line-opacity":{name:"opacity",
type:0,precisionFactor:100},"line-blur":{name:"blur",type:0,precisionFactor:4}};y.VTLLineMaterial=v;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial"],function(y,F,v){const h=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",
count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],q=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];let u=function(e){function b(a){return e.call(this,a)||this}F._inheritsLoose(b,e);var d=b.prototype;d.geometryInfo=function(){return h};d.opacityInfo=function(){return q};d.attributes=function(){return b.ATTRIBUTES};d.attributesInfo=function(){return b.ATTRIBUTES_INFO};
return b}(v.VTLMaterial);u.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");u.ATTRIBUTES_INFO={"icon-color":{name:"color",type:2},"icon-opacity":{name:"opacity",type:0,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:2},"icon-halo-width":{name:"halo_width",type:0,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"icon-size":{name:"size",type:0,precisionFactor:32,isLayout:!0}};v=function(e){function b(a){return e.call(this,
a)||this}F._inheritsLoose(b,e);var d=b.prototype;d.geometryInfo=function(){return h};d.opacityInfo=function(){return q};d.attributes=function(){return b.ATTRIBUTES};d.attributesInfo=function(){return b.ATTRIBUTES_INFO};return b}(v.VTLMaterial);v.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");v.ATTRIBUTES_INFO={"text-color":{name:"color",type:2},"text-opacity":{name:"opacity",type:0,precisionFactor:100},"text-halo-color":{name:"halo_color",
type:2},"text-halo-width":{name:"halo_width",type:0,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"text-size":{name:"size",type:0,isLayout:!0}};y.VTLIconMaterial=u;y.VTLTextMaterial=v;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/types","../expression/expression"],function(y,F){return function(){function v(h){this._expression=h}v.prototype.filter=function(h,q){if(!this._expression)return!0;
try{return this._expression.evaluate(h,q)}catch(u){return console.log(u.message),!0}};v.createFilter=function(h){if(!h)return null;this.isLegacyFilter(h)&&(h=this.convertLegacyFilter(h));try{const q=F.createExpression(h,null,y.BooleanType);return new v(q)}catch(q){return console.log(q.message),null}};v.isLegacyFilter=function(h){if(!Array.isArray(h)||0===h.length)return!0;switch(h[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===h.length&&"string"===
typeof h[1]&&!Array.isArray(h[2]);case "in":return 3<=h.length&&"string"===typeof h[1]&&!Array.isArray(h[2]);case "!in":return!0;case "any":case "all":for(let q=1;q<h.length;q++)if(!this.isLegacyFilter(h[1]))return!1;return!0;case "none":return!0;case "has":return 2===h.length&&("$id"===h[1]||"$type"===h[1]);case "!has":return!0;default:return!1}};v.convertLegacyFilter=function(h){if(!Array.isArray(h)||0===h.length)return!0;const q=h[0];if(1===h.length)return"any"!==q;switch(q){case "\x3d\x3d":return v.convertComparison("\x3d\x3d",
h[1],h[2]);case "!\x3d":return v.negate(v.convertComparison("\x3d\x3d",h[1],h[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return v.convertComparison(q,h[1],h[2]);case "in":return v.convertIn(h[1],h.slice(2));case "!in":return v.negate(v.convertIn(h[1],h.slice(2)));case "any":case "all":case "none":return v.convertCombining(q,h.slice(1));case "has":return v.convertHas(h[1]);case "!has":return v.negate(v.convertHas(h[1]));default:throw Error("Unexpected legacy filter.");}};v.convertComparison=
function(h,q,u){switch(q){case "$type":return[h,["geometry-type"],u];case "$id":return[h,["id"],u];default:return[h,["get",q],u]}};v.convertIn=function(h,q){switch(h){case "$type":return["in",["geometry-type"],["literal",q]];case "$id":return["in",["id"],["literal",q]];default:return["in",["get",h],["literal",q]]}};v.convertHas=function(h){switch(h){case "$type":return!0;case "$id":return["has-id"];default:return["has",h]}};v.convertCombining=function(h,q){return[h].concat(q.map(this.convertLegacyFilter))};
v.negate=function(h){return["!",h]};return v}()})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(y,F){function v(g,t){return{kind:"array",itemType:g,n:t}}function h(g){if("array"===g.kind){const t=h(g.itemType);return"number"===typeof g.n?`array<${t}, ${g.n}>`:"value"===g.itemType.kind?"array":`array<${t}>`}return g.kind}function q(g){if(null===g)return e;if("string"===typeof g)return d;if("boolean"===typeof g)return a;if("number"===
typeof g)return b;if(g instanceof F)return c;if(Array.isArray(g)){let t;for(const m of g){const n=q(m);if(!t)t=n;else if(t!==n){t=x;break}}return v(t||x,g.length)}return"object"===typeof g?l:x}function u(g,t){if("array"===t.kind)return"array"===g.kind&&(0===g.n&&"value"===g.itemType.kind||u(g.itemType,t.itemType))&&("number"!==typeof t.n||t.n===g.n);if("value"===t.kind)for(const m of k)if(u(g,m))return!0;return t.kind===g.kind}const e={kind:"null"},b={kind:"number"},d={kind:"string"},a={kind:"boolean"},
c={kind:"color"},l={kind:"object"},x={kind:"value"},k=[e,b,d,a,c,l,v(x)];y.BooleanType=a;y.ColorType=c;y.NullType=e;y.NumberType=b;y.ObjectType=l;y.StringType=d;y.ValueType=x;y.arrayType=v;y.getType=q;y.matchType=u;y.typeToString=h;y.valueToString=function(g){if(null===g)return"";const t=typeof g;return"string"===t?g:"number"===t||"boolean"===t?String(g):g instanceof F?g.toString():JSON.stringify(g)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/colorUtils ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(y,F,v,h,q,u,e){function b(w,f,p){var A=typeof w;if("string"===A||"boolean"===A||"number"===A||null===w){if(p)switch(p.kind){case "string":"string"!==A&&(w=da.toString(w));break;case "number":"number"!==A&&(w=da.toNumber(w));break;case "color":w=da.toColor(w)}w=["literal",w]}if(!Array.isArray(w)||0===w.length)throw Error("Expression must be a non empty array");A=w[0];if("string"!==typeof A)throw Error("First element of expression must be a string");const D=ia[A];if(void 0===D)throw Error(`Invalid expression operator "${A}"`);
if(!D)throw Error(`Unimplemented expression operator "${A}"`);return D.parse(w,f,p)}let d=function(){function w(p){this.parent=p;this.vars={}}var f=w.prototype;f.add=function(p,A){this.vars[p]=A};f.get=function(p){return this.vars[p]?this.vars[p]:this.parent?this.parent.get(p):null};return w}(),a=function(){function w(){this.type=e.ValueType}w.parse=function(f){if(1<f.length)throw Error('"id" does not expect arguments');return new w};w.prototype.evaluate=function(f,p){return f.id||null};return w}(),
c=function(){function w(){this.type=e.StringType}w.parse=function(f){if(1<f.length)throw Error('"geometry-type" does not expect arguments');return new w};w.prototype.evaluate=function(f,p){switch(f.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}};return w}(),l=function(){function w(){this.type=e.ObjectType}w.parse=function(f){if(1<f.length)throw Error('"properties" does not expect arguments');return new w};w.prototype.evaluate=function(f,p){return f.values};
return w}(),x=function(){function w(){this.type=e.NumberType}w.parse=function(f){if(1<f.length)throw Error('"zoom" does not expect arguments');return new w};w.prototype.evaluate=function(f,p){return p};return w}(),k=function(){function w(f,p,A){this.lhs=f;this.rhs=p;this.compare=A;this.type=e.BooleanType}w.parse=function(f,p,A){if(3!==f.length&&4!==f.length)throw Error(`"${f[0]}" expects 2 or 3 arguments`);if(4===f.length)throw Error(`"${f[0]}" collator not supported`);return new w(b(f[1],p),b(f[2],
p),A)};w.prototype.evaluate=function(f,p){return this.compare(this.lhs.evaluate(f,p),this.rhs.evaluate(f,p))};return w}(),g=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return k.parse(p,A,(D,J)=>D===J)};return f}(k),t=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return k.parse(p,A,(D,J)=>D!==J)};return f}(k),m=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,
w);f.parse=function(p,A){return k.parse(p,A,(D,J)=>D<J)};return f}(k),n=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return k.parse(p,A,(D,J)=>D<=J)};return f}(k),B=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return k.parse(p,A,(D,J)=>D>J)};return f}(k),E=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return k.parse(p,
A,(D,J)=>D>=J)};return f}(k),z=function(){function w(f){this.arg=f;this.type=e.BooleanType}w.parse=function(f,p){if(2!==f.length)throw Error('"!" expects 1 argument');return new w(b(f[1],p))};w.prototype.evaluate=function(f,p){return!this.arg.evaluate(f,p)};return w}(),r=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,p){const A=[];for(let D=1;D<f.length;D++)A.push(b(f[D],p));return new w(A)};w.prototype.evaluate=function(f,p){for(const A of this.args)if(!A.evaluate(f,
p))return!1;return!0};return w}(),C=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,p){const A=[];for(let D=1;D<f.length;D++)A.push(b(f[D],p));return new w(A)};w.prototype.evaluate=function(f,p){for(const A of this.args)if(A.evaluate(f,p))return!0;return!1};return w}(),H=function(){function w(f){this.args=f;this.type=e.BooleanType}w.parse=function(f,p){const A=[];for(let D=1;D<f.length;D++)A.push(b(f[D],p));return new w(A)};w.prototype.evaluate=function(f,p){for(const A of this.args)if(A.evaluate(f,
p))return!1;return!0};return w}(),K=function(){function w(f,p,A){this.type=f;this.args=p;this.fallback=A}w.parse=function(f,p,A){if(4>f.length)throw Error('"case" expects at least 3 arguments');if(1===f.length%2)throw Error('"case" expects an odd number of arguments');let D;const J=[];for(let T=1;T<f.length-1;T+=2){const W=b(f[T],p),V=b(f[T+1],p,A);D||(D=V.type);J.push({condition:W,output:V})}f=b(f[f.length-1],p,A);D||(D=f.type);return new w(D,J,f)};w.prototype.evaluate=function(f,p){for(const A of this.args)if(A.condition.evaluate(f,
p))return A.output.evaluate(f,p);return this.fallback.evaluate(f,p)};return w}(),M=function(){function w(f,p){this.type=f;this.args=p}w.parse=function(f,p){if(2>f.length)throw Error('"coalesce" expects at least 1 argument');let A;const D=[];for(let J=1;J<f.length;J++){const T=b(f[J],p);A||(A=T.type);D.push(T)}return new w(A,D)};w.prototype.evaluate=function(f,p){for(const A of this.args){const D=A.evaluate(f,p);if(null!==D)return D}return null};return w}(),L=function(){function w(f,p,A,D,J){this.type=
f;this.input=p;this.labels=A;this.outputs=D;this.fallback=J}w.parse=function(f,p){if(3>f.length)throw Error('"match" expects at least 3 arguments');if(0===f.length%2)throw Error('"case" expects an even number of arguments');let A;const D=b(f[1],p),J=[],T={};let W;for(let ba=2;ba<f.length-1;ba+=2){var V=f[ba];Array.isArray(V)||(V=[V]);for(const ea of V){V=typeof ea;if("string"!==V&&"number"!==V)throw Error('"match" requires string or number literal as labels');if(!W)W=V;else if(V!==W)throw Error('"match" requires labels to have the same type');
T[ea]=J.length}V=b(f[ba+1],p);A||(A=V.type);J.push(V)}return new w(A,D,T,J,b(f[f.length-1],p))};w.prototype.evaluate=function(f,p){const A=this.input.evaluate(f,p);return(this.outputs[this.labels[A]]||this.fallback).evaluate(f,p)};return w}(),I=function(){function w(p,A,D,J,T){this.operator=p;this.type=A;this.interpolation=D;this.input=J;this.stops=T}w.parse=function(p,A,D){const J=p[0];if(5>p.length)throw Error(`"${J}" expects at least 4 arguments`);const T=p[1];if(!Array.isArray(T)||0===T.length)throw Error(`"${T}" is not a valid interpolation`);
switch(T[0]){case "linear":if(1!==T.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==T.length||"number"!==typeof T[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==T.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var W=1;5>W;W++){var V=T[W];if("number"!==typeof V||0>V||1<V)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");
}break;default:throw Error(`"${p[0]}" unknown interpolation type "${T[0]}"`);}if(1!==p.length%2)throw Error(`"${J}" expects an even number of arguments`);W=b(p[2],A,e.NumberType);let ba;"interpolate-hcl"===J||"interpolate-lab"===J?ba=e.ColorType:D&&"value"!==D.kind&&(ba=D);D=[];for(V=3;V<p.length;V+=2){const ea=p[V];if("number"!==typeof ea)throw Error(`"${J}" requires stop inputs as literal numbers`);if(D.length&&D[D.length-1][0]>=ea)throw Error(`"${J}" requires strictly ascending stop inputs`);const ja=
b(p[V+1],A,ba);ba||(ba=ja.type);D.push([ea,ja])}if(ba&&ba!==e.ColorType&&ba!==e.NumberType&&("array"!==ba.kind||ba.itemType!==e.NumberType))throw Error(`"${J}" cannot interpolate type ${e.typeToString(ba)}`);return new w(J,ba,T,W,D)};var f=w.prototype;f.evaluate=function(p,A){var D=this.stops;if(1===D.length)return D[0][1].evaluate(p,A);var J=this.input.evaluate(p,A);if(J<=D[0][0])return D[0][1].evaluate(p,A);if(J>=D[D.length-1][0])return D[D.length-1][1].evaluate(p,A);let T=0;for(;++T<D.length&&
!(J<D[T][0]););const W=w.interpolationRatio(this.interpolation,J,D[T-1][0],D[T][0]);J=D[T-1][1].evaluate(p,A);const V=D[T][1].evaluate(p,A);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(J)&&Array.isArray(V))return J.map((ba,ea)=>u.interpolate(ba,V[ea],W));if("color"===this.type.kind&&J instanceof v&&V instanceof v)return J=new v(J),p=new v(V),new v([u.interpolate(J.r,p.r,W),u.interpolate(J.g,p.g,W),u.interpolate(J.b,p.b,W),u.interpolate(J.a,p.a,W)]);if("number"===this.type.kind&&
"number"===typeof J&&"number"===typeof V)return u.interpolate(J,V,W);throw Error(`"${this.operator}" cannot interpolate type ${e.typeToString(this.type)}`);}if("interpolate-hcl"===this.operator)return p=h.toLCH(J),A=h.toLCH(V),D=A.h-p.h,p=h.toRGB({h:p.h+W*(180<D||-180>D?D-360*Math.round(D/360):D),c:u.interpolate(p.c,A.c,W),l:u.interpolate(p.l,A.l,W)}),new v({a:u.interpolate(J.a,V.a,W),...p});if("interpolate-lab"===this.operator)return p=h.toLAB(J),A=h.toLAB(V),p=h.toRGB({l:u.interpolate(p.l,A.l,W),
a:u.interpolate(p.a,A.a,W),b:u.interpolate(p.b,A.b,W)}),new v({a:u.interpolate(J.a,V.a,W),...p});throw Error(`Unexpected operator "${this.operator}"`);};f.interpolationUniformValue=function(p,A){const D=this.stops;if(1===D.length||p>=D[D.length-1][0])return 0;let J=0;for(;++J<D.length&&!(p<D[J][0]););return w.interpolationRatio(this.interpolation,A,D[J-1][0],D[J][0])};f.getInterpolationRange=function(p){const A=this.stops;if(1===A.length)return p=A[0][0],[p,p];var D=A[A.length-1][0];if(p>=D)return[D,
D];for(D=0;++D<A.length&&!(p<A[D][0]););return[A[D-1][0],A[D][0]]};w.interpolationRatio=function(p,A,D,J){let T=0;"linear"===p[0]?T=w.exponentialInterpolationRatio(A,1,D,J):"exponential"===p[0]?T=w.exponentialInterpolationRatio(A,p[1],D,J):"cubic-bezier"===p[0]&&(T=q.unitBezier(p[1],p[2],p[3],p[4])(w.exponentialInterpolationRatio(A,1,D,J),1E-5));0>T?T=0:1<T&&(T=1);return T};w.exponentialInterpolationRatio=function(p,A,D,J){J-=D;if(0===J)return 0;p-=D;return 1===A?p/J:(A**p-1)/(A**J-1)};return w}(),
Q=function(){function w(f,p,A){this.type=f;this.input=p;this.stops=A}w.parse=function(f,p){if(5>f.length)throw Error('"step" expects at least 4 arguments');if(1!==f.length%2)throw Error('"step" expects an even number of arguments');const A=b(f[1],p,e.NumberType);let D;const J=[];J.push([-Infinity,b(f[2],p)]);for(let T=3;T<f.length;T+=2){const W=f[T];if("number"!==typeof W)throw Error('"step" requires stop inputs as literal numbers');if(J.length&&J[J.length-1][0]>=W)throw Error('"step" requires strictly ascending stop inputs');
const V=b(f[T+1],p);D||(D=V.type);J.push([W,V])}return new w(D,A,J)};w.prototype.evaluate=function(f,p){const A=this.stops;if(1===A.length)return A[0][1].evaluate(f,p);const D=this.input.evaluate(f,p);let J=0;for(;++J<A.length&&!(D<A[J][0]););return this.stops[J-1][1].evaluate(f,p)};return w}(),S=function(){function w(f,p){this.type=f;this.output=p}w.parse=function(f,p,A){if(4>f.length)throw Error('"let" expects at least 3 arguments');if(1===f.length%2)throw Error('"let" expects an odd number of arguments');
const D=new d(p);for(let J=1;J<f.length-1;J+=2){const T=f[J];if("string"!==typeof T)throw Error(`"let" requires a string to define variable names - found ${T}`);D.add(T,b(f[J+1],p))}f=b(f[f.length-1],D,A);return new w(f.type,f)};w.prototype.evaluate=function(f,p){return this.output.evaluate(f,p)};return w}(),R=function(){function w(f,p){this.type=f;this.output=p}w.parse=function(f,p,A){if(2!==f.length||"string"!==typeof f[1])throw Error('"var" requires just one literal string argument');p=p.get(f[1]);
if(!p)throw Error(`${f[1]} must be defined before being used in a "var" expression`);return new w(A||e.ValueType,p)};w.prototype.evaluate=function(f,p){return this.output.evaluate(f,p)};return w}(),N=function(){function w(f,p,A){this.type=f;this.index=p;this.array=A}w.parse=function(f,p){if(3!==f.length)throw Error('"at" expects 2 arguments');const A=b(f[1],p,e.NumberType);f=b(f[2],p);return new w(f.type.itemType,A,f)};w.prototype.evaluate=function(f,p){const A=this.index.evaluate(f,p);f=this.array.evaluate(f,
p);if(0>A||A>=f.length)throw Error('"at" index out of bounds');if(A!==Math.floor(A))throw Error('"at" index must be an integer');return f[A]};return w}(),G=function(){function w(f,p){this.key=f;this.obj=p;this.type=e.ValueType}w.parse=function(f,p){let A;switch(f.length){case 2:return A=b(f[1],p),new w(A);case 3:return A=b(f[1],p),f=b(f[2],p),new w(A,f);default:throw Error('"get" expects 1 or 2 arguments');}};w.prototype.evaluate=function(f,p){const A=this.key.evaluate(f,p);return this.obj?this.obj.evaluate(f,
p)[A]:f.values[A]};return w}(),O=function(){function w(f,p){this.key=f;this.obj=p;this.type=e.BooleanType}w.parse=function(f,p){let A;switch(f.length){case 2:return A=b(f[1],p),new w(A);case 3:return A=b(f[1],p),f=b(f[2],p),new w(A,f);default:throw Error('"has" expects 1 or 2 arguments');}};w.prototype.evaluate=function(f,p){const A=this.key.evaluate(f,p);return this.obj?(f=this.obj.evaluate(f,p),A in f):void 0!==f.values[A]};return w}(),P=function(){function w(f,p){this.key=f;this.vals=p;this.type=
e.BooleanType}w.parse=function(f,p){if(3!==f.length)throw Error('"in" expects 2 arguments');return new w(b(f[1],p),b(f[2],p))};w.prototype.evaluate=function(f,p){const A=this.key.evaluate(f,p);return-1!==this.vals.evaluate(f,p).indexOf(A)};return w}(),U=function(){function w(f,p,A){this.item=f;this.array=p;this.from=A;this.type=e.NumberType}w.parse=function(f,p){if(3>f.length||4<f.length)throw Error('"index-of" expects 3 or 4 arguments');const A=b(f[1],p),D=b(f[2],p);return 4===f.length?(f=b(f[3],
p,e.NumberType),new w(A,D,f)):new w(A,D)};w.prototype.evaluate=function(f,p){const A=this.item.evaluate(f,p),D=this.array.evaluate(f,p);if(this.from){f=this.from.evaluate(f,p);if(f!==Math.floor(f))throw Error('"index-of" index must be an integer');return D.indexOf(A,f)}return D.indexOf(A)};return w}(),Y=function(){function w(f){this.arg=f;this.type=e.NumberType}w.parse=function(f,p){if(2!==f.length)throw Error('"length" expects 2 arguments');f=b(f[1],p);return new w(f)};w.prototype.evaluate=function(f,
p){f=this.arg.evaluate(f,p);if("string"===typeof f||Array.isArray(f))return f.length;throw Error('"length" expects string or array');};return w}(),ca=function(){function w(f,p,A,D){this.type=f;this.array=p;this.from=A;this.to=D}w.parse=function(f,p){if(3>f.length||4<f.length)throw Error('"slice" expects 2 or 3 arguments');const A=b(f[1],p),D=b(f[2],p,e.NumberType);if(D.type!==e.NumberType)throw Error('"slice" index must return a number');if(4===f.length){f=b(f[3],p,e.NumberType);if(f.type!==e.NumberType)throw Error('"slice" index must return a number');
return new w(A.type,A,D,f)}return new w(A.type,A,D)};w.prototype.evaluate=function(f,p){const A=this.array.evaluate(f,p);if(!Array.isArray(A)&&"string"!==typeof A)throw Error('"slice" input must be an array or a string');const D=this.from.evaluate(f,p);if(0>D||D>=A.length)throw Error('"slice" index out of bounds');if(D!==Math.floor(D))throw Error('"slice" index must be an integer');if(this.to){f=this.to.evaluate(f,p);if(0>f||f>=A.length)throw Error('"slice" index out of bounds');if(f!==Math.floor(f))throw Error('"slice" index must be an integer');
return A.slice(D,f)}return A.slice(D)};return w}(),Z=function(){function w(){this.type=e.BooleanType}w.parse=function(f){if(1!==f.length)throw Error('"has-id" expects no arguments');return new w};w.prototype.evaluate=function(f,p){return void 0!==f.id};return w}(),X=function(){function w(f,p){this.args=f;this.calculate=p;this.type=e.NumberType}w.parse=function(f,p,A){f=f.slice(1).map(D=>b(D,p));return new w(f,A)};w.prototype.evaluate=function(f,p){let A;this.args&&(A=this.args.map(D=>D.evaluate(f,
p)));return this.calculate(A)};return w}(),ka=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){switch(p.length){case 2:return X.parse(p,A,D=>-D[0]);case 3:return X.parse(p,A,D=>D[0]-D[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return f}(X),la=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return X.parse(p,A,D=>{let J=1;for(const T of D)J*=T;return J})};return f}(X),ma=
function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){if(3===p.length)return X.parse(p,A,D=>D[0]/D[1]);throw Error('"/" expects 2 arguments');};return f}(X),na=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){if(3===p.length)return X.parse(p,A,D=>D[0]%D[1]);throw Error('"%" expects 2 arguments');};return f}(X),oa=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,
w);f.parse=function(p,A){if(3===p.length)return X.parse(p,A,D=>D[0]**D[1]);throw Error('"^" expects 1 or 2 arguments');};return f}(X),pa=function(w){function f(){return w.apply(this,arguments)||this}F._inheritsLoose(f,w);f.parse=function(p,A){return X.parse(p,A,D=>{let J=0;for(const T of D)J+=T;return J})};return f}(X),aa=function(){function w(f,p){this.args=f;this.calculate=p;this.type=e.NumberType}w.parse=function(f,p){const A=f.slice(1).map(D=>b(D,p));return new w(A,w.ops[f[0]])};w.prototype.evaluate=
function(f,p){let A;this.args&&(A=this.args.map(D=>D.evaluate(f,p)));return this.calculate(A)};return w}();aa.ops={abs:w=>Math.abs(w[0]),acos:w=>Math.acos(w[0]),asin:w=>Math.asin(w[0]),atan:w=>Math.atan(w[0]),ceil:w=>Math.ceil(w[0]),cos:w=>Math.cos(w[0]),e:()=>Math.E,floor:w=>Math.floor(w[0]),ln:w=>Math.log(w[0]),ln2:()=>Math.LN2,log10:w=>Math.log(w[0])/Math.LN10,log2:w=>Math.log(w[0])/Math.LN2,max:w=>Math.max(...w),min:w=>Math.min(...w),pi:()=>Math.PI,round:w=>Math.round(w[0]),sin:w=>Math.sin(w[0]),
sqrt:w=>Math.sqrt(w[0]),tan:w=>Math.tan(w[0])};let qa=function(){function w(f){this.args=f;this.type=e.StringType}w.parse=function(f,p){return new w(f.slice(1).map(A=>b(A,p)))};w.prototype.evaluate=function(f,p){return this.args.map(A=>A.evaluate(f,p)).join("")};return w}(),ha=function(){function w(f,p){this.arg=f;this.calculate=p;this.type=e.StringType}w.parse=function(f,p){if(2!==f.length)throw Error(`${f[0]} expects 1 argument`);p=b(f[1],p);return new w(p,w.ops[f[0]])};w.prototype.evaluate=function(f,
p){return this.calculate(this.arg.evaluate(f,p))};return w}();ha.ops={downcase:w=>w.toLowerCase(),upcase:w=>w.toUpperCase()};let ra=function(){function w(p){this.args=p;this.type=e.ColorType}w.parse=function(p,A){if(4!==p.length)throw Error('"rgb" expects 3 arguments');p=p.slice(1).map(D=>b(D,A));return new w(p)};var f=w.prototype;f.evaluate=function(p,A){const D=this._validate(this.args[0].evaluate(p,A)),J=this._validate(this.args[1].evaluate(p,A));p=this._validate(this.args[2].evaluate(p,A));return new v({r:D,
g:J,b:p})};f._validate=function(p){if("number"!==typeof p||0>p||255<p)throw Error(`${p}: invalid color component`);return Math.round(p)};return w}(),sa=function(){function w(p){this.args=p;this.type=e.ColorType}w.parse=function(p,A){if(5!==p.length)throw Error('"rgba" expects 4 arguments');p=p.slice(1).map(D=>b(D,A));return new w(p)};var f=w.prototype;f.evaluate=function(p,A){const D=this._validate(this.args[0].evaluate(p,A)),J=this._validate(this.args[1].evaluate(p,A)),T=this._validate(this.args[2].evaluate(p,
A));p=this._validateAlpha(this.args[3].evaluate(p,A));return new v({r:D,g:J,b:T,a:p})};f._validate=function(p){if("number"!==typeof p||0>p||255<p)throw Error(`${p}: invalid color component`);return Math.round(p)};f._validateAlpha=function(p){if("number"!==typeof p||0>p||1<p)throw Error(`${p}: invalid alpha color component`);return p};return w}(),ta=function(){function w(f){this.color=f;this.type=e.arrayType(e.NumberType,4)}w.parse=function(f,p){if(2!==f.length)throw Error('"to-rgba" expects 1 argument');
f=b(f[1],p);return new w(f)};w.prototype.evaluate=function(f,p){return(new v(this.color.evaluate(f,p))).toRgba()};return w}(),fa=function(){function w(f,p){this.type=f;this.args=p}w.parse=function(f,p){var A=f[0];if(2>f.length)throw Error(`${A} expects at least one argument`);let D=1,J;if("array"===A){if(2<f.length){switch(f[1]){case "string":J=e.StringType;break;case "number":J=e.NumberType;break;case "boolean":J=e.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');
}D++}else J=e.ValueType;if(3<f.length){var T=f[2];if(null!==T&&("number"!==typeof T||0>T||T!==Math.floor(T)))throw Error('"array" length argument must be a positive integer literal');D++}J=e.arrayType(J,T)}else switch(A){case "string":J=e.StringType;break;case "number":J=e.NumberType;break;case "boolean":J=e.BooleanType;break;case "object":J=e.ObjectType}for(A=[];D<f.length;D++)T=b(f[D],p),A.push(T);return new w(J,A)};w.prototype.evaluate=function(f,p){let A;for(const D of this.args){const J=D.evaluate(f,
p);A=e.getType(J);if(e.matchType(A,this.type))return J}throw Error(`Expected ${e.typeToString(this.type)} but got ${e.typeToString(A)}`);};return w}(),da=function(){function w(f,p){this.type=f;this.args=p}w.parse=function(f,p){var A=f[0];const D=w.types[A];if(D===e.BooleanType||D===e.StringType){if(2!==f.length)throw Error(`${A} expects one argument`);}else if(2>f.length)throw Error(`${A} expects at least one argument`);A=[];for(let J=1;J<f.length;J++){const T=b(f[J],p);A.push(T)}return new w(D,A)};
w.prototype.evaluate=function(f,p){if(this.type===e.BooleanType)return!!this.args[0].evaluate(f,p);if(this.type===e.StringType)return e.valueToString(this.args[0].evaluate(f,p));if(this.type===e.NumberType){for(const D of this.args){var A=Number(D.evaluate(f,p));if(!isNaN(A))return A}return null}if(this.type===e.ColorType){for(A of this.args)try{const D=w.toColor(A.evaluate(f,p));if(D instanceof v)return D}catch{}return null}};w.toBoolean=function(f){return!!f};w.toString=function(f){return e.valueToString(f)};
w.toNumber=function(f){const p=Number(f);if(isNaN(p))throw Error(`"${f}" is not a number`);return p};w.toColor=function(f){if(f instanceof v)return f;if("string"===typeof f){const p=v.fromString(f);if(p)return p;throw Error(`"${f}" is not a color`);}if(Array.isArray(f))return v.fromArray(f);throw Error(`"${f}" is not a color`);};return w}();da.types={"to-boolean":e.BooleanType,"to-color":e.ColorType,"to-number":e.NumberType,"to-string":e.StringType};let ua=function(){function w(f){this.val=f;this.type=
e.getType(f)}w.parse=function(f){if(2!==f.length)throw Error('"literal" expects 1 argument');return new w(f[1])};w.prototype.evaluate=function(f,p){return this.val};return w}(),va=function(){function w(f){this.arg=f;this.type=e.StringType}w.parse=function(f,p){if(2!==f.length)throw Error('"typeof" expects 1 argument');return new w(b(f[1],p))};w.prototype.evaluate=function(f,p){return e.typeToString(e.getType(this.arg.evaluate(f,p)))};return w}();const ia={array:fa,"boolean":fa,collator:null,format:null,
image:null,literal:ua,number:fa,"number-format":null,object:fa,string:fa,"to-boolean":da,"to-color":da,"to-number":da,"to-string":da,"typeof":va,accumulated:null,"feature-state":null,"geometry-type":c,id:a,"line-progress":null,properties:l,at:N,get:G,has:O,"in":P,"index-of":U,length:Y,slice:ca,"!":z,"!\x3d":t,"\x3c":m,"\x3c\x3d":n,"\x3d\x3d":g,"\x3e":B,"\x3e\x3d":E,all:r,any:C,"case":K,coalesce:M,match:L,within:null,interpolate:I,"interpolate-hcl":I,"interpolate-lab":I,step:Q,let:S,"var":R,concat:qa,
downcase:ha,"is-supported-script":null,"resolved-locale":null,upcase:ha,rgb:ra,rgba:sa,"to-rgba":ta,"-":ka,"*":la,"/":ma,"%":na,"^":oa,"+":pa,abs:aa,acos:aa,asin:aa,atan:aa,ceil:aa,cos:aa,e:aa,floor:aa,ln:aa,ln2:aa,log10:aa,log2:aa,max:aa,min:aa,pi:aa,round:aa,sin:aa,sqrt:aa,tan:aa,zoom:x,"heatmap-density":null,"has-id":Z,none:H};y.ALL=r;y.ANY=C;y.Add=pa;y.Assert=fa;y.At=N;y.Calculate=aa;y.Case=K;y.Coalesce=M;y.Coerce=da;y.Concat=qa;y.Div=ma;y.EQ=g;y.GE=E;y.GT=B;y.GeomType=c;y.Get=G;y.Has=O;y.HasID=
Z;y.ID=a;y.In=P;y.IndexOf=U;y.Interpolate=I;y.LE=n;y.LT=m;y.Length=Y;y.Let=S;y.Literal=ua;y.Match=L;y.Mod=na;y.Mul=la;y.NE=t;y.NONE=H;y.NOT=z;y.Pow=oa;y.Properties=l;y.Rgb=ra;y.Rgba=sa;y.Slice=ca;y.Step=Q;y.String=ha;y.Sub=ka;y.ToRgba=ta;y.TypeOf=va;y.Var=R;y.Zoom=x;y.createExpression=b;y.ops=ia;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/core/colorUtils":function(){define(["exports"],function(y){function F(a,c){const l=[];let x,k;if(a[0].length!==c.length)throw"dimensions do not match";
const g=a.length,t=a[0].length;let m=0;for(x=0;x<g;x++){for(k=m=0;k<t;k++)m+=a[x][k]*c[k];l.push(m)}return l}function v(a){a=[a.r/255,a.g/255,a.b/255].map(c=>.04045>=c?c/12.92:((c+.055)/1.055)**2.4);a=F(b,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function h(a){a=F(d,[a.x/100,a.y/100,a.z/100]).map(c=>Math.min(1,Math.max(.0031308>=c?12.92*c:1.055*c**(1/2.4)-.055,0)));return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function q(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(c=>
c>(6/29)**3?c**(1/3):1/3*(29/6)**2*c+4/29);return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function u(a){const c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(l=>l>6/29?l**3:3*(6/29)**2*(l-4/29));return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function e(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var c=a.c;var l=a.h;c={l:a.l,a:c*Math.cos(l),b:c*Math.sin(l)};return h(u(c))}if("l"in a&&"a"in a&&"b"in a)return h(u(a));if("x"in a&&"y"in a&&"z"in a)return h(a);
if("h"in a&&"s"in a&&"v"in a){{l=(a.h+360)%360/60;c=a.v/100*255;a=a.s/100*c;const x=a*(1-Math.abs(l%2-1));switch(Math.floor(l)){case 0:l={r:a,g:x,b:0};break;case 1:l={r:x,g:a,b:0};break;case 2:l={r:0,g:a,b:x};break;case 3:l={r:0,g:x,b:a};break;case 4:l={r:x,g:0,b:a};break;case 5:case 6:l={r:a,g:0,b:x};break;default:l={r:0,g:0,b:0}}l.r=Math.round(l.r+c-a);l.g=Math.round(l.g+c-a);l.b=Math.round(l.b+c-a);c=l}return c}return a}const b=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,
-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];y.darken=function(a,c){a=q(v(a));a.l*=1-c;return h(u(a))};y.toHSV=function(a){if("h"in a&&"s"in a&&"v"in a)return a;var c=e(a);{a=c.r;const l=c.g,x=c.b;c=Math.max(a,l,x);const k=c-Math.min(a,l,x);a=0===k?0:c===a?(l-x)/k%6:c===l?(x-a)/k+2:(a-l)/k+4;0>a&&(a+=6);a={h:60*a,s:100*(0===k?0:k/c),v:100/255*c}}return a};y.toLAB=function(a){return"l"in a&&"a"in a&&"b"in a?a:q(v(e(a)))};y.toLCH=function(a){if(!("l"in a&&"c"in a&&"h"in a)){{var c=q(v(e(a)));
a=c.l;var l=c.a;const x=c.b;c=Math.sqrt(l*l+x*x);l=Math.atan2(x,l);l=0<l?l:l+2*Math.PI;a={l:a,c,h:l}}}return a};y.toRGB=e;y.toXYZ=function(a){return"x"in a&&"y"in a&&"z"in a?a:v(e(a))};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(y){function F(b,d){b%=d;return 0<=b?b:b+d}const v=Number.POSITIVE_INFINITY,h=Math.PI,q=128/h,u=256/360,e=1/Math.LN2;y.C_256_TO_RAD=h/128;y.C_2PI=2*h;y.C_DEG_TO_256=u;y.C_DEG_TO_RAD=
h/180;y.C_INFINITY=v;y.C_PI=h;y.C_PI_BY_2=h/2;y.C_RAD_TO_256=q;y.C_SQRT2=1.414213562;y.C_SQRT2_INV=1/1.414213562;y.between=function(b,d,a){return b>=d&&b<=a||b>=a&&b<=d};y.degToByte=function(b){return F(b*u,256)};y.interpolate=function(b,d,a){return b*(1-a)+d*a};y.log2=function(b){return Math.log(b)*e};y.positiveMod=F;y.radToByte=function(b){return F(b*q,256)};y.sqr=function(b){return b*b};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],
function(y){let F=function(){};F.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",
default:1.05}};F.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",
default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",
default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase",
"lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}};F.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}};F.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};F.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,
1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};F.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",
minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}};F.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",
default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",
minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};F.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,
default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};F.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},
"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};y.StyleDefinition=F;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/types","../expression/expression"],function(y,F,v,h){return function(){function q(e,b){this.isDataDriven=
!1;this.interpolator=null;switch(e.type){case "number":var d=!0;break;case "color":d=!0;break;case "array":d="number"===e.value;break;default:d=!1}null==b&&(b=e.default);if(Array.isArray(b)&&0<b.length&&h.ops[b[0]]){d={number:v.NumberType,color:v.ColorType,string:v.StringType,boolean:v.BooleanType,enum:v.StringType};try{var a="array"===e.type?v.arrayType(d[e.value]||v.ValueType,e.length):d[e.type];const c=h.createExpression(b,null,a);this.getValue=this._buildExpression(c,e);this.isDataDriven=!0;c instanceof
h.Interpolate&&c.input instanceof h.Zoom&&(this.interpolator=c)}catch(c){console.log(c.message),this.getValue=this._buildSimple(e.default)}}else{d&&"interval"===b.type&&(d=!1);if(a=b&&b.stops&&0<b.stops.length)for(const c of b.stops)c[1]=this._validate(c[1],e);if(this.isDataDriven=b?!!b.property:!1)if(void 0!==b.default&&(b.default=this._validate(b.default,e)),a)switch(b.type){case "identity":this.getValue=this._buildIdentity(b,e);break;case "categorical":this.getValue=this._buildCategorical(b,e);
break;default:this.getValue=d?this._buildInterpolate(b,e):this._buildInterval(b,e)}else this.getValue=this._buildIdentity(b,e);else a?this.getValue=d?this._buildZoomInterpolate(b):this._buildZoomInterval(b):(b=this._validate(b,e),this.getValue=this._buildSimple(b))}}var u=q.prototype;u._validate=function(e,b){if("number"===b.type){if(e<b.minimum)return b.minimum;if(e>b.maximum)return b.maximum}else"color"===b.type?e=q._parseColor(e):"enum"===b.type?"string"===typeof e&&(e=b.values.indexOf(e)):"array"===
b.type&&"enum"===b.value?e=e.map(d=>"string"===typeof e?b.values.indexOf(d):d):"string"===b.type&&(e=v.valueToString(e));return e};u._buildSimple=function(e){return()=>e};u._buildExpression=function(e,b){return(d,a)=>{try{const c=e.evaluate(a,d);return void 0===c?b.default:this._validate(c,b)}catch(c){return console.log(c.message),b.default}}};u._buildIdentity=function(e,b){return(d,a)=>{let c;a&&(c=a.values[e.property]);return void 0!==c?this._validate(c,b):void 0!==e.default?e.default:b.default}};
u._buildCategorical=function(e,b){return(d,a)=>{let c;a&&(c=a.values[e.property]);c=this._categorical(c,e.stops);return void 0!==c?c:void 0!==e.default?e.default:b.default}};u._buildInterval=function(e,b){return(d,a)=>{let c;a&&(c=a.values[e.property]);return"number"===typeof c?this._interval(c,e.stops):void 0!==e.default?e.default:b.default}};u._buildInterpolate=function(e,b){return(d,a)=>{let c;a&&(c=a.values[e.property]);return"number"===typeof c?this._interpolate(c,e.stops,e.base||1):void 0!==
e.default?e.default:b.default}};u._buildZoomInterpolate=function(e){return b=>this._interpolate(b,e.stops,e.base||1)};u._buildZoomInterval=function(e){return b=>this._interval(b,e.stops)};u._categorical=function(e,b){const d=b.length;for(let a=0;a<d;a++)if(b[a][0]===e)return b[a][1]};u._interval=function(e,b){const d=b.length;let a=0;for(let c=0;c<d;c++)if(b[c][0]<=e)a=c;else break;return b[a][1]};u._interpolate=function(e,b,d){const a=b.length;for(let x=0;x<a;x++){const k=b[x];if(k[0]<=e)var c=k;
else{var l=k;break}}if(c&&l){b=l[0]-c[0];e-=c[0];d=1===d?e/b:(d**e-1)/(d**b-1);if(Array.isArray(c[1])){c=c[1];l=l[1];e=[];for(b=0;b<c.length;b++)e.push(F.interpolate(c[b],l[b],d));return e}return F.interpolate(c[1],l[1],d)}if(c)return c[1];if(l)return l[1]};q._isEmpty=function(e){for(const b in e)if(e.hasOwnProperty(b))return!1;return!0};q._parseColor=function(e){if(Array.isArray(e))return e;"string"===typeof e&&(e=new y(e));if(e instanceof y){if(!this._isEmpty(e))return y.toUnitRGBA(e)}else return e};
return q}()})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./decluttering/config ./RenderBucket ../webgl/TiledDisplayObject".split(" "),function(y,F,v,h,q,u,e,b){b=function(a){function c(x,k,g,t,m=null){g=a.call(this,x,g,t,[4096,4096])||this;g._memCache=m;g._referenced=0;g._hasSymbolBuckets=!1;g._memoryUsedByLayerData=0;g.layerData=new Map;g.layerCount=
0;g.status="loading";g.allSymbolsFadingOut=!1;g.lastOpacityUpdate=0;g.symbols=new Map;g.isCoverage=!1;g.neededForCoverage=!1;g.decluttered=!1;g.invalidating=!1;g.parentTile=null;g.childrenTiles=new Set;g._processed=!1;g._referenced=1;g.styleRepository=k;g.id=x.id;g.transforms.tileUnitsToPixels=q.create();return g}F._inheritsLoose(c,a);var l=c.prototype;l.setData=function(x){this.changeDataImpl(x);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};l.deleteLayerData=function(x){let k=
!1;for(const g of x)this.layerData.has(g)&&(x=this.layerData.get(g),this._memoryUsedByLayerData-=x.memoryUsed,3===x.type&&this.symbols.has(g)&&(this.symbols.delete(g),k=!0),x.destroy(),this.layerData.delete(g),this.layerCount--);v.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);k&&this.emit("symbols-changed");this.requestRender()};l.processed=function(){return this._processed};l.hasData=function(){return 0<this.layerCount};l.dispose=function(){"unloaded"!==
this.status&&(d.delete(this),c._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};l.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};l.retain=function(){++this._referenced};l.getMemoryUsage=function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)};l.changeDataImpl=function(x){let k=!1;if(x){x=this._createRenderBuckets(x);for(const [g,t]of x)this.layerData.has(g)&&
(x=this.layerData.get(g),this._memoryUsedByLayerData-=t.memoryUsed,x.destroy(),this.layerData.delete(g),this.layerCount--),3===t.type&&(this.symbols.set(g,t.symbols),k=!0),this._memoryUsedByLayerData+=t.memoryUsed,this.layerData.set(g,t),this.layerCount++;v.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,g]of this.layerData)3===g.type&&(this._hasSymbolBuckets=!0);k&&this.emit("symbols-changed")};l.attachWithContext=
function(x){this.stage={context:x,trashDisplayObject(k){k.processDetach()},untrashDisplayObject(){return!1}}};l.setTransform=function(x,k){a.prototype.setTransform.call(this,x,k);var g=k/(x.resolution*x.pixelRatio);k=this.size[0]/this.coordRange[0]*g;g*=this.size[1]/this.coordRange[1];const t=[0,0];x.toScreen(t,this.coords);const m=this.transforms.tileUnitsToPixels;h.identity(m);h.translate(m,m,t);h.rotate(m,m,Math.PI*x.rotation/180);h.scale(m,m,[k,g,1])};c._destroyRenderBuckets=function(x){if(x){var k=
new Set;x.forEach(g=>{k.has(g)||(g.destroy(),k.add(g))});x.clear()}};l._createRenderBuckets=function(x){const k=new Map,g=new Map;for(const t of x){x=this._deserializeBucket(t,g);for(const m of x.layerUIDs)k.set(m,x)}return k};l._deserializeBucket=function(x,k){let g=k.get(x);if(g)return g;switch((new Uint32Array(x))[0]){case 1:g=new e.FillRenderBucket(x,this.styleRepository);break;case 2:g=new e.LineRenderBucket(x,this.styleRepository);break;case 3:g=new e.SymbolRenderBucket(x,this.styleRepository,
this);break;case 4:g=new e.CircleRenderBucket(x,this.styleRepository)}k.set(x,g);return g};F._createClass(c,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<u.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<u.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===
this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}}]);return c}(b.TiledDisplayObject);const d=new Map;y.VectorTile=b;y.printAllocations=function(){d.forEach((a,c)=>{console.log(`\n${c.key}:`);a[0].forEach(l=>console.log(l));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");a[1].forEach(l=>console.log(l))})};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./decluttering/util".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l,x){h=function(){function k(t,m){this.layerUIDs=[];this.isDestroyed=!1;this.data=t;this.memoryUsed=t.byteLength;let n=1;t=new Uint32Array(t);this.layerUIDs=[];const B=t[n++];for(let E=0;E<B;E++)this.layerUIDs[E]=t[n++];this.bufferDataOffset=n;m&&(this.layer=m.getStyleLayerByUID(this.layerUIDs[0]))}var g=k.prototype;g.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};g.prepareForRendering=function(t){v.isNone(this.data)||(this.doPrepareForRendering(t,
this.data,this.bufferDataOffset),this.data=null)};F._createClass(k,[{key:"isPreparedForRendering",get:function(){return v.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return k}();u=function(k){function g(m,n){n=k.call(this,m,n)||this;n.type=2;n.lineIndexStart=0;n.lineIndexCount=0;m=new Uint32Array(m);let B=n.bufferDataOffset;n.lineIndexStart=m[B++];n.lineIndexCount=m[B++];n.bufferDataOffset=B;return n}F._inheritsLoose(g,k);var t=g.prototype;t.hasData=function(){return 0<
this.lineIndexCount};t.triangleCount=function(){return this.lineIndexCount/3};t.doDestroy=function(){v.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();v.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();v.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};t.doPrepareForRendering=function(m,n,B){n=new Uint32Array(n);var E=new Int32Array(n.buffer);const z=n[B++];
this.lineVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;E=n[B++];this.lineIndexBuffer=q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,E));B+=E;B=this.layer.lineMaterial;this.lineVertexArrayObject=new e(m,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return g}(h);b=function(k){function g(m,n){n=k.call(this,m,n)||this;n.type=1;n.fillIndexStart=0;n.fillIndexCount=0;n.outlineIndexStart=0;n.outlineIndexCount=0;m=new Uint32Array(m);
let B=n.bufferDataOffset;n.fillIndexStart=m[B++];n.fillIndexCount=m[B++];n.outlineIndexStart=m[B++];n.outlineIndexCount=m[B++];n.bufferDataOffset=B;return n}F._inheritsLoose(g,k);var t=g.prototype;t.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};t.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};t.doDestroy=function(){v.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();v.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();
v.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;v.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();v.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();v.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};t.doPrepareForRendering=function(m,n,B){n=
new Uint32Array(n);var E=new Int32Array(n.buffer),z=n[B++];this.fillVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;z=n[B++];this.fillIndexBuffer=q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,z));B+=z;z=n[B++];this.outlineVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;E=n[B++];this.outlineIndexBuffer=q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,E));B+=E;n=this.layer;B=n.fillMaterial;n=n.outlineMaterial;this.fillVertexArrayObject=new e(m,
B.getAttributeLocations(),B.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new e(m,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return g}(h);d=function(k){function g(m,n,B){n=k.call(this,m,n)||this;n.type=3;n.iconPerPageElementsMap=new Map;n.glyphPerPageElementsMap=new Map;n.symbolInstances=[];n.isIconSDF=!1;n.opacityChanged=!1;n.lastOpacityUpdate=0;n.symbols=[];const E=new Uint32Array(m),
z=new Int32Array(m);m=new Float32Array(m);let r=n.bufferDataOffset;n.isIconSDF=!!E[r++];var C=E[r++];for(var H=0;H<C;H++){var K=E[r++],M=E[r++],L=E[r++];n.iconPerPageElementsMap.set(K,[M,L])}C=E[r++];for(H=0;H<C;H++)K=E[r++],M=E[r++],L=E[r++],n.glyphPerPageElementsMap.set(K,[M,L]);C=E[r++];H=E[r++];n.iconOpacity=new Int32Array(C);n.textOpacity=new Int32Array(H);r=x.deserializeSymbols(E,z,m,r,n.symbols,B);n.bufferDataOffset=r;return n}F._inheritsLoose(g,k);var t=g.prototype;t.hasData=function(){return 0<
this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};t.triangleCount=function(){let m=0;for(const [,n]of this.iconPerPageElementsMap)m+=n[1];for(const [,n]of this.glyphPerPageElementsMap)m+=n[1];return m/3};t.doDestroy=function(){v.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();v.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();v.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();v.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();
this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;v.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();v.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();v.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();v.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};t.updateOpacityInfo=
function(){if(this.opacityChanged){this.opacityChanged=!1;var m=v.unwrap(this.iconOpacity),n=v.unwrap(this.iconOpacityBuffer);0<m.length&&m.byteLength===n.size&&n.setSubData(m);m=v.unwrap(this.textOpacity);n=v.unwrap(this.textOpacityBuffer);0<m.length&&m.byteLength===n.size&&n.setSubData(m)}};t.doPrepareForRendering=function(m,n,B){n=new Uint32Array(n);var E=new Int32Array(n.buffer),z=n[B++];this.iconVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;z=n[B++];this.iconIndexBuffer=
q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,z));B+=z;z=n[B++];this.textVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;E=n[B++];this.textIndexBuffer=q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,E));B+=E;this.iconOpacityBuffer=q.createVertex(m,35044,v.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=q.createVertex(m,35044,v.unwrap(this.textOpacity).buffer);n=this.layer;B=n.iconMaterial;n=n.textMaterial;this.iconVertexArrayObject=new e(m,B.getAttributeLocations(),
B.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new e(m,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return g}(h);a=function(k){function g(m,n){n=k.call(this,m,n)||this;n.type=4;n.circleIndexStart=0;n.circleIndexCount=0;m=new Uint32Array(m);let B=n.bufferDataOffset;n.circleIndexStart=m[B++];n.circleIndexCount=m[B++];n.bufferDataOffset=
B;return n}F._inheritsLoose(g,k);var t=g.prototype;t.hasData=function(){return 0<this.circleIndexCount};t.triangleCount=function(){return this.circleIndexCount/3};t.doDestroy=function(){v.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();v.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();v.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};
t.doPrepareForRendering=function(m,n,B){n=new Uint32Array(n);var E=new Int32Array(n.buffer);const z=n[B++];this.circleVertexBuffer=q.createVertex(m,35044,new Int32Array(E.buffer,4*B,z));B+=z;E=n[B++];this.circleIndexBuffer=q.createIndex(m,35044,new Uint32Array(n.buffer,4*B,E));B+=E;B=this.layer.circleMaterial;this.circleVertexArrayObject=new e(m,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return g}(h);y.CircleRenderBucket=a;y.FillRenderBucket=
b;y.LineRenderBucket=u;y.RenderBucketBase=h;y.SymbolRenderBucket=d;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./core"],function(y,F,v,h){let q=function(d){this.tile=d;this.parent=null;this.children=new Set},u=function(){function d(){this.nodes=new Map;this.roots=new Set}var a=d.prototype;a.create=function(c){const l=new q(c);let x;
const k=[];this.nodes.forEach(g=>{this._canConnectDirectly(l,g)&&k.push(g);!x&&this._canConnectDirectly(g,l)&&(x=g)});if(x){for(const g of k)x.children.delete(g),l.children.add(g),g.parent=l;x.children.add(l);l.parent=x}else{this.roots.add(l);for(const g of k)l.children.add(g),g.parent=l,this.roots.delete(g)}this.nodes.set(c.key.id,l);return l};a.destroy=function(c){v.isSome(c.parent)?(c.parent.children.delete(c),c.children.forEach(l=>{v.isSome(c.parent)&&c.parent.children.add(l)})):this.roots.delete(c);
c.children.forEach(l=>{(l.parent=c.parent)||this.roots.add(l)});this.nodes.delete(c.tile.key.id)};a.clear=function(){this.roots.clear();this.nodes.clear()};a._canConnectDirectly=function(c,l){let {level:x,row:k,col:g}=l.tile.key;for({world:l}=l.tile.key;0<x;){x--;k>>=1;g>>=1;if(c.tile.key.level===x&&c.tile.key.row===k&&c.tile.key.col===g&&c.tile.key.world===l)return!0;if(this.nodes.has(`${x}/${k}/${g}/${l}`))break}return!1};return d}(),e=function(){function d(){this._tileGraph=new u;this._tileArray=
null}var a=d.prototype;a.has=function(c){return"string"===typeof c?this._tileGraph.nodes.has(c):this._tileGraph.nodes.has(c.key.id)};a.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(c=>{this._tileArray.push(c.tile)}));return this._tileArray};a.getRoots=function(){const c=[];this._tileGraph.roots.forEach(l=>{c.push(l.tile)});return c};a.getParent=function(c){c=this._tileGraph.nodes.get("string"===typeof c?c:c.key.id);return v.isSome(c.parent)&&c.parent.tile};a.getChildren=
function(c){const l=[];this._tileGraph.nodes.get("string"===typeof c?c:c.key.id).children.forEach(x=>{l.push(x.tile)});return l};a.get=function(c){return this._tileGraph.nodes.get(c).tile};a.removeKey=function(c){c=this._tileGraph.nodes.get(c);this._tileGraph.destroy(c);this._tileArray=null};a.forEach=function(c){this._tileGraph.nodes.forEach((l,x)=>c(l.tile,x))};a.add=function(c){this._tileGraph.create(c);this._tileArray=null};a.remove=function(c){c=this._tileGraph.nodes.get(c.key.id);this._tileGraph.destroy(c);
this._tileArray=null};a.clear=function(){this._tileGraph.clear();this._tileArray=[]};return d}(),b=function(){function d(c,l,x){this._rows=Math.ceil(l/x);this._columns=Math.ceil(c/x);this._cellSize=x;this.cells=Array(this._rows);for(c=0;c<this._rows;c++)for(this.cells[c]=Array(this._columns),l=0;l<this._columns;l++)this.cells[c][l]=[]}var a=d.prototype;a.getCell=function(c,l){l=Math.min(Math.max(Math.floor(l/this._cellSize),0),this._rows-1);c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._columns-
1);return this.cells[l]&&this.cells[l][c]||null};a.getCellSpan=function(c,l,x,k){return[Math.min(Math.max(Math.floor(c/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(x/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(k/this._cellSize),0),this.rows-1)]};F._createClass(d,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);
return d}();y.GridIndex=b;y.TileForest=e;y.TileGraph=u;y.TileNode=q;y.deserializeSymbols=function(d,a,c,l,x,k){const g=a[l++];for(let n=0;n<g;n++){const B=new h.VTLSymbol(k);B.xTile=a[l++];B.yTile=a[l++];B.hash=a[l++];B.priority=a[l++];var t=a[l++];for(var m=0;m<t;m++){const E=a[l++],z=a[l++],r=a[l++],C=a[l++],H=!!a[l++],K=a[l++],M=c[l++],L=c[l++],I=a[l++],Q=a[l++];B.colliders.push({xTile:E,yTile:z,dxPixels:r,dyPixels:C,hard:H,partIndex:K,width:I,height:Q,minLod:M,maxLod:L})}t=d[l++];for(m=0;m<t;m++)B.textVertexRanges.push([d[l++],
d[l++]]);t=d[l++];for(m=0;m<t;m++)B.iconVertexRanges.push([d[l++],d[l++]]);x.push(B)}return l};y.tileCoordChange=function(d,a,c,l,x,k){c-=x;if(0<=c)return(a>>c)+(l-(k<<c))*(d>>c);c=-c;return a-(k-(l<<c))*(d>>c)<<c};y.writeOpacityToBuffers=function(d,a,c){for(const [n,B]of d.symbols){{var l=d,x=a,k=c,g=B;const E=l.layerData.get(n);if(3===E.type){for(const z of g){g=z.unique;var t=void 0;if(z.selectedForRendering){var m=g.parts[0];t=m.startOpacity;m=m.targetOpacity;l.allSymbolsFadingOut=l.allSymbolsFadingOut&&
0===m;t=k?Math.floor(127*t)|m<<7:m?255:0;t|=t<<24|t<<16|t<<8}else t=0;for(const [r,C]of z.iconVertexRanges)for(m=r;m<r+C;m+=4)E.iconOpacity[m/4]=t;z.selectedForRendering?(t=g.parts[1],g=t.startOpacity,t=t.targetOpacity,l.allSymbolsFadingOut=l.allSymbolsFadingOut&&0===t,g=k?Math.floor(127*g)|t<<7:t?255:0,t=g<<24|g<<16|g<<8|g):t=0;for(const [r,C]of z.textVertexRanges)for(g=r;g<r+C;g+=4)E.textOpacity[g/4]=t}E.lastOpacityUpdate=x;E.opacityChanged=!0}}}};Object.defineProperty(y,"__esModule",{value:!0})})},
"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){y.VTLSymbol=function(F){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=F};y.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l,x,k,g,t,m,n,B,E){const z=x.ofType({key:"type",base:t,typeMap:{rect:m,path:E,geometry:B}});y.LayerView2DMixin=r=>{r=function(C){function H(){var M=C.apply(this,arguments)||this;M.clips=new z;M.moving=!1;M.attached=!1;M.lastUpdateId=-1;M.updateRequested=!1;return M}F._inheritsLoose(H,C);var K=H.prototype;K.initialize=function(){var M;this.container||(this.container=new n.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([g.init(this,"suspended",L=>{this.container&&(this.container.visible=!L);this.view&&!L&&this.updateRequested&&this.view.requestUpdate()},!0),g.init(this,["layer.opacity","container"],()=>{if(this.container){var L,I;this.container.opacity=null!=(L=null==(I=this.layer)?void 0:I.opacity)?L:1}},!0),g.init(this,["layer.blendMode"],L=>{this.container&&(this.container.blendMode=L)},!0),g.init(this,["layer.effect"],L=>{this.container&&(this.container.effect=L)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(M=this.view)&&M.whenLayerView?this.view.whenLayerView(this.layer).then(L=>{L!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};K.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};K.isVisibleAtScale=
function(M){var L=!0,I=this.layer;const Q=I.minScale;I=I.maxScale;if(null!=Q&&null!=I){L=!Q;let S=!I;!L&&M<=Q&&(L=!0);!S&&M>=I&&(S=!0);L=L&&S}return L};K.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};K.processUpdate=function(M){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",M),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(M)))};K.isUpdating=
function(){return!1};K.isRendering=function(){return!1};K.canResume=function(){return C.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};F._createClass(H,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return H}(r);v.__decorate([e.property({type:z,set(C){C=k.referenceSetter(C,this._get("clips"),z);this._set("clips",C)}})],r.prototype,"clips",void 0);v.__decorate([e.property()],r.prototype,"moving",void 0);
v.__decorate([e.property()],r.prototype,"attached",void 0);v.__decorate([e.property()],r.prototype,"container",void 0);v.__decorate([e.property()],r.prototype,"suspended",void 0);v.__decorate([e.property({readOnly:!0})],r.prototype,"updateParameters",void 0);v.__decorate([e.property()],r.prototype,"updateRequested",void 0);v.__decorate([e.property()],r.prototype,"updating",null);v.__decorate([e.property()],r.prototype,"view",void 0);return r=v.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],
r)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l){v=function(x){function k(){return x.apply(this,arguments)||this}y._inheritsLoose(k,x);return k}(l.JSONSupport);return v=F.__decorate([b.subclass("esri.views.layers.support.ClipArea")],v)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l){var x;v=x=function(k){function g(){var t=k.apply(this,arguments)||this;t.type="rect";t.left=null;t.right=null;t.top=null;t.bottom=null;return t}y._inheritsLoose(g,k);g.prototype.clone=function(){return new x({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};y._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(l);F.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0);
F.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"right",void 0);F.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0);F.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0);F.__decorate([u.property({readOnly:!0})],v.prototype,"version",null);return v=x=F.__decorate([b.subclass("esri.views.layers.support.ClipRect")],v)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l,x,k,g,t,m){var n;v={base:l,key:"type",typeMap:{extent:x,polygon:k}};m=n=function(B){function E(){var z=B.apply(this,arguments)||this;z.type="geometry";z.geometry=null;return z}y._inheritsLoose(E,B);E.prototype.clone=function(){return new n({geometry:this.geometry.clone()})};y._createClass(E,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return E}(m);F.__decorate([u.property({types:v,json:{read:g.fromJSON,write:!0}})],m.prototype,"geometry",void 0);
F.__decorate([u.property({readOnly:!0})],m.prototype,"version",null);return m=n=F.__decorate([b.subclass("esri.views.layers.support.Geometry")],m)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l){v=function(x){function k(){var g=x.apply(this,arguments)||this;g.type="path";g.path=[];return g}y._inheritsLoose(k,x);y._createClass(k,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return k}(l);F.__decorate([u.property({type:[[[Number]]],json:{write:!0}})],v.prototype,"path",void 0);F.__decorate([u.property({readOnly:!0})],v.prototype,"version",null);return v=F.__decorate([b.subclass("esri.views.layers.support.Path")],v)})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/promiseUtils ../../../../request ../../../../core/ItemCache ../../../../core/workers/workers ../../tiling/TileKey ./TileIndex ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./decluttering/debugging".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l,x){const k=new u(10),g=new Map;u=function(){function t(n,B,E){this._vectorTileLayer=n;this._styleRepository=B;this.devicePixelRatio=E;this._connection=this._glyphMosaic=this._spriteMosaic=null}var m=t.prototype;m.destroy=function(){this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};m.start=async function(n){const B=
this._vectorTileLayer;var E=B.sourceNameToSource;const z=[];for(const r in E)z.push(this._fetchTileMap(E[r],n));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,n);this._spriteSourcePromise.then(r=>{this._spriteMosaic=new l(1024,1024,250);this._spriteMosaic.setSpriteSource(r)});E=new c(this._styleRepository.glyphs);this._glyphMosaic=new a(1024,1024,E);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,scheduler:n.scheduler,signal:n.signal}).then(r=>
{this._connection=r;return Promise.all(this._connection.broadcast("setStyle",{style:B.currentStyleInfo.style,vectorTileLayerMaxBuffers:v("vectortilelayer-max-buffers")},n))});return Promise.all(z)};m.updateStyle=async function(n){await this._broadcastPromise;return this._broadcastPromise=new Promise((B,E)=>{Promise.all(this._connection.broadcast("updateStyle",n)).then(B,E)})};m.setStyle=async function(n,B){await this._broadcastPromise;this._styleRepository=n;const E=this._vectorTileLayer.sourceNameToSource,
z=[];for(const r in E)z.push(this._fetchTileMap(E[r],null));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(r=>{this._spriteMosaic=new l(1024,1024,250);this._spriteMosaic.setSpriteSource(r)});n=new c(n.glyphs);this._glyphMosaic=new a(1024,1024,n);this._broadcastPromise=new Promise((r,C)=>{Promise.all(this._connection.broadcast("setStyle",{style:B,vectorTileLayerMaxBuffers:v("vectortilelayer-max-buffers")})).then(r,C)});z.push(this._broadcastPromise);
return Promise.all(z)};m.fetchTileData=function(n,B){return this._getRefKeys(n,B).then(E=>{const z=this._vectorTileLayer.sourceNameToSource,r=[];for(const C in z)r.push(C);return this._getSourcesData(r,E,B)})};m.parseTileData=function(n,B){const E=n&&n.data;if(!E)return Promise.resolve(null);const {sourceName2DataAndRefKey:z,transferList:r}=E;return 0===Object.keys(z).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.getAvailableClient().then(C=>C.invoke("createTileAndParse",
{key:n.key.id,sourceName2DataAndRefKey:z,styleLayerUIDs:n.styleLayerUIDs},{...B,transferList:r}).then(H=>({tileData:H}))))};m.getSprites=async function(n){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(n)};m.getGlyphs=function(n){return this._glyphMosaic.getGlyphItems(n.font,n.codePoints)};m.perfReport=function({key:n,milliseconds:B}){x.perfAdd(n,B,"ms")};m._getTilePayload=async function(n,B,E){n=b.pool.acquire(n.id);const z=this._vectorTileLayer.sourceNameToSource[B].getSourceTileUrl(n.level,
n.row,n.col);b.pool.release(n);try{return{protobuff:await this.request(z,E),sourceName:B}}catch(r){if(h.isAbortError(r))throw r;return{protobuff:null,sourceName:B}}};m.request=function(n,B){return q(n,{responseType:"array-buffer",...B}).then(({data:E})=>E)};m._fetchTileMap=async function(n,B){if(n.capabilities.operations.supportsTileMap&&n.tileIndex)return Promise.resolve();if(n.tileMapURL){var E=k.get(n.tileMapURL);if(E)n.tileIndex=E;else if(g.has(n.tileMapURL))try{var z=await g.get(n.tileMapURL);
n.tileIndex=new d(z.data)}catch(r){if(h.isAbortError(r))throw r;}else{B=q(n.tileMapURL,B);g.set(n.tileMapURL,B);try{z=await B,g.delete(n.tileMapURL),k.put(n.tileMapURL,n.tileIndex),n.tileIndex=new d(z.data)}catch(r){if(g.delete(n.tileMapURL),h.isAbortError(r))throw r;}}}};m._getRefKeys=function(n,B){const E=this._vectorTileLayer.sourceNameToSource,z=[];for(const r in E){const C=E[r].getRefKey(n,B);z.push(C)}return h.eachAlways(z)};m._getSourcesData=function(n,B,E){const z=[];for(let r=0;r<B.length;r++)if(null==
B[r].value||null==n[r])z.push(null);else{const C=this._getTilePayload(B[r].value,n[r],E);z.push(C)}return h.eachAlways(z).then(r=>{const C={},H=[];for(let K=0;K<r.length;K++)r[K].value&&r[K].value&&r[K].value.protobuff&&0<r[K].value.protobuff.byteLength&&(C[r[K].value.sourceName]={refKey:B[K].value.id,protobuff:r[K].value.protobuff},H.push(r[K].value.protobuff));return{sourceName2DataAndRefKey:C,transferList:H}})};F._createClass(t,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>
this._spriteMosaic)}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}}]);return t}();y.TileHandler=u;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(y,F,v){return function(){function h(u){if(u instanceof F.TilemapCache)this._tilemapCache=u;else if(u&&"index"in u)this._tilemap=u.index;else throw Error("Invalid tilemap!");
}var q=h.prototype;q.dataKey=function(u,e){if(this._tilemapCache){const {level:b,row:d,col:a}=u,c=new v(u);return this._tilemapCache.fetchAvailabilityUpsample(b,d,a,c,e).then(()=>{c.world=u.world;return c}).catch(l=>{if(y.isAbortError(l))throw l;return null})}return this._getIndexedDataKey(u)};q.forEach=function(u,e,b,d,a){this._callback=a;this._maxLevel=e+u;this._forEach(this._tilemap,e,b,d)};q._forEach=function(u,e,b,d){0!==u&&(this._callback(e,b,d),e!==this._maxLevel&&"object"===typeof u&&(this._forEach(u[0],
e+1,2*b,2*d),this._forEach(u[1],e+1,2*b,2*d+1),this._forEach(u[2],e+1,2*b+1,2*d),this._forEach(u[3],e+1,2*b+1,2*d+1)))};q._getIndexedDataKey=function(u){const e=[u];if(0>u.level||0>u.row||0>u.col||0<u.row>>u.level||0<u.col>>u.level)return Promise.resolve(null);for(;0!==u.level;)u=new v(u.level-1,u.row>>1,u.col>>1,u.world),e.push(u);u=this._tilemap;let b=e.pop(),d,a;if(1===u)return Promise.resolve(b);for(;e.length;)if(d=e.pop(),a=(d.col&1)+((d.row&1)<<1),u){if(0===u[a]){b=null;break}if(1===u[a]){b=
d;break}b=d;u=u[a]}return Promise.resolve(b)};return h}()})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l,x,k,g,t,m,n,B,E,z,r){var C;const H=q.getLogger("esri.layers.support.TilemapCache");y.TilemapCache=C=function(K){function M(I){I=K.call(this,I)||this;I._handles=new B;I._pendingTilemapRequests={};I._availableLevels={};I.levels=5;I.cacheByteSize=2097152;I.request=n;I._prefetchingEnabled=!0;return I}F._inheritsLoose(M,K);var L=M.prototype;L.initialize=function(){this._tilemapCache=new E(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),z.init(this,"layer.tileInfo.lods",I=>this._initializeAvailableLevels(I),!0)]);this._initializeTilemapDefinition()};L.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};L.castLevels=function(I){return 2>=I?(H.error("Minimum levels for Tilemap is 3, but got ",I),3):I};L.fetchTilemap=function(I,Q,S,R){if(!this._availableLevels[I])return Promise.reject(new a("tilemap-cache:level-unavailable",`Level ${I} is unavailable in the service`));
const N=this._tmpTilemapDefinition;if(I=this._tilemapFromCache(I,Q,S,N))return Promise.resolve(I);const G=R&&R.signal;R={...R,signal:null};return new Promise((O,P)=>{g.onAbort(G,()=>P(g.createAbortError()));const U=r.tilemapDefinitionId(N);let Y=this._pendingTilemapRequests[U];if(!Y){Y=r.Tilemap.fromDefinition(N,R).then(Z=>{this._tilemapCache.put(U,Z,Z.byteSize);return Z});const ca=()=>delete this._pendingTilemapRequests[U];this._pendingTilemapRequests[U]=Y;Y.then(ca,ca)}Y.then(O,P)})};L.getAvailability=
function(I,Q,S){return this._availableLevels[I]?(I=this._tilemapFromCache(I,Q,S,this._tmpTilemapDefinition))?I.getAvailability(Q,S):"unknown":"unavailable"};L.getAvailabilityUpsample=function(I,Q,S,R){R.level=I;R.row=Q;R.col=S;I=this.layer.tileInfo;for(I.updateTileInfo(R);;)if(Q=this.getAvailability(R.level,R.row,R.col),"unavailable"===Q){if(!I.upsampleTile(R))return"unavailable"}else return Q};L.fetchAvailability=function(I,Q,S,R){return this._availableLevels[I]?this.fetchTilemap(I,Q,S,R).catch(N=>
N).then(N=>{if(N instanceof r.Tilemap)return N=N.getAvailability(Q,S),"unavailable"===N?Promise.reject(new a("tile-map:tile-unavailable","Tile is not available",{level:I,row:Q,col:S})):N;if(g.isAbortError(N))throw N;return"unknown"}):Promise.reject(new a("tilemap-cache:level-unavailable",`Level ${I} is unavailable in the service`))};L.fetchAvailabilityUpsample=function(I,Q,S,R,N){R.level=I;R.row=Q;R.col=S;const G=this.layer.tileInfo;G.updateTileInfo(R);const O=this.fetchAvailability(I,Q,S,N).catch(P=>
{if(g.isAbortError(P))throw P;if(G.upsampleTile(R))return this.fetchAvailabilityUpsample(R.level,R.row,R.col,R);throw P;});this._fetchAvailabilityUpsamplePrefetch(R.id,I,Q,S,N,O);return O};L._fetchAvailabilityUpsamplePrefetch=async function(I,Q,S,R,N,G){if(this._prefetchingEnabled){var O=`prefetch-${I}`;if(!this._handles.has(O)){var P=g.createAbortController();G.then(()=>P.abort(),()=>P.abort());var U=!1;this._handles.add({remove(){U||(U=!0,P.abort())}},O);await t.waitTicks(10,P.signal).catch(()=>
{});U||(U=!0,this._handles.remove(O));if(!g.isAborted(P))for(I={id:I,level:Q,row:S,col:R},N={...N,signal:P.signal},Q=this.layer.tileInfo,S=0;C._prefetches.length<C._maxPrefetch&&Q.upsampleTile(I);++S){const Y=this.fetchAvailability(I.level,I.row,I.col,N);C._prefetches.push(Y);R=()=>{C._prefetches.removeUnordered(Y)};Y.then(R,R)}}}};L._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var I=this.layer.parsedUrl,Q=I.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:I.path,
query:Q?c.objectToQuery(Q):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};L._tilemapFromCache=function(I,Q,S,R){R.level=I;R.row=Q-Q%this.size;R.col=S-S%this.size;I=r.tilemapDefinitionId(R);return this._tilemapCache.get(I)};L._initializeAvailableLevels=function(I){this._availableLevels={};I&&I.forEach(Q=>this._availableLevels[Q.level]=!0)};F._createClass(M,[{key:"size",get:function(){return 1<<this.levels}},
{key:"test",get:function(){const I=this;return{get prefetchingEnabled(){return I._prefetchingEnabled},set prefetchingEnabled(Q){I._prefetchingEnabled=Q},hasTilemap(Q,S,R){return!!I._tilemapFromCache(Q,S,R,I._tmpTilemapDefinition)}}}}]);return M}(m);y.TilemapCache._maxPrefetch=4;y.TilemapCache._prefetches=new k({initialSize:C._maxPrefetch});v.__decorate([u.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"levels",void 0);v.__decorate([e.cast("levels")],y.TilemapCache.prototype,"castLevels",
null);v.__decorate([u.property({readOnly:!0,type:Number})],y.TilemapCache.prototype,"size",null);v.__decorate([u.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"cacheByteSize",void 0);v.__decorate([u.property({constructOnly:!0})],y.TilemapCache.prototype,"layer",void 0);v.__decorate([u.property({constructOnly:!0})],y.TilemapCache.prototype,"request",void 0);y.TilemapCache=C=v.__decorate([d.subclass("esri.layers.support.TilemapCache")],y.TilemapCache);Object.defineProperty(y,"__esModule",
{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(y,F,v,h,q){function u(b){if("vector-tile"===b.service.type)var d=`${b.service.url}/tilemap/${b.level}/${b.row}/${b.col}/${b.width}/${b.height}`;else d=b.service.tileServers,d=`${d&&d.length?d[b.row%d.length]:b.service.url}/tilemap/${b.level}/${b.row}/${b.col}/${b.width}/${b.height}`;(b=b.service.query)&&(d=`${d}?${b}`);return d}let e=function(){function b(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var d=b.prototype;d.getAvailability=function(a,c){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(c-this.location.left);c=a>>3;const l=this._tileAvailabilityBitSet;return 0>c||c>l.length?"unknown":l[c]&1<<a%8?"available":"unavailable"};d._updateFromData=function(a){let c=!0,l=!0;const x=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let k=0;for(let g=0;g<a.length;g++){const t=g%8;a[g]?(l=!1,x[k]|=1<<t):c=!1;7===t&&++k}l?this._allAvailability="unavailable":c?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=x,this.byteSize+=x.length)};b.fromDefinition=function(a,c){const l=a.service.request||q,{row:x,col:k,width:g,height:t}=a,m={query:{f:"json"}};c=c?{...m,...c}:m;return l(u(a),c).then(n=>n.data).catch(n=>{if(n&&n.details&&422===n.details.httpStatus)return{location:{top:x,left:k,width:g,
height:t},valid:!0,data:h.constant(g*t,0)};throw n;}).then(n=>{if(n.location&&(n.location.top!==x||n.location.left!==k||n.location.width!==g||n.location.height!==t))throw new v("tilemap:location-mismatch","Tilemap response for different location than requested",{response:n,definition:{top:x,left:k,width:g,height:t}});return b.fromJSON(n)})};b.fromJSON=function(a){b.validateJSON(a);const c=new b;c.location=Object.freeze(F.clone(a.location));c._updateFromData(a.data);return Object.freeze(c)};b.validateJSON=
function(a){if(!a||!a.location)throw new v("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new v("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new v("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new v("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new v("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return b}();y.Tilemap=e;y.default=e;y.tilemapDefinitionId=function(b){return`${b.level}/${b.row}/${b.col}/${b.width}/${b.height}`};y.tilemapDefinitionUrl=u;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../webgl/Rect ./RectangleBinPack".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c){return function(){function l(k,g,t){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=k;this.height=g;this._glyphSource=t;this._binPack=new c(k-4,g-4);this._glyphData.push(new Uint8Array(k*g));this._dirties.push(!0);this._textures.push(void 0)}var x=l.prototype;x.getGlyphItems=function(k,g){const t=[],m=this._glyphSource,n=new Set,B=1/256;for(const z of g)n.add(Math.floor(z*
B));const E=[];n.forEach(z=>{if(256>=z){const r=k+z;this._rangePromises.has(r)?E.push(this._rangePromises.get(r)):(z=m.getRange(k,z).then(()=>{this._rangePromises["delete"](r)},()=>{this._rangePromises["delete"](r)}),this._rangePromises.set(r,z),E.push(z))}});return Promise.all(E).then(()=>{let z=this._glyphIndex[k];z||(z={},this._glyphIndex[k]=z);for(const M of g){var r=z[M];if(r){t[M]={sdf:!0,rect:r.rect,metrics:r.metrics,page:r.page,code:M};continue}var C=m.getGlyph(k,M);if(!C||!C.metrics)continue;
r=C.metrics;let L;if(0===r.width)L=new a(0,0,0,0);else{const I=r.width+6,Q=r.height+6;var H=I%4?4-I%4:4,K=Q%4?4-Q%4:4;1===H&&(H=5);1===K&&(K=5);L=this._binPack.allocate(I+H,Q+K);L.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new c(this.width-4,this.height-4),L=this._binPack.allocate(I+H,Q+K));
H=this._glyphData[this._currentPage];C=C.bitmap;let S;if(C)for(let R=0;R<Q;R++){K=I*R;S=this.width*(L.y+R+1)+L.x;for(let N=0;N<I;N++)H[S+N+1]=C[K+N]}}z[M]={rect:L,metrics:r,tileIDs:null,page:this._currentPage};t[M]={sdf:!0,rect:L,metrics:r,page:this._currentPage,code:M};this._dirties[this._currentPage]=!0}return t})};x.removeGlyphs=function(k){for(const g in this._glyphIndex){const t=this._glyphIndex[g];if(!t)continue;let m;for(const n in t)if(m=t[n],m.tileIDs["delete"](k),0===m.tileIDs.size){const B=
this._glyphData[m.page],E=m.rect;let z,r;for(let C=0;C<E.height;C++)for(z=this.width*(E.y+C)+E.x,r=0;r<E.width;r++)B[z+r]=0;delete t[n];this._dirties[m.page]=!0}}};x.bind=function(k,g,t,m=0){this._textures[t]||(this._textures[t]=new v(k,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const n=this._textures[t];n.setSamplingMode(g);this._dirties[t]&&n.setData(this._glyphData[t]);k.bindTexture(n,m);this._dirties[t]=!1};x.dispose=function(){this._binPack=
null;for(const k of this._textures)k&&k.dispose();this._textures.length=0};return l}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/Rect"],function(y,F){return function(){function v(q,u){this._height=this._width=0;this._free=[];this._width=q;this._height=u;this._free.push(new F(0,0,q,u))}var h=v.prototype;h.allocate=function(q,u){if(q>this._width||u>this._height)return new F;let e=null,b=-1;for(let d=0;d<this._free.length;++d){const a=
this._free[d];q<=a.width&&u<=a.height&&(null===e||a.y<=e.y&&a.x<=e.x)&&(e=a,b=d)}if(null===e)return new F;this._free.splice(b,1);e.width<e.height?(e.width>q&&this._free.push(new F(e.x+q,e.y,e.width-q,u)),e.height>u&&this._free.push(new F(e.x,e.y+u,e.width,e.height-u))):(e.width>q&&this._free.push(new F(e.x+q,e.y,e.width-q,e.height)),e.height>u&&this._free.push(new F(e.x,e.y+u,q,e.height-u)));return new F(e.x,e.y,q,u)};h.release=function(q){for(let u=0;u<this._free.length;++u){const e=this._free[u];
if(e.y===q.y&&e.height===q.height&&e.x+e.width===q.x)e.width+=q.width;else if(e.x===q.x&&e.width===q.width&&e.y+e.height===q.y)e.height+=q.height;else if(q.y===e.y&&q.height===e.height&&q.x+q.width===e.x)e.x=q.x,e.width+=q.width;else if(q.x===e.x&&q.width===e.width&&q.y+q.height===e.y)e.y=q.y,e.height+=q.height;else continue;this._free.splice(u,1);this.release(q)}this._free.push(q)};y._createClass(v,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);
return v}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(y,F){let v=function(){function q(e){this._metrics=[];this._bitmaps=[];if(e)for(;e.next();)switch(e.tag()){case 1:{const b=e.getMessage();for(;b.next();)switch(b.tag()){case 3:{const d=b.getMessage();let a,c,l,x,k,g,t;for(;d.next();)switch(d.tag()){case 1:a=d.getUInt32();break;case 2:c=d.getBytes();break;case 3:l=d.getUInt32();break;case 4:x=d.getUInt32();break;case 5:k=
d.getSInt32();break;case 6:g=d.getSInt32();break;case 7:t=d.getUInt32();break;default:d.skip()}d.release();a&&(this._metrics[a]={width:l,height:x,left:k,top:g,advance:t},this._bitmaps[a]=c);break}default:b.skip()}b.release();break}default:e.skip()}}var u=q.prototype;u.getMetrics=function(e){return this._metrics[e]};u.getBitmap=function(e){return this._bitmaps[e]};return q}(),h=function(){function q(){this._ranges=[]}var u=q.prototype;u.getRange=function(e){return this._ranges[e]};u.addRange=function(e,
b){this._ranges[e]=b};return q}();return function(){function q(e){this._glyphInfo={};this._baseURL=e}var u=q.prototype;u.getRange=function(e,b){const d=this._getFontStack(e);if(d.getRange(b))return Promise.resolve();const a=256*b,c=a+255;e=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+c);return y(e,{responseType:"array-buffer"}).then(l=>{d.addRange(b,new v(new F(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{d.addRange(b,new v)})};u.getGlyph=function(e,b){if(e=this._getFontStack(e)){var d=
Math.floor(b/256);if(!(256<d)&&(e=e.getRange(d)))return{metrics:e.getMetrics(b),bitmap:e.getBitmap(b)}}};u._getFontStack=function(e){let b=this._glyphInfo[e];b||(b=this._glyphInfo[e]=new h);return b};return q}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../webgl/Rect ./RectangleBinPack".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c){return function(){function l(k,g,t=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=k||0>=g)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=k;this._pageHeight=g;0<t&&(this._maxItemSize=t);this._binPack=new c(k-4,g-4)}var x=l.prototype;x.getWidth=function(k){return k>=this._size.length?
-1:this._size[k][0]};x.getHeight=function(k){return k>=this._size.length?-1:this._size[k][1]};x.setSpriteSource=function(k){this.dispose();this.pixelRatio=k.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new c(this._pageWidth-4,this._pageHeight-4);const g=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=g;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=k};x.getSpriteItem=
function(k,g=!1){var t=this._mosaicRects[k];if(t)return t;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;t=this._sprites.getSpriteInfo(k);if(!t||!t.width||!t.height||0>t.width||0>t.height)return null;const m=t.width,n=t.height,[B,E,z]=this._allocateImage(m,n);if(0>=B.width)return null;this._copy(B,t,E,z,g);t={rect:B,width:m,height:n,sdf:t.sdf,simplePattern:!1,pixelRatio:t.pixelRatio,page:E};return this._mosaicRects[k]=t};x.getSpriteItems=function(k){const g={};for(const t of k)g[t]=
this.getSpriteItem(t);return g};x.getMosaicItemPosition=function(k,g){g=(k=this.getSpriteItem(k,g))&&k.rect;if(!g)return null;g.width=k.width;g.height=k.height;const t=this._size[k.page];return{size:[k.width,k.height],tl:[(g.x+2)/t[0],(g.y+2)/t[1]],br:[(g.x+2+k.width)/t[0],(g.y+2+k.height)/t[1]],page:k.page}};x.bind=function(k,g,t=0,m=0){this._textures[t]||(this._textures[t]=new v(k,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[t][0],height:this._size[t][1]},new Uint8Array(this._mosaicsData[t].buffer)));
const n=this._textures[t];n.setSamplingMode(g);this._dirties[t]&&n.setData(new Uint8Array(this._mosaicsData[t].buffer));k.bindTexture(n,m);this._dirties[t]=!1};l._copyBits=function(k,g,t,m,n,B,E,z,r,C,H){let K=m*g+t;E=z*B+E;if(H)for(E-=B,H=-1;H<=C;H++,K=((H+C)%C+m)*g+t,E+=B)for(z=-1;z<=r;z++)n[E+z]=k[K+(z+r)%r];else for(t=0;t<C;t++){for(m=0;m<r;m++)n[E+m]=k[K+m];K+=g;E+=B}};x._copy=function(k,g,t,m,n,B){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(t>=this._mosaicsData.length)){var E=new Uint32Array(B?
B.buffer:this._sprites.image.buffer),z=this._mosaicsData[t];z&&E||console.error("Source or target images are uninitialized!");l._copyBits(E,B?g.width:this._sprites.width,g.x,g.y,z,m[0],k.x+2,k.y+2,g.width,g.height,n);this._dirties[t]=!0}};x._allocateImage=function(k,g){k+=2;g+=2;var t=Math.max(k,g);if(this._maxItemSize&&this._maxItemSize<t)return t=new a(0,0,k,g),this._mosaicsData.push(new Uint32Array(k*g)),this._dirties.push(!0),this._size.push([k,g]),this._textures.push(void 0),[t,this._mosaicsData.length-
1,[k,g]];t=k%4?4-k%4:4;let m=g%4?4-g%4:4;1===t&&(t=5);1===m&&(m=5);t=this._binPack.allocate(k+t,g+m);return 0>=t.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new c(this._pageWidth-4,this._pageHeight-4),this._allocateImage(k,g)):
[t,this._currentPage,[this._pageWidth,this._pageHeight]]};x.dispose=function(){this._binPack=null;this._mosaicRects={};for(const k of this._textures)k&&k.dispose();this._textures.length=0};return l}()})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(y){function F(v,h){return`${Math.round(10*v)/10}${h}`}y.drawColliders=function(v,h){const q=window.COLLISION_XRAY;for(let x=0;x<h.length;++x){const k=!h[x].unique.show;if(q||!k)for(const g of h[x].colliders){if(!g.enabled)continue;
var u=!h[x].unique.parts[g.partIndex].show;if(!q&&u)continue;var e=g.xScreen,b=g.yScreen;const t=g.dxScreen,m=g.dyScreen;v.globalAlpha=k||u?.2:1;u=v;var d=e-1,a=b-1;u.fillStyle="green";u.fillRect(d,a,3,3);u=v;d=e+t;a=b+m;var c=g.width,l=g.height;u.strokeStyle="red";u.strokeRect(d,a,c,l);u=v;e=e+t-1;b=b+m-1;u.fillStyle="blue";u.fillRect(e,b,3,3);v.globalAlpha=1}}};y.drawGridIndex=function(v,h){v.strokeStyle="black";const q=h.cellSize,u=h.rows,e=h.columns;for(let b=0;b<u;b++){const d=h.cells[b],a=b*
q,c=(b+1)*q;for(let l=0;l<e;l++){const x=d[l],k=l*q;v.strokeRect(k,a,(l+1)*q-k,c-a);v.fillText(`cells:${x.length}`,k+4,a+12)}}};y.perfAdd=function(v,h,q){if(window.PERFORMANCE_RECORDING_STORAGE){var u=window.PERFORMANCE_RECORDING_STORAGE;u.perf=u.perf||{};u=u.perf;u[v]=u[v]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:q};u[v].time+=h;u[v].samples.push(h);if(null==u[v].min||h<u[v].min)u[v].min=h;if(null==u[v].max||h>u[v].max)u[v].max=h}};y.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&
(window.PERFORMANCE_RECORDING_STORAGE.perf={})};y.perfElement=function(v){if(!window.PERFORMANCE_RECORDING_STORAGE){var h=document.createElement("div");h.innerHTML="No recorded data is present because performance recording is disabled.";return h}h=document.createElement("div");var q=window.PERFORMANCE_RECORDING_STORAGE.perf;var u='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${v}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;
const e=[];for(var b in q)e.push({name:b,value:q[b].time/q[b].samples.length,sortkey:q[b].max});e.sort((k,g)=>-(k.sortkey-g.sortkey));b=e.map(k=>k.name);for(var d of b)u+="\x3ctr\x3e",u+=`<td>${d}</td>`,u+=`<td>${F(q[d].time,q[d].unit)}</td>`,u+=`<td>${q[d].samples.length}</td>`,u+=`<td>${F(q[d].time/q[d].samples.length,q[d].unit)}</td>`,u+=`<td style="text-align: right;">${F(q[d].min,q[d].unit)}</td>`,u+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",u+=`<td>${F(q[d].max,q[d].unit)}</td>`,u+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",
u+="\x3c/tr\x3e";h.innerHTML=u+"\x3ctable\x3e";u=h.querySelectorAll("td[data-distribution\x3d'1']");d=h.querySelectorAll("td[data-histogram\x3d'1']");for(let k=0;k<u.length;k++){let g=u[k];var a=document.createElement("canvas");a.height=10;a.width=100;var c=a.getContext("2d");c.strokeStyle=v;c.beginPath();c.moveTo(0,5);c.lineTo(100,5);if(q[b[k]].max>q[b[k]].min+.001)for(const t of q[b[k]].samples){var l=(t-q[b[k]].min)/(q[b[k]].max-q[b[k]].min);c.moveTo(100*l,3);c.lineTo(100*l,7)}c.stroke();c.strokeRect((e[k].value-
q[b[k]].min)/(q[b[k]].max-q[b[k]].min)*100-2,0,4,9);g.appendChild(a);g=d[k];{a=Array(50);for(c=0;c<a.length;c++)a[c]=0;for(const m of q[b[k]].samples)c=(m-q[b[k]].min)/(q[b[k]].max-q[b[k]].min),a[1===c?a.length-1:Math.floor(c*a.length)]++;c=document.createElement("canvas");c.height=30;c.width=120;l=c.getContext("2d");l.strokeStyle=v;l.fillStyle=v;let t=0;for(var x=0;x<a.length;x++)t=Math.max(t,a[x]);for(x=0;x<a.length;x++){const m=a[x];l.fillRect(x*c.width/a.length,c.height*(1-m/t),c.width/a.length,
m/t*c.height)}l.beginPath();l.moveTo(0,c.height);l.lineTo(c.width,c.height);l.stroke();g.appendChild(c)}}v=h.querySelectorAll("td");for(q=0;q<v.length;q++)v[q].style.padding="5px";return h};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/maybe","../../../../core/LRUCache","../../tiling/TileKey","../../tiling/TileCoverage"],function(y,F,v,h,q){const u=(b,d)=>b+1/(1<<2*d);let e=function(){function b(a,
c){this._tiles=new Map;this._tileCache=new v(40,l=>l.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this._container=c}var d=b.prototype;d.destroy=function(){for(const [,a]of this._tiles)a.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null};d.update=function(a){this._updateCacheSize(a);const c=this.tileInfoView;a=c.getTileCoverage(a.state,0,"smallest");const {spans:l,lodInfo:x}=
a,{level:k}=x,g=new Set,t=new Set;for(const {row:n,colFrom:B,colTo:E}of l)for(let z=B;z<=E;z++){const r=h.getId(k,n,x.normalizeCol(z),x.getWorldForColumn(z)),C=this._getOrAcquireTile(r);g.add(r);C.processed()?this._addToContainer(C):t.add(new h(r))}for(const [n,B]of this._tiles)B.isCoverage=g.has(n);for(var m of t)this._findPlaceholdersForMissingTiles(m,g);m=!1;for(const [n,B]of this._tiles)B.neededForCoverage=g.has(n),B.neededForCoverage||B.isHoldingForFade&&c.intersects(a,B.key)&&g.add(n),B.isFading&&
(m=!0);for(const [n]of this._tiles)g.has(n)||this._releaseTile(n);q.pool.release(a);return!m};d.clear=function(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()};d.clearCache=function(){this._tileCache.clear()};d._findPlaceholdersForMissingTiles=function(a,c){var l=[];for(const [,x]of this._tiles)this._addPlaceholderChild(l,x,a,c);l=l.reduce(u,0);1E-6>Math.abs(1-l)||this._addPlaceholderParent(a.id,c)};d._addPlaceholderChild=function(a,c,l,x){if(!(c.key.level<=l.level)&&c.hasData()){{var k=
c.key;const g=k.level-l.level;k=l.row===k.row>>g&&l.col===k.col>>g&&l.world===k.world}k&&(this._addToContainer(c),x.add(c.id),a.push(c.key.level-l.level))}};d._addPlaceholderParent=function(a,c){for(;;){{const [x,k,g,t]=a.split("/");a=parseInt(x,10);a=0===a?null:`${a-1}/${parseInt(k,10)>>1}/${parseInt(g,10)>>1}/${parseInt(t,10)}`}if(!a||c.has(a))break;const l=this._getTile(a);if(l&&l.hasData()){this._addToContainer(l);c.add(l.id);break}}};d._getOrAcquireTile=function(a){let c=this._tiles.get(a);if(c)return c;
(c=this._tileCache.pop(a))||(c=this.acquireTile(new h(a)));this._tiles.set(a,c);return c};d._getTile=function(a){let c=this._tiles.get(a);if(c)return c;(c=this._tileCache.pop(a))&&this._tiles.set(a,c);return c};d._releaseTile=function(a){const c=this._tiles.get(a);this.releaseTile(c);this._removeFromContainer(c);this._tiles.delete(a);c.hasData()?this._tileCache.put(a,c,1):c.dispose()};d._addToContainer=function(a){let c;const l=[],x=this._container;if(!x.contains(a)){var k=this._visibleTiles;for(const [,
g]of k)this._canConnectDirectly(a,g)&&l.push(g),F.isNone(c)&&this._canConnectDirectly(g,a)&&(c=g);if(F.isSome(c)){for(const g of l)c.childrenTiles.delete(g),a.childrenTiles.add(g),g.parentTile=a;c.childrenTiles.add(a);a.parentTile=c}else for(const g of l)a.childrenTiles.add(g),g.parentTile=a;k.set(a.id,a);x.addChild(a)}};d._removeFromContainer=function(a){this._visibleTiles.delete(a.id);this._container.removeChild(a);if(F.isSome(a.parentTile)){a.parentTile.childrenTiles.delete(a);for(const c of a.childrenTiles)F.isSome(a.parentTile)&&
a.parentTile.childrenTiles.add(c)}for(const c of a.childrenTiles)c.parentTile=a.parentTile;a.parentTile=null;a.childrenTiles.clear()};d._canConnectDirectly=function(a,c){a=a.key;let {level:l,row:x,col:k,world:g}=c.key;for(c=this._visibleTiles;0<l;){l--;x>>=1;k>>=1;if(a.level===l&&a.row===x&&a.col===k&&a.world===g)return!0;if(c.has(`${l}/${x}/${k}/${g}`))break}return!1};d._updateCacheSize=function(a){a=a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var c=Math.ceil(a[0]/512)+1,
l=Math.ceil(a[1]/512)+1;this._viewSize[0]=a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*c*l}};return b}();y.TileManager=e;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ../../tiling/TileKey ../../tiling/TileCoverage ../webgl/TiledDisplayObject ../webgl/enums ../webgl/TileContainer ./decluttering/debugging ./decluttering/SymbolFader".split(" "),
function(y,F,v,h,q,u,e,b,d,a,c,l){function x(k,g){if(k){const t=k.getLayoutProperty("visibility");if(!t||1!==t.getValue()&&(void 0===k.minzoom||k.minzoom<g+1E-6)&&(void 0===k.maxzoom||k.maxzoom>=g-1E-6))return!0}return!1}a=function(k){function g(m){m=k.call(this,m)||this;m._backgroundTiles=[];m._pointToCallbacks=new Map;m._fading=!1;return m}F._inheritsLoose(g,k);var t=g.prototype;t.destroy=function(){this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);
this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null);v.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};t.setStyleResources=function(m,n,B){this._spriteMosaic=m;this._glyphMosaic=n;this._styleRepository=B;v.isNone(this._symbolFader)&&(m=new l.SymbolFader(this._styleRepository,this.children),m.on("fade-start",()=>{this.emit("fade-start");this._fading=!0;this.requestRender()}),
m.on("fade-complete",()=>{this.emit("fade-complete");this._fading=!1;this.requestRender()}),this._symbolFader=m);v.unwrap(this._symbolFader).styleRepository=B};t.deleteStyleLayers=function(m){v.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(m)};t.hitTest=async function(m,n){m=[m,n];n=h.createResolver();this._pointToCallbacks.set(m,n);this.requestRender();return n.promise};t.enterTileInvalidation=function(){for(const m of this.children)m.invalidating=!0};t.createRenderParams=function(m){return{...k.prototype.createRenderParams.call(this,
m),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};t.doRender=function(m){!this.visible||m.drawPhase!==d.WGLDrawPhase.MAP&&m.drawPhase!==d.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||k.prototype.doRender.call(this,m)};t.addChild=function(m){k.prototype.addChild.call(this,m);v.isSome(this._symbolFader)?this._symbolFader.addTile(m):m.decluttered=!0;this.requestRender();return m};t.removeChild=function(m){v.isSome(this._symbolFader)&&
this._symbolFader.removeTile(m);this.requestRender();return k.prototype.removeChild.call(this,m)};t.renderChildren=function(m){if(m.drawPhase===d.WGLDrawPhase.DEBUG)k.prototype.renderChildren.call(this,m);else if(this._doRender(m),0<this._pointToCallbacks.size){const {context:n}=m,B=n.getBoundFramebufferObject();m.drawPhase=d.WGLDrawPhase.HITTEST;const E=m.painter.effects.hittest;E.bind(m);this._doRender(m);E.draw(m,this._pointToCallbacks);n.bindFramebuffer(B)}};t.removeAllChildren=function(){for(let m=
0;m<this.children.length;m++){const n=this.children[m];v.isSome(this._symbolFader)&&this._symbolFader.removeTile(n);n.dispose()}k.prototype.removeAllChildren.call(this)};t.getStencilTarget=function(){return this.children.filter(m=>m.neededForCoverage&&m.hasData())};t.restartDeclutter=function(){v.isSome(this._symbolFader)&&this._symbolFader.restartDeclutter()};t._doRender=function(m){var {context:n}=m,B=this._styleRepository;if(B){var E=B.layers,z=!0;m.drawPhase===d.WGLDrawPhase.HITTEST&&(z=!1);0<
B.backgroundBucketIds.length&&(m.renderPass="background",this._renderBackgroundLayers(m,B.backgroundBucketIds));k.prototype.renderChildren.call(this,m);m.drawPhase===d.WGLDrawPhase.MAP&&this._fade(m.displayLevel,m.state);if((B=this.children.filter(M=>M.visible&&M.hasData()))&&0!==B.length){for(var r of B)r.triangleCount=0;n.setStencilWriteMask(0);n.setColorMask(!0,!0,!0,!0);n.setStencilOp(7680,7680,7681);n.setStencilTestEnabled(!0);n.setBlendingEnabled(!1);n.setDepthTestEnabled(!0);n.setDepthWriteEnabled(!0);
n.setDepthFunction(515);n.setClearDepth(1);n.clear(n.gl.DEPTH_BUFFER_BIT);m.renderPass="opaque";for(r=E.length-1;0<=r;r--)this._renderStyleLayer(E[r],m,B);n.setDepthWriteEnabled(!1);n.setBlendingEnabled(z);n.setBlendFunctionSeparate(1,771,1,771);m.renderPass="translucent";for(z=0;z<E.length;z++)this._renderStyleLayer(E[z],m,B);n.setDepthTestEnabled(!1);m.renderPass="symbol";for(z=0;z<E.length;z++)this._renderStyleLayer(E[z],m,B);n.bindVAO();n.setStencilTestEnabled(!0);n.setBlendingEnabled(!0);if(m.drawPhase===
d.WGLDrawPhase.MAP&&(m=window.COLLISION_DEBUG_CTX)&&v.isSome(this._symbolFader)&&(m.clearRect(0,0,m.canvas.width,m.canvas.height),!this._fading||window.COLLISION_XRAY))for(const M of this.children)if(M.symbols){const L=[];M.symbols.forEach(I=>{L.push(...I)});if(window.COLLISION_SHOW_GRID){var C,H,K;(n=null==(C=this._symbolFader)?void 0:null==(H=C._symbolDeclutterer)?void 0:null==(K=H._collisionJob)?void 0:K._gridIndex)&&c.drawGridIndex(m,n)}c.drawColliders(m,L)}}}};t._fade=function(m,n){v.isSome(this._symbolFader)&&
(this._symbolFader.update(m,n)||this.requestRender())};t._renderStyleLayer=function(m,n,B){const {painter:E,renderPass:z}=n;if(void 0!==m){var r=m.getLayoutProperty("visibility");if(!r||1!==r.getValue()){switch(m.type){case 0:return;case 1:if("opaque"!==z&&"translucent"!==n.renderPass)return;var C="vtlFill";break;case 2:if("translucent"!==z)return;C="vtlLine";break;case 4:if("symbol"!==z)return;C="vtlCircle";break;case 3:if("symbol"!==z)return;C="vtlSymbol"}B=3===m.type?B.filter(H=>H.decluttered):
B.filter(H=>H.neededForCoverage);if("vtlSymbol"!==C&&(r=n.displayLevel,0===B.length||void 0!==m.minzoom&&m.minzoom>=r+1E-6||void 0!==m.maxzoom&&m.maxzoom<r-1E-6))return;r=m.uid;n.styleLayerUID=r;n.styleLayer=m;for(const H of B)if(H.layerData.has(r)){E.renderObjects(n,B,C);break}}}};t._renderBackgroundLayers=function(m,n){const {context:B,displayLevel:E,painter:z,state:r}=m,C=this._styleRepository;var H=!1;for(var K of n)if(x(C.getLayerById(K),E)){H=!0;break}if(H){H=this._tileInfoView.getTileCoverage(m.state,
0,"smallest");var {spans:M,lodInfo:L}=H,{level:I}=L,Q=q.create();K=[];if(this._renderPasses){var S=this._renderPasses[0];v.isSome(this._clippingInfos)&&(S.brushes[0].prepareState(m,this._clippingInfos[0]),S.brushes[0].drawMany(m,this._clippingInfos))}S=this._backgroundTiles;var R=0;for(const {row:G,colFrom:O,colTo:P}of M)for(let U=O;U<=P;U++){if(R<S.length){var N=S[R];N.key.set(I,G,L.normalizeCol(U),L.getWorldForColumn(U));this._tileInfoView.getTileBounds(Q,N.key,!1);N.bounds=Q;N.coords[0]=Q[0];N.coords[1]=
Q[3]}else N=new u(I,G,L.normalizeCol(U),L.getWorldForColumn(U)),N=new b.TiledDisplayObject(N,this._tileInfoView.getTileBounds(q.create(),N),[512,512],[4096,4096]),S.push(N);N.setTransform(r,this._tileInfoView.getTileResolution(N.key));K.push(N);R++}B.setStencilWriteMask(0);B.setColorMask(!0,!0,!0,!0);B.setStencilOp(7680,7680,7681);B.setStencilFunction(514,0,255);I=!0;m.drawPhase===d.WGLDrawPhase.HITTEST&&(I=!1);B.setStencilTestEnabled(I);for(const G of n)n=C.getLayerById(G),x(n,E)&&(m.styleLayerUID=
n.uid,m.styleLayer=n,z.renderObjects(m,K,"vtlBackground"));e.pool.release(H)}};return g}(a["default"]);y.VectorTileContainer=a;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/Evented ./config ./core ./util ./jobs ./SymbolDeclutterer ./SymbolRepository".split(" "),function(y,F,v,h,q,u,e,b,d,a){h=function(c){function l(k,
g){var t=c.call(this)||this;t.styleRepository=k;t._tileToHandle=new Map;t._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};t._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};t._completed=!1;t._symbolRepository=new a.SymbolRepository(4096,g,()=>new u.VTLUniqueSymbol);t._symbolDeclutterer=new d.SymbolDeclutterer(g,t._symbolRepository,(m,n,B)=>new b.CollisionJob(m,n,B,t.styleRepository,t._zoom,t._viewState.rotation),(m,n)=>{m.allSymbolsFadingOut=!0;m.lastOpacityUpdate=n;e.writeOpacityToBuffers(m,
n,!0);m.decluttered=!0;m.requestRender()},(m,n)=>t.styleRepository.getStyleLayerByUID(m.styleLayerUID).z-t.styleRepository.getStyleLayerByUID(n.styleLayerUID).z,m=>(m=t.styleRepository.getStyleLayerByUID(m).getLayoutProperty("visibility"))&&1===m.getValue()?!1:!0);return t}F._inheritsLoose(l,c);var x=l.prototype;x.addTile=function(k){k.decluttered=!1;this._tileToHandle.set(k,k.on("symbols-changed",()=>{this._symbolRepository.add(k);this.restartDeclutter()}));this._symbolRepository.add(k);this.restartDeclutter()};
x.removeTile=function(k){const g=this._tileToHandle.get(k);g&&(this._symbolRepository.removeTile(k),this.restartDeclutter(),g.remove(),this._tileToHandle.delete(k))};x.update=function(k,g){this._zoom=k;this._viewState={scale:g.scale,rotation:g.rotation,center:[g.center[0],g.center[1]],size:[g.size[0],g.size[1]]};this._continueDeclutter();return this._completed};x.restartDeclutter=function(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()};x.clear=function(){this._completed=
!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(k=>k.remove());this._tileToHandle.clear()};x.deleteStyleLayers=function(k){this._symbolRepository.deleteStyleLayers(k)};x._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,
this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(q.DECLUTTER_BUDGET))&&this._scheduleNotifyStable()};x._scheduleNotifyStable=function(){v.isSome(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle);
this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*q.FADE_DURATION)};x._notifyUnstable=function(){v.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};F._createClass(l,[{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||
this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return l}(h);y.SymbolFader=h;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util"],function(y,F,v,h){let q=function(){function u(b,d,a,c,l,x){this._symbols=b;this._styleRepository=c;this._zoom=l;this._currentSymbolCursor=this._currentLayerCursor=0;
this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new h.GridIndex(d,a,v.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*x/180);this._co=Math.cos(Math.PI*x/180);for(const k of b)for(const g of k.symbols)this._allNeededMatrices.has(g.tile)||this._allNeededMatrices.set(g.tile,F.clone(g.tile.transforms.tileUnitsToPixels))}var e=u.prototype;e.work=function(b){const d=this._gridIndex,a=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,
this._currentSymbolCursor=0){const z=this._symbols[this._currentLayerCursor],r=this._getProperties(z.styleLayerUID);for(;this._currentSymbolCursor<z.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-a>b)return!1;var c=z.symbols[this._currentSymbolCursor];if(!c.unique.show)continue;{var l=c,x=this._si,k=this._co,g=this._allNeededMatrices.get(c.tile),t=this._zoom;const {iconRotationAlignment:L,textRotationAlignment:I,iconTranslate:Q,iconTranslateAnchor:S,
textTranslate:R,textTranslateAnchor:N}=r;var m=0;for(const G of l.colliders){const [O,P]=0===G.partIndex?Q:R;var n=0===G.partIndex?S:N,B=G.minLod<=t&&t<=G.maxLod;m+=B?0:1;G.enabled=B;G.xScreen=G.xTile*g[0]+G.yTile*g[3]+g[6];G.yScreen=G.xTile*g[1]+G.yTile*g[4]+g[7];0===n?(G.xScreen+=k*O-x*P,G.yScreen+=x*O+k*P):(G.xScreen+=O,G.yScreen+=P);1===(0===G.partIndex?L:I)?(G.dxScreen=G.dxPixels,G.dyScreen=G.dyPixels):(G.dxScreen=k*(G.dxPixels+G.width/2)-x*(G.dyPixels+G.height/2)-G.width/2,G.dyScreen=x*(G.dxPixels+
G.width/2)+k*(G.dyPixels+G.height/2)-G.height/2)}0<l.colliders.length&&m===l.colliders.length&&(l.unique.show=!1)}l=c.unique;if(!l.show)continue;const {iconAllowOverlap:C,iconIgnorePlacement:H,textAllowOverlap:K,textIgnorePlacement:M}=r;for(const L of c.colliders)if(L.enabled&&(x=l.parts[L.partIndex],x.show)){if(k=!(L.partIndex?K:C))a:{k=L.xScreen+L.dxScreen;g=L.yScreen+L.dyScreen;t=k+L.width;m=g+L.height;const [I,Q,S,R]=d.getCellSpan(k,g,t,m);for(n=Q;n<=R;n++)for(B=I;B<=S;B++){var E=d.cells[n][B];
for(const N of E){E=N.xScreen+N.dxScreen;const G=N.yScreen+N.dyScreen,O=E+N.width,P=G+N.height;if(!(t<E||k>O||m<G||g>P)){k=!0;break a}}}k=!1}k&&(L.hard?l.show=!1:x.show=!1)}if(l.show)for(const L of c.colliders){if(!L.enabled)continue;if(L.partIndex?M:H)continue;if(!l.parts[L.partIndex].show)continue;c=L.xScreen+L.dxScreen;x=L.yScreen+L.dyScreen;const [I,Q,S,R]=this._gridIndex.getCellSpan(c,x,c+L.width,x+L.height);for(c=Q;c<=R;c++)for(x=I;x<=S;x++)this._gridIndex.cells[c][x].push(L)}}}return!0};e._getProperties=
function(b){var d=this._styleProps.get(b);if(d)return d;d=this._zoom;const a=this._styleRepository.getStyleLayerByUID(b);var c=0!==a.getLayoutValue("symbol-placement",d);let l=a.getLayoutValue("icon-rotation-alignment",d);2===l&&(l=c?0:1);let x=a.getLayoutValue("text-rotation-alignment",d);2===x&&(x=c?0:1);c=a.getPaintValue("icon-translate",d);const k=a.getPaintValue("icon-translate-anchor",d),g=a.getPaintValue("text-translate",d),t=a.getPaintValue("text-translate-anchor",d);d={iconAllowOverlap:a.getLayoutValue("icon-allow-overlap",
d),iconIgnorePlacement:a.getLayoutValue("icon-ignore-placement",d),textAllowOverlap:a.getLayoutValue("text-allow-overlap",d),textIgnorePlacement:a.getLayoutValue("text-ignore-placement",d),iconRotationAlignment:l,textRotationAlignment:x,iconTranslateAnchor:k,iconTranslate:c,textTranslateAnchor:t,textTranslate:g};this._styleProps.set(b,d);return d};return u}();y.CollisionJob=q;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./config"],function(y,F,v,h){function q(e,b){if(e.priority-b.priority)return e.priority-b.priority;const d=e.tile.key,a=b.tile.key;return d.world-a.world?d.world-a.world:d.level-a.level?d.level-a.level:d.row-a.row?d.row-a.row:d.col-a.col?d.col-a.col:e.xTile-b.xTile?e.xTile-b.xTile:e.yTile-b.yTile}let u=function(){function e(d,a,c,l,x,k){this._visibleTiles=d;this._symbolRepository=a;this._createCollisionJob=c;this._assignTileSymbolsOpacity=
l;this._symbolLayerSorter=x;this._isLayerVisible=k;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var b=e.prototype;b.setScreenSize=function(d,a){this._screenWidth===d&&this._screenHeight===a||this.restart();this._screenWidth=d;this._screenHeight=a};b.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=
!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};b.continue=function(d){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var a=performance.now();if(!this._selectionJob.work(d))return!1;this._selectionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){a=
performance.now();if(!this._collisionJob.work(d))return!1;this._collisionJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){a=performance.now();if(!this._opacityJob.work(d))return!1;this._opacityJobCompleted=!0;d=Math.max(0,d-(performance.now()-a));if(0===d)return!1}this._running=!1;return!0};b._createSelectionJob=function(){const d=this._symbolRepository.uniqueSymbols,a=[];let c=0,l=
0;const x=this._isLayerVisible,k=this._symbolLayerSorter;return{work:function(g){const t=performance.now();for(;l<d.length;l++,c=0){const n=d[l];var m=n.styleLayerUID;if(!x(m)){a[l]||(a[l]={styleLayerUID:m,symbols:[]});continue}a[l]=a[l]||{styleLayerUID:m,symbols:[]};const B=a[l];for(;c<n.uniqueSymbols.length;c++){m=n.uniqueSymbols[c];if(99===c%100&&performance.now()-t>g)return!1;let E=null,z=!1,r=!1;for(const C of m.tileSymbols)if(C.selectedForRendering=!1,!r||!z){const H=C.tile;if(!E||H.isCoverage||
H.neededForCoverage&&!z){E=C;if(H.neededForCoverage||H.isCoverage)r=!0;H.isCoverage&&(z=!0)}}E.selectedForRendering=!0;if(r){B.symbols.push(E);m.show=!0;for(const C of m.parts)C.show=!0}else m.show=!1}}for(const n of a)n.symbols.sort(q);return!0},get sortedSymbols(){return a.sort(k)}}};b._createOpacityJob=function(){function d(x,k){var g=x.symbols;for(const [,m]of g){var t=m;g=k;for(const n of t){t=n.unique;for(const B of t.parts)B.startOpacity+=(g-B.startTime)/h.FADE_DURATION*(.5<B.targetOpacity?
1:-1),B.startOpacity=Math.min(Math.max(B.startOpacity,0),1),B.startTime=g,B.targetOpacity=t.show&&B.show?1:0}}a(x,k);for(const m of x.childrenTiles)d(m,k)}const a=this._assignTileSymbolsOpacity,c=this._visibleTiles;let l=0;return{work(x){const k=performance.now();for(;l<c.length;l++){if(performance.now()-k>x)return!1;const g=c[l];if(v.isSome(g.parentTile))continue;const t=performance.now();d(g,t)}return!0}}};F._createClass(e,[{key:"running",get:function(){return this._running}}]);return e}();y.SymbolDeclutterer=
u;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(y,F,v,h){let q=function(){function u(b,d,a){this.tileCoordRange=b;this._visibleTiles=d;this._createUnique=a;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var e=u.prototype;e.add=function(b,d){this._uniqueSymbolLayerArray=null;let a=this._tiles.get(b.id);
a||(a={symbols:new Map},this._tiles.set(b.id,a));var c=new Map;if(d)for(var l of d)a.symbols.has(l)&&(c.set(l,a.symbols.get(l)),a.symbols.delete(l));else for(var [x]of b.layerData)a.symbols.has(x)&&(c.set(x,a.symbols.get(x)),a.symbols.delete(x));this._removeSymbols(c);d=b.symbols;c=new Map;for(const [k,g]of d)if(l=g.length,32<=l){x=this.tileCoordRange;do x/=2,l/=4;while(8<l&&64<x);l=new h.GridIndex(this.tileCoordRange,this.tileCoordRange,x);c.set(k,{flat:g,index:l});a.symbols.set(k,{flat:g,index:l});
for(const t of g)l.getCell(t.xTile,t.yTile).push(t)}else c.set(k,{flat:g}),a.symbols.set(k,{flat:g});this._addSymbols(b.key,d)};e.deleteStyleLayers=function(b){this._uniqueSymbolLayerArray=null;for(const [d,a]of this._tiles){const c=new Map;for(const l of b)a.symbols.has(l)&&(c.set(l,a.symbols.get(l)),a.symbols.delete(l));this._removeSymbols(c);0===a.symbols.size&&this._tiles.delete(d)}};e.removeTile=function(b){this._uniqueSymbolLayerArray=null;const d=this._tiles.get(b.id);if(d){var a=new Map;for(const [c]of b.symbols)d.symbols.has(c)&&
(a.set(c,d.symbols.get(c)),d.symbols.delete(c));this._removeSymbols(a);0===d.symbols.size&&this._tiles.delete(b.id)}};e._removeSymbols=function(b){for(const [a,{flat:c}]of b)for(const l of c){b=l.unique;var d=b.tileSymbols;const x=d.length-1;for(let k=0;k<x;k++)if(d[k]===l){d[k]=d[x];break}d.length=x;0===x&&(d=this._uniqueSymbolsReferences.get(a),d.delete(b),0===d.size&&this._uniqueSymbolsReferences.delete(a));l.unique=null}};e._addSymbols=function(b,d){if(0!==d.size){var a=this._visibleTiles;for(const c of a)c.parentTile||
c.key.world!==b.world||c.key.level===b.level&&!c.key.equals(b)||this._matchSymbols(c,b,d);for(const [c,l]of d)for(const x of l)v.isNone(x.unique)&&(b=this._createUnique(),x.unique=b,b.tileSymbols.push(x),d=this._uniqueSymbolsReferences.get(c),d||(d=new Set,this._uniqueSymbolsReferences.set(c,d)),d.add(b))}};e._matchSymbols=function(b,d,a){if(b.key.level>d.level){var c=b.key.level-d.level;if(b.key.row>>c!==d.row||b.key.col>>c!==d.col)return}if(d.level>b.key.level&&(c=d.level-b.key.level,d.row>>c!==
b.key.row||d.col>>c!==b.key.col))return;if(d.equals(b.key))for(var l of b.childrenTiles)this._matchSymbols(l,d,a);else{l=new Map;for(const [g,t]of a){var x=[];for(const n of t)a=h.tileCoordChange(this.tileCoordRange,n.xTile,d.level,d.col,b.key.level,b.key.col),c=h.tileCoordChange(this.tileCoordRange,n.yTile,d.level,d.row,b.key.level,b.key.row),0<=a&&a<this.tileCoordRange&&0<=c&&c<this.tileCoordRange&&x.push({symbol:n,xTransformed:a,yTransformed:c});a=[];c=b.key.level<d.level?1:1<<b.key.level-d.level;
const m=this._tiles.get(b.id).symbols.get(g);if(m){const n=m.flat;for(const B of x){var k=!1;let E;const z=B.xTransformed,r=B.yTransformed;E=v.isSome(m.index)?m.index.getCell(z,r):n;x=B.symbol;const C=x.hash;for(const H of E)if(C===H.hash&&Math.abs(z-H.xTile)<=c&&Math.abs(r-H.yTile)<=c){k=H.unique;x.unique=k;k.tileSymbols.push(x);k=!0;break}k||a.push(x)}}0<a.length&&l.set(g,a)}for(const g of b.childrenTiles)this._matchSymbols(g,d,l)}};e._createUniqueSymbolLayerArray=function(){var b=this._uniqueSymbolsReferences;
const d=Array(b.size);let a=0;for(const [c,l]of b){const x=Array(l.size);b=0;for(const k of l)x[b++]=k;d[a]={styleLayerUID:c,uniqueSymbols:x};a++}return d};F._createClass(u,[{key:"uniqueSymbols",get:function(){v.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return u}();y.SymbolRepository=q;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../layers/support/TileInfo","./TileKey","./TileInfoView"],function(y,F,v,h){return function(q){function u(){var b=q.apply(this,arguments)||this;b._fullCacheLodInfos=null;b._levelByScale={};return b}y._inheritsLoose(u,q);var e=u.prototype;e.getTileParentId=function(b){b=v.pool.acquire(b);const d=0===b.level?null:v.getId(b.level-1,b.row>>1,b.col>>1,b.world);v.pool.release(b);return d};e.getTileCoverage=function(b,d,a){b=q.prototype.getTileCoverage.call(this,b,d,a);if(!b)return b;const c=1<<b.lodInfo.level;
b.spans=b.spans.filter(l=>0<=l.row&&l.row<c);return b};e.scaleToLevel=function(b){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[b])return this._levelByScale[b];{var d=this._fullCacheLodInfos;if(b>d[0].scale)return d[0].level;let a;for(let c=0;c<d.length-1;c++)if(a=d[c+1],b>a.scale)return d=d[c],d.level+(d.scale-b)/(d.scale-a.scale);return d[d.length-1].level}};e._initializeFullCacheLODs=function(b){b=0===b[0].level?b.map(d=>({level:d.level,resolution:d.resolution,
scale:d.scale})):F.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(d=>({level:d.level,resolution:d.resolution,scale:d.scale}));for(let d=0;d<b.length;d++)this._levelByScale[b[d].scale]=b[d].level;this._fullCacheLodInfos=b};return u}(h)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../Graphic ../../../core/Handles ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/style/StyleRepository ../tiling/TileQueue ../engine/vectorTiles/VectorTile ../../layers/LayerView ./LayerView2D ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTileContainer ../tiling/TileInfoViewPOT".split(" "),function(y,
F,v,h,q,u,e,b,d,a,c,l,x,k,g,t,m,n,B,E,z,r,C,H,K,M,L){function I(S){if(h.isNone(S))return 0;switch(S.type){case "partial":return Object.keys(S.diff).length;case "complete":return Math.max(Object.keys(S.oldValue).length,Object.keys(S.newValue).length);case "collection":return Object.keys(S.added).length+Object.keys(S.changed).length+Object.keys(S.removed).length}}const Q=q.getLogger("esri.views.2d.layers.VectorTileLayerView2D");v=function(S){function R(){var G=S.apply(this,arguments)||this;G._styleChanges=
[];G._handles=new t;G._fetchQueue=null;G._parseQueue=null;G._isTileHandlerReady=!1;G.fading=!1;return G}y._inheritsLoose(R,S);var N=R.prototype;N.initialize=function(){const G=this.layer.tileInfo;if((G&&G.spatialReference).equals(this.view.spatialReference)){var {style:O,spriteUrl:P,glyphsUrl:U}=this.layer.currentStyleInfo;this._styleRepository=new B(O,{spriteUrl:P,glyphsUrl:U});this._tileInfoView=new L(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new M.VectorTileContainer(this._tileInfoView);
this._tileHandler=new H.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0;this.notifyChange("updating");this.requestUpdate()}),this._vectorTileContainer.on("fade-complete",()=>{this.fading=!1;this.notifyChange("updating");this.requestUpdate()})])}else this.addResolvingPromise(Promise.reject(new a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
{layer:this.layer})))};N.destroy=function(){var G;this._stop();this.container.removeAllChildren();this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null);null==(G=this._tileHandler)?void 0:G.destroy();this._tileHandler=null};N.hitTest=async function(G,O){if(this.suspended||!this._tileHandlerPromise)return null;await this._tileHandlerPromise;G=await this._vectorTileContainer.hitTest(G,O);if(!G||0===G.length)return null;G=G[0]-1;var P=this._styleRepository;O=
P.getStyleLayerByUID(G);if(!O)return null;P=P.getStyleLayerIndex(O.id);G=new g({attributes:{layerId:P,layerName:O.id,layerUID:G}});G.layer=this.layer;G.sourceLayer=this.layer;return G};N.update=function(G){this._tileHandlerPromise&&this._isTileHandlerReady&&(G.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=G.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),
this._fetchQueue.state=G.state,this._parseQueue.state=G.state,this._tileManager.update(G)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};N.attach=function(){this._start();this._handles.add([this.layer.on("paint-change",G=>{if(G.isDataDriven)this._styleChanges.push({type:0,data:G}),this.notifyChange("updating"),this.requestUpdate();else{const P=this._styleRepository;var O=P.getLayerById(G.layerName);O&&(O=3===O.type,P.setPaintProperties(G.layerName,G.paint),O&&this._vectorTileContainer.restartDeclutter(),
this._vectorTileContainer.requestRender())}}),this.layer.on("layout-change",G=>{const O=this._styleRepository,P=O.getLayerById(G.layer);if(P){var U=m.diff(P.layout,G.layout);h.isNone(U)||(m.hasDiff(U,"visibility")&&1===I(U)?(O.setLayoutProperties(G.layer,G.layout),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:1,data:G}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",
G=>{const O=this._styleRepository,P=O.getLayerById(G.layer);P&&(O.setStyleLayerVisibility(G.layer,G.visibility),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",G=>{this._styleChanges.push({type:2,data:G});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",G=>{this._styleChanges.push({type:3,data:G});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",
()=>this._loadStyle())])};N.detach=function(){this._stop();this._handles.removeAll()};N.moveStart=function(){this.requestUpdate()};N.viewChange=function(){this.requestUpdate()};N.moveEnd=function(){this.requestUpdate()};N.canResume=function(){let G=S.prototype.canResume.call(this);var O=this.layer;if(G&&O.currentStyleInfo){const P=this.view.scale;(O=O.currentStyleInfo)&&O.layerDefinition&&(O=O.layerDefinition,O.minScale&&O.minScale<P&&(G=!1),O.maxScale&&O.maxScale>P&&(G=!1))}return G};N.isUpdating=
function(){const G=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<G.length&&0<G.filter(O=>O.invalidating).length||this.fading};N.acquireTile=function(G){const O=this._createVectorTile(G);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(O.key).then(P=>this._parseQueue.push({key:O.key,data:P})).then(P=>{O.once("attach",()=>this.requestUpdate());P&&(O.setData(P.tileData),this.requestUpdate(),
this.notifyChange("updating"))}).catch(P=>{this.notifyChange("updating");k.isAbortError(P)||Q.error(P)})});return O};N.releaseTile=function(G){G=G.key.id;this._fetchQueue.abort(G);this._parseQueue.abort(G);this.requestUpdate()};N._start=function(){this._stop();this._tileManager=new K.TileManager({acquireTile:P=>this.acquireTile(P),releaseTile:P=>this.releaseTile(P),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var G=new AbortController,O=this._tileHandler.start({signal:G.signal}).then(()=>
{this._fetchQueue=new E({tileInfoView:this._tileInfoView,process:(P,U)=>this._getTileData(P,U),concurrency:15});this._parseQueue=new E({tileInfoView:this._tileInfoView,process:(P,U)=>this._parseTileData(P,U),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(P=>{this._vectorTileContainer.setStyleResources(P,this._tileHandler.glyphMosaic,this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=G;this._tileHandlerPromise=O}};
N._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var G=this._tileHandlerAbortController;G&&G.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=null);this._vectorTileContainer.removeAllChildren()}};N._getTileData=async function(G,O){G=await this._tileHandler.fetchTileData(G,
O);this.notifyChange("updating");return G};N._parseTileData=async function(G,O){return this._tileHandler.parseTileData(G,O)};N._applyStyleChanges=async function(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var G=this._styleChanges;try{await this._tileHandler.updateStyle(G)}catch(Z){Q.error("error applying vector-tiles style update",Z.message),this._fetchQueue.resume(),this._parseQueue.resume(),
this._isTileHandlerReady=!0}const O=this._styleRepository,P=[];G.forEach(Z=>{3===Z.type&&(Z=O.getLayerById(Z.data.layerName))&&P.push(Z.uid)});const U=[];let Y;G.forEach(Z=>{const X=Z.data;switch(Z.type){case 0:O.setPaintProperties(X.layerName,X.paint);Y=X.layerName;break;case 1:O.setLayoutProperties(X.layerName,X.layout);Y=X.layerName;break;case 3:O.deleteStyleLayer(X.layerName);return;case 2:O.setStyleLayer(X.layer,X.index),Y=X.layer.id}(Z=O.getLayerById(Y))&&U.push(Z.uid)});G=this._vectorTileContainer.children;
if(0<P.length){this._vectorTileContainer.deleteStyleLayers(P);for(var ca of G)ca.deleteLayerData(P)}this._fetchQueue.resume();this._parseQueue.resume();if(0<U.length){ca=[];for(const Z of G)G=this._fetchQueue.push(Z.key).then(X=>this._parseQueue.push({key:Z.key,data:X,styleLayerUIDs:U})).then(X=>Z.setData(X.tileData)),ca.push(G);await Promise.all(ca)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()};N._loadStyle=async function(){const {style:G,spriteUrl:O,
glyphsUrl:P}=this.layer.currentStyleInfo;this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this.notifyChange("updating");this._styleRepository=new B(G,{spriteUrl:O,glyphsUrl:P});this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=k.createAbortController();var {signal:U}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,
G),await this._tileHandlerPromise}catch(Y){if(!k.isAbortError(Y))throw Y;}U.aborted||(U=await this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(U,this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()};N._createVectorTile=function(G){const O=this._tileInfoView.getTileBounds(n.create(),G);return new z.VectorTile(G,this._styleRepository,O,[512,512])};
return R}(C.LayerView2DMixin(r));F.__decorate([e.property()],v.prototype,"_fetchQueue",void 0);F.__decorate([e.property()],v.prototype,"_parseQueue",void 0);F.__decorate([e.property()],v.prototype,"_isTileHandlerReady",void 0);F.__decorate([e.property()],v.prototype,"suspended",void 0);F.__decorate([e.property()],v.prototype,"fading",void 0);F.__decorate([e.property()],v.prototype,"updating",void 0);return v=F.__decorate([d.subclass("esri.views.2d.layers.VectorTileLayerView2D")],v)});