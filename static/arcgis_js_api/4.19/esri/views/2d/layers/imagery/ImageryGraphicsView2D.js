// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/Extent ../../../../core/screenUtils ../../../../request ../../../../Graphic ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../../../support/GraphicsCollection ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../engine/Container ../graphics/GraphicsView2D ../graphics/GraphicContainer".split(" "),
function(p,f,d,t,K,g,u,v,L,M,N,n,w,q,x,y,z,A,B,C,D,E,F){const G=t.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");d=function(r){function l(){var a=r.apply(this,arguments)||this;a.attached=!1;a.container=new D.Container;a.updateRequested=!1;a._graphicsView=null;a._projectFullExtentPromise=null;a.type="Graphics";a._graphics=new B["default"];a._updateGraphics=n.debounce(async(e,k)=>{if(e.stationary){var c=e.state,h=new q({xmin:c.extent.xmin,ymin:c.extent.ymin,xmax:c.extent.xmax,ymax:c.extent.ymax,
spatialReference:c.spatialReference}),m=e.state.size[0],H=e.state.size[1];c={};c.timeExtent=a.timeExtent;c.requestAsImageElement=!1;c.signal=k;null==a._projectFullExtentPromise&&(a._projectFullExtentPromise=a._getProjectedFullExtent(h.spatialReference));k="vector-field"===a.layer.renderer.type?a.layer.renderer.symbolTileSize:50;var I=await a._projectFullExtentPromise;h=A.snapImageToSymbolTile(h,m,H,k,I);c=await a.layer.fetchImage(h.extent,h.width,h.height,c);m=a.layer.renderer;if("vector-field"===
m.type){a._pixelData={extent:h.extent,pixelBlock:c.pixelData.pixelBlock};const J=await m.getGraphicsFromPixelData(c.pixelData,"vector-uv"===a.layer.rasterInfo.dataType);a._graphicsView.update(e);await n.after(0).then(()=>{a._graphics.set("items",J)})}}});return a}p._inheritsLoose(l,r);var b=l.prototype;b.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};b.update=function(a){this._updateGraphics(a).catch(e=>{n.isAbortError(e)||G.error(e)})};b.hitTest=function(a,
e){a=this.view.toMap(x.createScreenPoint(a,e));return Promise.resolve(new z({attributes:{},geometry:a,layer:this.layer}))};b.attach=function(){this._graphicsView=new E({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new F(this.view.featuresTilingScheme)});this.attached=!0};b.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);this._graphicsView=null};b.moveStart=function(){};
b.viewChange=function(){};b.moveEnd=function(){};b.install=function(a){this.container.addChild(this._graphicsView.container);a.addChild(this.container)};b.uninstall=function(a){this.container.removeChild(this._graphicsView.container);a.removeChild(this.container)};b.isUpdating=function(){return this._graphicsView.updating||this.updateRequested};b.getPixelData=function(){return this.updating?null:this._pixelData};b.redraw=function(){};b.requestUpdate=function(){this.updateRequested||(this.updateRequested=
!0,this.view.requestUpdate())};b._getProjectedFullExtent=async function(a){try{return await C.projectExtent(this.layer.fullExtent,a)}catch(e){try{const k=(await y(this.layer.url,{query:{option:"footprints",outSR:a.wkid||JSON.stringify(a.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return k?q.fromJSON(k):null}catch{return null}}};p._createClass(l,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return l}(w);f.__decorate([g.property()],d.prototype,
"attached",void 0);f.__decorate([g.property()],d.prototype,"container",void 0);f.__decorate([g.property()],d.prototype,"layer",void 0);f.__decorate([g.property()],d.prototype,"timeExtent",void 0);f.__decorate([g.property()],d.prototype,"view",void 0);f.__decorate([g.property()],d.prototype,"updateRequested",void 0);f.__decorate([g.property()],d.prototype,"updating",null);f.__decorate([u.enumeration({graphics:"Graphics"})],d.prototype,"type",void 0);return d=f.__decorate([v.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],
d)});