// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/maybe ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),function(C,D,u,F,y,G,I,
H,E,B,z,v,a,g,b){var e;const h=G.getLogger("esri.layers.support.PixelBlock");u=e=function(m){function n(d){d=m.call(this,d)||this;d.width=null;d.height=null;d.pixelType="f32";d.validPixelCount=null;d.mask=null;d.maskIsAlpha=!1;d.pixels=null;d.statistics=null;return d}C._inheritsLoose(n,m);n.createEmptyBand=function(d,c){return new (e.getPixelArrayConstructor(d))(c)};n.getPixelArrayConstructor=function(d){let c;switch(d){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;case "u16":c=Uint16Array;
break;case "u32":c=Uint32Array;break;case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array}return c};var p=n.prototype;p.castPixelType=function(d){if(!d)return"f32";d=d.toLowerCase();-1<["u1","u2","u4"].indexOf(d)?d="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(d)&&(d="f32");return d};p.getPlaneCount=
function(){return this.pixels&&this.pixels.length};p.addData=function(d){if(!d.pixels||d.pixels.length!==this.width*this.height)throw new z("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(d.pixels);this.statistics.push(d.statistics||{minValue:null,maxValue:null})};p.getAsRGBA=function(){const d=new ArrayBuffer(this.width*this.height*
4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(d);break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)};p.getAsRGBAFloat=function(){const d=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(d);return d};p.updateStatistics=function(){this.statistics=this.pixels.map(f=>this._calculateBandStatistics(f,this.mask));const d=this.mask;let c=0;if(d)for(let f=0;f<d.length;f++)d[f]&&c++;else c=this.width*
this.height;this.validPixelCount=c};p.clamp=function(d){if(d&&"f64"!==d&&"f32"!==d){switch(d){case "u8":var c=[0,255];break;case "u16":c=[0,65535];break;case "u32":c=[0,4294967295];break;case "s8":c=[-128,127];break;case "s16":c=[-32768,32767];break;case "s32":c=[-2147483648,2147483647];break;default:c=[-3.4*1E39,3.4*1E39]}var [f,k]=c;c=this.pixels;var q=this.width*this.height,l=c.length,r=[];for(let M=0;M<l;M++){var w=e.createEmptyBand(d,q);var A=c[M];for(let J=0;J<q;J++){var x=A[J];w[J]=x>k?k:x<
f?f:x}r.push(w)}this.pixels=r;this.pixelType=d}};p.extractBands=function(d){if(y.isNone(d)||0===d.length||null==this.pixels||0===this.pixels.length)return this;var c=this.pixels.length;const f=d.some(k=>k>=this.pixels.length);c=c===d.length&&!d.some((k,q)=>k!==q);return f||c?this:new e({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:d.map(k=>this.pixels[k]),statistics:this.statistics&&d.map(k=>this.statistics[k])})};
p.clone=function(){const d=new e({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(d.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let c;const f=e.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){d.pixels=[];const k=this.pixels[0].slice;for(c=0;c<this.pixels.length;c++)d.pixels[c]=k?this.pixels[c].slice(0,this.pixels[c].length):new f(this.pixels[c])}if(this.statistics)for(d.statistics=
[],c=0;c<this.statistics.length;c++)d.statistics[c]=F.clone(this.statistics[c]);return d};p._fillFrom8Bit=function(d){const {mask:c,maskIsAlpha:f,pixels:k}=this;if(d&&k&&k.length){var q,l;var r=q=l=k[0];3<=k.length?(q=k[1],l=k[2]):2===k.length&&(q=k[1]);var w=new Uint32Array(d),A=this.width*this.height;if(r.length!==A)h.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(c&&c.length===A)if(f)for(d=0;d<A;d++)c[d]&&(w[d]=c[d]<<24|l[d]<<16|q[d]<<8|r[d]);else for(d=0;d<
A;d++)c[d]&&(w[d]=-16777216|l[d]<<16|q[d]<<8|r[d]);else for(d=0;d<A;d++)w[d]=-16777216|l[d]<<16|q[d]<<8|r[d]}else h.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};p._fillFromNon8Bit=function(d){const {pixels:c,mask:f,statistics:k}=this;if(d&&c&&c.length){var q=this.pixelType,l=1,r=0;l=1;k&&0<k.length?(r=k.map(J=>J.minValue).reduce((J,N)=>Math.min(J,N)),l=k.map(J=>J.maxValue-J.minValue).reduce((J,N)=>Math.max(J,N)),l=255/l):(l=255,"s8"===q?(r=-128,l=127):"u16"===
q?l=65535:"s16"===q?(r=-32768,l=32767):"u32"===q?l=4294967295:"s32"===q?(r=-2147483648,l=2147483647):"f32"===q?(r=-3.4*1E39,l=3.4*1E39):"f64"===q&&(r=-Number.MAX_VALUE,l=Number.MAX_VALUE),l=255/(l-r));d=new Uint32Array(d);q=this.width*this.height;var w,A,x;var M=w=A=c[0];if(M.length!==q)return h.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=c.length)if(w=c[1],3<=c.length&&(A=c[2]),f&&f.length===q)for(x=0;x<q;x++)f[x]&&(d[x]=-16777216|(A[x]-r)*l<<16|(w[x]-r)*l<<
8|(M[x]-r)*l);else for(x=0;x<q;x++)d[x]=-16777216|(A[x]-r)*l<<16|(w[x]-r)*l<<8|(M[x]-r)*l;else if(f&&f.length===q)for(x=0;x<q;x++)w=(M[x]-r)*l,f[x]&&(d[x]=-16777216|w<<16|w<<8|w);else for(x=0;x<q;x++)w=(M[x]-r)*l,d[x]=-16777216|w<<16|w<<8|w}else h.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};p._fillFrom32Bit=function(d){const {pixels:c,mask:f}=this;if(!d||!c||!c.length)return h.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");
let k,q,l,r;k=q=l=c[0];3<=c.length?(q=c[1],l=c[2]):2===c.length&&(q=c[1]);const w=this.width*this.height;if(k.length!==w)return h.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let A=0;if(f&&f.length===w)for(r=0;r<w;r++)d[A++]=k[r],d[A++]=q[r],d[A++]=l[r],d[A++]=f[r]&1;else for(r=0;r<w;r++)d[A++]=k[r],d[A++]=q[r],d[A++]=l[r],d[A++]=1};p._calculateBandStatistics=function(d,c){let f=Infinity,k=-Infinity;const q=d.length;let l,r=0;if(c)for(l=0;l<q;l++)c[l]&&(r=d[l],
f=r<f?r:f,k=r>k?r:k);else for(l=0;l<q;l++)r=d[l],f=r<f?r:f,k=r>k?r:k;return{minValue:f,maxValue:k}};return n}(b.JSONSupport);D.__decorate([I.property({json:{write:!0}})],u.prototype,"width",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"height",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"pixelType",void 0);D.__decorate([H.cast("pixelType")],u.prototype,"castPixelType",null);D.__decorate([I.property({json:{write:!0}})],u.prototype,"validPixelCount",void 0);
D.__decorate([I.property({json:{write:!0}})],u.prototype,"mask",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"maskIsAlpha",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"pixels",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"statistics",void 0);return u=e=D.__decorate([B.subclass("esri.layers.support.PixelBlock")],u)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock"],function(C,D){function u(a,
g){a=Math.min(Math.max(a,-100),100);g=Math.min(Math.max(g,-100),100);let b,e;const h=new Uint8Array(256);for(b=0;256>b;b++)0<a&&100>a?e=(200*b-25500+510*g)/(2*(100-a))+128:0>=a&&-100<a?e=(200*b-25500+510*g)*(100+a)/2E4+128:100===a?(e=200*b-25500+256*(100-a)+510*g,e=0<e?255:0):-100===a&&(e=128),h[b]=255<e?255:0>e?0:e;return h}function F(a,g,b,e,h,m,n,p){return{xmin:h<=b*a?0:h<b*a+a?h-b*a:a,ymin:m<=e*g?0:m<e*g+g?m-e*g:g,xmax:h+n<=b*a?0:h+n<b*a+a?h+n-b*a:a,ymax:m+p<=e*g?0:m+p<e*g+g?m+p-e*g:g}}function y(a,
g,b,e){var h=a.filter(O=>v(O))[0];if(null==h)return null;const m=e?e.width:g.width;e=e?e.height:g.height;const n=h.width,p=h.height,d=g.width/n;g=g.height/p;const c=b?b.x:0;b=b?b.y:0;const f=h.pixelType;var k=D.getPixelArrayConstructor(f);const q=h.pixels.length;h=[];let l,r;let w,A,x,M,J,N,R;for(A=0;A<q;A++){r=new k(m*e);for(x=0;x<g;x++)for(M=0;M<d;M++){var S=a[x*d+M];if(v(S))for(l=S.pixels[A],R=F(n,p,M,x,c,b,m,e),J=R.ymin;J<R.ymax;J++)for(S=(x*p+J-b)*m+(M*n-c),w=J*n,N=R.xmin;N<R.xmax;N++)r[S+N]=
l[w+N]}h.push(r)}let Q;if(a.some(O=>null==O||O.mask&&0<O.mask.length))for(Q=new Uint8Array(m*e),x=0;x<g;x++)for(M=0;M<d;M++)if(k=(S=a[x*d+M])?S.mask:null,R=F(n,p,M,x,c,b,m,e),k)for(J=R.ymin;J<R.ymax;J++)for(S=(x*p+J-b)*m+(M*n-c),w=J*n,N=R.xmin;N<R.xmax;N++)Q[S+N]=k[w+N];else if(S)for(J=R.ymin;J<R.ymax;J++)for(S=(x*p+J-b)*m+(M*n-c),w=J*n,N=R.xmin;N<R.xmax;N++)Q[S+N]=1;else for(J=R.ymin;J<R.ymax;J++)for(S=(x*p+J-b)*m+(M*n-c),w=J*n,N=R.xmin;N<R.xmax;N++)Q[S+N]=0;a=new D({width:m,height:e,pixels:h,pixelType:f,
mask:Q});a.updateStatistics();return a}function G(a){if(!v(a))return null;const g=a.clone(),{width:b,height:e,pixels:h,mask:m}=a;var n=h[0];a=g.pixels[0];for(let c=2;c<e-1;c++){const f=new Map;for(var p=c-2;p<c+2;p++)for(var d=0;4>d;d++){const k=p*b+d;E(f,n[k],m?m[k]:1)}a[c*b]=I(f);a[c*b+1]=a[c*b+2]=a[c*b];for(p=3;p<b-1;p++)d=(c-2)*b+p+1,E(f,n[d],m?m[d]:1),d=(c-1)*b+p+1,E(f,n[d],m?m[d]:1),d=c*b+p+1,E(f,n[d],m?m[d]:1),d=(c+1)*b+p+1,E(f,n[d],m?m[d]:1),d=(c-2)*b+p-3,H(f,n[d],m?m[d]:1),d=(c-1)*b+p-3,
H(f,n[d],m?m[d]:1),d=c*b+p-3,H(f,n[d],m?m[d]:1),d=(c+1)*b+p-3,H(f,n[d],m?m[d]:1),a[c*b+p]=I(f);a[c*b+p+1]=a[c*b+p]}for(n=0;n<b;n++)a[n]=a[b+n]=a[2*b+n],a[(e-1)*b+n]=a[(e-2)*b+n];g.updateStatistics();return g}function I(a){if(0===a.size)return 0;let g=0,b=-1,e=0;const h=a.keys();let m=h.next();for(;!m.done;)e=a.get(m.value),e>g&&(b=m.value,g=e),m=h.next();return b}function H(a,g,b){0!==b&&(b=a.get(g),1===b?a.delete(g):a.set(g,b-1))}function E(a,g,b){0!==b&&a.set(g,a.has(g)?a.get(g)+1:1)}function B(a,
g,b){let {x:e,y:h}=g;const {width:m,height:n}=b;if(0===e&&0===h&&n===a.height&&m===a.width)return a;const {width:p,height:d}=a;g=Math.max(0,h);const c=Math.max(0,e),f=Math.min(e+m,p),k=Math.min(h+n,d);if(0>f||0>k||!v(a))return null;e=Math.max(0,-e);h=Math.max(0,-h);const {pixels:q,mask:l}=a;var r=m*n,w=q.length;const A=[];for(var x=0;x<w;x++){var M=q[x],J=D.createEmptyBand(a.pixelType,r);for(let N=g;N<k;N++){const R=N*p;let S=(N+h-g)*m+e;for(let Q=c;Q<f;Q++)J[S++]=M[R+Q]}A.push(J)}r=new Uint8Array(r);
for(w=g;w<k;w++)for(x=w*p,M=(w+h-g)*m+e,J=c;J<f;J++)r[M++]=l?l[x+J]:1;a=new D({width:b.width,height:b.height,pixelType:a.pixelType,pixels:A,mask:r});a.updateStatistics();return a}function z(a,g=!0){if(!v(a))return null;const {pixels:b,width:e,height:h,mask:m,pixelType:n}=a;a=[];const p=Math.round(e/2),d=Math.round(h/2),c=h-1,f=e-1;for(var k=0;k<b.length;k++){var q=b[k],l=D.createEmptyBand(n,p*d),r=0;for(var w=0;w<h;w+=2)for(var A=0;A<e;A+=2){var x=q[w*e+A];if(g){var M=A===f?x:q[w*e+A+1];const J=w===
c?x:q[w*e+A+e],N=A===f?J:w===c?M:q[w*e+A+e+1];l[r++]=(x+M+J+N)/4}else l[r++]=x}a.push(l)}k=null;if(m)for(k=new Uint8Array(p*d),q=0,l=0;l<h;l+=2)for(r=0;r<e;r+=2)w=m[l*e+r],g?(A=r===f?w:m[l*e+r+1],x=l===c?w:m[l*e+r+e],M=r===f?x:l===c?A:m[l*e+r+e+1],k[q++]=w*A*x*M?1:0):k[q++]=w;return new D({width:p,height:d,pixelType:n,pixels:a,mask:k})}const v=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};C.approximateTransform=function(a,g,b,e,h="nearest"){if(!v(a))return null;
"majority"===h&&(a=G(a));const {pixels:m,mask:n,pixelType:p}=a,d=a.width;var c=a.height;a=D.getPixelArrayConstructor(p);var f=m.length;const {width:k,height:q}=g;g=e.cols;var l=e.rows;const r=Math.ceil(k/g),w=Math.ceil(q/l);e=!1;for(var A=0;A<b.length;A+=3)-1===b[A]&&-1===b[A+1]&&-1===b[A+2]&&(e=!0);let x,M,J,N,R,S;const Q=new Float32Array(k*q),O=new Float32Array(k*q);A=0;let U,P;const t="majority"===h?0:.5;for(let T=0;T<w;T++)for(let W=0;W<r;W++){x=12*(T*r+W);h=b[x];M=b[x+1];J=b[x+2];N=b[x+3];R=
b[x+4];S=b[x+5];for(var K=0;K<l;K++){A=(T*l+K)*k+W*g;P=(K+.5)/l;for(var L=0;L<K;L++)U=(L+.5)/g,Q[A+L]=Math.round((h*U+M*P+J)*d-t),O[A+L]=Math.round((N*U+R*P+S)*c-t)}x+=6;h=b[x];M=b[x+1];J=b[x+2];N=b[x+3];R=b[x+4];S=b[x+5];for(K=0;K<l;K++)for(A=(T*l+K)*k+W*g,P=(K+.5)/l,L=K;L<g;L++)U=(L+.5)/g,Q[A+L]=Math.round((h*U+M*P+J)*d-t),O[A+L]=Math.round((N*U+R*P+S)*c-t)}b=(T,W)=>{for(let V=0;V<q;V++){x=V*k;for(let X=0;X<k;X++)T[x]=0>Q[x]||0>O[x]?0:W[Q[x]+O[x]*d],x++}};c=[];for(l=0;l<f;l++)g=new a(k*q),b(g,m[l]),
c.push(g);a=new D({width:k,height:q,pixelType:p,pixels:c});if(n)a.mask=new Uint8Array(k*q),b(a.mask,n);else if(e)for(a.mask=new Uint8Array(k*q),f=0;f<k*q;f++)a.mask[f]=0>Q[f]||0>O[f]?0:1;a.updateStatistics();return a};C.clip=B;C.colorize=function(a,g){if(!v(a)||!g&&(g.indexedColormap||g.indexed2DColormap))return a;const b=a.clone();var e=b.pixels;let h=b.mask;const m=b.width*b.height;if(1!==e.length)return a;const {indexedColormap:n,indexed2DColormap:p,offset:d,alphaSpecified:c}=g;g=n.length-1;a=
0;e=e[0];const f=new Uint8Array(e.length),k=new Uint8Array(e.length),q=new Uint8Array(e.length);let l=0;if(n)if(h)for(a=0;a<m;a++)h[a]&&(l=4*(e[a]-d),l<d||l>g?h[a]=0:(f[a]=n[l],k[a]=n[l+1],q[a]=n[l+2],h[a]=n[l+3]));else{h=new Uint8Array(m);for(a=0;a<m;a++)l=4*(e[a]-d),l<d||l>g?h[a]=0:(f[a]=n[l],k[a]=n[l+1],q[a]=n[l+2],h[a]=n[l+3]);b.mask=h}else if(h)for(a=0;a<m;a++)h[a]&&(g=p[e[a]],f[a]=g[0],k[a]=g[1],q[a]=g[2],h[a]=g[3]);else{h=new Uint8Array(m);for(a=0;a<m;a++)g=p[e[a]],f[a]=g[0],k[a]=g[1],q[a]=
g[2],h[a]=g[3];b.mask=h}b.pixels=[f,k,q];b.statistics=null;b.pixelType="u8";b.maskIsAlpha=c;return b};C.createColormapLUT=function(a){if(a){var g=a.colormap;if(g&&0!==g.length){g=g.sort((c,f)=>c[0]-f[0]);var b=0;0>g[0][0]&&(b=g[0][0]);var e=Math.max(256,g[g.length-1][0]-b+1),h=new Uint8Array(4*e),m=[],n=0,p=0,d=5===g[0].length;if(65536<e)return g.forEach(c=>{m[c[0]-b]=d?c.slice(1):c.slice(1).concat([255])}),{indexed2DColormap:m,offset:b,alphaSpecified:d};if(a.fillUnspecified)for(a=g[p],n=a[0]-b;n<
e;n++)h[4*n]=a[1],h[4*n+1]=a[2],h[4*n+2]=a[3],h[4*n+3]=d?a[4]:255,n===a[0]-b&&(a=p===g.length-1?a:g[++p]);else for(n=0;n<g.length;n++)a=g[n],p=4*(a[0]-b),h[p]=a[1],h[p+1]=a[2],h[p+2]=a[3],h[p+3]=d?a[4]:255;return{indexedColormap:h,offset:b,alphaSpecified:d}}}};C.createContrastBrightnessLUT=u;C.createHistogramEqualizationLUT=function(a,g=256){g=Math.min(g,256);const {size:b,counts:e}=a;a=new Uint8Array(b);var h=e.reduce((c,f)=>c+f/g,0);let m=0;var n=0;let p=0,d=h;for(let c=0;c<b;c++)if(p+=e[c],!(c<
b-1&&p+e[c+1]<d)){for(;m<g-1&&d<p;)m++,d+=h;for(;n<=c;n++)a[n]=m;n=c+1}for(h=n;h<b;h++)a[h]=g-1;return a};C.createStretchLUT=function(a){const {minCutOff:g,maxCutOff:b,gamma:e,pixelType:h}=a,m=a.outMin||0,n=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(h))return null;const p=g.length;let d;let c=0;"s8"===h?c=-127:"s16"===h&&(c=-32767);let f=256;-1<["u16","s16"].indexOf(h)&&(f=65536);const k=[],q=n-m;for(d=0;d<p;d++)k[d]=b[d]-g[d];var l=e&&e.length>=p;const r=[];if(l)for(d=0;d<p;d++)r[d]=1<
e[d]?2<e[d]?6.5+(e[d]-2)**2.5:6.5+100*(2-e[d])**4:1;let w;const A=[];let x,M,J;if(l)for(d=0;d<p;d++){J=[];for(l=0;l<f;l++)x=l+c,w=(x-g[d])/k[d],M=1,1<e[d]&&(M-=(1/q)**(w*r[d])),J[l]=x<b[d]&&x>g[d]?Math.floor(M*q*w**(1/e[d]))+m:x>=b[d]?n:m;A[d]=J}else for(d=0;d<p;d++){J=[];for(l=0;l<f;l++)x=l+c,J[l]=x<=g[d]?m:x>=b[d]?n:Math.floor((x-g[d])/k[d]*q)+m;A[d]=J}if(null!=a.contrastOffset)for(a=u(a.contrastOffset,a.brightnessOffset),d=0;d<p;d++)for(J=A[d],l=0;l<f;l++)J[l]=a[J[l]];return{lut:A,offset:c}};C.estimateStatisticsFromHistograms=
function(a){const g=[];for(let m=0;m<a.length;m++){const {min:n,max:p,size:d,counts:c}=a[m];let f=0;var b=0;for(var e=0;e<d;e++)f+=c[e],b+=e*c[e];b/=f;e=0;for(var h=0;h<d;h++)e+=c[h]*(h-b)**2;h=(p-n)/d;g.push({min:n,max:p,avg:(b+.5)*h+n,stddev:Math.sqrt(e/(f-1))*h})}return g};C.estimateStatisticsHistograms=function(a){if(!v(a))return null;a.statistics||a.updateStatistics();const {pixels:g,mask:b,pixelType:e,statistics:h}=a;a=a.width*a.height;const m=g.length;let n,p;let d;var c;const f=[],k=[];for(d=
0;d<m;d++){var q=new Uint32Array(256);var l=g[d];if("u8"===e)if(n=-.5,p=255.5,b)for(c=0;c<a;c++)b[c]&&q[l[c]]++;else for(c=0;c<a;c++)q[l[c]]++;else{n=h[d].minValue;p=h[d].maxValue;var r=(p-n)/256;var w=new Uint32Array(257);if(b)for(c=0;c<a;c++)b[c]&&w[Math.floor((l[c]-n)/r)]++;else for(c=0;c<a;c++)w[Math.floor((l[c]-n)/r)]++;for(c=0;255>c;c++)q[c]=w[c];q[255]=w[255]+w[256]}f.push({min:n,max:p,size:256,counts:q});for(c=l=w=r=0;256>c;c++)r+=q[c],w+=c*q[c];w/=r;for(c=0;256>c;c++)l+=q[c]*(c-w)**2;q=Math.sqrt(l/
(r-1));r=(p-n)/256;c=(w+.5)*r+n;q*=r;k.push({min:n,max:p,avg:c,stddev:q})}return{statistics:k,histograms:f}};C.extractBands=function(a,g){if(null==g||!g.length||!v(a))return a;const b=a.pixels.length;return g&&g.some(e=>e>=b)||1===b&&1===g.length&&0===g[0]||b===g.length&&!g.some((e,h)=>e!==h)?a:new D({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:g.map(e=>a.pixels[e]),statistics:a.statistics&&g.map(e=>a.statistics[e])})};
C.getClipBounds=F;C.lookupPixels=function(a,g){if(!v(a))return null;const {pixels:b,mask:e}=a,h=a.width*a.height,m=b.length;let n=g.lut;({offset:g}=g);let p,d;n&&1===n[0].length&&(n=b.map(()=>n));const c=[];let f,k,q;if(g)if(null==e)for(p=0;p<m;p++){f=b[p];k=n[p];q=new Uint8Array(h);for(d=0;d<h;d++)q[d]=k[f[d]-g];c.push(q)}else for(p=0;p<m;p++){f=b[p];k=n[p];q=new Uint8Array(h);for(d=0;d<h;d++)e[d]&&(q[d]=k[f[d]-g]);c.push(q)}else if(null==e)for(p=0;p<m;p++){f=b[p];k=n[p];q=new Uint8Array(h);for(d=
0;d<h;d++)q[d]=k[f[d]];c.push(q)}else for(p=0;p<m;p++){f=b[p];k=n[p];q=new Uint8Array(h);for(d=0;d<h;d++)e[d]&&(q[d]=k[f[d]]);c.push(q)}a=new D({width:a.width,height:a.height,pixels:c,mask:e,pixelType:"u8"});a.updateStatistics();return a};C.mosaic=y;C.mosaicPixelData=function(a,g){if(!a||0===a.length)return null;var b=a.filter(k=>k.pixelBlock)[0];if(!b)return null;var e=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;const h=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,m=.01*Math.min(e,h),n=
a.sort((k,q)=>Math.abs(k.extent.ymax-q.extent.ymax)>m?q.extent.ymax-k.extent.ymax:Math.abs(k.extent.xmin-q.extent.xmin)>m?k.extent.xmin-q.extent.xmin:0);var p=Math.min.apply(null,n.map(k=>k.extent.xmin));const d=Math.min.apply(null,n.map(k=>k.extent.ymin)),c=Math.max.apply(null,n.map(k=>k.extent.xmax)),f=Math.max.apply(null,n.map(k=>k.extent.ymax));a={x:Math.round((g.xmin-p)/e),y:Math.round((f-g.ymax)/h)};p={width:Math.round((c-p)/e),height:Math.round((f-d)/h)};e={width:Math.round((g.xmax-g.xmin)/
e),height:Math.round((g.ymax-g.ymin)/h)};if(Math.round(p.width/b.pixelBlock.width)*Math.round(p.height/b.pixelBlock.height)!==n.length||0>a.x||0>a.y||p.width<e.width||p.height<e.height)return null;b=n.map(k=>k.pixelBlock);b=y(b,p,a,e);return{extent:g,pixelBlock:b}};C.remapColor=function(a,g){if(!v(a))return null;a=a.clone();var {pixels:b}=a;const e=a.width*a.height,h=g.length,m=Math.floor(h/2),n=g[Math.floor(m)];b=b[0];let p,d,c,f,k,q,l=!1;const r=new Uint8Array(e),w=new Uint8Array(e),A=new Uint8Array(e);
let x=a.mask;const M=4===g[0].mappedColor.length;x||(x=new Uint8Array(e),x.fill(M?255:1),a.mask=x);for(k=0;k<e;k++)if(x[k]){p=b[k];l=!1;q=m;d=n;c=0;for(f=h-1;1<f-c;){if(p===d.value){l=!0;break}p>d.value?c=q:f=q;q=Math.floor((c+f)/2);d=g[Math.floor(q)]}l||(p===g[c].value?(d=g[c],l=!0):p===g[f].value?(d=g[f],l=!0):p<g[c].value?(l=!1,d=null):p>g[c].value&&(p<g[f].value?(d=g[c],l=!0):f===h-1?(l=!1,d=null):(d=g[f],l=!0)));l?(r[k]=d.mappedColor[0],w[k]=d.mappedColor[1],A[k]=d.mappedColor[2],x[k]=d.mappedColor[3]):
r[k]=w[k]=A[k]=x[k]=0}a.pixels=[r,w,A];a.mask=x;a.pixelType="u8";a.maskIsAlpha=M;return a};C.resampleByMajority=G;C.setValidBoundary=function(a,g,b){if(!v(a))return null;const {width:e,height:h}=a,m=g.x;g=g.y;const n=b.width+m;b=b.height+g;if(0>m||0>g||n>e||b>h||0===m&&0===g&&n===e&&b===h)return a;a.mask||(a.mask=new Uint8Array(e*h));const p=a.mask;for(let d=0;d<h;d++){const c=d*e;for(let f=0;f<e;f++)p[c+f]=d<g||d>=b||f<m||f>=n?0:1}a.updateStatistics();return a};C.split=function(a,g,b){if(!v(a))return null;
const {width:e,height:h}=g;let {width:m,height:n}=a;const p=new Map,d={x:0,y:0};b=null==b?1:1+b;for(let c=0;c<b;c++){const f=Math.ceil(m/e),k=Math.ceil(n/h);for(let q=0;q<k;q++){d.y=q*h;for(let l=0;l<f;l++){d.x=l*e;const r=B(a,d,g);p.set(`${c}/${q}/${l}`,r)}}c<b-1&&(a=z(a));m=Math.round(m/2);n=Math.round(n/2)}return p};C.stretch=function(a,g){if(!v(a))return null;a=a.clone();const {pixels:b,mask:e}=a,{minCutOff:h,maxCutOff:m,gamma:n}=g,p=g.outMin||0;g=g.outMax||255;const d=a.width*a.height,c=b.length;
let f;let k,q,l;const r=g-p,w=[];for(f=0;f<c;f++)w[f]=m[f]-h[f];var A=n&&n.length>=c;const x=[];if(A)for(f=0;f<c;f++)x[f]=1<n[f]?2<n[f]?6.5+(n[f]-2)**2.5:6.5+100*(2-n[f])**4:1;if(A)if(null!=e)for(A=0;A<d;A++){if(e[A])for(f=0;f<c;f++)k=b[f][A],l=(k-h[f])/w[f],q=1,1<n[f]&&(q-=(1/r)**(l*x[f])),b[f][A]=k<m[f]&&k>h[f]?Math.floor(q*r*l**(1/n[f]))+p:k>=m[f]?g:p}else for(A=0;A<d;A++)for(f=0;f<c;f++)k=b[f][A],l=(k-h[f])/w[f],q=1,1<n[f]&&(q-=(1/r)**(l*x[f])),b[f][A]=k<m[f]&&k>h[f]?Math.floor(q*r*l**(1/n[f]))+
p:k>=m[f]?g:p;else if(null!=e)for(A=0;A<d;A++){if(e[A])for(f=0;f<c;f++)k=b[f][A],b[f][A]=k<m[f]&&k>h[f]?Math.floor((k-h[f])/w[f]*r)+p:k>=m[f]?g:p}else for(A=0;A<d;A++)for(f=0;f<c;f++)k=b[f][A],b[f][A]=k<m[f]&&k>h[f]?Math.floor((k-h[f])/w[f]*r)+p:k>=m[f]?g:p;a.pixelType="u8";a.updateStatistics();return a};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../core/unitUtils ../../../geometry/projection".split(" "),
function(C,D,u,F,y,G,I,H,E){function B(b,e,h,m=null){if(b.spatialReference.equals(e))return b;const n=g(b.spatialReference,e);if(n&&!E.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");h=h.center;b=new G({xmin:h.x-b.x/2,xmax:h.x+b.x/2,ymin:h.y-b.y/2,ymax:h.y+b.y/2,spatialReference:b.spatialReference});e=n?E.project(b,e,m):F.project(b,e);return null==e?null:{x:e.xmax-e.xmin,y:e.ymax-e.ymin}}function z(b,e=.01){return H.getMetersPerUnitForSR(b)?e/H.getMetersPerUnitForSR(b):
0}function v(b,e,h=null,m=!0){const n=b.spatialReference;if(n.equals(e))return b;const p=g(n,e);if(p&&!E.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((h=p?E.project(b,e,h):F.project(b,e))&&m&&e.isGeographic){var d,c;const [f,k]=n.isWebMercator?u.getInfo(n).origin:null!=(d=null==(c=u.getInfo(n))?void 0:c.valid)?d:[];(e=z(n))&&null!=f&&null!=k&&(Math.abs(b.x-f)<e&&5E-4>Math.abs(180-h.x)?h.x-=360:Math.abs(b.x-k)<e&&5E-4>Math.abs(180+h.x)&&(h.x+=
360))}return h}function a(b,e,h=null,m=!0){var n,p,d,c;const f=b.spatialReference;if(f.equals(e))return b;var k=g(f,e);if(k&&!E.isLoaded())throw new D("rasterprojectionhelper-projectExtent","projection engine is not loaded");k=k?E.project(b,e,h):F.project(b,e);let [q,l]=null!=(n=null==(p=u.getInfo(f))?void 0:p.origin)?n:[];k&&m&&f.isWebMercator&&e.isGeographic&&null!=q&&null!=l&&(.001>Math.abs(b.xmin-q)&&1E3<Math.abs(l-b.xmax)&&5E-4>Math.abs(180-k.xmax)&&(k.xmin=-180,m=[],m.push(new y(b.xmax,b.ymin,
f)),m.push(new y(b.xmax,(b.ymin+b.ymax)/2,f)),m.push(new y(b.xmax,b.ymax,f)),m=m.map(r=>v(r,e,h)).filter(r=>!isNaN(null==r?void 0:r.x)).map(r=>r.x),k.xmax=Math.max.apply(null,m)),.001>Math.abs(b.xmax-l)&&1E3<Math.abs(q-b.xmin)&&5E-4>Math.abs(180+k.xmin)&&(k.xmax=180,m=[],m.push(new y(b.xmin,b.ymin,f)),m.push(new y(b.xmin,(b.ymin+b.ymax)/2,f)),m.push(new y(b.xmin,b.ymax,f)),b=m.map(r=>v(r,e,h)).filter(r=>!isNaN(null==r?void 0:r.x)).map(r=>r.x),k.xmin=Math.min.apply(null,b)));[q,l]=e.isWebMercator?
u.getInfo(e).origin:null!=(d=null==(c=u.getInfo(e))?void 0:c.valid)?d:[];(d=z(e))&&null!=q&&null!=l&&(Math.abs(k.xmin-q)<d&&(k.xmin=q),Math.abs(k.xmax-l)<d&&(k.xmax=l));return k}const g=function(b,e){const h=(b.isWGS84||b.isWebMercator)&&(e.isWGS84||e.isWebMercator);return!(b.equals(e)||h)};C.computeProjectedScales=function(b,e,h=512,m=!0){const {extent:n,spatialReference:p,pixelSize:d}=b,c=B(new y({x:d.x,y:d.y,spatialReference:p}),e,n);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,
isCustomTilingScheme:!1};var f=(c.x+c.y)/2,k=H.getMetersPerUnitForSR(e);f=f*k*96*39.37;var q=e.isGeographic?512/h*2.958287637958547E8:512/h*5.91657527591555E8;h=!1;const l=a(n,e);m&&(e.isGeographic||e.isWebMercator)&&(h=0>l.xmin*l.xmax);e=f;if(h)e=q,b=1128.497176*k,k=B(new y({x:.29858214164761665,y:.29858214164761665,spatialReference:{wkid:3857}}),p,l),k.x*=e/b,k.y*=e/b;else{k={x:d.x,y:d.y};b=Math.ceil(Math.log(Math.min(b.width,b.height)/32)/Math.LN2);for(m=0;e<.5005*q&&m<b;)m++,e*=2,k.x*=2,k.y*=
2;1.001>=Math.max(e,q)/Math.min(e,q)&&(e=q)}b=[e];q=[{x:k.x,y:k.y}];for(f=Math.min(70.5310735,f)/1.001;e>=f;)e/=2,k.x/=2,k.y/=2,b.push(e),q.push({x:k.x,y:k.y});return{projectedPixelSize:c,scales:b,srcResolutions:q,isCustomTilingScheme:!h}};C.defaultGridSpacing=32;C.getDefaultDatumTransformationForDataset=function(b,e,h){if(!g(b.spatialReference,e))return null;if(!E.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");return h?E.getTransformation(e,b.spatialReference,
b):E.getTransformation(b.spatialReference,e,b)};C.getProjectionOffsetGrid=function(b,e,h,m=null,n=null,p=!1,d=[32,32]){var c,f;if(g(b.spatialReference,e.spatialReference)&&!E.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&e&&h))return null;const {xmin:k,ymin:q,xmax:l,ymax:r}=b;var w=b.spatialReference,A=e.spatialReference;const [x,M]=null!=(c=null==(f=u.getInfo(w))?void 0:f.valid)?c:[];var J=d[0]*h.x,N=d[1]*h.y;h=Math.ceil((l-k)/J-.1)+
1;c=Math.ceil((r-q)/N-.1)+1;f=[];b=!1;for(var R=0;R<h;R++){var S=[];for(var Q=0;Q<c;Q++){var O=new y({x:k+J*R,y:r-N*Q,spatialReference:w});O=v(O,A,m);n&&(O=n.inverseTransform(O));S.push(O);0<R&&p&&O&&U[Q]&&null!=x&&O.x<U[Q].x&&(O.x+=M-x);O?(f.push((O.x-e.xmin)/(e.xmax-e.xmin)),f.push((e.ymax-O.y)/(e.ymax-e.ymin))):(f.push(NaN),f.push(NaN),b=!0)}var U=S}e=[Math.abs((f[0]+f[4]+f[4*h]+f[4*h+4])/4-f[2*c+2]),Math.abs((f[1]+f[5]+f[4*c+1]+f[4*c+5])/4-f[2*c+3])];m=new Float32Array((h-1)*(c-1)*12);n=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]);p=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(U=0;U<h-1;U++){for(w=0;w<c-1;w++){Q=U*c*2+2*w;N=f[Q];A=f[Q+1];var P=f[Q+2],t=f[Q+3];Q+=2*c;R=f[Q];J=f[Q+1];S=f[Q+2];Q=f[Q+3];O=0;let K=12*(w*(h-1)+U);for(let L=0;3>L;L++)m[K++]=n[O++]*N+n[O++]*P+n[O++]*S;O=0;for(P=0;3>P;P++)m[K++]=n[O++]*A+n[O++]*t+n[O++]*Q;O=0;for(t=0;3>t;t++)m[K++]=p[O++]*N+p[O++]*R+p[O++]*S;O=0;for(N=0;3>N;N++)m[K++]=p[O++]*A+p[O++]*J+p[O++]*Q}if(b)for(w=0;w<m.length;w++)isNaN(m[w])&&(m[w]=-1)}return{offsets:f,
error:e,coefficients:m,spacing:d,size:[h-1,c-1]}};C.load=async function(){if(E.isLoaded()||!E.isSupported())return null;await E.load()};C.projectExtent=a;C.projectPoint=v;C.projectResolution=B;C.snapPyramid=function(b,e,h){var m=Math.log(b.x/e.pixelSize.x)/Math.LN2;const n=Math.log(b.y/e.pixelSize.y)/Math.LN2;b=e.storageInfo.maximumPyramidLevel||0;h="down"===h?Math.floor(Math.min(m,n)):"up"===h?Math.ceil(Math.max(m,n)):Math.round((m+n)/2);m=!1;0>h?h=0:h>b&&(m=h>b+3,h=b);b=2**h;e=new y({x:b*e.nativePixelSize.x,
y:b*e.nativePixelSize.y,spatialReference:e.spatialReference});return{pyramidLevel:h,pyramidResolution:e,excessiveReading:m}};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../core/maybe ../../../geometry/Point ../../../geometry ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper".split(" "),function(C,D,u,F,y,G){function I(B,z){if(!H.has(B))return null;B=H.get(B);return null==B[z]?null:B[z]}const H=
new Map,E=new y;C.decreaseRefCount=function(B,z,v){if(!H.has(B))return null==z?E.decreaseRefCount(B,v):0;const a=H.get(B);if(null==a[z])return E.decreaseRefCount(B,v);z=a[z].cache;if(z.has(v)){B=z.get(v);B.refCount--;if(0===B.refCount){z.delete(v);for(z=0;z<a.length;z++)a[z]&&a[z].cache.has(v)&&a[z].cache.delete(v);B.controller&&B.controller.abort()}return B.refCount}return 0};C.deleteBlock=function(B,z,v){if(H.has(B)){var a=H.get(B);null==a[z]?E.deleteBlock(B,v):a[z].cache.delete(v)}else null==z&&
E.deleteBlock(B,v)};C.deleteRaster=function(B){H.delete(B)};C.getBlock=function(B,z,v){if(!H.has(B))return null==z?E.getBlock(B,v):null;var a=H.get(B);if(null==a[z]){for(z=0;z<a.length;z++)if(a[z]&&a[z].cache.has(v))return v=a[z].cache.get(v),v.refCount++,v.block;return E.getBlock(B,v)}B=a[z].cache;if(B.has(v))return v=B.get(v),v.refCount++,v.block;for(let g=0;g<a.length;g++)if(g!==z&&a[g]&&a[g]&&a[g].cache.has(v))return a=a[g].cache.get(v),a.refCount++,B.set(v,a),a.block;return null};C.getRasterId=
function(B,z){return null==z?B:`${B}?sliceId=${z}`};C.putBlock=function(B,z,v,a,g=null){if(H.has(B)){var b=H.get(B);if(null==b[z])E.putBlock(B,v,a,g);else{var e={refCount:1,block:a,isResolved:!1,isRejected:!1,controller:g};a.then(()=>e.isResolved=!0).catch(()=>e.isRejected=!0);b[z].cache.set(v,e)}}else null==z&&E.putBlock(B,v,a,g)};C.register=function(B,z){z={extent:null,rasterInfo:z,cache:new Map};if(H.has(B))return B=H.get(B),B.push(z),B.length-1;H.set(B,[z]);return 0};C.unregister=function(B,z){if(H.has(B)){const v=
H.get(B);v[z]=null;v.some(a=>null!=a)||H.delete(B)}};C.update=function(B,z,v,a,g,b,e=null){B=I(B,z);z=B.extent;const {cache:h,rasterInfo:m}=B;if(!z||z.xmin!==v.xmin||z.xmax!==v.xmax||z.ymin!==v.ymin||z.ymax!==v.ymax){z=v.clone().normalize();var {spatialReference:n,transform:p}=m,d=new Set;for(let r=0;r<z.length;r++){var c=z[r];if(c.xmax-c.xmin<=a||c.ymax-c.ymin<=a)continue;var f=G.projectExtent(c,n,e);D.isSome(p)&&(f=p.inverseTransform(f));var k=new u({x:a,y:a,spatialReference:c.spatialReference});
if(null==g&&(g=G.projectResolution(k,n,c,e),!g))return;const {pyramidLevel:w,pyramidResolution:A,excessiveReading:x}=G.snapPyramid(g,m,b||"closest");if(x)return;({storageInfo:c}=m);var {origin:q}=c;k=Math.max(0,Math.floor((f.xmin-q.x)/A.x));q=Math.max(0,Math.floor((q.y-f.ymax)/A.y));const M=0<w?c.pyramidBlockWidth:c.blockWidth,J=0<w?c.pyramidBlockHeight:c.blockHeight;c=Math.max(0,Math.floor(k/M)-1);var l=Math.max(0,Math.floor(q/J)-1);k=Math.floor((k+Math.ceil((f.xmax-f.xmin)/A.x-.1)-1)/M)+1;f=Math.floor((q+
Math.ceil((f.ymax-f.ymin)/A.y-.1)-1)/J)+1;for(q=l;q<=f;q++)for(l=c;l<=k;l++)d.add(`${w}/${q}/${l}`)}h.forEach((r,w)=>{d.has(w)||(r=h.get(w),(null==r||r.isResolved||r.isRejected)&&h.delete(w))});B.extent={xmin:v.xmin,ymin:v.ymin,xmax:v.xmax,ymax:v.ymax}}};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function C(u=15E3,F=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=
u;this._interval=Math.min(u,F)}var D=C.prototype;D.decreaseRefCount=function(u,F){u=u+"/"+F;F=this._cachedBlocks;if(F.has(u)){const y=F.get(u);y.refCount--;0>=y.refCount&&(F.delete(u),y.controller&&y.controller.abort());return y.refCount}return 0};D.getBlock=function(u,F){u=u+"/"+F;F=this._cachedBlocks;if(F.has(u)){const y=F.get(u);y.ts=Date.now();y.refCount++;F.delete(u);F.set(u,y);return y.block}return null};D.putBlock=function(u,F,y,G=null){const I=this._cachedBlocks;u=u+"/"+F;I.has(u)?(y=I.get(u),
y.ts=Date.now(),y.refCount++):I.set(u,{block:y,ts:Date.now(),refCount:1,controller:G});this.trim();this.updateTimer()};D.deleteBlock=function(u,F){const y=this._cachedBlocks;u=u+"/"+F;y.has(u)&&y.delete(u)};D.updateMaxSize=function(u){this._size=u;this.trim()};D.empty=function(){this._cachedBlocks.clear();this.clearTimer()};D.getCurrentSize=function(){return this._cachedBlocks.size};D.updateTimer=function(){if(null==this._timer){var u=this._cachedBlocks;this._timer=setInterval(()=>{const F=Array.from(u),
y=Date.now();for(let G=0;G<F.length;G++)if(F[G][1].ts<=y-this._duration)u.delete(F[G][0]);else break;0===u.size&&this.clearTimer()},this._interval)}};D.trim=function(){const u=this._cachedBlocks;if(!(-1===this._size||this._size>=u.size)){var F=Array.from(u);for(let y=0;y<F.length-this._size;y++)u.delete(F[y][0])}};D.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return C}()})},"esri/views/support/drapedUtils":function(){define("exports ../../core/maybe ../../geometry/Extent ../../geometry ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(C,D,u,F,y,G){function I(E,B,z,v=new u){let a;if("2d"===z.type)a=B*z.resolution;else if("3d"===z.type){var g=z.overlayPixelSizeInMapUnits(E),b=z.basemapSpatialReference;a=D.isSome(b)&&!b.equals(z.spatialReference)?y.getMetersPerUnitForSR(b)/y.getMetersPerUnitForSR(z.spatialReference):B*g}B=E.x-a;g=E.y-a;b=E.x+a;E=E.y+a;({spatialReference:z}=z);v.xmin=Math.min(B,b);v.ymin=Math.min(g,E);v.xmax=Math.max(B,b);v.ymax=Math.max(g,E);v.spatialReference=z;return v}const H=new u;C.createQueryGeometry=
I;C.intersectsDrapedGeometry=function(E,B,z){E=z.toMap(E);if(D.isNone(E))return!1;const v=G.calculateTolerance();return I(E,v,z,H).intersects(B)};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(C){function D(y,G){return G?"xoffset"in G&&G.xoffset?Math.max(y,Math.abs(G.xoffset)):"yoffset"in G&&G.yoffset?Math.max(y,Math.abs(G.yoffset||0)):y:y}function u(y,G){if("number"===typeof y)return y;if(y&&y.stops&&y.stops.length){{y=
y.stops;let I=G=0;for(let H=0;H<y.length;H++){const E=y[H].size;"number"===typeof E&&(G+=E,I++)}y=G/I}return y}return G}function F(y,G){if(!G)return y;G=G.filter(E=>"size"===E.type).map(E=>{const {maxSize:B,minSize:z}=E;return(u(B,y)+u(z,y))/2});let I=0;const H=G.length;if(0===H)return y;for(let E=0;E<H;E++)I+=G[E];return Math.max(Math.floor(I/H),y)}C.calculateTolerance=function(y){const G=y&&y.renderer;y="touch"===(y&&y.event&&y.event.pointerType)?9:6;if(!G)return y;y="visualVariables"in G?F(y,G.visualVariables):
y;if("simple"===G.type)return D(y,G.symbol);if("unique-value"===G.type){let I=y;G.uniqueValueInfos.forEach(H=>{I=D(I,H.symbol)});return I}if("class-breaks"===G.type){let I=y;G.classBreakInfos.forEach(H=>{I=D(I,H.symbol)});return I}return y};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Graphic ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v,a,g,b,e,h){F=m=>{m=function(n){function p(){var c=n.apply(this,arguments)||this;c._rasterFieldPrefix="Raster.";c.layer=null;c.view=null;c.fullExtent=null;c.tileInfo=null;c.datumTransformation=null;return c}D._inheritsLoose(p,n);var d=p.prototype;d.fetchPopupFeatures=async function(c,f){const {layer:k}=this;if(!c)return Promise.reject(new z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:k}));var {popupEnabled:q}=k;f=h.getFetchPopupTemplate(k,
f);if(!q||!y.isSome(f))throw new z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:q,popupTemplate:f});q=[];({value:c}=await k.identify(c));if(c){var l,r;const A=c.join(", ");c={ObjectId:0};c["Raster.ServicePixelValue"]=this._formatAttributeValue(A,"Raster.ServicePixelValue");if((f=null==(l=k.rasterInfo)?void 0:null==(r=l.attributeTable)?void 0:r.features)&&0<f.length&&(l=f.filter(x=>String(x.attributes.value||x.attributes.Value||x.attributes.VALUE)===
A),0<l.length&&(l=l[0])))for(var w in l.attributes)l.attributes.hasOwnProperty(w)&&(r=this._rasterFieldPrefix+w,c[r]=this._formatAttributeValue(l.attributes[w],r));w=new b(this.fullExtent.clone(),null,c);w.layer=k;w.sourceLayer=w.layer;q.push(w)}return q};d.updateFullExtent=function(){var c=this.layer.tileInfo;let f;c&&c.spatialReference||(f=new z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));c=e.getDefaultDatumTransformationForDataset(this.layer.fullExtent,
this.view.spatialReference,!1);c=e.projectExtent(this.layer.fullExtent,this.view.spatialReference,c);null==c&&(f=new z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",c);this.datumTransformation||(this.datumTransformation=e.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0));return f?Promise.reject(f):Promise.resolve()};d._formatAttributeValue=function(c,
f){if("string"===typeof c&&(f=(f=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,f))&&f.format)){let k,q;return-1<c.trim().indexOf(",")?(k=",",q=k+" ",this._formatDelimitedString(c,k,q,f)):-1<c.trim().indexOf(" ")?(k=q=" ",this._formatDelimitedString(c,k,q,f)):this._formatNumberFromString(c,f)}return c};d._getFieldInfo=function(c,f){if(c&&c.length&&f){var k=f.toLowerCase(),q=void 0;c.some(l=>!l.fieldName||l.fieldName.toLowerCase()!==k&&l.fieldName.toLowerCase()!==
k.replace(/ /g,"_")?!1:(q=l,!0));return q}};d._formatDelimitedString=function(c,f,k,q){return c&&f&&k&&q?c.trim().split(f).map(l=>this._formatNumberFromString(l,q)).join(k):c};d._formatNumberFromString=function(c,f){if(!c||!f)return c;const k=Number(c);return isNaN(k)?c:f.format(k)};D._createClass(p,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return p}(m);u.__decorate([H.property()],
m.prototype,"layer",void 0);u.__decorate([H.property()],m.prototype,"view",void 0);u.__decorate([H.property()],m.prototype,"fullExtent",void 0);u.__decorate([H.property()],m.prototype,"tileInfo",void 0);u.__decorate([H.property({readOnly:!0})],m.prototype,"hasTilingEffects",null);return m=u.__decorate([B.subclass("esri.views.layers.ImageryTileLayerView")],m)};C.ImageryTileLayerView=F;C.default=F;Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../core/maybe","../../../layers/support/fieldUtils"],function(C,D,u){C.getFetchPopupTemplate=function(F,y){return F.popupTemplate?F.popupTemplate:D.isSome(y)&&y.defaultPopupTemplateEnabled&&D.isSome(F.defaultPopupTemplate)?F.defaultPopupTemplate:null};C.getRequiredFields=async function(F,y=F.popupTemplate){if(!D.isSome(y))return[];const G=await y.getRequiredFields(F.fields);({lastEditInfoEnabled:y}=y);const {objectIdField:I,typeIdField:H,globalIdField:E,relationships:B}=F;if(G.includes("*"))return["*"];
y=y?await u.getFeatureEditFields(F):[];const z=u.fixFields(F.fields,[...G,...y]);H&&z.push(H);z&&I&&u.hasField(F.fields,I)&&-1===z.indexOf(I)&&z.push(I);z&&E&&u.hasField(F.fields,E)&&-1===z.indexOf(E)&&z.push(E);B&&B.forEach(v=>{({keyField:v}=v);z&&v&&u.hasField(F.fields,v)&&-1===z.indexOf(v)&&z.push(v)});return z};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ../viewpointUtils ./webgl/enums ./brushes ./webgl/TileContainer ./RasterTile".split(" "),
function(C,D,u,F,y,G,I,H){I=function(E){function B(){var v=E.apply(this,arguments)||this;v.isCustomTilingScheme=!1;return v}D._inheritsLoose(B,E);var z=B.prototype;z.createTile=function(v){const a=this._getTileBounds(v);return new H.RasterTile(v,a,this._tileInfoView.tileInfo.size)};z.destroyTile=function(){};z.prepareRenderPasses=function(v){const a=v.registerRenderPass({name:"bitmap (tile)",brushes:[G.brushes.raster],target:()=>this.children.map(g=>g.bitmap),drawPhase:y.WGLDrawPhase.MAP});return[...E.prototype.prepareRenderPasses.call(this,
v),a]};z.doRender=function(v){this.visible&&v.drawPhase===y.WGLDrawPhase.MAP&&E.prototype.doRender.call(this,v)};z._getTileBounds=function(v){const a=this._tileInfoView.getTileBounds(u.create(),v);if(this.isCustomTilingScheme&&v.world){var {tileInfo:g}=this._tileInfoView,b=F.getWorldWidth(g.spatialReference);if(b){const {resolution:e}=g.lodAt(v.level);g=(b=b/e%g.size[0])?(g.size[0]-b)*e:0;a[0]-=g*v.world;a[2]-=g*v.world}}return a};return B}(I["default"]);C.RasterTileContainer=I;Object.defineProperty(C,
"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./webgl/TiledDisplayObject","./RasterBitmap"],function(C,D,u,F){u=function(y){function G(H,E,B,z=null){var v=y.call(this,H,E,B)||this;v.bitmap=new F.RasterBitmap(z,null,null);v.bitmap.coordScale=B;v.bitmap.once("isReady",()=>v.ready());return v}D._inheritsLoose(G,y);var I=G.prototype;I.destroy=function(){y.prototype.destroy.call(this);this.bitmap.destroy();this.stage=
this.bitmap=null};I.getMemoryUsage=function(){return this.bitmap.getMemoryUsage()};I.setTransform=function(H,E){y.prototype.setTransform.call(this,H,E);this.bitmap.transforms.dvs=this.transforms.dvs};I.onAttach=function(){this.bitmap.stage=this.stage};I.onDetach=function(){this.bitmap.stage=null};D._createClass(G,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(H){this.bitmap.stencilRef=H}}]);return G}(u.TiledDisplayObject);C.RasterTile=u;Object.defineProperty(C,"__esModule",
{value:!0})})},"esri/views/2d/engine/RasterBitmap":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../layers/support/rasterFunctions/pixelUtils ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ../../webgl/rasterUtils".split(" "),function(C,D,u,F,y,G,I,H,E){const B={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,
colormapOffset:null,type:"stretch"};H=function(z){function v(g=null,b=null,e=null){var h=z.call(this)||this;h._textureInvalidated=!0;h._memoryUsed=null;h._supportsBilinear=!0;h.stencilRef=0;h.coordScale=[1,1];h._symbolizerParameters=null;h.height=null;h.isRendereredSource=!1;h.pixelRatio=1;h.resolution=0;h.rotation=0;h._source=null;h.rawPixelData=null;h._suspended=!1;h._bandIds=null;h._interpolation=null;h._transformGrid=null;h.width=null;h.x=0;h.y=0;h.transforms={dvs:G.create()};h.source=g;h.transformGrid=
b;h.interpolation=e;return h}D._inheritsLoose(v,z);var a=v.prototype;a.destroy=function(){const g=this.getTextures();null==g?void 0:g.textures.forEach(b=>b.dispose());this._colormapTexture=this._transformGridTexture=this._rasterTexture=null};a.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())};a.setTransform=function(g){const b=F.identity(this.transforms.dvs),[e,h]=g.toScreenNoRotation([0,0],this.x,this.y);var m=this.resolution/this.pixelRatio/
g.resolution;const n=m*this.width;m*=this.height;const p=Math.PI*this.rotation/180;F.translate(b,b,I.fromValues(e,h));F.translate(b,b,I.fromValues(n/2,m/2));F.rotate(b,b,-p);F.translate(b,b,I.fromValues(-n/2,-m/2));F.scaleByVec2(b,b,I.fromValues(n,m));F.multiply(this.transforms.dvs,g.displayViewMat3,b)};a.getTextures=function(){if(!this._rasterTexture)return null;const g=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),g.push("u_transformGrid"));this._rasterTexture&&(b.push(this._rasterTexture),
g.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),g.push("u_colormap"));return{names:g,textures:b}};a.getMemoryUsage=function(){if(u.isNone(this._memoryUsed)){const g=this.getTextures();if(null==g)return 0;this._memoryUsed=g.textures.map(b=>b.descriptor.width*b.descriptor.height*4).reduce((b,e)=>b+e)}return this._memoryUsed};a.onAttach=function(){this.invalidateTexture()};a.onDetach=function(){this.invalidateTexture()};a.updateTexture=function({context:g}){if(this.stage)this._textureInvalidated&&
(this._textureInvalidated=!1,b=(b=this.source)&&b.pixels&&0<b.pixels.length,this._createOrDestroyRasterTexture(g),this._rasterTexture&&(b?(this._updateColormapTexture(g),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=E.createTransformTexture(g,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()));else{var b,e,h;null==(b=this._rasterTexture)?void 0:b.dispose();null==(e=this._transformGridTexture)?void 0:e.dispose();
null==(h=this._colormapTexture)?void 0:h.dispose();this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null}};a._createOrDestroyRasterTexture=function(g){var b,e;const h=this.source?y.extractBands(this.source,this.bandIds):null;if(h&&h.pixels&&0<h.pixels.length){var m=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(m)return;
this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}m=this.interpolation||"nearest";var n=this.isRendereredSource||!(null!=(b=g.capabilities.textureFloat)&&b.textureFloat);this._rasterTexture=E.createRasterTexture(g,h,m,n);this._supportsBilinear=null==(e=g.capabilities.textureFloat)?void 0:e.textureFloatLinear;this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};a._updateColormapTexture=
function(g){const b=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!b)this._colormapTexture=E.createColormapTexture(g,e),this._colormap=e;else if(e.length!==b.length||e.some((h,m)=>h!==b[m]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=E.createColormapTexture(g,e),this._colormap=e};D._createClass(v,[{key:"symbolizerParameters",
get:function(){return this._symbolizerParameters||B},set:function(g){this._symbolizerParameters=g}},{key:"source",get:function(){return this._source},set:function(g){this._source=g;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTextureBandIds=this._rasterTexture=null)}},{key:"suspended",get:function(){return this._suspended},set:function(g){this._suspended&&!g&&this.stage&&(this.ready(),this.requestRender());this._suspended=g}},{key:"bandIds",get:function(){return this._bandIds},
set:function(g){this._bandIds=g;this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(g){this._interpolation=g;this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==g&&"cubic"!==g?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(g){this._transformGrid=g;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}}]);
return v}(H.DisplayObject);C.RasterBitmap=H;Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v,a,g,b,e,h,m,n,p){const d=a.ofType({key:"type",base:e,typeMap:{rect:h,path:p,geometry:n}});C.LayerView2DMixin=c=>{c=function(f){function k(){var l=f.apply(this,arguments)||this;l.clips=new d;l.moving=!1;l.attached=!1;l.lastUpdateId=-1;l.updateRequested=!1;return l}D._inheritsLoose(k,f);var q=k.prototype;q.initialize=function(){var l;this.container||(this.container=new m.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([b.init(this,"suspended",r=>{this.container&&(this.container.visible=!r);this.view&&!r&&this.updateRequested&&this.view.requestUpdate()},!0),b.init(this,["layer.opacity","container"],()=>{if(this.container){var r,w;this.container.opacity=null!=(r=null==(w=this.layer)?void 0:w.opacity)?r:1}},!0),b.init(this,["layer.blendMode"],r=>{this.container&&(this.container.blendMode=r)},!0),b.init(this,["layer.effect"],r=>{this.container&&(this.container.effect=r)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(l=this.view)&&l.whenLayerView?this.view.whenLayerView(this.layer).then(r=>{r!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};q.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};q.isVisibleAtScale=
function(l){var r=!0,w=this.layer;const A=w.minScale;w=w.maxScale;if(null!=A&&null!=w){r=!A;let x=!w;!r&&l<=A&&(r=!0);!x&&l>=w&&(x=!0);r=r&&x}return r};q.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};q.processUpdate=function(l){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",l),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(l)))};q.isUpdating=
function(){return!1};q.isRendering=function(){return!1};q.canResume=function(){return f.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};D._createClass(k,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return k}(c);u.__decorate([I.property({type:d,set(f){f=g.referenceSetter(f,this._get("clips"),d);this._set("clips",f)}})],c.prototype,"clips",void 0);u.__decorate([I.property()],c.prototype,"moving",void 0);
u.__decorate([I.property()],c.prototype,"attached",void 0);u.__decorate([I.property()],c.prototype,"container",void 0);u.__decorate([I.property()],c.prototype,"suspended",void 0);u.__decorate([I.property({readOnly:!0})],c.prototype,"updateParameters",void 0);u.__decorate([I.property()],c.prototype,"updateRequested",void 0);u.__decorate([I.property()],c.prototype,"updating",null);u.__decorate([I.property()],c.prototype,"view",void 0);return c=u.__decorate([E.subclass("esri.views.2d.layers.LayerView2D")],
c)};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v){u=function(a){function g(){return a.apply(this,arguments)||this}C._inheritsLoose(g,a);return g}(v.JSONSupport);return u=D.__decorate([H.subclass("esri.views.layers.support.ClipArea")],u)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v){var a;u=a=function(g){function b(){var e=g.apply(this,arguments)||this;e.type="rect";e.left=null;e.right=null;e.top=null;e.bottom=null;return e}C._inheritsLoose(b,g);b.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};C._createClass(b,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return b}(v);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],u.prototype,"left",void 0);
D.__decorate([G.property({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0);D.__decorate([G.property({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0);D.__decorate([G.property({readOnly:!0})],u.prototype,"version",null);return u=a=D.__decorate([H.subclass("esri.views.layers.support.ClipRect")],u)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v,a,g,b,e,h){var m;u={base:v,key:"type",typeMap:{extent:a,polygon:g}};h=m=function(n){function p(){var d=n.apply(this,arguments)||this;d.type="geometry";d.geometry=null;return d}C._inheritsLoose(p,n);p.prototype.clone=function(){return new m({geometry:this.geometry.clone()})};C._createClass(p,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return p}(h);D.__decorate([G.property({types:u,json:{read:b.fromJSON,write:!0}})],h.prototype,"geometry",void 0);
D.__decorate([G.property({readOnly:!0})],h.prototype,"version",null);return h=m=D.__decorate([H.subclass("esri.views.layers.support.Geometry")],h)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(C,D,u,F,y,G,I,H,E,B,z,v){u=function(a){function g(){var b=a.apply(this,arguments)||this;b.type="path";b.path=[];return b}C._inheritsLoose(g,a);C._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(v);D.__decorate([G.property({type:[[[Number]]],json:{write:!0}})],u.prototype,"path",void 0);D.__decorate([G.property({readOnly:!0})],u.prototype,"version",null);return u=D.__decorate([H.subclass("esri.views.layers.support.Path")],u)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../core/screenUtils ../../../Graphic ../../../layers/support/PixelBlock ../../../core/watchUtils ../../../layers/support/TileInfo ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../layers/support/rasterDatasets/RawBlockCache ../../webgl/capabilities ../../layers/RefreshableLayerView ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../support/drapedUtils ../../layers/ImageryTileLayerView ../engine/RasterTileContainer ./LayerView2D".split(" "),function(C,
D,u,F,y,G,I,H,E,B,z,v,a,g,b,e,h,m,n,p,d,c,f,k,q,l,r,w,A,x,M,J,N,R){const S=y.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Q=[0,0];u=function(O){function U(){var t=O.apply(this,arguments)||this;t._tileStrategy=null;t._tileInfoView=null;t._fetchQueue=null;t._blockCacheRegistryUrl=null;t._blockCacheRegistryId=null;t._bitmapView=null;t._emptyTilePixelBlock=null;t._srcResolutions=null;t._previousLOD=null;t._needBlockCacheUpdate=!1;t._globalSymbolizerParams=null;t._symbolizerParams=null;t._abortController=
null;t._globalUpdateRequested=!1;t._isCustomTilingScheme=!1;t.useWebGLForProcessing=!0;t._redrawDebounced=a.debounce(K=>t._redrawImage(K),2E3);return t}C._inheritsLoose(U,O);var P=U.prototype;P.initialize=function(){const t=this.updateFullExtent();this.addResolvingPromise(t)};P.hitTest=function(t,K){if(this.suspended)return Promise.resolve(null);t=this.view.toMap(h.createScreenPoint(t,K));return Promise.resolve(new m({attributes:{},geometry:t}))};P.update=function(t){this._fetchQueue.pause();this._fetchQueue.state=
t.state;this._tileStrategy.update(t);this._fetchQueue.resume();const {extent:K,resolution:L,scale:T}=t.state;t=this._tileInfoView.getClosestInfoForScale(T);if(this.layer.raster){var W;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const V=this._srcResolutions[t.level],X=K.toJSON?K:b.fromJSON(K);k.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,X,L,V,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;(null==(W=this._previousLOD)?void 0:W.level)!==t.level&&
(this._previousLOD=t,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")};P.attach=function(){this.layer.increaseRasterJobHandlerUsage();q().supportsTextureFloat||(this.useWebGLForProcessing=!1);this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0);this._initializeTileInfo();this._tileInfoView=new r(this.tileInfo,this.fullExtent);this._fetchQueue=new w({tileInfoView:this._tileInfoView,concurrency:10,process:(K,
L)=>this.fetchTile(K,L)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new A({cachePolicy:"purge",resampling:!1,acquireTile:K=>this.acquireTile(K),releaseTile:K=>this.releaseTile(K),cacheSize:t,tileInfoView:this._tileInfoView});this._bitmapView=new N.RasterTileContainer(this._tileInfoView);this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme;this.container.addChild(this._bitmapView);this.handles.add([p.watch(this,["layer.bandIds","layer.renderer"],()=>this._redrawDebounced().catch(K=>
{a.isAbortError(K)||S.error(K)})),p.watch(this,["layer.interpolation"],(K,L)=>{"majority"!==K&&"majority"!==L||!this._canUseMajorityInterpolationOnDataSource()?this._redrawDebounced().catch(T=>{a.isAbortError(T)||S.error(T)}):this.refreshDebounced()}),p.watch(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach");this._updateBlockCacheRegistry()};P.detach=function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._tileStrategy.destroy();this._fetchQueue.clear();
this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};P.moveStart=function(){this.requestUpdate()};P.viewChange=function(){this.requestUpdate()};P.moveEnd=function(){if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=a.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>
{this._globalUpdateRequested=!1;this.requestUpdate()});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t);this.requestUpdate()};P.createFetchPopupFeaturesQueryGeometry=function(t,K){return M.createQueryGeometry(t,K,this.view)};P.doRefresh=async function(){this.updateRequested||this.suspended||(this.layer.updateRenderer(),this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(t=>this._enqueueTileFetch(t)),
this.notifyChange("updating"))};P.isUpdating=function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};P.acquireTile=function(t){t=this._bitmapView.createTile(t);const K=t.bitmap;[K.x,K.y]=this._tileInfoView.getTileCoords(Q,t.key);K.resolution=this._tileInfoView.getTileResolution(t.key);[K.width,K.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(t);this.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;
return t};P.releaseTile=function(t){this._fetchQueue.abort(t.key.id);this._bitmapView.removeChild(t);t.once("detach",()=>{t.destroy();this.requestUpdate()});this.requestUpdate()};P.fetchTile=function(t,K){K=!F.isNone(K)&&K.signal;const L=this._canUseWebGLForProcessing();K={tileInfo:this.tileInfo,signal:F.unwrap(K),registryId:this._blockCacheRegistryId,requestRawData:L,srcResolution:this._srcResolutions[t.level],datumTransformation:this.datumTransformation,interpolation:L?"nearest":this.layer.interpolation};
return this.layer.fetchTile(t.level,t.row,t.col,K)};P._canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};P._getCacheSize=function(t){return t?40:0};P._initializeTileInfo=function(){var t=this.view.spatialReference;const K=new g({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:t}),{scales:L,srcResolutions:T,isCustomTilingScheme:W}=f.computeProjectedScales(this.layer.rasterInfo,
t);t=d.create({spatialReference:t,size:512,scales:L});if(0===t.origin.x||t.origin.x>K.x)t.origin=K;this._isCustomTilingScheme=W;this._set("tileInfo",t);this._srcResolutions=null!=T?T:[]};P._enqueueTileFetch=async function(t,K){if(!this._fetchQueue.has(t.key.id)){try{const L=await this._fetchQueue.push(t.key),{bandIds:T}=this.layer;let W=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){W=!1;try{await this._redrawImage(this._abortController&&
this._abortController.signal)}catch(X){a.isAbortError(X)&&S.error(X)}this._globalUpdateRequested=!1}const V=this._canUseWebGLForProcessing();V&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams();if(L&&L.pixelBlock){const X={extent:L.extent,pixelBlock:L.pixelBlock};t.bitmap.rawPixelData=X;if(V)t.bitmap.source=L.pixelBlock,t.bitmap.isRendereredSource=!1;else{const Y=await this.layer.applyRenderer(X,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?
this._globalSymbolizerParams:null);t.bitmap.source=Y;t.bitmap.isRendereredSource=!0}t.bitmap.symbolizerParameters=V?this._globalSymbolizerParams||this._symbolizerParams:null;V?t.bitmap.transformGrid||(t.bitmap.transformGrid=L.transformGrid):t.bitmap.transformGrid=null}else{const X=this._createEmptyTilePixelBlock();t.bitmap.source=X;t.bitmap.symbolizerParameters=V?this._symbolizerParams:null;t.bitmap.transformGrid=null}t.bitmap.bandIds=T;t.bitmap.width=this._tileInfoView.tileInfo.size[0];t.bitmap.height=
this._tileInfoView.tileInfo.size[1];t.bitmap.interpolation=this._getLayerInterpolation();t.bitmap.suspended=W;t.bitmap.invalidateTexture();t.once("attach",()=>this.requestUpdate());this._bitmapView.addChild(t)}catch(L){a.isAbortError(L)||S.error(L)}this.requestUpdate()}};P._redrawImage=async function(t){this.layer.updateRenderer();this.hasTilingEffects?await this._updateGlobalSymbolizerParams(t):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const {bandIds:K}=this.layer;t=this._bitmapView.children.map(async L=>
{const T=this._canUseWebGLForProcessing();!T&&L.bitmap.rawPixelData?(L.bitmap.source=await this.layer.applyRenderer(L.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null),L.bitmap.isRendereredSource=!0):(L.bitmap.isRendereredSource&&L.bitmap.rawPixelData&&(L.bitmap.source=L.bitmap.rawPixelData.pixelBlock),L.bitmap.isRendereredSource=!1);L.bitmap.symbolizerParameters=T?this._globalSymbolizerParams||
this._symbolizerParams:null;L.bitmap.bandIds=K;L.bitmap.interpolation=this._getLayerInterpolation();L.bitmap.suspended=!1});await a.eachAlways(t);this.container.requestRender()};P._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){const t=this._tileInfoView.tileInfo.size[0],K=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new n({width:t,height:K,pixels:[new Uint8Array(t*K)],mask:new Uint8Array(t*K),pixelType:"u8"})}return this._emptyTilePixelBlock};P._updateGlobalSymbolizerParams=
async function(t){(t=await this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,{srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t}))&&t.pixelBlock&&(t=this.layer.symbolizer.generateWebGLParameters({pixelBlock:c.extractBands(t.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&
t&&"stretch"===t.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(t.factor=t.factor.map(K=>255*K),t.outMin=Math.round(255*t.outMin),t.outMax=Math.round(255*t.outMax)),this._globalSymbolizerParams=t)};P._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})};P._updateBlockCacheRegistry=
function(t=!1){const {url:K,rasterInfo:L,multidimensionalDefinition:T,raster:W}=this.layer;var V=null!=L&&L.multidimensionalInfo?W.getSliceIndex(T):null;V=k.getRasterId(K,V);V!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=k.register(V,this.layer.raster.rasterInfo),t&&(t=this._tileInfoView.getClosestInfoForScale(this.view.scale),k.update(V,this._blockCacheRegistryId,this.view.extent,
this.view.resolution,this._srcResolutions[t.level],this.layer.raster.ioConfig.sampling)),this._blockCacheRegistryUrl=V)};P._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:t,attributeTable:K,colormap:L,pixelType:T}=this.layer.rasterInfo;return 1===t&&(null!=K||null!=L||"u8"===T||"s8"===T)};P._getLayerInterpolation=function(){const t=this.layer.renderer.type;return"raster-colormap"===t||"unique-value"===t||"class-breaks"===t?"nearest":this.layer.interpolation};C._createClass(U,
[{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(t){if(this._tileStrategy&&this.useProgressiveUpdate!==t){this._tileStrategy.destroy();this._bitmapView.removeAllChildren();const K=this._getCacheSize(t);this._tileStrategy=new A({cachePolicy:"purge",resampling:!1,acquireTile:L=>this.acquireTile(L),releaseTile:L=>this.releaseTile(L),cacheSize:K,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",
t);this.requestUpdate()}}}]);return U}(J.ImageryTileLayerView(l.RefreshableLayerView(R.LayerView2DMixin(x))));D.__decorate([I.property()],u.prototype,"useProgressiveUpdate",null);return u=D.__decorate([E.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],u)});