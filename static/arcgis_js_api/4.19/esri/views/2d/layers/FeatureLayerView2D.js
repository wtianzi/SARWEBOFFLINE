// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/has ./core/Logger ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/property ./core/jsonMap ./core/accessorSupport/decorators/subclass ./core/urlUtils ./core/uuid ./portal/support/resourceExtension ./Graphic".split(" "),function(v,g,e,A,c,f,n,d,k,x,r,q){var D;e=D=function(w){function B(){var m=w.apply(this,arguments)||this;m.isAggregate=!0;return m}v._inheritsLoose(B,
w);var z=B.prototype;z.getEffectivePopupTemplate=function(m){return this.popupTemplate?this.popupTemplate:(m=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in m&&m.popupEnabled?m.popupTemplate:null};z.getObjectId=function(){return this.objectId};z.clone=function(){return new D({objectId:this.objectId,...this.cloneProperties()})};return B}(q);g.__decorate([f.property({type:Boolean})],e.prototype,"isAggregate",void 0);g.__decorate([f.property({type:Number,json:{read:!0}})],e.prototype,
"objectId",void 0);return e=D=g.__decorate([d.subclass("esri.AggregateGraphic")],e)})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(v){function g(c,f){return f?"xoffset"in f&&f.xoffset?Math.max(c,Math.abs(f.xoffset)):"yoffset"in f&&f.yoffset?Math.max(c,Math.abs(f.yoffset||0)):c:c}function e(c,f){if("number"===typeof c)return c;if(c&&c.stops&&c.stops.length){{c=c.stops;let n=f=0;for(let d=0;d<c.length;d++){const k=c[d].size;"number"===typeof k&&(f+=k,n++)}c=f/
n}return c}return f}function A(c,f){if(!f)return c;f=f.filter(k=>"size"===k.type).map(k=>{const {maxSize:x,minSize:r}=k;return(e(x,c)+e(r,c))/2});let n=0;const d=f.length;if(0===d)return c;for(let k=0;k<d;k++)n+=f[k];return Math.max(Math.floor(n/d),c)}v.calculateTolerance=function(c){const f=c&&c.renderer;c="touch"===(c&&c.event&&c.event.pointerType)?9:6;if(!f)return c;c="visualVariables"in f?A(c,f.visualVariables):c;if("simple"===f.type)return g(c,f.symbol);if("unique-value"===f.type){let n=c;f.uniqueValueInfos.forEach(d=>
{n=g(n,d.symbol)});return n}if("class-breaks"===f.type){let n=c;f.classBreakInfos.forEach(d=>{n=g(n,d.symbol)});return n}return c};Object.defineProperty(v,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../core/maybe ../../geometry/Extent ../../geometry ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),function(v,g,e,A,c,f){function n(k,x,r,q=new e){let D;if("2d"===r.type)D=x*r.resolution;else if("3d"===r.type){var w=r.overlayPixelSizeInMapUnits(k),
B=r.basemapSpatialReference;D=g.isSome(B)&&!B.equals(r.spatialReference)?c.getMetersPerUnitForSR(B)/c.getMetersPerUnitForSR(r.spatialReference):x*w}x=k.x-D;w=k.y-D;B=k.x+D;k=k.y+D;({spatialReference:r}=r);q.xmin=Math.min(x,B);q.ymin=Math.min(w,k);q.xmax=Math.max(x,B);q.ymax=Math.max(w,k);q.spatialReference=r;return q}const d=new e;v.createQueryGeometry=n;v.intersectsDrapedGeometry=function(k,x,r){k=r.toMap(k);if(g.isNone(k))return!1;const q=f.calculateTolerance();return n(k,q,r,d).intersects(x)};
Object.defineProperty(v,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../geometry/support/jsonUtils ../../../geometry ../../../TimeExtent ../../../tasks/support/Query".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D,w,B,z,m,p){var C;e=new d.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});d=new d.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});w=C=function(G){function K(E){E=G.call(this,E)||this;E.where=null;E.geometry=null;E.spatialRelationship="intersects";E.hiddenIds=new Set;E.distance=void 0;E.objectIds=null;E.units=null;E.timeExtent=null;E.enabled=!1;return E}v._inheritsLoose(K,G);var F=K.prototype;F.writeWhere=function(E,T){T.where=E||"1\x3d1"};F.enable=function(){this._set("enabled",!0)};
F.createQuery=function(E={}){const {where:T,geometry:H,spatialRelationship:L,timeExtent:I,objectIds:J,units:l,distance:y}=this;return new p({geometry:A.clone(H),objectIds:A.clone(J),spatialRelationship:L,timeExtent:A.clone(I),where:T,units:l,distance:y,...E})};F.clone=function(){const {where:E,geometry:T,spatialRelationship:H,hiddenIds:L,timeExtent:I,objectIds:J,units:l,distance:y}=this,M=new Set;L.forEach(P=>M.add(P));return new C({geometry:A.clone(T),hiddenIds:M,objectIds:A.clone(J),spatialRelationship:H,
timeExtent:A.clone(I),where:E,units:l,distance:y})};return K}(w.JSONSupport);g.__decorate([n.property({type:String})],w.prototype,"where",void 0);g.__decorate([x.writer("where")],w.prototype,"writeWhere",null);g.__decorate([n.property({types:z.geometryTypes,json:{read:B.fromJSON,write:!0}})],w.prototype,"geometry",void 0);g.__decorate([n.property({type:String,json:{read:{source:"spatialRel",reader:e.read},write:{target:"spatialRel",writer:e.write}}})],w.prototype,"spatialRelationship",void 0);g.__decorate([n.property({json:{write:(G,
K,F)=>K[F]=Array.from(G),read:G=>new Set(G)}})],w.prototype,"hiddenIds",void 0);g.__decorate([n.property({type:Number,json:{write:{overridePolicy(G){return{enabled:0<G}}}}})],w.prototype,"distance",void 0);g.__decorate([n.property({type:[Number],json:{write:!0}})],w.prototype,"objectIds",void 0);g.__decorate([n.property({type:String,json:{read:d.read,write:{writer:d.write,overridePolicy(G){return{enabled:G&&0<this.distance}}}}})],w.prototype,"units",void 0);g.__decorate([n.property({type:m,json:{write:!0}})],
w.prototype,"timeExtent",void 0);g.__decorate([n.property({readOnly:!0})],w.prototype,"enabled",void 0);return w=C=g.__decorate([k.subclass("esri.views.layers.support.FeatureFilter")],w)})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ./FeatureFilter".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D){var w;e=w=function(B){function z(){var m=B.apply(this,arguments)||this;m.filter=null;m.includedEffect=null;m.excludedEffect=null;m.excludedLabelsVisible=!1;return m}v._inheritsLoose(z,B);z.prototype.clone=function(){return new w({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return z}(q.JSONSupport);g.__decorate([f.property({type:D,json:{write:!0}})],
e.prototype,"filter",void 0);g.__decorate([f.property({json:{write:!0}})],e.prototype,"includedEffect",void 0);g.__decorate([f.property({json:{write:!0}})],e.prototype,"excludedEffect",void 0);g.__decorate([f.property({type:Boolean,json:{write:!0}})],e.prototype,"excludedLabelsVisible",void 0);return e=w=g.__decorate([d.subclass("esri.views.layers.support.FeatureEffect")],e)})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../layers/support/fieldUtils ../../core/watchUtils ../../layers/support/commonProperties ../../tasks/support/Query ./support/FeatureFilter ./support/FeatureEffect ./support/popupUtils".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D,w,B,z,m,p,C,G,K,F,E){const T=f.getLogger("esri.views.layers.FeatureLayerView");A=H=>{H=function(L){function I(...l){l=L.call(this,...l)||this;l._updatingRequiredFieldsPromise=null;l.effect=null;l.filter=null;l.timeExtent=null;l.layer=null;l.requiredFields=[];l.view=null;return l}g._inheritsLoose(I,L);var J=I.prototype;J.initialize=function(){p.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);p.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange())};J.highlight=function(l){throw Error("missing implementation");};J.createQuery=function(){var l={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};l=c.isSome(this.filter)?this.filter.createQuery(l):new G(l);c.isSome(this.timeExtent)&&(l.timeExtent=c.isSome(l.timeExtent)?l.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return l};J.queryFeatures=
function(l,y){throw Error("missing implementation");};J.queryObjectIds=function(l,y){throw Error("missing implementation");};J.queryFeatureCount=function(l,y){throw Error("missing implementation");};J.queryExtent=function(l,y){throw Error("missing implementation");};J._loadArcadeModules=function(l){if(l.get("expressionInfos.length"))return z.loadArcade()};J._handleRequiredFieldsChange=function(){const l=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",l);l.then(()=>{this._updatingRequiredFieldsPromise===
l&&this._set("_updatingRequiredFieldsPromise",null)})};J._updateRequiredFields=async function(){if(this.layer&&this.view){var l="3d"===this.view.type,{layer:y,layer:{fields:M,objectIdField:P,renderer:Y,displayField:Z}}=this,W=y.featureReduction,O=new Set;W=await B.eachAlways([Y?Y.collectRequiredFields(O,M):null,m.collectLabelingFields(O,y),l?m.collectElevationFields(O,y):null,c.isSome(this.filter)?m.collectFilterFields(O,y,this.filter):null,this.effect?m.collectFilterFields(O,y,this.effect.filter):
null,W?m.collectFeatureReductionFields(O,y,W):null]);y.timeInfo&&this.timeExtent&&m.collectFields(O,y.fields,[y.timeInfo.startField,y.timeInfo.endField]);"feature"===y.type&&y.floorInfo&&m.collectFields(O,y.fields,[y.floorInfo.floorField]);for(const ca of W)ca.error&&T.error(ca.error);m.collectField(O,M,P);l&&Z&&m.collectField(O,M,Z);l=Array.from(O).sort();this._set("requiredFields",l)}};J.validateFetchPopupFeatures=function(l){const {layer:y,layer:{popupEnabled:M}}=this;if(!M)return new r("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:y});if(!E.getFetchPopupTemplate(this.layer,l))return new r("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:y})};J.fetchClientPopupFeatures=async function(l){const y=c.isSome(l)?l.clientGraphics:null;if(!y||0===y.length)return Promise.resolve([]);const M=[],P=[],{layer:Y}=this;var Z=E.getFetchPopupTemplate(Y,l);if(!c.isSome(Z))return Promise.resolve([]);var W=await this._loadArcadeModules(Z);Z=W&&W.arcadeUtils.hasGeometryOperations(Z);
l=await this.createPopupQuery(l);W=m.unpackFieldNames(Y.fields,l.outFields);for(const O of y)Z||!m.featureHasFields(W,O)?P.push(O):M.push(O);if("stream"===Y.type||0===P.length)return Promise.resolve(M);l.objectIds=P.map(O=>O.attributes[Y.objectIdField]);return Y.queryFeatures(l).then(O=>M.concat(O.features)).catch(()=>P)};J.createPopupQuery=async function(l){var y=this.layer;const M=y.createQuery();l=E.getFetchPopupTemplate(y,l);var P=c.isSome(l)&&await this._loadArcadeModules(l);P=c.isSome(l)&&P&&
P.arcadeUtils.hasGeometryOperations(l);y=!("point"!==y.geometryType&&!P);M.returnGeometry=y;M.returnZ=y;M.returnM=y;M.outFields=await E.getRequiredFields(this.layer,l);M.outSpatialReference=this.view.spatialReference;return M};J.canResume=function(){return!L.prototype.canResume.call(this)||c.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};g._createClass(I,[{key:"availableFields",get:function(){const {layer:l,layer:{fields:y},requiredFields:M}=this;return"outFields"in l&&l.outFields?m.fixFields(y,
[...m.unpackFieldNames(y,l.outFields),...M]):m.fixFields(y,M)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(l){T.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return I}(H);e.__decorate([d.property()],H.prototype,"_updatingRequiredFieldsPromise",void 0);e.__decorate([d.property({readOnly:!0})],H.prototype,"availableFields",null);e.__decorate([d.property({type:F})],
H.prototype,"effect",void 0);e.__decorate([d.property({type:K})],H.prototype,"filter",void 0);e.__decorate([d.property(C.combinedViewLayerTimeExtentProperty)],H.prototype,"timeExtent",void 0);e.__decorate([d.property()],H.prototype,"layer",void 0);e.__decorate([d.property({type:Number})],H.prototype,"maximumNumberOfFeatures",null);e.__decorate([d.property({readOnly:!0,type:Boolean})],H.prototype,"maximumNumberOfFeaturesExceeded",null);e.__decorate([d.property({readOnly:!0})],H.prototype,"requiredFields",
void 0);e.__decorate([d.property()],H.prototype,"suspended",void 0);e.__decorate([d.property()],H.prototype,"view",void 0);return H=e.__decorate([x.subclass("esri.views.layers.FeatureLayerView")],H)};v.FeatureLayerView=A;v.default=A;Object.defineProperty(v,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(v,g,e){v.getFetchPopupTemplate=function(A,c){return A.popupTemplate?A.popupTemplate:
g.isSome(c)&&c.defaultPopupTemplateEnabled&&g.isSome(A.defaultPopupTemplate)?A.defaultPopupTemplate:null};v.getRequiredFields=async function(A,c=A.popupTemplate){if(!g.isSome(c))return[];const f=await c.getRequiredFields(A.fields);({lastEditInfoEnabled:c}=c);const {objectIdField:n,typeIdField:d,globalIdField:k,relationships:x}=A;if(f.includes("*"))return["*"];c=c?await e.getFeatureEditFields(A):[];const r=e.fixFields(A.fields,[...f,...c]);d&&r.push(d);r&&n&&e.hasField(A.fields,n)&&-1===r.indexOf(n)&&
r.push(n);r&&k&&e.hasField(A.fields,k)&&-1===r.indexOf(k)&&r.push(k);x&&x.forEach(q=>{({keyField:q}=q);r&&q&&e.hasField(A.fields,q)&&-1===r.indexOf(q)&&r.push(q)});return r};Object.defineProperty(v,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D,w,B,z,m,p,C,G){const K=D.ofType({key:"type",base:z,typeMap:{rect:m,path:G,geometry:C}});v.LayerView2DMixin=F=>{F=function(E){function T(){var L=E.apply(this,arguments)||this;L.clips=new K;L.moving=!1;L.attached=!1;L.lastUpdateId=-1;L.updateRequested=!1;return L}g._inheritsLoose(T,E);var H=T.prototype;H.initialize=function(){var L;this.container||(this.container=new p.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([B.init(this,"suspended",I=>{this.container&&(this.container.visible=!I);this.view&&!I&&this.updateRequested&&this.view.requestUpdate()},!0),B.init(this,["layer.opacity","container"],()=>{if(this.container){var I,J;this.container.opacity=null!=(I=null==(J=this.layer)?void 0:J.opacity)?I:1}},!0),B.init(this,["layer.blendMode"],I=>{this.container&&(this.container.blendMode=I)},!0),B.init(this,["layer.effect"],I=>{this.container&&(this.container.effect=I)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(L=this.view)&&L.whenLayerView?this.view.whenLayerView(this.layer).then(I=>{I!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};H.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};H.isVisibleAtScale=
function(L){var I=!0,J=this.layer;const l=J.minScale;J=J.maxScale;if(null!=l&&null!=J){I=!l;let y=!J;!I&&L<=l&&(I=!0);!y&&L>=J&&(y=!0);I=I&&y}return I};H.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};H.processUpdate=function(L){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",L),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(L)))};H.isUpdating=
function(){return!1};H.isRendering=function(){return!1};H.canResume=function(){return E.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};g._createClass(T,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return T}(F);e.__decorate([n.property({type:K,set(E){E=w.referenceSetter(E,this._get("clips"),K);this._set("clips",E)}})],F.prototype,"clips",void 0);e.__decorate([n.property()],F.prototype,"moving",void 0);
e.__decorate([n.property()],F.prototype,"attached",void 0);e.__decorate([n.property()],F.prototype,"container",void 0);e.__decorate([n.property()],F.prototype,"suspended",void 0);e.__decorate([n.property({readOnly:!0})],F.prototype,"updateParameters",void 0);e.__decorate([n.property()],F.prototype,"updateRequested",void 0);e.__decorate([n.property()],F.prototype,"updating",null);e.__decorate([n.property()],F.prototype,"view",void 0);return F=e.__decorate([k.subclass("esri.views.2d.layers.LayerView2D")],
F)};Object.defineProperty(v,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q){e=function(D){function w(){return D.apply(this,arguments)||this}v._inheritsLoose(w,D);return w}(q.JSONSupport);return e=g.__decorate([d.subclass("esri.views.layers.support.ClipArea")],e)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q){var D;e=D=function(w){function B(){var z=w.apply(this,arguments)||this;z.type="rect";z.left=null;z.right=null;z.top=null;z.bottom=null;return z}v._inheritsLoose(B,w);B.prototype.clone=function(){return new D({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};v._createClass(B,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return B}(q);g.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"left",void 0);
g.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"right",void 0);g.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"top",void 0);g.__decorate([f.property({type:[Number,String],json:{write:!0}})],e.prototype,"bottom",void 0);g.__decorate([f.property({readOnly:!0})],e.prototype,"version",null);return e=D=g.__decorate([d.subclass("esri.views.layers.support.ClipRect")],e)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D,w,B,z,m){var p;e={base:q,key:"type",typeMap:{extent:D,polygon:w}};m=p=function(C){function G(){var K=C.apply(this,arguments)||this;K.type="geometry";K.geometry=null;return K}v._inheritsLoose(G,C);G.prototype.clone=function(){return new p({geometry:this.geometry.clone()})};v._createClass(G,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return G}(m);g.__decorate([f.property({types:e,json:{read:B.fromJSON,write:!0}})],m.prototype,"geometry",void 0);
g.__decorate([f.property({readOnly:!0})],m.prototype,"version",null);return m=p=g.__decorate([d.subclass("esri.views.layers.support.Geometry")],m)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q){e=function(D){function w(){var B=D.apply(this,arguments)||this;B.type="path";B.path=[];return B}v._inheritsLoose(w,D);v._createClass(w,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return w}(q);g.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],e.prototype,"path",void 0);g.__decorate([f.property({readOnly:!0})],e.prototype,"version",null);return e=g.__decorate([d.subclass("esri.views.layers.support.Path")],e)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require",
"exports"],function(v,g){g.createOrReuseTileRenderer=async function(e,A){if(!e)return null;switch(e.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return new (await new Promise(function(c,f){v(["./tileRenderers/SymbolTileRenderer"],function(n){c(Object.freeze({__proto__:null,"default":n}))},f)})).default(A);case "heatmap":return new (await new Promise(function(c,f){v(["./tileRenderers/HeatmapTileRenderer"],function(n){c(Object.freeze({__proto__:null,
"default":n}))},f)})).default(A)}};Object.defineProperty(g,"__esModule",{value:!0})})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Promise ../../../../core/workers/workers".split(" "),
function(v,g,e,A,c,f,n,d,k,x,r,q,D,w){e=function(B){function z(p){p=B.call(this,p)||this;p._startupResolver=q.createResolver();p.isReady=!1;return p}v._inheritsLoose(z,B);var m=z.prototype;m.initialize=function(){this._controller=q.createAbortController();this.addResolvingPromise(this._startWorker(this._controller.signal))};m.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};m.startup=async function(p,C,G,K){await this.when();var F=this._controller.signal;F=Array.isArray(G.source)?
{transferList:G.source,signal:F}:void 0;p=p.tileInfo.toJSON();await this._connection.invoke("startup",{service:G,config:C,tileInfo:p,tiles:K},F);this._startupResolver.resolve();this._set("isReady",!0)};m.updateTiles=async function(p){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("updateTiles",p))};m.update=async function(p){p={config:p};await this._startupResolver.promise;return this._connection.invoke("update",p)};m.applyUpdate=async function(p){await this._startupResolver.promise;
return this._connection.invoke("applyUpdate",p)};m.setHighlight=async function(p){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",p))};m.refresh=async function(){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.refresh"))};m.queryFeatures=async function(p,C){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",p.toJSON(),C)};m.queryObjectIds=async function(p,
C){await this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",p.toJSON(),C)};m.queryFeatureCount=async function(p,C){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",p.toJSON(),C)};m.queryExtent=async function(p,C){return this._connection.invoke("controller.queryExtent",p.toJSON(),C)};m.queryLatestObservations=async function(p,C){await this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",
p.toJSON(),C)};m.queryStatistics=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",p)};m.getObjectId=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",p)};m.getDisplayId=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.getDisplayId",p)};m.getFeature=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.getFeature",
p)};m.getAggregate=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregate",p)};m.getAggregateValueRanges=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")};m.mapValidDisplayIds=async function(p){await this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",p)};m.onEdits=async function(p){await this._startupResolver.promise;const {addedFeatures:C,
deletedFeatures:G,updatedFeatures:K}=p;return q.ignoreAbortErrors(this._connection.invoke("controller.onEdits",{addedFeatures:C,deletedFeatures:G,updatedFeatures:K}))};m.enableEvent=async function(p,C){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:p,value:C}))};m._startWorker=async function(p){try{this._connection=await w.open("Pipeline",{client:this.client,strategy:"dedicated",signal:p})}catch(C){q.throwIfNotAbortError(C)}};
v._createClass(z,[{key:"tileRenderer",set:function(p){this.client.tileRenderer=p}},{key:"closed",get:function(){return this._connection.closed}}]);return z}(D.EsriPromise);g.__decorate([f.property()],e.prototype,"isReady",void 0);g.__decorate([f.property()],e.prototype,"client",void 0);g.__decorate([f.property()],e.prototype,"tileRenderer",null);return e=g.__decorate([d.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],e)})},"esri/views/2d/tiling/TileManager":function(){define(["exports",
"../../../core/maybe","./TileKey","./TileCoverage"],function(v,g,e,A){let c=function(){function f(d){this._tiles=new Map;this.buffer=0;this.acquireTile=d.acquireTile;this.releaseTile=d.releaseTile;this.tileInfoView=d.tileInfoView;this.buffer=d.buffer}var n=f.prototype;n.destroy=function(){};n.clear=function(){this._tiles.forEach(d=>this._releaseTile(d))};n.tileKeys=function(){const d=[];this._tiles.forEach((k,x)=>d.push(x));return d};n.update=function(d){d=this.tileInfoView.getTileCoverage(d.state,
this.buffer,"closest");const {spans:k,lodInfo:x}=d,{level:r}=x,q=[],D=[],w=new Set,B=new Set;for(const {row:z,colFrom:m,colTo:p}of k)for(let C=m;C<=p;C++){const G=e.getId(r,z,x.normalizeCol(C),x.getWorldForColumn(C)),K=this._getOrAcquireTile(q,G);w.add(G);K.isReady?K.visible=!0:B.add(K.key)}B.forEach(z=>this._addPlaceholders(w,z));this._tiles.forEach(z=>{w.has(z.key.id)||(D.push(z.key.id),this._releaseTile(z))});A.pool.release(d);return{hasMissingTiles:0<B.size,added:q,removed:D}};n._getOrAcquireTile=
function(d,k){if(!this._tiles.has(k)){const x=this.acquireTile(new e(k));d.push(k);this._tiles.set(k,x);x.visible=!1}return this._tiles.get(k)};n._getTile=function(d){return this._tiles.get(d)};n._releaseTile=function(d){this._tiles.delete(d.key.id);this.releaseTile(d)};n._addPlaceholders=function(d,k){const x=this._addPlaceholderChildren(d,k);1E-6>Math.abs(1-x)||this._addPlaceholderParent(d,k)||(this._getTile(k.id).visible=!0)};n._addPlaceholderChildren=function(d,k){let x=0;this._tiles.forEach(r=>
{x+=this._addPlaceholderChild(d,r,k)});return x};n._addPlaceholderChild=function(d,k,x){if(k.key.level<=x.level||!k.hasData||!x.contains(k.key))return 0;k.visible=!0;d.add(k.key.id);return 1/(1<<2*(k.key.level-x.level))};n._addPlaceholderParent=function(d,k){k=k.getParentKey();let x=0,r=null;for(;g.isSome(k);){if(d.has(k.id))return!0;const q=this._getTile(k.id);if(null!=q&&q.isReady)return q.visible=!0,d.add(q.key.id),!0;null!=q&&q.hasData&&q.patchCount>x&&(x=q.patchCount,r=q);k=k.getParentKey()}return r?
(r.visible=!0,d.add(r.key.id),!0):!1};return f}();v.TileManager=c;Object.defineProperty(v,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/Extent ../../../geometry ../../../core/Collection ../../../Graphic ../../../AggregateGraphic ../../../core/watchUtils ../../../layers/support/arcgisLayerUrl ../../../tasks/support/FeatureSet ../../../tasks/support/Query ../engine/webgl/definitions ../../webgl/capabilities ../../layers/RefreshableLayerView ../../layers/LayerView ../../../renderers/support/clickToleranceUtils ../../support/drapedUtils ./support/clusterUtils ../../layers/effects/EffectList ./features/support/pixelBuffering ./support/util ./features/schemaUtils ../../layers/support/FeatureFilter ../../layers/support/FeatureEffect ../../layers/FeatureLayerView ./LayerView2D ./features/tileRenderers ./support/FeatureLayerProxy ../tiling/TileManager".split(" "),function(v,
g,e,A,c,f,n,d,k,x,r,q,D,w,B,z,m,p,C,G,K,F,E,T,H,L,I,J,l,y,M,P,Y,Z,W,O,ca,ia,ja,ka,la,ma,na){function ha(da){return da&&"openPorts"in da}const aa=f.getLogger("esri.views.2d.layers.FeatureLayerView2D");f=function(da){function fa(){var a=da.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._updatingPipelineConfig=!1;a._onGoingEdits=0;a._isRefreshing=!1;a._visibilityOverrides=new Set;a._effect=null;a._highlightIds=new Map;a._lastPixelBuffer=0;a.filter=null;a.effectLists={included:new Y["default"],
excluded:new Y["default"]};a.doRefresh=z.debounce(async()=>{a.isUpdating()&&await F.whenFalseOnce(v._assertThisInitialized(a),"updating");a._set("_isRefreshing",!0);a._lockGPUUploads();try{await a._proxy.refresh()}catch(b){z.isAbortError(b)}a._unlockGPUUploads();a._set("_isRefreshing",!1)});a._doUpdate=z.debounce(async()=>{try{if(!a.destroyed&&a._hasRequiredSupport(a.layer)){a._set("_updatingPipelineConfig",!0);await F.whenFalseOnce(v._assertThisInitialized(a),"_isRefreshing");var {effect:b,filter:h}=
v._assertThisInitialized(a);await a._updateRequiredFields();var {renderer:t}=a._getEffectiveRenderer();a._set("_effectiveRenderer",t);var N={renderer:a.layer.renderer,spatialReference:a.layer.spatialReference,timeExtent:a.layer.timeExtent,definitionExpression:a.layer.definitionExpression,featureReduction:a.layer.featureReduction,fields:a.layer.fields,geometryType:a.layer.geometryType,historicMoment:"feature"===a.layer.type?a.layer.historicMoment:null,labelsVisible:a.layer.labelsVisible,labelingInfo:a.layer.labelingInfo,
availableFields:a.availableFields,effect:a.effect,filter:a.filter,gdbVersion:"feature"===a.layer.type?a.layer.gdbVersion:null,pixelBuffer:0},U=W.toJSONGeometryType(a.layer.geometryType),S=await Z.computePxBuffer(t,U,a.layer.featureReduction),V=a._createConfiguration(N,h,b);a._lastPixelBuffer=0===S?0:Math.max(S,a._lastPixelBuffer);V.schema.source.pixelBuffer=a._lastPixelBuffer;var X=a._createTileRendererHash(t);if(X!==a._tileRendererHash){await a._initTileRenderer(t);const Q=a._serviceOptions;a.effects.forEach(ea=>
c.isSome(ea)&&c.isSome(ea.filter)&&ea.filter.enable());a.tileRenderer.onConfigUpdate(t);const R={added:a._tileStrategy.tileKeys(),removed:[]},ba=a.layer;"stream"!==ba.type&&ha(ba.source)&&(Q.source=await ba.source.openPorts());await a._proxy.startup(a.view.featuresTilingScheme,V,Q,R);a.hasHighlight()&&await a._proxy.setHighlight(Array.from(a._highlightIds.keys()));await a._onceTilesUpdated();a.tileRenderer.onConfigUpdate(t)}else{const Q=await a._proxy.update(V);(Q.mesh||Q.targets.aggregate)&&a._lockGPUUploads();
try{await a._proxy.applyUpdate(Q)}catch(R){z.isAbortError(R)||aa.error(R)}(Q.mesh||Q.targets.aggregate)&&a._unlockGPUUploads();a.effects.forEach(R=>c.isSome(R)&&c.isSome(R.filter)&&R.filter.enable());a.tileRenderer.onConfigUpdate(t);a._forceAttributeTextureUpload()}a._tileRendererHash=X;a.tileRenderer.invalidateLabels();a.requestUpdate()}}catch(Q){}});a._updateHighlight=z.debounce(async()=>a._proxy.setHighlight(Array.from(a._highlightIds.keys())));return a}v._inheritsLoose(fa,da);var u=fa.prototype;
u.destroy=function(){var a,b;null==(a=this._proxy)?void 0:a.destroy();c.andThen(this._updateClusterSizeTask,h=>h.remove());null==(b=this.tileRenderer)?void 0:b.destroy()};u.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),F.init(this,"effect",a=>{this.effectLists.included.effect=null==a?void 0:a.includedEffect}),F.init(this,"effect",a=>{this.effectLists.excluded.effect=
null==a?void 0:a.excludedEffect})])};u._initProxy=async function(){if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type&&this.layer.isTable)throw new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const a=this._createClientOptions();this._set("_proxy",new ma({client:a}));return this._proxy.when()};u._initServiceOptions=async function(){this._set("_serviceOptions",await this._createServiceOptions())};
u.highlight=function(a){let b;a instanceof G?b=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?b=[a]:C.isCollection(a)?b=a.map(h=>h&&h.getAttribute(this.layer.objectIdField)).toArray():Array.isArray(a)&&0<a.length&&(b="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(h=>h&&h.getAttribute(this.layer.objectIdField)));if(!b||!b.length)return{remove:()=>{}};b=b.filter(h=>null!=h);this._addHighlight(b);return{remove:()=>this._removeHighlight(b)}};u.hasHighlight=function(){return!!this._highlightIds.size};
u.hitTest=function(a,b){return this._hitTest(a,b)};u.queryStatistics=function(){return this._proxy.queryStatistics()};u.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(h=>{h=T.fromJSON(h);h.features.forEach(t=>{t.layer=this.layer;t.sourceLayer=this.layer});return h})};u.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};u.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),b)};u.queryFeatureCount=function(a,
b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};u.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(h=>({count:h.count,extent:m.fromJSON(h.extent)}))};u.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};u.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,added:h,removed:t}=this._tileStrategy.update(a);(h.length||t.length)&&this._proxy.updateTiles({added:h,
removed:t});b&&this.requestUpdate();this.notifyChange("updating")}};u.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new na.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(F.init(this,"renderingConfigHash",()=>this._update()),"attach");"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",async a=>{this._set("_onGoingEdits",
this._onGoingEdits+1);try{const b="globalIdField"in this.layer&&this.layer.globalIdField,h=a.deletedFeatures.some(N=>-1===N.objectId||!N.objectId),t=b&&this.availableFields.includes(b);if(h&&!t){aa.error(new r("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`));return}await this._proxy.onEdits(a)}catch(b){z.isAbortError(b)}this._set("_onGoingEdits",Math.max(0,this._onGoingEdits-
1))}),"attach")};u.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");this._updatingPipelineConfig=!1;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};u.moveStart=function(){this.requestUpdate()};u.viewChange=function(){this.requestUpdate()};u.moveEnd=function(){this.requestUpdate()};u.fetchPopupFeatures=async function(a,b){if(c.isSome(b)&&
b.clientGraphics.length){var h=b.clientGraphics[0];if(h instanceof K)return[h]}if(h=this.validateFetchPopupFeatures(b))throw h;if(c.isSome(b)&&0===b.clientGraphics.length)return[];h=this.fetchClientPopupFeatures(b);if(!a)return h;a=this._fetchServicePopupFeatures(a,b);return z.eachAlwaysValues([h,a]).then(B.flatten)};u._fetchServicePopupFeatures=async function(a,b){if("stream"===this.layer.type||"ogc-feature"===this.layer.type)return[];const h=await this.createPopupQuery(b),{layer:t}=this;var {renderer:N}=
t;const U=c.isSome(b)?b.event:null;N=y.calculateTolerance({renderer:N,event:U});h.geometry=this.createFetchPopupFeaturesQueryGeometry(a,N);const S=new Set,{objectIdField:V}=t;if(a=c.isSome(b)?b.clientGraphics:null)for(const X of a)S.add(X.attributes[V]);return t.queryFeatures(h).then(X=>X.features.filter(Q=>!S.has(Q.attributes[V])))};u.createFetchPopupFeaturesQueryGeometry=function(a,b){return M.createQueryGeometry(a,b,this.view)};u.isUpdating=function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||
null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||0<this._onGoingEdits)};u._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};u._detectQueryMode=async function(a){if("path"in a&&E.isHostedAgolService(a.path)&&"feature"===this.layer.type&&"point"===this.layer.geometryType&&!this.layer.capabilities.operations.supportsEditing&&
e("featurelayer-snapshot-enabled"))try{const b=await this.layer.queryFeatureCount(),h=e("featurelayer-snapshot-point-min-threshold");if(b<=h)return{mode:"snapshot",featureCount:b};const t=e("featurelayer-snapshot-point-max-threshold"),N=e("featurelayer-snapshot-point-coverage"),U=this.view.extent,S=this.layer.fullExtent,V=null==S?void 0:S.clone().intersection(U),X=(null==V?NaN:V.width)*(null==V?NaN:V.height),Q=(null==S?NaN:S.width)*(null==S?NaN:S.height);a=0===Q?0:X/Q;if(b<=t&&a>=N)return{mode:"snapshot",
featureCount:b}}catch(b){aa.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:b})}return{mode:"on-demand"}};u._createServiceOptions=async function(){const a=this.layer;if("stream"===a.type)return null;const {capabilities:b,objectIdField:h}=a,t=a.fields.map(oa=>oa.toJSON()),N=a.fullExtent&&a.fullExtent.toJSON(),U=W.toJSONGeometryType(a.geometryType),S=a.timeInfo&&a.timeInfo.toJSON()||null,V=a.spatialReference?a.spatialReference.toJSON():null,X="feature"===a.type?
a.customParameters:null,Q="feature"===a.type?a.globalIdField:null;let R;"ogc-feature"===a.type?R=a.source.getFeatureDefinition():ha(a.source)?R=await a.source.openPorts():a.parsedUrl&&(R=A.clone(a.parsedUrl),"dynamicDataSource"in a&&a.dynamicDataSource&&(R.query={layer:JSON.stringify({source:a.dynamicDataSource})}));const {mode:ba,featureCount:ea}=await this._detectQueryMode(R);return{type:ba,featureCount:ea,globalIdField:Q,maxRecordCount:b.query.maxRecordCount,tileMaxRecordCount:b.query.tileMaxRecordCount,
capabilities:b,fields:t,fullExtent:N,geometryType:U,objectIdField:h,source:R,timeInfo:S,spatialReference:V,customParameters:X}};u._createMemoryServiceOptions=async function(a){a=await a.openPorts();return{...this._createServiceOptions(),type:"memory",source:a}};u._cleanUpQuery=function(a){a=H.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};u._createUpdateClusterSizeTask=function(a,b){return this.watch("_aggregateValueRanges",async h=>
{this._updateClusterEffectiveRendererSizeVariable(a,b,h);if(!this._updatingPipelineConfig)this.tileRenderer.onConfigUpdate(this._effectiveRenderer)})};u._updateClusterEffectiveRendererSizeVariable=async function(a,b,h){if(a.dynamicClusterSize&&"visualVariables"in a&&a.visualVariables){var t=P.findSizeVV(a.visualVariables);c.isSome(t)&&"cluster_count"===t.field&&(t=a.visualVariables.indexOf(t),a.visualVariables[t]=P.createClusterCountSizeVariable(b,h),a=a.clone(),a.dynamicClusterSize=!0,this._set("_effectiveRenderer",
a))}};u._getEffectiveRenderer=function(){var a=this.layer.renderer;const b=this.layer.featureReduction;c.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(b&&"cluster"===b.type&&P.isClusterCompatibleRenderer(a)){const h=[];a=P.createClusterRenderer(h,a,b,this._aggregateValueRanges);c.andThen(this._updateClusterSizeTask,t=>t.remove());this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,b);return{renderer:a,aggregateFields:h,
featureReduction:b}}return{renderer:a,aggregateFields:[],featureReduction:null}};u._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};u._releaseTile=function(a){this.tileRenderer.releaseTile(a)};u._initTileRenderer=async function(a){const b=await la.createOrReuseTileRenderer(a,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),
this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=b;this._set("tileRenderer",b);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(a);this.requestUpdate();return this.tileRenderer};u._createTileRendererHash=function(a){return`${"heatmap"===a.type?"heatmap":"symbol"}.${"dot-density"===a.type}`};u._createFeatureDataHash=function(a,b,h){a=a.getAttributeHash();b=JSON.stringify(b);h=c.isSome(h)&&JSON.stringify(h.filter);const t=
JSON.stringify(this.timeExtent);let N="";this._visibilityOverrides.forEach(U=>N+=U);return`${a}.${b}.${h}.${t}.${N}`};u._injectOverrides=function(a){var b=c.isSome(a)?a.timeExtent:null;b=c.isSome(this.timeExtent)&&c.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var h=null;const t="floorInfo"in this.layer&&this.layer.floorInfo;t&&(h=c.isSome(a)&&a.where,h=this._addFloorFilterClause(h));if(!this._visibilityOverrides.size&&!b&&!t)return a;a=c.isSome(a)&&a.clone()||new ca;a.hiddenIds=this._visibilityOverrides;
a.timeExtent=b;h&&(a.where=h);return a};u._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var h,t=this.view.floors;if(!t||!t.length)return a;null!=(h=b.floorInfo.viewAllLevelIds)&&h.length&&(t=b.floorInfo.viewAllLevelIds);h=t.filter(N=>""!==N).map(N=>"'"+N+"'");h.push("''");b=b.floorInfo.floorField;t="("+b+" IN ({ids}) OR "+b+" IS NULL)";t=t.replace("{ids}",h.join(", "));c.isSome(a)&&a.includes(b)&&(h=new RegExp("AND \\("+b+".*NULL\\)","g"),a=a.replace(h,
""),h=new RegExp("\\("+b+".*NULL\\)","g"),a=a.replace(h,""),a=a.replace(/\s+/g," ").trim());a=""!==a?"("+a+") AND "+t:t}return""!==a?a:null};u._createConfiguration=function(a,b,h){const t="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,N="feature"===this.layer.type?this.layer.gdbVersion:void 0,U=Array(L.MAX_FILTERS);b=this._injectOverrides(b);U[0]=c.isSome(b)?b.toJSON():null;U[1]=c.isSome(h)&&h.filter?h.filter.toJSON():null;a=O.createSchema(a);if(c.isNone(a))return null;
h=I();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:N,historicMoment:t,devicePixelRatio:window.devicePixelRatio||1,filters:U,schema:a,supportsTextureFloat:h.supportsTextureFloat,maxTextureSize:h.maxTextureSize}};u._hasRequiredSupport=function(a){var b;return"dot-density"!==(null==(b=a.renderer)?void 0:b.type)||I().supportsTextureFloat?!0:(aa.error(new r("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),
!1)};u._onceTilesUpdated=function(){this.requestUpdate();return F.whenFalseOnce(this,"_pipelineIsUpdating",!1)};u._lockGPUUploads=function(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()};u._unlockGPUUploads=function(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()};u._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};u._update=function(){this.view.timeline.begin(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`);
const a=this._doUpdate();this._updatingPromise=a;const b=()=>{a===this._updatingPromise&&this._set("_updatingPipelineConfig",!1);this.view&&this.view.timeline.end(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`)};a.then(b).catch(h=>{z.isAbortError(h)||aa.error(h);b()})};u._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{z.isAbortError(b)||aa.error(b)})};
u._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight().catch(b=>{z.isAbortError(b)||aa.error(b)})};u._createHittestResult=function(a){a.layer=this.layer;a.sourceLayer=this.layer;c.isSome(a.geometry)&&(a.geometry.spatialReference=this.view.spatialReference);return a};u._hitTest=async function(a,b){if(this.suspended||!this.tileRenderer)return null;a=await this.tileRenderer.hitTest(a,
b);if(0===a.length)return await z.after(1),null;a=a[0];if(1!==(a&2147483648)>>>31)return a=await this._proxy.getFeature(a),c.andThen(a,h=>this._createHittestResult(G.fromJSON(h)));a=await this._proxy.getAggregate(a);return c.isNone(a)?null:c.isSome(a.referenceId)?(a=await this._proxy.getFeature(a.referenceId),c.andThen(a,h=>this._createHittestResult(G.fromJSON(h)))):this._createHittestResult(K.fromJSON(a))};v._createClass(fa,[{key:"labelsVisible",get:function(){return!this.suspended&&this.layer.labelingInfo&&
this.layer.labelsVisible}},{key:"effect",get:function(){return c.unwrapOr(this._effect,null)},set:function(a){const b=this._effect;c.isSome(b)&&c.isSome(b.filter)&&b.filter.enabled&&c.isSome(a)&&c.isSome(a.filter)&&a.filter.enable();this._effect=a;this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields,
b=this.layer,h=this.view.floors,{definitionExpression:t,renderer:N,labelingInfo:U}=b,S="feature"===b.type?b.gdbVersion:void 0,V="feature"===b.type&&b.historicMoment?b.historicMoment.getTime():void 0,{timeExtent:X}=this,Q="stream"===b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null,R=JSON.stringify(this.clips),ba=b.featureReduction&&b.featureReduction.toJSON();return JSON.stringify({filterHash:c.isSome(this.filter)&&this.filter.toJSON(),effectHash:c.isSome(this.effect)&&
this.effect.toJSON(),streamFilter:Q,gdbVersion:S,definitionExpression:t,historicMoment:V,availableFields:a,renderer:N,labelingInfo:b.labelsVisible&&U,timeExtent:X,floors:h,clipsHash:R,featureReduction:ba})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||
!!this.timeExtent}}]);return fa}(ja.FeatureLayerView(J.RefreshableLayerView(ka.LayerView2DMixin(l))));g.__decorate([d.property()],f.prototype,"_serviceOptions",void 0);g.__decorate([d.property()],f.prototype,"_proxy",void 0);g.__decorate([d.property()],f.prototype,"_pipelineIsUpdating",void 0);g.__decorate([d.property()],f.prototype,"_updatingPipelineConfig",void 0);g.__decorate([d.property()],f.prototype,"_effectiveRenderer",void 0);g.__decorate([d.property()],f.prototype,"_aggregateValueRanges",
void 0);g.__decorate([d.property()],f.prototype,"_onGoingEdits",void 0);g.__decorate([d.property()],f.prototype,"_isRefreshing",void 0);g.__decorate([d.property()],f.prototype,"labelsVisible",null);g.__decorate([d.property({type:ca})],f.prototype,"filter",void 0);g.__decorate([d.property({type:ia})],f.prototype,"effect",null);g.__decorate([d.property({readOnly:!0})],f.prototype,"effects",null);g.__decorate([d.property({readOnly:!0})],f.prototype,"queryMode",null);g.__decorate([d.property()],f.prototype,
"renderingConfigHash",null);g.__decorate([d.property()],f.prototype,"tileRenderer",void 0);g.__decorate([d.property()],f.prototype,"updating",void 0);return f=g.__decorate([x.subclass("esri.views.2d.layers.FeatureLayerView2D")],f)});