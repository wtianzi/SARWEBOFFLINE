// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../Graphic ../../../core/watchUtils ../../layers/LayerView ./graphics/GraphicsView2D ./graphics/GraphicContainer ./LayerView2D".split(" "),
function(r,t,l,h,B,C,D,E,u,F,G,H,v,w,k,x,n,p,y){const z=Object.freeze({remove(){},pause(){},resume(){}});l=function(q){function m(){return q.apply(this,arguments)||this}r._inheritsLoose(m,q);var e=m.prototype;e.fetchPopupFeatures=async function(a){return(await Promise.all(Array.from(this.graphicsViews(),c=>c.searchFeatures(a).then(b=>b.filter(d=>!!d.popupTemplate))))).flat()};e.graphicsViews=function*(){h.isSome(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():
h.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};e.hitTest=async function(a,c){if(this.suspended)return null;const b=Array.from(this.graphicsViews(),async d=>{const f=await d.hitTest(a,c);return f?(h.isSome(this._graphicsViewsFeatureCollectionMap)&&(d=this._graphicsViewsFeatureCollectionMap.get(d),!f.popupTemplate&&d.popupTemplate&&(f.popupTemplate=d.popupTemplate)),f):null});return(await Promise.all(b)).filter(d=>!!d)[0]||null};e.highlight=function(a){let c;"number"===typeof a?c=
[a]:a instanceof w?c=[a.uid]:Array.isArray(a)&&0<a.length?c="number"===typeof a[0]?a:a.map(b=>b&&b.uid):v.isCollection(a)&&(c=a.map(b=>b&&b.uid).toArray());c=c.filter(b=>null!=b);if(!c.length)return z;for(const b of this.graphicsViews())b.addHighlight(c);return{remove:()=>{for(const b of this.graphicsViews())b.removeHighlight(c)}}};e.update=function(a){for(const c of this.graphicsViews())c.processUpdate(a)};e.attach=function(){const a=this.view,c=()=>this.requestUpdate();var b=this.layer.featureCollections;
if(h.isSome(b)&&b.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const d of b){b=new p(this.view.featuresTilingScheme);b.fadeTransitionEnabled=!0;const f=new n({view:a,graphics:d.source,renderer:d.renderer,requestUpdateCallback:c,container:b});this._graphicsViewsFeatureCollectionMap.set(f,d);this.container.addChild(f.container);this.handles.add([k.init(d,"visible",g=>f.container.visible=g),k.init(f,"updating",()=>this.notifyChange("updating"))],"layerView")}}else h.isSome(this.layer.sublayers)&&
this.handles.add(k.on(this.layer,"sublayers","change",()=>this._createGraphicsViews(),()=>this._createGraphicsViews(),()=>this._destroyGraphicsViews()),"sublayers")};e.detach=function(){this._destroyGraphicsViews();this.handles.remove("sublayers")};e.moveStart=function(){};e.moveEnd=function(){};e.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};e.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};e._destroyGraphicsViews=function(){this.container.removeAllChildren();
this.handles.remove("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};e._createGraphicsViews=function(){this._destroyGraphicsViews();if(!h.isNone(this.layer.sublayers)){var a=[],c=this.view,b=()=>this.requestUpdate();for(const d of this.layer.sublayers){const f=new p(this.view.featuresTilingScheme);f.fadeTransitionEnabled=!0;const g=new n({view:c,graphics:d.graphics,requestUpdateCallback:b,container:f});this.handles.add([d.on("graphic-update",
g.graphicUpdateHandler),k.init(d,"visible",A=>g.container.visible=A),k.init(g,"updating",()=>this.notifyChange("updating"))],"layerView");this.container.addChild(g.container);a.push(g)}this._graphicsViews=a}};return m}(y.LayerView2DMixin(x));return l=t.__decorate([u.subclass("esri.views.2d.layers.MapNotesLayerView2D")],l)});