// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/screenUtils ../../../engine/webgl/definitions ../../../../../symbols/cim/Rect ../../../../../symbols/cim/CIMSymbolHelper ../../graphics/graphicsUtils".split(" "),function(h,p,q,r,t,u){function k(a){if(!("visualVariables"in a&&a.hasVisualVariables("size")))return 0;a=a.getVisualVariablesForType("size");if(!a[0])return 0;a=a[0];if("stops"===a.transformationType)return a.stops.map(b=>b.size).reduce(g,0);if("clamped-linear"===a.transformationType){let b=-Infinity,c=
-Infinity;b="number"===typeof a.maxSize?a.maxSize:a.maxSize.stops.map(d=>d.size).reduce(g,0);c="number"===typeof a.minSize?a.minSize:a.minSize.stops.map(d=>d.size).reduce(g,0);return Math.max(b,c)}if("real-world-size"===a.transformationType)return 30}function e(a,b){return null==a?b:a}async function l(a,b){if("simple-marker"===a.type)return b=Math.max(e(a.size,12),b),m(a)+.707*b;if("picture-marker"===a.type){var c=Math.max(e(a.height,12),b);b=e(a.width,12)*(c/e(a.height,12))/2;c/=2;return m(a)+Math.sqrt(b*
b+c*c)}if("text"===a.type){if(c=a.text&&a.text.length){b=[];for(let d=0;d<c;d++)b.push({...n,code:a.text.charCodeAt(d)});b={glyphMosaicItems:b}}else b={glyphMosaicItems:[n]};u.getTextSymbolSize(f,a.toJSON(),b);return Math.max(Math.abs(f[0]),Math.abs(f[1]))+Math.max(f[2],f[3])}return"simple-line"===a.type?(c=Math.max(e(a.width,.75),b)/2,a.marker?Math.max(6*a.width,2*b):c):"simple-fill"===a.type||"picture-fill"===a.type?Math.max(null==a.outline?0:e(a.outline.width,0),b)/2:"cim"===a.type?(a=t.CIMSymbolHelper.getEnvelope(a.data))?
Math.sqrt(a.width*a.width+a.height*a.height):0:"web-style"===a.type?l(await a.fetchCIMSymbol(),b):0}async function v(a,b){return a.type in w?Math.min(await l(a,b),75):0}function m(a){const b=e(a.xoffset,0);a=e(a.yoffset,0);return Math.sqrt(b*b+a*a)}function g(a,b){return Math.max(a,b)}const w={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},f=[0,0,0,0],n={sdf:!0,code:99,metrics:q.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new r(0,0,24,
24),page:0,textureBinding:2};h.computePxBuffer=async function(a,b,c){if(!a||c&&"cluster"===c.type)return 0;if("heatmap"===a.type)return Math.round(3*a.blurRadius);if("dot-density"===a.type)return 0;if("dictionary"===a.type)return"esriGeometryPoint"===b||"esriGeometryMultipoint"===b?100:200;b=a.getSymbols();a=k(a);c=[];for(var d of b)c.push(v(d,a));d=await Promise.all(c);return p.pt2px(d.reduce(g,0))};h.getPtMaxVVSize=k;Object.defineProperty(h,"__esModule",{value:!0})});