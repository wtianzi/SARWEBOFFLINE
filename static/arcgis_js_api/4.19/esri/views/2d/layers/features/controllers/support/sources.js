// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../layers/graphics/featureConversionUtils ../../../../../../core/workers/workers ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../../../../../layers/ogc/ogcFeatureUtils ../../support/FeatureSetReaderPBF".split(" "),function(k,h,q,l,r,m,f,p,t){let g=function(){function c(d){this.service=d}c.prototype.destroy=function(){};return c}(),u=function(c){function d(b){var e=
c.call(this,b)||this;e._portsOpen=r.openWithPorts(b.source).then(n=>e.client=n);return e}h._inheritsLoose(d,c);var a=d.prototype;a.destroy=function(){this.client.close();this.client=null};a.executeQuery=async function(b,e){await this._portsOpen;b=await this.client.invoke("queryFeatures",b.toJSON(),e);return f.FeatureSetReaderJSON.fromFeatureSet(b,this.service.objectIdField)};return d}(g),v=function(c){function d(){return c.apply(this,arguments)||this}h._inheritsLoose(d,c);d.prototype.executeQuery=
async function(a,b){({data:b}=await m.executeQueryPBFBuffer(this.service.source,a,{...b,query:{...this.service.customParameters,...null==b?void 0:b.query}}));return t.FeatureSetReaderPBF.fromBuffer(b,this.service.geometryType,!a.quantizationParameters)};return d}(g),y=function(c){function d(){return c.apply(this,arguments)||this}h._inheritsLoose(d,c);d.prototype.executeQuery=async function(a,b){const {source:e,capabilities:n,spatialReference:w,objectIdField:x}=this.service;if(a.quantizationParameters&&
!n.query.supportsQuantization)return a=a.clone(),a.quantizationParameters=null,{data:a}=await m.executeQuery(e,a,w,{...b,query:{...this.service.customParameters,...null==b?void 0:b.query}}),a=l.convertFromFeatureSet(a,x),l.quantizeOptimizedFeatureSet(b.transform,a),f.FeatureSetReaderJSON.fromOptimizedFeatureSet(a);({data:b}=await m.executeQuery(e,a,this.service.spatialReference,{...b,query:{...q.unwrap(this.service.customParameters),...null==b?void 0:b.query}}));return f.FeatureSetReaderJSON.fromFeatureSet(b,
this.service.objectIdField)};return d}(g),z=function(c){function d(){return c.apply(this,arguments)||this}h._inheritsLoose(d,c);d.prototype.executeQuery=async function(a,b){const {capabilities:e}=this.service;if(a.quantizationParameters&&!e.query.supportsQuantization)return a.clone().quantizationParameters=null,a=await p.queryOptimizedFeatureSet(this.service.source,a,b),l.quantizeOptimizedFeatureSet(b.transform,a),f.FeatureSetReaderJSON.fromOptimizedFeatureSet(a);b=await p.queryOptimizedFeatureSet(this.service.source,
a,b);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(b)};return d}(g);k.SourceAdapter=g;k.createSourceAdapter=function(c){const {capabilities:d}=c;var a=c.source;return a&&a.capabilities&&a.collectionId&&a.layerDefinition&&a.url?new z(c):Array.isArray(c.source)?new u(c):d.query.supportsFormatPBF?new v(c):new y(c)};Object.defineProperty(k,"__esModule",{value:!0})});