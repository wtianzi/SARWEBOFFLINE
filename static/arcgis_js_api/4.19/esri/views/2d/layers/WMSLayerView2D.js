// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/Extent ../../layers/RefreshableLayerView ../../layers/LayerView ../../layers/WMSLayerView ../engine/BitmapContainer ./LayerView2D ./support/ExportStrategy".split(" "),
function(z,k,e,A,N,r,O,B,C,P,Q,R,D,E,F,G,H,I,J,K){const L=A.getLogger("esri.views.2d.layers.WMSLayerView2D");e=function(t){function l(){return t.apply(this,arguments)||this}z._inheritsLoose(l,t);var b=l.prototype;b.initialize=function(){const {layer:a,view:c}=this;a.supportsSpatialReference(c.spatialReference)||this.addResolvingPromise(Promise.reject(new C("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",
{layer:a})))};b.hitTest=function(){return null};b.update=function(a){this.strategy.update(a).catch(c=>{D.isAbortError(c)||L.error(c)})};b.attach=function(){const {layer:a}=this,{imageMaxHeight:c,imageMaxWidth:f}=a;this._bitmapContainer=new I.BitmapContainer;this.container.addChild(this._bitmapContainer);this.strategy=new K({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:c,imageMaxWidth:f,imageRotationSupported:!1,imageNormalizationSupported:!1,
hidpi:!1});this.handles.add(this.watch("exportImageVersion",()=>this.requestUpdate()),"exportImageVersion")};b.detach=function(){this.handles.remove("exportImageVersion");this.strategy.destroy();this.container.removeChild(this._bitmapContainer);this._bitmapContainer.removeAllChildren()};b.moveStart=function(){};b.viewChange=function(){};b.moveEnd=function(){this.requestUpdate()};b.createFetchPopupFeaturesQuery=function(a){const {view:c}=this,f=this._bitmapContainer,{x:g,y:m}=a,{spatialReference:M}=
c;let d=null,n=0,u=0;f.children.some(h=>{const {width:v,height:w,resolution:x,x:p,y:q}=h;h=p+x*v;const y=q-x*w;return g>=p&&g<=h&&m<=q&&m>=y?(d=new E({xmin:p,ymin:y,xmax:h,ymax:q,spatialReference:M}),n=v,u=w,!0):!1});if(!d)return null;a=d.width/n;return{extent:d,width:n,height:u,x:Math.round((g-d.xmin)/a),y:Math.round((d.ymax-m)/a)}};b.doRefresh=async function(){this.requestUpdate()};b.isUpdating=function(){return this.strategy.updating||this.updateRequested};b.fetchImage=function(a,c,f,g){return this.layer.fetchImage(a,
c,f,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...g})};return l}(H.WMSLayerView(F.RefreshableLayerView(J.LayerView2DMixin(G))));k.__decorate([r.property()],e.prototype,"strategy",void 0);k.__decorate([r.property()],e.prototype,"updating",void 0);return e=k.__decorate([B.subclass("esri.views.2d.layers.WMSLayerView2D")],e)});