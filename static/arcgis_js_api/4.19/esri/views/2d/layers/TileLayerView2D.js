// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/support/drapedUtils":function(){define("exports ../../core/maybe ../../geometry/Extent ../../geometry ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),function(k,h,c,C,b,d){function g(f,x,p,y=new c){let q;if("2d"===p.type)q=x*p.resolution;else if("3d"===p.type){var m=p.overlayPixelSizeInMapUnits(f),l=p.basemapSpatialReference;q=h.isSome(l)&&!l.equals(p.spatialReference)?b.getMetersPerUnitForSR(l)/b.getMetersPerUnitForSR(p.spatialReference):x*
m}x=f.x-q;m=f.y-q;l=f.x+q;f=f.y+q;({spatialReference:p}=p);y.xmin=Math.min(x,l);y.ymin=Math.min(m,f);y.xmax=Math.max(x,l);y.ymax=Math.max(m,f);y.spatialReference=p;return y}const n=new c;k.createQueryGeometry=g;k.intersectsDrapedGeometry=function(f,x,p){f=p.toMap(f);if(h.isNone(f))return!1;const y=d.calculateTolerance();return g(f,y,p,n).intersects(x)};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(k){function h(b,
d){return d?"xoffset"in d&&d.xoffset?Math.max(b,Math.abs(d.xoffset)):"yoffset"in d&&d.yoffset?Math.max(b,Math.abs(d.yoffset||0)):b:b}function c(b,d){if("number"===typeof b)return b;if(b&&b.stops&&b.stops.length){{b=b.stops;let g=d=0;for(let n=0;n<b.length;n++){const f=b[n].size;"number"===typeof f&&(d+=f,g++)}b=d/g}return b}return d}function C(b,d){if(!d)return b;d=d.filter(f=>"size"===f.type).map(f=>{const {maxSize:x,minSize:p}=f;return(c(x,b)+c(p,b))/2});let g=0;const n=d.length;if(0===n)return b;
for(let f=0;f<n;f++)g+=d[f];return Math.max(Math.floor(g/n),b)}k.calculateTolerance=function(b){const d=b&&b.renderer;b="touch"===(b&&b.event&&b.event.pointerType)?9:6;if(!d)return b;b="visualVariables"in d?C(b,d.visualVariables):b;if("simple"===d.type)return h(b,d.symbol);if("unique-value"===d.type){let g=b;d.uniqueValueInfos.forEach(n=>{g=h(g,n.symbol)});return g}if("class-breaks"===d.type){let g=b;d.classBreakInfos.forEach(n=>{g=h(g,n.symbol)});return g}return b};Object.defineProperty(k,"__esModule",
{value:!0})})},"esri/views/layers/TileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y,q,m,l,B){C=z=>{z=function(J){function K(){return J.apply(this,arguments)||this}h._inheritsLoose(K,J);K.prototype.fetchPopupFeatures=async function(I,F){var {layer:u}=this;if(!I)return Promise.reject(new p("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:u}));if("tile"!==u.type)return Promise.reject(new p("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:u.type}));const G=this.get("view.scale");u=u.allSublayers.toArray().filter(w=>
{const A=0===w.minScale||G<=w.minScale,r=0===w.maxScale||G>=w.maxScale;return w.popupTemplate&&w.popupEnabled&&w.visible&&A&&r});return l.eachAlways(u.map(async w=>{const A=w.createQuery();var r=b.isSome(F)?F.event:null;r=B.calculateTolerance({renderer:w.renderer,event:r});A.geometry=this.createFetchPopupFeaturesQueryGeometry(I,r);A.outFields=await w.popupTemplate.getRequiredFields();return(await w.queryFeatures(A)).features})).then(w=>[].concat(...w.map(A=>A.value).filter(Boolean)))};return K}(z);
c.__decorate([n.property()],z.prototype,"layer",void 0);return z=c.__decorate([x.subclass("esri.layers.mixins.TileLayerView")],z)};k.TileLayerView=C;k.default=C;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y,q,m,l,B,z,J,K,I){const F=q.ofType({key:"type",base:B,typeMap:{rect:z,path:I,geometry:K}});k.LayerView2DMixin=u=>{u=function(G){function w(){var r=G.apply(this,arguments)||this;r.clips=new F;r.moving=!1;r.attached=!1;r.lastUpdateId=-1;r.updateRequested=!1;return r}h._inheritsLoose(w,G);var A=w.prototype;A.initialize=function(){var r;this.container||(this.container=new J.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([l.init(this,"suspended",t=>{this.container&&(this.container.visible=!t);this.view&&!t&&this.updateRequested&&this.view.requestUpdate()},!0),l.init(this,["layer.opacity","container"],()=>{if(this.container){var t,D;this.container.opacity=null!=(t=null==(D=this.layer)?void 0:D.opacity)?t:1}},!0),l.init(this,["layer.blendMode"],t=>{this.container&&(this.container.blendMode=t)},!0),l.init(this,["layer.effect"],t=>{this.container&&(this.container.effect=t)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(r=this.view)&&r.whenLayerView?this.view.whenLayerView(this.layer).then(t=>{t!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};A.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};A.isVisibleAtScale=
function(r){var t=!0,D=this.layer;const v=D.minScale;D=D.maxScale;if(null!=v&&null!=D){t=!v;let a=!D;!t&&r<=v&&(t=!0);!a&&r>=D&&(a=!0);t=t&&a}return t};A.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};A.processUpdate=function(r){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",r),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(r)))};A.isUpdating=
function(){return!1};A.isRendering=function(){return!1};A.canResume=function(){return G.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};h._createClass(w,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return w}(u);c.__decorate([g.property({type:F,set(G){G=m.referenceSetter(G,this._get("clips"),F);this._set("clips",G)}})],u.prototype,"clips",void 0);c.__decorate([g.property()],u.prototype,"moving",void 0);
c.__decorate([g.property()],u.prototype,"attached",void 0);c.__decorate([g.property()],u.prototype,"container",void 0);c.__decorate([g.property()],u.prototype,"suspended",void 0);c.__decorate([g.property({readOnly:!0})],u.prototype,"updateParameters",void 0);c.__decorate([g.property()],u.prototype,"updateRequested",void 0);c.__decorate([g.property()],u.prototype,"updating",null);c.__decorate([g.property()],u.prototype,"view",void 0);return u=c.__decorate([f.subclass("esri.views.2d.layers.LayerView2D")],
u)};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y){c=function(q){function m(){return q.apply(this,arguments)||this}k._inheritsLoose(m,q);return m}(y.JSONSupport);return c=h.__decorate([n.subclass("esri.views.layers.support.ClipArea")],c)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y){var q;c=q=function(m){function l(){var B=m.apply(this,arguments)||this;B.type="rect";B.left=null;B.right=null;B.top=null;B.bottom=null;return B}k._inheritsLoose(l,m);l.prototype.clone=function(){return new q({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};k._createClass(l,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return l}(y);h.__decorate([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"left",void 0);
h.__decorate([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"right",void 0);h.__decorate([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"top",void 0);h.__decorate([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"bottom",void 0);h.__decorate([d.property({readOnly:!0})],c.prototype,"version",null);return c=q=h.__decorate([n.subclass("esri.views.layers.support.ClipRect")],c)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y,q,m,l,B,z){var J;c={base:y,key:"type",typeMap:{extent:q,polygon:m}};z=J=function(K){function I(){var F=K.apply(this,arguments)||this;F.type="geometry";F.geometry=null;return F}k._inheritsLoose(I,K);I.prototype.clone=function(){return new J({geometry:this.geometry.clone()})};k._createClass(I,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return I}(z);h.__decorate([d.property({types:c,json:{read:l.fromJSON,write:!0}})],z.prototype,"geometry",void 0);
h.__decorate([d.property({readOnly:!0})],z.prototype,"version",null);return z=J=h.__decorate([n.subclass("esri.views.layers.support.Geometry")],z)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y){c=function(q){function m(){var l=q.apply(this,arguments)||this;l.type="path";l.path=[];return l}k._inheritsLoose(m,q);k._createClass(m,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return m}(y);h.__decorate([d.property({type:[[[Number]]],json:{write:!0}})],c.prototype,"path",void 0);h.__decorate([d.property({readOnly:!0})],c.prototype,"version",null);return c=h.__decorate([n.subclass("esri.views.layers.support.Path")],c)})},"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../engine/BitmapTileContainer".split(" "),
function(k,h,c,C,b,d,g,n,f,x,p,y,q){k.BitmapTileLayerView2D=m=>{m=function(l){function B(){return l.apply(this,arguments)||this}h._inheritsLoose(B,l);var z=B.prototype;z.attach=function(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new q.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)};z.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView.removeAllChildren()};return B}(m);return m=c.__decorate([f.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],
m)};Object.defineProperty(k,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../tiling/TileKey ../../layers/RefreshableLayerView ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../support/drapedUtils ../../layers/TileLayerView ./LayerView2D ./BitmapTileLayerView2D".split(" "),function(k,
h,c,C,b,d,g,n,f,x,p,y,q,m,l,B,z,J,K,I,F,u,G,w){const A=b.getLogger("esri.views.2d.layers.TileLayerView2D"),r=[0,0];c=function(t){function D(){var a=t.apply(this,arguments)||this;a._tileStrategy=null;a._fetchQueue=null;a.layer=null;return a}k._inheritsLoose(D,t);var v=D.prototype;v.initialize=function(){var a=this.layer.tileInfo;a=a&&a.spatialReference;let e;a||(e=new x("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));a.equals(this.view.spatialReference)||
(e=new x("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}));this.watch("resampling",()=>{this.refresh()});e&&this.addResolvingPromise(Promise.reject(e))};v.hitTest=function(){return null};v.update=function(a){this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();this.notifyChange("updating")};v.attach=function(){const a="tileServers"in this.layer?this.layer.tileServers:
null;this._tileInfoView=new z(this.layer.tileInfo,this.layer.fullExtent);this._fetchQueue=new J({tileInfoView:this._tileInfoView,concurrency:a&&10*a.length||10,process:(e,M)=>this.fetchTile(e,M)});this._tileStrategy=new K({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView});this.requestUpdate();this.container.requestRender();t.prototype.attach.call(this)};v.detach=function(){t.prototype.detach.call(this);
this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null};v.moveStart=function(){this.requestUpdate()};v.viewChange=function(){this.requestUpdate()};v.moveEnd=function(){this.requestUpdate()};v.createFetchPopupFeaturesQueryGeometry=function(a,e){return F.createQueryGeometry(a,e,this.view)};v.doRefresh=async function(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(a=>
this._enqueueTileFetch(a)),this.notifyChange("updating"))};v.isUpdating=function(){var a;return 0<(null==(a=this._fetchQueue)?void 0:a.length)};v.acquireTile=function(a){a=this._bitmapView.createTile(a);const e=a.bitmap;[e.x,e.y]=this._tileInfoView.getTileCoords(r,a.key);e.resolution=this._tileInfoView.getTileResolution(a.key);[e.width,e.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(a);this._bitmapView.addChild(a);this.requestUpdate();return a};v.releaseTile=function(a){this._fetchQueue.abort(a.key.id);
this._bitmapView.removeChild(a);a.once("detach",()=>a.destroy());this.requestUpdate()};v.fetchTile=async function(a,e){const M="tilemapCache"in this.layer?this.layer.tilemapCache:null;e=!C.isNone(e)&&e.signal;if(!M)try{return await this._fetchImage(a,e)}catch(H){if(!m.isAbortError(H)&&!this.resampling)return this._createBlankImage();throw H;}const L=new l(0,0,0,0);let E;try{await M.fetchAvailabilityUpsample(a.level,a.row,a.col,L,{signal:e});if(L.level!==a.level&&!this.resampling)return this._createBlankImage();
E=await this._fetchImage(L,e)}catch(H){if(m.isAbortError(H))throw H;E=await this._fetchImage(a,e)}const {level:N,row:P,col:O}=L;return this.resampling&&N!==a.level?this._resampleImage(E,N,P,O,a.level,a.row,a.col):E};v._enqueueTileFetch=async function(a){if(!this._fetchQueue.has(a.key.id)){try{const e=await this._fetchQueue.push(a.key);a.bitmap.source=e;a.bitmap.width=this._tileInfoView.tileInfo.size[0];a.bitmap.height=this._tileInfoView.tileInfo.size[1];a.once("attach",()=>this.requestUpdate())}catch(e){m.isAbortError(e)||
A.error(e)}this.requestUpdate()}};v._fetchImage=async function(a,e){return this.layer.fetchTile(a.level,a.row,a.col,{timestamp:this.refreshTimestamp,signal:e})};v._resampleImage=function(a,e,M,L,E,N,P){const O=this._tileInfoView.tileInfo.size;var H=this._tileInfoView.getTileResolution(e),Q=this._tileInfoView.getTileResolution(E);E=this._tileInfoView.getLODInfoAt(E);P=E.getXForColumn(P);N=E.getYForRow(N);E=this._tileInfoView.getLODInfoAt(e);e=E.getXForColumn(L);L=E.getYForRow(M);M=Math.round((P-e)/
H);e=Math.round(-(N-L)/H);L=Math.round(Q/H*O[0]);H=Math.round(Q/H*O[1]);Q=this._createBlankImage();Q.getContext("2d").drawImage(a,M,e,L,H,0,0,O[0],O[1]);return Q};v._createBlankImage=function(){const a=this._tileInfoView.tileInfo.size,e=document.createElement("canvas");[e.width,e.height]=a;return e};k._createClass(D,[{key:"resampling",get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling}}]);return D}(u.TileLayerView(B.RefreshableLayerView(w.BitmapTileLayerView2D(G.LayerView2DMixin(I)))));
h.__decorate([g.property()],c.prototype,"resampling",null);return c=h.__decorate([f.subclass("esri.views.2d.layers.TileLayerView2D")],c)});