// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../layers/features/support/AttributeStore ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),function(r,v,t,n,u,w,x,y,p){t=function(){function q(a,b,c){this._geometryType=a;this._idField=b;this._templateStore=c}var l=q.prototype;l.update=function(a,b){n.isSome(a.mesh.labels)&&this._setLabelTemplates(a.mesh.labels,
b)};l._setLabelTemplates=function(a,b){this._labelTemplates=a.map(c=>x.fromLabelClass(c,b))};l.analyze=async function(a,b,c,f,e,d){if(!u.isAborted(d)){var h;"dictionary"===b.type&&(h=await b.analyze(this._idField,a.copy(),f,e,d));for(var k=0;a.next();){var g=void 0;g=h?h[k++]:n.isSome(c)&&w.isAggregateId(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?c.match(this._idField,a,this._geometryType,f,e):b.match(this._idField,a,this._geometryType,f,e);a.setGroupId(g);if(p.isDynamicId(g)){g=this._templateStore.getDynamicTemplateGroup(g);
for(const m of g)m&&m.analyze&&m.analyze(this._templateStore,a,f,e)}}return this._templateStore.finalize(d)}};l.analyzeGraphics=async function(a,b,c,f,e){if(!u.isAborted(e)){a=a.getCursor();for(b&&await b.analyze(this._idField,a.copy(),c,f,e);a.next();){let d=a.getGroupId();if(null==d||-1===d)d=b.match(this._idField,a,a.geometryType,c,f),a.setGroupId(d);if(p.isDynamicId(d)){const h=this._templateStore.getDynamicTemplateGroup(d);for(const k of h)k&&k.analyze&&k.analyze(this._templateStore,a,c,f)}a.setGroupId(d)}return this._templateStore.finalize(e)}};
l.writeGraphic=function(a,b){const c=b.getGroupId(),f=b.getDisplayId(),e=this._templateStore.getTemplateGroup(c);a.featureStart(b.insertAfter);if(null!=f){if(p.isDynamicId(c))for(const d of e)d.bindFeature(b,null,null);if(e){for(const d of e)d&&d.write(a,b);a.featureEnd()}}};l.writeCursor=function(a,b,c,f,e,d){const h=b.getGroupId(),k=b.getDisplayId(),g=this._templateStore.getTemplateGroup(h);b.getObjectId();if(null!=k&&g){if(p.isDynamicId(h))for(const m of g)m.bindFeature(b,c,f);for(const m of g)m.write(a,
b);n.isSome(d)&&a.hasRecords&&(c=d&&this._findLabelRef(g),this._writeLabels(a,b,d,c,e))}};l._findLabelRef=function(a){for(const b of a)if(b instanceof y)return b;return null};l._writeLabels=function(a,b,c,f,e){for(const d of c)if(n.isSome(d)&&d){const {glyphs:h,rtl:k,index:g}=d;c=this._labelTemplates[g];c.setZoomLevel(e);c.bindReferenceTemplate(f);c.bindTextInfo(h,k);c.write(a,b)}};v._createClass(q,[{key:"templates",get:function(){return this._templateStore}}]);return q}();r.WGLMeshFactory=t;Object.defineProperty(r,
"__esModule",{value:!0})});