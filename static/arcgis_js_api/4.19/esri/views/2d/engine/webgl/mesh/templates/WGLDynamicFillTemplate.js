// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../definitions ../../number ../../materialKey/MaterialKey ../../color ../../GeometryUtils ../../util/Result ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate".split(" "),function(B,w,m,x,n,C,y,z,D,g,E,F){return function(A){function p(a){var q;var d=A.call(this,a)||this;if(g.isFunction(a.color))d._dynamicPropertyMap.set("_fillColor",(b,e,f)=>(b=a.color(b,e,f))&&y.premultiplyAlphaRGBA(b)||
0);else{const b=a.color;d.fillColor=b&&y.premultiplyAlphaRGBA(b)||0}let r=0;g.isFunction(a.height)||(r=a.height||0);const h="CIMMarkerPlacementInsidePolygon"===(null==(q=a.cim.placement)?void 0:q.type)&&a.cim.placement.shiftOddRows?2:1;d._dynamicPropertyMap.set("_height",(b,e,f)=>g.isFunction(a.height)?a.height(b,e,f)*h:r*h);let c=0;g.isFunction(a.offsetX)||(c=m.pt2px(a.offsetX||0)+128,255<c&&(c=255));d._dynamicPropertyMap.set("_offsetX",(b,e,f)=>g.isFunction(a.offsetX)?(b=m.pt2px(a.offsetX(b,e,f))+
128,255<b&&(b=255),b):c);let l=1;g.isFunction(a.scaleX)||(l=a.scaleX||1);d._dynamicPropertyMap.set("_scaleX",(b,e,f)=>g.isFunction(a.scaleX)?a.scaleX(b,e,f):l);let k=0;g.isFunction(a.offsetY)||(k=m.pt2px(-a.offsetY||0)+128,255<k&&(k=255));d._dynamicPropertyMap.set("_offsetY",(b,e,f)=>g.isFunction(a.offsetY)?(b=m.pt2px(-a.offsetY(b,e,f))+128,255<b&&(b=255),b):k);let t=0;g.isFunction(a.angle)||(t=z.radToByte(a.angle)||0);d._dynamicPropertyMap.set("_angle",(b,e,f)=>g.isFunction(a.angle)?z.radToByte(a.angle(b,
e,f)):t);d._effects=a.effects;d._cimFillLayer=a;d._fillMaterialKey=C.FillMaterialKey.load(a.materialKey);return d}B._inheritsLoose(p,A);p.fromCIMFill=function(a){return new p(a)};p.prototype.bindFeature=function(a,q,d){const r=a.readLegacyFeature();this._dynamicPropertyMap.forEach((l,k)=>{this[k]=l(r,q,d)});a=this._fillMaterialKey;var h=this._materialCache,c=this._cimFillLayer;this.aux3=n.i8888to32(0,0,this._angle,c.colorLocked?1:0);c=c.materialHash;c=c(r,q,d);c=h.get(c);h=null;c&&D.ok(c.spriteMosaicItem)&&
(h=c.spriteMosaicItem);if(h){const {rect:l,width:k,height:t}=h;c=l.x+x.SPRITE_PADDING;const b=l.y+x.SPRITE_PADDING,e=c+k,f=b+t;let u=w.nextHighestPowerOfTwo(m.pt2px(this._height));255<u?u=255:0>=u&&(u=w.nextHighestPowerOfTwo(f-b));let v=w.nextHighestPowerOfTwo(m.pt2px(this._height/t*k||0));255<v?v=255:0>=v&&(v=w.nextHighestPowerOfTwo(e-c));const G=this._scaleX;this.tl=n.i1616to32(c,b);this.br=n.i1616to32(e,f);this.aux1=n.i8888to32(v,u,this._offsetX,this._offsetY);this.aux2=n.i1616to32(128*G,128);
a.sdf=h.sdf;a.pattern=!0;a.textureBinding=h.textureBinding}else this.aux2=this.aux1=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return p}(E(F))});