// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Logger ../../../../core/Error ../../../../core/mathUtils ../../../../core/screenUtils ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./enums ./color ./SymbolProperties".split(" "),function(b,q,r,A,B,t,u,M,v,w,x,Y,Z,aa,f,C,N){function m(a){const c={};for(const d of a)c[d.name]=
d.strideInBytes;return c}function D(a){switch(a){case f.WGLGeometryType.MARKER:return O;case f.WGLGeometryType.FILL:return P;case f.WGLGeometryType.LINE:return Q;case f.WGLGeometryType.TEXT:return R;case f.WGLGeometryType.LABEL:return S}}function E(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function F(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function T(a){const c={};for(const d in a){let e=0;c[d]=a[d].map(g=>
{const h={...g,normalized:g.normalized||!1,divisor:g.divisor||0,offset:e,stride:0};e+=g.count*F(g.type);return h});c[d].forEach(g=>g.stride=e)}return c}const p=q.getLogger("esri.views.2d.engine.webgl.Utils");q=[{name:"geometry",strideInBytes:32,divisor:0}];t=[{name:"geometry",strideInBytes:32,divisor:0}];u=[{name:"geometry",strideInBytes:12,divisor:0}];v=[{name:"geometry",strideInBytes:36,divisor:0}];w=[{name:"geometry",strideInBytes:32,divisor:0}];x=[{name:"geometry",strideInBytes:36,divisor:0}];
const G=m(q),H=m(t),I=m(u),J=m(v),K=m(w),L=m(x),O=["geometry"],P=["geometry"],Q=["geometry"],R=["geometry"],S=["geometry"],y=new Map;b.C_FILL_STRIDE_SPEC=H;b.C_FILL_STRIDE_SPEC_DD=I;b.C_FILL_VERTEX_DEF=t;b.C_FILL_VERTEX_DEF_DD=u;b.C_ICON_STRIDE_SPEC=G;b.C_ICON_VERTEX_DEF=q;b.C_LABEL_STRIDE_SPEC=L;b.C_LABEL_VERTEX_DEF=x;b.C_LINE_STRIDE_SPEC=J;b.C_LINE_VERTEX_DEF=v;b.C_TEXT_STRIDE_SPEC=K;b.C_TEXT_VERTEX_DEF=w;b.C_VBO_GEOMETRY="geometry";b.C_VBO_INFO={["geometry"]:35044};b.C_VBO_PERINSTANCE="per_instance";
b.C_VBO_PERINSTANCE_VV="per_instance_vv";b.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*c/4));case 1:case 3:return new Uint8Array(a*c)}};b.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};b.copyMeshData=function(a,c,d,e,g,h,k){for(const z in h){var n=h[z].stride,l=E(n);const U=h[z].data,V=d[z].data,W=n*g.vertexCount/l,X=n*a/l;n=n*g.vertexFrom/l;for(l=0;l<
W;++l)V[l+X]=U[l+n]}d=g.indexCount;for(h=0;h<d;++h)e[h+c]=k[h+g.indexFrom]-g.vertexFrom+a};b.createGeometryData=function(a,c){const d=[];for(let e=0;5>e;++e){const g=D(e),h={};for(const k of g)h[k]={data:c(e,k)};d.push({data:a(e),buffers:h})}return d};b.createProgramDescriptor=(a,c)=>{if(!y.has(a)){const g=T(c);var d=g;var e={};for(const h in d){const k=d[h];e[h]=k.length?k[0].stride:0}d=e;e={};for(const h in c)for(const k of c[h])e[k.name]=k.location;c=e;y.set(a,{strides:d,bufferLayouts:g,attributes:c})}return y.get(a)};
b.createTextureFromTexelData=function(a,c){let d,e;A.isPowerOfTwo(c.width)&&A.isPowerOfTwo(c.height)?(d=!0,e=9987):(d=!1,e=9729);return new M(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:d,samplingMode:e,wrapMode:33071,flipped:!0},c)};b.forEachGeometryType=function(a){a(f.WGLGeometryType.MARKER);a(f.WGLGeometryType.FILL);a(f.WGLGeometryType.LINE);a(f.WGLGeometryType.TEXT);a(f.WGLGeometryType.LABEL)};b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,
geometry:a}};b.getBytes=F;b.getCapType=function(a,c){switch(a){case "butt":return 0;case "round":return c?2:1;case "square":return 2;default:return p.error(new r("mapview-invalid-type",`Cap type ${a} is not a valid option. Defaulting to round`)),1}};b.getJoinType=function(a){switch(a){case "miter":return 2;case "bevel":return 0;case "round":return 1;default:return p.error(new r("mapview-invalid-type",`Join type ${a} is not a valid option. Defaulting to round`)),1}};b.getNamedBuffers=D;b.getPixelArrayCtor=
function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:p.error(new r("webgl-utils",`Unable to handle type ${a}`))}};b.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:p.error(new r("webgl-utils",`Unable to handle type ${a}`))}};b.getStrides=function(a,c){switch(a){case f.WGLGeometryType.MARKER:return G;case f.WGLGeometryType.FILL:return c?I:H;case f.WGLGeometryType.LINE:return J;case f.WGLGeometryType.TEXT:return K;
case f.WGLGeometryType.LABEL:return L}};b.getTextProperties=function(a){return N.TextProperties.pool.acquire(a.color?C.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?C.copyAndPremultiply(a.haloColor):[255,255,255,255],B.pt2px(a.haloSize),B.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.getTransformParams=function(a){const {transform:c,
hasZ:d,hasM:e}=a;return{transform:c,hasZ:d,hasM:e}};b.getVVType=function(a){switch(a){case "opacity":return f.VVType.OPACITY;case "color":return f.VVType.COLOR;case "rotation":return f.VVType.ROTATION;case "size":return f.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${a}`),null}};b.isDefined=function(a){return null!=a};b.isNumber=function(a){return"number"===typeof a};b.strideToPackingFactor=E;Object.defineProperty(b,"__esModule",{value:!0})});