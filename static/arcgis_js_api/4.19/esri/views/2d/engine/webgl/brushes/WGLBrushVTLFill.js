// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../definitions ../../../../../chunks/mat3f32 ../number ../enums ./WGLBrush".split(" "),function(E,J,F,z,K,L,A,B){const G=1/65536;B=function(H){function C(){var a=H.apply(this,arguments)||this;a._fillProgramOptions={id:!1,pattern:!1};a._outlineProgramOptions={id:!1};a._patternMatrix=K.create();return a}J._inheritsLoose(C,H);var x=C.prototype;x.dispose=function(){};x.drawMany=function(a,t){const {displayLevel:k,
drawPhase:d,renderPass:h,styleLayerUID:e}=a,b=a.styleLayer;var l=b.getPaintValue("fill-pattern",k),c=void 0!==l;const v=!c&&b.getPaintValue("fill-antialias",k);let u=!0;var p=1;if(!c){c=b.getPaintProperty("fill-color");var q=b.getPaintProperty("fill-opacity");null!=c&&c.isDataDriven||null!=q&&q.isDataDriven||(p=b.getPaintValue("fill-color",k),p=b.getPaintValue("fill-opacity",k)*p[3],1<=p&&(u=!1))}if(!u||"opaque"!==h){var f;d===A.WGLDrawPhase.HITTEST&&(f=L.u32to4Xu8(e+1));c=b.getPaintValue("fill-translate",
k);q=b.getPaintValue("fill-translate-anchor",k);(u||"translucent"!==h)&&this._drawFill(a,e,b,t,c,q,l,f);l=!b.hasDataDrivenOutlineColor&&b.outlineUsesFillColor&&1>p;v&&"opaque"!==h&&!l&&this._drawOutline(a,e,b,t,c,q,f)}};x._drawFill=function(a,t,k,d,h,e,b,l){const {context:c,displayLevel:v,state:u,drawPhase:p,painter:q,pixelRatio:f,spriteMosaic:y}=a;a=k.fillMaterial;var g=q.vectorTilesMaterialManager;const w=void 0!==b,n=f>z.VTL_HIGH_RES_CUTOFF?2:1;let r;const I=p===A.WGLDrawPhase.HITTEST,D=this._fillProgramOptions;
D.id=I;D.pattern=w;g=g.getMaterialProgram(c,a,D);c.bindProgram(g);if(w){r=y.getMosaicItemPosition(b,!0);if(!r){c.bindProgram();return}g.setUniform2f("u_pattern_tl",r.tl[0],r.tl[1]);g.setUniform2f("u_pattern_br",r.br[0],r.br[1]);g.setUniform1i("u_texture",z.VTL_TEXTURE_BINDING_UNIT_SPRITES);y.bind(c,9729,r.page,z.VTL_TEXTURE_BINDING_UNIT_SPRITES)}g.setUniformMatrix3fv("u_displayMat3",1===e?u.displayMat3:u.displayViewMat3);g.setUniform2fv("u_fillTranslation",h);g.setUniform1f("u_depth",k.z+G);I&&g.setUniform4fv("u_id",
l);h=-1;for(const m of d)m.layerData.has(t)&&(m.key.level!==h&&(h=m.key.level,a.setDataUniforms(g,v,k,h)),d=m.layerData.get(t),d.prepareForRendering(c),e=d.fillVertexArrayObject,F.isNone(e)||(c.bindVAO(e),g.setUniformMatrix3fv("u_dvsMat3",m.transforms.dvs),w&&(e=m.coordRange[0]/(n*m.size[0]*Math.max(2**(Math.round(v)-m.key.level),1)),b=1/(r.size[1]*e),this._patternMatrix[0]=1/(r.size[0]*e),this._patternMatrix[4]=b,g.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),c.setStencilFunction(514,
m.stencilRef,255),c.drawElements(4,d.fillIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*d.fillIndexStart),m.triangleCount+=d.fillIndexCount/3))};x._drawOutline=function(a,t,k,d,h,e,b){const {context:l,displayLevel:c,state:v,drawPhase:u,painter:p,pixelRatio:q}=a;a=k.outlineMaterial;var f=p.vectorTilesMaterialManager;const y=.75/q,g=u===A.WGLDrawPhase.HITTEST,w=this._outlineProgramOptions;w.id=g;f=f.getMaterialProgram(l,a,w);l.bindProgram(f);f.setUniformMatrix3fv("u_displayMat3",1===e?v.displayMat3:
v.displayViewMat3);f.setUniform2fv("u_fillTranslation",h);f.setUniform1f("u_depth",k.z+G);f.setUniform1f("u_outline_width",y);g&&f.setUniform4fv("u_id",b);h=-1;for(const n of d)n.layerData.has(t)&&(n.key.level!==h&&(h=n.key.level,a.setDataUniforms(f,c,k,h)),d=n.layerData.get(t),d.prepareForRendering(l),e=d.outlineVertexArrayObject,F.isNone(e)||(l.bindVAO(e),f.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),l.setStencilFunction(514,n.stencilRef,255),l.drawElements(4,d.outlineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*
d.outlineIndexStart),n.triangleCount+=d.outlineIndexCount/3))};return C}(B);E.WGLBrushVTLFill=B;Object.defineProperty(E,"__esModule",{value:!0})});