// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Logger","../../../../../core/mathUtils","../../../../../core/screenUtils","./visualVariableSimpleUtils"],function(m,n,t,v,w){function u(a,b){const c=!!a.maxScale,d=!!a.minScale&&b.scaleToZoom(a.minScale)||0;b=c&&b.scaleToZoom(a.maxScale)||255;return{deconflictionStrategy:a.deconflictionStrategy,minZoom:t.clamp(Math.floor(10*d),0,255),maxZoom:t.clamp(Math.floor(10*b),0,255)}}function x(a){return b=>v.pt2px(w.getSizeForValueSimple(b,a))}function p(a){if(!a)return null;
for(const b of a)if("size"===b.type)return x(b);return null}const y=(a,b)=>a.order-b.order,z=(a,b)=>a.index-b.index,A=n.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");n=function(){function a(c,d,f,g){this._vvHandle=null;var e=c.layer;const {geometryType:k,labelingInfo:l,renderer:q}=e;q&&(this.vvEval=p("visualVariables"in q&&q.visualVariables));this._vvHandle=e.watch("renderer",h=>{h&&(this.vvEval=p("visualVariables"in h&&h.visualVariables))});var r=(e=e.featureReduction)&&"cluster"===
e.type&&e.labelingInfo;e=(l||[]).map(h=>u(h,g));r=(r||[]).map(h=>u(h,g));this.layerView=c;this.geometryType=k;this.index=d;this.order=f;this.zoomRanges=[...e,...r];this.layerView=c}var b=a.prototype;b.hasVV=function(){return!!this.vvEval};b.allOrNothing=function(){return"polyline"!==this.geometryType};b.destroy=function(){this._vvHandle.remove()};a.create=function(c,d,f,g){f=f.sort(y);let e=!1,k=-1;for(const l of f)!e&&l.order>d&&(k=l.index,e=!0),e&&l.index++;e||(k=f.length);return new a(c,k,d,g)};
a.delete=function(c,d){const f=d.sort(z);for(let g=c+1;g<f.length;g++)d[g].index--;d[c].destroy();d.splice(c,1)};a.find=function(c,d){for(const f of d)if(f.index===c)return f;A.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();m.createLabelVVEvaluator=p;m.default=n;Object.defineProperty(m,"__esModule",{value:!0})});