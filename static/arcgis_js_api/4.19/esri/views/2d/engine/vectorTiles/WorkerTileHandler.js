// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["../../../../core/promiseUtils","./style/StyleRepository","./WorkerTile"],function(n,p,q){return function(){function m(){this._spriteInfo={};this._glyphInfo={}}var f=m.prototype;f.reset=function(){this._spriteInfo={};this._glyphInfo={};return Promise.resolve()};f.getLayers=function(){var a;return null==(a=this._styleRepository)?void 0:a.layers};f.createTileAndParse=async function(a,c){var {key:b}=a;const g={};for(const d of Object.keys(a.sourceName2DataAndRefKey))g[d]=a.sourceName2DataAndRefKey[d].refKey;
b=new q(b,g,this,this._styleRepository);try{return await b.parse(a,this._vectorTileLayerMaxBuffers,c)}catch(d){b.setObsolete();b.release();if(!n.isAbortError(d))throw d;return null}};f.updateStyle=function(a){if(a&&0!==a.length&&this._styleRepository){var c=this._styleRepository;for(const b of a)switch(a=b.data,b.type){case 0:c.setPaintProperties(a.layerName,a.paint);break;case 1:c.setLayoutProperties(a.layerName,a.layout);break;case 3:c.deleteStyleLayer(a.layerName);break;case 2:c.setStyleLayer(a.layer,
a.index)}}};f.setStyle=function(a){this._styleRepository=new p(a.style);this._spriteInfo={};this._glyphInfo={};this._vectorTileLayerMaxBuffers=a.vectorTileLayerMaxBuffers};f.fetchSprites=function(a,c,b){const g=[],d=this._spriteInfo;a.forEach(e=>{void 0===d[e]&&g.push(e)});return 0===g.length?Promise.resolve():c.invoke("getSprites",g,{signal:b&&b.signal}).then(e=>{for(const k in e)d[k]=e[k]})};f.getSpriteItems=function(){return this._spriteInfo};f.fetchGlyphs=function(a,c,b,g,d){const e=[];let k=
this._glyphInfo[c];k?b.forEach(h=>{k[h]||e.push(h)}):(k=this._glyphInfo[c]=[],b.forEach(h=>e.push(h)));return 0===e.length?Promise.resolve():g.invoke("getGlyphs",{tileID:a,font:c,codePoints:e},d).then(h=>{for(let l=0;l<h.length;l++)h[l]&&(k[l]=h[l])})};f.getGlyphItems=function(a){return this._glyphInfo[a]};return m}()});