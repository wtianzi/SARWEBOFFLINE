// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../chunks/vec2 ../../support/QueueProcessor".split(" "),function(x,m,k,G,H,p,I,B,J,K,L,C,D,E){function F(q,r){q.length=
0;r.forEach(c=>q.push(c));return q}const w=new Set,u=[],t=new Map,y=[0,0];k=function(q){function r(a){a=q.call(this,a)||this;a._keyToItem=new Map;a.concurrency=6;a.strategy="scale-first";a.tileInfoView=null;return a}x._inheritsLoose(r,q);var c=r.prototype;c.initialize=function(){const {concurrency:a,process:h}=this;this._queue=new E.QueueProcessor({concurrency:a,process:(b,g)=>{b=this._keyToItem.get(b);return h(b,{signal:g})},peeker:b=>b.values().next().value})};c.destroy=function(){this.clear();
this._queue.destroy();this._queue=null};c.abort=function(a){this._queue.abort("string"===typeof a?a:a.id)};c.clear=function(){this._queue.clear();this._keyToItem.clear();this.notifyChange("updating")};c.has=function(a){return"string"===typeof a?this._keyToItem.has(a):this._keyToItem.has(a.id)};c.isOngoing=function(a){a="string"===typeof a?a:a.id;return this.has(a)&&this._queue.isOngoing(a)};c.pause=function(){this._queue.pause()};c.push=function(a,h){const b=a.key.id+"-"+h;if(this.has(b))return this.get(b);
h=this._queue.push(b);const g=()=>{this._keyToItem.delete(b);this.notifyChange("updating")};this._keyToItem.set(b,a);h.then(g,g);this.notifyChange("updating");return h};c.reset=function(){this._queue.reset();this.notifyChange("updating")};c.resume=function(){this._queue.resume()};c._peekByScaleFirst=function(a){if(!this.state)return a.values().next().value;const h=this.tileInfoView;let b=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY;a.forEach(f=>{f=this._keyToItem.get(f);const d=this.tileInfoView.getTileScale(f.key);
t.has(d)||(t.set(d,[]),b=Math.max(d,b),g=Math.min(d,g));t.get(d).push(f.key);w.add(d)});let e=this.state.scale;t.has(e)||(F(u,w),u.sort(),e=u.reduce((f,d)=>Math.abs(d-e)<Math.abs(f-e)?d:f,u[0]));e=Math.min(e,b);e=Math.max(e,g);a=t.get(e);const l=h.getClosestInfoForScale(e),n=l.getColumnForX(this.state.center[0]),v=l.getRowForY(this.state.center[1]);a.sort((f,d)=>{const z=l.denormalizeCol(f.col,f.world),A=l.denormalizeCol(d.col,d.world);return Math.sqrt((n-z)*(n-z)+(v-f.row)*(v-f.row))-Math.sqrt((n-
A)*(n-A)+(v-d.row)*(v-d.row))});w.clear();t.clear();return a[0].id};c._peekByCenterFirst=function(a){if(!this.state)return a.values().next().value;const h=this.tileInfoView,b=this.state.center;let g=Number.POSITIVE_INFINITY,e=null;a.forEach(l=>{l=this._keyToItem.get(l);h.getTileCoords(y,l.key);const n=D.distance(y,b);n<g&&(g=n,e=l.key)});return e.id};x._createClass(r,[{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},
{key:"updating",get:function(){return 0<this.length||0<this.onGoingCount}}]);return r}(C);m.__decorate([p.property({constructOnly:!0})],k.prototype,"concurrency",void 0);m.__decorate([p.property({constructOnly:!0})],k.prototype,"process",void 0);m.__decorate([p.property()],k.prototype,"state",void 0);m.__decorate([p.property({constructOnly:!0})],k.prototype,"strategy",void 0);m.__decorate([p.property({constructOnly:!0})],k.prototype,"tileInfoView",void 0);m.__decorate([p.property({readOnly:!0})],
k.prototype,"updating",null);return k=m.__decorate([B.subclass("esri.views.2d.tiling.PagedTileQueue")],k)});