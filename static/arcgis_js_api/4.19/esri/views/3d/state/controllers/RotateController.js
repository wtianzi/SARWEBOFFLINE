// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../Constraints ../../camera/constraintUtils ../utils/navigationUtils ./InteractiveController".split(" "),
function(h,r,p,A,I,J,t,K,B,L,M,N,u,C,k,c,D,q,E,v,F,w,G,m,H){h.RotateController=function(x){function n(a){a=x.call(this,a)||this;a.view=null;a.pivot="center";a.lastPoint=v.create();a.tmpWorldUp=k.create();a.tmpViewDir=k.create();a.tmpRotCurPoint=v.create();a.tmpTransf=E.create();a.tmpAxis=k.create();a.tmpPivotPoint=k.create();a.pivotPos=k.create();a.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return a}r._inheritsLoose(n,
x);var l=n.prototype;l.initialize=function(){this.rotScale="center"===this.pivot?3:1.5};l.begin=function(a){if(this.active){switch(this.pivot){case "eye":c.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||c.copy(this.pivotPos,this.beginCamera.center),A("disable-feature:context-navigation")||
this.constrainPivotPoint(a),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;m.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};l.constrainPivotPoint=function(a){const b=this.beginCamera,f=k.create();var e;c.subtract(f,this.pivotPos,b.eye);this.view.camera.position.hasZ&&(e=Math.abs(this.view.camera.position.z));let g=c.length(f);
this.view.camera.position.hasZ&&g>7*e&&(g=7*e);e=D.getReferenceEllipsoid(this.view.spatialReference);var d=C.createScreenPointArray(b.width/b.pixelRatio*.5,b.height/b.pixelRatio*.5);e=m.decideNavigationMode(this.beginCamera,d,!0,e);d=this.view._stage.renderView.getMinimalDepthForArea(b.fullWidth/b.pixelRatio*.5,b.fullHeight/b.pixelRatio*.5,b,90,2.5);a=this.view._stage.renderView.getMinimalDepthForArea(a[0],a[1],b,90);if(void 0!==d||void 0!==a)d=void 0===d?a:d,a=void 0===a||e===m.NavigationMode.Horizontal?
d:a,g=d>a?a:d;c.normalize(f,f);c.copy(this.pivotPos,c.add(this.tmpPivotPoint,b.eye,c.scale(this.tmpPivotPoint,f,g)))};l.update=function(a){if(this.active){switch(this.pivot){case "eye":var b=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);G.applyAll(this.view,this.currentCamera,this.constraintOptions)}};l.end=function(){this.active&&this.finishController()};l.applyRotation=function(a,
b,f,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp);m.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let g=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;c.subtract(this.tmpViewDir,f,e);var d=c.length(this.tmpViewDir);d=u.acosClamped(c.dot(this.tmpViewDir,this.tmpWorldUp)/d);if("eye"===this.pivot){const y=.5*Math.PI-d,z=.495*Math.PI;b=y-Math.max(-z,Math.min(z,y+-.5*b))}b=u.clamp(b+d,w.TiltDefault.min,w.TiltDefault.max)-
d;q.identity(this.tmpTransf);c.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(g=-g);q.rotate(this.tmpTransf,this.tmpTransf,g,this.tmpWorldUp);q.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);c.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);c.add(f,e,this.tmpViewDir);c.transformMat4(a.up,a.up,this.tmpTransf);F.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};r._createClass(n,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return n}(H.InteractiveController);p.__decorate([t.property({constructOnly:!0})],h.RotateController.prototype,"view",void 0);p.__decorate([t.property()],h.RotateController.prototype,"pivot",void 0);h.RotateController=p.__decorate([B.subclass("esri.views.3d.state.controllers.RotateController")],h.RotateController);Object.defineProperty(h,"__esModule",{value:!0})});