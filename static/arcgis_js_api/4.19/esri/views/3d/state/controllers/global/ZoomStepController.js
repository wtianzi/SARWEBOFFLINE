// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../support/geometryUtils ../../../webgl-engine/lib/Intersector ../../../camera/constraintUtils/surfaceCollision ../../../../animation/easing ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../PointToPointAnimationController ../../utils/navigationUtils".split(" "),
function(l,u,v,w,E,F,G,H,x,I,J,K,k,c,y,n,z,A,B,C,r,D,p){l.ZoomStepController=function(t){function q(){var a=t.apply(this,arguments)||this;a.zoomLocation=k.create();a.tmpCamera=new r;a.tmpViewDir=k.create();a.tmpRayDir={origin:k.create(),direction:k.create()};a.targetOnSphere=k.create();a.tmpCenter=k.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new r,interactionDirection:null,tiltMode:0};a.sphere=n.sphere.create();return a}u._inheritsLoose(q,
t);var m=q.prototype;m.initialize=function(){this.intersector=new z.Intersector(this.view.state.mode)};m.zoomStep=function(a,e){if(this.active){var f=this.view.state,{interactionStartCamera:d}=this.constraintOptions;this.animation.finished?d.copyFrom(f.camera):this.animation.cameraAt(1,d);var b=d=!1;this.intersectionHelper.intersectScreen(e,this.zoomLocation)&&(d=0<a?!0:!1,b=!0);this.tmpCamera.copyFrom(f.camera);d?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:c.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,a,this.zoomLocation,e,b);this.begin(this.tmpCamera)}};m.animationSettings=function(){return{apex:null,duration:.6,easing:B.outExpo}};m.updateCamera=function(a,e,f,d,b){var h=y.getReferenceEllipsoid(this.view.spatialReference);if(p.decideNavigationMode(a,
d,b,h)===p.NavigationMode.Horizontal||w("disable-feature:context-navigation")){e=.6**e;this.sphere[3]=c.length(f);c.subtract(this.tmpViewDir,a.center,a.eye);b=c.length(this.tmpViewDir);h=b*e;1>=e&&4>h&&(h=4,e=h/b);if(1E-6>Math.abs(b-h))return;b=c.length(a.center);this.sphere[3]!==b&&c.scale(a.center,a.center,(this.sphere[3]+e*(b-this.sphere[3]))/b);c.scale(this.tmpViewDir,this.tmpViewDir,-e);c.add(a.eye,a.center,this.tmpViewDir);C.applyAll(this.view,a,this.constraintOptions);1E-12<c.squaredDistance(f,
a.center)&&n.sphere.intersectScreen(this.sphere,a,d,this.targetOnSphere)&&p.panToPosition(this.sphere,a,f,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{b=.6**Math.abs(e);h=0<e?1:-1;n.ray.fromScreenAtEye(a,d,this.tmpRayDir);c.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var g;this.view.camera.position.hasZ&&(g=Math.abs(this.view.camera.position.z));g=Math.max(12*g,20);d=this.view._stage.renderView.getMinimalDepthForArea(d[0],d[1],this.view._stage.camera,
60);g=g>d?d:g;c.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,g);c.add(f,this.tmpRayDir.origin,this.tmpRayDir.direction);f=g*b;0<e&&4>f&&(f=4,b=f/g);if(1E-6>Math.abs(g-f))return;c.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-b));c.add(a.eye,a.eye,this.tmpRayDir.direction);c.add(a.center,a.center,this.tmpRayDir.direction)}A.applySurfaceCollisionConstraint(this.view,a)};return q}(D.PointToPointAnimationController);l.ZoomStepController=v.__decorate([x.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
l.ZoomStepController);Object.defineProperty(l,"__esModule",{value:!0})});