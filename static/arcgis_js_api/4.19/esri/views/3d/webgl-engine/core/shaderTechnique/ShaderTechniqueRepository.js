// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(h,l,k){let m=function(g){this.technique=g;this.refZeroFrame=this.refCount=0},p=function(){function g(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}var f=g.prototype;f.dispose=function(){this._perConstructorInstances.forEach(a=>a.forEach(c=>c.technique.dispose()));this._perConstructorInstances.clear()};f.acquire=function(a,c){const b=
c.key;let d=this._perConstructorInstances.get(a);d||(d=new Map,this._perConstructorInstances.set(a,d));let e=d.get(b);void 0===e&&(e=new m(new a(this._context,c)),d.set(b,e));++e.refCount;return e.technique};f.acquireAndReleaseExisting=function(a,c,b){return k.isNone(b)?this.acquire(a,c):c.key===b.key&&b instanceof a?b:(this.release(b),this.acquire(a,c))};f.release=function(a){k.isNone(a)||(a=this._perConstructorInstances.get(a.constructor).get(a.key),--a.refCount,0===a.refCount&&(a.refZeroFrame=
this._frameCounter))};f.frameUpdate=function(){this._frameCounter++;this._perConstructorInstances.forEach((a,c)=>{a.forEach((b,d)=>{0===b.refCount&&b.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(b.technique.dispose(),a.delete(d))});0===a.size&&this._perConstructorInstances.delete(c)})};f.getProgramsUsingUniform=function(a){return this._context.commonUniformStore.getPrograms(a)};f.hotReload=async function(){const a=[];this._perConstructorInstances.forEach((c,b)=>{a.push((async(d,e)=>
{if(e=e.shader)await e.reload(),d.forEach(n=>{n.technique.reload(this._context)})})(c,b))});await Promise.all(a)};l._createClass(g,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return g}();h.ShaderTechniqueRepository=p;Object.defineProperty(h,"__esModule",{value:!0})});