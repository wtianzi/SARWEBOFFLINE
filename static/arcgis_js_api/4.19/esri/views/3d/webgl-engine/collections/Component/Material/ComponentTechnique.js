// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../../../webgl/Program ../../../../../webgl/renderState ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../lib/OrderIndependentTransparency ../../../lib/StencilUtils ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../../chunks/ComponentShader.glsl".split(" "),
function(z,p,t,g,m,A,B,u,q,f,C,v,D,E,r,w,F,G,H,x,e){const h={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9,TERRAIN_LINEAR_DEPTH:10,GEOMETRY_LINEAR_DEPTH:11};q=function(n){function l(){return n.apply(this,arguments)||this}t._inheritsLoose(l,n);var c=l.prototype;c.bindPass=function(d,a){const b=this.program;x.VertexPosition.bindViewProjTransform(b,
a.viewTransform);D.Slice.bindUniforms(this.program,this.configuration,a.slicePlane);0===a.identifier&&void 0!==a.ssrParams&&(a.ssrParams.lastFrameColorTextureUnit=h.LAST_FRAME_COLOR,a.ssrParams.linearDepthTextureUnit=h.PREPASS_LINEAR_DEPTH,F.ScreenSpaceReflections.bindUniforms(this.program,d,a.ssrParams));0===a.identifier&&(b.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",a.transformNormal_ViewFromGlobal),2===a.subPass&&b.setUniform2fv("cameraNearFar",a.cameraNearFar),0!==a.subPass&&1!==a.subPass||
!a.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",a.cameraNearFar),b.setUniform2fv("inverseViewport",a.inverseViewport),a.multipassTerrainParams.terrainLinearDepthTexture&&(b.setUniform1i("terrainDepthTexture",h.TERRAIN_LINEAR_DEPTH),d.bindTexture(a.multipassTerrainParams.terrainLinearDepthTexture,h.TERRAIN_LINEAR_DEPTH))),0===a.subPass&&(a.ambientOcclusionEnabled&&a.ambientOcclusion.bind(b,h.SSAO),a.shadowsEnabled&&a.shadowMap.bind(b,h.SHADOW_MAP),a.lighting.setUniforms(this.program,
a.integratedMesh)));1===a.identifier&&this.program.setUniform2fv("cameraNearFar",a.cameraNearFar);2===a.identifier&&E.OutputHighlight.bindOutputHighlight(d,this.program,a)};c.bindDraw=function(d,a){x.VertexPosition.bindModelTransform(this.program,d);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",d.transformNormal_GlobalFromModel);if(a.isIntegratedMesh){const b=a.overlayTexScale;a=a.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[d.toMapSpace[0]*b[0]+a[0],d.toMapSpace[1]*
b[1]+a[1],d.toMapSpace[0]*b[2]+a[2],d.toMapSpace[1]*b[3]+a[3]]);this.program.setUniform4fv("overlayTexScale",[d.toMapSpace[2]*b[0],d.toMapSpace[3]*b[1],d.toMapSpace[2]*b[2],d.toMapSpace[3]*b[3]])}};c.bindMaterial=function(d,a,b){const k=this.program;k.setUniform4fv("uBaseColor",a.baseColor);k.setUniform1f("uObjectOpacity",a.objectOpacity);k.setUniform1f("textureAlphaCutoff",a.alphaCutoff);1===a.componentParameters.type?a.componentParameters.texture.bind(k,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",
unit:h.COMPONENT_COLOR}):(k.setUniform4fv("uExternalColor",a.componentParameters.externalColor),k.setUniform1i("uExternalColorMixMode",a.componentParameters.externalColorMixMode));m.isSome(a.baseColorTexture)&&a.baseColorTexture.bind(d,k,"uBaseColorTexture",h.DIFFUSE,"uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)H.PhysicallyBasedRenderingParameters.bindUniforms(this.program,a,this.configuration.isSchematic),m.isSome(a.metallicRoughnessTexture)&&a.metallicRoughnessTexture.bind(d,
k,"texMetallicRoughness",h.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),m.isSome(a.emissionTexture)&&a.emissionTexture.bind(d,k,"texEmission",h.EMISSION,"texEmissionSize"),m.isSome(a.occlusionTexture)&&a.occlusionTexture.bind(d,k,"texOcclusion",h.OCCLUSION,"texOcclusionSize"),m.isSome(a.normalTexture)&&a.normalTexture.bind(d,k,"normalTexture",h.NORMAL,"normalTextureSize");a.isIntegratedMesh&&(0===b.identifier&&0===b.subPass?(d.bindTexture(m.unwrap(a.overlayColorInner),h.OVERLAY0_COLOR),d.bindTexture(m.unwrap(a.overlayColorOuter),
h.OVERLAY1_COLOR),d.bindTexture(m.unwrap(a.overlayNormalInner),h.OVERLAY0_NORMAL),d.bindTexture(m.unwrap(a.overlayNormalOuter),h.OVERLAY1_NORMAL),k.setUniform1i("ovInnerNormalTex",h.OVERLAY0_NORMAL),k.setUniform1i("ovOuterNormalTex",h.OVERLAY1_NORMAL)):2===b.identifier&&(d.bindTexture(m.unwrap(a.overlayHighlightInner),h.OVERLAY0_COLOR),d.bindTexture(m.unwrap(a.overlayHighlightOuter),h.OVERLAY1_COLOR)),k.setUniform1i("ovInnerColorTex",h.OVERLAY0_COLOR),k.setUniform1i("ovOuterColorTex",h.OVERLAY1_COLOR),
k.setUniform1f("overlayOpacity",1))};c.initializeProgram=function(d){const a=l.shader.get();var b=this.configuration;b=a.build({multipassTerrainEnabled:b.multipassTerrainEnabled,cullAboveGround:b.cullAboveGround,OITEnabled:0===b.transparencyPassType,output:b.output,normalType:0===b.integratedMeshMode?b.hasNormals?1:3:2,attributeColor:b.hasVertexColors,attributeTextureCoordinates:b.vertexTextureCoordinates,componentData:b.componentData,alphaDiscardMode:b.alphaDiscardMode,baseColorTexture:b.baseColorTexture,
doubleSidedMode:b.doubleSidedMode,receiveAmbientOcclusion:b.receiveAmbientOcclusion,receiveShadows:b.receiveShadows,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:d.viewingMode,vertexDiscardMode:b.vertexDiscardMode,pbrMode:3===b.integratedMeshMode?4:b.usePBR?b.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:b.hasMetalnessAndRoughnessTexture,hasEmissionTexture:b.hasEmissionTexture,hasOcclusionTexture:b.hasOcclusionTexture,hasNormalTexture:b.hasNormalTexture,
vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:G.doublePrecisionRequiresObfuscation(d.rctx),overlayEnabled:2===b.integratedMeshMode||3===b.integratedMeshMode,ssrEnabled:b.ssrEnabled,highStepCount:!1,ellipsoidMode:b.ellipsoidMode});return new C(d.rctx,b.generateSource("vertex"),b.generateSource("fragment"),a.attributeLocations)};c.setPipelineState=function(d){const a=this.configuration,b=0!==a.integratedMeshMode,k=3===d,y=2===d;return v.makePipelineState({blending:0!==
a.output&&7!==a.output||!a.blendingEnabled?null:k?r.blendingDefault:r.OITBlending(d),culling:I[a.cullFace],depthTest:{func:r.OITDepthTest(d)},depthWrite:k||y?v.defaultDepthWriteParams:null,colorWrite:v.defaultColorWriteParams,stencilWrite:b||a.sceneHasOcludees?w.stencilWriteMaskOn:null,stencilTest:b?w.replaceBitWhenDepthTestPasses(1):a.sceneHasOcludees?w.stencilBaseAllZerosParams:null,polygonOffset:k||y?a.polygonOffsetEnabled?{factor:2,units:2}:null:r.OITPolygonOffset})};c.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};
return l}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(e.ComponentShader,()=>new Promise(function(n,l){z(["./shader/ComponentShader.glsl"],n,l)}));const I=[null,{face:1028,mode:2305},{face:1029,mode:2305}];u=function(n){function l(){var c=n.apply(this,arguments)||this;c.transformNormal_GlobalFromModel=A.create();c.toMapSpace=B.create();return c}t._inheritsLoose(l,n);return l}(x.VertexPosition.ModelTransform);e=function(n){function l(){var c=n.apply(this,arguments)||this;c.output=0;c.hasVertexColors=
!1;c.hasNormals=!1;c.vertexTextureCoordinates=0;c.componentData=0;c.slicePlaneEnabled=!1;c.cullFace=2;c.baseColorTexture=!1;c.receiveAmbientOcclusion=!0;c.receiveShadows=!0;c.vertexDiscardMode=0;c.doubleSidedMode=2;c.blendingEnabled=!0;c.alphaDiscardMode=1;c.integratedMeshMode=0;c.ssrEnabled=!1;c.polygonOffsetEnabled=!1;c.usePBR=!1;c.isSchematic=!1;c.hasMetalnessAndRoughnessTexture=!1;c.hasEmissionTexture=!1;c.hasOcclusionTexture=!1;c.hasNormalTexture=!1;c.sceneHasOcludees=!1;c.transparencyPassType=
3;c.ellipsoidMode=1;c.multipassTerrainEnabled=!1;c.cullAboveGround=!0;return c}t._inheritsLoose(l,n);return l}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:8})],e.prototype,"output",void 0);g.__decorate([f.parameter()],e.prototype,"hasVertexColors",void 0);g.__decorate([f.parameter()],e.prototype,"hasNormals",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"vertexTextureCoordinates",void 0);g.__decorate([f.parameter({count:2})],e.prototype,"componentData",void 0);g.__decorate([f.parameter()],
e.prototype,"slicePlaneEnabled",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"cullFace",void 0);g.__decorate([f.parameter()],e.prototype,"baseColorTexture",void 0);g.__decorate([f.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);g.__decorate([f.parameter()],e.prototype,"receiveShadows",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"vertexDiscardMode",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"doubleSidedMode",void 0);g.__decorate([f.parameter()],
e.prototype,"blendingEnabled",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"alphaDiscardMode",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"integratedMeshMode",void 0);g.__decorate([f.parameter()],e.prototype,"ssrEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"polygonOffsetEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"usePBR",void 0);g.__decorate([f.parameter()],e.prototype,"isSchematic",void 0);g.__decorate([f.parameter()],e.prototype,"hasMetalnessAndRoughnessTexture",
void 0);g.__decorate([f.parameter()],e.prototype,"hasEmissionTexture",void 0);g.__decorate([f.parameter()],e.prototype,"hasOcclusionTexture",void 0);g.__decorate([f.parameter()],e.prototype,"hasNormalTexture",void 0);g.__decorate([f.parameter()],e.prototype,"sceneHasOcludees",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"transparencyPassType",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"ellipsoidMode",void 0);g.__decorate([f.parameter()],e.prototype,"multipassTerrainEnabled",
void 0);g.__decorate([f.parameter()],e.prototype,"cullAboveGround",void 0);p.ComponentDrawParameters=u;p.ComponentTechnique=q;p.ComponentTechniqueConfiguration=e;p.TextureUnits=h;Object.defineProperty(p,"__esModule",{value:!0})});