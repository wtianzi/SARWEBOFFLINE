// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4f32 ./Util ../../../webgl/Util ./glUtil3D ../shaders/ShadowHighlightTechnique".split(" "),function(D,m,n,d,t,E,p,F,u,G,v,H,I,w){let Y=function(){function q(a,b,f,r){this._rctx=b;this.highlightShadowMapSlot=f;this.defaultSnapshotSlot=
r;this._maxOpacity=this._dayNightTerminatorFactor=this._opacityElevationFactor=1;this._defaultOptions={shadowColor:G.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1};b=new w.ShadowHighlightTechniqueConfiguration;this._shadowHighlightTechnique=a.acquireAndReleaseExisting(w.ShadowHighlightTechnique,b,this._shadowHighlightTechnique);this._viewingMode=a.viewingMode;this._quadVAO=I.createQuadVAO(this._rctx)}var c=q.prototype;c.render=function(a,b,f,r,J,K){v.assert(this._quadVAO);if(f.enabled&&
this.wouldRender){var e=this._rctx,x=this._quadVAO,h=this._shadowHighlightTechnique,y=L,z=M,k=N,A=O,B=P,l=Q,R=this.defaultSnapshotSlot,S=this.highlightShadowMapSlot,g=this._defaultOptions,T=g.shadowColor,U=g.shadowOpacity;g=g.occludedShadowOpacity;var V=this._opacityElevationFactor*this._dayNightTerminatorFactor,X=u.set(W,1/b.descriptor.width,1/b.descriptor.height);d.transformMat4(l,r,a.viewInverseTransposeMatrix);d.normalize(l,l);d.copy(B,a.center);u.copy(A,a.nearFar);v.inverseProjectionInfo(a.projectionMatrix,
a.fullWidth,a.fullHeight,y,z);t.translate(k,a.viewMatrix,a.center);t.invert(k,k);e.bindFramebuffer(K);e.bindProgram(h.program);h.bindPipelineState(e);h.bindPass(e,{color:T,opacity:U,occludedOpacity:g,terminationFactor:V,defaultSnapshotSlot:R,highlightSnapshotSlot:S,shadowMappingEnabled:f.enabled,shadowMap:f,origin:B,zScale:z,inverseView:k,projInfo:y,nearFar:A,depthMap:b,lightDirView:l,highlightMap:J.colorTexture,texelSize:X});e.bindVAO(x);e.drawArrays(h.primitiveType,0,H.vertexCount(x,"geometry"))}};
c.getGpuMemoryUsage=function(){return this._quadVAO?this._quadVAO.size:0};c.setDefaultOptions=function(a){this._defaultOptions=a;this._updateMaxOpacity()};c.setup=function(a,b){this._opacityElevationFactor=1-m.smoothstep(4E4,5E4,a.relativeElevation);this._dayNightTerminatorFactor=this._evaluateDayNightTerminatorFactor(a.center,b)};c.dispose=function(){this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null)};c._updateMaxOpacity=function(){const a=this._defaultOptions;this._maxOpacity=Math.max(a.shadowOpacity,
a.occludedShadowOpacity)*a.shadowColor[3]};c._evaluateDayNightTerminatorFactor=function(a,b){a=1===this._viewingMode?d.normalize(C,a):d.set(C,0,0,1);b=d.dot(a,b);return m.smoothstep(0,1,m.glClamp(30*b,0,1))};D._createClass(q,[{key:"wouldRender",get:function(){return.001953125<=this._maxOpacity*this._opacityElevationFactor*this._dayNightTerminatorFactor}}]);return q}();const W=p.create(),C=n.create(),Q=n.create(),P=n.create(),O=p.create(),M=p.create(),L=F.create(),N=E.create();return Y});