// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/quatf64 ../../../../chunks/vec4f64 ../../../../chunks/mat3 ../../../../chunks/vec4 ../../../../chunks/quat ../../../../chunks/vec3f32 ../../../../chunks/sphere ../../../../chunks/boundedPlane ../../support/geometryUtils ./Object3D".split(" "),function(m,w,n,p,k,r,L,t,M,
B,N,O,P,Q,R,S,x,T){function A(d,c){return n.isNone(d)||null==d.layerUid?null:n.isSome(c.graphicsView)&&d.layerUid===c.graphicsView.graphics3d.layer.id?c.graphics:c.map.findLayerByUid(d.layerUid)}function C(d,c){if(n.isNone(d))return null;const a=A(d,c);return n.isNone(a)?null:a===c.graphics?n.isSome(c.graphicsView)?n.unwrap(c.graphicsView.getGraphicFromGraphicUid(d.graphicUid)):null:(c=c.allLayerViews.find(b=>b.layer===a))?U(c,d):null}function U(d,c){return!d||d.suspended?null:"getGraphicFromIntersectorMetadata"in
d&&c?d.getGraphicFromIntersectorMetadata(c):"getGraphicFromGraphicUid"in d&&null!=c.graphicUid?d.getGraphicFromGraphicUid(c.graphicUid):null}let V=function(){function d(){this._transform=t.create();this._transformInverse=new y({value:this._transform},r.invert,t.create);this._transformInverseTranspose=new y(this._transformInverse,r.transpose,t.create);this._transformTranspose=new y({value:this._transform},r.transpose,t.create);this._transformInverseRotation=new y({value:this._transform},N.normalFromMat4Legacy,
L.create)}var c=d.prototype;c.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};c.setTransformMatrix=function(a){r.copy(this._transform,a)};c.multiplyTransform=function(a){r.multiply(this._transform,this._transform,a)};c.set=function(a){r.copy(this._transform,a);this.invalidateLazyTransforms()};c.setAndInvalidateLazyTransforms=function(a,b){this.setTransformMatrix(a);
this.multiplyTransform(b);this.invalidateLazyTransforms()};w._createClass(d,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return d}(),y=function(){function d(c,a,b){this.original=
c;this.update=a;this.dirty=!0;this.transform=b()}d.prototype.invalidate=function(){this.dirty=!0};w._createClass(d,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return d}(),W=function(){function d(){this.min=new u;this.max=new u;this.hud=new u;this.ground=new u}d.prototype.init=function(c){this.min.init(c);this.max.init(c);this.hud.init(c);this.ground.init(c);this.all=[]};return d}(),u=function(){function d(a){this.normal=
p.create();this.transformation=t.create();this._ray=x.ray.create();this.init(a)}var c=d.prototype;c.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;k.scale(z,this.ray.direction,this.dist);k.add(a,this.ray.origin,z);return!0};c.getTransformedNormal=function(a){k.copy(v,this.normal);v[3]=0;O.transformMat4(v,v,this.transformation);k.copy(a,v);k.normalize(a,a);return a};c.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;
this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?x.ray.copy(a,this._ray):this._ray=x.ray.create()};c.set=function(a,b,e,f,g,h,l,q,X,Y){a instanceof T.Object3D&&(a={type:"stage",obj:a});this.dist=e;k.copy(this.normal,f);r.copy(this.transformation,g);this.target=a;this.name=b;this.drapedLayerOrder=h;this.center=l?p.clone(l):null;this.geometryId=q;this.triangleNr=X;this.drapedLayerGraphicOrder=Y};c.copyFrom=function(a){x.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=
a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?p.clone(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;k.copy(this.normal,a.normal);r.copy(this.transformation,a.transformation)};c.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return A(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":{const b=
this.target.metadata.layerUid;a=null!=b?a.map.findLayerByUid(b):null}return a;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return A(this.target.metadata,a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};c.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return C(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return C(this.target.metadata,
a)}}return null};w._createClass(d,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return k.scale(z,this.ray.direction,this.dist),k.length(z)}}]);return d}(),D=function(){function d(a=0){this.offset=a;this.tmpVertex=p.create()}var c=d.prototype;c.applyToVertex=function(a,b,e){const f=a+this.localOrigin[0],g=b+this.localOrigin[1],h=e+this.localOrigin[2],l=this.offset/Math.sqrt(f*
f+g*g+h*h);this.tmpVertex[0]=a+f*l;this.tmpVertex[1]=b+g*l;this.tmpVertex[2]=e+h*l;return this.tmpVertex};c.applyToAabb=function(a){var b=a[0]+this.localOrigin[0];const e=a[1]+this.localOrigin[1],f=a[2]+this.localOrigin[2],g=a[3]+this.localOrigin[0],h=a[4]+this.localOrigin[1],l=a[5]+this.localOrigin[2],q=this.offset/Math.sqrt(b*b+e*e+f*f);a[0]+=b*q;a[1]+=e*q;a[2]+=f*q;b=this.offset/Math.sqrt(g*g+h*h+l*l);a[3]+=g*b;a[4]+=h*b;a[5]+=l*b;return a};return d}(),F=function(){function d(a=0){this.offset=
a;this.componentLocalOriginLength=0;this.tmpVertex=p.create();this.mbs=B.create();this.obb={center:p.create(),halfSize:Q.create(),quaternion:null}}var c=d.prototype;c.applyToVertex=function(a,b,e){const f=e+this.componentLocalOriginLength,g=this.offset/Math.sqrt(a*a+b*b+f*f);this.tmpVertex[0]=a+a*g;this.tmpVertex[1]=b+b*g;this.tmpVertex[2]=e+f*g;return this.tmpVertex};c.applyToAabb=function(a){var b=a[0];const e=a[1],f=a[2]+this.componentLocalOriginLength,g=a[3],h=a[4],l=a[5]+this.componentLocalOriginLength,
q=this.offset/Math.sqrt(b*b+e*e+f*f);a[0]+=b*q;a[1]+=e*q;a[2]+=f*q;b=this.offset/Math.sqrt(g*g+h*h+l*l);a[3]+=g*b;a[4]+=h*b;a[5]+=l*b;return a};c.applyToMbs=function(a){const b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),e=this.offset/b;this.mbs[0]=a[0]+a[0]*e;this.mbs[1]=a[1]+a[1]*e;this.mbs[2]=a[2]+a[2]*e;this.mbs[3]=a[3]+a[3]*this.offset/b;return this.mbs};c.applyToObb=function(a){var b=a.center;const e=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);this.obb.center[0]=b[0]+b[0]*e;this.obb.center[1]=
b[1]+b[1]*e;this.obb.center[2]=b[2]+b[2]*e;k.transformQuat(this.obb.halfSize,a.halfSize,a.quaternion);k.add(this.obb.halfSize,this.obb.halfSize,a.center);b=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*b;this.obb.halfSize[1]+=this.obb.halfSize[1]*b;this.obb.halfSize[2]+=this.obb.halfSize[2]*b;k.subtract(this.obb.halfSize,this.obb.halfSize,a.center);P.conjugate(E,
a.quaternion);k.transformQuat(this.obb.halfSize,this.obb.halfSize,E);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};w._createClass(d,[{key:"localOrigin",set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}}]);return d}(),G=function(){function d(a=0){this.offset=a;this.sphere=R.create();this.tmpVertex=p.create()}
var c=d.prototype;c.applyToVertex=function(a,b,e){const f=this.objectTransform.transform;let g=f[0]*a+f[4]*b+f[8]*e+f[12],h=f[1]*a+f[5]*b+f[9]*e+f[13];a=f[2]*a+f[6]*b+f[10]*e+f[14];b=this.offset/Math.sqrt(g*g+h*h+a*a);g+=g*b;h+=h*b;a+=a*b;b=this.objectTransform.inverse;this.tmpVertex[0]=b[0]*g+b[4]*h+b[8]*a+b[12];this.tmpVertex[1]=b[1]*g+b[5]*h+b[9]*a+b[13];this.tmpVertex[2]=b[2]*g+b[6]*h+b[10]*a+b[14];return this.tmpVertex};c.applyToMinMax=function(a,b){const e=this.offset/Math.sqrt(a[0]*a[0]+a[1]*
a[1]+a[2]*a[2]);a[0]+=a[0]*e;a[1]+=a[1]*e;a[2]+=a[2]*e;a=this.offset/Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);b[0]+=b[0]*a;b[1]+=b[1]*a;b[2]+=b[2]*a};c.applyToAabb=function(a){var b=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*b;a[1]+=a[1]*b;a[2]+=a[2]*b;b=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*b;a[4]+=a[4]*b;a[5]+=a[5]*b;return a};c.applyToBoundingSphere=function(a){const b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),e=this.offset/b;this.sphere[0]=a[0]+a[0]*
e;this.sphere[1]=a[1]+a[1]*e;this.sphere[2]=a[2]+a[2]*e;this.sphere[3]=a[3]+a[3]*this.offset/b;return this.sphere};return d}();const H=new G,I=new F,J=new D,K=p.create(),z=p.create(),v=B.create(),E=M.create();m.I3SVerticalOffsetGlobalViewingMode=F;m.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2};m.IntersectorResult=u;m.IntersectorResults=W;m.IntersectorTransform=
V;m.Object3DVerticalOffsetGlobalViewingMode=G;m.TERRAIN_ID="terrain";m.TerrainVerticalOffsetGlobalViewingMode=D;m.getVerticalOffsetI3S=function(d){return n.isSome(d)?(I.offset=d,I):null};m.getVerticalOffsetObject3D=function(d){return n.isSome(d)?(H.offset=d,H):null};m.getVerticalOffsetTerrain=function(d){return n.isSome(d)?(J.offset=d,J):null};m.sliceFilterPredicate=function(d){return(c,a,b)=>{k.lerp(K,c,a,b);return!S.extrusionContainsPoint(d,K)}};Object.defineProperty(m,"__esModule",{value:!0})});