// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../support/debugFlags ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../collections/Component/Material/ComponentTechnique ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(g,u,v,h,w,x,m,k,y,z,q,A,B,C,D,E,n){const F={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let G=function(){function e(){this._value=0}var d=e.prototype;d.increment=function(){this._value++};d.decrement=function(){this._value--};u._createClass(e,[{key:"value",get:function(){return this._value}}]);return e}();const H={solid:0,sketch:1,uber:2};let J=function(){function e(a,b,c){this.rctx=a;this.shaderTechniqueRepository=b;this.config=new n.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new G;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new h,[2]:new h},[2]:{[1]:new h,[2]:new h}};this.renderablesDirty=!1;this.settings={...F,...c};this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:z.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES};this.config.legacy=this.settings.legacy;this.config.mode=H[this.settings.type];this.config.silhouette=
!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=B.doublePrecisionRequiresObfuscation(a)}var d=e.prototype;d.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};d.addRenderable=function(a){this.renderables.add(a);this.renderablesDirty=!0};d.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=
!0};d.setRenderablesDirty=function(){this.renderablesDirty=!0};d.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forAll(a);this.sortedRenderables[b][2].forAll(a)};d.setMultipassParameters=function(a){this.config.multipassTerrainEnabled=a.multipassTerrainEnabled?a.multipassTerrainEnabled:!1;this.config.cullAboveGround=a.cullAboveGround?a.cullAboveGround:!1};d.bindRegularEdges=function(a,b){this.setMultipassParameters(a);this.config.silhouette=
!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(n.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};d.bindSilhouetteEdges=function(a,b){this.setMultipassParameters(a);this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(n.EdgeShaderTechnique,this.config,this.technique);
this.technique.bindPass(this.rctx,{bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};d.renderRegularEdges=function(a,b,c){this.render(this.technique.program,a,a.regular.vao,b,c)};d.renderSilhouetteEdges=function(a,b,c){this.render(this.technique.program,a,a.silhouette.vao,b,c)};d.render=function(a,b,c,l,p){this.setUniforms(a,b,l);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,
4,p)};d.setUniforms=function(a,b,c){b.components.buffer.textureBuffer.bind(a,r);c.multipassTerrainEnabled&&(a.setUniform2fv("cameraNearFar",c.camera.nearFar),a.setUniform2fv("inverseViewport",c.inverseViewport),A.bindMultipassTerrainUniforms(a,this.rctx,c));if("origin"in b.transform)a.setUniformMatrix4fv("uView",c.localViewMatrixForEdges),a.setUniformMatrix4fv("uModel",b.transform.modelMatrix),q.Slice.bindUniforms(a,this.settings,c.slicePlane,b.transform.origin.vec3);else{const l=new E.TwoVectorPosition(b.transform.position),
p=k.transpose(t,k.invert(t,b.transform.rotationScale)),f=new D.ComponentDrawParameters;m.copy(f.worldFromModel_TL,l.low);m.copy(f.worldFromModel_TH,l.high);k.copy(f.worldFromModel_RS,b.transform.rotationScale);k.copy(f.transformNormal_GlobalFromModel,p);C.VertexPosition.bindModelTransform(a,f);a.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",f.transformNormal_GlobalFromModel);b=c.camera.viewInverseTransposeMatrix;b=m.set(I,b[3],b[7],b[11]);q.Slice.bindUniforms(a,this.settings,c.slicePlane,
b)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.camera.fovY/2)/(c.camera.fullViewport[3]/2))};d.setSketchUniforms=function(a){const b=this.settings.strokesTexture,c=b.texture;v.isNone(c)||(this.rctx.bindTexture(c,0),a.setUniform1i("uStrokesTexture",0),a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height),a.setUniform1f("uStrokesLog2Resolution",w.log2(b.resolution)),a.setUniform1f("uStrokesNormalizationScale",
b.normalizationScale),a.setUniform1f("uStrokesAmplitude",b.amplitude),a.setUniform1f("uStrokeVariants",b.variants))};d.sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(b=>{0!==b.objectTransparency&&0!==b.edgeTransparency&&this.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)});const a=(b,c)=>"origin"in b.transform&&
"origin"in c.transform?b.transform.origin.id<c.transform.origin.id?-1:b.transform.origin.id>c.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(a);this.sortedRenderables[1][2].sort(a);this.sortedRenderables[2][1].sort(a);this.sortedRenderables[2][2].sort(a)};e.getKey=function(a,b,c){return`edges-t:${a}:${b}:${c}`};return e}();const r={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2},t=y.create(),I=x.create();g.EXTENSION_LENGTH_OFFSET=128;g.EdgeRenderer=J;g.LINE_WIDTH_FRACTION_FACTOR=
8;g.componentDataBindParameters=r;Object.defineProperty(g,"__esModule",{value:!0})});