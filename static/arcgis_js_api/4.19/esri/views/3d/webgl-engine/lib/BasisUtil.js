// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","../../../webgl/Texture","../../../webgl/Util","../../../../libs/basisu/BasisU"],function(h,l,p,q,r){async function m(){l.isNone(k)&&(k=r.getBasisTranscoder(),e=await k);return k}let e=null,k=null;h.createTextureFromBasis=async function(c,b,a){l.isNone(e)&&(e=await m());a=new e.BasisFile(new Uint8Array(a));if(1>a.getNumImages())return null;const f=a.getNumLevels(0);var d=a.getHasAlpha();const t=a.getImageWidth(0,0),u=a.getImageHeight(0,0),{compressedTextureETC:v,
compressedTextureS3TC:w}=c.capabilities,[n,x]=v?d?[1,37496]:[0,37492]:w?d?[3,33779]:[2,33776]:[13,6408];a.startTranscoding();d=[];for(let g=0;g<f;g++)d.push(new Uint8Array(a.getImageTranscodedSizeInBytes(0,g,n))),a.transcodeImage(d[g],0,g,n,0,0);a.close();a.delete();return new p(c,{...b,samplingMode:1<f?9987:9729,hasMipmap:1<f,internalFormat:x,width:t,height:u},{type:"compressed",levels:d})};h.estimateBasisTextureMemoryUsage=function(c){if(l.isNone(e))return c.byteLength;var b=new e.BasisFile(new Uint8Array(c));
if(1>b.getNumImages())return 0;c=b.getNumLevels(0);const a=b.getHasAlpha(),f=b.getImageWidth(0,0),d=b.getImageHeight(0,0);b.close();b.delete();b=q.getBytesPerElementFormat(a?37496:37492);return Math.ceil((4**c-1)/(3*4**(c-1))*d*b*f)};h.loadBasis=m;Object.defineProperty(h,"__esModule",{value:!0})});