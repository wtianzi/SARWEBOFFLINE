// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../lib/StencilUtils ../../../../chunks/RibbonLine.glsl".split(" "),
function(y,q,t,g,u,e,r,f,z,l,v,A,B,C,n,D,h,E){const w={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};r=function(m){function k(c,b){b=m.call(this,c,b)||this;b.stipplePattern=null;b.stippleTextureBind=null;b.stippleTextureRepository=c.stippleTextureRepository;return b}t._inheritsLoose(k,m);var d=k.prototype;d.initializeProgram=function(c){var b=k.shader.get();const a=this.configuration;b=b.build({OITEnabled:0===
a.transparencyPassType,output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:a.stippleEnabled,stippleOffColorEnabled:a.stippleOffColorEnabled,stippleUVMaxEnabled:a.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:a.stippleIntegerRepeatsEnabled,roundCaps:a.roundCaps,roundJoins:a.roundJoins,vvColor:a.vvColor,vvSize:a.vvSize,vvInstancingEnabled:!0,vvOpacity:a.vvOpacity,falloffEnabled:a.falloffEnabled,innerColorEnabled:a.innerColorEnabled,
multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new z(c.rctx,b.generateSource("vertex"),b.generateSource("fragment"),w)};d.dispose=function(){m.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};d.bindPass=function(c,b,a){v.View.bindProjectionMatrix(this.program,a.camera.projectionMatrix);4===this.configuration.output&&B.OutputHighlight.bindOutputHighlight(c,this.program,
a);a.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",a.inverseViewport),D.bindMultipassTerrainUniforms(this.program,c,a));this.program.setUniform1f("intrinsicWidth",b.width);this.program.setUniform4fv("intrinsicColor",b.color);this.program.setUniform1f("miterLimit","miter"!==b.join?0:b.miterLimit);this.program.setUniform2fv("cameraNearFar",a.camera.nearFar);this.program.setUniform1f("pixelRatio",a.camera.pixelRatio);this.program.setUniform2f("screenSize",a.camera.fullViewport[2],
a.camera.fullViewport[3]);C.VisualVariables.bindUniformsWithOpacity(this.program,b);if(this.stipplePattern!==b.stipplePattern){const p=b.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,p);this.stipplePattern=p}this.configuration.stippleEnabled&&(c=u.isSome(this.stippleTextureBind)?this.stippleTextureBind(c,0)*a.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/c),this.configuration.stippleOffColorEnabled&&
(c=u.unwrap(b.stippleOffColor),this.program.setUniform4f("stippleOffColor",c[0],c[1],c[2],3<c.length?c[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",b.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",u.unwrapOr(b.innerColor,b.color)),this.program.setUniform1f("innerWidth",b.innerWidth*a.camera.pixelRatio))};d.bindDraw=function(c){v.View.bindView(this.program,c);A.Slice.bindUniformsWithOrigin(this.program,this.configuration,c)};
d.setPipelineState=function(c,b){const a=this.configuration,p=3===c,F=2===c;return l.makePipelineState({blending:0===a.output||7===a.output?p?n.blendingDefault:n.OITBlending(c):null,depthTest:{func:n.OITDepthTest(c)},depthWrite:p?!a.transparent&&a.writeDepth&&l.defaultDepthWriteParams:n.OITDepthWrite(c),colorWrite:l.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?b?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:p||
F?a.polygonOffset&&x:n.OITPolygonOffset})};d.initializePipeline=function(){const c=this.configuration,b=c.polygonOffset&&x;c.occluder&&(this._occluderPipelineTransparent=l.makePipelineState({blending:n.blendingDefault,polygonOffset:b,depthTest:h.depthCompareAlways,depthWrite:null,colorWrite:l.defaultColorWriteParams,stencilWrite:null,stencilTest:h.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=l.makePipelineState({blending:n.blendingDefault,polygonOffset:b,depthTest:h.depthCompareAlways,
depthWrite:null,colorWrite:l.defaultColorWriteParams,stencilWrite:h.stencilWriteMaskOff,stencilTest:h.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=l.makePipelineState({blending:null,polygonOffset:b,depthTest:h.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:h.stencilWriteMaskOn,stencilTest:h.stencilToolMaskBaseParams}));this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,
!1)};d.getPipelineState=function(c,b){return b?this._occludeePipelineState:this.configuration.occluder?11===c?this._occluderPipelineTransparent:10===c?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline};t._createClass(k,[{key:"primitiveType",get:function(){return 5}}]);return k}(r.ShaderTechnique);r.shader=new e.ReloadableShaderModule(E.RibbonLineShader,()=>new Promise(function(m,k){y(["./RibbonLine.glsl"],m,k)}));const x={factor:0,units:-4};e=function(m){function k(){var d=
m.apply(this,arguments)||this;d.output=0;d.occluder=!1;d.slicePlaneEnabled=!1;d.transparent=!1;d.polygonOffset=!1;d.writeDepth=!1;d.stippleEnabled=!1;d.stippleOffColorEnabled=!1;d.stippleIntegerRepeatsEnabled=!1;d.roundCaps=!1;d.roundJoins=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.falloffEnabled=!1;d.innerColorEnabled=!1;d.sceneHasOcludees=!1;d.transparencyPassType=3;d.multipassTerrainEnabled=!1;d.cullAboveGround=!0;return d}t._inheritsLoose(k,m);return k}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:8})],
e.prototype,"output",void 0);g.__decorate([f.parameter()],e.prototype,"occluder",void 0);g.__decorate([f.parameter()],e.prototype,"slicePlaneEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"transparent",void 0);g.__decorate([f.parameter()],e.prototype,"polygonOffset",void 0);g.__decorate([f.parameter()],e.prototype,"writeDepth",void 0);g.__decorate([f.parameter()],e.prototype,"stippleEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"stippleOffColorEnabled",void 0);g.__decorate([f.parameter()],
e.prototype,"stippleIntegerRepeatsEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"roundCaps",void 0);g.__decorate([f.parameter()],e.prototype,"roundJoins",void 0);g.__decorate([f.parameter()],e.prototype,"vvSize",void 0);g.__decorate([f.parameter()],e.prototype,"vvColor",void 0);g.__decorate([f.parameter()],e.prototype,"vvOpacity",void 0);g.__decorate([f.parameter()],e.prototype,"falloffEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"innerColorEnabled",void 0);g.__decorate([f.parameter()],
e.prototype,"sceneHasOcludees",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"transparencyPassType",void 0);g.__decorate([f.parameter()],e.prototype,"multipassTerrainEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"cullAboveGround",void 0);q.RibbonLineTechnique=r;q.RibbonLineTechniqueConfiguration=e;q.ribbonVertexAttributeLocations=w;Object.defineProperty(q,"__esModule",{value:!0})});