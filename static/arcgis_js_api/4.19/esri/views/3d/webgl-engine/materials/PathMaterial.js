// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../support/buffer/BufferView ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../lib/Util ../lib/geometryDataUtils ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ./VisualVariableMaterialParameters ../lib/PathGeometry ./PathTechnique".split(" "),function(r,t,A,u,B,C,D,p,E,F,G,v,w,H,I,q){const J=p.assert;p=function(h){function g(a){a=
h.call(this,a,K)||this;a.supportsEdges=!0;a._vertexAttributeLocations=q.pathVertexAttributeLocations;a.techniqueConfig=new q.PathTechniqueConfiguration;a.vertexBufferLayout=g.getVertexBufferLayout(a.params);return a}t._inheritsLoose(g,h);var c=g.prototype;c.getTechniqueConfig=function(a,b){this.techniqueConfig.output=a;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=
this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;if(0===a||7===a)this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=b&&b.ssaoEnabled?this.params.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=
b?b.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=b?b.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=b?b.cullAboveGround:!0;return this.techniqueConfig};c.getPassParameters=function(){return this.params};c.isVisibleInPass=function(a){return 4===a||6===a||7===a?this.params.castShadows:!0};c.isVisible=function(){const a=this.params;return h.prototype.isVisible.call(this)?0<a.opacity:!1};c.intersect=function(a,b,e,k,f,l,n){if(I.isPathGeometry(a)){b=a.path;e=[this.params.size[0],
this.params.size[1]];if(this.params.vvSizeEnabled){var d=this.params.vvSizeOffset,m=this.params.vvSizeFactor;const x=this.params.vvSizeMinSize,y=this.params.vvSizeMaxSize,z=b.sizeAttributeValue;e[0]*=u.clamp(d[0]+z*m[0],x[0],y[0]);e[1]*=u.clamp(d[2]+z*m[2],x[2],y[2])}d=Math.max(e[0],e[1]);a=a.boundingInfo;A.isNone(a)?this._intersectTriangles(b,e,f,l,n):(a=C.fromValues(a.bbMin[0]-d,a.bbMin[1]-d,a.bbMin[2]-d,a.bbMax[0]+d,a.bbMax[1]+d,a.bbMax[2]+d),d=[l[0]-f[0],l[1]-f[1],l[2]-f[2]],m=Math.sqrt(d[0]*
d[0]+d[1]*d[1]+d[2]*d[2]),G.intersectAabbInvDir(a,f,[m/d[0],m/d[1],m/d[2]],k.tolerance)&&this._intersectTriangles(b,e,f,l,n))}};c._intersectTriangles=function(a,b,e,k,f){a.baked.size&&a.baked.size[0]===b[0]&&a.baked.size[1]===b[1]||a.baked.bake(b);a.baked.intersect(e,k,f)};c.computeAttachmentOrigin=function(a,b){a=a.vertexAttributes;if(!a)return null;a=a.get("position");return E.computeAttachmentOriginLines(a,null,!1,b)};c.createBufferWriter=function(){return new L(this.vertexBufferLayout)};c.getGLMaterial=
function(a){if(0===a.output||7===a.output||1===a.output||2===a.output||4===a.output||3===a.output&&this.params.castShadows)return new M(a)};g.getVertexBufferLayout=function(a){let b=D.newLayout().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");if(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f("featureValue");return b};return g}(v.Material);let M=function(h){function g(a){a=h.call(this,a)||this;a.updateParameters();return a}t._inheritsLoose(g,
h);var c=g.prototype;c.updateParameters=function(a){this.technique=this.techniqueRep.acquireAndReleaseExisting(q.PathTechnique,this.material.getTechniqueConfig(this.output,a),this.technique)};c.beginSlot=function(a){return a===(this.technique.configuration.transparent?5:3)};c._updateOccludeeState=function(a){a.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:a.hasOccludees})};c._updateShadowState=function(a){a.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&
this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled})};c.ensureParameters=function(a){if(0===this.output||7===this.output)this._updateShadowState(a),this._updateOccludeeState(a);this.updateParameters(a)};c.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};return g}(F);const K={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,
receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...H.Default,...v.materialParametersDefaults};let L=function(){function h(c){this.vertexBufferLayout=c}var g=h.prototype;g.allocate=function(c){return this.vertexBufferLayout.createBuffer(c)};g.elementCount=function(c){return c.indices.get("position").length};g.write=function(c,a,b,e){const k=f=>{if(a.vertexAttributes.has(f)){const l=a.vertexAttributes.get(f),n=a.indices.get(f);J(4===l.size);const d=b.getField(f,
B.BufferViewVec4f);if(d)w.writeBufferVec4(n,l.data,d,e);else throw Error("unable to acquire view for "+f);}};k("profileRight");k("profileUp");k("profileVertexAndNormal");this.vertexBufferLayout.hasField("featureValue")&&k("featureValue");w.writeDefaultAttributes(a,this.vertexBufferLayout,c.transformation,c.invTranspTransformation,b,e)};return h}();r.PathMaterial=p;Object.defineProperty(r,"__esModule",{value:!0})});