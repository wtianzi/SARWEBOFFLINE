// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/Accessor ../../../../../geometry/Polyline ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../geometry/projectionEllipsoid ../../../../../core/watchUtils ../../../../../geometry/projection ../../../../../core/Quantity ../../../../../geometry/support/geodesicUtils ../../../../../geometry/geometryEngine ../../measurementTools/support/UnitNormalizer".split(" "),
function(k,C,u,L,x,M,N,y,O,D,P,Q,R,E,F,l,n,z,G,t,H,g,p,v,I,J){k.DirectLineMeasurement3DController=function(A){function w(a){a=A.call(this,a)||this;a._tempStartPosition=n.create();a._tempEndPosition=n.create();a._tempCornerPosition=n.create();a._unitNormalizer=new J;a._handles=new G;return a}C._inheritsLoose(w,A);var h=w.prototype;h.initialize=function(){this._handles.add(H.whenOnce(this.view,"ready",()=>this._initialize(),!0))};h._initialize=function(){const a=this.view.spatialReference;var b=t.getSphericalPCPF(a);
this._sphericalPCPF=b=b===t.SphericalECEFSpatialReference?t.WGS84ECEFSpatialReference:b;const c=g.canProjectWithoutEngine(a,b);this._unitNormalizer.spatialReference=c?b:a;this._handles.add([this.dataObject.watch("startPoint",()=>this._updateMeasurement(),!0),this.dataObject.watch("endPoint",()=>this._updateMeasurement(),!0),this.dataObject.watch("settings",()=>this._updateMeasurement(),!0)],"model");this._updateMeasurement()};h._updateMeasurement=function(){var a=this.dataObject.startPoint;const b=
this.dataObject.endPoint;if(x.isNone(a)||x.isNone(b))this.dataObject.measurement=null;else{var c=this._euclideanDistances(a,b);a=this._exactGeodesicDistanceAndAngle(a,b,c.horizontal.value);this.dataObject.measurement={directDistance:c.direct,horizontalDistance:c.horizontal,verticalDistance:c.vertical,geodesicDistance:a.distance,geodesicAngle:a.angle}}};h._euclideanDistances=function(a,b){a.z>b.z&&(a=[a,a=b][0]);var c=a.clone();c.z=b.z;const e=this._tempStartPosition;var d=this._tempEndPosition,m=
this._tempCornerPosition,f=this.view.spatialReference;const B=this._sphericalPCPF;f=g.canProjectWithoutEngine(f,B)?B:f;g.projectPointToVector(a,e,f);g.projectPointToVector(b,d,f);g.projectPointToVector(c,m,f);c=z.distance(e,d);d=z.distance(m,d);a=Math.abs(b.z-a.z);b=K=>this._unitNormalizer.normalizeDistance(K);m=b(c);d=b(d);a=b(a);return{direct:new p(m,"meters"),horizontal:new p(d,"meters"),vertical:new p(a,"meters")}};h._exactGeodesicDistanceAndAngle=function(a,b,c){const e=a.spatialReference;var d=
new F({paths:[a,b],spatialReference:e});d=e.isGeographic&&v.isSupported(e)?v.geodesicLengths([d],"meters")[0]:e.isWebMercator?I.geodesicLength(d,"meters"):void 0;const {distance:m,angle:f}=d?{distance:d,angle:this._fallbackGeodesicAngle(d,e)}:this._fallbackGeodesicDistance(a,b,c);return{distance:new p(m,"meters"),angle:new p(f,"degrees")}};h._fallbackGeodesicAngle=function(a,b){return a/t.getReferenceEllipsoid(b).metersPerDegree};h._fallbackGeodesicDistance=function(a,b,c){if(g.projectPointToWGS84ComparableLonLat(a,
q)){g.projectPointToWGS84ComparableLonLat(b,r);a=l.deg2rad(q[0]);b=l.deg2rad(q[1]);c=l.deg2rad(r[0]);const e=l.deg2rad(r[1]);a=l.acosClamped(Math.sin(b)*Math.sin(e)+Math.cos(b)*Math.cos(e)*Math.cos(Math.abs(c-a)));a=l.rad2deg(a);b={distance:0};v.inverseGeodeticSolver(b,[q[0],q[1]],[r[0],r[1]]);return{distance:b.distance,angle:a}}return{distance:c,angle:this._fallbackGeodesicAngle(c,a.spatialReference)}};return w}(E);u.__decorate([y.property()],k.DirectLineMeasurement3DController.prototype,"view",
void 0);u.__decorate([y.property()],k.DirectLineMeasurement3DController.prototype,"dataObject",void 0);k.DirectLineMeasurement3DController=u.__decorate([D.subclass("esri.views.3d.interactive.graphics.DirectLineMeasurement3D.DirectLineMeasurement3DController")],k.DirectLineMeasurement3DController);const q=n.create(),r=n.create();Object.defineProperty(k,"__esModule",{value:!0})});