// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/clock ../../../../../core/scheduling ../../../../../core/Collection ../../../../../core/screenUtils ../../../../../core/collectionUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../layers/Layer ../../../../../core/watchUtils ../../../../../chunks/mat4 ../../../../../layers/buildingSublayers/BuildingComponentSublayer ../../../../interactive/interactiveToolUtils ../../../../support/screenUtils ../../../support/stack ../../../support/geometryUtils ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Texture ../../../../interactive/dragEventPipeline ../../../../interactive/InteractiveToolBase ../../editingTools/dragEventPipeline3D ../../manipulatorUtils ./sliceToolConfig ../../../../../widgets/Slice/SlicePlane ./sliceToolUtils ./images/heading-rotate-png ./images/tilt-rotate-png".split(" "),
function(F,q,n,d,N,ba,r,ca,O,da,ea,fa,P,Q,R,w,G,x,m,H,I,S,y,T,C,z,p,g,U,J,A,V,B,W,l,K,k,X,Y){function L(t,v,e,a){e=k.createShiftPlane(e,g.boundedPlane.normal(a),t.direction,g.plane.create());a=x.create();return g.plane.intersectRay(e,t,a)?{type:"shift",creatingPointerId:v,shiftPlane:e,depth:0,startPoint:a}:null}function D(t){return"mouse"!==t.pointerType||0===t.button}const M=N.getLogger("esri.views.3d.interactive.analysisTools.slice.SliceTool");n=function(t){function v(a){var b=t.call(this,a)||this;
b.clock=P["default"];b.deferCreation=!0;b.cursor=null;b._planeInfo=null;b.layersMode="none";b.shiftManipulator=null;b.rotateHeadingManipulator=null;b.rotateTiltManipulator=null;b.resizeManipulators=null;b.disableEngineLayers=!1;b._handles=new H;b._viewHandles=new H;b._frameTask=null;b._prevPointerMoveTimeout=null;b._outlineVisualElement=null;b._gridVisualElement=null;b._startPlane=g.boundedPlane.create();b._previewPlane=null;b._activeKeyModifiers={};b._lastCursorPosition=w.createScreenPoint();b._baseOpacity=
1;b._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}];b._intersector=new U.Intersector(a.view.state.mode);b._intersector.options.store=0;return b}F._inheritsLoose(v,t);var e=v.prototype;e.onAttach=function(){this._updateLayerViews();this.visible&&(!this.tiltEnabled&&d.isSome(this._planeInfo)&&k.forceHorizontalOrVertical(this._planeInfo.plane,this.view.renderCoordsHelper,this._planeInfo.plane),
this.view.slicePlane=d.isSome(this._planeInfo)?this._planeInfo.plane:null,this._updateManipulators())};e.initialize=function(){if(null==this.model)throw Error("SliceTool requires valid model, but null was provided.");this.rotateHeadingTexture=new J.Texture(X,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0});this.rotateTiltTexture=new J.Texture(Y,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0});this.view._stage&&(this.view._stage.add(this.rotateHeadingTexture),this.view._stage.add(this.rotateTiltTexture));
this.planeChanged();const a=S.init(this,"state",c=>{"ready"!==c&&this.create();"sliced"===c&&this.complete()},!0);this._handles.add([a,this.view.state.watch("camera",()=>this._onCameraChange()),this.excludedLayers.on("before-add",c=>{const f=c.item;null!=f&&(f instanceof I||f instanceof T)?f instanceof I&&k.isAlwaysDrapedLayer(f)?(M.error("excludedLayers",`Layer '${f.title}, id:${f.id}' of type '${f.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),c.preventDefault()):
this.excludedLayers.includes(f)&&c.preventDefault():(M.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),c.preventDefault())})]);const b=c=>{this.updateManipulatorsInteractive(c);c.grabbing||(d.isSome(this._planeInfo)&&g.boundedPlane.copy(this._planeInfo.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=k.createShiftManipulator(this.view);this.manipulators.add(this.shiftManipulator);this.shiftManipulator.events.on("grab-changed",
c=>{this._onShiftGrab(c);b(this.shiftManipulator)});this._handles.add(this._createShiftDragPipeline(this.shiftManipulator));this.rotateHeadingManipulator=k.createRotateManipulator(this.view,this.rotateHeadingTexture);this.manipulators.add(this.rotateHeadingManipulator);this.rotateHeadingManipulator.events.on("grab-changed",c=>{this._onRotateHeadingGrab(c);b(this.rotateHeadingManipulator)});this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator));this.rotateTiltManipulator=
k.createRotateManipulator(this.view,this.rotateTiltTexture);this.manipulators.add(this.rotateTiltManipulator);this.rotateTiltManipulator.events.on("grab-changed",c=>{this._onRotateTiltGrab(c);b(this.rotateTiltManipulator)});this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator));this.resizeManipulators=this._resizeHandles.map((c,f)=>{const h=k.createResizeManipulator(this.view,c);h.events.on("grab-changed",u=>{this._onResizeGrab(u,f);b(h)});this._handles.add(this._createResizeDragPipeline(h));
return h});this.manipulators.addMany(this.resizeManipulators);this._outlineVisualElement=k.createOutlineVisualElement(this.view);this._gridVisualElement=k.createGridVisualElement(this.view)};e.destroy=function(){this.view._stage&&(this.view._stage.remove(this.rotateHeadingTexture),this.view._stage.remove(this.rotateTiltTexture));this.detach();this._handles.destroy();this._handles=null;this._viewHandles.destroy();this._viewHandles=null;this._removeFrameTask();this._clearPointerMoveTimeout();this._outlineVisualElement.destroy();
this._outlineVisualElement=null;this._gridVisualElement.destroy();this._gridVisualElement=null};e.planeChanged=function(){if(this.view){var a=this.model.plane,b=this._planeInfo;if(!(d.isNone(b)&&d.isNone(a)||d.isSome(b)&&d.isSome(a)&&a.equals(b))){b=null;if(d.isSome(a)){const c=k.shapeToPlane(a,this.view.renderCoordsHelper,g.boundedPlane.create());d.isSome(c)&&(b={plane:c,heading:a.heading,tilt:a.tilt,position:a.position,width:a.width,height:a.height})}this._updateInternalSlicePlane(b)}}};e.enterExcludeLayerMode=
function(){d.isNone(this._planeInfo)||(this._set("layersMode","exclude"),C.setActive(this,!0))};e.exitExcludeLayerMode=function(){d.isNone(this._planeInfo)||(this._set("layersMode","none"),C.setActive(this,!1))};e.deactivate=function(){this._updateMouseCursor();this._set("layersMode","none");this._updatePreviewPlane(null)};e.onDetach=function(){this._planeInfo=null;this._updateLayerViews();this._set("layersMode","none")};e.onShow=function(){this._updateMouseCursor();this._updateLayerViews();this._updateManipulators();
this._updateVisualElementVisibility();const a=this.view;a.slicePlane=d.isSome(this._planeInfo)?this._planeInfo.plane:null;0===this._viewHandles.size&&this._viewHandles.add([a.allLayerViews.on("change",()=>this._updateLayerViews()),this.excludedLayers.on("change",()=>this._updateLayerViews())])};e.onHide=function(){this._updateMouseCursor();this._updateLayerViews();this._updateVisualElementVisibility();this.view.slicePlane=null;this._viewHandles.removeAll();this._clearPointerMoveTimeout()};e.onInputEvent=
function(a){switch(a.type){case "pointer-drag":if(!D(a))break;this._onPointerDrag(a)&&a.stopPropagation();break;case "pointer-move":this._onPointerMove(a);this._updateMouseCursor();break;case "pointer-up":this._onPointerUp(a)&&a.stopPropagation();break;case "immediate-click":if(!D(a))break;this._onClickPlacePlane(a)&&(a.stopPropagation(),this._updateMouseCursor());break;case "click":if(!D(a))break;this._onClickExcludeLayer(a)&&a.stopPropagation();break;case "drag":this.inputState&&a.stopPropagation();
break;case "key-down":this._onKeyDown(a)&&a.stopPropagation();break;case "key-up":this._onKeyUp(a)&&a.stopPropagation()}};e.onEditableChange=function(){this._outlineVisualElement.width=this.editable?l.PLANE_OUTLINE_WIDTH:l.PLANE_PREVIEW_OUTLINE_WIDTH};e._updateLayerViews=function(){const a=d.isSome(this._planeInfo)&&this.visible,b=[],c=f=>{"layers"in f?f.layers.forEach(c):b.push(f)};this.excludedLayers.forEach(c);this.view.allLayerViews.forEach(f=>{"slicePlaneEnabled"in f&&(f.slicePlaneEnabled=a&&
0>b.indexOf(f.layer));"sublayerViews"in f&&f.sublayerViews.forEach(h=>{h.slicePlaneEnabled=a&&0>b.indexOf(h.sublayer)})});this.view.basemapTerrain.slicePlaneEnabled=a&&!this.excludeGroundSurface};e._onPointerDrag=function(a){if(a.pointerId===this._creatingPointerId){const b=z.createScreenPointFromEvent(a);this.shiftManipulator.events.emit("drag",{action:"start",pointerType:a.pointerType,start:b,screenPoint:b});return!0}return!1};e._onPointerMove=function(a){this._lastCursorPosition.x=a.x;this._lastCursorPosition.y=
a.y;this._resetPointerMoveTimeout();"touch"!==a.pointerType&&this._updatePreviewPlane(z.createScreenPointFromEvent(a),this._activeKeyModifiers)};e._onCameraChange=function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers);this._updateManipulators()};e._onPointerUp=function(a){return a.pointerId===this._creatingPointerId&&d.isSome(this._planeInfo)?(g.boundedPlane.copy(this._planeInfo.plane,this._startPlane),this.inputState=null,!0):!1};e._onClickPlacePlane=function(a){if("exclude"===
this.layersMode)return!1;if(this._isTargeting){var b=z.createScreenPointFromEvent(a);const c=g.boundedPlane.create();if(this._pickPlane(b,!1,this._activeKeyModifiers,c))return g.boundedPlane.copy(c,this._startPlane),b=this._calculatePickRay(b),this.model.plane=k.planeToShape(c,this.view.renderCoordsHelper,this.view.spatialReference,new K),this.inputState=L(b,a.pointerId,c.origin,c),!0}return!1};e._onClickExcludeLayer=function(a){if("exclude"!==this.layersMode||!this.created)return!1;this.view.hitTest(z.createScreenPointFromEvent(a)).then(b=>
{b.results.length?(b=(b=b.results[0])&&b.graphic)&&(b=b.sourceLayer||b.layer)&&this.excludedLayers.push(b):b.ground.layer?this.excludedLayers.push(b.ground.layer):this.excludeGroundSurface=!0});this._set("layersMode","none");C.setActive(this,!1);return!0};e._onKeyDown=function(a){return a.key===l.forceVerticalModifier||a.key===l.forceHorizontalModifier?(this._activeKeyModifiers[a.key]=!0,d.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0):
!1};e._onKeyUp=function(a){return a.key!==l.forceVerticalModifier&&a.key!==l.forceHorizontalModifier||!this._activeKeyModifiers[a.key]?!1:(delete this._activeKeyModifiers[a.key],d.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)};e._onShiftGrab=function(a){"start"!==a.action||d.isNone(this._planeInfo)||(a=this._calculatePickRay(a.screenPoint),g.boundedPlane.copy(this._planeInfo.plane,this._startPlane),this.inputState=L(a,null,this.shiftManipulator.renderLocation,
this._planeInfo.plane))};e._createShiftDragPipeline=function(a){return A.createManipulatorDragEventPipeline(a,(b,c,f)=>{if((b=this.inputState)&&"shift"===b.type){var h=d.isSome(this._planeInfo)?g.boundedPlane.copy(this._planeInfo.plane,g.boundedPlane.create()):null;c.next(B.screenToRenderPlane(this.view,b.shiftPlane)).next(this._shiftDragAdjustSensitivity(b)).next(this._shiftDragUpdatePlane(b));f.next(()=>{d.isSome(h)&&this._updateSlicePlane(h)})}})};e._shiftDragAdjustSensitivity=function(a){return b=>
{if(d.isNone(this._planeInfo))return null;const c=Math.min((1-Math.abs(m.dot(g.boundedPlane.normal(this._planeInfo.plane),b.ray.direction)/m.length(b.ray.direction)))/.001,1),f=-g.plane.signedDistance(this._startPlane.plane,b.renderEnd),h=-g.plane.signedDistance(this._startPlane.plane,a.startPoint);a.depth=a.depth*(1-c)+f*c-h;return b}};e._shiftDragUpdatePlane=function(a){return()=>{if(!d.isNone(this._planeInfo)){var b=m.copy(p.sv3d.get(),this._startPlane.origin),c=m.copy(p.sv3d.get(),g.boundedPlane.normal(this._startPlane));
m.scale(c,c,-a.depth);m.add(c,c,b);g.boundedPlane.fromValues(c,this._planeInfo.plane.basis1,this._planeInfo.plane.basis2,this._planeInfo.plane);this._updateSlicePlane(this._planeInfo.plane)}}};e._onRotateHeadingGrab=function(a){if("start"===a.action&&!d.isNone(this._planeInfo)){var b=k.createRotatePlane(this._planeInfo.plane,this.view.renderCoordsHelper,1,g.plane.create());a=this._calculatePickRay(a.screenPoint);var c=x.create();g.plane.intersectRay(b,a,c)&&(g.boundedPlane.copy(this._planeInfo.plane,
this._startPlane),this.inputState={type:"rotate",rotatePlane:b,startPoint:c})}};e._createRotateHeadingDragPipeline=function(a){return A.createManipulatorDragEventPipeline(a,(b,c,f)=>{if((b=this.inputState)&&"rotate"===b.type){var h=d.isSome(this._planeInfo)?g.boundedPlane.copy(this._planeInfo.plane,g.boundedPlane.create()):null;c.next(B.screenToRenderPlane(this.view,b.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(b)).next(this._rotateDragUpdatePlaneFromRotate());f.next(()=>{d.isSome(h)&&
this._updateSlicePlane(h)})}})};e._onRotateTiltGrab=function(a){if("start"===a.action&&!d.isNone(this._planeInfo)){var b=k.createRotatePlane(this._planeInfo.plane,this.view.renderCoordsHelper,2,g.plane.create());a=this._calculatePickRay(a.screenPoint);var c=x.create();g.plane.intersectRay(b,a,c)&&(g.boundedPlane.copy(this._planeInfo.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:b,startPoint:c})}};e._createRotateTiltDragPipeline=function(a){return A.createManipulatorDragEventPipeline(a,
(b,c,f)=>{if((b=this.inputState)&&"rotate"===b.type){var h=d.isSome(this._planeInfo)?g.boundedPlane.copy(this._planeInfo.plane,g.boundedPlane.create()):null;c.next(B.screenToRenderPlane(this.view,b.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(b)).next(this._rotateDragUpdatePlaneFromRotate());f.next(()=>{d.isSome(h)&&this._updateSlicePlane(h)})}})};e._rotateDragRenderPlaneToRotate=function(a){return b=>{if(d.isNone(this._planeInfo))return null;const c=g.plane.normal(a.rotatePlane),f=W.calculateInputRotationTransform(this.inputState.startPoint,
b.renderEnd,this._planeInfo.plane.origin,c);return{...b,rotateAxis:c,rotateAngle:f}}};e._rotateDragUpdatePlaneFromRotate=function(){return a=>{if(!d.isNone(this._planeInfo)){var b=y.identity(p.sm4d.get());y.rotate(b,b,a.rotateAngle,a.rotateAxis);a=m.transformMat4(p.sv3d.get(),this._startPlane.basis1,b);b=m.transformMat4(p.sv3d.get(),this._startPlane.basis2,b);g.boundedPlane.fromValues(this._planeInfo.plane.origin,a,b,this._planeInfo.plane);this._updateSlicePlane(this._planeInfo.plane)}}};e._onResizeGrab=
function(a,b){if("start"===a.action&&!d.isNone(this._planeInfo)){a=this._calculatePickRay(a.screenPoint);var c=p.sv3d.get();g.plane.intersectRay(this._planeInfo.plane.plane,a,c)&&(g.boundedPlane.copy(this._planeInfo.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:b,startPoint:x.clone(c)})}};e._createResizeDragPipeline=function(a){return A.createManipulatorDragEventPipeline(a,(b,c,f)=>{if((b=this.inputState)&&"resize"===b.type&&!d.isNone(this._planeInfo)){var h=g.boundedPlane.copy(this._planeInfo.plane,
g.boundedPlane.create());c.next(B.screenToRenderPlane(this.view,this._planeInfo.plane.plane)).next(this._resizeDragUpdatePlane(b));f.next(()=>{this._updateSlicePlane(h)})}})};e._resizeDragUpdatePlane=function(a){return b=>{d.isNone(this._planeInfo)||(k.resizePlane(this._resizeHandles[a.activeHandleIdx],this.inputState.startPoint,b.renderEnd,this.view._stage.camera,this._startPlane,this._planeInfo.plane),this._updateSlicePlane(this._planeInfo.plane))}};e._updateSlicePlane=function(a){const b=k.planeToShape(a,
this.view.renderCoordsHelper,this.view.spatialReference,new K);let c=null;d.isSome(b)&&(c={plane:a,heading:b.heading,tilt:b.tilt,position:b.position,width:b.width,height:b.height});this._updateInternalSlicePlane(c);this.model.plane=b};e._updateInternalSlicePlane=function(a){const b=d.isSome(this._planeInfo);this._planeInfo=a;!this.tiltEnabled&&d.isSome(this._planeInfo)&&k.forceHorizontalOrVertical(this._planeInfo.plane,this.view.renderCoordsHelper,this._planeInfo.plane);b!==d.isSome(this._planeInfo)&&
this._updateLayerViews();this.visible&&this.attached&&(this.view.slicePlane=d.isSome(this._planeInfo)?this._planeInfo.plane:null,this._updateManipulators())};e._updatePreviewPlane=function(a,b={}){let c=this._previewPlane;this._previewPlane=null;if(d.isNone(a))this._removeFrameTask(),this._updateManipulators();else{if(!this._planeInfo&&this.active){const f=d.isSome(c)?c:g.boundedPlane.create();c=d.isSome(c)?g.boundedPlane.copy(c,Z):null;this._pickPlane(a,!0,b,f)&&(a=l.PREVIEW_FADE_DOT_THRESHOLD,b=
!1,d.isSome(c)&&(b=m.dot(c.plane,f.plane)<a||m.dot(m.normalize(p.sv3d.get(),c.basis1),m.normalize(p.sv3d.get(),f.basis1))<a),b&&(this._baseOpacity=0),this._previewPlane=f)}d.isSome(this._previewPlane)&&d.isNone(this._frameTask)&&0===this._baseOpacity?this._frameTask=Q.addFrameTask({update:({deltaTime:f})=>{this._baseOpacity=Math.min(this._baseOpacity+f/(1E3*l.PREVIEW_FADE_DURATION_SECONDS),1);this._updateManipulators();1===this._baseOpacity&&this._removeFrameTask()}}):d.isNone(this._previewPlane)&&
d.isSome(this._frameTask)?this._removeFrameTask():d.isSome(this._previewPlane)&&this._updateManipulators()}};e._removeFrameTask=function(){d.isSome(this._frameTask)&&(this._frameTask.remove(),this._frameTask=null)};e._calculatePickRay=function(a){const b=g.ray.create();a=w.screenPointObjectToArray(a,aa);g.ray.fromScreen(this.view.state.camera,a,b);m.normalize(b.direction,b.direction);return b};e._pickMinResult=function(a){a=w.screenPointObjectToArray(a,p.sv2d.get());this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,
this._intersector);return this._intersector.results.min};e._pickPlane=function(a,b,c,f){var h=this._pickMinResult(a);a=p.sv3d.get();if(!h.getIntersectionPoint(a))return!1;h=h.getTransformedNormal(p.sv3d.get());const u=this.view._stage.camera;0<m.dot(h,u.viewForward)&&m.scale(h,h,-1);const E=k.calculatePlaneHalfSize(a,u);b=(b?1:-1)*E*l.INITIAL_DEPTH_OFFSET_FRAC;b=m.scale(p.sv3d.get(),h,b);m.add(b,b,a);a=this.tiltEnabled?3:0;k.createPlane(b,h,E,E,u,c[l.forceVerticalModifier]?2:c[l.forceHorizontalModifier]?
1:a,this.view.renderCoordsHelper,f);return!0};e._updateMouseCursor=function(){this._set("cursor",null);this._isTargeting||"exclude"===this.layersMode?this._set("cursor","crosshair"):d.isSome(this._creatingPointerId)&&this._set("cursor","grabbing")};e._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout&&(this._prevPointerMoveTimeout.remove(),this._prevPointerMoveTimeout=null)};e._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout();this.shiftManipulator.state|=k.DidPointerMoveRecentlyFlag;
this.rotateHeadingManipulator.state|=k.DidPointerMoveRecentlyFlag;this.rotateTiltManipulator.state|=k.DidPointerMoveRecentlyFlag;this._prevPointerMoveTimeout=this.clock.setTimeout(()=>{this.shiftManipulator.state&=~k.DidPointerMoveRecentlyFlag;this.rotateHeadingManipulator.state&=~k.DidPointerMoveRecentlyFlag;this.rotateTiltManipulator.state&=~k.DidPointerMoveRecentlyFlag},l.POINTER_MOVE_TIMER_MS)};e._updateManipulators=function(){if(!this.disableEngineLayers){var a=null,b=!1,c=!1;d.isSome(this._planeInfo)?
(a=this._planeInfo.plane,b=!0):d.isSome(this._previewPlane)&&(a=this._previewPlane,c=!0);var f=d.isSome(a)?k.calculateBoundedPlaneTranslateRotate(a,p.sm4d.get()):null;this.shiftManipulator.available=b;this.rotateHeadingManipulator.available=b;this.rotateTiltManipulator.available=b&&this.tiltEnabled;this.resizeManipulators.forEach(h=>h.available=b);b&&(k.updateShiftRestartHandle(this.shiftManipulator,f,a,this.view._stage.camera),k.updateRotateHeadingHandle(this.rotateHeadingManipulator,f,a,this.view.renderCoordsHelper),
k.updateRotateTiltHandle(this.rotateTiltManipulator,f,a),this.resizeManipulators.forEach((h,u)=>k.updateResizeHandle(h,this._resizeHandles[u],f,a)));this._outlineVisualElement.width=c?l.PLANE_PREVIEW_OUTLINE_WIDTH:l.PLANE_OUTLINE_WIDTH;d.isSome(a)&&(c=m.set(p.sv3d.get(),m.length(a.basis1),m.length(a.basis2),1),c=y.fromScaling(p.sm4d.get(),c),c=y.multiply(c,f,c),this._outlineVisualElement.transform=c,this._gridVisualElement.transform=c,this._updateMaterials());this._updateVisualElementVisibility()}};
e._updateVisualElementVisibility=function(){if(!this.disableEngineLayers){var a=null;d.isSome(this._planeInfo)?a=this._planeInfo.plane:d.isSome(this._previewPlane)&&(a=this._previewPlane);this._outlineVisualElement.visible=this.visible;this._gridVisualElement.visible=d.isSome(a)&&this.visible}};e._updateMaterials=function(){this._outlineVisualElement.color=[l.PLANE_OUTLINE_COLOR[0],l.PLANE_OUTLINE_COLOR[1],l.PLANE_OUTLINE_COLOR[2],l.PLANE_OUTLINE_COLOR[3]*this._baseOpacity];const a=this.inputState&&
"resize"===this.inputState.type?l.GRID_COLOR:[0,0,0,0];this._gridVisualElement.backgroundColor=[l.PLANE_BACKGROUND_COLOR[0],l.PLANE_BACKGROUND_COLOR[1],l.PLANE_BACKGROUND_COLOR[2],l.PLANE_BACKGROUND_COLOR[3]*this._baseOpacity];this._gridVisualElement.gridColor=a};e.updateManipulatorsInteractive=function(a){a.grabbing?(this.shiftManipulator.interactive=this.shiftManipulator===a,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===a,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===
a,this.resizeManipulators.forEach(b=>{b.interactive=b===a})):(this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,this.resizeManipulators.forEach(b=>{b.interactive=!0}))};e.testData=function(){return{plane:d.isSome(this._planeInfo)?this._planeInfo.plane:null}};F._createClass(v,[{key:"state",get:function(){const a=!!this._planeInfo,b=!!this.inputState;return a?a&&b?"slicing":a&&!b?"sliced":"ready":"ready"}},{key:"isSupported",
get:function(){return"3d"===this.get("view.type")}},{key:"model",set:function(a){if(null==a)throw Error("SliceTool requires valid model, but null was provided.");this._handles.remove("model");this._set("model",a);this._handles.add(this.model.watch("plane",()=>this.planeChanged(),!0),"model")}},{key:"excludedLayers",get:function(){return this._get("excludedLayers")||new R},set:function(a){this._set("excludedLayers",G.referenceSetter(a,this._get("excludedLayers")))}},{key:"excludeGroundSurface",set:function(a){this._set("excludeGroundSurface",
a);this.view&&this._updateLayerViews()}},{key:"tiltEnabled",set:function(a){a!==this._get("tiltEnabled")&&(this._set("tiltEnabled",a),this.view&&(this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),d.isSome(this._planeInfo)&&!a&&(this._planeInfo.plane=g.boundedPlane.copy(this._planeInfo.plane)),this._updateManipulators()))}},{key:"inputState",get:function(){return this._get("inputState")},set:function(a){this._set("inputState",a);this._updateMaterials()}},{key:"_isTargeting",
get:function(){return!this.inputState&&!this._planeInfo&&this.active}},{key:"_creatingPointerId",get:function(){return this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}}]);return v}(V.InteractiveToolBase);q.__decorate([r.property()],n.prototype,"clock",void 0);q.__decorate([r.property({constructOnly:!0})],n.prototype,"view",void 0);q.__decorate([r.property({readOnly:!0})],n.prototype,"state",null);q.__decorate([r.property({readOnly:!0})],n.prototype,"isSupported",
null);q.__decorate([r.property({readOnly:!0})],n.prototype,"cursor",void 0);q.__decorate([r.property()],n.prototype,"model",null);q.__decorate([r.property()],n.prototype,"_planeInfo",void 0);q.__decorate([r.property({readOnly:!0})],n.prototype,"layersMode",void 0);q.__decorate([r.property({cast:G.castForReferenceSetter})],n.prototype,"excludedLayers",null);q.__decorate([r.property({type:Boolean,value:!1})],n.prototype,"excludeGroundSurface",null);q.__decorate([r.property({type:Boolean,value:!1})],
n.prototype,"tiltEnabled",null);q.__decorate([r.property({value:null})],n.prototype,"inputState",null);n=q.__decorate([O.subclass("esri.views.3d.interactive.analysisTools.slice.SliceTool")],n);const Z=g.boundedPlane.create(),aa=w.createScreenPointArray();return n});