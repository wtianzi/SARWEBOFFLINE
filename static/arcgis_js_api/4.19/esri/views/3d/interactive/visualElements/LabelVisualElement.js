// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../chunks/vec2 ./VisualElement ../measurementTools/support/viewUtils ../../../overlay/LineOverlayItem ../../../overlay/TextOverlayItem".split(" "),function(u,C,D,g,v,J,K,e,y,L,M,N){function z(n,p,f,a){n.eval(p,A,E);J.add(F,A,E);f.projectToRenderScreen(A,G);f.projectToRenderScreen(F,H);e.subtract(a,O,P);
e.normalize(a,a)}y=function(n){function p(a){var c=n.call(this,a.view)||this;c._handles=new K;c._textItem=null;c._calloutItem=null;c._showCallout=!0;c._showText=!0;c._geometry=null;c._text=null;c._fontSize=14;c._distance=25;c._anchor="right";c.applyProps(a);return c}C._inheritsLoose(p,n);var f=p.prototype;f.overlaps=function(a){return this.textItem.visible&&a.textItem.visible&&this.view.overlay.overlaps(this._textItem,a.textItem)};f._updateLabelPosition=function(){if(this.attached){this._showCallout=
this._showText=!1;if(D.isSome(this.geometry)&&this.view._stage)switch(this.geometry.type){case "point":this._computeLabelPositionFromPoint(this.geometry,k)&&(this._textItem.position=[k[0],k[1]],this._textItem.anchor="center",this._showText=!0);break;case "corner":this._computeLabelPositionFromCorner(this.geometry,this._distance,k,w)&&(this._showCallout=this._updatePosition(k,w),this._showText=!0);break;case "segment":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,
k,w)&&(this._showText=!0,this._showCallout=this._updatePosition(k,w))}this.updateVisibility(this.visible)}};f._computeLabelPositionFromPoint=function(a,c){this.view.renderCoordsHelper.toRenderCoords(a,x);a=this.view._stage.camera;a.projectToRenderScreen(x,d);if(0>d[2]||1<d[2])return!1;a.renderToScreen(d,c);return!0};f._computeLabelPositionFromCorner=function(a,c,l,q){if(!a)return!1;const h=this.view._stage.camera;z(a.left,1,h,m);e.negate(m,m);z(a.right,0,h,I);e.add(b,m,I);e.negate(b,b);e.normalize(b,
b);h.projectToRenderScreen(a.left.endRenderSpace,d);if(0>d[2]||1<d[2])return!1;h.renderToScreen(d,l);e.scale(b,b,c*h.pixelRatio);e.add(b,b,d);h.renderToScreen(b,q);return!0};f._computeLabelPositionFromSegment=function(a,c,l,q,h){if(!a)return!1;const B=a.segment,r=this.view._stage.camera;L.screenSpaceTangent(B.startRenderSpace,B.endRenderSpace,m,r);e.set(b,-m[1],m[0]);let t=!1;switch(l){case "top":t=0>b[1];break;case "bottom":t=0<b[1];break;case "left":t=0<b[0];break;case "right":t=0>b[0]}t&&e.negate(b,
b);if(0===e.length(b))switch(l){case "top":b[1]=1;break;case "bottom":b[1]=-1;break;case "left":b[0]=-1;break;case "right":b[0]=1}B.eval(Q[a.sampleLocation],x);r.projectToRenderScreen(x,d);if(0>d[2]||1<d[2])return!1;r.renderToScreen(d,q);e.scale(b,b,c*r.pixelRatio);e.add(b,b,d);r.renderToScreen(b,h);return!0};f._updatePosition=function(a,c){if(c){const l=c[0]-a[0],q=c[1]-a[1];this._textItem.position=[c[0],c[1]];this._textItem.anchor=Math.abs(l)>Math.abs(q)?0<l?"left":"right":0<q?"top":"bottom";this._calloutItem.startPosition=
[a[0],a[1]];this._calloutItem.endPosition=[c[0],c[1]];return!0}this._textItem.position=[a[0],a[1]];this._textItem.anchor="center";return!1};f.createResources=function(){this._textItem=new N({visible:!0});this._textItem.text=D.unwrap(this._text);this._textItem.fontSize=this._fontSize;this._calloutItem=new M({visible:!0,width:2});this._updateLabelPosition();this.view.overlay.items.addMany([this._textItem,this._calloutItem]);this._handles.add(this.view.state.watch("camera",()=>{this._updateLabelPosition()}))};
f.destroyResources=function(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]);this._handles.removeAll()};f.updateVisibility=function(a){this._textItem.visible=this._showText&&a;this._calloutItem.visible=this._showCallout&&a};C._createClass(p,[{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this._updateLabelPosition()}},{key:"textItem",get:function(){return this._textItem}},{key:"text",get:function(){return this._text},
set:function(a){this._text=a;this.attached&&(this._textItem.text=this._text)}},{key:"fontSize",get:function(){return this._fontSize},set:function(a){this._fontSize=a;this.attached&&(this._textItem.fontSize=this._fontSize)}},{key:"distance",get:function(){return this._distance},set:function(a){this._distance!==a&&(this._distance=a,this._updateLabelPosition())}},{key:"anchor",get:function(){return this._anchor},set:function(a){this._anchor!==a&&(this._anchor=a,this._updateLabelPosition())}}]);return p}(y.VisualElement);
const A=v.create(),F=v.create(),E=v.create(),m=g.createRenderScreenPointArray(),I=g.createRenderScreenPointArray(),b=g.createRenderScreenPointArray(),x=v.create(),d=g.createRenderScreenPointArray3(),k=g.createScreenPointArray(),w=g.createScreenPointArray(),G=g.createRenderScreenPointArray3(),P=G,H=g.createRenderScreenPointArray3(),O=H,Q={start:0,center:.5,end:1};u.LabelVisualElement=y;u.mirrorPosition=function(n){switch(n){case "top":return"bottom";case "right":return"left";case "bottom":return"top";
case "left":return"right"}};u.screenSpaceTangent=z;Object.defineProperty(u,"__esModule",{value:!0})});