// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../geometry/projectionEllipsoid ../../../chunks/mat4 ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../chunks/mat4f64 ../../../geometry/support/aaBoundingBox ./geometryUtils ./intersectionUtils".split(" "),function(q,D,v,m,d,E,F,G,H,w,x,r,g,I){const y=.5*Math.PI,J=y/Math.PI*180;let C=function(){function z(a){this.renderCoordsHelper=a.renderCoordsHelper;
this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:m.create(),direction:m.create()};for(a=0;4>a;a++)this.extent[a]={origin:m.create(),direction:m.create(),cap:{next:null,direction:m.create()}},this.planes[a]=g.plane.create();this.planes[4]=g.plane.create();this.planes[5]=g.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}var n=z.prototype;n.update=function(a,b,c,e=!0){const l=this.extent;this.toRenderBoundingExtent(a,b,c);d.add(this.center.origin,l[0].origin,l[2].origin);
d.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||d.scale(this.center.direction,this.center.direction,-1);for(c=0;4>c;c++){const h=l[c];this.renderCoordsHelper.worldUpAtPosition(h.origin,h.direction);const p=l[3===c?0:c+1];h.cap.next=p.origin;E.directionFromTo(h.cap.direction,h.origin,p.origin);g.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[c]);e||d.scale(h.direction,h.direction,-1)}g.plane.fromVectorsAndPoint(l[0].cap.direction,
l[1].cap.direction,l[0].origin,this.planes[4]);e?g.plane.negate(this.planes[4],this.planes[5]):(g.plane.copy(this.planes[4],this.planes[5]),g.plane.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b;this.minGlobalAltitude=.9*F.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};n.isVisibleInFrustum=function(a,b,c=!1){if(null==a)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?
J:y*b))return!0;if(a.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan)return b=this.extent[0],!c&&a.intersectsRay(g.ray.wrap(b.origin,b.direction))?!0:!1;for(b=0;b<this.extent.length;b++){var e=this.extent[b];if(!c&&a.intersectsRay(g.ray.wrap(e.origin,e.direction))||a.intersectsLineSegment(g.lineSegment.fromPoints(e.origin,e.cap.next,K),e.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(b=0;b<a.lines.length;b++)if(e=a.lines[b],I.frustumLineSegment(c,
e.origin,e.endpoint,e.direction))return!0;return!1};n.toRenderBoundingExtentGlobal=function(a,b,c){H.center(a,k);k[2]=c;w.computeLinearTransformation(b,k,t,this.renderCoordsHelper.spatialReference);G.invert(A,t);r.empty(f);for(const {x0:e,x1:l,y0:h,y1:p}of L)for(let u=0;5>u;u++){const B=u/4;k[0]=v.lerp(a[e],a[l],B);k[1]=v.lerp(a[h],a[p],B);k[2]=c;w.projectVectorToVector(k,b,k,this.renderCoordsHelper.spatialReference);d.transformMat4(k,k,A);r.expandWithVec3(f,k)}d.set(this.extent[0].origin,f[0],f[1],
f[2]);d.set(this.extent[1].origin,f[3],f[1],f[2]);d.set(this.extent[2].origin,f[3],f[4],f[2]);d.set(this.extent[3].origin,f[0],f[4],f[2]);for(a=0;4>a;++a)d.transformMat4(this.extent[a].origin,this.extent[a].origin,t)};n.toRenderBoundingExtentLocal=function(a,b){d.set(this.extent[0].origin,a[0],a[1],b);d.set(this.extent[1].origin,a[2],a[1],b);d.set(this.extent[2].origin,a[2],a[3],b);d.set(this.extent[3].origin,a[0],a[3],b)};n.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(a,
b,c);break;case 2:this.toRenderBoundingExtentLocal(a,c);break;default:D.neverReached(this.renderCoordsHelper.viewingMode)}};n.isVisibleInFrustumGlobal=function(a){if(0>d.dot(this.center.direction,a.direction))return!0;for(let b=0;4>b;b++)if(0>d.dot(this.extent[b].direction,a.direction))return!0;return!1};return z}();const L=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],k=m.create(),t=x.create(),A=x.create(),f=r.create(),K=g.lineSegment.create();q.FrustumExtentIntersection=
C;q.default=C;Object.defineProperty(q,"__esModule",{value:!0})});