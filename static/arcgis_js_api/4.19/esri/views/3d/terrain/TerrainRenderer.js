// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/ObjectPool ../../../core/PooledArray ../../../core/Accessor ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec4f64 ../../../chunks/vec4 ../support/buffer/BufferView ../../../geometry/support/aaBoundingBox ../../../support/requestImageUtils ./TerrainConst ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./OverlayRenderer ./PatchGeometryFactory ./tileUtils ./PatchRenderData ./TileRenderer ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/statistics/tracer".split(" "),
function(Z,n,p,A,Da,Ea,u,Fa,ia,Ga,Ha,Ia,aa,K,ja,ka,B,v,la,ba,L,ca,ma,R,na,oa,pa,qa,S,ra,T,sa,ta,da,ea,C,ua,va,U,V){function fa(D,w,f){ca.set(f,D[0]*w[2]+w[0],D[1]*w[3]+w[1],D[2]*w[2],D[3]*w[3])}const M=R.create(),N=L.create();let wa=function(){this.extent=L.create();this.maxLevel=this.minLevel=0;this.callback=null};p=function(D){function w(a){a=D.call(this,a)||this;a.type="Terrain";a.isGround=!0;a.tileSize=256;a.rctx=null;a._isTransparent=!1;a.renderDataPool=new aa(ua.PatchRenderData);a.patchGroups=
new K({allocator:b=>b||{root:null,origin:null,patches:new K},deallocator:b=>{b.root=null;b.origin=null;b.patches.clear();return b}});a.patchGroupsDirty=!0;a.patchGroupsMap=new Map;a.tileIterator=new C.IteratorPreorder;a.highestVisibleLODTile=null;a.visible=!0;a._opaque=!0;a._skirtScale=1;a._velvetOverground=!0;a.castShadows=!0;a._ssrEnabled=!1;a.emptyTex=null;a.tileRenderer=null;a.tileBackgroundInitialized=!1;a.tileBackgroundUpdating=!1;a.stencilEnabledLayerExtents=[];a.numTrianglesRendered=0;a.numTilesRendered=
0;a.numTilesCulled=0;a.numOriginsRendered=0;a.clippingExtent=null;a.overlayOpacity=1;a.needsHighlight=!1;a.renderOccludedFlags=1;a.visibleScaleRangeQueries=new K({initialSize:10});a.visibleScaleRangeQueriesInvPtr=0;a.visibleScaleRangeQueryQueue=new K({initialSize:30});a.visibleScaleRangeQueryPool=new aa(wa);return a}Z._inheritsLoose(w,D);var f=w.prototype;f.destroy=function(){ea.clearCaches()};f.install=function(a){a.addRenderPlugin([2,7,9],this)};f.uninstall=function(a){a.removeRenderPlugin(this)};
f.setDebugScreenSizePerspective=function(a){this.shaderTechniqueConfig.screenSizePerspective!==a&&(this.shaderTechniqueConfig.screenSizePerspective=a,this.setNeedsRender())};f.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};f.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};f.setRenderOccludedOverlay=function(a){this.renderOccludedFlags=a?da.overlayRenderOccludedFlag:1;this.setNeedsRender()};f.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=
a;this.setNeedsRender()};f.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};f.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a));this.updateTileGeometry(a);this.updateTileTexture(a)};f.queryVisibleLevelRange=function(a,b,d,c){const e=this.visibleScaleRangeQueryPool.acquire();ca.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=
null!=d?d:Number.MAX_VALUE;e.callback=c;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};f.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),this.setNeedsRender(),a.resetPendingUpdate(64))};f.updateTileGeometry=function(a){for(const b of a.layerInfo[0])b.pendingUpdates&=-33;a.resetPendingUpdate(32);a.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};f.unloadTile=function(a){a.renderData&&
(this.releaseTileGeometry(a.renderData),a.renderData.clear(),a.renderData=null,a.setMemoryDirty(),this.setNeedsRender())};f._getLocalOriginOfTile=function(a){const b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return B.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};f.setVisibility=function(a){this.visible=a;this.setNeedsRender()};f.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};f.setNeedsRender=function(a=1){this.patchGroupsDirty=!0;this.context.requestRender(a)};f.setTileBackground=function(a){this.tileBackground=a;this._updateTileBackground()};f.initializeRenderContext=function(a){this.context=a;this.rctx=a.renderContext.rctx;this.shaderTechniques=a.shaderTechniqueRep;this.shaderTechniqueConfig=new U.TerrainTechniqueConfiguration;this.tileRenderer=new va.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&
this._updateTileBackground();this.emptyTex=qa.createEmptyTexture(this.rctx)};f.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};f.intersect=function(a,b,d,c){if(this.rootTiles&&(!a.options.selectOpaqueTerrainOnly||!a.options.selectionMode||this._opaque)){var e=xa,h=ya;v.subtract(e,c,d);v.set(h,1/e[0],1/e[1],1/e[2]);var g=a.results.min,r=a.results.max,E=a.results.ground,I=
0===a.options.store,x=!!a.results.ground.target,m,H=this.clippingExtent,F=this.tileIterator;F.reset(this.rootTiles);for(var l=S.getVerticalOffsetTerrain(a.verticalOffset);!F.done;){const q=F.next();if(null===q.renderData||x&&this._useStencilForTile(q))continue;if(a.options.invisibleTerrain){if(!q.visible&&H&&!q.intersectsExtent(H))continue}else if(!q.visible)continue;var t=q.renderData.geometryInfo;R.set(M,t.boundingBox);const O=q.renderData.localOrigin;A.isSome(l)&&(l.localOrigin=O,l.applyToAabb(M));
const G=-this._skirtScale*t.skirtLength;if(0!==G){var z=q.up;R.expandWithOffset(M,G*z[0],G*z[1],G*z[2])}z=M;v.subtract(P,d,O);if(!T.intersectAabbInvDirBefore(z,P,h,a.tolerance,I&&null!=g.dist?g.dist:Infinity))continue;const J=(k,y,za,Aa)=>{k.set(void 0,C.tile2str(y),za,Aa,ba.IDENTITY,void 0);k.intersector="TerrainRenderer";k.target={type:"external",metadata:{tile:y}}};z=(k,y)=>{0<=k&&(a.options.backfacesTerrain||0>v.dot(y,e))&&(a.options.invisibleTerrain||!a.options.selectionMode||null==b||b(d,c,
k))&&((null==E.dist||k<E.dist)&&J(E,q,k,y),a.options.isFiltered||(2===a.options.store&&(A.isNone(m)?(m=new S.IntersectorResult(a.ray),J(m,q,k,y),a.results.all.push(m)):k<m.dist&&J(m,q,k,y)),(null==g.dist||k<g.dist)&&J(g,q,k,y),0!==a.options.store&&(null==r.dist||k>r.dist)&&J(r,q,k,y)))};const W=Ba;v.subtract(W,c,O);const X=t.indices,Y=t.vertexAttributes,Ca={data:Y.getField("position",ma.BufferViewVec3f).typedBuffer,size:3,stride:Y.stride/4};t=t.numWithoutSkirtIndices/3;T.intersectTriangles(P,W,0,
t,X,Ca,null,l,z);0!==G&&ea.intersectSkirts(P,W,t,X.length/3,X,Y,"spherical"===this.manifold?k=>v.scale(k,k,G/v.length(v.add(k,k,O))):k=>v.set(k,0,0,G),l,z)}}};f.render=function(a){if(9===a.slot){if(0===(a.renderOccludedMask&da.overlayRenderOccludedFlag))return!1}else if(a.slot!==(this.opaque?2:7))return!1;V.trace("# BEGIN RENDER TERRAIN");var b=a.pass;const d=1===a.scenelightingData.globalFactor,c=this._updatePatchGroups();switch(b){case 0:b=a.shadowMap&&a.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==
b&&(this.shaderTechniqueConfig.receiveShadows=b);b=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==b&&(this.shaderTechniqueConfig.overlayMode=b);this._renderMaterialPass(a,0,c,9===a.slot?3:1);break;case 4:case 6:this.castShadows&&d&&this._renderAuxiliaryPass(a,3,c,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(a,1,c,0);break;case 3:this._renderAuxiliaryPass(a,2,c,0);break;case 5:this.needsHighlight&&
(this._renderAuxiliaryPass(a,4,c,2),a.rctx.clearSafe(256))}V.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};f._renderMaterialPass=function(a,b,d,c){const e=a.rctx,h=a.camera;this._ssrEnabled=a.ssrParams.ssrEnabled;this._setTerrainTechnique(b,3===c);const g=this.shaderTechnique.program;a.rctx.bindProgram(g);e.bindProgram(g);1===c&&a.ssrParams&&(a.ssrParams.lastFrameColorTextureUnit=9,a.ssrParams.linearDepthTextureUnit=8,ta.ScreenSpaceReflections.bindUniforms(g,
e,a.ssrParams));a.shadowMap&&a.shadowMap.bind(g,7);a.ssaoHelper&&a.ssaoHelper.setUniforms(g,6);g.setUniform1i("tex",0);g.setUniform1i("texNext",1);this._bindOverlayData(g,c);g.setUniformMatrix4fv("viewNormal",h.viewInverseTransposeMatrix);pa.View.bindProjectionMatrix(g,h.projectionMatrix);a.scenelightingData.setUniforms(g,!0);b=h.viewMatrix;v.set(Q,b[12],b[13],b[14]);v.normalize(Q,Q);g.setUniform3fv("viewDirection",Q);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=
0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,g,d,c):a.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(a,g,d,c),a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};f._renderAuxiliaryPass=function(a,b,d,c){this._setTerrainTechnique(b,3===c);b=this.shaderTechnique.program;a.rctx.bindProgram(b);if(5===a.pass){const e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,6);b.setUniform1i("depthTex",
6);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else b.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix),2!==a.pass&&4!==a.pass&&6!==a.pass||b.setUniform2fv("nearFar",a.camera.nearFar);this._renderPatchGroupsAuxiliary(a,b,d,c)};f._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=!0;var a=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;
this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!A.isSome(this.tileRenderer.backgroundColor);this.rootTiles&&C.traverseTilesPreorder(this.rootTiles,b=>{this.tileRenderer.updateTileTexture(b);this.setNeedsRender()});this.setNeedsRender()};if("string"===typeof this.tileBackground){const b=this.tileBackground;na.requestImage(b).then(d=>{b===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(d,this.tileBackground===oa.DEFAULT_TILE_BACKGROUND),
a())})}else{const b=this.tileBackground?ka.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(b,!1);a()}}};f._updatePatchGroups=function(){const a=this.patchGroups;if(!this.patchGroupsDirty)return a;this.highestVisibleLODTile=null;this._renderCollectOrigins(a);if(0!==this.renderOrder){for(let b=0;b<a.length;b++)C.sortTiles(this.renderOrder,a.data[b].patches);a.sort((b,d)=>{var c=this.renderOrder;b=0===b.patches.length?-c:0===d.patches.length?c:C.compareTiles(b.patches.data[0],
d.patches.data[0],c);return b})}this.patchGroupsDirty=!1;return a};f._renderCollectOrigins=function(a){var b=this.rootTiles;const d="spherical"===this.manifold;a.clear();for(const c of b)b=a.pushNew(),b.root=c,b.origin=d?B.ZEROS:c.centerAtSeaLevel,b.patches.clear(),this._renderCollectOriginsForRoot(a,b);a.filterInPlace(c=>0<c.patches.length)};f._renderCollectOriginsForRoot=function(a,b){const d=this.tileIterator;d.resetOne(b.root);const c=this.patchGroupsMap;c.clear();for(c.set(b.origin,b);!d.done;){b=
d.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,d.skipSubtree();else{if(0===b.lij[0]%7){const h=a.pushNew();h.root=b;h.origin=b.centerAtSeaLevel;c.set(b.centerAtSeaLevel,h);h.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(e=c.get(e.localOrigin))&&e.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;d.skipSubtree()}}}};f._scaleQueriesForTile=function(a){const b=a.extent;a=a.lij[0];let d=0;for(;d<
this.visibleScaleRangeQueriesInvPtr;){const c=this.visibleScaleRangeQueries.data[d],e=c.extent;a>=c.minLevel&&a<=c.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(d,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):d++}};f._useStencilForTile=function(a){for(const b of this.stencilEnabledLayerExtents)if(a.intersectsExtent(b))return!0;return!1};f._renderPatchGroupsAuxiliary=function(a,b,d,c){this.shaderTechnique.bindPipelineState(a.rctx);
const e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);0!==c&&this._bindOverlayData(b,c);for(let h=0;h<d.length;h++){const g=d.data[h];this._bindPatchGroupData(b,g,a.camera.eye,a.camera.viewMatrix);for(let r=0;r<g.patches.length;r++)this._renderPatch(a.rctx,b,g.patches.data[r],4,e,c)}a.rctx.bindVAO(null)};f._renderPatchGroups=function(a,b,d,c){const e=a.rctx,h=a.camera,g=h.viewMatrix;this.shaderTechnique.bindPipelineState(e);
if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var r=ra.getSettings("spherical"===this.manifold?1:2,this.ellipsoidRadius);r.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:h.fovY});T.bindScreenSizePerspective(r,b,"screenSizePerspective")}r=0<this.stencilEnabledLayerExtents.length;const E=3===c;E&&(e.bindTexture(this.emptyTex,0),b.setUniform1f("blend",1),b.setUniform4fv("texOffsetAndScale",L.ZEROS));var I=A.isSome(this.tileRenderer.backgroundColor)?
this.tileRenderer.backgroundColor:L.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&b.setUniform4fv("backgroundColor",I);b.setUniform1f("skirtScale",E?0:this._skirtScale);I=this.wireframe?1:4;for(let H=0;H<d.length;H++){var x=d.data[H];const F=x.patches;if(0!==F.length)for(this._bindPatchGroupData(b,x,h.eye,g),sa.Slice.bindUniforms(b,this.shaderTechnique.configuration,a.sliceHelper&&a.sliceHelper.plane,x.origin),a.shadowMap&&a.shadowMap.bindView(b,x.origin),this.numOriginsRendered++,x=0;x<F.length;x++){const l=
F.data[x];var m=l.renderData.textureReference;if(!A.isNone(m)){V.trace("# RENDER TILE "+C.tile2str(l)+", screenDepth:"+l.screenDepth);if(!E){this._scaleQueriesForTile(l);fa(l.renderData.geometryInfo.uvOffsetAndScale,m.offsetAndScale,N);b.setUniform4fv("texOffsetAndScale",N);e.bindTexture(m.texture.texture,0);m=l.renderData.textureFadeFactor;const t=1>m?l.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&A.isSome(t)?(fa(l.renderData.geometryInfo.uvOffsetAndScale,
t.offsetAndScale,N),b.setUniform1f("textureFadeFactor",m),b.setUniform4fv("nextTexOffsetAndScale",N),e.bindTexture(t.texture.texture,1)):(b.setUniform1f("textureFadeFactor",1),e.bindTexture(this.emptyTex,1));l.renderData.textureIsFading&&this.setNeedsRender();b.setUniform1f("opacity",l.renderData.opacity);b.setUniform1i("compositeBackground",l.renderData.compositeBackgroundInShader?1:0);b.setUniform1f("textureOpacity",l.renderData.layerOpacity);b.setUniform1f("baseOpacity",l.renderData.baseOpacity)}m=
this._renderPatch(e,b,l,I,r,c);l.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=m/3}}}e.bindVAO(null)};f._renderPatch=function(a,b,d,c,e,h){0!==h&&this._bindOverlayPatchData(b,d.renderData.overlay);e&&(this._useStencilForTile(d)?this.stencilShaderTechnique.bindPipelineState(a):this.shaderTechnique.bindPipelineState(a));e=0===this._skirtScale?d.renderData.geometryInfo.numWithoutSkirtIndices:d.renderData.vao.indexBuffer.size;a.bindVAO(d.renderData.vao);b.assertCompatibleVertexAttributeLocations(d.renderData.vao);
a.drawElements(c,e,d.renderData.vao.indexBuffer.indexType,0);return e};f._bindPatchGroupData=function(a,b,d,c){a.setUniform3fv("origin",b.origin);la.translate(ha,c,b.origin);a.setUniformMatrix4fv("view",ha);a.setUniform3f("camPos",d[0]-b.origin[0],d[1]-b.origin[1],d[2]-b.origin[2])};f._bindOverlayData=function(a,b){a.setUniform1i("ovInnerColorTex",2);a.setUniform1i("ovOuterColorTex",3);a.setUniform1i("ovInnerWaterTex",4);a.setUniform1i("ovOuterWaterTex",5);a.setUniform1f("overlayOpacity",this.overlayOpacity);
const d=this.overlayRenderer.overlays;a=c=>{if(A.isSome(d)){var e=d[c];const h=(1===b?e.renderTargets.color:2===b?e.renderTargets.highlight:e.renderTargets.occluded).fbo.getTexture();this.rctx.bindTexture(h,2+c);(e=1===b?e.renderTargets.water:null)?(e=e.fbo.getTexture(),this.rctx.bindTexture(e,4+c)):this.rctx.bindTexture(this.emptyTex,4+c)}else this.rctx.bindTexture(this.emptyTex,2+c),this.rctx.bindTexture(this.emptyTex,4+c)};a(0);a(1)};f._bindOverlayPatchData=function(a,b){a.setUniform4fv("overlayTexOffset",
b.offsets);a.setUniform4fv("overlayTexScale",b.scales)};f._setTerrainTechnique=function(a,b){this.shaderTechniqueConfig.output=a;0===a&&(this.shaderTechniqueConfig.atmosphere="spherical"===this.manifold&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=b;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(U.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);
this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(U.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};f.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};f._prepareScaleRangeQueries=function(){const a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;for(;a.length<a.data.length&&0<b.length;){const d=b.pop();a.push(d)}this.visibleScaleRangeQueriesInvPtr=
a.length};f._processScaleRangeQueries=function(){const a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool;for(let d=0;d<a.length;d++){const c=a.data[d];b.release(c);c.callback(d>=this.visibleScaleRangeQueriesInvPtr);c.callback=null}a.clear()};Z._createClass(w,[{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},
{key:"renderingDisabled",set:function(a){this._set("renderingDisabled",!!a);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(a){this._isTransparent!==a&&(this._isTransparent=a,this.setNeedsRender())}},
{key:"skirtScale",get:function(){return this._skirtScale},set:function(a){a!==this._skirtScale&&(this._skirtScale=a,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(a){this.shaderTechniqueConfig.tileBorders!==a&&(this.shaderTechniqueConfig.tileBorders=a,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(a){this.shaderTechniqueConfig.backfaceCullingEnabled!==
a&&(this.shaderTechniqueConfig.backfaceCullingEnabled=a,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(a){this._set("renderOrder",a);this.setNeedsRender()}},{key:"velvetOverground",set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return S.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this.shaderTechniqueConfig.slicePlaneEnabled!==
a&&(this.shaderTechniqueConfig.slicePlaneEnabled=a,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(a){this.shaderTechniqueConfig.textureFadingEnabled!==a&&(this.shaderTechniqueConfig.textureFadingEnabled=a,this.setNeedsRender())}},{key:"wireframe",set:function(a){this._get("wireframe")!==a&&(this._set("wireframe",a),this.rootTiles&&(C.traverseTilesPreorder(this.rootTiles,b=>{b.renderData&&b.renderData.updateGeometry(this.rctx,a)}),this.setNeedsRender()))}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);
return w}(ja);n.__decorate([u.property()],p.prototype,"tileBackgroundInitialized",void 0);n.__decorate([u.property()],p.prototype,"tileBackgroundUpdating",void 0);n.__decorate([u.property({constructOnly:!0})],p.prototype,"manifold",void 0);n.__decorate([u.property({constructOnly:!0})],p.prototype,"overlayRenderer",void 0);n.__decorate([u.property({constructOnly:!0})],p.prototype,"ellipsoidRadius",void 0);n.__decorate([u.property({readOnly:!0})],p.prototype,"updating",null);n.__decorate([u.property({value:!1})],
p.prototype,"renderingDisabled",null);n.__decorate([u.property()],p.prototype,"renderPatchBorders",null);n.__decorate([u.property()],p.prototype,"cullBackFaces",null);n.__decorate([u.property({value:1})],p.prototype,"renderOrder",null);n.__decorate([u.property()],p.prototype,"wireframe",null);n=p=n.__decorate([ia.subclass("esri.views.3d.terrain.TerrainRenderer")],p);const ha=ba.create(),Q=B.create(),xa=B.create(),ya=B.create(),P=B.create(),Ba=B.create();return n});