// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/Logger ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,h,k,l,u,v,w,x,p,y,z,A,B,C,D,E,F,G){const H=k.getLogger("esri.views.3d.environment.PanoramicAtmosphere");k=function(){function m(b){this.slot=14;this._readyResolver=l.createResolver();this._readyController=l.createAbortController();this.view=b;this._atmosphereTechniqueConfig=new p.SimpleAtmosphereTechniqueConfiguration}var e=m.prototype;e.destroy=function(){this._readyResolver.reject();this._texture=h.disposeMaybe(this._texture);this._vao=h.disposeMaybe(this._vao);this._readyController=
h.abortMaybe(this._readyController)};e.when=function(){return this._readyResolver.promise};e.initializeRenderContext=function(b){const c=b.renderContext.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=b.shaderTechniqueRep.acquireAndReleaseExisting(p.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(c);this._vaoCount=F.vertexCount(this._vao,"geometry");w.requestImage(y,{signal:this._readyController.signal}).then(a=>
{this._texture=new E(c,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(a=>{l.isAbortError(a)||H.error("Unable to initialize atmosphere: image request failed",a);this._readyResolver.reject()})};e.uninitializeRenderContext=function(){this.destroy()};e.render=function(b){if(b.slot!==this.slot||0!==b.pass)return!1;const c=b.rctx,a=this._atmosphereTechnique.program;c.bindProgram(a);this._atmosphereTechnique.bindPipelineState(c);
c.bindTexture(this._texture,0);a.setUniform1i("tex",0);B.View.bindProjectionMatrix(a,b.camera.projectionMatrix);var d=q;u.copy(d,b.camera.viewMatrix);d[12]=0;d[13]=0;d[14]=0;d[15]=1;a.setUniformMatrix4fv("view",q);a.setUniform4f("color",1,1,1,1);b.scenelightingData.setLightDirectionUniform(a);c.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(4,0,this._vaoCount);return!0};e._createVertexArrayObject=function(b){var c=C.createPolySphereGeometry(1,2,!1);const a=c.indices.get("position");
for(var d=0;d<a.length;d+=3){var g=a[d];a[d]=a[d+2];a[d+2]=g}c=c.vertexAttributes.get("position").data;d=r.createBuffer(a.length);g=d.position;for(let f=0;f<a.length;++f){const n=3*a[f];g.set(f,0,c[n]);g.set(f,1,c[n+1]);g.set(f,2,c[n+2])}return new G(b,x.Default3D,{geometry:z.glLayout(r)},{geometry:D.createVertex(b,35044,d.buffer)})};t._createClass(m,[{key:"canRender",get:function(){return null!=this._texture}}]);return m}();const q=v.create(),r=A.newLayout().vec3f("position");return k});