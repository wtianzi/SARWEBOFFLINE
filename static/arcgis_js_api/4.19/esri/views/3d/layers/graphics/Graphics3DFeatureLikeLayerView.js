// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/support/webMercatorUtils ../../../../Graphic ../../../../core/Handles ../../../../core/accessorSupport/diffUtils ../../../../core/watchUtils ../../../../tasks/support/Query ../../../support/WatchUpdatingTracking ./graphicUtils ./constants ./Graphics3DCore ./Graphics3DScaleVisibility ../support/attributeUtils ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates".split(" "),
function(p,e,d,x,P,Q,f,R,y,S,T,U,q,z,r,t,A,u,m,B,C,D,E,F,G,v,H,I,J,K){d=function(w){function l(a){a=w.call(this,a)||this;a._handles=new A;a.watchUpdatingTracking=new C.WatchUpdatingTracking;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}p._inheritsLoose(l,w);var g=l.prototype;g.normalizeCtorArgs=function(a){const b=a.frustumVisibilityEnabled?new J:null,c=a.scaleVisibilityEnabled?new G:null,h=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==
a.layer.geometryType?new I.Graphics3DFilterVisibility:null,k=a.elevationAlignmentEnabled?new H:null,n=new F.Graphics3DCore({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),{updateClippingExtent:L,suspendResumeExtentMode:M,dataExtent:N}=a;return{graphicsCore:n,frustumVisibility:b,scaleVisibility:c,filterVisibility:h,elevationAlignment:k,updateClippingExtent:L,
suspendResumeExtentMode:M,dataExtent:N}};g.initialize=function(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",()=>this.filterVisibility.filterChanged()),this.watchUpdatingTracking.add(this.owner,"timeExtent",()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",
(a,b)=>{u.diff(a,b)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",()=>this.graphicsCore.updateVisibilityInfo());this.watchUpdatingTracking.add(this.layer,"labelingInfo",(a,b)=>{u.diff(a,b)&&this.graphicsCore.updateLabelingInfo()})};g.setup=async function(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const a=this.owner,b=this.owner.view.basemapTerrain,c=(h,k,n)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(h,
k,n);this.scaleVisibility&&this.scaleVisibility.setup(a,this.layer,c,this.graphicsCore,b);this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(a,c,this.graphicsCore,a.view.elevationProvider);this._set("objectStates",new K.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility));this._set("deconfliction",
a.view.deconflictor.addGraphicsOwner(this.graphicsCore));await q.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.watchUpdatingTracking.add(this.layer,"renderer",h=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(h)));this.watchUpdatingTracking.add(a,"fullOpacity",()=>this.graphicsCore.opacityChange());
this.setupSuspendResumeExtent();this.updateClippingExtent&&(this.watchUpdatingTracking.add(a.view,"clippingArea",()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await q.logOnError(this.graphicsCore.updateLabelingInfo())};g.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);var a="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");
for(const b of a)if(a=this[b])a.destroy(),this._set(b,null);this._set("layer",null);this._set("owner",null)};g.maskOccludee=function(a){const {set:b,handle:c}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(b,a.uid);return c};g.highlight=function(a,b){if(a instanceof B){const {set:c,handle:h}=this.objectStates.acquireSet(0,b);this.owner.queryObjectIds(a).then(k=>this.objectStates.setObjectIds(c,k));return h}if("number"===typeof a||"string"===typeof a||a instanceof t)return this.highlight([a],
b);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof t)if(null!=v.attributeLookup(this.layer.fieldsIndex,a[0].attributes,b))a=a.map(c=>v.attributeLookup(this.layer.fieldsIndex,c.attributes,b));else{a=a.map(k=>k.uid);const {set:c,handle:h}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(c,a);return h}if("number"===typeof a[0]||"string"===typeof a[0]){const {set:c,handle:h}=this.objectStates.acquireSet(0,b);this.objectStates.setObjectIds(c,a);return h}}return O};
g._updateClippingExtent=function(){const a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};g.setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(m.init(this,"suspendResumeExtentMode",()=>{this._handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this._handles.add([m.init(this.graphicsCore,
"computedExtent",a=>this.updateSuspendResumeExtent(a)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this._handles.add([m.init(this,"dataExtent",a=>this.updateSuspendResumeExtent(a)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:x.neverReached(this.suspendResumeExtentMode)}}))};g.updateSuspendResumeExtent=
function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};g.extentToSuspendResumeRect=function(a,b){const c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!r.canProject(a,c))return;a=r.project(a,c)}return D.enlargeExtent(a,b,E.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};g.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);
this.scaleVisibility&&this.scaleVisibility.setExtent(a)};p._createClass(l,[{key:"suspended",get:function(){var a;return null==(a=this.scaleVisibility)?void 0:a.suspended}},{key:"suspendInfo",get:function(){var a,b;const c={};null!=(a=this.scaleVisibility)&&a.suspended&&(c.outsideScaleRange=!0);null!=(b=this.frustumVisibility)&&b.suspended&&(c.outsideOfView=!0);return c}},{key:"updating",get:function(){var a,b,c;return!!(null!=(a=this.graphicsCore)&&a.updating||null!=(b=this.frustumVisibility)&&b.updating||
null!=(c=this.watchUpdatingTracking)&&c.updating)}}]);return l}(z);e.__decorate([f.property({aliasOf:"graphicsCore.layer"})],d.prototype,"layer",void 0);e.__decorate([f.property({aliasOf:"graphicsCore.owner"})],d.prototype,"owner",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"updateClippingExtent",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"graphicsCore",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"scaleVisibility",void 0);e.__decorate([f.property({constructOnly:!0})],
d.prototype,"filterVisibility",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"elevationAlignment",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"frustumVisibility",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"deconfliction",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"labeling",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"objectStates",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"watchUpdatingTracking",
void 0);e.__decorate([f.property()],d.prototype,"suspendResumeExtentMode",void 0);e.__decorate([f.property()],d.prototype,"dataExtent",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspended",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspendInfo",null);e.__decorate([f.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],d.prototype,"updating",null);d=e.__decorate([y.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
d);const O={remove(){},pause(){},resume(){}};return d});