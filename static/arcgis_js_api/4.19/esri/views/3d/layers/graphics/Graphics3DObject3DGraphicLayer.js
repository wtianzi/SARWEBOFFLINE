// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./graphicUtils ./featureExpressionInfoUtils".split(" "),function(y,n,v,u,p,z,A,B){function x(g){return g.isVisible?g.params.transparent?1:2:0}let w=function(){function g(a,b,d,k,c,h,l,e=null){this.graphics3DSymbolLayer=a;this.stageObject=b;this._uniqueGeometries=d;this._uniqueMaterials=k;this._uniqueTextures=
c;this.elevationAligner=h;this.elevationContext=l;this._edgeState=e;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.stageObject=b}var f=g.prototype;f.getBSRadius=function(){throw Error("Method not implemented.");};f.initialize=function(a,b){this.stageLayer=b;this.stage=a;a.addMany(this._uniqueMaterials);a.addMany(this._uniqueGeometries);a.addMany(this._uniqueTextures);
a.add(this.stageObject)};f.destroy=function(){var a=this.stage;this.stageLayer&&(a.removeMany(this._uniqueMaterials),a.removeMany(this._uniqueGeometries),a.removeMany(this._uniqueTextures));a.remove(this.stageObject);this._addedToStage&&(this.stageLayer.remove(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};f.layerOpacityChanged=
function(a,b){if(!n.isNone(this._edgeState)){var d=x(this._edgeState.baseMaterial),k=!1;for(const c of this._edgeState.edgeMaterials)c.objectTransparency!==d&&(c.objectTransparency=d,k=!0);k&&this.resetEdgeObject(b);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};f.slicePlaneEnabledChanged=function(a,b){n.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:a},
!b),this._edgeState.properties.slicePlaneEnabled=a)};f.setVisibility=function(a){if(null!=this.stage&&this._visible!==a&&((this._visible=a)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),n.isSome(this._edgeState))){const b=this.stage.renderView.ensureEdgeView();b.hasObject(this.stageObject)?b.updateObjectVisibility(this.stageObject,a):a&&this.addOrUpdateEdgeObject(b,!1)}};f.alignWithElevation=function(a,
b,d,k){null!=this.elevationAligner&&(n.isSome(d)&&B.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(k))};f.getCenterObjectSpace=function(a=v.create()){return u.copy(a,z.getCenter(this.stageObject.getBounds(!0)))};f.getBoundingBoxObjectSpace=function(a=p.create()){var b=this.stageObject;a||(a=p.create());p.setMin(a,b.getBBMin(!0));p.setMax(a,b.getBBMax(!0));
return a};f.computeAttachmentOrigin=function(a){for(const b of this.stageObject.geometryRecords)b.computeAttachmentOrigin(m)&&(u.transformMat4(m,m,this.stageObject.transformation),u.add(a.render.origin,a.render.origin,m),a.render.num++)};f.getProjectedBoundingBox=async function(a,b,d,k,c){c=this.getBoundingBoxObjectSpace(c);var h=C,l=p.isPoint(c)?1:h.length;for(var e=0;e<l;e++){const t=h[e];q[0]=c[t[0]];q[1]=c[t[1]];q[2]=c[t[2]];u.transformMat4(q,q,this.stageObject.transformation);r[3*e]=q[0];r[3*
e+1]=q[1];r[3*e+2]=q[2]}if(!a(r,0,l))return null;p.empty(c);a=null;this.calculateRelativeScreenBounds&&(a=this.calculateRelativeScreenBounds());for(h=0;h<3*l;h+=3){for(e=0;3>e;e++)c[e]=Math.min(c[e],r[h+e]),c[e+3]=Math.max(c[e+3],r[h+e]);a&&d.push({location:r.slice(h,h+3),screenSpaceBoundingRect:a})}if(b&&b.service&&"absolute-height"!==this.elevationContext.mode){p.center(c,m);d="relative-to-scene"===this.elevationContext.mode?"scene":"ground";l=0;if(b.useViewElevation)l=n.unwrapOr(b.service.getElevation(m[0],
m[1],d),0);else try{const t=A.demResolutionForBoundingBox(c,b);l=n.unwrapOr(await b.service.queryElevation(m[0],m[1],k,t,d),0)}catch(t){}p.offset(c,0,0,-this.alignedSampledElevation+l)}return c};f.addObjectState=function(a,b){0===a&&b.addObject(this.stageObject,this.stageObject.highlight());1===a&&b.addObject(this.stageObject,this.stageObject.maskOccludee())};f.removeObjectState=function(a){a.removeObject(this.stageObject)};f.resetEdgeObject=function(a){if(!n.isNone(this._edgeState)){var b=this.stage.renderView.ensureEdgeView();
this._visible?this.addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};f.addOrUpdateEdgeObject=function(a,b){const d=this._edgeState;if(!n.isNone(d)){var k=x(d.baseMaterial);for(const c of d.edgeMaterials)c.objectTransparency=k;a.addOrUpdateObject3D(this.stageObject,d.edgeMaterials,d.properties,!b).then(()=>{var c;return null==(c=this.stageLayer)?void 0:c.commit()})}};y._createClass(g,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},
{key:"visible",get:function(){return this._visible}}]);return g}();(function(g){g=g.VisibilityModes||(g.VisibilityModes={});g[g.REMOVE_OBJECT=0]="REMOVE_OBJECT";g[g.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(w||(w={}));const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=v.create(),m=v.create(),C=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return w});