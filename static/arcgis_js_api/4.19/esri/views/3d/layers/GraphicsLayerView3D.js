// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ./graphics/graphicUtils ./LayerView3D ../../layers/LayerView ./support/projectExtentUtils ./graphics/Graphics3DFrustumVisibility ./graphics/Graphics3DGraphicLikeLayerView".split(" "),
function(l,e,d,m,w,x,f,y,n,z,A,B,h,p,q,r,t,u,v){d=function(k){function g(){var a=k.apply(this,arguments)||this;a.frustumVisibility=new u;a.slicePlaneEnabled=!1;a.drapeSourceType=1;a.suspendResumeExtent=null;a.fullExtentInLocalViewSpatialReference=null;return a}l._inheritsLoose(g,k);var c=g.prototype;c.initialize=function(){this._set("graphics3d",new v({owner:this,layer:this.layer,scaleVisibilityEnabled:!0}));this.graphics3d.setup();this.frustumVisibility.setup(this);this.setupSuspendResumeExtent();
this.updatingHandles.add(this,"fullOpacity",()=>this.graphics3d.graphicsCore.opacityChange());this.handles.add(this.layer.on("graphic-update",b=>this.graphics3d.graphicsCore.graphicUpdateHandler(b)));const a=t.toViewIfLocal(this).then(b=>{this.fullExtentInLocalViewSpatialReference=b});a&&this.addResolvingPromise(a);this.layer.internal?this.notifyChange("updating"):this.handles.add(h.whenTrueOnce(this.view,"basemapTerrain.ready",()=>this.notifyChange("updating")))};c.destroy=function(){this.frustumVisibility&&
(this.frustumVisibility.destroy(),this._set("frustumVisibility",null));this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))};c.fetchPopupFeatures=async function(a,b){return m.isSome(b)?b.clientGraphics:null};c.notifyGraphicGeometryChanged=function(a){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(a)};c.notifyGraphicVisibilityChanged=function(a){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(a)};c.getGraphicFromGraphicUid=function(a){return this.graphics3d.getGraphicFromGraphicUid(a)};
c.whenGraphicBounds=function(a,b){return this.graphics3d.whenGraphicBounds(a,b)};c.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b):null};c.getSymbolLayerSize=function(a,b){return this.graphics3d.getSymbolLayerSize(a,b)};c.queryGraphics=function(){return Promise.resolve(this.loadedGraphics)};c.maskOccludee=function(a){return this.graphics3d.maskOccludee(a)};c.highlight=function(a){return this.graphics3d.highlight(a)};c.canResume=
function(){var a;return k.prototype.canResume.call(this)&&!(null!=(a=this.graphics3d)&&a.suspended)};c.isUpdating=function(){var a,b;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(a=this.view)&&null!=(b=a.basemapTerrain)&&b.ready))};c.setupSuspendResumeExtent=function(){const a=()=>{this.suspendResumeExtent=p.enlargeExtent(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,1.2,this.graphics3d.graphicsCore.extentPadding);
this.frustumVisibility.setExtent(this.suspendResumeExtent)};h.init(this.graphics3d.graphicsCore,"computedExtent",()=>a(),!0);h.watch(this.graphics3d.graphicsCore,"extentPadding",()=>a(),!0)};l._createClass(g,[{key:"legendEnabled",get:function(){return this.canResume()&&!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var a;const b={};m.isSome(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(b.outsideScaleRange=!0);b.outsideOfView=null!=(a=this.frustumVisibility)&&
a.suspended?!0:!1;return b}},{key:"graphics3DGraphics",get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,
nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}}]);return g}(q.LayerView3D(r));e.__decorate([f.property({aliasOf:"layer.graphics"})],d.prototype,"loadedGraphics",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspended",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"legendEnabled",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"updating",void 0);e.__decorate([f.property()],
d.prototype,"layer",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"frustumVisibility",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"graphics3d",void 0);e.__decorate([f.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspendInfo",null);return d=e.__decorate([n.subclass("esri.views.3d.layers.GraphicsLayerView3D")],d)});