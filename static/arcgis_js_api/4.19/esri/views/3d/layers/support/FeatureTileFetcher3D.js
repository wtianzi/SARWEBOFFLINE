// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ../../../../core/MapUtils ../../../../layers/graphics/dehydratedFeatures ../../terrain/tileUtils ./featureReference ./FeatureTile".split(" "),
function(n,C,p,Y,h,M,Z,q,aa,N,ba,ca,da,w,O,P,Q,R,x,D,S,E,T,v,U,F,G){function A(m){return"dummy-tile-full-extent"===m.id}function V(m){let l=0;for(const e of m)e.features&&0<e.features.length&&e.alive&&(l=Math.max(l,e.descriptor.lij[0]));return l}function W(m){m.setFeatures([],0,null);m.featuresMissing=!1;return 4}function H(m){return h.isNone(m)?new Set:new Set(m.map(l=>l.name))}function I(m,l){if(h.isNone(m)||h.isNone(l))return H(l);const e=new Set;for(const {name:a}of l)m.has(a)&&e.add(a);return e}
const J=M.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n.FeatureTileFetcher3D=function(m){function l(a){a=m.call(this,a)||this;a._useTileCount=!1;a.updating=!1;a.updatingTotal=0;a.updatingRemaining=0;a.expectedFeatureDiff=0;a.maximumNumberOfFeaturesExceeded=!1;a.maximumNumberOfFeaturesExceededThrottle=1E3;a._fullRatio=1;a._farRatio=1;a.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};a.handles=new Q;a._frameTask=D.ImmediateTask;a._dirty=!1;a.featureTiles=new Map;a.displayingFeatureReferences=
new Map;a.numDisplayingFeatureReferences=0;a.suspended=!0;a.pendingEdits=null;return a}C._inheritsLoose(l,m);var e=l.prototype;e.initialize=function(){this.handles.add(R.on(this,"tileDescriptors","change",()=>this.setDirty(),()=>this.setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?F.MultiFeatureReference:F.SingleFeatureReference;const a=this.context.scheduler;h.isSome(a)&&(this._frameTask=a.registerTask(D.Task.FEATURE_TILE_FETCHER,
b=>this._process(b),()=>this.updating));this.setDirty()};e.destroy=function(){this._frameTask.remove();this.handles=h.destroyMaybe(this.handles);this.featureTiles.forEach(a=>{this.cancelFetchTile(a);this.removeTile(a)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};e.restart=function(){this.featureTiles.forEach(a=>{this.cancelFetchTile(a);this.clearTile(a);this.resetFetchTile(a)});h.isSome(this.context.memoryCache)&&
this.context.memoryCache.clear();this.setDirty()};e.refetch=function(){this.featureTiles.forEach(a=>{this.cancelFetchTile(a);this.resetFetchTile(a)});h.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};e.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};e.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};e.pause=function(){this.paused&&(this.featureTiles.forEach(a=>this.cancelFetchTile(a)),this.updated())};e.unpause=
function(){this.paused||(this.setDirty(),this.updated())};e.applyEdits=function(a){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:w.createAbortController()},this.pause());const b=this.pendingEdits;b.count++;const c=b.edits.then(()=>a.result.catch(d=>{if(w.isAbortError(d))throw d;return null}).then(d=>d?(this.applyEditsDeleteFeatures(d.deletedFeatures),this.applyEditsAddUpdateFeatures(d.addedFeatures,d.updatedFeatures,b.controller.signal).then(()=>d)):d).then(d=>
{0===--b.count&&(this.pendingEdits===b&&(this.pendingEdits=null),h.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.unpause(),this.updated());return d}));b.edits=c;this.updated();return c};e.applyEditsDeleteFeatures=function(a){if(0!==a.length){var b=new Set;a.forEach(c=>b.add(c.objectId));this.featureTiles.forEach(c=>{if(c.features){var d=c.features.filter(f=>!b.has(v.getObjectId(f,this.objectIdField)));d.length!==c.features.length&&(c.setFeatures(d,0,c.availableFields),this.invalidateCounts())}})}};
e.applyEditsAddUpdateFeatures=async function(a,b,c){const d=[],f=new Set;a.forEach(k=>d.push(k.objectId));b.forEach(k=>{d.push(k.objectId);f.add(k.objectId)});if(0!==d.length){var g=[];this.featureTiles.forEach(k=>{(k=this.applyEditsAddUpdateTile(k,d,f,c))&&g.push(k)});await w.eachAlways(g)}};e.applyEditsAddUpdateTile=async function(a,b,c,d){if(a.features){var f=this.createQuery(a);f.resultType=void 0;f.cacheHint=!1;f.objectIds=b;b=await this.queryFeatures(f,d);d=null;0<c.size&&(f=a.features.filter(g=>
!c.has(v.getObjectId(g,this.objectIdField))),f.length!==a.features.length&&(d=f));if(0<b.features.length){d||(d=a.features.slice());for(const g of b.features)d.push(g)}d&&(a.hasPreciseFeatureCount&&(a.numFeatures=Math.max(a.numFeatures,d.length)),a.setFeatures(d,0,I(a.availableFields,b.fields)),this.invalidateCounts())}};e.queryFeatures=function(a,b){return this.context.query.queryFeaturesDehydrated(a,{signal:b,timeout:6E5})};e.setDirty=function(){this._dirty=!0;this.updated()};e._process=function(a){this._frameTask.processQueue(a);
if(this._dirty&&this.constructed){this._dirty=!1;var b=this.getListOfTiles();this.markTilesNotAlive(b);if(a.run(()=>this.addTiles(b,a))&&a.run(()=>this.filterExtentTiles(b,a))&&a.run(()=>this.removeTiles(b,a))&&!a.done){var c=this.sortTiles(b);a.run(()=>this.displayTiles(c,a))&&a.run(()=>this.fetchTiles(c,a))&&a.run(()=>this.updateMemoryEstimates(c,a))||this.setDirty();this.updated();this.updating||this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}};e.markTilesNotAlive=function(a){for(const b of a)b.alive=
!1};e.addTiles=function(a,b){if(this.suspended)return!1;this.tileDescriptors.forEach(c=>{const d=this.featureTiles.get(c.id);d?d.alive=!0:b.done||(a.push(this.addTile(c)),b.madeProgress())});return b.hasProgressed};e.filterExtentTiles=function(a,b){for(const c of a){if(b.done)break;c.alive&&(c.filtered=!c.intersects(this.filterExtent),c.filtered&&(this.clearTile(c),b.madeProgress()))}return b.hasProgressed};e.removeTiles=function(a,b){for(let c=a.length-1;0<=c&&!b.done;c--){const d=a[c];d.alive||
(this.removeTile(d),c!==a.length-1&&(a[c]=a[a.length-1]),a.pop(),b.madeProgress())}return b.hasProgressed};e.sortTiles=function(a){a.sort((b,c)=>b.descriptor.loadPriority-c.descriptor.loadPriority);return a};e.displayTiles=function(a,b){const c=this.updateRatio(a),d=f=>{const g=1>this._fullRatio?c(f)*this._farRatio:1;f.reduceFeatures(g,this.memoryFactor,this.objectIdField)&&this.setDirty();return this.showTile(f)};for(const f of a)if(!b.run(()=>d(f))){this.setDirty();break}return b.hasProgressed};
e.fetchTiles=function(a,b){if(this.paused)return!1;var c=!1;for(const f of a)if(f.needsFetching){var d=h.isSome(this.context.memoryCache)?this.context.memoryCache.pop(f.id):null;if(h.isSome(d))f.cache=d,this.setDirty(),this.scheduleUpdated(),b.madeProgress();else if(this.needsNumFeatures(f)&&(c=w.createAbortController(),d=this.fetchTileCount(f,c.signal),this._handleRequest(f,d,c,()=>f.numFeatures=G.FAILED_FEATURE_COUNT),c=!0,b.madeProgress()),b.done)return!0}if(c)return b.hasProgressed;for(const f of a)if(f.needsFetching&&
(a=w.createAbortController(),c=this.fetchTile(f,a.signal),this._handleRequest(f,c,a,g=>{f.setFeatures([],0,null);this.invalidateCounts();f.featuresMissing=!1;this.context.logFetchError(J,g)}),b.madeProgress(),b.done))return!0;return b.hasProgressed};e.updateMemoryEstimates=function(a,b){a.some(c=>b.run(()=>c.updateMemoryEstimates())?!1:(this.setDirty(),!0));return b.hasProgressed};e.reclip=function(a,b){if(this.constructed){var c=[];this.featureTiles.forEach(d=>{h.isNone(d.displayingFeatures)||0===
d.displayingFeatures.length||(d.intersectionIncludingBorrowed(b,K),d.intersectionIncludingBorrowed(a,L),x.equals(K,L)||c.push(d))});this.refreshDisplayingFeatures(c);this.updated()}};e.refreshDisplayingFeatures=function(a){const b=new Set,c=this.changes.updates;for(const d of a)if(!h.isNone(d.displayingFeatures))for(const f of d.displayingFeatures)a=v.getObjectId(f,this.objectIdField),b.has(a)||(b.add(a),{feature:a}=this.displayingFeatureReferences.get(a),c.removes.push(a),c.adds.push(a));this.applyChanges()};
e.updated=function(){let a=0;this.paused||this.featureTiles.forEach(c=>c.isFetching?++a:0);var b=this._dirty||0<a||!!this.pendingEdits;this._set("updating",b);if(b){let c=b=0,d=0,f=0,g=0,k=0;const u=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(r=>{++d;if(r.isFetching&&r.hasPreciseFeatureCount){const z=this.maximumFeaturesForTile(r)*(1-r.emptyFeatureRatio),y=h.isSome(r.displayingFeatures)?r.displayingFeatures.length*u:0;k+=z-y}r.needsFetching?
++g:0<r.numFeatures&&(++f,c+=r.numFeatures)});g+=a;let t=0;c?(b=c,t=Math.min(g*c/f,c)):(b=d,t=g);k=Math.min(this.maximumNumberOfFeatures-this.features.length,k);this._set("updatingTotal",b);this._set("updatingRemaining",t);this._set("expectedFeatureDiff",k)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};e.updateMaximumNumberOfFeaturesExceeded=function(){const a=T.someMap(this.featureTiles,b=>b.perTileMaximumNumberOfFeaturesExceeded);
this._set("maximumNumberOfFeaturesExceeded",a)};e.updateRatio=function(a){const b=V(a),c=g=>1/(1<<Math.max(0,b-g.descriptor.lij[0]));let d=0,f=0;for(const g of a)a=g.numFeatures,d+=a,f+=a*c(g);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/f;this.scheduleUpdated();return c};e.maximumFeaturesUpdated=function(a,b){a!==b&&(b>a&&this.featureTiles.forEach(c=>{if(c.featuresMissing){var d=this.maximumFeaturesForTile(c);c.features&&(c.features.length>=
d||5===c.fetchStatus)||(this.cancelFetchTile(c),this.resetFetchTile(c))}}),this.setDirty())};e.addTile=function(a){a=new G.FeatureTile(a);this.featureTiles.set(a.id,a);this.resetFetchTile(a);this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};e.referenceDisplayingFeaturesFromRelatedTiles=function(a){const b=a.descriptor.resolution;this.featureTiles.forEach(c=>{if(!(h.isNone(c.displayingFeatures)||a===c||a.descriptor.lij&&c.descriptor.lij&&!U.tilesAreRelated(a.descriptor.lij,c.descriptor.lij))){h.isNone(a.displayingFeatures)&&
(a.displayingFeatures=[]);a.descriptor.extent&&c.descriptor.extent&&(h.isNone(a.extentIncludingBorrowedFeatures)&&(a.extentIncludingBorrowedFeatures=x.clone(a.descriptor.extent)),x.expand(a.extentIncludingBorrowedFeatures,c.descriptor.extent,a.extentIncludingBorrowedFeatures));for(const d of c.displayingFeatures)a.displayingFeatures.push(d),c=this.displayingFeatureReferences.get(v.getObjectId(d,this.objectIdField)),c.ref(c.feature,b),this.numDisplayingFeatureReferences++}});a.featureLimit=h.isSome(a.displayingFeatures)?
a.displayingFeatures.length:0};e.removeTile=function(a){this.clearTile(a);this.featureTiles.delete(a.id)};e.resetFetchTile=function(a){a.filtered=!a.intersects(this.filterExtent);a.filtered?a.needsFetching&&(a.fetchStatus=4):a.fetchStatus=0};e.cancelFetchTile=function(a){const b=a.requestController;h.isSome(b)&&(a.requestController=null,a.resetFetching(),b.abort())};e.fetchTileCount=async function(a,b){a.numFeatures=await this.fetchCount(a,b);this.updateRatio(this.getListOfTiles());return 3===a.fetchStatus?
1:0};e.fetchTile=async function(a,b){var c=this.maximumFeaturesForTile(a);if(0>=c)return W(a);const d=this.getMaxRecordCount(a);var f=Math.ceil(c/d);if(A(a)||!this.context.capabilities.supportsMaxRecordCountFactor||a.numFeatures<=c&&f>E.MAX_MAX_RECORD_COUNT_FACTOR)return this.fetchPagedTile(a,b);f=this.createQuery(a);f.maxRecordCountFactor=Math.ceil(c/d);a.isRefetching&&a.features&&0<a.features.length&&(f.maxRecordCountFactor=Math.max(Math.ceil(a.features.length/(1-a.emptyFeatureRatio)/d)+1,f.maxRecordCountFactor));
const {features:g,exceededTransferLimit:k,fields:u}=await this.queryFeatures(f,b);c=k?f.maxRecordCountFactor>=E.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5;await this._frameTask.schedule(()=>{a.featuresMissing=g.length<a.numFeatures||k;const t=this._removeEmptyFeatures(g);a.setFeatures(g,t,H(u))},b);this.invalidateCounts();return c};e.fetchCount=async function(a,b){return this.context.query.queryFeatureCount(this.createFeatureCountQuery(a),{signal:b})};e.fetchPagedTile=async function(a,b){let c=0,d=0,f,g=0,
k=this.maximumFeaturesForTile(a)-g;const u=this.getMaxRecordCount(a);let t=null;for(;;){const r=this.createQuery(a),z=this.setPagingParameters(r,c,k,u),{features:y,exceededTransferLimit:B,fields:X}=await this.queryFeatures(r,b);await this._frameTask.schedule(()=>{z&&(c+=h.unwrap(r.num));g+=y.length;d+=this._removeEmptyFeatures(y);a.featuresMissing=c<a.numFeatures||B;f=f?f.concat(y):y;t=I(t,X);a.setFeatures(f,d,t)},b);this.invalidateCounts();this.setDirty();k=this.maximumFeaturesForTile(a)-g;if(!z||
!B||0>=k)return B?4:5}};e.createFeatureCountQuery=function(a){a=this.createQuery(a);this.context.capabilities.supportsCacheHint&&(a.resultType=void 0,a.cacheHint=!0);return a};e.createQuery=function(a){const b=this.context.createQuery(),c=a.descriptor.extent;c&&(b.geometry=x.toExtent(c,this.context.tilingScheme.spatialReference));this.setResolutionParams(b,a);this.useTileQuery(a)?b.resultType="tile":this.context.capabilities.supportsCacheHint&&(b.cacheHint=!0);return b};e.setPagingParameters=function(a,
b,c,d){if(!this.context.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.context.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/d),a.num=Math.min(a.maxRecordCountFactor*d,c)):a.num=Math.min(d);return!0};e.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;const b=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)/this.lodFactor};e.setResolutionParams=
function(a,b){this.supportsResolution&&(b=this.getEffectiveTileResolution(b),null!=b&&(this.context.capabilities.supportsQuantization?a.quantizationParameters=new S({mode:"view",originPosition:"upper-left",tolerance:b,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(a.maxAllowableOffset=b)))};e._removeEmptyFeatures=function(a){const b=a.length;for(let c=0;c<a.length;)v.hasVertices(a[c].geometry)?++c:(a[c]=a[a.length-1],--a.length);return b-a.length};e.needsNumFeatures=function(a){return this.useTileCount&&
a.needsFeatureCount&&!A(a)};e.getMaxRecordCount=function(a){const {tileMaxRecordCount:b,maxRecordCount:c}=this.context;return this.useTileQuery(a)&&h.isSome(b)&&0<b&&this.context.capabilities.supportsResultType?b:h.isSome(c)&&0<c?c:2E3};e.useTileQuery=function(a){return A(a)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};e._handleRequest=function(a,b,c,d){a.fetchStatus=a.needsRefetching?3:2;a.requestController=c;let f=!1;b.then(g=>{a.requestController=
null;a.fetchStatus=g}).catch(g=>{a.requestController===c&&(a.requestController=null,a.fetchStatus=4);w.isAbortError(g)?f=!0:d(g)}).then(()=>{f||this.setDirty();this.scheduleUpdated()})};e.scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(O.schedule(()=>{this.handles.remove("scheduleUpdated");this.updated()}),"scheduleUpdated")};e.showTile=function(a){if(h.isSome(a.displayingFeatures)&&!a.needsDisplayUpdate)return!1;var b=a.features;if(0===a.featureLimit||
!b)return b=h.isSome(a.displayingFeatures)&&0<a.displayingFeatures.length,this.hideTileFeatures(a),a.displayingFeatures=[],b;const c=a.descriptor.resolution,d=this.changes.updates,f=this.changes.adds,g=Math.min(a.featureLimit,b.length);a.featureLimit=g;for(let u=0;u<g;++u){var k=b[u];const t=v.getObjectId(k,this.objectIdField),r=this.displayingFeatureReferences.get(t);r?(k=r.ref(k,c),k.oldVersion!==k.newVersion&&(d.removes.push(k.oldVersion),d.adds.push(k.newVersion))):(this.displayingFeatureReferences.set(t,
new this.FeatureReferenceClass(k,c)),f.push(k));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=b.slice(0,g);return!0};e.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};e.hideTileFeatures=function(a){if(!h.isNone(a.displayingFeatures)){var b=this.changes.updates,c=this.changes.removes;for(const f of a.displayingFeatures){const g=v.getObjectId(f,this.objectIdField);var d=this.displayingFeatureReferences.get(g);d&&((d=d.unref(a.descriptor.resolution),
this.numDisplayingFeatureReferences--,d)?d.oldVersion!==d.newVersion&&(null==d.newVersion?(this.displayingFeatureReferences.delete(g),c.push(d.oldVersion)):(b.adds.push(d.newVersion),b.removes.push(d.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};e.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);
a=this.changes.adds;const b=this.changes.removes,c=Math.min(a.length,b.length);let d=0;for(;d<c;){const f=Math.min(d+200,c);this.features.addMany(a.slice(d,f));this.features.removeMany(b.slice(d,f));d=f}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=0};e.clearTile=function(a){this.hideTile(a);a.features&&h.isSome(this.context.memoryCache)&&this.context.memoryCache.put(a.id,a.cache,16+a.estimatedSize);a.setFeatures(null,
0,null);this.invalidateCounts()};e.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};e.getListOfTiles=function(){return Array.from(this.featureTiles.values())};e.maximumFeaturesForTile=function(a){const b=a.hasPreciseFeatureCount?a.numFeatures:Infinity;return Math.min(Math.ceil((a.hasPreciseFeatureCount?b:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};C._createClass(l,
[{key:"maximumNumberOfFeatures",set:function(a){a=a||Infinity;const b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))}},{key:"memoryFactor",set:function(a){this.memoryFactor!==a&&(this._set("memoryFactor",a),this.setDirty())}},{key:"lodFactor",set:function(a){this.lodFactor!==a&&(this._set("lodFactor",a),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&h.isSome(this.context.query.queryFeatureCount)},
set:function(a){this._useTileCount=a;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let a=0;this.featureTiles.forEach(b=>a+=b.estimatedUnusedSize);return a}},{key:"totalVertices",get:function(){let a=0;this.featureTiles.forEach(b=>a+=b.numVertices);return a}},{key:"totalFeatures",get:function(){let a=0;this.featureTiles.forEach(b=>a+=b.numFeatures);return a}},{key:"filterExtent",set:function(a){if(a&&this.context.tilingScheme&&!a.spatialReference.equals(this.context.tilingScheme.spatialReference))J.error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let a=null;this.featureTiles.forEach(b=>{h.isNone(b.displayingFeatures)||0===b.displayingFeatures.length||(h.isNone(a)?a=new Set(b.availableFields):a.forEach(c=>{b.availableFields.has(c)||
h.unwrap(a).delete(c)}))});return h.isSome(a)?a:new Set}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this.getListOfTiles().reduce((a,b)=>a+(b.features?b.features.length:0),0)}},{key:"test",get:function(){return{process:a=>this._process(a),getFeatureTileById:a=>this.featureTiles.get(a),forEachFeatureTile:a=>this.featureTiles.forEach(a)}}}]);return l}(P);p.__decorate([q.property({constructOnly:!0})],
n.FeatureTileFetcher3D.prototype,"features",void 0);p.__decorate([q.property()],n.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);p.__decorate([q.property({value:Infinity})],n.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);p.__decorate([q.property({value:1})],n.FeatureTileFetcher3D.prototype,"memoryFactor",null);p.__decorate([q.property({value:1})],n.FeatureTileFetcher3D.prototype,"lodFactor",null);p.__decorate([q.property()],n.FeatureTileFetcher3D.prototype,"useTileCount",
null);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"updating",void 0);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",
null);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);p.__decorate([q.property({constructOnly:!0})],n.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"totalVertices",null);p.__decorate([q.property({readOnly:!0})],n.FeatureTileFetcher3D.prototype,"totalFeatures",null);p.__decorate([q.property()],n.FeatureTileFetcher3D.prototype,
"filterExtent",null);p.__decorate([q.property({constructOnly:!0})],n.FeatureTileFetcher3D.prototype,"context",void 0);n.FeatureTileFetcher3D=p.__decorate([N.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],n.FeatureTileFetcher3D);const K=x.create(),L=x.create();p=n.FeatureTileFetcher3D;n.contextCapabilitiesFromLayer=function(m){const l=m.capabilities.query;a:switch(m.geometryType){case "polyline":m=!0;break a;case "polygon":m=m.capabilities&&m.capabilities.query&&m.capabilities.query.supportsQuantization;
break a;default:m=!1}return{supportsMultipleResolutions:m,supportsPagination:!(!l||!l.supportsPagination),supportsResultType:!(!l||!l.supportsResultType),supportsCacheHint:!(!l||!l.supportsCacheHint),supportsQuantization:!(!l||!l.supportsQuantization),supportsQuantizationEditMode:!(!l||!l.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!l||!l.supportsMaxRecordCountFactor),supportsFormatPBF:!(!l||!l.supportsFormatPBF)}};n.default=p;Object.defineProperty(n,"__esModule",{value:!0})});