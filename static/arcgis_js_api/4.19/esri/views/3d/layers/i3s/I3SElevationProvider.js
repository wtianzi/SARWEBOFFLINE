// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../webgl-engine/lib/Intersector".split(" "),
function(w,k,f,x,y,G,r,H,z,I,J,K,A,B,t,l,C,m,D,E){const g=m.empty(),n=D.create(),b=t.create(),p=t.create(),q=t.create(),F=y.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");f=function(v){function u(a){a=v.call(this,a)||this;a.tmpEvent={spatialReference:null,extent:g,context:"scene"};return a}w._inheritsLoose(u,v);var h=u.prototype;h.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new E.Intersector(this.view.state.mode);
this.intersector.options.store=0;const a=this.layerView.i3slayer.fullExtent;this.zmin=a.zmin;this.zmax=a.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};h.getElevation=function(a,e,c,d){b[0]=a;b[1]=e;b[2]=c;if(!this.renderCoordsHelper.toRenderCoords(b,d,b))return F.error("could not project point to compute elevation"),null;e=this.layerView.elevationOffset;a=this.zmin+e;e=this.zmax+e;l.copy(p,b);l.copy(q,b);this.renderCoordsHelper.setAltitude(e,p);this.renderCoordsHelper.setAltitude(a,
q);this.intersector.reset(p,q);this.intersectionHandler.intersect(this.intersector,null,p,q);return this.intersector.results.min.getIntersectionPoint(b)?this.renderCoordsHelper.getAltitude(b):null};h.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};h.objectChanged=function(a){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(a),this.tmpEvent.spatialReference=
this.spatialReference,this.emit("elevation-change",this.tmpEvent))};h.computeObjectExtent=function(a){m.empty(g);this._expandExtent(a,g);return g};h.computeLayerExtent=function(){m.empty(g);for(const a of this.layerView.getVisibleNodes())this._expandExtent(a,g);return g};h._expandExtent=function(a,e){var c=a.visibilityObb||a.serviceObbInRenderSR;if(x.isSome(c))for(C.fromQuat(n,c.quaternion),n[12]=c.center[0],n[13]=c.center[1],n[14]=c.center[2],a=0;8>a;++a)b[0]=a&1?c.halfSize[0]:-c.halfSize[0],b[1]=
a&2?c.halfSize[1]:-c.halfSize[1],b[2]=a&4?c.halfSize[2]:-c.halfSize[2],l.transformMat4(b,b,n),this.renderCoordsHelper.fromRenderCoords(b,b,this.spatialReference),m.expand(e,b);else{var d=a.renderMbs[3];c=l.copy(p,a.renderMbs);c[0]-=d;c[1]-=d;c[2]-=d;a=l.copy(q,a.renderMbs);a[0]+=d;a[1]+=d;a[2]+=d;for(d=0;8>d;++d)b[0]=d&1?c[0]:a[0],b[1]=d&2?c[1]:a[1],b[2]=d&4?c[2]:a[2],this.renderCoordsHelper.fromRenderCoords(b,b,this.spatialReference),m.expand(e,b)}};return u}(B.EventedMixin(A));k.__decorate([r.property({constructOnly:!0})],
f.prototype,"layerView",void 0);k.__decorate([r.property({constructOnly:!0})],f.prototype,"intersectionHandler",void 0);k.__decorate([r.property()],f.prototype,"view",void 0);k.__decorate([r.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],f.prototype,"spatialReference",void 0);return f=k.__decorate([z.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],f)});