// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../../layers/RefreshableLayerView ../terrain/RasterTile ./LayerView3D ./TiledLayerView3D ../../layers/LayerView ../../support/drapedUtils ../../layers/ImageryTileLayerView".split(" "),
function(p,g,f,r,C,D,h,E,t,F,G,H,u,v,w,x,y,z,A,B){f=function(q){function k(){var a=q.apply(this,arguments)||this;a.isAlignedMapTile=!0;return a}p._inheritsLoose(k,q);var e=k.prototype;e.initialize=function(){this.layer.increaseRasterJobHandlerUsage();var a=this.updateFullExtent();this.addResolvingPromise(a);a=u.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{var b=this.view.basemapTerrain.tilingScheme;const {tileInfo:d}=this.layer,c=-1<["png","png24","png32","jpg","mixed"].indexOf(d.format)&&
b.compatibleWith(d);b=(this.isAlignedMapTile=c)?d:b.toTileInfo();this._set("tileInfo",b);this.updatingHandles.add(this,"layer.renderer",()=>this.refresh());this.updatingHandles.add(this,"layer.interpolation",()=>this.refresh());this.updatingHandles.add(this,"layer.bandIds",()=>this.refresh());this.updatingHandles.add(this,"layer.multidimensionalDefinition",()=>this.refresh())});this.addResolvingPromise(a)};e.destroy=function(){this.layer.decreaseRasterJobHandlerUsage();this.view=null};e.fetchTile=
async function(a,b,d,c){const m=this.tileInfo,n=this.layer.symbolizer.canRenderInWebGL;c={tileInfo:m,requestRawData:n,signal:r.unwrap(c.signal),requestAsImageElement:this.isAlignedMapTile};c=await this.layer.fetchTile(a,b,d,c);if(c instanceof HTMLImageElement)return c;let l=c&&c.pixelBlock;if(!l||!n&&(l=await this.layer.applyRenderer(c),null==l))return this._blankTile;b=new w([a,b,d],l,m.size[0],m.size[1]);n&&(b.symbolizerRenderer=this.layer.symbolizer.rendererJSON,b.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(a)),
b.transformGrid=c.transformGrid);b.bandIds=this.layer.bandIds;return b};e._getSymbolizerOptions=function(a){a=this.tileInfo.lodAt(a).resolution;return{pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:a,y:a},bandIds:this.layer.bandIds}};e.ensureSymbolizerParameters=function(a){JSON.stringify(a.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(a.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(a.lij[0])))};
e.createFetchPopupFeaturesQueryGeometry=function(a,b){return A.createQueryGeometry(a,b,this.view)};e.refresh=function(){this.emit("data-changed")};e.doRefresh=async function(a){this.suspended||this.emit("data-changed")};p._createClass(k,[{key:"_blankTile",get:function(){const a=document.createElement("canvas"),b=a.getContext("2d"),[d,c]=this.tileInfo.size;a.width=d;a.height=c;b.clearRect(0,0,d,c);return b.getImageData(0,0,d,c)}},{key:"imageFormatIsOpaque",get:function(){return"jpg"===this.layer.tileInfo.format}},
{key:"hasMixedImageFormats",get:function(){return"mixed"===this.layer.tileInfo.format}},{key:"dataLevelRange",get:function(){const a=this.layer.tileInfo.lods;return this.levelRangeFromScaleRange(this.tileInfo.lods[0].scale,a[a.length-1].scale)}}]);return k}(B.ImageryTileLayerView(v.RefreshableLayerView(y.TiledLayerView3D(x.LayerView3D(z)))));g.__decorate([h.property({readOnly:!0})],f.prototype,"_blankTile",null);g.__decorate([h.property({readOnly:!0})],f.prototype,"imageFormatIsOpaque",null);g.__decorate([h.property({readOnly:!0})],
f.prototype,"hasMixedImageFormats",null);g.__decorate([h.property({readOnly:!0})],f.prototype,"dataLevelRange",null);return f=g.__decorate([t.subclass("esri.views.3d.layers.ImageryTileLayerView3D")],f)});