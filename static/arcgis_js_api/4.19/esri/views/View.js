// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../core/scheduling ../core/Accessor ../geometry/support/spatialReferenceUtils ../geometry/SpatialReference ../geometry/Extent ../core/Evented ../core/Collection ../core/Promise ../core/Loadable ../core/CollectionFlattener ../Map ../TimeExtent ../core/watchUtils ../geometry/HeightModelInfo ../core/HandleOwner ../support/GraphicsCollection ./BasemapView ./LayerViewManager ./Magnifier ./RefreshManager ./input/ViewEvents ./ToolViewManager ./3d/interactive/graphics/AnalysisManager ./input/Input ./navigation/Navigation ./support/DefaultsFromMap".split(" "),
function(h,d,c,z,A,X,e,q,Y,B,r,Z,aa,ba,C,D,E,F,G,u,H,l,I,v,J,K,L,k,M,N,w,O,P,x,Q,R,S,T,U,y,V){var m;const n=A.getLogger("esri.views.View");c=m=function(t){function p(b){var a=t.call(this,b)||this;a._userSpatialReference=null;a._cursor=null;a.allLayerViews=new J({root:h._assertThisInitialized(a),rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:g=>g.layerViews});a.animation=null;a.basemapView=null;a.defaultsFromMap=
new V({view:h._assertThisInitialized(a)});a.fatalError=null;a.extent=null;a.graphics=new w["default"];a.navigating=!1;a.layerViews=new l;a.magnifier=new x;a.padding={left:0,top:0,right:0,bottom:0};a.ready=!1;a.spatialReferenceWarningDelay=1E3;a.supportsGround=!0;a.timeExtent=null;a.type=null;a.scale=null;a.updating=!1;a.initialExtentRequired=!0;a.renderContext=null;a.input=new U;a.navigation=new y;a.layerViewManager=null;a.refreshManager=null;a.isHeightModelInfoRequired=!1;a.width=null;a.height=null;
a.resizing=!1;a.suspended=!1;a.viewEvents=new R.ViewEvents(h._assertThisInitialized(a));a.persistableViewModels=new l;a._isValid=!1;a._readyCycleForced=!1;a.handles.add(a.watch("preconditionsReady",g=>{g?(a._currentSpatialReference=a.spatialReference,m.views.add(h._assertThisInitialized(a))):(a._currentSpatialReference=null,m.views.remove(h._assertThisInitialized(a)));a.notifyChange("spatialReference");!g&&a.ready?(a.layerViewManager.clear(),a.toolViewManager.detach(),a._teardown()):g&&!a.ready&&
(a._startup(),a.toolViewManager.attach())},!0));return a}h._inheritsLoose(p,t);var f=p.prototype;f.initialize=function(){this.addResolvingPromise(this.validate().then(()=>{this._isValid=!0;return k.whenOnce(this,"ready")}));this.basemapView=new O.BasemapView({view:this});this.layerViewManager=new P({view:this,layerViewImporter:{importLayerView:a=>this.importLayerView(a),hasLayerViewModule:a=>this.hasLayerViewModule(a)},supportsGround:this.supportsGround});this.refreshManager=new Q({view:this});this.toolViewManager=
new S({view:this});this.analysisManager=new T.AnalysisManager({viewFactory:a=>this.createAnalysisView(a),controllerFactory:a=>this.createAnalysisController(a)});this._resetInitialViewPropertiesFromContent();let b;k.init(this.defaultsFromMap,"isSpatialReferenceDone",a=>{const g=!!(this.map&&0<this.map.allLayers.length);if((!a||this.spatialReference||!g)&&b)b=null;else if(a&&!this.spatialReference&&g&&!b){const W=b=C.after(this.spatialReferenceWarningDelay);b.then(()=>{W===b&&n.warn("#spatialReference",
"no spatial reference could be derived from the currently added map layers")}).catch(()=>{})}},!0)};f.destroy=function(){if(!this.destroyed){this.viewEvents.destroy();this.allLayerViews.destroy();this.navigation&&(this.navigation.destroy(),this._set("navigation",null));this.graphics.destroy();this.graphics=null;this.handles.remove("defaultsFromMap");this.defaultsFromMap.destroy();this._set("defaultsFromMap",null);this.toolViewManager.destroy();this.toolViewManager=null;this.refreshManager.destroy();
this.refreshManager=null;this.layerViewManager.destroy();this.layerViewManager=null;this.basemapView.destroy();this.basemapView=null;this.invalidate();this._emitter.clear();this.handles.removeAll();var b=this.map;this.map=null;null==b?void 0:b.destroy()}};f._startup=function(){this._set("ready",!0)};f._teardown=function(){this._set("ready",!1)};f.whenReady=function(){return Promise.resolve(this)};f.toMap=function(){n.error("#toMap()","Not implemented on this instance of View");return null};f.whenLayerView=
function(b){return this.layerViewManager.whenLayerView(b)};f.getAnalysisView=function(b){return this.analysisManager.getAnalysisView(b)};f.whenAnalysisView=function(b){return this.analysisManager.whenAnalysisView(b)};f.getDefaultSpatialReference=function(){return this.get("defaultsFromMap.spatialReference")};f.getDefaultHeightModelInfo=function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null};f.importLayerView=function(b){throw new r("importLayerView() not implemented");
};f.hasLayerViewModule=function(b){return!1};f.createAnalysisView=async function(b){throw new r("createAnalysisView() not implemented");};f.createAnalysisController=async function(b){throw new r("createAnalysisController() not implemented");};f.validate=async function(){};f.invalidate=function(){this._isValid=!1};f.isSpatialReferenceSupported=function(b,a,g){return!0};f.isTileInfoRequired=function(){return!1};f.when=function(b,a){this.isResolved()&&!this.ready&&n.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.');
return t.prototype.when.call(this,b,a)};f.forceReadyCycle=function(){this.ready&&(this._readyCycleForced=!0,k.whenFalseOnce(this,"preconditionsReady",()=>this._readyCycleForced=!1))};f.createTool=function(b,a,g){return this.toolViewManager.createTool(b,a,g)};f.tryFatalErrorRecovery=function(){this.fatalError=null};f._resetInitialViewPropertiesFromContent=function(){if(this.defaultsFromMap){var b=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset();this._currentSpatialReference=
null;this.notifyChange("spatialReference");this.handles.remove("defaultsFromMap");this.handles.add([k.watch(this,"spatialReference",(a,g)=>{F.equals(a,g)||b()}),k.watch(this,"initialExtentRequired",b),D.schedule(b)],"defaultsFromMap")}};h._createClass(p,[{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&
this.map&&(!v.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}},{key:"map",set:function(b){var a;const g=this._get("map");b!==g&&(null!=(a=b)&&a.destroyed&&(n.warn("#map","The provided map is already destroyed",
{map:b}),b=null),v.isLoadable(b)&&b.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",b))}},{key:"spatialReference",get:function(){let b=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;b&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(b=b.clone(),b.vcsWkid=this.defaultsFromMap.vcsWkid,b.latestVcsWkid=this.defaultsFromMap.latestVcsWkid);return b},set:function(b){this._userSpatialReference=
b;this._set("spatialReference",b)}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent}},{key:"cursor",get:function(){const b=this.toolViewManager?this.toolViewManager.cursor:null;return z.isSome(b)?b:this._cursor||"default"},set:function(b){this._cursor=b;this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}}]);return p}(N.HandleOwnerMixin(H.EventedMixin(I.EsriPromiseMixin(E))));
c.views=new l;d.__decorate([q.aliasOf("toolViewManager.activeTool")],c.prototype,"activeTool",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"allLayerViews",void 0);d.__decorate([e.property()],c.prototype,"animation",void 0);d.__decorate([e.property()],c.prototype,"basemapView",void 0);d.__decorate([e.property()],c.prototype,"defaultsFromMap",void 0);d.__decorate([e.property()],c.prototype,"fatalError",void 0);d.__decorate([e.property({type:u})],c.prototype,"extent",void 0);d.__decorate([e.property(w.graphicsCollectionProperty())],
c.prototype,"graphics",void 0);d.__decorate([e.property({readOnly:!0,type:M,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],c.prototype,"heightModelInfo",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"interacting",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"navigating",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:"fatalError _isValid _readyCycleForced map map.loaded? width height spatialReference _currentSpatialReference initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone defaultsFromMap.isTileInfoDone".split(" ")})],
c.prototype,"preconditionsReady",null);d.__decorate([e.property({type:l,readOnly:!0})],c.prototype,"layerViews",void 0);d.__decorate([e.property({type:x})],c.prototype,"magnifier",void 0);d.__decorate([e.property({value:null,type:K})],c.prototype,"map",null);d.__decorate([e.property()],c.prototype,"padding",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"ready",void 0);d.__decorate([e.property({type:G})],c.prototype,"spatialReference",null);d.__decorate([e.property()],c.prototype,"spatialReferenceWarningDelay",
void 0);d.__decorate([e.property()],c.prototype,"stationary",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"supportsGround",void 0);d.__decorate([e.property({type:L})],c.prototype,"timeExtent",void 0);d.__decorate([q.aliasOf("toolViewManager.tools")],c.prototype,"tools",void 0);d.__decorate([e.property()],c.prototype,"toolViewManager",void 0);d.__decorate([q.aliasOf("analysisManager.analyses")],c.prototype,"analyses",void 0);d.__decorate([e.property()],c.prototype,"analysisManager",void 0);
d.__decorate([e.property({readOnly:!0})],c.prototype,"type",void 0);d.__decorate([e.property({type:Number})],c.prototype,"scale",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"updating",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"initialExtentRequired",void 0);d.__decorate([e.property({readOnly:!0,type:u})],c.prototype,"initialExtent",null);d.__decorate([e.property()],c.prototype,"cursor",null);d.__decorate([e.property()],c.prototype,"renderContext",void 0);d.__decorate([e.property({readOnly:!0})],
c.prototype,"input",void 0);d.__decorate([e.property({type:y,nonNullable:!0})],c.prototype,"navigation",void 0);d.__decorate([e.property()],c.prototype,"layerViewManager",void 0);d.__decorate([e.property()],c.prototype,"width",void 0);d.__decorate([e.property()],c.prototype,"height",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"resizing",void 0);d.__decorate([e.property({value:null,readOnly:!0})],c.prototype,"size",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"suspended",
void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"viewEvents",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"persistableViewModels",void 0);d.__decorate([e.property()],c.prototype,"_isValid",void 0);d.__decorate([e.property()],c.prototype,"_readyCycleForced",void 0);d.__decorate([e.property()],c.prototype,"_currentSpatialReference",void 0);return c=m=d.__decorate([B.subclass("esri.views.View")],c)});