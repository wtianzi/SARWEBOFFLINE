// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(n,d){n.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(f=>{const x=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&d.isMultiOriginJSONMixin(x)&&x.updateOrigin(f.propName,f.newOrigin)})};Object.defineProperty(n,"__esModule",{value:!0})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(n){n.isMultiOriginJSONMixin=
function(d){return d&&"getAtOrigin"in d&&"originOf"in d};Object.defineProperty(n,"__esModule",{value:!0})})},"esri/support/MapFloorInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ../layers/support/FacilityLayerInfo ../layers/support/LevelLayerInfo ../layers/support/SiteLayerInfo".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h){b=function(q){function k(u){u=q.call(this,u)||this;u.levelLayer=null;u.facilityLayer=null;u.siteLayer=null;return u}n._inheritsLoose(k,q);return k}(y.JSONSupport);d.__decorate([g.property({type:t,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"levelLayer",void 0);d.__decorate([g.property({type:v,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"facilityLayer",void 0);d.__decorate([g.property({type:h,json:{write:!0,origins:{"web-scene":{write:!1}}}})],
b.prototype,"siteLayer",void 0);return b=d.__decorate([p.subclass("esri.support.MapFloorInfo")],b)})},"esri/layers/support/FacilityLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y){b=function(v){function t(h){h=v.call(this,h)||this;h.layerId=null;h.facilityIdField=null;h.siteIdField=null;h.nameField=null;return h}n._inheritsLoose(t,v);return t}(y.JSONSupport);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"layerId",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"facilityIdField",void 0);d.__decorate([g.property({type:String,
json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"siteIdField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"nameField",void 0);return b=d.__decorate([p.subclass("esri.layers.support.FacilityLayerInfo")],b)})},"esri/layers/support/LevelLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y){b=function(v){function t(h){h=v.call(this,h)||this;h.layerId=null;h.levelIdField=null;h.facilityIdField=null;h.longNameField=null;h.shortNameField=null;h.levelNumberField=null;h.verticalOrderField=null;return h}n._inheritsLoose(t,v);return t}(y.JSONSupport);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"layerId",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],
b.prototype,"levelIdField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"facilityIdField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"longNameField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"shortNameField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],
b.prototype,"levelNumberField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"verticalOrderField",void 0);return b=d.__decorate([p.subclass("esri.layers.support.LevelLayerInfo")],b)})},"esri/layers/support/SiteLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y){b=function(v){function t(h){h=v.call(this,h)||this;h.layerId=null;h.siteIdField=null;h.nameField=null;return h}n._inheritsLoose(t,v);return t}(y.JSONSupport);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"layerId",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],b.prototype,"siteIdField",void 0);d.__decorate([g.property({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],
b.prototype,"nameField",void 0);return b=d.__decorate([p.subclass("esri.layers.support.SiteLayerInfo")],b)})},"esri/tasks/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/jsonUtils".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v){b=function(t){function h(q){q=t.call(this,q)||this;q.geometries=null;q.outSpatialReference=null;q.transformation=null;q.transformForward=null;return q}n._inheritsLoose(h,t);h.prototype.toJSON=function(){const q=this.geometries.map(function(L){return L.toJSON()}),k=this.geometries[0],u={};u.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());u.inSR=k.spatialReference.wkid||JSON.stringify(k.spatialReference.toJSON());u.geometries=
JSON.stringify({geometryType:v.getJsonType(k),geometries:q});this.transformation&&(u.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(u.transformForward=this.transformForward);return u};return h}(y.JSONSupport);d.__decorate([g.property()],b.prototype,"geometries",void 0);d.__decorate([g.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);d.__decorate([g.property()],b.prototype,"transformation",void 0);d.__decorate([g.property()],
b.prototype,"transformForward",void 0);return b=d.__decorate([p.subclass("esri.tasks.support.ProjectParameters")],b)})},"esri/webdoc/RangeInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),function(n,
d,b,f,x,g,l,p,z,A,G,y,v){var t;b=t=function(h){function q(k){k=h.call(this,k)||this;k.activeRange=null;k.currentRangeExtent=null;k.fullRangeExtent=null;return k}n._inheritsLoose(q,h);q.prototype.clone=function(){return new t(f.clone({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))};return q}(v.JSONSupport);d.__decorate([l.property({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],
b.prototype,"activeRange",void 0);d.__decorate([l.property({type:[Number],json:{write:!0}})],b.prototype,"currentRangeExtent",void 0);d.__decorate([l.property({type:[Number],json:{write:!0}})],b.prototype,"fullRangeExtent",void 0);return b=t=d.__decorate([z.subclass("esri.webdoc.RangeInfo")],b)})},"esri/webdoc/Widgets":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ./widgets/FloorFilter ./widgets/Range ./widgets/TimeSlider".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h,q){var k;b=k=function(u){function L(B){B=u.call(this,B)||this;B.range=null;B.timeSlider=null;B.floorFilter=null;return B}n._inheritsLoose(L,u);L.prototype.clone=function(){return new k(f.clone({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))};return L}(v.JSONSupport);d.__decorate([l.property({type:h,json:{write:!0}})],b.prototype,"range",void 0);d.__decorate([l.property({type:q,json:{write:!0}})],b.prototype,"timeSlider",void 0);d.__decorate([l.property({type:t,
json:{write:!0}})],b.prototype,"floorFilter",void 0);return b=k=d.__decorate([z.subclass("esri.webdoc.Widgets")],b)})},"esri/webdoc/widgets/FloorFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v){var t;b=t=function(h){function q(k){k=h.call(this,k)||this;k.enabled=!1;k.longNames=!1;k.minimized=!1;k.pinnedLevels=!1;k.site=null;k.facility=null;k.level=null;return k}n._inheritsLoose(q,h);q.prototype.clone=function(){return new t(f.clone({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))};return q}(v.JSONSupport);d.__decorate([l.property({type:Boolean,
json:{read:{source:"enabled"},write:{target:"enabled"}}})],b.prototype,"enabled",void 0);d.__decorate([l.property({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],b.prototype,"longNames",void 0);d.__decorate([l.property({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],b.prototype,"minimized",void 0);d.__decorate([l.property({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],b.prototype,"pinnedLevels",void 0);d.__decorate([l.property({type:String,
json:{read:{source:"site"},write:{target:"site"}}})],b.prototype,"site",void 0);d.__decorate([l.property({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],b.prototype,"facility",void 0);d.__decorate([l.property({type:String,json:{read:{source:"level"},write:{target:"level"}}})],b.prototype,"level",void 0);return b=t=d.__decorate([z.subclass("esri.webdoc.widgets.FloorFilter")],b)})},"esri/webdoc/widgets/Range":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y){var v;b=new l.JSONMap({slider:"slider",picker:"picker"});y=v=function(t){function h(q){q=t.call(this,q)||this;q.interactionMode=null;q.numStops=null;q.stopInterval=null;return q}n._inheritsLoose(h,t);h.prototype.clone=function(){return new v({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})};return h}(y.JSONSupport);d.__decorate([g.property({type:b.apiValues,nonNullable:!0,json:{type:b.jsonValues,default:null,read:{reader:b.read},
write:{isRequired:!0,writer:b.write}}})],y.prototype,"interactionMode",void 0);d.__decorate([g.property({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=null!=this.stopInterval;return{enabled:!t,isRequired:!t}}}}})],y.prototype,"numStops",void 0);d.__decorate([g.property({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],y.prototype,"stopInterval",void 0);return y=v=d.__decorate([p.subclass("esri.webdoc.widgets.Range")],
y)})},"esri/webdoc/widgets/TimeSlider":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/object ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../TimeExtent ../../TimeInterval".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h,q,k,u){var L;b=L=function(B){function E(r){r=B.call(this,r)||this;r.currentTimeExtent=null;r.fullTimeExtent=null;r.loop=!1;r.numStops=null;r.numThumbs=null;r.stopDelay=null;r.stopInterval=null;r.stops=null;return r}n._inheritsLoose(E,B);var H=E.prototype;H.readCurrentTimeExtent=function(r){if(r)return new k({start:null!=r[0]?new Date(r[0]):null,end:null!=r[1]?new Date(r[1]):null})};H.writeCurrentTimeExtent=function(r,F,J){r&&x.setDeepValue(J,[r.start?r.start.getTime():
null,r.end?r.end.getTime():null],F)};H.readFullTimeExtent=function(r,F){if(r=F.properties)return new k({start:null!=r.startTime?new Date(r.startTime):null,end:null!=r.endTime?new Date(r.endTime):null})};H.writeFullTimeExtent=function(r,F){if(r){F=F.properties=F.properties||{};var J=r.end;r=r.start;J&&(F.endTime=J?J.getTime():null);r&&(F.startTime=r?r.getTime():null)}};H.readStopInterval=function(r,F,J){return r?u.fromJSON({value:r.interval,unit:r.units},J):null};H.writeStopInterval=function(r,F,J,
D){r&&(r=r.toJSON(D),x.setDeepValue(J,{interval:r.value,units:r.unit},F))};H.readStops=function(r){return r&&r.length?r.map(F=>new Date(F)):null};H.writeStops=function(r,F,J){r&&r.length&&x.setDeepValue(J,r.map(D=>D.getTime()),F)};H.clone=function(){return new L(f.clone({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))};return E}(q.JSONSupport);
d.__decorate([p.property({type:k,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],b.prototype,"currentTimeExtent",void 0);d.__decorate([A.reader("currentTimeExtent")],b.prototype,"readCurrentTimeExtent",null);d.__decorate([y.writer("currentTimeExtent")],b.prototype,"writeCurrentTimeExtent",null);d.__decorate([p.property({type:k,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],
b.prototype,"fullTimeExtent",void 0);d.__decorate([A.reader("fullTimeExtent")],b.prototype,"readFullTimeExtent",null);d.__decorate([y.writer("fullTimeExtent")],b.prototype,"writeFullTimeExtent",null);d.__decorate([p.property({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],b.prototype,"loop",void 0);d.__decorate([p.property({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var B;
const E=!!this.stopInterval,H=!(null==(B=this.stops)||!B.length);B=!(E||H);return{enabled:B,isRequired:B}}}}})],b.prototype,"numStops",void 0);d.__decorate([p.property({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],b.prototype,"numThumbs",void 0);d.__decorate([p.property({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],b.prototype,
"stopDelay",void 0);d.__decorate([p.property({type:u,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var B;const E=null!=this.numStops,H=!(null==(B=this.stops)||!B.length);return{enabled:!H,isRequired:!(E||H)}}}}})],b.prototype,"stopInterval",void 0);d.__decorate([A.reader("stopInterval")],b.prototype,"readStopInterval",null);d.__decorate([y.writer("stopInterval")],b.prototype,"writeStopInterval",null);d.__decorate([p.property({type:[Date],
json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],b.prototype,"stops",void 0);d.__decorate([A.reader("stops")],b.prototype,"readStops",null);d.__decorate([y.writer("stops")],b.prototype,"writeStops",null);return b=L=d.__decorate([G.subclass("esri.webdoc.widgets.TimeSlider")],b)})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(n){const d={width:600,height:400};n.getOptimalThumbnailSize=
function(b,f){f=f||d;let {width:x,height:g}=f;f=x/g;1.5>f?g=x/1.5:1.5<f&&(x=1.5*g);x>b.width&&(g*=b.width/x,x=b.width);g>b.height&&(x*=b.height/g,g=b.height);return{width:Math.round(x),height:Math.round(g)}};Object.defineProperty(n,"__esModule",{value:!0})})},"esri/webmap/ApplicationProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ../webdoc/applicationProperties/Viewing".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t){var h;b=h=function(q){function k(u){u=q.call(this,u)||this;u.editing=null;u.offline=null;u.viewing=null;return u}n._inheritsLoose(k,q);k.prototype.clone=function(){return new h(f.clone({editing:this.editing,offline:this.offline,viewing:this.viewing}))};return k}(v.JSONSupport);d.__decorate([l.property({json:{write:!0}})],b.prototype,"editing",void 0);d.__decorate([l.property({json:{write:!0}})],b.prototype,"offline",void 0);d.__decorate([l.property({type:t,json:{write:!0}})],
b.prototype,"viewing",void 0);return b=h=d.__decorate([z.subclass("esri.webmap.ApplicationProperties")],b)})},"esri/webdoc/applicationProperties/Viewing":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ./Search".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t){var h;b=h=function(q){function k(u){u=q.call(this,u)||this;u.search=null;return u}n._inheritsLoose(k,q);k.prototype.clone=function(){return new h(f.clone({search:this.search}))};return k}(v.JSONSupport);d.__decorate([l.property({type:t,json:{write:!0}})],b.prototype,"search",void 0);return b=h=d.__decorate([z.subclass("esri.webdoc.applicationProperties.Viewing")],b)})},"esri/webdoc/applicationProperties/Search":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../core/Collection ../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils ./SearchLayer ./SearchTable".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h,q,k,u,L){var B;const E=q.ofType(u),H=q.ofType(L);b=B=function(r){function F(D){D=r.call(this,D)||this;D.addressSearchEnabled=!0;D.enabled=!0;D.hintText=null;D.layers=new E;D.tables=new H;return D}n._inheritsLoose(F,r);var J=F.prototype;J.readAddressSearchEnabled=function(D){return!D};J.writeAddressSearchEnabled=function(D,P,I){P[I]=!D};J.clone=function(){return new B(f.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,
layers:this.layers,tables:this.tables}))};return F}(h.JSONSupport);d.__decorate([l.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"addressSearchEnabled",void 0);d.__decorate([z.reader("addressSearchEnabled")],b.prototype,"readAddressSearchEnabled",null);d.__decorate([G.writer("addressSearchEnabled")],b.prototype,"writeAddressSearchEnabled",null);d.__decorate([l.property({type:Boolean,
nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],b.prototype,"enabled",void 0);d.__decorate([l.property({type:String,json:{write:!0}})],b.prototype,"hintText",void 0);d.__decorate([l.property({type:E,json:{write:{overridePolicy:k.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],b.prototype,"layers",void 0);d.__decorate([l.property({type:H,json:{read:!0,write:{overridePolicy:k.writeNonEmptyCollectionPolicy},
origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"tables",void 0);return b=B=d.__decorate([A.subclass("esri.webdoc.applicationProperties.Search")],b)})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(n){n.writeNonEmptyCollectionPolicy=function(d){return{enabled:!(null==d||!d.length)}};Object.defineProperty(n,"__esModule",{value:!0})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ./SearchLayerField".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t){var h;b=h=function(q){function k(u){u=q.call(this,u)||this;u.field=null;u.id=null;u.subLayer=null;return u}n._inheritsLoose(k,q);k.prototype.clone=function(){return new h(f.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};return k}(v.JSONSupport);d.__decorate([l.property({type:t,json:{write:{isRequired:!0}}})],b.prototype,"field",void 0);d.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"id",void 0);d.__decorate([l.property({type:g.Integer,
json:{write:!0}})],b.prototype,"subLayer",void 0);return b=h=d.__decorate([z.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../layers/support/fieldType".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v){var t;b=t=function(h){function q(k){k=h.call(this,k)||this;k.exactMatch=!1;k.name=null;k.type=null;return k}n._inheritsLoose(q,h);q.prototype.clone=function(){return new t({exactMatch:this.exactMatch,type:this.type,name:this.name})};return q}(y.JSONSupport);d.__decorate([g.property({type:Boolean,json:{write:!0}})],b.prototype,"exactMatch",void 0);d.__decorate([g.property({type:String,json:{write:!0}})],b.prototype,"name",void 0);d.__decorate([l.enumeration(v.kebabDict)],
b.prototype,"type",void 0);return b=t=d.__decorate([p.subclass("esri.webdoc.applicationProperties.SearchLayerField")],b)})},"esri/webdoc/applicationProperties/SearchTable":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ./SearchTableField".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t){var h;b=h=function(q){function k(u){u=q.call(this,u)||this;u.field=null;u.id=null;return u}n._inheritsLoose(k,q);k.prototype.clone=function(){return new h(f.clone({field:this.field,id:this.id}))};return k}(v.JSONSupport);d.__decorate([l.property({type:t,json:{write:{isRequired:!0}}})],b.prototype,"field",void 0);d.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"id",void 0);return b=h=d.__decorate([z.subclass("esri.webdoc.applicationProperties.SearchTable")],
b)})},"esri/webdoc/applicationProperties/SearchTableField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../layers/support/fieldType".split(" "),function(n,
d,b,f,x,g,l,p,z,A,G,y,v){var t;b=t=function(h){function q(k){k=h.call(this,k)||this;k.exactMatch=!1;k.name=null;k.type=null;return k}n._inheritsLoose(q,h);q.prototype.clone=function(){return new t({exactMatch:this.exactMatch,type:this.type,name:this.name})};return q}(y.JSONSupport);d.__decorate([g.property({type:Boolean,json:{write:!0}})],b.prototype,"exactMatch",void 0);d.__decorate([g.property({type:String,json:{write:!0}})],b.prototype,"name",void 0);d.__decorate([l.enumeration(v.kebabDict)],b.prototype,
"type",void 0);return b=t=d.__decorate([p.subclass("esri.webdoc.applicationProperties.SearchTableField")],b)})},"esri/webmap/Bookmark":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/deprecate ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ../geometry/Extent ../core/Identifiable ../Viewpoint ../webdoc/support/Thumbnail".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h,q,k,u,L,B,E,H){var r;const F=g.getLogger("esri.webmap.Bookmark");b=r=function(J){function D(I){I=J.call(this,I)||this;I.name=null;I.thumbnail=new H;return I}n._inheritsLoose(D,J);var P=D.prototype;P.castThumbnail=function(I){return"string"===typeof I?new H({url:I}):l.ensureType(H,I)};P.readViewpoint=function(I,Q){const {extent:U,viewpoint:Z}=Q;return E.fromJSON(Z||{targetGeometry:U})};P.clone=function(){return new r(f.clone({name:this.name,thumbnail:this.thumbnail,
viewpoint:this.viewpoint}))};n._createClass(D,[{key:"extent",set:function(I){A.deprecatedProperty(F,"extent",{replacement:"viewpoint",version:"4.17"});this._set("viewpoint",new E({targetGeometry:I.clone()}));this._set("extent",I)}},{key:"viewpoint",set:function(I){const Q=I.targetGeometry;x.isNone(Q)||"extent"!==Q.type?(I=new t("invalid-viewpoint","'viewpoint.targetGeometry' should be an extent",{viewpoint:I}),F.error(I)):(this._set("extent",Q.clone()),this._set("viewpoint",I))}}]);return D}(B.IdentifiableMixin(u.JSONSupport));
d.__decorate([p.property({type:L,nonNullable:!0,json:{read:!1,write:{isRequired:!0}}})],b.prototype,"extent",null);d.__decorate([p.property({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],b.prototype,"name",void 0);d.__decorate([p.property({type:H,json:{write:{overridePolicy(J){return{enabled:!(!J||!J.url)}}}}})],b.prototype,"thumbnail",void 0);d.__decorate([z.cast("thumbnail")],b.prototype,"castThumbnail",null);d.__decorate([p.property({type:E,nonNullable:!0,json:{write:!0}})],b.prototype,
"viewpoint",null);d.__decorate([y.reader("viewpoint",["extent","viewpoint"])],b.prototype,"readViewpoint",null);return b=r=d.__decorate([v.subclass("esri.webmap.Bookmark")],b)})},"esri/webdoc/support/Thumbnail":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y){var v;b=v=function(t){function h(){var k=t.apply(this,arguments)||this;k.url="";return k}n._inheritsLoose(h,t);var q=h.prototype;q.destroy=function(){this.url=""};q.clone=function(){return new v({url:this.url})};return h}(y.JSONSupport);d.__decorate([g.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"url",void 0);return b=v=d.__decorate([p.subclass("esri.webdoc.support.Thumbnail")],b)})},"esri/webmap/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../Color".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t){var h;b=h=function(q){function k(u){u=q.call(this,u)||this;u.color=new t([0,0,0,1]);return u}n._inheritsLoose(k,q);k.prototype.clone=function(){return new h(f.clone({color:this.color}))};return k}(v.JSONSupport);d.__decorate([l.property({type:t,json:{write:!0}})],b.prototype,"color",void 0);return b=h=d.__decorate([z.subclass("esri.webmap.background.ColorBackground")],b)})},"esri/webmap/InitialViewProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/Accessor ../geometry/SpatialReference ../Viewpoint ../webdoc/RangeInfo ./background/ColorBackground".split(" "),
function(n,d,b,f,x,g,l,p,z,A,G,y,v,t,h,q,k){var u;b=u=function(L){function B(E){E=L.call(this,E)||this;E.background=null;E.rangeInfo=null;E.spatialReference=null;E.viewpoint=null;return E}n._inheritsLoose(B,L);B.prototype.clone=function(){return new u(f.clone({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))};return B}(v);d.__decorate([l.property({type:k})],b.prototype,"background",void 0);d.__decorate([l.property({type:q})],b.prototype,
"rangeInfo",void 0);d.__decorate([l.property({type:t})],b.prototype,"spatialReference",void 0);d.__decorate([l.property({type:h})],b.prototype,"viewpoint",void 0);return b=u=d.__decorate([z.subclass("esri.webmap.InitialViewProperties")],b)})},"esri/webmap/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../core/Version"],function(n,d,b){b=function(f){function x(g,l){return f.call(this,g,l,"webmap")||this}d._inheritsLoose(x,f);return x}(b.Version);n.Version=b;n.default=
b;Object.defineProperty(n,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(n,d){let b=function(){function f(g,l,p=""){this.major=g;this.minor=l;this._context=p}var x=f.prototype;x.lessThan=function(g,l){return this.major<g||g===this.major&&this.minor<l};x.since=function(g,l){return!this.lessThan(g,l)};x.validate=function(g){if(this.major!==g.major)throw new d((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+
" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:g});};x.clone=function(){return new f(this.major,this.minor,this._context)};f.parse=function(g,l=""){const [p,z]=g.split(".");var A=/^\s*\d+\s*$/;if(!p||!p.match||!p.match(A))throw new d((l&&l+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!z||!z.match||!z.match(A))throw new d((l&&l+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:g});g=parseInt(p,10);A=parseInt(z,10);return new f(g,A,l)};return f}();n.Version=b;Object.defineProperty(n,"__esModule",{value:!0})})},"*noref":1}});
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/has ./core/maybe ./core/Logger ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/property ./core/jsonMap ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/Error ./core/urlUtils ./core/uuid ./portal/support/resourceExtension ./core/arrayUtils ./core/promiseUtils ./core/accessorSupport/read ./geometry/SpatialReference ./geometry/support/webMercatorUtils ./core/Collection ./kernel ./core/Promise ./core/Loadable ./portal/Portal ./core/loadAll ./portal/PortalItem ./webdoc/support/writeUtils ./support/basemapUtils ./Map ./Viewpoint ./core/MultiOriginJSONSupport ./core/watchUtils ./core/accessorSupport/originUtils ./layers/support/arcgisLayerUrl ./portal/support/portalItemUtils ./support/MapFloorInfo ./tasks/support/ProjectParameters ./webdoc/RangeInfo ./webdoc/Widgets ./webdoc/support/thumbnailUtils ./webmap/ApplicationProperties ./webmap/Bookmark ./webmap/background/ColorBackground ./webmap/InitialViewProperties ./webmap/Version".split(" "),function(n,
d,b,f,x,g,l,p,z,A,G,y,v,t,h,q,k,u,L,B,E,H,r,F,J,D,P,I,Q,U,Z,V,aa,fa,ha,ia,K,ja,ba,ca,ka,la,ma,na,da,W,R){const X=new R.Version(2,20),ea=H.ofType(na),Y=g.getLogger("esri.WebMap"),S=new Map;S.set("image/jpeg","jpeg");S.set("image/jpg","jpg");S.set("image/png","png");S.set("image/gif","gif");const oa="NatGeo_World_Map Ocean_Basemap USA_Topo_Maps World_Imagery World_Street_Map World_Terrain_Base World_Topo_Map World_Hillshade Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Reference_Overlay Reference/World_Transportation".split(" ").map(N=>
N.toLowerCase());f=function(N){function T(a){a=N.call(this,a)||this;a.applicationProperties=null;a.bookmarks=new ea;a.floorInfo=null;a.initialViewProperties=new W;a.portalItem=null;a.presentation=null;a.sourceVersion=null;a.widgets=null;a.authoringApp=a.authoringAppVersion=null;a._isAuthoringAppSetByUser=a._isAuthoringAppVersionSetByUser=!1;return a}d._inheritsLoose(T,N);var m=T.prototype;m.destroy=function(){const a=this.portalItem;this.portalItem=null;null==a?void 0:a.destroy()};m.initialize=function(){this.when().catch(a=>
{Y.error("#load()","Failed to load web map",a)});if(this.resourceInfo){let a;try{a=this._validateJSON(this.resourceInfo)}catch(c){this.addResolvingPromise(Promise.reject(c));return}this.read(a)}};m.writeAuthoringApp=function(a,c){c.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};m.writeAuthoringAppVersion=function(a,c){c.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:r.version};m.readInitialViewProperties=function(a,c){var e;a=new W;c.background&&(a.background=
da.fromJSON(c.background));const w=null==(e=c.initialState)?void 0:e.viewpoint;w&&(w.rotation&&R.Version.parse(c.version||"","webmap").lessThan(2,20)&&"ArcGIS Pro"===c.authoringApp&&(w.rotation*=-1),a.viewpoint=V.fromJSON(w));c.mapRangeInfo&&(a.rangeInfo=ca.fromJSON(c.mapRangeInfo));c.spatialReference&&(a.spatialReference=B.fromJSON(c.spatialReference));return a};m.writeInitialViewProperties=function(a,c,e,w){a&&((e=a.background)&&e.color&&(c.background=e.write(null,w)),a.viewpoint&&(c.initialState=
{viewpoint:a.viewpoint.write(null,w)}),a.rangeInfo&&(c.mapRangeInfo=a.rangeInfo.toJSON(w)),a.spatialReference&&(c.spatialReference=a.spatialReference.write(null,w)))};m.writeLayers=function(a,c,e,w){c[e]=this._writeLayers(a,w,"operational-layers")};m.readSourceVersion=function(a,c){const [e,w]=c.version.split(".");return new R.Version(parseInt(e,10),parseInt(w,10))};m.writeSourceVersion=function(a,c,e){c[e]=`${X.major}.${X.minor}`};m.writeTables=function(a,c,e,w){a=this._writeLayers(a,w,"tables");
a.length&&(c[e]=a)};m.load=function(a){this.addResolvingPromise(this._loadFromSource());return Promise.resolve(this)};m.loadAll=function(){return P.loadAll(this,a=>{a(this.ground,this.basemap,this.layers,this.tables)})};m.read=function(a,c){c={...c,origin:"web-map"};const e=this._getAuthoringPropsState();L.readLoadable(this,a,w=>N.prototype.read.call(this,a,w),c);this._restoreAuthoringPropsFromState(e)};m.write=function(a,c){if("loaded"!==this.loadStatus)throw a=new v("webmap:not-loaded","Web map must be loaded before it can be serialized"),
Y.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),a;this._removeDanglingLayerRefs();c={...c,origin:"web-map",restrictedWebMapWriting:!0,webmap:this};return N.prototype.write.call(this,a,c)};m.save=async function(a){a=a||{};this._validateItem();await this._updateFromPromise;await this.load();await this._loadLayerContainers();await this._beforeSave();this._validateMap();const c=this.portalItem,e={origin:"web-map",messages:[],writtenProperties:[],
url:c.itemUrl&&t.urlToObject(c.itemUrl),portal:c.portal||D.getDefault()},w=this.write(null,e);this._validateJSONForWriting(e,a);await this._updateItemProperties(c);await this._updateItem(c,w,e);await this._updateItemThumbnail();return c};m.saveAs=async function(a,c){c=c||{};a=this._getPortalItem(a);await this._updateFromPromise;await this.load();await this._loadLayerContainers();await this._beforeSave();this._validateMap();const e={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:a.portal},
w=this.write(null,e);this._validateJSONForWriting(e,c);await this._updateItemPropertiesForSaveAs(a);const C=this._getThumbnailState();await this._createItem(a,w,e,c);this._restoreThumbnailFromState(C);await this._updateItemThumbnail();return a};m.updateFrom=async function(a,c){this._updateFromPromise=a=this._updateFromInternal(a,c);await a;a===this._updateFromPromise&&(this._updateFromPromise=null)};m.getLayerJSONFromResourceInfo=function(a){var c,e,w,C;const M=this.resourceInfo;return this._collectAllLayersJSON(k.flatten([null==
M?void 0:null==(c=M.baseMap)?void 0:c.baseMapLayers,null==M?void 0:M.operationalLayers,null==(e=this.basemap)?void 0:null==(w=e.resourceInfo)?void 0:null==(C=w.data)?void 0:C.baseMapLayers])).find(O=>O.id===a.id)};m._collectAllLayersJSON=function(a){return a.reduce((c,e)=>{c.push(e);"GroupLayer"===e.layerType&&(c=c.concat(this._collectAllLayersJSON(e.layers||[])));return c},[])};m._writeLayers=function(a,c,e){c={...c,layerContainerType:e};return a.map(w=>x.unwrap(Q.getLayerJSON(w,"tables"===e?null:
this.getLayerJSONFromResourceInfo(w),c))).filter(Boolean).toArray()};m._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve(null)};m._loadFromItem=function(a){return a.load().catch(c=>{throw new v("webmap:load-portal-item","Failed to load portal item",{error:c});}).then(()=>{if("Web Map"!==a.type)throw new v("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",
{type:a.type});}).then(()=>a.fetchData()).then(c=>{this.resourceInfo=c;return this._readAndLoadFromJSON(c,{origin:"web-map",portal:a.portal||D.getDefault()})}).then(()=>this._computeInitialViewpoint())};m._readAndLoadFromJSON=function(a,c){a=this._validateJSON(a);this.read(a,c);return this._loadFromJSON(a,c)};m._validateJSON=function(a){const c=R.Version.parse(a.version||"","webmap");X.validate(c);a.version=`${c.major}.${c.minor}`;return a};m._loadFromJSON=function(a,c){const e={context:{...c,layerContainerType:"operational-layers"}};
this.portalItem&&(e.context.portal=this.portalItem.portal||D.getDefault());return(new Promise(function(w,C){n(["./layers/support/layersCreator"],w,C)})).then(({populateOperationalLayers:w})=>{const C=[];var M=a.operationalLayers;M&&M.length&&C.push(w(this.layers,M,e));M={...e,context:{...e.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"};const O=a.tables;O&&O.length&&C.push(w(this.tables,O,M));return u.eachAlways(C).then(()=>{})})};m._computeInitialViewpoint=async function(){var a,
c;let e=this.initialViewProperties;!(null==(a=e)?0:null==(c=a.viewpoint)?0:c.targetGeometry)&&(a=await this._getExtentFromItem())&&(e=e?e.clone():new W,e.viewpoint=new V,e.viewpoint.targetGeometry=a,this.initialViewProperties=e)};m._getExtentFromItem=async function(){var a,c;const e=null==(a=this.initialViewProperties)?void 0:a.spatialReference,w=null==(c=this.portalItem)?void 0:c.extent;return e&&w?e.isWGS84?w.clone():e.isWebMercator?E.geographicToWebMercator(w):(await new Promise(function(C,M){n(["./portal/support/geometryServiceUtils"],
C,M)})).create(this.portalItem).then(C=>{const M=new ba;M.geometries=[w];M.outSpatialReference=e;return C.project(M)}).then(C=>C[0]).catch(C=>{Y.error("Error projecting item's extent:",C);return null}):null};m._removeDanglingLayerRefs=function(){var a=this.applicationProperties,c=a&&a.viewing&&a.viewing.search;const e=w=>!!this.allLayers.find(C=>C.id===w);c&&c.layers&&(c.layers=c.layers.filter(w=>e(w.id)));c&&c.tables&&(c.tables=c.tables.filter(w=>!!this.tables.find(C=>C.id===w.id)));(c=a&&a.editing&&
a.editing.locationTracking)&&c.info&&!e(c.info.layerId)&&(a.editing=null);(a=this.presentation&&this.presentation.slides)&&a.forEach(w=>{w.visibleLayers&&(w.visibleLayers=w.visibleLayers.filter(C=>e(C.id)))})};m._validateMap=function(){if(!this.basemap||!this.basemap.baseLayers.length)throw new v("webmap:save","Map does not have a valid basemap with a base layer.");};m._validateItem=function(){if(!this.portalItem)throw Y.error("save: requires the portalItem property to be set"),new v("webmap:portal-item-not-set",
"Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem)};m._validateItemType=function(a){if("Web Map"!==a.type)throw new v("webmap:portal-item-wrong-type",'Portal item needs to have type "Web Map"');};m._loadLayerContainers=function(){const a=[];this.basemap&&a.push(this.basemap.load());this.ground&&a.push(this.ground.load());return u.eachAlways(a).then(()=>{})};m._beforeSave=async function(){const a=[];for(const c of this.allLayers)if("beforeSave"in c&&"function"===
typeof c.beforeSave){const e=c.beforeSave();e&&a.push(e)}await u.eachAlways(a)};m._loadAllLayers=function(){const a=this._getAllLayersAndTables().map(c=>c.load());return u.eachAlways(a).then(()=>{})};m._getAllLayersAndTables=function(){return this.allLayers.concat(this.allTables)};m._validateJSONForWriting=function(a,c){a=a.messages.filter(e=>"error"===e.type).map(e=>new v(e.name,e.message,e.details));c.ignoreUnsupported&&(a=a.filter(e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&
"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name));if(0<a.length)throw new v("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a});};m._updateItemProperties=async function(a){a.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry);await this._updateTypeKeywords(a)};m._updateItemPropertiesForSaveAs=async function(a){K.removeTypeKeyword(a,
"CollectorDisabled");K.removeTypeKeyword(a,"OfflineDisabled");K.removeTypeKeyword(a,"Workforce Project");K.removeTypeKeyword(a,"Workforce Worker");K.removeTypeKeyword(a,"Workforce Dispatcher");K.removeTypeKeyword(a,"Offline Map Areas");K.removeTypeKeyword(a,"FieldMapsDisabled");await this._updateItemProperties(a)};m._getWGS84Extent=async function(a){a=a.clone().normalize();let c;if(1<a.length)for(const e of a)c?e.width>c.width&&(c=e):c=e;else c=a[0];return this._projectToWGS84(c)};m._projectToWGS84=
async function(a){var c=a.spatialReference;if(c.isWGS84)return a.clone();if(c.isWebMercator)return E.webMercatorToGeographic(a);c=await (await new Promise(function(w,C){n(["./portal/support/geometryServiceUtils"],w,C)})).create(this.portalItem);const e=new ba;e.geometries=[a];e.outSpatialReference=B.WGS84;return(await c.project(e))[0]};m._updateTypeKeywords=async function(a){K.addTypeKeyword(a,"ArcGIS API for JavaScript");await this._loadAllLayers();this._evalCollectorKeyword(a);this._evalDataEditingKeyword(a);
this._evalOfflineKeyword(a);this._evalDeveloperBasemapKeyword(a);a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter((c,e,w)=>w.indexOf(c)===e))};m._evalCollectorKeyword=function(a){K.hasTypeKeyword(a,"CollectorDisabled")||K.hasTypeKeyword(a,"Workforce Project")||K.hasTypeKeyword(a,"Workforce Worker")||K.hasTypeKeyword(a,"Workforce Dispatcher")||!this._hasEditableFeatureLayer()?K.removeTypeKeyword(a,"Collector"):K.addTypeKeyword(a,"Collector")};m._evalDataEditingKeyword=function(a){this._hasEditableFeatureLayer()?
K.addTypeKeyword(a,"Data Editing"):K.removeTypeKeyword(a,"Data Editing")};m._evalOfflineKeyword=function(a){!K.hasTypeKeyword(a,"OfflineDisabled")&&this._isOfflineCapableMap()?K.addTypeKeyword(a,"Offline"):K.removeTypeKeyword(a,"Offline")};m._evalDeveloperBasemapKeyword=function(a){U.hasDeveloperBasemapLayer(this.basemap)?K.addTypeKeyword(a,"DeveloperBasemap"):K.removeTypeKeyword(a,"DeveloperBasemap")};m._hasEditableFeatureLayer=function(){return this._getAllLayersAndTables().some(a=>a.loaded&&this._isFeatureServiceLayer(a)&&
a.capabilities.operations.supportsEditing&&a.editingEnabled)};m._isFeatureServiceLayer=function(a){return!("feature"!==a.type||!a.source||"feature-layer"!==a.source.type)};m._isOfflineCapableMap=function(){return this._getAllLayersAndTables().filter(a=>"group"!==a.type).every(a=>a.loaded&&this._isOfflineCapableLayer(a))};m._isOfflineCapableLayer=function(a){return this._isFeatureServiceLayer(a)&&a.capabilities.operations.supportsSync||("tile"===a.type||"vector-tile"===a.type)&&(a.capabilities.operations.supportsExportTiles||
this._isExportableAGOLTileLayer(a)||U.isDeveloperBasemapLayer(a))&&a.spatialReference.equals(this.initialViewProperties.spatialReference)};m._isExportableAGOLTileLayer=function(a){return"tile"===a.type?ia.isServerOrServicesAGOLUrl(a.url)&&oa.some(c=>-1<a.url.toLowerCase().indexOf("/"+c+"/")):!1};m._updateItem=async function(a,c,e){await a.update({data:c});this._syncUpInstanceWithItem(a,c,e)};m._createItem=async function(a,c,e,w){const C=this.portalItem,M=!!(C&&C.id&&C.portal.user),O=a.portal;await O._signIn();
if(!await this._canCopyItem(C,M,O))throw new v("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");await O.user.addItem({item:a,folder:w.folder,data:c});this.portalItem=a;this._syncUpInstanceWithItem(a,c,e)};m._canCopyItem=async function(a,c,e){if(x.isSome(a)&&a.id&&a.typeKeywords&&-1<a.typeKeywords.indexOf("useOnly")){if(a.portal.portalHostname!==e.portalHostname)return!1;c||await a.reload();return"admin"===a.itemControl||"update"===a.itemControl}return!0};
m._syncUpInstanceWithItem=function(a,c,e){aa.MultiOriginJSONSupport.prototype.read.call(this,{version:c.version,authoringApp:c.authoringApp,authoringAppVersion:c.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:a.itemUrl&&t.urlToObject(a.itemUrl)});ha.updateOrigins(e);this.resourceInfo=c};m._updateItemThumbnail=async function(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename}),this._clearThumbnailOverride())};
m._getPortalItem=function(a){a=I.from(a);a.id&&(a=a.clone(),a.id=null);a.type||(a.type="Web Map");a.portal||(a.portal=D.getDefault());this._validateItemType(a);return a};m._updateFromInternal=async function(a,c){c=c||{};await fa.whenTrueOnce(a,"ready");this._updateInitialViewProperties(a,c);await this._updateThumbnailUrl(a,c)};m._updateInitialViewProperties=function(a,c){if(!c.backgroundExcluded){var e;this.initialViewProperties.background=null==(e=a.background)?void 0:e.clone()}this.initialViewProperties.spatialReference=
a.spatialReference.clone();c.viewpointExcluded||(this.initialViewProperties.viewpoint=new V({rotation:a.rotation,scale:c.scalePreserved?a.scale:null,targetGeometry:this._getViewExtent(a)}));if(!c.widgetsExcluded)for(const w of a.persistableViewModels)w.updateWebDocument(this)};m._getViewExtent=function(a){const c=a.center.clone().normalize();a=a.extent.clone();const e=a.width/2;a.xmin=c.x-e;a.xmax=c.x+e;return a};m._updateThumbnailUrl=async function(a,c){c.thumbnailExcluded||(c=la.getOptimalThumbnailSize(a,
c.thumbnailSize),a=await a.takeScreenshot({format:"png",width:c.width,height:c.height}),this._setAutoGeneratedThumbnail(a.dataUrl))};m._setAutoGeneratedThumbnail=function(a){this.thumbnailUrl=a;this._thumbnailFilename=null};m._clearThumbnailOverride=function(){this._clearOverride("thumbnailUrl");this.clear("thumbnailUrl","user");this._thumbnailFilename=null};m._generateCustomThumbnailFilename=function(a){if(t.isDataProtocol(a)){a=(a=(a=t.dataComponents(a))&&a.mediaType)&&S.get(a.toLowerCase())||null;
const c=`thumbnail${Date.now()}`;return a?`${c}.${a}`:c}return null};m._getThumbnailState=function(){let a=this.thumbnailUrl;a&&(a=this._isOverridden("thumbnailUrl")?a:t.addQueryParameter(a,"w","8192"));return{thumbnailUrl:a,filename:this._thumbnailFilename}};m._restoreThumbnailFromState=function(a){this.thumbnailUrl=a.thumbnailUrl;this._thumbnailFilename=a.filename};m._getAuthoringPropsState=function(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,
isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}};m._restoreAuthoringPropsFromState=function(a){a.isAuthoringAppSetByUser?this.authoringApp=a.authoringApp:this._isAuthoringAppSetByUser=!1;a.isAuthoringAppVersionSetByUser?this.authoringAppVersion=a.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1};T.fromJSON=function(a){if(!a)throw new v("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};d._createClass(T,[{key:"authoringApp",
set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)}},{key:"authoringAppVersion",set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)}},{key:"thumbnailUrl",get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?(this._override("thumbnailUrl",a),this._thumbnailFilename=this._generateCustomThumbnailFilename(a)):this._clearThumbnailOverride()}}]);return T}(aa.MultiOriginJSONMixin(J.LoadableMixin(F.EsriPromiseMixin(Z))));
f.VERSION=X;b.__decorate([p.property({type:ma,json:{write:!0}})],f.prototype,"applicationProperties",void 0);b.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"authoringApp",null);b.__decorate([y.writer("authoringApp")],f.prototype,"writeAuthoringApp",null);b.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"authoringAppVersion",null);b.__decorate([y.writer("authoringAppVersion")],f.prototype,"writeAuthoringAppVersion",
null);b.__decorate([p.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],f.prototype,"basemap",void 0);b.__decorate([p.property({type:ea,json:{write:{overridePolicy(N){return{enabled:!!(N&&0<N.length),ignoreOrigin:!0}}}}})],f.prototype,"bookmarks",void 0);b.__decorate([p.property({type:ja,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],f.prototype,"floorInfo",void 0);b.__decorate([p.property({type:W,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint",
"mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:da},"initialState.viewpoint":{type:V},mapRangeInfo:{type:ca},spatialReference:{type:B}}}}})],f.prototype,"initialViewProperties",void 0);b.__decorate([A.reader("initialViewProperties")],f.prototype,"readInitialViewProperties",null);b.__decorate([y.writer("initialViewProperties")],f.prototype,"writeInitialViewProperties",null);b.__decorate([p.property({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],
f.prototype,"layers",void 0);b.__decorate([y.writer("layers")],f.prototype,"writeLayers",null);b.__decorate([p.property({type:I})],f.prototype,"portalItem",void 0);b.__decorate([p.property({json:{write:!0}})],f.prototype,"presentation",void 0);b.__decorate([p.property()],f.prototype,"resourceInfo",void 0);b.__decorate([p.property({readOnly:!0,type:R.Version,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],f.prototype,"sourceVersion",void 0);b.__decorate([A.reader("sourceVersion")],
f.prototype,"readSourceVersion",null);b.__decorate([y.writer("sourceVersion")],f.prototype,"writeSourceVersion",null);b.__decorate([p.property({json:{read:!1,write:{ignoreOrigin:!0}}})],f.prototype,"tables",void 0);b.__decorate([y.writer("tables")],f.prototype,"writeTables",null);b.__decorate([p.property()],f.prototype,"thumbnailUrl",null);b.__decorate([p.property({type:ka,json:{write:!0}})],f.prototype,"widgets",void 0);return f=b.__decorate([G.subclass("esri.WebMap")],f)});