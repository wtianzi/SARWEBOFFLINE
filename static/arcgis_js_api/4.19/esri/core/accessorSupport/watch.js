// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../lang ./utils ./get ../ArrayPool ../ReentrantObjectPool ../scheduling ./trackingUtils".split(" "),function(k,w,t,x,D,E,F,y){function z(a){n.has(a)?g.splice(g.indexOf(a),1):n.add(a);g.push(a);u||(u=F.schedule(A))}function B(a){if(!a.removed){var {callback:b,path:e,oldValue:c,target:d}=a,h=a.getValue();w.equals(c,h)||(a.oldValue=h,b.call(d,h,c,e,d))}}function A(){let a=10;for(;u&&a--;){u=null;const e=g;g=l.acquire();n.clear();const c=l.acquire();for(const d of e){var b=d.uid;B(d);
b===d.uid&&d.removed&&c.push(d)}for(b=0;b<g.length;b++){const d=g[b];d.removed&&(c.push(d),n.delete(d),g.splice(b,1),--b)}for(b=0;b<c.length;b++)p.pool.release(c[b]);l.release(e);l.release(c);v.forEach(d=>d())}}function G(a,b,e){let c=t.parse(a,b,e,(d,h,q)=>{let f,m,r=y.reactionAsync(()=>x.valueOf(d,h),(H,I)=>{d.__accessor__.destroyed||f&&f.uid!==m?c.remove():(f||(f=p.pool.acquire(d,h,H,q,I),m=f.uid),z(f))});return{remove:t.once(function(){r.remove();f&&(f.uid!==m||f.removed||(f.removed=!0,z(f)),
f=null);c=r=null})}});return c}function J(a,b,e){const c=t.parse(a,b,e,(d,h,q)=>{let f=!1;return y.reaction(()=>x.valueOf(d,h),(m,r)=>{d.__accessor__.destroyed?c.remove():f||(f=!0,w.equals(r,m)||q.call(d,m,r,h,d),f=!1)})});return c}function C(a,b,e,c=!1){return!a.__accessor__||a.__accessor__.destroyed?{remove(){}}:c?J(a,b,e):G(a,b,e)}let p=function(){function a(){this.uid=0;this.getValue=this.callback=this.oldValue=this.path=this.target=null;this.removed=!1;this.propertyPath=null}var b=a.prototype;
b.acquire=function(e,c,d,h,q){this.target=e;this.path=c;this.oldValue=d;this.callback=h;this.getValue=q;this.propertyPath=t.pathToStringOrArray(c);this.uid=++a.uid;this.removed=!1};b.release=function(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null;this.uid=++a.uid;this.removed=!0};return a}();p.pool=new E.ReentrantObjectPool(p);p.uid=0;const l=new D,n=new Set;let g=l.acquire(),u;const v=new Set;k.afterDispatch=function(a){v.add(a);return{remove(){v.delete(a)}}};k.default=
C;k.dispatch=A;k.dispatchTarget=function(a){const b=l.copy(g);for(let e=0;e<b.length;e++){const c=b[e];c.target===a&&(B(c),n.delete(c),g.splice(g.indexOf(c),1))}};k.isValueInUse=function(a){return g.some(b=>b.oldValue===a)};k.removeTarget=function(a){for(let b=0;b<g.length;b++){const e=g[b];e.target===a&&(e.removed=!0)}};k.watch=C;Object.defineProperty(k,"__esModule",{value:!0})});