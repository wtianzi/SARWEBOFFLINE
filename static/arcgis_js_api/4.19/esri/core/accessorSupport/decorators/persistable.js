// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../../maybe ../metadata ./property ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../PropertyOrigin ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(y,u,l,z,A,B,p,C,D,r,q){function E(c,k,d){const h=z.getOwnPropertyMetadata(k,d);return{type:String,read:(b,e,g)=>{b=q.read(b,e,g);if(h.type===String)return b;if("function"===typeof h.type)return new h.type({url:b})},write:{writer(b,e,g,a){if(a&&a.resources){var f=l.isNone(b)?
null:"string"===typeof b?b:b.url;f=f?q.toJSON(f,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null;var m=h.type!==String&&(!B.isMultiOriginJSONMixin(this)||a&&a.origin&&this.originIdOf(d)>D.nameToId(a.origin));if(a&&a.portalItem&&l.isSome(f)&&!p.isAbsolute(f))if(m){{m=a.portalItem.resourceFromPath(f);const n=v(b,f,a),t=r.getResourceContentExtension(n),F=p.getPathExtension(m.path);t!==F?w(this,d,b,f,e,g,a,c):(x(this,
d,m,n,a.resources.toUpdate),e[g]=f)}}else a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(f)}),e[g]=f;else a&&a.portalItem&&(l.isNone(f)||l.isSome(q.itemIdFromResourceUrl(f))||p.isBlobProtocol(f)||m)?w(this,d,b,f,e,g,a,c):e[g]=f}else e[g]="string"===typeof b?q.toJSON(b,a):b.write({},a)}}}}function w(c,k,d,h,b,e,g,a){const f=C.generateUUID();d=v(d,h,g);const m=p.join(l.get(a,"prefix"),f);a=`${m}.${r.getResourceContentExtension(d)}`;const n=g.portalItem.resourceFromPath(a);p.isBlobProtocol(h)&&
g.resources.pendingOperations.push(G(h).then(t=>{n.path=`${m}.${r.getResourceContentExtension(t)}`;b[e]=n.itemRelativeUrl}).catch(()=>{}));x(c,k,n,d,g.resources.toAdd);b[e]=n.itemRelativeUrl}function x(c,k,d,h,b){b.push({resource:d,content:h,finish:e=>{"string"===typeof c[k]?c[k]=e.url:c[k].url=e.url}})}function v(c,k,d){return"string"===typeof c?{url:k}:new Blob([JSON.stringify(c.toJSON(d))],{type:"application/json"})}async function G(c){const k=(await new Promise(function(d,h){y(["../../../request"],
function(b){d(Object.freeze({__proto__:null,"default":b}))},h)})).default;({data:c}=await k(c,{responseType:"blob"}));return c}u.persistable=function(c){const k=l.isSome(c)&&c.origins?c.origins:[void 0];return(d,h)=>{a:if(l.isSome(c)&&"resource"===c.type)var b=E(c,d,h);else{switch(l.isSome(c)&&c.type?c.type:"other"){case "other":b={read:!0,write:!0};break a;case "url":{const {read:e,write:g}=q.persistableUrlUtils;b={read:e,write:g};break a}}b=void 0}for(const e of k){const g=A.propertyJSONMeta(d,
e,h);for(const a in b)g[a]=b[a]}}};Object.defineProperty(u,"__esModule",{value:!0})});