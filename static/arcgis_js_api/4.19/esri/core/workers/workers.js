// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("require exports ../has ../Error ../promiseUtils ./RemoteClient ./Connection ./WorkerOwner".split(" "),function(w,f,g,x,n,p,r,y){function z(a){if(a&&a.__esModule)return a;var b=Object.create(null);a&&Object.keys(a).forEach(function(c){if("default"!==c){var d=Object.getOwnPropertyDescriptor(a,c);Object.defineProperty(b,c,d.get?d:{enumerable:!0,get:function(){return a[c]}})}});b["default"]=a;return Object.freeze(b)}async function l(a,b){const c=new r;await c.open(a,b);return c}async function t(){if(m)return m;
u=n.createAbortController();const a=[];for(let b=0;b<h;b++){const c=y.create(b).then(d=>e[b]=d);a.push(c)}return m=Promise.all(a)}let h=g("esri-workers-debug")?1:g("host-browser")?navigator.hardwareConcurrency-1:0;h||(h=g("safari")&&g("mac")||g("trident")?7:2);let v=0;const e=[];let m=null,u;f.RemoteClient=p;f.Connection=r;f.initialize=function(){t()};f.open=async function(a,b={}){if("string"!==typeof a)throw new x("workers:undefined-module","modulePath is missing");var c=b.strategy||"distributed";
g("host-webworker")&&!g("esri-workers")&&(c="local");if("local"===c){var d=await p.loadWorker(a);d||(d=await new Promise(function(k,q){w([a],function(A){k(z(A))},q)}));n.throwIfAborted(b.signal);c=b.client||d;d=p.connect(d);return l([d],{...b,client:c})}await t();n.throwIfAborted(b.signal);if("dedicated"===c)return c=v++%h,c=await e[c].open(a,b),l([c],b);if(b.maxNumWorkers&&0<b.maxNumWorkers&&(c=Math.min(b.maxNumWorkers,h),c<h)){d=Array(c);for(let k=0;k<c;++k){const q=v++%h;d[k]=e[q].open(a,b)}return l(d,
b)}c=e.map(k=>k.open(a,b));return l(c,b)};f.openWithPorts=function(a,b){return l(a,{client:b})};f.terminate=function(){m&&(u.abort(),m=null);for(let a=0;a<e.length;a++)e[a]&&e[a].terminate();e.length=0};Object.defineProperty(f,"__esModule",{value:!0})});