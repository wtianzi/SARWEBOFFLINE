// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Logger ../spatialReferenceUtils ../webMercatorUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../projectionEllipsoid ../../projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../views/3d/support/buffer/BufferView".split(" "),function(m,A,w,B,y,n,p,q,C,D,r,g){function t(d,b,e,c,a,x){if(b){var h=a.isWGS84||w.isCGCS2000(a)||w.isMars(a)||w.isMoon(a),z=e.count;if(h)for(e=0;e<z;e++)c.getVec(e,k),b.getVec(e,l),h=p.getSphericalPCPF(a),
q.computeLinearTransformation(h,k,u,h),r.fromMat4(f,u),1===d&&r.transpose(f,f),n.transformMat3(l,l,f),x.setVec(e,l);else for(a=0;a<z;a++)c.getVec(a,k),b.getVec(a,l),q.computeLinearTransformation(p.SphericalECEFSpatialReference,k,u,p.SphericalECEFSpatialReference),r.fromMat4(f,u),h=B.y2lat(e.get(a,1)),h=Math.cos(h),0===d&&(h=1/h),f[0]*=h,f[1]*=h,f[2]*=h,f[3]*=h,f[4]*=h,f[5]*=h,1===d&&r.transpose(f,f),n.transformMat3(l,l,f),n.normalize(l,l),x.setVec(a,l);return x}}const v=A.getLogger("esri.geometry.support.meshUtils.normalProjection"),
k=y.create(),l=y.create(),u=D.create(),f=C.create();m.projectFromECEF=function(d,b,e){q.projectBuffer(d,p.getSphericalPCPF(e),0,b,e,0,d.length/3);return b};m.projectNormalFromECEF=function(d,b,e,c,a){if(!c.isWebMercator&&!c.isWGS84)return v.error("Cannot convert to PCS spatial reference buffer from ECEF"),a;t(1,g.BufferViewVec3f.fromTypedArray(d),g.BufferViewVec3f64.fromTypedArray(b),g.BufferViewVec3f64.fromTypedArray(e),c,g.BufferViewVec3f.fromTypedArray(a));return a};m.projectNormalToECEF=function(d,
b,e,c,a){if(!c.isWebMercator&&!c.isWGS84)return v.error("Cannot convert PCS spatial reference buffer to ECEF"),a;t(0,g.BufferViewVec3f.fromTypedArray(d),g.BufferViewVec3f64.fromTypedArray(b),g.BufferViewVec3f64.fromTypedArray(e),c,g.BufferViewVec3f.fromTypedArray(a));return a};m.projectTangentFromECEF=function(d,b,e,c,a){if(!c.isWebMercator&&!c.isWGS84)return v.error("Cannot convert to PCS spatial reference buffer from ECEF"),a;t(1,g.BufferViewVec3f.fromTypedArray(d,16),g.BufferViewVec3f64.fromTypedArray(b),
g.BufferViewVec3f64.fromTypedArray(e),c,g.BufferViewVec3f.fromTypedArray(a,16));for(b=3;b<d.length;b+=4)a[b]=d[b];return a};m.projectTangentToECEF=function(d,b,e,c,a){if(!c.isWebMercator&&!c.isWGS84)return v.error("Cannot convert PCS spatial reference buffer to ECEF"),a;t(0,g.BufferViewVec3f.fromTypedArray(d,4*Float32Array.BYTES_PER_ELEMENT),g.BufferViewVec3f64.fromTypedArray(b),g.BufferViewVec3f64.fromTypedArray(e),c,g.BufferViewVec3f.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(b=3;b<
d.length;b+=4)a[b]=d[b];return a};m.projectToECEF=function(d,b,e){q.projectBuffer(d,b,0,e,p.getSphericalPCPF(b),0,d.length/3);return e};m.transformBufferInPlace=function(d,b,e=!1){if(d)for(let a=0;a<d.length;a+=3){for(var c=0;3>c;c++)k[c]=d[a+c];n.transformMat4(k,k,b);e&&n.normalize(k,k);for(c=0;3>c;c++)d[a+c]=k[c]}};Object.defineProperty(m,"__esModule",{value:!0})});