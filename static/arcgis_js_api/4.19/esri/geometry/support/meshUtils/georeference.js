// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../projectionEllipsoid ../../../core/unitUtils ../../../chunks/mat4 ../../projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../views/3d/support/buffer/BufferView ./projection ../../../chunks/vec32".split(" "),function(q,C,D,r,v,E,F,w,x,k,l,m){function y(b,a,e){E.computeLinearTransformation(b.spatialReference,[b.x,b.y,b.z||0],e,D.getSphericalPCPF(b.spatialReference));const {horizontal:f,vertical:d}=t(a?a.unit:null,b.spatialReference);
v.scale(e,e,[f,f,d]);return e}function z(b,a){b=b.spatialReference;return b.isWGS84||b.isWebMercator&&(!a||!1!==a.geographic)}function t(b,a){if(C.isNone(b))return G;const e=a.isWGS84?1:r.getMetersPerUnit(a);a=a.isWGS84?1:r.getMetersPerVerticalUnitForSR(a);b=r.convertUnit(1,b,"meters");return{horizontal:b*e,vertical:b*a}}const u=w.create(),H=w.create(),A=F.create(),G={horizontal:1,vertical:1};q.georeference=function(b,a,e){if(z(a,e)){var f=a.spatialReference,d=y(a,e,u);e=new Float64Array(b.position.length);
var c=b.position,h=d;a=f;var g=e;m.transformMat4(k.BufferViewVec3f64.fromTypedArray(g),k.BufferViewVec3f64.fromTypedArray(c),h);c=new Float64Array(c.length);a=l.projectFromECEF(g,c,a);d=x.normalFromMat4(A,d);g=e;c=b.normal;h=d;var p=f;if(c){var n=new Float32Array(c.length);m.transformMat3(k.BufferViewVec3f.fromTypedArray(n),k.BufferViewVec3f.fromTypedArray(c),h);l.projectNormalFromECEF(n,a,g,p,n);g=n}else g=null;if(b=b.tangent){c=new Float32Array(b.length);m.transformMat3(k.BufferViewVec3f.fromTypedArray(c,
4*Float32Array.BYTES_PER_ELEMENT),k.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),d);for(d=3;d<c.length;d+=4)c[d]=b[d];l.projectTangentFromECEF(c,a,e,f,c);b=c}else b=null;b={position:a,normal:g,tangent:b}}else{{f=new Float64Array(b.position.length);d=b.position;g=a.x;c=a.y;h=a.z||0;const {horizontal:B,vertical:I}=t(e?e.unit:null,a.spatialReference);for(a=0;a<d.length;a+=3)f[a+0]=d[a+0]*B+g,f[a+1]=d[a+1]*B+c,f[a+2]=d[a+2]*I+h;b={position:f,normal:b.normal,tangent:b.tangent}}}return b};
q.ungeoreference=function(b,a,e){if(z(a,e)){var f=a.spatialReference;y(a,e,u);var d=v.invert(H,u);a=new Float64Array(b.position.length);e=d;var c=l.projectToECEF(b.position,f,a),h=k.BufferViewVec3f64.fromTypedArray(c);c=new Float64Array(c.length);var g=k.BufferViewVec3f64.fromTypedArray(c);m.transformMat4(g,h,e);e=c;d=x.normalFromMat4(A,d);c=b.normal;h=d;c?(c=l.projectNormalToECEF(c,b.position,a,f,new Float32Array(c.length)),g=k.BufferViewVec3f.fromTypedArray(c),m.transformMat3(g,g,h),h=c):h=null;
(c=b.tangent)?(b=l.projectTangentToECEF(c,b.position,a,f,new Float32Array(c.length)),f=k.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),m.transformMat3(f,f,d)):b=null;b={position:e,normal:h,tangent:b}}else{{f=new Float64Array(b.position.length);d=b.position;h=a.x;c=a.y;g=a.z||0;const {horizontal:p,vertical:n}=t(e?e.unit:null,a.spatialReference);for(a=0;a<d.length;a+=3)f[a+0]=(d[a+0]-h)/p,f[a+1]=(d[a+1]-c)/p,f[a+2]=(d[a+2]-g)/n;b={position:f,normal:b.normal,tangent:b.tangent}}}return b};
Object.defineProperty(q,"__esModule",{value:!0})});