// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Logger","../MeshComponent"],function(r,u,v){function w(a,c,d,b,k){if(a.components)for(var e of a.components){const g=e.cloneWithDeduplication(d,b);for(var f=0;f<g.faces.length;f++)g.faces[f]+=c.position/3;f=g;0<c.normal&&!a.vertexAttributes.normal&&"source"===f.shading&&(f.shading="flat");k.push(g)}else if(a.vertexAttributes&&a.vertexAttributes.position){d=a.vertexAttributes.position.length/3;b=new Uint32Array(d);for(e=0;e<d;e++)b[e]=e+c.position;d=b=new v({faces:b});
0<c.normal&&!a.vertexAttributes.normal&&"source"===d.shading&&(d.shading="flat");k.push(b)}}function p(a,c,d,b,k){if(c){var e=c.position;if(e)if(c=c[a]){k=0;e=d[a];d=b[a];var f=c.length;for(var g=0;g<f;g++)e[d++]=c[k++];b[a]+=c.length}else if(c=d[a],d=b[a],f=l[a],c){for(g=0;g<e.length;g+=3)for(let h=0;h<f;h++)c[d++]=k;b[a]=d}}}function x(a){var c,d,b;let k=0,e=0,f=0,g=0,h=0;var m=b=c=d=!1;for(const q of a){const n=q.vertexAttributes;if(n&&n.position&&(n.uv&&(d=!0),n.normal&&(c=!0),n.tangent&&(m=!0),
n.color&&(b=!0),c&&d&&b&&m))break}for(const q of a)(a=q.vertexAttributes)&&a.position&&(k+=a.position.length,d&&(e+=a.position.length/l.position*l.uv),c&&(f+=a.position.length/l.position*l.normal),b&&(g+=a.position.length/l.position*l.color),m&&(h+=a.position.length/l.position*l.tangent));return{position:new Float64Array(k),uv:e?new Float32Array(e):null,normal:f?new Float32Array(f):null,tangent:h?new Float32Array(h):null,color:g?new Uint8Array(g):null}}const t=u.getLogger("esri.geometry.support.triangleMeshMerge"),
l={position:3,normal:3,tangent:4,uv:2,color:4};r.merge=function(a,c){if(0===a.length)return t.error("merge()","Must specify one more more geometries to merge"),null;const d=a[0].spatialReference;if(a.some(h=>!h.spatialReference.equals(d)))return t.error("merge()","Geometries must all be in the same spatial reference"),null;const b=x(a),k=[],e={position:0,uv:0,normal:0,tangent:0,color:0},f=new Map,g=new Map;for(const h of a){a=h.vertexAttributes;if(c&&c.reuseMaterials&&h.components)for(const m of h.components)m.material&&
f.set(m.material,m.material);w(h,e,f,g,k);p("position",a,b,e,0);p("normal",a,b,e,0);p("tangent",a,b,e,0);p("uv",a,b,e,0);p("color",a,b,e,255)}return{vertexAttributes:b,components:k,spatialReference:d}};Object.defineProperty(r,"__esModule",{value:!0})});