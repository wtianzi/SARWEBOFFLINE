// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.19/esri/copyright.txt for details.
//>>built
define("exports ../../core/maybe ../../chunks/vec3f64 ../../chunks/mat3f64 ../../chunks/vec4f64 ./MeshTexture ./MeshMaterialMetallicRoughness ../../chunks/mat3 ../../views/3d/support/buffer/BufferView ../../chunks/vec32 ./meshUtils/georeference ../../views/3d/webgl-engine/materials/DefaultMaterial ../../views/3d/glTF/DefaultLoadingContext ../../chunks/vec22 ../../chunks/vec33 ../../chunks/vec43 ../../views/3d/support/buffer/utils ../../views/3d/glTF/loader ../../views/3d/glTF/internal/indexUtils ../../chunks/vec42".split(" "),
function(x,c,C,y,D,E,F,z,g,u,G,H,I,J,K,A,t,L,v,w){function M(a,e){const d=N(a.color,a.opacity),h=a.emissiveFactor?O(a.emissiveFactor):null;var l=c.unwrap(c.applySome(a.textureColor,b=>e.get(b))),p=c.unwrap(c.applySome(a.textureNormal,b=>e.get(b))),k=c.unwrap(c.applySome(a.textureEmissive,b=>e.get(b))),m=c.unwrap(c.applySome(a.textureOcclusion,b=>e.get(b)));a:{switch(a.alphaMode){case "OPAQUE":var q="opaque";break a;case "MASK":q="mask";break a;case "BLEND":q="blend";break a}q=void 0}a={color:d,colorTexture:l,
normalTexture:p,emissiveColor:h,emissiveTexture:k,occlusionTexture:m,alphaMode:q,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,metallic:a.metallicFactor,roughness:a.roughnessFactor,metallicRoughnessTexture:c.unwrap(c.applySome(a.textureMetallicRoughness,b=>e.get(b)))};return new F(a)}function P(a,e,d,h){var l=t.createBuffer(g.BufferViewVec3f64,d.attributes.position.count);u.transformMat4(l,d.attributes.position,d.transform);const p=c.applySome(d.attributes.normal,b=>{const f=t.createBuffer(g.BufferViewVec3f,
b.count),n=z.normalFromMat4(y.create(),d.transform);u.transformMat3(f,b,n);return f.typedBuffer}),k=c.applySome(d.attributes.tangent,b=>{const f=t.createBuffer(g.BufferViewVec4f,b.count),n=z.normalFromMat4(y.create(),d.transform);w.transformMat3(f,b,n);return f.typedBuffer}),m=c.applySome(d.attributes.texCoord0,b=>{const f=t.createBuffer(g.BufferViewVec2f,b.count);J.normalizeIntegerBuffer(f,b);return f.typedBuffer}),q=c.applySome(d.attributes.color,b=>{const f=t.createBuffer(g.BufferViewVec4u8,b.count);
if(4===b.elementCount)b instanceof g.BufferViewVec4f?w.scale(f,b,255):b instanceof g.BufferViewVec4u8?A.copy(f,b):b instanceof g.BufferViewVec4u16&&w.shiftRight(f,b,8);else{A.fill(f,255,255,255,255);const n=new g.BufferViewVec3u8(f.buffer,0,4);b instanceof g.BufferViewVec3f?u.scale(n,b,255):b instanceof g.BufferViewVec3u8?K.copy(n,b):b instanceof g.BufferViewVec3u16&&u.shiftRight(n,b,8)}return f.typedBuffer});h=G.georeference({position:l.typedBuffer,normal:c.unwrap(p),tangent:c.unwrap(k)},a,{...h,
unit:"meters"});l=Q(d.indices||d.attributes.position.count,d.primitiveType);return{vertexAttributes:{position:h.position,normal:h.normal,tangent:h.tangent,uv:c.unwrap(m),color:c.unwrap(q)},components:[{faces:l,material:e.get(d.material),trustSourceNormals:!0}],spatialReference:a.spatialReference}}function Q(a,e){switch(e){case 4:return v.trianglesToTriangles(a);case 5:return v.triangleStripToTriangles(a);case 6:return v.triangleFanToTriangles(a)}}function R(a){return{horizontal:B(a.s),vertical:B(a.t)}}
function B(a){switch(a){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}function r(a){return 255*a**(1/H.COLOR_GAMMA)}function N(a,e){return D.fromValues(r(a[0]),r(a[1]),r(a[2]),e)}function O(a){return C.fromValues(r(a[0]),r(a[1]),r(a[2]))}x.loadGLTFMesh=async function(a,e,d){var h=new I.DefaultLoadingContext;e=(await L.load(h,e,d,!0)).model;h=e.lods.shift();const l=new Map,p=new Map;e.textures.forEach((k,m)=>l.set(m,new E({data:k.data,wrap:R(k.parameters.wrap)})));e.materials.forEach((k,
m)=>p.set(m,M(k,l)));return h.parts.map(k=>P(a,p,k,d))};Object.defineProperty(x,"__esModule",{value:!0})});